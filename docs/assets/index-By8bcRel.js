(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const $f=(function(){const t={},e={};let i="gbr";t.define=({ioc:n,idiom:a})=>{e[n]=a},t.set=n=>{if(!n)return i;if(e[n])return i=n,e[n]},t.options=()=>Object.keys(e),t.current=()=>e[i];function r(n){if(!n)return"";let a=e[i];const s=n.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a}return t.tr=n=>{if(!n)return"";if(r(n))return r(n);let a=e.default;const s=n.split(".");for(;s.length;){const o=s.shift();a=a?.[o]||""}return a},t.obj=n=>n?e?.[i]?.[n]?e[i][n]:e.default[n]?e.default[n]:{}:"",e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t})();function Pt(t){return typeof t=="function"}function g1e(t){return typeof t=="string"}function pp(t){return typeof t=="object"&&!Array.isArray(t)}function v1e(t,e=0){let i=e,r,n;const a=()=>{i-=new Date().getTime()-n.getTime(),window.clearTimeout(r)},s=()=>i=e,o=()=>{n=new Date,r=window.setTimeout(function(){i=e,t()},i)};return o(),{pause:a,resume:o,reset:s}}var y1e=Object.defineProperty,Ai=(t,e)=>{for(var i in e)y1e(t,i,{get:e[i],enumerable:!0})};function CU(){return"2.2.36"}var Tk={};Ai(Tk,{competitionGovernor:()=>qG,drawsGovernor:()=>JH,entriesGovernor:()=>UW,eventGovernor:()=>PW,generationGovernor:()=>LW,matchUpFormatGovernor:()=>Zf,matchUpGovernor:()=>$W,mocksGovernor:()=>wx,participantGovernor:()=>p3,policyGovernor:()=>Wq,publishingGovernor:()=>Cx,queryGovernor:()=>rR,reportGovernor:()=>f3,scheduleGovernor:()=>m3,scoreGovernor:()=>Fv,tieFormatGovernor:()=>v3,tournamentGovernor:()=>w3,venueGovernor:()=>T3});var qG={};Ai(qG,{getLinkedTournamentIds:()=>I1,getTournamentIds:()=>y1,linkTournaments:()=>Mae,mutate:()=>Fie,query:()=>_ae,unlinkTournament:()=>Aae,unlinkTournaments:()=>Nae});var Fie={};Ai(Fie,{linkTournaments:()=>Mae,unlinkTournament:()=>Aae,unlinkTournaments:()=>Nae});var Nb="SINGLES",Ir="SINGLES",Wv="DOUBLES",fr="DOUBLES",rc="TEAM",_r="TEAM",Bie={SINGLES_MATCHUP:Nb,SINGLES:Ir,DOUBLES_MATCHUP:Wv,DOUBLES:fr,TEAM_MATCHUP:rc,TEAM:_r},$ie={[Ir]:[Ir,"S"],[fr]:[fr,"D"],[_r]:[_r,"T"],S:[Ir,"S"],D:[fr,"D"],T:[_r,"T"]};function Jn(t,e){return(t??0)-(e??0)}function ii(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function wd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function hY(t){if(!t.length)return;let e=[...t].sort(Jn),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function b1e(t){if(!wd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function WG(t){return isNaN(t)?0:t%2&&t+1||t}function YG(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function gn(t){return!isNaN(parseFloat(t))}function Vie(t){let e=ii(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function RU(t){if(isNaN(t))return!1;for(;!wd(t);)t++;return t}function Pc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function fi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function I1e(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function w1e(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function jie(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=jie(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=w1e(o,r)),parseFloat(o.toFixed(n))}function cA(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function vi(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function S1e(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function so(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function mT(t){return fi(t)?t:1/0}function Ul(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function T1e(t){return Gie(Ul(t))}function Gie(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function U1e(t,e,i){return i.indexOf(t)===e}function Hie(t){return t.filter(U1e)}function vl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function ml(t){let e=Math.floor(Math.random()*t.length);return t[e]}function vt(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function tp(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Un(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function fY(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function ho(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function D1e(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function E1e(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Ca(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function zie(t,[e,...i]){return t.length?[t.slice(0,e),...zie(t.slice(e),[...i,e])]:[]}function P1e(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function qie(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function Wie(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function $$(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function C1e(t,e=1){if(!Array.isArray(t)||!t.every(fi))return[];let i=Math.min(...t,e),r=Math.max(...t);return vt(i,r+1).filter(n=>!t.includes(n))}function Po(t){return typeof t=="function"}function jr(t){return typeof t=="string"}function ji(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function R1e(t,e){if(!ji(t)||!ji(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function Yie(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(ji).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var M1e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function V$(t,e){if(t===void 0)return null;if(!ji(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>V$(a))}:{[n]:e?r(t[n]):V$(t[n])}))}function j$(t){return Array.isArray(t)?t.length+t.map(j$).reduce((e,i)=>e+i,0):ji(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>j$(t[e])).reduce((e,i)=>e+i,0):0}function N1e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=j$(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Uk(t,e){return!Array.isArray(t)||!jr(e)?!1:Un(t,$ie[e]).length}var se={success:!0},Kie="error",Zie={SUCCESS:se,ERROR:Kie};function Xie({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==vi(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...se}}var tT={};Ai(tT,{addNotice:()=>bi,callListener:()=>CP,createInstanceState:()=>cne,cycleMutationStatus:()=>TH,deepCopyEnabled:()=>SH,deleteNotice:()=>EH,deleteNotices:()=>VI,disableNotifications:()=>dne,enableNotifications:()=>dN,getDevContext:()=>ac,getMethods:()=>UH,getNotices:()=>DH,getProvider:()=>J$,getTopics:()=>pc,getTournamentId:()=>jI,getTournamentRecord:()=>PH,getTournamentRecords:()=>Og,globalLog:()=>gne,handleCaughtError:()=>$k,hasTopic:()=>Fk,removeTournamentRecord:()=>mne,setDeepCopy:()=>PP,setDevContext:()=>EP,setGlobalLog:()=>une,setGlobalMethods:()=>pne,setGlobalSubscriptions:()=>hRe,setMethods:()=>hne,setStateMethods:()=>vne,setStateProvider:()=>dRe,setSubscriptions:()=>fRe,setTournamentId:()=>RP,setTournamentRecord:()=>fne,setTournamentRecords:()=>Bk,timeKeeper:()=>pRe});var G$={message:"Chronological error; time violation.",code:"ANACHRONISM"},UP={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Jie={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},H$={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},dn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Qe={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},i1={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},gT={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Ab={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Nt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Qie={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},nc={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Uy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},KG={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},ZG={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},vT={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},ere={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},tre={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},A1e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},XG={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},r1={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},Dk={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},_1e={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},MU={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},NU={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},JG={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},Ek={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},ire={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},n1={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Md={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},rre={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},nre={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},are={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},sre={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},ore={message:"Invalid action",code:"ERR_INVALID_ACTION"},z$={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},lre={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},cre={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},ure={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},QG={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},dre={message:"Existing round",code:"ERR_EXISTING_ROUND"},k1e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},dc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Qr={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},eH={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Dy={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},tH={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},pre={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Th={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Or={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Lc={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},hre={message:"Event exists",code:"ERR_EXISTING_EVENT"},fre={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},mre={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},iH={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},gre={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ey={message:"Invalid stage",code:"ERR_INVALID_STAGE"},vre={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},yre={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},bre={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},q$={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},a1={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},cN={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},O1e={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},AU={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},oh={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},rH={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},nH={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Ire={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},_U={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Qs={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},xI={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Os={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},hm={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Mo={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},il={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},aH={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Pk={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},x1e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},wre={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},sH={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Sre={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},oH={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},L1e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},s1={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},F1e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},lH={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},B1e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},Ck={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},$1e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},V1e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},LI={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Wt={message:"Missing value",code:"ERR_MISSING_VALUE"},Tre={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Ure={message:"Missing date",code:"ERR_MISSING_DATE"},Dre={message:"No valid dates",code:"ERR_NO_VALID_DATES"},uA={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},uN={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Ere={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},xa={message:"Invalid Date",code:"ERR_INVALID_DATE"},vu={message:"Invalid time",code:"ERR_INVALID_TIME"},Pre={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},W$={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Cre={message:"Invalid score",code:"ERR_INVALID_SCORE"},Rk={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},j1e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},cH={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Rre={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Mk={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Y$={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},Nk={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},FI={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Sd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},bl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Mre={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Td={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Nre={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},BI={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},o1={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},na={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Are={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},An={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},_re={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},G1e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},kre={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},_g={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Ore={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},xre={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Lre={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},kU={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Ak={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},uH={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},K$={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Fre={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},H1e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},z1e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Bre={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},$re={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Z$={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},dH={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},pH={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Vre={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},hH={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},yT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},jre={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},OU={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Gre={message:"Court exists",code:"ERR_EXISTING_COURT"},Hre={message:"Venue exists",code:"ERR_EXISTING_VENUE"},$I={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},kg={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},zre={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},fH={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},qre={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Wre={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},q1e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},mH={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Yre={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},gH={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},vH={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},_k={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Kre={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},iI={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Zre={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},xU={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Xre={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},kk={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Jre={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Qre={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},fm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},FE={message:"Invalid gender",code:"ERR_INVALID_GENDER"},DP={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},be={message:"Invalid values",code:"ERR_INVALID_VALUES"},ene={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},yH={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},tne={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Ok={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},bH={message:"Value unchanged",code:"ABORT_UNCHANGED"},ja={message:"Not found",code:"ERR_NOT_FOUND"},xk={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},ine={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},IH={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},rne={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},nne={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},X$={message:"Existing stage",code:"ERR_EXISTING_STAGE"},wH={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},l1={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},ane={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},c1={message:"Scores present",code:"ERR_SCORES_PRESENT"},sne={ANACHRONISM:G$,CANNOT_CHANGE_WINNING_SIDE:Nk,CANNOT_MODIFY_TIEFORMAT:cH,CANNOT_MODIFY_PARTICIPANT_TYPE:Rre,CANNOT_REMOVE_MAIN_STRUCTURE:Jie,CANNOT_REMOVE_PARTICIPANTS:Mk,CATEGORY_MISMATCH:Y$,COURT_EXISTS:Gre,COURT_NOT_FOUND:OU,DRAW_DEFINITION_NOT_FOUND:nc,DRAW_ID_EXISTS:rre,DRAW_POSITION_ACTIVE:Dk,DRAW_POSITION_ASSIGNED:vT,DRAW_POSITION_NOT_CLEARED:tre,DRAW_POSITION_NOT_FOUND:A1e,DRAW_SIZE_MISMATCH:ire,DUPLICATE_ENTRY:UP,DUPLICATE_VALUE:ene,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:$re,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Bre,EVENT_EXISTS:hre,EVENT_NOT_FOUND:Lc,EXISTING_DRAW_DEFINITIONS:Qie,EXISTING_END_TIME:fH,EXISTING_FLIGHT:ine,EXISTING_MATCHUP_ID:nne,EXISTING_OUTCOME:rne,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:kU,EXISTING_PARTICIPANT:Ak,EXISTING_POLICY_TYPE:oH,EXISTING_PROFILE:IH,EXISTING_ROUND:dre,EXISTING_STAGE:X$,EXISTING_STRUCTURE:wH,INCOMPATIBLE_MATCHUP_STATUS:cN,INCOMPLETE_SOURCE_STRUCTURE:KG,INSUFFICIENT_DRAW_POSITIONS:pH,INVALID_ACTION:ore,INVALID_ASSIGNMENT:z$,INVALID_BOOKINGS:uA,INVALID_CATEGORY:DP,INVALID_COLLECTION_DEFINITION:Qre,INVALID_CONFIGURATION:Jre,INVALID_DATE_AVAILABILITY:uN,INVALID_DATE:xa,INVALID_DRAW_DEFINITION:Ab,INVALID_DRAW_POSITION_FOR_SEEDING:ZG,INVALID_DRAW_POSITION:MU,INVALID_DRAW_SIZE:Ek,INVALID_END_TIME:zre,INVALID_ENTRIES:mre,INVALID_EVENT_TYPE:Th,INVALID_GAME_SCORES:W$,INVALID_GENDER:FE,INVALID_MATCHUP_FORMAT:rH,INVALID_MATCHUP_STATUS:AU,INVALID_MATCHUP_STATUS_BYE:bre,INVALID_MATCHUP:il,INVALID_OBJECT:fm,INVALID_PARTICIPANT_ID:Sd,INVALID_PARTICIPANT_IDS:bl,INVALID_PARTICIPANT_ROLE:Mre,INVALID_PARTICIPANT_SEEDING:nre,INVALID_PARTICIPANT_TYPE:Td,INVALID_PARTICIPANT:FI,INVALID_POLICY_DEFINITION:Sre,INVALID_RECORDS:H$,INVALID_SCALE_ITEM:iI,INVALID_SEED_NUMBER:cre,INVALID_SEED_POSITION:ure,INVALID_SET_NUMBER:B1e,INVALID_SIDE_NUMBER:lH,INVALID_SCORE:Cre,INVALID_STAGE:Ey,INVALID_START_TIME:Wre,INVALID_STRUCTURE:Uy,INVALID_STOP_TIME:qre,INVALID_TIE_FORMAT:oh,INVALID_TIME:vu,INVALID_TIME_ITEM:mH,INVALID_TOURNAMENT_DATES:Pre,INVALID_TOURNAMENT_RECORD:i1,INVALID_VALUES:be,INVALID_WINNING_SIDE:Rk,MATCHUP_NOT_FOUND:Os,METHOD_NOT_FOUND:l1,MISSING_ASSIGNMENTS:iH,MISSING_ASYNC_STATE_PROVIDER:Yre,MISSING_AVOIDANCE_POLICY:wre,MISSING_BIRTH_DATE:Tre,MISSING_COLLECTION_DEFINITION:Ire,MISSING_COURT_ID:LI,MISSING_COURTS_INFO:jre,MISSING_DATE_AVAILABILITY:Ere,MISSING_DATE:Ure,MISSING_DRAW_DEFINITION:Nt,MISSING_DRAW_ID:Md,MISSING_DRAW_POSITION:NU,MISSING_DRAW_POSITIONS:r1,MISSING_DRAW_SIZE:n1,MISSING_ENTRIES:fre,MISSING_EVENT:Or,MISSING_QUALIFIED_PARTICIPANTS:Are,MISSING_MATCHUP_FORMAT:nH,MISSING_MATCHUP_ID:Qs,MISSING_MATCHUP_IDS:xI,MISSING_MATCHUP:Mo,MISSING_MATCHUPS:hm,MISSING_PARTICIPANT_COUNT:Ore,MISSING_PARTICIPANT_ID:na,MISSING_PARTICIPANT_IDS:_g,MISSING_PARTICIPANT_ROLE:Nre,MISSING_PARTICIPANT:BI,MISSING_PARTICIPANTS:o1,MISSING_PENALTY_ID:hH,MISSING_PENALTY_TYPE:Vre,MISSING_PERSON_DETAILS:Lre,MISSING_POLICY_ATTRIBUTES:sH,MISSING_POLICY_DEFINITION:Pk,MISSING_POLICY_TYPE:aH,MISSING_POSITION_ASSIGNMENTS:yre,MISSING_ROUND_NUMBER:k1e,MISSING_SCHEDULE:Kre,MISSING_SCORING_POLICY:F1e,MISSING_SEED_ASSIGNMENTS:lre,MISSING_SEEDCOUNT_THRESHOLDS:sre,MISSING_SEEDING_POLICY:x1e,MISSING_SET_NUMBER:$1e,MISSING_SET_OBJECT:Ck,MISSING_SIDE_NUMBER:V1e,MISSING_STAGE:gre,MISSING_STRUCTURE_ID:dc,MISSING_STRUCTURE:Dy,MISSING_MAIN_STRUCTURE:tH,MISSING_STRUCTURES:eH,MISSING_TARGET_LINK:QG,MISSING_TIE_FORMAT:_U,MISSING_TIME_ITEM:gH,MISSING_TIME_ITEMS:vH,MISSING_TOURNAMENT_ID:gT,MISSING_TOURNAMENT_RECORD:Qe,MISSING_TOURNAMENT_RECORDS:dn,MISSING_VALUE:Wt,MISSING_VENUE_ID:kg,MODIFICATIONS_FAILED:Zre,NO_CANDIDATES:kk,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:dH,NO_MODIFICATIONS_APPLIED:xU,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Z$,NO_PARTICIPANT_REMOVED:kre,NO_VALID_ACTIONS:tne,NO_VALID_ATTRIBUTES:Ok,NO_VALID_DATES:Dre,NOT_FOUND:ja,NOT_IMPLEMENTED:xk,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:uH,PARTICIPANT_ID_EXISTS:_re,PARTICIPANT_NOT_CHECKED_IN:xre,PARTICIPANT_NOT_FOUND:An,PARTICIPANT_PAIR_EXISTS:G1e,PENALTY_NOT_FOUND:yT,POLICY_NOT_ATTACHED:L1e,POLICY_NOT_FOUND:s1,SCHEDULE_NOT_CLEARED:ere,SCHEDULED_MATCHUPS:ane,SCORES_PRESENT:c1,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:are,STAGE_SEQUENCE_LIMIT:vre,STRUCTURE_NOT_FOUND:Qr,TEAM_NOT_FOUND:yH,UNABLE_TO_ASSIGN_COURT:Xre,UNLINKED_STRUCTURES:pre,UNRECOGNIZED_DRAW_TYPE:XG,UNRECOGNIZED_MATCHUP_FORMAT:a1,UNRECOGNIZED_MATCHUP_STATUS:q$,VALUE_UNCHANGED:bH,VENUE_EXISTS:Hre},Xr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},one={addNotice:nRe,callListener:cRe,cycleMutationStatus:rRe,deleteNotice:oRe,deleteNotices:sRe,disableNotifications:W1e,enableNotifications:Y1e,getMethods:Lk,getNotices:aRe,getTopics:lRe,getTournamentId:lne,getTournamentRecord:K1e,getTournamentRecords:Z1e,removeTournamentRecord:eRe,setMethods:iRe,setSubscriptions:tRe,setTournamentId:J1e,setTournamentRecord:X1e,setTournamentRecords:Q1e,handleCaughtError:uRe};function W1e(){Xr.disableNotifications=!0}function Y1e(){Xr.disableNotifications=!1}function lne(){return Xr.tournamentId}function K1e(t){return Xr.tournamentRecords[t]}function Z1e(){return Xr.tournamentRecords}function X1e(t){let e=t?.tournamentId;return e?(Xr.tournamentRecords[e]=t,{success:!0}):{error:i1}}function J1e(t){return t?Xr.tournamentRecords[t]?(Xr.tournamentId=t,{success:!0}):{error:Qe}:(Xr.tournamentId=void 0,{success:!0})}function Q1e(t){Xr.tournamentRecords=t;let e=Object.keys(t);e.length===1?Xr.tournamentId=e[0]:e.length||(Xr.tournamentId=void 0)}function eRe(t){if(typeof t!="string")return{error:be};if(!Xr.tournamentRecords[t])return{error:ja};delete Xr.tournamentRecords[t];let e=Object.keys(Xr.tournamentRecords);return e.length===1?Xr.tournamentId=e[0]:e.length||(Xr.tournamentId=void 0),{success:!0}}function tRe(t){return typeof t.subscriptions!="object"?{error:be}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Xr.subscriptions[e]=t.subscriptions[e]:delete Xr.subscriptions[e]}),{...se})}function iRe(t){return typeof t!="object"?{error:be}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Xr.methods[e]=t[e])}),{...se})}function rRe(){let t=Xr.modified;return Xr.modified=!1,t}function nRe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Xr.disableNotifications||(Xr.modified=!0),!(Xr.disableNotifications||!Xr.subscriptions[t]&&!r)))return i&&(Xr.notices=Xr.notices.filter(n=>!(n.topic===t&&n.key===i))),Xr.notices.push({topic:t,payload:e,key:i}),{...se}}function Lk(){return Xr.methods??{}}function aRe({topic:t}){return Xr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function sRe(){Xr.notices=[]}function oRe({topic:t,key:e}){Xr.notices=Xr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function lRe(){return{topics:Object.keys(Xr.subscriptions)}}function cRe({topic:t,notices:e},i){let r=Xr.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function uRe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:lne(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Dr={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Ga=one,mY=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function dRe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Un(Object.keys(t),mY).length!==mY.length)throw new Error("Global state provider is missing required methods");return Ga=t,{success:!0}}function cne(){if(Ga.createInstanceState){try{Ga.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Yre}}function ac(t){return!t||typeof t!="object"?Dr.devContext??!1:typeof Dr.devContext!="object"?!1:Object.keys(t).every(e=>Dr.devContext?.[e]===t[e])&&Dr.devContext}function pRe(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Dr.timers).filter(r=>r!=="default"||Dr.timers[r].startTime).map(r=>{let n=Dr.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Dr.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Dr.timers[e].state==="stopped"?0:(i-(Dr.timers[e]?.startTime??0))/1e3,n=Dr.timers[e].elapsedTime+r;return{state:Dr.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Dr.timers[e]||t==="reset"){if(e==="allTimers")return Dr.timers={default:{elapsedTime:0}},!0;Dr.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Dr.timers[e].elapsedTime||(Dr.timers[e].elapsedTime=0),t==="stop"&&Dr.timers[e].state!=="stopped"&&(Dr.timers[e].state="stopped")&&(Dr.timers[e].elapsedTime+=(i-(Dr.timers[e]?.startTime??0))/1e3),t==="start"&&(Dr.timers[e].startTime=i)&&(Dr.timers[e].state="active"),Dr.timers[e]}function une(t){Po(t)?Dr.globalLog=t:delete Dr.globalLog}function EP(t){Dr.devContext=t}function dne(){Ga.disableNotifications()}function dN(){Ga.enableNotifications()}function PP(t,e){typeof t=="boolean"&&(Dr.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Dr.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Dr.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Dr.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Dr.deepCopyAttributes.threshold=e.threshold))}function SH(){return{enabled:Dr.deepCopy,...Dr.deepCopyAttributes}}function hRe(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Dr.globalSubscriptions[e]=t.subscriptions[e]}),{...se}):{error:Wt,info:"missing subscriptions"}}function fRe(t){return t?.subscriptions?Ga.setSubscriptions({subscriptions:t.subscriptions}):{error:Wt,info:"missing subscriptions"}}function pne(t){return t?typeof t!="object"?{error:be}:(Object.keys(t).forEach(e=>{Po(t[e])&&(Dr.globalMethods[e]=t[e])}),{...se}):{error:Wt,info:"missing method declarations"}}function hne(t){return t?typeof t!="object"?{error:be}:Ga.setMethods(t):{error:Wt,info:"missing method declarations"}}function TH(){return Ga.cycleMutationStatus()}function bi(t){if(typeof t?.topic!="string")return;let e=Dr.globalSubscriptions[t.topic];return Ga.addNotice(t,e)}function UH(){return{...Dr.globalMethods,...Ga.getMethods()}}function DH(t){return Ga.getNotices(t)}function EH({key:t,topic:e}){return Ga.deleteNotice({key:t,topic:e})}function VI(){return Ga.deleteNotices()}function pc(){return Ga.getTopics()}function Fk(t){return pc()?.topics?.includes(t)}async function CP(t){return Ga.callListener(t,Dr.globalSubscriptions)}function jI(){return Ga.getTournamentId()}function PH(t){return Ga.getTournamentRecord(t)}function Og(){return Ga.getTournamentRecords()}function fne(t){return Ga.setTournamentRecord(t)}function Bk(t){return Ga.setTournamentRecords(t)}function RP(t){return Ga.setTournamentId(t)}function mne(t){return Ga.removeTournamentRecord(t)}function J$(){return Ga}function $k({engineName:t,methodName:e,params:i,err:r}){let n=Po(Ga.handleCaughtError)&&Ga.handleCaughtError||one.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function gne(t,e){if(Dr.globalLog)try{Dr.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),une()}else console.log(e,t)}function vne(t,e,i,r){if(!ji(t))return{error:be};gn||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{Po(o[c])?a[c]=o[c]:ji(o[c])&&(e===!0||n?.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),r?pne(a):hne(a),{methods:a}}function mRe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Lt(t,e,i,r){if(typeof t!="object"||t===null)return t;SH()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=mRe(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Lt(o))}:{[s]:r?t[s]:Lt(t[s])}))}function ce({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Lt(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...se}),e??{success:!0}}var us="FEMALE",Tf="OTHER",GI="MIXED",Zn="MALE",_p={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:us,MIXED:GI,OTHER:Tf,MALE:Zn,ANY:"ANY"};function Cv(t){return[us,"F"].includes(t)}function Eb(t){return[Zn,"M"].includes(t)}function ec(t){return[GI,"X"].includes(t)}function lh(t){return["ANY","A"].includes(t)}function Ms(t){if(t){if(Cv(t))return us;if(ec(t))return GI;if(Eb(t))return Zn;if(lh(t))return"ANY"}return Tf}function hp(t){return Cv(t)||Eb(t)}var gRe="MIXED events can not contain mixed singles or { gender: ANY } collections",vRe="events with { gender: ANY } can not contain MIXED singles collections";function Vk(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&hp(i)&&Ms(i)!==Ms(n)?ce({result:{valid:!1,error:FE},context:{gender:n},stack:e}):ec(i)&&(lh(n)||ec(n)&&r!==fr)?ce({result:{error:FE,valid:!1},info:gRe,stack:e}):lh(i)&&ec(n)&&r!==fr?ce({result:{error:FE,valid:!1},info:vRe,stack:e}):{valid:!0}}var yRe="normal",gY="timed",bRe="final",CH="NOAD",IRe={S:yRe,F:bRe};function jk(t,e){if((t?.bestOf||t?.exactly)&&t?.setFormat)return wRe(t,e)}function MP(t){return!isNaN(Number(t))&&Number(t)}function yne(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function wRe(t,e){let i=MP(t.bestOf)||void 0,r=MP(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return yne(t.setFormat);let a=n&&`SET${n}`||"",s=vY(t.setFormat,e),o=s&&`S:${s}`||"",l=vY(t.finalSetFormat,e),c=n&&n>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,c].filter(u=>u).join("-")}function vY(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return yne(t);if(t.tiebreakSet)return yY(t.tiebreakSet);let i=MP(t.setTo);if(i){let r=t.NoAD&&CH||"",n=yY(t.tiebreakFormat),a=n&&`/${n}`||"",s=MP(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function yY(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&MP(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?CH:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Bs(t){if(jr(t)){let e=t.startsWith("T")&&gY||t.startsWith("SET")&&"SET"||"";if(e===gY){let i=Ine(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return SRe(t)}}function SRe(t){let e=t.split("-"),i=u1(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&bY(e[1]),s=e&&bY(e[2]),o=a&&a.timed||s&&s.timed,l=r&&r<6||o&&n,c=!e[2]||s,u=a,d=Lt({setFormat:a,exactly:n,bestOf:r});if(s&&(d.finalSetFormat=s),l&&u&&c)return d}function bY(t){if(t?.[1]===":"){let e=t.split(":"),i=IRe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let f=IY(r);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(r.startsWith("T"))return Ine(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&wne(n[2])||!1,s=!n?.[2]||a,o=n?u1(n[1]):void 0,l=bne(r),c=l!==!1,u=c&&l||o,d=IY(r.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,o&&s&&p&&c&&h||!1}}}function bne(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?u1(i[1]):i[1])||!1}function IY(t){if(t)if(t.startsWith("TB")){let e=bne(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i?.[1],n=i&&wne(i[2]),a=!i?.[2]||n,s=u1(r);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!fi(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}else return!1}else return!1}function Ine(t){let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=u1(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2],s=[void 0,"P","G"].includes(a);if(a&&!s){let o=e.match(/^(\d+)(@)([A-Za-z]+)$/)?.[3];return o?(n.modifier=o,n):void 0}return a&&(n.based=i[2]),n}function wne(t){return t&&t.indexOf(CH)>=0}function u1(t){return isNaN(Number(t))?0:Number(t)}function Dl({matchUpFormat:t}){if(!jr(t)||t==="")return!1;let e=Bs(t),i=/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),o=s?.[1],l=s?.[2],c=s?.[3];return jk(e,!!(i&&n&&r===a||s&&l&&o===c))===t}var dA=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Sne=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,fp=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Rv=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function pA(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ti(t.scheduledTime)),!e)return;let i=Gr(t.scheduledTime),r=Ti(e);return r&&i&&(r+=`T${i}`),r}function TRe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function LU(t){let e=typeof t=="string"?t?.split(" "):[];return t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Rv.test(HI(t,!0,!0)))}function el(t){return Yv(t)||dA.test(t)}function URe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return DRe(i,{displaySeconds:!1})}function DRe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(Nc).join(":")}var RH=t=>{let e=NP(t)||Yv(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Nc(r)}-${Nc(e.getUTCDate())}`};function ERe(t){let e=NP(t)||Yv(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Du(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function hA(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function PRe(t){return hA(t).getTime()}function NP(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function bT(t,e){if(!el(t)||!el(e))return[];let i=Ti(t)+"T00:00",r=Ti(e)+"T00:00",n=new Date(i),a=new Date(r),s=NP(a)&&NP(n)&&c(n,a),o=[],l=0;if(s){let u=n,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),d=u.setDate(u.getDate()+1)}return o.map(u=>Du(u));function c(u,d){return u<=d}}var CRe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Yv(t){return typeof t!="string"?!1:CRe.test(t)}function MH(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function Xi(t){let e=Gr(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function RRe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Nc(e),Nc(i)].join(":")}function fA(t){return MH(t)?t.split(":").slice(0,2).map(Nc).join(":"):void 0}function Gr(t){return Yv(t)&&t.indexOf("T")>0?fA(t.split("T").reverse()[0]):fA(t)}function Ti(t){return Yv(t)||fp.test(t)?t.split("T")[0]:void 0}function DE(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ti(i.toISOString())}function mA(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function MRe(t){let e=mA(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Nc).join(":")}function NRe(t){let e=mA(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function HI(t,e,i){let r=Ti(t),n=Gr(t),a=r?n:t;return t?e&&(r&&i&&t||MRe(a))||NRe(a):void 0}function Tne(t,e){let i=mA(t),r=mA(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function NH(t,e=7){let i=Ti(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Du(n)}function ARe(t){return NH(t)}function _Re(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Du(n,i)}function kRe(t,e,i){let r=new Date(t,0);return Du(new Date(r.setDate(e)),i)}function jn(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(Nc),n=hA(e).setHours(i,r,0,0);return hA(n)}function d1(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Jo(t,e){let i=Gr(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return Gr(AH(jn(i),r).toISOString())}function AH(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Nc(t){return t.toString()[1]?t:"0"+t}function Uh(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var Une={addDays:NH,addWeek:ARe,addMinutesToTimeString:Jo,convertTime:HI,getIsoDateString:pA,getUTCdateString:RH,DateHHMM:URe,extractDate:Ti,extractTime:Gr,formatDate:Du,getDateByWeek:_Re,isISODateString:Yv,isDate:NP,isTimeString:MH,offsetDate:hA,offsetTime:PRe,sameDay:Uh,timeStringMinutes:Xi,timeToDate:jn,timeUTC:ERe,validTimeValue:LU,validDateString:dA,timeValidation:Rv,dateValidation:fp},ORe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),xRe=t=>t.filter(Boolean).every(gn);function rI(t){let e=t.category;if(typeof e!="object")return{error:DP};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(ORe([i,r,n,o],"string")&&xRe([a,s])&&[r,n].filter(Boolean).every(el)))return{error:DP};let c=t.consideredDate??Ti(new Date().toLocaleDateString("sv"));if(!el(c))return{error:xa};let[u]=c.split("-").slice(0,3).map(V=>parseInt(V)),d=DE(c,-1),[p,h]=d.split("-").slice(1,3).map(V=>parseInt(V)),f=`${Nc(p)}-${Nc(h)}`,m=DE(c,1),[g,v]=m.split("-").slice(1,3).map(V=>parseInt(V)),y=`${Nc(g)}-${Nc(v)}`,b=s&&DE(c,-1*365*s),I=a&&DE(c,-1*365*a),w=[],T=V=>!w.includes(V)&&w.push(V);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,C=i?.includes("-"),E=C&&i?.match(D),P=i?.match(S),R=(V,F)=>`${V}-${F}`,M=V=>{let F=u-V,j=R(F,y);e.ageMinDate&&e.ageMinDate!==j&&T(`Invalid submitted ageMinDate: ${n}`),n=j,i&&(e.ageMax&&e.ageMax!==V-1&&(T(`Invalid submitted ageMax: ${a}`),I=void 0),a=V-1)},A=V=>{let F=u-V-1,j=R(F,y);e.ageMin&&e.ageMin>V&&T(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>V&&T(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==j&&T(`Invalid submitted ageMinDate: ${n}`),n=j,i&&(e.ageMax&&e.ageMax!==V&&(T(`Invalid submitted ageMax: ${a}`),b=void 0),a=V)},N=V=>{let F=u-V,j=R(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&T(`Invalid submitted ageMaxDate: ${r}`),r=j,i&&(e.ageMin&&e.ageMin!==V+1&&(T(`Invalid submitted ageMin: ${s}`),b=void 0),s=V+1)},k=V=>{let F=u-V-1,j=R(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&T(`Invalid submitted ageMaxDate: ${r}`),r=j,i&&(e.ageMin&&e.ageMin!==V&&(T(`Invalid submitted ageMin: ${s}`),b=void 0),s=V)},x=V=>{let[F,j,q]=(V.match(S)||[]).slice(1),W=parseInt(j);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&T(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(W)):F==="O"&&N(W),q==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&T(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(W)):q==="O"&&k(W),r=r??b,n=n??I};if(E){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let j=u-e.ageMin;r=R(j,f)}if(e.ageMax){let j=u-e.ageMax-1;n=R(j,y)}let[V,F]=(i?.match(D)??[]).slice(1).map(j=>parseInt(j));V<=F?(s=V,a=F,l=!0):T(`Invalid combined age range ${i}`)}else C?i?.split("-").forEach(x):P?x(i):(s&&N(s),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(T(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Lt({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return w.length&&(O.errors=w),O}function AP({category:t}){if(!ji(t))return{error:be};let e=rI({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!gn(i)?ce({result:{error:be},context:{ratingMax:i}}):r&&!gn(r)?ce({result:{error:be},context:{ratingMin:r}}):{...e}}function p1({childCategory:t,withDetails:e,category:i}){let r=AP({category:i}),n=AP({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Lt({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function h1({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ce({result:{errors:l,error:fm},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!Uk([Ir,fr],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!c?.length].concat([m,d,v,y].map(fi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let w=Xie({collectionValueProfiles:c,matchUpCount:h});w.errors&&l.push(...w.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Dl({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),r){let w=Vk({referenceGender:a,matchUpType:g,gender:I});if(w.error)return ce({context:{referenceGender:a,gender:I},result:w,stack:o})}if(t&&n&&b){let w=p1({category:n,childCategory:b});if(!w.valid)return ce({result:{error:DP},context:w,stack:o})}return l.length?ce({result:{errors:l,error:Qre},stack:o}):{valid:!0}}function No(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=LRe({...t,stack:s});if(l?.error)return l;let c,u=n.collectionDefinitions.every(g=>{let{setValue:v,scoreValue:y,collectionValue:b}=g;(v||y)&&!b&&(c=!0);let{valid:I,errors:w}=h1({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:g,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return I?!0:(Array.isArray(w)&&o.push(...w),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!c||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return c?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ce({context:{tieFormat:n,errors:o,aggregateValueImperative:c},result:{error:oh},stack:s});let p=n.collectionDefinitions.map(({collectionId:g})=>g),h=!r||p.length===vi(p).length,f=u&&d&&h;return f?{valid:f,errors:o}:ce({result:{error:oh},context:{tieFormat:n,errors:o},stack:s})}function LRe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!ji(e)?ce({result:{error:oh},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):ji(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...se}:ce({result:{error:oh},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ce({result:{error:oh},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var IT="resourceSubType",wT="resourceType",ST="identifier",Dne={RESOURCE_SUB_TYPE:IT,RESOURCE_TYPE:wT,IDENTIFIER:ST};function Tt(t,e,i,r,n=0){if(J$().makeDeepCopy)return J$().makeDeepCopy(t,e,i,r);let a=SH(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!a?.enabled&&!i||typeof t!="object"||Po(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||Po(l)&&!l(h)),p=(h,f)=>{u[h]=Po(f?.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=Po(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=_H(f);Object.assign(u,...g)}else r&&h==="extensions"?u[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&Po(f?.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:TRe(f)?u[h]=new Date(f).toISOString():u[h]=Tt(f,e,i,r,n+1)}return u}function _H(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function Ene(t=1,e){return vt(0,t).map(()=>or(e))}function or(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var Pne={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Cne={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Rne={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Mne={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Nne={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Ane={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},_ne={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},kne={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},One={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},xne={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Eu="SET3-S:6/TB7",FRe="SET3-S:6NOAD",Lne="SET3-S:6/TB7-F:TB10",BRe="SET3-S:4/TB7",$Re="SET3-S:4/TB5@3",VRe="SET1-S:T20",jRe="SET1-S:8/TB7",GRe="SET1-S:8/TB7@7",HRe={FORMAT_STANDARD:Eu,FORMAT_STANDARD_NOAD:FRe,FORMAT_ATP_DOUBLES:Lne,FORMAT_SHORT_SETS:BRe,FORMAT_FAST4:$Re,FORMAT_PRO_SET:jRe,FORMAT_COLLEGE_PRO_SET:GRe,TIMED20:VRe},Fne={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Bne={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},$ne={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Vne={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},jne={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Gne={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Hne={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},gA="COLLEGE_DEFAULT",Q$="COLLEGE_JUCO",eV="COLLEGE_D3",zne="DOMINANT_DUO",qne="DOMINANT_DUO_MIXED",Wne="LAVER_CUP",Yne="TEAM_DOUBLES_3_AGGREGATION",Kne="TIME_TENNIS_DUAL",Zne="TIME_TENNIS_PRO_CIRCUIT",Xne="USTA_BREWER_CUP",Jne="USTA_OZAKI_CUP",Qne="USTA_COLLEGE",eae="USTA_GOLD_TEAM_CHALLENGE",tae="USTA_LEVEL_1",iae="USTA_INTERSECTIONAL",rae="USTA_SECTION_BATTLE",nae="USTA_SOUTHERN_LEVEL_5",aae="USTA_TOC",sae="USTA_WTT_ITT",oae="USTA_ZONAL",lae={COLLEGE_D3:eV,COLLEGE_DEFAULT:gA,COLLEGE_JUCO:Q$,DOMINANT_DUO:zne,DOMINANT_DUO_MIXED:qne,LAVER_CUP:Wne,TEAM_DOUBLES_3_AGGREGATION:Yne,TIME_TENNIS_DUAL:Kne,TIME_TENNIS_PRO_CIRCUIT:Zne,USTA_BREWER_CUP:Xne,USTA_OZAKI_CUP:Jne,USTA_COLLEGE:Qne,USTA_GOLD_TEAM_CHALLENGE:eae,USTA_INTERSECTIONAL:iae,USTA_LEVEL_1:tae,USTA_SECTION_BATTLE:rae,USTA_SOUTHERN_LEVEL_5:nae,USTA_TOC:aae,USTA_WTT_ITT:sae,USTA_ZONAL:oae},cae="STANDARD",wY={[cae]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[eV]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Eu,matchUpCount:6,matchUpValue:1},tieFormatName:eV,valueGoal:5},[gA]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Eu,matchUpCount:6,matchUpValue:1},tieFormatName:gA,valueGoal:4},[Q$]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Eu,matchUpCount:6,matchUpValue:1},tieFormatName:Q$,valueGoal:5},[Wne]:Gne,[zne]:Fne,[qne]:_ne,[Yne]:Cne,[Kne]:kne,[Zne]:Ane,[Xne]:One,[Jne]:xne,[Qne]:Bne,[eae]:Pne,[iae]:Nne,[tae]:$ne,[rae]:Mne,[nae]:Rne,[sae]:Vne,[aae]:Hne,[oae]:jne},zRe=t=>{let e=t?.namedFormat&&Object.keys(wY).includes(t.namedFormat)?t.namedFormat:cae,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Tt(wY[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??or();let c=t?.event?.eventId;return i.pop()??`${c}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:Lne,collectionName:"Doubles",matchUpType:fr,...s.doubles},{collectionId:o(1),matchUpFormat:Eu,collectionName:"Singles",matchUpType:Ir,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Vf=zRe,mp="SINGLES",nI="SINGLES",Fc="DOUBLES",jf="DOUBLES",Qn="TEAM",El="TEAM",qRe="RATING",WRe="BOTH",ll={AGE:"AGE",BOTH:WRe,DOUBLES:Fc,DOUBLES_EVENT:jf,RATING:qRe,SINGLES:mp,SINGLES_EVENT:nI,TEAM_EVENT:El,TEAM:Qn},Ut="MAIN",Ht="QUALIFYING",bs="CONSOLATION",La="VOLUNTARY_CONSOLATION",In="PLAY_OFF",Gk=[Ut,Ht,bs,In,La],aI={[Ht]:1,[Ut]:2,[In]:3,[bs]:3,[La]:4},uae="finishingPositions",dae="aggregateEventStructures",pae={[Ut]:1,[In]:2,[bs]:3,[Ht]:4,[La]:5},YRe={[In]:1,[Ut]:2,[bs]:3,[Ht]:4,[La]:5},Hk="CLUSTER",KRe="SEPARATE",Kv="WATERFALL",zk="ITEM",wo="CONTAINER",wu="DRAW",qk="RANDOM",Su="TOP_DOWN",Zv="BOTTOM_UP",Dh="POSITION",Eh="WINNER",Ph="LOSER",gp="FIRST_MATCHUP",Pl="AD_HOC",ZRe="AD_HOC",FU="FEED_IN",TT="COMPASS",UT="OLYMPIC",XRe="SINGLE_ELIMINATION",ip="SINGLE_ELIMINATION",f1="DOUBLE_ELIMINATION",DT="FIRST_MATCH_LOSER_CONSOLATION",m1="FIRST_ROUND_LOSER_CONSOLATION",Py="LUCKY_DRAW",Wk="CURTIS_CONSOLATION",JRe="CURTIS_CONSOLATION",kH="FEED_IN_CHAMPIONSHIP_TO_SF",_P="FEED_IN_CHAMPIONSHIP_TO_SF",OH="FEED_IN_CHAMPIONSHIP_TO_QF",kP="FEED_IN_CHAMPIONSHIP_TO_QF",xH="FEED_IN_CHAMPIONSHIP_TO_R16",OP="FEED_IN_CHAMPIONSHIP_TO_R16",hae="MODIFIED_FEED_IN_CHAMPIONSHIP",xP="MODIFIED_FEED_IN_CHAMPIONSHIP",g1="FEED_IN_CHAMPIONSHIP",QRe="DOUBLE_ROUND_ROBIN",$u="ROUND_ROBIN",Ch="ROUND_ROBIN_WITH_PLAYOFF",fae="DECIDER",mae="BACKDRAW",LH={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},FH={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Xv="WIN_RATIO",zI="ROUND_OUTCOME",gae=[TT,Wk,kP,OP,_P,g1,OH,xH,kH,DT,m1,Py,xP,UT,In,Ch],e0e=[Pl,TT,Wk,f1,kP,OP,_P,g1,FU,DT,m1,Py,xP,UT,In,$u,Ch,ip],Wn={MAIN:Ut,QUALIFYING:Ht,CONSOLATION:bs,ITEM:zk,CONTAINER:wo,FIRST_MATCHUP:gp,WINNER:Eh,LOSER:Ph,AD_HOC:Pl,FEED_IN:FU,FLEX_ROUNDS:ZRe,COMPASS:TT,PLAY_OFF:In,OLYMPIC:UT,KNOCKOUT:XRe,SINGLE_ELIMINATION:ip,DOUBLE_ELIMINATION:f1,CURTIS:Wk,FICSF:kH,FICQF:OH,FICR16:xH,MFIC:hae,VOLUNTARY_CONSOLATION:La,FIRST_MATCH_LOSER_CONSOLATION:DT,FIRST_ROUND_LOSER_CONSOLATION:m1,MODIFIED_FEED_IN_CHAMPIONSHIP:xP,FEED_IN_CHAMPIONSHIP_TO_R16:OP,FEED_IN_CHAMPIONSHIP_TO_QF:kP,FEED_IN_CHAMPIONSHIP_TO_SF:_P,FEED_IN_CHAMPIONSHIP:g1,LUCKY_DRAW:Py,ROUND_ROBIN_WITH_PLAYOFF:Ch,ROUND_ROBIN:$u,DECIDER:fae,BACKDRAW:mae,COMPASS_ATTRIBUTES:LH,OLYMPIC_ATTRIBUTES:FH,DRAW:wu,RANDOM:qk,TOP_DOWN:Su,BOTTOM_UP:Zv,WATERFALL:Kv,WIN_RATIO:Xv,ROUND_OUTCOME:zI,MULTI_STRUCTURE_DRAWS:gae,generatedDrawTypes:e0e,stageOrder:aI,finishOrder:pae,AGGREGATE_EVENT_STRUCTURES:dae,FINISHING_POSITIONS:uae},t0e=Wn,xs="tournamentRecords",BH="policyDefinitions",da="tournamentRecord",$H="onlineResource",$s="drawDefinition",vae="tieFormatName",VH="matchUpFormat",Rh="participantId",yae="scheduleDates",i0e="tournamentId",r0e="scheduleDate",n0e="roundNumber",Yk="structureId",jH="participant",v1="matchUpIds",bae="entryStage",a0e="policyType",Iae="structures",GH="eventType",kp="matchUpId",Kk="tieFormat",Zk="inContext",Xk="structure",Jk="courtIds",s0e="personId",Qk="venueIds",HH="matchUps",wae="courtId",Sae="eventId",Yh="matchUp",Tae="drawId",Pu="error",mm="event",BU="param",zH="uuids",o0e="averageMatchUpMinutes",l0e="recoveryMinutes",c0e="periodLength",u0e="number",Ko="object",Cs="array",ds="_validate",Uae="_message",sc="_invalid",Fo="_ofType",qH="_anyOf",ET="_oneOf",SY={[$H]:t=>Un(Object.keys(t),[IT,wT,ST]).length===3,[vae]:t=>t&&Vf({namedFormat:t}),[zH]:t=>!t||Array.isArray(t)&&t.every(jr),[Kk]:t=>!No({tieFormat:t}).error,[GH]:t=>[mp,Fc,Qn].includes(t),[bae]:t=>Gk.includes(t)},d0e={[xs]:dn,[da]:Qe,[BH]:Pk,[$s]:Nt,[Rh]:na,[VH]:nH,[i0e]:gT,[Yk]:dc,[v1]:xI,[jH]:BI,[$H]:fm,[GH]:Th,[Iae]:eH,[kp]:Qs,[Kk]:oh,[Xk]:Dy,[wae]:LI,[HH]:hm,[Sae]:Lc,[Yh]:Mo,[Jk]:Wt,[Qk]:Wt,[Tae]:Md,[mm]:Or},p0e={[xs]:Ko,[BH]:Ko,[da]:Ko,[$s]:Ko,[$H]:Ko,[yae]:Cs,[jH]:Ko,[v1]:Cs,[Iae]:Cs,[Kk]:Ko,[Xk]:Ko,[Jk]:Cs,[Qk]:Cs,[HH]:Cs,[Yh]:Ko,[mm]:Ko,[zH]:Cs};function jt(t,e,i){if(!t&&!ji(t))return{error:be};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:be};let{paramError:r,errorParam:n}=m0e(t,e);if(!r)return{valid:!0};let a=r[ds]&&(r[Pu]||r[sc])||t?.[n]===void 0&&(r[Pu]||r[sc]||d0e[n]||be)||be,s=n??(r[ET]&&Object.keys(r[ET]).join(", "));return ce({info:{param:s,message:r[Uae]},result:{error:a},stack:i})}function Dae(t,e){let i=Object.keys(t),r=Object.keys(e);return Un(i,r)}function h0e(t,e){if(!e)return;let i=Dae(t,e);return i.length!==1?{error:be}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function f0e(t,e){if(!e)return;let i=Dae(t,e).filter(r=>t[r]);return i.length<1?{error:be}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function m0e(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&h0e(t,a);if(u?.error)return u.error;u&&Object.assign(c,u);let d=s&&f0e(t,s);if(d?.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=o&&!Po(o),g=t[f]!==void 0&&!o&&g0e(t,f,n),v=c[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!v0e(t[f],o)||SY[f]&&!SY[f](t[f]);return y&&(i=f,r=l),y});return!p.length||h}),errorParam:i,paramInfo:r}}function g0e(t,e,i){return i=i||p0e[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function v0e(t,e){return Po(e)?e(t):!0}var WH="DYNAMIC",sg="RANKING",eg="RATING",Jv="SCALE",ch="SEEDING",$U={RANKING:sg,RATING:eg,SCALE:Jv,SEEDING:ch};function VU(t){let e=jt(t,[{[jH]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(Jv)&&[sg,eg,ch].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=vi(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,c,u,d]=o.itemType.split("."),p=d?`${u}.${d}`:u,h=l===ch&&"seedings"||l===sg&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...se,...r}}function sI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return n(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},n(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var tV="voluntaryConsolation",Uf="competitiveBands",YH="roundRobinTally",Mh="positionActions",Fa="matchUpActions",pN="rankingPoints",Gf="roundNaming",jU="participant",LP="progression",xg="scheduling",FP="avoidance",y0e="participant",b0e="display",Bc="scoring",bu="seeding",PT="feedIn",I0e="audit",vA="draws",Cy={POLICY_TYPE_VOLUNTARY_CONSOLATION:tV,POLICY_TYPE_COMPETITIVE_BANDS:Uf,POLICY_TYPE_ROUND_ROBIN_TALLY:YH,POLICY_TYPE_POSITION_ACTIONS:Mh,POLICY_TYPE_MATCHUP_ACTIONS:Fa,POLICY_TYPE_RANKING_POINTS:pN,POLICY_TYPE_ROUND_NAMING:Gf,POLICY_TYPE_PARTICIPANT:jU,POLICY_TYPE_PROGRESSION:LP,POLICY_TYPE_SCHEDULING:xg,POLICY_TYPE_AVOIDANCE:FP,POLICY_TYPE_DISPLAY:b0e,POLICY_TYPE_PRIVACY:y0e,POLICY_TYPE_FEED_IN:PT,POLICY_TYPE_SCORING:Bc,POLICY_TYPE_SEEDING:bu,POLICY_TYPE_AUDIT:I0e,POLICY_TYPE_DRAWS:vA};function og({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Tt(s,!1,n);if(o){let l=e?.[jU];if(i?.withScaleValues){let{ratings:c,rankings:u}=VU({participant:o});o.rankings=u,o.ratings=c}if(l?.participant)return sI({template:l.participant,source:o})}return o}var w0e="element required",S0e="missing name";function oo(t){if(!t||typeof t!="object")return{error:Wt};if(t.element&&typeof t?.element!="object")return{error:be};if(!t?.name)return{error:Wt,info:S0e};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=oo({element:i,name:t.name});if(r.error)return ce({result:r,stack:"removeExtension"})}return{...se}}return{error:Wt,info:w0e}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...se}):{...se,info:ja}}function vp({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function ir(t){if(typeof t!="object")return{error:Wt};let e="addExtension";if(t?.element&&typeof t.element!="object")return ce({result:{error:be},stack:e});if(!vp({extension:t.extension}))return ce({result:{error:be,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=ir({extension:t.extension,element:r});if(n.error)return ce({result:n,stack:e})}return{...se}}else return ce({result:{error:Wt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...se}}function KH(t){return!t||typeof t!="object"?{error:Wt}:t.tournamentRecord?ir({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Qe}}function eO(t){return!t||typeof t!="object"?{error:Wt}:t.drawDefinition?ir({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:nc}}function Lg(t){return!t||typeof t!="object"?{error:Wt}:t.event?ir({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Lc}}function Eae(t){if(!t||typeof t!="object")return{error:Wt};if(!t.participantId)return{error:na};let e=t.tournamentRecord?.participants||[],i=og({participantId:t.participantId,tournamentParticipants:e});return i?ir({creationTime:t.creationTime,extension:t.extension,element:i}):{error:An}}function ZH(t){return!t||typeof t!="object"?{error:Wt}:t.tournamentRecord?oo({element:t.tournamentRecord,name:t.name}):{error:Qe}}function Pae(t){return!t||typeof t!="object"?{error:Wt}:t.drawDefinition?oo({element:t.drawDefinition,name:t.name}):{error:nc}}function tO(t){return!t||typeof t!="object"?{error:Wt}:t?.event?oo({element:t.event,name:t.name}):{error:Lc}}function Cae(t){if(!t||typeof t!="object")return{error:Wt};if(!t.participantId)return{error:na};let e=t.tournamentRecord?.participants||[],i=og({participantId:t.participantId,tournamentParticipants:e});return i?oo({element:i,name:t.name}):{error:An}}function y1({tournamentRecords:t}){return{tournamentIds:ji(t)?Object.keys(t):[],...se}}var T0e="extensionQueries";function Pi({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(c=>c?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:ja}}return ce({result:{error:Wt},stack:T0e})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:ja}}var U0e="activeSuspension",BP="appliedPolicies",Rae="context",iO="delegatedOutcome",vd="disabled",oI="disableAutoCalc",rO="disableLinks",yA="display",Ov="drawDeletions",D0e="drawProfile",bA="entryProfile",E0e="eventProfile",P0e="eventWithdrawalRequests",C0e="factory",Vu="flightProfile",iV="groupingAttribute",Hf="lineUps",Qv="linkedTournamentsIds",nO="matchUpHistory",XH="participantRepresentatives",GU="personRequests",iT="positionActions",R0e="rankingPoints",M0e="registration",Op="roundTarget",b1="scheduleLimits",zf="scheduleTiming",lI="schedulingProfile",N0e="statusDetail",CT="subOrder",qf="tally",BE="tieFormatModification",xv={ACTIVE_SUSPENSION:U0e,APPLIED_POLICIES:BP,CONTEXT:Rae,DELEGATED_OUTCOME:iO,DISABLED:vd,DISABLE_LINKS:rO,DISABLE_AUTO_CALC:oI,DISPLAY:yA,DRAW_DELETIONS:Ov,DRAW_PROFILE:D0e,ENTRY_PROFILE:bA,EVENT_PROFILE:E0e,EVENT_WITHDRAWAL_REQUESTS:P0e,FLIGHT_PROFILE:Vu,GROUPING_ATTRIBUTE:iV,LINEUPS:Hf,LINKED_TOURNAMENTS:Qv,MATCHUP_HISTORY:nO,PARTICIPANT_REPRESENTATIVES:XH,PERSON_REQUESTS:GU,POSITION_ACTIONS:iT,RANKING_POINTS:R0e,REGISTRATION:M0e,ROUND_TARGET:Op,SCHEDULE_LIMITS:b1,SCHEDULE_TIMING:zf,SCHEDULING_PROFILE:lI,STATUS_DETAIL:N0e,SUB_ORDER:CT,TALLY:qf,TIE_FORMAT_MODIFICATIONS:BE,FACTORY:C0e},TY=[iO,vd,oI,rO,Vu,Hf,Qv,nO,XH,GU,Op,b1,zf,lI,CT,qf,BE];function Mae({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let e=y1({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?ir({tournamentRecords:t,discover:!0,extension:{name:Qv,value:{tournamentIds:i}}}):{...se}}function Nae({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let e=oo({name:Qv,tournamentRecords:t,discover:!0});return ce({result:e,stack:"unlinkTournaments"})}function Aae({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:be};if(!e)return{error:gT};let i=y1({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:gT};let n;return r.every(a=>{let s=t[a],{extension:o}=Pi({element:s,name:Qv});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=ZH({name:Qv,tournamentRecord:s});return d.error&&(n=d.error),d.success}let c=l.filter(d=>d!==e);o.value={tournamentIds:c};let u=KH({tournamentRecord:s,extension:o});return u.error&&(n=u.error),u.success}),n?{error:n}:{...se}}var _ae={};Ai(_ae,{getLinkedTournamentIds:()=>I1,getTournamentIds:()=>y1});function I1({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:dn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=Pi({element:i,name:Qv}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var JH={};Ai(JH,{adHocPositionSwap:()=>Toe,addAdHocMatchUps:()=>kO,addDrawDefinitionTimeItem:()=>rq,addFinishingRounds:()=>O1,addGoesTo:()=>ty,addPlayoffStructures:()=>_O,addQualifyingStructure:()=>Soe,addVoluntaryConsolationStage:()=>moe,addVoluntaryConsolationStructure:()=>Hz,allPlayoffPositionsFilled:()=>eq,alternateDrawPositionAssignment:()=>roe,assignDrawPosition:()=>Koe,assignDrawPositionBye:()=>mc,attachConsolationStructures:()=>zoe,attachPlayoffStructures:()=>bq,attachQualifyingStructure:()=>iq,attachStructures:()=>AO,autoSeeding:()=>UOe,automatedPlayoffPositioning:()=>XU,automatedPositioning:()=>z1,checkValidEntries:()=>LO,deleteAdHocMatchUps:()=>Xoe,drawMatic:()=>zq,findDrawDefinition:()=>Uq,generateAdHocMatchUps:()=>FO,generateAdHocRounds:()=>Hq,generateAndPopulatePlayoffStructures:()=>vq,generateDrawDefinition:()=>cR,generateDrawMaticRound:()=>_q,generateDrawStructuresAndLinks:()=>Mq,generateDrawTypeAndModifyDrawDefinition:()=>Nq,generateQualifyingStructure:()=>cq,generateVoluntaryConsolation:()=>Sle,getAssignedParticipantIds:()=>xy,getAvailableMatchUpsCount:()=>OO,getAvailablePlayoffProfiles:()=>Y1,getDrawDefinitionTimeItem:()=>Sz,getDrawParticipantRepresentativeIds:()=>Sq,getDrawStructures:()=>ju,getDrawTypeCoercion:()=>eR,getEligibleVoluntaryConsolationParticipants:()=>wq,getMatchUpsMap:()=>is,getParticipantIdFinishingPositions:()=>Tq,getPositionAssignments:()=>YP,getPositionsPlayedOff:()=>JU,getRandomQualifierList:()=>Cq,getSeedingThresholds:()=>Yz,getSeedsCount:()=>tR,getStructureSeedAssignments:()=>$c,getTeamLineUp:()=>ey,getValidGroupSizes:()=>G1,isAdHoc:()=>Ao,isCompletedStructure:()=>_h,isValidForQualifying:()=>Rq,luckyLoserDrawPositionAssignment:()=>Xse,modifyDrawDefinition:()=>qoe,modifyDrawName:()=>Iq,modifySeedAssignment:()=>loe,mutate:()=>kae,positionActions:()=>Pq,pruneDrawDefinition:()=>Yoe,qualifierDrawPositionAssignment:()=>tq,qualifierProgression:()=>coe,query:()=>ele,removeDrawPositionAssignment:()=>zP,removeRoundMatchUps:()=>Joe,removeSeededParticipant:()=>woe,removeStructure:()=>hoe,renameStructures:()=>poe,resetDrawDefinition:()=>Woe,resetQualifyingStructure:()=>goe,resetVoluntaryConsolationStructure:()=>Wae,setDrawParticipantRepresentativeIds:()=>Oae,setPositionAssignments:()=>toe,setStructureOrder:()=>uoe,setSubOrder:()=>Qoe,shiftAdHocRounds:()=>eoe,swapAdHocRounds:()=>ioe,swapDrawPositionAssignments:()=>boe,updateTeamLineUp:()=>aw,withdrawParticipantAtDrawPosition:()=>Gse});var kae={};Ai(kae,{adHocPositionSwap:()=>Toe,addAdHocMatchUps:()=>kO,addDrawDefinitionTimeItem:()=>rq,addPlayoffStructures:()=>_O,addQualifyingStructure:()=>Soe,addVoluntaryConsolationStage:()=>moe,addVoluntaryConsolationStructure:()=>Hz,alternateDrawPositionAssignment:()=>roe,assignDrawPosition:()=>Koe,assignDrawPositionBye:()=>mc,attachConsolationStructures:()=>zoe,attachPlayoffStructures:()=>bq,attachQualifyingStructure:()=>iq,attachStructures:()=>AO,automatedPlayoffPositioning:()=>XU,automatedPositioning:()=>z1,deleteAdHocMatchUps:()=>Xoe,luckyLoserDrawPositionAssignment:()=>Xse,modifyDrawDefinition:()=>qoe,modifyDrawName:()=>Iq,modifySeedAssignment:()=>loe,pruneDrawDefinition:()=>Yoe,qualifierDrawPositionAssignment:()=>tq,qualifierProgression:()=>coe,removeDrawPositionAssignment:()=>zP,removeRoundMatchUps:()=>Joe,removeSeededParticipant:()=>woe,removeStructure:()=>hoe,renameStructures:()=>poe,resetDrawDefinition:()=>Woe,resetQualifyingStructure:()=>goe,resetVoluntaryConsolationStructure:()=>Wae,setDrawParticipantRepresentativeIds:()=>Oae,setPositionAssignments:()=>toe,setStructureOrder:()=>uoe,setSubOrder:()=>Qoe,shiftAdHocRounds:()=>eoe,swapAdHocRounds:()=>ioe,swapDrawPositionAssignments:()=>boe,updateTeamLineUp:()=>aw,withdrawParticipantAtDrawPosition:()=>Gse});var QH=t=>e=>t[e],ez=(t=[])=>t.map(Ea).filter(Boolean),rV=(t=[])=>t.map(xi).filter(Boolean),xi=(t={})=>QH(t)("participantId"),Ea=(t={})=>QH(t)("matchUpId"),$P=(t={})=>QH(t)("drawId");function Oae({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:nc};if(!Array.isArray(t))return{error:be};let i=rV(e?.entries||[]);return t.length&&Un(t,i).length<t.length?{error:be}:eO({drawDefinition:e,extension:{name:XH,value:t}})}var rl="ABANDONED",qI="AWAITING_RESULT",xp="CANCELLED",Sn="COMPLETED",HU="DEAD_RUBBER",yr="DEFAULTED",ia="DOUBLE_DEFAULT",on="DOUBLE_WALKOVER",Zu="IN_PROGRESS",Cl="INCOMPLETE",tz="NOT_PLAYED",Ia="RETIRED",Fg="SUSPENDED",Dn="TO_BE_PLAYED",xr="WALKOVER",xae=[qI,Sn,yr,Zu,Cl,Ia,Fg],iz=[qI,Sn,yr,on,ia,Zu,Cl,Ia,Fg,xr],rz=[rl,qI,"BYE",xp,Sn,HU,yr,on,ia,Zu,Cl,tz,Ia,Fg,Dn,xr],nz=["BYE",on,ia,Sn,yr,Ia,xr],az=[rl,qI,xp,HU,Zu,Cl,tz,Fg,Dn,void 0],Hn=[xp,rl,Sn,HU,yr,on,ia,Ia,xr],aO=[rl,Sn,yr,on,ia,Zu,Ia,xr],sz=[Zu,Cl,Fg,Dn],Kh={ABANDONED:rl,AWAITING_RESULT:qI,BYE:"BYE",CANCELLED:xp,COMPLETED:Sn,DEAD_RUBBER:HU,DEFAULTED:yr,DOUBLE_WALKOVER:on,DOUBLE_DEFAULT:ia,IN_PROGRESS:Zu,INCOMPLETE:Cl,NOT_PLAYED:tz,RETIRED:Ia,SUSPENDED:Fg,TO_BE_PLAYED:Dn,WALKOVER:xr};function WI(t,e,i){let r=d=>Pi({element:d,name:Op})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===dae&&YRe,s=i?.mode===uae&&pae,o=s||a||aI,l=d=>d?.stage===Ut&&d?.stageSequence===1,c=d=>l(d)?-1:o[d?.stage],u=d=>d?.matchUps.every(({matchUpStatus:p})=>Hn.includes(p)?1:-1);return n&&u(t)-u(e)||a&&c(t)-c(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(IA(t)||0)-(IA(e)||0)}function IA(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function si(t){let e=jt(t,[{[$s]:!0,[Yk]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=ju({drawDefinition:i}),a=n?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===r);if(!s)return{error:Qr};let o=s.structureType===zk?a?.find(l=>l.structures?.some(c=>c.structureId===r)):void 0;return{structure:s,containingStructure:o}}function ju({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&Nt||!e?.structures&&eH||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=f=>{let m=Pi({element:f,name:Op})?.extension?.value;return!n||n===m},u=e?.structures?.filter(p).filter(h).filter(c).sort((f,m)=>WI(f,m,a))??[],d=t?Object.assign({},...Gk.map(f=>{let m=u?.filter(g=>g.stage===f);return m?.length&&{[f]:m}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(f){return!o&&!Array.isArray(s)||o&&f.stage===o||Array.isArray(s)&&s.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function Lae({drawDefinition:t}){if(!t)return{error:Nt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Sr({structure:i}),a=n?.map(xi).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Sr({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:Nt};if({structure:i,error:r}=si({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Sr({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=yre,{positionAssignments:n,error:r}}function aa({drawDefinition:t,structureId:e,structure:i}){let r=Sr({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&r?.length===n?.length,s=r?.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),o=r?.filter(c=>!c.participantId&&c.bye),l=r?.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var oz="addDrawDefinition",sO="addMatchUps",lg="addParticipants",lz="addScaleItems",Fae="addEvent",Bae="addVenue",_f="audit",cz="dataIssue",uz="deleteParticipants",dz="deleteVenue",pz="deletedDrawIds",hz="deletedMatchUpIds",fz="modifyDrawDefinition",$ae="modifyDrawEntries",Vae="modifyEventEntries",mz="modifyMatchUp",Is="modifyParticipants",gz="modifyPositionAssignments",vz="modifySeedAssignments",Ry="modifyTournamentDetail",My="modifyVenue",VP="mutations",nV="publishEvent",jae="publishEventSeeding",Gae="publishOrderOfPlay",Hae="publishParticipants",yz="unPublishEvent",bz="unPublishEventSeeding",Iz="unPublishOrderOfPlay",A0e="unPublishParticipants",oO="updateInContextMatchUp",zae={ADD_DRAW_DEFINITION:oz,ADD_MATCHUPS:sO,ADD_PARTICIPANTS:lg,ADD_SCALE_ITEMS:lz,ADD_EVENT:Fae,ADD_VENUE:Bae,AUDIT:_f,DATA_ISSUE:cz,DELETE_PARTICIPANTS:uz,DELETE_VENUE:dz,DELETED_DRAW_IDS:pz,DELETED_MATCHUP_IDS:hz,MODIFY_DRAW_DEFINITION:fz,MODIFY_DRAW_ENTRIES:$ae,MODIFY_EVENT_ENTRIES:Vae,MODIFY_MATCHUP:mz,MODIFY_PARTICIPANTS:Is,MODIFY_POSITION_ASSIGNMENTS:gz,MODIFY_SEED_ASSIGNMENTS:vz,MODIFY_TOURNAMENT_DETAIL:Ry,MODIFY_VENUE:My,MUTATIONS:VP,PUBLISH_EVENT_SEEDING:jae,PUBLISH_EVENT:nV,PUBLISH_ORDER_OF_PLAY:Gae,PUBLISH_PARTICIPANTS:Hae,UNPUBLISH_EVENT_SEEDING:bz,UNPUBLISH_EVENT:yz,UNPUBLISH_ORDER_OF_PLAY:Iz,UPDATE_INCONTEXT_MATCHUP:oO};function lO(t,e){if(!t)return{error:Nt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...se}}function cg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&lO(t),bi({payload:{matchUps:i,tournamentId:e,eventId:r},topic:sO}),{...se}}function Zh({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&lO(t),bi({topic:hz,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)EH({key:a});return{...se}}function Gi({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&Pr({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),bi({topic:mz,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...se}):(console.log(Mo),{error:Mo})}function _0e({tournamentId:t,inContextMatchUp:e}){return e?(bi({payload:{inContextMatchUp:e,tournamentId:t},topic:oO,key:e.matchUpId}),{...se}):{error:Mo}}function w1({tournamentId:t,eventId:e,drawDefinition:i}){return i?(lO(i),bi({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:oz,key:i.drawId}),{...se}):(console.log(Nt),{error:Nt})}function k0e({tournamentId:t,eventId:e,drawId:i}){return bi({payload:{drawId:i,tournamentId:t,eventId:e},topic:pz,key:i}),EH({key:i}),{...se}}function Pr({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(lO(t,i),bi({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:fz,key:t.drawId}),{...se}):{error:Nt}}function qae({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:Nt};if(!i)return{error:Dy};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return bi({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:vz,key:t.drawId}),Pr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...se}}function ug({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:Nt};if(!i)return{error:Dy};let n=Sr({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return bi({topic:gz,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Pr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...se}}function Wae({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:Nt};let n=e.structures?.find(s=>s.stage===La);if(!n)return{error:Qr};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Zh({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==La)),Pr({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...se}}function wz({drawPositions:t,structure:e}){if([Ht,Ut].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Sr({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{ir({element:r,extension:{name:rO,value:!0}})})}function cO(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[iT]===!1)return;let{extension:n}=Pi({name:iT,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Ut);if(o){let l=Sr({structure:o}).positionAssignments?.map(({drawPosition:c,participantId:u,bye:d,qualifier:p})=>({drawPosition:c,participantId:u,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:iT};ir({element:r,extension:s})}function zU({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:c}=o??{};l&&c&&(n[c]=l?.map(u=>u.structureId))&&l.forEach(u=>a[u.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function uO(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===fr?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===fr&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function qc(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var S1="SIGN_IN_STATUS",Yae="SIGNED_OUT",jP="SIGNED_IN",Co="TEAM",Li="INDIVIDUAL",hc="GROUP",Di="PAIR",pr="TEAM",rT={TEAM_PARTICIPANT:Co,INDIVIDUAL:Li,GROUP:hc,TEAM:pr,PAIR:Di},Vs={INDIVIDUAL:Li,GROUP:hc,PAIR:Di,TEAM:pr,SIGN_IN_STATUS:S1,SIGNED_OUT:Yae,SIGNED_IN:jP};function dO({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Tt(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===pr),s=n.filter(l=>l.participantType===hc),o=n.filter(l=>l.participantType===Di);return n.forEach(l=>{if(l.participantType===Li){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.teamParticipantIds?.includes(u.participantId)&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function Kae(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function O0e(t){let e=Object.assign({},...tg.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Kae(e[t])}var tg=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Zae({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=tg.find(({iso:u})=>u===l);i&&c?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&c?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c?.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function x0e({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?sI({template:e,source:s}):s)}}}}function Bg(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:An}}function Xae(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=Bg({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Wt}}function Wc(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=Xae(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:be,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:vH};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=Tt(a.pop(),!1,!0);if(s){let o={timeItem:s,...se};return e&&Object.assign(o,{previousItems:a}),o}else return{info:ja}}function Sz({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Md};if(!e.timeItems)return{info:ja};let{timeItem:n,previousItems:a,info:s}=Wc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function T1({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Or};if(!r.timeItems)return{info:ja};let{timeItem:n,previousItems:a,info:s}=Wc({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function pO({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Qe};if(!e.timeItems)return{info:ja};let{timeItem:n,previousItems:a,info:s}=Wc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function Tz({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:Qe};if(!i)return{error:na};let a=Bg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:ja};let{timeItem:o,previousItems:l,info:c}=Wc({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:c}}var L0e={[hc]:"groupParticipantIds",[Di]:"pairParticipantIds",[pr]:"teamParticipantIds"},F0e={[hc]:"groups",[pr]:"teams"};function Jae({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let h=p?.participantId;h&&V0e({participantMap:u,participantId:h})}for(let p of i.participants??[]){let h=Tt(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!u[f]){c.push(f);continue}if(Object.assign(u[f].participant,h),m){let v=$0e({individualParticipantIds:m,participantCopy:h,participantMap:u,participantType:g,participantId:f});v.missingParticipantIds.length&&c.push(...v.missingParticipantIds)}if(r&&(u[f].participant.signedIn=B0e(h)),n){let{ratings:v,rankings:y,seedings:b}=VU({participant:h});u[f].participant.seedings=b,u[f].participant.rankings=y,u[f].participant.ratings=v}(l||o)&&Zae({participant:u[f].participant,withISO2:o,withIOC:l})}if(t){let p=ji(t)?t:void 0;x0e({participantMap:u,template:p})}let d;return a&&(d=dO({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function B0e(t){let{timeItem:e}=Wc({itemType:S1,element:t});return e?.itemValue===jP}function $0e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[L0e[r]].push(n),[pr,hc].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p}=e,h=F0e[r];o[h].push({participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p})}if(r===Di){let l=t.find(c=>c!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function V0e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Ir]:{...i},[fr]:{...i},[pr]:{...i},...i}}}function Ny({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return Jae({...t,...r,tournamentRecord:i});let a=Tt(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>Zae({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=dO({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:c}=VU({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function Qi({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:aH};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...se};function o(l){let c=l?.extensions?.find(u=>u.name===BP)?.value;if(c)for(let u of Object.keys(c))(t?e.includes(u):!e.length||e.includes(u))&&(s[u]=Tt(c[u],!1,!0))}}function gm({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:aH};let{appliedPolicies:a}=Qi({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:s1.message}}var Qae="WALKOVER",UY="RETIRED",Uz="COMPETITIVE",GP="ROUTINE",HP="DECISIVE",hN="winRatio",j0e={[Uf]:{policyName:"Competitive Bands Default",profileBands:{[HP]:20,[GP]:50}}},Dz=j0e;function vm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=gm({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[Uf]??s?.[Uf]??Dz[Uf];a.policies[Uf]=o}return a}function Ay({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:Qe};let{appliedPolicies:a}=Qi({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:s1?.message}}function U1({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=Ay({policyType:xg,tournamentRecord:t,event:r}),a=(t?Pi({element:t,name:zf}).extension:void 0)?.value,s=(r&&Pi({name:zf,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function Ez({drawDefinition:t,attributes:e}){let{extension:i}=Pi({element:t,name:bA}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:bA,value:r},eO({drawDefinition:t,extension:i}),{entryProfile:r}}function D1({drawDefinition:t}){let{extension:e}=Pi({element:t,name:bA});return{entryProfile:e?.value||{}}}var Cu="ALTERNATE",E1="CONFIRMED",nl="DIRECT_ACCEPTANCE",P1="FEED_IN",C1="JUNIOR_EXEMPT",Wf="LUCKY_LOSER",R1="ORGANISER_ACCEPTANCE",M1="QUALIFIER",G0e="REGISTERED",N1="SPECIAL_EXEMPT",Yc="UNGROUPED",_y="UNPAIRED",RT="WILDCARD",Nh="WITHDRAWN",fN=[E1,nl,C1,R1,N1],ese=[P1,Wf,M1],ky=[E1,nl,P1,C1,R1,N1,RT],Xu=[E1,nl,C1,Wf,M1,R1,N1,RT],tse=[Cu,E1,nl,P1,C1,Wf,R1,M1,G0e,N1,Yc,_y,RT,Nh],Ju={ALTERNATE:Cu,CONFIRMED:E1,DIRECT_ACCEPTANCE:nl,DIRECT_ENTRY_STATUSES:ky,DRAW_SPECIFIC_STATUSES:ese,EQUIVALENT_ACCEPTANCE_STATUSES:fN,FEED_IN:P1,JUNIOR_EXEMPT:C1,LUCKY_LOSER:Wf,ORGANISER_ACCEPTANCE:R1,QUALIFIER:M1,SPECIAL_EXEMPT:N1,STRUCTURE_SELECTED_STATUSES:Xu,UNGROUPED:Yc,UNPAIRED:_y,VALID_ENTRY_STATUSES:tse,WILDCARD:RT,WITHDRAWN:Nh};function Pz({stage:t,drawDefinition:e}){let{entryProfile:i}=D1({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&Gk.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return Ez({drawDefinition:e,attributes:n}),!0}return r}function H0e({stage:t,drawDefinition:e}){let{entryProfile:i}=D1({drawDefinition:e});return i[t]?.alternates||0}function z0e({stage:t,drawDefinition:e}){let{entryProfile:i}=D1({drawDefinition:e});return i[t]?.wildcardsCount||0}function aV({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function YI({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let c=i.entries?.reduce((u,d)=>{let p=Pi({name:Op,element:d})?.extension?.value,h=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),f=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return h&&(!r||m===r)&&f&&(!s||!p||s===p)?u.concat(d):u},[])??[];if(a&&l===In){let{playoffEntries:u,error:d}=q0e({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(u?.length?u:c).filter(p=>!e||p.placementGroup===e)}return c}function q0e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Dh&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=si({drawDefinition:e,structureId:s});o?.structureType===wo&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{let{participantId:g}=m,v=Pi({element:m,name:qf}).extension?.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a?.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,w=[...a??[]].sort(Jn).indexOf(I)+1;r.push({entryStage:In,entryStatus:P1,placementGroup:w,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:r}}function W0e({stage:t,drawDefinition:e}){return ky.reduce((i,r)=>(aV({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function $c({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=si({drawDefinition:i,structureId:r}));let o=Sr({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Qr};r||(r=n.structureId);let{stage:l,stageSequence:c}=n,u=l===In&&i&&YI({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:l}),d=u?u.filter(f=>f.placementGroup===1).sort((f,m)=>f.GEMscore<m.GEMscore&&1||f.GEMscore>m.GEMscore&&-1||0).map((f,m)=>{let g=m+1;return{participantId:f.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=lre;let h=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:l,error:a}}function Hd(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function $E({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(a=>t.tieFormatId===a.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function Ks({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:$E({item:i,drawDefinition:t,structure:e,event:r})||$E({item:e,drawDefinition:t,structure:e,event:r})||Hd(t)||Hd(r)}}function Y0e({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function is({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c?.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function dg({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(c=>Object.assign(Tt(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function ise({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=Ca(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(Jn);return i.map(n=>r.indexOf(n)+1)}function hO(t){if(!ji(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>fi(a)||a===void 0||a===null);return r&&n}function Kc(t){return Array.isArray(t)?t.every(hO):!1}function fo({matchUps:t=[],interpolate:e}){if(!Kc(t))return{roundMatchUps:[],error:be};let i=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ii(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(h)?d:d.concat(h)},[]).sort(Jn).map(d=>{let p=t.filter(m=>m.roundNumber===d),h=p.find(({matchUpType:m})=>m===_r)?p.filter(({matchUpType:m})=>m===_r):p,f=m=>m.sort((g,v)=>Jn(g.roundPosition,v.roundPosition));return{[d]:f(h)}}),r=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ii(p.roundNumber):p.roundNumber;return d[h]||(d[h]=Lt({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(h=>ii(h)).filter(h=>!isNaN(h))),p=n[d]?.length;if(p>1&&wd(p)){let h=d+1,f=h+p/2;vt(h,f).forEach((m,g)=>{n[m]=vt(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,h=n[d]?.filter(m=>!Hn.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,f=p&&p===h;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:h,inactiveRound:f}}})),o=0,l=0,c=Object.keys(n).map(d=>ii(d)).filter(d=>!isNaN(d));c.forEach(d=>{let p=n[d].sort((f,m)=>f.roundPosition-m.roundPosition),h=p.map(f=>f?.drawPositions||[]).flat();if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let f=h.sort(Jn),m=Ca(f,2);s[d].drawPositions=f,s[d].pairedDrawPositions=m}else{let f=s[d-1],m=f.drawPositions,g=f.matchUpsCount/s[d].matchUpsCount,v=Ca(m,g),y=p.map(b=>{let{roundPosition:I}=b,w=[...b.drawPositions||[],void 0,void 0].slice(0,2);if(!I)return w;let T=w?.filter(Boolean)||[];if(!T?.length)return[void 0,void 0];if(d<3&&T?.length===2)return w?.slice().sort(Jn);let S=Un(m,T).length!==T?.length;if(T?.length&&S)return T?.length===1?[T[0],void 0]:w?.slice().sort(Jn);let D=(I-1)*2;return v.slice(D,D+2).map(C=>T?.find(E=>C.includes(E)))});s[d].drawPositions=y?.flat(),s[d].pairedDrawPositions=y}s[d+1]&&s[d+1].matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let u=!!Object.values(s).find(({matchUpsCount:d})=>!wd(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:c,roundProfile:s,...se}}function mN(t){if(!Array.isArray(t))return"";let e=t.filter(gn);return e.length?vi([Math.min(...e),Math.max(...e)]).join("-"):""}function K0e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Nt};if(!e)return{error:dc};let{structure:r}=si({drawDefinition:t,structureId:e});if(r?.stage!==bs)return{error:Ey,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[])||[],o=Object.assign({},...s.map(d=>{let p=dg({structureId:d,matchUpsMap:i}),h=fo({matchUps:p}).roundProfile;return{[d]:h}})),l=dg({matchUpsMap:i,structureId:e}),{roundProfile:c}=fo({matchUps:l}),u={};return a?.forEach(d=>{let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=o[p],b=y[1]?.drawPositions,I=y[h]?.matchUpsCount;if(!I)return;let w=I?b.length/I:0,T=b.length/w,S=b.slice(),D=ise({roundPositionsCount:T,groupedOrder:m}),C=D?.length||1;if(C<=T){let R=b.length/C,M=Ca(S,R);f===Zv&&M.forEach(A=>A.reverse()),S=D?.length&&D?.map(A=>M[A-1]).flat()||M.flat()}let E=Ca(S,w);if(g){let R=vt(0,g.interleave).map(()=>{}),M=vt(0,g.offset).map(()=>{});E=E.map(N=>[N,...R]),E.unshift(M),E=E.flat(1);let A=E.length-g.offset;E=E.slice(0,A)}u[v]||(u[v]={});let P=c?.[v]?.feedRound?2:1;E.forEach((R,M)=>{let A=1+M*P;u[v][A]||(u[v][A]=mN(R))})}),{sourceDrawPositionRanges:u}}function rse({drawDefinition:t}){if(typeof t!="object")return{error:Ab};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[bs,In].includes(d)||s[l].push(o);let p=r.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:u,stage:v})}}}function Z0e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:Nt};if(!i)return{error:dc};if(!e){let s=dg({matchUpsMap:r,structureId:i});if({roundProfile:e}=fo({matchUps:s}),!e)return{error:Wt}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],c=Ca(l,l.length/o),u=c.map(mN),d=c.map(g=>g.map(v=>v-n)).map(mN),p=a.map(g=>{if(g>s)return;let v=e?.[g]?.drawPositions??[];return Ca(v,v.length/o)}).filter(Boolean),h=vt(0,o).map(g=>p.map(v=>v[g]).flat().filter(Boolean).sort(Jn)).map(g=>vi(g)),f=h.map(g=>P1e(g).map(mN).join(", ")),m=Object.assign({},...vt(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:u[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:h[g],drawPositionsRange:f[g]}})));return{[s]:m}}))}}function Cz({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??fo({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==Py)&&!i?.structures&&t&&n}function Ao({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==La&&(!e.length||!i&&!r)}var Rz={[Gf]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ut]:"",[In]:"P",[Ht]:"Q",[bs]:"C"}}},X0e=Rz;function nse({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=fo({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=Ao({structure:i}),c=Cz({structure:i}),u=i.structures,d={},p=Rz[Gf],h=i.stage===Ht,f=h?Math.max(...(e?.structures??[]).filter(R=>R.stage===Ht).map(({stageSequence:R})=>R??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",v=t?.roundNamingMap||p.roundNamingMap||{},y=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},b=t?.affixes?.preFeedRound||p.affixes.preFeedRound,I=t?.affixes?.roundNumber||p.affixes.roundNumber,w=(t?.namingConventions||p.namingConventions).round,T=o&&o!==Ut?o[0]:"",S=t?.stageConstants||p.stageConstants,D=o&&S?.[o]||T,C=`${g}${D}${m}`,E=n?Object.keys(n):[],P=h&&S?.[Ht]?`${S?.[Ht]}-`:"";if(u||l||c)Object.assign(d,...E.map(R=>{let M=`${P}${w} ${R}`,A=`${I}${R}`;return{[R]:{roundName:M,abbreviatedRoundName:A}}}));else{let R=h&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...E.map(M=>{if(!n?.[M])return;let{matchUpsCount:A,preFeedRound:N}=n[M],k=A*2,x=R?.[n?.[M].finishingRound]||R&&`${I}${k}`||v[A]||`${I}${k}`,O=N?`-${b}`:"",V=`${x}${O}`,F=[C,s,V].filter(Boolean).join("-"),j=`${y[A]||`${I}${k}`}${O}`,q=[C,s,j].filter(Boolean).join("-");return{[M]:{abbreviatedRoundName:q,roundName:F}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var J0e=(t,e)=>(t||0)+(e||0);function ase(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Qae||i<=e[HP]&&HP||i<=e[GP]&&GP||Uz}function sse({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(J0e)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Q0e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function ose(t){return t.map(Q0e).sort().map(e=>parseFloat(e.toFixed(2)))}function A1({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Mo};let{score:r,winningSide:n}=i;if(!n)return{error:be};let a=!e&&t&&Ay({policyType:Uf,tournamentRecord:t}).policy,s=e||a?.profileBands||Dz[Uf].profileBands,o=sse({score:r}),l=ose([o]),c=ase(l,s),u=Array.isArray(l)?l[0]:l;return{...se,competitiveness:c,pctSpread:u}}function lse({matchUp:t}){if(!t)return{error:Mo};if(t&&!t.sides)return{error:il};if(t&&!t.hasContext)return{error:_k};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===Li).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=vi(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...se}}var wA="CHECK_IN",SA="CHECK_OUT",eMe="SCHEDULE",KI="SCHEDULE.ASSIGNMENT.VENUE",Ah="SCHEDULE.ALLOCATION.COURTS",pg="SCHEDULE.ASSIGNMENT.COURT",fO="SCHEDULE.COURT.ORDER",ZI="SCHEDULE.DATE",tMe="COMPLETED.DATE",Mz="HOME_PARTICIPANT_ID",Nz="SCHEDULE.ASSIGN.OFFICIAL",XI="SCHEDULE.TIME.SCHEDULED",ud="SCHEDULE.TIME.START",kf="SCHEDULE.TIME.STOP",uh="SCHEDULE.TIME.RESUME",Yf="SCHEDULE.TIME.END",mO="SCHEDULE.TIME.MODIFIERS",cse="TO_BE_ANNOUNCED",use="NEXT_AVAILABLE",dse="FOLLOWED_BY",pse="AFTER_REST",hse="RAIN_DELAY",iMe="NOT_BEFORE",sV=[cse,use,dse,pse,hse],rMe="ELIGIBILITY",nMe="REGISTRATION",aMe="SUSPENSION",sMe="MEDICAL",oMe="PENALTY",fse="SCALE",mse="RATING",gse="RANKING",Az="SEEDING",$g="PUBLISH",fc="PUBLIC",Vg="STATUS",lMe="MODIFICATION",cMe="RETRIEVAL",uMe="other",gO={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:sV,AFTER_REST:pse,ALLOCATE_COURTS:Ah,ASSIGN_COURT:pg,ASSIGN_OFFICIAL:Nz,ASSIGN_VENUE:KI,CHECK_IN:wA,CHECK_OUT:SA,COMPLETED_DATE:tMe,COURT_ORDER:fO,ELIGIBILITY:rMe,END_TIME:Yf,FOLLOWED_BY:dse,MEDICAL:sMe,MODIFICATION:lMe,NEXT_AVAILABLE:use,NOT_BEFORE:iMe,OTHER:uMe,PENALTY:oMe,PUBLIC:fc,PUBLISH:$g,RANKING:gse,RATING:mse,RAIN_DELAY:hse,REGISTRATION:nMe,RESUME_TIME:uh,RETRIEVAL:cMe,SCALE:fse,SCHEDULE:eMe,SCHEDULED_DATE:ZI,SCHEDULED_TIME:XI,SEEDING:Az,START_TIME:ud,STATUS:Vg,STOP_TIME:kf,SUSPENSION:aMe,TIME_MODIFIERS:mO,TO_BE_ANNOUNCED:cse};function JI({matchUp:t}){if(!t)return{error:Mo};if(!t.hasContext)return{error:_k};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:il};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=lse({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[wA,SA].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===wA);e?.forEach((o,l)=>{let c=r?.[l],u=o?.length&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...se}}var kn=t=>e=>{let i=ji(e)&&e?.matchUpType||jr(e)&&e;return i&&$ie[t].includes(i)};function VE(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function jE(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function vse({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function dMe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&jE({...e,averageMinutes:i,matchUpFormat:n}),c=t?.matchUpRecoveryTimes&&jE({...t,averageMinutes:i,matchUpFormat:n}),u=o?.matchUpRecoveryTimes&&jE({...o,averageMinutes:i,matchUpFormat:n}),d=[l,c,u,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return vse({categoryName:a,categoryType:s,timesBlockArray:d})}function pMe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&VE({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&VE({...n,matchUpFormat:t}),c=s?.matchUpAverageTimes&&VE({...s,matchUpFormat:t}),u=[o,l,c,s?.defaultTimes?.averageTimes,r?.averageTimes];return vse({categoryName:e,categoryType:i,timesBlockArray:u})}var yse="DOUBLES_SINGLES",bse="SINGLES_DOUBLES",Ru="total",oV="participantConflict",zm="matchUpConflict",Ise="ISSUE_IDS",mv="CONFLICT",gv="WARNING",lV="ERROR",cV="ISSUE",gN="STATE",wse={SINGLES_DOUBLES:bse,DOUBLES_SINGLES:yse,TOTAL:Ru,CONFLICT_MATCHUP_ORDER:zm,CONFLICT_PARTICIPANTS:oV,SCHEDULE_ISSUE_IDS:Ise,SCHEDULE_CONFLICT:mv,SCHEDULE_WARNING:gv,SCHEDULE_ERROR:lV,SCHEDULE_ISSUE:cV,SCHEDULE_STATE:gN};function _1({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:Qe};s=s??o?.eventType??nI;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=U1({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return vO({eventType:s,timingDetails:u})}function vO({timingDetails:t,eventType:e}){let i=pMe(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=dMe({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=kn(nI)(e)?bse:yse,c=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function M2(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Oy({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>M2(n)-M2(a)).pop(),r=i&&M2(i);return{itemValue:i?.itemValue,timeStamp:r}}function Sse({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:XI});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function QI({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:ZI});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function hb(t){if(Sne.test(t)){let e=RH();return new Date(`${e}T${t}`)}else return new Date(t)}function hMe({matchUp:t}){if(!t)return{error:Mo};if(!t.timeItems)return{error:vH};let e=t.timeItems.filter(r=>[ud,kf,uh,Yf].includes(r?.itemType)).sort((r,n)=>hb(r.itemValue).getTime()-hb(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case ud:a=0;break;case Yf:if(r.lastValue&&[ud,uh].includes(r.lastType)){let l=hb(n.itemValue).getTime()-hb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case kf:if([ud,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=hb(n.itemValue).getTime()-hb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([ud,uh].includes(i.lastType)){let r=new Date().getTime()-hb(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:fMe(i.milliseconds),relevantTimeItems:e}}function fMe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function mMe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===ud&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function k1(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:be};let n=qc(t);i.venueId||(i.venueId=or());let a;for(let s of Object.values(n)){let o=gMe({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||bi({topic:Bae,payload:{venue:i}}),Lt({...se,venue:a})}function gMe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=or()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:Hre}:(i&&ir({element:r,extension:{value:i,name:Rae}}),t.venues.push(r),{...se,venue:Tt(r)})):{error:Wt,info:"missing venue"}:{error:Qe}}function Xh({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Qe};if(!i)return{error:kg};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(I1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=Xh({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return k1({tournamentRecord:e,venue:o.venue}),{...se,venue:r}}}return r?{...se,venue:r}:{error:$I}}function _z({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Xh({tournamentRecords:i,tournamentRecord:r,venueId:n});return Tt(a,t,!0)}function ew({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Qe};if(!i)return{error:LI};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...se,court:n,venue:a};if(t){let s=(I1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=ew({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&k1({tournamentRecord:e,venue:c.venue}),{...se,court:n,venue:a}}}return ce({result:{error:OU},stack:r})}function kz(t){return Tt(ew(t),!1,!0)}function yO({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Qe};if(!i)return{error:LI};let r=ew({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(r.court);return{...se,courtInfo:Tt(n,!1,e)}}function MT(t){let e=jt(t,[{[da]:!0},{venueId:!0,[Pu]:kg}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=Xh({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:c})=>({...c}))(yO({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:c,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:c,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...se,venueData:Tt(o,!1,!0)}}function vMe({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===Yf&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Cn({event:t,eventId:e}){if(!t)return{error:Or};let i=Pi({name:Vu,element:t})?.extension,r=e?Tt(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function _o(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=o.find(d=>{let p=(d?.drawDefinitions??[]).find(h=>h.drawId===r);if(p)c=p,l=a[d.eventId].tournamentId;else{let h=(d&&Cn({event:d})?.flightProfile)?.flights?.find(f=>f.drawId===r);if(h)return l=a[d.eventId].tournamentId,{entries:h.drawEntries,drawName:h.drawName,tournamentId:l,drawId:r}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>u?.eventId===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ce({result:{error:Lc},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ce({result:{error:nc},context:{drawId:r,eventId:i},stack:n})}}function bO(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:Mo};if(n&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let w=t.drawDefinition||e?.drawDefinitions?.find(S=>S.drawId===u.drawId);!w&&a&&({drawDefinition:w,event:e}=_o({drawId:u.drawId,tournamentRecord:a}));let T=u.structureId&&w?.structures?.find(({structureId:S})=>S===u.structureId);i=t.matchUpType||T?.matchUpType||w?.matchUpType||e?.eventType!==Qn&&e?.eventType}let{milliseconds:d,time:p}=hMe({matchUp:u}),{startTime:h}=mMe({matchUp:u}),{endTime:f}=vMe({matchUp:u}),m,{eventIds:g,drawIds:v}=r??{};if((!g||g.includes(u.eventId))&&(!v||v.includes(u.drawId))){let w=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,T=new Map,S=u.timeItems?.toSorted((ne,le)=>w(ne)-w(le))??[];for(let ne of S)T.set(ne.itemType,ne.itemValue);let D=T.get(Mz),C=T.get(Ah),E=T.get(XI),P=T.get(mO),R=T.get(ZI),M=T.get(Nz),A=T.get(fO),N=T.get(KI),k=T.get(pg),x,O,V,F,j,q=u.matchUpType??i;if(o&&E&&n&&q){let ne={matchUpFormat:u.matchUpFormat??l,...o};({averageMinutes:O=0,recoveryMinutes:V=0,typeChangeRecoveryMinutes:F=0}=vO({timingDetails:ne,eventType:q})),(O||V)&&(x=f?Jo(Gr(f),V):Jo(E,O+V)),F&&(j=f?Jo(Gr(f),F):Jo(E,O+F))}!R&&E&&(R=Ti(E));let W=pA({scheduledDate:R,scheduledTime:E}),z={},H=(a&&N&&MT({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(z[N]=H);let{venueName:Z,venueAbbreviation:J,courtsInfo:ie}=H,K=(k&&ie?.find(ne=>ne.courtId===k))?.courtName;for(let ne of C||[]){if(!a)break;ne.venueId&&!z[ne.venueid]&&(z[ne.venueId]=MT({venueId:ne.venueId,tournamentRecord:a})?.venueData);let le=z[ne.venueId];ne.venueName=le?.venueName;let re=le?.courtsInfo?.find(me=>me.courtId===ne.courtId);ne.courtName=re?.courtName}m=Lt({typeChangeTimeAfterRecovery:j,timeAfterRecovery:x,scheduledDate:R,scheduledTime:E,isoDateString:W,homeParticipantId:D,venueAbbreviation:J,allocatedCourts:C,timeModifiers:P,venueName:Z,venueId:N,courtOrder:A,courtName:K,courtId:k,official:M,typeChangeRecoveryMinutes:F,recoveryMinutes:V,averageMinutes:O,milliseconds:d,startTime:h,endTime:f,time:p})}else m=Lt({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:y}=QI({matchUp:u}),{scheduledTime:b}=Sse({matchUp:u});if(s&&c?.displaySettings?.draws){let w=c.displaySettings.draws,T=(w?.[u.drawId]??w?.default)?.scheduleDetails;if(T){let S=(T.find(D=>y&&D.dates?.includes(y))??T.find(D=>!D.dates?.length))?.attributes;if(S){let D=Object.assign({},...Object.keys(m).map(C=>({[C]:!0})),S);m=sI({source:m,template:D})}}}let I=u.matchUpStatus&&Hn.includes(u.matchUpStatus)&&(Ti(f)||Ti(y)||Ti(b))||void 0;return{schedule:m,endDate:I}}function yMe({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(Wie(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>ho(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(qie(t)){let o=[...t].sort(Jn);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(ii(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function TA({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Gu({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:Qe};if(!Array.isArray(i)||i.length>2)return{error:bl};if(!i.length)return ce({result:{error:_g},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===Di&&Un(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return ce({result:{error:An},stack:r});let s=Tt(n.slice(1),!1,!0);return{participant:Tt(a),duplicatedPairParticipants:s,...se}}function ey({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Nt};if(typeof e!="string")return{error:na};let{extension:i}=Pi({element:t,name:Hf});return{lineUp:(i?.value||{})[e]}}function bMe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{let{assignedParticipantIds:f,substitutions:m}=TA({collectionPosition:i,collectionId:s,lineUp:p});if(l===fr){if(f?.length<=2){let g=n?.[f[0]]?.pairIdMap?.[f[1]],v=(g&&n[g]?.participant||Gu({participantIds:f,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:v,teamParticipant:h,substitutions:m}}}else if(f?.length>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let g=f?.[0];return g&&{[d]:{participantId:g,teamParticipant:h,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||ey({participantId:h.teamParticipantId,drawDefinition:a})?.lineUp;return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,h=o?.find(g=>g?.drawPosition===d),f=h?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),m=h?.lineUp||ey({participantId:p,drawDefinition:a})?.lineUp;return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function IO(t){let e=jt(t,[{[Yh]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===Li&&Ir||n===Di&&fr||n===pr&&pr||void 0}return{matchUpType:r}}function IMe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(h=>h.drawPosition&&h.drawPosition===a),c=a&&t,u=o&&e,d=c?c[a]?.participantId:l?.participantId,p=l?wMe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...u?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let h=c[a]?.teamParticipant,f=c[a]?.participant,m=c[a]?.substitutions;f&&(p.participant=f),m&&(p.substitutions=m),h&&(p.teamParticipant=h)}return p}function wMe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=SMe({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function SMe({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function Tse({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:w,scoringActive:T,matchUpTieId:S,isRoundRobin:D,roundProfile:C,sideLineUps:E,structure:P,context:R,matchUp:M,event:A}){l=l??{};let N=Ks({drawDefinition:I,structure:P,matchUp:M,event:A})?.tieFormat,{roundOffset:k,structureId:x,structureName:O,stage:V,stageSequence:F}=P,{drawId:j,drawName:q,drawType:W}=I??{},z=N?.collectionDefinitions,H=M.collectionId&&z?.find(ve=>ve.collectionId===M.collectionId),Z=M.collectionId?H?.matchUpFormat:M.matchUpFormat??P?.matchUpFormat??I?.matchUpFormat??A?.matchUpFormat,J=M.matchUpType||H?.matchUpType||P?.matchUpType||I?.matchUpType||!kn(Qn)(A?.eventType)&&A?.eventType,ie=h?"BYE":M.matchUpStatus,{schedule:K,endDate:ne}=bO({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:Z,publishStatus:w,matchUpType:J,matchUp:M,event:A}),le=d??M.drawPositions??[],{collectionPosition:re,collectionId:me,roundPosition:he}=M,Ie=M.roundNumber??l.roundNumber,Le=me?bMe({tournamentParticipants:i,positionAssignments:r,collectionPosition:re,participantMap:g,drawDefinition:I,drawPositions:le,collectionId:me,sideLineUps:E,matchUpType:J}):void 0,ot=c?.[Ie]?.roundName||l.roundName,at=c?.[Ie]?.abbreviatedRoundName||l.abbreviatedRoundName,dt=C?.[Ie]?.feedRound,It=C?.[Ie]?.preFeedRound,ze=C?.[Ie]?.roundFactor,Ct=n?.[Ie],ke=he?Ct?.[he]:void 0,mt=e?.[Ie],Be=H?.category?{...R?.category||{},...H.category}:R?.category??A?.category,ut=M.processCodes?.length&&M.processCodes||H?.processCodes?.length&&H?.processCodes||P?.processCodes?.length&&P?.processCodes||I?.processCodes?.length&&I?.processCodes||A?.processCodes?.length&&A?.processCodes||u?.processCodes,it=b?.withCompetitiveness&&A1({...v,matchUp:M}),xe=M.finishingPositionRange??l.finishingPositionRange,Ze=V!==Ht&&fi(o)&&o+(Ie||0),st=ve=>Lt(ve,void 0,!0),qe={...st(R),...st({matchUpFormat:J===Qn?void 0:Z,tieFormat:J!==Qn?void 0:N,gender:H?.gender??A?.gender,endDate:M.endDate??ne,discipline:A?.discipline,category:Be,finishingPositionRange:xe,abbreviatedRoundName:at,drawPositionsRange:ke,competitiveProfile:it,structureName:O,stageSequence:F,drawPositions:le,matchUpStatus:ie,processCodes:ut,isRoundRobin:D,matchUpTieId:S,preFeedRound:It,matchUpType:J,roundFactor:ze,roundOffset:k,structureId:x,roundNumber:Ie,roundOfPlay:Ze,feedRound:dt,roundName:ot,drawName:q,drawType:W,schedule:K,drawId:j,stage:V}),...Tt(st(M),!0,!0)};if(Z&&M.score?.scoreStringSide1){let ve=Bs(Z),{bestOf:$e,finalSetFormat:De,setFormat:je}=ve??{};(De?.tiebreakSet||je?.tiebreakSet||je?.timed)&&(qe.score.sets=qe.score.sets.sort((Oe,nt)=>Oe.setNumber-nt.setNumber).map((Oe,nt)=>(nt+1===$e?(De?.tiebreakSet||De?.timed)&&(Oe.tiebreakSet=!0):(je?.tiebreakSet||je?.timed)&&(Oe.tiebreakSet=!0),Oe.tiebreakSet&&[1,2].includes(Oe.winningSide)&&(Oe.side1Score=Oe.winningSide===1?1:0,Oe.side2Score=Oe.winningSide===2?1:0),Oe)))}if(Array.isArray(le)){let{orderedDrawPositions:ve,displayOrder:$e}=yMe({drawPositions:le,roundProfile:C,roundNumber:Ie}),De=C?.[Ie]?.feedRound,je=$e[0]!==ve[0],Oe=ve.concat(void 0,void 0).slice(0,2).map((nt,Fe)=>{let wt=Fe+1,pt=je?3-wt:wt,Mt=IMe({...Le,positionAssignments:r,displaySideNumber:pt,seedAssignments:f,drawPosition:nt,isFeedRound:De,sideNumber:wt}),Wi=M.sides?.find(Vi=>Vi.sideNumber===wt),Qt=he?(he-1)*2+Fe+1:void 0,tr=Qt?mt?.[Qt]:void 0;return st({sourceDrawPositionRange:tr,...Wi,...Mt})});Object.assign(qe,Tt({sides:Oe},!0,!0))}if(i&&qe.sides){let ve=p?.[jU],$e=De=>{let je=g?.[De]?.participant;return je&&sI({template:ve?.participant,source:je})};if(qe.sides.filter(Boolean).forEach(De=>{if(De.participantId){let je=Tt($e(De.participantId)||(i?og({policyDefinitions:p,participantId:De.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(je){let Oe,nt;if(I?.entries){let Fe=I.entries.find(pt=>pt.participantId===De.participantId),wt=A?.entries?.find(pt=>pt.participantId===De.participantId);Oe=Fe?.entryStatus||wt?.entryStatus,je.entryStatus=Oe,Fe?.entryStage&&(nt=Fe.entryStage,je.entryStage=nt)}a===!1?Object.assign(De,{participant:{entryStage:nt,entryStatus:Oe}}):Object.assign(De,{participant:je})}}if(De?.participant?.individualParticipantIds?.length&&!De.participant.individualParticipants?.length){let je=De.participant.individualParticipantIds.map(Oe=>$e(Oe)||(i?og({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Oe}):void 0));a!==!1&&Object.assign(De.participant,{individualParticipants:je})}}),!qe.matchUpType){let{matchUpType:De}=IO({matchUp:qe});De&&Object.assign(qe,{matchUpType:De})}if(b?.inferGender&&(!qe.gender||qe.gender===GI)&&qe.sides?.length===2&&qe.matchUpType!==Qn){let De=qe.sides.map(je=>{if(kn(Ir)(qe.matchUpType))return je.participant?.person?.sex;if(je.participant?.individualParticipants?.length===2){let Oe=vi(je.participant.individualParticipants.map(nt=>nt.person?.sex)).filter(Boolean);if(Oe.length===1)return Oe[0]}});if(De.filter(Boolean).length===2&&vi(De).length===1){let je=De[0];qe.inferredGender=je}}}if(qe.tieMatchUps){let ve=qe.matchUpStatus==="BYE",$e=qe.sides?.map(({participant:De,drawPosition:je,sideNumber:Oe,lineUp:nt})=>{let Fe=De?.participantType===Qn&&De;return{teamParticipant:Fe&&Lt({participantRoleResponsibilities:Fe.participantRoleResponsibilities,participantOtherName:Fe.participanOthertName,participantName:Fe.participantName,participantId:Fe.participantId,teamId:Fe.teamId}),drawPosition:je,sideNumber:Oe,lineUp:nt}});qe.tieMatchUps=qe.tieMatchUps.map(De=>{let je=qe.matchUpId,Oe={finishingPositionRange:qe.finishingPositionRange,abbreviatedRoundName:at,roundNumber:Ie,roundName:ot};return Tse({tieDrawPositions:le,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:$e,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Oe,appliedPolicies:p,isCollectionBye:ve,usePublishState:m,publishStatus:w,matchUpTieId:je,isRoundRobin:D,roundProfile:C,matchUp:De,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:u,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:T,structure:P,context:R})})}let ft=qe.sides?.filter(ve=>ve?.participantId).length===2,_t=!qe.winningSide;if(Object.assign(qe,{readyToScore:T&&ft&&_t,hasContext:!0}),ft){let{allParticipantsCheckedIn:ve,checkedInParticipantIds:$e}=JI({matchUp:qe});Object.assign(qe,{allParticipantsCheckedIn:ve,checkedInParticipantIds:$e})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(ve=>delete qe[ve]),qe}function TMe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:Ah});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Tt(r,!1,!0)}:e}function UMe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:pg});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function DMe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:KI});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Df(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:w,tournamentIds:T,matchUpTypes:S,structureIds:D,readyToScore:C,courtIds:E,eventIds:P,venueIds:R,drawIds:M,stages:A}=t,N=Array.isArray(I)?I.filter(Boolean):[],k=Array.isArray(a)?a.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(A)?A.filter(Boolean):[],V=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],j=Array.isArray(f)?f.filter(Boolean):[],q=Array.isArray(p)?p.filter(Boolean):[],W=Array.isArray(l)?l.filter(Boolean):[],z=Array.isArray(h)&&g?h.filter(Boolean):[],H=Array.isArray(S)&&m?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(R)?R.filter(Boolean):[],ie=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],K=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ne=Array.isArray(T)?T.filter(Boolean):[],le=Array.isArray(P)?P.filter(Boolean):[],re=Array.isArray(M)?M.filter(Boolean):[],me=Array.isArray(D)?D.filter(Boolean):[];return e.filter(he=>{if(C&&!kn(rc)(he)&&!he.readyToScore||he.winningSide&&s&&![1,2].includes(he.winningSide)||d!==void 0&&(d&&!he.tieMatchUps||!d&&he.tieMatchUps)||n!==void 0&&(n&&!he.collectionId||!n&&he.collectionId)||O.length&&!O.includes(he.stage)||V.length&&!V.includes(he.stageSequence)||F.length&&(!he.collectionId||!F.includes(he.collectionId))||j.length&&(!he.roundName||!j.includes(he.roundName))||q.length&&(!he.roundNumber||!q.includes(he.roundNumber))||W.length&&(!he.roundPosition||!W.includes(he.roundPosition))||k.length&&(!he.matchUpStatus||!k.includes(he.matchUpStatus))||x.length&&he.matchUpStatus&&x.includes(he.matchUpStatus)||z.length&&!z.includes(he.matchUpId)||H.length&&(!he.matchUpType||!Uk(H,he.matchUpType))||ie.length&&(!he.matchUpFormat||!ie.includes(he.matchUpFormat)))return!1;if(K?.length){let{scheduledTime:Ie}=Sse({matchUp:he}),{scheduledDate:Le}=QI({matchUp:he}),ot=Ti(Ie)||Le;if(!K.find(at=>Uh(at,ot)))return!1}if(Z.length){let{courtId:Ie}=UMe({matchUp:he}),{allocatedCourts:Le}=TMe({matchUp:he}),ot=Le?.map(({courtId:at})=>at);if(!Z.filter(Boolean).includes(Ie)||ot?.includes(Ie))return!1}if(J.length){let{venueId:Ie}=DMe({matchUp:he});if(!J.filter(Boolean).includes(Ie))return!1}if(w){if(ne.length&&!ne.includes(he.tournamentId)||le.length&&!le.includes(he.eventId)||re.length&&!re.includes(he.drawId)||me.length&&!me.includes(he.structureId))return!1;let Ie=he.sides?.map(({participantId:Le})=>Le).filter(Boolean)??[];if(r&&Ie.length<r||N.length&&!N.some(Le=>Ie.includes(Le)))return!1}return!0})}function rr(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:c,event:u}=t,{seedAssignments:d,contextContent:p,exitProfiles:h,matchUpsMap:f}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:Dy,roundMatchUps:g,matchUps:[]};let v=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],y=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],b=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],I=!o?.eventId||!v?.length&&!r?.eventIds?.filter(Boolean).length||v?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),w=!y?.length||y.includes(l.structureId),T=!s||!b?.length||b.includes(s.drawId);if(!I||!w||!T)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=vm({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:S}=Qi({drawDefinition:s}),D={...t.tournamentAppliedPolicies,...S,...t.policyDefinitions},C=D?.scoring?.structures,E=l.stage&&C?.stage?.[l.stage],P=l.stageSequence&&E?.stageSequence?.[l.stageSequence],R=D?.scoring?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned;f||(f=is({drawDefinition:s,structure:l}));let{positionAssignments:M,allPositionsAssigned:A}=aa({structure:l}),N=!R||A,{seedAssignments:k}=$c({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??k;let{structureId:x}=l;h=h||s&&rse({drawDefinition:s}).exitProfiles;let O=h?.[x],V=O?.length&&(O[0].split("-").map(Z=>parseInt(Z)).reduce((Z,J)=>Z+J)||0),F=!!l.structures,j=dg({matchUpsMap:f,structureId:x,inContext:c}),q=D?.[Gf],W=nse({roundNamingPolicy:q,drawDefinition:s,structure:l,matchUps:j}),{roundNamingProfile:z,roundProfile:H}=W;if(g=W?.roundMatchUps??[],n&&(j=Df({matchUps:j,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),c){let{sourceDrawPositionRanges:Z}=K0e({drawDefinition:s,matchUpsMap:f,structureId:x}),J=s?Z0e({drawDefinition:s,roundProfile:H,matchUpsMap:f,structureId:x}).drawPositionsRanges:void 0,ie=t.tournamentParticipants,K=t.participantMap;!ie?.length&&!K&&i&&({participants:ie=[],participantMap:K}=Ny({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:c})),j=j.map(ne=>Tse({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:Z,tournamentParticipants:ie,positionAssignments:M,drawPositionsRanges:J,initialRoundOfPlay:V,roundNamingProfile:z,tournamentRecord:i,appliedPolicies:D,seedAssignments:d,contextContent:p,participantMap:K,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:F,roundProfile:H,structure:l,context:o,matchUp:ne,event:u})),(j?.filter(ne=>Array.isArray(ne.tieMatchUps))).forEach(ne=>{let le=ne.tieMatchUps;j=j.concat(...le)}),r&&(j=Df({processContext:!0,...r,matchUps:j}))}else(j?.filter(Z=>Array.isArray(Z.tieMatchUps))).forEach(Z=>{let J=Z.tieMatchUps;j=j.concat(...J)});return n&&(j=Df({matchUps:j,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(j=Df({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:j})),(n?.matchUpTypes||n?.matchUpIds||c)&&(g=fo({matchUps:j}).roundMatchUps??[]),Ks({drawDefinition:s,structure:l,event:u})?.tieFormat&&({collectionPositionMatchUps:m}=Y0e({matchUps:j})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:F,roundProfile:H,matchUpsMap:f,matchUps:j}}function Lv({matchUp:t}){return t?Hn.includes(t?.matchUpStatus)||t?.winningSide:!1}function wO({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:w,context:T,event:S}){!w&&b&&({structure:w}=si({drawDefinition:g,structureId:b}));let D=rr({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:w,inContext:I,context:T,event:S}),C=[],E=[],P=[],R=[],M=[];if(D.error)return D;let{matchUps:A}=D,{assignedPositions:N}=aa({structure:w}),k=N?.filter(O=>O.participantId).map(O=>O.drawPosition),x;return A.filter(O=>{let V=c?.matchUpTypes?.length===1&&c.matchUpTypes[0]===_r;return!(O.matchUpType!==_r&&V)}).forEach(O=>{if(O.matchUpStatus===rl){C.push(O);return}O.matchUpType===_r&&(x=!0);let V=!!O.collectionId,F=V&&O.sides?.every(Z=>Z.participantId),j=!V&&O.drawPositions?.filter(Boolean).length===2,q=!V&&O.drawPositions?.every(Z=>k?.includes(Z)),W=N?.filter(Z=>Z.bye).map(Z=>Z.drawPosition),z=!V&&O.drawPositions?.find(Z=>W?.includes(Z)),H=sz.includes(O.matchUpStatus)&&(F||j&&(!t||q));return z?M.push(O):Lv({matchUp:O})?E.push(O):H?P.push(O):R.push(O)}),{includesTeamMatchUps:x,abandonedMatchUps:C,completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:R,byeMatchUps:M,structure:w}}function EMe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Nt};if(!i)return{error:dc};let{links:r}=qU({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function N2({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||ho(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Eh,Ph].includes(n?.linkType)&&!n?.source?.roundNumber?ce({result:{error:be},stack:"getTargetLink",context:n}):n}function qU({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:dc}:{error:Nt}}function PMe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function A2({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:QG};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:c}}=n,{structure:u}=si({drawDefinition:r,structureId:a}),{positionAssignments:d}=Sr({structure:u}),p=(e?.filter(C=>C.structureId===u?.structureId)).filter(C=>C.roundNumber===l&&!C.matchUpTieId),h=p.length,f=vt(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c?.interleave&&m!==.5){let C=c.offset+(i-1)*c.interleave,E=i+C;g=Math.ceil(E/2),v=1-E%2}let y=f,b=f[g-1],I=ise({roundPositionsCount:f.length,groupedOrder:o}),w=I?.length||1;if(w<=f.length){let C=h/w,E=Ca(f,C);s===Zv&&E.forEach(P=>P.reverse()),y=I?.length&&I?.map(P=>E[P-1]).flat()||y}s===Su?b=y[g-1]:s===Zv?((!I?.length||w>f.length)&&(g=p.length+1-g),b=y[g-1]):s===qk&&ac()&&console.log(xk,{feedProfile:s});let T=b&&p.reduce((C,E)=>E.roundPosition===b?E:C,void 0),S;T?.feedRound?(v=0,S=Math.min(...(T.drawPositions||[]).filter(Boolean))):S=T?.drawPositions?.length===2&&T?.drawPositions[v];let D=d?.find(({drawPosition:C})=>C===S);if(D){let{extension:C}=Pi({element:D,name:rO});if(C?.value)return{disabledDrawPosition:S}}return{matchUp:T,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function mo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=si({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===zI?CMe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):RMe({matchUp:a})}function CMe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=EMe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,c=N2({source:l,linkType:Eh}),u=N2({linkCondition:gp,linkType:Ph,source:l}),d=N2({source:l,linkType:Ph}),p=u&&d;d||(d=u);let h=c?.target?.feedProfile,f=d?.target?.feedProfile,m=u?.target?.feedProfile,g,v,y,b,I,w,T,S,D,C;if(e&&(a||s)&&(T=a&&h!==wu&&t.find(({matchUpId:R})=>R===a),b=s&&f!==wu&&t.find(({matchUpId:R})=>R===s),T||b))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:T}};let{roundPosition:E}=n;C=C||t.filter(R=>R.structureId===r.structureId);let P=C.reduce((R,M)=>M.roundNumber===n.roundNumber&&!M.matchUpTieId?R+1:R,0);return d&&!b&&f!==wu&&({matchUpDrawPositionIndex:w,targetDrawPosition:I,matchUp:b}=A2({targetLink:d,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==wu&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=A2({targetLink:u,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),c&&!T&&h!==wu&&({matchUpDrawPositionIndex:D,targetDrawPosition:S,matchUp:T}=A2({targetLink:c,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),T||(C=C||t.filter(R=>R.structureId===r.structureId),{matchUp:T}=PMe({structureMatchUps:C,matchUp:n})),Lt({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:w,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:T,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function RMe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function MMe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=si({drawDefinition:t,structureId:a});if(o?.finishingPosition===Xv){let{roundNumber:l}=r,c=l&&ii(l)+1,u=o.matchUps??[],{roundMatchUps:d}=fo({matchUps:u});if(c&&d?.[c]){let p=[...s].sort(Jn).map((h,f)=>{let m=d[c].find(g=>g.drawPositions?.includes(h));return{matchUpId:m?.matchUpId,roundNumber:c,schedule:m?.schedule,sideNumber:f+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=mo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:c}=l.targetMatchUps,{loserMatchUp:u}=l.targetMatchUps;!r.winnerMatchUpId&&c&&(r.winnerMatchUpId=c.matchUpId),!r.loserMatchUpId&&u&&(r.loserMatchUpId=u.matchUpId);let d=_2({upcomingMatchUp:c}),p=_2({upcomingMatchUp:u});if(r.matchUpStatus!=="BYE"&&u?.matchUpStatus==="BYE"){let{matchUp:f}=Use({matchUp:u,drawDefinition:t,inContextDrawMatchUps:e})||{};p=f&&_2({upcomingMatchUp:f})||p}let h=r.schedule?.timeAfterRecovery;if(h&&(d?.schedule?.scheduledTime&&Xi(d.schedule.scheduledTime)<Xi(h)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Xi(p.schedule.scheduledTime)<Xi(h)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let f=l.targetLinks?.loserTargetLink?.linkCondition===gp,m=NMe(r);if(m.length){let g=rV(c?.sides),v=rV(u?.sides),y=m.find(({participantId:I})=>g.includes(I))?[]:m,b=m.find(({participantId:I})=>v.includes(I))?[]:m;u&&f&&b.length<2&&b.push({bye:!0,tbd:!0}),y?.length&&c&&(!l.targetMatchUpIds&&c&&(c=e.find(({matchUpId:I})=>I===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(y)),b?.length&&u&&(l.targetMatchUpIds||(c=e.find(({matchUpId:I})=>I===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(b))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function NMe(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function Use({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Dn)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=mo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},Use({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function _2(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function zn(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=WU(t);if(i.error)return ce({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function WU(t){if(!t?.drawDefinition)return{error:Nt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:w,event:T}=t,S=[],D=[],C=[],E=[],P=[];v&&!i&&(i=vm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:T}));let R;!e?.length&&u&&(e=u?.participants,(I||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=dO({participants:e,participantsProfile:o})));let{structures:M}=ju({drawDefinition:y});if(!M)return{error:Qr};r||(r=is({drawDefinition:y}));let A=y&&rse({drawDefinition:y}).exitProfiles;M.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:V=[],upcomingMatchUps:F=[],completedMatchUps:j=[],abandonedMatchUps:q=[]}=wO({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:x,context:w,event:T});S=S.concat(...q),D=D.concat(...j),C=C.concat(...F),E=E.concat(...V),P=P.concat(...O)});let N=x=>(!h&&!b&&!p||(h&&(x=Df({matchUps:x,...h})),p&&(x=Df({matchUps:x,...p,processContext:!0}))),x),k={abandonedMatchUps:N(S),completedMatchUps:N(D),upcomingMatchUps:N(C),pendingMatchUps:N(E),byeMatchUps:N(P),matchUpsMap:r,...se,groupInfo:R};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:V,upcoming:F,pending:j,bye:q}=x,W=[].concat(...O&&S||[],...V&&D||[],...F&&C||[],...j&&E||[],...q&&P||[]);MMe({inContextDrawMatchUps:W,drawDefinition:y})}return k}function Jh(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:Or};let{eventId:b,eventName:I,endDate:w,eventType:T,category:S,gender:D,matchUpFormat:C}=y??{},E={...v,...Lt({indoorOutDoor:y.indoorOutdoor??u?.indoorOutdoor,surfaceCategory:y.surfaceCategory??u?.surfaceCategory,endDate:y.endDate??u?.endDate,tournamentId:u?.tournamentId,matchUpFormat:C,eventName:I,eventType:T,category:S,eventId:b,gender:D})};w&&(E.endDate=w),f&&!i&&(i=vm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:y}));let P;if(!e?.length&&!r&&u){let A=Ny({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:g});r=A.participantMap,e=A.participants??[],P=A.groupInfo}let R=y.drawDefinitions??[],M=U1({tournamentRecord:u,event:y}).scheduleTiming;return{matchUps:R.flatMap(A=>{let{matchUps:N}=zn({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:A,contextContent:i,matchUpFilters:h,participantMap:r,scheduleTiming:M,nextMatchUps:m,inContext:g,event:y});return N??[]}),groupInfo:P}}function Ha(t){let e=jt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:Qe};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??c.tournamentId,y=c?.events??[];r||({participants:r,participantMap:i}=Ny({participantsProfile:a,useParticipantMap:o,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=Qi({tournamentRecord:c}),I={...g,tournamentId:v,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},w=vm({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:y.flatMap(T=>(I.eventDrawsCount=T.drawDefinitions?.length??0,Jh({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:w,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:r,inContext:u,event:T}).matchUps??[])).concat(...c.matchUps??[])}}function Ud({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:dn};let u=Object.keys(r).map(d=>{let p=r[d];return Ha({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...se,matchUps:u}}function tw(t,e){return AMe(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function AMe(t,e){return(aI[t?.stage]||0)-(aI[e?.stage]||0)}function lo(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:w,eventType:T,category:S,gender:D,matchUpFormat:C}=y??{},E={...v,surfaceCategory:y?.surfaceCategory??u?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??u?.indoorOutdoor,matchUpFormat:C,eventType:T,eventName:I,category:S,eventId:b,endDate:w,gender:D},P;return!e?.length&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=Ny({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!r&&(r=vm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...zn({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:r,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function _b({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Tt(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l?.[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),n.includes(l[h])||n.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?n.includes(f)||n.push(f):(a=f,n.push(f))}}}}var Dse=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:_b({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:_b({element:e,accessor:i})?.value}))||(typeof t=="string"&&_b({element:e,accessor:t}))?.value,Rl=Dse;function O1({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!Kc(a))return[];let{roundProfile:l,roundNumbers:c=[]}=fo({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let u=n?r-n:0,d=u&&l?.[r-u]?.matchUpsCount,p=l&&Object.values(l).map(Rl("matchUpsCount")),h=(g,v)=>{let y=Math.min(...g);d&&v&&y===1&&(y=d);let b=Math.max(...g);return e&&b>e&&(b=e),[y,b]},f=l&&Object.assign({},...c.map(g=>{let v=(r??0)+1-g-u,y=l[g].matchUpsCount,b={finishingPositionRange:{},finishingRound:v},I=p?.slice(g-1).reduce((R,M)=>R+(M||0),0),w=o&&g!==1,T=1+t+(w?i??0:0),S=1,D=vt(T,s?T+y*2:I+T+S),C=I+S-y,E=h(D.slice(C)),P=h(D.slice(0,C),!0);return b.finishingPositionRange={loser:E,winner:P},{[g]:b}})),m=ac({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let v=g.roundNumber&&f[g.roundNumber];m&&!v&&console.log({roundFinishingData:f,matchUp:g}),g.finishingRound=v?.finishingRound,g.finishingPositionRange=v?.finishingPositionRange}),a}function ty({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:Nt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=zn({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];O1({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=mo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:c}=o.targetMatchUps,u=l?.matchUpId,d=c?.matchUpId,p=dg({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===a);if(p&&(u&&(r.winnerMatchUpIds[p.matchUpId]=u,Object.assign(p,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let h=c.finishingPositionRange&&[...n.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];n.finishingPositionRange.loser=f,p.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function Qu(t){let e=qc(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:hm};if(!Array.isArray(r))return{error:Md};let o=t.matchUpIds?.length?t.matchUpIds:i.map(y=>y.matchUpId);if(!Array.isArray(o))return{error:xI};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((y,b)=>y.concat(b.events??[]).map(I=>(I.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:y})=>y===Dh),f=i;if(h.length){f=Ud({nextMatchUps:!0,tournamentRecords:e}).matchUps;let y=h.reduce((b,I)=>{let w=I.source?.structureId,T=I.target?.structureId;return w&&T&&(u[T]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of y)l[b]=[];for(let b of f??[]){let I=b.containerStructureId||b.structureId;y.includes(I)&&l[I].push(b.matchUpId)}}let m=y=>{c[y]||(c[y]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[y]=[])},g=(y,b)=>{c[y].matchUpIds.forEach(I=>{c[b].matchUpIds.push(I)}),c[b].matchUpIds.push(y),c[y].dependentMatchUpIds.push(b),n&&c[y].participantIds.forEach(I=>c[b].participantIds.push(I))},v=y=>{let b=Object.keys(l).length;for(let I of y||[]){let{matchUpId:w,winnerMatchUpId:T,loserMatchUpId:S}=I;if(!o.length||o.includes(w)){if(m(w),n){let{individualParticipantIds:E}=uO(I);c[w].participantIds=E}T&&(m(T),g(w,T),d[T].push(w)),S&&(m(S),g(w,S),d[S].push(w)),c[w].sources.push(d[w]);let D=d[w].map(E=>c[E].sources[0]).flat(),C=d[w].map(E=>c[E].sources[1]).flat();if(c[w].sources.push(D,C),b){let E=I.containerStructureId||I.structureId,P=u[E];if(l[P])for(let R of l[P])m(R),g(R,w),d[R].push(w)}}}};if(s)ty({drawDefinition:s}),f?.length||(f=lo({drawDefinition:s}).matchUps),v(f);else{if(f?.length||(f=Ud({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let y=p?.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:I=[]})=>I.map(({drawId:w})=>w))).flat(1/0):[];y&&(r=y)}for(let y of r){let b=f?.filter(I=>I.drawId===y).sort(tw);if(!b?.find(({roundPosition:I})=>!I)){let I=b?.find(({tournamentId:T})=>T),{drawDefinition:w}=_o({tournamentRecord:e[I?.tournamentId],drawId:y});w&&ty({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...se}}function sa(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:c}=r||{},u=n||a||s||o||l||c;return!!(i?.sets?.length>1||u)}function x1({matchUpStatus:t}){return nz.includes(t)}function _Me({matchUpStatus:t}){return aO.includes(t)}function uV({matchUpStatus:t}){return az.includes(t)}function Oz({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(Oz)?.length;return sa({score:n})||s||e&&a||t&&_Me({matchUpStatus:t})&&![yr,xr,Zu].includes(t)}function L1(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=zU({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let S=si({drawDefinition:e,structureId:r});if(S.error)return S;a=i?S.containingStructure??S.structure:S.structure}if(Ao({structure:a}))return{structure:a,isAdHoc:!0,error:MU};let{matchUps:c}=zn({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),u=c?.filter(S=>S.structureId===r||o.includes(S.structureId)),{matchUpDependencies:d}=Qu({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let S of c??[]){if(S.structureId===r||o.includes(S.structureId)){h.push(...S.drawPositions??[]);let D=S.roundNumber;for(let C of(S.drawPositions??[]).filter(Boolean))(!f[C]||D&&f[C]>D)&&(f[C]=D)}Oz(S)&&(m.push(S),p.push(S.matchUpId,...d?.[S?.matchUpId]?.matchUpIds||[]))}let g=vi(h.filter(Boolean)).sort(Jn),v=vi(p),y=vi(u?.map(({matchUpId:S,drawPositions:D})=>v.includes(S)?D:[]).flat().filter(Boolean)).sort(Jn),{positionAssignments:b}=Sr({drawDefinition:e,structure:a}),I=b?.filter(S=>S.bye).map(S=>S.drawPosition),w=b?.filter(S=>S.qualifier).map(S=>S.drawPosition),T=g?.filter(S=>!y.includes(S))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:w,inactiveDrawPositions:T,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function cI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(Jn)[0]}}var Vm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},xz=[];function Il(t,e){jr(t)&&(t={method:t}),(e||ac())&&xz.push(t)}function kMe(t){return xz.slice()}function OMe(t){let e=kMe().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(Vm).includes(r)?Vm[r]:Vm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&Vm[n[u]]?Vm[n[u]]:Vm.brightwhite;return`${Vm.white}${u}: ${d}${i[u]}`}).join(", "),c=a?.length<15?"		":"	";return[s?`
`:"",o,a,c,Vm.white,l,Vm.reset,`
`].join("")});e?.length&&console.log(...e)}function xMe(){xz.length=0}function As(t){return[yr,xr,Ia].includes(t)}function mc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:c}){if(!r)return{error:Nt};if(l||({structure:l}=si({drawDefinition:r,structureId:o})),!l)return{error:Qr};o||({structureId:o}=l);let u="assignDrawPositionBye";Il({method:u,color:"cyan",drawPosition:n}),s??=is({drawDefinition:r});let{positionAssignments:d}=Sr({structure:l}),{activeDrawPositions:p}=L1({drawDefinition:r,structureId:o});if(d?.find(P=>P.drawPosition===n)?.bye)return{...se};let h=!!(a&&s.drawMatchUps.find(P=>P.loserMatchUpId===a?.matchUpId&&As(P.matchUpStatus)));if(p?.includes(n)&&!h)return{error:Dk};let f=d?.find(P=>P.drawPosition===n);if(!f)return{error:MU};let{filled:m,containsBye:g,assignedParticipantId:v}=LMe(f);if(g)return{...se};if(m&&!g&&!h)return ce({result:{error:vT},stack:u});let y=Qi({tournamentRecord:i,drawDefinition:r,event:c}).appliedPolicies??{},b=zn({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:w}=rr({provisionalPositioning:t,drawDefinition:r,matchUpFilters:I,matchUpsMap:s,structure:l});if(d?.forEach(P=>{P.drawPosition===n&&(P.bye=!0,h&&(P.participantId=void 0))}),l.structureType===wo)return FMe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:w}),ug({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),DY({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:T,roundMatchUps:S}=fo({matchUps:w}),D=(T&&Object.keys(T).map(P=>parseInt(P)).reverse())?.find(P=>T?.[P].drawPositions?.includes(n)),C=D?S?.[D].find(({drawPositions:P})=>P?.includes(n)):void 0;C&&Ese({tournamentRecord:i,drawDefinition:r,matchUp:C,event:c});let E=C?.drawPositions?.find(P=>P!==n);if(C&&E){let P=Lz({sourceDrawPositions:C.drawPositions,matchUpId:C.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(P.error)return P}return ug({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),DY({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function DY({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&cO({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),ce({result:{...se},stack:s})}function LMe(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function Ese({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Gi({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function FMe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&Ese({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function Lz({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Il({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(b=>b.matchUpId===s),c=e.find(b=>b.matchUpId===s)?.structureId,{structure:u}=si({drawDefinition:n,structureId:c}),{positionAssignments:d}=Sr({structure:u}),p=d?.filter(b=>b.bye).map(b=>b.drawPosition),h=l?.drawPositions?.find(b=>b!==t),f=h&&p?.includes(h),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=mo({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(v&&v.structureId===u?.structureId&&BMe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:o}),g&&f&&g.structureId!==u?.structureId){let{roundNumber:b}=g;if(b===1){let I=mc({structureId:m.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:o});if(I.error)return I}else Pse({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...se}}function BMe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",c=s.drawMatchUps.find(A=>A.matchUpId===a.matchUpId),u=e.find(A=>A.matchUpId===a.matchUpId)?.structureId,{structure:d}=si({drawDefinition:n,structureId:u}),{positionAssignments:p}=Sr({structure:d}),h=p?.find(({drawPosition:A})=>A===t)?.bye,f=c.drawPositions?.filter(Boolean),m=p?.filter(A=>f?.includes(A.drawPosition)),g=p?.find(({drawPosition:A})=>A===t),v=i?.find(A=>A!==t),y=(v&&m?.find(({drawPosition:A})=>A===v))?.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),f?.length>1&&h&&!y)return ce({result:{error:vT},stack:l});let I=f?.find(A=>A!==t),w=b,T=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=T.map(A=>!A&&!w||A===t?(w=!0,t):A).sort(Jn);if(!w)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),ce({result:{error:vT},stack:l});let D=p?.find(({drawPosition:A})=>A===I)?.bye,C=p?.find(({drawPosition:A})=>A===t)?.bye;Object.assign(c,{matchUpStatus:C||D?"BYE":Dn,score:void 0,winningSide:void 0,drawPositions:S});let E=c.drawPositions.find(A=>!T.includes(A));Il({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:D,drawPositionIsBye:C}),Gi({tournamentId:r?.tournamentId,matchUp:c,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:P},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:M}}=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(D||C){let A=D?t:I;if(A)Lz({drawPositionToAdvance:A,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(C&&P&&R)if(R.feedRound)Pse({loserTargetDrawPosition:M,tournamentRecord:r,loserTargetLink:P,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,k=R.drawPositions[N],x=mc({structureId:P.target.structureId,drawPosition:k,tournamentRecord:r,drawDefinition:n,event:o});if(x.error)return x}}}function Pse({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Il({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:c}=cI({drawPosition:t,matchUps:l});if(c===o){let u=mc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(u.error)return u}}function Cse({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=rr({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>o.drawPositions?.includes(c)).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Dn}),Gi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function F1(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=si({drawDefinition:a,structureId:s}),u=(aa({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u?.drawPosition),!r)return{error:NU};i||(i=u?.participantId);let{activeDrawPositions:d}=L1({drawDefinition:a,structureId:s});return d.includes(r)?{error:Dk}:(e||({matchUps:e}=zn({inContext:!0,drawDefinition:a,matchUpsMap:o})),dV({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(ug({tournamentId:n?.tournamentId,drawDefinition:a,structure:c,event:l}),{...se,participantId:i}):{error:tre})}function dV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=si({drawDefinition:i,structureId:a});if(!o)return{error:Qr};let l=aa({drawDefinition:i,structure:o}).positionAssignments||[],c=l.some(v=>{if(v.drawPosition===r)return delete v.participantId,delete v.qualifier,delete v.bye,!0});if(o.structureType===wo)return Cse({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:c,...se};let u={isCollectionMatchUp:!1},{matchUps:d}=rr({drawDefinition:i,matchUpFilters:u,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:h}=fo({matchUps:d}),f=(p&&Object.keys(p))?.map(v=>ii(v)),m=r,g=f?.map(v=>{let y=p?.[v]?.pairedDrawPositions?.find(E=>E.includes(m)),b=y?.find(E=>E!==m),I=l.find(E=>E.drawPosition===b),w=p?.[v+1],T=I?.bye,S=w?.pairedDrawPositions?.find(E=>E.includes(b)),D=T&&S&&w&&w.drawPositions?.includes(b),C=y&&{pairedDrawPositionByeAdvancedPair:!D&&S,pairedDrawPosition:b,targetDrawPosition:m,relevantPair:y,roundNumber:v};return D&&(m=b),C}).filter(v=>v?.targetDrawPosition)?.reduce((v,y)=>{let{roundNumber:b,relevantPair:I,targetDrawPosition:w,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:S}=y,D={roundNumber:b,targetDrawPosition:w,relevantPair:I},C=S&&{roundNumber:b+1,targetDrawPosition:T,relevantPair:S,subsequentRoundRemoval:!0},E=[D,C].filter(Boolean);return v.concat(...E)},[]);return g?.forEach(({roundNumber:v,targetDrawPosition:y,relevantPair:b})=>{let I=h?.[v].find(w=>ho(w.drawPositions?.filter(Boolean),b.filter(Boolean)));I&&($Me({inContextDrawMatchUps:t,targetDrawPosition:y,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:v,matchUpsMap:n}),Rse({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:I,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function $Me({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=si({drawDefinition:r,structureId:s});if(!o)return{error:Qr};if(o.structureType===wo)return;n=n||is({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:c}=cI({drawPosition:e,matchUps:l}),u=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==c&&p.drawPositions?.includes(e)),d=Sr({drawDefinition:r,structureId:s}).positionAssignments??[];return u?.forEach(p=>Rse({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...se}}function Rse({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c="removeDrawPosition",u=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??is({drawDefinition:r});let h=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:f}=cI({drawPosition:a,matchUps:h});if(n.roundNumber&&f&&n.roundNumber>f){let S=(n.drawPositions??[]).map(D=>D===a?void 0:D);n.drawPositions=S}if(n.matchUpType===_r){let S=(t?.find(D=>D.matchUpId===n.matchUpId)?.sides??[]).reduce((D,C,E)=>C.drawPosition===a?E:D,void 0);S!==void 0&&n.sides?.[S]?.lineUp&&(delete n.sides?.[S].lineUp,Gi({tournamentId:i?.tournamentId,context:`${c}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=mo({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:S})=>n.drawPositions?.includes(S)).filter(S=>S.bye).length,w=I&&"BYE"||n.matchUpStatus&&As(n.matchUpStatus)&&n.matcHUpStatus||Dn;n.matchUpStatus=w,n.matchUpStatus&&As(n.matchUpStatus)&&(n.winningSide=void 0);let T=u?.find(S=>!n.drawPositions?.includes(S));if(u?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(T&&Il({method:c,color:"brightyellow",removedDrawPosition:T}),Gi({tournamentId:i?.tournamentId,context:`${c}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:S,roundNumber:D}=v;if(D===1){let C=S[b];dV({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let C=Math.min(...S.filter(Boolean)),E=VMe({loserMatchUpDrawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:s,event:l});if(E.error)return ce({result:E,stack:c});let P=(s?.mappedMatchUps||{})[v.structureId].matchUps,{initialRoundNumber:R}=cI({drawPosition:C,matchUps:P});R===1&&(Il({method:c,color:"brightyellow",loserMatchUpDrawPosition:C}),dV({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...se}}function VMe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=si({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Sr({structure:o});if(l?.find(c=>c.drawPosition===t)?.bye){let c=F1({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(c.error)return c}return{...se}}function xy({drawDefinition:t,stages:e}){if(!t)return{error:Nt};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=vi(i.map(n=>{let{positionAssignments:a}=Sr({structure:n});return a?a.map(xi):[]}).flat().filter(Boolean));return{...se,assignedParticipantIds:r}}function yd(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Ut}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function Sv(t){return[_y,Yc].includes(t)}function UA({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){if(!n||!Array.isArray(n))return{error:Sd,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Or};if(a&&!tse.includes(a))return{error:K$};if(s&&!Gk.includes(s))return{error:Ey};let p="modifyEntriesStatus",h=[];if(!a&&!o)return ce({result:{error:Wt},info:"Missing entryStatus",stack:p});if(o&&!vp({extension:o,requiredAttributes:["name"]}))return ce({result:{error:be},info:"Invalid extension",context:{extension:o},stack:p});let f=[];d?.drawDefinitions?.forEach(C=>{let E=xy({stages:u&&[u],drawDefinition:C}).assignedParticipantIds??[];f.push(...E)});let m=i?.participants??[];if(!n.every(C=>{let E=og({tournamentParticipants:m,participantId:C})?.participantType;return!(E&&[Di,Co].includes(E)&&Sv(a))&&!(a&&d?.eventType&&E===Li&&[Fc,El].includes(d.eventType)&&[Cu,...fN].includes(a))}))return{error:K$};let g=d&&Cn({event:d}).flightProfile,v=g?.flights?.find(C=>C.drawId===c),y=C=>{let E=(C||[]).filter(R=>!u||!R.entryStage||u===R.entryStage).filter(({participantId:R})=>n.includes(R)),P=R=>a&&f.includes(R.participantId)&&!(fN.includes(R.entryStatus)&&fN.includes(a));return E.every(R=>P(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?ir({element:R,extension:o}):oo({element:R,name:o.name})),!0))?{...se}:{error:kU}},b=({flight:C,drawDefinition:E})=>{d&&(d.entries=yd({entries:d.entries??[]})),C&&(C.drawEntries=yd({entries:C.drawEntries})),E&&(E.entries=yd({entries:E.entries}))},I=C=>{let{flight:E,drawDefinition:P}=C,R="updateDrawEntries";if(E){let M=y(E.drawEntries);if(M.error)return ce({result:M,stack:R})}if(P){let M=y(P.entries);if(M.error)return ce({result:M,stack:R});h.includes(P.drawId)||h.push(P.drawId)}return{...se}},w=d?.entries?.find(({entryPosition:C})=>C)??(v?.drawEntries?.find(({entryPosition:C})=>C)||r?.entries?.find(({entryPosition:C})=>C));if(t&&!w&&b({flight:v,drawDefinition:r}),v||r){let C=I({flight:v,drawDefinition:r});if(C.error)return ce({result:C,stack:p})}let T=d?.drawDefinitions?.map(({drawId:C})=>C)??[],S=g?.flights?.filter(C=>!T.includes(C.drawId))||[];for(let C of S){let E=C&&I({flight:C});if(E?.error)return ce({result:E,stack:p})}let D=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!v&&!r&&a&&ese.includes(a))return{error:$re};if(!v&&!r||a===Nh||l&&D){let C=y(d?.entries);if(C?.error)return ce({result:C,stack:p});let E;if(a===Nh&&(g?.flights?.every(P=>{let R=y(P.drawEntries);return R.error?(E=R.error,!1):(P.drawEntries=P.drawEntries.filter(({participantId:M})=>!n.includes(M)),!0)}),d?.drawDefinitions?.every(P=>{let R=y(P.entries);return R.error?(E=R.error,!1):(P.entries=P.entries?.filter(({participantId:M})=>!n.includes(M)),!0)})),E)return ce({result:{error:E},stack:p})}t&&b({flight:v,drawDefinition:r});for(let C of d?.drawDefinitions??[])h.length&&!h.includes(C.drawId)||Pr({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:C});return{...se}}function dh({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:BI};if(!ji(e))return{error:be};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[Jv,n,a,s].join("."),l=i.timeItems.filter(c=>c?.itemType===o).filter(c=>!t||c?.itemDate).sort((c,u)=>(c.createdAt?new Date(c.createdAt).getTime():0)-(u.createdAt?new Date(u.createdAt).getTime():0)).pop();if(l){let[c,u,d,p]=l.itemType?.split(".")??[];if(c!==Jv)return{error:iI};let h=(r&&_b({element:l.itemValue,accessor:r}))?.value||l.itemValue,f={eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:u};return{...se,scaleItem:f}}}return{...se,scaleItem:void 0}}function jMe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=u=>[Jv,ch,n.eventType,u].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:u})=>u.split(".")[1]===ch).map(({itemType:u,itemValue:d})=>({[u]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),c=Un(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||c.length)&&c.length){if(t?.stageSeedingScaleNames){let u=Object.keys(t.stageSeedingScaleNames).map(p=>{let h=s(t.stageSeedingScaleNames[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else if(c){let u=c.map(d=>o[d]);a.seedValue=u.pop()}}else if(!e&&typeof i=="object"){let u=Object.keys(i).map(p=>{let h=s(i[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else{let{categoryName:u,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,u].filter(Boolean),h;for(let f of p){let m={eventType:n.eventType,scaleType:ch,scaleName:f},g=dh({scaleAttributes:m,participant:r});if(g.scaleItem){h=g.scaleItem;break}}if(h&&(!e||t?.published&&!t?.published?.drawIds?.length)){let f=h.scaleValue;a.seedValue=f}}return a}function GMe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d?.length&&t?Object.assign({},..._H(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Lt(h,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function B1(t){let e=jt(t,[{[da]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=fc}=t,n=`${$g}.${Vg}`;return Tt(pO({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function HMe(t){let{tournamentId:e}=t??{};return!!e}function Zc({event:t,status:e=fc}){let i=`${$g}.${Vg}`;return T1({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function Fz({drawDetails:t,drawId:e}){return t?.[e]?.publishingDetail?.published}function iw(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!HMe(e))return{error:be};if(n&&!o)return{error:Lc};if(Array.isArray(r)&&r?.length){let d={};for(let p of r){if(!jr(p))return{error:be};let h=_o({tournamentRecord:e,eventId:p})?.event;if(!h)return{error:Lc};let f=k2({event:h});d[p]=f}return{...se,publishState:d}}if(o){let d=k2({event:o}),p={};if(s)return i?{publishState:{status:{published:!!d.status.publishedDrawIds?.includes(s),drawDetail:d.status.drawDetails?.[s]},...se}}:{error:nc};if(Array.isArray(a)&&a?.length){let h=o.drawDefinitions?.map($P)??[];for(let f of a){if(!jr(f))return{error:be};if(!h.includes(f))return{error:nc};p[f]={status:{published:!!d.status.publishedDrawIds.includes(f),drawDetail:d.status.drawDetails?.[f]}}}}else p=d;return{...se,publishState:p}}let l=[],c=!1,u={};for(let d of e?.events??[]){let p=k2({event:d});u[d.eventId]=p,p.status.published&&(l.push(d.eventId),c=!0);for(let{drawId:h}of d.drawDefinitions??[]){let f=p.status?.publishedDrawIds?.includes(h);f&&(u[h]={status:{published:f}})}}if(e){let d=B1({tournamentRecord:e});u.tournament=d??{},(d?.orderOfPlay?.published||d?.participants?.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...se,publishState:u}}function k2({event:t}){let e=Zc({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map($P)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>Fz({drawDetails:r,drawId:o})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function Mse(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r==="BYE"||e[i].scheduleItems.push({...u,scheduledDate:Ti(u?.scheduledDate),scheduledTime:Gr(u?.scheduledTime),checkScoreHasValue:sa({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function zMe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=r?m:g;r&&(f.winCount+=1,n===xr&&(f.walkoverWinCount+=1),n===yr&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=r))}function EY(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:w,collectionId:T,matchUpType:S,winningSide:D,matchUpId:C,schedule:E,eventId:P,drawId:R,sides:M}=t,A=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:N},k)=>{let x=M[1-k].participantId;return N&&{[N]:x}}).filter(Boolean));for(let N of M){let{participantId:k,sideNumber:x,bye:O}=N;if(O)continue;let V=D===x,F=W=>{let z=n[W]?.participant,H=z?.participantType,Z=[{participantId:W,participantType:H}];if(H!==Co)for(let J of z?.individualParticipantIds||[]){let ie=n[J]?.participant;Z.push({participantType:ie?.participantType,participantId:J})}return Z},j=(W,z)=>{if(s){if(n[W].matchUps[C]={participantWon:V,matchUpType:S,structureId:f,sideNumber:x,matchUpId:C,eventId:P,drawId:R,stage:g},a){let H=F(z);n[W].matchUps[C].opponentParticipantInfo=H}T&&(n[W].matchUps[C].collectionId=T)}a&&z&&(n[W].opponents[z]={participantId:z,matchUpId:C,eventId:P,drawId:R}),v&&zMe({finishingPositionRange:c,participantMap:n,participantWon:V,finishingRound:u,matchUpStatus:d,participantId:W,stageSequence:p,roundNumber:h,structureId:f,matchUpId:C,drawId:R,stage:g}),(i||e)&&Mse({participantMap:n,participantId:W,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:h,structureId:f,matchUpId:C,schedule:E,drawId:R,score:m})},q=({participant:W,partnerParticipantId:z})=>{let H=(Z,J)=>{Z&&(Z.partnerParticipantIds||(Z.partnerParticipantIds=[]),Z.partnerParticipantIds.includes(J)||Z.partnerParticipantIds.push(J))};l&&H(W?.draws?.[R],z),o&&H(W?.events?.[P],z),s&&H(W?.matchUps?.[C],z)};if(k&&n[k]){let W=A?.[x];j(k,W);let z=n[k]?.participant.participantType===Di,H=n[k]?.participant.individualParticipantIds||[];if(I){if(r){let Z=J=>n[J].matchUps[I]={participantWon:y===x,matchUpId:I,matchUpType:_r,sideNumber:x};Z(k),H.forEach(Z)}if(l&&!n[k].draws[R]){let Z=w.find(K=>K.sideNumber===x)?.participant?.participantId,J=n[Z]?.draws?.[R]?.entryStatus,ie=K=>n[K].draws[R]={entryStatus:J,eventId:P,drawId:R};ie(k),H.forEach(ie)}}if(z&&(H.forEach(Z=>n[Z]&&j(Z,W)),H.forEach((Z,J)=>{let ie=H[1-J],K=n[Z];K&&q({participant:K,partnerParticipantId:ie})}),o&&w)){let Z=w.find(J=>J.sideNumber===x)?.participant?.participantId;if(Z){let J=n[Z]?.events[P];J?(n[k].events[P]={...J},H.forEach(ie=>n[ie].events[P]={...J})):console.log("Missing teamEntry",{eventId:P,teamParticipantId:Z})}}if(D){let Z=J=>{V?(n[J].counters[S].wins+=1,n[J].counters.wins+=1,d===xr&&(n[J].counters[S].walkoverWins+=1,n[J].counters.walkoverWins+=1),d===yr&&(n[J].counters[S].defaultWins+=1,n[J].counters.defaultWins+=1)):(n[J].counters[S].losses+=1,n[J].counters.losses+=1,d===xr&&(n[J].counters[S].walkovers+=1,n[J].counters.walkovers+=1),d===yr&&(n[J].counters[S].defaults+=1,n[J].counters.defaults+=1))};Z(k),H.forEach(Z)}}}}function SO(t,e){return(t||"").localeCompare(e||"")}function qMe(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:c,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,withOpponents:g,withMatchUps:v,withSeeding:y,withEvents:b,withDraws:I}=t,w=e?.participantIds,T=N=>{let k=[N];return l[N]?.participant.individualParticipantIds?.forEach(x=>k.push(x)),k.some(x=>!w?.length||w.includes(x))?k:[]},S={withMatchUps:v||d,withEvents:b||d,withDraws:I||d,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:y},D=[],C={},E=[],P={},R={},M={},A=({eventType:N,scaleNames:k,participantId:x})=>l[x]?.participant?.rankings?.[N]?.find(O=>k.includes(O.scaleName))?.scaleValue;for(let N of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(N.eventId))continue;let{drawDefinitions:k=[],extensions:x=[],eventType:O,eventName:V,category:F,entries:j,eventId:q,gender:W}=N,{flightProfile:z}=Cn({event:N}),H=z?.flights??[],Z=iw({event:N}).publishState;Z&&(P[q]=Z);let J=Z?.status?.publishedSeeding;if(b||y||d){let K=i?Object.assign({},..._H(x??[])):{};R[q]={...K,eventName:V,eventType:O,category:F,eventId:q,gender:W};let ne=[F?.categoryName,F?.ageCategoryCode].filter(Boolean);for(let le of j){let{participantId:re}=le;if(!re||!l[re])continue;let me=A({eventType:O,scaleNames:ne,participantId:re}),he,Ie;if(y){let ot=l[re].participant;({seedAssignments:he,seedValue:Ie}=jMe({publishedSeeding:J,usePublishState:a,withSeeding:y,participant:ot,event:N}))}let Le=ot=>{if(l[ot]?.events?.[q])return;let at=l[ot];GMe({convertExtensions:i,seedAssignments:he,participant:at,withSeeding:y,seedValue:Ie,eventId:q,ranking:me,entry:le})};Le(re),(l[re].participant.individualParticipantIds||[]).forEach(Le)}}let ie=P?.[q]?.publishedSeeding;if(I||d||y){let K=le=>le?Object.assign({},...le.map(({participantId:re,seedValue:me,seedNumber:he})=>({[re]:{seedValue:me,seedNumber:he}}))):void 0,ne=vi([...k.map($P),...H.map($P)]);for(let le of ne){let re=k.find(ve=>ve.drawId===le),me=[F?.categoryName,F?.ageCategoryCode].filter(Boolean),{structures:he=[],drawOrder:Ie,drawName:Le,drawType:ot}=re??{},at=H?.find(ve=>ve.drawId===le),dt=re?.entries||at?.drawEntries,It=at?.flightNumber,ze=(re?.structures||[]).sort((ve,$e)=>WI(ve,$e)).map(({structureId:ve,structures:$e})=>[ve,...($e||[]).map(({structureId:De})=>De)]).flat(1/0),Ct,ke,mt,Be,ut=0,it=he.filter(({stage:ve,stageSequence:$e})=>ve===Ut&&$e===1||ve===Ht).flatMap(ve=>{let{positionAssignments:$e}=Sr({structure:ve}),{seedAssignments:De,stageSequence:je,stage:Oe}=ve;return Oe===Ut?(ut=$e?.length??0,mt=$e,Be=De):je===1&&(Ct=$e,ke=De),$e}).map(({participantId:ve})=>ve).filter(Boolean),xe=K(Be),Ze=K(ke),st=re?dt.filter(({participantId:ve})=>it.includes(ve)):dt,qe=!a||ie?.published&&(ie?.drawIds?.length===0||ie?.drawIds?.includes(le));for(let ve of st){if(!l[ve.participantId])continue;let{entryStatus:$e,entryStage:De,entryPosition:je,participantId:Oe}=ve,nt=A({participantId:Oe,scaleNames:me,eventType:O}),Fe=wt=>{if(!l[wt]||l[wt].draws?.[le])return;let pt=y&&qe,Mt=pt?{}:void 0,Wi=pt?xe?.[Oe]?.seedValue||xe?.[Oe]?.seedNumber:void 0,Qt=Wi?xe?.[Oe]:void 0,tr=pt?Ze?.[Oe]?.seedValue||Ze?.[Oe]?.seedNumber:void 0,Vi=tr?Ze?.[Oe]:void 0;Mt&&Wi&&(Mt[Ut]=Qt),Mt&&tr&&(Mt[Ht]=Vi);let $i=Wi||tr;$i&&(l[wt].participant.seedings[O]||(l[wt].participant.seedings[O]=[]),Qt&&l[wt].participant.seedings[O].push({...Qt,scaleName:le}),Vi&&l[wt].participant.seedings[O].push({...Vi,scaleName:le}),Mt&&(l[wt].events[q].seedAssignments||(l[wt].events[q].seedAssignments={}),Object.keys(Mt).forEach(Wr=>l[wt].events[q].seedAssignments[Wr]=Mt[Wr]))),(I||d)&&(l[wt].draws[le]=Lt({seedAssignments:Mt,entryPosition:je,entryStatus:$e,entryStage:De,seedValue:$i,eventId:q,ranking:nt,drawId:le},!1,!1,!0))};[Yc,_y].includes($e)||(Fe(Oe),(l[Oe].participant.individualParticipantIds||[])?.forEach(Fe))}let ft=(re?.structures??[]).reduce((ve,$e)=>(ve.includes($e.stage)||ve.push($e.stage),ve),[]),_t=(re?.links??[]).length;M[le]={qualifyingPositionAssignments:Ct,qualifyingSeedAssignments:ke,mainPositionAssignments:mt,qualifyingSeedingMap:Ze,mainSeedAssignments:Be,orderedStructureIds:ze,mainSeedingMap:xe,flightNumber:It,linksCount:_t,drawOrder:Ie,drawName:Le,drawType:ot,drawSize:ut,drawId:le,stages:ft}}}if(d||h||f||m||g||v||I){let K=!!h||u,ne=Jh({afterRecoveryTimes:!!h,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:c,nextMatchUps:K,event:N})?.matchUps??[];for(let le of ne){let{finishingPositionRange:re,potentialParticipants:me,tieMatchUps:he=[],sides:Ie=[],winningSide:Le,matchUpType:ot,matchUpId:at,eventId:dt,drawId:It,collectionId:ze,stageSequence:Ct,finishingRound:ke,matchUpStatus:mt,roundPosition:Be,roundNumber:ut,structureId:it,schedule:xe,score:Ze,stage:st}=le;C[at]=le;let qe={finishingPositionRange:re,finishingRound:ke,stageSequence:Ct,roundPosition:Be,collectionId:ze,roundNumber:ut,structureId:it,schedule:xe,eventId:dt,drawId:It,score:Ze,stage:st};EY({...qe,...S,matchUpStatus:mt,winningSide:Le,matchUpType:ot,matchUpId:at,sides:Ie});for(let ft of he){let{winningSide:_t,sides:ve=[],matchUpId:$e,matchUpStatus:De,matchUpType:je}=ft;EY({...qe,...S,winningSide:_t,tieWinningSide:Le,matchUpTieId:at,matchUpId:$e,sides:ve,matchUpSides:Ie,matchUpStatus:De,matchUpType:je})}Array.isArray(me)&&(K||h||p)&&me.flat().map(xi).filter(Boolean)?.forEach(ft=>{T(ft)?.forEach(_t=>{l[_t]&&(l[_t].potentialMatchUps[at]=Lt({tournamentId:n?.tournamentId,matchUpId:at,eventId:dt,drawId:It}))}),(h||p)&&Mse({potential:!0,participantMap:l,participantId:ft,matchUpStatus:mt,roundPosition:Be,structureId:it,matchUpType:ot,roundNumber:ut,matchUpId:at,schedule:xe,drawId:It,score:Ze})})}E.push(...ne)}}if(m||d||h){let N=Object.values(l);for(let k of N){let{wins:x,losses:O,[Ir]:{wins:V,losses:F},[fr]:{wins:j,losses:q}}=k.counters,W=(z,H,Z)=>{let J=H+Z,ie=H,K=J&&ie/J;k.statistics[z]={denominator:J,numerator:ie,statValue:K,statCode:z}};if(m&&(W(hN,x,O),W(`${hN}.${Ir}`,V,F),W(`${hN}.${fr}`,j,q)),d){let z=(H=[])=>Math.abs(H[0]-H[1]);for(let H of Object.keys(k.draws)){let{orderedStructureIds:Z=[],flightNumber:J}=M[H]||{};if(k.structureParticipation&&Z.length){let ie,K=0,ne=Z.map(le=>{let re=k.structureParticipation[le];if(!re)return;ie||(ie=re?.finishingPositionRange),z(ie)>z(re?.finishingPositionRange)&&(ie=re?.finishingPositionRange);let me=re.stage!==Ht;return me&&(K+=1),Lt({...re,participationOrder:me?K:void 0,flightNumber:J})}).filter(Boolean);k.draws[H]&&(k.draws[H].finishingPositionRange=ie,k.draws[H].structureParticipation=ne)}}}if(h){let z=ji(h)?h.scheduledMinutesDifference:0,H=k.scheduleItems||[],Z=k.potentialMatchUps||{},J=H.reduce((K,ne)=>{let{scheduledDate:le,scheduledTime:re}=ne;return K[le]||(K[le]=[]),re&&K[le].push(ne),K},{});Object.values(J).forEach(K=>K.sort(Tne));for(let K of H){let{typeChangeTimeAfterRecovery:ne,timeAfterRecovery:le,scheduledDate:re,scheduledTime:me}=K,he=J[re],Ie=Xi(me);for(let Le of he){if(Le.matchUpId===K.matchUpId||As(Le.matchUpStatus)&&!Le.checkScoreHasValue)continue;let ot=K.matchUpType!==Le.matchUpType&&ne||le,at=K.drawId===Le.drawId,dt=Z[K.matchUpId]&&Z[Le.matchUpId],It=Xi(Le.scheduledTime),ze=Math.abs(It-Ie),Ct=It>=Ie;if((z&&!isNaN(z)?ze<=z:Ct&&Xi(Le.scheduledTime)<Xi(ot))&&!(dt&&at)&&Ct){let ke=[K.matchUpId,Le.matchUpId].sort(SO).join("|");k.scheduleConflicts[ke]={priorScheduledMatchUpId:K.matchUpId,matchUpIdWithConflict:Le.matchUpId}}}}let ie=k.participant.participantId;Object.keys(k.scheduleConflicts).length&&D.push(ie),l[ie].scheduleConflicts=k.scheduleConflicts}}}return{participantIdsWithConflicts:D,eventsPublishStatuses:P,derivedEventInfo:R,derivedDrawInfo:M,mappedMatchUps:C,participantMap:l,matchUps:E}}function $1({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=zp(h)&&e?.events?.filter(I=>h?.includes(I.eventId))||e?.events||[],g=n&&WMe({drawEntryStatuses:n,tournamentEvents:m}),v=s&&YMe({eventEntryStatuses:s,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((I,w)=>I.concat(...(w.drawDefinitions||[]).map(T=>Lae({drawDefinition:T}).allPositionedParticipantIds).filter(Boolean)),[]),b=I=>r?.reduce((w,T)=>{let{accessor:S,value:D}=T,{values:C}=_b({element:I,accessor:S});return w&&C?.includes(D)},!0);if(i=i?.filter(I=>{let w=Wc({element:I,itemType:S1})?.timeItem?.itemValue,{participantRoleResponsibilities:T,participantType:S,participantRole:D,participantId:C,person:E}=I,P=Array.isArray(f)&&f?.length&&E?.sex&&f.includes(E.sex);return p?f&&P||a&&y.includes(C)||a===!1&&!y.includes(C)||g?.includes(C)||v?.includes(C)||u?.includes(C)||d&&w===d||c&&S&&zp(c)&&c.includes(S)||o&&D&&zp(o)&&o.includes(D)||l&&zp(T)&&zp(l)&&l.find(R=>T?.includes(R))||r?.length&&zp(r)&&b(I):(!f||P)&&(a===void 0||a&&y.includes(C)||a===!1&&!y.includes(C))&&(!g||g.includes(C))&&(!v||v.includes(C))&&(!u||u.includes(C))&&(!d||w===d)&&(!c||S&&zp(c)&&c.includes(S))&&(!o||D&&zp(o)&&o.includes(D))&&(!l||zp(T)&&zp(l)&&l.find(R=>T?.includes(R)))&&(!r?.length||zp(r)&&b(I))}),m.length&&h){let I=m.filter(w=>h.includes(w.eventId)).map(w=>{let T=(w.entries||[]).map(D=>D.participantId);if(kn(mp)(w.eventType))return T;let S=(e?.participants??[]).filter(D=>T.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return T.concat(...S)}).flat(1);i=i?.filter(w=>I.includes(w.participantId))}return i}function zp(t){return t&&Array.isArray(t)&&t.length}function WMe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return vi(e.reduce((r,n)=>{let{flightProfile:a}=Cn({event:n}),s=a?.flights?.map(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(xi):[]).flat()||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(xi):[])||[];return r.concat(...s,...o)},[]))}function YMe({eventEntryStatuses:t,tournamentEvents:e}){return vi(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(xi);return i.concat(...n)},[]))}function cn(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,contextProfile:v,withOpponents:y,withMatchUps:b,internalUse:I,withSeeding:w,withEvents:T,withDraws:S,withISO2:D,withIOC:C}=t;if(!l)return{error:Qe};(b||n)&&Qu({tournamentRecord:l});let E=Jae({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:I,withISO2:D,withIOC:C}),{participantMap:P}=E,R=qMe({withMatchUps:b??n,withEvents:T??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,participantMap:P,withOpponents:y,contextProfile:v,withSeeding:w}),{participantIdsWithConflicts:M,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,mappedMatchUps:x}=R,O=R.matchUps;P=R.participantMap;let V=c??r,F=({potentialMatchUps:Z,scheduleConflicts:J,scheduleItems:ie,participant:K,statistics:ne,opponents:le,matchUps:re,events:me,draws:he})=>{let Ie=Object.values(he),Le=Object.values(le);return y&&Ie?.forEach(ot=>{ot.opponents=Le.filter(at=>at.drawId===ot.drawId)}),Lt({...K,scheduleConflicts:c?Object.values(J):void 0,draws:S||n?Ie:void 0,events:T||n?Object.values(me):void 0,matchUps:b||n?Object.values(re):void 0,opponents:y?Le:void 0,potentialMatchUps:V?Object.values(Z):void 0,statistics:f?Object.values(ne):void 0,scheduleItems:o?ie:void 0},!1,!1,!0)},j=new Map;for(let Z of Object.keys(P))j.set(Z,F(P[Z]));let q=[...j.values()],W=s?.[jU]?.participant,z=$1({participants:q,participantFilters:i,tournamentRecord:l});if(e){let Z=ji(e)?e:void 0;for(let J of z)for(let ie of J.individualParticipantIds??[]){J.individualParticipants||(J.individualParticipants=[]);let K=j.get(ie),ne=Z?sI({template:Z,source:K}):K;J.individualParticipants.push(ne)}}let H=W?z.map(Z=>sI({source:Z,template:W})):z;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?x:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,participants:H,...se}}function kb({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:Nt};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function YU(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:Nt};let{entryProfile:s}=D1({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:c}=si({drawDefinition:i,structureId:n}),u=i.links?.filter(h=>h?.target?.structureId===c?.structureId),d=0;if(u?.length)for(let h of u){let f=si({structureId:h.source.structureId,drawDefinition:i})?.structure;if(f?.stage===Ht){let m=h.source.roundNumber,g=h.target.roundNumber,v=0;if(f.structureType===wo){let y=f.structures?.length??0,b=h.source.finishingPositions?.length??0;v=y*b}else v=rr({matchUpFilters:{roundNumbers:[m]},structure:f,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps?.length||0;l[g]||(l[g]=0),l[g]+=v,d+=v}}let p=Object.keys(l);if(p.length<=1){let h=p[0]||1;l[h]=Math.max(l[h]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function DA({stage:t,drawDefinition:e}){let{entryProfile:i}=D1({drawDefinition:e});return i?.[t]?.drawSize||0}function KMe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=DA({stage:n,drawDefinition:i}),{qualifiersCount:s}=YU({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function Nse({stage:t,drawDefinition:e}){return!!(t===La||Pz({stage:t,drawDefinition:e})&&DA({stage:t,drawDefinition:e}))}function Ase({entryStatus:t=nl,drawDefinition:e,stageSequence:i,stage:r}){if(t===Cu)return H0e({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...se}:{error:Bre};let n=KMe({drawDefinition:e,stageSequence:i,stage:r}),a=z0e({drawDefinition:e,stage:r}),s=aV({entryStatus:RT,drawDefinition:e,stage:r}),o=aV({entryStatus:nl,drawDefinition:e,stage:r}),l=s+o,c=l>=n,u=n-l;return r!==La&&c?{error:Z$}:t===RT?s<a?{...se}:{error:Z$}:{positionsAvailable:u,...se}}function Bz(t){let e=jt(t,[{[$s]:!0,[bae]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=nl,entryStageSequence:n,entryStage:a=Ut,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==Pl&&!Nse({stage:a,drawDefinition:o}))return ce({result:{error:Ey},stack:m});let g=Ase({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!h||h!==Pl))return{error:g.error};if(p&&!vp({extension:p}))return ce({result:{error:be},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||c?.participantId;if(!v)return ce({result:{error:na},stack:m});let y=r===Wf&&kb({participantId:v,drawDefinition:o,entryStatus:r}),b=a===La&&kb({participantId:v,drawDefinition:o,entryStage:a}),I=kb({participantId:v,drawDefinition:o}),w=r!==Wf&&a!==La&&I;if(w)return i?(bi({payload:{drawId:o.drawId,eventId:f?.eventId,error:UP,participantId:v},topic:cz}),{...se}):ce({result:{error:UP},context:{participantId:v},stack:m});if(y||b)return ce({context:{invalidEntry:w,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:Ak},stack:m});let T=Lt({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&ir({element:T,extension:p}),u&&ir({extension:{name:"roundEntry",value:u},element:T}),o.entries||(o.entries=[]),o.entries.push(T),Pr({drawDefinition:o}),{...se}}function ZMe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=nl,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Ut,roundTarget:u,extension:d,event:p}=t,h=o.drawType===Pl;if(!c)return{error:gre};if(!o)return{error:Nt};if(!Array.isArray(s))return{error:bl};if(!h&&!Nse({stage:c,drawDefinition:o}))return{error:Ey};if(d&&!vp({extension:d}))return ce({result:{error:be},info:"Invalid extension",context:{extension:d},stack:e});let f=Ase({drawDefinition:o,stageSequence:l,entryStatus:r,stage:c});if(!a&&!f.success&&!h)return{error:f.error};let m=f.positionsAvailable??0;if(!a&&!h&&c!==La&&m<s.length)return{error:uH};let g=[],v=o.drawId,y=p?.eventId,b=s.reduce((I,w)=>{let T=r===Wf&&kb({participantId:w,drawDefinition:o,entryStatus:r}),S=c===La&&kb({entryStage:c,drawDefinition:o,participantId:w}),D=kb({participantId:w,drawDefinition:o});return r!==Wf&&c!==La&&D&&(g.push(w),i&&bi({payload:{error:UP,participantId:w,eventId:y,drawId:v},topic:cz})),T||S?I.concat(w):I},[]);return g.length&&!i?ce({context:{eventId:y,drawId:v,duplicateEntries:g},result:{error:UP},stack:e}):(s.filter(I=>I&&!b.includes(I)).forEach(I=>{let w={entryStageSequence:l,entryStage:c,participantId:I,entryStatus:r};d&&ir({element:w,extension:d}),u&&ir({extension:{name:Op,value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w)}),n&&(o.entries=yd({entries:o.entries})),Pr({drawDefinition:o}),b?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:b,duplicateEntries:g,...se}:{...se})}function $z({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!n?.length)return{error:_g};if(!d)return{error:Lc};if(!u)return{error:Md};let p=(d.entries||[]).map(xi);if(n.filter(m=>!p.includes(m)).length)return{error:fre};if(a){let m=ZMe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:h}=Cn({event:d}),f=h?.flights.find(m=>m.drawId===u);return f?.drawEntries&&(n.forEach(m=>{let g=s===Wf&&O2({participantId:m,entryStatus:s,flight:f}),v=l===La&&O2({participantId:m,entryStage:l,flight:f});!(s!==Wf&&l!==La&&O2({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=yd({entries:f.drawEntries}))),{...se}}function O2({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function V1({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:Or};if(!Array.isArray(e)||e.some(d=>!jr(d)))return ce({result:{error:Sd},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>xy({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(xi).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(xi).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=Un(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return ce({result:{error:kU},stack:a});if(!e?.length)return{...se,participantIdsRemoved:[]};let c=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||c.push(d.participantId),p}),t&&(n.entries=yd({entries:n.entries}));let{flightProfile:u}=Cn({event:n});return u?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...se,participantIdsRemoved:c}}var _se={[Fa]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},KU=_se;function rp(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=nl,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:s,entryStage:o=Ut,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ce({result:{error:bl},stack:g});let v=vi(t.participantIds??[]);if(!m)return{error:Or};if(!v?.length)return ce({result:{error:_g},stack:g});if(!m?.eventId)return{error:Lc};let y=Qi({tournamentRecord:l,event:m}).appliedPolicies??{},b=s?.[Fa]??y?.[Fa]??KU[Fa],I=(n??b?.participants?.enforceGender)!==!1,w=[],T=[];if(p&&(!Array.isArray(p)||!p.every(N=>vp({extension:N})))||h&&!vp({extension:h}))return ce({context:Lt({extension:h,extensions:p}),result:{error:be},info:"Invalid extension(s)",stack:g});let S=!!l,D=[],C,E=l?.participants?.filter(N=>{if(!v.includes(N.participantId))return!1;let k=kn(Ir)(m.eventType)&&N.participantType===Li&&!Sv(i),x=m.eventType===fr&&N.participantType===Di;return k&&(!m.gender||!I||ec(m.gender)||lh(m.gender)||Ms(m.gender)===Ms(N.person?.sex))||x&&!Sv(i)?!0:m.eventType===fr&&N.participantType===Li&&Sv(i)?m.gender&&I&&!(ec(m.gender)||lh(m.gender))&&Ms(m.gender)!==Ms(N.person?.sex)?(D.push({participantId:N.participantId,sex:N.person?.sex}),!1):!0:k&&m.gender&&I&&!(ec(m.gender)||lh(m.gender))&&Ms(m.gender)!==Ms(N.person?.sex)?(D.push({participantId:N.participantId,sex:N.person?.sex}),!1):m.eventType===pr&&(N.participantType===pr||Sv(i)&&N.participantType===Li)}).map(N=>N.participantId)??[],P=v.filter(N=>!S||E.includes(N));m.entries||(m.entries=[]);let R=m.entries.map(N=>N.participantId||N.participant?.participantId);if(P.forEach(N=>{if(!R.includes(N)){let k=Lt({participantId:N,entryStatus:i,entryStage:o,extensions:p});h&&ir({element:k,extension:h}),d&&ir({extension:{name:Op,value:d},element:k}),a&&(k.entryStageSequence=a),w.push(k.participantId),m.entries?.push(k)}}),f&&!Sv(o)){let N=$z({participantIds:P,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:i,roundTarget:d,entryStage:o,extension:h,drawId:f,event:m});N.error&&(C=N.error)}if(m.eventType&&[jf,El].includes(m.eventType)){let N=(m.entries||[]).map(V=>V.participantId),k=(m.entries||[]).filter(V=>Sv(V.entryStatus)).map(V=>V.participantId),x=(l?.participants??[]).filter(V=>N.includes(V.participantId)&&V.participantType&&[Di,pr].includes(V.participantType)).map(V=>V.individualParticipantIds).flat(1/0),O=k.filter(V=>x.includes(V));O.length&&(T.push(...O),V1({participantIds:O,autoEntryPositions:!1,event:m}))}if(P.length!==v.length)return ce({context:{mismatchedGender:D,gender:m.gender},result:{error:bl},stack:g});r&&(m.entries=yd({entries:m.entries||[]}));let M=w.length,A=T.length;return ce({result:{...se,addedEntriesCount:M,removedEntriesCount:A},stack:g,info:C})}var kse="ADMINISTRATION",XMe="CAPTAIN",JMe="COACH",ms="COMPETITOR",Ose="MEDIA",xse="MEDICAL",Vz="OFFICIAL",Lse="OTHER",Fse="SECURITY",jg={ADMINISTRATION:kse,CAPTAIN:XMe,COACH:JMe,COMPETITOR:ms,MEDIA:Ose,MEDICAL:xse,OFFICIAL:Vz,OTHER:Lse,SECURITY:Fse};function jz({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ce({result:{error:Qe},stack:a});if(!i||!e)return ce({result:{error:Wt},stack:a});let s=(r.participants??[]).find(u=>u.participantId===i);if(!s)return ce({result:{error:An},stack:a});if(![pr,hc].includes(s.participantType))return ce({result:{participantType:s.participantType,error:Td},stack:a});let o=Bse({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=o;if(c)return ce({result:o,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(h=>!d.includes(h));rp({participantIds:p,entryStatus:Yc,tournamentRecord:r,event:u})}}return l&&bi({topic:Is,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...se,...o}}function Bse({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=cn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),u=(e.individualParticipantIds??[]).filter(p=>{let h=t?.includes(p),f=h&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>c.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:v})=>g||sa({score:v})),m=h&&!f?.length;if(h&&!m&&l.push(p),m){s.push(p);for(let g of i.events??[])for(let v of g.drawDefinitions??[]){let{extension:y}=Pi({element:v,name:Hf}),b=y?.value[e.participantId];y&&b&&(y.value[e.participantId]=b.filter(w=>w.participantId!==p),ir({element:v,extension:y}),w1({drawDefinition:v}));let I=lo({drawDefinition:v,inContext:!1}).matchUps??[];for(let w of I){let T=w.sides??[];for(let S of T){let D=S.lineUp??[];D.find(C=>C.participantId===p)&&(S.lineUp=D.filter(C=>C.participantId!==p),Gi({tournamentId:i?.tournamentId,drawDefinition:v,matchUp:w}))}}}}else o.push(p);return!m});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:Mk}||d}function TO({participantRole:t=ms,individualParticipantIds:e=[],groupingTypes:i=[Co,hc],tournamentRecord:r}){if(!r)return{error:Qe};let n=r.participants??[],{participants:a,mappedMatchUps:s}=cn({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=Bse({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});c&&o++}),o?se:{error:kre}}function rw(t){let e=jt(t,[{[da]:!0},{participantIds:!0,[Fo]:Cs,[Pu]:_g}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...se};let s=(r.events||[])?.filter(({eventType:f})=>f===Qn).map(f=>f?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=cn({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=f=>{let m=(Ha({matchUpFilters:{drawIds:f,matchUpTypes:[fr]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:v})=>v||[])).filter(Boolean);return Un(m,n)},c=s?.length?l(s):[],u=o.filter(f=>f.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(c?.length||u.length)return{error:kU};let d={},p={};for(let f of r.events||[]){let m=V1({participantIds:n,event:f});if(m.error)return m;d[f.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(f=>{let m=n.includes(f.participantId)||f.participantType===Di&&f.individualParticipantIds?.some(g=>n.includes(g));if(!m&&f.participantType===Qn&&f.individualParticipantIds?.some(g=>n.includes(g))&&(f.individualParticipantIds=f.individualParticipantIds.filter(g=>!n.includes(g))),m&&i&&f.participantType&&[Di,pr].includes(f.participantType))for(let g of f.individualParticipantIds||[])n.includes(g)||(p[f.participantId]||(p[f.participantId]=[]),p[f.participantId].push(g));return!m});let h=a-r.participants.length;if(TO({individualParticipantIds:n,tournamentRecord:r}),i)for(let f of r.events||[]){let m=d[f.eventId].map(g=>p[g]||[]).flat();rp({participantIds:m,entryStatus:Yc,tournamentRecord:r,event:f})}return h&&bi({payload:{participantIds:n,tournamentId:r.tournamentId},topic:uz}),h?{...se,participantsRemovedCount:h}:{error:Mk}}function $se({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Cn({event:n}),c=l?.flights?.find(u=>u.drawId===r);c?s=c.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&Xu.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function Vse({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:Qe};if(!r)return ce({result:{error:na},stack:o});if(!s)return{error:Or};if(!s.eventType||![jf,El].includes(s.eventType))return ce({result:{error:Th},stack:o});let l=e.participants??[],c=l.find(v=>v.participantId===r);if(!c)return ce({result:{error:An},stack:o});if(!c.participantType||![Di,Co].includes(c.participantType)||c.participantType===Co&&s.eventType!==El||c.participantType===Di&&s.eventType!==jf)return{error:Td};let u=(s.entries??[]).find(v=>v.participantId===r);if(!u)return{error:Fre};let{stageEntries:d}=$se({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(xi),h=l.filter(({participantId:v})=>p.includes(v)).map(({individualParticipantIds:v})=>v).flat().filter(Boolean),f=c.individualParticipantIds?.filter(v=>tp(v,h).length===1),m=V1({participantIds:[r],event:s});if(m.error||f?.length&&(m=rp({participantIds:f,entryStatus:Yc,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let g;return t&&rw({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...se,participantRemoved:g}}function Gz({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return Vse({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function jse(t){if(!t.tournamentRecord)return{error:Qe};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=Vse({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...se}:{error:n}}function zP(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=F1(t);if(c.error)return ce({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t,f=Qi({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Cu,Nh].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=Bg({tournamentRecord:g,participantId:u}),{participantType:y,individualParticipantIds:b}=v??{};if(n&&y===Di){let I=Gz({tournamentRecord:g,drawDefinition:r,participantId:u,event:p});if(I.error)return ce({result:I,stack:l});b&&UA({participantIds:b,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else UA({participantIds:[u],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=mc({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return ce({result:g,stack:l})}let{structure:m}=si({drawDefinition:r,structureId:h});return wz({structure:m,drawPositions:[d]}),cO({appliedPolicies:f,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function Gse(t){return Object.assign(t,{entryStatus:Nh}),zP(t)}var ig=({finishingPosition:t=zI,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:c,structureType:u,structureName:d,matchUps:p=[],matchUpType:h,structureId:f,roundOffset:m,roundLimit:g,stageOrder:v,structures:y,tieFormat:b,stage:I})=>{let w={structureId:f??or(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:c,stageSequence:a,structureName:d};(s||e&&b)&&(w.tieFormat=b),o&&(w.structureOrder=o),u&&(w.structureType=u),l&&(typeof l=="string"?w.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(w.seedingProfile=l.positioning)),h&&(w.matchUpType=h),m&&(w.roundOffset=m),v&&(w.stageOrder=v),g&&(w.roundLimit=g),I&&(w.stage=I),i&&(w.qualifyingRoundNumber=i);let T=p.flatMap(({drawPositions:S})=>S).filter(Boolean);return y?w.structures=y:(w.matchUps=p,w.positionAssignments=vi(T).sort((S,D)=>S-D).map(S=>({drawPosition:S}))),w},Ac=ig;function pV(t){return jr(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function gs(t){return jr(t)?pV(t.replace(/_/g," ")):""}function Hz({structureName:t=gs(La),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:Nt};let a=Ac({stage:La,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),Pr({drawDefinition:i,structureIds:[a.structureId]}),{...se}}function zz({drawPositions:t}){if(!t?.length)return{error:r1};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=vi(i.map(UO)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function UO(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(Jn).join("|")}function Hse({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return UO(h)}))}function QMe({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Wt}}var eNe={getRoundRobinGroupMatchUps:zz,determineRoundNumber:QMe,drawPositionsHash:UO,groupRounds:Hse};function j1(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:c=Ut,matchUpType:u,roundTarget:d,structureId:p,groupNames:h,tieFormat:f,drawSize:m,idPrefix:g,isMock:v,uuids:y}=t,b=t.structureName??r?.["0"]?.name??gs(Ut),{groupCount:I,groupSize:w}=tNe({structureOptions:a,appliedPolicies:s,drawSize:m}),T=Xv,S,D=vt(1,I+1).map(E=>{let P=iNe({groupSize:w,structureOrder:E,matchUpType:u,drawSize:m,idPrefix:g,isMock:v});S=Array.isArray(P)?Math.max(...P.map(({roundNumber:M})=>M??0)):0;let R=h?.[E-1]??`${i} ${E}`;return ig({structureId:y?.pop(),hasExistingDrawDefinition:e,structureType:zk,finishingPosition:T,qualifyingOnly:o,structureOrder:E,structureName:R,tieFormat:f,matchUps:P})}),C=ig({structureId:p??y?.pop(),hasExistingDrawDefinition:e,structureType:wo,finishingPosition:T,seedingProfile:l,structureName:b,stageSequence:n,structures:D,tieFormat:f,stage:c});return d&&ir({extension:{name:Op,value:d},element:C}),{structures:[C],maxRoundNumber:S,groupCount:I,links:[],groupSize:w,...se}}function tNe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=G1({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function G1(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=vt(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...se,validGroupSizes:r}}function iNe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=vt(1+o,i+1+o),c=zz({drawPositions:l}).uniqueMatchUpGroupings??[],u=Hse({groupSize:i,drawPositionOffset:o});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=UO(h),m=d(f),g=[1,r],v=rNe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:n,uuids:s}),y={matchUpStatus:m?Dn:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function rNe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||or()}function qz(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!fi(i))return{seedBlocks:void 0,...ce({result:{error:be},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=RU(i);if(e){let h=Math.min(e,n),f=[],m=1;for(vt(0,h).forEach(()=>{f.push([m]),m++});m<n;){let g=vt(m,m+h);m+=h,f.push(g)}return{...se,seedBlocks:f}}let a=vt(1,n+1),s=[],o=n/2;for(;o>1;){let h=Ca(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],w=m[m.length-1];r&&f>4?f===8?v=y?w:I:v=b?I:w:v=y?I:w,ho(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=vt(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return vt(0,u).forEach(h=>{p.push(s.slice(d,d+c[h])),d+=c[h]}),{...se,seedBlocks:p}}function Wz({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!fi(e))return{seedGroups:void 0,...ce({result:{error:be},context:{drawSize:e},stack:i})};if(t){if(!fi(t))return{seedGroups:void 0,...ce({context:{roundRobinGroupsCount:t},result:{error:be},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:vt(0,n).map(()=>{let a=vt(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=qz({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function Yz({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=G1({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return ce({context:{roundRobinGroupsCount:t},result:{error:be}})}let{seedGroups:i}=Wz({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...se,seedingThresholds:r}}function NT(t){if(!t)return 1/0;if(fi(t))return ii(t);let e=t.split("-")[0];return fi(e)?ii(e):1/0}function nNe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(Jn),e.reverse(),e}function aNe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function sNe({positioning:t,size:e}){let i=nNe({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[Hk,Kv].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!n.includes(f))){let f=o(p,h);return n.push(f),f}},c=p=>{let h=p.filter(f=>!n.includes(f));if(h.length)return n.push(...h),h},u=(p,h)=>{let f=o(p,h);if(!n.includes(f))return n.push(f),f},d=vt(1,e+1);for(let p of i)if(p===1){let h=Ca(d,2),f=h.map(l).filter(Boolean);f.length&&r.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&r.push(m)}else{let h=Ca(d,p).map(u).filter(Boolean);h.length&&r.push(h)}return{divisions:i,divisionGroupings:r}}function nw({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:Dy};let{matchUps:l,roundMatchUps:c}=rr({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:u}=$c({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=aa({structure:s}),p=d?.length,h=u?.length??0,f=[],m=Object.keys(c).map(k=>parseInt(k)).sort((k,x)=>k-x).map(k=>{let x=c[k].map(V=>V.drawPositions).flat(1/0).filter(Boolean),O=x.filter(V=>!f.includes(V));return f=f.concat(...x),O}).filter(k=>k.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let y=g?.length||0,b=m.filter(k=>k.filter(x=>x<=h).length),{stage:I,structureType:w,roundLimit:T}=s,S=w===wo,D=!S&&m?.length,C=!S&&I===Ht&&T,E=b.flat(1/0),P=D?E?.length:0,R=a?p:h,M=Cz({drawDefinition:n,structure:s,matchUps:l}),A=M?0:!D&&R||R&&E.length<R&&R-E.length||0;if(C){let k=s?.matchUps?s.matchUps.filter(({roundNumber:O})=>O===s.roundLimit).length:0,x=g.length/k;if(!D){let O=H1(r),V=Ca(g,x),F=1,j=vt(0,V[0].length).map(()=>{let q=vt(F,F+V.length);return F+=V.length,q});({validSeedBlocks:o}=zse({drawPositionBlocks:V,nonRandom:r?.nonRandom,positioning:O,seedGroups:j}))}}else S?{validSeedBlocks:o}=oNe({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):D?o=b.map(k=>({seedNumbers:k,drawPositions:k})):M&&Ca(g,2).map((k,x)=>({drawPositions:[k[0]],seedNumbers:[x+1]})).forEach(k=>o.push(k));if(!S&&!M&&!C){let{blocks:k}=lNe({drawPositionOffset:v,seedNumberOffset:P,seedCountGoal:A,seedingProfile:r,baseDrawSize:y});k.forEach(x=>o.push(x))}let N=o.flatMap(k=>k.drawPositions).reduce((k,x)=>g?.includes(x)&&k,!0);return!M&&!D&&!S&&!N?{error:ure,validSeedBlocks:[],isContainer:S,isFeedIn:D}:{isLuckyStructure:M,validSeedBlocks:o,isContainer:S,isFeedIn:D}}function oNe({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Sr({structure:e})?.positionAssignments,s=H1(t),o=a?.length??0,{seedGroups:l}=Wz({roundRobinGroupsCount:n,drawSize:o}),c=r.map(u=>Sr({structure:u}).positionAssignments?.map(d=>d.drawPosition));return zse({drawPositionBlocks:c,positioning:s,seedGroups:l,nonRandom:i})}function zse({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=sNe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=aNe({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Kv?h=r?h:so(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),n.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function lNe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:c}=qz({cluster:H1(n)===Hk,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of c){if(o+1>a)break;let p=d.map(f=>f+e),h=u(o+1,d.length).map(f=>+f+r);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function EA({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=si({drawDefinition:e,structureId:n});t||(t=Qi({drawDefinition:e}).appliedPolicies);let o=i?.validSeedBlocks;return!o&&s&&(o=nw({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):[].concat(...o.map(l=>l.drawPositions)).includes(r)}function qse(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=si({drawDefinition:i,structureId:a}),{seedAssignments:l}=$c({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:c}=aa({structure:o}),u=c?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=Qi({drawDefinition:i}),p=(n?.validSeedBlocks||o&&nw({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).filter(R=>R.drawPositions.filter(M=>!u?.includes(M)).length)[0],h=l?.map(R=>R.participantId).filter(Boolean),f=c?.map(R=>R.participantId).filter(Boolean),m=h?.filter(R=>f?.includes(R)),g=h?.filter(R=>!f?.includes(R)),v=l?.filter(R=>g?.includes(R.participantId)),y=l?.filter(R=>!R.participantId),b=(v?.length&&v.length>0?v.length:y?.length??0)&&p?.drawPositions.filter(R=>!u?.includes(R))||[],I=s?so(b):b,w=[],T=I.map(()=>{let R=P(v,w)?.participantId;return R&&w.push(R),R}).filter(Boolean),S=l?.filter(R=>m?.includes(R.participantId)).map(R=>R.seedNumber),D=(p?.seedNumbers||[]).filter(R=>!S?.includes(R)),C=l?.filter(R=>D.includes(R.seedNumber)).map(R=>R.participantId),E=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?T:C,unplacedSeedNumbers:D,unfilledPositions:I,unplacedSeedAssignments:v};function P(R,M){let A=R.filter(x=>!M.includes(x.participantId)),N=Math.min(...A.map(x=>NT(x.seedValue))),k=A.filter(x=>NT(x.seedValue)===N);return so(k).pop()}}function H1(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function ZU({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){let d="assignSeed",{structure:p}=si({drawDefinition:i,structureId:s}),{positionAssignments:h}=aa({structure:p}),f=$c({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(w=>w.seedNumber),g=kb({drawDefinition:i,participantId:n});if(n&&!g)return ce({result:{error:Sd},context:{participantId:n},stack:d});let v=u?Cn({event:u}).flightProfile?.flights?.length:0,y=v&&v>1,b=h?.find(w=>w.participantId===n)?.drawPosition;if(b&&!EA({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return ce({result:{error:ZG},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||f.push({seedNumber:o,seedValue:l});let I;return f.forEach(w=>{w.participantId===n&&w.seedNumber!==o&&(w.participantId=void 0),w.seedNumber===o&&(w.participantId=n,!r?.groupSeedingThreshold&&!y&&(w.seedValue=l??o),I=!0)}),I?(qae({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...se}):ce({result:{error:cre},stack:d})}function Kz({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:c}=Pi({element:n,name:Hf}),u=c?.value||{},d=Tt(u[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(h=>({...a.sides?.find(f=>f.sideNumber===h)??{},sideNumber:h}));let p=a.sides.find(h=>h.sideNumber===o);p&&(p.lineUp=d)}Gi({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function Wse(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=dg({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&f?.includes(a)));let l=e?.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===u),p=d?.matchUpStatus,h=[on,ia].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function cNe({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(Jn).filter(Boolean),positionAdded:i,positionAssigned:r}}function Yse({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:dg({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function Kse({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=Yse({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(u=>u.matchUpId===o),c=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=jr(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function vN({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function Ob({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){let u="assignMatchUpDrawPosition";o||(o=is({drawDefinition:n})),t||(t=zn({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(M=>M.matchUpId===l),p=d?.structureId,h=n?.structures?.find(M=>M.structureId===p);if(!h)return{error:Qr};let f=o?.drawMatchUps?.find(M=>M.matchUpId===l),m=f?.drawPositions??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=cNe({drawPositions:m,drawPosition:s}),{positionAssignments:b}=Sr({drawDefinition:n,structure:h}),I=b?.filter(M=>y.includes(M.drawPosition))?.find(({bye:M})=>M),w=f?.matchUpStatus&&As(f.matchUpStatus)&&y.filter(Boolean).length<2;a=I&&"BYE"||a||w&&f.matchUpStatus||f?.matchUpStatus&&[on,ia].includes(f.matchUpStatus)&&f.matchUpStatus||Dn;let T=!!(As(f?.matchUpStatus)&&f?.winningSide);if(f&&g){t=zn({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let M=w&&vN({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||T&&f.winningSide||void 0;f?.matchUpStatusCodes&&Kse({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:M,matchUpStatus:T?f?.matchUpStatus:a}),Gi({tournamentId:i?.tournamentId,eventId:d?.eventId,context:u,drawDefinition:n,matchUp:f})}let S=mo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:C,loserTargetDrawPosition:E},targetLinks:{loserTargetLink:P}}=S,R=dg({structureId:h.structureId,matchUpsMap:o});if(v&&I){if(D)if(["BYE",on,ia].includes(a)){let M=Ob({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}else{let{structureId:M}=D;M!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(v&&T){if(D){let M=Ob({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}else if(D&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:M}=Wse({targetMatchUp:f,drawPosition:s,matchUpsMap:o,structure:h});if(M){let A=Ob({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(A.error)return A}}if(f?.matchUpType===_r){let M=t?.find(({matchUpId:k})=>k===f.matchUpId),A=(M?.sides??[]).reduce((k,x,O)=>x.drawPosition===s?O:k,void 0),N=b?.find(k=>k.drawPosition===s)?.participantId;N&&A!==void 0&&Kz({inContextTargetMatchUp:M,drawPositionSideIndex:A,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:f})}if(P?.linkCondition===gp&&y.filter(Boolean).length===2&&!I&&R.filter(({drawPositions:M,roundNumber:A})=>A===1&&ho(M,y)).every(({matchUpStatus:M})=>[Sn,Ia].includes(M))&&C){let{structureId:M}=C,A=mc({drawPosition:E,tournamentRecord:i,drawDefinition:n,structureId:M,matchUpsMap:o,event:c});if(A.error)return A}return v?{...se}:ce({result:{error:vT},context:{drawPosition:s},stack:u})}function Zse({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=zU({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:u})=>u)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:u})=>u)||[],o=t?.filter(u=>a.includes(u.structureId)&&Un(u.drawPositions??[],s).length)??[],l=o.map(({matchUpId:u})=>u),c=r?.drawMatchUps?.filter(u=>l.includes(u.matchUpId))??[];return{drawPositions:s,matchUps:c,targetMatchUps:o}}function Zz({lineUp:t}){if(!Array.isArray(t))return;let e={};return vi(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=TA({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function iy(t){return`${t} must be an array`}function DO({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(iy("lineUp")),{valid:!1,errors:i,error:be};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(iy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=vi(t.map(xi)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?be:void 0}}function aw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:Nt};if(typeof e!="string")return{error:na};let n=DO({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=Pi({element:t,name:Hf}),s=a?.value||{};return s[e]=Zz({lineUp:r}),ir({element:t,extension:{name:Hf,value:s}}),w1({drawDefinition:t}),{...se}}function Xz({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:Nt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Zse({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of u)d.matchUpType===rc&&(d.sides??[]).forEach((p,h)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let f=c.find(({matchUpId:m})=>m===d.matchUpId);if(f?.sides?.[h]){if(delete f.sides[h].lineUp,e===!1){let m=d.tieFormat,g=p.participantId;m&&g&&aw({drawDefinition:r,participantId:g,lineUp:[],tieFormat:m})}Gi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:f})}}});return{...se}}function yp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){let h="assignDrawPosition";if(!o&&!i)return ce({result:{error:na},stack:h});u=u??is({drawDefinition:a}),e||({matchUps:e}=zn({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=si({drawDefinition:a,structureId:d});if(f.error)return ce({result:f,stack:h});let{structure:m}=f;if(!m)return{error:Qr};if(Ao({structure:m}))return ce({result:{error:il},stack:h});let{seedAssignments:g}=$c({provisionalPositioning:t,drawDefinition:a,structure:m}),v=g?.find(E=>E.participantId===o)?.seedNumber,{appliedPolicies:y}=Qi({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(v&&!EA({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return ce({result:{error:ZG},context:{drawPosition:c},stack:h});let b=aa({structure:m}).positionAssignments||[],I=b?.find(E=>E.drawPosition===c);if(!I)return ce({result:{error:MU},context:{drawPosition:c},stack:h});if(b?.map(xi).includes(o))return ce({result:{error:kU},context:{drawPosition:c},stack:h});let{containsParticipant:w,containsBye:T}=C(I);if(T){let E=F1({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(E.error)return ce({result:E,stack:h})}if(w&&I.participantId!==o){let{activeDrawPositions:E}=L1({drawDefinition:a,structureId:d});if(E.includes(c))return ce({result:{error:Dk},stack:h});Xz({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m})}if(I.participantId=o,i&&(I.qualifier=!0),m.stage===Ut&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[bs,In].includes(m.stage)){let E=m.stage===Ht?Ht:Ut,P=(a.structures?.find(R=>R?.stage===E&&R?.stageSequence===1)?.seedAssignments??[]).find(R=>R.participantId===o);if(P?.participantId){let{participantId:R,seedNumber:M,seedValue:A}=P;ZU({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:R,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(m.structureType!==wo)uNe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{Cse({positionAssignments:b,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:E,matchUps:P,targetMatchUps:R}=Zse({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(E&&P?.length===1&&P[0].matchUpType===_r){let M=(R?.[0].sides??[]).reduce((A,N,k)=>E?.includes(N.drawPosition)?k:A,void 0);Kz({inContextTargetMatchUp:R[0],teamParticipantId:o,matchUp:P[0],drawPositionSideIndex:M,tournamentRecord:n,drawDefinition:a})}}let S=a.entries?.find(E=>E.participantId===o),D=p?.entries?.find(E=>E.participantId===o);return!S&&D&&Bz({entryStatus:D.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),ug({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...se};function C(E){let P=E.bye,R=E.qualifier,M=E.participantId;return{containsBye:P,containsQualifier:R,containsParticipant:M,filled:P||R||M}}}function uNe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=rr({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=fo({matchUps:u}),{initialRoundNumber:p}=cI({drawPosition:a,matchUps:u}),h=p&&d?.[p].find(f=>f.drawPositions?.includes(a));if(h){let f=Ob({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(f.error)return ce({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...se}}function Jz(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Nt};let d=Qi({tournamentRecord:n,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=is({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=zn({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Sr({drawDefinition:a,structureId:l}),m=f?.find(I=>I.drawPosition===o);if(m?.participantId){let I=m.participantId,w=yp({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});return w.success?b({appliedPolicies:d,removedParticipantId:I}):ce({result:w,stack:u})}let g=F1({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(g.error)return ce({result:g,stack:u});let v=g.participantId,y=yp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(!y.success)return ce({result:y,stack:u});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:w}){let{structure:T}=si({drawDefinition:a,structureId:l});wz({drawPositions:[o],structure:T});let S={[e]:s,name:r,drawPosition:o,structureId:l};return cO({appliedPolicies:I,drawDefinition:a,positionAction:S}),ce({context:{removedParticipantId:w},result:{...se},stack:u})}}function dNe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return Jz({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Xse(t){return dNe(t)}function Jse({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Gi({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function Qse(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=jt(t,i);if(r.error)return r;let n=si(t);if(n.error)return n;let a=n.structure;if(!Ao({structure:a}))return ce({result:{error:Uy,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=fo({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:hm}}function eoe(t){let e=Qse(t,[{targetRoundNumber:!0,roundNumber:!0,[Fo]:u0e}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return ce({result:{error:be},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?vt(s+1,a+1):vt(a,s),c={};return l.forEach(u=>(r?.[u]??[]).forEach(({matchUpId:d})=>{c[d]=u-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:u})=>c[u]=a),Jse({params:t,modMap:c,structure:i}),{...se}}function toe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:Nt};if(!Array.isArray(t))return{error:be};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:c}=o;if(!c)continue;let u=si({drawDefinition:r,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:Qr};let p=Sr({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),h=c?.map(({drawPosition:g})=>g);if(Un(p,h).length!==p?.length)return ce({result:{error:be},info:"drawPositions do not match",stack:a});let f=is({drawDefinition:r}),{matchUps:m}=zn({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let g of c||[]){let{drawPosition:v,participantId:y,bye:b,qualifier:I}=g;if(b){let w=mc({tournamentRecord:i,drawDefinition:r,drawPosition:v,matchUpsMap:f,structureId:l,structure:d,event:n});if(w?.error)return w}else if(I)c.forEach(w=>{w.drawPosition===v&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(y){let w=yp({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:y,drawPosition:v,matchUpsMap:f,structureId:l,event:n});if(w?.error)return w}}ug({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return Pr({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...se}}function ioe(t){let e=Qse(t,[{roundNumbers:!0,[Fo]:Cs,[ds]:s=>s.length===2&&s.every(gn)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return ce({result:{error:be,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Jse({params:t,modMap:a,structure:i}),{...se}}function roe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return Jz({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function noe({drawDefinition:t,structureId:e}){if(!t)return{error:Nt};let{structure:i}=si({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function EO({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:Or};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=ju({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function Qz({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:Qe};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=EO({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function _h(t){if(!t?.drawDefinition)return!1;let e=wO(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===_r),n=n?.filter(({matchUpType:s})=>s===_r),a=a?.filter(({matchUpType:s})=>s===_r)),!!(r?.length&&!n?.length&&!a?.length)}function eq(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:Nt};let{playoffStructures:r}=noe({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&Xu.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Sr({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function hV({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=hV({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=hV({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function pNe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:sH};if(!Array.isArray(r))return{error:o1};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=aoe({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function aoe({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:sH};if(!r)return{error:BI};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(...hV({significantCharacters:c,value:r,accessors:u}))}else if(s){let u=a?.includeIds,d=(e?.[s]||[]).filter(p=>!u||u.includes(p));d?.length&&i?.length&&d.forEach(p=>{let h=i.find(f=>f.participantId===p);if(h?.individualParticipantIds?.includes(r.participantId)){let f=h?.participantId;n.push(f)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(r.participantId)&&n.push(u)})}),{values:vi(n)}}function PY({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=aoe({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function soe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function hNe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=soe(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=n(s),l=s.filter(c=>!o.includes(c)).filter(c=>{let u=CY(c);return!r[u]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=CY(o);return!a.includes(l)}}}function fNe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=soe(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function CY(t){return Number(t%2?t+1:t-1)}function mNe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function gNe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?fNe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):hNe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function ooe({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function vNe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(u=>e.includes(u))]).filter(c=>c[1].length).map(([c,u])=>({[c]:u}))),s=Object.keys(a).reduce((c,u)=>a[u].length>c?a[u].length:c,0),o=Object.keys(a).filter(c=>a[c].length===s),l=ml(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?ml(a[n]):ml(e),groupKey:n}}function yNe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function bNe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((D,C)=>C.length>D?C.length:D,0)<=2,c=ooe({positionAssignments:t,participantIds:e}),u=yNe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=vNe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=mNe({participantId:d,allGroups:s}),f=gNe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=v?.length&&v[0],b=g?.length&&g[0],I=a&&y?y:b,w=a?b:y,T=I?.length&&I||w?.length&&w,S;if(T?.length){let D=vl(T);S=vl(D)}else{let D=vl(m[0]);S=vl(D)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function PA({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=zz({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{ho(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{ho(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function INe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!s?.includes(c)).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=PA({isRoundRobin:n,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=PA({isRoundRobin:n,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function RY(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,h=Tt(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||n?.includes(b.drawPosition))).map(b=>b.drawPosition);vt(0,r).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:w}=bNe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(T=>{T.drawPosition===w&&(T.participantId=I)})});let m=PY({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ca(m,d),v=PA({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=INe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=wNe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=PY({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ca(m,d),v=PA({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=z$;c.push(I)}if(b.qualifier&&b.participantId){let I=z$;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function wNe({candidatePositionAssignments:t,swapOptions:e}){let i=vl(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=vl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),s=t.find(c=>c.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...se}}function SNe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){if(!u)return{error:wre};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=si({drawDefinition:a,structureId:c}),{matchUps:b}=rr({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&wd(m)&&!g){let j=b1e(m)||0,q=b.reduce((W,z)=>z.roundNumber>W?z.roundNumber:W,0);g=q<j?1:q-j+1}let{positionAssignments:I}=aa({structure:y}),w=dO({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,T=I?.filter(j=>!j.participantId),S=I?.map(j=>j.drawPosition),D=y?.structureType===wo,C=D?{structure:y,matchUps:b,allDrawPositions:S,roundsToSeparate:g}:{matchUps:b,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:P}=D?TNe(C):UNe(C),R={groupParticipants:o.filter(j=>j.participantType===hc).map(j=>j.participantId),teamParticipants:o.filter(j=>j.participantType===pr).map(j=>j.participantId),pairParticipants:o.filter(j=>j.participantType===Di).map(j=>j.participantId)},M=pNe({targetParticipantIds:e,policyAttributes:f,idCollections:R,participants:o});if(M.error)return ce({result:M,stack:v});let A=Object.assign({},...e.map(j=>{let q=Object.keys(M).filter(W=>(M[W]??[]).includes(j));return{[j]:q}})),N=ooe({participantIds:e,positionAssignments:I});if(N.length>(T?.length||0))return{error:pH};let k,x=N.length,O=vt(0,h).map(()=>RY({initialPositionAssignments:I,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:R,allGroups:M,drawSize:d}));if(k=O.reduce((j,q)=>!j||(q.conflicts||0)<(j.conflicts||0)?q:j,void 0),!k||k.conflicts){let j=vt(0,h).map(()=>RY({initialPositionAssignments:I,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:R,allGroups:M,drawSize:d}));k=O.concat(...j).filter(q=>!q.errors?.length).reduce((q,W)=>!q||(W.conflicts||0)<(q.conflicts||0)?W:q,void 0)}if(!k)return{error:kk};let V=(Sr({structure:y})?.positionAssignments??[]).filter(j=>j.participantId).map(j=>j.participantId),F=k.positionAssignments.filter(j=>!V.includes(j.participantId));for(let j of F)if(j.bye){let q=mc({tournamentRecord:n,drawDefinition:a,structureId:c,matchUpsMap:l,event:p,...j});if(q.error)return ce({result:q,stack:v})}else if(j.participantId){let q=yp({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(q.error)return ce({result:q,stack:v,context:{assignment:j}})}return{...se}}function TNe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function UNe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(Jn),a=Math.max(...n),s=t.filter(u=>u>a),o=n.length,l=vt(o===2?1:2,o).filter(u=>u===YG(u)),c=l.slice(0,e||l.length).reverse().map(u=>Ca(n,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:c}}function DNe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){let h="positionUnseededParticipants";u||({structure:u}=si({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=aa({structure:u}),{seedAssignments:m}=$c({provisionalPositioning:t,drawDefinition:a,structure:u}),g=m?.map(C=>C.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,b=v===Ht?Pi({element:u,name:Op})?.extension?.value:void 0,I=YI({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:ky,structureId:c,roundTarget:b,stage:v}),w=I.filter(C=>!g?.includes(C.participantId)).map(C=>C.participantId),T=f?.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!r&&w.length>(T?.length||0))return ce({result:{error:pH},context:{unseededParticipantsCount:w.length,unfilledDrawPositionsCount:T?.length},stack:h});let{appliedPolicies:S}=Qi({tournamentRecord:n,drawDefinition:a,event:p}),D=S?.[FP];if(u.stage===In){let C=I.reduce((E,P)=>(E[P.groupingValue]||(E[P.groupingValue]=[]),E[P.groupingValue].push(P.participantId),E),{});Object.keys(C).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:C}))}return D&&o?SNe({provisionalPositioning:t,unseededParticipantIds:w,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:D,drawSize:d}):ENe({provisionalPositioning:t,unseededParticipantIds:w,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function ENe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?so(r):r.reverse();for(let h of e){let f=p.pop();if(!n||f){let m=yp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return ce({result:m,stack:"randomUnseededDistribution"})}}return{...se}}function PNe(t){let e=t.structure??si(t).structure,i="positionQualifiers",r=[];if(e.stage===bs)return ce({result:{error:Ey},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=CNe(t);for(let o of Object.keys(n)){let l=a?.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[o]>(l||0))return ce({result:{error:dH},context:{unfilledDrawPositions:l},stack:i});vt(0,n[o]).forEach(()=>{let c=vl(l);r.push(c),a?.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...se,qualifierDrawPositions:r}}function CNe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=si({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=aa({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=YU({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>ii(m)),{matchUps:c}=rr({structure:e}),{roundProfile:u}=fo({matchUps:c}),d=Object.assign({},...l.filter(m=>u?.[m]).map(m=>({[m]:u?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=r?.filter(v=>v.qualifier&&d[m]?.drawPositions?.includes(v.drawPosition)).map(v=>v.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function MY({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=si({drawDefinition:a,structureId:u})),u||(u=p?.structureId),r||(r=Qi({drawDefinition:a}).appliedPolicies),!n){let v=p&&nw({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});v?.error&&m.push(v.error),n=v?.validSeedBlocks}return c=c??n?.length??0,vt(0,c).forEach(()=>{if(g<(c||0)){let v=RNe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:h});v?.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...se,seedPositions:f}}function RNe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=qse({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=Qi({drawDefinition:r}),{avoidance:h}=p??{};h&&s&&u?.length>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:NU};f.push(g);let v=yp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:c});if(!v.success)return v}return{...se,seedPositions:f}}function MNe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=aa({structure:i}),{seedAssignments:n}=$c({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function NNe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>ANe(a,i,r,t));let n=r.map(a=>Array.isArray(a)?so(a):a).flat(1/0);return Vie(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function ANe(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=fV(Ca(t.drawPositions,2));_Ne(n,i,r)}}function _Ne(t,e,i){let r,n=i[e.length];for(;r=yN(t,n);)e.push(r),n=i[e.length]}function yN(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?ONe(t,e):kNe(t,e)}function kNe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function ONe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return yN(e?n:t[Math.round(Math.random())],e)}return i<r?yN(t[1],e):yN(t[0],e)}function fV(t){let e=Math.floor(t.length/2);return t.length>2?[fV(t.slice(0,e)),fV(t.slice(e))]:t}function xNe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=nw({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=MNe({provisionalPositioning:t,drawDefinition:r,structure:o})??[],h=vi([].concat(...e.map(I=>I.drawPositions))),f=p.filter(I=>h.includes(I.drawPosition)),m=(I,w)=>NT(I.seedValue)-NT(w.seedValue),g=d.reduce((I,w)=>{let T=f.filter(S=>w.drawPositions?.includes(S.drawPosition)).sort(m);return I.concat(...T)},[]).map(I=>I.drawPosition),v=NNe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),y=NY({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),b=NY({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function NY({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function LNe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,c=s.stage===Ht,{positionAssignments:u}=aa({structure:s}),d=u?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=rr({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=f?.[1]||[],g=s.structureType===wo?h:m,v=vi([].concat(...g.map(N=>N.drawPositions))),y=Math.min(...v)-1,b=d?.filter(N=>v.includes(N)),I=N=>{let k=Math.ceil(N.length/2),x=[N.slice(0,k),N.slice(k)],O=x.map(Z=>[].concat(...Z.flat(1/0)).length),V=Math.min(...O.flat(1/0)),F=Math.max(...O.flat(1/0)),j=O.indexOf(F),q=V!==F,W=so(x),[z,H]=!V||q?[x[j],x[1-j]]:[W[0],W[1]];return{greaterHalf:z,lesserHalf:H}},w=N=>{let{greaterHalf:k,lesserHalf:x}=I(N),{greaterHalf:O,lesserHalf:V}=I(k),F=so(O.flat(1/0)).pop(),j=O.flat().filter(q=>q!==F);return{newlyFilteredChunks:[...x,...V,j],drawPosition:F}},T=N=>!e.includes(N),S=N=>!b?.includes(N),D=N=>{let k=Ca(N.sort(Jn),Math.ceil(N.length/4)).map(V=>V.filter(S)),x=[].concat(...k.flat(1/0)).length,O=[];for(let V=0;V<x;V++){let{newlyFilteredChunks:F,drawPosition:j}=w(k);O.push(j),k=F}return O},{validSeedBlocks:C}=nw({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),E=C?.map(N=>N.drawPositions?.map(k=>k+y)),P;if(o){let N=v.length,{seedBlocks:k}=qz({cluster:H1(l)===Hk,participantsCount:N});P=k.map(x=>x.map(O=>O+y)).map(D).filter(x=>x.length)}else c?P=E?.map(N=>N.filter(S)):P=E?.map(D).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((k,x)=>k-x)).filter(N=>N?.[0]+1===N?.[1]),M=N=>R.reduce((k,x)=>x.includes(N)?x.reduce((O,V)=>V!==N?V:O,void 0):k,void 0),A=P.map(N=>N.map(M)).flat(1/0).filter(S).filter(T).filter(Boolean);if(c&&!s.structures){let N=a%4,k=A.slice(0,N),x=f[s.roundLimit]?.length,O=Ca(A.slice(N),x).map(so).flat();A=k.concat(O)}return{unseededByePositions:A}}function FNe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=rr({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],c=r?.structureType===wo,u=c?s:l,d=c?r?.structures?.length||0:s.length,{structureId:p,stage:h,stageSequence:f}=r,m=YI({entryStatuses:Xu,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=YU({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=aa({structure:r}),I=b?.map(E=>E.drawPosition),w=y?.filter(E=>E.bye).length,T=y?.filter(E=>E.bye).map(E=>E.drawPosition),S=u.map(E=>E.drawPositions).filter(E=>E?.reduce((P,R)=>!T?.includes(R)&&P,!0)).flat(1/0).filter(E=>I?.includes(E)),D=y?.length,C=D?D-v:0;return C>d&&r.stageSequence===1&&r.stage!==bs&&(C=d),{placedByes:w,byesCount:C,relevantMatchUps:u,placedByePositions:T,roundMatchUps:o,positionsToAvoidDoubleBye:S}}function AY({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){l||({structure:l}=si({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===Ht),{byesCount:h,placedByes:f,relevantMatchUps:m}=FNe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...se};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=xNe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),w=l?.structureType&&[wo,zk].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,T=p&&y?.length?y:v,{unseededByePositions:S}=LNe({provisionalPositioning:t,seedOrderByePositions:T,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:I}),D=R=>R%2,C=(R,M)=>(R||[]).every(A=>D(A)?M!==A+1:M!==A-1),E=[].concat(...T);if(!u)for(;S.length;){let R=S.find(M=>C(E,M));R?(E.push(R),S=S.filter(M=>M!==R)):(E.push(...S),S=[])}w&&(E=so(E),ac({ignoreSeededByes:w})&&console.log({byePositions:E}));let P=E.slice(0,g);for(let R of P){let M=mc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(M?.error)return M}return{...se,unseededByePositions:S,byeDrawPositions:P}}function z1(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,placementGroup:o,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(dne(),e=Tt(e,!1,!0));let g=N=>(i||dN(),ce({result:N,stack:"automatedPositioning"})),v=N=>(i||dN(),N),y=si({drawDefinition:e,structureId:c});if(y.error)return g(y);let b=y.structure;if(!b)return{error:Qr};let I=t.appliedPolicies||Qi({drawDefinition:e,structure:b,event:f})?.appliedPolicies,{qualifiersCount:w}=YU({stageSequence:b.stageSequence,provisionalPositioning:r,stage:b.stage,drawDefinition:e,structureId:c}),T=ky;if(!YI({stageSequence:b.stageSequence,provisionalPositioning:r,stage:b.stage,placementGroup:o,drawDefinition:e,entryStatuses:T,structureId:c})?.length&&!w)return v({...se});let S=t.matchUpsMap??is({drawDefinition:e}),D=t.inContextDrawMatchUps??zn({inContext:!0,drawDefinition:e,matchUpsMap:S})?.matchUps,C=[],E=nw({provisionalPositioning:r,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:P}=E;m.push({validSeedBlocks:P});let R=t.participants||(s?cn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]);if(H1(b.seedingProfile||l)===Kv){let N=a?AY({provisionalPositioning:r,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(N?.error)return g(N);C=N.unseededByePositions,m.push({action:"positionByes",unseededByePositions:C});let k=b.seedingProfile?{positioning:b.seedingProfile}:l;if(N=MY({seedingProfile:k,provisionalPositioning:r,inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:f}),N.error)return g(N);m.push({seedPositions:N.seedPositions,action:"positionSeedBlocks"})}else{if(p!==Py){let k=b.seedingProfile?{positioning:b.seedingProfile}:l,x=MY({seedingProfile:k,provisionalPositioning:r,inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:f});if(x.error)return g(x);m.push({action:"positionSeedBlocks",seedPositions:x.seedPositions})}let N=a?AY({provisionalPositioning:r,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(N?.error)return g(N);C=N?.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:N?.byeDrawPositions,unseededByePositions:C})}let M={};if(!d){let N=PNe({inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b});if(N.error||(N.conflicts&&(M.qualifierConflicts=N.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:N.qualifierDrawPositions}),N=DNe({provisionalPositioning:r,inContextDrawMatchUps:D,unseededByePositions:C,multipleStructures:n,tournamentRecord:s,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structureId:c,structure:b,drawSize:h,event:f}),N.error))return g(N);N.conflicts&&(M.unseededConflicts=N.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=Sr({drawDefinition:e,structure:b});return Pr({drawDefinition:e,structureIds:[c]}),i||dN(),{positionAssignments:A,conflicts:M,...se,positioningReport:m}}function XU(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:nc};if(!_h({drawDefinition:n,structureId:s})&&!i)return{error:KG};let c=noe({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,h)=>IA(p)-IA(h)),u=[],d=[];if(c)for(let p of c){let{structureId:h}=p,f=z1({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(f.error)return f;f.positionAssignments&&u.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...se,structurePositionAssignments:u,positioningReports:d}}function loe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:Nt};if(!n)return{error:dc};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:Sd};let{structure:l}=si({drawDefinition:i,structureId:n});if(!l)return{error:Qr};if(!(!t||gn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>gn(p)&&ii(p)>0)))return{error:be};let{seedAssignments:c}=$c({drawDefinition:i,structure:l}),u=c?.map(p=>p.seedNumber),d=c?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return qae({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...se}}function tq({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return Jz({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function qP({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=qU({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=si({structureId:l,drawDefinition:i});if(!(e&&c?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var BNe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let c=r.indexOf(o),u=t.findIndex((d,p)=>!n.has(p));for(;n.has(u)&&u===-1&&n.size<t.length;)u=t.findIndex((d,p)=>!n.has(p)&&p>u);a.push(c),n.add(c)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function coe({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=jt({drawDefinition:i,event:r,tournamentRecord:e},[{[$s]:!0,[mm]:!0,[da]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Ut&&g.stageSequence===1);if(!l)return ce({result:{error:tH}});let c=(Qi({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Mh]?.requireCompletedStructures,{qualifierPositions:u,positionAssignments:d}=aa({structure:l});if(!u.length)return ce({result:{error:dH}});let p=vt(0,u.length);n&&(p=BNe(p,n));let h=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:f}=qP({structureId:l.structureId,targetRoundNumber:t,linkType:Eh,drawDefinition:i})||{},{relevantLinks:m}=qP({structureId:l.structureId,targetRoundNumber:t,linkType:Dh,drawDefinition:i})||{};for(let g of f){let v=i.structures?.find(b=>b.structureId===g.source.structureId);if(v?.stage!==Ht)continue;let y=_h({structureId:g.source.structureId,drawDefinition:i});if(!c||y){let b=v.qualifyingRoundNumber,{matchUps:I}=rr({matchUpFilters:{...b&&{roundNumbers:[b]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:v});for(let w of I){let T=w.matchUpStatus==="BYE"&&w.sides?.find(({participantId:D})=>D),S=w.sides.find(D=>D?.sideNumber===w.winningSide);if(S||T){let{participantId:D}=S||T||{};D&&!h.includes(D)&&o.push(D)}}}}for(let g of m){let v=i?.structures?.find(y=>y.structureId===g.source.structureId);if(v?.stage===Ht&&_h({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:y}=Sr({structure:v}),b=y?.map(I=>{let w=I.participantId,T=Pi({element:I,name:qf}).extension?.value;return T?{participantId:w,groupOrder:T?.groupOrder}:{}}).filter(({groupOrder:I,participantId:w})=>I===1&&!h.includes(w)).map(({participantId:I})=>I)??[];b&&o.push(...b)}}return o.length?(p.forEach((g,v)=>{let y=o[v],b=u[g].drawPosition;y&&tq({qualifyingParticipantId:y,structureId:l.structureId,drawPosition:b,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:y,drawPosition:b})}),ce({result:Lt({...se,assignedParticipants:s})})):ce({result:{error:Are}})}function uoe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>fi(i)))&&ce({result:{error:be},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>mT(i.structureOrder)-mT(r.structureOrder)),{...se}):{error:Nt}}function PO({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let v=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(v&&!v?.stage){let y=e.find(b=>b.structureId===g);v.stage=y?.stage}return v},a={},s={},o=i.map(g=>{let v=g.source.structureId,y=g.target.structureId,b=n(v),I=n(y);return[Zv,Su,qk,Kv].includes(g.target.feedProfile)?(b?.targets.push(y),I?.sources.push(v)):g.target.feedProfile===wu&&(I?.drawSources.push(v),b?.drawTargets.push(y)),s[y]=s[y]||g.target.feedProfile===wu,a[y]=vi([...a[y]||[],v]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let v=r.get(g);if(v){let y=v.targets??[];for(;y.length;){let b=y.pop(),I=b&&r[b];I?.targets?.length?y.push(...I.targets):I&&(v.rootStage=I.stage)}if(v.rootStage||(v.rootStage=v.stage),!v.targets?.length){let b=v.sources??[];for(;b.length;){let I=b.pop(),w=I&&r[I];if(w?.sources?.length){for(let T of w.sources)v.progeny?.includes(T)||v.progeny?.push(T);b.push(...w.sources)}}}}}let l=0;for(let g of r.keys()){let v=r.get(g);if(v&&v.rootStage===Ht){let y=[v.drawTargets?.[0]],b=0;for(;y.length;){b+=1;let I=y.pop(),w=I?r.get(I):void 0;w?.drawTargets?.length&&y.push(w.drawTargets[0])}v.distanceFromMain=b,b>l&&(l=b)}}let c=o.length;vt(0,Math.ceil(c/2)).forEach(()=>{o=vt(0,c).map(g=>{let v=o[g],y=o.reduce((b,I)=>ho(v,I)?b.concat(...I):b,[])||[];return vi(v.concat(...y))})});let u=o[0],d=(g,v)=>Un(g,v).length===g.length,p=o.slice(1).reduce((g,v)=>g&&d(v,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(g=>{let{structureId:v,stage:y}=g;h.find(b=>b.includes(v))||(h.push([v]),y!==La&&f.push([v]))});let m=p&&f.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:h}}function doe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=PO({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...se}}function iq(t){let e=jt(t,[{[da]:!0,[$s]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return $Ne({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function $Ne(t){let e=jt(t,[{[$s]:!0,[Xk]:!0},{link:!0,[Fo]:Ko,[Kie]:QG}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=si({drawDefinition:i,structureId:o});if(l.error)return ce({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),doe({drawDefinition:i});let c=rr({structure:n})?.matchUps||[];return cg({drawDefinition:i,tournamentId:r,matchUps:c,eventId:a}),Pr({drawDefinition:i,structureIds:[n.structureId]}),{...se}}function poe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:be};if(!t)return{error:Nt};let i=Object.assign({},...e.map(r=>{if(!ji(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Wt};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...se}}function rq({drawDefinition:t,timeItem:e}){if(!t)return{error:nc};if(!e)return{error:gH};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:mH};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),w1({drawDefinition:t}),{...se}}function hoe(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=jt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(v=>v.structureId===r);if(!o)return{error:Qr};let l=s.find(({stage:v,stageSequence:y})=>v===Ut&&y===1),c=r===l?.structureId,u=s.filter(({stage:v})=>v===Ht).map(Rl("structureId"));if(c&&!u.length)return{error:Jie};let d=u.includes(r),p=VNe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=GNe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:g}=HNe({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:r});if(jNe({removedMatchUpIds:m,drawDefinition:i}),c){let v=(l.matchUps??[])?.map(Rl("matchUpId"));m.push(...v),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&doe({drawDefinition:i}),Zh({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),Pr({drawDefinition:i,eventId:n?.eventId}),{...se,removedMatchUpIds:m,removedStructureIds:g}}function VNe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=u=>i.links?.find(d=>d.target.structureId===u),c=l(r)?.source.structureId;for(;c;)o.push(c),c=l(c)?.source.structureId}if(zn({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>sa({score:l}))){let l=Qi({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[Bc]?.allowDeletionWithScoresPresent?.structures))return{error:c1}}return{...se}}function jNe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=zn({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function GNe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(Rl("structureId")),o=u=>n.links?.map(d=>d.source.structureId===u&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=u=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===u&&d.source.structureId).filter(Boolean)??[],c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function HNe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let c=a.pop();l.push(...WNe({idBeingRemoved:c,drawDefinition:n}));let u=qNe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:s});o.push(...u.removedStructureIds);let d=zNe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function zNe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function qNe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function WNe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=si({structureId:t,drawDefinition:e}),r=rr({structure:i}).matchUps;return ez(r)}function CA({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:Nt};if(!Pz({drawDefinition:e,stage:r}))return{error:Ey};let n=W0e({drawDefinition:e,stage:r}),{qualifiersCount:a}=YU({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:ire};let{entryProfile:o}=Ez({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return Pr({drawDefinition:e}),{...se,entryProfile:o}}function foe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?Pz({drawDefinition:e,stage:i})?(Ez({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Pr({drawDefinition:e}),{...se}):{error:Ey}:{error:Nt}}function YNe({drawDefinition:t,drawSize:e}){if(!t)return{error:Nt};let i=CA({stage:La,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Pr({drawDefinition:t}),{...se})}function moe(t){return YNe(t)}function goe({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:Nt};let n=e.structures?.find(s=>s.stage===Ht&&s.structureId===r);if(!n)return{error:Qr};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>sa({score:o})??Hn.includes(s)))return{error:c1};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Zh({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),Pr({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...se}}var KNe="qualifierDrawPositionAssignment",ZNe="withdrawParticipantAtDrawPosition",XNe="alternateDrawPositionAssignment",JNe="luckyLoserDrawPositionAssignment",_Y="removeDrawPositionAssignment",voe="swapDrawPositionAssignments",QNe="modifyPairAssignment",eAe="adHocPositionSwap",tAe="modifyParticipantOtherName",kY="assignDrawPosition",iAe="removeSeededParticipant",rAe="assignDrawPositionBye",nAe="modifySeedAssignment",yoe="addPenalty",nq="MODIFY_PAIR",CO="QUALIFIER",aq="ALTERNATE",sq="WITHDRAW",uI="ASSIGN",mV="REMOVE",oq="LUCKY",GE="REMOVE_SEED",RO="SWAP",WP="NICKNAME",xb="SEED_VALUE",dI="PENALTY",sw={MODIFY_PAIR_ASSIGNMENT:nq,QUALIFYING_PARTICIPANT:CO,ALTERNATE_PARTICIPANT:aq,WITHDRAW_PARTICIPANT:sq,ASSIGN_PARTICIPANT:uI,LUCKY_PARTICIPANT:oq,REMOVE_ASSIGNMENT:mV,SWAP_PARTICIPANTS:RO,ADD_NICKNAME:WP,REMOVE_SEED:GE,ADD_PENALTY:dI,ASSIGN_BYE:"BYE",SEED_VALUE:xb};function boe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:Nt};if(!r)return{error:dc};if(i?.length!==2)return{error:be,drawPositions:i};let a=is({drawDefinition:e}),{matchUps:s}=zn({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=si({drawDefinition:e,structureId:r});if(!o)return{error:Qr};let l=Qi({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},c;if(o.structureType===wo?c=oAe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):c=aAe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),c.error)return c;if(wz({structure:o,drawPositions:i}),cO({appliedPolicies:l,drawDefinition:e,positionAction:{name:voe,drawPositions:i,structureId:r}}),ug({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===El){let u=rr({matchUpFilters:{matchUpTypes:[rc]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(h=>i.includes(h))),d=rr({matchUpFilters:{matchUpTypes:[rc]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(h=>{let f=h?.drawPosition;if(i.includes(f)){let m=h.participantId,g=d.find(({matchUpId:y})=>y===p.matchUpId),v=p?.sides?.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0);Kz({inContextTargetMatchUp:p,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return Pr({drawDefinition:e,structureIds:[r]}),{...se}}function aAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(c=>r?.includes(c.drawPosition));if(!o)return{error:be,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...se};if(o.filter(({qualifier:c})=>c).length===2)return{...se};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?Ioe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):sAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function Ioe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:f})=>f),l=r.find(({participantId:f})=>f),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=zP({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return h.error||(h=zP({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),h.error)||(mc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),h=yp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:s}),h.error)?h:{...se}}function sAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),Xz({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...se}}function oAe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((c,u)=>{let d=u?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&c.push(...d),c},[]);if(o.filter(({bye:c})=>c).length===2)return{...se};if(o.filter(({qualifier:c})=>c).length===2)return{...se};Xz({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:c})=>c);if(o.some(({bye:c})=>c)&&!l)Ioe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let c=Tt(o,!1,!0);o.forEach((u,d)=>{let p=c[1-d].participantId;u.qualifier=c[1-d].qualifier,u.participantId=p})}return{...se}}function woe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:Qe};if(!e)return{error:Nt};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Ut,Ht].includes(a.stage)||a.stage===Ut&&a.stageSequence!==1?ce({result:{error:Uy},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...se}:ce({info:"participant not seeded",result:{error:ja},context:{participantId:i}}):ce({result:{error:Qr},stack:n})}function q1({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Eh}){return!r||!n?{error:dc}:{link:Lt({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:wu,roundNumber:t,structureId:n}})}}function ow({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>W1({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function W1({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??or();let h=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${h}-TMU-${p+1}`};return vt(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Dn,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:o,isMock:n}})}function lq({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||or()}function RA({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o?.length;for(;l<(p||0);){let h=o?.[l],f=o?.[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=lq({roundPosition:u,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y?.drawPosition).filter(Boolean),matchUpStatus:Dn,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),u++,l+=2}return{roundNodes:c,matchUps:r}}function bp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!wd(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let u=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!wd(o)&&!u)return{matchUps:[],roundsCount:0};let d=vt(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=RA({matchUpType:n,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)r&&p.length===r&&(a=f-1),{roundNodes:p,matchUps:h}=RA({nodes:p,matchUpType:n,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=O1({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function cq(t){let e="generateQualifyingStructure";if(!t.drawDefinition)return ce({result:{error:Nt},stack:e});if(t.drawSize&&!fi(t.drawSize)||t.participantsCount&&!fi(t.participantsCount)||t.qualifyingPositions&&!fi(t.qualifyingPositions))return ce({result:{error:be},stack:e});let i=t.drawSize??WG(t.participantsCount),{hasExistingDrawDefinition:r,qualifyingRoundNumber:n,qualifyingPositions:a,targetStructureId:s,structureOptions:o,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,matchUpFormat:d,structureName:p,structureId:h,roundTarget:f,tieFormat:m,drawType:g,idPrefix:v,isMock:y,uuids:b}=t;if(!t.drawSize)return ce({result:{error:n1},context:{drawSize:i},stack:e});if(a&&a>=t.drawSize)return ce({result:{error:be},context:{drawSize:i,qualifyingPositions:a},stack:e});let I,w,T,S,D=0,C,E=1,{structureProfiles:P}=PO({drawDefinition:u}),R=P[s];if(!R)return ce({result:{error:Qr},context:{targetStructureId:s},stack:e});let M=u.matchUpType,A=f?`${f}-`:"",N=R.stage===Ht,k=l?.[Gf]?.namingConventions?.pre??X0e[Gf]?.namingConventions?.pre,x=N&&k?`${k}-`:"",O=p??(A?`${x}${gs(Ht)} ${A}`:`${x}${gs(Ht)}`);if(g===$u){let{maxRoundNumber:j,structures:q,groupCount:W}=j1({structureName:p??O,structureId:h??b?.pop(),hasExistingDrawDefinition:r,stage:Ht,structureOptions:o,appliedPolicies:l,qualifyingOnly:c,stageSequence:E,matchUpType:M,roundTarget:f,tieFormat:m,idPrefix:v,drawSize:i,isMock:y,uuids:b});D=W,I=j,T=q[0],C=[1]}else({drawSize:i,matchUps:S,roundLimit:I,roundsCount:w}=bp({qualifyingRoundNumber:n,qualifyingPositions:a,matchUpType:M,idPrefix:v,drawSize:i,isMock:y,uuids:b})),I||(I=w),T=Ac({structureName:p??O,structureId:h??b?.pop(),qualifyingRoundNumber:I,stage:Ht,matchUpFormat:d,stageSequence:E,matchUpType:M,roundLimit:I,matchUps:S}),f&&ir({extension:{name:Op,value:f},element:T}),D=S?.filter(j=>j.roundNumber===I)?.length;let V=g===$u?Dh:Eh,F=T&&I&&q1({sourceStructureId:T.structureId,sourceRoundNumber:I,targetStructureId:s,finishingPositions:C,linkType:V})?.link;return m&&(S=rr({structure:T})?.matchUps||[],S?.forEach(j=>{let{tieMatchUps:q}=ow({tieFormat:m,matchUp:j,isMock:y});Object.assign(j,{tieMatchUps:q,matchUpType:M})})),{qualifyingDrawPositionsCount:i,qualifiersCount:D,...se,structure:T,link:F}}function Soe(t){if(!t.tournamentRecord)return{error:Qe};let e=lAe(t);return e.error,e}function lAe(t){if(!t.drawDefinition)return{error:Nt};if(!t.targetStructureId)return{error:dc};let e=cq(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:be}:iq({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Toe(t){let e=jt(t,[{[$s]:!0,[Yk]:!0,[kp]:!0},{[n0e]:!0,[ds]:d=>Number.isInteger(d)&&d>0},{[ds]:d=>Array.isArray(d)&&d.length===2&&d.every(jr),[sc]:bl,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=si({drawDefinition:i,structureId:r});if(!s)return{error:Qr};if(!Ao({structure:s}))return{error:Uy};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,c=d=>!sa(d),u=(s?.matchUps??[]).filter(l).filter(c).filter(o);if(u.length!==2)return{error:bl};for(let d of u){let p=d?.sides?.find(h=>t.participantIds.includes(h?.participantId));if(p){let h=t.participantIds.find(f=>f!==p?.participantId);p.participantId=h,Gi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return Pr({drawDefinition:i,structureIds:[r]}),{...se}}function cAe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=vt(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=lq({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Dn,roundNumber:i,matchUpId:b};t&&(I.matchUpType=r),s&&(I.isMock=!0),a.push(I);let w={children:[y,v]};h.push(w)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function hg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??A(e);let g=uAe({drawSize:a}),v=g.length,y=0;if(i?.length)y=i.reduce((N,k)=>N+k,0);else if(e){let N=e-a;i=g.filter(k=>k<=N?(N-=k,!0):!1),y=i.reduce((k,x)=>k+x,0),r=i.length}else n>=v?r=0:c&&(r=v-c,n=0),i=g.filter((N,k)=>c&&!r||r&&k>=n+r||k<n?0:N),y=i.reduce((N,k)=>N+k,0),r=i.length;let b=[...g,...i].sort((N,k)=>k-N),I=b.length,w=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>I-N)].map(N=>b[N]).reduce((N,k)=>N+k,0);y=y-w;let T=0,S=[],D,C=1,E=vt(0,a).map((N,k)=>({drawPosition:k+1+y})),P=y+1;for(let N of g){if({roundNodes:D,matchUps:S}=RA({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),C++,i.includes(N)){let k=Ul(i)[N],x=vt(0,k),O=I+1-C,V=s?.includes(O)??l?.includes(C);x.forEach(()=>{({roundNodes:D,matchUps:S,drawPosition:P}=cAe({drawPosition:!V&&P||void 0,nodes:D,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:T})),C++,T+=1})}E=D}I!==C-1&&console.log("ERROR");let R=a-y;S=O1({finishingPositionOffset:u?R:o,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let M=D?.length?D[0]:D;return M&&(M.roundNumber=C-1,M.matchUps=S),{draw:M,matchUps:S,roundsCount:I};function A(N){let k=YG(N);return k>N?k/2:k}}function uAe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return vt(0,e).reverse().map(i=>Math.pow(2,i))}function nT(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Ut,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!c||s?.[l])||g<2||f&&o>f)return{};let I=[],w=[],T=[],S=t.matchUpType??p?.matchUpType,D=e+1,C=e+g,E=`${D}-${C}`,P=s?.[l],R=r&&`${r} `||"",M=s?.[E]??n?.[E],A=t.structureName||M?.name||P?.name&&(i?`${R}${P?.name}`:P.name)||`${R}${E}`,N=M?.abbreviation??P?.abbreviation,k=t.structureId??P?.structureId??b?.pop(),x={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?hg(x):bp(x),V=Ac({structureAbbreviation:N,stageSequence:o,structureName:A,matchUpType:S,roundOffset:d,structureId:k,matchUps:O,stage:m});I.push(...O),w.push(V);let F=Math.ceil(Math.log(g)/Math.log(2)),j=u?Math.min(u-d,F):(!a||D<a)&&F||0;return g>2&&vt(1,j+1).forEach(W=>q(W)),{structureId:V.structureId,matchUps:I,structureName:A,structures:w,links:T,...se};function q(W){let z=g/Math.pow(2,W);if(z<2)return;let H=g/Math.pow(2,W)+e;if(a&&H+1>a)return;let{structures:Z,structureId:J,matchUps:ie,links:K}=nT({finishingPositionOffset:H,exitProfile:`${l}-${W}`,roundOffset:d+W,stageSequence:o+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(V.structureId&&J){let ne={linkType:Ph,source:{roundNumber:W,structureId:V.structureId},target:{roundNumber:1,feedProfile:Su,structureId:J}};K&&V&&K.push(ne),K?.length&&T.push(...K)}return Z?.length&&w.push(...Z),ie?.length&&I.push(...ie),{structureId:J,childLinks:K,structures:w}}}function uq({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=si({drawDefinition:t,structureId:i});if(r.error)return ce({result:r});let{matchUps:n}=rr({structure:r.structure,matchUpsMap:e});return{...fo({matchUps:n}),matchUps:n,matchUpsMap:e}}function OY({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=uq({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(Uoe(r?.[a]).forEach(s=>{t.forEach(o=>{dAe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function dAe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return vt(i,(r||i)+1).includes(t)}function Uoe(t){return[vi(t?.finishingPositionRange?.loser||[]),vi(t?.finishingPositionRange?.winner||[])]}function pAe(t){return Uoe(t).map(e=>vt(e[0],e[1]&&e[1]+1||e[0]+1))}function JU({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:be,context:{structureIds:e}};if(!t)return{error:Nt};e=e??(t.structures??[]).filter(a=>a.stage!==Ht).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=uq({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(pAe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(Jn).flat();return{positionsNotPlayedOff:vi(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Doe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:Nt};if(!r)return{error:dc};if(!e)return{error:Wt,info:"missing playoffPositions"};let n=JU({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=OY({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ii(v)).filter(v=>!t.includes(v)),c=OY({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ii(v)):[],p=l.filter(v=>!d.includes(v)).sort(Jn),{roundProfile:h}=uq({drawDefinition:i,structureId:r}),f=p.map(v=>{let y=h?.[v].finishingPositionRange.loser,[b,I]=y??[0,0];return vt(b,(I||b)+1)}).flat().sort(Jn),{playoffRoundsRanges:m}=hAe({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function hAe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=vt(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function Y1({drawDefinition:t,structureId:e}){if(!t)return{error:Nt};let{matchUps:i,matchUpsMap:r}=lo({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=JU({drawDefinition:t,matchUpsMap:r}),{structures:s}=ju({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==La||c.structureId===e),l={};for(let c of o){let u=c?.structureId,d=fAe({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function fAe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=qU({drawDefinition:e,structureId:n});if(i.structureType===wo||i.structures){let h=Sr({structure:i})?.positionAssignments?.length,f=i.structures.length,m=(h??0)/f,g=a.source?.flatMap(({source:E})=>E?.finishingPositions||[])||[],v=vt(1,m+1).filter(E=>!g.includes(E)),y=r.find(E=>E.containerStructureId===n&&E.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],b=a?.source.map(({target:E})=>E.structureId),{positionsPlayedOff:I=[],positionsNotPlayedOff:w=[]}=JU({structureIds:b,drawDefinition:e}),T=[...I,...w],S=vt(y[0],y[1]+1).filter(E=>!T.includes(E)),D=Ca(S,S.length/v.length),C=v.map((E,P)=>{let R=D[P],M=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:E,finishingPositions:R,finishingPositionRange:M}});return{positionsNotPlayedOff:S,playoffFinishingPositionRanges:C,finishingPositionsAvailable:v,finishingPositionsPlayedOff:g,positionsPlayedOff:I,groupCount:f,groupSize:m}}let s=a?.source?.filter(h=>h.linkCondition!==gp).map(h=>h.source?.roundNumber)||[],o=a?.source?.filter(h=>h.linkCondition===gp).map(h=>h.source?.roundNumber)||[],l=Doe({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),c=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,u=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let h of o){let f=a?.source.find(b=>b.source.roundNumber===h),m=f?.target.roundNumber,g=f?.target.structureId,v=r.filter(({roundNumber:b,structureId:I})=>I===g&&b===m),y=v.filter(({sides:b})=>b.find(I=>I.participantFed&&!I.participantId)).length;if(c&&y===v.length){c.push(h);let b=d?.[h]?.finishingPositionRange?.loser;if(b){let I=Math.min(...b),w=I+y,T=vt(I,w),S={finishingPositionRange:[I,w-1].join("-"),finishingPositions:T,roundNumber:h};u.push(S)}}}return c&&c.sort(Jn),u.sort((h,f)=>h.roundNumber-f.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function mAe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:Nt};if(!jr(i)||!Array.isArray(t))return{error:be};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:Y1({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function Eoe(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Ut,matchUpType:o,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:o,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=n?hg(h):bp(h),m=Ac({structureName:a||i?.["0"]?.name||gs(Ut),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:f,stage:s}),g=[m],v=[];if(u>2){let y=u/2,{matchUps:b}=bp({finishingPositionOffset:e+y,idPrefix:c&&`${c}-c`,drawSize:y,matchUpType:o,isMock:d}),I=gs(bs),w=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${I}`:I),T=Ac({structureName:w,matchUps:b,structureId:p?.pop(),stage:bs,stageSequence:1,matchUpType:o});g.push(T);let S={linkType:Ph,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Su,structureId:T.structureId}};v.push(S)}return{...se,structures:g,links:v}}function Poe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return vt(1+e,r+1+e).map(c=>{let u=l?.[c-1]?l[c-1]:c%2&&Su||Zv,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:Ph,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=o[c-1];return h&&(p.target.groupedOrder=h),ac()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=gp,p.target.feedProfile=Su),s.includes(d)?p:void 0}).filter(Boolean)}function Coe(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Ut,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=s?hg(f):bp(f),v=t.structureName??n?.["0"]?.name??gs(Ut),y=ig({structureId:c||h?.pop(),structureName:v,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),b=[y],I=[];if(u>2){let w=[0,2].slice(0,u/16).map((T,S)=>{let D=S+1,{consolationStructure:C}=gAe({idPrefix:d&&`${d}-c${S}`,structureId:h?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:D,roundOffset:T,matchUpType:l,drawSize:u,isMock:p,index:S,uuids:h});b.push(C);let E=Poe({consolationStructure:C,roundsCount:2,mainStructure:y,roundOffset:T});return{consolationStructure:C,links:E}}).map(T=>T.links).flat();if(I.push(...w),u>=4&&u<=16||u>32){let{matchUps:T}=bp({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),S=n?.["3-4"]?.name??gs(In),D=a?.[S]||S,C=e?`${e} ${D}`:D,E=ig({structureId:h?.pop(),matchUps:T,stageSequence:2,stage:In,structureName:C,matchUpType:l}),P={linkType:Ph,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:E.structureId,feedProfile:Su,roundNumber:1}};b.push(E),I.push(P)}}return{structures:b,links:I,...se}}function gAe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:h,roundsCount:f}=hg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),m=u===0&&i?.["0-1"]?.name||u===1&&i?.["0-3"]?.name||`${gs(bs)} ${u+1}`,g=r?.[m]||m,v=t?`${t} ${g}`:g;return{consolationStructure:ig({matchUps:h,stage:bs,structureName:v,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:f}}function yb(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Ut,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||t.policyDefinitions?.[PT]||t.appliedPolicies?.[PT],y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=a?hg(y):bp(y),I=Ac({structureName:s||r?.["0"]?.name||gs(Ut),structureId:l||m?.pop(),stageSequence:i,matchUpType:c,matchUps:b,stage:o}),w=[I],T=[],S=h/2,{matchUps:D,roundsCount:C}=hg({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let E=r?.["0-1"]?.name??gs(bs),P=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${E}`:E,R=Ac({matchUps:D,structureId:m?.pop(),stage:bs,stageSequence:1,structureName:P,matchUpType:c});w.push(R);let M=Poe({consolationStructure:R,mainStructure:I,roundsCount:C,feedPolicy:v,fmlc:g});T.push(...M)}return{...se,structures:w,links:T}}function Roe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){c=c||n?.[PT];let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=mAe({structureId:r,drawDefinition:s,playoffGroups:o});if(b)return ce({result:{error:b},stack:f});if(!(!I||o?.every(w=>{let{finishingPositions:T=[]}=w;if(!T.length)return!1;let S=[...T].sort(Jn).map((D,C)=>(T[C+1]||D)-D).every(D=>D<2);return(!t||S)&&T.every(D=>I[D])})))return ce({context:{validFinishingPositions:Object.values(I)},result:{error:be},stack:f});for(let w of o){let T=w.finishingPositions,S=I&&T.map(N=>I[N]?.finishingPositions).flat(),D=u*T.length,C=RU(D),E=C===2&&ip||w.drawType||ip;S&&(m=Math.min(...S)-1);let P=S&&`${Math.min(...S)}-${Math.max(...S)}`,R=w.structureName||P&&w.playoffAttributes?.[P]?.name||w.playoffAttributes?.["0"]?.name,M={addNameBaseToAttributeName:w.addNameBaseToAttributeName,playoffStructureNameBase:w.playoffStructureNameBase,finishingPositionNaming:w.finishingPositionNaming,finishingPositionLimit:w.finishingPositionLimit,structureId:w.structureId??h?.pop(),playoffAttributes:w.playoffAttributes,structureNameMap:w.structureNameMap,sequenceLimit:w.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:In,stageSequence:a,matchUpType:l,drawSize:C,isMock:p,uuids:h},A=({playoffStructures:N,playoffLinks:k})=>{let[x]=N,O=yM({playoffStructureId:x.structureId,finishingPositions:T,sourceStructureId:r});y.push(O),y.push(...k),v.push(...N),g.push({structureId:x.structureId,finishingPositions:T}),m+=D};if(E===ip){let{matchUps:N}=bp({finishingPositionLimit:m+D,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:C,isMock:p,uuids:h}),k=Ac({structureId:w.structureId??h?.pop(),matchUpFormat:e,stage:In,structureName:R,stageSequence:a,matchUps:N});v.push(k);let x=yM({playoffStructureId:k.structureId,finishingPositions:T,sourceStructureId:r});y.push(x),m+=D,g.push({structureId:k.structureId,finishingPositions:T})}else if([TT,UT,In].includes(E)){let N={playoffAttributes:w.playoffAttributes??i,playoffStructureNameBase:w.playoffStructureNameBase,structureId:w.structureId??h?.pop(),structureName:w.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:In,roundOffset:0,stageSequence:a,drawSize:C,isMock:p,uuids:h};E===TT?Object.assign(N,{playoffAttributes:w?.playoffAttributes??i??LH,roundOffsetLimit:3}):E===UT&&Object.assign(N,{playoffAttributes:w?.playoffAttributes??i??FH,roundOffsetLimit:2});let k=nT(N);if(k.error)return k;if(k.links?.length&&y.push(...k.links),k.structures?.length&&v.push(...k.structures),v.sort(WI),k.structureId){let x=yM({playoffStructureId:k.structureId,finishingPositions:T,sourceStructureId:r});y.push(x),g.push({structureId:k.structureId,finishingPositions:T})}m+=D}else if([DT,g1,OP,kP,_P,xP].includes(E)){let N=[h?.pop(),h?.pop()],k={playoffStructureNameBase:w.playoffStructureNameBase,structureId:w.structureId??h?.pop(),playoffAttributes:w.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:In,structureName:R,matchUpType:l,feedPolicy:c,drawSize:C,isMock:p},x={[DT]:{fmlc:!0,feedRounds:1},[xP]:{feedRounds:1},[OP]:{feedsFromFinal:3},[kP]:{feedsFromFinal:2},[_P]:{feedsFromFinal:1}};Object.assign(k,x[E]||{});let{structures:O,links:V}=yb(k),[F]=O,j=yM({playoffStructureId:F.structureId,finishingPositions:T,sourceStructureId:r});y.push(j),y.push(...V),v.push(...O),g.push({structureId:F.structureId,finishingPositions:T}),m+=D}else if([$u].includes(E)){let{structures:N,links:k}=j1({...M,structureOptions:w.structureOptions||{groupSize:4}});A({playoffStructures:N,playoffLinks:k})}else if([m1].includes(E)){let{structures:N,links:k}=Eoe(M);A({playoffStructures:N,playoffLinks:k})}else if([JRe].includes(E)){let{structures:N,links:k}=Coe(M);A({playoffStructures:N,playoffLinks:k})}else if([Pl].includes(E)){let N=Ac({structureId:w.structureId??h?.pop(),structureName:w.structureName,finishingPosition:hN,stage:In,stageSequence:a,matchUps:[]});A({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function yM({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Dh,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:wu,roundNumber:1}}}function vAe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ce({result:{error:Wt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:c}=t,u=Roe({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(u.error)return ce({result:u,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:h,positionRangeMap:f}=u,m=h?.map(({finishingPositions:D})=>D).flat().map(D=>f[D].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=zn({inContext:!0,drawDefinition:a}),y=d.map(({structureId:D})=>D),b=g?.filter(({structureId:D})=>y.includes(D)).map(Ea),I=v?.drawMatchUps?.filter(({matchUpId:D})=>b?.includes(D));if(I?.length){let D=Ks({drawDefinition:a,event:c})?.tieFormat;D&&I.forEach(C=>{let{tieMatchUps:E}=ow({isMock:t.isMock,tieFormat:D,matchUp:C});Object.assign(C,{tieMatchUps:E,matchUpType:rc})})}let{positionAssignments:w}=Sr({structureId:i,drawDefinition:a}),T={};w?.forEach(D=>{let C=Pi({element:D,name:qf})?.extension?.value?.groupOrder;C&&(T[C]||(T[C]=[]),T[C].push(D.participantId))});let S=XU({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return S.error&&S.error?.code!==KG.code?ce({result:S,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...se}}function HS({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var Moe="NTRP",Noe={ELO:"ELO",NTRP:Moe,TRN:"TRN",UTR:"UTR",WTN:"WTN"},yAe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Moe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Ua=yAe;function bAe({sourceRatingType:t,sourceRating:e}){let i=Ua[t].range,r=i[0]>i[1],n=Ua.ELO.range;return HS({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function IAe({targetRatingType:t,sourceRating:e}){let i=Ua[t].decimalsCount||0,r=Ua[t].range,n=r[0]>r[1],a=Math.max(...r),s=Ua.ELO.range,o=HS({targetRange:r,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return n?a-l:l}function xY(t){let e=jt(t,[{ratings:!0,[Fo]:Ko}]);if(e.error)return e;let i=t.matchUpType&&[Ir,fr].includes(t.matchUpType)?t.matchUpType:Ir,r=Object.keys(Ua),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((d,p)=>d.includes(p.scaleName)?d:d.concat(p.scaleName),[]):[];if(!a)return{error:ja};let s=t.ratings[i]?.find(d=>d.scaleName===n)??t.ratings[i][0];if(a[0]===n)return s;let o=s.scaleName,l=Ua[s.scaleName].accessor,c=l?s.scaleValue[l]:s.scaleValue,u=bAe({sourceRatingType:o,sourceRating:c});return{convertedRating:IAe({targetRatingType:n,sourceRating:u}),sourceRating:c}}function wAe({participantResults:t,sides:e,score:i}){let r=e.find(({sideNumber:o})=>o===1),n=e.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[Ir]&&s?.[Ir]){let o="ELO",{convertedRating:l}=xY({ratings:a,targetRatingType:o}),{convertedRating:c}=xY({ratings:s,targetRatingType:o}),{side1pressure:u,side2pressure:d}=SAe({side1ConvertedRating:l,side2ConvertedRating:c,score:i});u&&t[r?.participantId].pressureScores.push(u),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Ua.ELO.range),h=cA((c-l)/p),f=cA((l-c)/p);t[r?.participantId].ratingVariation.push(h),t[n?.participantId].ratingVariation.push(f)}}function SAe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),s=Ua.ELO.range,o=Math.max(...s),l=(o-r)*0,c=(r+l)/o*a,u=i?.sets?.reduce((y,b)=>y+(b?.side1Score??0),0),d=i?.sets?.reduce((y,b)=>y+(b.side2Score??0),0),p=t>e?2:1,h=(u||0)*(n+(p===1?c:0)),f=(d||0)*(n+(p===2?c:0)),m=h+f,g=m?cA(h/m):0,v=m?cA(f/m):0;return{side1pressure:g,side2pressure:v}}function dq({winningSide:t,matchUpFormat:e=Eu,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=Bs(e),c=pq(l?.bestOf??1);if(typeof o=="number"&&(i===yr&&r?.setsCreditForDefaults||i===xr&&r?.setsCreditForWalkovers))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===Ia&&(+a[1-o]===c&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=c)),a}function Aoe({matchUpFormat:t=Eu,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=Bs(t),l=o?.bestOf??1,c=pq(l),u=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===yr&&r?.gamesCreditForDefaults||i===xr&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,h=c*p;d[s].push(h)}else a.forEach((p,h)=>{let f=(p.setNumber||h+1)>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[f]?.based,g=o?.[f].tiebreakSet,{side1Score:v,side2Score:y}=p;LY(m)&&!g&&(d[0].push(ii(v||0)),d[1].push(ii(y||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===Ia&&typeof s=="number"){let p=a.length>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[p];if(LY(h.based)){let f=h?.setTo||0,m=v=>{if(!(!o||v===""))return+v===u-1||+v===u?ii(u||0)+1:+v<u?f:u},g=dq({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(v=>v[s]<=v[1-s]).reduce((v,y)=>v+(y?1:0),0)>g[1-s]){let v=d[s].length,y=m(d[1-s][v-1]);y&&(d[s][v-1]=y)}c>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(f)}}return[d[0].reduce((p,h)=>p+h,0),d[1].reduce((p,h)=>p+h,0)]}function _oe({matchUpFormat:t,score:e}){let i=t?Bs(t):void 0,r=i?.bestOf??1,n=pq(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let c=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",u=i?.[c]?.based;if(koe(u)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=ii(d||0)),p&&(s[1]+=ii(p||0))}else o.side1TiebreakScore&&(s[0]+=ii(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=ii(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function pq(t){return t&&Math.ceil(t/2)||1}function koe(t){return t==="P"}function LY(t){return!koe(t)}function TAe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&Bs(i)||{},l=o.bestOf,c=l&&Math.ceil(l/2)||1,u=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let h=t[p].setsWon,f=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*c||h+f,g=Math.round(h/m*d)/d;(g===1/0||isNaN(g))&&(g=m);let v=t[p].tieMatchUpsWon,y=t[p].tieMatchUpsLost,b=v+y,I=Math.round(v/b*d)/d;(I===1/0||isNaN(I))&&(I=v);let w=t[p].matchUpsWon,T=t[p].matchUpsLost,S=w+T,D=Math.round(w/S*d)/d;(D===1/0||isNaN(D))&&(D=w);let C=t[p].gamesWon||0,E=t[p].gamesLost||0,P=(a||0)*c*(u||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(P,C+E),M=Math.round(C/R*d)/d;(M===1/0||isNaN(M))&&(M=0);let A=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/A*d)/d;(N===1/0||isNaN(N))&&(N=0),t[p].setsWon=h,t[p].setsLost=f,t[p].setsPct=g,t[p].tieMatchUpsWon=v,t[p].tieMatchUpsPct=I,t[p].matchUpsPct=D,t[p].gamesWon=C,t[p].gamesLost=E,t[p].gamesPct=M,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function K1({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],c=s?.filter(h=>(h.tieMatchUps||!l.includes(h.matchUpStatus))&&(!t?.length||Un(t,[zS(h,0),zS(h,1)]).length===2)),u=c?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):h?.sets?.length??0)?.reduce((h,f)=>h+f,0),d=h=>h?.sets?.reduce((f,m)=>f+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=c?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(h))?.reduce((h,f)=>h+f,0);for(let h of c??[]){let{matchUpStatus:f,tieMatchUps:m,tieFormat:g,score:v,winningSide:y,sides:b}=h,I=g&&h._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:S})=>S),w=y&&UAe(h),T=y&&DAe(h);if(!w&&!T)if(f&&Hn.includes(f)){let S=zS(h,0),D=zS(h,1);S&&(qm(o,S),o[S].matchUpsCancelled+=1),D&&(qm(o,D),o[D].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let S of m){if(S.winningSide){let D=b?.find(({sideNumber:E})=>E===S.winningSide)?.participantId,C=b?.find(({sideNumber:E})=>E===S.winningSide)?.participantId;D&&C&&(qm(o,D),qm(o,C),o[D].tieMatchUpsWon+=1,o[C].tieMatchUpsLost+=1,kn(Ir)(S.matchUpType)?(o[D].tieSinglesWon+=1,o[C].tieSinglesLost+=1):kn(fr)(S.matchUpType)&&(o[D].tieDoublesWon+=1,o[C].tieDoublesLost+=1))}FY({score:S.score,manualGamesOverride:I,participantResults:o,sides:b})}}else FY({manualGamesOverride:I,participantResults:o,score:v,sides:b});else if(qm(o,w),qm(o,T),m?.length){a=0;for(let S of m){let{matchUpType:D}=S,C=kn(fr)(D),E=kn(Ir)(D);S.winningSide&&(S.winningSide===y?(w&&(o[w].tieMatchUpsWon+=1,E&&(o[w].tieSinglesWon+=1),C&&(o[w].tieDoublesWon+=1)),T&&(o[T].tieMatchUpsLost+=1,E&&(o[T].tieSinglesLost+=1),C&&(o[T].tieDoublesLost+=1))):S.winningSide!==y&&(T&&(o[T].tieMatchUpsWon+=1,E&&(o[T].tieSinglesWon+=1),C&&(o[T].tieDoublesWon+=1)),w&&(o[w].tieMatchUpsLost+=1,E&&(o[w].tieSinglesLost+=1),C&&(o[w].tieDoublesLost+=1)))),BY({matchUpFormat:S.matchUpFormat,matchUpStatus:S.matchUpStatus,matchUpType:S.matchUpType,score:S.score,sides:S.sides,winningParticipantId:w,losingParticipantId:T,manualGamesOverride:I,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:y})}Ooe({winningParticipantId:w,losingParticipantId:T,participantResults:o,matchUpStatus:f})}else BY({matchUpFormat:h.matchUpFormat??r,matchUpType:h.matchUpType,isTieMatchUp:void 0,winningParticipantId:w,manualGamesOverride:I,losingParticipantId:T,participantResults:o,pressureRating:e,matchUpStatus:f,tallyPolicy:n,winningSide:y,score:v,sides:b});if(I){let S=v?.sets?.reduce((P,R)=>P+(R?.side1Score??0),0),D=v?.sets?.reduce((P,R)=>P+(R.side2Score??0),0),C=b?.find(({sideNumber:P})=>P===1)?.participantId,E=b?.find(({sideNumber:P})=>P===2)?.participantId;qm(o,C),qm(o,E),C&&(o[C].gamesWon+=S,o[C].gamesLost+=D),E&&(o[E].gamesWon+=D,o[E].gamesLost+=S)}}return TAe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:u}),{participantResults:o}}function UAe(t){let e=t.winningSide-1;return zS(t,e)}function DAe(t){let e=1-(t.winningSide-1);return zS(t,e)}function zS(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function qm(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function FY({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(ii(u||0)),a[1].push(ii(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(qm(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function BY({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let h=u&&u-1,f=1-h;n&&l===Ir&&wAe({participantResults:r,sides:p,score:d}),o||Ooe({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=dq({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=Aoe({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=_oe({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[h],r[t].setsLost+=m[f],e||(r[t].gamesWon+=g[h],r[t].gamesLost+=g[f]),r[t].pointsWon+=v[h],r[t].pointsLost+=v[f]),i&&(r[i].setsWon+=m[f],r[i].setsLost+=m[h],e||(r[i].gamesWon+=g[f],r[i].gamesLost+=g[h]),r[i].pointsWon+=v[f],r[i].pointsLost+=v[h])}function Ooe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===xr&&(i[e].walkovers+=1),r===yr&&(i[e].defaults+=1),r===Ia&&(i[e].retirements+=1),As(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function EAe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function PAe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(c,u)=>Number.parseFloat(t.reversed?c:u)-Number.parseFloat(t.reversed?u:c),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let c=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(c)}EAe(t,i,r,n)}r.push("----------------------")}function CAe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{PAe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function xoe({participantResults:t,participantIds:e,attribute:i}){return Loe({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function Loe(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var RAe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],x2={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function $Y(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!MAe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=xoe({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=Foe({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=v+1,d=g.position):(c&&y>c&&(d+=u,u=0),g.position=d,u+=1),c=y});let h=l.map(({position:g})=>g),f=Ul(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];g?.position!==void 0&&(I>1&&(g.ties=I,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(n?.GEMscore)?Object.keys(x2).filter(v=>n.GEMscore.includes(v)):Object.keys(x2)).map(v=>(g[v]||0)*Math.pow(10,x2[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function MAe({participantResults:t,participantsCount:e}){let i=Loe({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function NAe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:c}=K1({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=xoe({participantResults:c,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:u,idsFilter:s,groupTotals:r}],p;return Object.keys(u).length>1&&e.length&&(p=Object.keys(u).map(h=>parseFloat(h)).sort((h,f)=>l?h-f:f-h).map(h=>u[h]).map(h=>{let f=Foe({participantResults:c,disableHeadToHead:t,participantIds:h,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...f.report??[]),f.order}).map((h,f)=>h.map(m=>m.resolved?m:{...m,subGroup:[f].concat(...m.subGroup??[])})).flat()),{order:p,report:d}}function Foe({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let u=AAe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=(n?.tallyDirectives||RAe).filter(u=>{let d=!(gn(u.maxParticipants)&&i?.length>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,groupTotals:h,disableHeadToHead:f})=>(l=NAe({disableHeadToHead:f,participantIds:i,matchUpFormat:r,groupTotals:h,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(u=>({participantId:u})),report:o}}function AAe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function QU({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!Kc(n))return{error:hm};let o=vi(n.map(({structureId:I})=>I));if(o.length!==1)return ce({result:{error:be,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(I=>I&&I.matchUpStatus!=="BYE"),c=l.length&&vi(l.map(({drawPositions:I})=>I).flat()).length,u=l.filter(I=>Lv({matchUp:I})).length===l.length;u||(s=0);let d=n.every(({matchUpType:I,tieMatchUps:w})=>I===_r&&w?.every(T=>Lv({matchUp:T}))),p=t?.[YH],h=n.filter(I=>Lv({matchUp:I})??I.matchUpType===_r),{participantResults:f}=K1({matchUps:h,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=$Y({matchUps:h,participantResults:f,participantsCount:c,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&_Ae({participantResults:f}),u&&v)m=y,g=v,v.forEach(I=>{let{participantId:w,groupOrder:T,rankOrder:S,subOrder:D,ties:C,GEMscore:E}=I,P=f[w];Object.assign(P,{groupOrder:T,rankOrder:S,GEMscore:E,subOrder:D,ties:C})});else{let{groupOrder:I,report:w}=$Y({requireCompletion:!1,participantResults:f,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=w,g=I,I&&I.forEach(T=>{let{participantId:S,groupOrder:D,GEMscore:C}=T,E=f[S];Object.assign(E,{provisionalOrder:D,GEMscore:C})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=g),e||ac({tally:!0})){let I=CAe({matchUps:n,report:m,order:g});ac({tally:!0})&&console.log(I),b.readableReport=I}return b}function _Ae({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function Boe({positionAssignments:t}){let e=(t||[]).filter(Rl(Rh)).map(n=>{let{extension:a}=Pi({element:n,name:CT}),s=ii(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Ul(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function hq({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Kc(n))return{error:be};if(!t)return{error:be};let{policyDefinitions:s}=gm({policyTypes:[YH],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=Boe({positionAssignments:t}),l=n.length?QU({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:qf};ir({element:h,extension:m}),c[f].ties||oo({element:h,name:CT})}else oo({element:h,name:qf}),oo({element:h,name:CT})}),Pr({drawDefinition:i}),{...se,participantResults:c,bracketComplete:u,report:d}}function $oe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function Hr(t){let e=jt(t,[{[$s]:!0,[kp]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=ju({drawDefinition:a}),p=t.contextContent||n&&vm({contextProfile:n,drawDefinition:a});for(let h of d){let{matchUps:f}=rr({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:h,context:c,event:u}),{matchUp:m}=$oe({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:Os}}function MO(t){return!ji(t)||!t.notes?{error:Wt}:ji(t.element)?!jr(t.notes)&&!t.notes?.testing?{error:be}:(Object.assign(t.element,{notes:t.notes}),{...se}):{error:be}}function fq(t){return ji(t)?ji(t.element)?(t.element.notes&&delete t.element.notes,{...se}):{error:be}:{error:Wt}}var NO={matchUpStatus:Dn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function np(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:c,winningSide:u,matchUpId:d,event:p,notes:h,score:f}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:Qi({policyTypes:[Bc],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===_r;if(g&&o){if(d&&r.matchUpId!==d){let S=Hr({drawDefinition:o,matchUpId:d,event:p});if(!S.matchUp)return{error:Os};({matchUp:r,structure:n}=S)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[xr,on].includes(l)||c?Object.assign(r,{...NO}):f&&(r.score=f);let v=l&&r?.matchUpStatus===yr&&l!==yr;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),u&&(r.winningSide=u),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=Hr({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&sa(r)&&!Hn.includes(l)&&![qI,Fg,Cl].includes(l)&&(r.matchUpStatus=Zu);let y;if((v&&r?.processCodes?.length||l===yr)&&(y=m?.[Bc]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let S=n?.structureType===wo,D=Ao({structure:n});if(Cz({drawDefinition:o,structure:n})||D||S){let C=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let M=g?{matchUpTypes:[_r]}:void 0,{matchUps:A}=rr({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:M,drawDefinition:o,structure:R,event:p});return D&&(R.positionAssignments=vi(A.flatMap(N=>(N.sides??[]).map(k=>k.participantId)).filter(Boolean)).map(N=>({participantId:N}))),hq({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:A,event:p})},E=S&&n.structures.find(R=>R?.matchUps.find(M=>M.matchUpId===d)),P=C(E||n);if(P.error)return ce({result:P,stack:e})}}if(h){let S=MO({element:r,notes:h});if(S.error)return ce({result:S,stack:e})}let b=s?.tournamentId,I=pc().topics.includes(oO),w=(I||y)&&is({drawDefinition:o}),T=w&&zn({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:w}).matchUps?.[0];if(I&&T&&_0e({tournamentId:b,inContextMatchUp:T}),Array.isArray(y)&&T&&!T.sides?.every(({participantId:S})=>S))if(l===yr)r.processCodes=vi([...r.processCodes??[],...y]);else for(let S of y||[]){let D=S&&r?.processCodes?.lastIndexOf(S);r?.processCodes?.splice(D,1)}return Gi({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:r}),{...se}}function mq(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,c=x1({matchUpStatus:a})||[xp,rl].includes(a)&&s||r,u=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(Ao({structure:o})&&u===1||a===yr&&u||kAe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[Bc]?.requireParticipantsForScoring===!1||As(a)&&u===1&&e))return ce({result:{error:iH},stack:d});let p=[xr].includes(a),h=c?a:t.winningSide&&Sn||Cl,f=np({...t,winningSide:t.winningSide,matchUpStatusCodes:c&&i||[],matchUpStatus:h,removeScore:p});return ce({result:f,stack:d})}function kAe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=aa({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function Voe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>fi(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>ii(r));return{groupValueGroups:e,groupValueNumbers:i}}function OAe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>Hn.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),fi(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):fi(m)?a.forEach(y=>{y.score?.sets?.forEach(b=>{b.winningSide&&(s[b.winningSide-1]+=m)})}):fi(f)?a.forEach(y=>{y.score?.sets?.forEach(b=>{let{side1TiebreakScore:I=0,side2TiebreakScore:w=0,side1Score:T=0,side2Score:S=0}=b;(y.matchUpStatus===Sn||y.winningSide||b.winningSide)&&(T||S?(s[0]+=T,s[1]+=S):(I||w)&&b.winningSide&&(s[b.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=xAe({collectionDefinition:t,collectionPosition:b});fi(I)&&(s[y.winningSide-1]+=I)}}),fi(d)){let y;if(h?.aggregateValue)l&&(fi(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h?.valueGoal)y=s.reduce((b,I,w)=>I>=h.valueGoal?w+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,w,T)=>w>=b?T+1:I,0)}y&&(g?i[u].values[y-1]+=d:o[y-1]+=d)}else g?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((y,b)=>r[b]+=y||0)}function xAe({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function Z1(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((I,w)=>I+w)))return{error:be};if(!s)return{error:Mo};let l=Ks({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:_U};let c=No({tieFormat:l});if(c.error)return c;let u=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=Voe(l);for(let I of u)OAe({collectionDefinition:I,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let I of f){let w=h[I],{allGroupMatchUpsCompleted:T,matchUpCount:S,winCriteria:D,groupValue:C,sideWins:E,values:P}=w,R;if(D?.aggregateValue)T&&P[0]!==P[1]&&(R=P[0]>P[1]?1:2);else if(D?.valueGoal)R=P.reduce((M,A,N)=>A>=D.valueGoal?N+1:M,void 0);else{let M=Math.floor(S/2)+1;R=E.reduce((A,N,k)=>N>=M?k+1:A,void 0)}R&&(p[R-1]+=C||0)}let m=p.map((I,w)=>(I||0)+e[w]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l?.winCriteria){let{valueGoal:I,aggregateValue:w,tallyDirectives:T}=l.winCriteria;if(I?b=m.map((S,D)=>({sideNumber:D+1,points:S})).find(({points:S})=>S>=I)?.sideNumber:w&&d.every(S=>S.matchUpStatus&&Hn.includes(S.matchUpStatus)||S.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&T){let S=s.matchUpId,D=s.hasContext?s:n?.drawMatchUps?.[S]||r&&Hr({inContext:!0,drawDefinition:r,matchUpId:S})?.matchUp;if(D){let{completedTieMatchUps:C,order:E}=QU({matchUps:[D]});if(C&&E?.length){let P=E[0].participantId;b=D.sides.find(({participantId:R})=>R===P)?.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function X1({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=Hr({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=Pi({element:e,name:Hf}),s=Tt(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:c,sideNumber:u})=>({drawPosition:c,sideNumber:u,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let c=l.participantId,u=c&&s[c]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:f})=>f===l.sideNumber)??{},h=d?.length?d:u;return{...o(l),...p,lineUp:h}}),Gi({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function os(t){if(t)return Tt(t,!1,!0)}function gq(t){let e=jt(t,[{[xs]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function joe({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=gq({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function ym(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||t.tournamentRecord?.tournamentId;l&&joe({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:Qe};let d=Hr({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:Os};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:il};X1({tournamentId:u?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Pi({name:oI,element:p});if(f?.value)if(n)oo({element:p,name:oI});else return{...se,score:p.score};let m=Ks({drawDefinition:i,structure:h,matchUp:p,event:o})?.tieFormat;p.tieFormat=os(m);let g=Z1({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:o}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,w=y?.side1Score||y?.side2Score;if(e&&!p.score&&!w)return{...se};let T={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},S=v&&[1,2].includes(v),D=S&&Sn||Oz({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:T})&&Zu||Dn,C=!!(p.winningSide&&!S),E=p.tieMatchUps.find(({score:R,winningSide:M,matchUpStatus:A})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||A&&Hn.includes(A)||M),P;if(p.tieFormat&&!S&&!E){let R=Ks({drawDefinition:i,structure:h,event:o})?.tieFormat;R&&JSON.stringify(m)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return np({appliedPolicies:t.appliedPolicies,matchUpStatus:D,score:T,removeWinningSide:C,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:s,matchUp:p,event:o}),{...se,score:T,removeWinningSide:C,tieFormatRemoved:P,winningSide:v}}function LAe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){let h="directWinner";if(s){let f=c.drawPositions||[],m=f[t],g=s.source.structureId,v=si({structureId:g,drawDefinition:l});if(v.error)return v;let{structure:y}=v,{positionAssignments:b}=aa({structureId:g,drawDefinition:l}),I=b?.find(E=>E.drawPosition===n)?.participantId,w=s.target.structureId,{positionAssignments:T}=aa({structureId:w,drawDefinition:l}),S=T?.find(E=>E.participantId===I)?.drawPosition,D=T?.filter(E=>{let P=f.includes(E.drawPosition),R=!E.participantId&&!E.bye&&!E.qualifier;return P&&R}).map(E=>E.drawPosition),C=D?.includes(m);if(I&&s.target.roundNumber===1&&C)yp({drawPosition:m,participantId:I,structureId:w,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(I&&D?.length){let E=D.pop();E&&yp({participantId:I,structureId:w,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:E,matchUpsMap:d,event:p})}else if(S){let E=Ob({drawPosition:S,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(E.error)return ce({result:E,stack:h})}else if(y?.stage!==Ht){let E="winner target position unavaiallble";console.log(E),ce({stack:h,result:{error:E}})}if(y?.seedAssignments&&y.structureId!==w){let E=y.seedAssignments.find(({participantId:R})=>R===I),P=E?.participantId;E&&P&&ZU({eventId:c?.eventId,structureId:w,...E,tournamentRecord:a,drawDefinition:l,participantId:P})}}else{let f=Ob({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(f.error)return f}if(u&&i){let f=u.sides?.find(m=>m.sideNumber===i);if(f?.lineUp){let m=u.roundPosition,g=c.roundPosition,v=m===g&&m!==1||Math.floor(m/2)===g?2:1,y=d?.drawMatchUps?.find(({matchUpId:w})=>w===c.matchUpId),b=[1,2].map(w=>({...y.sides?.find(T=>T.sideNumber===w)||{},sideNumber:w}));y.sides=b;let I=y.sides.find(w=>w.sideNumber===v);if(I){let w=f.lineUp?.filter(T=>T?.participantId);I.lineUp=Zz({lineUp:w}),Gi({tournamentId:a?.tournamentId,eventId:c?.eventId,matchUp:y,context:h,drawDefinition:l})}}}return{...se}}function FAe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:h}=t,f="directLoser",m=l.linkCondition,g=u.drawPositions||[],v=m===gp&&u.roundNumber===2&&Math.min(...g.filter(Boolean)),y=v||g[e],b=v||g[1-e],I=l.source.structureId,{structure:w}=si({structureId:I,drawDefinition:c}),{matchUps:T}=rr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:w,event:h}),S=T.filter(z=>z.drawPositions?.includes(s)).filter(z=>{let H=z.sides.find(J=>J.drawPosition===s),Z=z.matchUpStatus===xr||z.matchUpStatus===yr&&!sa(z);return H?.sideNumber===z.winningSide&&!Z}),D=m===gp&&S.length===0,{positionAssignments:C}=aa({structureId:I,drawDefinition:c}),E=C?.find(z=>z.drawPosition===s)?.participantId,P={loserParticipantId:E},R=l.target.structureId,{positionAssignments:M}=aa({structureId:R,drawDefinition:c}),A=M?.filter(({drawPosition:z})=>g.includes(z)),N=A?.some(z=>z.participantId&&E&&z.participantId===E),k=n&&[Ia,xr,yr].includes(a||"");if(N)return{...se,stack:f};let x=A?.filter(z=>{let H=g.includes(z.drawPosition),Z=!z.participantId&&!z.bye&&!z.qualifier;return H&&Z}).map(z=>z.drawPosition),O=x?.includes(y),V=l.target.roundNumber>1&&x?.length,F=l.target.roundNumber===1&&O;if(v){let z=j();if(z.context&&Object.assign(P,z.context),z.error)return ce({result:z,stack:f})}else if(F){let z=W();if(z.context&&Object.assign(P,z.context),z.error)return ce({result:z,stack:f})}else if(E&&V){x.sort(Jn);let z=x[0],H=yp({participantId:E,structureId:R,drawPosition:z,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:h});if(H.error)return ce({result:H,stack:f});if(!H.error&&k&&n)return{stack:f,context:{progressExitStatus:!0,loserParticipantId:E}}}else return ce({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:O},result:{error:O?MU:_1e},stack:f});if(w?.seedAssignments&&w.structureId!==R){let z=w.seedAssignments.find(({participantId:Z})=>Z===E),H=z?.participantId;z&&H&&ZU({eventId:u?.eventId,structureId:R,...z,tournamentRecord:o,drawDefinition:c,participantId:H})}if(d&&r){let z=d.sides?.find(H=>H.sideNumber===3-r);if(z?.lineUp){let{roundNumber:H,eventId:Z}=u,{roundPosition:J}=d,ie=H===1?2-J%2:1,K=p?.drawMatchUps?.find(({matchUpId:re})=>re===u.matchUpId),ne=[1,2].map(re=>({...K.sides?.find(me=>me.sideNumber===re)||{},sideNumber:re}));K.sides=ne;let le=K.sides.find(re=>re.sideNumber===ie);le&&(le.lineUp=Zz({lineUp:z.lineUp}),Gi({tournamentId:o?.tournamentId,matchUp:K,context:f,drawDefinition:c,eventId:Z}))}}return ce({result:{...se},stack:f,context:P});function j(){let z="loserLinkFedFMLC";return ce(D?{result:W(),stack:z}:{result:q(),stack:z})}function q(){let z=mc({drawPosition:b,structureId:R,tournamentRecord:o,drawDefinition:c,event:h});return ce({result:z,stack:"assignLoserPositionBye"})}function W(){let z=E?yp({drawPosition:y,participantId:E,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:h}):{error:na};return!z.error&&k&&n?{stack:f,context:{progressExitStatus:!0}}:ce({result:z,stack:"assignLoserDrawPosition"})}}function Goe(t){let e="directParticipants",i=mq(t);if(i.error)return ce({result:i,stack:e});let r=x1({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:c,drawDefinition:u,matchUpStatus:d,dualMatchUp:p,matchUpsMap:h,winningSide:f,targetData:m,matchUpId:g,structure:v,matchUp:y,event:b}=t,I=!!y.collectionId,w=Ao({structure:v}),T=y.drawPositions,S;if(I){let{matchUpTieId:D,matchUpsMap:C}=t,E=ym({appliedPolicies:t.appliedPolicies,matchUpId:D,tournamentRecord:c,drawDefinition:u,matchUpsMap:C,event:b});if(S=E&&{tieMatchUpResult:E},T=a.find(({matchUpId:P})=>P===D)?.drawPositions,!n)return ce({result:{...se,...S},stack:e})}if(w)return ce({result:{...se,...S},stack:e});if(T){let D=s?s-1:f-1,C=1-D,E=T[D],P=T[C],R={},{targetLinks:{loserTargetLink:M,winnerTargetLink:A,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:k,loserMatchUpDrawPositionIndex:x,winnerMatchUp:O,loserMatchUp:V,byeMatchUp:F}}=m;if(O){let j=LAe({sourceMatchUpStatus:r&&d||Sn,winnerMatchUpDrawPositionIndex:k,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:E,tournamentRecord:c,winnerTargetLink:A,drawDefinition:u,winnerMatchUp:O,dualMatchUp:p,matchUpsMap:h,event:b});if(j.error)return ce({result:j,stack:e})}if(V){let j=FAe({sourceMatchUpStatus:r&&d||Sn,loserMatchUpDrawPositionIndex:x,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:P,tournamentRecord:c,loserTargetLink:M,drawDefinition:u,loserMatchUp:V,matchUpsMap:h,dualMatchUp:p,event:b});if(j.context?.progressExitStatus&&Object.assign(R,j.context,{sourceMatchUpStatus:r&&d||Sn,sourceMatchUpStatusCodes:l||[],loserMatchUp:V,matchUpsMap:h}),j.error)return ce({result:j,stack:e})}if(F){let j=F.drawPositions||[],q=Math.min(...j.filter(Boolean)),W=N.target.structureId,z=mc({drawPosition:q,structureId:W,tournamentRecord:c,drawDefinition:u,event:b});if(z.error)return ce({result:z,stack:e})}return ce({result:{...se,...S},stack:e,context:R})}else return ce({result:{error:r1},stack:e})}function vq(t){let e="genPlayoffStructure";if(!t.drawDefinition)return ce({result:{error:Nt},stack:e});let i=Y1(t);if(i.error)return ce({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=Tt(t.drawDefinition,!1,!0),{structure:I}=si({structureId:r,drawDefinition:b});if(!I)return ce({result:{error:Qr},stack:e});if(I.structureType===wo||I.structures)return vAe({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:w,playoffRounds:T}=i,{playoffPositionsReturned:S,error:D,playoffSourceRounds:C,playoffRoundsRanges:E}=Doe(t);if(D)return ce({result:{error:D},stack:e});let P=h?.length&&Object.assign({},...h),R=f||typeof h=="object"&&h.map(J=>Object.keys(J)).flat(),M=Array.isArray(R)&&R.map(J=>!isNaN(J)&&ii(J)).filter(Boolean);if(M){if(!Array.isArray(M))return ce({result:{error:be},context:{validRoundNumbers:M},stack:e});M.forEach(J=>{if(!T?.includes(J))return ce({result:{error:be},context:{roundNumber:J},stack:e})})}c&&c.forEach(J=>{if(!S?.includes(J))return ce({result:{error:be},context:{playoffPosition:J},stack:e})});let A=M||C,N=M?w:E,k=[],x=[];for(let J of A??[]){let ie=N?.find(Le=>Le.roundNumber===J);if(!ie)return ce({result:{error:be},context:{roundNumber:J},stack:e});let K=ie.finishingPositions.length,ne=Math.min(...ie.finishingPositions)-1,le=2,re=J&&P?.[J]&&le+P[J]-1,me=nT({exitProfile:`0-${J}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:ne,playoffAttributes:l,exitProfileLimit:p,stage:In,roundOffset:0,drawDefinition:b,sequenceLimit:re,stageSequence:le,drawSize:K,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:u});if(me.error)return ce({result:me,stack:e});let{structures:he,links:Ie}=me;if(he?.length&&k.push(...he),Ie?.length&&x.push(...Ie),me.structureId&&J){let Le={linkType:Ph,source:{structureId:r,roundNumber:J},target:{structureId:me.structureId,feedProfile:Su,roundNumber:1}};x.push(Le)}}if(!k.length)return ce({result:{error:be},info:"No structures generated",stack:e});b.structures.push(...k),b.links.push(...x);let{matchUps:O,matchUpsMap:V}=zn({inContext:!0,drawDefinition:b}),F=k.map(({structureId:J})=>J),j=O?.filter(({structureId:J})=>F.includes(J)).map(Ea),q=V?.drawMatchUps?.filter(({matchUpId:J})=>j?.includes(J));if(q?.length){let J=Ks({drawDefinition:b,event:v})?.tieFormat;J&&q.forEach(ie=>{let{tieMatchUps:K}=ow({matchUp:ie,tieFormat:J,isMock:g});Object.assign(ie,{tieMatchUps:K,matchUpType:_r})})}O?.filter(J=>Lv({matchUp:J})&&J.structureId===r)?.forEach(J=>{let{matchUpId:ie,score:K,winningSide:ne}=J,le=mo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ie}),re=Goe({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:V,winningSide:ne,targetData:le,matchUpId:ie,structure:I,matchUp:J,score:K,event:v});re.error&&console.log(re.error)}),O?.filter(J=>J.matchUpStatus==="BYE"&&J.structureId===r)?.forEach(J=>{let{matchUpId:ie}=J,K=mo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ie}),{targetLinks:{loserTargetLink:ne},targetMatchUps:{loserMatchUpDrawPositionIndex:le,loserMatchUp:re}}=K;if(ne&&re){let me=ne.target.structureId,he=re.drawPositions[le],Ie=mc({drawPosition:he,structureId:me,tournamentRecord:d,drawDefinition:b,event:v});Ie.error&&console.log(Ie.error)}});let W=[],z=ty({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:V}).goesToMap,{structure:H}=si({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:Z}=rr({structure:H});return Z.forEach(J=>{let ie=z?.loserMatchUpIds[J.matchUpId];if(ie&&J.loserMatchUpId!==ie){J.loserMatchUpId=ie;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:J};W.push(ne)}let K=z?.winnerMatchUpIds[J.matchUpId];if(K&&J.winnerMatchUpId!==K){J.winnerMatchUpId=K;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:J};W.push(ne)}}),{structures:k,matchUpModifications:W,links:x,drawDefinition:b,...se}}function Hoe({element:t}){if(!t)return{error:be};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:be};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Lp(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:gH};let a=Xae(t);if(a.error)return a;if(!(ji(n)&&jr(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:mH};if(!a.timeItems)a.timeItems=[];else if(BAe({element:a,duplicateValues:e,timeItem:n}))return{...se};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...se}}function BAe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&Wc({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function yq({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:Qe};if(!n)return{error:na};let s=Bg({tournamentRecord:i,participantId:n});return s.error?s:Lp({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function J1(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:Qe};let s=Lp({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=Hoe({element:i});return bi({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:Ry}),s}function lw(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Lp({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:Lc}}function zoe(t){return AO({...t,itemType:"attachConsolationStructures"})}function bq(t){return AO({...t,itemType:"attachPlayoffStructures"})}function AO({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:Nt};if(!Array.isArray(n)||!Array.isArray(a))return ce({result:{error:be},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),c=r.links?.map(l);if(a.some(g=>{let v=l(g);return c?.includes(v)}))return ce({result:{error:wH},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let u=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>u.includes(g.structureId)?n.find(({structureId:v})=>v===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),ty({drawDefinition:r});let h=n.map(g=>rr({structure:g})?.matchUps||[]).flat();cg({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:h});let f=n.map(({structureId:g})=>g);if(Pr({drawDefinition:r,structureIds:f}),e?.length){let g={};e.forEach(y=>{let b=y.matchUp?.matchUpId;b&&(g[b]=y)});let v=y=>{y.matchUps.forEach(b=>{if(g[b.matchUpId]){let{tieMatchUps:I,...w}=g[b.matchUpId].matchUp;if(Object.assign(b,w),I?.length){let T={};I.forEach(S=>g[S.matchUpId]=S),b.tieMatchUps.forEach(S=>Object.assign(S,T[S.matchUpId]))}g[b.matchUpId].matchUp=b,Gi(g[b.matchUpId])}})};r.structures.forEach(y=>{if(d?.includes(y.structureId))if(y.structures)for(let b of y.structures)v(b);else v(y)})}let m=p.map(Rl("structureId"));if(i){let g={itemValue:{structureIds:f,drawId:r.drawId},itemType:t};Lp({element:i,timeItem:g})}return{...se,addedStructureIds:m}}function _O(t){let{structures:e,links:i,matchUpModifications:r,error:n}=vq(t);if(n)return{error:n};let a=t.drawDefinition;return bq({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function ry(t){let e=jt(t,[{_anyOf:{[xs]:!1,[da]:!1,[$s]:!1,[mm]:!1},[BH]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=VY(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&Pr({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Qe};for(let a of n){let s=t.tournamentRecords[a],o=VY(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:Qe};return i.length?{...se,applied:i}:{error:oH}}function VY(t,e){let i=Qi(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:Pk};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!ji(s))return{error:be};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!jr(o))return{error:be};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...ir({element:e,extension:{name:BP,value:i}}),applied:r}:{applied:r,error:oH}}function Iq({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return ce({result:{error:be},context:{drawName:r}});i||(i=Cn({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:Vu,value:{...i,flights:i.flights}};Lg({event:a,extension:o})}return e&&(e.drawName=r,Pr({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:Nt}:{...se,flight:s}}function qoe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!ji(i))return{error:be};let a=Cn({event:n}).flightProfile,s=i.drawName&&Iq({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:Nt};if(o){let l={name:Vu,value:{...a,flights:a.flights}};Lg({event:n,extension:l})}return e&&(i.policyDefinitions&&ry({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Pr({tournamentId:t?.tournamentId,drawDefinition:e})),{...se}}function Woe({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:Nt};let r=is({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:c}=s;o&&(c!==1||![Ht,Ut].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:u,isRoundRobin:d}=rr({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of u){let{matchUpId:h,roundNumber:f}=p,m=p.sides||[],g=n(h);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,NO),f&&f>1&&g.drawPositions?.length&&!d){let v=m?.map(({drawPosition:b,participantFed:I})=>!I&&b).filter(Boolean),y=g.drawPositions.map(b=>v.includes(b)?void 0:b);g.drawPositions=y}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(v=>v.itemType&&![Ah,pg,KI,Nz,ZI,XI].includes(v.itemType))),Gi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==iT);let a=(i.structures||[]).map(({structureId:s})=>s);return Pr({drawDefinition:i,structureIds:a}),{...se}}function Q1({tournamentRecord:t}){if(!t)return{error:Qe};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.map(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=PO({drawDefinition:r}),c=i[n],u=(r?.structures||[]).map(b=>{let{stage:I,stageSequence:w,structureId:T}=b,S=aI[I],{inContextStructureMatchUps:D}=L1({drawDefinition:r,structure:b,event:c}),C=D?.filter(({winningSide:q})=>q),E=C.filter(Boolean).length||0;s+=E,o+=D.length-s;let P=Math.max(C.filter(({roundNumber:q})=>q===1).map(({roundPosition:q})=>q)),{positionAssignments:R}=Sr({structure:b}),M=R?.filter(({participantId:q})=>q);a+=M?.length??0;let A=(R?.length??0)-(M?.length??0),{roundMatchUps:N,roundProfile:k,roundNumbers:x,maxMatchUpsCount:O}=fo({matchUps:D}),V=k&&Object.keys(k).filter(q=>!k[q].inactiveRound).map(q=>parseInt(q)),F=k&&Object.keys(k).filter(q=>k[q].inactiveRound).map(q=>parseInt(q)),j=k&&Object.values(k).every(q=>q.inactiveRound);return{positionsAssignedCount:M?.length??0,maxWinningSideFirstRoundPosition:P,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:O,inactiveRounds:F,roundMatchUps:N,activeRounds:V,roundNumbers:x,roundProfile:k,structureId:T,stageSequence:w,orderNumber:S,stage:I}}),d=u.find(b=>b.orderNumber===2&&b.stageSequence===1),p=u.filter(({inactiveStructure:b})=>!b).length,{links:h}=qU({structureId:d.structureId,drawDefinition:r}),f=ii(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=u?.every(({inactiveStructure:b})=>b),g=!h.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),v=r.drawId;a&&!s&&e.positionsNoOutcomes.push(v),m&&e.inactive.push(v),f&&e.matchPlay.push(v),g&&e.canBePruned.push(v);let y={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:u,inactiveDraw:m,isMatchPlay:f,drawId:v};e.drawAnalysis[v]=y}),{...se,drawsAnalysis:e}}function Yoe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:Qe};if(!i)return{error:Nt};let n=[],{drawsAnalysis:a}=Q1({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=ju({stageSequence:1,drawDefinition:i,stage:Ut}),c=o.structuresData.find(({structureId:h})=>l.structureId===h),u=(l.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=u.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let d=n.map(Ea),p=u.map(Ea).filter(h=>!d.includes(h));if(s){let h=n.filter(({roundNumber:y})=>!c.inactiveRounds.includes(y)).filter(({winningSide:y})=>y),f=h.map(Ea),m=d.filter(y=>!f.includes(y));p.push(...m);let g=h.flatMap(y=>y.drawPositions??[]).filter(Boolean).flat(),v=Object.assign({},...g.map((y,b)=>({[y]:b+1})));if(h.forEach(y=>{t?y.drawPositions=y.drawPositions.map(b=>v[b]):delete y.drawPositions}),t){let y=l?.positionAssignments?.filter(b=>g.includes(b.drawPosition)).map(b=>(b.drawPosition=v[b.drawPosition],b));l.positionAssignments=y}else l.positionAssignments=[];l.matchUps=h,n=h}Zh({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),Pr({drawDefinition:i})}return{...se,matchUps:n}}function Koe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:Nt};if(!r)return{error:NU};if(!n)return{error:dc};if(o){let l=mc({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{if(a)return{error:xk};{let l=yp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:s});if(l.error)return l}}return{...se}}function Zoe(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:c})=>e.includes(c)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:Qr};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:Qr};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===zI)return{error:Uy};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(Ea);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function Xoe(t){let e=jt(t,[{[$s]:!0},{[ET]:{[v1]:!1,roundNumbers:!1},[sc]:be,[Fo]:Cs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=Zoe(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=d?.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!n)return!1;if(b||sa({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!r)return!1;return p?.includes(v)})??[],m=f.map(Ea),g=f.map(({tieMatchUps:v})=>v?.map(Ea)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Zh({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let v=vi(c.matchUps.map(Rl("roundNumber"))),y=C1e(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Gi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){c.positionAssignments=vi(c.matchUps.flatMap(S=>(S.sides??[]).map(D=>D.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=c?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,I=l.existingMatchUps.some(S=>S.matchUpType===rc)?{matchUpTypes:[rc]}:void 0,{matchUps:w}=rr({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:c,event:o});Ao({structure:c})&&(c.positionAssignments=vi(w.flatMap(S=>(S.sides??[]).map(D=>D.participantId)).filter(Boolean)).map(S=>({participantId:S})));let T=hq({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:w,event:o});T.error&&console.log(T)}Pr({structureIds:[u],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:c1}:{...se,deletedMatchUpsCount:[...m,...g].length}}function Joe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:Qe};if(!i)return{error:Nt};if(!n)return ce({result:{error:Wt},info:"roundNumber required"});let s=si({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:Uy}:Ao({structure:o})?$Ae({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...se})}function $Ae({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d?.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(Jn).includes(r)){let u=s.filter(d=>{let p=d.roundNumber===r&&(!Hn.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Ea))),!p});l.length&&(Zh({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Gi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...se}}function kO(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:Nt};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:dc};if(!Kc(n))return{error:be,info:iy("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:Qr};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===zI)return{error:Uy};let c=Ha({tournamentRecord:i,inContext:!1})?.matchUps?.map(Ea)??[],u=n.map(Ea);if(ho(c,u))return{error:nne,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(cg({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),Pr({drawDefinition:r,structureIds:[s]})),{...se}}function Qoe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:Nt};if(!r)return{error:dc};if(!i)return{error:NU};let{structure:s}=si({drawDefinition:e,structureId:r});if(!s)return{error:Qr};let o=s;s.structures&&s.structureType===wo&&(o=s.structures?.find(h=>h.positionAssignments?.find(f=>f.drawPosition===i)));let l=o?.positionAssignments,c=l?.find(h=>h.drawPosition===i);c&&ir({element:c,extension:{name:CT,value:n}});let u=(a?.eventType===_r||e.matchUpType===_r||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[_r]},{matchUps:d}=rr({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return hq({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Pr({drawDefinition:e,structureIds:[r]}),{...se}}var ele={};Ai(ele,{addGoesTo:()=>ty,allPlayoffPositionsFilled:()=>eq,checkValidEntries:()=>LO,findDrawDefinition:()=>Uq,getAssignedParticipantIds:()=>xy,getAvailableMatchUpsCount:()=>OO,getAvailablePlayoffProfiles:()=>Y1,getDrawDefinitionTimeItem:()=>Sz,getDrawParticipantRepresentativeIds:()=>Sq,getDrawStructures:()=>ju,getDrawTypeCoercion:()=>eR,getEligibleVoluntaryConsolationParticipants:()=>wq,getMatchUpsMap:()=>is,getParticipantIdFinishingPositions:()=>Tq,getPositionAssignments:()=>YP,getPositionsPlayedOff:()=>JU,getRandomQualifierList:()=>Cq,getSeedingThresholds:()=>Yz,getSeedsCount:()=>tR,getStructureSeedAssignments:()=>$c,getTeamLineUp:()=>ey,getValidGroupSizes:()=>G1,isAdHoc:()=>Ao,isCompletedStructure:()=>_h,isValidForQualifying:()=>Rq,positionActions:()=>Pq});function wq({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){if(!o)return{error:Nt};let f=[Ut,In];i&&f.push(Ht);let m=h?.eventType?{matchUpTypes:[h.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,v=e&&h?Jh({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:h})?.matchUps??[]:lo({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],y=YI({stage:La,drawDefinition:o}).map(({participantId:x})=>x),b={},I={},w={},T={};n||(n=gm({policyTypes:[tV],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let S=n?.[tV];t=t.length&&t||S?.excludedMatchUpStatuses||[],e=e??S?.includeEventParticipants,d=d??S?.allEntries,r=r??S?.finishingRoundLimit,a=a??S?.roundNumberLimit,l=l??S?.matchUpsLimit,c===void 0&&(c=S?.requirePlay!==void 0?S.requirePlay:!0),u===void 0&&(u=S?.requireLoss!==void 0?S.requireLoss:!0),p=p??S?.winsLimit;for(let x of v){if(c&&x.winningSide&&![1,2].includes(x.winningSide)&&x.matchUpStatus!==on||x.finishingRound&&r&&x.finishingRound>=r||x.finishingRound&&a&&x.finishingRound<=a)continue;let O=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===3-x.winningSide),V=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===x.winningSide);if(x.sides?.forEach(F=>{let j=F?.participant?.participantId;j&&(w[j]=F.participant,x.matchUpStatus===on&&!c&&(I[j]=F.participant,b[j]||(b[j]=0),(!x.matchUpStatus||!t.includes(x.matchUpStatus))&&(b[j]+=1)))}),O?.participant){let F=O.participant.participantId;I[F]=O.participant,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}if(V?.participant){let F=V.participant.participantId;T[F]||(T[F]=0),T[F]+=1,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}}let D=s?.participants&&!c&&!u&&d,C=D?((e&&h?h.entries:o.entries)??[]).filter(x=>![Nh,Yc].includes(x.entryStatus)).map(({participantId:x})=>x):[],E=Object.keys(I),P=D?(s?.participants??[]).filter(({participantId:x})=>C.includes(x)):u&&Object.values(I)||Object.values(w),R=x=>!u||E.includes(x),M=x=>!c||(b[x]||0)>=0,A=x=>!p||(T[x]||0)<=p,N=x=>!l||b[x]<=l,k=x=>!y.includes(x);return{eligibleParticipants:P.filter(x=>R(x.participantId)&&M(x.participantId)&&A(x.participantId)&&N(x.participantId)&&k(x.participantId)).map(x=>({...x,individualParticipants:x.individualParticipantIds?.map(O=>s?.participants?.find(V=>V.participantId===O))})),losingParticipantIds:E,...se}}function OO(t){let e=jt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:dc};let a=i.structures?.find(f=>f.structureId===n);if(!a)return{error:Qr};let s,o=(a.matchUps??[])?.reduce((f,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>f?m.roundNumber:f),0);if(a.structures||s||a.finishingPosition===zI)return{error:Uy};let l=i?.entries?.filter(f=>{let m=f.entryStatus;return Xu.includes(m)})??[],c=Math.floor(l?.length/2)||1,u=r??o??1,d=a.matchUps?.filter(f=>f.roundNumber===u)?.length??0,p=c-d,h=p>0?p:0;return{...se,availableMatchUpsCount:h,lastRoundNumber:o,roundMatchUpsCount:c}}function Sq({drawDefinition:t}){let e=Pi({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function VAe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Nt};let r=zn({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Tt(r.matchUps,!1,!0),a=vi(n.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function Tq({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Nt};let{participantIds:r,participantIdMatchUps:n}=VAe({tournamentParticipants:e?.participants,drawDefinition:i}),a=r?.map(s=>{let o=n[s].filter(d=>[Sn,"BYE"].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:u}}})||[];return Object.assign({},...a)}function Gg({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:Qe};if(!r)return{error:Md};if(!e&&t){if(typeof i!="string"&&(i=joe({tournamentRecords:t,drawId:r}),!i))return{error:gT};if(e=t[i],!e)return{error:Qe}}let n=e&&_o({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...se}:ce({result:{error:nc},stack:"findDrawDefinition"})}function Uq(t){let{drawDefinition:e,error:i}=Gg(t);return i?{error:i}:{drawDefinition:Tt(e)}}function jAe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[Yc,_y].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:u})=>s.includes(u)):void 0,c=e?t.filter(({participantId:u})=>o.includes(u)):void 0;return{validModifyAssignedPairAction:Lt({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:QNe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:c,type:nq},!1,!1,!0)}}return{}}function ny(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===gp&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),c=l?.targetMatchUps?.loserMatchUp,u=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=c?.sides[u]?.participant,p=As(a?.matchUpStatus),h=p&&!d,f=a?.sides?.reduce((b,I)=>I?.participant?++b:b,0)??0,m=a?.winningSide&&p&&f===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!h||s?.winningSide&&g===2&&(!s.feedRound||!As(s?.matchUpStatus))))return!0;let v=s&&mo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),y=l&&ny({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(v&&ny({targetData:v,inContextDrawMatchUps:e,drawDefinition:r})||y)}var tle={[Mh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ht,Ut],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[WP,dI,CO,xb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},bN="positionAction",gV="matchUpAction";function ile({actionType:t=bN,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===bN&&Mh||t===gV&&Fa,a=t===bN&&tle||t===gV&&_se,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:c}=s||{},u=c?.find(d=>{let{stages:p,stageSequences:h,structureTypes:f,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!f?.length||Array.isArray(f)&&f?.includes(r?.structureType))&&(!h?.length||Array.isArray(h)&&h.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:s}}function jY({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function rle({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:c,structureTypes:u,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),h=!c?.length||Array.isArray(c)&&c.includes(n),f=!u?.length||Array.isArray(u)&&u.includes(a),m=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return h&&f&&m&&o&&p})}}function qo({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var nle="replaceTieMatchUpParticipantId",ale="assignTieMatchUpParticipantId",vV="removeTieMatchUpParticipantId",GY="assignMatchUpSideParticipant",GAe="removeMatchUpSideParticipant",sle="substituteParticipant",yV="REMOVE_SUBSTITUTION",ole="REPLACE_PARTICIPANT",Dq="REMOVE_PARTICIPANT",bV="setMatchUpStatus",IV="SUBSTITUTION",lle="SCHEDULE",HAe="PENALTY",wV="REFEREE",cle="STATUS",SV="START",ule="SCORE",Eq={REPLACE_TEAM_POSITION_METHOD:nle,ASSIGN_TEAM_POSITION_METHOD:ale,REMOVE_TEAM_POSITION_METHOD:vV,REPLACE_PARTICIPANT:ole,SUBSTITUTION_METHOD:sle,REMOVE_SUBSTITUTION:yV,REMOVE_PARTICIPANT:Dq,SCHEDULE_METHOD:bV,SUBSTITUTION:IV,SCHEDULE:lle,PENALTY:HAe,REFEREE:wV,STATUS:cle,SCORE:ule,START:SV,END:"END"};function zAe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){let h=[],f=n.sides?.find(A=>A.participant),m=ec(n.gender)&&n.sideNumber&&n.sides?.filter(A=>A.particiapntId).length===1&&f?.participant?.person?.sex,g=n.matchUpType,v=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,y=n.sides?.flatMap(A=>A.participant?.individualParticipants||A.participant).filter(Boolean)?.map(xi),b=n.sides?.filter(A=>!l||A.sideNumber===l).flatMap(A=>A.participant?.individualParticipants||A.participant).filter(Boolean),I=b?.map(xi),w=e?.find(A=>A.matchUpId===n.matchUpTieId)?.sides?.map(A=>A?.participant?.individualParticipants?.filter(({participantId:N,person:k})=>!I?.includes(N)&&(!v||lh(v)||k.sex===v||ec(v)&&!m||m&&k.sex!==m))),T=l?w?.[l-1]:w?.map((A,N)=>({participants:A,sideNumber:N+1})),S=l?w?.[l-1]?.map(xi):w?.map((A,N)=>({participants:A?.map(xi),sideNumber:N+1})),D=l&&(kn(Nb)(g)&&!I?.length||kn(Wv)(g)&&(I?.length??0)<2)||!l&&(kn(Nb)(g)&&(I?.length??0)<2||kn(Wv)(g)&&(I?.length??0)<4),C=S?.filter(A=>!y?.includes(A)),E=T?.filter(({participantId:A})=>C.includes(A));if(D&&C?.length&&h.push({availableParticipantIds:C,method:ale,availableParticipants:E,type:uI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),I?.length&&(!sa(u)||p?.substitutions?.length)&&h.push({method:vV,type:Dq,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),E?.length&&(!l&&I?.length||l&&p?.participant)&&h.push({availableParticipantIds:C,method:nle,availableParticipants:E,type:ole,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),qo({policyActions:a,action:yV})&&p?.substitutions?.length){let A=p.participant?.participantType===Li&&[p.participantId]||p.participant?.participantType===Di&&p.participant.individualParticipantIds||[],N=p.substitutions.map(k=>k.participantId).filter(k=>A.includes(k));(!o||N.includes(o))&&h.push({method:vV,type:yV,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let P=t?.[Fa],R=P?.substituteWithoutScore,M=P?.substituteAfterCompleted;if(qo({policyActions:a,action:IV})&&i.length===2&&(!l&&I?.length||l&&p?.participant)&&(R||sa(u))&&(M||u.matchUpStatus&&!Hn.includes(u.matchUpStatus))&&b?.length&&T.length){let A=b.map(xi);h.push({info:"list of team players available for substitution",method:sle,availableParticipantIds:S,existingParticipantIds:A,availableParticipants:T,existingParticipants:b,type:IV,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function qAe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){if(i.includes(o))return{};let h=l.find(S=>S.type===uI)?.availableParticipantIds,f=a?.[Mh]?.otherFlightEntries,m=a?.[Mh]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:S})=>!m||(u.stage===Ht?S===Ht:S!==Ht)).sort((S,D)=>(S.entryPosition??1/0)-(D.entryPosition??1/0)).map(({participantId:S})=>S).filter(Boolean),{allPositionedParticipantIds:v}=Lae({drawDefinition:s}),y=r.map(S=>S.participantId).filter(Boolean),b=g.filter(S=>u.stage&&[Ht,Ut,In].includes(u.stage)?!v?.includes(S):!y.includes(S)),I=(p?.entries??[]).filter(S=>S.entryStatus===Cu&&dle({restrictQualifyingAlternates:m,structure:u,entry:S})&&(u.stage&&[Ht,Ut,In].includes(u.stage)?!v?.includes(S.participantId):!y.includes(S.participantId))).sort((S,D)=>(S.entryPosition??1/0)-(D.entryPosition??1/0)).map(S=>S.participantId),w=vi(b.concat(I));if(f){let S=(p?Cn({event:p}).flightProfile:void 0)?.flights?.filter(D=>D.drawId!==d).map(D=>D.drawEntries.filter(C=>C.participantId&&![Nh,Yc,_y].includes(C.entryStatus)&&!g.includes(C.participantId)).map(({participantId:C})=>C)).flat().filter(Boolean);S?.length&&w.push(...S)}h?.length&&(w=w.filter(S=>!h.includes(S)));let T=n?t?.filter(S=>w.includes(S.participantId)):void 0;return T?.forEach(S=>{let D=(s.entries??[]).find(C=>C.participantId===S.participantId);S.entryPosition=D?.entryPosition}),T?.sort((S,D)=>(S.entryPosition||1/0)-(D.entryPosition||1/0)),w.length?{validAlternatesAction:Lt({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:XNe,availableAlternatesParticipantIds:w,type:aq,availableAlternates:T})}:{}}function dle({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===Ht&&!t||i.entryStage===Ut&&r===bs)return!0}function WAe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Cu&&dle({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(xi)}function YAe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){let p=[],h=l?.matchUps??[],f=c.sides?.find(D=>D.sideNumber===s)?.participantId,m=h.filter(({roundNumber:D})=>D===c.roundNumber),g=n?.entries?.filter(({entryStatus:D})=>D&&ky.includes(D)).map(xi)??[],v=m.map(D=>(D.sides??[]).flatMap(xi)).flat().filter(Boolean),y=g.filter(D=>!i.includes(D)&&(!t||!v.includes(D))),b=e?.filter(D=>y?.includes(D.participantId)).map(D=>Tt(D,void 0,!0));b?.forEach(D=>{let C=(n.entries??[]).find(E=>E.participantId===D.participantId);D.entryPosition=C?.entryPosition}),y.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:GY,type:uI,availableParticipantIds:y,participantsAvailable:b});let I=d?.entries??[],w=WAe({eventEntries:I,structure:l}),T=vi(g.concat(w));if(r){let D=(d?Cn({event:d}):void 0)?.flights?.filter(C=>C.drawId!==u).flatMap(C=>C.drawEntries.filter(E=>E.participantId&&![Nh,Yc,_y].includes(E.entryStatus)).map(({participantId:E})=>E)).filter(Boolean);D?.length&&T.push(...D)}T=T.filter(D=>!i.includes(D)&&!y.includes(D)&&(!t||!v.includes(D)));let S=e?.filter(D=>T.includes(D.participantId)).map(D=>Tt(D,void 0,!0));if(S?.forEach(D=>{let C=(n.entries??[]).find(E=>E.participantId===D.participantId);D.entryPosition=C?.entryPosition}),S?.sort((D,C)=>(D.entryPosition||1/0)-(C.entryPosition||1/0)),T.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:T,participantsAvailable:S,method:GY,type:Cu}),!sa(c)&&s&&f){p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:GAe,type:Dq});let D=k=>k.sides.map(xi),C=({matchUpId:k})=>k!==c.matchUpId,E=k=>!sa(k),P=c.sides?.find(k=>k.sideNumber!==s)?.participantId,R=h.filter(({roundNumber:k})=>k!==c.roundNumber).filter(C).map(D),M=[P,...R.filter(k=>k.includes(f)).flat()].filter(Boolean),A=k=>!M.flat().includes(k),N=m.filter(E).filter(C).map(D).flat().filter(A);if(N.length){let k=e?.filter(x=>N.includes(x.participantId)).map(x=>Tt(x,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:N,method:eAe,type:RO,swappableParticipants:k})}}return p}function xO(t){if(!t)return{error:be};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&jr(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!c)return{error:Qe};if(!l||!jr(l))return{error:Qs};if(o&&![1,2].includes(o))return ce({result:{error:be},context:{sideNumber:o}});if(!e){let K=(Ha({tournamentRecord:c}).matchUps??[]).find(le=>le.matchUpId===l);i=(c?.events??[]).find(le=>le.eventId===K?.eventId);let ne=(i?.drawDefinitions??[]).find(le=>le.drawId===K?.drawId);ne&&(e=ne)}if(!e)return{error:Nt};let u=cn({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=Hr({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Os};let f=Qi({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,n??{});let m=f?.[Mh]?.otherFlightEntries,g=f?.[Fa]??KU[Fa],{enabledStructures:v}=ile({actionType:gV,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=rle({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??is({drawDefinition:e}),I=t.inContextDrawMatchUps??zn({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,w=I?.find(K=>K.matchUpId===l),T=o&&w?.sides?.find(K=>K.sideNumber===o),S=w?.sides?.map(K=>K.participantId||K.participant?.participantid).filter(Boolean)??[],{assignedPositions:D,allPositionsAssigned:C}=aa({structure:h}),{structureId:E}=h??{},P=[];if(!E)return{validActions:P};let R=Ao({structure:h}),M=!!p.collectionId;if(R&&!M){let K=YAe({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:o,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});P.push(...K)}let A=_h({drawDefinition:e,structure:h}),N=D?.filter(K=>K.participantId).map(K=>K.drawPosition),k=D?.filter(K=>K.bye).map(K=>K.drawPosition),x=p.matchUpStatus==="BYE"||!M&&p.drawPositions?.reduce((K,ne)=>k?.includes(ne)||K,!1);if(x)return{validActions:P,isByeMatchUp:x};qo({policyActions:y,action:wV})&&P.push({type:wV,payload:{matchUpId:l}});let O=!x1({matchUpStatus:p.matchUpStatus}),V=f?.scoring?.structures,F=h?.stage&&V?.stage&&V?.stage[h.stage],j=h?.stageSequence&&F?.stageSequence&&F.stageSequence[h.stageSequence],q=!(f?.scoring?.requireAllPositionsAssigned||F?.requireAllPositionsAssigned||j?.requireAllPositionsAssigned)||C,W=p.sides&&p.sides.filter(K=>K?.participantId).length===2,z=p.matchUpStatus&&[on,ia].includes(p.matchUpStatus),H=mo({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),Z=ny({inContextDrawMatchUps:I,drawDefinition:e,targetData:H}),J=(w?.drawPositions?.length===2&&w.drawPositions.every(K=>N?.includes(K))&&w?.sides?.length===2&&w.sides.every(({participantId:K})=>K)||W)&&!(z&&Z),ie={method:yoe,type:dI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&P.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:bV,type:lle}),qo({policyActions:y,action:dI})&&(T?.participant||!o&&S?.length)&&P.push(ie),O&&J&&P.push({type:cle}),q&&J){let{matchUpId:K,matchUpFormat:ne}=p,le={drawId:d,matchUpId:K,matchUpFormat:ne,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};P.push({info:"set outcome and winningSide",method:bV,type:ule,payload:le}),qo({policyActions:y,action:SV})&&P.push({type:SV}),qo({policyActions:y,action:"END"})&&P.push({type:"END"})}if(M&&w){let K=zAe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:I,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:w,policyActions:y,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:T});P.push(...K)}return{structureIsComplete:A,validActions:P,isDoubleExit:z,...se}}function KAe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=s.links?.reduce((v,y)=>{let b=y.source?.structureId,I=y.target?.structureId;return v.sourceStructureIds.includes(b)||v.sourceStructureIds.push(b),v.targetStructureIds.includes(I)||v.targetStructureIds.push(I),v},{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],m=s.links?.filter(v=>v.target?.structureId===c.structureId)??[];for(let v of m){let y=v?.source?.structureId,{structure:b}=si({structureId:y,drawDefinition:s}),I=b?.finishingPosition===zI&&(p?.length!==1||h?.length!==1),w={};if(I){let{matchUps:D}=rr({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:C}=cI({drawPosition:o,matchUps:D}),E=s.links?.find(P=>P.target?.structureId===c?.structureId&&P.target.roundNumber===C)?.source?.roundNumber;w.roundNumbers=[E]}let{completedMatchUps:T}=wO({structureId:y,inContext:!0,matchUpFilters:w,drawDefinition:s}),S=a.map(D=>D.participantId).filter(Boolean);T?.filter(({matchUpType:D,winningSide:C})=>C&&(d?.eventType!==Qn||D===Qn)).map(({winningSide:D,sides:C})=>D&&C?.[1-(D-1)]).map(xi).filter(D=>D&&!S.includes(D))?.forEach(D=>{f.includes(D)||f.push(D)})}let g=t?.filter(v=>f?.includes(v.participantId));return g?.forEach(v=>{let y=(s.entries??[]).find(b=>b.participantId===v.participantId);v.entryPosition=y?.entryPosition}),f?.length?{validLuckyLosersAction:{type:oq,method:JNe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function ZAe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){let{drawId:m}=c,g=[],v,y,b=[],I=l?.[bu]?.validSeedPositions?.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=qse({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h})),b?.length||(b=s.filter(w=>!w.participantId&&!w.bye&&!w.qualifier).map(w=>w.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:rAe,type:"BYE"}),a&&I){let w=s.map(E=>E.participantId).filter(Boolean),T={structureIds:t},{completedMatchUps:S}=WU({inContext:!0,matchUpFilters:T,drawDefinition:c}),D=vi((S??[]).filter(({matchUpType:E})=>f?.eventType!==Qn||E===Qn)?.map(({sides:E})=>E?.map(xi)).flat().filter(E=>E&&!w.includes(E))),C=o?n?.filter(E=>D?.includes(E.participantId)).map(E=>Tt(E,void 0,!0)):void 0;return C?.forEach(E=>{let P=(c.entries??[]).find(R=>R.participantId===E.participantId);E.entryPosition=P?.entryPosition}),C?.length&&g.push(Lt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:kY,type:uI,availableParticipantIds:D,participantsAvailable:C})),{validAssignmentActions:g}}if(b.includes(p)||d){let w;if(y?.length){let S=y.filter(D=>v?.includes(D.participantId));S.sort(XAe),w=S.map(D=>D.participantId)}else w=e;let T=o?n?.filter(S=>w.includes(S.participantId)).map(S=>Tt(S,void 0,!0)):void 0;T?.length&&g.push(Lt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:kY,type:uI,availableParticipantIds:w,participantsAvailable:T}))}return{validAssignmentActions:g}}function XAe(t,e){return t.bye||NT(t.seedValue)<NT(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function JAe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let c=[],u=[],d=[],p=[],h=i.map(w=>w.participantId).filter(Boolean),f=n?.[Mh],m=!f?.disableRoundRestrictions&&t[s],g=f?.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=qP({targetRoundNumber:m,linkType:Eh,drawDefinition:a,structureId:o})||{};v?.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=qP({targetRoundNumber:m,linkType:Dh,drawDefinition:a,structureId:o})||{};b?.length&&p.push(...b);for(let w of y){let T=a.structures?.find(D=>D.structureId===w.source.structureId);if(T?.stage!==Ht)continue;let S=_h({structureId:w.source.structureId,drawDefinition:a});if(!g||S){let D=T.qualifyingRoundNumber,{matchUps:C}=rr({matchUpFilters:{roundNumbers:[D],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:T});for(let E of C){let P=E.sides.find(M=>M?.sideNumber===E.winningSide),R=E.matchUpStatus==="BYE"&&E.sides?.find(({participantId:M})=>M);if(P||R){let{participantId:M,participant:A}=P||R||{};M&&!h.includes(M)&&(A&&r&&c.push(A),u.push(M))}}}}for(let w of I){let T=a.structures?.find(D=>D.structureId===w.source.structureId);if(T?.stage!==Ht)continue;let S=_h({structureId:w.source.structureId,drawDefinition:a});if(!g||S){let{positionAssignments:D}=Sr({structure:T}),C=D?.map(E=>{let P=E.participantId,R=Pi({element:E,name:qf}).extension?.value;return R?{participantId:P,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:E,participantId:P})=>E===1&&!h.includes(P)).map(({participantId:E})=>E)??[];if(C&&u.push(...C),r){let E=e.filter(({participantId:P})=>C.includes(P));c.push(...E)}}}return u.length&&d.push(Lt({qualifyingParticipants:r?c:void 0,method:KNe,type:CO,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function QAe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(n.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=r?.filter(E=>E!==u&&!(c&&o.includes(E))),v=a?.filter(E=>m(E)&&g?.includes(E.drawPosition))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=rr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>ho(E,y)),w=Object.assign({},...I.map(E=>E.sides?.filter(({sourceDrawPositionRange:P})=>P).map(({drawPosition:P,sourceDrawPositionRange:R})=>({[P]:R}))).flat()),T=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>T.includes(E.participantId)),D=Object.assign({},...S.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=D?.[E.participantId],R=w[E.drawPosition];return Lt({...E,participant:s?Tt(P,!1,!0):void 0,sourceDrawPositionRange:R})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:voe,type:RO,availableAssignments:C}}:{}}function Pq(t){let e=jt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,c=t.tournamentParticipants??(a&&cn({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=si({structureId:t.structureId,drawDefinition:s});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:Qr};let p=d.structureId;if(u=L1({drawDefinition:s,structureId:p}),o===void 0&&!u.isAdHoc)return{error:NU};if(u.isAdHoc)return xO(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=Qi({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=ile({actionType:bN,appliedPolicies:v,drawDefinition:s,structure:d}),w=y?.activePositionOverrides||[],{sourceStructureIds:T}=qP({finishingPosition:Xv,targetRoundNumber:1,linkType:Dh,drawDefinition:s,structureId:p})||{},S;T?.length&&(S=T.every(ie=>_h({structureId:ie,drawDefinition:s})));let D=T.length,C=T.length&&!S,{policyActions:E}=rle({enabledStructures:b,drawDefinition:s,structure:d}),P=![Ht,Ut].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,M=[],{assignedPositions:A,positionAssignments:N}=aa({structure:d}),k=A?.find(ie=>ie.drawPosition===o),x=!!k;if(!N?.map(ie=>ie.drawPosition)?.includes(o))return{error:MU};let{stage:O,stageSequence:V}=d,F=[O];O===bs&&F.push(Ut),O===Ut&&F.push(bs);let j=YI({entryStatuses:ky,provisionalPositioning:n,drawDefinition:s,stageSequence:V,structureId:p,stages:F}),q=xy({drawDefinition:s,stages:F}).assignedParticipantIds??[],W=j.filter(ie=>!q.includes(ie.participantId)).map(ie=>ie.participantId),z=g.includes(o),H=m.includes(o);if(I)return{info:"Actions Disabled for structure",isActiveDrawPosition:H,isDrawPosition:!0,hasPositionAssigned:x,validActions:[],isByePosition:z};if(qo({policyActions:E,action:uI})&&!H&&N&&!C&&(!k||z)){let{validAssignmentActions:ie}=ZAe({positionSourceStructureIds:T,unassignedParticipantIds:W,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:v,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,event:l});ie?.forEach(K=>M.push(K))}if(qo({policyActions:E,action:CO})&&!H){let{validAssignmentActions:ie}=JAe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:v,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});ie?.forEach(K=>M.push(K))}let{participantId:Z}=k||{},J=Z&&c.find(ie=>ie.participantId===Z);if(k){qo({policyActions:E,action:mV})&&!H&&(M.push({type:mV,method:_Y,payload:{drawId:R,structureId:p,drawPosition:o},willDisableLinks:P}),z||M.push({type:sq,method:ZNe,payload:{drawId:R,structureId:p,drawPosition:o},willDisableLinks:P}),qo({policyActions:E,action:"BYE"})&&!z&&M.push({type:"BYE",method:_Y,payload:{drawId:R,structureId:p,drawPosition:o,replaceWithBye:!0},willDisableLinks:P}));let ie=d.stage===Ht||d.stage===Ut&&d.stageSequence===1;if(!z&&jY({activePositionOverrides:w,activeDrawPositions:m,action:xb})&&qo({policyActions:E,action:xb})&&EA({drawDefinition:s,structureId:p,drawPosition:o})&&ie){let{seedAssignments:K}=$c({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne,seedValue:le}=K?.find(re=>re.participantId===Z)??{};M.push({type:xb,method:nAe,participant:J,seedNumber:ne,payload:{drawId:R,structureId:p,participantId:Z,seedValue:le}})}if(!z&&jY({activePositionOverrides:w,activeDrawPositions:m,action:GE})&&qo({policyActions:E,action:GE})&&EA({drawDefinition:s,structureId:p,drawPosition:o})&&ie){let{seedAssignments:K}=$c({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne}=K?.find(le=>le.participantId===Z)??{};M.push({method:iAe,type:GE,participant:J,seedNumber:ne,payload:{participantId:Z,structureId:p,drawId:R}})}if(!z&&Z){if(qo({policyActions:E,action:dI})){let K={type:dI,method:yoe,participant:J,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};M.push(K)}if(qo({policyActions:E,action:WP})){let K={type:WP,method:tAe,participant:J,payload:{participantId:Z,otherName:void 0}};M.push(K)}}if(qo({policyActions:E,action:RO})){let{validSwapAction:K}=QAe({possiblyDisablingAction:P,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,structure:d,drawId:R});K&&M.push(K)}}if(qo({policyActions:E,action:aq})&&!C){let{validAlternatesAction:ie}=qAe({possiblyDisablingAction:P,tournamentParticipants:c,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:v,drawDefinition:s,drawPosition:o,validActions:M,structureId:p,structure:d,drawId:R,event:l});ie&&M.push(ie)}if(qo({policyActions:E,action:oq})&&!C&&!H&&N){let{validLuckyLosersAction:ie}=KAe({sourceStructuresComplete:S,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R});ie&&M.push(ie)}if(J?.participantType===Di&&qo({policyActions:E,action:nq})){let{validModifyAssignedPairAction:ie}=jAe({tournamentParticipants:c,returnParticipants:r,drawPosition:o,participant:J,drawId:R,event:l});ie&&M.push(ie)}return{isActiveDrawPosition:H,isDrawPosition:!0,hasPositionAssigned:x,isByePosition:z,validActions:M,...se}}function eR({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[vA]?.drawTypeCoercion,n=e?.[vA]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var Cq=({drawDefinition:t})=>{let e=jt({drawDefinition:t},[{[$s]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Ut&&n.stageSequence===1);if(!i)return ce({result:{error:tH}});let{qualifierPositions:r}=aa({structure:i});return vt(0,r.length).sort(()=>Math.random()-.5)};function Rq({structureId:t,drawDefinition:e}){if(!e)return{error:Nt};if(!jr(t))return{error:be};let i=qU({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Un([Zv,Su,qk,Kv],r).length;return{...se,valid:n}}function YP({tournamentRecord:t,drawDefinition:e,stage:i=Ut,structureId:r,structure:n}){if(!t)return{error:Qe};if(!n&&!e)return{error:Nt};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:dc};let{error:a,positionAssignments:s}=Sr({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function ple({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:be};let i=RU(t);return i?{drawSize:i}:ce({result:{error:be},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function tR(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=t?.participantsCount??t?.participantCount;if(!i){let f=gm({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return ce({result:f,stack:l});i=f.policyDefinitions}let u=fi(c);if(c&&!u)return ce({result:{error:be},context:{participantsCount:c},stack:l});if(n&&!u)return ce({result:{error:Ore},stack:l});if(isNaN(r))if(c)({drawSize:r}=ple({participantsCount:c}));else return ce({result:{error:n1},stack:l});let d=n&&c||r;if(d&&d>r)return{error:uH};let p=i?.[bu];if(!p)return{error:Sre};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=r:r===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:sre}}function LO({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=cn({tournamentRecord:i})),!s)return{error:o1};if(!Array.isArray(s))return{error:be};if(!o)return{error:Or};let l=e?.[Fa]??r?.[Fa]??KU[Fa],c=(a??l?.participants?.enforceGender)!==!1,{eventType:u,gender:d}=o,p=u===jf,h=u===El&&pr||p&&Di||Li,f=Object.assign({},...(t??o.entries??[]).map(v=>({[v.participantId]:v.entryStatus}))),m=Object.keys(f),g=s.filter(v=>m.includes(v.participantId)).filter(v=>{let y=e_e({participant:v,participantType:h,eventType:u,entryStatusMap:f}),b=t_e({genderEnforced:c,participantMap:n,eventGender:d,participant:v,isDoubles:p,mismatch:y});return y||!b});if(g.length){let v=g.map(y=>y.participantId);return{error:mre,invalidParticipantIds:v}}return{...se,valid:!0}}function e_e({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[jf,El].includes(i)&&t.participantType===Li&&(Sv(n)||n===Nh);return t.participantType!==e&&!a}function t_e(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&vi(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||lh(r)||hp(r)&&Ms(o[0])===Ms(r)||ec(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),c=e?.person?.sex,u=!e?.person||!r||ec(r)||lh(r)||hp(r)&&Ms(c)===Ms(r);return!s||l&&u}function hle({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",c=[],u=[],d=[],p=(y,b)=>y.stageSequence-b.stageSequence,h=(y,b)=>y.roundTarget-b.roundTarget,f=0,m=0,g,v=1;for(let y of e.sort(h)){let b=y.structureProfiles||[];v=y.roundTarget||v;let I=1,w=0,T,S,D;for(let C of(b||[]).sort(p)){let E=WG(C.drawSize||C.participantsCount),{qualifyingRoundNumber:P,structureOptions:R,matchUpFormat:M,structureName:A,structureId:N,drawType:k}=C,x=C.matchUpType,O=C.qualifyingPositions||i_e({drawSize:E,qualifyingRoundNumber:P}),V,F,j;if(!fi(E))return ce({result:{error:n1},stack:l});let q=e.length>1?`${v}-`:"",W=b.length>1||q?I:"",z=A||(q||W?`${gs(Ht)} ${q}${W}`:gs(Ht));if(k===$u){let{structures:H,groupCount:Z,maxRoundNumber:J}=j1({structureName:C.structureName||z,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:Ht,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:I,matchUpType:x,roundTarget:v,tieFormat:n,drawSize:E,idPrefix:a,isMock:s,uuids:o});w=Z,V=J,F=H[0],g=[1]}else({drawSize:E,matchUps:j,roundLimit:V}=bp({qualifyingRoundNumber:P,qualifyingPositions:O,matchUpType:x,drawSize:E,idPrefix:a,isMock:s,uuids:o})),F=Ac({structureName:C.structureName||z,structureId:N||o?.pop(),qualifyingRoundNumber:V,hasExistingDrawDefinition:t,stage:Ht,qualifyingOnly:r,matchUpFormat:M,stageSequence:I,matchUpType:x,roundLimit:V,tieFormat:n,matchUps:j}),v&&ir({extension:{name:Op,value:v},element:F}),w=j?.filter(H=>H.roundNumber===V)?.length||0;if(I>1){let{link:H}=q1({sourceStructureId:S,sourceRoundNumber:T,targetStructureId:F.structureId,finishingPositions:D===Dh?[1]:void 0,linkType:D});d.push(H),f+=(E||0)-w}else f+=E||0;D=k===$u?Dh:Eh,S=F.structureId,T=V,n&&(j=rr({structure:F})?.matchUps||[],j?.forEach(H=>{let{tieMatchUps:Z}=ow({tieFormat:n,matchUp:H,isMock:s});Object.assign(H,{tieMatchUps:Z,matchUpType:x})})),u.push(F),I+=1}m+=w,c.push({qualifiersCount:w,finalQualifyingRoundNumber:T,finalQualifyingStructureId:S,finishingPositions:g,roundTarget:v,linkType:D}),v+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:f,qualifyingDetails:c,structures:u,...se,links:d}}function i_e({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function fle(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=ii(t.drawSize),n=e&&t.drawType!==Pl&&(typeof e=="boolean"||e<=2)&&r===2&&ip||t.drawType||ip,a=gae.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=ip;else if(r<4&&i)return{...ce({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:Ek},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function r_e(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:gs(Ut),...t,stage:Ut},{structures:a,groupCount:s}=j1(n);if(s<1)return{error:Jre};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:gs(In)}],[l]=a,{structures:c,links:u}=Roe({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return c&&a.push(...c),{...se,structures:a,links:u}}function n_e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=r.map((c,u)=>{let d=r.indexOf(c)%2?Su:Zv,p=1+u;return{linkType:Ph,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:Eh,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Su,roundNumber:n,structureId:t.structureId}},l=[{linkType:Eh,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Su,roundNumber:1,structureId:i.structureId}},{linkType:Ph,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Su,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function a_e({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=hg({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=ig({structureName:t||gs(Ut),structureId:a?.pop(),stageSequence:1,stage:Ut,matchUpType:e,matchUps:o});s.push(l);let c=r/2,{matchUps:u}=hg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=ig({structureName:gs(mae),matchUps:u,structureId:a?.pop(),stage:bs,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=bp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),h=ig({structureName:gs(fae),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:In,matchUpType:e});s.push(h);let f=n_e({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...se}}function s_e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!fi(s)||s<2)return{matchUps:[],roundsCount:0};if(wd(s))return bp(t);let c=o_e(s),u=c.shift(),d=vt(1,(u?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=RA({roundNumber:h,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=vt(1,v+1);r&&v===r&&(f=h-1);let b=y.map(I=>{let w=lq({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:w}});p.push(...b),h++}let m=h-1;return p=O1({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function o_e(t){let e=ii(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function mle(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Ut,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||l()||o?.pop(),u=t.appliedPolicies??Qi(t),d=t.policyDefinitions?.[PT]||u?.[PT];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??gs(Ut),h=()=>{let{matchUps:f}=bp(t);return{structures:[Ac({stageSequence:i,structureName:p,matchUpType:a,structureId:c,tieFormat:n,matchUps:f,stage:r})],links:[],...se}};return{generators:{[Pl]:()=>({structures:[Ac({finishingPosition:Xv,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:c,stage:r})],links:[],...se}),[Py]:()=>{let{matchUps:f}=s_e(t);return{structures:[Ac({stageSequence:i,structureName:p,matchUpType:a,structureId:c,matchUps:f,stage:r})],links:[],...se}},[ip]:()=>h(),[f1]:()=>a_e(t),[TT]:()=>nT({...t,roundOffsetLimit:3,playoffAttributes:e??LH}),[UT]:()=>nT({...t,roundOffsetLimit:2,playoffAttributes:e??FH}),[In]:()=>nT(t),[FU]:()=>{let{matchUps:f}=hg({drawSize:s,uuids:o,matchUpType:a});return{structures:[Ac({stageSequence:i,structureName:p,matchUpType:a,structureId:c,stage:Ut,tieFormat:n,matchUps:f})],links:[],...se}},[m1]:()=>Eoe(t),[DT]:()=>yb({...t,feedRounds:1,fmlc:!0}),[hae]:()=>yb({...t,feedRounds:1}),[kH]:()=>yb({...t,feedsFromFinal:1}),[OH]:()=>yb({...t,feedsFromFinal:2}),[xH]:()=>yb({...t,feedsFromFinal:3}),[g1]:()=>yb(t),[Wk]:()=>Coe(t),[$u]:()=>j1(t),[Ch]:()=>r_e(t)}}}function Mq(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:c}=t||{},u=ii(t.drawSize),d=t.drawTypeCoercion??eR({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",h=fle({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:u});if(h.error)return h;let f=h.drawType,m=[],g=[],v=t?.matchUpType??Ir,y=s?.structures?.filter(({stage:W})=>W===Ht);y&&m.push(...y);let b=y?.map(({structureId:W})=>W),I=s?.structures?.find(({stage:W,stageSequence:z})=>W===Ut&&z===1),w=s?.links?.filter(W=>W.target.structureId===I?.structureId&&b?.includes(W.source.structureId)),T=(W,z)=>{if(W.linkType===Dh&&z?.structures){let H=W.source.finishingPositions||[];return z.structures.length*H.length}else if(W.linkType===Eh&&z?.matchUps?.length){let H=W.source.roundNumber;return z.matchUps.filter(({roundNumber:Z})=>Z===H).length}},S=y?.map(W=>{let z=w?.find(K=>K.target.structureId===W.structureId),H=Sr({structure:W})?.positionAssignments?.length??0;if(!z)return H;let Z=z?.source.structureId,J=s.structures?.find(K=>K.structureId===Z),ie=T(z,J)||0;return H-ie}).filter(Boolean).reduce((W,z)=>W+z,0),D=w?.map(W=>{let z=W.source.structureId,H=y?.find(Z=>Z.structureId===z);return T(W,H)}).filter(Boolean).reduce((W,z)=>W+z,0),C=!!(I&&!I?.matchUps?.length);if(y?.length&&!C)return{error:X$};let E=!y?.length&&t.qualifyingProfiles,P=E?.length&&hle({idPrefix:t.idPrefix,qualifyingProfiles:E,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:c});if(P?.error)return P;let{qualifyingDrawPositionsCount:R,qualifyingDetails:M,qualifiersCount:A}=P||{qualifyingDrawPositionsCount:S,qualifiersCount:D};R&&(P?.structures&&m.push(...P.structures),P?.links&&g.push(...P.links)),Object.assign(t,Lt({drawSize:u,matchUpType:v,tieFormat:o}));let N=f!==Pl&&(!u||u<2||!a&&![FU,Py].includes(f)&&([Ch,$u].includes(f)&&u<3||![$u,Ch].includes(f)&&!wd(u)));if(N&&!R)return ce({context:{drawSize:u,invalidDrawSize:N},result:{error:Ek},stack:p});let{generators:k,error:x}=mle(t);if(x)return{error:x};let O=k[f];if(!O)return{error:XG};let V=O?.();if(V.error)return V;let{structures:F,links:j}=V;if(F?.length){let W=F.find(({stage:z,stageSequence:H})=>z===Ut&&H===1);if(I&&W){if(C){let z=W.structureId;if(W.structureId=I.structureId,j?.length)for(let H of j)H.source.structureId===z&&(H.source.structureId=I.structureId),H.target.structureId===z&&(H.target.structureId=I.structureId)}else if(!i)return{error:X$}}m.push(...F)}m.sort(WI),j?.length&&g.push(...j);let q=V.structures.find(({stage:W,stageSequence:z})=>W===Ut&&z===1);for(let W of M||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:H,roundTarget:Z,finishingPositions:J,linkType:ie}=W,K=q&&q1({targetStructureId:q.structureId,sourceStructureId:H,sourceRoundNumber:z,finishingPositions:J,targetEntryRound:Z,linkType:ie})?.link;if(K?.error)return K;K&&g.push(K)}return w&&g.push(...w),{...se,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:A},structures:m,links:g}}function Nq(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ce({result:{error:Nt},stack:n});let a=e?t.drawDefinition:Tt(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let b=No({tieFormat:s});if(b.error)return b}s=os(s??Ks({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||Ir),t.tieFormat=s,t.matchUpType=o;let l=DA({drawDefinition:a,stage:Ut});t.drawSize=t.drawSize??l,!l&&t.drawSize&&CA({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ut});let c=is({drawDefinition:a}).drawMatchUps.map(Ea),u=Mq(t);if(u.error)return ce({result:u,stack:n});let{structures:d,links:p,qualifyingResult:h}=u;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,h?.qualifiersCount||0);if(h?.qualifyingDrawPositionsCount&&!DA({stage:Ht,drawDefinition:a})){let b=CA({drawSize:h.qualifyingDrawPositionsCount,stage:Ht,drawDefinition:a});if(b.error)return b}if(f){let b=foe({qualifiersCount:f,drawDefinition:a,stage:Ut});if(b.error)return b}let m=t.drawSize??l;Object.assign(t,Lt({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:v}=zn({drawDefinition:a});s&&g?.forEach(b=>{if(!c.includes(b.matchUpId)){let{tieMatchUps:I}=ow({tieFormat:s,matchUp:b,isMock:r});Object.assign(b,{tieMatchUps:I,matchUpType:o})}});let{inContextDrawMatchUps:y}=ty({drawDefinition:a,matchUpsMap:v});return Pr({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...se,structures:d,matchUps:g,links:p}}function iR(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!vle({scaleItem:n}))return{error:iI};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===Co&&n?.eventType!==El)return{error:iI};let o=yle({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=pc();l.includes(Is)&&bi({topic:Is,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...se,info:bH,existingValue:n?.scaleValue}||s&&{...se,newValue:n?.scaleValue}||{error:An}}function gle(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:Qe};if(!r.participants)return{error:o1};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let h of d.scaleItems)if(vle({scaleItem:h}))Array.isArray(o[p])||(o[p]=[]),o[p].push(h);else return{error:iI}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let h of o[p]){if(d.participantType===Co&&h?.eventType!==El)return ce({context:{participantId:p,scaleItem:h,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:iI}});yle({participant:d,scaleItem:h,removePriorValues:i}),l.push(d),s++}}let c=s?void 0:xU,{topics:u}=pc();if(u.includes(Is)&&s&&bi({topic:Is,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...h}=a,f=h.scaleAttributes?.scaleType&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let m={itemType:lz,itemValue:h};if(f&&(m.itemSubTypes=f),p||d){let{drawDefinition:g,event:v}=_o({tournamentRecord:r,eventId:d,drawId:p});p&&rq({drawDefinition:g,timeItem:m}),d&&lw({event:v,timeItem:m})}else J1({tournamentRecord:r,timeItem:m})}}return n&&u.includes(_f)&&bi({topic:_f,payload:n}),Lt({...se,modificationsApplied:s,info:c})}function vle({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function yle({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:BI};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:iI};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=dh({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Jv,c,u,d].join("."),h=Lt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...se,valueChanged:l,newValue:i.scaleValue}}function Aq(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=jt(t,[{[da]:!0},{modifiedScaleValues:!0,[Fo]:Ko}]);if(n.error)return n;for(let a in i){let s=iR({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...se}}function AT(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:na};let{participant:a,tournamentId:s}=Bg({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...dh({participant:a,scaleAttributes:i}),tournamentId:s}:{error:An}}var l_e=(t=0)=>250/Math.pow(t+5,.4),c_e=()=>1;function u_e(t=3,e=2){let i=t/e;return isNaN(i)?CS.kDefault():i}var CS={nSpread:400,diffThreshold:.125,kCalc:l_e,kMultiplier:u_e,kDefault:c_e};function ble(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Ua,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},c=r?.[s];if(!c)return{error:Wt};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,h=d?u.slice().reverse():u,f=(k,x)=>parseFloat(x)>=Math.min(...k)&&parseFloat(x)<=Math.max(...k);(!f(u,e)||!f(u,i))&&(f(u,e)||(e=c.defaultInitialization),f(u,i)||(i=c.defaultInitialization));let m=HS({targetRange:Ua.ELO.range,sourceRange:h,value:d?u[0]-e:e}),g=HS({targetRange:Ua.ELO.range,sourceRange:h,value:d?u[0]-i:i}),v=(k,x)=>1/(1+Math.pow(10,(x-k)/CS.nSpread)),y=v(m,g),b=v(g,m),I=CS.kCalc(n),w=CS.kCalc(a),T=CS.kMultiplier(o,l),S=m+T*I*(1-y),D=g+T*w*(0-b),C=HS({sourceRange:Ua.ELO.range,value:S,targetRange:h}),E=HS({sourceRange:Ua.ELO.range,value:D,targetRange:h}),P=d?u[0]-C:C,R=parseFloat(P.toFixed(p)),M=d?u[0]-E:E,A=parseFloat(M.toFixed(p)),N=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(C>E&&N>CS.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var d_e=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function Ile(t){let e=jt(t,[{[da]:!0},{matchUpIds:!0,[Fo]:Cs,[Pu]:xI},{ratingType:!1,[ds]:y=>Ua[y]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=Ua[a],{accessor:p}=d,h={},f=(t.matchUps||s&&lo({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:Hn}}).matchUps||Ha({matchUpFilters:{matchUpIds:c,matchUpStatuses:Hn},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${WH}`,g=u?m:a;f.sort(tw);for(let y of f){let{endDate:b,matchUpFormat:I,score:w,sides:T,winningSide:S}=y,D=y.matchUpType,C={eventType:D,scaleName:a,scaleType:eg},E={scaleName:m,eventType:D,scaleType:eg},P=Object.assign({},...(T??[]).map(F=>{let{sideNumber:j,participant:q}=F;return j&&{[j]:[q?.participantId,...q?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(P).flat().map(F=>{let j=h[F],q=!s||j?AT({scaleAttributes:E,tournamentRecord:n,participantId:F}).scaleItem:void 0,W=AT({tournamentRecord:n,scaleAttributes:C,participantId:F}).scaleItem,z=p?{[p]:void 0}:void 0;return F&&{[F]:q??W??{scaleName:g,eventType:D,scaleDate:b,scaleType:eg,scaleValue:z}}})),M=I?Bs(I):{},A=M?.bestOf||1,N=M?.setsTo||1,k=o?A&N:A,x=w?.sets&&d_e(w.sets)||S===1&&[1,0]||[0,1],O=S?P[S]:[],V=S?P[3-S]:[];for(let F of O){let j=R[F]?.scaleValue,q=typeof j=="object"?j[p]:j;for(let W of V){let z=R[W]?.scaleValue,H=typeof z=="object"?z[p]:z,Z=S?x[S]:[0,0],J=S?x[3-S]:[0,0],{newWinnerRating:ie,newLoserRating:K}=ble({winnerCountables:Z,loserCountables:J,maxCountables:k,winnerRating:q,loserRating:H,ratingType:a}),ne=p?{...j,[p]:ie}:ie,le=p?{...z,[p]:K}:K;R[F].scaleValue=ne,R[W].scaleValue=le,R[F].scaleName=g,R[W].scaleName=g}}Object.assign(h,R),i&&Aq({tournamentRecord:n,modifiedScaleValues:h,removePriorValues:r})}let v=f.map(({matchUpId:y})=>y);return{...se,modifiedScaleValues:h,outputScaleName:g,processedMatchUpIds:v}}function FO(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:Nt};let{participantIdPairings:o,matchUpsCount:l}=t,c=OO(t);if(c.error)return ce({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ce({result:{error:be,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!fi(l)||e&&!Array.isArray(e)||!o&&!l)return{error:be,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:be,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(u||0))return{error:be,info:"roundNumber error"};let h=r??(n&&(u??0)+1||u||1);o=o??vt(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=g=>{if(!t.idPrefix)return;let v=i.drawId,y=t.idPrefix??"ah";return`${v}-${y}-${h}-${g}`},m=o?.map((g,v)=>{let y=g?.participantIds??[void 0,void 0];y.push(void 0,void 0);let b=y.slice(0,2).map((w,T)=>Lt({sideNumber:T+1,participantId:w})),I=e[v]??f(v)??or();return{roundNumber:h,matchUpStatus:Dn,matchUpId:I,sides:b}});if(m?.length){let g=Ks({drawDefinition:i,event:s})?.tieFormat;g&&m.forEach(v=>{let{tieMatchUps:y}=ow({tieFormat:g,matchUp:v,isMock:a});Object.assign(v,{tieMatchUps:y,matchUpType:_r})})}return{roundNumber:h,matchUpsCount:m?.length??0,matchUps:m,...se}}function p_e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=HY({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[L2(l)];o.push(l);let u=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=Lb(y,b.opponent);if(!g.includes(I)){let w=HY({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(L2(w))){c.push(L2(w)),o.push(w);let{maxDelta:T,value:S}=w;T<d.maxDelta&&(d=w),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=vl(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function L2(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function HY({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=Lb(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),Ca(t,a).map(d=>so(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Lb(h,f),g=r[m];return g>d?g:d},0),u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Lb(h,f),g=n[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function Lb(t,e){return[t,e].sort(SO).join("|")}function wle({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=Lb(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function h_e({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(xi);if(r.length===2){let[n,a]=r,s=Lb(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function f_e({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=Lb(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var m_e=0;function g_e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Ua[r]?.defaultInitialization??m_e;return n.split("|").map(s=>{if(i===Fc){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function v_e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;n.forEach(b=>{let I=g_e({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),w=typeof d=="number"&&d||.5,T=d&&(Math.round(Math.random())?w:w*-1)||0,S=Math.abs(I[0]-I[1])+T,D=Math.abs(I[0]-I[1]);o[b]=D,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=n.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=f_e({possiblePairings:r,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=p_e({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var y_e=100,b_e=100,I_e=4e3;function _q(t){let{encounterValue:e=y_e,sameTeamValue:i=b_e,maxIterations:r=I_e,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:h,structureId:f,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:w}=t;if(!p)return{error:Nt};if(!t.structure&&!f)return{error:Qr};let T=t.structure||si({drawDefinition:p,structureId:f}).structure;if(!ji(T))return{error:Dy};if(!d?.length)return{error:_g};let S=[...o??[],...T?.matchUps??[]],{encounters:D}=h_e({matchUps:S}),C=l?.participants??[],E={};if(c){let Z=vi(T?.matchUps?T.matchUps.map(({roundNumber:ie})=>ie):[]),J=Math.max(...Z,0);if(J){let ie=T?.matchUps?.filter(({roundNumber:ne})=>ne===J).map(({matchUpId:ne})=>ne),K=Ile({ratingType:v??w?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:ie});if(K.error)return K;K.modifiedScaleValues&&(E=K.modifiedScaleValues)}}let{valueObjects:P}=w_e({tournamentParticipants:C,encounterValue:e,sameTeamValue:i,encounters:D}),{uniquePairings:R,possiblePairings:M,deltaObjects:A}=wle({participantIds:d}),N=Object.values(E).length?E:t.adHocRatings,k={tournamentParticipants:C,possiblePairings:M,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:A,valueObjects:P,eventType:g,scaleName:v,salted:I},{candidatesCount:x,participantIdPairings:O,deltaCandidate:V,iterations:F,candidate:j}=v_e(k);if(!x)return{error:kk};let q,W;if(a){let Z=FO({structureId:T?.structureId,ignoreLastRoundNumber:s,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:h,matchUpIds:m,idPrefix:y,isMock:b,event:w});if(Z.error)return Z;q=Z.roundNumber,W=Z.matchUps}let{maxDelta:z,maxDiff:H}=j;return{roundNumber:q,participantIdPairings:O,modifiedScaleValues:E,candidatesCount:x,deltaCandidate:V,...se,iterations:F,matchUps:W,maxDelta:z,maxDiff:H}}function w_e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===pr);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=wle({participantIds:o});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function Sle(t){let{drawType:e=ip,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:c}=t,u=t?.drawDefinition;if(!u)return{error:Nt};let d=La,p=YI({stageSequence:1,drawDefinition:u,stage:d}),h=[$u,f1,Ch].includes(e)?p.length:RU(p.length);if(!a&&e===FU&&p.length<2||e===$u&&p.length<3)return{error:Ek};let{tieFormat:f,matchUpType:m}=t;if(f){let P=No({tieFormat:f});if(P.error)return P}f=os(f??Ks({drawDefinition:u})?.tieFormat),m=m??u.matchUpType;let{structures:g}=ju({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:vre};if(g?.[0]?.matchUps?.length)return{error:wH};let v=g?.[0]?.structureId;Object.assign(t,Lt({structureName:t.structureName??gs(La),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=mle(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:XG};let I=b?.();if(I.error)return I;let{structures:w,links:T}=I,S=w.map(P=>rr({structure:P}).matchUps).flat();f&&S.forEach(P=>{let{tieMatchUps:R}=ow({matchUp:P,tieFormat:f,isMock:l});Object.assign(P,{tieMatchUps:R,matchUpType:m})}),(!r||!i)&&(u=Tt(u,!1,!0)),u.links||(u.links=[]),T.length&&u.links.push(...T);let D=w.map(({structureId:P})=>P);u.structures||(u.structures=[]);let C=u.structures.map(({structureId:P})=>P);u.structures=u.structures.map(P=>D.includes(P.structureId)?w.find(({structureId:R})=>R===P.structureId):P);let E=w.filter(({structureId:P})=>!C.includes(P));return E.length&&u.structures.push(...E),s&&z1({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:v,placeByes:o,drawSize:h,event:c}),i&&Pr({drawDefinition:u}),{links:T,structures:w,...se}}var Fv={};Ai(Fv,{addGame:()=>Mle,addPoint:()=>Rle,addSet:()=>Ale,addShot:()=>Nle,analyzeScore:()=>Vq,analyzeSet:()=>ZP,calculateHistoryScore:()=>Ele,checkScoreHasValue:()=>sa,checkSetIsComplete:()=>VO,clearHistory:()=>Cle,generate:()=>Tle,generateScoreString:()=>ph,generateTieMatchUpScore:()=>Z1,getSetComplement:()=>Gq,getTiebreakComplement:()=>zO,helpers:()=>xle,isValidMatchUpFormat:()=>Dl,keyValueScore:()=>ice,mutate:()=>Dle,parseMatchUpFormat:()=>Bs,parseScoreString:()=>_A,query:()=>oce,redo:()=>_le,reverseScore:()=>Ule,setServingSide:()=>Ple,stringifyMatchUpFormat:()=>jk,tidyScore:()=>sce,umo:()=>Ole,undo:()=>kle,validateMatchUpScore:()=>lce,validateScore:()=>jq,validateSetScore:()=>$q,validateTieFormat:()=>No});var Tle={};Ai(Tle,{generateScoreString:()=>ph,generateTieMatchUpScore:()=>Z1,reverseScore:()=>Ule});function ph(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:Wt,info:"missing sets"};let u=s&&Bs(s),{bestOf:d,finalSetFormat:p,setFormat:h}=u??{},f=n||!(!e||!l||l===1),m=r?S_e({matchUpStatus:a}):"",g=c?.sort(T_e).map(v).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=W=>gn(W?.side1Score)||gn(W?.side2Score),w=(W=>gn(W?.side1TiebreakScore)||gn(W?.side2TiebreakScore))(y),T=b?.tiebreakSet||!I(y)&&w,{side1Score:S,side2Score:D,side1TiebreakScore:C,side2TiebreakScore:E}=y,P=C||(gn(C)||w&&o?0:""),R=E||(gn(E)||w&&o?0:"");if(T){let W=I(y)&&!w,z=W?S:P,H=W?D:R;return`[${(f?[H,z]:[z,H]).join("-")}]`}let M=w?Math.min(P,R):"",A=M===P?1:2,N=gn(M)?`(${M})`:"",k=S||(gn(S)||o?0:""),x=D||(gn(D)||o?0:""),O=W=>!i&&A===W?N:"",V=`${k}${O(1)}`,F=`${x}${O(2)}`,j=i&&w?`(${M})`:"",q=f?`${[F,V].join("-")}${j}`:`${[V,F].join("-")}${j}`;return["-"," "].includes(q)&&(q=""),q}}function S_e({matchUpStatus:t}){let e={[Ia]:"RET",[xr]:"WO",[ia]:"DF/DF",[on]:"WO/WO",[Fg]:"SUS",[rl]:"ABN",[yr]:"DEF",[HU]:"DR"};return t&&e[t]||""}function T_e(t,e){return t.setNumber-e.setNumber}function Ule(t){if(!t?.score)return{error:Wt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Lt({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),r=t?.setTBlast,n=ph({setTBlast:r,sets:i}),a=ph({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...se}}var Dle={};Ai(Dle,{addGame:()=>Mle,addPoint:()=>Rle,addSet:()=>Ale,addShot:()=>Nle,calculateHistoryScore:()=>Ele,clearHistory:()=>Cle,redo:()=>_le,setServingSide:()=>Ple,umo:()=>Ole,undo:()=>kle});function Ly({matchUp:t}){let{extension:e}=Pi({name:nO,element:t});if(!e)return{error:ja};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...se}}function Ele(t){if(!t)return{error:Wt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Mo};let r=Ly({matchUp:e})?.history||[];if(!Array.isArray(r))return{error:be,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:nH};if(!Dl({matchUpFormat:n}))return{error:rH};let a=Bs(n),{bestOf:s,finalSetFormat:o,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=E=>[1,2].includes(E),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),w=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=w(),S=I(),D=b(),C=0;for(let E of r){C+=1,g=u.sets.length+1===s;let P=g&&o?o:l,{tiebreakAt:R,setTo:M,NoAD:A,tiebbreakFormat:N}=P,k=D.side1Score===R&&D.side1Score===D.side2Score,x=!!P.tiebreakSet,O=x?P.tiebreakSet:N,{tiebreakTo:V,NoAD:F}=O||{},j=()=>{p=void 0,h=[0,0],f=3-f,D.side1TiebreakScore="",D.side2TiebreakScore="",D.side1PointScore="",D.side2PointScore="",v=0},q=H=>{D.winningSide=H;let{s:Z,...J}=D;u.sets.push(J),T=w(),S=I(),D=b(),j()},W=H=>{S.winningSide=H;let{g:Z,...J}=S;D.games.push(J),T=w(),S=I(),j();let ie=`side${H}Score`;D[ie]+=1},z=H=>{T.winningSide=H;let{p:Z,...J}=T;S.points.push(J),T=w(),v=0;let ie=()=>h.reduce((ne,le)=>ne+le)%4/4>.5?f:3-f,K=H-1;if(k||x){h[K]+=1,p=ie(),D[`side${H}TiebreakScore`]=h[K],D[`side${3-H}TiebreakScore`]=h[1-K];let ne=F?1:2;if(h[K]>=V&&h[K]>=h[1-K]+ne)return W(H),{gameCompleted:!0}}else if(h[1-K]===4&&h[K]===3?h[1-K]-=1:h[K]+=1,D.side1PointScore=c[h[0]],D.side2PointScore=c[h[1]],h[K]===5||h[K]===4&&h[1-K]<3||A&&h[K]===4)return W(H),{gameCompleted:!0}};if(y(E.srv)&&(f=E.srv),["p","s","g","o"].includes(E.u)&&d.push(E.u),E.shotOutcome&&(T.shots.push(E),E.shotType==="SERVE"&&["OUT","NET"].includes(E.shotOutcome)&&(v+=1),v===2)){let H=3-f;z(H)}if(y(E.p)||fi(E.pointNumber)){let H=E.winningSide||E.p;if(z(H)?.gameCompleted)continue}if(y(E.g)||fi(E.gameNumber)){let H=E.winningSide||E.g;S.winningSide=H;let Z=`side${H}Score`,J=`side${3-H}Score`;if(d.length&&(d.includes("p"),d=[]),W(H),D[Z]===M&&D[Z]-D[J]>=(A?1:2)&&(q(H),g))break}if(y(E.s)||fi(E.setNumber)){let H=E.winningSide||E.s;if(q(H),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return C!==r.length&&console.log({error:"Match completed with excess history"}),(D.side1Score||D.side2Score||D.games.length||D.side1TiebreakScore||D.side2TiebreakScore)&&u.sets.push(D),u.scoreStringSide1=ph({...u,matchUpFormat:n}),u.scoreStringSide2=ph({...u,matchUpFormat:n,reversed:!0}),f=p||f,i&&(e.score=u),{...se,servingSide:f,score:u}}function Fy({undoHistory:t,history:e,matchUp:i}){return ir({element:i,extension:{value:{history:e,undoHistory:t},name:nO}})}function Ple({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:lH};let{history:i=[]}=Ly({matchUp:t});return i.push({srv:e}),Fy({matchUp:t,history:i})}function Cle({matchUp:t}){return Fy({matchUp:t})}function Rle({matchUp:t,point:e}){if(!e||!t)return{error:Wt};if(typeof e!="object")return{error:be,context:{point:e}};let{history:i=[]}=Ly({matchUp:t});return i.push(e),Fy({matchUp:t,history:i})}function Mle({matchUp:t,game:e}){if(typeof e!="object")return{error:be,context:{game:e}};let{history:i=[]}=Ly({matchUp:t});return i.push(e),Fy({matchUp:t,history:i})}function Nle({matchUp:t,shot:e}){if(typeof e!="object")return{error:Wt};let{history:i=[]}=Ly({matchUp:t});return i.push(e),Fy({matchUp:t,history:i})}function Ale({matchUp:t,set:e}){if(typeof e!="object")return{error:Wt};let{history:i=[]}=Ly({matchUp:t});return i.push(e),Fy({matchUp:t,history:i})}function _le({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ly({matchUp:t});return i.length&&e.push(i.pop()),Fy({matchUp:t,history:e,undoHistory:i})}function kle({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ly({matchUp:t});return i.push(e.pop()),Fy({matchUp:t,history:e,undoHistory:i})}var Ole={},xle={};Ai(xle,{keyValueScore:()=>ice,parseMatchUpFormat:()=>Bs,stringifyMatchUpFormat:()=>jk,tidyScore:()=>sce});var U_e="COMPLETED",D_e="WO/WO",Lle=["RET","DEF","WO",D_e,"ABN","SUS","INT"],TV="DEFAULTED",Fle="WALKOVER",Ble="ABANDONED",$le="SUSPENDED",Vle="RETIRED",jle="INTERRUPTED",E_e=[Vle,TV,Fle],P_e="Enter Score",pI="()",ay="[]",kq=["up","left","shift+tab"],Oq=["enter","down","tab","right"],MA="backspace",Gle="r",Hle="s",zle="a",qle="d",Wle="w",Yle="i",BO=[Gle,qle,Wle,zle,Hle,Yle],$O="space",F2=["[","("],NA=[...kq,...Oq,$O,"]"],Kle="-",C_e="/",Fb=Kle,hh=Kle,Zle=[C_e],R_e=0,M_e=["=","+","num_1","num_2","shift+=","shift+-"],Kp=["0","1","2","3","4","5","6","7","8","9"].concat(BO),Xle=Kp.map(t=>`shift+${t}`),xq=[Fb,MA].concat(NA,Zle),Jle=[Kp,Xle,xq].join(","),N_e=[Jle,kq,Oq,M_e].join(",");[].concat(...Kp,...Kp,...xq,...Kp,...Kp,...Kp,...Kp,...Kp,...Kp);var Lq={OUTCOMEKEYS:BO,SIDE1KEYS:Kp,SIDE2KEYS:Xle,MODIFIERS:xq,PROMPT:P_e,MOVEUP:kq,MOVEDOWN:Oq,HOTKEYS:N_e};function lS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Qle({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function Qle({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Lle){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function UV({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=Qle({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=aT({brackets:ay,scoreString:e}),f=__e(e);if(f>=0){n=e.slice(0,f);let{isTiebreakEntry:m}=aT({brackets:pI,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:v}=aT({brackets:ay,scoreString:n}),y=n&&n[n.length-1].trim(),b=n&&!isNaN(y),I=t.isIncompleteSetScore;if(h&&v){let w=n.slice(g+1).split(hh),T=w?.length>0&&w[0]!==void 0&&!isNaN(parseInt(w[0]))&&parseInt(w[0])||void 0,S=w?.length>1&&w[1]!==void 0&&parseInt(w[1])||void 0,D=[T,S];if(S){let C=r===1?1:0;D[C]=(D?.[1-C]||0)+(p?1:2),(D[C]||0)<d&&(D[C]=d),n=e.slice(0,g+1),n+=D.join(hh)}else T!==void 0?(n=e.slice(0,g+1),n+=T):(n=e.slice(0,g),I=!0);l.side1TiebreakScore=D[0]||0,l.side2TiebreakScore=D[1]||0}if(n.length||(n=void 0),I){let w=l.side1Score?.toString();if(w){let T=w?.slice(0,w.length-1);l.side1Score=!isNaN(T)&&parseInt(T)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(b){let w=l.side2Score?.toString(),T=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let S=w?.slice(0,w.length-1);l.side2Score=!isNaN(S)&&parseInt(S)||void 0}else{let S=T?.slice(0,T.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!v?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function aT({brackets:t=pI,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...tp(i,n)),s=Math.max(...tp(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function A_e({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=ay.split(""),a=t.split(""),s=Math.max(...tp(r,a)),o=Math.max(...tp(n,a)),l=Math.max(...tp(hh,a));return i&&s>o&&l>s}function __e(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function ece(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function zY({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=Bs(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,c)=>{let{winningSide:u}=c;return u&&l[u-1]++,l},[0,0])?.indexOf(s)+1||void 0;return E_e.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function VO({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Wt,info:"missing set"};e=e||i&&Bs(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:c}=s,{setTo:u,tiebreakAt:d}=o,p=l||c,h=jO({set:s}),f=Math.abs(l-c),m=l>=u||c>=u,g=r||l>=u&&c>=u||d&&d<u&&(l===d||c===d),v=t||g&&(h===1&&s.side1TiebreakScore>s.side2TiebreakScore||h===2&&s.side2TiebreakScore>s.side1TiebreakScore),y=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,b=f>=y;return!!((a&&p||m&&(b||g)||r)&&(!g||v))}function jO({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Fq({analysis:t,set:e}){let i=jO({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return VO({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function k_e({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=ii(r);let{validSide2Score:s,requiresTiebreak:o}=O_e({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=Fq({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=pI.split("")[0];e+=c}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function O_e({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,c;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=o===a&&i===n||o===n&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function tce({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===Gle?r?(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=Vle):(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=TV):e===qle?(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=TV):e===Wle?(s=!0,i=[],r="WO",n=t===2?1:2,a=Fle):e===Hle&&r?(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"SUS"}),a=$le,n=void 0):e===zle?(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"ABN"}),a=Ble,n=void 0):e===Yle&&r&&(s=!0,r=lS({scoreString:r,lowSide:t,outcome:"INT"}),a=jle,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function x_e(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!e?.length&&l!==MA&&(e=[{setNumber:1}]);let d=e.length-1;if(BO.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=tce({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===MA){if({scoreString:r,sets:e,outcomeRemoved:u}=UV({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===$O){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===Fb&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ii((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ii(h),p=e[d].side1Score.toString(),c=!0}else{let h=ii((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ii(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?r=h+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function L_e({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=ay.split("");if(t.isMatchTiebreakEntry||(r+=u),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=aT({brackets:ay,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(hh);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let h=[p[0]||0,p[1]||0].map(g=>ii(g)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<l&&(h[f]=l);let m=n[n.length-1];m.side1TiebreakScore=h[0],m.side2TiebreakScore=h[1],r=r.slice(0,(d??0)+1),r+=h.join(hh),s=!0}else{let h=[p[0]||0,p[1]||0].map(m=>ii(m)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let d=ece({lowValue:ii(a||0),tiebreakTo:l,NoAD:c}),p=[ii(a),d];i===2&&p.reverse();let h={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(h),r+=p.join(hh),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function F_e({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=f(),c=[r,l];e===2&&c.reverse();let u=pI.split("")[0],d=c.join(Fb)+(o?u:" ");i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=Fq({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?r+1:r+1===n?r+(s?1:2):n}}function B_e({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(V=>V?.winningSide)?.length||0)+(i?0:1),s=Bs(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},c=l?.timed,u=o&&n[s?.bestOf-1],d=u?.winningSide,{isTiebreakEntry:p}=aT({brackets:pI,scoreString:e}),{isTiebreakEntry:h}=aT({brackets:ay,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),v=e&&!isNaN(g),y=!f&&g===Fb,b=p&&F2.includes(g),I=h&&F2.includes(g),w=h&&g===hh,T=e?.split(""),[S]=ay.split(""),D=T&&Math.max(...tp(S,T)),C=T&&Math.max(...tp(hh,T)),E=T&&C>D,P=n[n.length-1]?.winningSide,R=n?.length&&!P,M=Lle.find(V=>e?.indexOf(V)>=0),A=!isNaN(r),N=r===$O,k=NA.includes(r),x=e?.split("").find(V=>F2.includes(V)),O=k&&h&&!I&&(w||!A_e({scoreString:e}));return{isTiebreakSetValue:m&&A,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:R,isSpace:N,isCloser:k,isTiebreakCloser:k&&x&&f&&v,isDecidingSet:o,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:A,hasOpener:x,hasOutcome:M,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:P,isInvalidSetTiebreakValue:N&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:w}}function ice(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Jle.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=zY({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=B_e({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(Zle.includes(i)&&(i=Fb),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ii(i)===0&&(f.isTiebreakCloser=!0),NA.includes(i)&&f.hasOpener&&(i=""),NA.includes(i)&&(i=$O),f.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(f.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:s,winningSide:a}=x_e({analysis:f,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(BO.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:u}=tce({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===MA)u=!0,{scoreString:r,sets:n}=UV({analysis:f,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Fb&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=UV({analysis:f,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===hh&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,r+=hh);else if([Fb,hh].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:n,scoreString:r,updated:u}=k_e({analysis:f,scoreString:r,sets:n,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?pI:ay,g=m.split("").reverse()[0],v=m.split("")[0],y=n[n.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:w}=b||{},T=jO({set:y});if(!f.isTiebreakSet){let D=parseInt(r.split(v).reverse()[0]),C=ece({lowValue:D,tiebreakTo:I,NoAD:w});T===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=D):(y.side1TiebreakScore=D,y.side2TiebreakScore=C)}r=(r||"")+g,f.isDecidingSet||(r+=" ");let S=Fq({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=L_e({analysis:f,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(f.isSetTiebreakEntry){let[m]=pI.split(""),g=Math.max(...tp(m,r.split(""))),v=r.slice(g+1),y=v&&ii(v)===R_e,b=ii(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:w,NoAD:T}=I||{};!y&&v.length<2?T&&b>w-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!n.length){u=!0;let{scoreString:m,set:g}=F_e({analysis:f,lowSide:e,scoreString:r,value:ii(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=m||void 0}else console.log("error: unknown outcome")}if(u){n=n?.filter(Boolean);let{matchUpWinningSide:m}=zY({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Dn,Cl].includes(s))?(s=U_e,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):r&&!a&&![$le,Ble,jle].includes(s)&&(s=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var GO="\\d+-\\d+",KP="\\d+-\\d+\\(\\d+\\)",Bq="\\[\\d+-\\d+\\]",$_e="\\d+-\\d+\\(\\d+-\\d+\\)",V_e=new RegExp(`(${GO}),`,"g"),j_e=new RegExp(`(${KP}),`,"g"),G_e=[GO,KP,Bq,$_e],H_e=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],z_e=H_e.map(t=>{let e=t.split("").map(i=>G_e[i]).join(" ");return new RegExp(`^${e}$`)});function qY(t){return!t||z_e.some(e=>e.test(t))}function q_e(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let c="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",u=c.split("").find(d=>d!==n);if(c.includes(o))r[n]||(n="");else return r[o]||(n=""),u}return s}).join("");return t!==a?a:t}function IN(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function W_e(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function _T(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function AA(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function WY(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function Y_e(t){return t.startsWith("(")&&t.endsWith(")")}function K_e({score:t,applied:e}){t=q_e(t);let i=/\)(\d+)/g;if(i.test(t))for(let T of t.match(i)){let S=T.replace(")",") ");t=t.replace(T,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let T of a||[]){let[S]=T.match(n).slice(1),D=S.replace(/ /g,"");t=t.replace(T,`(${D})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let T=t.match(s);T.length&&T.forEach(S=>{let D=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,D)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let T=t.match(s);T.length&&T.forEach(S=>{let D=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,D)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(T=>{let S=new RegExp(`(\\d+)${T}(\\d+)`,"g"),D=t.match(S);D&&D.forEach(C=>t=t.replace(C,C.split(T).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(T=>{let[S]=T.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(T,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(T=>{let[S]=T.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&S==="6"?t=t.replace(T,"(6-0)"):t=t.replace(T,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(T=>{let[S]=T.match(/(\d\/\d)\/,/).slice(1);t=t.replace(T,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(T=>{let[S]=T.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(T,`(6-${S})`):t=t.replace(T,`(${S})`)});let p,h,f,m,g,v=()=>{g=Ul(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[T]=t.match(y).slice(1);t=t.replace(y,T+")")}if(g["("]===g[")"]&&g["("]>1){let T=t.split(")(").join(") (").split(" ");T.every(Y_e)?t=T.map(S=>{let D=S.slice(1,S.length-1);return D.length>2?D:S}).join(" "):t=T.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(T=>g[T])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(T=>g[T]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let T=[],S=0;for(let D of t.split("").reverse())D===")"&&(S?T.push("("):S+=1),D==="("&&(S-=1),T.push(D);T.reverse(),t=T.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let T="",S=0;for(let D of t.split(""))D==="("&&(S?T+=")":S+=1),D===")"&&(S-=1),T+=D;t=T}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let w=T=>{let S=T.indexOf("("),D=T.indexOf(")");return S>=0&&D>=0&&S<D};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let T=t.slice(1,t.length-1);w(T)&&(t=T,v())}return{score:t,applied:e}}function HO(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=tp("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function Z_e({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[V_e,j_e].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(HO).join(" "),{score:t,applied:e}}function X_e({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(IN),a=0,s="";for(let p of n){let h=tp(p,r).filter(v=>!a||v>a)[0],f=r.slice(a,h-1),m=r[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,w=[b,I].sort().reverse().join("-"),T=[f.join(" "),[w,p].join("")].join(" ");s+=T,a=h+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>W_e(p)&&"bracket"||_T(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return r.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}r=t.split(" ");let l,c=r.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=tp("tiebreak",c);if(u.length){let p="";r.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!_T(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(Bq).test(p)&&"super"||new RegExp(KP).test(p)&&"tiebreak"||new RegExp(GO).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function J_e({score:t,applied:e}){for(let D of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${D}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(R=>parseInt(R)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(D).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[D,C,E,P,R,M]=t.match(i).slice(1);t=t.replace(i,`${D}${C}-${E} ${P}-${R}${M}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(D=>(n.test(D)&&(D=D.replace("("," (")),a.test(D)&&(D=D.replace(")",") ")),D)).join(" "),e.push("spaceConsiderationPatterns")});let s=HO(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[D,C,E]=t.match(o).slice(1),[P,R]=C.split("");t=`${D}-${P} ${R}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[D,C]=t.match(c).slice(1),E=D.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let R=E.match(l).slice(1,3).join("-"),M=P.match(l).slice(1,3).join("-");t=`${R} ${M}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[D,C]=t.match(u).slice(1),E=D.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let R=E.match(l).slice(1,3).join("-"),M=P.match(l).slice(1,3).join("-");t=`${R} ${M}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let D=t.match(d)[0],C=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[D,C,E]=t.match(h).slice(1),P=C.split(""),R=`${D}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,R),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m?.length){let D=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(D).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(D=>{let C=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(D=>{let C=" "+D.slice(1).split(" ").join("-");t=t.replace(D,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let D=t.match(v)[0],C=D.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(D,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let D=t.match(b),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;D.forEach(P=>{let[R,M]=P.match(C).slice(1),A=`${R}-${M}`;E=E.replace(P,A)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[D,C,E]=t.match(I).slice(1);D.replace(/\D/g,"").length>=4&&(t=D+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let w=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let D of t.match(w)||[]){let[C,E,P,R]=D.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[M,A]=E.split("-").map(N=>parseInt(N));Math.abs(M-A)===1&&(t=t.replace(D,`${C}${E}(${P})${R}`),e.push("spaceSeparatedSetPattern"))}let T=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let D of t.match(T)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,R]=D.match(C).slice(1),[M,A]=E.split("-").map(N=>parseInt(N));Math.abs(M-A)===1&&(t=t.replace(D,`${E}(${P})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let D of t.match(S)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=D.match(C).slice(1);t=t.replace(D,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function Q_e({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(_T(l[0]))return l[0]+`(${l[1].slice(0,l[1].length-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(gn(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let c=l.indexOf("1");l=AA(l.split(""),c)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let c=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&c){let[u,d,p]=Array.from(o.match(n)).slice(1),h=Math.min(d,p);return`${u}(${h})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1),u=l.split("");return`${u[0]}-${u[1]}(${c})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1);return _T(l)?`${l}(${c})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function eke({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let u of n||[]){let d=u.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(u)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(m[0]-m[1])===1)continue}let h=WY(d),f=HO(h);t=t.replace(u,`(${f})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(u=>{let d=WY(u.match(/^\[(.*)\]$/)[1]);t=t.replace(u,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(u=>t.endsWith(u))&&o.some(u=>t.includes(u))){let u="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||IN(g)),h=d.every(g=>g.includes("/")||IN(g)),f=d.every(g=>g.includes("-")||IN(g)),m=p&&","||f&&"-"||h&&"/";if(m){let g;d.forEach(v=>{if(v.startsWith("("))if(g==="set"&&(u+=" "),v.includes(m))u+=v.slice(1).split(m).map(y=>y.trim()).join("-"),g="set";else{let y=v.slice(1);u+=`(${y}) `,g="tiebreak"}else if(v.startsWith("[")){let y=v.slice(1).split(m).map(I=>parseInt(I.trim())),b=Math.min(...y);g==="set"?u+=`(${b}) `:u+=`[${y.join("-")}] `,g="tiebreak"}}),t=u.trim()}}let l=Ul(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&_T(t)&&gn(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function rce({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=gn(o)&&parseInt(o),c=r[0]!==void 0&&r[1]!==void 0;if(gn(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&gn(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&s()}}return{sets:i}}function DV(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=AA(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=AA(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function nce(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>gn(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(c=>parseInt(c)):e.split("").map(c=>parseInt(c)),{sets:l}=rce({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[c,u,d]=o;e=`${c}-${u}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[c,u,d]=o;e=`[${c}${u}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[c,u,d,p]=o,h=Math.min(d,p);e=`${c}-${u}(${h})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[c,u,d,p]=o;e=`[${c}${u}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[c,u,d,p]=o;e=`${c}${u} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[c,u,d,p,h]=o;e=`${c}-${u}(${d}) ${p}-${h}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[c,u,d,p,h]=o;e=`${c}-${u} ${d}-${p}(${h})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p} [${h}${f}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u}(${d}) ${p}-${h} ${f}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p}(${h}) ${f}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p} ${h}-${f}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let c=DV(e);c&&e!==c&&i.push("parsedSuperPattern"),e=c??e}else{let c=Ca(e.split(""),2).map(v=>v.join("")),u=c.map(v=>{let[y,b]=v.split("").map(T=>parseInt(T)),I=Math.abs(y-b),w=y>b?1:2;return I>1&&w||w*-1}),d=u.reduce((v,y)=>v>0&&y>0,1),p=Ul(u),h=u.map(v=>Math.abs(v)),f=Ul(h),m=u[0]<0,g=!m&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[c.slice(0,2).join(" "),c.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=c.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(f).includes(3))e=c.join(" "),i.push("chunkSplit");else{let[v,y,b,I,w,T]=o,S=u.reduce((D,C,E)=>C<0?E:D,void 0);if(S===0){let D=Math.min(b,I);e=`${v}-${y}(${D}) ${w}-${T}`,i.push("chunkSplitTiebreak1")}else if(S===1){let D=Math.min(w,T);e=`${v}-${y} ${b}-${I}(${D})`,i.push("chunkSplitTiebreak2")}else e=`${v}-${y} ${b}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[v,y,b,I,w,T,S,D]=o;m||g?o[5]===1&&(m?e=`${v}-${y}(${b}) ${I}-${w} [${T}${S}-${D}]`:e=`${v}-${y} ${b}-${I}(${w}) [${T}${S}-${D}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function ace(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function tke({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(KP).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!_T(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&gn(u))return u.split("").join("-");u=HO(u);let p=new RegExp(`^${Bq}$`).test(u)&&"super"||new RegExp(`^${KP}$`).test(u)&&"tiebreak"||new RegExp(`^${GO}$`).test(u)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(w=>parseInt(w)>v||d&&parseInt(w)<=n)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=ace(t);if(c===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function ike({score:t}){let{setsTied:e,winningSide:i}=ace(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>gn(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function rke({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function nke({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function ake({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=AA(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=nce({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function ske({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&DV(t)?{score:DV(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function oke({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function lke({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function cke({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function uke({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function dke({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function pke({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function hke({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function fke({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>gn(i))&&e.length===4&&(t=e)}return{score:t}}function mke({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var gke={handleTiebreakSlashSeparation:hke,handleSetSlashSeparation:dke,punctuationAdjustments:K_e,handleGameSeparation:pke,joinFloatingTiebreak:X_e,handleBracketSpacing:Z_e,handleSpaceSeparator:fke,separateScoreBlocks:ake,matchKnownPatterns:J_e,removeDanglingBits:uke,removeErroneous:ske,handleDefaulted:cke,handleWalkover:oke,properTiebreak:Q_e,handleNumeric:nce,handleRetired:lke,containedSets:eke,sensibleSets:tke,stringScore:rke,superSquare:ike,setBuilder:rce,excisions:mke,replaceOh:nke},B2={},vke=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],yke=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function sce(t){if(!t.score)return{error:be};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=gke[v]({profile:o,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(vke);let m=qY(h);return m||(h=e.toString().replace(/\D/g,""),d?.removed&&(d.removed=void 0),f(yke),m=qY(h),m||(h="")),u.forEach(g=>{B2[g]||(B2[g]=0),B2[g]+=1}),{matchUpStatus:c?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var oce={};Ai(oce,{analyzeScore:()=>Vq,analyzeSet:()=>ZP,checkScoreHasValue:()=>sa,checkSetIsComplete:()=>VO,getSetComplement:()=>Gq,getTiebreakComplement:()=>zO,isValidMatchUpFormat:()=>Dl,parseScoreString:()=>_A,validateMatchUpScore:()=>lce,validateScore:()=>jq,validateSetScore:()=>$q,validateTieFormat:()=>No});function $q(t,e,i,r){if(!e)return{isValid:!0};let n=Bs(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:c}=a,u=c?.tiebreakTo,d=!!u&&!s,p=t.side1TiebreakScore,h=t.side2TiebreakScore,f=p!==void 0&&h!==void 0,m=d&&f?p:t.side1Score||t.side1||0,g=d&&f?h:t.side2Score||t.side2||0,v=Math.max(m,g),y=Math.min(m,g),b=v-y;if(d)return r?{isValid:!0}:m===0&&g===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:v<u?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${u}, got ${v}`}:b<2?{isValid:!1,error:`Tiebreak-only set must be won by at least 2 points, got ${v}-${y}`}:v===u&&y>u-2?{isValid:!1,error:`Tiebreak-only set at ${u}-${y} requires playing past ${u}`}:v>u&&b!==2?{isValid:!1,error:`Tiebreak-only set past ${u} must be won by exactly 2 points, got ${v}-${y}`}:{isValid:!0};let I=p!==void 0||h!==void 0,w=s&&v===s+1&&y===s;if(I||w){if(s){if(v!==s+1)return{isValid:!1,error:`Tiebreak set winner must have ${s+1} games, got ${v}`};if(y!==s)return{isValid:!1,error:`Tiebreak set loser must have ${s} games when tied, got ${y}`}}if(I&&l){let T=Math.max(p||0,h||0),S=Math.min(p||0,h||0),D=T-S,C=l.tiebreakTo||7;if(T<C)return{isValid:!1,error:`Tiebreak winner must reach ${C} points, got ${T}`};if(D<2)return{isValid:!1,error:`Tiebreak must be won by 2 points, got ${T}-${S}`};if(S>=C-1&&D>2)return{isValid:!1,error:`Tiebreak score ${T}-${S} is invalid`}}}else{if(s&&o){if(m===s+1&&g<s-1)return{isValid:!1,error:`With tiebreak format, if side 1 has ${s+1} games, side 2 must be at least ${s-1}, got ${g}`};if(g===s+1&&m<s-1)return{isValid:!1,error:`With tiebreak format, if side 2 has ${s+1} games, side 1 must be at least ${s-1}, got ${m}`}}if(r)return s&&(v>s+10||y>s+10)?{isValid:!1,error:`Set score ${v}-${y} exceeds expected range for ${s}-game sets`}:{isValid:!0};if(s&&v<s)return{isValid:!1,error:`Set winner must reach ${s} games, got ${v}`};if(b<2)return{isValid:!1,error:`Set must be won by at least 2 games, got ${v}-${y}`};if(o){if(y>=o)return{isValid:!1,error:`When tied at ${o}-${o}, must play tiebreak. Use format like ${o+1}-${o}(5)`};if(v>s+1)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s+1}-${s-1}. Got ${v}-${y}`}}else if(v>s+10)return{isValid:!1,error:`Set score ${v}-${y} exceeds reasonable limits`}}return{isValid:!0}}function lce(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Ia,xr,yr].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,c=o.winningSide!==void 0,u=$q(o,e,l,a||i===void 0&&!c);if(!u.isValid)return{isValid:!1,error:`Set ${s+1}: ${u.error}`}}return{isValid:!0}}function Vq({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(w=>w?.winningSide)||[]).reduce((w,T)=>{let{winningSide:S}=T;if(!S)return w;let D=S-1;return w[D]++,w},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,c=o!==void 0&&s[o],u=l!==void 0&&s[l],d=e?Bs(e):void 0,p=Math.max(...s),h=Ul(s)[p],f=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[yr,Ia,xr].includes(v),b=!d||!a.length||a.every((w,T)=>{let S=T+1,D=S===m,C=S===a.length,{side1Score:E,side2Score:P,side1TiebreakScore:R,side2TiebreakScore:M,winningSide:A}=w,N=Math.max(E??0,P??0),k=R??M,{finalSetFormat:x,setFormat:O}=d,V=D&&x||O;if(k){let{tiebreakTo:F,NoAD:j}=V?.tiebreakFormat||{},q=Math.max(R??0,M??0);if(j&&q>F||q<F&&A&&(C&&!y||!C))return!1}return V.setTo?!(!V.noTiebreak&&N>V.setTo+1):!0}),I=(!e||p===g)&&h===1&&s.indexOf(p)+1||void 0;return{valid:!!(b&&(r&&c>u&&r===I||r&&y||!r&&!I&&(![Sn,yr,Ia,xr].includes(v)||f&&v===Sn)))}}function jq({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:be};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:be,info:l};if(o!==void 0&&typeof o!="string")return{error:be,info:l};if(a!==void 0&&!Array.isArray(a))return{error:be,info:iy("sets")};if(a?.length){let c=a.map(d=>d?.setNumber).filter(Boolean);if(c.length!==vi(c).length)return{error:be,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(w=>![void 0,null].includes(w))).every(I=>I.every(w=>fi(w))))return{error:be,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>fi(I)))return{error:be,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:be,info:"winningSide must be 1 or 2"}}let{valid:u}=Vq({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:Cre,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var Gq=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=ii(i);s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?(s>r&&(o=r),o=s<r?r:r-1):o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},zO=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=bke({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function bke(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function _A({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=Bs(i);let s=i?.match(/SET(\d+)/)?.[1];n=s?Number.parseInt(s):3}catch{}return e?.split(" ").filter(Boolean).map((s,o)=>a({set:s,setNumber:o+1}));function a({set:s,setNumber:o}){let l=/\(([^)]+)\)/,c=/\[([^\]]+)\]/,u=l.exec(s),d=c.exec(s),p=s?.startsWith("[")&&d,h=!1;if(r&&p){let b=o===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(b){let I=b.tiebreakSet?.tiebreakTo,w=b.setTo;h=!!I&&!w}}let f,m,g,v,y;if(p){let b=d[1].split("-").map(I=>parseInt(I));h?(f=b[0],m=b[1],y=f>m&&1||f<m&&2||void 0):(g=b[0],v=b[1],y=g>v&&1||g<v&&2||void 0)}else{let b=(u&&s.replace(u[0],"")||d&&s.replace(d[0],"")||s).split("-").map(I=>Number.parseInt(I));if(f=b[0],m=b[1],y=f>m&&1||f<m&&2||void 0,u){let I=u[1],w=zO({lowValue:I,isSide1:y===2,tiebreakTo:t});Array.isArray(w)&&([g,v]=w)}if(d&&!p){let I=d[1].split("-").map(w=>Number.parseInt(w));g=I[0],v=I[1]}}return{side1Score:f,side2Score:m,side1TiebreakScore:g,side2TiebreakScore:v,winningSide:y,setNumber:o}}}function Ike({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=jO({set:n});return VO({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function ZP(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:Ck};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,c=!!l?.tiebreakSet,u=!!l?.timed,d=!c&&!u,p=!!(r&&s&&r<=s),h=[e?.side1Score,e?.side2Score],f=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h?.filter(O=>!isNaN(O)).length,I=m?.filter(O=>!isNaN(O)).length,{tiebreakAt:w}=l||{},T=w&&h.filter(O=>O>=w).length===2,S=T&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),D=!!(I&&!b),C=!!e?.winningSide,{error:E,result:P}=wke({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:R,result:M}=Ske({sideTiebreakScores:m,setObject:e,setFormat:l}),A=d&&!D&&P||c&&D&&M||u,N=p&&!(c&&!D)&&!(d&&D)&&(!C||A),k=Ike({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:D,setObject:e}),x={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:T,isCompletedSet:C,isDecidingSet:o,isTiebreakSet:D,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:S,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:k};return e?.winningSide!==void 0&&(D?(x.isValidTiebreakSetOutcome=M,M||(x.tiebreakSetError=R)):(x.isValidStandardSetOutcome=P,P||(x.standardSetError=E))),x}function wke({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:Ck};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:be};if(i?.filter(S=>!isNaN(S)).length!==2)return{result:!1,error:W$};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&i?.find(S=>S>=s)))return{result:!1,error:W$};let u=[1,2].includes(t?.winningSide);if(!t||!u)return{result:!1,error:Rk};let d=t?.winningSide-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=r?.filter(S=>!isNaN(S)).length===2,y=r?.[d],b=r?.[p],I=o&&i.filter(S=>S>=o).length===2;if(g){let{NoAD:S,tiebreakTo:D}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(D))return{result:!1,error:{message:"tiebreakTo error"}};if(!(D&&r?.find(M=>M>=D)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=o<s?s:s+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,P=y-b,R=b>=D-1;if(P&&R&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let w=c?1:2,T=f>=s-1;return m&&T&&!I&&m<w?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>w&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Ske({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:Ck};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:Rk};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=t?.winningSide-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function Tke(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===Qn&&s===Qn){let d=e?.structures?.find(({stage:p})=>p===Ut)?.tieFormat;c=c||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&Vf({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||Vf({event:l,isMock:o,hydrateCollections:i}),u=void 0}else u||(c=void 0,l?.matchUpFormat||(u=Eu));if(c){let d=No({gender:l?.gender,enforceGender:r,tieFormat:c});if(d.error)return d}return{tieFormat:c,matchUpFormat:u}}function Uke(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:c,event:u}=t,d=t.qualifyingProfiles,p=d?.length?hle({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:c}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:w})=>w!==i),e.links=e.links?.filter(({source:w})=>w.structureId!==i);let{qualifiersCount:h,qualifyingDrawPositionsCount:f,qualifyingDetails:m}=p??{};f&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:w,stageSequence:T})=>w===Ut&&T===1),{qualifiersCount:v}=YU({stageSequence:1,drawDefinition:e,structureId:s,stage:Ut}),y=Math.max(h??0,v??0),b=foe({qualifiersCount:y,drawDefinition:e,stage:Ut});if(b.error||(b=CA({drawSize:f,stage:Ht,drawDefinition:e}),b.error))return b;Dke({drawDefinition:e,drawEntries:a,event:u});let I=Eke({mainStructure:g,qualifyingDetails:m,drawDefinition:e});return I.error?I:{drawDefinition:e,structureId:s}}function Dke({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===Ht)){let n={...r,entryStage:r.entryStage??Ut,drawDefinition:t,event:i};Bz(n)}}function Eke({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,c=t&&q1({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(c?.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function cce(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||Xu.includes(n)}).map(xi)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return ce({result:{error:Sd},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:be,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:be,info:"roundsCount must be less than 32"}:{participantIds:e}}function Hq(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,c,u=cce(t);if(u.error)return u;for(let d of vt(1,i+1)){let p=FO({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:c,idPrefix:s,isMock:o,event:l});if(p.error)return ce({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),c=(p?.roundNumber??1)+1}return{matchUps:e}}function Pke(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Ua[r]?.accessor,o=e.participants??[];for(let l of i??[]){let c=o?.find(d=>d.participantId===l),u=YY({scaleName:`${r}.${WH}`,participant:c,eventType:n});!u&&r&&(u=YY({scaleAccessor:s,participant:c,scaleName:r,eventType:n})),u&&!a[l]&&(a[l]=u)}return a}function YY({scaleType:t=eg,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&dh({scaleAttributes:{eventType:n??nI,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&ji(a)?a[e]:a}function zq(t){let e=Rke(t);if(e?.error)return e;let i=cce(t);if(i.error)return i;let r=Cke(t);if(r.error)return r;let n=Pke(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],c;for(let u of vt(1,(t.roundsCount??1)+1)){let d=_q({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:c,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...h}=d;h.modifiedScaleValues&&(n=h.modifiedScaleValues),l.push({...h,iteration:u,matchUpsCount:p?.length}),c=(h?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...se,matchUps:o,roundResults:l}}function Cke(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&aI[a.stage];return Ao({structure:a})&&s>(aI[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?Ao({structure:r})?{structure:r}:{error:Ab}:{error:Qr}}function Rke(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:be,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Pl?{error:Ab}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:be,info:"Missing Entries"}:{error:void 0}}function Mke(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:u,entryStatus:d})=>(!u||u===Ut)&&d&&Xu.includes(d)),l=o?.map(xi),c=o?Math.floor(o.length/2):0;if(t.automated)return Nke({...t,participantIds:l});{let u=Hq({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:n,isMock:a,event:s});if(u.error)return u;u.matchUps?.length&&kO({matchUps:u.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...se}}function Nke(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=zq({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&kO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...se})}function Ake({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){r=r??n;let u=si({drawDefinition:s,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:Qr};let{positionAssignments:p}=aa({structure:d}),h=p?.length||0;if(c>h)return{error:are};let f=d.structures?.length,m=fi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=Wz({roundRobinGroupsCount:f,drawSize:h})?.seedGroups,{seedsCount:v}=tR({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:h});return v&&a?.[bu]&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=vt(1,c+1).map(y=>{let b=g?.find(T=>T.includes(y)),I=b&&Math.min(...b),w=m&&y>=m?I:y;return{participantId:void 0,seedNumber:y,seedValue:w}}),Pr({drawDefinition:s,structureIds:[l]}),{...se,seedLimit:c}}function cw({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:Qe};return a=a??s?.entries??[],{scaledEntries:a.filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||!u.entryStageSequence||u.entryStageSequence===n)&&Xu.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=AT({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function uce(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=ju({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:h})=>!n.includes(h));if(!a)return ce({result:{error:Qr},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=$ke({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&Oke({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==Pl&&!(t.qualifyingOnly&&t.stage!==Ht),d=(r?.length||0)>1,p=u?kke({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p?.error?ce({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function _ke({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=Pi({name:Op,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&ky.includes(n.entryStatus)})}function kke(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=z1({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function Oke(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(xi);e?xke({...t,enteredParticipantIds:a}):(n||i)&&Lke({...t,enteredParticipantIds:a})}function xke(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?nw({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;ZU({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function Lke(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=d?.category||{};d?.eventType;let f=Fke({...t})||l&&Bke({...t}),m=f?.length??0;m<e&&(e=m),f?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,v)=>{let y=v+1,{participantId:b,scaleValue:I}=g,w=n?.[y]||I||y;ZU({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:b,structureId:u,seedNumber:y,seedValue:w,event:d})})}function Fke(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},c=s?.eventType,u={scaleName:i||o||l||s.eventId,scaleType:ch,eventType:c};return cw({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function Bke(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return cw({scaleAttributes:{scaleName:s||o,scaleType:sg,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function $ke(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=_ke(t);e>i.length&&(e=i.length);let{seedLimit:r}=Ake({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function Vke(t){let e=Nq({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=jke({ignoreStageSpace:n,drawDefinition:i,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===Py?0:ii(t.seedsCount??0),y=uce({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Ut,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;y.positioningReport?.length&&f.push({[Ut]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===Pl&&t.roundsCount&&Mke({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:f,conflicts:m,structureId:b}}function jke(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Ut)continue;let o={...s,ignoreStageSpace:e??n===Pl,entryStage:s.entryStage??Ut,event:t.event,drawDefinition:i,drawType:n},l=Bz(o);if(r&&l.error)return l}return{error:void 0}}var Gke=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Hke=Gke;function zke(t){let{drawId:e=or(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=Hke();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function qq(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=jt(t,[{[$s]:!0,[VH]:!0}]);if(l.error)return l;if(!Dl({matchUpFormat:n}))return{error:a1};let c="setMatchUpFormat";if(s){let u=Hr({drawDefinition:r,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if(d?.matchUpType===Qn)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:il};d&&(d.matchUpFormat=n,Gi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===Qn)return{error:Th};for(let u of e){let d=si({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===Qn)return{error:Th};let u=si({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),Pr({drawDefinition:r,structureIds:e}),{...se}}function qke({tieFormat:t}){let e=No({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=or());return{tieFormat:t}}function Wke({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=qke({tieFormat:a});if(o.error)return o;let l=t?.every(c=>c.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=qq({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var Wq={};Ai(Wq,{attachPolicies:()=>ry,findPolicy:()=>Ay,getAppliedPolicies:()=>Qi,getPolicyDefinitions:()=>gm,mutate:()=>dce,query:()=>hce,removePolicy:()=>pce});var dce={};Ai(dce,{attachPolicies:()=>ry,removePolicy:()=>pce});function pce(t){let e=jt(t,[{[a0e]:!0,_anyOf:{[xs]:!1,[da]:!1,[$s]:!1,[mm]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return KY(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:Qe};for(let a of n){let s=t.tournamentRecords[a],o=KY(t,s);if(o.error)return o;i=!0}}else return{error:Qe};return i?{...se}:{error:s1}}function KY(t,e){let i=Qi(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?ir({element:e,extension:{name:BP,value:i}}):oo({element:e,name:BP}),{...se}):{error:s1}}var hce={};Ai(hce,{findPolicy:()=>Ay,getAppliedPolicies:()=>Qi,getPolicyDefinitions:()=>gm});var fce={[bu]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Ch]:{positioning:Kv},[$u]:{positioning:Kv}},positioning:KRe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},EV=fce;function Yke({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ce({info:"policyDefinitions must be an object",result:{error:be},stack:r});let n={[FP]:t?.[FP]};return e?Kke({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&ry({drawDefinition:i,policyDefinitions:n}),!t?.[bu]&&!e?.[bu]&&(ry({policyDefinitions:EV,drawDefinition:i}),t&&Object.assign(t,EV)),{error:void 0}}function Kke({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(ry({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function Zke(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:c}=t,u=t.drawId?c?.drawDefinitions?.find(v=>v.drawId===t.drawId):void 0,d=u?.structures?.find(v=>v.stage===Ut&&v.stageSequence===1)?.structureId,p=u?u.structures?.filter(v=>v.stage===Ht):[],h=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;u&&o!==u.drawType&&(u.drawType=o);let f=u??zke({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=Wke({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:f,matchUpFormat:n,matchUpType:a,tieFormat:s,event:c});if(m.error)return ce({result:m,stack:l});let g=Yke({appliedPolicies:r,policyDefinitions:i,drawDefinition:f,stack:l});return g.error?g:{drawDefinition:f,structureId:d,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:h}}function Xke(t){let e="generateOrGetExisting",i=[],r=[],n=Zke(t);if(n.error)return ce({result:n,stack:e});let a=n.existingDrawDefinition,s=n.drawDefinition??{},o=n.structureId,l=t.drawEntries??t.eventEntries??[],c=n.existingQualifyingPlaceholderStructureId&&Uke({...t,...n})||Vke({...t,...n,entries:l});return c.error?ce({result:c,stack:e}):(c.positioningReports?.length&&i.push(...c.positioningReports??[]),c.conflicts?.length&&r.push(...c.conflicts??[]),s=c.drawDefinition,o=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function Jke(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:c,structureId:u,tieFormat:d,entries:p,stack:h}=t,f=e&&!n?.length&&!i,m=[];if(n){let g=(I,w)=>I.stageSequence-w.stageSequence,v=(I,w)=>I.roundTarget-w.roundTarget,y=[],b=1;n.sort(v);for(let I of n){if(!Array.isArray(I.structureProfiles))return ce({info:iy("structureProfiles"),result:{error:Wt},stack:h});b=I.roundTarget||b;let w=I.structureProfiles?.sort(g)||[],T=1;for(let S of w){let{qualifyingRoundNumber:D,qualifyingPositions:C,seededParticipants:E,seedingScaleName:P,seedsCount:R=0,seedByRanking:M,placeByes:A,drawSize:N}=S,k=uce({...t,seedingProfile:S.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:D,preparedStructureIds:y,qualifyingPositions:C,seededParticipants:E,stage:Ht,seedingScaleName:P,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:M,participants:c,roundTarget:b,seedsCount:R,placeByes:A,drawSize:N,entries:p});if(k.error)return k;k.structureId&&y.push(k.structureId),T+=1,k.conflicts?.length&&m.push(...k.conflicts),k.positioningReport?.length&&r.push({[Ht]:k.positioningReport})}b+=1}}else if(u&&f){let g=Ac({structureName:gs(Ht),stage:Ht,qualifyingOnly:s,tieFormat:d}),{link:v}=q1({sourceStructureId:g.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:Dh});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(v)}return{qualifyingConflicts:m,error:void 0}}var rR={};Ai(rR,{addGoesTo:()=>ty,allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allPlayoffPositionsFilled:()=>eq,allTournamentMatchUps:()=>Ha,analyzeDraws:()=>Q1,analyzeMatchUp:()=>JP,analyzeTournament:()=>rW,bulkUpdatePublishedEventIds:()=>aW,calculateWinCriteria:()=>dw,categoryCanContain:()=>p1,checkMatchUpIsComplete:()=>Lv,checkValidEntries:()=>LO,compareTieFormats:()=>Kf,competitionScheduleMatchUps:()=>lR,courtGridRows:()=>rx,credits:()=>Qke,drawMatchUps:()=>bW,eventMatchUps:()=>sx,filterMatchUps:()=>Df,filterParticipants:()=>$1,findDrawDefinition:()=>Uq,findExtension:()=>Pi,findVenue:()=>Xh,getAggregateTeamResults:()=>iW,getAllDrawMatchUps:()=>zn,getAllEventData:()=>sW,getAllStructureMatchUps:()=>rr,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>Qq,getAppliedPolicies:()=>Qi,getAssignedParticipantIds:()=>xy,getAvailableMatchUpsCount:()=>OO,getAvailablePlayoffProfiles:()=>Y1,getCategoryAgeDetails:()=>rI,getCheckedInParticipantIds:()=>JI,getCompetitionDateRange:()=>YO,getCompetitionMatchUps:()=>XP,getCompetitionParticipants:()=>Yq,getCompetitionPenalties:()=>eW,getCompetitionVenues:()=>nR,getCourtInfo:()=>yO,getCourts:()=>IW,getDrawData:()=>XO,getDrawDefinitionTimeItem:()=>Sz,getDrawParticipantRepresentativeIds:()=>Sq,getDrawStructures:()=>ju,getDrawTypeCoercion:()=>eR,getEligibleVoluntaryConsolationParticipants:()=>wq,getEntriesAndSeedsCount:()=>nx,getEvent:()=>TW,getEventData:()=>JO,getEventMatchUpFormatTiming:()=>uW,getEventProperties:()=>wW,getEventPublishStatus:()=>Zc,getEventStructures:()=>EO,getEventTimeItem:()=>T1,getEvents:()=>SW,getFlightProfile:()=>Cn,getHomeParticipantId:()=>fW,getLinkedTournamentIds:()=>I1,getMatchUpCompetitiveProfile:()=>A1,getMatchUpContextIds:()=>mW,getMatchUpDailyLimits:()=>lx,getMatchUpDailyLimitsUpdate:()=>dW,getMatchUpDependencies:()=>Qu,getMatchUpFormat:()=>gW,getMatchUpFormatTiming:()=>_1,getMatchUpFormatTimingUpdate:()=>cW,getMatchUpScheduleDetails:()=>bO,getMatchUpType:()=>IO,getMatchUpsMap:()=>is,getMatchUpsStats:()=>vW,getMatchUpsToSchedule:()=>QO,getMaxEntryPosition:()=>lW,getModifiedMatchUpFormatTiming:()=>ax,getPairedParticipant:()=>Gu,getParticipantEventDetails:()=>Kq,getParticipantIdFinishingPositions:()=>Tq,getParticipantMembership:()=>Zq,getParticipantResults:()=>K1,getParticipantScaleItem:()=>AT,getParticipantSchedules:()=>Xq,getParticipantSignInStatus:()=>Jq,getParticipantTimeItem:()=>Tz,getParticipants:()=>cn,getPersonRequests:()=>By,getPolicyDefinitions:()=>gm,getPositionAssignments:()=>YP,getPositionsPlayedOff:()=>JU,getPredictiveAccuracy:()=>hW,getProfileRounds:()=>ix,getPublishState:()=>iw,getRandomQualifierList:()=>Cq,getRoundMatchUps:()=>fo,getRounds:()=>yW,getScaleValues:()=>VU,getScaledEntries:()=>cw,getScheduledRoundsDetails:()=>aR,getSchedulingProfile:()=>Im,getSchedulingProfileIssues:()=>oW,getSeedingThresholds:()=>Yz,getSeedsCount:()=>tR,getStructureSeedAssignments:()=>$c,getTeamLineUp:()=>ey,getTieFormat:()=>ZO,getTimeItem:()=>Wc,getTournamentIds:()=>y1,getTournamentInfo:()=>uw,getTournamentPenalties:()=>WO,getTournamentPersons:()=>tW,getTournamentPoints:()=>KO,getTournamentPublishStatus:()=>B1,getTournamentStructures:()=>Qz,getTournamentTimeItem:()=>pO,getValidGroupSizes:()=>G1,getVenueData:()=>MT,getVenuesAndCourts:()=>bm,isAdHoc:()=>Ao,isCompletedStructure:()=>_h,isValidForQualifying:()=>Rq,isValidMatchUpFormat:()=>Dl,matchUpActions:()=>xO,participantScaleItem:()=>dh,participantScheduledMatchUps:()=>pW,positionActions:()=>Pq,publicFindCourt:()=>kz,publicFindVenue:()=>_z,tallyParticipantResults:()=>QU,tieFormatGenderValidityCheck:()=>Vk,tournamentMatchUps:()=>ox,validMatchUp:()=>hO,validMatchUps:()=>Kc,validateCollectionDefinition:()=>h1,validateLineUp:()=>DO});function Qke(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var mce={};Ai(mce,{filterParticipants:()=>$1,getCompetitionParticipants:()=>Yq,getPairedParticipant:()=>Gu,getParticipantEventDetails:()=>Kq,getParticipantMembership:()=>Zq,getParticipantScaleItem:()=>AT,getParticipantSchedules:()=>Xq,getParticipantSignInStatus:()=>Jq,getParticipantTimeItem:()=>Tz,getParticipants:()=>cn,getScaleValues:()=>VU,participantScaleItem:()=>dh,validateLineUp:()=>DO});function Yq(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:dn};let i=[],r={},n={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=cn({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),u?.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...se,matchUps:s}}function Kq({tournamentRecord:t,participantId:e}){if(!t)return{error:Qe};if(!e)return{error:na};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[pr,Di].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return ho(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function Zq({tournamentRecord:t,participantId:e}){if(!t)return{error:Qe};if(!e)return{error:na};let{participants:i}=cn({participantFilters:{participantTypes:[pr,Di,hc]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function Xq({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Qe};if(typeof t!="object")return{error:fm,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Ha({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=Qu({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=c?.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(f=>n[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat()??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=u?.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat()||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...se}}function Jq({tournamentRecord:t,participantId:e}){if(!t)return{error:Qe};if(!e)return{error:na};let{participant:i}=Bg({tournamentRecord:t,participantId:e});if(!i)return{error:An};let{timeItem:r}=Wc({itemType:S1,element:i});return r&&r.itemValue===jP&&jP}var gce={};Ai(gce,{analyzeDraws:()=>Q1,analyzeTournament:()=>rW,getAggregateTeamResults:()=>iW,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>Qq,getAppliedPolicies:()=>Qi,getCompetitionDateRange:()=>YO,getCompetitionPenalties:()=>eW,getPolicyDefinitions:()=>gm,getTournamentInfo:()=>uw,getTournamentPenalties:()=>WO,getTournamentPersons:()=>tW,getTournamentPoints:()=>KO,getTournamentStructures:()=>Qz,getTournamentTimeItem:()=>pO});function Qq({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Qe};let{appliedPolicies:r}=Qi({tournamentRecord:t});return(r?.[Bc]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function qO({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:Qe};let{appliedPolicies:r}=Qi({tournamentRecord:t});return(r?.[vA]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function WO({tournamentRecord:t}){if(!t)return{error:Qe};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function eW({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let e=[];for(let i of Object.values(t)){let{penalties:r}=WO({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function vce({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var eOe={[jU]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},tOe=eOe;function uw(t){let{tournamentRecord:e}=t??{};if(!e)return{error:Qe};let i=(({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:w})=>({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:w}))(e),r=cn({participantFilters:{participantRoles:[kse,Vz,Ose,xse,Fse]},policyDefinitions:tOe,tournamentRecord:e})?.participants??[];r&&(i.tournamentContacts=r);let n=iw({tournamentRecord:e})?.publishState,a=n?.tournament?.status?.publishedEventIds||[],s=[];for(let o of e.events??[])if(!t?.usePublishState||a.includes(o.eventId)){let l=vce({event:o}).eventInfo;l&&s.push(l)}return i.timeItemValues=Hoe({element:e}),i.publishState=n?.tournament,i.eventInfo=s,{tournamentInfo:Tt(Lt(i),!1,!0),...se}}function YO({tournamentRecords:t}){if(!ji(t))return{error:dn};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=uw({tournamentRecord:s}),c=o&&new Date(Ti(o));(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let u=l&&new Date(Ti(l));return(!n.endDate||u&&u>n.endDate)&&(n.endDate=u),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ti(e.startDate.toISOString()),r=e.endDate&&Ti(e.endDate.toISOString());return!i||!r?{error:Ure}:{startDate:i,endDate:r}}function tW({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Qe};let i=t.participants||[];e&&(i=$1({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function iW(t){let e=jt(t,[{[da]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(h=>h.teams?.length===1&&h.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=cn({participantFilters:{participantTypes:[Li]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===Co)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let h of d?.draws??[]){let f=h?.finishingPositionRange?.join("-");if(f&&i?.[f]){let m=p?.participantId,g=h?.drawId,v=`${m}|${g}|${f}`;r[v]=i[f]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,h)=>{d[p]===void 0&&(d[p]=0),d[p]+=h},c={},u={};for(let d of a??[]){let{sides:p,matchUpFormat:h}=d,f=h&&Bs(h);if(p?.length===2&&f.setFormat?.timed&&(!f.finalSetFormat||f.finalSetFormat?.timed))for(let m of p){let g=n(m.participant),v=g?.participantId,y=m.participant?.participantId,b=g?.participantName,I=m.sideNumber,w=m.participant?.individualParticipantIds||y&&[y]||[];if(w.forEach(T=>{T&&!c[T]&&(c[T]=o(b))}),v&&I){u[v]||(u[v]=o(b));let T=[...w.map(D=>c[D]),u[v]];d.winningSide&&(I===d.winningSide?T.forEach(D=>l(D,"win",1)):T.forEach(D=>l(D,"loss",1)));let S=d.score?.sets||[];for(let D of S){let C=D?.[`side${3-I}Score`]||0,E=D?.[`side${I}Score`]||0,P=E-C;T.forEach(R=>l(R,"pointsPlayed",E+C)),T.forEach(R=>l(R,"points",E)),T.forEach(R=>l(R,"diff",P))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");u[p]&&(u[p].bonus+=r[d],u[p].pointsPct=parseFloat((u[p].points/u[p].pointsPlayed).toFixed(2)),u[p].standingPoints=u[p].win+u[p].bonus)}for(let d of Object.keys(c))c[d].pointsPct=parseFloat((c[d].points/c[d].pointsPlayed).toFixed(2));return{...se,individualResults:c,teamResults:u}}function iOe(t){let e=t.participants?.filter(({participantType:a})=>a===pr)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function rW({tournamentRecord:t}){if(!t)return{error:Qe};let{drawsAnalysis:e}=Q1({tournamentRecord:t}),i={isDual:iOe(t),drawsAnalysis:e},r=cn({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...se,analysis:i}}function yce(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function rOe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!r&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!r||!m.startDate||new Date(r)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!f.drawTypes?.length||f.drawTypes?.includes(s))&&(!f.drawSizes?.length||f.drawSizes.includes(a))&&(!f.stages?.length||f.stages.includes(p))&&(!f.levels?.length||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!f.flights?.flightNumbers?.length||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!f.category?.ageCategoryCodes||f.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!f.eventTypes?.length||f.eventTypes?.includes(n)))}}function ZY({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(f,m)=>{if(f){if(Array.isArray(m)){let g=m.find(v=>v.flight===f||v.f===f);return g.value||g.v}if(typeof m=="object"){let g=m.flights||m.f;if(Array.isArray(g))return g[f-1]}}},o=(f,m)=>{let g=f?.value||f?.v||(fi(f)?f:0),v=yce(a,f?.level);return{value:s(m,v)||fi(v)&&v||g}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let f=i.find(v=>v.drawSize===r||v.drawSizes?.includes(r)),m=i.find(v=>v.drawSize&&v.threshold&&r>v.drawSize),g=i.find(v=>!v.drawSize&&!v.drawSizes?.length);h!==void 0&&(f=f?.[h],m=m?.[h],g=g?.[h]),u=o(f,e).value,d=o(m,e).value,p=o(g,e).value,l=u||d||p,c=u&&f.requireWin||d&&m.requireWin||g?.requireWin}else if(typeof i=="object"){let f=i?.drawSizes?.[r],m=i;h!==void 0&&(f=f?.[h],m=m?.[h]),u=o(f,e).value,p=o(m,e).value,l=u||p,c=u?f.requireWin:m?.requireWin}else fi(i)&&h===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:c}}function KO({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:Qe};let{policyDefinitions:n}=gm({policyTypes:[pN],tournamentRecord:i}),a=e?.[pN]??n?.[pN];if(!a)return{error:Pk};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=cn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c?.filter(v=>v.draws?.length),f={},m={},g={};for(let v of h??[]){let{participantType:y,participantId:b,person:I,draws:w}=v;for(let T of w){let{drawId:S,structureParticipation:D,eventId:C}=T,E=u[C],P=d[S],R=P?.drawType,{category:M,eventType:A}=E||{},N=T.startDate||E.startDate||i.startDate,k=T.endDate||E.endDate||i.endDate;if(A===El&&b!==Co)continue;let x;if(s){let O=l,V=0,F=0,j=0,q;for(let W of D){let{finishingPositionRange:z,participationOrder:H,participantWon:Z,flightNumber:J,rankingStage:ie,winCount:K}=W;V+=K||0;let ne=P?.drawSize,{awardProfile:le}=rOe({awardProfiles:s,participation:W,eventType:A,startDate:N,category:M,drawSize:ne,drawType:R,endDate:k,level:r});if(le){if(!ne)continue;let re=Array.isArray(z)&&Math.max(...z),me=vi(z||[]).join("-"),he=re&&ie!==Ht&&z?.includes(ne);le.requireWinForPoints!==void 0&&(O=le.requireWinForPoints),le.requireWinFirstRound!==void 0&&(o=le.requireWinFirstRound);let{finishingPositionPoints:Ie={},finishingPositionRanges:Le,finishingRound:ot,pointsPerWin:at,flights:dt}=le,It=Array.isArray(le.perWinPoints)?le.perWinPoints?.find(mt=>mt.participationOrders?.includes(H)):le.perWinPoints,ze=Ie.participationOrders,Ct=0,ke;if((!ze||ze.includes(H))&&Le&&re){let mt=Le[re];mt&&({awardPoints:Ct,requireWin:ke}=ZY({flightNumber:J,valueObj:mt,drawSize:ne,flights:dt,level:r}))}if(!Ct&&ot&&H===1&&re){let mt=ot[re];mt&&({awardPoints:Ct,requireWin:ke}=ZY({participantWon:Z,flightNumber:J,valueObj:mt,drawSize:ne,flights:dt,level:r}))}if(he&&o!==void 0&&(O=o),ke!==void 0&&(O=ke),Ct>F&&(!O||K)&&(F=Ct,q=re),!Ct&&at&&K&&(j+=K*at,q=me),!Ct&&K&&It){let mt=yce(r,It?.level);mt?j+=K*mt:It.value&&(j+=K*It.value)}}if(x=F+j,y===Co){let re=(v.matchUps||[]).filter(({structureId:me})=>me===W.structureId);for(let{matchUpId:me}of re){let he=p[me],Ie=he.sides.find(Le=>Le.participantId===b).sideNumber;if(he.winningSice===Ie)for(let Le of he.tieMatchUps)Le.winningSide}}}if(j||F){let W={winCount:V,positionPoints:F,rangeAccessor:q,perWinPoints:j,eventType:A,drawId:S,points:x},z=I?.personId;z?(f[z]||(f[z]=[]),f[z].push(W)):y===Di?(g[b]||(g[b]=[]),g[b].push(W)):y===Co&&(m[b]||(m[b]=[]),m[b].push(W))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...se}}var bce={};Ai(bce,{compareTieFormats:()=>Kf,getTieFormat:()=>ZO,tieFormatGenderValidityCheck:()=>Vk,validateCollectionDefinition:()=>h1});function kA(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:c}=n;e.includes(s)||e.push(s);let u=l?.ageCategoryCode;return[o,a===Wv?"D":"S",u,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Kf({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=kA(e),{matchUpFormats:o,tieFormatDesc:l}=kA(i),c=vi((a??[]).filter(w=>!(o??[]).includes(w)).concat((o??[]).filter(w=>!(a??[]).includes(w)))),u=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionName:w})=>w).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(w=>({[w.collectionId]:w}))),h=Object.assign({},...(i?.collectionDefinitions||[]).map(w=>({[w.collectionId]:w})));r.collectionIds=fY(Object.keys(p),Object.keys(h)),n.collectionIds=fY(Object.keys(h),Object.keys(p)),r.collectionsValue=XY(p),n.collectionsValue=XY(h),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let f=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((w,T)=>{let S=r.collectionsValue.assignmentValues[T];return!S||w.valueKey!==S.valueKey||w.value!==S.value?!0:Array.isArray(w.value)?w.value.every((D,C)=>S.value[C]===D):!1}),y=u||d||l!==s||g||v||f!==0,b=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:s,ancestorDesc:l,...se,different:y,invalid:I}}function XY(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(SO).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return r+=c,o?.length?n+o.reduce((g,v)=>g+v.value,0):c?fi(u)?n+u*c:fi(d)?n+d*c:fi(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function nW(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Ice(t);return{matchUp:Tt(e,!0,!0),error:i}}function Ice({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){if(!i)return{error:Qe};if(typeof o!="string")return{error:Qs};if(!a||!d){let f=(Ha({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!f)return{error:Os};({eventId:c,drawId:u}=f),{event:d,drawDefinition:a}=_o({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:nc};n&&!r&&(r=vm({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:c??d?.eventId,drawId:u},{participants:h=[]}=Ny({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let f=(lo({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!f)return{error:Os};let m=a?.structures?.find(g=>g.structureId===f.structureId);return{drawDefinition:a,structure:m,matchUp:f}}else{let{matchUp:f,structure:m}=Hr({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:f,structure:m,drawDefinition:a}}}function ZO({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:Qe};if(!s&&!o&&!i&&!r)return ce({result:{error:Wt},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(h=>h.eventId===a));let l=nW({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:Md};let h=si({drawDefinition:e,structureId:i});if(h.error)return h;n=h.structure}let c=(n?.tieFormat||n?.tieFormatId)&&Ks({structure:n,drawDefinition:e,event:o})?.tieFormat,u=(e?.tieFormat||e?.tieFormatId)&&Ks({drawDefinition:e,event:o})?.tieFormat,d=Ks({event:o})?.tieFormat,p=Ks({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...se,matchUp:l?.matchUp,structureDefaultTieFormat:os(c),eventDefaultTieFormat:os(d),drawDefaultTieFormat:os(u),tieFormat:os(p),structure:n}}var wce={};Ai(wce,{bulkUpdatePublishedEventIds:()=>aW,getAllEventData:()=>sW,getCourtInfo:()=>yO,getDrawData:()=>XO,getEventData:()=>JO,getEventPublishStatus:()=>Zc,getPublishState:()=>iw,getTournamentPublishStatus:()=>B1,getVenueData:()=>MT});function aW({tournamentRecord:t,outcomes:e}){if(!t)return{error:Qe};if(!e?.length)return{error:Wt,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=Zc({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(c=>{let u=s?Object.keys(a.drawDetails).filter(d=>Fz({drawId:d,drawDetails:s})):[];return o?.includes(c)||u.includes(c)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function Sce({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=ji(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function Tce({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Tt(r,t,!0),venueId:i.venueId},{extension:a}=Pi({name:vd,element:r});if(e&&a){let s=ji(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let c=l.date;if(!(!c||s.includes(c)))return l}).filter(Boolean);n.dateAvailability=o}return{inContextCourt:n}}function bm(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:h}=Pi({name:vd,element:p});if(h?.value)continue}s.includes(p.venueId)||(c.push(Tt(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=Pi({name:vd,element:h});if(Sce({extension:m,dates:n}))continue}let{inContextCourt:f}=Tce({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:c,...se}}function nOe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:dn};let n=Tt(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=Pi({name:vd,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(c=>{if(!i&&!r?.length)return c;let{extension:u}=Pi({name:vd,element:c});return Sce({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=Tce({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function nR({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:dn}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=nOe({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function sW({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Qe};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=uw({tournamentRecord:t}),{venues:a}=bm({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=vce({event:o}).eventInfo,u=U1({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:w,updatedAt:T})=>({matchUpFormat:w,updatedAt:T,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=WU({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Zc({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}function Uce({publishStatus:t,drawId:e}){return t?.drawDetails?t.drawDetails?.[e]?.publishingDetail?.published:t?.drawIds?t.drawIds.includes(e):!0}var Dce="PUBLIC",aOe="ADMIN",Ece={PUBLIC_DISPLAY:Dce,ADMIN_DISPLAY:aOe};function XO(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=fc,pressureRating:l,refreshResults:c,contextProfile:u,drawDefinition:d,noDeepCopy:p,sortConfig:h,context:f,event:m}=t;if(!d)return{error:Nt};let g=(({matchUpFormat:k,updatedAt:x,drawType:O,drawName:V,drawId:F})=>({matchUpFormat:k,updatedAt:x,drawName:V,drawType:O,drawId:F}))(d);g.display=Pi({element:d,name:yA}).extension?.value;let v={},y,b,{allStructuresLinked:I,sourceStructureIds:w,hasDrawFeedProfile:T,structureGroups:S}=PO({drawDefinition:d});if(!I)return{error:pre};let D=t?.eventPublishState??iw({event:m}).publishState,C=t?.publishStatus??Zc({event:m,status:o}),E=D?.status?.drawDetails?.[d.drawId],P=!!D?.status?.published,R=E?.structureDetails,M=!1,A=!1,N=S.map(k=>{let x={},O=k.map(V=>{let{structure:F}=si({drawDefinition:d,structureId:V}),{seedAssignments:j}=$c({drawDefinition:d,structure:F});return F?.stage===Ut&&F.stageSequence===1&&(y=j),F?.stage===Ht&&(v[F.stageSequence??0]=j),F}).sort((V,F)=>WI(V,F,h)).map(V=>{if(!V)return;let F=V?.structureId,j=[];V.stage&&[Ut,bs,In].includes(V.stage)&&(j=y),V?.stage===Ht&&(j=v[V.stageSequence??0]);let{matchUps:q,roundMatchUps:W,roundProfile:z}=rr({seedAssignments:V?.seedAssignments?.length?void 0:j,context:{drawId:g.drawId,...f},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:C,contextProfile:u,drawDefinition:d,inContext:a,structure:V,event:m}),{positionAssignments:H}=Sr({structure:V}),Z=H?.filter(Rl(Rh)).map(ne=>{let le=Pi({element:ne,name:qf})?.extension?.value,{drawPosition:re,participantId:me}=ne;return A=!0,{participantResult:le,participantId:me,drawPosition:re}});if(q.length&&(!Z?.length&&t.allParticipantResults||c&&!V.structures)){let{subOrderMap:ne}=Boe({positionAssignments:H}),le=q.some(me=>me.matchUpType===rc)?q.filter(me=>me.matchUpType===rc):q,re=QU({matchUpFormat:V.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});b=re?.report,Z=H?.filter(Rl(Rh)).map(me=>{let{drawPosition:he,participantId:Ie}=me;return A=!0,{participantResult:Ie&&re?.participantResults?.[Ie],participantId:Ie,drawPosition:he}})}let J=V?(({stageSequence:ne,structureName:le,structureType:re,matchUpFormat:me,stage:he})=>({stageSequence:ne,structureName:le,structureType:re,matchUpFormat:me,stage:he}))(V):{},ie=Pi({element:V,name:yA}).extension?.value;J.display=ie?.[Dce]??ie,J.sourceStructureIds=w[F],J.hasDrawFeedProfile=T[F],J.positionAssignments=H,J.structureActive=q.reduce((ne,le)=>{let re=[on,ia,Zu,Sn,xp,yr,Ia,xr].includes(le.matchUpStatus);return ne||re||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let K=q.reduce((ne,le)=>ne&&["BYE",Sn,Ia,xr,yr,rl].includes(le.matchUpStatus),!!q.length);return J.structureCompleted=K,x[F]=K,J.structureActive&&(M=!0),{...J,participantResults:Z,seedAssignments:j,roundMatchUps:W,roundProfile:z,structureId:F,report:b}});return O.forEach(V=>{i||delete V.positionAssignments,V.sourceStructuresComplete=V.sourceStructureIds?.every(F=>x[F])}),O}).flat().filter(k=>!s||R?.[k?.structureId]?.published||!0);return g.drawActive=M,g.participantPlacements=A,g.drawGenerated=N?.reduce((k,x)=>k||!!x?.roundMatchUps,!1),g.drawCompleted=N?.reduce((k,x)=>k&&x.structureCompleted,!0),g.drawPublished=s?P&&Uce({publishStatus:C,drawId:g.drawId}):void 0,{structures:!s||g.drawPublished?p&&N||Tt(N,!1,!0):void 0,drawInfo:p?g:Tt(g,!1,!0),...se}}function JO(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=fc,contextProfile:s,sortConfig:o}=t,l=jt(t,[{tournamentRecord:!0},{[qH]:{event:!1,eventId:!1}}]);if(l.error)return l;let c=Tt(t.tournamentRecord,!1,!0),u=t.event?void 0:_o({tournamentRecord:c,eventId:t.eventId}).event,d=t.event?Tt(t.event,!1,!0):u&&Tt(u,!1,!0)||void 0;if(!d)return{error:Lc};let{eventId:p}=d,{tournamentId:h,endDate:f}=c,m=Zc({event:d,status:a}),g=iw({event:d}).publishState??{},v=!!g?.status?.published,{participants:y}=cn({withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:c}),b=({stage:M,drawId:A})=>{if(!n)return!0;let N=m?.drawDetails?.[A]?.stageDetails;return!N||!Object.keys(N).length?!0:N[M]?.published},I=({structureId:M,drawId:A})=>{if(!n)return!0;let N=m?.drawDetails?.[A]?.structureDetails;return!N||!Object.keys(N).length?!0:N[M]?.published},w=({drawId:M})=>n?Uce({publishStatus:m,drawId:M}):!0,T=({drawId:M,structure:A})=>{if(!n)return A;let N=m?.drawDetails?.[M]?.structureDetails?.[A.structureId]?.roundLimit;if(fi(N)){let k=vt(1,N+1),x={},O={};for(let V of k)A.roundMatchUps[V]&&(x[V]=A.roundMatchUps[V],O[V]=A.roundProfile[V]);A.roundMatchUps=x,A.roundProfile=O}return A},S=d.drawDefinitions||[],D=!n||v?S.filter(w).map(M=>(({drawInfo:A,structures:N})=>({...A,structures:N}))(XO({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:h,endDate:f},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:c,usePublishState:n,contextProfile:s,drawDefinition:M,publishStatus:m,sortConfig:o,event:d}))).map(({structures:M,...A})=>{let N=M?.filter(({stage:k,structureId:x})=>I({structureId:x,drawId:A.drawId})&&b({stage:k,drawId:A.drawId})).map(k=>T({drawId:A.drawId,structure:k}));return{...A,structures:N}}).filter(M=>M.structures?.length):void 0,C=(Array.isArray(c.venues)?c.venues:[]).map(M=>(({venueData:A})=>({...A}))(MT({venueId:M.venueId,tournamentRecord:c}))),E=(({eventId:M,eventName:A,eventType:N,eventLevel:k,surfaceCategory:x,matchUpFormat:O,category:V,gender:F,startDate:j,endDate:q,ballType:W,discipline:z})=>({eventId:M,eventName:A,eventType:N,eventLevel:k,surfaceCategory:x,matchUpFormat:O,category:V,gender:F,startDate:j,endDate:q,ballType:W,discipline:z}))(d);E.display=Pi({element:d,name:yA}).extension?.value;let{tournamentInfo:P}=uw({tournamentRecord:c}),R={tournamentInfo:P,venuesData:C,eventInfo:E,drawsData:D};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...se,eventData:R,participants:y}}var Pce={};Ai(Pce,{courtGridRows:()=>rx,findVenue:()=>Xh,getMatchUpsToSchedule:()=>QO,getPersonRequests:()=>By,getProfileRounds:()=>ix,getScheduledRoundsDetails:()=>aR,getSchedulingProfile:()=>Im,getSchedulingProfileIssues:()=>oW,publicFindCourt:()=>kz});function kT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=uO(r);i=i??r.schedule?.timeAfterRecovery;let a=c=>{t[c]||(t[c]=[]),t[c]=vi(t[c].concat(...n))},s=c=>{i&&(!e[c]||i>e[c])&&(e[c]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:c})=>{c&&(i&&s(c),a(c))})}function QO(t){let e=jt(t,[{[HH]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(h=>c.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(r.includes(h.matchUpId)||u.includes(h.matchUpId)),m=["BYE",yr,Sn,rl,Ia,xr,on,ia].includes(h?.matchUpStatus);return n||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],kT({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function ex({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Dl({matchUpFormat:r}))return{error:a1};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{if(u)return;let p=i[d],h=l?_o({tournamentRecord:p,eventId:l})?.event:void 0;return u=_1({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:h}),u?.averageMinutes||u?.recoveryMinutes}),{recoveryMinutes:u?.recoveryMinutes||t,averageMinutes:u?.averageMinutes||e,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||t}}function aR(t){let e=jt(t,[{[qH]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Fo]:Cs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:dn};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(f=>zU({tournamentRecord:f}).containedStructures)),c=t.matchUps??Ud({nextMatchUps:!0,tournamentRecords:n}).matchUps,u=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{let m=f.periodLength||r,g=[];l?.[f.structureId]?g.push(...l[f.structureId]):g.push(f.structureId);let v=c?Df({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:g,matchUps:c}).sort(tw):[],{segmentNumber:y,segmentsCount:b}=f.roundSegment||{};if(fi(y)&&wd(v?.length)&&wd(b)&&y>0&&y<=b&&b<v?.length&&!f.matchUpIds?.length){let S=v.length/b,D=S*(y-1);v=v.slice(D,D+S)}let I=n[f.tournamentId],w=_o({drawId:f.drawId,tournamentRecord:I}).event,T=[];for(let S of v){let D=S.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(S)),T.push(D))}for(let S of T){let{eventType:D,category:C}=w??{},{categoryName:E,ageCategoryCode:P}=C??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:M,averageMinutes:A,error:N}=ex({categoryName:E??P,categoryType:C?.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:n,matchUpFormat:S,eventType:D});if(N)return{error:N,round:f};let k=v.filter(O=>(i||!Hn.includes(O.matchUpStatus))&&O.matchUpStatus!=="BYE").map(Ea);k.forEach(O=>{h[O]={typeChangeRecoveryMinutes:R,recoveryMinutes:M,averageMinutes:A},d[O]=M,p[O]=A}),s.push(...k),u=Math.max(A||0,u);let x=`${A}|${m}`;return{roundPeriodLength:m,recoveryMinutes:M,averageMinutes:A,matchUpIds:k,hash:x}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...se}}function Cce({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ti(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let c=(o?.venues||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&r.includes(f.drawId);return m||n.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function tx({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:be};let{venueIds:i,tournamentsMap:r}=oOe({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return el(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=r?.[m]?.[y]?.[b]?.[g]?.includes(v);I||(a="Invalid rounds");let{segmentNumber:w,segmentsCount:T}=f||{},S=!f||fi(w)&&wd(T)&&w<=T;return S||(a="Invalid segment"),I&&S}):(n=$I,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=be),{valid:!!s,error:n,info:a}}function sOe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:u,courts:d})=>(!r||d?.length)&&u),c=e?.tournamentId;if(c){n.push(c),i[c]={};let u=e?.events||[];for(let d of u){let p=d.eventId;s.push(p),i[c][p]={};let h=f=>parseInt(f);for(let f of d.drawDefinitions||[]){let m=f.drawId;o.push(m),i[c][p][m]={};let{structures:g}=ju({drawDefinition:f});for(let v of g||[]){let y=v.structureId,{matchUps:b}=rr({structure:v}),{roundMatchUps:I}=fo({matchUps:b}),w=I&&Object.keys(I).map(h);if(i[c][p][m][y]=w,a.push(y),v.structures?.length)for(let T of v.structures)a.push(T.structureId),i[c][p][m][T.structureId]=w}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function oOe(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=sOe({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function Im({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let{extension:i}=Pi({element:e,name:lI,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=nR({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=gq({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=Cce({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let u=eD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function eD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=tx({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?ir({tournamentRecords:t,discover:!0,extension:{name:lI,value:i}}):oo({element:e,name:lI,tournamentRecords:t,discover:!0})}function sR(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=Im({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=nR({tournamentRecords:i}),{eventIds:n,drawIds:a}=gq({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=Cce({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...eD({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...se,modifications:o,issues:l}}function oW(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:i1};if(!Array.isArray(e))return{error:be};if(!e.every(el))return{error:xa};let n=[],a=0,s={},{schedulingProfile:o}=Im({tournamentRecords:i});if(!o)return{issues:n,...se};let{matchUps:l}=Ud({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!e?.length||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=aR({tournamentRecords:i,periodLength:r,matchUps:l,rounds:f}),{matchUpDependencies:y}=Qu({tournamentRecords:i,matchUps:l}),b=I=>{let w;return v?.find((T,S)=>{let D=T.matchUpIds.includes(I);return D&&(w=S),D}),w};if(g?.forEach((I,w)=>{let T=g.slice(w+1),S=Un(T,y?.[I]?.matchUpIds||[]);S.length&&m.push({matchUpId:I,shouldBeAfter:S})}),m.length){a+=m.length;let I=m.map(({matchUpId:w,shouldBeAfter:T})=>{let S=b(w),D=vi(T.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),D.forEach(C=>{s[d][S].includes(C)||s[d][S].push(C)}),{matchUpId:w,matchUpRoundIndex:S,earlierRoundIndices:D,shouldBeAfter:T}});n.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...se}}function By(t){let{tournamentRecords:e,requestType:i}=t,r=jt(t,[{[xs]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=Pi({element:a,name:GU}),o=s?.value||[];for(let l of o){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...se}}function PV(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=r?e:s,u=[n,o,l,c,a].join("|");return Lt({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:u})}function JY({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Ul(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=ex({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function lOe(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function QY(t){let e=t.length,i=t.filter(({sides:c})=>c?.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||Hn.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>c?.scheduledDate&&c?.scheduledTime&&u!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function ix({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:i1};t={[i.tournamentId]:i}}if(e){let a=tx({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Im({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:ja};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let c=PV(l);return c.roundSegment?.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Lt({id:r?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:n}}function rx({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:be};let r=i?.reduce((s,o)=>{let l=o.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>s?c:s},1),n=e?Math.max(e,r):r,a=vt(0,n).map(s=>({matchUps:vt(0,i.length).map(o=>{let l=i[o],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:s+1,venueId:u,courtId:c}}})}));return i.forEach((s,o)=>{for(let l of s.matchUps){let c=l.schedule?.courtOrder;c&&(a[c-1].matchUps[o]=l)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}var Rce={};Ai(Rce,{getEntriesAndSeedsCount:()=>nx,getMaxEntryPosition:()=>lW});function nx({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Or};let{entries:s,stageEntries:o}=$se({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:c}=ple({participantsCount:l}),u=tR({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ce({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function lW(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>ii(n||0)),0)}var Mce={};Ai(Mce,{allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allTournamentMatchUps:()=>Ha,analyzeMatchUp:()=>JP,calculateWinCriteria:()=>dw,checkMatchUpIsComplete:()=>Lv,competitionScheduleMatchUps:()=>lR,drawMatchUps:()=>bW,eventMatchUps:()=>sx,filterMatchUps:()=>Df,getAllDrawMatchUps:()=>zn,getAllStructureMatchUps:()=>rr,getCheckedInParticipantIds:()=>JI,getCompetitionMatchUps:()=>XP,getEventMatchUpFormatTiming:()=>uW,getHomeParticipantId:()=>fW,getMatchUpCompetitiveProfile:()=>A1,getMatchUpContextIds:()=>mW,getMatchUpDailyLimits:()=>lx,getMatchUpDailyLimitsUpdate:()=>dW,getMatchUpDependencies:()=>Qu,getMatchUpFormat:()=>gW,getMatchUpFormatTiming:()=>_1,getMatchUpFormatTimingUpdate:()=>cW,getMatchUpScheduleDetails:()=>bO,getMatchUpType:()=>IO,getMatchUpsStats:()=>vW,getModifiedMatchUpFormatTiming:()=>ax,getParticipantResults:()=>K1,getPredictiveAccuracy:()=>hW,getRoundMatchUps:()=>fo,getRounds:()=>yW,isValidMatchUpFormat:()=>Dl,matchUpActions:()=>xO,participantScheduledMatchUps:()=>pW,tallyParticipantResults:()=>QU,tournamentMatchUps:()=>ox,validMatchUp:()=>hO,validMatchUps:()=>Kc});function Nce({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let i=[],r;for(let n of Object.values(t)){let{extension:a}=Pi({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=Pi({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function cW({tournamentRecords:t}){return Nce({extensionName:zf,tournamentRecords:t})}var $2="ADULT",V2="JUNIOR",bM="WHEELCHAIR",Ace={[xg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[fr]:30,default:60}}]},defaultDailyLimits:{[Ir]:2,[fr]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Eu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[bM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[$2,bM],minutes:{default:60,[fr]:30}},{categoryTypes:[V2],minutes:{default:60,[fr]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[$2,bM],minutes:{default:30}},{categoryTypes:[V2],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[$2,V2],minutes:{default:30}},{categoryTypes:[bM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},cOe=Ace;function uW({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Or};let n=[],a;if(e?.length){let d=[];n=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h?.matchUpFormat)&&Dl({matchUpFormat:h?.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Ay({policyType:Bc,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=Pi({name:zf,element:r}),h,f;p?.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=cOe[xg],n=vi([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,c=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:Or};let u=n.map(({matchUpFormat:d,description:p})=>{let h=_1({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...h}});return Lt({eventMatchUpFormatTiming:u,info:a})}function ax(t){let e=jt(t,[{[da]:!0},{[ds]:m=>Dl({matchUpFormat:m}),[sc]:a1,[VH]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=Pi({name:zf,element:n}),s=a?.value,{extension:o}=Pi({element:i,name:zf}),l=o?.value,c=s?.matchUpAverageTimes&&VE({...s,matchUpFormat:r}),u=l?.matchUpAverageTimes&&VE({...l,matchUpFormat:r}),d=[c,u].find(m=>m),p=s?.matchUpRecoveryTimes&&jE({...s,matchUpFormat:r}),h=l?.matchUpRecoveryTimes&&jE({...l,matchUpFormat:r}),f=[p,h].find(m=>m);return{matchUpFormat:r,recoveryTimes:f,averageTimes:d}}function dW({tournamentRecords:t}){return Nce({extensionName:b1,tournamentRecords:t})}var oR=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function pW({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Kc(e))return{error:hm};if(!Array.isArray(t))return{error:be};let i=e.filter(Boolean).filter(({schedule:r})=>oR({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ti(a?.scheduledDate),o=Gr(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>Tne(Gr(n.schedule?.scheduledTime),Gr(a.schedule?.scheduledTime)))}),{...se,scheduledMatchUps:i}}function uOe({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=Zc({event:n}),s=a?.drawDetails;ji(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>Fz({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function OA({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t?.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Ti(l.scheduledDate)||l.scheduledTime&&Ti(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&Gr(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}for(let d of Object.keys(c)){let p=c[d].sort((h,f)=>(h.roundNumber||0)-(f.roundNumber||0));c[d]=p}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[r(h)]||0,g=i[r(f)]||0;return m-g}),n.push(...p)}}return n}function sx(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Or};let{eventId:I,eventName:w,endDate:T,eventType:S,category:D,gender:C}=b??{},E={...y,...Lt({surfaceCategory:b.surfaceCategory??u?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??u?.indoorOutdoor,tournamentId:g??u?.tournamentId,endDate:T??u?.endDate,eventName:w,eventType:S,category:D,eventId:I,gender:C})},P;!e&&u&&({participants:e,participantMap:r,groupInfo:P}=Ny({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=vm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let R=Zc({event:b});return{...(b.drawDefinitions??[]).reduce((M,A)=>{let N=WU({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:r,publishStatus:R,contextProfile:f,drawDefinition:A,nextMatchUps:m,inContext:v,event:b});return Object.keys(N)?.forEach(k=>{Array.isArray(N[k])&&(M[k]||(M[k]=[]),M[k]=M[k].concat(N[k]))}),M},{}),...se,groupInfo:P}}function ox(t){if(!t?.tournamentRecord)return{error:Qe};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:v,groupInfo:y}=Ny({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=vm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=Qi({tournamentRecord:s}),I=c?.eventIds??[];return{...m.filter(w=>!I.includes(w.eventId)).map(w=>{let T={eventDrawsCount:Cn({event:w}).flightProfile?.flights?.length||w.drawDefinitions?.length||0,...h};return sx({hydrateParticipants:t.hydrateParticipants,context:T,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:w})}).reduce((w,T)=>((T&&Object.keys(T).filter(S=>!["success","matchUpsMap"].includes(S)))?.forEach(S=>{Array.isArray(T[S])&&(w[S]||(w[S]=[]),w[S]=w[S].concat(T[S]),w.matchUpsCount!==void 0?w.matchUpsCount+=T[S].length:w.matchUpsCount=T[S].length)}),w),{matchUpsCount:0}),groupInfo:y,participants:g}}function XP({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:dn};let d=Object.keys(r).map(f=>{let m=r[f];return ox({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function lR(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:dn};let{courts:e,venues:i}=bm(t),r=Im(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=fc,sortCourtsData:h}=t,f=o??jI()??Object.keys(l)[0],m=d?B1({tournamentRecord:l[f],status:p}):void 0,g=s?XP({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Sn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!m?.orderOfPlay?.published)return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=uOe({tournamentRecords:l})),v?.length&&(t.contextFilters||(t.contextFilters={}),t.contextFilters?.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>v.includes(M)):t.contextFilters.drawIds=v),m?.eventIds?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>m.eventIds.includes(M)):t.matchUpFilters.eventIds=m.eventIds),m?.scheduledDates?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>m.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Sn)||t.matchUpFilters.excludeMatchUpStatuses.push(Sn):t.matchUpFilters.excludeMatchUpStatuses=[Sn]);let{completedMatchUps:b,upcomingMatchUps:I,pendingMatchUps:w,groupInfo:T,mappedParticipants:S}=XP({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),D=[...I??[],...w??[]];y&&(!v?.length||Object.keys(y).length)&&(D=D.filter(M=>{let{drawId:A,structureId:N,stage:k}=M;if(!y?.[A]?.publishingDetail?.published)return!1;let x=Object.keys(y[A].stageDetails??{});if(x.length){let V=x.filter(j=>!y[A].stageDetails[j].published),F=x.filter(j=>y[A].stageDetails[j].published);return V.length&&V.includes(k)?!1:F.length&&F.includes(k)?!0:V.length&&!V.includes(k)&&!F.length}let O=Object.keys(y[A].structureDetails??{});if(O.length){let V=O.filter(j=>!y[A].structureDetails[j].published),F=O.filter(j=>y[A].structureDetails[j].published);return V.length&&V.includes(N)?!1:F.length&&F.includes(N)?!0:V.length&&!V.includes(N)&&!F.length}return!0}));let C=n?OA({matchUps:D,schedulingProfile:r}):D,E=e?.map(M=>{let A=R(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:A,...M}}),P={completedMatchUps:s?g:b,mappedParticipants:t.hydrateParticipants?void 0:S,dateMatchUps:C,courtsData:E,groupInfo:T,venues:i};if(c){let{rows:M,courtPrefix:A}=rx({minRowsCount:u,courtsData:E});P.courtPrefix=A,P.rows=M}return{...P,...se};function R({courtId:M}){let A=(a?C.concat(b??[]):C).filter(N=>N.schedule?.courtId===M||N.schedule?.allocatedCourts?.map(({courtId:k})=>k).includes(M));return h?OA({matchUps:A,schedulingProfile:r}):A}}function lx({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:dn};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=dOe({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function dOe(t){let e=jt(t,[{[da]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=Ay({policyType:xg,tournamentRecord:i}),{extension:n}=Pi({element:i,name:b1}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function hW(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!r&&!e)return{error:Qe};if(l&&![Ir,fr].includes(l))return{error:be,info:{matchUpType:l}};if(e&&!Kc(e))return{error:be,context:{matchUps:e}};let f=Ua[c],m=f?.ascending??t.ascending??!1,g=f?.accessor??t.valueAccessor,v=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,y=fi(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[Ir,fr]},w=r?.participants;e?.[0]?.hasContext?p?e=e.filter(A=>A.drawId===p):u&&(e=e.filter(A=>A.eventId===u)):e===void 0&&(e=p&&!n&&[]||!p&&u&&!h&&[]||p&&lo({inContext:!0,drawDefinition:n,contextFilters:I,contextProfile:b,participants:w})?.matchUps||!p&&u&&Jh({inContext:!0,contextFilters:I,contextProfile:b,participants:w,event:h})?.matchUps||Ha({tournamentRecord:r,contextFilters:I,contextProfile:b})?.matchUps||[]),l&&(e=e.filter(A=>A.matchUpType===l));let T=e.filter(({winningSide:A,score:N,sides:k,matchUpStatus:x})=>![Ia,yr,xr,HU,rl].includes(x??"")&&sa({score:N})&&k?.length===2&&A),S=hOe({matchUps:T,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:c}),D=!o||kn(Ir)(l)?y:(y||0)*2,C=y?T.map(({competitiveProfile:A,matchUpType:N,score:k,sides:x})=>{let O=_ce({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:c,sides:x}),V=Math.abs(O[0].value-O[1].value);return{competitiveness:A?.competitiveness,valuesGap:V,score:k}}).filter(({valuesGap:A})=>A<=D):[],E=pOe({zoneData:C}),P=E&&[].concat(Object.values(E)).flat().length,R=P&&Object.assign({},...Object.keys(E).map(A=>({[A]:Math.round(1e4*E[A].length/P)/100}))),M=T.length-(C?.length||0);return{...se,relevantMatchUps:T,zoneDistribution:R,zoneData:C,accuracy:S,nonZone:M}}function pOe({zoneData:t}){let e={[Uz]:[],[GP]:[],[HP]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function _ce({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let c=l?.[e?.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l?.individualParticipants;if(u?.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=eK({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=o(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=eK({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:h,exclusionValue:f}=o(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function eK({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?Ir:i,s=r?.rankings?.[a]?.find(c=>c.scaleName===n),o=(r?.ratings?.[a]?.find(c=>c.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function hOe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Wt};let f=h-1,m=_ce({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:n,sides:d});if(e){let w=m.map(({exclusionValues:T})=>T).flat();if(w.length){s.excluded.push({scoreString:p?.scoreStringSide1,exclusionValues:w,winningSide:h,sideValues:m});continue}}if(m.filter(w=>![void 0,"",null].includes(w.value)).length<2){s.excluded.push({scoreString:p?.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p?.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=r?g:g*-1,I=h===1?p?.scoreStringSide1:p?.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function dw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=Voe({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=o&&r.includes(o);if(fi(p||d))n=!0;else{if(h)continue;if(typeof l=="number"&&fi(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let f of s)i+=f.matchUpValue;else typeof u=="number"&&fi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...se}:{valueGoal:Math.floor(i/2)+1,...se}}function fW(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=jt(t,[{[Yh]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Oy({timeItems:r?.timeItems||[],itemType:Mz});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function mW({matchUps:t,matchUpId:e}){if(!Kc(t))return{error:be};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function tD(t,e){if(!ji(t))return{error:be};if(!Array.isArray(e))return{error:be};let i={};for(let{param:r,error:n,attr:a}of e){let s=fOe({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function fOe({params:t,param:e,attr:i,error:r}){if(e===Xk&&ji(t.drawDefinition)&&jr(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Yh){let n=Ice({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:ja,info:{param:e}}}function gW(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=jt(t,[{[da]:!0},{[qH]:{[Yk]:!1,[kp]:!1,[Tae]:!1,[mm]:!1}}]);if(a[Pu])return a;let s=tD(t,[{[BU]:Yh,[Pu]:Wt}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:Md};let p=si({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,c=n?.matchUpFormat,u=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function vW({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Kc(i))return{error:hm};let r=!t&&Ay({policyType:Uf,tournamentRecord:e}).policy,n=t||r?.profileBands||Dz[Uf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(sse),o=(p,h)=>{let f=ase(h,n);return p[f]+=1,p},l=ose(s).reduce((p,h)=>o(p,h),{[Uz]:0,[GP]:0,[HP]:0,[Qae]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===UY).length;return u.push({[UY]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...se}}var{stageOrder:tK}=t0e;function mOe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(tK[t?.stage]||0)-(tK[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function yW({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:be,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:i1};n={[s.tournamentId]:s}}let h=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||o))&&h)return{error:dn};let f=Object.assign({},...Object.values(n??{}).map(({venues:T=[],tournamentId:S})=>({[S]:T?.map(({venueId:D})=>D)}))),m=Object.values(n??{}).map(({events:T=[],tournamentId:S,startDate:D,endDate:C})=>T.map(E=>({...E,validVenueIds:f[S],startDate:E.startDate??D,endDate:E.endDate??C}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||o)&&ix({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(T=>({[T.id]:T}))),b=r||n&&Ud({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],I=[],w=b&&Object.values(b.reduce((T,S)=>{let D=PV(S).id,C=g?.[D],E=[...T[D]?.matchUps??[],S],{containerStructureId:P,stageSequence:R,structureName:M,tournamentId:A,isRoundRobin:N,matchUpType:k,roundNumber:x,roundOffset:O,structureId:V,eventName:F,roundName:j,drawName:q,eventId:W,drawId:z}=S,H=N?P:V;return{...T,[D]:{id:u?D:void 0,structureId:H,stageSequence:R,segmentsCount:C,structureName:M,tournamentId:A,matchUpType:k,roundNumber:x,roundOffset:O,eventName:F,roundName:j,drawName:q,matchUps:E,eventId:W,drawId:z}}},{})).map(T=>{let{minFinishingSum:S,winnerFinishingPositionRange:D}=lOe(T.matchUps),C=T.segmentsCount;if(C){let x=T.matchUps.length/C;return Ca(T.matchUps.sort((O,V)=>O.roundPosition-V.roundPosition),x).map((O,V)=>{let{unscheduledCount:F,incompleteCount:j,matchUpsCount:q,isScheduled:W,isComplete:z,byeCount:H}=QY(O),Z=JY({matchUps:T.matchUps,tournamentRecords:n,events:m,round:T});return Lt({...T,...p,roundSegment:{segmentsCount:C,segmentNumber:V+1},winnerFinishingPositionRange:D,unscheduledCount:F,incompleteCount:j,minFinishingSum:S,matchUpsCount:q,isScheduled:W,roundTiming:Z,isComplete:z,byeCount:H,matchUps:O})})}let{unscheduledCount:E,incompleteCount:P,matchUpsCount:R,isScheduled:M,isComplete:A,byeCount:N}=QY(T.matchUps),k=JY({matchUps:T.matchUps,tournamentRecords:n,events:m,round:T});return Lt({...T,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:P,minFinishingSum:S,matchUpsCount:R,isScheduled:M,roundTiming:k,isComplete:A,byeCount:N})}).flat().filter(T=>{if(t){let V=Ti(t),F=u?T.id:PV(T).id;if(V&&y[F]&&Ti(y[F].scheduleDate)===V)return!1}let{isComplete:S,isScheduled:D}=T,C=!i||!S,E=!e||!D,P=d||c?m?.find(({eventId:V})=>V===T.eventId):void 0,R=P?.startDate??s?.startDate,M=P?.endDate??s?.endDate,A=!c||!R||new Date(c)>=new Date(R),N=!c||!M||new Date(c)<=new Date(M),k=A&&N,x=!d||P?.validVenueIds.includes(d),O=C&&E&&x&&k;return O||I.push(T),O}).sort(mOe)||[];return{...se,rounds:w,excludedRounds:I}}function JP(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:Mo};s=s||e?.matchUpFormat;let o=Bs(s),l=!!e?.winningSide,c=e.score?.sets,u=c?.length,d=r&&r-1,p=!!c?.find((H,Z)=>H.setNumber===r&&Z===d),h=c?.filter(H=>H?.winningSide)||[],f=h?.length||0,m=r&&c?.slice(r)||[],g=!!(u&&r&&m?.reduce((H,Z)=>(!Z||!Z.side1Score&&!Z.side2Score&&!Z.side1TiebreakScore&&!Z.side2TiebreakScore&&!Z.side1PointScore&&!Z.side2PointScore)&&H,!0)),v=r<=u&&c.find(H=>H.setNumber===r),y=v&&ZP({setObject:v,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:w}=y||{},T=!!(v&&!b&&g||r&&r===u+1&&!l),S=[1,2].includes(i),D=S?i-1:0,C=v&&S&&(!n&&!a&&I[D]!==void 0&&I[D]||n&&w[D]!==void 0&&w[D]),E=!!C,P=h?.map(H=>ZP({setObject:H,matchUpScoringFormat:o}).isValidSetOutcome).reduce((H,Z)=>H&&Z,!0),R=h.reduce((H,Z)=>{let{winningSide:J}=Z,ie=J-1;return H[ie]++,H},[0,0]),M=e?.winningSide,A=M&&M-1,N=1-A,k=R[A],x=R[N],O=Math.max(...R),V=Ul(R)[O],{bestOf:F,exactly:j}=o??{},q=F&&Math.ceil(F/2)||j||1,W=O===q&&V===1&&R.indexOf(O)+1||void 0,z=k>x&&M===W;return{completedSetsHaveValidOutcomes:P,validMatchUpWinningSide:z,calculatedWinningSide:W,matchUpScoringFormat:o,validMatchUpOutcome:W&&P&&z,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:E,existingValue:C,isExistingSet:p,isActiveSet:T,...y}}function bW({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:w,eventName:T,endDate:S,eventType:D,category:C,gender:E}=I??{},P={...b,...Lt({surfaceCategory:I?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:I?.indoorOutdoor??o?.indoorOutdoor,endDate:S??I?.endDate??o?.endDate,tournamentId:v??o?.tournamentId,eventName:T,eventType:D,category:C,eventId:w,gender:E})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=Ny({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!u&&(u=vm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...WU({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var kce={};Ai(kce,{getCompetitionVenues:()=>nR,getCourts:()=>IW,getVenuesAndCourts:()=>bm,publicFindVenue:()=>_z});function IW({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Tt(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:Qe}}var Oce={};Ai(Oce,{categoryCanContain:()=>p1,getCategoryAgeDetails:()=>rI,getEvent:()=>TW,getEventProperties:()=>wW,getEventStructures:()=>EO,getEventTimeItem:()=>T1,getEvents:()=>SW,getFlightProfile:()=>Cn,getScaledEntries:()=>cw});function wW({tournamentRecord:t,event:e}){if(!t)return{error:Qe};if(!e)return{error:Or};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=i.map(d=>d.participantId),o=r.filter(d=>s.includes(d.participantId)),l,c,u;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:h,name:f}=d,m={scaleType:Az,eventType:a,scaleName:n},g=dh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:gse,eventType:a,scaleName:n};let v=dh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:mse,eventType:a,scaleName:n};let y=dh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||g),c=!!(c||v),u=!!(u||y),{participantId:p,participantName:h||f,seed:g,ranking:v,rating:y}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function SW({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:Qe};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:u})=>!n||Array.isArray(n)&&n.includes(u)).map(u=>{let d=u.drawDefinitions?.map($P);if(a?.length&&!Un(a,d).length)return;let p=Tt(u);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),c={};if(e){let u=cn({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((h,f)=>h+parseFloat(f),0);for(let p of l){let h=i??p.eventType,f=p.eventId;c[f]||(c[f]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:T})=>Xu.includes(T)).map(xi),g=T=>{if(T?.ratings?.[h])for(let S of T?.ratings?.[h]??[]){let D=S.scaleName;c[f].ratings[D]||(c[f].ratings[D]=[]);let C=Ua[D]?.accessor;if(C){let E=parseFloat(S.scaleValue?.[C]);E&&c[f].ratings[D].push(E)}}if(T?.rankings?.[h])for(let S of T?.rankings?.[h]??[]){let D=S.scaleName;c[f].ranking[D]||(c[f].ranking[D]=[]),S.scaleValue&&c[f].ranking[D].push(S.scaleValue)}};for(let T of m){let S=u?.[T]?.participant;if(S?.participantType!==Li)for(let D of S?.individualParticipantIds??[]){let C=u?.[D]?.participant;g(C)}else g(S)}let v=c[f].ratings;for(let T of Object.keys(v)){let S=v[T];if(!S.length)continue;let D=hY(S)?.toFixed(2);c[f].ratingsStats[T]={avg:parseFloat((d(S)/S.length).toFixed(2)),median:D?parseFloat(D):void 0,max:Math.max(...S),min:Math.min(...S)}}let y=(T,S)=>{let D=C=>{if(c[f].draws?.[T]&&C?.ratings?.[h])for(let E of C?.ratings?.[h]??[]){let P=E.scaleName;c[f].draws[T]?.ratings[P]||(c[f].draws[T].ratings[P]=[]);let R=Ua[P]?.accessor;if(R){let M=parseFloat(E.scaleValue?.[R]);M&&c[f].draws[T].ratings[P].push(M)}}if(c[f].draws?.[T]&&C?.rankings?.[h])for(let E of C?.rankings?.[h]??[]){let P=E.scaleName;c[f].draws[T]?.ranking[P]||(c[f].draws[T].ranking[P]=[]);let R=E.scaleValue;R&&c[f].draws[T].ranking[P].push(R)}};for(let C of S.filter(Boolean)){let E=u?.[C]?.participant;if(E?.participantType!==Li)for(let P of E?.individualParticipantIds??[]){let R=u?.[P]?.participant;D(R)}else D(E)}},b=[],I=T=>a?.length&&a.includes(T)||b.includes(T);for(let T of p.drawDefinitions??[]){let S=T.drawId;if(I(S))continue;let D=xy({drawDefinition:T}).assignedParticipantIds??[];c[f].draws[S]||(c[f].draws[S]={ratingsStats:{},ratings:{},ranking:{}}),b.push(S),y(S,D)}let w=Cn({event:p}).flightProfile;for(let T of w?.flights??[]){let S=T.drawId;if(I(S))continue;let D=T.drawEntries.map(xi);y(S,D)}for(let T of b){let S=c[f].draws[T].ratings;for(let D of Object.keys(S)){let C=S[D];if(!C.length)continue;let E=hY(C)?.toFixed(2);c[f].draws[T].ratingsStats[D]={avg:parseFloat((d(C)/C.length).toFixed(2)),median:E?parseFloat(E):void 0,max:Math.max(...C),min:Math.min(...C)}}}}}return Lt({eventScaleValues:c,events:l,...se})}function TW({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:Qe};if(!r)return{error:Or};let n=Tt(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Lt({drawDefinition:a,event:n})}function gOe(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=bOe(t),n=IOe({...t,policyDefinitions:r,appliedPolicies:i}),a=yOe(t),s=wOe({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return ce({result:s,stack:e});let o=SOe({...t,consideredEntries:a}),l=vOe({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return ce({result:l,stack:e});let c=l.drawType;if(isNaN(o)&&c!==Pl)return ce({result:{error:n1},stack:e});let u=r?.[bu]??i?.[bu],d=t.seedingProfile??u?.seedingProfile?.drawTypes?.[c??""]??u?.seedingProfile;t.seedingProfile&&(r[bu]||(r[bu]={...EV[bu]}),r[bu].seedingProfile=d);let p=TOe({...t,drawType:c});return p?.error?ce({result:p,stack:e}):{drawSize:o,drawType:c,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function vOe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??eR({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=fle({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function xce(t){return t?.filter(e=>e.entryStatus&&[...Xu,M1].includes(e.entryStatus))}function yOe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||xce(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ut)}function bOe(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...Qi({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Tt(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function IOe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Fa]?.participants?.enforceGender??i?.[Fa]?.participants?.enforceGender}function wOe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&LO({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function SOe(t){return!t.drawSize&&t.consideredEntries.length&&![Pl,f1,FU,$u,Ch].includes(t.drawType??"")&&RU(t.consideredEntries.length)||t.drawSize&&ii(t.drawSize)||!1}function TOe(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&qO({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:JG}:{...se}}function Lce(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[Gf],n=is({drawDefinition:e});return e.structures?.forEach(a=>{let s=dg({structureId:a.structureId,matchUpsMap:n}),o=nse({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:c}=o;(a.structures||[a]).forEach(u=>{(u.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let h=l?.[p]?.roundName,f=l?.[p]?.abbreviatedRoundName,m=c?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:f,feedRound:m,roundName:h})}})})}),{drawDefinition:e}}function cR(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=cn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=xce(r?.entries)??[],l=gOe({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return ce({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=r?.eventType,g=t.matchUpType??m,v=Tke({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return ce({result:v,stack:n});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return ce({result:{error:be},stack:n});let I=Xke({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:r});if(I.error)return ce({result:I,stack:n});let{existingDrawDefinition:w,positioningReports:T,drawDefinition:S,structureId:D,conflicts:C,entries:E}=I;if(!S)return ce({result:{error:be},stack:n});let P=Jke({...t,existingDrawDefinition:w,positioningReports:T,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:D,entries:E,params:t,stack:n});if(P.error)return P;let{qualifyingConflicts:R}=P;return S.drawName=t.drawName??(p&&gs(p)),d&&typeof e=="object"&&d>=4&&Hz({...e,drawDefinition:S,matchUpType:g}),t.hydrateRoundNames&&c?.[Gf]&&Lce({drawDefinition:S,appliedPolicies:c}),{existingDrawDefinition:!!w,qualifyingConflicts:R,positioningReports:T,drawDefinition:S,structureId:D,...se,conflicts:C}}function Fce({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Wt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:ch,scaleName:n,scaleDate:s}],participantId:o}))}}function UOe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=nx({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:be};let m=cw({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Fce({scaleAttributes:r,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:n});return{scaleItemsWithParticipantIds:g}}var UW={};Ai(UW,{addDrawEntries:()=>$z,addEventEntries:()=>rp,addEventEntryPairs:()=>Gce,destroyPairEntries:()=>jse,destroyPairEntry:()=>Gz,getEntriesAndSeedsCount:()=>nx,getMaxEntryPosition:()=>lW,modifyEntriesStatus:()=>UA,modifyEventEntries:()=>Hce,mutate:()=>Bce,promoteAlternate:()=>Vce,promoteAlternates:()=>EW,query:()=>Rce,removeDrawEntries:()=>jce,removeEventEntries:()=>V1,setEntryPosition:()=>DW,setEntryPositions:()=>$ce});var Bce={};Ai(Bce,{addDrawEntries:()=>$z,addEventEntries:()=>rp,addEventEntryPairs:()=>Gce,destroyPairEntries:()=>jse,destroyPairEntry:()=>Gz,modifyEntriesStatus:()=>UA,modifyEventEntries:()=>Hce,promoteAlternate:()=>Vce,promoteAlternates:()=>EW,removeDrawEntries:()=>jce,removeEventEntries:()=>V1,setEntryPosition:()=>DW,setEntryPositions:()=>$ce});function DW({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:Qe};if(!i)return ce({result:{error:na},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:be,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=yd({entries:a.entries})),e?.entries&&(o(e),e.entries=yd({entries:e.entries}))),{...se}}function $ce({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:Qe};if(!Array.isArray(e))return{error:be};for(let n of e){let{participantId:a,entryPosition:s}=n,o=DW({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=yd({entries:r.entries})),i?.entries&&(i.entries=yd({entries:i.entries})),{...se}}function Vce(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:be,participantId:e}:EW({...t,participantIds:[e].filter(Boolean)})}function EW({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ut,eventId:a,event:s}){if(!t)return{error:Qe};if(!Array.isArray(i))return{error:be,participantIds:i};if(!s)return{error:Or};let o="promoteAlternates";if(s){let l=iK({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=iK({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ce({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...se},stack:o}):l}return{...se}}function iK({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Cu),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:Fre};let l=o.filter(({entryStatus:d})=>d!==Cu);if(l.length)return{error:K$,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:H1e,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u?.length)return{error:z1e,invalidStageSequence:u};for(let d of o){d.entryStatus=nl;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Cu&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===nl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ii(f||0)),0);d.entryPosition=h||0}return{...se}}function jce({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:Or};if(!r)return{error:Md};if(!e?.length)return{error:_g};let s=xy({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(ho(s,e))return{error:kU};let o=u=>{let d=u.participantId;return!e.includes(d)},{flightProfile:l}=Cn({event:a}),c=l?.flights?.find(u=>u.drawId===r);return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),t&&(c.drawEntries=yd({entries:c.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=yd({entries:i.entries}))),{...se}}function Ip(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:Qe};if(!s)return ce({result:{error:BI},stack:e});s.participantId||(s.participantId=or()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:c}=s;if(o.participants.reduce((m,g)=>g.participantId===l||m,!1))return{error:_re};let{participantType:u,participantRole:d}=s;if(!u||!Object.keys(rT).includes(u))return{error:Td,participantType:u};if(!d)return{error:Nre};let p=o.participants||[],h=p.filter(m=>m.participantType===Li).map(m=>m.participantId);if(u!==Li&&s.person)return{error:be,person:s.person};if(c&&!Array.isArray(c))return{error:be,individualParticipantIds:c};if(u===Di){if(s.person)return{error:be,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return ce({info:"PAIR must be 2 individualParticipantIds",result:{error:bl},stack:e});{let v=p.filter(y=>y.participantType===Li).map(y=>y.participantId);if(!Array.isArray(s.individualParticipantIds))return ce({result:{error:bl},stack:e});if(!s.individualParticipantIds.reduce((y,b)=>v.includes(b)&&y,!0))return ce({result:{error:bl},stack:e})}}else return ce({result:{error:_g},stack:e});let m=p.filter(v=>v.participantType===Di).map(v=>({individualParticipantIds:v.individualParticipantIds,participant:v})),g=s.participantType===Di&&m.find(v=>Un(v.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...se,existingParticipant:!0,participant:r&&Tt(g.participant)};if(!s.participantName){let v=p.filter(b=>s.individualParticipantIds?.includes(b.participantId)),y=v.map(b=>b.person?.standardFamilyName).filter(Boolean).join("/");v.length===1&&(y+="/Unknown"),s.participantName=y}}else if(u===Li){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:Lre};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(u&&[pr,hc].includes(u)){if(c||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return ce({result:{participantId:m,error:be},stack:e});if(!h.includes(m))return ce({result:{participantId:m,error:An},stack:e})}}else return{error:Td};o.participants.push(s),n||bi({payload:{tournamentId:o.tournamentId,participants:[s]},topic:lg});let f={participant:r&&Tt(s),...se};return Lt(f)}function Hu({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:Qe};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=or())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===Li),l=a.filter(d=>d.participantType!==Li),c=o.concat(...l),u=[];if(c.length){for(let p of c){let h=Ip({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&bi({topic:lg,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&Tt(u),addedCount:u.length,...se};return s.length&&Object.assign(d,{notAdded:s,info:Ak}),Lt(d)}else return{info:"No new participants to add",addedCount:0,...se}}function Gce(t){let e=jt(t,[{[da]:!0,[mm]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Cu,participantIdPairs:n=[],entryStage:a=Ut,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==fr)return{error:Th};let u=[],d=new Map;for(let I of s.participants??[]){let{participantType:w,participantId:T,person:S,individualParticipantIds:D}=I;w===Li&&S?.sex?d.set(T,S.sex):w===Di&&D&&u.push(D)}let p=n.filter(I=>{if(I.length!==2)return!0;if(!l.gender||lh(l.gender))return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let w=I.map(S=>d.get(S)),T=Eb(l.gender)&&(!Eb(w[0])||!Eb(w[1]))||Cv(l.gender)&&(!Cv(w[0])||!Cv(w[1]));return ec(l.gender)&&(w.sort(SO),(!Cv(w[0])||!Eb(w[1]))&&(T=!0)),T});if(p.length)return{error:bl,invalidParticipantIdPairs:p};let h=n.map(I=>({participantId:c?.pop()??or(),participantRole:ms,individualParticipantIds:I,participantType:Di})),f=i?h:h.filter(I=>!u.find(w=>Un(w,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=Hu({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=n.map(I=>{let w=g.find(S=>Un(S.individualParticipantIds,I).length===2);if(w)return w;let{participant:T}=Gu({tournamentRecord:s,participantIds:I});return T}).map(I=>I.participantId),y=rp({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});f.length&&bi({payload:{participants:f},topic:lg});let b=f.map(xi);return{...y,info:m,newParticipantIds:b}}function Hce({entryStatus:t=nl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ut,tournamentRecord:n,event:a}){if(!n)return{error:Qe};if(!a)return{error:Or};let s=n.participants??[],o=s.filter(m=>m.participantType===Li).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:bl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:bl,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Di).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Un(g,m).length===2)).map(m=>({participantType:Di,participantRole:ms,individualParticipantIds:m})),p=Hu({participants:d,tournamentRecord:n});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Gu({tournamentRecord:n,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),f=e.map(m=>({entryStatus:Yc,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...h,...f),{...se}}var PW={};Ai(PW,{addDrawDefinition:()=>uR,addEvent:()=>iD,addFlight:()=>px,assignSeedPositions:()=>rue,attachFlightProfile:()=>OW,categoryCanContain:()=>p1,deleteDrawDefinitions:()=>cx,deleteEvents:()=>aue,deleteFlightAndFlightDraw:()=>tue,deleteFlightProfileAndFlightDraws:()=>Xce,generate:()=>zce,generateEventsFromTieFormat:()=>Wce,getCategoryAgeDetails:()=>rI,getEvent:()=>TW,getEventProperties:()=>wW,getEventStructures:()=>EO,getEventTimeItem:()=>T1,getEvents:()=>SW,getFlightProfile:()=>Cn,getScaledEntries:()=>cw,modifyEvent:()=>sue,modifyEventMatchUpFormatTiming:()=>Jce,modifyPairAssignment:()=>iue,mutate:()=>Yce,query:()=>Oce,refreshEventDrawOrder:()=>kW,removeEventMatchUpFormatTiming:()=>ux,removeScaleValues:()=>xW,removeSeeding:()=>nue,setEventDates:()=>AW,setEventDisplay:()=>dx,setEventEndDate:()=>NW,setEventStartDate:()=>MW,updateDrawIdsOrder:()=>_W,validateCategory:()=>AP});var zce={};Ai(zce,{generateEventsFromTieFormat:()=>Wce});function DOe({tournamentId:t,event:e}){return e?(bi({payload:{tournamentId:t,event:e},key:e.eventId,topic:Fae}),{...se}):{error:Or}}var EOe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},POe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},qce={COLLEGE_D3:EOe,COLLEGE_DEFAULT:POe,COLLEGE_JUCO:COe,DOMINANT_DUO:Fne,DOMINANT_DUO_MIXED:_ne,LAVER_CUP:Gne,TEAM_DOUBLES_3_AGGREGATION:Cne,TIME_TENNIS_DUAL:kne,TIME_TENNIS_PRO_CIRCUIT:Ane,USTA_BREWER_CUP:One,USTA_OZAKI_CUP:xne,USTA_COLLEGE:Bne,USTA_GOLD_TEAM_CHALLENGE:Pne,USTA_INTERSECTIONAL:Nne,USTA_LEVEL_1:$ne,USTA_SECTION_BATTLE:Mne,USTA_SOUTHERN_LEVEL_5:Rne,USTA_TOC:Hne,USTA_WTT_ITT:Vne,USTA_ZONAL:jne};function iD({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:Qe};if(e.events||(e.events=[]),!r)return{error:Or};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Lt({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:be,context:o}}let s={eventType:nI,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===El){if(r.tieFormat){let o=No({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!qce[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:be};let o=Vf({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=or()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:hre};{let o=s;if(e.events.push(o),!t){let{topics:l}=pc();if(l.includes(sO)){let d=Jh({event:r}).matchUps??[];cg({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:c,...u}=r;for(let d of c||[])w1({drawDefinition:d});DOe({tournamentId:e?.tournamentId,event:u})}return{...se,event:s}}}function Wce(t){let e=jt(t,[{[ET]:{[Kk]:!0,[vae]:!0}},{[da]:!0}]);if(e.error)return e;let i=t.tieFormat||Vf({namedFormat:t.tieFormatName}),r=t.uuids||[Ene(i.collectionDefinitions.length)],n={[Zn]:[],[us]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===Co)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&hp(l)){let c=Ms(l);c&&n[c].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||or(),l=s.matchUpType,c=s.gender,u={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:c,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===jf?Yc:t.entryStatus||nl,p=ec(c)?[...n[Zn],...n[us]]:n[Ms(c)||Tf]??[];if(p.length){let h=rp({participantIds:p,entryStatus:d,event:u});if(h.error)return h}}if(a.push(u),t.addEvents!==!1){let d=iD({internalUse:!0,tournamentRecord:t.tournamentRecord,event:u});if(d.error)return d}}return{...se,events:a}}var Yce={};Ai(Yce,{addDrawDefinition:()=>uR,addEvent:()=>iD,addFlight:()=>px,assignSeedPositions:()=>rue,attachFlightProfile:()=>OW,deleteDrawDefinitions:()=>cx,deleteEvents:()=>aue,deleteFlightAndFlightDraw:()=>tue,deleteFlightProfileAndFlightDraws:()=>Xce,modifyEvent:()=>sue,modifyEventMatchUpFormatTiming:()=>Jce,modifyPairAssignment:()=>iue,refreshEventDrawOrder:()=>kW,removeEventMatchUpFormatTiming:()=>ux,removeScaleValues:()=>xW,removeSeeding:()=>nue,setEventDates:()=>AW,setEventDisplay:()=>dx,setEventEndDate:()=>NW,setEventStartDate:()=>MW,updateDrawIdsOrder:()=>_W,validateCategory:()=>AP});function rD({removePriorValues:t=!0,status:e=fc,statusObject:i,event:r}){if(!ji(i))return{error:be};let n=Zc({event:r,status:e}),a=`${$g}.${Vg}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return lw({timeItem:s,removePriorValues:t,event:r})}function nD(t){let e=jt(t,[{[da]:!0,[mm]:!0},{eventDataParams:!1,[Fo]:Ko}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=fc,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:c}=Qi({tournamentRecord:n,event:s}),u={...c,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:w})=>w)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],h=p.length?[]:t.drawIds,f=(l??[]).concat(...o??[],...h??[],...p),m=f.filter(w=>!d.includes(w));if(m.length)return ce({result:{error:nc},context:{invalidDrawIds:m}});let g=Zc({event:s,status:a}),v=Object.keys(g?.drawDetails||{}).filter(w=>d.includes(w)).reduce((w,T)=>(w[T]=g.drawDetails[T],w),{});for(let w of d)if((!f.length||f.includes(w))&&(o?.includes(w)||h?.length&&!h.includes(w)?v[w]={...v[w],publishingDetail:{published:!1}}:(l?.includes(w)||h?.includes(w)||!h?.length)&&(v[w]={...v[w],publishingDetail:{published:!0}})),t.drawDetails?.[w]){let T=t.drawDetails[w],S=T.structureDetails??v[w].structureDetails,D=T.stageDetails??v[w].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:E=[],publishingDetail:P={},stagesToRemove:R=[],stagesToAdd:M=[]}=T;if((E||M)&&(P.published=!0),v[w]={publishingDetail:P,structureDetails:S,stageDetails:D},E.length||C.length){let N=(s?.drawDefinitions?.find(x=>x.drawId===w)?.structures??[]).map(({structureId:x})=>x),k=(E??[]).concat(C??[]).filter(x=>!N.includes(x));if(k.length)return ce({result:{error:Qr},context:{invalidStructureIds:k}});S=S??{};for(let x of N)C.includes(x)?S[x]={published:!1}:S[x]={published:!0};v[w].structureDetails=S}let A=(s?.drawDefinitions?.find(N=>N.drawId===w)?.structures??[]).map(({stage:N})=>N);if(M.length){for(let N of M)D[N]={published:!0};for(let N of A)D[N]||(D[N]={published:!1})}if(M.length||R.length){for(let N of R)D[N]={published:!1};for(let N of A)D[N]||(D[N]={published:!0})}(M.length||R.length)&&(v[w].stageDetails=D)}rD({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:s});let{topics:y}=pc(),b=y.includes(nV),I=b||t.returnEventData?JO({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:s})?.eventData:void 0;return b&&bi({payload:{eventData:I,tournamentId:n.tournamentId},topic:nV}),{...se,eventData:I}}var Kce="deleteDrawDefinitions",CV="autoSchedulingAudit",wN="deleteEvents",Zce={AUTO_SCHEDULING_AUDIT:CV,DELETE_EVENTS:wN,DELETE_DRAW_DEFINITIONS:Kce};function cx(t){if(!t.tournamentRecord)return{error:Qe};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:c}=Qi({tournamentRecord:a,event:r}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let D=_o({tournamentRecord:a,eventId:o,drawId:d});if(D.error)return D;r=D.event}let p=[],h=[],f=[];if(!r?.drawDefinitions)return ce({info:"event has no drawDefinition",result:{...se},stack:e});let m=r.drawDefinitions.map(({drawId:D})=>D);if(i.length||(i=m),i=i.filter(D=>m.includes(D)),!i.length)return ce({info:"nothing to do; no matching drawIds in event.",result:{...se},stack:e});let g=Tt(Cn({event:r}).flightProfile,!1,!0),v=({participantId:D,drawPosition:C,qualifier:E,bye:P})=>({bye:P,qualifier:E,drawPosition:C,participantId:D}),y=l??c?.[Bc]?.allowDeletionWithScoresPresent?.drawDefinitions,b=Zc({event:r})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],w,T=[],S=r.drawDefinitions.filter(D=>{if(i.includes(D.drawId)){let C=lo({event:r,drawDefinition:D})?.matchUps??[];if(C.some(({score:V})=>sa({score:V}))&&!y)return T.push(D.drawId),!0;let{drawId:E,drawType:P,drawName:R}=D,M=g?.flights?.find(V=>V.drawId===D.drawId);M&&(M.drawEntries=M.drawEntries?.filter(V=>Xu.includes(V.entryStatus))),I.includes(E)&&(I=I.filter(V=>V!==E),w=!0);let A=ju({stageSequence:1,drawDefinition:D,stage:Ut})?.structures?.[0],N=(A?YP({structureId:A.structureId,tournamentRecord:a,drawDefinition:D}):void 0)?.positionAssignments?.map(v),k=ju({stage:Ht,drawDefinition:D})?.structures,x=k?.length?k.map(V=>{let F=V.stageSequence;return{positionAssignments:YP({structureId:V.structureId,tournamentRecord:a,drawDefinition:D})?.positionAssignments.map(v),stageSequence:F}}):void 0,O={action:Kce,payload:{drawDefinitions:[D],eventId:o??r?.eventId,auditData:s}};f.push(O),p.push(Lt({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:x,positionAssignments:N,auditData:s,drawType:P,drawName:R,drawId:E})),C?.forEach(({matchUpId:V})=>h.push(V))}return!i.includes(D.drawId)});if(T.length&&!l)return ce({context:{drawIdsWithScoresPresent:T},result:{error:c1},stack:e});if(r.drawDefinitions=S,g&&Lg({event:r,extension:{name:Vu,value:g}}),sR({tournamentRecord:a}),w){let D={};for(let E of I)D[E]=b.drawDetails?.[E]??{published:!0};let C=rD({statusObject:{drawDetails:D},event:r});if(C.error)return{error:C.error}}if(f.length)if(Fk(_f)){let D=a.tournamentId;bi({topic:_f,payload:{tournamentId:D,detail:f}});let C=(Wc({element:r,itemType:Ov})?.timeItem?.itemValue||0)+1;Lp({element:r,timeItem:{itemType:Ov,itemValue:C},removePriorValues:!0})}else ROe({appliedPolicies:c,event:r,deletedDrawsDetail:p,auditData:s});if(h.length&&Zh({tournamentId:a?.tournamentId,matchUpIds:h}),i.forEach(D=>k0e({drawId:D})),n&&w){let D=nD({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(D.error)return{...se,info:D.error}}return{...se}}function ROe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[Ov]===!1)return;let{extension:n}=Pi({name:Ov,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:Ov};ir({element:e,extension:s})}function Xce({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:Qe};if(!r)return{error:Or};let{flightProfile:a}=Cn({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=cx({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:tO({event:r,name:Vu})}return{...se}}function CW(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:dn};let o=Object.keys(s).filter(c=>!n||n===c);if(n&&!o.includes(n))return{error:be};let l;for(let c of o){let u=s[c],{event:d}=_o({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=MOe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...se}:{error:Lc}}function MOe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:Qe};if(r&&!Array.isArray(r))return{error:be};if(e&&!Array.isArray(e))return{error:be};let a=zf;if(n){let{extension:s}=Pi({element:n,name:a}),o=s?.value||{},l=rK({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});ir({element:n,extension:{name:a,value:l}})}else{let{extension:s}=Pi({element:t,name:a}),o=s?.value||{},l=rK({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});ir({extension:{name:a,value:l},element:t})}return{...se}}function rK(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:c})=>l?.length||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function Jce(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:Qe};if(!Dl({matchUpFormat:n}))return{error:be};if(!o)return{error:Or};let{averageTimes:l=[],recoveryTimes:c=[]}=ax({tournamentRecord:e,matchUpFormat:n,event:o}),u=o.category,d=u?.categoryName||u?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{if(b.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(b.categoryNames?.includes(d)&&(b.categoryNames=b.categoryNames.filter(I=>I!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=r&&!isNaN(ii(r)),g=i&&!isNaN(ii(i)),v=l.map(f).filter(b=>b?.categoryNames?.length),y=c.map(f).filter(b=>b?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||Ir]:r}),v.push(p)),g&&(Object.assign(h.minutes,{[o?.eventType||Ir]:i}),y.push(h)),!m&&!g?{error:be}:CW({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:s})}function ux(t){if(t.event)return nK({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=jt(t,[{[xs]:!0,[Sae]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=_o({tournamentRecord:n,eventId:r});if(a)return nK({event:a})}}return{error:Lc}}function nK({event:t}){return tO({event:t,name:zf})}var RW={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function Qce(t){return!Array.isArray(t)||vi(t).length!==t.length?!1:t.every(e=>Object.keys(RW).includes(e))}function MW({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Qe};if(!e)return{error:Or};if(!fp.test(i))return{error:xa};let r=eue(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,s=new Date(Ti(i)).getTime();if(!n||!a||s<n||s>a)return{error:xa};let o=e.endDate&&new Date(Ti(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...se}}function NW(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:Qe};if(!i)return{error:Or};if(!fp.test(r))return{error:xa};let n=eue(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ti(r)).getTime();if(!a||!s||o<a||o>s)return{error:xa};let l=i.startDate&&new Date(Ti(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...se}}function AW(t){let e=jt(t,[{tournamentRecord:!0,event:!0},{[ds]:l=>fp.test(l),[sc]:xa,startDate:!1,endDate:!1},{[ds]:l=>l.filter(Boolean).every(c=>fp.test(c)),[sc]:xa,activeDates:!1},{[ds]:Qce,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:s}=t,o=t.activeDates?.filter(Boolean);if(a&&s){let l=new Date(Ti(a)).getTime(),c=new Date(Ti(s)).getTime();if(l>c)return{error:be}}if(o){let l=a||i.startDate,c=s||i.endDate,u=!l||o.every(p=>new Date(p)>=new Date(l)),d=!c||o.every(p=>new Date(p)<=new Date(c));if(!u||!d)return{error:xa}}if(a){let l=MW({tournamentRecord:i,event:n,startDate:a});if(l.error)return l}if(s){let l=NW({tournamentRecord:i,event:n,endDate:s});if(l.error)return l}return o&&(n.activeDates=o),r&&(n.weekdays=r),{...se}}function eue(t){let{startDate:e,endDate:i}=t;return!fp.test(e)||!fp.test(i)?ce({result:{error:Pre},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ti(e)).getTime(),tournamentEndDate:new Date(Ti(i)).getTime()}}function _W({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:Or};if(!e)return{error:Wt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:be,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!isNaN(n)))return{error:be,info:"drawOrder must be numeric"};if(vi(i).length!==i.length)return{error:be,info:"drawOrder values must be unique"};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&Un(n,a).length!==n.length)return{error:be,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Cn({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...se}}function kW({tournamentRecord:t,event:e}){if(!t)return{error:Qe};if(!e)return{error:Or};let{flightProfile:i}=Cn({event:e}),r=i?.flights&&Object.assign({},...i.flights.sort((n,a)=>n.flightNumber-a.flightNumber).map((n,a)=>({[n.drawId]:a+1})))||e.drawDefinitions?.length&&Object.assign({},...e.drawDefinitions.sort((n,a)=>n.drawOrder-a.drawOrder).map((n,a)=>({[n.drawId]:a+1})))||void 0;return r?_W({event:e,orderedDrawIdsMap:r}):{...se}}function tue({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:Qe};if(!r)return{error:Md};if(!n)return{error:Or};let{flightProfile:s}=Cn({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(c=>c.drawId!==r),l={name:Vu,value:{...s,flights:o}};Lg({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=cx({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return kW({tournamentRecord:e,event:n})}function iue(t){let e=jt(t,[{[mm]:!0,[da]:!0,[zH]:!1},{replacementIndividualParticipantId:!0,[ds]:g=>jr(g),existingIndividualParticipantId:!0,[Pu]:na,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==Fc)return{error:Th};if(!(o?.entries?.filter(({entryStatus:g})=>[Yc,_y].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Sd};let c=(n.participants||[]).find(g=>g.participantId===s);if(c?.participantType!==Di)return{error:FI,participant:c};let u=c.individualParticipantIds,d=[i,...u.filter(g=>g!==r)],{participant:p}=Gu({participantIds:d,tournamentRecord:n}),h;if(p)h=p.participantId;else{let g={participantId:l?.pop(),participantRole:ms,individualParticipantIds:d,participantType:Di},v=Ip({participant:g,returnParticipant:!0,tournamentRecord:n});if(v.error)return v;h=v.participant.participantId}let{flightProfile:f}=Cn({event:o});if(a){let g=f?.flights?.find(({drawId:v})=>v===a.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===s?{...v,participantId:h}:v)),a.entries=a.entries.map(v=>v.participantId===s?{...v,participantId:h}:v);for(let v of a.structures||[])if(v.structures){v.positionAssignments=void 0;for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===s?{...b,participantId:h}:b)}else v.positionAssignments&&(v.positionAssignments=v.positionAssignments.map(y=>y.participantId===s?{...y,participantId:h}:y))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:h}||g.participantId===i&&{...g,participantId:r}||g);let m=n.events.some(({entries:g,eventId:v,drawDefinitions:y})=>o.eventId===v?y.some(({drawId:b,entries:I})=>b===a?.drawId?!1:I?.find(w=>w.participantId===s)):g?.find(b=>b.participantId===s));if(!m){let g=rw({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...se,participantOtherEntries:m,newPairParticipantId:h}}function uR(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:c}=t;if(!l)return{error:Nt};if(!c)return{error:Or};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:be,info:"drawDefintions count mismatch"};let{flightProfile:m}=Cn({event:c}),g=e&&m?.flights?.find(R=>R.flightNumber===e.flightNumber),v=m?.links?.find(R=>R?.target?.drawId===u)?.source?.drawId;if(v&&!c.drawDefinitions.find(R=>R.drawId===v))return ce({result:{error:Nt},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ce({result:{error:Ab},info:{relevantFlight:g}});let y=p?.every(({participantId:R,entryStatus:M})=>{let A=g?.drawEntries.find(N=>N.participantId===R);return!M||A?.entryStatus===M}),b=!s||h&&p?.every(({participantId:R,entryStatus:M,entryStage:A})=>h.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===A))?.entryStatus===M);if(g&&!y)return ce({result:{error:Ab},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&Xu.includes(R?.entryStatus)){let M=h?.filter(Boolean).find(A=>A.participantId===R.participantId);M&&R.entryStatus&&M?.entryStatus!==R.entryStatus&&(M.entryStatus=R.entryStatus,f+=1)}}),h&&!b)return ce({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:Ab}});let I=m?.flights?.map(({flightNumber:R})=>!isNaN(R)&&ii(R))?.filter(Boolean)||[],w=c.drawDefinitions.map(({drawOrder:R})=>R&&ii(R))?.filter(Boolean)||[],T=Math.max(0,...w,...I)+1,S=m?.flights?.find(R=>R.drawId===u),D;if(S){S.drawName=l.drawName,D={name:Vu,value:{...m,flights:m.flights}};let R=S.flightNumber;R&&!w.includes(R)?T=R:S.flightNumber=T}else{let R=m?.flights||[];R.push({manuallyAdded:!0,flightNumber:T,drawEntries:p,drawName:d,drawId:u}),D={name:Vu,value:{...m||{},flights:R}}}Lg({event:c,extension:D}),Object.assign(l,{drawOrder:T});let C=c.drawDefinitions.find(R=>R.drawId===u),E=o?.tournamentId,P=c.eventId;if(C){if(!a)return{error:rre};let R=lo({drawDefinition:C})?.matchUps?.map(Ea)??[],M=lo({drawDefinition:l})?.matchUps;if(!i){R?.length&&Zh({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:E,eventId:P}),M?.length&&cg({matchUps:M,tournamentId:E,eventId:P}),c.drawDefinitions=c.drawDefinitions.map(N=>N.drawId===u?l:N);let A=l.structures?.map(({structureId:N})=>N);Pr({drawDefinition:l,tournamentId:E,structureIds:A,eventId:P})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:R}=lo({drawDefinition:l,event:c});R&&cg({tournamentId:o?.tournamentId,matchUps:R}),w1({drawDefinition:l,tournamentId:E,eventId:P})}return{...se,modifiedEventEntryStatusCount:f}}function rue(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!o?.length)return{error:iH};if(!r)return{error:Qe};if(!l)return{error:Md};let d=$c({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v?.participantId).filter(Boolean);if(g.length!==Hie(g).length)return{error:nre};for(let v of m){let y=ZU({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:c});if(y?.error)return y;y?.success&&u++}return u?{...se,modifications:u}:{error:xU}}function OW({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return ce({result:{error:Wt},stack:r});if(!e)return ce({result:{error:Or},stack:r});let{flightProfile:n}=Cn({event:e});return n&&!t?ce({result:{error:IH},stack:r}):e.drawDefinitions?.length?ce({result:{error:Qie},stack:r}):(Lg({event:e,extension:{name:Vu,value:i}}),{flightProfile:Tt(i,!1,!0),...se})}function NOe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:Qe};if(!i)return{error:_g};if(!e)return{error:Wt,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[fse,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...se}}function xW({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:Or};if(r&&!Array.isArray(r))return ce({result:{error:be},info:iy("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:c}=Cn({event:a}),u=c?.flights?.find(d=>d.drawId===n);u?o=u.drawEntries:o=i?.entries}let l=(o||[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||r.includes(c.entryStatus))).map(xi);return NOe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function dx({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=fc,event:n}){if(!e)return ce({result:{error:Qe}});if(!n)return ce({result:{error:Or}});if(!ji(i))return ce({result:{error:Wt}});if(ji(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>R1e(d.attributes,c.attributes));u?.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=rD({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...se}}function nue({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:Qe};if(!a)return{error:Or};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:ch,scaleName:r};return xW({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function aue(t){let e=jt(t,[{[da]:!0},{eventIds:!0,[Fo]:Cs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(c=>{if(n.includes(c.eventId)){let p={action:wN,payload:{events:[c]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===Fc?(c.entries||[]).map(({entryStatus:p,participantId:h})=>p!==Yc&&h).filter(Boolean):[],d=n.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));r.participants=r.participants.filter(({participantId:u})=>!c.includes(u))}if(sR({tournamentRecord:r}),a.length)if(Fk(_f)){let c=r.tournamentId;bi({topic:_f,payload:{type:wN,tournamentId:c,detail:a}})}else J1({tournamentRecord:r,timeItem:{itemValue:s,itemType:wN}});return{...se}}function sue(t){let e=jt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Ko}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=kOe(t),s=OOe({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,c=Cn({event:r})?.flightProfile?.flights,u=!r.drawDefinitions?.length&&!c?.length,d=xOe({noFlightsNoDraws:u,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=LOe({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let h=AOe({...t,...s,enteredParticipants:a,stack:n});if(h.error)return h;let f=_Oe({...t,stack:n});return f.error?f:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...se})}function AOe(t){let e=t.eventUpdates?.category;if(!e)return{...se};let i=AP({category:e});if(i.error)return i;if(t.event.eventType===Qn){let r=t.event?.drawDefinitions?.map(s=>Hd(s))??[],n=Hd(t.event),a=(Jh(t)?.matchUps??[]).map(s=>Hd(s))??[];if(![n,...r,...a].filter(Boolean).every(s=>s.collectionDefinitions.every(o=>!o.category||p1({category:t.eventUpdates.category,childCategory:o.category}))))return ce({result:{error:DP},stack:t.stack})}if(t.enteredParticipants?.length){let r=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,n=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,a=t.enteredParticipants.map(l=>l.participantType===Li?l:l.individualParticpants??[]).flat(),s=rI({category:e,consideredDate:r}),o=rI({category:e,consideredDate:n});if(s?.ageMinDate||s?.ageMaxDate||o?.ageMinDate||o?.ageMaxDate)for(let l of a){let c=l.person?.birthDate;if(!c)return ce({result:{error:Tre},stack:t.stack});let u=new Date(c).getTime();if(s.ageMinDate||s.ageMaxDate){let d=new Date(s.ageMinDate).getTime(),p=new Date(s.ageMaxDate).getTime();if(u<d||u>p)return ce({result:{error:Y$},stack:t.stack})}if(o.ageMin||o.ageMax){let d=new Date(o.ageMinDate).getTime(),p=new Date(o.ageMaxDate).getTime();if(u<d||u>p)return ce({result:{error:Y$},stack:t.stack})}}}return{...se}}function _Oe(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=AW({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ce({result:a,stack:n})}return{...se}}function kOe(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...Xu,Cu].includes(a)}).map(({participantId:n})=>n)??[];return r?cn({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function OOe({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=vi(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function xOe({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||lh(i.gender)||e.length===1&&e[0]===i.gender||t&&ec(i.gender);return i.gender&&!n?ce({context:{gender:i.gender,validGender:n},result:{error:FE},stack:r}):{...se}}function LOe({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(Qn)&&[Qn]||t.includes(Li)&&[mp]||t.includes(Di)&&[Fc]||[Fc,mp,Qn]).includes(e.eventType??"");return e.eventType&&!r?ce({context:{participantType:e.eventType,validEventType:r},result:{error:Th},stack:i}):{...se}}function px({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return ce({result:{error:Or},stack:s});if(!i)return ce({result:{error:Wt},stack:s});if(e?.length){let h=(n.entries??[]).map(xi),f=e.map(xi);if(Un(f,h).length!==f.length)return ce({result:{error:be},stack:s})}let o=Cn({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:h})=>!isNaN(h)&&ii(h))?.filter(Boolean)||[],c=Math.max(0,...l)+1,u={drawId:r||or(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),(o?.flights||[]).find(({drawId:h})=>h===u.drawId))return ce({result:{error:ine},stack:s});let d=(o?.flights||[]).concat(u),p={name:Vu,value:{...o||{},flights:d}};return Lg({event:n,extension:p})}var LW={};Ai(LW,{drawMatic:()=>zq,garman:()=>fue,generateAdHocMatchUps:()=>FO,generateAdHocRounds:()=>Hq,generateAndPopulatePlayoffStructures:()=>vq,generateCourts:()=>FW,generateDrawDefinition:()=>cR,generateDrawMaticRound:()=>_q,generateDrawStructuresAndLinks:()=>Mq,generateDrawTypeAndModifyDrawDefinition:()=>Nq,generateFlightProfile:()=>BOe,generateLineUps:()=>hue,generateQualifyingStructure:()=>cq,generateSeedingScaleItems:()=>Fce,generateStatCrew:()=>$Oe,generateVoluntaryConsolation:()=>Sle,roundRobinGroups:()=>eNe});var FOe="splitLevelBased",oue="splitWaterfall",lue="splitShuttle",cue={SPLIT_LEVEL_BASED:FOe,SPLIT_WATERFALL:oue,SPLIT_SHUTTLE:lue};function BOe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Or};let f=p.entries??[],{flightProfile:m}=Cn({event:p});if(m&&i&&!s)return{error:IH};let g=t.scaledEntries??cw({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(xi),y=so(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||ky.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,w=Math.ceil(I/c),T=Ca(b,w);u===oue?T=$$(b,c):u===lue&&(T=$$(b,c,!0));function S(E){return(E||[]).map(({participantId:P,scaleValue:R})=>{let M=f.find(A=>A.participantId===P);return M?.scaleValue&&R&&(M.scaleValue=R),M}).sort((P,R)=>P.scaleValue-R.scaleValue).map((P,R)=>(P.scaleValue&&(P.seedNumber=R+1),P))}let D=vt(0,c).map(E=>{let P=E+1;return{flightNumber:P,drawId:d?.pop()??or(),drawEntries:S(T[E]),drawName:l?.length&&l[E]||`${e} ${P}`}}),C={scaleAttributes:n,splitMethod:u,flights:D};if(i){let E=OW({flightProfile:C,deleteExisting:s,event:p});return{splitEntries:ac()&&T||void 0,...E}}else return{flightProfile:C,...se}}function uue({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return due({tagName:e,attributes:n,childArrays:i,childObjects:r})}function due(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=r?.map(({key:h,value:f})=>due({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=n?.map(({key:h,value:f})=>uue({tagName:h,json:f??[]})).join(`\r
`),c=i?.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function $Oe(t){let e=jt(t,[{[da]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=cn({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),c=i.participants.filter(b=>b.participantType===pr),u=o?.filter(b=>b.matchUpType===pr)??[],d=u?.reduce((b,I)=>{let w=I?.tieMatchUps??[];return w&&[...b,...w]},[])??[],p=o?.filter(b=>b.matchUpType===Ir)??[],h=o?.filter(b=>b.matchUpType===fr)??[],f=d.length===p.length+h.length,m=u.length===1&&f,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:f?"N":"Y",startDate:r},v=[],y=[];if(m){let b=u[0],{json:I,xml:w}=aK({teamParticipants:c,teamMatchUp:b,...g,doubles:h,singles:p});y.push(I),v.push(w)}else for(let b of u){let I=b?.sides?.map(({participant:D})=>D?.participantId).filter(Boolean);if(I?.length!==2)continue;let w=I.map(D=>D&&s?.[D]?.participant),{xml:T,json:S}=aK({doubles:b.tieMatchUps?.filter(D=>D.matchUpType===fr),singles:b.tieMatchUps?.filter(D=>D.matchUpType===Ir),teamParticipants:w,teamMatchUp:b,...g});y.push(S),v.push(T)}return{json:y,xml:v,...se}}function aK({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){let u=t?.find(I=>I.participantRoleResponsibilities?.includes("Home")),d=t?.filter(I=>I.participantId!==u?.participantId),p=Du(o,"/","MDY"),h=u?.participantName||d?.[1]?.participantName,f=u?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,g=d?.[0]?.participantId,v={},y=t.map(I=>({team:{...GOe({teamParticipant:I,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:f})}})),b=Lt({venue:{tournamentname:s?r:void 0,neutralgame:u?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:h,visname:m,homeid:f,visid:g,date:p},childArray:y,singles_matches:c?.map(I=>sK({matchUp:I,homeid:f,uniValues:v})),doubles_matches:l?.map(I=>sK({matchUp:I,homeid:f,uniValues:v}))});return{json:b,xml:uue({json:b,tagName:"tngame"})}}function VOe({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?vi(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?vi(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,c=i.individualParticipants?.[0]?.participantName,u=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],h=e[s][i.individualParticipants?.[0]?.participantId],f=e[s][i.individualParticipants?.[1]?.participantId];return Lt({vh:d,uni:p,uni_1:h,uni_2:f,team:o,name:l,name_1:c,name_2:u})}function jOe({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,c=`tie_${r}`,u=e===1?n:a,d=e===1?s:o;return{[l]:u,[c]:d}})??[])}function GOe({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",c=i?.[s]?.matchUps,u=c&&Object.keys(c),d=e?.sides?.find(({participant:I})=>I.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let h={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],m=[],g=0;for(let I of u??[]){let w=r?.[I],T=w.sides.find(({participant:D})=>D.participantId===s)?.sideNumber,S=w.score?.sets?.[0]?.[`side${T}Score`]??0;g+=S;for(let D of w.tieMatchUps??[]){let{matchUpType:C,winningSide:E}=D,P=E&&(E===T?"w":"l")||"";P&&(h[C][P]+=1);let R=P==="w"?"1":"0",M=P==="l"?"1":"0";if(C===Ir){let A=m.length+1;m.push({singles_pair:{pair:A,won:R,lost:M,tied:"0"}})}else if(C===fr){let A=f.length+1;f.push({doubles_pair:{pair:A,won:R,lost:M,tied:"0"}})}}}let v=[{singles:{childArray:m,won:h.SINGLES.w,lost:h.SINGLES.l}},{doubles:{childArray:f,won:h.DOUBLES.w,lost:h.DOUBLES.l}}],y=[],b=1;for(let I of t.individualParticipantIds){let w=i?.[I];if(w){let{participant:T,counters:S}=w,D={won:S?.DOUBLES?.wins||0,lost:S?.DOUBLES?.losses||0},C={won:S?.SINGLES?.wins||0,lost:S?.SINGLES?.losses||0},{participantName:E,participantId:P}=T;a[s][P]=b,y.push({player:{name:E,uni:b,singles:C,doubles:D}})}b+=1}return{vh:l,id:s,name:o,score:p||g,totals:v,childArray:y}}function sK({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:c,participant:u}=l,d=jOe({sets:t.score?.sets,sideNumber:c});return{[a===Ir?"singles_score":"doubles_score"]:{...VOe({homeid:e,uniValues:i,participant:u}),...d}}});return{[a===Ir?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var HOe="DESC",RV="DESC",pue={ASC:"ASC",ASCENDING:"ASC",DESC:HOe,DESCENDING:RV};function hue(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==El)return{error:Th};if(!r)return{error:Qe};if(!e&&!n)return{error:nc};if(e=e??Ks({drawDefinition:n,event:l})?.tieFormat,No({tieFormat:e}).error)return{error:oh};if(typeof a!="object"&&!i)return{error:be,context:{scaleAccessor:a}};let c={},u=(n?.entries??l?.entries??[]).filter(P=>P?.entryStatus===nl).map(xi),{participants:d=[]}=cn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:P})=>u.includes(P)),h=P=>P===sg?"rankings":"ratings",f=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=f,scaleType:g=sg,sortOrder:v,accessor:y}=a||{},b=h(g),I=(P,R)=>{let M=P[b]?.[R];if(!M&&i&&(M=P[b]?.[Nb]),Array.isArray(M)){let A=M.find(N=>N.scaleName===m)?.scaleValue;if(gn(A))return A;if(y&&typeof A=="object")return A[y]}return 0},w=(P,R,M)=>{let A=v===RV?R:P,N=v===RV?P:R;return I(A,M)-I(N,M)},T=(P,R)=>w(P,R,Nb),S=(P,R)=>w(P,R,Wv),D=[],C=e?.collectionDefinitions??[];for(let P of p){let R=P.individualParticipants?.sort(T)??[],M=s?R:P.individualParticipants?.sort(S)??[],A={};for(let k of C){let x=[],{collectionId:O,matchUpCount:V,matchUpType:F,gender:j}=k,q=kn(Nb)(F);vt(0,V).forEach(W=>{let z=q?R:M??[],H=W+1,Z=[];vt(0,q?1:2).forEach(J=>{let ie=z?.find(K=>{let ne=Ms(j),le=ne&&(hp(j)&&ne||ec(j)&&[Zn,us][J]);return(!le||le===K.person?.sex)&&!x.includes(K.participantId)})?.participantId;ie&&(Z.push(ie),x.push(ie),A[ie]||(A[ie]=[]),A[ie].push({collectionPosition:H,collectionId:O}))}),q||D.push(Z)})}let N=Object.keys(A).map(k=>({collectionAssignments:A[k],participantId:k}));c[P.participantId]=N}let E=[];for(let P of D){let{participant:R}=Gu({tournamentParticipants:d,participantIds:P});if(!R){let M={individualParticipantIds:P,participantRole:ms,participantType:Di};E.push(M)}}if(o){for(;E.length;)Ip({participant:E.pop(),tournamentRecord:r});ir({element:n,extension:{name:Hf,value:c}})}return{...se,lineUps:c,participantsToAdd:E}}function FW(t){if(!t)return{error:Wt};let e=jt(t,[{dates:!1,[ds]:s=>Array.isArray(s)&&s.every(el)},{uuids:!1,[ds]:s=>Array.isArray(s)&&s.every(jr)},{startTime:!1,endTime:!1,[ds]:MH},{idPrefix:!1,namePrefix:!1,[ds]:jr},{count:!0,[ds]:gn}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&bT(i,r)||[],a=vt(1,t.count+1).map(s=>Lt({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??or(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...se,courts:a}}var fue={};Ai(fue,{default:()=>WOe,garman:()=>vue});function dR({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Uh(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function aD(t){let e=jt(t,[{courtDate:!0,_ofType:Ko}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=jn(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>fA(o.startTime).localeCompare(fA(l.startTime))).forEach(o=>{let l={startTime:Gr(a.toISOString()),endTime:o.startTime};jn(o.startTime)>a&&n.push(l),jn(o.endTime)>a&&(a=jn(o.endTime))});let s={startTime:Gr(a.toISOString()),endTime:r.endTime};return jn(r.endTime)>a&&n.push(s),{timeSlots:n}}function zOe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=aD({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=jn(s.startTime),l=jn(s.endTime);return o>i||l<r?!1:d1(i,l)>=t}return{enoughTime:n}}function mue(t){let e=jt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Cs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=jn(n),l=AH(o,i),{enoughTime:c}=zOe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=dR({date:a,court:u});return!!(d&&c(d))})||[]).length,...se}}function hx(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:be,courts:a};if(!Array.isArray(s))return{error:uA};if(!el(n))return{error:xa};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,h)=>{let{courtId:f}=h;return f?p.courtBookings[f]?p.courtBookings[f].push(h):p.courtBookings[f]=[h]:p.unassignedBookings.push(h),p},{courtBookings:{},unassignedBookings:[]}),c=a.map((p,h)=>{let{courtId:f,courtName:m}=p,g=o[f]||[],v=dR({date:n,court:p})||{},{bookings:y=[],startTime:b,endTime:I,date:w}=v,T=[e[h]&&{startTime:b,endTime:e[h]},...Tt(y,!1,!0),...g].filter(Boolean);return{courtId:f,courtName:m,dateAvailability:{bookings:T,startTime:b,endTime:I,date:w}}});l.sort((p,h)=>Xi(p.startTime)-Xi(h.startTime));let u=()=>c.map(p=>{let h=p.dateAvailability,{timeSlots:f=[]}=aD({courtDate:h});return{courtName:p.courtName,courtId:p.courtId,timeSlots:f}}).flat(),d=[];for(let p of l){let{startTime:h,endTime:f,averageMinutes:m,recoveryMinutes:g,matchUpId:v}=p,y=Xi(h),b=Xi(f),I=u().reduce((w,{courtId:T,courtName:S,timeSlots:D})=>{let C;return D.find(({startTime:E,endTime:P})=>{C=Xi(E)-y;let R=y>=Xi(E);return b<=Xi(P)&&w.startDifference!==0&&((C===0||C+r>=0)&&(w.startDifference===void 0||C<w.startDifference)||R)})?{courtName:S,courtId:T,startDifference:C}:w},{});if(I.courtId){let w={averageMinutes:m,recoveryMinutes:g,matchUpId:v,startTime:h,endTime:f};d.push(w),c.find(({courtId:T})=>T===I.courtId)?.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:p})}return{virtualCourts:c.map(({courtId:p,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:p})),assignedBookings:d}}function fx({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function gue(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return vt(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function OT({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=dR({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Xi(l)<Xi(a)||i&&Xi(l)>Xi(a))?l:a},void 0)}function qOe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||OT({courts:r,scheduleDate:n,startTime:!0}),i=i||OT({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=jn(e),o=jn(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=dR({court:l,date:n}),{timeSlots:u}=aD({courtDate:c});u?.forEach(d=>{let p=jn(d.startTime),h=jn(d.endTime);if(p>o||p<s||h<s)return!1;if(d1(p,h)>=t){let f=Gr(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function BW(t){let e=jt(t,[{courts:!0,_ofType:Cs}]);if(e.error)return e;let{date:i=RH(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||fx({averageMatchUpMinutes:c}),i=Ti(i),r=Gr(r),n=Gr(n);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=gue({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=hx({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=qOe({averageMinutes:c,courts:y,startTime:r,endTime:n,date:i});o&&b&&(r=b??r);let I=Xi(r),w=Xi(n)-I,T=Math.floor(w/a),S=vt(0,T+1).map(D=>{let C=I+D*a,E=RRe(C),P=mue({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:R=0}=P,M=R>f?R-f:0;v+=D?R:0;let A=D?v/D:R,N=a*A/c,k=D?N*(D-1)+A:A,x=R?f&&k-h||M:0;h=k,f=R,m+=x;let O=ii(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:R,newCourts:M,totalMatchUps:g}});return{scheduleTimes:S.reduce((D,C)=>{let E=vt(0,C.add).map(()=>({scheduleTime:C.periodStart}));return D.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var vue={getCourtsAvailableAtPeriodStart:mue,generateTimeSlots:aD,getScheduleTimes:BW,courtGenerator:gue},WOe=vue,Zf={};Ai(Zf,{isValid:()=>Dl,isValidMatchUpFormat:()=>Dl,parse:()=>Bs,stringify:()=>jk});var $W={};Ai($W,{allCompetitionMatchUps:()=>Ud,allDrawMatchUps:()=>lo,allEventMatchUps:()=>Jh,allTournamentMatchUps:()=>Ha,analyzeMatchUp:()=>JP,applyLineUps:()=>$ue,assignMatchUpSideParticipant:()=>bue,assignTieMatchUpParticipantId:()=>xA,bulkMatchUpStatusUpdate:()=>xue,calculateWinCriteria:()=>dw,checkInParticipant:()=>jW,checkMatchUpIsComplete:()=>Lv,checkOutParticipant:()=>VW,competitionScheduleMatchUps:()=>lR,disableTieAutoCalc:()=>_ue,drawMatchUps:()=>bW,enableTieAutoCalc:()=>Mue,eventMatchUps:()=>sx,filterMatchUps:()=>Df,findMatchUp:()=>nW,getAllDrawMatchUps:()=>zn,getAllStructureMatchUps:()=>rr,getCheckedInParticipantIds:()=>JI,getCompetitionMatchUps:()=>XP,getEventMatchUpFormatTiming:()=>uW,getHomeParticipantId:()=>fW,getMatchUpCompetitiveProfile:()=>A1,getMatchUpContextIds:()=>mW,getMatchUpDailyLimits:()=>lx,getMatchUpDailyLimitsUpdate:()=>dW,getMatchUpDependencies:()=>Qu,getMatchUpFormat:()=>gW,getMatchUpFormatTiming:()=>_1,getMatchUpFormatTimingUpdate:()=>cW,getMatchUpScheduleDetails:()=>bO,getMatchUpType:()=>IO,getMatchUpsStats:()=>vW,getModifiedMatchUpFormatTiming:()=>ax,getParticipantResults:()=>K1,getPredictiveAccuracy:()=>hW,getRoundMatchUps:()=>fo,getRounds:()=>yW,isValidMatchUpFormat:()=>Dl,matchUpActions:()=>xO,mutate:()=>yue,participantScheduledMatchUps:()=>pW,query:()=>Mce,removeDelegatedOutcome:()=>Nue,removeMatchUpSideParticipant:()=>zW,removeTieMatchUpParticipantId:()=>wue,replaceTieMatchUpParticipantId:()=>HW,resetAdHocMatchUps:()=>Fue,resetMatchUpLineUps:()=>JW,resetScorecard:()=>e3,resetTieFormat:()=>QW,setDelegatedOutcome:()=>Lue,setMatchUpFormat:()=>kue,setMatchUpStatus:()=>pR,setOrderOfFinish:()=>Bue,substituteParticipant:()=>Aue,tallyParticipantResults:()=>QU,toggleParticipantCheckInState:()=>mx,tournamentMatchUps:()=>ox,updateTieMatchUpScore:()=>ym,validMatchUp:()=>hO,validMatchUps:()=>Kc});var yue={};Ai(yue,{applyLineUps:()=>$ue,assignMatchUpSideParticipant:()=>bue,assignTieMatchUpParticipantId:()=>xA,bulkMatchUpStatusUpdate:()=>xue,checkInParticipant:()=>jW,checkOutParticipant:()=>VW,disableTieAutoCalc:()=>_ue,enableTieAutoCalc:()=>Mue,findMatchUp:()=>nW,removeDelegatedOutcome:()=>Nue,removeMatchUpSideParticipant:()=>zW,removeTieMatchUpParticipantId:()=>wue,replaceTieMatchUpParticipantId:()=>HW,resetAdHocMatchUps:()=>Fue,resetMatchUpLineUps:()=>JW,resetScorecard:()=>e3,resetTieFormat:()=>QW,setDelegatedOutcome:()=>Lue,setMatchUpFormat:()=>kue,setMatchUpStatus:()=>pR,setOrderOfFinish:()=>Bue,substituteParticipant:()=>Aue,toggleParticipantCheckInState:()=>mx,updateTieMatchUpScore:()=>ym});function bue({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:Sd};if(!e)return{error:Nt};if(!n)return{error:Qs};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return ce({result:{error:be,context:{sideNumber:r}}});let{matchUp:o,structure:l}=Hr({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:Os};if(!(!l?.structures&&!(e.drawType&&e.drawType!==Pl)&&!l?.matchUps?.find(({roundPosition:c})=>!!c)))return{error:JG};if(!i&&(o?.score?.scoreStringSide1||Hn.includes(o?.matchUpstatus)||o?.matchUpStatus&&[on,ia].includes(o.matchUpStatus)))return{error:Mk,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(c=>{let u=o.sides?.find(d=>d.sideNumber===c)??{sideNumber:c};return r===c?{...u,participantId:i}:u}),s)for(let c of o.sides)c.sideNumber&&(c.sideNumber=3-c.sideNumber);Gi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...se,sidesSwapped:s}}function Ml({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=Hr({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:Os};let c=Lp({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Gi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function VW(t){let e=[{[da]:!0},{[$s]:!0},{[Rh]:!0},{[kp]:!0}],i=jt(t,e);if(i.error)return i;let r=tD(t,[{[BU]:Yh,attr:{[Zk]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&aO.includes(c)||c&&Hn.includes(c)||sa({score:u}))return{error:ore};let d=JI({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!h?.includes(s))return{error:Sd};if(!p?.includes(s))return{error:xre};let f=lse({matchUp:l});if(f?.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m?.indexOf(s);return v!==void 0&&[0,1].includes(v)&&(g?.[v]??[]).forEach(y=>{Ml({drawDefinition:a,matchUpId:o,timeItem:{itemType:SA,itemValue:y}})}),Ml({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:SA}}),{...se,checkedOut:!0}}function jW(t){let e=[{[da]:!0},{[$s]:!0},{[Rh]:!0},{[kp]:!0}],i=jt(t,e);if(i[Pu])return i;let r=tD(t,[{[BU]:Yh,attr:{[Zk]:!0}}]);if(r[Pu])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=JI({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!u?.includes(s))return{[Pu]:Sd};let d={...se,checkedIn:!0};return c?.includes(s)||Ml({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:wA}}),d}function mx(t){let e=jt(t,[{[Rh]:!0,[$s]:!0,[kp]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:Qe};let n=tD(t,[{[BU]:Yh,attr:{[Zk]:!0},[Pu]:Os}]).matchUp?.matchUp;if(!n)return{error:Os};let{checkedInParticipantIds:a=[]}=JI({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?VW({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):jW({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function GW({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:Qe};if(!e)return{error:Md};if(!r)return{error:Lc};let n=is({drawDefinition:e}),{matchUp:a}=Hr({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:Os};let{matchUp:s,structure:o}=Hr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:Os};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=s;if(p&&!Uk([Ir,fr],p))return{error:il};let{positionAssignments:h}=Sr({structure:o}),f=h?.filter(T=>c?.includes(T.drawPosition)),{matchUp:m}=Hr({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=m?.sides?.map(xi)??[],v=f?.map(xi)??[],y=[...g,...v],{participants:b}=cn({tournamentRecord:t,participantFilters:{participantTypes:[pr],participantIds:y}}),{matchUp:I}=Hr({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),w=Ks({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:s,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:w,structure:o,...se}}function HW(t){let e=GW(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return ce({result:{error:na},stack:i});if(r===a)return{...se};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u?.matchUpType,v=u?.sides?.find(O=>O.participant?.participantId===r||O.participant?.individualParticipantIds?.includes(r));if(!v)return{error:An};let y=cn({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(y.length!==2)return ce({result:{error:na},stack:i});if(y[0].participantType!==y[1].participantType)return ce({result:{error:Td},stack:i});let{appliedPolicies:b}=Qi({tournamentRecord:n,drawDefinition:s,event:l}),I=t.policyDefinitions?.[Fa]??b?.[Fa]??KU[Fa],w=y.find(({participantId:O})=>O===a);if((t.enforceGender??I?.participants?.enforceGender)!==!1&&hp(u?.gender)&&Ms(u?.gender)!==Ms(w?.person?.sex))return{error:FI,info:"Gender mismatch"};let T=I?.processCodes?.substitution;X1({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:s,dualMatchUp:h});let S=h?.sides?.find(({sideNumber:O})=>O===v.sideNumber);if(!S)return ce({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:ja},stack:i});if(u?.sides?.flatMap(O=>O.participant?.individualParticipantIds||O.participant?.participantId||[])?.includes(a))return ce({result:{error:Ak},stack:i});let D=c?.sides?.find(({sideNumber:O})=>O===v.sideNumber)?.participantId,C=S.lineUp,E=C?.find(({participantId:O})=>a===O),P=C?.reduce((O,V)=>V.substitutionOrder>O?V.substitutionOrder:O,0),R=C?.map(O=>{let V=Tt(O,!1,!0);if(![r,a].includes(V.participantId))return V;if(!o&&[r,a].includes(V.participantId)&&(V.collectionAssignments=V.collectionAssignments?.filter(F=>!(F.collectionPosition===d&&F.collectionId===p))),o&&r===V.participantId&&(V.collectionAssignments=V.collectionAssignments.map(F=>F.collectionPosition===d&&F.collectionId===p&&F.substitutionOrder===void 0?{...F,substitutionOrder:P}:F)),V.participantId===a){V.collectionAssignments||(V.collectionAssignments=[]);let F={collectionId:p,collectionPosition:d};o&&(F.previousParticipantId=r,F.substitutionOrder=(P??0)+1),V.collectionAssignments.push(F)}return V})??[];if(!E){let O={collectionId:p,collectionPosition:d};o&&(O.substitutionOrder=(P??0)+1,O.previousParticipantId=r);let V={collectionAssignments:[O],participantId:a};R.push(V)}let M=g===fr,{assignedParticipantIds:A}=TA({lineUp:C,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=TA({lineUp:R,collectionPosition:d,collectionId:p});if(S.lineUp=R,D&&m){let O=aw({participantId:D,lineUp:R,drawDefinition:s,tieFormat:m});if(O.error)return ce({result:O,stack:i})}else console.log("team participantId not found");let k,x;if(M){let{tournamentRecord:O}=t,V=Gu({participantIds:N,tournamentRecord:O});if(!V.participant){let j=Ip({returnParticipant:!0,pairOverride:!0,tournamentRecord:O,participant:{participantRole:ms,individualParticipantIds:N,participantType:Di}});if(j.error)return ce({result:j,stack:i});k=j.participant?.participantId}V=Gu({participantIds:A,tournamentRecord:O});let F=V.participant?.participantId;F&&rw({participantIds:[F],tournamentRecord:O}).success&&(x=F)}if(o||v.substitutions?.length===1){if(o)T&&f&&(f.processCodes=vi([...f?.processCodes??[],...T]));else for(let O of T||[]){let V=f?.processCodes?.lastIndexOf(O);V!==void 0&&f?.processCodes?.splice(V,1)}f&&Gi({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s})}return h&&Gi({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s}),{...se,modifiedLineUp:R,participantRemoved:x,participantAdded:k}}function Iue({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:be};let s=i?.lineUp||ey({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(c=>{if(!n.includes(c.participantId))return c;let u=c.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:c.participantId,...d})),!p});return{participantId:c.participantId,collectionAssignments:u}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function YOe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===Qn&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Cn({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...se}}function gx({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ce({result:{error:Qe},stack:n});if(!e||!t)return ce({result:{error:Wt},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return ce({result:{error:An},stack:n});if(s?.participantType&&![pr,hc].includes(s.participantType))return ce({context:{participantType:s.participantType},result:{error:Td},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==Li);if(o.length)return ce({result:{error:bl,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&TO({individualParticipantIds:c,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=pc();if(u.includes(Is)){let d=a.find(({participantId:p})=>p===e);bi({topic:Is,payload:{participants:[d]}})}return YOe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Tt(s,!1,!0),added:c.length,...se}}function vx(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:Qe};if(!s)return{error:BI};if(!s.participantId)return Ip({tournamentRecord:n,participant:s});let{participant:o}=Bg({participantId:s.participantId,tournamentRecord:n});if(!o)return Ip({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:Rre};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),u&&jr(u)&&(v.participantOtherName=u),d&&jr(d)&&(v.participantName=d),Array.isArray(c)){let{participants:y}=cn({participantFilters:{participantTypes:[Li]},tournamentRecord:n}),b=y?.map(xi);if(b){let I=c.filter(w=>jr(w)&&b.includes(w));([hc,_r].includes(h||o.participantType)||h===Di&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===rT.PAIR&&e&&(v.participantName=KOe({individualParticipants:y,newValues:v}))}}return Object.keys(jg).includes(p)&&(v.participantRole=p),Object.keys(rT).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===rT.INDIVIDUAL&&g&&ZOe({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Lt(v)),i&&gx({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),bi({topic:Is,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Tt(o),...se}}function KOe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function ZOe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=r;d&&Object.keys(_p).includes(d)&&(n.sex=d);let p;if(jr(l)&&(n.personId=l),o&&jr(o)&&(XOe(o)||o==="")&&(n.nationalityCode=o),a&&typeof jr(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof jr(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let h=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=h}c&&el(c)&&(n.birthdate=c),u&&jr(u)&&(n.tennisId=u),Object.assign(e.person,n)}function XOe(t){return tg.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function xA(t){let e=GW(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return ce({result:{error:na},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ce({result:{error:lH},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if(c?.sides?.flatMap(F=>F.participant?.individualParticipantIds||F.participant?.participantId||[])?.includes(s))return ce({result:{...se},stack:i});r=r??(t.sideNumber?l?.sides?.find(F=>F.sideNumber===t.sideNumber)?.participantId:void 0);let v=cn({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!v)return ce({result:{error:An},stack:i});let{appliedPolicies:y}=Qi({tournamentRecord:n,drawDefinition:a,event:o}),b=t.policyDefinitions?.[Fa]??y?.[Fa]??KU[Fa];if((t.enforceGender??b?.participants?.enforceGender)!==!1&&hp(c?.gender)&&Ms(c?.gender)!==Ms(v.person?.sex))return{error:FI,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:w}=v;if(kn(Ir)(f)&&w!==Li)return{error:Td};let T=w===Li?[s]:I,S=r&&p?.find(({participantId:F})=>F===r)||p?.find(({individualParticipantIds:F})=>ho(T,F));if(!S)return{error:yH};if(r||(r=S.participantId),!r)return{error:An};let D=u?.find(F=>F.participantId===S?.participantId)?.drawPosition,C=m?.sides?.find(F=>F.participantId===r)?.sideNumber,E=c?.sides?.find(F=>D&&F.drawPosition===D)?.sideNumber,P=C??E??t.sideNumber;if(!g)return{error:_U};if(!g.collectionDefinitions?.find(F=>F.collectionId===h))return{error:Ire};X1({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=m?.sides?.find(F=>F.sideNumber===P),M=c?.sides?.find(F=>F.sideNumber===P),A=(R?.lineUp??ey({participantId:r,drawDefinition:a})?.lineUp)?.filter(F=>F.collectionAssignments?.find(j=>j.collectionPosition===d&&j.collectionId===h&&!j.previousParticipantId))?.map(F=>F?.participantId),N=A?.length>1&&A||(w===Di?v.individualParticipantIds:[s]),k=Iue({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:h});if(k.error)return ce({result:k,stack:i});let{modifiedLineUp:x}=k,O;if(f===fr){if(w!==Di){let F=j2({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return ce({result:F,stack:i});if(F=V({side:M}),F.error)return F;O=F.deletedParticipantId,R&&(R.lineUp=x),m&&Gi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(w===Di)for(let F of N)j2({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:F,collectionId:h,tieFormat:g})}else{let F=j2({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return F}if(R&&(R.lineUp=x),m&&Gi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),O){let{error:F}=rw({participantIds:[O],tournamentRecord:n});F&&console.log("cleanup")}return{...se,modifiedLineUp:x};function V({side:F}){let j;if(F.participant){let q=F.participant.individualParticipantIds||[];if(q.filter(Boolean).length===1){let{participant:W}=Gu({participantIds:q,tournamentRecord:n});q.push(s);let{participant:z}=Gu({participantIds:q,tournamentRecord:n});if(!z&&W){W.individualParticipantIds=q;let H=vx({pairOverride:!0,tournamentRecord:n,participant:W});if(H.error)return H}else j=W?.participantId}}else{let q=Ip({participant:{individualParticipantIds:[s],participantRole:ms,participantType:Di},pairOverride:!0,tournamentRecord:n});if(q.error)return q}return{...se,deletedParticipantId:j}}}function j2({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=ey({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(u=>u?.participantId===n),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let u={collectionAssignments:[c],participantId:n};r.push(u)}return aw({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function wue(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ce({result:{error:na},stack:a});let s=GW(t);if(s.error)return s;let{appliedPolicies:o}=Qi({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Fa]??o?.[Fa]??KU[Fa])?.processCodes?.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=s;if(!g)return ce({result:{error:Mo},stack:a});let b=u?.sides?.find(P=>P.participant?.participantId===r||P.participant?.individualParticipantIds?.includes(r));if(!b)return ce({result:{error:An},stack:a});let I=t.policyDefinitions?.[Bc]??o?.[Bc];if(!b.substitutions?.length&&(sa({score:u?.score})||u?.winningSide)&&I?.requireParticipantsForScoring!==!1)return ce({result:{error:rne},stack:a});let w=c?.sides?.find(({sideNumber:P})=>P===b.sideNumber)?.participantId;if(!w)return ce({result:{error:An},stack:a});let T=cn({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!T)return ce({result:{error:An},stack:a});if(m===Ir&&T.participantType===Di)return ce({result:{error:FI},stack:a});let S=T.participantType===Li?[r]:T.individualParticipantIds;X1({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let D=g.sides?.find(({sideNumber:P})=>P===b.sideNumber);if(!D&&(g.sides?.filter(({lineUp:P})=>!P).length||0)<2){let P=h?.map(({participantId:R})=>({drawPosition:d?.find(M=>M.participantId===R)?.drawPosition,teamParticipantId:R}));D=g.sides?.find(R=>P?.find(({drawPosition:M})=>M===R.drawPosition)?.teamParticipantId===w)}if(!D)return ce({result:{error:An,context:{participantId:r}}});let{modifiedLineUp:C,previousParticipantIds:E}=Iue({collectionPosition:p,teamParticipantId:w,dualMatchUpSide:D,participantIds:S,drawDefinition:i,collectionId:f});if(D.lineUp=C,w&&y&&aw({participantId:w,lineUp:C,drawDefinition:i,tieFormat:y}),m===fr&&T.participantType===Li){let P=u?.sides?.find(A=>A.sideNumber===D?.sideNumber),{participantId:R}=P??{},M=R&&cn({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(M){let A=M?.individualParticipantIds?.filter(N=>N!==r)??[];if(E&&A.push(...E),A.length>2)return ce({result:{error:bl},stack:a});if(M.draws?.length){if(A.length===1){let{participant:N}=Gu({participantIds:A,tournamentRecord:e});if(!N){let k=Ip({participant:{participantRole:ms,individualParticipantIds:A,participantType:Di},pairOverride:!0,tournamentRecord:e});if(k.error)return ce({result:k,stack:a})}}}else if(A.length){M.individualParticipantIds=A;let N=vx({participant:M,pairOverride:!0,tournamentRecord:e});if(N.error)return ce({result:N,stack:a})}else{let N=rw({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return ce({result:{error:An},stack:a})}if(b.substitutions?.length===1&&!u?.sides?.find(P=>P.sideNumber!==b.sideNumber)?.substitutions?.length&&v?.processCodes?.length){for(let P of l||[]){let R=v.processCodes.lastIndexOf(P);v.processCodes.splice(R,1)}Gi({tournamentId:e?.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Gi({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...se,modifiedLineUp:C}}function zW(t){let e=jt(t,[{[da]:!0,[$s]:!0,[kp]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:be,sideNumber:r};let{matchUp:s,structure:o}=Hr({drawDefinition:i,matchUpId:n,event:a});return s?Ao({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Gi({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...se}):{error:JG}:{error:Os}}function JOe({matchUpStatuses:t=["BYE",xr,yr],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((u,d)=>!u||d.roundNumber>u.roundNumber?d:u,void 0),a=n?.drawPositions?.find(u=>u!==i),s=r.filter(u=>u?.drawPositions?.includes(a)).map(u=>u.matchUpStatus),o=r.filter(u=>u?.drawPositions?.includes(i)).map(u=>u.matchUpStatus),l=ho(s||[],t),c=ho(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:o}}function QOe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=si({drawDefinition:a,structureId:s});if(d?.structureType===wo)return{...se};c=c??is({drawDefinition:a});let p=(c?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:h}=cI({drawPosition:i,matchUps:p}),f=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==h&&g.drawPositions?.includes(i)),{positionAssignments:m}=Sr({drawDefinition:a,structureId:s});for(let g of f??[])exe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:g,event:u});return{...se}}function exe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){let d="removeSubsequentDrawPosition";if(o){let h=t.find(({matchUpId:m})=>c.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,f=c.sides?.find(m=>m.sideNumber===h);f&&delete f.lineUp}c.drawPositions=(c.drawPositions||[]).map(h=>h===r?void 0:h).filter(Boolean);let p=e.filter(({drawPosition:h})=>c.drawPositions?.includes(h)).filter(h=>h.bye).length;return c.matchUpStatus=p&&"BYE"||As(c.matchUpStatus)&&c.matchUpStatus||Dn,As(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Kse({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Gi({tournamentId:n?.tournamentId,eventId:u?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:c}),{...se}}function sD(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Ao({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:r1};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:w}}=l,T=np({...t,matchUpStatus:a||Dn,removeWinningSide:!0});if(T.error)return T;let S;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(S=ym({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:r,drawDefinition:n,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...se}}if(h)return{...se};let{matchUps:D}=rr({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:u}),{positionAssignments:C}=aa({structure:u}),E=m-1,P=1-E,R=f[E],M=f[P],{winnerParticipantId:A,loserParticipantId:N}=C?.reduce((x,O)=>(O.drawPosition===M&&(x.loserParticipantId=O.participantId),O.drawPosition===R&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},k=D.filter(x=>x.drawPositions?.includes(M));if(I&&Sue({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:x}=JOe({drawPositionMatchUps:k,loserDrawPosition:M,sourceMatchUps:D}),O=g.linkCondition===gp;if(x&&O){let F=Math.min(...b.drawPositions);MV({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:s,event:d})}let V=txe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if(V.error)return V}if(w){let x=Math.min(...w.drawPositions);MV({targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}return{...se,...S&&{tieMatchUpResult:S}}}function Sue({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:g}=si({drawDefinition:o,structureId:m});if(!g)return{error:Qr};let{positionAssignments:v}=aa({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(S=>S.participantId!==r);let y=v?.find(S=>S.participantId===r)?.drawPosition,{matchUps:b}=rr({drawDefinition:o,structure:g,event:d}),I=b.map(S=>S.drawPositions).flat(1/0).filter(Boolean),w=Ul(I);if((y?w[y]:void 0)===1)v?.forEach(S=>{S.participantId===r&&delete S.participantId});else{let S=b.filter(({drawPositions:D})=>D.includes(y));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:S,winnerTargetLink:a})}let T=c?.drawMatchUps?.find(({matchUpId:S})=>S===l.matchUpId);T&&Gi({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:T,context:f,drawDefinition:o})}return h&&QOe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...se}}function txe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){let u="removeDirectedLoser",d=r.target.structureId,{structure:p}=si({drawDefinition:a,structureId:d});if(!p)return{error:Qr};let{positionAssignments:h}=aa({structure:p}),f=h?.find(m=>m.participantId===e)?.drawPosition;if(h?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);m.matchUpStatusCodes=t===on?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0),g=o?.drawMatchUps?.find(({matchUpId:y})=>y===s.matchUpId),v=g?.sides?.[m];v&&(delete v.lineUp,Gi({tournamentId:i?.tournamentId,eventId:c?.eventId,matchUp:g,context:u,drawDefinition:a}))}return{...se}}function MV({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Il({color:"brightyellow",method:l,drawPosition:r});let c=F1({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return ce({result:c,stack:l})}function ixe(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&Bs(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function rxe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return ce({result:{error:AU},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=aa({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Gi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...se}):ce({result:{error:bre},info:"matchUp does not include BYE",stack:n})}function HE(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===wo)return ce({result:{...se},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u,m=As(p?.matchUpStatus)&&!p.sides?.map(v=>v.participantId??v.participant).filter(Boolean).length,g=p?.matchUpStatus===on;if(p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:v}=d;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let y=Tue({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:v,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return ce({result:y,stack:l})}else if(!g){let{feedRound:y,drawPositions:b,matchUpId:I}=p,w=y?2:2-b.indexOf(f);w=m?p.winningSide:w;let T=oK({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:c,matchUpId:I});if(T.error)return ce({result:T,stack:l})}}if(h){let v=oK({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(v.error)return ce({result:v,stack:l})}return ce({result:{...se},stack:l})}function oK(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:H})=>H===a.structureId),l=t.matchUpStatus===ia?ia:on,c=t.matchUpStatus===ia?yr:xr,u="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(H=>H.matchUpId===a.matchUpId);if(!d)return{error:Mo};let p=n?.drawPositions||[],h=d.drawPositions?.filter(Boolean),f=n?.structureId===a.structureId;if(f&&ho(p,h)&&(h=h.filter(H=>!p.includes(H))),f&&h.length>1)return ce({result:{error:vT},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=Wse(t),v=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:w,loserMatchUp:T}=y;if(T){let{loserTargetLink:H}=b,Z=Tue({loserTargetDrawPosition:I,loserMatchUp:T,tournamentRecord:i,loserTargetLink:H,drawDefinition:r,matchUpsMap:s});if(Z.error)return ce({result:Z,stack:u})}let S=d.drawPositions?.filter(Boolean)||[],D=S.length===1,C=t.walkoverWinningSide||D&&vN({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=As(d.matchUpStatus)&&!S.length,P=d.finishingRound===1,R=E&&!P?l:c,M=e.find(H=>H.matchUpId===g.matchUpId),A=[],N;n&&(n?.structureId===M?.structureId?n.roundPosition<g?.roundPosition?N=1:N=2:a.feedRound?n.structureId===a.structureId?N=2:N=1:C&&(N=3-C));let k=t.matchUpStatus,x=g?.matchUpStatus;N===1?A=[{matchUpStatus:IM(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:IM(x),previousMatchUpStatus:x,sideNumber:2}]:N===2&&(A=[{matchUpStatus:IM(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:IM(k),previousMatchUpStatus:k,sideNumber:2}]),A.length&&(A=A.map(H=>Lt(H)));let O=np({...t,winningSide:C,matchUp:d,matchUpStatusCodes:A,matchUpStatus:R});if(O.error)return ce({result:O,stack:u});if(E)return HE({...t,matchUpStatus:R,targetData:v});if(!w)return ce({result:{...se},stack:u});let V=h.length===2?h[C-1]:h[0],{positionAssignments:F}=Sr({structure:o}),j=F?.find(H=>H.drawPosition===V),q=s.drawMatchUps.find(H=>H.matchUpId===w.matchUpId),W=q?.drawPositions?.filter(Boolean),z=W.length===1;if(V){if(j?.bye){let H=mo({matchUpId:q.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(z){let Z=W.filter(Boolean)[0],J=vN({drawPosition:Z,matchUpId:q.matchUpId,inContextDrawMatchUps:e}),ie=np({appliedPolicies:t.appliedPolicies,matchUpId:q.matchUpId,matchUp:q,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:J});return ie.error?ce({result:ie,stack:u}):Lz({drawPositionToAdvance:Z,matchUpId:q.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(As(w.matchUpStatus)){let Z=HE({...t,matchUpId:q.matchUpId,matchUpStatus:R,targetData:H});if(Z.error)return ce({result:Z,stack:u})}return ce({result:{...se},stack:u})}return Ob({matchUpId:w.matchUpId,drawPosition:V,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!q)return{error:Mo};if(z){let J=W[0],ie=vN({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:J});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let H=As(q.matchUpStatus)?c:l,Z=np({matchUpId:q.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:q,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:H});if(Z.error)return ce({result:Z,stack:u});if(H===l){let J=HE({...t,matchUpId:a.matchUpId,matchUpStatus:H,targetData:v});if(J.error)return J}}return ce({result:{...se},stack:u})}function Tue(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:c}=si({drawDefinition:n,structureId:l});return c?mc({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:Dy}}function IM(t){return t===on?xr:t===ia?yr:t}function nxe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",c=a.winningSide,u=[on,ia].includes(r),d=x1({matchUpStatus:r}),p=uV({matchUpStatus:r}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>np({...t,removeScore:[xp,xr].includes(r),matchUpStatus:r||Dn});return h&&{error:q$}||f&&SN(t)||m&&axe(t)||c&&sD(t)||p&&g()||l&&rxe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:q$}||u&&sxe(t)||s&&SN(t)||t.propagateExitStatus&&SN(t)||ce({result:{error:AU,info:"matchUpStatus: "+r},stack:o})}function axe(t){let e=sD(t);return e.error?e:HE(t)}function sxe(t){let e=SN({...t,removeScore:!0});return e.error?e:HE(t)}function SN(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=sD(t);if(n.error)return ce({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=np({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=ym({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return ce({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return ce({result:r,stack:e})}function oxe({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Sr({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:c}=Pi({element:l,name:qf});return c?.value?.groupOrder}),{containerStructures:s}=zU({drawDefinition:t}),o=s[e.structureId];return{structureIds:qU({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>ho(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function Uue({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Xv&&_h({drawDefinition:t,structure:e})){let{structureIds:n}=oxe({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function lxe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===wu){let o=r.sides.find(({sideNumber:c})=>c!==a).participantId,l=i.find(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:u})=>u===o));if(l?.matchUpStatus===Dn){let c=mo({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!ny({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let{structure:u}=si({structureId:l.structureId,drawDefinition:n}),d=Sr({structure:u}).positionAssignments;for(let p of d||[])if(p.participantId===o){let h=r.sides.find(({sideNumber:f})=>f===a).participantId;if(p.participantId=h,u?.positionAssignments)u.positionAssignments=d;else if(u?.structures){let f=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of u.structures)m.positionAssignments?.forEach(g=>g.participantId=f[g.drawPosition])}ug({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{...se,qualifierReplaced:e}}function cxe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===wu){let o=r.sides.find(({sideNumber:u})=>u===a)?.participantId,l=i.filter(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:d,qualifier:p})=>p&&!d)),c=ml(l);if(c?.matchUpStatus===Dn){let u=mo({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!ny({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let d=c.sides.find(f=>f.qualifier&&!f.participantId)?.drawPosition,{structure:p}=si({structureId:c.structureId,drawDefinition:n});if(!p)return{error:Qr};let h=Sr({structure:p}).positionAssignments;for(let f of h||[])if(f.drawPosition===d&&!f.participantId){if(f.participantId=o,p.positionAssignments)p.positionAssignments=h;else if(p.structures){let m=Object.assign({},...(h||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(v=>v.participantId=m[v.drawPosition])}ug({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...se,qualifierPlaced:e}}function uxe(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:c,matchUp:u}=t;if(o?._disableAutoCalc&&a!==!1)return mq(t);if(u.winningSide&&u.winningSide!==l){let{connectedStructureIds:f}=Uue({drawDefinition:s,structure:c,matchUp:u});f.length&&(console.log({connectedStructureIds:f}),i=!0);let m=sD(t);if(m.error)return m}let d=Goe(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return ce({result:d,stack:e});let p,h;return t.qualifierChanging&&n?.[LP]?.autoReplaceQualifiers&&(p=lxe(t).qualifierReplaced),t.qualifierAdvancing&&n?.[LP]?.autoPlaceQualifiers&&(h=cxe(t).qualifierPlaced),ce({result:Lt({...se,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:h,context:r}),stack:e})}var TN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Due(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";Il({color:"brightyellow",method:c,matchUpId:o,iteration:l,keyColors:TN});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:h}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:v,roundPosition:y,structureName:b}=d;Il({winner:"winner",roundPosition:y,structureName:b,roundNumber:v,keyColors:TN,stage:g}),lK({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let f=u?.matchUpStatus==="BYE"&&(u?.feedRound||u?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===gp;if(f&&m){let g=e.filter(({roundNumber:b,structureId:I})=>I===s.structureId&&b===1),v=g.map(({roundPosition:b})=>b),y=Ca(v.sort(),2).find(b=>b.includes(s.roundPosition));if((g.filter(({roundPosition:b})=>y.includes(b))?.map(({matchUpStatus:b})=>b)).every(b=>[ia,on].includes(b)))return ce({result:{...se},stack:c})}if(u&&(u.matchUpStatus!=="BYE"||f)){let g=e.find(({matchUpId:S})=>S===u.matchUpId),{structure:v}=si({drawDefinition:r,structureId:g.structureId}),{stage:y,roundNumber:b,roundPosition:I,feedRound:w,structureName:T}=u;if(Il({loser:"loser",roundPosition:I,structureName:T,roundNumber:b,keyColors:TN,feedRound:w,stage:y}),i?.progression?.doubleExitPropagateBye||f)MV({drawPosition:p,targetLink:h,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let S=lK({...t,targetMatchUp:u,structure:v,iteration:l});if(S.error)return ce({result:S,stack:c})}}return ce({result:{...se},stack:c})}function lK(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,c="conditionallyRemoveDrawPosition";Il({method:c,structureName:o?.structureName,iteration:l});let u=mo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=u,p=s?.drawMatchUps.find(I=>I.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=d?.drawPositions?.filter(Boolean)?.find(I=>a.drawPositions.includes(I));else if(!n)g=Un(a?.drawPositions||[],d?.drawPositions||[])?.[0];else if(m=Yse({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[on,ia].includes(m?.matchUpStatus),h=m?.drawPositions?.filter(Boolean)||[],[...Hn,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let I=n.drawPositions||[],w=a.drawPositions?.filter(Boolean);ho(I,w)&&(w=w?.filter(T=>!I.includes(T))),g=I.concat(h).find(T=>w?.includes(T))}if(d&&g){let{stage:I,roundNumber:w,roundPosition:T,structureName:S}=d;Il({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:T,structureName:S,roundNumber:w,keyColors:TN,stage:I}),Sue({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let v=Due({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(v.error)return ce({result:v,stack:c});let y=dxe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=np({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ce({result:v,stack:c}):{...se}}function dxe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[ia,yr].includes(e?.matchUpStatus)?yr:xr:Dn}function pxe(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===wu){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:c})=>c===s));if(o&&o.matchUpStatus===Dn){let l=mo({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!ny({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:c}=si({structureId:o.structureId,drawDefinition:n}),u=Sr({structure:c}).positionAssignments;for(let d of u||[])if(d.participantId===s){if(d.participantId=void 0,c?.positionAssignments)c.positionAssignments=u;else if(c?.structures){let p=Object.assign({},...(u||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c?.structures||[])h.positionAssignments?.forEach(f=>f.participantId=p[f.drawPosition])}ug({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{qualifierRemoved:e}}function hxe(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([on,ia].includes(e?.matchUpStatus)&&![on,ia].includes(i)){let g=Due(t);if(g.error)return ce({result:g,stack:a})}let s=i===on,o=sa({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&ixe(t.inContextMatchUp),c=t.removeScore||!l&&![Cl,rl].includes(i||Cl),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!sa({score:r}),d=g=>{let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:w}=t;if(I?._disableAutoCalc&&w!==!1)return mq({...t,removeWinningSide:u});let{connectedStructureIds:T}=Uue({drawDefinition:b,structure:y,matchUp:e});T.length&&(console.log({connectedStructureIds:T}),v=!0),Object.assign(t,{removeScore:g});let S=sD(t);if(S.error)return S;if(t.removingQualifier&&t.appliedPolicies?.[LP]?.autoRemoveQualifiers){let D=pxe(t);return{...se,connectedStructures:v,...D}}return{...se,connectedStructures:v}};if(u&&n&&t.isCollectionMatchUp)return cK(t);let p=[xp,rl].includes(i)&&t.dualWinningSideChange,h=i&&i!==Dn,f=t.propagateExitStatus&&As(i),m=(n||p||f)&&uxe(t)||o&&d(c)||h&&nxe(t)||u&&d(c)||e&&cK({...t,removeScore:!0})||{...se};return ce({result:m,stack:a})}function cK(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=sD(t);if(r.error)return r}let i=np({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=ym({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return ce({result:i,stack:e})}function qW(t){let e=jt(t,[{[da]:!0,[$s]:!0,[kp]:!0},{homeParticipantId:!0,[Pu]:na}]);if(e.error)return e;let i=tD(t,[{[BU]:Yh,attr:{[Zk]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(u=>u?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:Sd};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:c}=t;return Ml({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:c,timeItem:{itemType:Mz,itemValue:a}})}function Eue({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Oy({timeItems:i?.timeItems||[],itemType:mO});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function Hg(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return ce({result:{error:Qs},stack:e});if(!LU(o))return ce({result:{error:vu},stack:e});if(!i){let h=Hr({drawDefinition:a,matchUpId:l});if(h.error)return ce({result:h,stack:e});i=h.matchUp}let c=Ti(o),u=QI({matchUp:i}).scheduledDate,d=c&&!u;if((Eue({matchUp:i}).timeModifiers||[])?.length){let h=Pue({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h?.error)return ce({result:h,stack:e})}let p=HI(o,!0,d);return Ml({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:XI,itemValue:p}})}function Pue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return ce({result:{error:Qs},stack:o});if(n!==void 0&&!Array.isArray(n))return ce({info:iy("timeModifiers"),result:{error:be},stack:o});if(!s){let d=Hr({drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o});s=d.matchUp}let l=Eue({matchUp:s}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...se};if(c.some(d=>sV.includes(d))){l=l.filter(p=>!sV.includes(p));let d=Hg({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ce({result:d,stack:o})}let u=n?.length?[...c,...l]:void 0;return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:mO,itemValue:u}})}function yx({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Qs};let s=t&&fp.test(t);if(t&&!s)return{error:xa};let o={itemValue:Ti(t),itemType:ZI};return Ml({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function bx({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:Qe};if(!s)return{error:Qs};let l=Hr({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==rc)return{error:il};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(u=>typeof u=="string")))return{error:be,context:{courtIds:o}};let c;if(o){let u=e||i&&{[i.tournamentId]:i},d=bm({tournamentRecords:u});if(d.error)return d;let p=d.courts?.filter(h=>o.includes(h.courtId));if(p?.length!==o.length)return{error:be,context:{courtIds:o}};c=p?.map(h=>({venueId:h.venueId,courtId:h.courtId}))}return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Ah,itemDate:a,itemValue:c}})}function oD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:Qe};if(!a)return{error:Qs};if(s){let o=Xh({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:KI,itemValue:s}})}function pw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:Qe};if(!s)return{error:Qs};if(o){let l=ew({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let c=l.venue?.venueId;oD({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:c})}return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:pg,itemDate:a,itemValue:o}})}function Jd(t,e){let i=Sne.test(t)?t:Gr(t),r=Ti(t)||Ti(e)||Du(new Date);return new Date(`${r}T${i}`).getTime()}function Ix(t){let e="addMatchUpScheduleItems",i=jt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Fo]:Ko}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:s=!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:h,schedule:f,event:m}=t,g,v;if(p)g=p.find(N=>N.matchUpId===h);else{let N=Hr({drawDefinition:u,event:m,matchUpId:h});if(N.error)return N;g=N.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:w,resumeTime:T,homeParticipantId:S,scheduledDate:D,scheduledTime:C,startTime:E,stopTime:P,timeModifiers:R,venueId:M}=f;s&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=Qu({drawDefinition:u}));let A=r?.[h]?.matchUpIds;if(f.scheduledDate&&s&&A){let N=n?.filter(k=>(k.schedule?.scheduledDate||Ti(k.schedule?.scheduledTime))&&A.includes(k.matchUpId)).map(({schedule:k})=>{let x=pA(k);return new Date(x).getTime()});if(N?.length){let k=pA(f),x=new Date(k).getTime();if(Math.max(...N)>=x){if(a)return ce({result:{error:G$},stack:e});v=G$}}}if(D!==void 0){let N=yx({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledDate:D,matchUpId:h});if(N?.error)return ce({result:N,stack:e,context:{scheduledDate:D}})}if(C!==void 0){let N=Hg({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledTime:C,matchUpId:h,matchUp:g});if(N?.error)return ce({result:N,stack:e,context:{scheduledTime:C}})}if(E!==void 0){let N=YW({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,startTime:E,event:m});if(N?.error)return ce({result:N,stack:e,context:{startTime:E}})}if(P!==void 0){let N=ZW({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,stopTime:P,event:m});if(N?.error)return ce({result:N,stack:e,context:{stopTime:P}})}if(T!==void 0){let N=XW({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,resumeTime:T,matchUpId:h,event:m});if(N?.error)return ce({result:N,stack:e,context:{resumeTime:T}})}if(y!==void 0){let N=KW({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,endTime:y,event:m});if(N?.error)return ce({result:N,stack:e,context:{endTime:y}})}if(I!==void 0){let N=bx({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtIds:I});if(N?.error)return ce({result:N,stack:e,context:{courtIds:I}})}if(b!==void 0&&D!==void 0){let N=pw({courtDayDate:D,disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtId:b});if(N?.error)return ce({result:N,stack:e,context:{courtId:b}})}if(M!==void 0){let N=oD({disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,venueId:M});if(N?.error)return ce({result:N,stack:e,context:{venueId:M}})}if(w!==void 0&&fi(w)){let N=WW({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,courtOrder:w,matchUpId:h});if(N?.error)return ce({result:N,stack:e,context:{courtOrder:w}})}if(R!==void 0){let N=Pue({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,timeModifiers:R,matchUpId:h,matchUp:g});if(N?.error)return ce({result:N,stack:e,context:{timeModifiers:R}})}return jr(S)&&qW({disableNotice:!0,homeParticipantId:S,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h}),d||Gi({tournamentId:c?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:u,matchUp:g}),v?{...se,warnings:[v]}:{...se}}function WW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Qs};if(n&&!fi(n))return{error:be,info:"courtOrder must be numeric"};let s=n&&ii(n);return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:fO,itemValue:s}})}function Cue({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:Qs};if(!n)return{error:na};if(e){let l=cn({tournamentRecord:e,participantFilters:{participantTypes:[Li],participantRoles:[Vz]}}).participants??[];if(!og({tournamentParticipants:l,participantId:n}))return{error:An}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function YW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:Qs};if(!LU(a))return{error:vu};let{matchUp:o}=Hr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=QI({matchUp:o}),c=(o?.timeItems??[]).filter(u=>[kf,uh,Yf].includes(u?.itemType)).map(u=>Jd(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Jd(a,l)<c){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==ud));let u=HI(a,!0,!0);return Ml({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:ud,itemValue:u}})}else return{error:Wre}}function KW({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:Qs};if(!LU(s))return{error:vu};let{matchUp:l}=Hr({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=QI({matchUp:l}),u=(l?.timeItems??[]).filter(d=>[ud,uh,kf].includes(d?.itemType)).map(d=>Jd(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Jd(s,c)>u){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Yf));let d=HI(s,!0,!0);return Ml({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Yf,itemValue:d}})}else return{error:zre}}function ZW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:Qs};if(!LU(a))return{error:vu};let{matchUp:o}=Hr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=QI({matchUp:o}),c=o?.timeItems??[];if(c.reduce((f,m)=>m.itemType===Yf||f,void 0))return{error:fH};let u=c.filter(f=>[ud,uh,kf].includes(f?.itemType)).sort((f,m)=>Jd(f.itemValue,l)-Jd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===kf,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Jd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Jd(a,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:HI(a,!0,!0),itemType:kf};return Ml({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:f})}else return{error:qre}}function XW({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:Qs};if(!LU(n))return{error:vu};let{matchUp:o}=Hr({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=QI({matchUp:o}),c=o?.timeItems??[];if(c.reduce((f,m)=>m.itemType===Yf||f,void 0))return{error:fH};let u=c.filter(f=>[ud,uh,kf].includes(f?.itemType)).sort((f,m)=>Jd(f.itemValue,l)-Jd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===uh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Jd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Jd(n,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:HI(n,!0,!0),itemType:uh};return Ml({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:f})}else return{error:q1e}}function fxe(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=As(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&As(s.matchUpStatus));return a&&r?.matchUpStatus===on||a&&n}function mxe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){let u=Tt(n,void 0,!0);for(let p of u?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=c,!sa({score:c})&&!e?Object.assign(p,{...NO}):e&&(p.matchUpStatus=e));a=a??Ks({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=Z1({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function gxe(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(w=>w.sideNumber===i.winningSide),o=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=s,{drawPosition:u,participantId:d}=o,p="swapWinnerLoser",{matchUps:h}=rr(t),f=h.filter(({drawPositions:w,roundNumber:T})=>w?.includes(l)&&T>a);ac({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{w.drawPositions=w.drawPositions?.map(T=>T===l?u:T)||[],Gi({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:m,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:T})=>w===m&&T>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y?.target.structureId,b?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:T})=>w!==m&&I.includes(T)).forEach(({stage:w,stageSequence:T,structureId:S})=>{v.includes(S)||v.push(S),n.structures.filter(({stage:D,stageSequence:C})=>D===w&&C>T).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:T}=Sr({structure:w}),S=T?.find(({participantId:C})=>C===c),D=T?.find(({participantId:C})=>C===d);S&&(S.participantId=d),D&&(D.participantId=c)}),np({...t})}function lD(t){let e="setMatchUpStatus";t.matchUpStatus&&[xr,on].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:p,event:h,score:f}=t;if(!c)return{error:Nt};if(u&&[xp,Cl,rl,Dn].includes(u)&&d)return{error:be,winningSide:d,matchUpStatus:u};if(![void 0,...rz].includes(u))return ce({result:{error:AU},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=is({drawDefinition:c}),{matchUps:g}=zn({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,event:h}),v=m.drawMatchUps.find(W=>W.matchUpId===p),y=g?.find(W=>W.matchUpId===p);if(!v||!g)return{error:Os};if((v.winningSide||d)&&u==="BYE")return{context:"Cannot have Bye with winningSide",error:cN,matchUpStatus:u};let b=y?.structureId,{structure:I}=si({drawDefinition:c,structureId:b}),w=kn(_r)(v.matchUpType),T=y?.drawPositions?.filter(Boolean),S=y?.matchUpTieId,D=mo({matchUpId:S||p,inContextDrawMatchUps:g,drawDefinition:c});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:y,matchUpTieId:S,matchUpsMap:m,targetData:D,structure:I,matchUp:v});let C=u===Dn&&f?.scoreStringSide1===""&&f?.scoreStringSide2===""&&!d;if(fxe(t)&&C)return{error:O1e};let E=ny(t),P;if(w){if(o)ir({extension:{name:oI,value:!0},element:v});else if(l){let W=v.winningSide,{winningSide:z,scoreStringSide1:H,scoreStringSide2:Z,set:J}=Z1({drawDefinition:c,matchUpsMap:m,structure:I,matchUp:v,event:h}),ie={scoreStringSide1:H,scoreStringSide2:Z,sets:J?[J]:[]};if(P=z!==W,E&&P)return ce({stack:"winningSideWithDownstreamDependencies",result:{error:Nk},context:{winningSide:d,matchUp:v}});oo({name:oI,element:v}),Object.assign(t,{winningSide:z,dualWinningSideChange:P,projectedWinningSide:z,score:ie})}X1({tournamentId:s?.tournamentId,inContextDualMatchUp:y,eventId:h?.eventId,dualMatchUp:v,drawDefinition:c})}if(w&&u&&[qI].includes(u))return{info:"Not supported for matchUpType: TEAM",error:be};if(f&&!w&&!r){let W=v.matchUpFormat??I?.matchUpFormat??c?.matchUpFormat??h?.matchUpFormat,z=jq({existingMatchUpStatus:v.matchUpStatus,matchUpFormat:W,matchUpStatus:u,winningSide:d,score:f});if(z.error)return z}let R=Qi({policyTypes:[LP,Bc],tournamentRecord:s,drawDefinition:c,event:h})?.appliedPolicies??{};ji(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let M=yxe({assignedDrawPositions:T,propagateExitStatus:n,inContextMatchUp:y,appliedPolicies:R,drawDefinition:c,matchUpStatus:u,structure:I,matchUp:v});if(M?.error)return M;let A=y?.stage===Ht&&y.finishingRound===1,N=A&&d,k=A&&v.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&uV({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!sa({outcome:t.outcome})),x=N&&d!==v.winningSide&&v.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:x,removingQualifier:k,appliedPolicies:R}),S){let{matchUp:W}=Hr({matchUpId:S,inContext:!0,drawDefinition:c,matchUpsMap:m,event:h});if(W){let z=Ks({matchUp:W,drawDefinition:c,structure:I,event:h})?.tieFormat,{projectedWinningSide:H}=mxe({drawDefinition:c,matchUpStatus:u,dualMatchUp:W,matchUpsMap:m,winningSide:d,tieFormat:z,structure:I,matchUp:v,event:h,score:f}),Z=W.winningSide;P=H!==Z;let J=W._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:H,autoCalcDisabled:J,matchUpTieId:S,dualMatchUp:W,tieFormat:z})}}let O=x1({matchUpStatus:u});if(!S){if(E&&!d&&(u&&uV({matchUpStatus:u})||u&&[on,ia].includes(u)))return{error:cN,activeDownstream:E,winningSide:d};if(d&&d===v.winningSide&&u&&!O)return{context:"winningSide must include directing matchUpStatus",error:cN,directingMatchUpStatus:O,matchUpStatus:u}}let{schedule:V}=t;if(V){let W=Ix({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:c,matchUpId:p,schedule:V});if(W.error)return W}let F=!w&&!P&&d&&v.winningSide&&v.winningSide!==d;if(i&&F&&v.roundPosition)return gxe(t);let j=d&&!S||t.projectedWinningSide;Il({activeDownstream:E,matchUpWinner:j,method:e,winningSide:d});let q=!E&&hxe(t)||j&&vxe(t)||(O||t.autoCalcDisabled)&&Rue(t)||{error:tne};return ce({result:q,stack:e})}function vxe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Rue(t):ce({stack:"winningSideWithDownstreamDependencies",result:{error:Nk},context:{winningSide:i,matchUp:e}})}function Rue(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!sa({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Dn||t.winningSide&&Sn||Cl:t.matchUpStatus||Sn,s=t.removeScore||[xp,xr].includes(a)&&![Cl,rl].includes(a),o=np({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=ym({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function yxe({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[Bc]?.requireParticipantsForScoring===!1)return{...se};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,c=o?.sides?[]:Sr({structureId:s?.structureId,drawDefinition:n}).positionAssignments,u=l&&l===2||o.collectionId&&Ao({structure:s})&&l&&l>=1||t?.length===2&&c?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[xr,yr,on].includes(a)&&l===1&&e?{...se}:a&&iz.includes(a)&&!u?ce({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:u},result:{error:AU}}):{...se}}function Mue({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:Nt};let{matchUp:n}=Hr({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==rc?{error:il}:lD({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function Nue({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Nt};if(!i)return{error:Qs};let{matchUp:r}=Hr({drawDefinition:t,event:e,matchUpId:i});return r?oo({name:iO,element:r}):{error:Os}}function bxe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:Nt};if(!a)return{error:Qs};if(!e||!t)return ce({result:{error:na},stack:o});let{matchUp:l}=Hr({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:Os};if(!l.collectionId)return ce({result:{error:il},stack:o});let c=is({drawDefinition:r}),{matchUps:u}=zn({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:c}),d=u?.find(h=>h.matchUpId===a),p=u?.find(h=>h.matchUpId===d?.matchUpTieId)?.sides?.find(h=>h.participant.individualParticipants.some(({participantId:f})=>f===e));return!p||n&&p.sideNumber!==n?{error:Sd}:p.participant?.individualParticipants?.map(xi).filter(h=>h!==e)?.includes(t)?HW({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):ce({result:{error:Sd},stack:o})}function Aue(t){return bxe(t)}function _ue({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Nt};let{matchUp:r}=Hr({drawDefinition:t,matchUpId:e,event:i});return ir({extension:{name:oI,value:!0},element:r})}function kue(t){let e="setMatchUpFormat",i=jt(t,[{tournamentRecord:!0},{[ds]:w=>Dl({matchUpFormat:w}),[sc]:a1,matchUpFormat:!0}]);if(i.error)return ce({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return ce({result:{error:be,scheduledDates:a},stack:e});if(c&&!Uk([mp,Fc],c))return ce({result:{error:Th},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v?.length)&&!n)return ce({result:{error:Nt},stack:e});if(h&&u&&n){let w=qq({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:u});if(w.error)return w;g+=1}let I=w=>{let T=[];for(let S of w.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||v?.length&&!v.includes(S.structureId))continue;v?.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,T.push(S.structureId),g+=1);let D=((m||a)&&rr({matchUpFilters:{matchUpStatuses:[Dn]},structure:S}).matchUps)??[],C=(a&&rr({matchUpFilters:{matchUpStatuses:[Dn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(D?.length){let E=C?C.map(Ea):D.map(Ea);for(let P of D)E.includes(P.matchUpId)&&(P.matchUpFormat=a?.length?o:void 0,Gi({tournamentId:r?.tournamentId,eventId:f?.eventId,context:e,drawDefinition:w,matchUp:P}))}}return!T.length&&w.matchUpFormat!==o&&(w.matchUpFormat=o,g+=1),T};for(let w of r?.events||[])if(!(y?.length&&!y.includes(w.eventId)||c&&c!==w.eventType||c===Qn))if(Array.isArray(s)||Array.isArray(p)||v?.length||b?.length)for(let T of w.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(T.drawId))continue;let S=I(T);Pr({structureIds:S,drawDefinition:T})}else w.matchUpFormat!==o&&(w.matchUpFormat=o,g+=1);return g?{...se,modificationsCount:g}:{...se,info:xU}}function JW({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:Nt};let a=Hr({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:il};let s=Hr({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let c=s?.tieFormat,u=l.participantId;c&&u&&aw({drawDefinition:i,participantId:u,lineUp:[],tieFormat:c})}Gi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...se,modificationsCount:o}}function Oue(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=ph({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=ph({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=ph({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),u=o===c?l:o;return r&&(o=r===1?c:u,l=r===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function Ixe({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let c="progressExitStatus";Il({matchUpId:s?.matchUpId,matchUpStatus:i,color:"magenta",method:c});let u=As(i)&&i!==Ia&&i||xr,d=zn({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=u,h=d?.find(f=>f.matchUpId===s?.matchUpId);if(h?.matchUpId&&p){let f,m=h.matchUpStatusCodes?.map(y=>typeof y=="string"?y:"WO")??[],g=h.sides?.find(y=>y.participantId===r);if(g?.sideNumber)if(h?.sides?.reduce((y,b)=>b?.participantId?y+1:y,0)===1&&m.length===0)f=g.sideNumber===1?2:1,m[0]=t[0];else if(!As(s.matchUpStatus))f=g.sideNumber===1?2:1,m[0]=t[0];else{let y=m[0];m[g.sideNumber-1]=t[0];let b=g.sideNumber===1?2:1;m[b-1]=y,p=on,f=void 0}let v=lD({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:f,event:l});return ce({result:v,stack:c,context:{progressExitStatus:!0}})}return ce({result:{error:Mo},stack:c})}function pR(t){let e=jt(t,[{[kp]:!0,[$s]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=qc(t);if(!t.drawDefinition){let w=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=w);let T=_o({eventId:t.eventId,drawId:t.drawId,tournamentRecord:w});if(T.error)return T;T.drawDefinition&&(t.drawDefinition=T.drawDefinition),t.event=T.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpId:d,schedule:p,event:h,notes:f}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=Ay({policyType:Bc,tournamentRecord:o,event:h}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:b}=t;if(y?.winningSide&&![1,2].includes(y.winningSide))return{error:Rk};if(m){let w=qq({tournamentRecord:o,drawDefinition:u,matchUpFormat:m,matchUpId:d,event:h});if(w.error)return w}if(y?.score?.sets&&!y.score.scoreStringSide1){let{score:w}=Oue({...y,setTBlast:b});y.score=w,y.score.sets=y.score.sets.filter(T=>T.side1Score||T.side2Score||T.side1TiebreakScore||T.side2TiebreakScore)}let I=lD({matchUpStatusCodes:y?.matchUpStatusCodes,matchUpStatus:y?.matchUpStatus,winningSide:y?.winningSide,allowChangePropagation:v,disableScoreValidation:n,score:y?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpFormat:m,matchUpId:d,schedule:p,event:h,notes:f});if(I.context?.progressExitStatus){let w=!0,T=0;for(;w&&T<10;){w=!1,T+=1;let S=Ixe({sourceMatchUpStatusCodes:I.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:I.context.sourceMatchUpStatus,loserParticipantId:I.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:I.context.loserMatchUp,matchUpsMap:I.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});S.context?.loserMatchUp&&(Object.assign(I.context,S.context),w=!0)}}return ce({result:I,stack:i})}function xue(t){if(!t?.outcomes)return{error:Wt};if(!Array.isArray(t.outcomes))return{error:Wt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:Qe};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=wxe({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...se}}function wxe(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=_o({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:c}=l,u=o?.drawDefinitions?.find(d=>d.drawId===c);if(u&&c){let{matchUpFormat:d,matchUpId:p}=l,h=pR({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:u,matchUpFormat:d,matchUpId:p,outcome:l,drawId:c,event:o});if(h.error)return h}}}return{...se}}function Sxe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:Nt};if(!i)return{error:Wt,info:"missing outcome"};if(!r&&!e)return{error:Mo};if(!r){let n=Hr({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:be}:ir({element:r,extension:{name:iO,value:i}})}function Lue(t){return Sxe(t)}function QW(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=jt(t,[{[da]:!0,[kp]:!0}],e);if(a.error)return a;let s=tD(t,[{[BU]:Yh}]);if(s[Pu])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:c}=s?.matchUp??{};if(!l?.tieMatchUps)return ce({result:{error:il},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...se};let u=Ks({structure:c,drawDefinition:i,event:r})?.tieFormat;if(!u)return ce({result:{error:ja},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let m of u.collectionDefinitions){let{matchUpCount:g,collectionId:v}=m;p.push(v);let y=(l.tieMatchUps||[]).filter(b=>b.collectionId===v);if(y.length>g)y.sort((b,I)=>(b.matchUpStatus===Dn?1:0)-(I.matchUpStatus===Dn?1:0)),h.push(...y.slice(0,g)),d.push(...y.slice(3).map(Ea));else if(h.push(...y),y.length<g){let b=g-y.length,I=W1({collectionDefinition:m,matchUpsLimit:b,matchUp:l,uuids:n});f.push(...I)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return f.length&&(h.push(...f),cg({eventId:r?.eventId,matchUps:f,drawDefinition:i,tournamentId:o})),d.length&&Zh({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,Gi({structureId:c?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...se,newMatchUps:f,deletedMatchUpIds:d}}function e3(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ce({result:{error:Nt},stack:a});if(!r)return ce({result:{error:Qs},stack:a});if(!jr(r))return ce({result:{error:be,matchUpId:r},stack:a});let s=is({drawDefinition:i}),{matchUps:o}=zn({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),c=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:Os};if(l.matchUpType!==El)return{error:il};let u=mo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=c?.structureId,{structure:p}=si({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:c,matchUpsMap:s,targetData:u,structure:p,matchUp:l}),ny(t))return{error:Nk};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let g=lD({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return ce({result:g,stack:a})}let h=Qi({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,f=ym({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(f.error)return ce({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let m=Ks({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:g,descendantDifferences:v,ancestorDifferences:y,valueDifference:b}=Kf({descendant:l.tieFormat,ancestor:m});if(v.collectionIds.length===1&&!y.collectionIds.length&&!y.groupsCount&&g===1&&b===1){let I=QW({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(I.error)return I}}}return{...se}}function Fue(t){let e=jt(t,[{[$s]:!0,[mm]:!0},{[ET]:{[v1]:!1,roundNumbers:!1},[Uae]:"At least one must be provided",[Fo]:Cs}]);if(e.error)return e;let i=Zoe(t);if(i.error)return i;let{matchUpIds:r}=i,n=kn(El)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let u=e3({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&JW({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=lD({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=zW({...t,matchUpId:l});if(u.error)return u}}return{...se}}function Txe({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:Nt};let r="setOrderOfFinish";if(!Array.isArray(i))return ce({info:iy("finishingOrder"),result:{error:be},stack:r});let{completedMatchUps:n,matchUpsMap:a}=WU({inContext:!0,drawDefinition:e}),s=n?.map(Ea)??[],o=i.map(Ea),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(n??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:w,roundNumber:T,structureId:S}=b;return y.matchUpTypes.includes(w)||y.matchUpTypes.push(w),y.roundNumbers.includes(T)||y.roundNumbers.push(T),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return ce({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:be},stack:r});let p,h,f={},m=[],g=[];if(!i.every(({orderOfFinish:y,matchUpId:b})=>(m.push(b),y&&g.push(y),f[b]=y,p=s.includes(b),h=y===void 0||fi(y)&&Math.floor(y)>0,p&&h)))return ce({result:{error:p?be:AU},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n?.filter(y=>y.structureId===u[0]&&y.roundNumber===c[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:b}=y||{};if(b){if(!fi(b))return ce({context:{orderOfFinish:b,matchUp:y},result:{error:be},stack:r});g.push(b)}}if(Hie(g).length!==g.length||Math.max(...g)>g.length)return ce({info:"Values not unique or greater than expected number of values",result:{error:be},stack:r});if(u.length){let y=wO({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:a});if(y.error)return ce({result:y,stack:r});y.completedMatchUps?.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Gi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...se}}function Bue(t){return Txe(t)}function $ue(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=jt(t,[{[da]:!0,[$s]:!0,[kp]:!0},{lineUps:!0,[Fo]:Cs}],s);if(o.error)return o;let l=e.participants||[],c=Hr({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(c.error)return c;if(!c.matchUp)return{error:Os};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:h}=u;if(h!==_r)return{error:il};if(!p?.length)return{error:r1};let f=Ks({matchUp:u,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let v of n){if(!Array.isArray(v))return{error:be,lineUp:v};let y={},b=[];for(let D of v){if(typeof D!="object")return{error:be,lineUpAssignment:D};let{participantId:C,collectionAssignments:E=[]}=D;if(!Array.isArray(E))return{error:be,collectionAssignments:E};let P=l.find(M=>M.participantId===C);if(!P)return{error:An};if(P.participantType!==Li)return{error:Td};let R=u.sides?.find(M=>M.participant?.individualParticipantIds?.includes(C))?.sideNumber;R&&b.push(R);for(let M of E){if(typeof M!="object")return{error:be,collectionAssignment:M};let{collectionId:A,collectionPosition:N}=M,k=f?.collectionDefinitions?.find(V=>V.collectionId===A);if(!k)return{error:be,collectionId:A};let x=`${A}-${N}`;y[x]||(y[x]=[]);let O=y[x].length;if(kn(Ir)(k.matchUpType)&&O||k.matchUpType===fr&&O>1)return{info:"Excessive collectionPosition assignments",error:be};y[x].push(C)}}let I=Object.values(y);for(let D of I)if(D.length===2){let{participant:C}=Gu({tournamentParticipants:l,participantIds:D});if(!C){let E=Ip({participant:{participantType:Di,participantRole:ms,individualParticipantIds:D},pairOverride:!0,tournamentRecord:e});if(E.error)return E}}let w=Ul(b),T=(w[1]||0)>(w[2]||0)&&1||(w[2]||0)>(w[1]||0)&&2||void 0,S=Object.keys(m).map(D=>parseInt(D));T&&!S.includes(T)&&(m[T]=v)}if(!Object.keys(m).length)return{error:bH};if(c=Hr({drawDefinition:i,matchUpId:r}),c.error)return c;if(!c.matchUp)return{error:Os};let{matchUp:g}=c;g.sides||(g.sides=[]);for(let v of[1,2]){let y=g.sides.find(I=>I.sideNumber===v),b=m[v];if(b)y?y.lineUp=b:g.sides.push({lineUp:b,sideNumber:v});else continue}return Gi({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...se}}var wx={};Ai(wx,{anonymizeTournamentRecord:()=>cde,generate:()=>Vue,generateEventWithDraw:()=>Ex,generateOutcome:()=>l3,generateOutcomeFromScoreString:()=>t3,generateParticipants:()=>cD,generateTournamentRecord:()=>ode,modifyTournamentRecord:()=>ude,mutate:()=>lde});var Vue={};Ai(Vue,{generateEventWithDraw:()=>Ex,generateOutcome:()=>l3,generateOutcomeFromScoreString:()=>t3,generateParticipants:()=>cD,generateTournamentRecord:()=>ode});function t3(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a}=t;if(!n)return{outcome:{...NO,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:be,winningSide:r};let s=n&&_A({scoreString:n,matchUpFormat:e}),o=n?.trim().startsWith("["),l=r;if(!l&&e&&s){let p={side1:0,side2:0};s.forEach(h=>{h.winningSide===1?p.side1++:h.winningSide===2&&p.side2++}),p.side1>p.side2?l=1:p.side2>p.side1&&(l=2)}let c={},u=ph({sets:s,matchUpFormat:e,setTBlast:a}),d=ph({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return o?(c.scoreStringSide1=u,c.scoreStringSide2=d):l===2?(c.scoreStringSide1=d,c.scoreStringSide2=u):(c.scoreStringSide1=u,c.scoreStringSide2=d),c.sets=_A({scoreString:c.scoreStringSide1,matchUpFormat:e}),Lt({outcome:{matchUpStatus:i,winningSide:l,score:c}})}function i3({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function hR({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Uxe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function QP({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let c=Gr(l?.schedule?.endTime),u=c?Jo(c,ii(s)):Jo(o,ii(r)+ii(s)),d=i&&(c?Jo(Gr(c),i):Jo(o,ii(r)+ii(i))),p=a?.[l.matchUpId]?.participantIds||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(f=>{hR({individualParticipantProfiles:e,participantId:f});let m=e[f].priorMatchUpType!==l.matchUpType&&d||u;h.includes(f)?Uxe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:f,scheduleTime:o}):(e[f].timeAfterRecovery=m,e[f].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),kT({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:l})}function jue({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Jo(i,o),c=e?.[r]?.dependentMatchUpIds||[];if(c.length){let u=c.reduce((d,p)=>{let h=t[p];if(!h)return d;let f={scheduleTime:h,matchUpId:p};return h&&!d.matchUpId||Xi(h)<Xi(d.scheduleTime)?f:d},{});u.scheduleTime&&Xi(l)>Xi(u.scheduleTime)&&(a=u)}return{scheduledDependent:a}}function Dxe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===fr&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var fR="DO_NOT_SCHEDULE",Gue={DO_NOT_SCHEDULE:fR};function r3({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=Dxe(s).map(({person:h})=>h?.personId);if(i){let h=(s?.potentialParticipants||[]).flat().map(({person:f})=>f?.personId);o.push(...h)}let l=o.map(h=>r[h]?.map(f=>({...f,personId:h}))).filter(Boolean).flat().filter(h=>h.requestType===fR&&Uh(a,h.date)),c=[],u=s?.matchUpId,d=jn(Gr(n),Ti(a)),p=Gr(AH(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(n>m&&n<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:n}),e[f]?(e[f].scheduleTimes.includes(n)||e[f].scheduleTimes.push(n),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function NV({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=uO(i),s=(t[i.matchUpId]||[]).filter(o=>!ho(o,a)).flat();[...a,...s].forEach(o=>{if(hR({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Ru]?l[Ru]+=r:r>0&&(l[Ru]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function Exe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let g=m.schedule||{},v=m.matchUpStatus==="BYE";return v&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!v&&oR({schedule:g})&&(!c||m.schedule.scheduledDate===c)}),i=n.map(Ea));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of f){NV({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let g=m.schedule?.scheduledTime;if(g){s[m.matchUpId]=g;let v=u?.[m.matchUpId]?.recoveryMinutes;QP({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:v,scheduleTime:g,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:h}}function Sx({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:dn};if(!Kc(o)&&!Array.isArray(i))return{error:hm};a=a??fx({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=U1({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return oR({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:u?.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f?.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=vO({timingDetails:v,eventType:g}),{courtId:I,venueId:w}=p,T=Gr(p.scheduledTime),S=Jo(T,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:T,courtId:I,endTime:S,venueId:w}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function Pxe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:dn};o=o??fx({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:h,venues:f}=bm({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=h?.filter(w=>!u||u.includes(w.venueId))??[];c=c??OT({courts:m,scheduleDate:l,startTime:!0}),p=p??OT({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=Sx({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=BW(y),I=u?.length===1&&u[0]||f?.length===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v?.map(Rl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function Cxe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash,o=e,s=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function Hue({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){let m={},g=[],v=[],y=[];for(let b of f){let{rounds:I=[],venueId:w}=b,{scheduledRoundsDetails:T,greatestAverageMinutes:S,orderedMatchUpIds:D,minutesMap:C}=aR({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:I});y.push(...D??[]);let{groupedRounds:E}=Cxe({scheduledRoundsDetails:T,greatestAverageMinutes:S,garmanSinglePass:!0}),P,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:P}=Pxe({averageMatchUpMinutes:E[0]?.averageMinutes,scheduleDate:Ti(u),venueIds:[b.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let M=Exe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:P,greatestAverageMinutes:S,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:C,matchUps:p});({dateScheduledMatchUpIds:P}=M);let A=M,{byeScheduledMatchUpDetails:N,clearDate:k}=M;N?.length&&v.push(...N);let{matchUpsToSchedule:x,matchUpMap:O}=QO({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:P,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:k,matchUps:p}),V=h.filter(F=>F.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:V.length,greatestAverageMinutes:S,scheduledRoundsDetails:T,dateScheduledMatchUps:A,matchUpsToSchedule:x,scheduleTimes:R,groupedRounds:E,venueCourts:V,minutesMap:C,matchUpMap:O},o||g.push(...P)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function Rxe(t,e){let i=Xi(t.scheduleTime),r=Xi(t.timeAfterRecovery),n=Xi(e.scheduleTime),a=Xi(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return Lt({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function n3({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,c=s.every(p=>{hR({individualParticipantProfiles:t,participantId:p});let h=t[p];if(!h.timeAfterRecovery)return!0;let f=Gr(n?.schedule?.endTime),m=f?Jo(f,ii(l)):Jo(r,ii(o)+ii(l));return![...Object.keys(h.potentialBookings).filter(g=>g!==n.drawId).map(g=>h.potentialBookings[g]).flat(),...h.bookings].find(g=>Rxe({scheduleTime:r,timeAfterRecovery:m},g).hasOverlap)}),u=e[n.matchUpId],d=(u?d1(jn(u),jn(r),!1):0)>=0;return{enoughTime:c&&d}}function zue({autoSchedulingAudit:t,tournamentRecords:e}){bi({topic:_f,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,c)=>l+c.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:CV,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;Fk(_f)?bi({payload:{type:CV,tournamentId:o,detail:n},topic:_f}):J1({tournamentRecord:s,timeItem:a})}}function a3({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=uO(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=vi(n.concat(...o));return l.forEach(c=>{hR({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,Ru].find(d=>{let p=u.counters?.[d]||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function eC({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){if(!o)return{error:Qe};if(!l&&(!c||!Array.isArray(c)))return{error:xI};if(!l&&(!u||typeof u!="object"))return{error:Kre};let d,p=[],h=0;if(r&&!n){let g=Qu({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=Ha({tournamentRecord:o})?.matchUps??[]);let f=d.reduce((g,v)=>{let{matchUpId:y,drawId:b,matchUpStatus:I}=v;return(e||I!=="BYE")&&(t||!Hn.includes(I))&&(g[b]?g[b].push(y):g[b]=[y]),g},{}),m=l?.map(g=>g.matchUpId);for(let g of Object.keys(f)){let{drawDefinition:v}=Gg({tournamentRecord:o,drawId:g});if(!v)continue;let y=f[g].filter(I=>c?.includes(I)??m?.includes(I)),b=lo({inContext:!1,drawDefinition:v}).matchUps;for(let I of y){let w=l?.find(S=>S.matchUpId===I)?.schedule||u,T=Ix({schedule:w,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:v,drawMatchUps:b,matchUpId:I});if(T?.warnings?.length&&p.push(...T.warnings),T?.success&&(h+=1),T.error)return T}}return p.length?{...se,scheduled:h,warnings:p}:{...se,scheduled:h}}function mR(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!n)return eC(t);let u=jt(t,[{[xs]:!0},{[ET]:{matchUpContextIds:!1,matchUpDetails:!1},[sc]:be,[Fo]:Cs}]);if(u.error)return u;if((!l||n)&&!c)return{error:Wt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=Qu({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:m}=f,g=n?.filter(y=>y.tournamentId===m).map(Ea),v=l?.filter(y=>y?.tournamentId===m);if(g?.length||v?.length){let y=eC({matchUpDetails:v,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:f,checkChronology:o,matchUpIds:g,schedule:c});if(y.warnings?.length&&d.push(...y.warnings),y.scheduled&&(p+=y.scheduled),y.error)return y}}return d.length?{...se,scheduled:p,warnings:d}:{...se,scheduled:p}}function Mxe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){let g={},v={},y={},b={},I={},w={},T={},S={},D={},C={};for(let R of n){let M=Ti(R?.scheduleDate),A=R?.venues||[],N={},k={},x=(Z,J)=>{Z.forEach(ie=>{let K=k[ie].counters;K[J]?K[J]+=1:K[J]=1,K[Ru]?K[Ru]+=1:K[Ru]=1})};y[M]={},b[M]={},g[M]={},v[M]={},T[M]=[],S[M]=[],D[M]=[],C[M]=[];let O={};h.forEach(Z=>{Z.schedule?.scheduledDate&&Uh(M,Ti(Z.schedule.scheduledDate))&&kT({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:V,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=Hue({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:w,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:M,matchUps:h,courts:f,venues:A}),q=10,W=0,z,H=10;for(;!z;){for(let{venueId:Z}of A){let J=0,ie=F[Z];for(;ie.courtsCount&&ie.scheduleTimes?.length&&ie.matchUpsToSchedule?.length&&J<=ie.courtsCount;){let{scheduleTime:K,attempts:ne=0}=ie.scheduleTimes.shift(),le=ie.matchUpsToSchedule.find(re=>{let{matchUpId:me,matchUpType:he}=re,{participantIdsAtLimit:Ie,relevantParticipantIds:Le}=a3({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:re});if(Ie.length)return S[M].includes(me)||S[M].push(me),!1;let{scheduledDependent:ot}=jue({matchUpScheduleTimes:w,matchUpDependencies:s,scheduleTime:K,matchUpId:me,details:ie});if(ot)return!1;let{dependenciesScheduled:at,remainingDependencies:dt}=i3({matchUpScheduleTimes:w,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:re});if(!at)return b[M][me]||(b[M][me]=[]),b[M][me].push({scheduleTime:K,remainingDependencies:dt}),!1;let{enoughTime:It}=n3({individualParticipantProfiles:k,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:K,details:ie,matchUp:re});if(!It)return y[M][me]||(y[M][me]=[]),y[M][me].push({scheduleTime:K}),!1;let ze=ie.greatestAverageMinutes,{conflicts:Ct}=r3({potentials:e,averageMatchUpMinutes:ze,requestConflicts:C,personRequests:d,scheduleTime:K,scheduleDate:M,matchUp:re});if(Ct?.length)return I[M]||(I[M]=[]),I[M].push(...Ct),!1;x(Le,he);let ke=ie.minutesMap?.[me]?.recoveryMinutes;return QP({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:O,averageMatchUpMinutes:ze,matchUpDependencies:s,recoveryMinutes:ke,scheduleTime:K,matchUp:re}),w[me]=K,!0});ie.matchUpsToSchedule=ie.matchUpsToSchedule.filter(({matchUpId:re})=>re!==le?.matchUpId),le?J+=1:(v[M][Z]||(v[M][Z]=[]),v[M][Z].push({scheduleTime:K,attempts:ne+1}))}ie.matchUpsToSchedule?.length&&(v[M][Z]=v[M][Z]?.filter(K=>{let ne=K.attempts<q;return ne&&ie.scheduleTimes.push(K),!ne})),(!ie.scheduleTimes?.length||!ie.matchUpsToSchedule?.length)&&(ie.complete=!0)}W+=1,z=A.every(({venueId:Z})=>F[Z].complete)||W===H}for(let{venueId:Z}of A){let J=F[Z].matchUpMap;Object.keys(J).forEach(ie=>{let K=c[ie];K&&Object.keys(J[ie]).forEach(ne=>{let{drawDefinition:le}=Gg({tournamentRecord:K,drawId:ne});le&&J[ie][ne].forEach(({matchUpId:re})=>{let me=w[re];if(me){let he=me.split(":").map(Nc).join(":"),Ie=`${Ti(M)}T${he}`;m?T[M].push(re):(Hg({drawDefinition:le,scheduledTime:Ie,matchUpId:re}).success&&T[M].push(re),Z&&oD({tournamentRecord:K,drawDefinition:le,matchUpId:re,venueId:Z}))}})})}),D[M]=F[Z].matchUpsToSchedule.map(Ea),g[M][Z]=F[Z].scheduleTimes.sort((ie,K)=>Xi(ie.scheduleTime)-Xi(K.scheduleTime))}!m&&V?.length&&mR({matchUpDetails:V,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of R.venues)for(let J of Z.rounds){let ie=(J.matchUps?.map(({matchUpId:ne})=>ne)||[]).filter(ne=>T[M].includes(ne));J.canScheduledMatchUpIds=ie;let K=Math.round(ie.length/J.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),J.possibleToSchedulePct=K,J.matchUpsCount===ie.length&&(J.possibleToSchedule=!0)}}let E=n.map(({scheduleDate:R})=>R),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:T,schedulingProfile:u,noTimeMatchUpIds:D,requestConflicts:C,scheduledDates:E};return zue({tournamentRecords:c,autoSchedulingAudit:P}),{...se,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:S,scheduledMatchUpIds:T,noTimeMatchUpIds:D,requestConflicts:C,scheduledDates:E}}function uK({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Wt,stack:"getEarliestCourtTime"};let a=OT({scheduleDate:n,courts:[r],startTime:!0}),s=OT({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=dR({court:r,date:n}),{timeSlots:l}=aD({courtDate:o}),c=jn(e),u=jn(i);return{earliestCourtTime:l?.reduce((d,p)=>{let h=jn(p.startTime),f=jn(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(d1(m,f)>=t){let g=Gr(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function Nxe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){let g={},v={},y={},b={},I={},w={},T={},S={},D={};for(let P of n??[]){let R=Ti(P?.scheduleDate),M=P?.venues||[],A={},N={},k=(le,re)=>{le.forEach(me=>{let he=N[me].counters;he[re]?he[re]+=1:he[re]=1,he[Ru]?he[Ru]+=1:he[Ru]=1})};g[R]={},v[R]={},w[R]=[],T[R]=[],S[R]=[],D[R]=[];let x={};h?.forEach(le=>{le.schedule?.scheduledDate&&Uh(R,Ti(le.schedule.scheduledDate))&&kT({matchUpPotentialParticipantIds:A,matchUpNotBeforeTimes:x,matchUp:le})});let{allDateScheduledByeMatchUpDetails:O,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=Hue({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:R,matchUps:h,courts:f,venues:M}),q=h?.filter(({matchUpId:le})=>V.includes(le)),{bookings:W}=Sx({dateScheduledMatchUps:q,tournamentRecords:c,scheduleDate:R,periodLength:u}),{virtualCourts:z}=hx({scheduleDate:R,periodLength:u,bookings:W,courts:f}),H=z?.reduce((le,re)=>{let{earliestCourtTime:me,courtEndTime:he}=uK({date:R,averageMinutes:0,court:re});return(!le.startTime||jn(me)<jn(le.startTime))&&(le.startTime=me),(!le.endTime||jn(he)>jn(le.endTime))&&(le.endTime=he),le},{}),Z=H.startTime,J=({courtId:le,booking:re})=>z?.find(me=>me.courtId===le)?.dateAvailability[0].bookings.push(re),ie=10,K=0,ne;for(;!ne;){for(let{venueId:le}of M){let re=F[le],me=re.matchUpsToSchedule.length,he=[],Ie=[],Le,ot=0;for(;!Le;){for(let at of re.matchUpsToSchedule){if(Ie.length===re.courtsCount||he.length===re.courtsCount){Le=!0;break}let{matchUpId:dt,matchUpType:It}=at,{participantIdsAtLimit:ze,relevantParticipantIds:Ct}=a3({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:at});if(ze.length){T[R].includes(dt)||T[R].push(dt);continue}let{dependenciesScheduled:ke,remainingDependencies:mt}=i3({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:at});if(!ke){v[R][dt]||(v[R][dt]=[]),v[R][dt].push({remainingDependencies:mt});continue}let Be=[],ut=z?.reduce((it,xe)=>{if(Ie.includes(xe.courtId))return it;let{earliestCourtTime:Ze}=uK({averageMinutes:re.greatestAverageMinutes,startTime:Z,date:R,court:xe});if(it.scheduleTime&&Xi(Ze)>=Xi(it.scheduleTime))return it;let{scheduledDependent:st}=jue({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:Ze,matchUpId:dt,details:re});if(st)return it;let{enoughTime:qe}=n3({individualParticipantProfiles:N,matchUpNotBeforeTimes:x,matchUpDependencies:s,scheduleTime:Ze,details:re,matchUp:at});if(!qe)return g[R][dt]||(g[R][dt]=[]),g[R][dt].includes(Ze)||g[R][dt].push(Ze),it;let ft=re.minutesMap?.[dt]?.averageMinutes||re.greatestAverageMinutes,{conflicts:_t}=r3({potentials:e,averageMatchUpMinutes:ft,requestConflicts:D,personRequests:p,scheduleTime:Ze,scheduleDate:R,matchUp:at});if(_t?.length)return Be.push(..._t),!1;k(Ct,It);let ve=re.minutesMap?.[dt]?.recoveryMinutes;return QP({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,matchUpNotBeforeTimes:x,averageMatchUpMinutes:ft,matchUpDependencies:s,recoveryMinutes:ve,scheduleTime:Ze,matchUp:at}),(!it.scheduleTime||Xi(Ze)<Xi(it.scheduleTime))&&(it.averageMatchUpMinutes=ft,it.recoveryMinutes=ve,it.scheduleTime=Ze,it.courtName=xe.courtName,it.courtId=xe.courtId),it},{});if(ut.scheduleTime){let{averageMatchUpMinutes:it,recoveryMinutes:xe,scheduleTime:Ze,courtId:st}=ut;I[dt]=Ze,b[dt]=st,he.push(dt),Ie.push(st);let qe=Ze,ft=Jo(qe,it);J({courtId:st,booking:{averageMatchUpMinutes:it,recoveryMinutes:xe,periodLength:u,matchUpId:dt,startTime:qe,courtId:st,endTime:ft,venueId:le}}),re.matchUpsToSchedule=re.matchUpsToSchedule.filter(_t=>_t.matchUpId!==dt)}else Be?.length&&(y[R]||(y[R]=[]),y[R].push(...Be))}(Ie.length===re.courtsCount||he.length===re.courtsCount||!re.matchUpsToSchedule.length)&&(Le=!0),re.matchUpsToSchedule.length&&he<re.courtsCount&&(jn(Z)<jn(H.endTime)?Z=Jo(Z,u):(Le=!0,re.complete=!0)),ot+=1,!Le&&ot>=me&&(Le=!0)}re.matchUpsToSchedule?.length||(re.complete=!0)}K+=1,ne=M.every(({venueId:le})=>F[le].complete)||K===ie}for(let{venueId:le}of M){let re=F[le].matchUpMap;Object.keys(re).forEach(me=>{let he=c[me];he&&Object.keys(re[me]).forEach(Ie=>{let{drawDefinition:Le}=Gg({tournamentRecord:he,drawId:Ie});Le&&re[me][Ie].forEach(({matchUpId:ot})=>{let at=I[ot],dt=b[ot];if(at){let It=at.split(":").map(Nc).join(":"),ze=`${Ti(R)}T${It}`;m||(Hg({drawDefinition:Le,scheduledTime:ze,matchUpId:ot}),pw({courtDayDate:R,tournamentRecords:c,tournamentRecord:he,drawDefinition:Le,matchUpId:ot,courtId:dt})),w[R].push(ot)}})})}),S[R]=F[le].matchUpsToSchedule.map(Ea)}!m&&O?.length&&mR({matchUpDetails:O,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let le of P.venues)for(let re of le.rounds){let me=(re.matchUps??[]).map(({matchUpId:Ie})=>Ie)?.filter(Ie=>w[R].includes(Ie));re.canScheduledMatchUpIds=me;let he=Math.round((me?.length||0)/re.matchUpsCount*1e4)/100;(he===1/0||isNaN(he))&&(he=void 0),re.possibleToSchedulePct=he,re.matchUpsCount===me?.length&&(re.possibleToSchedule=!0)}}let C=(n??[]).map(({scheduleDate:P})=>P),E={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:w,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:C};return zue({tournamentRecords:c,autoSchedulingAudit:E}),{...se,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:T,scheduledMatchUpIds:w,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:C}}function Tx(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Hn,scheduledDates:r,venueIds:n}=t,a=qc(t),s=ji(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:dn};let o=0;for(let l of s){let c=a[l],u=Axe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...se,clearedScheduleCount:o}}function Axe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=Hn,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:Qe};if(!Array.isArray(e)||!Array.isArray(n))return{error:be};n.length&&t.push("venueId");let a=Ha({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&oR({schedule:u,scheduleAttributes:t})&&(!n?.length||n.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=_o({tournamentRecord:i,drawId:c}),p=lo({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=m?.itemType&&![Ah,pg,KI,fO,ZI,XI].includes(m?.itemType);return g||(f=!0),g}),f&&(Gi({context:"clear schedules",eventId:u?.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...se,clearedScheduleCount:l}}function Ux(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=jt(t,[{[xs]:!0},{[ds]:C=>!C||Array.isArray(C)&&C.every(el),[yae]:!1,[Fo]:Cs}]);if(u.error)return u;let d=Im({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...se};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>zU({tournamentRecord:C}).containedStructures)),g=n.map(C=>{if(el(C))return Ti(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>el(C)&&Ti(C)).filter(C=>C&&(!n.length||g.includes(C)));if(!v.length)return{error:Dre};if(r&&!l){let C=Array.isArray(r)?r:[];Tx({tournamentRecords:a,scheduledDates:C})}let y=bm({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Ud({matchUpFilters:{matchUpTypes:[Ir,fr]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=Qu({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:w}=lx({tournamentRecords:a}),{personRequests:T}=By({requestType:fR,tournamentRecords:a}),S=f.filter(C=>{let E=Ti(C?.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),D={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:w,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:f,personRequests:T,periodLength:s,matchUps:b,dryRun:l,courts:y};return c?Nxe(D):Mxe(D)}function Dx(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=or()),n.startDate&&!Yv(n.startDate)&&!dA.test(n.startDate)?{error:xa}:n.endDate&&!Yv(n.endDate)&&!dA.test(n.endDate)?{error:xa}:(n.extensions&&(n.extensions=n.extensions.filter(vp)),{...n})}function s3({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:Qe};let o={},l=(i.participants??[]).filter(({participantType:f,participantRole:m})=>f===Li&&m===ms),c=0;for(let f of l){let m=a&&_b({element:f,accessor:a})?.value||r&&f.person?.[r]||e&&f[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[c]??m,participantId:s?.pop()??or(),individualParticipantIds:[],participantRole:ms,participantType:pr};let g={value:r??e,name:iV};ir({element:o[m],extension:g}),c+=1}o[m].individualParticipantIds.push(f.participantId)}}let u=Object.keys(o),d=(i.participants??[]).map(f=>{if(f.participantType!==pr||f.participantRole!==ms)return;let{extension:m}=Pi({name:iV,element:f}),g=m?.value;if(u.includes(g))return f.participantId}).filter(Boolean),p=0,h=[];return Object.keys(o).forEach(f=>{let m=o[f],{participantId:g}=m;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(m),h.push(m),p++)}),t&&p?(bi({payload:{tournamentId:i.tournamentId,participants:h},topic:lg}),{...se,participantsAdded:p}):h.length?{...se,newParticipants:h}:{error:j1e}}var _xe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],kxe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function que({count:t=1,participantsCount:e=32}={}){let i=so(kxe),r=i.slice(0,t);return{cities:vt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ml(r))}}function Wue({count:t=1,participantsCount:e=32}={}){let i=so(_xe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:vt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:ml(r))}}function Yue({count:t=1,participantsCount:e=32}={}){let i=vt(0,t).map(()=>vt(0,5).map(()=>Pc(0,9)).join(""));return{postalCodes:vt(0,e).map(r=>r<t?i[r]:ml(i))}}function LA({idPrefix:t,participantType:e,index:i,uuids:r}){let n=jr(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||or()}function Kue(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var Oxe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function G2(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!hp(i))return{personData:[],error:be};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=Oxe,o=tg.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/s.length),d=vt(0,l).flatMap(()=>{let m=Tt(n,!1,!0);return vt(0,n.length).map(()=>vl(m))}),p=vt(0,c).flatMap(()=>{let m=Tt(a,!1,!0);return vt(0,a.length).map(()=>vl(m))}),h=vt(0,u).flatMap(()=>{let m=Tt(s,!1,!0);return vt(0,s.length).map(()=>vl(m))}),f={};for(let m=0;m<r;m++){let g=d.pop(),v=i||ml([Zn,us]),y=v===Zn?h.pop():p.pop(),b=ml(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function Zue(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:be};let c=a?.[Zn]||Eb(l)&&e||0,u=a?.[us]||Cv(l)&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&G2({count:c,sex:Zn}).personData||[],h=u&&G2({count:u,sex:us}).personData||[],f=[...p,...h,...d&&G2({count:d}).personData||[]],m=f.filter(D=>!l||c&&u||D.sex===l),g=[];if(Array.isArray(s)){let D=s.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![Zn,us].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!tg.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(D.length)m=D;else return{error:be}}let v=s?m:so(m);if(v.length<e){let{maleFirstNames:D,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:R}=f.reduce((M,A)=>{let{firstName:N,lastName:k,nationalityCode:x}=A;return A.sex===Zn?(M.maleFirstNames.includes(N)||M.maleFirstNames.push(N),M.maleLastNames.includes(k)||M.maleLastNames.push(k)):(M.femaleFirstNames.includes(N)||M.femaleFirstNames.push(N),M.femaleLastNames.includes(k)||M.femaleLastNames.push(k)),M.nationalityCodes.includes(x)||M.nationalityCodes.push(x),M},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});vt(0,e-v.length).forEach(()=>{let M=l||ml([Zn,us]),A=ml(R),N=ml(M===Zn?D:E),k=ml(M===Zn?C:P),x={firstName:N,lastName:k,sex:M,nationalityCode:A};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=rI({consideredDate:r,category:o}),I=ii(y?.slice(0,4)||0)||ii(b?.slice(0,4)||0)-3,w=ii(b?.slice(0,4)||0)||ii(y?.slice(0,4)||0)+3,T=(y||b)&&[I,w],S=v.slice(0,e).map((D,C)=>{let[E,P]=T||[],R=T&&vl(vt(E,P)),M=vl(vt(0,365)),A=R&&kRe(R,M);return Object.assign(Lt({extensions:i||[{name:"regionCode",value:C+1}],birthDate:A,isMock:n}),D)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var xxe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function FA({nameRoot:t="TEAM",count:e=1}={}){let i=so(xxe).slice(0,e);return i.length<e&&vt(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function cD(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Ua,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:w,personData:T,sex:S,inContext:D,withISO2:C,withIOC:E,scaleAllParticipants:P}=t,R=h===Di||w===Wv,M=h===pr||w===pr;i&&(!Array.isArray(i)||!i.every(ke=>gn(ke))||i.length!==2)&&(i=void 0),e=P?p:e;let A=1e3,N=e&&e>A?e:A;i=i||[1,N],i[1]+=1;let k=p*(R&&2||M&&(f??8)||1),x=Zue({count:k,personExtensions:y,consideredDate:s,gendersCount:I,personData:T,category:l,sex:S});if(x.error)return x;let{nationalityCodes:O,persons:V}=x,F={},j={},q={},W={},z=ke=>{Object.assign(F,ke.doublesRankings),Object.assign(j,ke.singlesRankings),Object.assign(W,ke.doublesRatings),Object.assign(q,ke.singlesRatings)};if(ji(l)){let ke=dK({scaledParticipantsCount:e,ratingsParameters:r,participantType:h,ratingsValues:a,rankingRange:i,category:l});z(ke)}Array.isArray(o)&&o.forEach(ke=>{let mt=dK({scaledParticipantsCount:e,ratingsParameters:r,participantType:h,ratingsValues:a,rankingRange:i,category:ke});z(mt)});let H=tg.filter(ke=>u==="IOC"&&ke.ioc||ke.iso);function Z(ke){let mt=Math.ceil(k/ke);return n&&mt>n?Math.ceil(k/n):ke}let{postalCodesProfile:J,postalCodesCount:ie,statesProfile:K,citiesProfile:ne,citiesCount:le,statesCount:re}=b||{},me=ke=>Object.keys(ke).map(mt=>vt(0,K[mt]).map(()=>mt)).flat(),he=ne&&me(ne)||b?.cities||que({count:le||k,participantsCount:k}).cities,Ie=K&&me(K)||b?.states||Wue({count:re||k,participantsCount:k}).states,Le=J&&me(J)||b?.postalCodes||Yue({count:ie||k,participantsCount:k}).postalCodes,ot={cities:he,states:Ie,postalCodes:Le},at=Z(c),dt=at?so(H).slice(0,c):d&&H.filter(ke=>d.includes(ke.iso))||H,It=so(vt(0,Math.ceil(k/(at||1))).map(()=>dt).flat(1/0)),ze=FA({count:p}).names;return{participants:vt(0,p).map(ke=>{let mt=R&&2||M&&(f??8)||1,Be=vt(0,mt).map(st=>{let qe=ke*mt+st;return Ct(qe)}),ut=Be.map(st=>st.participantId),it=Be.map(st=>st.person.standardFamilyName).join("/"),xe=R?Di:pr,Ze={participantId:LA({participantType:xe,index:ke,idPrefix:g,uuids:v}),participantName:R?it:ze[ke],participantRole:ms,individualParticipantIds:ut,participantType:xe};return D&&(Ze.individualParticipants=Be),R||M?[Ze,...Be]:Be}).flat(),...se};function Ct(ke){let mt=V[ke],{nationalityCode:Be,participantExtensions:ut,participantTimeItems:it,extensions:xe,firstName:Ze,birthDate:st,lastName:qe,personId:ft,sex:_t}=mt||{},ve=Ze||"GivenName",$e=qe||"FamilyName",De=`${ve} ${$e}`,je=It[ke],Oe=O?.length&&Be||je&&(u==="IOC"?je.ioc||je.iso:je.iso||je.ioc)||Be;It?.length&&!Oe&&!Be&&console.log("%c Invalid Nationality Code",{participantIndex:ke,country:je});let nt=Kue({...ot,participantIndex:ke,nationalityCode:Oe}),Fe=Lt({participantId:LA({participantType:Li,index:ke,idPrefix:g,uuids:v}),extensions:ut,timeItems:it,participantRole:ms,participantType:Li,participantName:De,person:{personId:ft||m?.length&&m[ke]||or(),birthDate:el(st)?st:void 0,addresses:[nt],standardFamilyName:$e,standardGivenName:ve,nationalityCode:Oe,extensions:xe,sex:_t}});if(E&&Oe){let pt=tg.find(({iso:Mt})=>Mt===Oe);pt?.ioc&&(Fe.person.iocNationalityCode=pt.ioc),pt?.label&&(Fe.person.countryName=pt.label)}if(C&&Oe){let pt=tg.find(({iso:Mt})=>Mt===Oe);pt?.iso2&&(Fe.person.iso2NationalityCode=pt.iso2),pt?.label&&(Fe.person.countryName=pt.label)}let wt=pt=>{let Mt=pt.categoryName||pt.ratingType||pt.ageCategoryCode,Wi=j[Mt]?.[ke],Qt=F[Mt]?.[ke];wM({scaleValue:Wi,eventType:nI,scaleType:sg,participant:Fe,category:pt}),wM({scaleValue:Qt,eventType:jf,scaleType:sg,participant:Fe,category:pt});let tr=q[Mt]?.[ke],Vi=W[Mt]?.[ke];wM({scaleValue:tr,eventType:nI,scaleType:eg,participant:Fe,category:pt}),wM({scaleValue:Vi,eventType:jf,scaleType:eg,participant:Fe,category:pt})};return Array.isArray(o)?o.forEach(pt=>wt(pt)):l&&wt(l),Fe}}function wM({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[Jv,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function dK(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=so(vt(m,g)).slice(0,i||Pc(20,30)),[Di,pr].includes(n)){let[v,y]=s||[];o[f]=so(vt(v,y)).slice(0,i||Pc(20,30))}}if(h&&r[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...r[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:w,range:T,step:S}=y,D=M=>{let A={},N=Object.keys(M||{});for(let k of N){let x=M[k];if(typeof x=="object"&&x.generator){let{range:O}=x,[V,F]=O.slice().sort();A[k]=Pc(V,F)}else A[k]=x}return A},C=T[0]>T[1]?2:.7,[E,P]=T.slice().sort(),R=vt(0,2e3).map(()=>jie(E,P,C,S,I)).filter(M=>(!m||M<=m)&&(!g||M>=g)).slice(0,i||Pc(20,30)).map(M=>w?Object.assign({},...w.map(A=>({[A]:M})),D(b)):M);c[f]=[...a,...R],[Di,pr].includes(n)&&(u[f]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function o3(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},c={[Zn]:0,[us]:0,[GI]:0,[Tf]:0,ANY:0};(ji(t.tieFormat)?t.tieFormat:Vf({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(h=>{let{category:f,collectionId:m,matchUpType:g,matchUpCount:v,gender:y}=h;if(hp(y)){let b=Ms(y),I=v*(g===fr?2:1);b&&c[b]<I&&(c[b]=I)}else ec(y)&&(c[Zn]<v&&(c[Zn]=v),c[us]<v&&(c[us]=v));if(f){let b=JSON.stringify(f);l[b]=f}if(m||(h.collectionId=or()),kn(fr)(g)){let b=v;o+=v,n=Math.max(n,b)}if(kn(Ir)(g)){let b=v;s+=v,a=Math.max(a,b)}});let u=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function Lxe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Li}=t||{},a=r||0,s={[us]:0,[GI]:0,[Tf]:0,[Zn]:0,ANY:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:w,stage:T})=>{let S=y===Fc,D=y===Qn,C=!!(m||T===Ht||I||w);if(D){u=Math.max(u,v+f),b=typeof b=="object"?b:Vf({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:R,genders:M}=o3({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,E),l=Math.max(l,R),C||(o=Math.max(o,P)),Object.keys(M).forEach(A=>s[A]+=M[A])}else if(S)if(C){let E=(v+f)*2;d+=E,w&&(s[w]+=E)}else v+f&&v+f>o&&(o=v+f);else if(C){let E=v+f;w&&(s[w]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e?.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let w of v){let{tieFormatName:T,tieFormat:S}=w;p({...w,tieFormatName:T||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,o*2,l);return o&&(n=Di),(r||a)<h&&(r=h),r&&o&&[Di,Qn].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:s}}function Xue({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...se};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=Lxe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=cD({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,h=0,f=Hu({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=s3({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Li).map(xi),g=t?.idPrefix?`${pr}-${t.idPrefix}`:void 0,v=vt(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=LA({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:ms,individualParticipantIds:b,participantType:pr,participantId:I}});return f=Hu({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...se})}function Jue({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Ut,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(c||p)-l;return u||i||e||d===Ht?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Que({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ut]||0,a=e[Ht]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var Fxe={[xr]:2,[on]:1,[ia]:1,[Ia]:1,[yr]:4};function l3(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Fxe,matchUpFormat:n=Eu,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Dl({matchUpFormat:n}))return{error:rH};if(typeof r!="object")return{error:be};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:be};let o=Object.keys(r).filter(E=>Object.keys(Kh).includes(E)&&E!==Sn);if(Object.keys(o).reduce((E,P)=>E+r[P],0)>100)return{error:be,matchUpStatusProfile:r};let l=o.reduce((E,P)=>(E.pointer=E.pointer+r[P],E.valueMap.push([E.pointer,P]),E),{pointer:0,valueMap:[]}),c=Pc(1,100),u=(l.valueMap.find(E=>c<=E[0])??[100,Sn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(As(u)){i=i||Pc(1,2);let E={score:d,matchUpStatus:u,winningSide:i};if(!(u===yr&&Pc(1,100)>100-e))return{outcome:E}}else if([on,ia].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Bs(n),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=Pc(0,1),b=i?[i-1]:[...vt(0,s).map(()=>y),1-y],I=[Ia,yr,Cl,Fg].includes(u)&&(vl(vt(1,f||h))||1),w,T=vt(1,(f??h)+1);for(let E of T){let P=E===(f??h),{set:R,incomplete:M,winningSideNumber:A}=Bxe({setFormat:P&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:E});if(v.push(R),M){w=A;break}if(JP({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let S=JP({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),D=w?i||w:S.calculatedWinningSide,{score:C}=Oue({winningSide:D,score:{sets:v},matchUpStatus:u});return{outcome:{winningSide:D,matchUpStatus:u,score:C}}}function Bxe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,h=Pc(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+vl([1,-1])*v,b=I1e(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let w=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(r){let[D,C]=I;return Object.assign(s,{side1Score:D,side2Score:C}),Hn.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}w||(I[Pc(0,1)]+=1),w=I[0]>I[1]?1:2,w!==m&&I.reverse();let[T,S]=I;return Object.assign(s,{side1Score:T,side2Score:S,winningSide:m}),{set:s}}else{if(r)return s.side1Score=Pc(0,c),s.side2Score=Pc(0,c),Hn.includes(i)&&(m=t[h]+1),{set:s,incomplete:r,winningSideNumber:m};{let g=vt(1,o+1).map(S=>vt(0,o+2-S).map(()=>S)).flat(),v=g[Pc(0,g.length-1)],y=o&&Gq({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,D]=y;Object.assign(s,{side1Score:S,side2Score:D})}let w=ZP({matchUpScoringFormat:{setFormat:n},setObject:s}),T;if(w.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:D}=l||u||{},C=vt(1,D+1).map(R=>vt(0,D+2-R).map(()=>R)).flat(),E=C[Pc(0,C.length-1)],P=zO({isSide1:!0,tiebreakNoAd:S,tiebreakTo:D,lowValue:E});if(P)if(b){let R=P[0]>P[1]?1:2;I?R!==I&&P.reverse():f&&P.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=P,T=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else w.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=P:[s.side2TiebreakScore,s.side1TiebreakScore]=P}s.winningSide=w.winningSide||w.leadingSide||I||T}}return{set:s}}function BA(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:Nt};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,c=s.structures.slice().sort(WI),u=0,{matchUps:d,matchUpsMap:p}=zn({matchUpFilters:{matchUpTypes:[_r],roundNumbers:[1]},contextFilters:{stages:[Ut,Ht]},inContext:!0,drawDefinition:s});if(d?.length){let v=o?.category?.ageCategoryCode||o?.category?.categoryName;if(v){let y=hue({singlesOnly:!0,tournamentRecord:n,drawDefinition:s,scaleAccessor:{scaleName:v,sortOrder:"ASC",scaleType:sg},event:o});if(y.error)return y;let{lineUps:b,participantsToAdd:I}=y;Hu({tournamentRecord:n,participants:I}),ir({element:s,extension:{name:Hf,value:b}})}else{let y=d[0]?.structureId,{positionAssignments:b}=Sr({drawDefinition:s,structureId:y});if(b?.length){let{participants:I}=cn({participantFilters:{participantTypes:[_r]},tournamentRecord:n}),w=T=>{let S=T.tieMatchUps.filter(kn(Ir)),D=T.tieMatchUps.filter(kn(fr));S.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(R=>{let{drawPosition:M}=R,A=I?.find(N=>{let{participantId:k}=N;return b.find(x=>x.participantId===k)?.drawPosition===M});if(A){let N=A.individualParticipantIds?.[E];N&&xA({teamParticipantId:A.participantId,participantId:N,tournamentRecord:n,drawDefinition:s,tieMatchUpId:P,event:o})}})}),D.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(R=>{let{drawPosition:M}=R,A=I?.find(N=>{let{participantId:k}=N;return b.find(x=>x.participantId===k)?.drawPosition===M});A&&A.individualParticipantIds?.slice(E*2,E*2+2)?.forEach(N=>{xA({teamParticipantId:A.participantId,participantId:N,tournamentRecord:n,drawDefinition:s,tieMatchUpId:P,event:o})})})})};d.forEach(w)}}}let h=typeof i=="string"&&i,f=h&&Sn,m=c.length===2&&c[0].finishingPosition===Xv&&Un(c.map(({stage:v})=>v),[Ut,In]).length===2,g=c.map(({structureId:v})=>v);for(let v of g){if(u>=a)break;let y=s.structures.find(w=>w.structureId===v),b=rr({contextFilters:{matchUpTypes:[fr,Ir]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}).matchUps;b.length;let I=b.filter(({winningSide:w})=>!w).sort(tw).map(Ea);for(let w of I){if(!isNaN(a)&&u>=a)break;let{matchUps:T}=rr({matchUpFilters:{matchUpTypes:[fr,Ir]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}),S=T.find(C=>C.matchUpId===w),D=[on,ia].includes(S.matchUpStatus);if(S?.readyToScore&&!D){let C=$xe({matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:s,targetMatchUp:S,matchUpFormat:l,matchUpStatus:f,scoreString:h,winningSide:!r&&1,event:o});if(C?.error)return C;u+=1}}m&&y.finishingPosition===Xv&&t.completeRoundRobinPlayoffs&&XU({structureId:y.structureId,applyPositioning:!0,drawDefinition:s})}return{...se,completedCount:u}}function ede(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=t3({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),pR({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function $xe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return ede(t);let{matchUpId:d}=o||{},{outcome:p}=l3({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return pR({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function tde({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Cn({event:s}).flightProfile,{eventName:l,eventType:c,category:u}=s,{startDate:d}=r,p=[],h=u?.categoryName||u?.ageCategoryCode||u?.ratingType,f=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,g]of o.flights.entries()){let{drawId:v,stage:y,drawName:b,drawEntries:I}=g;p.push(g.drawId);let w=n[m],{seedsCount:T,generate:S=!0}=w||{};if(S){let D=I.filter(Rl(Rh)).map(Rl(Rh)),C=h||l;if(r&&T&&T<=D.length&&vt(1,T+1).forEach((A,N)=>{let k={scaleValue:A,scaleName:C,scaleType:ch,eventType:c,scaleDate:d},x=D[N];iR({tournamentRecord:r,participantId:x,scaleItem:k})}),f?.includes(v))break;let E=cR({...w,matchUpType:c,seedingScaleName:C,tournamentRecord:r,drawEntries:I,drawName:b,drawId:v,isMock:a,event:s,stage:y});if(E.error)return{error:E.error,drawIds:[]};let{drawDefinition:P}=E;if(!P)return{error:nc};let R=n[m]?.drawExtensions;if(Array.isArray(R)&&R.filter(vp).forEach(A=>ir({element:P,extension:A})),E=uR({suppressNotifications:!0,tournamentRecord:r,drawDefinition:P,event:s}),E.error)return{error:E.error,drawIds:[]};if(w?.withPlayoffs){let A=P.structures?.[0].structureId,N=_O({idPrefix:w.idPrefix,...w.withPlayoffs,tournamentRecord:r,drawDefinition:P,structureId:A,isMock:a,event:s});if(N?.error)return N}let M=w?.completionGoal;if(w?.automated!==!1&&(e||M)){let A=w?.matchUpFormat,N=BA({completeAllMatchUps:!M&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:M,drawDefinition:P,matchUpFormat:A,event:s});if(N.error)return{error:N.error,drawIds:[]};let k=N.completedCount;if(w?.drawType===Ch){let x=P.structures?.find(F=>F.stage===Ut);if(!x)return{error:Qr};let O=XU({structureId:x.structureId,tournamentRecord:r,drawDefinition:P});if(O.error)return{error:O.error,drawIds:[]};let V=M?M-(k??0):void 0;if(O=BA({completeAllMatchUps:!M&&e,completionGoal:M?V:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:P,matchUpFormat:A,event:s}),O.error)return{error:O.error,drawIds:[]}}}}}return{...se,drawIds:p}}function ide(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:c,gender:u,eventType:d}=o,p=kn(mp)(d)&&Li||kn(Fc)(d)&&Di||d,h=i[Ut]||0,f=i[Ht]||0,m=a.drawProfiles?.length?h+f:a.participantsProfile?.participantsCount??0,g=hp(u)?u:void 0,v=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:y}=cD({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:c,idPrefix:v,sex:g}),b=Hu({tournamentRecord:n,participants:y});if(b.error)return b;let I=y?.filter(({participantType:T})=>T===p),w=y?.map(xi);return{uniqueDrawParticipants:I,uniqueParticipantIds:w}}function Vxe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=ip,qualifyingPositions:s=0,stage:o=Ut,drawSize:l=0,drawName:c,drawId:u}=r,d=l-s,p=i.slice(0,d).map(xi);if(p.length){let m=rp({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let h=p.map(m=>({entryStatus:nl,entryStage:o,participantId:m})),f=px({drawName:c||a,qualifyingPositions:s,drawEntries:h,drawId:u,event:n,stage:o});return f.error?f:{...se}}function rde({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Ut,drawSize:h=0}=c,f=h-u,m=d||s||a||p===Ht,g=m?t.slice(l,l+f):i[p||Ut]||[];m&&(l+=f);let v=Vxe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:c,event:o});if(v.error)return v}return{...se}}function nde(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=mp,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:w,tieFormatName:T,processCodes:S,discipline:D,eventLevel:C,timeItems:E,ballType:P,category:R}=u,M=u.eventId||or(),A=u.tieFormat||(v===Qn?Vf({namedFormat:T,event:{eventId:M,category:R,gender:m},hydrateCollections:s,isMock:h}):void 0),N=c.participants;for(let K of b)!m&&K.gender&&(m=K?.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:x,uniqueParticipantStages:O}=Jue({drawProfiles:b,category:R,gender:m}),V=kn(mp)(v)&&Li||kn(Fc)(v)&&Di||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:j=[]}=O?ide({event:{eventType:v,category:R,gender:m},uniqueParticipantsCount:x,participantsProfile:r,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:q}=u;typeof q!="object"&&(q={});let W=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||W||"Generated Event";let z={...q,surfaceCategory:w,processCodes:S,discipline:D,eventLevel:C,eventName:g,eventType:v,tieFormat:A,ballType:P,category:R,eventId:M,gender:m};if(I?.length&&Array.isArray(I)){let K=I.filter(vp);K?.length&&Object.assign(z,{extensions:K})}if(Array.isArray(E)&&E.forEach(K=>lw({event:J,timeItem:K})),typeof y=="object")for(let K of Object.keys(y))ry({policyDefinitions:{[K]:y[K]},event:z});z.category&&(z.category.categoryName=W);let H,Z=iD({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(Z.error)return Z;let J=Z?.event,{stageParticipants:ie}=Que({allUniqueParticipantIds:e,stageParticipantsCount:k,eventParticipantType:V,targetParticipants:N});if(b?.length){let K=rde({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:ie,tournamentRecord:c,drawProfiles:b,category:R,gender:m,event:J});if(K.error)return K;let ne=tde({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:b,isMock:h,event:J});if(ne.error)return ne;H=ne.drawIds}else if(u?.participantsProfile?.participantsCount){let K=F.map(xi);if(K.length){let ne=rp({participantIds:K,autoEntryPositions:a,tournamentRecord:c,entryStage:Ut,event:J});if(ne.error)return ne}}return p&&nD({tournamentRecord:c,event:J}),{drawIds:H,eventId:M,uniqueParticipantIds:j}}function c3({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!el(e))return{error:xa};let n="addSchedulingProfileRound",{extension:a}=Pi({name:lI,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>Uh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=YO({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:xa};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>ji(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return ce({result:{error:dre},stack:n});l.rounds.push(r);let d=eD({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...se}}function jxe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:be};let i=zU({tournamentRecord:e}).containedStructures,r=Ha({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=r.filter(v=>{let y=f?.indexOf("-")>0&&f.split("-").map(I=>+I),b=v.finishingPositionRange?.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Un(b,y).length===2||vi(b).length===vi(y).length&&Un(b,y).length===vi(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:w}=g,T=g.structureId;y&&!f&&(T=Object.keys(i).find(C=>i[C].includes(T))??T);let S={tournamentId:n,structureId:T,roundNumber:y,roundSegment:m,eventId:v,drawId:h},D=c3({tournamentRecords:{[n]:e},round:S,scheduleDate:o,venueId:d});if(D.error)return D;a.push({structureName:I,roundName:w,drawName:b,...S})}}}}return{scheduledRounds:a}}function Ex(t){let e=jt(t,[{drawProfile:!0,_ofType:Ko}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=Tt(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=Eu,drawType:b=ip,tournamentAlternates:I=0,alternatesCount:w=0,qualifyingPositions:T,qualifyingProfiles:S,generate:D=!0,eventExtensions:C,drawExtensions:E,completionGoal:P,tieFormatName:R,buildTeams:M,seedsCount:A,timeItems:N,drawName:k,category:x,idPrefix:O,publish:V,gender:F,stage:j}=g,q=g.drawSize||(g.ignoreDefaults?void 0:32),W=g.eventId||or(),z=p.eventType||p.matchUpType||mp,H=z===Fc?Di:Li,Z=ji(p.tieFormat)&&p.tieFormat||z===pr&&Vf({event:{eventId:W,category:x,gender:F},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,J=x?.categoryName||x?.ageCategoryCode||x?.ratingType,ie=p.eventName||J||`Generated ${z}`,K=u?.participants||[],ne=(S?.map(Be=>Be.structureProfiles||[]).flat().reduce((Be,ut)=>{let it=!ut.participantsCount||ut.participantsCount>ut.drawSize?ut.drawSize:ut.participantsCount||0;return Be+it},0)||0)*(H===Di?2:1),le=(!p.participantsCount||p.participantsCount>q?q:p.participantsCount)||0,re={eventName:ie,eventType:z,tieFormat:Z,category:x,eventId:W,gender:F};Array.isArray(N)&&N.forEach(Be=>lw({event:re,timeItem:Be}));let{eventAttributes:me}=p;if(typeof me!="object"&&(me={}),Object.assign(re,me),C?.length&&Array.isArray(C)){let Be=C.filter(vp);Be?.length&&Object.assign(re,{extensions:Be})}let he=[];if(r?.participantsCount===0||p.uniqueParticipants||ne||!u||F||x){let Be=(le||0)+w+ne,ut=Be,it={[Zn]:0,[us]:0},xe,Ze;z===pr&&({teamSize:xe,genders:Ze}=o3({alternatesCount:w,tieFormatName:R,tieFormat:Z,drawSize:q}),Object.keys(Ze).forEach(ft=>{let _t=Ms(ft);_t&&hp(ft)&&Ze[_t]&&(it[_t]=q*Ze[_t])}),ut=xe*((q||0)+ne));let st=r?.idPrefix?`D-${f}-${r?.idPrefix}`:void 0,qe=cD({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ut,consideredDate:u?.startDate,sex:F||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:H,gendersCount:it,idPrefix:st,category:x}).participants;if(re.category&&(re.category.categoryName=J),u){let ft=Hu({participants:qe,tournamentRecord:u});if(ft.error)return ft}if(qe.forEach(({participantId:ft})=>he.push(ft)),K=qe,z===pr){let ft=Ze[Zn]?qe.filter(({participantType:pt,person:Mt})=>pt===Li&&Mt?.sex===Zn).map(xi):[],_t=Ze[us]?qe.filter(({participantType:pt,person:Mt})=>pt===Li&&Cv(Mt?.sex)).map(xi):[],ve=qe.filter(({participantType:pt})=>pt===Li).map(xi).filter(pt=>!ft.includes(pt)&&!_t.includes(pt)),$e=[...g.teamNames??[],...FA({count:Be}).names],De=xe-(Ze[Zn]+Ze[us]),je=0,Oe=0,nt=0,Fe=vt(0,Be).map(pt=>{let Mt=_t.slice(je,je+Ze[us]),Wi=ft.slice(Oe,Oe+Ze[Zn]),Qt=ve.slice(nt,nt+De);je+=Ze[us],Oe+=Ze[Zn],nt+=De;let tr=M!==!1?[...Mt,...Wi,...Qt]:[];return{participantName:$e[pt]||`Team ${pt+1}`,participantOtherName:`TM${pt+1}`,participantRole:ms,individualParticipantIds:tr,participantType:pr,participantId:or()}}),wt=Hu({participants:Fe,tournamentRecord:u});if(!wt.success)return wt;K=Fe}}let Ie=Be=>{let{participantType:ut}=Be;return kn(mp)(z)&&ut===Li||kn(Fc)(z)&&ut===Di?!0:z===pr&&ut===pr},Le=Be=>!p.gender||Be.person?.sex===p.gender?!0:Be.individualParticipantIds?.some(ut=>{let it=K.find(xe=>xe.participantId===ut);return it&&Le(it)}),ot=K.filter(Ie).filter(Le).filter(({participantId:Be})=>!i.includes(Be)),at=ot.slice(0,le).map(Be=>Be.participantId);if(d&&at?.length){let Be=rp({autoEntryPositions:s,entryStage:j,tournamentRecord:u,participantIds:at,event:re});if(Be.error)return Be}let dt=ne?ot.slice(le,le+ne).map(Be=>Be.participantId):0;if(d&&dt?.length){let Be=0,ut=1,it=(Ze,st)=>Ze.stageSequence-st.stageSequence,xe=(Ze,st)=>Ze.roundTarget-st.roundTarget;for(let Ze of S.sort(xe)){ut=Ze.roundTarget||ut;let st=1,qe;for(let ft of Ze.structureProfiles.sort(it)){let _t=(ft.drawSize||WG(ft.participantsCount))-(qe||0),ve=dt.slice(Be,Be+_t),$e=rp({entryStage:Ht,entryStageSequence:st,autoEntryPositions:s,tournamentRecord:u,participantIds:ve,roundTarget:ut,event:re});if($e.error)return $e;qe=ft.qualifyingPositions,Be+=_t,st+=1}ut+=1}}let It=v&&u?.participants?.filter(({participantId:Be})=>!at.includes(Be)).filter(Ie).filter(Le).slice(0,w||q-le||I).map(Be=>Be.participantId);if(d&&It?.length){let Be=rp({participantIds:It,autoEntryPositions:!1,entryStatus:Cu,tournamentRecord:u,event:re});if(Be.error)return Be.error}let ze=J||ie;u&&A&&A<=at.length&&vt(1,A+1).forEach((Be,ut)=>{let it={scaleName:ze,scaleDate:h,scaleType:Az,scaleValue:Be,eventType:z},xe=at[ut];iR({tournamentRecord:u,participantId:xe,scaleItem:it})});let Ct=cR({...Tt(p,!1,!0),tournamentRecord:u,seedingScaleName:ze,matchUpFormat:y,eventId:W,isMock:d,event:re});if(Ct.error)return Ct;if(!Ct.drawDefinition)return{error:nc};let{drawDefinition:ke}=Ct,mt=ke.drawId;if(Array.isArray(E)&&E.filter(vp).forEach(Be=>ir({element:ke,extension:Be})),D){if(uR({drawDefinition:ke,event:re,suppressNotifications:!0}),p.withPlayoffs){let ut=ke.structures?.[0].structureId,it=_O({...p.withPlayoffs,tournamentRecord:u,drawDefinition:ke,structureId:ut,idPrefix:O,isMock:d,event:re});if(it?.error)return it}let Be=p.automated===!1;if(d&&!Be){let ut=it=>{let xe=BA({completeAllMatchUps:it.completeAllMatchUps,completionGoal:it.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:re});if(xe.error)return xe;let Ze=xe.completedCount;if(b===Ch){let st=ke.structures?.find(_t=>_t.stage===Ut);if(!st)return{error:Qr};XU({structureId:st.structureId,tournamentRecord:u,drawDefinition:ke});let qe=P?P-(Ze??0):void 0,ft=BA({completionGoal:P?qe:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:re});if(ft.error)return ft}};if(P&&ut({completionGoal:P}),p.outcomes){let{matchUps:it}=lo({inContext:!0,drawDefinition:ke,event:re});for(let xe of p.outcomes){let{matchUpStatus:Ze=Sn,matchUpStatusCodes:st,stageSequence:qe=1,matchUpIndex:ft=0,structureOrder:_t,matchUpFormat:ve,drawPositions:$e,roundPosition:De,stage:je=Ut,roundNumber:Oe,winningSide:nt,scoreString:Fe}=xe,wt=it?.reduce((Qt,tr)=>{let{structureId:Vi,matchUpId:$i}=tr;return Qt[Vi]?Qt[Vi].push($i):Qt[Vi]=[$i],Qt},{})??[],pt=Object.assign({},...Object.keys(wt).map((Qt,tr)=>({[Qt]:tr+1}))),Mt=it?.filter(Qt=>(!je||Qt.stage===je)&&(!qe||Qt.stageSequence===qe)&&(!Oe||Qt.roundNumber===Oe)&&(!De||Qt.roundPosition===De)&&(!_t||pt[Qt.structureId]===_t)&&(!$e||Un($e,Qt.drawPositions).length===2))?.[ft],Wi=ede({matchUpStatusCodes:st,tournamentRecord:u,drawDefinition:ke,targetMatchUp:Mt,matchUpFormat:ve,matchUpStatus:Ze,scoreString:Fe,winningSide:nt});if(Wi?.error)return Wi}}a&&ut({completeAllMatchUps:a})}V&&nD({tournamentRecord:u,event:re})}else{let Be=px({drawEntries:ke.entries,drawName:k||b,qualifyingPositions:T,drawId:mt,event:re,stage:j});if(Be.error)return Be}return{...se,event:Lt(re),uniqueParticipantIds:he,targetParticipants:K,drawDefinition:ke,eventId:W,drawId:mt}}var ade=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),Gxe=ade;function $A(t){return parseInt(t)}function pK({startTime:t="",endTime:e=""}={}){if(!t||!e||!Rv.test(t)||!Rv.test(e))return!1;let[i,r]=t.split(":").map($A),[n,a]=e.split(":").map($A);return n<i?!1:!(i===n&&a<r)}function Hxe(t,e){let[i,r]=t.startTime.split(":").map($A),[n,a]=e.startTime.split(":").map($A);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function sde({dateAvailability:t}){if(!t)return{error:Ere};if(!Array.isArray(t))return{error:uN};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:uN};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:uN};if(n&&!fp.test(n))return{error:xa,dateAvailability:{date:n},info:e};if(!Rv.test(a))return{error:vu,dateAvailability:{startTime:a},info:i};if(!Rv.test(s))return{error:vu,dateAvailability:{endTime:s},info:i};if(a===s)return{error:vu,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!pK({startTime:a,endTime:s}))return{error:vu,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:uA};for(let l of o){if(typeof l!="object")return{error:uA};let{startTime:c,endTime:u}=l;if(!Rv.test(c))return{error:vu,booking:{startTime:c},info:i};if(!Rv.test(u))return{error:vu,booking:{endTime:u},info:i};if(c===u)return{error:vu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!pK({startTime:c,endTime:u}))return{error:vu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function Px({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Xh({tournamentRecord:t,venueId:i});if(!a)return{error:$I};a.courts||(a.courts=[]);let s={...ade(),venueId:i,courtId:r};if(s.courtId||(s.courtId=or()),a.courts.some(o=>o.courtId===s.courtId))return{error:Gre};{let o=(n?.dateAvailability||[]).map(u=>({...u,date:Ti(u.date),startTime:Gr(u.startTime),endTime:Gr(u.endTime),bookings:u.bookings?.map(({startTime:d,endTime:p,bookingType:h})=>({startTime:Gr(d),endTime:Gr(p),bookingType:h}))})),l=Object.keys(s);for(let u of l)if(n?.[u])if(u==="dateAvailability"){let d=sde({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=n[u];let c=s;return a.courts.push(c),e||bi({payload:{venue:a,tournamentId:t.tournamentId},topic:My,key:a.venueId}),{...se,court:Tt(s),venueId:i}}}function u3(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:kg};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=Xh({tournamentRecord:s,venueId:i});if(o){let l=zxe({...t,tournamentRecord:s});for(let c of l?.courts??[])n.push(c?.courtId);if(l.error)return l;a=!0}}return a?{...se,courtIds:n}:{error:$I}}function zxe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:kg};let h=Xh({tournamentRecord:r,venueId:d});if(h.error)return h;let{venue:f}=h;if(!gn(s)||!n)return{error:jre};s=s??n.length;let m=vt(0,s).map(g=>{let v=a?.[g],y=v?p.map(b=>({date:Du(b),startTime:o,endTime:c,...v})):e;return v&&o&&c&&y.push({startTime:o,endTime:c}),{courtName:n[g]||i&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=l?.pop()||u&&`${u}-${v+1}`;return Px({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?ce({info:"not all courts could be generated",result:{error:be}}):(f&&bi({payload:{venue:f,tournamentId:r.tournamentId},topic:My,key:f.venueId}),{...se,courts:Tt(m)})}function d3({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=r?.pop()??or(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},w=k1({tournamentRecord:t,venue:I});if(w.error){if(e)continue;return w}s.push(u);let T=bT(n,a),S=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(T.map(D=>({date:Du(D),startTime:p,endTime:h})));if(m||g){let D=u3({dateAvailability:d||S,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:u,dates:T});if(D.error)return D}}return s}function qxe(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let u of i){let d=[],{tieFormatName:p=gA,teamProfiles:h=[],teamsCount:f=0,category:m,idPrefix:g,gender:v}=u,y=u.leagueName??u.eventName??`League ${l+1}`,b=u.leagueId??u.eventId??o?.pop()??or();r.push(b);let I=ji(u.tieFormat)&&u.tieFormat||Vf({event:{eventId:b,category:m,gender:v},namedFormat:p,isMock:t.isMock})||void 0;if(!I)return{error:_U};let w=Math.max(f,h.length),T=vt(0,w),{genders:S,teamSize:D}=o3({tieFormat:I,drawSize:w}),C={[us]:0,[GI]:0,[Tf]:0,[Zn]:0,ANY:0};Object.keys(S).forEach(P=>C[P]+=S[P]);for(let P of T){let R=h?.[P]?.teamName??`Team ${P+1}`,M=h?.[P]?.teamId||o?.pop()||or(),A=u.startDate??t.startDate,N=cD({...u?.participantsProfile,participantsCount:D,consideredDate:A,gendersCount:C,category:m,uuids:o}).participants,k=N.map(q=>q.participantId),x=pr,O=M??LA({participantType:x,idPrefix:g,index:P,uuids:o});d.push({participantId:O,entryStatus:nl,entryStage:Ut});let V=h?.[P]?.venueIds??[],F={participantId:O,participantRole:ms,participantName:R,individualParticipantIds:k,participantType:x,homeVenueIds:V};V.forEach(q=>!n.includes(q)&&n.push(q)),s.push(...k),s.push(O);let j=Hu({participants:[F,...N],tournamentRecord:e});if(j.error)return j}let E={eventName:y,entries:d,eventType:pr,tieFormat:I,category:m,eventId:b,gender:v};if(e.events||(e.events=[]),e.events.push(E),d.length){let P=(gn(u.roundsCount)&&u.roundsCount)??u.roundsCount===QRe?(w-1)*2:w-1,R=cR({automated:u.automated,tournamentRecord:e,drawType:Pl,roundsCount:P,drawSize:w,event:E});if(R.error)return R;let{drawDefinition:M}=R;if(M){let A=M?.drawId;uR({drawDefinition:M,event:E,suppressNotifications:!0}),a.push(A)}}l++}let c=n.map(u=>({venueId:u}));d3({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:o})}var Wxe=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function ode(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=vl(Wxe),ratingsParameters:n=Ua,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:c}=t??{},u=t?.isMock===!1?void 0:!0;if(e&&!el(e)||i&&!el(i))return{error:xa};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:be};if(!e){let y=new Date;e=Du(i??y),i=Du(y.setDate(y.getDate()+7))}if(!i){let y=new Date(e);i=Du(y.setDate(y.getDate()+7))}let d=Dx({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:u}),p=l?.length?d3({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a?.length&&Array.isArray(a)){let y=a.filter(b=>vp({extension:b}));y?.length&&Object.assign(d,{extensions:y,isMock:u})}if(typeof s=="object")for(let y of Object.keys(s))ry({policyDefinitions:{[y]:s[y]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let y=Xue({tournamentRecord:d,...t});if(!y.success)return y}let h=[],f=[],m=[];if(t.leagueProfiles){let y=qxe({allUniqueParticipantIds:h,tournamentRecord:d,...t,eventIds:f,venueIds:p,drawIds:m});if(y?.error)return y}if(t.drawProfiles){let y=Yxe({allUniqueParticipantIds:h,ratingsParameters:n,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}if(t.eventProfiles){let y=Kxe({allUniqueParticipantIds:h,ratingsParameters:n,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}let{scheduledRounds:g=void 0,schedulerResult:v={}}=o?Zxe({...t,tournamentRecord:d}):{};return TH(),Lt({...se,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:f,venueIds:p,drawIds:m})}function Yxe(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=Ex({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=iD({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),n.push(u)}p?.length&&r.push(...p),s+=1}}function Kxe(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=nde({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&n.push(...c),r.push(l),u?.length&&i.push(...u),a+=1}}function Zxe(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=jxe({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:Ux({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var lde={};Ai(lde,{anonymizeTournamentRecord:()=>cde,modifyTournamentRecord:()=>ude});function cde({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:Qe};let s=Array.isArray(t)?TY.concat(...t):TY,o=O=>Array.isArray(t)?O?.extensions?.filter(V=>s.includes(V.name)):O?.extensions,l={};i.extensions=o(i);let c=a||or();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Du(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let O of i.participants||[]){O.extensions=o(O),O.onlineResources=[];let V=or();l[O.participantId]=V,O.participantId=V}for(let O of i.participants||[])Array.isArray(O.individualParticipantIds)&&(O.individualParticipantIds=O.individualParticipantIds.map(V=>l[V]));let u=0;for(let O of i.venues||[]){O.venueAbbreviation=`V${u}`,O.extensions=o(O),O.venueName=`Venue #${u}`,O.onlineResources=[],O.addresses=[];let V=or();l[O.venueId]=V,O.isMock=!0,u+=1;let F=0;for(let j of O.courts||[])j.courtName=`V${u}C${F}`,j.extensions=o(j),j.onlineResources=[],j.isMock=!0,F+=1}let d=1;for(let O of i.events||[]){O.extensions=o(O),O.onlineResources=[],O.isMock=!0;let V=or();l[O.eventId]=V,O.eventId=V;let F=O.category?.categoryName||O.category?.ageCategoryCode||O.category?.ratingType||O.gender;if(O.eventName=`Event ${d} ${F}`,Array.isArray(O.entries))for(let q of O.entries)q.participantId=l[q.participantId];for(let q of O.drawDefinitions||[]){q.extensions=o(q);let W=or();if(l[q.drawId]=W,q.drawId=W,q.isMock=!0,Array.isArray(q.entries))for(let H of q.entries)H.participantId=l[H.participantId];let z=H=>{H.extensions=o(H);let Z=or();l[H.structureId]=Z,H.structureId=Z;for(let J of H.positionAssignments||[])J.participantId&&(J.participantId=l[J.participantId]);for(let J of H.seedAssignments||[])J.participantId&&(J.participantId=l[J.participantId]);for(let J of H.matchUps||[]){J.isMock=!0;for(let ie of J.sides||[])ie.lineUp&&(ie.lineUp=ie.lineUp.map(({participantId:K,collectionAssignments:ne})=>({participantId:l[K],collectionAssignments:ne})))}};for(let H of q.structures||[])if(z(H),Array.isArray(H.structures))for(let Z of H.structures)z(Z);for(let H of q.links||[])H.source.structureId=l[H.source.structureId],H.target.structureId=l[H.target.structureId]}let{extension:j}=Pi({name:Vu,element:O});Array.isArray(j?.value?.flights)&&j?.value.flights?.forEach(q=>{if(q.drawId=l[q.drawId],Array.isArray(q.drawEntries))for(let W of q.drawEntries)W.participantId=l[W.participantId]}),d+=1}let p=i.startDate||Du(new Date),h=(i.participants||[]).filter(({participantType:O})=>O===Li),f=h.reduce((O,V)=>{let F=V.person?.sex,j=Ms(F);return j&&hp(F)?O[j]+=1:O[Tf]+=1,O},{[Zn]:0,[us]:0,[Tf]:0}),m=Object.assign({},...Object.keys(f).map(O=>({[O]:Zue({category:{ageCategoryCode:"O18"},count:f[O],personExtensions:[],consideredDate:p,sex:O})?.persons||[]}))),g={[Zn]:0,[us]:0,[Tf]:0},v=h.length,y=h.reduce((O,V)=>{let F=V.person?.addresses?.[0]||{},{city:j,state:q,postalCode:W}=F;return O.cities.includes(j)||O.cities.push(j),O.states.includes(q)||O.states.push(q),O.postalCodes.includes(W)||O.postalCodes.push(W),O},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,w=y.states.length,{cities:T}=que({count:I||v,participantsCount:v}),{states:S}=Wue({count:w||v,participantsCount:v}),{postalCodes:D}=Yue({count:b||v,participantsCount:v}),C={cities:T,states:S,postalCodes:D};h.forEach((O,V)=>{let F=O?.person,j=F?.sex||Tf,q=Ti(F?.birthDate)?.split("-")[0],W=g[j],z=m[j][W];if(g[j]+=1,q){let[,H,Z]=z?.birthDate?.split("-")||[],J=[q,H,Z].join("-");z.birthDate=J}if(F?.addresses){let H=Kue({...C,participantIndex:V,nationalityCode:z.nationalityCode});z.addresses=[H]}z.personId=n?.[V]||or(),e?(z.standardFamilyName=z.lastName,z.standardGivenName=z.firstName,O.participantName=`${z.standardGivenName} ${z.standardFamilyName}`):(z.standardFamilyName=F?.standardFamilyName,z.standardGivenName=F?.standardGivenName),delete z.firstName,delete z.lastName,z.extensions=o(F),O.person=z,l[F?.personId]=z.personId}),(i.participants||[]).filter(({participantType:O})=>O===Di).forEach(O=>{let{individualParticipantIds:V}=O;O.participantName=Xxe({individualParticipantIds:V,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:O})=>O===pr),P=E.length,R=FA({count:P}).names;E.forEach((O,V)=>{O.participantName=R[V]});let M=(i.participants||[]).filter(({participantType:O})=>O===hc),A=M.length,N=FA({count:A,nameRoot:"Group"}).names;M.forEach((O,V)=>{O.participantName=N[V]});let{extension:k}=Pi({element:i,name:lI});Array.isArray(k?.value)&&k?.value.forEach(O=>{O.tournamentId=l[O.tournamentId],O.structureId=l[O.structureId],O.eventId=l[O.eventId],O.drawId=l[O.drawId]});let{extension:x}=Pi({element:i,name:GU});return Array.isArray(x?.value)&&x?.value.forEach(O=>{O.personId=l[O.personId]}),{...se}}function Xxe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function ude(t){let{ratingsParameters:e=Ua,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,schedulingProfile:l,tournamentRecord:c,autoSchedule:u,eventProfiles:d,periodLength:p,venueProfiles:h,drawProfiles:f,isMock:m,uuids:g}=t;if(!c)return{error:Qe};let v=[],y=[],b=[];d?.forEach(C=>{let E=c.events?.find((P,R)=>C.eventIndex!==void 0&&R===C.eventIndex||C.eventName&&P.eventName===C.eventName||C.eventId&&P.eventId===C.eventId);E?.gender&&(C.gender=E.gender)});let I=c.participants?.length||void 0;I&&i?.idPrefix&&(i.idPrefix=`${i.idPrefix}-${I}`);let w=Xue({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:d,drawProfiles:f,uuids:g});if(!w.success)return w;if(d){let C=c.events?.length||0;for(let E of d){let{ratingsParameters:P}=E,R=c.events?.find((M,A)=>E.eventIndex!==void 0&&A===E.eventIndex||E.eventName&&M.eventName===E.eventName||E.eventId&&M.eventId===E.eventId);if(R){let{gender:M,category:A,eventType:N}=R,{drawProfiles:k,publish:x}=E,O=kn(mp)(N)&&Li||kn(Fc)(N)&&Di||N;if(k){let{stageParticipantsCount:V,uniqueParticipantsCount:F,uniqueParticipantStages:j}=Jue({drawProfiles:k,category:A,gender:M}),{uniqueDrawParticipants:q=[],uniqueParticipantIds:W=[]}=j?ide({event:{eventType:N,category:A,gender:M},uniqueParticipantsCount:F,participantsProfile:i,ratingsParameters:P,tournamentRecord:c,eventProfile:E,uuids:g}):{};v.push(...W);let{stageParticipants:z}=Que({targetParticipants:c.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:V,eventParticipantType:O}),H=rde({uniqueDrawParticipants:q,autoEntryPositions:a,stageParticipants:z,tournamentRecord:c,drawProfiles:k,category:A,gender:M,event:R});if(H.error||(H=tde({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:k,isMock:m,event:R}),H.error))return H;b.push(...H.drawIds)}x&&nD({tournamentRecord:c,event:R})}else{let M=nde({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:o,ratingsParameters:P,tournamentRecord:c,eventProfile:E,eventIndex:C,uuids:g});if(M.error)return M;let{eventId:A,drawIds:N,uniqueParticipantIds:k}=M;N&&b.push(...N),y.push(A),k?.length&&v.push(...k),C+=1}}}if(f){let C=(c.events||[]).map(E=>E.drawDefinitions?.map(()=>1)||[]).flat().reduce((E,P)=>E+P,0);for(let E of f){let P=Ex({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:e,tournamentRecord:c,drawProfile:E,drawIndex:C,uuids:g});if(P.error)return P;let{drawId:R,eventId:M,event:A,uniqueParticipantIds:N}=P;if(P=iD({tournamentRecord:c,event:A,internalUse:!0}),P.error)return P;R&&b.push(R),y.push(M),N?.length&&v.push(...N),C+=1}}let T=h?.length?d3({tournamentRecord:c,venueProfiles:h}):[],S,D={};if(l?.length){let C={[c.tournamentId]:c},E=eD({tournamentRecords:C,schedulingProfile:l});if(E.error)return E;if(u){let{tournamentId:P}=c,R={[P]:c};D=Ux({tournamentRecords:R,periodLength:p})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:S,schedulerResult:D,...se,eventIds:y,venueIds:T,drawIds:b}}var p3={};Ai(p3,{addDynamicRatings:()=>Aq,addIndividualParticipantIds:()=>gx,addParticipant:()=>Ip,addParticipants:()=>Hu,addPenalty:()=>Nde,addPersonRequests:()=>gde,addPersons:()=>Ade,createGroupParticipant:()=>Sde,createTeamsFromParticipantAttributes:()=>s3,deleteParticipants:()=>rw,filterParticipants:()=>$1,findParticipant:()=>wde,getCompetitionParticipants:()=>Yq,getPairedParticipant:()=>Gu,getParticipantEventDetails:()=>Kq,getParticipantMembership:()=>Zq,getParticipantScaleItem:()=>AT,getParticipantSchedules:()=>Xq,getParticipantSignInStatus:()=>Jq,getParticipantTimeItem:()=>Tz,getParticipants:()=>cn,getScaleValues:()=>VU,mergeParticipants:()=>Mde,modifyIndividualParticipantIds:()=>vde,modifyParticipant:()=>vx,modifyParticipantName:()=>Tde,modifyParticipantOtherName:()=>bde,modifyParticipantsSignInStatus:()=>yde,modifyPenalty:()=>Cde,modifyPersonRequests:()=>fde,mutate:()=>dde,participantScaleItem:()=>dh,query:()=>mce,regenerateParticipantNames:()=>Ide,removeIndividualParticipantIds:()=>jz,removeParticipantIdsFromAllTeams:()=>TO,removePenalty:()=>Ede,removePersonRequests:()=>mde,removeRatings:()=>Dde,scaledTeamAssignment:()=>Ude,setParticipantScaleItem:()=>iR,setParticipantScaleItems:()=>gle,validateLineUp:()=>DO});var dde={};Ai(dde,{addDynamicRatings:()=>Aq,addIndividualParticipantIds:()=>gx,addParticipant:()=>Ip,addParticipants:()=>Hu,addPenalty:()=>Nde,addPersonRequests:()=>gde,addPersons:()=>Ade,createGroupParticipant:()=>Sde,createTeamsFromParticipantAttributes:()=>s3,deleteParticipants:()=>rw,findParticipant:()=>wde,mergeParticipants:()=>Mde,modifyIndividualParticipantIds:()=>vde,modifyParticipant:()=>vx,modifyParticipantName:()=>Tde,modifyParticipantOtherName:()=>bde,modifyParticipantsSignInStatus:()=>yde,modifyPenalty:()=>Cde,modifyPersonRequests:()=>fde,regenerateParticipantNames:()=>Ide,removeIndividualParticipantIds:()=>jz,removeParticipantIdsFromAllTeams:()=>TO,removePenalty:()=>Ede,removePersonRequests:()=>mde,removeRatings:()=>Dde,scaledTeamAssignment:()=>Ude,setParticipantScaleItem:()=>iR,setParticipantScaleItems:()=>gle});function pde(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function hde({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===fR&&(a=Ti(a),s=Gr(s),o=Gr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=pde(),t[e].push(n);return{mergeCount:r.length}}function h3(t){let{tournamentRecords:e,personRequests:i}=t,r=jt(t,[{[xs]:!0}]);if(r.error)return r;if(!i)return{...se};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(og({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&ir({element:a,extension:{value:o,name:GU}})}return{...se}}function fde(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=jt(t,[{[xs]:!0},{requests:!0,[Fo]:Cs,[sc]:be}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=By({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&hde({personRequests:s,personId:r,requests:l}),h3({tournamentRecords:e,personRequests:s})}function mde(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=jt(t,[{[xs]:!0}]);if(s.error)return s;let{personRequests:o}=By({tournamentRecords:e}),l=u=>{o&&(o[u]=o[u].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[u]?.length||delete o[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&o?.[n])l(n);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?oo({name:GU,tournamentRecords:e,discover:!0}):h3({tournamentRecords:e,personRequests:o})}function gde(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=jt(t,[{[xs]:!0,[s0e]:!0},{requests:!0,[Fo]:Cs,[sc]:be}]);if(n.error)return n;let{personRequests:a}=By({tournamentRecords:e}),{mergeCount:s}=hde({personRequests:a,personId:i,requests:r});return s&&a?h3({tournamentRecords:e,personRequests:a}):{error:be}}function vde({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ce({result:{error:Qe},stack:r});if(!e||!t)return ce({result:{error:Wt},stack:r});let n=i.participants||[],a=n.find(h=>h.participantId===e);if(!a)return ce({result:{error:An},stack:r});if(![pr,hc].includes(a.participantType))return ce({result:{error:Td},context:{participantType:a.participantType},stack:r});let s=t.filter(h=>n.find(f=>f.participantId===h)?.participantType!==Li);if(s.length)return ce({result:{error:bl,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),c=o.filter(h=>!t.includes(h)),u=gx({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ce({result:u,stack:r});let d=jz({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ce({result:d,stack:r});let{topics:p}=pc();if(p.includes(Is)){let h=n.find(({participantId:f})=>f===e);bi({topic:Is,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function yde({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Qe};if(!Array.isArray(e))return{error:Wt};if(![jP,Yae].includes(i))return{error:be,signInState:i};let r=t.participants||[];if(!r.length)return{error:o1};let n=r.map(xi),a=e.filter(c=>!n.includes(c));if(a.length)return{error:be,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=yq({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:S1,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=pc();return s.length&&l.includes(Is)&&bi({topic:Is,payload:{tournamentId:t.tournamentId,participants:s}}),{...se}}function bde({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Qe};if(!e)return{error:na};let{participant:r}=Bg({tournamentRecord:t,participantId:e});if(!r)return{error:An};r.participantOtherName=i;let{topics:n}=pc();return n.includes(Is)&&bi({topic:Is,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...se}}function hK({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=pV(e?.standardGivenName??""),h=pV(e?.standardFamilyName??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),h=h.toLowerCase()):n(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function Jxe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==Co&&s){let{personFormat:o,doublesJoiner:l}=s;r===Li&&(e.participantName=hK({person:a,personFormat:o})),r===Di&&(e.participantName=n?.map(c=>{let u=t[c]?.person;return hK({person:u,personFormat:o})}).filter(Boolean).join(l??"/"))}}function Ide({tournamentRecord:t,formats:e}){if(!t)return{error:Qe};if(!ji(e))return{error:Wt};let i=t.participants??[],r=Yie(i,"participantId");for(let n of i)Jxe({participant:n,participantMap:r,formats:e});return{...se}}function wde(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Wt,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=og({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...se}}function Sde({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Lse,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:Qe};if(!a)return{error:Wt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:be};let s=(cn({participantFilters:{participantTypes:[Li]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:Td,participantId:u};let o=Lt({participantId:n||or(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:hc,participantRole:i}),l=Ip({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:c}=pc();return c.includes(lg)&&bi({topic:lg,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...se,participant:Tt(o)}}function Tde({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Qe};if(!i)return{error:na};if(!e)return{error:Wt,info:"Missing participantName"};let{participant:r}=Bg({tournamentRecord:t,participantId:i});if(!r)return{error:An};r.participantName=e;let{topics:n}=pc();return n.includes(Is)&&bi({topic:Is,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...se}}function Ude({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){if(!s)return{error:Qe};if(!Array.isArray(a)&&!fi(c)&&!u||!fi(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:be};if(!o&&!n.length||!n&&!(e&&o))return{error:Wt,info:"Missing scaling details"};if(u&&!a){if(d?.eventType!==El)return{error:Th};a=d?.entries?.filter(({entryStatus:v})=>v===nl).map(xi)}if(!a?.length&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Wt};let p=e??n.map(({participantId:v})=>v);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let h=a?.slice(r).concat(...a.slice(0,r))??[],f=[];for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(h.includes(y)){if(b!==Co)return{error:Td,participant:v};f.push(v)}}if(c&&f.length<c){let v=c-(f?.length||0),y=l??"Team",b=vt(0,v).map(S=>({participantName:`${y} ${S+1}`,participantType:Co,participantRole:ms})),{participants:I=[]}=Hu({participants:b,returnParticipants:!0,tournamentRecord:s}),w=I.map(xi),T=s.participants?.filter(({participantId:S})=>w.includes(S))??[];f.push(...T)}if(!f.length)return{error:yH};if(t)for(let v of f)v.individualParticipantIds=[];else{let v=f.map(y=>y).flat();e?.length?p=p.filter(y=>!v.includes(y)):n=n?.filter(({participantId:y})=>!v.includes(y))}if(!e?.length&&!n?.length)return{error:kk,info:"Nothing to be done"};if(!n.length){for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(!p.includes(y))continue;if(b!==Li)return{error:Td,participant:v};let I=dh({scaleAttributes:o,participant:v})?.scaleItem,w=o?.accessor?I?.scaleValue?.[o?.accessor]:I?.scaleValue,T={participantId:y,scaleValue:w};n.push(T)}if(!n.length)return{error:An}}n.sort((v,y)=>o?.sortOrder?(y?.scaleValue||0)-(v?.scaleValue||0):(v?.scaleValue||1/0)-(y?.scaleValue||1/0));for(let v of n)if(!v.participantId)return{error:be,scaledParticipant:v};let m=0;for(;m<n.length;){for(let v of f){if(m+1>n.length)break;let y=n[m];v.individualParticipantIds.push(y.participantId),m++}f.reverse()}let g=f.map(xi);for(let v of s.events??[]){if(v.eventType!==El)continue;let y=(v.entries??[]).filter(b=>g.includes(b.participantId));for(let b of y){let I=b.participantId,w=f.find(S=>S.participantId===I)?.individualParticipantIds;v.entries=(v.entries??[]).filter(S=>!w.includes(S.participantId)),(v.drawDefinitions??[]).forEach(S=>{S.entries=(S.entries??[]).filter(D=>!w.includes(D.participantId))});let{flightProfile:T}=Cn({event:v});(T?.flights||[]).forEach(S=>{S.drawEntries=(S.drawEntries||[]).filter(D=>!w.includes(D.participantId))})}}return{...se,scaledParticipants:n}}function Dde(t){let e=jt(t,[{[da]:!0,[GH]:!0},{ratingType:!1,[ds]:s=>Ua[s]}]);if(e.error)return e;let i=`${t.ratingType}.${WH}`,r=t.asDynamic?i:t.ratingType,n=[Jv,eg,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...se}}function Ede(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=Qxe({...t,tournamentRecord:i});if(r.error&&r.error!==yT)return r}return{...se}}function Qxe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Qe};if(!e)return{error:hH};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&bi({topic:Is,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...se,penalty:a}:{error:yT}}var eLe=({penaltyId:t=or()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Pde=eLe;function Cde(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=tLe({...t,tournamentRecord:i});if(r.error&&r.error!==yT||r.success)return r}return{error:yT}}function tLe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Qe};if(!e)return{error:be,modifications:e};if(!i)return{error:hH};let r=t?.participants??[],n=Object.keys(Pde()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:Ok};let s,o=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&bi({topic:Is,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...se,penalty:s}:{error:yT}}function Rde(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:vi(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=vi(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=Rde(t[n],e[n],i):r[n]=e[n];return r},{})}function Mde({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Qe};e.participants||(e.participants=[]);let r=t.filter(Rl(Rh)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=Rde(c,n[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(Rl(Rh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=pc();return o.length&&(e.participants=e.participants.concat(...o),l.includes(lg)&&bi({topic:lg,payload:{participants:o}})),a.length&&l.includes(Is)&&bi({topic:Is,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...se}}function Nde(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(cn({tournamentRecord:a}).participants??[])?.map(xi).filter(o=>i.includes(o));s.length&&(n=iLe({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...se,penaltyId:n}:{error:An}}function iLe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:Qe};if(!i)return{error:na};if(!n)return{error:Vre};let u=(e?.participants??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:An};let d=new Date().toISOString(),p=Object.assign(Pde({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>ir({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),bi({topic:Is,payload:{tournamentId:e.tournamentId,participants:u}}),{...se,penaltyId:p.penaltyId}}function Ade({participantRole:t=ms,tournamentRecord:e,persons:i}){if(!e)return{error:Qe};if(!Array.isArray(i))return{error:be};if(!Object.keys(jg).includes(t))return{error:Mre};let r=(e.participants||[]).map(({person:f})=>f?.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=or()),n.push(f.personId),f)),s=(f,m)=>Object.assign({},...Object.keys(f).filter(g=>!m.includes(g)).map(g=>({[g]:f[g]}))),o=a.map(f=>Lt({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:Li,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Hu({participants:o,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=cn({participantFilters:{participantTypes:[Li]},tournamentRecord:e})?.participants??[];if(t===ms&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(g=>{let v=[f,g.personId].map(y=>og({tournamentParticipants:p,personId:y})).filter(Boolean);if(v.length===2){let y=v.map(xi);d.push(Lt({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:ms,individualParticipantIds:y,participantType:Di}))}})}),d.length){if(u=Hu({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...se,addedCount:h,newPersonIds:n}}var Cx={};Ai(Cx,{bulkUpdatePublishedEventIds:()=>aW,getAllEventData:()=>sW,getCourtInfo:()=>yO,getDrawData:()=>XO,getEventData:()=>JO,getEventPublishStatus:()=>Zc,getPublishState:()=>iw,getTournamentPublishStatus:()=>B1,getVenueData:()=>MT,mutate:()=>_de,publishEvent:()=>nD,publishEventSeeding:()=>kde,publishOrderOfPlay:()=>Bde,publishParticipants:()=>Fde,query:()=>wce,setEventDisplay:()=>dx,unPublishEvent:()=>$de,unPublishEventSeeding:()=>Ode,unPublishOrderOfPlay:()=>Lde,unPublishParticipants:()=>xde});var _de={};Ai(_de,{publishEvent:()=>nD,publishEventSeeding:()=>kde,publishOrderOfPlay:()=>Bde,publishParticipants:()=>Fde,setEventDisplay:()=>dx,unPublishEvent:()=>$de,unPublishEventSeeding:()=>Ode,unPublishOrderOfPlay:()=>Lde,unPublishParticipants:()=>xde});function kde({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=fc,drawIds:a=[],event:s}){if(!r)return{error:Qe};if(!s)return{error:Or};let o=Zc({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},c=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},u=Lt({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return rD({statusObject:{seeding:u},removePriorValues:t,status:n,event:s}),bi({topic:jae,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...se}}function Ode({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=fc,drawIds:n,stages:a,event:s}){if(!i)return{error:Qe};if(!s)return{error:Or};let o=Zc({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let c of a)l.stageSeedingScaleNames[c]&&delete l.stageSeedingScaleNames[c];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(c=>!e.includes(c))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(c=>!n.includes(c))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),rD({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return bi({topic:bz,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...se}}function xde(t){let e=qc(t);if(!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=rLe({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function rLe({removePriorValues:t=!0,tournamentRecord:e,status:i=fc}){if(!e)return{error:Qe};let r=`${$g}.${Vg}`,{timeItem:n}=Wc({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Lp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({payload:{tournamentId:e.tournamentId},topic:A0e}),{...se}}function Lde(t){let e=qc(t);if(!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=nLe({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function nLe({removePriorValues:t=!0,tournamentRecord:e,status:i=fc}){if(!e)return{error:Qe};let r=`${$g}.${Vg}`,{timeItem:n}=Wc({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Lp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({topic:Iz,payload:{tournamentId:e.tournamentId}}),{...se}}function Fde(t){let e=qc(t);if(!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=aLe({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function aLe({removePriorValues:t,tournamentRecord:e,status:i=fc}){if(!e)return{error:Qe};let r=`${$g}.${Vg}`,{timeItem:n}=Wc({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i].participants={published:!0},Lp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),bi({payload:{tournamentId:e.tournamentId},topic:Hae}),{...se}}function Bde(t){let e=qc(t);if(!Object.keys(e).length)return{error:dn};for(let i of Object.values(e)){let r=sLe({tournamentRecord:i,...t});if(r.error)return r}return{...se}}function sLe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=fc,eventIds:n=[]}){if(!i)return{error:Qe};let a=`${$g}.${Vg}`,{timeItem:s}=Wc({element:i,itemType:a}),o=s?.itemValue||{[r]:{}};return o[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Lp({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),bi({topic:Gae,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...se}}function $de({removePriorValues:t=!0,tournamentRecord:e,status:i=fc,event:r}){if(!e)return{error:Qe};if(!r)return{error:Or};let n=`${$g}.${Vg}`,{timeItem:a}=T1({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,lw({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),rD({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),bi({topic:yz,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...se}}var f3={};Ai(f3,{getEntryStatusReports:()=>lLe,getParticipantStats:()=>oLe,getStructureReports:()=>uLe,getVenuesReport:()=>pLe});function oLe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:Qe};if(o&&!Array.isArray(o))return{error:il};if(o=o??Ha({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:hm};let l=[];e&&l.push(e),r&&l.push(r);let c=l.length?{participantIds:l}:{participantTypes:[Co]},u=cn({participantFilters:c,tournamentRecord:n}).participants??[];if(!u.every(({participantType:S})=>S===Co))return{error:bl};l.length||l.push(...u.map(xi));let d=new Map,p=new Map,h=new Map,f=new Map,m=(S,D="")=>p.get(S)||p.set(S,{participantName:D,participantId:S,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(S);for(let S of u){let{participantId:D,individualParticipantIds:C}=S;f.set(D,C??[]),m(D,S.participantName)}if(r&&!f.get(r))return ce({result:{error:An},context:{teamParticipantId:r}});if(e&&!f.get(e))return ce({result:{error:An},context:{opponentParticipantId:e}});let g=[],v=S=>{let D=[[],[]];for(let E of S){let P=E.participant;if(P?.participantName){d.set(P.participantId,{participantName:P.participantName,ratings:P.ratings});let R=p.get(P.participantId);R&&(R.participantName=P.participantName)}}let C=({side:E,individualParticipantIds:P})=>E.participantId&&(!P?.length||P.includes(E.participantId))&&[E.participantId]||E.participant?.individualParticipantIds?.length&&(!P?.length||Un(P,E.participant?.individualParticipantIds).length===E.participant?.individualParticipantIds?.length)&&E.participant.individualParticipantIds;if(f.size){let E=(P,R)=>{for(let M of S){if(!M.participant)continue;let A=C({individualParticipantIds:R,side:M});if(A?.length){let N=M.sideNumber;if(!N)continue;let k=[P];i&&k.push(...A),D[N-1]=k;let x=p.get(P);for(let O of A.filter(Boolean))x&&!x.competitorIds.includes(O)&&x.competitorIds.push(O)}}};if(r)(!e||S.every(P=>P.participant&&(C({individualParticipantIds:f.get(r),side:P})||C({individualParticipantIds:f.get(e),side:P}))))&&E(r,f.get(r));else for(let[P,R]of f)E(P,R)}else if(i)for(let E of S){if(!E.participant)continue;let P=C({individualParticipantIds:[],side:E}),R=E.sideNumber;R&&(D[R-1]=P)}return D};for(let S of o){if(!ji(S))return{error:il};let{matchUpStatus:D,matchUpFormat:C,matchUpType:E,winningSide:P,score:R,sides:M}=S;if(!M||!R||E===rc||D==="BYE")continue;let A=v(M);if(!A.filter(Boolean).length)continue;let N=t&&P&&A1({matchUp:S})?.competitiveness;g.push(S);let k=dq({matchUpStatus:D,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:R}),x=Aoe({matchUpStatus:D,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:R}),{pointsTally:O,tiebreaksTally:V}=_oe({matchUpFormat:C,score:R});A.forEach((F,j)=>{for(let q of F){let W=d.get(q)?.participantName,z=m(q,W);if(z){let H=(ne,le)=>le.forEach((re,me)=>z[ne][me]+=re),Z=j?[...V].reverse():V,J=j?[...O].reverse():O,ie=j?[...x].reverse():x,K=j?[...k].reverse():k;if(H("tiebreaks",Z),H("points",J),H("games",ie),H("sets",K),P){let ne=P-1===j?0:1;z.matchUps[ne]+=1}if(N){let ne=N.toLowerCase();z.competitiveness[ne]||(z.competitiveness[ne]=[0,0]),z.competitiveness[ne][j]+=1}if(D){let ne=D.toLowerCase();z.matchUpStatuses[ne]||(z.matchUpStatuses[ne]=0),z.matchUpStatuses[ne]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,w=(S,D)=>(S??0)+(D??0);for(let[S,D]of p.entries()){for(let C of y){let E=D[C].reduce(w);if(E){let P=D[C][0]/E,R=`${C}Ratio`,M=parseFloat(P.toFixed(2));D[R]=M,h.set(S,!0),I.has(R)||I.set(R,[]),I.get(R)?.push(M)}}for(let C of b){let E=D.competitiveness?.[C]?.reduce(w);if(E){let P=D.competitiveness[C][0]/E,R=`${C}Ratio`,M=parseFloat(P.toFixed(2));D[R]=M}}}if(!r){let S=(D,C)=>C-D;for(let D of p.values())for(let C of y){let E=`${C}Ratio`;if(typeof D[E]=="number"){let P=I.get(E)?.sort(S).indexOf(D[E]);if(typeof P=="number"&&P>=0){let R=`${C}Rank`;D[R]=P+1}}}}let T={relevantMatchUps:g,...se};return r?(T.teamStats=p.get(r),e&&(T.opponentStats=p.get(e))):T.participatingTeamsCount=h.size,T.allParticipantStats=[...p.values()],T}function VA({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:c})=>c==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function lLe({tournamentRecord:t}){if(!t)return{error:Qe};let e=t.tournamentId,{participantMap:i}=cn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Ha({matchUpFilters:{matchUpTypes:[Nb,Wv]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h?.flatMap(m=>f===Wv?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:w}=f;a[h]||(a[h]=[]);let{participant:T,events:S}=i?.[h]??{},D=VA({participant:T,eventType:g}),C=S?.[m]?.ranking;b===sq&&n.push(h),a[h].push({participantType:T?.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:b,entryStage:I,...D,ranking:C,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:D,entries:C}=S;l+=1;let E=({stage:A,stageSequence:N})=>A===Ut&&N===1||A===Ht,P=(S.structures??[]).filter(E).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>P.includes(A),M=A=>{let{participantId:N,entryStatus:k,entryStage:x}=A;m(k);let O=i?.[N]?.draws?.[D]?.seedAssignments?.[Ut];return{qualifyingSeeding:i?.[N]?.draws?.[D]?.seedAssignments?.[Ht],participantId:N,mainSeeding:O,entryStatus:k,entryStage:x,drawId:D}};return C?.filter(R).map(M)}),I=S=>{let D=S.participantId,C=i?.[D].participant.individualParticipantIds?.filter(E=>r.includes(E));return D&&{[D]:{individualParticipantIds:C}}};v===jf?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),D=C=>{S[C.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:C})})};b.forEach(D)})():b.forEach(S=>{c({id:S?.participantId,eventType:v,eventId:y,entry:S})});let w=Object.values(f).reduce((S,D)=>S+D.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/w*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let T=Object.assign({},...Xu.flatMap(S=>[{[S+"_count"]:f[S]?.count},{[S+"_pct"]:f[S]?.pct}]));s[y]={tournamentId:e,eventId:y,...T}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Li&&f===ms),d=u.filter(({participant:h})=>!r.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function cLe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=f=>{let m=f?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===r).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>VA({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(o.length-l.length)/o.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l?.length?u.totalWTN/l.length:0,p=l?.length?u.totalConfidence/l.length:0,h=Object.values(n).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function uLe(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:gT};let a=[],s={},o={},l=[],c=Object.assign({},...(i??[]).map(({name:m,label:g,accessor:v})=>{let y=Pi({element:e,name:m})?.extension?.value,b=v?_b({element:y,accessor:v})?.value:y;return{[g??m]:b}})),u=e?.tournamentId,d=Ha({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],p=m=>Wc({itemType:lz,itemSubTypes:[ch],element:{timeItems:m}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:m})=>{m?.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions??[g.drawPosition];s[v]??=[],s[v].push(`${y}: ${b.join("/")}`)})},f=e?.events?.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:w})=>{let T=v?.find(A=>A.name===Vu)?.value?.flights?.map(A=>({[A.drawId]:A.flightNumber})),S=T&&Object.assign({},...T),D=v?.find(A=>A.name===Ov),C=m?.find(A=>A.itemType===Ov),E=D?.value?.length??C?.itemValue??0,P=Object.values(S??{}),R=S&&Math.min(...P),M=p(m);return o[I]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:u,eventId:I},g.filter(A=>!r||!T||S[A.drawId]===R).flatMap(A=>{let{matchUpFormat:N,tieFormat:k,timeItems:x,extensions:O,structures:V,drawName:F,drawType:j,drawId:q}=A,{matchUpFormatCounts:W,matchUpsCount:z,avgConfidence:H,pctNoRating:Z,avgWTN:J}=cLe({eventType:y,matchUps:d,drawId:q}),ie=p(x)??M,K=dLe({extensions:O}),ne=K?.length??0;return h({positionManipulations:K}),o[I].totalPositionManipulations+=ne,o[I].generatedDrawsCount+=1,ne>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=ne),V?.filter(le=>(le.stageSequence===1||!n)&&[Ht,Ut,bs,In].includes(le.stage)).map(le=>{let re=[Ut,In].includes(le.stage)?d.find(wt=>wt.structureId===le.structureId&&wt.finishingRound===1&&wt.winningSide):void 0;le.stage===Ut&&a.push({eventName:b,drawName:F,structureId:le.structureId});let me=re?.sides?.find(wt=>wt.sideNumber===re.winningSide)?.participant,he=me?.participantType===Co&&me.participantId,Ie=me?.participantType===Di?me.individualParticipants:[],Le=VA({participant:Ie?.[0]??me,eventType:y}),{personId:ot,personOtherId:at,tennisId:dt,confidence:It,wtnRating:ze}=Le||{},Ct=VA({participant:Ie?.[1],eventType:y}),{personId:ke,personOtherId:mt,tennisId:Be,confidence:ut,wtnRating:it}=Ct||{},{ageCategoryCode:xe,categoryName:Ze,subType:st}=w??{},qe=le.matchUpFormat??N,ft=(W[qe]??0)/z*100,{tieFormatName:_t,tieFormatDesc:ve}=kA(k),{tieFormatName:$e,tieFormatDesc:De}=kA(le.tieFormat),je=ve===De,Oe=!je&&$e,nt=le.tieFormat&&!je&&De,Fe=K?.filter(wt=>wt.structureId===le.structureId)?.length??0;return{...c,tournamentId:u,eventId:I,structureId:le.structureId,drawId:q,eventType:y,category:st,categoryName:Ze,ageCategoryCode:xe,flightNumber:S?.[q],drawType:j,stage:le.stage,seedingBasis:ie?JSON.stringify(ie):void 0,winningPersonId:ot,winningPersonOtherId:at,winningPersonTennisId:dt,winningPersonWTNrating:ze,winningPersonWTNconfidence:It,winningPerson2Id:ke,winningPerson2OtherId:mt,winningPerson2TennisId:Be,winningPerson2WTNrating:it,winningPerson2WTNconfidence:ut,winningTeamId:he,positionManipulations:Fe,pctNoRating:Z,matchUpFormat:qe,pctInitialMatchUpFormat:ft,matchUpsCount:z,drawTieFormatName:_t,drawTieFormatDesc:ve,tieFormatName:Oe,tieFormatDesc:nt,avgConfidence:H,avgWTN:J}})})});return a.forEach(({eventName:m,drawName:g,structureId:v})=>{s[v]?.length&&l.push({eventName:m,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:f,flightReports:l}}function dLe({extensions:t}){return t?.find(({name:e})=>e===iT)?.value?.slice(1)}function pLe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:be,dates:n};if(!Array.isArray(r))return{error:be,venueIds:r};if(!(e&&Object.keys(e).filter(u=>!i||u===i)||[]).length)return{error:dn};if(!n.every(el))return{error:xa};let a=bm({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:u})=>!r?.length||r.includes(u)),o=a.courts?.reduce((u,d)=>(d.dateAvailability?.forEach(p=>{let h=p.date;u.includes(h)||u.push(h)}),u),[]).filter(u=>!n.length||n.includes(u)),l={venueIds:s?.map(({venueId:u})=>u)},{matchUps:c}=Ud({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(u=>hLe(o,u,c))}}function hLe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,c=0,u=0;for(let h of n){let f=h.dateAvailability.find(g=>g.date===o),m=(f&&aD({courtDate:f}).timeSlots)?.reduce((g,v)=>{let{startTime:y,endTime:b}=v,I=Xi(b)-Xi(y);return g+I},0);m&&(u+=1),l+=m}let d=i.filter(({schedule:h})=>h.venueId===r&&Uh(o,h.scheduledDate));d.forEach(({schedule:h})=>{let f=Gr(h.scheduledTime),m=Jo(f,h.averageMinutes),g=Xi(m)-Xi(f);c+=g});let p=l?(c/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var m3={};Ai(m3,{addMatchUpCourtOrder:()=>WW,addMatchUpEndTime:()=>KW,addMatchUpOfficial:()=>Cue,addMatchUpResumeTime:()=>XW,addMatchUpScheduleItems:()=>Ix,addMatchUpScheduledDate:()=>yx,addMatchUpScheduledTime:()=>Hg,addMatchUpStartTime:()=>YW,addMatchUpStopTime:()=>ZW,addSchedulingProfileRound:()=>c3,allocateTeamMatchUpCourts:()=>bx,assignMatchUpCourt:()=>pw,assignMatchUpVenue:()=>oD,bulkRescheduleMatchUps:()=>Yde,bulkScheduleMatchUps:()=>mR,bulkScheduleTournamentMatchUps:()=>eC,bulkUpdateCourtAssignments:()=>Hde,calculateScheduleTimes:()=>g3,clearMatchUpSchedule:()=>Zde,clearScheduledMatchUps:()=>Tx,courtGridRows:()=>rx,findMatchUpFormatTiming:()=>ex,findVenue:()=>Xh,generateBookings:()=>Sx,generateVirtualCourts:()=>hx,getMatchUpsToSchedule:()=>QO,getPersonRequests:()=>By,getProfileRounds:()=>ix,getScheduledRoundsDetails:()=>aR,getSchedulingProfile:()=>Im,getSchedulingProfileIssues:()=>oW,matchUpScheduleChange:()=>Kde,modifyMatchUpFormatTiming:()=>CW,mutate:()=>Vde,proAutoSchedule:()=>Gde,proConflicts:()=>qde,publicFindCourt:()=>kz,query:()=>Pce,removeEventMatchUpFormatTiming:()=>ux,removeMatchUpCourtAssignment:()=>jde,reorderUpcomingMatchUps:()=>Wde,scheduleMatchUps:()=>zde,scheduleProfileRounds:()=>Ux,setMatchUpDailyLimits:()=>Xde,setMatchUpHomeParticipantId:()=>qW,setSchedulingProfile:()=>eD,toggleParticipantCheckInState:()=>mx,validateSchedulingProfile:()=>tx});var Vde={};Ai(Vde,{addMatchUpCourtOrder:()=>WW,addMatchUpEndTime:()=>KW,addMatchUpOfficial:()=>Cue,addMatchUpResumeTime:()=>XW,addMatchUpScheduleItems:()=>Ix,addMatchUpScheduledDate:()=>yx,addMatchUpScheduledTime:()=>Hg,addMatchUpStartTime:()=>YW,addMatchUpStopTime:()=>ZW,addSchedulingProfileRound:()=>c3,allocateTeamMatchUpCourts:()=>bx,assignMatchUpCourt:()=>pw,assignMatchUpVenue:()=>oD,bulkRescheduleMatchUps:()=>Yde,bulkScheduleMatchUps:()=>mR,bulkScheduleTournamentMatchUps:()=>eC,bulkUpdateCourtAssignments:()=>Hde,calculateScheduleTimes:()=>g3,clearMatchUpSchedule:()=>Zde,clearScheduledMatchUps:()=>Tx,findMatchUpFormatTiming:()=>ex,generateBookings:()=>Sx,generateVirtualCourts:()=>hx,matchUpScheduleChange:()=>Kde,modifyMatchUpFormatTiming:()=>CW,proAutoSchedule:()=>Gde,proConflicts:()=>qde,removeEventMatchUpFormatTiming:()=>ux,removeMatchUpCourtAssignment:()=>jde,reorderUpcomingMatchUps:()=>Wde,scheduleMatchUps:()=>zde,scheduleProfileRounds:()=>Ux,setMatchUpDailyLimits:()=>Xde,setMatchUpHomeParticipantId:()=>qW,setSchedulingProfile:()=>eD,toggleParticipantCheckInState:()=>mx,validateSchedulingProfile:()=>tx});function g3({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:dn};s=s??fx({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=bm({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d?.filter(E=>!c||c.includes(E.venueId));l||(l=h?.reduce((E,P)=>{let R=P.dateAvailability?.find(M=>!M.date||Uh(o,M.date))?.startTime??P.startTime;return R&&(!E||Xi(R)<Xi(E))?R:E},void 0)),u||(u=h?.reduce((E,P)=>{let R=P.dateAvailability?.find(M=>!M.date||Uh(o,M.date))?.endTime??P.endTime;return R&&(!E||Xi(R)>Xi(E))?R:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:R}=U1({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:R}}})).flat()),g=lR({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),v=g?.dateMatchUps??[],y=g?.completedMatchUps??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},w=b?.map(({eventId:E,schedule:P,matchUpFormat:R})=>{let{event:M,scheduleTiming:A}=m[E],N=M?.eventType,k={...A,defaultTiming:I,matchUpFormat:R},{averageMinutes:x,recoveryMinutes:O}=vO({eventType:N,timingDetails:k}),{courtId:V,venueId:F}=P,j=Gr(P.scheduledTime),q=Jo(j,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:s,startTime:j,endTime:q,courtId:V,venueId:F}}),T={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:u,bookings:w,courts:h},{scheduleTimes:S}=BW(T),D=c?.length===1&&c[0]||p?.length===1&&p[0].venueId||void 0,C=b.map(Ea);return{venueId:D,scheduleTimes:S,dateScheduledMatchUpIds:C}}function jde(t){let e=jt(t,[{[xs]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,c=r[n];if(!c)return{error:Qe};let{drawDefinition:u,event:d}=Gg({tournamentRecord:c,drawId:l});if(!u)return{error:Nt};let p=Hr({drawDefinition:u,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===rc){let{itemValue:h}=Oy({timeItems:p.matchUp.timeItems??[],itemType:Ah}),f=o&&h.filter(m=>m.courtId!==o);return Ml({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:s,timeItem:{itemType:Ah,itemValue:f}})}else return pw({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:s})}function Gde({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!Kc(r))return{error:be};if(r.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:_k};let n=lR({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,s=[],o=h=>[(h.sides||[]).map(f=>[f.participantId,f.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a?.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(ji(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>ji(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!Hn.includes(h))).sort(tw);let c=Qu({matchUps:r.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;r.length&&l.length;){let h=l.shift(),f=[];for(;r.length&&h.availableCourts.length;){let m=r.concat(f).map(D=>D.matchUpId),g=r.shift(),v=g?.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(D=>c[v].matchUpIds.includes(D)),I=v&&d.some(D=>c[v].dependentMatchUpIds.includes(D)),w=h.matchUpIds.some(D=>y.includes(D)),T=o(g),S=h.participantIds.some(D=>T.includes(D));if(g&&!w&&!b&&!S&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),u.push(g),h.participantIds.push(...T),h.matchUpIds.push(v)}else g&&f.push(g)}r.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return n=mR({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:u,notScheduled:r}}function Hde(t){let{courtDayDate:e}=t,i=jt(t,[{courtAssignments:!0,[Fo]:Cs,[sc]:Wt},{[xs]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[xs][a];if(!s)return n={error:Qe},!1;let o=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=_o({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=pw({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h?.success;n={error:Xre}}),!0):(n={error:Nt},!1)})}),n||se}function zde(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=jt(t,[{[xs]:!0,[v1]:!0},{[ds]:el,[sc]:xa,[r0e]:!0},{[ds]:H=>!H||!isNaN(H),[o0e]:!1,[sc]:be,[l0e]:!1,[c0e]:!1}]);if(I.error)return I;let w=t.competitionMatchUps??Ud({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],T=t.matchUpDependencies??Qu({includeParticipantDependencies:!0,matchUps:w,tournamentRecords:e}).matchUpDependencies;w.forEach(H=>{H.schedule?.scheduledDate&&Uh(f,Ti(H.schedule.scheduledDate))&&kT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:H})});let S=m.map(H=>w.find(Z=>Z.matchUpId===H)).filter(Boolean),{venueId:D,scheduleTimes:C,dateScheduledMatchUpIds:E}=g3({tournamentRecords:e,remainingScheduleTimes:d,startTime:Gr(v),endTime:Gr(y),scheduleDate:Ti(f),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},R=[],M={},A={},N={};w.filter(({matchUpId:H})=>E?.includes(H)).forEach(H=>{NV({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:H,value:1});let Z=H.schedule?.scheduledTime;if(Z){M[H.matchUpId]=Z;let J=a?.[H.matchUpId];QP({recoveryMinutes:J||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:T,scheduleTime:Z,matchUp:H})}});let k=S.filter(H=>{let Z=E?.includes(H.matchUpId),J=["BYE",yr,Sn,rl,Ia,xr].includes(H?.matchUpStatus);return!Z&&!H.winningSide&&!J}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:V}=k.reduce((H,Z)=>{let{drawId:J,tournamentId:ie,matchUpType:K}=Z,{participantIdsAtLimit:ne,relevantParticipantIds:le}=a3({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:Z});return ne?.length?(H.overLimitMatchUpIds.push(Z.matchUpId),H.participantIdsAtLimit.push(...ne),H):(le.forEach(re=>{hR({individualParticipantProfiles:o,participantId:re});let me=o[re].counters;me[K]?me[K]+=1:me[K]=1,me[Ru]?me[Ru]+=1:me[Ru]=1}),H.matchUpMap[ie]||(H.matchUpMap[ie]={}),H.matchUpMap[ie][J]?H.matchUpMap[ie][J].push(Z):H.matchUpMap[ie][J]=[Z],kT({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),H)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});k=k.filter(({matchUpId:H})=>!O.includes(H));let F=0,j=C?.length??0,{personRequests:q}=By({tournamentRecords:e,requestType:fR});for(;C?.length&&k.length&&F<=j;){F++;let{scheduleTime:H}=C.shift(),Z=k.find(J=>{let{matchUpId:ie}=J,{dependenciesScheduled:K,remainingDependencies:ne}=i3({matchUpScheduleTimes:M,matchUpDependencies:T,allDateMatchUpIds:i,matchUp:J});if(!K)return N[ie]||(N[ie]=[]),N[ie].push({scheduleTime:H,remainingDependencies:ne}),!1;let{enoughTime:le}=n3({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:T,scheduleTime:H,matchUp:J});if(!le)return A[ie]||(A[ie]=[]),A[ie].push({scheduleTime:H}),!1;let{conflicts:re}=r3({potentials:u,averageMatchUpMinutes:r,requestConflicts:P,personRequests:q,scheduleTime:H,scheduleDate:f,matchUp:J});if(re?.length)return!1;let me=a?.[J.matchUpId];return QP({recoveryMinutes:me||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:T,scheduleTime:H,matchUp:J}),M[J.matchUpId]=H,!0});k=k.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z||R.push(H)}k.forEach(H=>{NV({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:H})});let W=[];Object.keys(x).forEach(H=>{let Z=e[H];Z&&Object.keys(x[H]).forEach(J=>{let{drawDefinition:ie}=Gg({tournamentRecord:Z,drawId:J});ie&&x[H][J].forEach(({matchUpId:K})=>{let ne=M[K];if(ne){let le=ne.split(":").map(Nc).join(":"),re=`${Ti(f)}T${le}`;b?W.push(K):(Hg({drawDefinition:ie,matchUpId:K,scheduledTime:re}).success&&W.push(K),D&&oD({tournamentRecords:e,tournamentRecord:Z,drawDefinition:ie,matchUpId:K,venueId:D}))}})})});let z=ez(k);return{...se,requestConflicts:Object.values(P),remainingScheduleTimes:C?.map(({scheduleTime:H})=>H),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:V,skippedScheduleTimes:R,overLimitMatchUpIds:O,scheduledMatchUpIds:W,noTimeMatchUpIds:z,recoveryTimeDeferred:A,dependencyDeferred:N}}function qde({tournamentRecords:t,matchUps:e}){if(!Kc(e))return{error:hm};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:_k};let i=Math.max(...e.map(({schedule:h})=>h?.courtOrder||1).map(h=>ii(h))),r=vt(1,i+1).map(h=>e.filter(f=>ii(f.schedule?.courtOrder)===h)),n={},a={},s={};r.flat().filter(Boolean).sort(tw).forEach(({schedule:h})=>delete h[gN]);let o=vi(e.map(({drawId:h})=>h)),l=Qu({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=r.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:w,potentialParticipants:T}=g,S=I?.courtId;n[v]=f,a[S]=[],m.matchUpIds.push(v),s[v]=g;let D=l[v].matchUpIds;D.length&&m.sourceMatchUpIds.push(...D);let C=w?.map(P=>[P.participant?.individualParticipantIds,P.participantId]).flat().filter(Boolean)??[],E=T?.flat().map(({individualParticipantIds:P,participantId:R})=>[P,R]).flat().filter(Boolean)||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[gN]){s[h].schedule[gN]=f,s[h].schedule[Ise]=g,d[n[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Ul(h.participantIds),b=Object.keys(y).filter(T=>y[T]>1),I=h.matchUpIds.filter(T=>l[T].participantIds.some(S=>b.includes(S)));I.forEach(T=>{v[T]||(v[T]={}),v[T][mv]||(v[T][mv]=I.filter(S=>S!==T))});let w=m&&h.participantIds.filter(T=>m.participantIds.includes(T));w&&w.forEach(T=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(D=>l[D].participantIds.includes(T));S.forEach(D=>{v[D]||(v[D]={}),v[D][gv]||(v[D][gv]=S.filter(C=>C!==D))})}),h.matchUpIds.forEach(T=>{let S=l[T].matchUpIds;for(let C of g){let E=C.matchUpIds.filter(P=>S.includes(P));E?.length&&(E.forEach(P=>p(P,lV,zm,[T])),p(T,lV,zm,E))}if(v[T]?.[mv]&&p(T,mv,oV,v[T][mv]),h.sourceMatchUpIds.includes(T)){let C=h.matchUpIds.filter(E=>l[E].matchUpIds.includes(T));p(T,mv,zm,C),h.matchUpIds.filter(E=>l[E].matchUpIds.includes(T)).forEach(E=>p(E,mv,zm,[T]))}let D=m?.matchUpIds?.filter(C=>u(T,C)>1);if(D?.length&&(p(T,cV,zm,D),D.forEach(C=>p(C,cV,zm,[T]))),v[T]?.[gv]&&p(T,gv,oV,v[T][gv]),m?.targetMatchUpIds?.includes(T)){let C=s[T].schedule.courtId,E=S.filter(P=>m.matchUpIds.includes(P));E.some(P=>s[P].schedule.courtId===C)||(E.forEach(P=>p(P,gv,zm,[T])),p(T,gv,zm,E))}})}),{courtIssues:a,rowIssues:d}}function Wde(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ce({result:{error:dn},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ce({result:{error:Wt},stack:e});let a=r?.length;if(!a)return{...se};let s=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(n?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=r[h].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?se:ce({result:{error:Zre},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Gg({tournamentRecord:p,drawId:d});return h?Hg({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:nc}}}function Yde(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:xI};if(typeof e!="object")return{error:be};let n=qc(t),a=[],s=[];for(let l of Object.values(n)){let c=fLe({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(c.error)return c;Array.isArray(c.notRescheduled)&&s.push(...c.notRescheduled);let u=ez(c.notRescheduled),d=[];c.rescheduled?.forEach(p=>{let{matchUpId:h}=p;u.includes(h)&&d.push(h),a.push(p)}),d.length&&(s=c?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...se,rescheduled:a,notRescheduled:s,allRescheduled:o}}function fLe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:Qe};if(!i||!Array.isArray(i))return{error:xI};if(typeof e!="object")return{error:be};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...se};if(s&&isNaN(s))return{error:be};if(o&&isNaN(o))return{error:be};let{matchUps:l}=Ha({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:I})=>!Hn.includes(I),u=l?.filter(I=>oR({schedule:I.schedule})).filter(I=>c({matchUpStatus:I.matchUpStatus}));if(!u?.length)return{...se};let{tournamentInfo:d}=uw({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u?.reduce((I,w)=>{let{matchUpId:T,drawId:S}=w;return I[S]?I[S].push(T):I[S]=[T],I},{}),m=1440;for(let I of Object.keys(f)){let w=Gg({tournamentRecord:t,drawId:I});if(w.error)return w;let T=w.drawDefinition,S=f[I].filter(D=>i.includes(D));for(let D of S)if(D&&T){let C=u.find(N=>N.matchUpId===D)?.schedule,{scheduledTime:E,scheduledDate:P}=C,R,M,A;if(!R&&o&&P){let N=Ti(P);A=DE(N,o),R=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(s&&E){let N=Ti(E),k=Xi(Gr(E))+s;if(R=k<0||k>m,!R){let x=Jo(E,s),O=N&&A||P===N&&N;M=O?`${O}T${x}`:x}}if(R)a.push(D);else{if(!r){if(M){let N=Hg({scheduledTime:M,drawDefinition:T,matchUpId:D});if(N.error)return N}if(A){let N=yx({scheduledDate:A,drawDefinition:T,matchUpId:D});if(N.error)return N}}(M||A)&&n.push(D)}}}let g=Ha({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:I})=>n.includes(I)),y=g.filter(({matchUpId:I})=>a.includes(I)),b=v.length&&!y.length;return{...se,rescheduled:v,notRescheduled:y,allRescheduled:b}}function Kde(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:dn};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:h}=n||{};if(!c&&!p)return ce({result:{error:Wt},stack:e});let{matchUps:f}=Ud({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f?.find(({matchUpId:I})=>I===c),g=f?.find(({matchUpId:I})=>I===p),v=0;if(s&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I?.success&&v++,I.error)return ce({result:I,stack:e})}else if(a&&s&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return ce({result:I,stack:e,info:"source"});let w=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(w.success&&v++,w.error)return ce({result:w,stack:e,info:"target"})}else return{error:Wt};return v?se:ce({result:{error:xU},stack:e});function y(I){let{tournamentRecords:w,tournamentId:T,matchUp:S,drawId:D}=I,C=w[T],{drawDefinition:E}=Gg({tournamentRecord:C,drawId:D});return S.matchUpType===_r?b({...I,tournamentRecord:C,drawDefinition:E}):pw({...I,tournamentRecord:C,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:w,tournamentRecord:T,drawDefinition:S,sourceCourtId:D,courtDayDate:C,matchUpId:E,matchUp:P,courtId:R}){let M=[R].concat(P.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==D));return bx({removePriorValues:I,tournamentRecords:w,tournamentRecord:T,drawDefinition:S,courtDayDate:C,matchUpId:E,courtIds:M})}}function Zde({scheduleAttributes:t=[Ah,pg,KI,ZI,XI,ud,Yf,uh,kf],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?lo({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Ha({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:Os};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Gi({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...se}}function Xde(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:dn};if(typeof r!="object")return{error:fm};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:be};for(let s of a){let o=n[s],l=ir({extension:{name:b1,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...se}}var v3={};Ai(v3,{addCollectionDefinition:()=>I3,addCollectionGroup:()=>rpe,aggregateTieFormats:()=>ape,compareTieFormats:()=>Kf,getTieFormat:()=>ZO,modifyCollectionDefinition:()=>y3,modifyTieFormat:()=>npe,mutate:()=>Jde,orderCollectionDefinitions:()=>tpe,query:()=>bce,removeCollectionDefinition:()=>b3,removeCollectionGroup:()=>epe,tieFormatGenderValidityCheck:()=>Vk,validateCollectionDefinition:()=>h1});var Jde={};Ai(Jde,{addCollectionDefinition:()=>I3,addCollectionGroup:()=>rpe,aggregateTieFormats:()=>ape,modifyCollectionDefinition:()=>y3,modifyTieFormat:()=>npe,orderCollectionDefinitions:()=>tpe,removeCollectionDefinition:()=>b3,removeCollectionGroup:()=>epe});function sy({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:Nt};if(a&&s)l=Hd(s);else if(i){if(t&&(!n||!r)){let c=Hr({drawDefinition:t,matchUpId:i});if(c.error)return c;if(c.matchUp?.matchUpType!==rc)return ce({result:{error:il},stack:o});r||(r=c.structure),n||(n=c.matchUp)}l=$E({item:n,drawDefinition:t,structure:r,event:s})||$E({item:r,drawDefinition:t,structure:r,event:s})||Hd(t)||Hd(s)}else if(t&&e){if(!r){let c=si({drawDefinition:t,structureId:e});if(c.error)return c;r=c?.structure}l=$E({item:r,drawDefinition:t,structure:r,event:s})||Hd(t)||Hd(s)}else l=Hd(t)||Hd(s);return l?{...se,structure:r,tieFormat:l,matchUp:n}:ce({result:{error:_U},stack:o})}function jA({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Hn].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Zu&&!sa(t))}function H2({from:t,to:e}){let i=Object.keys(t),r=Un(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function mLe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let c="updateTieFormat",u=e?.tournamentId,d=0,p=0,h=0,f=0,m=n?.collectionDefinitions.reduce((T,S)=>(T[S.collectionId]=(T[S.collectionId]||0)+S.matchUpCount,T),{}),g=({tieFormat:T})=>{let S=T?.collectionDefinitions.reduce((D,C)=>(D[C.collectionId]=(D[C.collectionId]||0)+C.matchUpCount,D),{});return H2({from:S,to:m}).equivalent},v=sy({drawDefinition:i})?.tieFormat,y=sy({event:o})?.tieFormat;if(o&&a){for(let T of o.drawDefinitions??[])b({drawDefinition:T});o.tieFormat=os(n),f+=1}else if(s){if(!s.tieMatchUps)return ce({result:{error:il},stack:c});let T=Ul(s.tieMatchUps?.map(({collectionId:P})=>P)),S=H2({to:m,from:T}),{changes:D,changesArePossible:C,cannotChangeReaon:E}=fK({matchUp:s,check:S});if(S.equivalent)if(jA({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=os(n),f+=1;else return ce({result:{error:cH},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(C)w({tieFormat:n,matchUp:s,changes:D,uuids:l});else return ce({context:{collectionMap:m,matchUpMap:T},result:{error:oh},info:E||"specified changes not possible",stack:c});p+=1,Gi({eventId:o?.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:s})}else if(r){let T=I({inheritedTieFormat:v??y,structure:r})?.modifiedMatchUpsCount;T&&(p+=T,d+=1,f+=1);let S=!r.tieFormat||Kf({ancestor:r.tieFormat,descendant:n}).different;S&&(r.tieFormat=os(n),d+=1,f+=1),(T||S)&&i&&Pr({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=os(n),f+=1;else return{error:Nt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...se,tieFormat:n};function b({drawDefinition:T}){let S=T.structures||[],D=[];for(let C of S){if(C.tieFormat)continue;let E=I({inheritedTieFormat:y,structure:C})?.modifiedMatchUpsCount;if(E){d+=1,p+=E;let P=C.structureId;D.push(P)}}return Pr({structureIds:D,eventId:o?.eventId,drawDefinition:T}),D.length}function I({inheritedTieFormat:T,structure:S}){let D=0,C=rr({matchUpFilters:{matchUpTypes:[_r]},structure:S})?.matchUps||[];for(let E of C){let P=jA({matchUp:E,updateInProgressMatchUps:t}),R=!1,M=Ul(E.tieMatchUps?.map(({collectionId:N})=>N)),A=H2({from:M,to:m});if(A.equivalent)E.tieFormat&&g(E)&&P&&(E.tieFormat=os(n),R=!0);else{let{changes:N,changesArePossible:k}=fK({matchUp:E,check:A});if(k&&!E.tieFormat)w({changes:N,matchUp:E,tieFormat:n,uuids:l});else if(T)(!E.tieFormat||Kf({ancestor:T,descendant:E.tieFormat}).different)&&(E.tieFormat=T,R=!0);else return ce({result:{error:_U},stack:c})}R&&(D+=1,Gi({tournamentId:e?.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:E}))}return{modifiedMatchUpsCount:D}}function w({uuids:T,matchUp:S,tieFormat:D,changes:C}){S.tieFormat=os(D);let E=[],P=[];return C.forEach(R=>{if(R.countChange>0){let M=Math.max(0,...S.tieMatchUps.filter(k=>k.collectionId===R.collectionId).map(Rl("collectionPosition"))),A=D.collectionDefinitions.find(k=>k.collectionId===R.collectionId),N=W1({matchUpsLimit:R.countChange,collectionPositionOffset:M,collectionDefinition:A,matchUp:S,uuids:T});P.push(...Tt(N,!1,!0)),h+=P.length,S.tieMatchUps.push(...N)}else{let M=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",M.length),E.push(...M),S.tieMatchUps=S.tieMatchUps.filter(({matchUpId:A})=>!M.includes(A))}}),P.length&&cg({matchUps:P,drawDefinition:i,tournamentId:u,eventId:a}),E.length&&Zh({matchUpIds:E,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:E,matchUpsAdded:P}}}function fK({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Dn).map(Rl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function Rx({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[BE])return;let{extension:r}=Pi({name:BE,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:BE};ir({element:e,extension:n})}function y3({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let w="modifyCollectionDefinition";if(s&&!Dl({matchUpFormat:s}))return ce({result:{error:be},context:{matchUpFormat:s},stack:w});if(r&&typeof r!="string")return ce({result:{error:be},context:{collectionName:r},stack:w});if(f&&!Object.values(_p).includes(f))return ce({result:{error:be},context:{gender:f},stack:w});if(p&&typeof p!="object")return ce({result:{error:be},context:{category:p},stack:w});let T={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(T).filter(Boolean).length&&!i&&!r&&!s&&!o&&!c)return ce({result:{error:Wt},stack:w});if(Object.values(T).filter(Boolean).length>1)return ce({info:"Only one value assignment allowed per collectionDefinition",result:{error:be},stack:w});let S=sy({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return ce({result:S,stack:w});let{matchUp:D,structure:C,tieFormat:E}=S,P=os(E),R=E?.collectionDefinitions.find(W=>W.collectionId===l),M=P?.collectionDefinitions.find(W=>W.collectionId===l);if(!R)return ce({info:"source collectionDefinition",result:{error:ja},context:{collectionId:l},stack:w});let A=v??y??b??I;if(g?.length){let W=Xie({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(W.errors)return ce({result:{error:be},info:W.errors,stack:w})}else if(A&&!fi(A))return ce({result:{error:be},info:"value is not an integer",context:{value:A},stack:w});let N=(W,z)=>Un(Object.keys(W),Object.keys(z)).length===Object.keys(W).length&&Un(Object.values(W),Object.values(z)).length===Object.values(W).length,k=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),x=fi(v)&&R.collectionValue!==v||fi(y)&&R.matchUpValue!==y||fi(b)&&R.scoreValue!==b||fi(I)&&R.setValue!==I||k,O=[];if(x&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,T),O.push({collectionId:l,...Lt(T)})),(fi(b)||fi(I))&&M.collectionGroupNumber){let W=M.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(z=>{let{collectionGroupNumber:H,...Z}=z;return H===W?Z:z}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:z})=>z!==W),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:V,valueGoal:F}=dw(P),j=Lt({aggregateValue:V,valueGoal:F});if((j.aggregateValue!==E?.winCriteria.aggregateValue||j.valueGoal!==E?.winCriteria.valueGoal)&&(P.winCriteria=j,O.push({collectionId:l,winCriteria:j})),fi(i)&&R.collectionOrder!==i&&(M.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(M.collectionName=r,O.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(M.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),fi(o)&&R.matchUpCount!==o&&(M.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),c&&R.matchUpType!==c)return ce({result:{error:xk},context:{matchUpType:c},stack:w});p&&R.category!==p&&(M.category=p,O.push({collectionId:l,category:p})),f&&R.gender!==f&&(M.gender=f,O.push({collectionId:l,gender:f}));let q=Lt(P);if(S=No({tieFormat:q}),S.error)return ce({result:S,stack:w});if(!O.length)return ce({result:{...se,modifications:O}});if(E?.tieFormatName!==n?(q.tieFormatName=n,O.push({tieFormatName:n})):O.length&&(delete q.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),S=mLe({tieFormat:q,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:D,event:m}),!S.error){let{appliedPolicies:W}=Qi({tournamentRecord:e}),z=Lt({collectionDefinition:M,drawId:a?.drawId,action:w,structureId:u,matchUpId:d,eventId:h});Rx({appliedPolicies:W,drawDefinition:a,auditData:z})}return ce({result:{...S,modifications:O},stack:w})}function gLe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=rr({matchUpFilters:{matchUpTypes:[_r]},structure:r})?.matchUps??[]:e&&(s=lo({matchUpFilters:{matchUpTypes:[_r]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Sn&&(t||o.matchUpStatus!==Zu&&!sa(o)))}}function vLe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=os(n));let l;if(t){let c=Qi({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=ym({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Gi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...se}}function Qde({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=dw(l);l.winCriteria=Lt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=gLe({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});vLe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Lt(l),v=No({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Nt};return Pr({drawDefinition:a,eventId:p?.eventId}),{...se}}function epe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:Wt};if(isNaN(e))return{error:be};let u="removeCollectionGroup",d=o?void 0:sy({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:c});if(d?.error)return ce({result:d,stack:u});let p=d?.structure;o=o??d?.matchUp;let h=d?.tieFormat,f=h?.winCriteria.valueGoal,m=h?.winCriteria.aggregateValue,g=os(h);if(d=No({tieFormat:g}),d.error)return ce({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=Qde({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:y}=Qi({tournamentRecord:i}),b=Lt({drawId:r?.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});Rx({appliedPolicies:y,drawDefinition:r,auditData:b})}return ce({result:{...d,modifiedCollectionIds:v},stack:u})}function xT({tieFormat:t,orderMap:e}){let i=os(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>mT(r.collectionOrder)-mT(n.collectionOrder)),i}function tpe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(u=>fi(u)))return ce({result:{error:be},context:{orderMap:n}});let l=i?si({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let c=l?.structure;if(a&&o?.tieFormat)mK({tournamentRecord:t,event:o,orderMap:n});else if(r){let u=e&&Hr({drawDefinition:e,matchUpId:r});if(u?.error)return u;if(s=u.matchUp,!s)return{error:Mo};let d=ZO({tournamentRecord:t,matchUpId:r,structure:c,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=xT({tieFormat:d,orderMap:n}),Gi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(c?.tieFormat)c.tieFormat=xT({tieFormat:c.tieFormat,orderMap:n}),ipe({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),Pr({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)AV({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)mK({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:ja};else if(e?.tieFormat)AV({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:ja};return{...se}}function mK({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=xT({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])AV({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function AV({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=xT({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=xT({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),ipe({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));Pr({drawDefinition:e,structureIds:o})}function ipe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=rr({matchUpFilters:{matchUpTypes:[_r]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=xT({tieFormat:s.tieFormat,orderMap:r}),Gi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function b3({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){let d="removeCollectionDefinition",p=c?void 0:sy({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:u});if(p?.error)return ce({result:p,stack:d});let h=p?.structure;c=c??p?.matchUp;let f=p?.tieFormat,m=os(f);if(p=No({tieFormat:m}),p.error)return ce({result:p,stack:d});let g=m?.collectionDefinitions?.find(P=>P.collectionId===a);if(!g)return ce({result:{error:ja,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(P=>P.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(P=>{let{collectionGroupNumber:R,...M}=P;return M}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:P})=>P!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=dw(m);m.winCriteria=Lt({aggregateValue:v,valueGoal:y});let b=f?.winCriteria.valueGoal,I=f?.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(n?m.tieFormatName=n:delete m.tieFormatName);let w=[];o&&c?w=[c]:s&&h?w=rr({matchUpFilters:{matchUpTypes:[_r]},structure:h})?.matchUps??[]:r?w=lo({matchUpFilters:{matchUpTypes:[_r]},drawDefinition:r})?.matchUps??[]:u&&(w=Jh({matchUpFilters:{matchUpTypes:[_r]}})?.matchUps??[]);let T=(w||[]).filter(P=>{let R=P.tieMatchUps?.filter(A=>A.collectionId===a)?.some(sa),M=e&&P.tieFormat?Kf({descendant:P.tieFormat,ancestor:m})?.different:!1;return t&&!R||!P.winningSide&&P.matchUpStatus!==Sn&&(t||P.matchUpStatus!==Zu&&!sa(P)&&!M)});if(!T.length)return{error:xU};let{appliedPolicies:S}=Qi({tournamentRecord:i});if(o&&c&&t){let P=c.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of P??[]){let M=lD({matchUpId:R.matchUpId,tieMatchUpId:c?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(M.error||(M=Hr({drawDefinition:r,matchUpId:o}),M.error))return M;c=M?.matchUp}}let D=[];for(let P of T){for(let R of P?.sides??[])R.lineUp=(R.lineUp??[]).map(M=>({participantId:M.participantId,collectionAssignments:(M?.collectionAssignments??[]).filter(A=>A.collectionId!==a)}));if(P.tieMatchUps=(P.tieMatchUps??[]).filter(R=>{let M=R.collectionId===a;return M&&D.push(R.matchUpId),!M}),P.tieFormat&&(P.tieFormat=os(m)),t){let R=ym({matchUpId:P.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(R.error)return R}Gi({tournamentId:i?.tournamentId,eventId:u?.eventId,drawDefinition:r,context:d,matchUp:P})}D.length&&Zh({tournamentId:i?.tournamentId,matchUpIds:D,eventId:u?.eventId,drawDefinition:r});let C=Lt(m);if(p=No({tieFormat:C}),p.error)return ce({result:p,stack:d});if(l&&u)u.tieFormat=C;else if(o&&c)c.tieFormat=C;else if(h)h.tieFormat=C;else if(r)r.tieFormat=C;else if(!c||!r)return{error:Nt};Pr({drawDefinition:r,eventId:u?.eventId});let E=Lt({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return Rx({appliedPolicies:S,drawDefinition:r,auditData:E}),{tieFormat:C,deletedMatchUpIds:D,targetMatchUps:T,...se}}function rpe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return ce({result:{error:Wt},stack:d});let p=l?void 0:sy({drawDefinition:r,structureId:s,matchUpId:o,eventId:c,event:u});if(p?.error)return ce({result:p,stack:d});let h=p?.structure;l=l||p?.matchUp;let f=p?.tieFormat,m=f?.winCriteria.valueGoal,g=os(f);if(p=No({tieFormat:g}),p.error)return ce({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&n.includes(b))return ce({info:"collectionIds cannot be part of other collectionGroups",result:{error:be},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Qde({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:c,event:u})}function I3({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){let g="addCollectionDefinition",v=Qi({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},y=n?.[Fa]??v?.[Fa];a=a??y?.participants?.enforceCategory;let b=(c??y?.participants?.enforceGender)!==!1,I=!!((i??m?.category)&&a!==!1),w=!!((s??m?.gender)&&b),T=h1({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:I,checkGender:w,event:m});if(T.error)return ce({result:T,stack:g});let S=p?.tieFormat?void 0:sy({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(S?.error)return ce({result:{error:S.error},stack:g});let D=S?.structure;p=p??S?.matchUp;let C=p?.tieFormat??S?.tieFormat,E=os(C);if(S=No({tieFormat:E}),S?.error)return ce({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=or();else if(E.collectionDefinitions.map(({collectionId:F})=>F).includes(e.collectionId))return ce({context:{collectionId:e.collectionId},result:{error:ene}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((F,j)=>(F.collectionOrder||0)-(j.collectionOrder||0)).forEach((F,j)=>F.collectionOrder=j+1);let{aggregateValue:P,valueGoal:R}=dw(E);E.winCriteria=Lt({aggregateValue:P,valueGoal:R});let M=C?.winCriteria.valueGoal,A=C?.winCriteria.aggregateValue;(M&&M!==R||P&&!A)&&(l?E.tieFormatName=l:delete E.tieFormatName);let N=[],k=[],x=[],O=Lt(E);if(S=No({tieFormat:O}),S?.error)return ce({result:{error:S.error},stack:g});if(h&&m){m.tieFormat=O;for(let F of m.drawDefinitions??[])if(!F.tieFormat)for(let j of F.structures??[]){if(j.tieFormat)continue;let q=z2({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});k.push(...q.newMatchUps),x.push(...q.targetMatchUps),N.push(j.structureId)}SM({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(u&&D){D.tieFormat=O;let F=z2({updateInProgressMatchUps:t,collectionDefinition:e,structure:D,uuids:f});k.push(...F.newMatchUps),x=F.targetMatchUps,SM({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(d&&p){if(!jA({matchUp:p,updateInProgressMatchUps:t}))return ce({result:{error:cH},stack:g});p.tieFormat=O;let F=W1({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...F),k.push(...F),SM({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(o){o.tieFormat=O;for(let F of o.structures??[]){let j=z2({updateInProgressMatchUps:t,collectionDefinition:e,structure:F,uuids:f});N.push(F.structureId),k.push(...j.newMatchUps),x.push(...j.targetMatchUps)}SM({modifiedMatchUps:x,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else return{error:Nt};let V=Lt({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});return Rx({appliedPolicies:v,drawDefinition:o,auditData:V}),{tieFormat:O,targetMatchUps:x,addedMatchUps:k,...se}}function z2({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(rr({matchUpFilters:{matchUpTypes:[_r]},structure:i})?.matchUps).filter(s=>jA({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=W1({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function SM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){cg({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Gi({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),Pr({structureIds:t,drawDefinition:r,eventId:a})}function npe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!No({tieFormat:i}).valid)return ce({result:{error:oh},info:"falied validation",stack:d});let p=sy({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return ce({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=os(f),g=Kf({descendant:i,ancestor:m,considerations:n});if(g.invalid)return ce({context:{invalid:g.invalid},result:{error:oh},stack:d});if(!g?.different)return ce({result:{...se},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:C})=>C),y=i.collectionDefinitions.map(({collectionId:C})=>C),b=v.filter(C=>!y.includes(C)),I=i.collectionDefinitions.filter(({collectionId:C})=>!v.includes(C)),w=I.map(Rl("collectionId")),T=[],S,D=i.tieFormatName;for(let C of i.collectionDefinitions){if(w.includes(C.collectionId))continue;let E=y3({updateInProgressMatchUps:t,...C,tournamentRecord:r,tieFormatName:D,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(E.modifications&&T.push(...E.modifications),E.error)return ce({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let C of I){let E=I3({updateInProgressMatchUps:t,collectionDefinition:C,tournamentRecord:r,drawDefinition:a,tieFormatName:D,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:c,event:u});if(E.error)return ce({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let C of b){let E=b3({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:D,collectionId:C,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:u});if(E.error)return ce({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}return f?.tieFormatName!==D?(S.tieFormatName=D,T.push({tieFormatName:D})):(T.length||w.length||b.length)&&(delete S.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((C,E)=>mT(C.collectionOrder)-mT(E.collectionOrder)).map((C,E)=>({...C,collectionOrder:E+1})),{processedTieFormat:os(S),modifications:T,...se}}function ape({tournamentRecord:t}){if(!t)return{error:Qe};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let u;for(let d of r)Kf({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);if(u)c.tieFormatId=u,delete c.tieFormat;else{let d=Tt(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=or()),c.tieFormatId=d.tieFormatId,delete c.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat});for(let u of c.structures??[])n({tieFormat:u.tieFormat})}let a=(c,u)=>{let d=o.matchUps?.find(p=>p.matchUpId===c);d&&(d.tieFormatId=u,delete d.tieFormat,Gi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=c=>{let u=Tt(c.tieFormat,void 0,!0);u.tieFormatId||(u.tieFormatId=or()),r.push(u),e+=1,a(c.matchUpId,u.tieFormatId)},o=Jh({matchUpFilters:{matchUpTypes:[rc]},event:i}),l=o.matchUps??[];for(let c of l){let u;for(let d of r)c.tieFormat&&Kf({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);u?a(c.matchUpId,u):s(c)}r.length&&(i.tieFormats=r)}return{...se,addedCount:e}}var w3={};Ai(w3,{addDrawDefinitionExtension:()=>eO,addEventExtension:()=>Lg,addEventTimeItem:()=>lw,addExtension:()=>ir,addNotes:()=>MO,addOnlineResource:()=>ppe,addParticipantExtension:()=>Eae,addParticipantTimeItem:()=>yq,addTimeItem:()=>Lp,addTournamentExtension:()=>KH,addTournamentTimeItem:()=>J1,analyzeDraws:()=>Q1,analyzeTournament:()=>rW,copyTournamentRecord:()=>ope,createTournamentRecord:()=>Dx,generate:()=>spe,getAggregateTeamResults:()=>iW,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>Qq,getAppliedPolicies:()=>Qi,getCompetitionDateRange:()=>YO,getCompetitionPenalties:()=>eW,getPolicyDefinitions:()=>gm,getTournamentInfo:()=>uw,getTournamentPenalties:()=>WO,getTournamentPersons:()=>tW,getTournamentPoints:()=>KO,getTournamentStructures:()=>Qz,getTournamentTimeItem:()=>pO,hydrateTournamentRecord:()=>cpe,mutate:()=>lpe,query:()=>gce,removeDrawDefinitionExtension:()=>Pae,removeEventExtension:()=>tO,removeExtension:()=>oo,removeNotes:()=>fq,removeOnlineResource:()=>dpe,removeParticipantExtension:()=>Cae,removeTournamentExtension:()=>ZH,setTournamentCategories:()=>mpe,setTournamentDates:()=>Mx,setTournamentEndDate:()=>vpe,setTournamentName:()=>hpe,setTournamentNotes:()=>fpe,setTournamentStartDate:()=>gpe,setTournamentStatus:()=>upe});var spe={};Ai(spe,{copyTournamentRecord:()=>ope,createTournamentRecord:()=>Dx});function ope(t){let e=jt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ti(r)).getTime()-new Date(Ti(i)).getTime():0)/n,s=t.endDate||NH(t.startDate,a),o=p=>p?.filter(({itemType:h})=>t.itemTypeList?.includes(h)),l=p=>p?.filter(({name:h})=>t.extensionList?.includes(h)),c=p=>{let{timeItems:h,extensions:f,...m}=p;return Tt({...m,timeItems:o(h),extensions:l(f)},!1,!0)},u=p=>{let{drawDefinitions:h,timeItems:f,extensions:m,startDate:g,endDate:v,...y}=p;return Tt({extensions:l(m),timeItems:o(f),startDate:t.startDate,endDate:s,...y},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(c)??[]:[],parentOrganisation:Tt({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Tt(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(u)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:or(),endDate:s};return{...se,tournamentRecord:d}}var lpe={};Ai(lpe,{addDrawDefinitionExtension:()=>eO,addEventExtension:()=>Lg,addEventTimeItem:()=>lw,addExtension:()=>ir,addNotes:()=>MO,addOnlineResource:()=>ppe,addParticipantExtension:()=>Eae,addParticipantTimeItem:()=>yq,addTimeItem:()=>Lp,addTournamentExtension:()=>KH,addTournamentTimeItem:()=>J1,hydrateTournamentRecord:()=>cpe,removeDrawDefinitionExtension:()=>Pae,removeEventExtension:()=>tO,removeExtension:()=>oo,removeNotes:()=>fq,removeOnlineResource:()=>dpe,removeParticipantExtension:()=>Cae,removeTournamentExtension:()=>ZH,setTournamentCategories:()=>mpe,setTournamentDates:()=>Mx,setTournamentEndDate:()=>vpe,setTournamentName:()=>hpe,setTournamentNotes:()=>fpe,setTournamentStartDate:()=>gpe,setTournamentStatus:()=>upe});function cpe(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[Gf]||n?.[Gf])&&Lce({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:Qe}}var yLe="ABANDONED",bLe="ACTIVE",ILe="CANCELLED",wLe="COMPLETED",SLe="IN_PROGRESS",S3={ABANDONED:yLe,ACTIVE:bLe,CANCELLED:ILe,COMPLETED:wLe,IN_PROGRESS:SLe};function upe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(S3).includes(e)?{error:be,info:"Unknown status"}:(t.tournamentStatus=e,{...se}):{error:Qe}}function dpe(t){let e=jt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ce({result:{error:ja}});cS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ce(s?{result:{error:ja}}:{result:{error:An}});if(s){if(c.person?.personId!==s)return ce({result:{error:FI}});cS({element:c.person,onlineResource:r})}else cS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ce({result:{error:OU}});cS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ce({result:{error:$I}});cS({element:c,onlineResource:r})}else cS({element:i,onlineResource:r}),bi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Ry});return{...se}}function cS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[IT]===e[IT]&&r?.[wT]===e[wT]&&r?.[ST]===e[ST]));t.onlineResources=i}function ppe(t){let e=jt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ce({result:{error:ja}});uS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ce(s?{result:{error:ja}}:{result:{error:An}});if(s){if(c.person?.personId!==s)return ce({result:{error:FI}});uS({element:c.person,onlineResource:r})}else uS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ce({result:{error:OU}});uS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ce({result:{error:$I}});uS({element:c,onlineResource:r})}else uS({element:i,onlineResource:r}),bi({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Ry});return{...se}}function uS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[IT]!==e[IT]&&r?.[wT]!==e[wT]&&r?.[ST]!==e[ST]);return i.push(e),t.onlineResources=i,{...se}}function hpe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:Qe};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&bi({topic:Ry,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...se}}function fpe({tournamentRecord:t,notes:e}){if(!t)return{error:Qe};let i=e?MO({element:t,notes:e}):fq({element:t});return i.error?i:(bi({topic:Ry,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...se})}function mpe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,bi({topic:Ry,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...se}):{error:Qe}}function TLe({tournamentRecord:t}){if(!t)return{error:Qe};let{startDate:e,endDate:i}=t,r=bT(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((u,d)=>{let p=Xi(u.startTime),h=Xi(u.endTime);return d.startTime&&Xi(d.startTime)<p&&(u.startTime=d.startTime),d.endTime&&Xi(d.endTime)>h&&(u.endTime=d.endTime),u},{startTime:"08:00",endTime:"18:00"}),l=r.map(u=>a.dateAvailability?.find(d=>d.date===u)??{date:u,startTime:s,endTime:o}),c=a.dateAvailability?.find(u=>!u.date);c&&l.unshift(c),a.dateAvailability=l}return{...se}}function Mx(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=jt(t,[{tournamentRecord:!0},{[ds]:h=>fp.test(h),[sc]:xa,startDate:!1,endDate:!1},{[ds]:h=>h.filter(Boolean).every(f=>fp.test(f)),[sc]:xa,activeDates:!1},{[ds]:Qce,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:be};if(r&&i&&new Date(i)>new Date(r))return{error:be};if(a?.length){let h=i||e.startDate,f=r||e.endDate,m=!h||a.every(v=>new Date(v)>=new Date(h)),g=!f||a.every(v=>new Date(v)<=new Date(f));if(!m||!g)return{error:xa}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=bT(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let c=bT(e.startDate,e.endDate),u=l.filter(h=>!c.includes(h)),d=c.filter(h=>!l.includes(h));for(let h of e.events??[])i&&h.startDate&&new Date(h.startDate)<new Date(i)&&(h.startDate=i),r&&h.startDate&&new Date(h.startDate)>new Date(r)&&(h.startDate=i??r),r&&h.endDate&&new Date(h.endDate)>new Date(r)&&(h.endDate=r),i&&h.endDate&&new Date(h.endDate)<new Date(i)&&(h.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&ULe({tournamentRecord:e})?.unscheduledMatchUpIds;return TLe({tournamentRecord:e}),bi({payload:Lt({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:Ry}),{...se,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function gpe({tournamentRecord:t,startDate:e}){return e?Mx({tournamentRecord:t,startDate:e}):{error:xa}}function vpe({tournamentRecord:t,endDate:e}){return e?Mx({tournamentRecord:t,endDate:e}):{error:xa}}function ULe({tournamentRecord:t}){let e=Ha({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!Tx({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:ere}:{unscheduledMatchUpIds:a}}var T3={};Ai(T3,{addCourt:()=>Px,addCourts:()=>u3,addVenue:()=>k1,deleteCourt:()=>Epe,deleteVenue:()=>P3,deleteVenues:()=>wpe,disableCourts:()=>Spe,disableVenues:()=>Tpe,enableCourts:()=>Upe,enableVenues:()=>Dpe,generate:()=>ype,generateCourts:()=>FW,getCompetitionVenues:()=>nR,getCourts:()=>IW,getVenuesAndCourts:()=>bm,modifyCourt:()=>C3,modifyCourtAvailability:()=>D3,modifyVenue:()=>Ppe,mutate:()=>bpe,publicFindVenue:()=>_z,query:()=>kce});var ype={};Ai(ype,{generateCourts:()=>FW});var bpe={};Ai(bpe,{addCourt:()=>Px,addCourts:()=>u3,addVenue:()=>k1,deleteCourt:()=>Epe,deleteVenue:()=>P3,deleteVenues:()=>wpe,disableCourts:()=>Spe,disableVenues:()=>Tpe,enableCourts:()=>Upe,enableVenues:()=>Dpe,modifyCourt:()=>C3,modifyCourtAvailability:()=>D3,modifyVenue:()=>Ppe});function U3(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:Qe};if(!t?.courtId)return{error:LI};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=Im({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=Ha({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{let h=p.schedule?.allocatedCourts?.map(({courtId:f})=>f);return p.schedule?.courtId===u||h?.includes(u)});return OA({matchUps:d,schedulingProfile:s})}}function DLe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:Qe};if(!r)return{error:kg};let{schedulingProfile:n}=Im({tournamentRecord:e}),{matchUps:a}=Ha({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{let d=u.schedule?.allocatedCourts?.map(({venueId:p})=>p);return u.schedule?.venueId===l||d?.includes(l)});return OA({matchUps:c,schedulingProfile:n})}}function D3({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:Qe};if(!n)return{error:LI};let s=sde({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=ELe(e);e=o;let c=ew({tournamentRecord:t,courtId:n});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=U3({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let h=Qi({tournamentRecord:t})?.appliedPolicies,f=a??h?.[xg]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(f||console.log("throw error: scheduled court matchUps",m.length))}return u&&(u.dateAvailability=e,!i&&d&&bi({payload:{venue:d,tournamentId:t.tournamentId},topic:My,key:d.venueId})),{...se,totalMergeCount:l}}function ELe(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(Hxe);let{mergedAvailability:a,mergeCount:s}=PLe(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function PLe(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(d1(jn(i),jn(c),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function E3({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:ane,info:e}}function Ipe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Qs};if(!e&&!r)return{error:Md};let a;if(!e){if(!t)return{error:Qe};({drawDefinition:e}=_o({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=Hr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Qe};let s=Ha({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=$oe({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[pg,Ah].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![pg,Ah].includes(s)),Gi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...se}):{error:Os}}function P3(t){if(typeof t?.venueId!="string")return{error:kg};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:Qe};let a=Ud({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=Qi({tournamentRecord:e})?.appliedPolicies,o=r??s?.[xg]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let u of a){let d=Ipe({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:l});if(d.error)return d}let c;l.venues=(l.venues??[]).filter(u=>u?.venueId!==i?!0:(c=!0,!1)),c&&bi({payload:{venueId:i,tournamentId:l.tournamentId},topic:dz,key:i})}else return E3({matchUpsCount:a.length});return sR({tournamentRecords:n}),{...se}}function wpe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Qe};if(!Array.isArray(e))return{error:be};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=P3({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...se}}function Spe(t){let{courtIds:e,dates:i}=t,r=qc(t),n=[{[xs]:!0,[Jk]:!0}],a=jt(t,n);if(a.error)return a;for(let s of Object.values(r))CLe({tournamentRecord:s,courtIds:e,dates:i});return{...se}}function CLe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>ir({extension:{value:r,name:vd},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...se}}function Tpe(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[xs]:!0,[Qk]:!0}],a=jt(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];RLe({tournamentRecord:l,venueIds:r})}return{...se}}function RLe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=ir({creationTime:!1,element:i,extension:{name:vd,value:!0}});if(r.error)return r}return{...se}}function Upe(t){let e=qc(t),i=[{[xs]:!0}];!t.enableAll&&i.push({[Jk]:!0});let r=jt(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))MLe({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...se}}function MLe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=Pi({element:a,name:vd});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),ir({extension:{name:vd,value:o},creationTime:!1,element:a})}}else oo({element:a,name:vd});return{...se}}function Dpe(t){let e=qc(t),i=[{[xs]:!0}];!t.enableAll&&i.push({[Qk]:!0});let r=jt(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&oo({element:o,name:vd});return{...se}}function Epe(t){let{courtId:e,disableNotice:i,force:r}=t,n=qc(t),a=jt(t,[{[xs]:!0,[wae]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=NLe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==OU)return o;o.success&&(s=!0)}return s?{...se}:o}function NLe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=ew({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=U3({tournamentRecord:t,courtId:i}),o=Qi({tournamentRecord:t})?.appliedPolicies,l=r??o?.[xg]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let c of s??[]){let u=Ipe({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:t});if(u.error)return u}a&&(a.courts=(a.courts??[]).filter(c=>c.courtId!==i),e||bi({payload:{venue:a,tournamentId:t.tournamentId},topic:My,key:a.venueId}))}else return E3({matchUpsCount:s.length});return{...se}}function C3(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=qc(t);if(!Object.keys(s).length)return{error:dn};let o,l;for(let c of Object.values(s)){let u=ALe({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...se}:l}function ALe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:Qe};if(!n)return{error:LI};if(!r||typeof r!="object")return{error:fm};let s=ew({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(Gxe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:Ok};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=D3({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||bi({payload:{venue:o,tournamentId:t.tournamentId},topic:My,key:o?.venueId}),{...se,court:Tt(l)}}var _Le=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),kLe=_Le;function Ppe(t){let{modifications:e,venueId:i,force:r}=t,n=qc(t);if(!Object.keys(n).length)return{error:dn};if(typeof i!="string")return{error:kg};let a,s;for(let o of Object.values(n)){let l=OLe({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==$I)return l}return sR({tournamentRecords:n}),s?{...se}:{error:a}}function OLe({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:Qe};if(!e||typeof e!="object")return{error:fm};if(!i)return{error:kg};let n=Qi({tournamentRecord:t})?.appliedPolicies,a=r??n?.[xg]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=DLe({tournamentRecord:t,venueId:i}),o=Xh({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,c=Object.keys(kLe()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>c.includes(g)).length)return{error:Ok};let u=c.filter(g=>!["courts","onlineResources"].includes(g)),d=Object.keys(e).filter(g=>u.includes(g));l&&d.forEach(g=>Object.assign(l,{[g]:e[g]}));let p=l?.courts?.map(g=>g.courtId)??[],h=e.courts?.map(g=>g.courtId)||[],f=h.length?p.filter(g=>!h.includes(g)):e?.courts&&p,m=[];if(f?.length){let g=l?.courts?.filter(v=>f.includes(v.courtId))?.map(v=>{let y=U3({courtId:v.courtId,tournamentRecord:t,venueMatchUps:s});for(let b of y.matchUps??[])m.push({matchUpId:b.matchUpId,drawId:b.drawId});return y.matchUps?.length??0}).reduce((v,y)=>v+y);if(l&&(!g||a))l.courts=l.courts?.filter(v=>h.includes(v.courtId)),eC({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return E3({matchUpsCount:g})}if(e.courts)for(let g of e.courts){let{courtId:v}=g||{},y=C3({modifications:g,disableNotice:!0,tournamentRecord:t,venueMatchUps:s,courtId:v,force:r});if(y.error===OU&&(y=Px({disableNotice:!0,tournamentRecord:t,venueId:i,court:g})),y.error)return y}return sR({tournamentRecord:t}),l&&bi({payload:{venue:l,tournamentId:t.tournamentId},topic:My,key:l?.venueId}),{...se,venue:Tt(l)}}var Ni={};Ai(Ni,{JSON2CSV:()=>jLe,UUID:()=>or,UUIDS:()=>Ene,allNumeric:()=>qie,attributeFilter:()=>sI,chunkArray:()=>Ca,chunkByNth:()=>$$,chunkSizeProfile:()=>zie,constantToString:()=>gs,countValues:()=>T1e,createMap:()=>Yie,dateTime:()=>Une,definedAttributes:()=>Lt,dehydrateMatchUps:()=>FLe,extractAttributes:()=>Dse,flattenJSON:()=>R3,generateDateRange:()=>bT,generateHashCode:()=>N1e,generateRange:()=>vt,generateTimeCode:()=>pde,groupValues:()=>Gie,hasAttributeValues:()=>M1e,instanceCount:()=>Ul,intersection:()=>Un,isConvertableInteger:()=>fi,isNumeric:()=>gn,isOdd:()=>Vie,isPowerOf2:()=>wd,makeDeepCopy:()=>Tt,matchUpScheduleSort:()=>LLe,matchUpSort:()=>tw,nearestPowerOf2:()=>YG,nextPowerOf2:()=>RU,noNulls:()=>S1e,noNumeric:()=>Wie,numericSort:()=>Jn,occurrences:()=>D1e,overlap:()=>ho,randomMember:()=>ml,randomPop:()=>vl,shuffleArray:()=>so,structureSort:()=>WI,subSort:()=>E1e,undefinedToNull:()=>V$,unique:()=>vi,visualizeScheduledMatchUps:()=>xLe});function xLe({scheduledMatchUps:t,showGlobalLog:e}){xMe();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Il({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=fo({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Il({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:c})=>{let u=Gr(c.scheduledTime);Il({matchUpId:l,time:u,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&OMe()}var{extractTime:gK,timeStringMinutes:vK}=Une;function LLe(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=vK(gK(i.scheduledTime)),a=vK(gK(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function FLe({tournamentRecord:t}){if(!t)return{error:Qe};if(typeof t!="object"||!t.tournamentId)return{error:be};let{matchUps:e}=Ha({tournamentRecord:t,inContext:!1});if(e?.length){let i=BLe({tournamentRecord:t});VLe(e,i)}return{...se}}function BLe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var $Le=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function VLe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))$Le.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function jLe(t,e){if(e&&typeof e!="object")return{error:be};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:be};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>R3(A,g)),y=Object.values(i).flat();r&&l.push(...y);let b=v.reduce((A,N)=>Object.keys(N).every(k=>!A.includes(k)&&A.push(k)||!0)&&A,[]).filter(A=>!l?.length||l.includes(A)),I=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(N=>({[N]:A})).flat()).flat()),w=(A,N)=>e?.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,T=b.reduce((A,N)=>{let k=I[N];return k?A.includes(k)||A.push(k):A.push(N),A},[]).sort(w);Object.keys(u).forEach(A=>!T.includes(A)&&T.unshift(A)),Object.keys(i).forEach(A=>!T.includes(A)&&T.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!T.includes(A)&&T.unshift(A));let S=T.map(A=>u[A]||A);if(o)return[S];let D=A=>`${h}${A}${h}`,C=[],E=A=>Object.values(T.reduce((N,k,x)=>{let O=i[k],V=(O?.length?A[O.find(q=>A[q])]:A[k])||p?.[k]||"",F=d[k]?.[V]||V,j=Po(c[k])?c[k](F):F;return N[k]=D(j),j&&(C[x]=(C[x]||0)+1),N},{})),P=v.map(E),R=s&&[...C].map((A,N)=>!A&&N).filter(gn).reverse();if(R){let A=N=>N.filter((k,x)=>!R.includes(x));P=P.map(A),S=A(S)}let M=P.map(A=>A.join(f));return a?M.map(A=>{let N=A.split(f);return Object.assign({},...N.map((k,x)=>({[S[x]]:k})))}):n?[S.map(D).join(f),...M].join(m):M.join(m)}function R3(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,R3(t[n],e,i.concat(n))),{})}var GLe={},{FACTORY:yK}=xv;function HLe({tournamentRecord:t,value:e}){let{extension:i}=Pi({element:t,name:yK}),r={name:yK,value:{...i?.value,...e}};ir({element:t,extension:r})}function Nx({timeStamp:t}){let e=Og(),i=TH();return i&&Object.values(e).forEach(r=>{HLe({tournamentRecord:r,value:{version:CU(),timeStamp:t}})}),i}function Cpe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=ac();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!u&&(o||c)&&(s.params=r),!u&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&gne(s,t)}function gR({methodName:t,params:e,start:i}){let r={error:l1,methodName:t},n=i?Date.now()-i:0;return Cpe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function zLe(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Qe};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=_o({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=_o({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:Lc};e.tournamentId=s,e.event=a}let r=e.tournamentId??jI();if(!r&&e)return e;let n=t[r];return r&&!n?{error:Qe}:(n&&(e.tournamentRecord=n),e)}function vR(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=jI();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||PH(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||Og(),c=i?Tt(i,void 0,!0):void 0,u=i?zLe(l,i):void 0;if(u?.error)return u;let d=qLe({params:u,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return Cpe({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function qLe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(ac())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return $k({engineName:"engine",methodName:r,params:i,err:a})}}function Ax(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=pc();for(let s of[...a].sort(Mpe)){let o=DH({topic:s});o?.length&&CP({topic:s,notices:o})}e&&n&&a.includes(VP)&&CP({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:VP})}async function Rpe(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=pc();for(let s of[...a].sort(Mpe)){let o=DH({topic:s});o&&await CP({topic:s,notices:o})}e&&n&&a.includes(VP)&&CP({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:VP})}var bK={[bz]:5,[yz]:5,[Iz]:5,[vz]:5,[gz]:5,[fz]:5,[$ae]:5,[Vae]:5,[mz]:1,[oO]:1,[Is]:5,[My]:5,[hz]:4,[uz]:4,[dz]:4,[pz]:4,[sO]:3,[oz]:2};function Mpe(t,e){return(bK[e]||0)-(bK[t]||0)}function WLe({convertExtensions:t,removeExtensions:e}){let i=Og();return{tournamentId:jI(),tournamentRecords:Tt(i,t,!1,e)}}function YLe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??jI();if(typeof r!="string")return{};let n=PH(r);return{tournamentRecord:Tt(n,e,!1,i)}}function KLe(){let t=Og(),{extension:e}=Pi({name:Qv,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),Bk(t)}function IK(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:fm}:t?.tournamentId?fne(e?Tt(t):t):{error:be}}function hI(t,e=!0){if(typeof t!="object")return{error:fm};if(RP(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:H$};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},RP(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:H$};return Bk(e?Tt(t):t)}async function ZLe(t,e,i){if(!Array.isArray(e))return{error:be,message:"directives must be an array"};let r=UH(),n=Date.now(),a=i&&Tt(Og(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:be,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return gR({methodName:u,start:n,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=vR(t,r[u],p,u,"async");if(h?.error)return a&&hI(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=Nx({timeStamp:o});return await Rpe({directives:e,mutationStatus:l,timeStamp:o}),VI(),{success:s.every(c=>c.success),results:s}}async function wK(t,e){if(!ji(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(Po).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(h=>Po(e[h])):jr(e.method)&&e.method;if(!r)return{error:l1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Tt(Og(),!1,!0),l=n||t[r]||Lk()[r];if(!l)return gR({methodName:r,params:s});let c=await vR(t,l,s,r,"async")??{};c?.error&&o&&hI(o);let u=Date.now(),d=Nx({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&await Rpe({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&VI(),c}function XLe(t,e,i,r,n,a){let s=vne(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>Po(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(ac())return u();try{return u()}catch(d){$k({engineName:"engine",methodName:l,params:c,err:d})}}}),{...se,...t}}function dS(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function M3(t,e){t.importMethods=(i,r,n,a)=>XLe(t,e,i,r,n,a),t.getTournament=i=>YLe(i),t.getState=i=>WLe({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>CU(),t.reset=()=>(Bk({}),dS(t)),t.devContext=i=>(EP(i),dS(t)),t.getDevContext=i=>ac(i),t.newTournamentRecord=(i={})=>{let r=Dx(i),n=r.tournamentId;return r.error?r:(IK(r),RP(n),{...se,tournamentId:n})},t.setState=(i,r,n)=>{PP(r,n);let a=hI(i,r);return dS(t,a)},t.setTournamentId=i=>RP(i),t.getTournamentId=()=>jI(),t.setTournamentRecord=(i,r,n)=>{PP(r,n);let a=IK(i,r);return dS(t,a)},t.removeTournamentRecord=i=>{let r=mne(i);return dS(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=KLe();return dS(t,i)}}function JLe(t){let e=cne();if(e.error&&!t)return e;let i={executionQueue:(r,n)=>ZLe(i,r,n),execute:r=>wK(i,r)};return M3(i,wK),i}function QLe(t,e,i){if(!Array.isArray(e))return{error:be,message:"directives must be an array"};let r=UH(),n=Date.now(),a=i&&Tt(Og(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:be,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:be,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return gR({methodName:u,start:n,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=vR(t,r[u],p,u,"sync");if(h?.error)return a&&hI(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=Nx({timeStamp:o});return Ax({directives:e,mutationStatus:l,timeStamp:o}),VI(),{success:s.every(c=>c.success),results:s}}function SK(t,e){if(!ji(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(Po).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(h=>Po(e[h])):jr(e.method)&&e.method;if(!r)return{error:l1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Tt(Og(),!1,!0),l=n||t[r]||Lk()[r];if(!l)return gR({methodName:r,params:s});let c=vR(t,l,s,r,"sync")??{};c?.error&&o&&hI(o);let u=Date.now(),d=Nx({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&Ax({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&VI(),c}var Npe=(()=>{let t={executionQueue:(e,i)=>QLe(t,e,i),execute:e=>SK(t,e)};return M3(t,SK),t})(),yR=Npe;function TK(t,e){if(!ji(e))return{error:be,message:"args must be an object"};let i=Object.values(e).filter(Po).length;if(i>1)return{message:"there must be only one arg with typeof function",error:be};let r=i?Object.keys(e).find(l=>Po(e[l])):jr(e.method)&&e.method;if(!r)return{error:l1};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||Lk()[r];return o?vR(t,o,s,r,"ask"):gR({methodName:r,params:s})}var eFe=(()=>{let t={execute:e=>TK(t,e)};return M3(t,TK),t})(),Bb={},Zm;function Ape(t,e=!0){if(!t)return{error:Wt};if(typeof t!="object")return{error:fm};if(t.matchUpId)Zm=t.matchUpId,Bb[Zm]=e?Tt(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Bb[i.matchUpId]=e?Tt(i):i,Zm||(Zm=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Bb[i.matchUpId]=e?Tt(i):i,Zm||(Zm=i.matchUpId));return e?Tt(t):t}function tFe(){return Bb[Zm]}function iFe(){return Object.values(Bb)}function rFe(){Zm=void 0,Bb={}}function nFe(t){return Tt(Bb[Zm],t?.convertExtensions,!1,t?.removeExtensions)}var aFe=(()=>{let t={getState:i=>nFe(i),version:()=>CU(),reset:()=>(rFe(),{...se}),drawId:void 0,error:void 0,success:!1,devContext:i=>(EP(i),t),setState:(i,r,n)=>{PP(r,n);let a=Ape(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return sFe(t,[Fv]),t})();function sFe(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(ac())return UK(t,{params:n,governor:i,methodName:r});try{return UK(t,{params:n,governor:i,methodName:r})}catch(a){$k({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function UK(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||tFe(),a=e?.matchUps||iFe(),s=e?.rollbackOnError&&Tt(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&Ape(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&Ax(),(l||!o?.success||e?.doNotNotify)&&VI(),o}var q2=!1,bR=(()=>{let t={version:()=>CU(),setDeepCopy:(r,n)=>(PP(r,n),t),devContext:r=>(EP(r),q2=!0,t)};return i([wx]),t;function e(r,n){let a=r({...n});return a?.error||Ax(),VI(),q2&&(EP(!1),q2=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=s=>{if(ac()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&hI(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&hI(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();yR.importMethods(Tk,!0,1);var Xf=yR,We=yR,oFe={getTournamentPoints:KO},lFe=oFe,cFe={calculateNewRatings:ble,generateDynamicRatings:Ile},uFe=cFe,dFe={...lFe,...uFe};yR.importMethods(dFe);var pFe=yR,hFe={[FP]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},fFe={[Mh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[xb,GE]}},mFe={[Mh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[xb,WP,dI],disabledActions:[]}]}},gFe={[Mh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},vFe={[jU]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},yFe={[Bc]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Eu,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[rl]:[],[xp]:[],[yr]:[],[Cl]:[],[Ia]:[],[xr]:[]}}},W2="Personal circumstance",bFe={[Bc]:{requireAllPositionsAssigned:!1,stage:{[Ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Eu,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Eu,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[rl]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[xp]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Cl]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[yr]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[xr]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:W2,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Ia]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:W2,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Nh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:W2,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},IFe={[bu]:{seedingProfile:{positioning:Hk},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},wFe={POLICY_AVOIDANCE_COUNTRY:hFe,POLICY_POSITION_ACTIONS_DEFAULT:tle,POLICY_POSITION_ACTIONS_DISABLED:gFe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:mFe,POLICY_POSITION_ACTIONS_UNRESTRICTED:fFe,POLICY_PRIVACY_DEFAULT:vFe,POLICY_ROUND_NAMING_DEFAULT:Rz,POLICY_SCHEDULING_DEFAULT:Ace,POLICY_SCORING_DEFAULT:yFe,POLICY_SCORING_USTA:bFe,POLICY_SEEDING_ITF:IFe,POLICY_SEEDING_DEFAULT:fce},fg={ratingsParameters:Ua,matchUpFormats:HRe,countryToFlag:Kae,tieFormats:qce,countries:tg,policies:wFe,flagIOC:O0e},So={};Ai(So,{activeMatchUpStatuses:()=>aO,auditConstants:()=>Zce,completedMatchUpStatuses:()=>Hn,directingMatchUpStatuses:()=>nz,displayConstants:()=>Ece,drawDefinitionConstants:()=>Wn,entryStatusConstants:()=>Ju,errorConditionConstants:()=>sne,eventConstants:()=>ll,extensionConstants:()=>xv,flightConstants:()=>cue,genderConstants:()=>_p,keyValueConstants:()=>Lq,matchUpActionConstants:()=>Eq,matchUpStatusConstants:()=>Kh,matchUpTypes:()=>Bie,nonDirectingMatchUpStatuses:()=>az,particicipantsRequiredMatchUpStatuses:()=>iz,participantConstants:()=>Vs,participantRoles:()=>jg,participantTypes:()=>rT,penaltyConstants:()=>_pe,policyConstants:()=>Cy,positionActionConstants:()=>sw,ratingConstants:()=>Noe,recoveryTimeRequiredMatchUpStatuses:()=>xae,requestConstants:()=>Gue,resourceContants:()=>Dne,resultConstants:()=>Zie,scaleConstants:()=>$U,scheduleConstants:()=>wse,sortingConstants:()=>pue,surfaceConstants:()=>kpe,tieFormatConstants:()=>lae,timeItemConstants:()=>gO,topicConstants:()=>zae,tournamentConstants:()=>S3,upcomingMatchUpStatuses:()=>sz,validMatchUpStatuses:()=>rz,venueConstants:()=>Ope,weekdayConstants:()=>RW});var SFe="Coaching",TFe="Ball Abuse",UFe="Racket Abuse",DFe="Verbal Abuse",EFe="INELIGIBILITY",PFe="Physical Abuse",CFe="Unsportmanlike Conduct",RFe="Dress Code Violation",MFe="Equipment Violation",NFe="Leaving the court",AFe="Failure to complete",_Fe="No Show",kFe="Other",OFe="REFUSAL_TO_PLAY",xFe="PROHIBITED_SUBSTANCE",LFe="Puncuality",FFe="Failure to sign in",_pe={COACHING:SFe,BALL_ABUSE:TFe,RACKET_ABUSE:UFe,VERBAL_ABUSE:DFe,PHYSICAL_ABUSE:PFe,INELIGIBILITY:EFe,UNSPORTSMANLIKE_CONDUCT:CFe,PROHIBITED_SUBSTANCE:xFe,DRESS_CODE_VIOLATION:RFe,EQUIMENT_VIOLATION:MFe,LEAVING_THE_COURT:NFe,REFUSAL_TO_PLAY:OFe,FAILURE_TO_COMPLETE:AFe,NO_SHOW:_Fe,OTHER:kFe,PUNCTUALITY:LFe,FAILUIRE_TO_SIGN_IN:FFe},BFe="CLAY",$Fe="HARD",VFe="GRASS",jFe="CARPET",GFe="ARTIFICIAL",kpe={CLAY:BFe,HARD:$Fe,GRASS:VFe,CARPET:jFe,ARTIFICIAL:GFe},HFe="INDOOR",zFe="OUTDOOR",Ope={INDOOR:HFe,OUTDOOR:zFe};const _V=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:aO,askEngine:eFe,asyncEngine:JLe,auditConstants:Zce,competitionEngine:Xf,competitionGovernor:qG,completedMatchUpStatuses:Hn,directingMatchUpStatuses:nz,displayConstants:Ece,drawDefinitionConstants:Wn,drawsGovernor:JH,entriesGovernor:UW,entryStatusConstants:Ju,errorConditionConstants:sne,eventConstants:ll,eventGovernor:PW,extensionConstants:xv,factoryConstants:So,fixtures:fg,flightConstants:cue,forge:GLe,genderConstants:_p,generationGovernor:LW,globalState:tT,governors:Tk,keyValueConstants:Lq,matchUpActionConstants:Eq,matchUpEngine:aFe,matchUpFormatCode:Zf,matchUpFormatGovernor:Zf,matchUpGovernor:$W,matchUpStatusConstants:Kh,matchUpTypes:Bie,mocksEngine:bR,mocksGovernor:wx,nonDirectingMatchUpStatuses:az,particicipantsRequiredMatchUpStatuses:iz,participantConstants:Vs,participantGovernor:p3,participantRoles:jg,participantTypes:rT,penaltyConstants:_pe,policyConstants:Cy,policyGovernor:Wq,positionActionConstants:sw,publishingGovernor:Cx,queryGovernor:rR,ratingConstants:Noe,recoveryTimeRequiredMatchUpStatuses:xae,reportGovernor:f3,requestConstants:Gue,resourceContants:Dne,resultConstants:Zie,scaleConstants:$U,scaleEngine:pFe,scheduleConstants:wse,scheduleGovernor:m3,scoreGovernor:Fv,sortingConstants:pue,surfaceConstants:kpe,syncEngine:Npe,tieFormatConstants:lae,tieFormatGovernor:v3,timeItemConstants:gO,tools:Ni,topicConstants:zae,tournamentConstants:S3,tournamentEngine:We,tournamentGovernor:w3,upcomingMatchUpStatuses:sz,utilities:Ni,validMatchUpStatuses:rz,venueConstants:Ope,venueGovernor:T3,version:CU,weekdayConstants:RW},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:xpe,FOLLOWED_BY:Lpe,NEXT_AVAILABLE:Fpe,NOT_BEFORE:Bpe,TO_BE_ANNOUNCED:$pe}=So.timeItemConstants,{SCHEDULE_ERROR:qFe,SCHEDULE_CONFLICT:WFe,SCHEDULE_WARNING:YFe}=So.scheduleConstants,{ORGANISER_ACCEPTANCE:KFe,DIRECT_ACCEPTANCE:ZFe,SPECIAL_EXEMPT:XFe,JUNIOR_EXEMPT:JFe,ALTERNATE:QFe,WILDCARD:e2e}=Ju,Vpe="All statuses",t2e="All genders",tC="All flights",DK="All rounds",mg="All events",i2e="No events",jpe="All teams",Gpe="All Types",r2e="Any team",Hpe="registration",n2e="timepicker",a2e="timevalue",zE="tmxContent",zpe="tmxDrawer",iC="splash",_x="superadmin",qpe="admin",N3="competitionEngine",s2e="tournamentEngine",kh="tournaments",Wpe="drawEntries",Es="tournament",kV="structure",Ype="invite",bb="event",EE="draw",OV="view",rC="tournamentEvents",uD="overview",Jf="participants",oy="schedule",A3="matchUps",Qp="events",_3="venues",o2e="unscheduled",IR={success:!0},l2e=10,Kpe="ISSUE",Cc="Automated",k3="Manual",Zpe={[qFe]:"matchup-error",[WFe]:"matchup-conflict",[Kpe]:"matchup-issue",[YFe]:"matchup-warning"},GA="tournamentParticipants",c2e="scheduledDateFilter",$b="unscheduledMatchUps",kx="tournamentsCalendar",HA="tournamentMatchUps",zA="tournamentSchedule",xV="tournamentsTable",qA="tournamentTeams",WA="venuesTable",Xpe="entriesCount",Jpe="eventsTable",nC="tmxOverlay",O3="teamStats",x3="drawControl",u2e="drawFrame",Qpe="drawRight",ehe="drawLeft",the="entriesView",Oh="drawsView",wR="QUALIFYING",od="ACCEPTED",ihe="eventInfo",L3="acceptedPanel",F3="alternatesPanel",B3="qualifyingPanel",$3="ungroupedPanel",V3="withdrawaPanel",rhe="unscheduledVisibility",nhe="tournamentsControl",j3="participantControl",G3="unscheduledControl",H3="scheduleControl",z3="matchUpsControl",q3="venuesControl",W3="eventsControl",SR="eventControl",Y3="teamsControl",d2e="controlBar",ahe="buttonBar",Sb="tmxPanel",she="tmxTable",ohe="tcContainer",ya="overlay",li="center",YA="header",Xt="right",ui="left",wp="bottom",EK="top",Ox="subTable",LT="",TM="flex",Vt="none",lhe="isOpen",K3="Collection value",Z3="Match value",X3="Score value",J3="Set value",lE={[xpe]:"After rest",[Lpe]:"Followed by",[$pe]:"To be announced",[Fpe]:"Next available",[Bpe]:"Not before"},p2e={[xpe]:"After rest",[Lpe]:"Followed by",[$pe]:"TBA",[Fpe]:"Next available",[Bpe]:"NB"},che={[KFe]:"OA",[ZFe]:"DA",[XFe]:"SE",[JFe]:"JE",[wR]:"QUAL",[QFe]:"ALT",[e2e]:"WC"},KA="Playoff",Tv="drawSize",ZA="CUSTOM",RS="advancePerGroup",XA="qualifiersCount",JA="groupRemaining",Q3="matchUpFormat",aC="structureName",qE="playoffType",Ef="groupSize",uhe="positions",fI="drawName",nh="drawType",WE="top",h2e="winners",LV="roundsColumns",FT="roundsStats",BT="roundsTable",mI="utr",sC="wtn",YE={},f2e={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},m2e=(t,e,i,r,n)=>{const a=t.split("-"),s=a.includes(ui)&&`left:${r}`,o=a.includes(Xt)&&`right:${n}`,l=a.includes("top")&&`top:${e}`,c=a.includes("bottom")&&`bottom:${i}`,u="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||li),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||li);return[s,o,l,c,u,d].filter(Boolean).join(";")};function g2e(t){if(YE.position)return YE.position;const e=document.createElement("div");return e.style.cssText="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+m2e(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),YE.position=e,e}function v2e(t){if(!t.message)return{error:"Missing message"};const e={...f2e,...t},i=g2e(e),r=y2e(e);if(e.onlyOne){let n=i.lastElementChild;for(;n;)i.removeChild(n),n=i.lastElementChild}i.appendChild(r.element)}function y2e(t){const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&v1e(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style.cssText=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const r=["notification"];if(typeof t.classList=="string"&&r.push(t.classList),t.type&&r.push(t.type),t?.animate?.in){const l=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",c=`animate__${t.animate.in}`;r.push(`animate__animated ${c} ${l}`),o(()=>e.classList.remove(c))}if(e.className=r.join(" "),t.dismissible){const l=document.createElement("button");l.className="delete",l.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",l)}const n=document.createElement("div");if(n.style.cssText="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?n.insertAdjacentHTML("beforeend",t.message):t.message&&console.log(" MESSAGE ",t.message,typeof t.message),Pt(t.action?.onClick)){const l=document.createElement("button");l.style.cssText="margin-left: 1em;",l.className="button",l.innerHTML=t.action.text||"OK",l.addEventListener("click",t.action.onClick),n.appendChild(l)}return e.appendChild(n),{element:e};function a(l){Pt(l)&&l(),t?.animate?.out?(e.classList.add(`animate__${t.animate.out}`),o(()=>{s(e.parentNode),delete YE.position,e.remove()})):(s(e.parentNode),delete YE.position,e.remove())}function s(l){l&&l.children.length<=1&&l.remove()}function o(l=()=>{}){const c={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const u in c)if(e.style[u]!==void 0){e.addEventListener(c[u],()=>l());break}}}function $t(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:r=!1,dismissible:n=!0,clickClose:a=!0,duration:s=2500,single:o=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};v2e({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:r,offsetBottom:c,type:i,offsetRight:u,dismissible:n,offsetLeft:d,clickClose:a,offsetTop:p,duration:s,position:e,message:f,onClose:l,opacity:h,action:m,single:o})}function b2e(){$t({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function I2e(){const t=`${$f.tr("phrases.blocked")}. ${$f.tr("phrases.enablepopups")}`;$t({intent:"is-danger",message:t})}function w2e(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${uD} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function S2e(){const t=document.getElementById("dnav");if(!t)return;const e=window.pageXOffset!=null,i=(document.compatMode||"")==="CSS1Compat";let r=0;const n=()=>{let c;e?c=window.pageYOffset:c=i?document.documentElement.scrollTop:document.body.scrollTop;let u;return c>r?u=!0:u=!1,r=c,u},a=()=>{n()&&!t.contains(document.activeElement)?(t.classList.add("scroll-down"),t.classList.remove("scroll-up")):(t.classList.add("scroll-up"),t.classList.remove("scroll-down"))};let s;const o=(c,u)=>{s||(s=!0,setTimeout(()=>{c(),s=!1},u))},l=window.matchMedia("(prefers-reduced-motion: reduce)");window.addEventListener("scroll",()=>{l&&!l.matches&&o(a,250)})}function T2e(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${ihe} class="block" style='display: none; width: 100%;'>
        <div id=${SR} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${Jpe}>
        <div id=${W3} class="controlBar"></div>
        <div id=${rC} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${the} style='display: none;'>
        <div id=${L3} class='tableClass block ${Sb}'>
          {' '}
        </div>
        <div id=${B3} class='tableClass block ${Sb}'>
          {' '}
        </div>
        <div id=${F3} class='tableClass block ${Sb}'>
          {' '}
        </div>
        <div id=${$3} class='tableClass block ${Sb}'>
          {' '}
        </div>
        <div id=${V3} class='tableClass block ${Sb}'>
          {' '}
        </div>
      </div>
      <div style="width: 100%; margin: 0">
        <div id=${x3}></div>
        <div id=${u2e} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${ehe} ></div>
          <div
            id=${Oh}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${Qpe} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const U2e=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function D2e(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=U2e,t}function E2e(){const t=document.getElementById("root");t.appendChild(P2e());const e=document.createElement("div");e.className="flexrow flexcenter",e.id=iC,e.style.cssText="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(D2e()),t.appendChild(e);const i=document.createElement("div");i.style.display=Vt,i.id=n2e;const r=document.createElement("input");r.className="timepicker-ui-input",r.id=a2e,r.type="text",i.appendChild(r),t.appendChild(i);const n=document.createElement("section");n.className="drawer drawer--left",n.setAttribute("data-drawer-target",""),n.id=zpe,n.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(n);const a=document.getElementById("navMain"),s=document.createElement("div");s.id=zE,s.className="springboard flexrow flexcenter",s.style.display=Vt;const o=document.createElement("div");o.id="navText",o.className="navText",o.style.display=Vt,s.appendChild(o);const l=document.createElement("div");l.id=ohe,l.className="flexcol flexcenter tournament_container",l.appendChild(w2e()),l.appendChild(T2e()),s.appendChild(l),a.appendChild(s);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.display=Vt,c.id=kh;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=nhe,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=xV,c.appendChild(d),a.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=Vt,p.style.height="90%",p.style.width="100%",p.id=kx,a.appendChild(p),S2e(),t}function P2e(){const t=document.createElement("div");return t.innerHTML=`<div id='dnav'>
    <div class="navbar-item" style="display: flex; flex-wrap: nowrap">
      <div id="provider" style="display: flex; flex-direction: column">
        <div style="font-size: .6em">TMX</div>
      </div>
      <div style="padding-left: 1em" id="pageTitle"> </div>
    </div>
    <div id='trnynav' class="navbar-item" style="display: flex; flex-direction: row;">
      <i id='o-route' class="nav-icon fa-solid fa-trophy"></i>
      <i id='p-route' class="nav-icon fa-solid fa-user-group" style="color: blue"></i>
      <i id='e-route' class="nav-icon fa-solid fa-diagram-project"></i>
      <i id='m-route' class="nav-icon fa-solid fa-table-tennis-paddle-ball"></i>
      <i id='s-route' class="nav-icon fa-solid fa-clock"></i>
      <i id='v-route' class="nav-icon fa-solid fa-location-dot"></i>
    </div>
    <div class="navbar-item" style="font-size: 1em">
      <i id="config" class="fa-solid fa-sliders"></i>
      <i id="login" style="padding-left: .5em" class="fa-solid fa-circle-user"></i>
    </div>
  </div>
  <main id="navMain"></main>`,t}function C2e(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function Xs(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const UN={[uD]:"o-tab",[Jf]:"p-tab",[Qp]:"e-tab",[A3]:"m-tab",[oy]:"s-tab",[_3]:"v-tab"};function R2e(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${j3}' class='controlBar'></div>
            <div id='${GA}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${Y3}' class='controlBar'></div>
              <div id='${qA}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${rhe}' style='width: 100%; display: none;'>
                  <div id='${G3}' class='controlBar flexcol flexcenter'></div>
                  <div id='${$b}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${H3}' class='controlBar flexcol flexcenter'></div>
                  <div id='${zA}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${q3}' class='controlBar'></div>
              <div id='${WA}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,r=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${z3}' class='controlBar'></div>
              <div id='${O3}' class='controlBar'></div>
              <div id='${HA}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,n={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":r},a=document.getElementById(ohe);Object.keys(n).forEach(s=>{const o=document.createElement("div");o.className="is-marginless",o.style.cssText="width: inherit",o.id=s,o.innerHTML=n[s],a.appendChild(o)}),dhe(Jf)}function dhe(t){return Object.keys(UN).includes(t)?(Object.keys(UN).forEach(e=>{const i=UN[e],r=document.getElementById(i);r?r.style.display=t===e?"":Vt:console.log({key:e,id:i,element:r})}),{...IR}):!1}function M2e(){[Oh,W3,z3,j3,G3,SR,Y3,H3,q3,O3,L3,F3,B3,$3,V3,rC,HA,GA,zA,qA,$b,WA].forEach(e=>{const i=UN[e],r=document.getElementById(i);r&&Xs(r)})}function phe(){return"tmxToken"}function hhe(t,e){return function(){return t.apply(e,arguments)}}const{toString:N2e}=Object.prototype,{getPrototypeOf:e4}=Object,{iterator:xx,toStringTag:fhe}=Symbol,Lx=(t=>e=>{const i=N2e.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Qh=t=>(t=t.toLowerCase(),e=>Lx(e)===t),Fx=t=>e=>typeof e===t,{isArray:dD}=Array,$T=Fx("undefined");function TR(t){return t!==null&&!$T(t)&&t.constructor!==null&&!$T(t.constructor)&&Mu(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const mhe=Qh("ArrayBuffer");function A2e(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&mhe(t.buffer),e}const _2e=Fx("string"),Mu=Fx("function"),ghe=Fx("number"),UR=t=>t!==null&&typeof t=="object",k2e=t=>t===!0||t===!1,DN=t=>{if(Lx(t)!=="object")return!1;const e=e4(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(fhe in t)&&!(xx in t)},O2e=t=>{if(!UR(t)||TR(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},x2e=Qh("Date"),L2e=Qh("File"),F2e=Qh("Blob"),B2e=Qh("FileList"),$2e=t=>UR(t)&&Mu(t.pipe),V2e=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Mu(t.append)&&((e=Lx(t))==="formdata"||e==="object"&&Mu(t.toString)&&t.toString()==="[object FormData]"))},j2e=Qh("URLSearchParams"),[G2e,H2e,z2e,q2e]=["ReadableStream","Request","Response","Headers"].map(Qh),W2e=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function DR(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),dD(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{if(TR(t))return;const a=i?Object.getOwnPropertyNames(t):Object.keys(t),s=a.length;let o;for(r=0;r<s;r++)o=a[r],e.call(null,t[o],o,t)}}function vhe(t,e){if(TR(t))return null;e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const Pb=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,yhe=t=>!$T(t)&&t!==Pb;function FV(){const{caseless:t,skipUndefined:e}=yhe(this)&&this||{},i={},r=(n,a)=>{const s=t&&vhe(i,a)||a;DN(i[s])&&DN(n)?i[s]=FV(i[s],n):DN(n)?i[s]=FV({},n):dD(n)?i[s]=n.slice():(!e||!$T(n))&&(i[s]=n)};for(let n=0,a=arguments.length;n<a;n++)arguments[n]&&DR(arguments[n],r);return i}const Y2e=(t,e,i,{allOwnKeys:r}={})=>(DR(e,(n,a)=>{i&&Mu(n)?t[a]=hhe(n,i):t[a]=n},{allOwnKeys:r}),t),K2e=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Z2e=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},X2e=(t,e,i,r)=>{let n,a,s;const o={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)s=n[a],(!r||r(s,t,e))&&!o[s]&&(e[s]=t[s],o[s]=!0);t=i!==!1&&e4(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},J2e=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},Q2e=t=>{if(!t)return null;if(dD(t))return t;let e=t.length;if(!ghe(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},eBe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&e4(Uint8Array)),tBe=(t,e)=>{const r=(t&&t[xx]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},iBe=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},rBe=Qh("HTMLFormElement"),nBe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),PK=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),aBe=Qh("RegExp"),bhe=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};DR(i,(n,a)=>{let s;(s=e(n,a,t))!==!1&&(r[a]=s||n)}),Object.defineProperties(t,r)},sBe=t=>{bhe(t,(e,i)=>{if(Mu(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(Mu(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},oBe=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return dD(t)?r(t):r(String(t).split(e)),i},lBe=()=>{},cBe=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function uBe(t){return!!(t&&Mu(t.append)&&t[fhe]==="FormData"&&t[xx])}const dBe=t=>{const e=new Array(10),i=(r,n)=>{if(UR(r)){if(e.indexOf(r)>=0)return;if(TR(r))return r;if(!("toJSON"in r)){e[n]=r;const a=dD(r)?[]:{};return DR(r,(s,o)=>{const l=i(s,n+1);!$T(l)&&(a[o]=l)}),e[n]=void 0,a}}return r};return i(t,0)},pBe=Qh("AsyncFunction"),hBe=t=>t&&(UR(t)||Mu(t))&&Mu(t.then)&&Mu(t.catch),Ihe=((t,e)=>t?setImmediate:e?((i,r)=>(Pb.addEventListener("message",({source:n,data:a})=>{n===Pb&&a===i&&r.length&&r.shift()()},!1),n=>{r.push(n),Pb.postMessage(i,"*")}))(`axios@${Math.random()}`,[]):i=>setTimeout(i))(typeof setImmediate=="function",Mu(Pb.postMessage)),fBe=typeof queueMicrotask<"u"?queueMicrotask.bind(Pb):typeof process<"u"&&process.nextTick||Ihe,mBe=t=>t!=null&&Mu(t[xx]),Ke={isArray:dD,isArrayBuffer:mhe,isBuffer:TR,isFormData:V2e,isArrayBufferView:A2e,isString:_2e,isNumber:ghe,isBoolean:k2e,isObject:UR,isPlainObject:DN,isEmptyObject:O2e,isReadableStream:G2e,isRequest:H2e,isResponse:z2e,isHeaders:q2e,isUndefined:$T,isDate:x2e,isFile:L2e,isBlob:F2e,isRegExp:aBe,isFunction:Mu,isStream:$2e,isURLSearchParams:j2e,isTypedArray:eBe,isFileList:B2e,forEach:DR,merge:FV,extend:Y2e,trim:W2e,stripBOM:K2e,inherits:Z2e,toFlatObject:X2e,kindOf:Lx,kindOfTest:Qh,endsWith:J2e,toArray:Q2e,forEachEntry:tBe,matchAll:iBe,isHTMLForm:rBe,hasOwnProperty:PK,hasOwnProp:PK,reduceDescriptors:bhe,freezeMethods:sBe,toObjectSet:oBe,toCamelCase:nBe,noop:lBe,toFiniteNumber:cBe,findKey:vhe,global:Pb,isContextDefined:yhe,isSpecCompliantForm:uBe,toJSONObject:dBe,isAsyncFn:pBe,isThenable:hBe,setImmediate:Ihe,asap:fBe,isIterable:mBe};function vr(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}Ke.inherits(vr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ke.toJSONObject(this.config),code:this.code,status:this.status}}});const whe=vr.prototype,She={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{She[t]={value:t}});Object.defineProperties(vr,She);Object.defineProperty(whe,"isAxiosError",{value:!0});vr.from=(t,e,i,r,n,a)=>{const s=Object.create(whe);Ke.toFlatObject(t,s,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const o=t&&t.message?t.message:"Error",l=e==null&&t?t.code:e;return vr.call(s,o,l,i,r,n),t&&s.cause==null&&Object.defineProperty(s,"cause",{value:t,configurable:!0}),s.name=t&&t.name||"Error",a&&Object.assign(s,a),s};const gBe=null;function BV(t){return Ke.isPlainObject(t)||Ke.isArray(t)}function The(t){return Ke.endsWith(t,"[]")?t.slice(0,-2):t}function CK(t,e,i){return t?t.concat(e).map(function(n,a){return n=The(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function vBe(t){return Ke.isArray(t)&&!t.some(BV)}const yBe=Ke.toFlatObject(Ke,{},null,function(e){return/^is[A-Z]/.test(e)});function Bx(t,e,i){if(!Ke.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ke.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!Ke.isUndefined(g[m])});const r=i.metaTokens,n=i.visitor||u,a=i.dots,s=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ke.isSpecCompliantForm(e);if(!Ke.isFunction(n))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(Ke.isDate(f))return f.toISOString();if(Ke.isBoolean(f))return f.toString();if(!l&&Ke.isBlob(f))throw new vr("Blob is not supported. Use a Buffer instead.");return Ke.isArrayBuffer(f)||Ke.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(Ke.endsWith(m,"{}"))m=r?m:m.slice(0,-2),f=JSON.stringify(f);else if(Ke.isArray(f)&&vBe(f)||(Ke.isFileList(f)||Ke.endsWith(m,"[]"))&&(v=Ke.toArray(f)))return m=The(m),v.forEach(function(b,I){!(Ke.isUndefined(b)||b===null)&&e.append(s===!0?CK([m],I,a):s===null?m:m+"[]",c(b))}),!1}return BV(f)?!0:(e.append(CK(g,m,a),c(f)),!1)}const d=[],p=Object.assign(yBe,{defaultVisitor:u,convertValue:c,isVisitable:BV});function h(f,m){if(!Ke.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),Ke.forEach(f,function(v,y){(!(Ke.isUndefined(v)||v===null)&&n.call(e,v,Ke.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!Ke.isObject(t))throw new TypeError("data must be an object");return h(t),e}function RK(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function t4(t,e){this._pairs=[],t&&Bx(t,this,e)}const Uhe=t4.prototype;Uhe.append=function(e,i){this._pairs.push([e,i])};Uhe.toString=function(e){const i=e?function(r){return e.call(this,r,RK)}:RK;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function bBe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Dhe(t,e,i){if(!e)return t;const r=i&&i.encode||bBe;Ke.isFunction(i)&&(i={serialize:i});const n=i&&i.serialize;let a;if(n?a=n(e,i):a=Ke.isURLSearchParams(e)?e.toString():new t4(e,i).toString(r),a){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class MK{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ke.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Ehe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},IBe=typeof URLSearchParams<"u"?URLSearchParams:t4,wBe=typeof FormData<"u"?FormData:null,SBe=typeof Blob<"u"?Blob:null,TBe={isBrowser:!0,classes:{URLSearchParams:IBe,FormData:wBe,Blob:SBe},protocols:["http","https","file","blob","url","data"]},i4=typeof window<"u"&&typeof document<"u",$V=typeof navigator=="object"&&navigator||void 0,UBe=i4&&(!$V||["ReactNative","NativeScript","NS"].indexOf($V.product)<0),DBe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",EBe=i4&&window.location.href||"http://localhost",PBe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:i4,hasStandardBrowserEnv:UBe,hasStandardBrowserWebWorkerEnv:DBe,navigator:$V,origin:EBe},Symbol.toStringTag,{value:"Module"})),Xl={...PBe,...TBe};function CBe(t,e){return Bx(t,new Xl.classes.URLSearchParams,{visitor:function(i,r,n,a){return Xl.isNode&&Ke.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...e})}function RBe(t){return Ke.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function MBe(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function Phe(t){function e(i,r,n,a){let s=i[a++];if(s==="__proto__")return!0;const o=Number.isFinite(+s),l=a>=i.length;return s=!s&&Ke.isArray(n)?n.length:s,l?(Ke.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!o):((!n[s]||!Ke.isObject(n[s]))&&(n[s]=[]),e(i,r,n[s],a)&&Ke.isArray(n[s])&&(n[s]=MBe(n[s])),!o)}if(Ke.isFormData(t)&&Ke.isFunction(t.entries)){const i={};return Ke.forEachEntry(t,(r,n)=>{e(RBe(r),n,i,0)}),i}return null}function NBe(t,e,i){if(Ke.isString(t))try{return(e||JSON.parse)(t),Ke.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const ER={transitional:Ehe,adapter:["xhr","http","fetch"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=Ke.isObject(e);if(a&&Ke.isHTMLForm(e)&&(e=new FormData(e)),Ke.isFormData(e))return n?JSON.stringify(Phe(e)):e;if(Ke.isArrayBuffer(e)||Ke.isBuffer(e)||Ke.isStream(e)||Ke.isFile(e)||Ke.isBlob(e)||Ke.isReadableStream(e))return e;if(Ke.isArrayBufferView(e))return e.buffer;if(Ke.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return CBe(e,this.formSerializer).toString();if((o=Ke.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Bx(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),NBe(e)):e}],transformResponse:[function(e){const i=this.transitional||ER.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(Ke.isResponse(e)||Ke.isReadableStream(e))return e;if(e&&Ke.isString(e)&&(r&&!this.responseType||n)){const s=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(o){if(s)throw o.name==="SyntaxError"?vr.from(o,vr.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Xl.classes.FormData,Blob:Xl.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ke.forEach(["delete","get","head","post","put","patch"],t=>{ER.headers[t]={}});const ABe=Ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_Be=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(s){n=s.indexOf(":"),i=s.substring(0,n).trim().toLowerCase(),r=s.substring(n+1).trim(),!(!i||e[i]&&ABe[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},NK=Symbol("internals");function cE(t){return t&&String(t).trim().toLowerCase()}function EN(t){return t===!1||t==null?t:Ke.isArray(t)?t.map(EN):String(t)}function kBe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const OBe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Y2(t,e,i,r,n){if(Ke.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!Ke.isString(e)){if(Ke.isString(r))return e.indexOf(r)!==-1;if(Ke.isRegExp(r))return r.test(e)}}function xBe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function LBe(t,e){const i=Ke.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,s){return this[r].call(this,e,n,a,s)},configurable:!0})})}let Nu=class{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(o,l,c){const u=cE(l);if(!u)throw new Error("header name must be a non-empty string");const d=Ke.findKey(n,u);(!d||n[d]===void 0||c===!0||c===void 0&&n[d]!==!1)&&(n[d||l]=EN(o))}const s=(o,l)=>Ke.forEach(o,(c,u)=>a(c,u,l));if(Ke.isPlainObject(e)||e instanceof this.constructor)s(e,i);else if(Ke.isString(e)&&(e=e.trim())&&!OBe(e))s(_Be(e),i);else if(Ke.isObject(e)&&Ke.isIterable(e)){let o={},l,c;for(const u of e){if(!Ke.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[c=u[0]]=(l=o[c])?Ke.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}s(o,i)}else e!=null&&a(i,e,r);return this}get(e,i){if(e=cE(e),e){const r=Ke.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return kBe(n);if(Ke.isFunction(i))return i.call(this,n,r);if(Ke.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=cE(e),e){const r=Ke.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||Y2(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(s){if(s=cE(s),s){const o=Ke.findKey(r,s);o&&(!i||Y2(r,r[o],o,i))&&(delete r[o],n=!0)}}return Ke.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||Y2(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return Ke.forEach(this,(n,a)=>{const s=Ke.findKey(r,a);if(s){i[s]=EN(n),delete i[a];return}const o=e?xBe(a):String(a).trim();o!==a&&delete i[a],i[o]=EN(n),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ke.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&Ke.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[NK]=this[NK]={accessors:{}}).accessors,n=this.prototype;function a(s){const o=cE(s);r[o]||(LBe(n,s),r[o]=!0)}return Ke.isArray(e)?e.forEach(a):a(e),this}};Nu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ke.reduceDescriptors(Nu.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});Ke.freezeMethods(Nu);function K2(t,e){const i=this||ER,r=e||i,n=Nu.from(r.headers);let a=r.data;return Ke.forEach(t,function(o){a=o.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function Che(t){return!!(t&&t.__CANCEL__)}function pD(t,e,i){vr.call(this,t??"canceled",vr.ERR_CANCELED,e,i),this.name="CanceledError"}Ke.inherits(pD,vr,{__CANCEL__:!0});function Rhe(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new vr("Request failed with status code "+i.status,[vr.ERR_BAD_REQUEST,vr.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}function FBe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function BBe(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,s;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[a];s||(s=c),i[n]=l,r[n]=c;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),c-s<e)return;const h=u&&c-u;return h?Math.round(p*1e3/h):void 0}}function $Be(t,e){let i=0,r=1e3/e,n,a;const s=(c,u=Date.now())=>{i=u,n=null,a&&(clearTimeout(a),a=null),t(...c)};return[(...c)=>{const u=Date.now(),d=u-i;d>=r?s(c,u):(n=c,a||(a=setTimeout(()=>{a=null,s(n)},r-d)))},()=>n&&s(n)]}const QA=(t,e,i=3)=>{let r=0;const n=BBe(50,250);return $Be(a=>{const s=a.loaded,o=a.lengthComputable?a.total:void 0,l=s-r,c=n(l),u=s<=o;r=s;const d={loaded:s,total:o,progress:o?s/o:void 0,bytes:l,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},i)},AK=(t,e)=>{const i=t!=null;return[r=>e[0]({lengthComputable:i,total:t,loaded:r}),e[1]]},_K=t=>(...e)=>Ke.asap(()=>t(...e)),VBe=Xl.hasStandardBrowserEnv?((t,e)=>i=>(i=new URL(i,Xl.origin),t.protocol===i.protocol&&t.host===i.host&&(e||t.port===i.port)))(new URL(Xl.origin),Xl.navigator&&/(msie|trident)/i.test(Xl.navigator.userAgent)):()=>!0,jBe=Xl.hasStandardBrowserEnv?{write(t,e,i,r,n,a,s){if(typeof document>"u")return;const o=[`${t}=${encodeURIComponent(e)}`];Ke.isNumber(i)&&o.push(`expires=${new Date(i).toUTCString()}`),Ke.isString(r)&&o.push(`path=${r}`),Ke.isString(n)&&o.push(`domain=${n}`),a===!0&&o.push("secure"),Ke.isString(s)&&o.push(`SameSite=${s}`),document.cookie=o.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function GBe(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function HBe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Mhe(t,e,i){let r=!GBe(e);return t&&(r||i==!1)?HBe(t,e):e}const kK=t=>t instanceof Nu?{...t}:t;function gI(t,e){e=e||{};const i={};function r(c,u,d,p){return Ke.isPlainObject(c)&&Ke.isPlainObject(u)?Ke.merge.call({caseless:p},c,u):Ke.isPlainObject(u)?Ke.merge({},u):Ke.isArray(u)?u.slice():u}function n(c,u,d,p){if(Ke.isUndefined(u)){if(!Ke.isUndefined(c))return r(void 0,c,d,p)}else return r(c,u,d,p)}function a(c,u){if(!Ke.isUndefined(u))return r(void 0,u)}function s(c,u){if(Ke.isUndefined(u)){if(!Ke.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function o(c,u,d){if(d in e)return r(c,u);if(d in t)return r(void 0,c)}const l={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:o,headers:(c,u,d)=>n(kK(c),kK(u),d,!0)};return Ke.forEach(Object.keys({...t,...e}),function(u){const d=l[u]||n,p=d(t[u],e[u],u);Ke.isUndefined(p)&&d!==o||(i[u]=p)}),i}const Nhe=t=>{const e=gI({},t);let{data:i,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:s,auth:o}=e;if(e.headers=s=Nu.from(s),e.url=Dhe(Mhe(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&s.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Ke.isFormData(i)){if(Xl.hasStandardBrowserEnv||Xl.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(Ke.isFunction(i.getHeaders)){const l=i.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&s.set(u,d)})}}if(Xl.hasStandardBrowserEnv&&(r&&Ke.isFunction(r)&&(r=r(e)),r||r!==!1&&VBe(e.url))){const l=n&&a&&jBe.read(a);l&&s.set(n,l)}return e},zBe=typeof XMLHttpRequest<"u",qBe=zBe&&function(t){return new Promise(function(i,r){const n=Nhe(t);let a=n.data;const s=Nu.from(n.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:c}=n,u,d,p,h,f;function m(){h&&h(),f&&f(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function v(){if(!g)return;const b=Nu.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),w={data:!o||o==="text"||o==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:b,config:t,request:g};Rhe(function(S){i(S),m()},function(S){r(S),m()},w),g=null}"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(v)},g.onabort=function(){g&&(r(new vr("Request aborted",vr.ECONNABORTED,t,g)),g=null)},g.onerror=function(I){const w=I&&I.message?I.message:"Network Error",T=new vr(w,vr.ERR_NETWORK,t,g);T.event=I||null,r(T),g=null},g.ontimeout=function(){let I=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const w=n.transitional||Ehe;n.timeoutErrorMessage&&(I=n.timeoutErrorMessage),r(new vr(I,w.clarifyTimeoutError?vr.ETIMEDOUT:vr.ECONNABORTED,t,g)),g=null},a===void 0&&s.setContentType(null),"setRequestHeader"in g&&Ke.forEach(s.toJSON(),function(I,w){g.setRequestHeader(w,I)}),Ke.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),o&&o!=="json"&&(g.responseType=n.responseType),c&&([p,f]=QA(c,!0),g.addEventListener("progress",p)),l&&g.upload&&([d,h]=QA(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",h)),(n.cancelToken||n.signal)&&(u=b=>{g&&(r(!b||b.type?new pD(null,t,g):b),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const y=FBe(n.url);if(y&&Xl.protocols.indexOf(y)===-1){r(new vr("Unsupported protocol "+y+":",vr.ERR_BAD_REQUEST,t));return}g.send(a||null)})},WBe=(t,e)=>{const{length:i}=t=t?t.filter(Boolean):[];if(e||i){let r=new AbortController,n;const a=function(c){if(!n){n=!0,o();const u=c instanceof Error?c:this.reason;r.abort(u instanceof vr?u:new pD(u instanceof Error?u.message:u))}};let s=e&&setTimeout(()=>{s=null,a(new vr(`timeout ${e} of ms exceeded`,vr.ETIMEDOUT))},e);const o=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),t=null)};t.forEach(c=>c.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>Ke.asap(o),l}},YBe=function*(t,e){let i=t.byteLength;if(i<e){yield t;return}let r=0,n;for(;r<i;)n=r+e,yield t.slice(r,n),r=n},KBe=async function*(t,e){for await(const i of ZBe(t))yield*YBe(i,e)},ZBe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)break;yield r}}finally{await e.cancel()}},OK=(t,e,i,r)=>{const n=KBe(t,e);let a=0,s,o=l=>{s||(s=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await n.next();if(c){o(),l.close();return}let d=u.byteLength;if(i){let p=a+=d;i(p)}l.enqueue(new Uint8Array(u))}catch(c){throw o(c),c}},cancel(l){return o(l),n.return()}},{highWaterMark:2})},xK=64*1024,{isFunction:UM}=Ke,XBe=(({Request:t,Response:e})=>({Request:t,Response:e}))(Ke.global),{ReadableStream:LK,TextEncoder:FK}=Ke.global,BK=(t,...e)=>{try{return!!t(...e)}catch{return!1}},JBe=t=>{t=Ke.merge.call({skipUndefined:!0},XBe,t);const{fetch:e,Request:i,Response:r}=t,n=e?UM(e):typeof fetch=="function",a=UM(i),s=UM(r);if(!n)return!1;const o=n&&UM(LK),l=n&&(typeof FK=="function"?(f=>m=>f.encode(m))(new FK):async f=>new Uint8Array(await new i(f).arrayBuffer())),c=a&&o&&BK(()=>{let f=!1;const m=new i(Xl.origin,{body:new LK,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!m}),u=s&&o&&BK(()=>Ke.isReadableStream(new r("").body)),d={stream:u&&(f=>f.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!d[f]&&(d[f]=(m,g)=>{let v=m&&m[f];if(v)return v.call(m);throw new vr(`Response type '${f}' is not supported`,vr.ERR_NOT_SUPPORT,g)})});const p=async f=>{if(f==null)return 0;if(Ke.isBlob(f))return f.size;if(Ke.isSpecCompliantForm(f))return(await new i(Xl.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(Ke.isArrayBufferView(f)||Ke.isArrayBuffer(f))return f.byteLength;if(Ke.isURLSearchParams(f)&&(f=f+""),Ke.isString(f))return(await l(f)).byteLength},h=async(f,m)=>{const g=Ke.toFiniteNumber(f.getContentLength());return g??p(m)};return async f=>{let{url:m,method:g,data:v,signal:y,cancelToken:b,timeout:I,onDownloadProgress:w,onUploadProgress:T,responseType:S,headers:D,withCredentials:C="same-origin",fetchOptions:E}=Nhe(f),P=e||fetch;S=S?(S+"").toLowerCase():"text";let R=WBe([y,b&&b.toAbortSignal()],I),M=null;const A=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let N;try{if(T&&c&&g!=="get"&&g!=="head"&&(N=await h(D,v))!==0){let j=new i(m,{method:"POST",body:v,duplex:"half"}),q;if(Ke.isFormData(v)&&(q=j.headers.get("content-type"))&&D.setContentType(q),j.body){const[W,z]=AK(N,QA(_K(T)));v=OK(j.body,xK,W,z)}}Ke.isString(C)||(C=C?"include":"omit");const k=a&&"credentials"in i.prototype,x={...E,signal:R,method:g.toUpperCase(),headers:D.normalize().toJSON(),body:v,duplex:"half",credentials:k?C:void 0};M=a&&new i(m,x);let O=await(a?P(M,E):P(m,x));const V=u&&(S==="stream"||S==="response");if(u&&(w||V&&A)){const j={};["status","statusText","headers"].forEach(H=>{j[H]=O[H]});const q=Ke.toFiniteNumber(O.headers.get("content-length")),[W,z]=w&&AK(q,QA(_K(w),!0))||[];O=new r(OK(O.body,xK,W,()=>{z&&z(),A&&A()}),j)}S=S||"text";let F=await d[Ke.findKey(d,S)||"text"](O,f);return!V&&A&&A(),await new Promise((j,q)=>{Rhe(j,q,{data:F,headers:Nu.from(O.headers),status:O.status,statusText:O.statusText,config:f,request:M})})}catch(k){throw A&&A(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new vr("Network Error",vr.ERR_NETWORK,f,M),{cause:k.cause||k}):vr.from(k,k&&k.code,f,M)}}},QBe=new Map,Ahe=t=>{let e=t&&t.env||{};const{fetch:i,Request:r,Response:n}=e,a=[r,n,i];let s=a.length,o=s,l,c,u=QBe;for(;o--;)l=a[o],c=u.get(l),c===void 0&&u.set(l,c=o?new Map:JBe(e)),u=c;return c};Ahe();const r4={http:gBe,xhr:qBe,fetch:{get:Ahe}};Ke.forEach(r4,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const $K=t=>`- ${t}`,e$e=t=>Ke.isFunction(t)||t===null||t===!1;function t$e(t,e){t=Ke.isArray(t)?t:[t];const{length:i}=t;let r,n;const a={};for(let s=0;s<i;s++){r=t[s];let o;if(n=r,!e$e(r)&&(n=r4[(o=String(r)).toLowerCase()],n===void 0))throw new vr(`Unknown adapter '${o}'`);if(n&&(Ke.isFunction(n)||(n=n.get(e))))break;a[o||"#"+s]=n}if(!n){const s=Object.entries(a).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=i?s.length>1?`since :
`+s.map($K).join(`
`):" "+$K(s[0]):"as no adapter specified";throw new vr("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n}const _he={getAdapter:t$e,adapters:r4};function Z2(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new pD(null,t)}function VK(t){return Z2(t),t.headers=Nu.from(t.headers),t.data=K2.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),_he.getAdapter(t.adapter||ER.adapter,t)(t).then(function(r){return Z2(t),r.data=K2.call(t,t.transformResponse,r),r.headers=Nu.from(r.headers),r},function(r){return Che(r)||(Z2(t),r&&r.response&&(r.response.data=K2.call(t,t.transformResponse,r.response),r.response.headers=Nu.from(r.response.headers))),Promise.reject(r)})}const khe="1.13.2",$x={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{$x[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const jK={};$x.transitional=function(e,i,r){function n(a,s){return"[Axios v"+khe+"] Transitional option '"+a+"'"+s+(r?". "+r:"")}return(a,s,o)=>{if(e===!1)throw new vr(n(s," has been removed"+(i?" in "+i:"")),vr.ERR_DEPRECATED);return i&&!jK[s]&&(jK[s]=!0,console.warn(n(s," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,s,o):!0}};$x.spelling=function(e){return(i,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function i$e(t,e,i){if(typeof t!="object")throw new vr("options must be an object",vr.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],s=e[a];if(s){const o=t[a],l=o===void 0||s(o,a,t);if(l!==!0)throw new vr("option "+a+" must be "+l,vr.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new vr("Unknown option "+a,vr.ERR_BAD_OPTION)}}const PN={assertOptions:i$e,validators:$x},vf=PN.validators;let Vb=class{constructor(e){this.defaults=e||{},this.interceptors={request:new MK,response:new MK}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=gI(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&PN.assertOptions(r,{silentJSONParsing:vf.transitional(vf.boolean),forcedJSONParsing:vf.transitional(vf.boolean),clarifyTimeoutError:vf.transitional(vf.boolean)},!1),n!=null&&(Ke.isFunction(n)?i.paramsSerializer={serialize:n}:PN.assertOptions(n,{encode:vf.function,serialize:vf.function},!0)),i.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?i.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:i.allowAbsoluteUrls=!0),PN.assertOptions(i,{baseUrl:vf.spelling("baseURL"),withXsrfToken:vf.spelling("withXSRFToken")},!0),i.method=(i.method||this.defaults.method||"get").toLowerCase();let s=a&&Ke.merge(a.common,a[i.method]);a&&Ke.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),i.headers=Nu.concat(s,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,o.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const f=[VK.bind(this),void 0];for(f.unshift(...o),f.push(...c),p=f.length,u=Promise.resolve(i);d<p;)u=u.then(f[d++],f[d++]);return u}p=o.length;let h=i;for(;d<p;){const f=o[d++],m=o[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{u=VK.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=gI(this.defaults,e);const i=Mhe(e.baseURL,e.url,e.allowAbsoluteUrls);return Dhe(i,e.params,e.paramsSerializer)}};Ke.forEach(["delete","get","head","options"],function(e){Vb.prototype[e]=function(i,r){return this.request(gI(r||{},{method:e,url:i,data:(r||{}).data}))}});Ke.forEach(["post","put","patch"],function(e){function i(r){return function(a,s,o){return this.request(gI(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}Vb.prototype[e]=i(),Vb.prototype[e+"Form"]=i(!0)});let r$e=class Ohe{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const s=new Promise(o=>{r.subscribe(o),a=o}).then(n);return s.cancel=function(){r.unsubscribe(a)},s},e(function(a,s,o){r.reason||(r.reason=new pD(a,s,o),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const e=new AbortController,i=r=>{e.abort(r)};return this.subscribe(i),e.signal.unsubscribe=()=>this.unsubscribe(i),e.signal}static source(){let e;return{token:new Ohe(function(n){e=n}),cancel:e}}};function n$e(t){return function(i){return t.apply(null,i)}}function a$e(t){return Ke.isObject(t)&&t.isAxiosError===!0}const VV={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(VV).forEach(([t,e])=>{VV[e]=t});function xhe(t){const e=new Vb(t),i=hhe(Vb.prototype.request,e);return Ke.extend(i,Vb.prototype,e,{allOwnKeys:!0}),Ke.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return xhe(gI(t,n))},i}const Js=xhe(ER);Js.Axios=Vb;Js.CanceledError=pD;Js.CancelToken=r$e;Js.isCancel=Che;Js.VERSION=khe;Js.toFormData=Bx;Js.AxiosError=vr;Js.Cancel=Js.CanceledError;Js.all=function(e){return Promise.all(e)};Js.spread=n$e;Js.isAxiosError=a$e;Js.mergeConfig=gI;Js.AxiosHeaders=Nu;Js.formToJSON=t=>Phe(Ke.isHTMLForm(t)?new FormData(t):t);Js.getAdapter=_he.getAdapter;Js.HttpStatusCode=VV;Js.default=Js;const{Axios:uIt,AxiosError:dIt,CanceledError:pIt,isCancel:hIt,CancelToken:fIt,VERSION:mIt,all:gIt,Cancel:vIt,isAxiosError:yIt,spread:bIt,toFormData:IIt,AxiosHeaders:wIt,HttpStatusCode:SIt,formToJSON:TIt,getAdapter:UIt,mergeConfig:DIt}=Js,Lhe=phe(),s$e="https://courthive.net",PR=Js.create({baseURL:s$e});PR.interceptors.request.use(t=>{const e=localStorage.getItem(Lhe);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));PR.interceptors.response.use(t=>(t.data?.error&&$t({message:t.data.error?.message,intent:"is-danger"}),t),t=>{if(t.message==="Network Error"&&$t({message:t.message,intent:"is-danger"}),t.response){t.response?.status===401&&Fhe();const e=t.response.data.message||t.response.data.error||t.response.data;$t({message:e,intent:"is-danger"})}});const o$e=()=>{const t=localStorage.getItem(Lhe);PR.defaults.headers.common.Authorization=`Bearer ${t}`},Fhe=()=>{PR.defaults.headers.common.Authorization=void 0},Xc={...PR,addAuthorization:o$e,removeAuthorization:Fhe};async function l$e({identifier:t}){return await Xc.post("/service/tournamentdetails",{identifier:t})}async function Vx({tournamentId:t}){return await Xc.post("/factory/fetch",{tournamentId:t})}async function c$e({provider:t}){return await Xc.post("/provider/add",t)}async function u$e({provider:t}){return await Xc.post("/provider/modify",t)}async function d$e({providerId:t}){return await Xc.post("/provider/detail",{providerId:t})}async function p$e({providerAbbr:t}){return await Xc.post("/provider/calendar",{providerAbbr:t})}async function oC(){return await Xc.post("/provider/allProviders",{})}async function Bhe(){return await Xc.post("/auth/allusers",{})}async function h$e({email:t}){return await Xc.post("/auth/remove",{email:t})}async function KE({tournamentRecord:t}){return await Xc.post("/factory/save",{tournamentRecord:t})}async function f$e({providerId:t,tournamentId:e}){return await Xc.post("/factory/remove",{providerId:t,tournamentId:e})}function n4(t){return t[t.length-1]}function CR(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function GK(t,e){return t?t.split(e):[]}function a4(t,e,i){const r=e===void 0||t>=e,n=i===void 0||t<=i;return r&&n}function $he(t,e,i){return t<e?e:t>i?i:t}function VT(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let c=i[l];return typeof c=="function"&&(c=c(r)),`${o} ${l}="${c}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?VT(t,e,i,s,n):n}function s4(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function jV(t){return new Date(t).setHours(0,0,0,0)}function hw(){return new Date().setHours(0,0,0,0)}function jT(...t){switch(t.length){case 0:return hw();case 1:return jV(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function lC(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function m$e(t,e){return lC(t,e*7)}function e_(t,e){const i=new Date(t),r=i.getMonth()+e;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function cC(t,e){const i=new Date(t),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+e);return r===1&&i.getMonth()===2?i.setDate(0):n}function HK(t,e){return(t-e+7)%7}function jb(t,e,i=0){const r=new Date(t).getDay();return lC(t,HK(e,i)-HK(r,i))}function Vhe(t,e){return Math.round((t-e)/6048e5)+1}function g$e(t){const e=jb(t,4,1),i=jb(new Date(e).setMonth(0,4),4,1);return Vhe(e,i)}function jhe(t,e){const i=jb(new Date(t).setMonth(0,1),e,e),r=jb(t,e,e),n=Vhe(r,i);if(n<53)return n;const a=jb(new Date(t).setDate(32),e,e);return r===a?1:n}function v$e(t){return jhe(t,0)}function y$e(t){return jhe(t,6)}function pS(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Bv(t,e,i){if(e!==1&&e!==2)return t;const r=new Date(t);return e===1?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const GV=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,b$e=/[\s!-/:-@[-`{-~]+/;let X2={};const zK={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const r=new Date(t);let n=parseInt(e,10)-1;if(isNaN(n)){if(!e)return NaN;const a=e.toLowerCase(),s=o=>o.toLowerCase().startsWith(a);if(n=i.monthsShort.findIndex(s),n<0&&(n=i.months.findIndex(s)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==Ghe(n)?r.setDate(0):r.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},I$e={d(t){return t.getDate()},dd(t){return DM(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return DM(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return DM(t.getFullYear(),2).slice(-2)},yyyy(t){return DM(t.getFullYear(),4)}};function Ghe(t){return t>-1?t%12:Ghe(t+12)}function DM(t,e){return t.toString().padStart(e,"0")}function Hhe(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in X2)return X2[t];const e=t.split(GV),i=t.match(new RegExp(GV,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const r=i.map(a=>I$e[a]),n=Object.keys(zK).reduce((a,s)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===s)&&a.push(s),a),[]);return X2[t]={parser(a,s){const o=a.split(b$e).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return n.reduce((l,c)=>{const u=zK[c](l,o[c],s);return isNaN(u)?l:u},hw())},formatter(a,s){let o=r.reduce((l,c,u)=>l+=`${e[u]}${c(a,s)}`,"");return o+=n4(e)}}}function vI(t,e,i){if(t instanceof Date||typeof t=="number"){const r=jV(t);return isNaN(r)?void 0:r}if(t){if(t==="today")return hw();if(e&&e.toValue){const r=e.toValue(t,e,i);return isNaN(r)?void 0:jV(r)}return Hhe(e).parser(t,i)}}function RR(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const r=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(r,e,i):Hhe(e).formatter(r,i)}const w$e=document.createRange();function gg(t){return w$e.createContextualFragment(t)}function zhe(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function jx(t){return t.getRootNode().activeElement===t}function ZE(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function XE(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function t_(t){t.firstChild&&(t.removeChild(t.firstChild),t_(t))}function S$e(t,e){t_(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(gg(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const i_=new WeakMap,{addEventListener:T$e,removeEventListener:U$e}=EventTarget.prototype;function r_(t,e){let i=i_.get(t);i||(i=[],i_.set(t,i)),e.forEach(r=>{T$e.call(...r),i.push(r)})}function qhe(t){let e=i_.get(t);e&&(e.forEach(i=>{U$e.call(...i)}),i_.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function Whe(t,e,i){const[r,...n]=t;if(e(r))return r;if(!(r===i||r.tagName==="HTML"||n.length===0))return Whe(n,e,i)}function Yhe(t,e){const i=typeof e=="function"?e:r=>r instanceof Element&&r.matches(e);return Whe(t.composedPath(),i,t.currentTarget)}const uE={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},o4={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:J2,format:D$e,weekStart:E$e}=o4;function qK(t,e){return t.length<6&&e>=0&&e<7?CR(t,e):t}function Khe(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return g$e;case 2:return v$e;case 3:return y$e}}function WK(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Khe(4,t)),t}function YK(t,e,i,r){const n=vI(t,e,i);return n!==void 0?n:r}function Q2(t,e,i=3){const r=parseInt(t,10);return r>=0&&r<=i?r:e}function EM(t,e,i,r=void 0){e in t&&(i in t||(t[i]=r?r(t[e]):t[e]),delete t[e])}function eB(t,e){const i=Object.assign({},t),r={},n=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:s,format:o,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(EM(i,"calendarWeeks","weekNumbers",T=>T?1:0),EM(i,"clearBtn","clearButton"),EM(i,"todayBtn","todayButton"),EM(i,"todayBtnMode","todayButtonMode"),i.language){let T;if(i.language!==l&&(n[i.language]?T=i.language:(T=i.language.split("-")[0],n[T]||(T=!1))),delete i.language,T){l=r.language=T;const S=c||n[J2];c=Object.assign({format:D$e,weekStart:E$e},n[J2]),l!==J2&&Object.assign(c,n[l]),r.locale=c,o===S.format&&(o=r.format=c.format),g===S.weekStart&&(g=WK(c.weekStart,r,m))}}if(i.format){const T=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",D=GV.test(i.format);(T&&S||D)&&(o=r.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=Q2(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),s&&!i.datesDisabled&&(i.datesDisabled=[]),h=r.pickLevel=v);let y=p,b=u;if("minDate"in i){const T=jT(0,0,1);y=i.minDate===null?T:YK(i.minDate,o,c,y),y!==T&&(y=Bv(y,h,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:YK(i.maxDate,o,c,b),b!==void 0&&(b=Bv(b,h,!0)),delete i.maxDate),b<y?(p=r.minDate=b,u=r.maxDate=y):(p!==y&&(p=r.minDate=y),u!==b&&(u=r.maxDate=b)),i.datesDisabled){const T=i.datesDisabled;if(typeof T=="function")r.datesDisabled=null,r.checkDisabled=(S,D)=>T(new Date(S),D,a);else{const S=r.datesDisabled=T.reduce((D,C)=>{const E=vI(C,o,c);return E!==void 0?CR(D,Bv(E,h,a)):D},[]);r.checkDisabled=D=>S.includes(D)}delete i.datesDisabled}if("defaultViewDate"in i){const T=vI(i.defaultViewDate,o,c);T!==void 0&&(r.defaultViewDate=T),delete i.defaultViewDate}if("weekStart"in i){const T=Number(i.weekStart)%7;isNaN(T)||(g=WK(T,r,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(qK,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(qK,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let T=i.weekNumbers;if(T){const S=typeof T=="function"?(D,C)=>T(new Date(D),C):Khe(T=parseInt(T,10),g);S&&(m=r.weekNumbers=T,r.getWeekNumber=S)}else m=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const T=parseInt(i.maxNumberOfDates,10);T>=0&&(r.maxNumberOfDates=T,r.multidate=T!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=Q2(i.maxView,d),delete i.maxView),I=h>I?h:I,I!==d&&(d=r.maxView=I);let w=f;if("startView"in i&&(w=Q2(i.startView,w),delete i.startView),w<h?w=h:w>d&&(w=d),w!==f&&(r.startView=w),i.prevArrow){const T=gg(i.prevArrow);T.childNodes.length>0&&(r.prevArrow=T.childNodes),delete i.prevArrow}if(i.nextArrow){const T=gg(i.nextArrow);T.childNodes.length>0&&(r.nextArrow=T.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const T=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:T.find(S=>S==="left"||S==="right")||"auto",y:T.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([T,S])=>{S!==void 0&&T in o4&&(r[T]=S)}),r}const KK={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function P$e(t){return Object.keys(KK).reduce((e,i)=>{const r=t[i]===void 0?KK[i]:t[i],n=r&&r.key;if(!n||typeof n!="string")return e;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),e[i]=a,e},{})}const ZK=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),C$e=s4(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${ZK(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${ZK(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),R$e=s4(`<div class="days">
  <div class="days-of-week">${VT("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${VT("span",42)}</div>
</div>`),M$e=s4(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${VT("span",6,{class:"week"})}</div>
</div>`);let l4=class{constructor(e,i){Object.assign(this,i,{picker:e,element:gg('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,r){this.disabled=[];const n=this.picker;n.setViewSwitchLabel(e),n.setPrevButtonDisabled(i),n.setNextButtonDisabled(r)}setDisabled(e,i){i.add("disabled"),CR(this.disabled,e)}performBeforeHook(e,i){let r=this.beforeShow(new Date(i));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const n=e.classList;if(r.enabled===!1&&this.setDisabled(i,n),r.classes){const a=r.classes.split(/\s+/);n.add(...a),a.includes("disabled")&&this.setDisabled(i,n)}r.content&&S$e(e,r.content)}}renderCell(e,i,r,n,{selected:a,range:s},o,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=n);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?c.add("prev"):r>this.last&&c.add("next"),c.add(...l),(o||this.checkDisabled(n,this.id))&&this.setDisabled(n,c),s){const[u,d]=s;r>u&&r<d&&c.add("range"),r===u&&c.add("range-start"),r===d&&c.add("range-end")}a.includes(r)&&c.add("selected"),r===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,n)}refreshCell(e,i,r,[n,a]){const s=e.classList;s.remove("range","range-start","range-end","selected","focused"),i>n&&i<a&&s.add("range"),i===n&&s.add("range-start"),i===a&&s.add("range-end"),r.includes(i)&&s.add("selected"),i===this.focused&&s.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class N$e extends l4{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const r=gg(R$e).firstChild;this.dow=r.firstChild,this.grid=r.lastChild,this.element.appendChild(r)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const r=gg(M$e).firstChild;this.weekNumbers={element:r,dow:r.firstChild,weeks:r.lastChild},this.element.insertBefore(r,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(XE(this.dow),this.weekNumbers&&XE(this.weekNumbers.dow)):(ZE(this.dow),this.weekNumbers&&ZE(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((r,n)=>{const a=(this.weekStart+n)%7;r.textContent=this.dayNames[a],r.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),r=e.getMonth(),n=jT(i,r,1),a=jb(n,this.weekStart,this.weekStart);this.first=n,this.last=jT(i,r+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?hw():void 0,this.prepareForRender(RR(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=jb(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,n)=>{const a=m$e(i,n);r.textContent=this.getWeekNumber(a,e),n>3&&r.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const r=lC(this.start,i),n=new Date(r),a=n.getDay(),s=[];this.today===r&&s.push("today"),this.daysOfWeekHighlighted.includes(a)&&s.push("highlighted"),this.renderCell(e,n.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(a),s)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function XK(t,e){if(!t||!t[0]||!t[1])return;const[[i,r],[n,a]]=t;if(!(i>e||n<e))return[i===e?r:-1,n===e?a:12]}class A$e extends l4{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(gg(VT("span",12,{"data-month":r=>r}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=jT(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>{const a=new Date(n),s=a.getFullYear(),o=a.getMonth();return r[s]===void 0?r[s]=[o]:CR(r[s],o),r},{}),i&&i.dates&&(this.range=i.dates.map(r=>{const n=new Date(r);return isNaN(n)?void 0:[n.getFullYear(),n.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,n=this.year===this.maxYear,a=XK(this.range,this.year);Array.from(this.grid.children).forEach((s,o)=>{const l=Bv(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(s,this.monthNames[o],o,l,{selected:e,range:a},i||r&&o<this.minMonth||n&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=XK(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,n)=>{this.refreshCell(r,n,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function _$e(t){return[...t].reduce((e,i,r)=>e+=r?i:i.toUpperCase(),"")}class JK extends l4{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${_$e(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(gg(VT("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=pS(e.minDate,this.step),this.minDate=jT(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=pS(e.maxDate,this.step),this.maxDate=jT(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=pS(e,this.navStep),r=i+9*this.step;this.first=i,this.last=r,this.start=i-this.step,this.focused=pS(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((r,n)=>CR(r,pS(n,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(r=>{if(r!==void 0)return pS(r,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const r=this.start+i*this.step,n=Bv(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,n,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function MS(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function n_(t,e){const{config:i,picker:r}=t,{currentView:n,viewDate:a}=r;let s;switch(n.id){case 0:s=e_(a,e);break;case 1:s=cC(a,e);break;default:s=cC(a,e*n.navStep)}s=$he(s,i.minDate,i.maxDate),r.changeFocus(s).render()}function Zhe(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function Xhe(t){t.setDate({clear:!0})}function Jhe(t){const e=hw();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function Qhe(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;jx(i)?i.addEventListener("blur",e,{once:!0}):e()}function QK(t,e){const i=t.picker,r=new Date(i.viewDate),n=i.currentView.id,a=n===1?e_(r,e-r.getMonth()):cC(r,e-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function k$e(t){Zhe(t)}function O$e(t){n_(t,-1)}function x$e(t){n_(t,1)}function L$e(t,e){const i=Yhe(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=t.picker.currentView,a=i.dataset;n?t.setDate(Number(a.date)):r===1?QK(t,Number(a.month)):QK(t,Number(a.year))}function F$e(t){t.preventDefault()}const tB=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),eZ=t=>t&&`${t}px`;function tZ(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,XE(t.controls.title)):(t.controls.title.textContent="",ZE(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;t_(i),e.prevArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;t_(i),e.nextArrow.forEach(r=>{i.appendChild(r.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?XE(t.controls.todayButton):ZE(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:r}=t.datepicker.config;t.controls.todayButton.disabled=!a4(hw(),i,r)}"clearButton"in e&&(e.clearButton?XE(t.controls.clearButton):ZE(t.controls.clearButton))}function iZ(t){const{dates:e,config:i,rangeSideIndex:r}=t,n=e.length>0?n4(e):Bv(i.defaultViewDate,i.pickLevel,r);return $he(n,i.minDate,i.maxDate)}function rZ(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:r,first:n,last:a}=t.currentView,s=new Date(e).getFullYear();switch(i){case 0:return e<n||e>a;case 1:return s!==r;default:return s<n||s>a}}function iB(t){return window.getComputedStyle(t).direction}function efe(t){const e=zhe(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:efe(e)}let B$e=class{constructor(e){const{config:i,inputField:r}=this.datepicker=e,n=C$e.replace(/%buttonClass%/g,i.buttonClass),a=this.element=gg(n).firstChild,[s,o,l]=a.firstChild.children,c=s.firstElementChild,[u,d,p]=s.lastElementChild.children,[h,f]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=o,this.controls=m;const g=r?"dropdown":"inline";a.classList.add(`datepicker-${g}`),tZ(this,i),this.viewDate=iZ(e),r_(e,[[a,"mousedown",F$e],[o,"click",L$e.bind(null,e)],[m.viewSwitch,"click",k$e.bind(null,e)],[m.prevButton,"click",O$e.bind(null,e)],[m.nextButton,"click",x$e.bind(null,e)],[m.todayButton,"click",Jhe.bind(null,e)],[m.clearButton,"click",Xhe.bind(null,e)]]),this.views=[new N$e(this),new A$e(this),new JK(this,{id:2,name:"years",cellClass:"year",step:1}),new JK(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):r.after(this.element)}setOptions(e){tZ(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,r=e.inputField;if(r){const n=iB(r);n!==iB(zhe(i))?i.dir=n:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else i.classList.add("active");this.active=!0,MS(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,MS(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:r,height:n}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:s,inputField:o}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:h}=o.getBoundingClientRect();let{x:f,y:m}=s.orientation,g=l,v=c;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const D=a.getBoundingClientRect();g-=D.left-a.scrollLeft,v-=D.top-a.scrollTop}const y=efe(o);let b=0,I=0,{clientWidth:w,clientHeight:T}=document.documentElement;if(y){const D=y.getBoundingClientRect();D.top>0&&(I=D.top),D.left>0&&(b=D.left),D.right<w&&(w=D.right),D.bottom<T&&(T=D.bottom)}let S=0;f==="auto"&&(l<b?(f="left",S=b-l):l+r>w?(f="right",w<u&&(S=w-u)):iB(o)==="rtl"?f=u-r<b?"left":"right":f="left"),f==="right"&&(g+=p-r),g+=S,m==="auto"&&(c-n>I?m=d+n>T?"top":"bottom":m="bottom"),m==="top"?v-=n:v+=h,e.remove(...Object.values(tB)),e.add(tB[f],tB[m]),i.left=eZ(g),i.top=eZ(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=rZ(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?iZ(this.datepicker):e;return this._renderMethod=rZ(this,i)?"render":"refresh",this.views.forEach(r=>{r.updateFocus(),r.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:r,_oldView:n}=this,a=new Date(this._oldViewDate),s=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[s](),n&&(this.main.replaceChild(i.element,n.element),MS(r,"changeView")),!isNaN(a)){const o=new Date(this.viewDate);o.getFullYear()!==a.getFullYear()&&MS(r,"changeYear"),o.getMonth()!==a.getMonth()&&MS(r,"changeMonth")}}};function tfe(t,e,i,r,n,a){if(a4(t,n,a)){if(r(t)){const s=e(t,i);return tfe(s,e,i,r,n,a)}return t}}function $$e(t,e,i){const r=t.picker,n=r.currentView,a=n.step||1;let s=r.viewDate,o;switch(n.id){case 0:s=lC(s,i?e*7:e),o=lC;break;case 1:s=e_(s,i?e*4:e),o=e_;break;default:s=cC(s,e*(i?4:1)*a),o=cC}s=tfe(s,o,e<0?-a:a,l=>n.disabled.includes(l),n.minDate,n.maxDate),s!==void 0&&r.changeFocus(s).render()}function V$e(t,e){const{config:i,picker:r,editMode:n}=t,a=r.active,{key:s,altKey:o,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(s==="Tab"){Qhe(t);return}if(s==="Enter"){if(!a)t.update();else if(n)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=r.currentView;m.isMinView?t.setDate(r.viewDate):(r.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:s,ctrlOrMetaKey:c,altKey:o,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:n?h==="exitEditMode"&&(m=h):a?h==="hide"?m=h:h==="prevButton"?m=[n_,[t,-1]]:h==="nextButton"?m=[n_,[t,1]]:h==="viewSwitch"?m=[Zhe,[t]]:i.clearButton&&h==="clearButton"?m=[Xhe,[t]]:i.todayButton&&h==="todayButton"&&(m=[Jhe,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!a||n)return;const f=(m,g)=>{l||c||o?t.enterEditMode():($$e(t,m,g),e.preventDefault())};s==="ArrowLeft"?f(-1,!1):s==="ArrowRight"?f(1,!1):s==="ArrowUp"?f(-1,!0):s==="ArrowDown"?f(1,!0):(s==="Backspace"||s==="Delete"||s&&s.length===1&&!c)&&t.enterEditMode()}function j$e(t){t.config.showOnFocus&&!t._showing&&t.show()}function G$e(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=jx(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function H$e(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function z$e(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function q$e(t,e){const{element:i,picker:r}=t;if(!r.active&&!jx(i))return;const n=r.element;Yhe(e,a=>a===i||a===n)||Qhe(t)}function ife(t,e){return t.map(i=>RR(i,e.format,e.locale)).join(e.dateDelimiter)}function rfe(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=t,{pickLevel:s,maxNumberOfDates:o}=r;let l=e.reduce((c,u)=>{let d=vI(u,r.format,r.locale);return d===void 0||(d=Bv(d,s,a),a4(d,r.minDate,r.maxDate)&&!c.includes(d)&&!r.checkDisabled(d,s)&&(s>0||!r.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return r.multidate&&!i&&(l=l.reduce((c,u)=>(n.includes(u)||c.push(u),c),n.filter(c=>!l.includes(c)))),o&&l.length>o?l.slice(o*-1):l}function a_(t,e=3,i=!0,r=void 0){const{config:n,picker:a,inputField:s}=t;if(e&2){const o=a.active?n.pickLevel:n.startView;a.update(r).changeView(o).render(i)}e&1&&s&&(s.value=ife(t.dates,n))}function nZ(t,e,i){const r=t.config;let{clear:n,render:a,autohide:s,revert:o,forceRefresh:l,viewDate:c}=i;a===void 0&&(a=!0),a?s===void 0&&(s=r.autohide):s=l=!1,c=vI(c,r.format,r.locale);const u=rfe(t,e,n);!u&&!o||(u&&u.toString()!==t.dates.toString()?(t.dates=u,a_(t,a?3:1,!0,c),MS(t,"changeDate")):a_(t,l?3:1,!0,c),s&&t.hide())}function aZ(t,e){return e?i=>RR(i,e,t.config.locale):i=>new Date(i)}class nfe{constructor(e,i={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const n=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:hw(),maxDate:void 0,minDate:void 0},eB(o4,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(n.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):n.container=e,r){const u=r.inputs.indexOf(a),d=r.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=r,this.rangeSideIndex=u}this._options=i,Object.assign(n,eB(i,this)),n.shortcutKeys=P$e(i.shortcutKeys||{});const s=GK(e.value||e.dataset.date,n.dateDelimiter);delete e.dataset.date;const o=rfe(this,s);o&&o.length>0&&(this.dates=o),a&&(a.value=ife(this.dates,n));const l=this.picker=new B$e(this),c=[e,"keydown",V$e.bind(null,this)];a?r_(this,[c,[a,"focus",j$e.bind(null,this)],[a,"mousedown",G$e.bind(null,this)],[a,"click",H$e.bind(null,this)],[a,"paste",z$e.bind(null,this)],[document,"mousedown",q$e.bind(null,this)],[window,"resize",l.place.bind(l)]]):(r_(this,[c]),this.show())}static formatDate(e,i,r){return RR(e,i,r&&uE[r]||uE.en)}static parseDate(e,i,r){return vI(e,i,r&&uE[r]||uE.en)}static get locales(){return uE}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=eB(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),a_(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!jx(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),qhe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=aZ(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],r={},n=n4(e);n&&typeof n=="object"&&!Array.isArray(n)&&!(n instanceof Date)&&Object.assign(r,i.pop());const a=Array.isArray(i[0])?i[0]:i;nZ(this,a,r)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),r=GK(this.inputField.value,this.config.dateDelimiter);nZ(this,r,i)}getFocusedDate(e=void 0){return aZ(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:r,picker:n,active:a,rangeSideIndex:s}=this,o=r.pickLevel,l=vI(e,r.format,r.locale);l!==void 0&&(n.changeFocus(Bv(l,o,s)),a&&i&&n.changeView(o),n.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let r;e==="picker"?r=2:e==="input"?r=1:r=3,a_(this,r,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function sZ(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function W$e(t,e,i,r){r_(t,[[i,"changeDate",e]]),new nfe(i,r,t)}function dE(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const r=t.datepickers,[n,a]=r,s={render:!1},o=t.inputs.indexOf(i),l=o===0?1:0,c=r[o].dates[0],u=r[l].dates[0];c!==void 0&&u!==void 0?o===0&&c>u?(n.setDate(u,s),a.setDate(c,s)):o===1&&c<u&&(n.setDate(c,s),a.setDate(u,s)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(s.clear=!0,r[l].setDate(r[o].dates,s)),r.forEach(d=>{d.picker.update().render()}),delete t._updating}class Y$e{constructor(e,i={}){let r=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(r.length<2)return;e.rangepicker=this,this.element=e,this.inputs=r=r.slice(0,2),Object.freeze(r),this.allowOneSidedRange=!!i.allowOneSidedRange;const n=dE.bind(null,this),a=sZ(i),s=this.datepickers=[];r.forEach(o=>{W$e(this,n,o,a)}),Object.freeze(s),Object.defineProperty(this,"dates",{get(){return s.map(o=>o.dates[0])}}),s[0].dates.length>0?dE(this,{target:r[0]}):s[1].dates.length>0&&dE(this,{target:r[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=sZ(e);this.datepickers.forEach(r=>{r.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),qhe(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?r=>RR(r,e,this.datepickers[0].config.locale):r=>new Date(r);return this.dates.map(r=>r===void 0?r:i(r))}setDates(e,i){const{datepickers:[r,n],inputs:[a,s],dates:[o,l]}=this;this._updating=!0,r.setDate(e),n.setDate(i),delete this._updating,n.dates[0]!==l?dE(this,{target:s}):r.dates[0]!==o&&dE(this,{target:a})}}var Qm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rB={exports:{}},oZ;function K$e(){return oZ||(oZ=1,(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected||p===9&&u.selected&&u.tabSelect?(d.preventDefault(),u.select(void 0,void 0,d)):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];n.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||c.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var n=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function s(l,c){return n.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(rB)),rB.exports}var Z$e=K$e();const X$e=MR(Z$e);function J$e({list:t,element:e,callback:i,currentValue:r,withCatchTab:n,onChange:a}){const s=new X$e(e,{list:t});e.parentElement&&(e.parentElement.style.width="100%");let o=!1;const l=c=>{o=!0,Pt(i)&&i(c.text.value),e.value=c.text.label,s.suggestions=[]};if(n){const c=u=>u.key==="Tab"&&u.preventDefault();e.addEventListener("keydown",c,!1),e.addEventListener("keyup",c,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",c=>l(c),!1),e.addEventListener("keyup",function(c){(c.key==="Enter"||c.key==="Tab")&&!o&&s.suggestions?.length&&(s.next(),s.select(0)),o=!1}),r){const c=t.find(u=>u.value===r)?.label;c&&(e.value=c)}return{typeAhead:s}}function afe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}function c4(t,e){for(const i of e.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||e.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,t.appendChild(r)}}function CN(t){const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style.cssText=`width: ${t.width}`:e.style.cssText="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style.cssText=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=Vt),t.controlId&&(a.id=t.controlId),t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,a.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const o of t.options??[]){const l=document.createElement("label");l.className="radio";const c=document.createElement("input");o.field&&n.push({input:c,field:o.field}),o.id&&(c.id=o.id),c.name=t.id,c.type="radio",c.value=o.text,o.checked&&(c.checked=!0),l.appendChild(c),s.appendChild(l);const u=document.createElement("span");u.style.marginLeft=".25em",u.style.marginRight="1em",u.innerHTML=o.text,s.appendChild(u)}a.appendChild(s),i=s}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style.cssText="width: 100%",t.zIndex&&(s.style.zIndex=t.zIndex);const o=document.createElement("select");if(t.dataPlaceholder&&o.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&o.setAttribute("data-type",t.dataType),t.multiple&&o.setAttribute("multiple","true"),t.disabled&&(o.disabled=!0),t.id&&(s.id=t.id),o.style.cssText="width: 100%",c4(o,t),s.appendChild(o),a.appendChild(s),t.help){const l=document.createElement("p");l.className="help font-medium is-info",l.innerHTML=t.help?.text,l.style.display=t.help?.visible?"":Vt,a.appendChild(l)}i=o,Pt(t.onChange)&&o.addEventListener("change",l=>t.onChange(l,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow nowrap",s.style.display="inline-block";const o=document.createElement("input");Pt(t.onChange)&&o.addEventListener("change",u=>t.onChange(u,t)),i=o;const l=t.intent??"is-success";o.className=`is-checkradio ${l}`,o.type="checkbox",o.id=t.id,t.checked&&(o.checked=!0),s.appendChild(o);const c=document.createElement("label");c.setAttribute("for",t.id),t.color&&(c.style.color=t.color),c.innerHTML=t.label,s.appendChild(c),a.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"off"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled","true"),t.id&&s.setAttribute("id",t.id),a.appendChild(s),t.iconLeft){a.classList.add("has-icons-left");const l=document.createElement("span");l.className="icon is-small is-left font-medium";const c=document.createElement("i");c.className=t.iconLeft,l.appendChild(c),a.appendChild(l)}if(t.type==="password"){a.classList.add("has-icons-right");const l=document.createElement("span");l.className="icon is-small is-right font-medium";const c=document.createElement("i");c.className=t.iconRight,l.appendChild(c),a.appendChild(l)}i=s;const o=document.createElement("p");if(o.className="help font-medium",a.appendChild(o),t.validator&&s.addEventListener("input",l=>afe(t,l,s,o,t.validator)),t.date){const l=t.maxNumberOfDates||1,c=!t.maxNumberOfDates||l===1;r=new nfe(s,{maxDate:t.maxDate,minDate:t.minDate,format:"yyyy-mm-dd",maxNumberOfDates:l,autohide:c})}else t.typeAhead&&J$e({...t.typeAhead,element:s});Pt(t.onKeyDown)&&s.addEventListener("keydown",l=>t.onKeyDown(l,t)),Pt(t.onChange)&&s.addEventListener("change",l=>t.onChange(l,t)),Pt(t.onInput)&&s.addEventListener("input",l=>t.onInput(l,t)),Pt(t.onKeyUp)&&s.addEventListener("keyup",l=>t.onKeyUp(l,t)),t.value!==void 0&&(s.value=t.value),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=Vt),{field:e,inputElement:i,datepicker:r,subFields:n}}function pn(t,e,i){const r=document.createElement("div");r.style.cssText="display: flex; width: 100%;",r.classList.add("flexcol");const n={},a={};let s;for(const o of e){if((o.text||o.html)&&!o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style.cssText=o.style||o.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(o.id&&(u.id=o.id),u.className="content",u.innerHTML=o.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:h}=CN(o.fieldPair);h&&(n[`${o.field}.date`]=h),p&&(n[o.fieldPair.field]=p,o.fieldPair.focus&&(s=p)),a[o.fieldPair.field]=d,l.appendChild(d),r.appendChild(l)}else r.appendChild(c);continue}if(o.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),r.appendChild(l);continue}if(o.spacer){const l=document.createElement("div"),c=typeof o.spacer=="number"&&`${o.spacer}em`||typeof o.spacer=="string"&&o.spacer||"1em";l.style.marginBlockEnd=c,r.appendChild(l);continue}if(!(!o.label&&!o.field||o.hide)&&o.field){const l=o.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d,subFields:p}=CN(o);if(p&&p.forEach(h=>n[h.field]=h.input),d&&(n[`${o.field}.date`]=d),o.focus&&(s=u),n[o.field]=u,a[o.field]=c,l){l.appendChild(c);const{field:h,inputElement:f,datepicker:m}=CN(o.fieldPair);m&&(n[`${o.field}.date`]=m),f&&(n[o.fieldPair.field]=f,o.fieldPair.focus&&(s=f)),a[o.fieldPair.field]=h,l.appendChild(h),r.appendChild(l)}else r.appendChild(c)}}if(s&&setTimeout(()=>s.focus(),200),t.appendChild(r),i?.length)for(const o of i){if(o.dateRange&&Array.isArray(o.fields)){const[l,c]=o.fields;if(n[l]&&n[c]){const u=new Y$e(n[l],{inputs:[n[l],n[c]],minDate:o.minDate,maxDate:o.maxDate,format:"yyyy-mm-dd",autohide:!0});n[`${l}.date`]=u}}o.control&&(Pt(o.onChange)&&n[o.control].addEventListener("change",l=>o.onChange({e:l,inputs:n,fields:a})),Pt(o.onInput)&&n[o.control]&&n[o.control].addEventListener("input",l=>o.onInput({e:l,inputs:n,fields:a})),Pt(o.onFocusOut)&&n[o.control]&&n[o.control].addEventListener("focusout",l=>o.onFocusOut({e:l,inputs:n,fields:a})))}return n}var lZ,Kn="colors",Ec="sizes",pi="space",Q$e={gap:pi,gridGap:pi,columnGap:pi,gridColumnGap:pi,rowGap:pi,gridRowGap:pi,inset:pi,insetBlock:pi,insetBlockEnd:pi,insetBlockStart:pi,insetInline:pi,insetInlineEnd:pi,insetInlineStart:pi,margin:pi,marginTop:pi,marginRight:pi,marginBottom:pi,marginLeft:pi,marginBlock:pi,marginBlockEnd:pi,marginBlockStart:pi,marginInline:pi,marginInlineEnd:pi,marginInlineStart:pi,padding:pi,paddingTop:pi,paddingRight:pi,paddingBottom:pi,paddingLeft:pi,paddingBlock:pi,paddingBlockEnd:pi,paddingBlockStart:pi,paddingInline:pi,paddingInlineEnd:pi,paddingInlineStart:pi,top:pi,right:pi,bottom:pi,left:pi,scrollMargin:pi,scrollMarginTop:pi,scrollMarginRight:pi,scrollMarginBottom:pi,scrollMarginLeft:pi,scrollMarginX:pi,scrollMarginY:pi,scrollMarginBlock:pi,scrollMarginBlockEnd:pi,scrollMarginBlockStart:pi,scrollMarginInline:pi,scrollMarginInlineEnd:pi,scrollMarginInlineStart:pi,scrollPadding:pi,scrollPaddingTop:pi,scrollPaddingRight:pi,scrollPaddingBottom:pi,scrollPaddingLeft:pi,scrollPaddingX:pi,scrollPaddingY:pi,scrollPaddingBlock:pi,scrollPaddingBlockEnd:pi,scrollPaddingBlockStart:pi,scrollPaddingInline:pi,scrollPaddingInlineEnd:pi,scrollPaddingInlineStart:pi,fontSize:"fontSizes",background:Kn,backgroundColor:Kn,backgroundImage:Kn,borderImage:Kn,border:Kn,borderBlock:Kn,borderBlockEnd:Kn,borderBlockStart:Kn,borderBottom:Kn,borderBottomColor:Kn,borderColor:Kn,borderInline:Kn,borderInlineEnd:Kn,borderInlineStart:Kn,borderLeft:Kn,borderLeftColor:Kn,borderRight:Kn,borderRightColor:Kn,borderTop:Kn,borderTopColor:Kn,caretColor:Kn,color:Kn,columnRuleColor:Kn,fill:Kn,outline:Kn,outlineColor:Kn,stroke:Kn,textDecorationColor:Kn,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Ec,minBlockSize:Ec,maxBlockSize:Ec,inlineSize:Ec,minInlineSize:Ec,maxInlineSize:Ec,width:Ec,minWidth:Ec,maxWidth:Ec,height:Ec,minHeight:Ec,maxHeight:Ec,flexBasis:Ec,gridTemplateColumns:Ec,gridTemplateRows:Ec,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},eVe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,NR=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,eVe))(e);return n in t?t[n]:t[n]=i(e,...r)}},RN=Symbol.for("sxs.internal"),u4=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),cZ=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:tVe}=Object.prototype,HV=t=>t.includes("-")?t:t.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),iVe=/\s+(?![^()]*\))/,hS=t=>e=>t(...typeof e=="string"?String(e).split(iVe):[e]),uZ={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:hS(((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t}))),marginInline:hS(((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t}))),maxSize:hS(((t,e)=>({maxBlockSize:t,maxInlineSize:e||t}))),minSize:hS(((t,e)=>({minBlockSize:t,minInlineSize:e||t}))),paddingBlock:hS(((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t}))),paddingInline:hS(((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t})))},nB=/([\d.]+)([^]*)/,rVe=(t,e)=>t.length?t.reduce(((i,r)=>(i.push(...e.map((n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n))),i)),[]):e,nVe=(t,e)=>t in aVe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${HV(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${HV(t)}:${r}fit-content`)+a)):String(e),aVe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},vg=t=>t?t+"-":"",sfe=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((r,n,a,s,o)=>s=="$"==!!a?r:(n||s=="--"?"calc(":"")+"var(--"+(s==="$"?vg(e)+(o.includes("$")?"":vg(i))+o.replace(/\$/g,"-"):o)+")"+(n||s=="--"?"*"+(n||"")+(a||"1")+")":""))),sVe=/\s*,\s*(?![^()]*\))/,oVe=Object.prototype.toString,qS=(t,e,i,r,n)=>{let a,s,o;const l=(c,u,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,(T=>T[1].toUpperCase())),w=typeof h=="object"&&h&&h.toString===oVe&&(!r.utils[I]||!u.length);if(I in r.utils&&!w){const T=r.utils[I];if(T!==s){s=T,f(T(h)),s=null;continue}}else if(I in uZ){const T=uZ[I];if(T!==o){o=T,f(T(h)),o=null;continue}}if(y&&(g=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((T,S,D,C,E,P)=>{const R=nB.test(S),M=.0625*(R?-1:1),[A,N]=R?[C,S]:[S,C];return"("+(D[0]==="="?"":D[0]===">"===R?"max-":"min-")+A+":"+(D[0]!=="="&&D.length===1?N.replace(nB,((k,x,O)=>Number(x)+M*(D===">"?1:-1)+O)):N)+(E?") and ("+(E[0]===">"?"min-":"max-")+A+":"+(E.length===1?P.replace(nB,((k,x,O)=>Number(x)+M*(E===">"?-1:1)+O)):P):"")+")"}))),w){const T=y?d.concat(p):[...d],S=y?[...u]:rVe(u,p.split(sVe));a!==void 0&&n(dZ(...a)),a=void 0,l(h,S,T)}else a===void 0&&(a=[[],u,d]),p=y||p.charCodeAt(0)!==36?p:`--${vg(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=w?h:typeof h=="number"?h&&I in lVe?String(h)+"px":String(h):sfe(nVe(I,h??""),r.prefix,r.themeMap[I]),a[0].push(`${y?`${p} `:`${HV(p)}:`}${h}`)}}var g,v};f(c),a!==void 0&&n(dZ(...a)),a=void 0};l(t,e,i)},dZ=(t,e,i)=>`${i.map((r=>`${r}{`)).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,lVe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},pZ=t=>String.fromCharCode(t+(t>25?39:97)),Gb=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=pZ(i%52)+r;return pZ(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),PE=["themed","global","styled","onevar","resonevar","allvar","inline"],cVe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},uVe=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,((a,s)=>{const{cssText:o}=a;let l="";if(o.startsWith("--sxs"))return"";if(n[s-1]&&(l=n[s-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${o}`;return a.cssRules.length?`${l}${o}`:""}return o})).join("")},r=()=>{if(e){const{rules:o,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in o)delete o[c]}const n=Object(t).styleSheets||[];for(const o of n)if(cVe(o)){for(let l=0,c=o.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=PE[h[0]];f&&(e||(e={sheet:o,reset:r,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const o=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,o(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,(u=>u.cssText)).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:o("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:s}=e;for(let o=PE.length-1;o>=0;--o){const l=PE[o];if(!s[l]){const c=PE[o+1],u=s[c]?s[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${o}}`,u),s[l]={group:a.cssRules[u+1],index:u,cache:new Set([o])}}dVe(s[l])}};return r(),e},dVe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},pE=Symbol(),pVe=NR(),hVe=(t,e)=>pVe(t,(()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[RN]){r.type==null&&(r.type=n[RN].type);for(const a of n[RN].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(fVe(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),mVe(t,r,e)})),fVe=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${vg(n.prefix)}c-${Gb(r)}`,s=[],o=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,tVe.call(u,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&c.push(p);const g=h[f],v=[m,g,!cZ(g)];s.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!cZ(h)];o.push(m)}return[a,r,s,o,l,c]},mVe=(t,e,i)=>{const[r,n,a,s]=gVe(e.composers),o=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[pE].length;h++){const[f,m]=p[pE][h];d.rules[f].apply(m)}return p[pE]=[],null}return p[pE]=[],p.rules={},PE.forEach((h=>p.rules[h]={apply:f=>p[pE].push([h,f])})),p})(i):null,l=(o||i).rules,c=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||vVe;const{css:p,...h}=d,f={};for(const v in a)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":a[v],...y}:(y=String(y),f[v]=y!=="undefined"||s.has(v)?y:a[v])}else f[v]=a[v];const m=new Set([...n]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),qS(y,[`.${v}`],[],t,(S=>{l.styled.apply(S)})));const w=hZ(b,f,t.media),T=hZ(I,f,t.media,!0);for(const S of w)if(S!==void 0)for(const[D,C,E]of S){const P=`${v}-${Gb(C)}-${D}`;m.add(P);const R=(E?i.rules.resonevar:i.rules.onevar).cache,M=E?l.resonevar:l.onevar;R.has(P)||(R.add(P),qS(C,[`.${P}`],[],t,(A=>{M.apply(A)})))}for(const S of T)if(S!==void 0)for(const[D,C]of S){const E=`${v}-${Gb(C)}-${D}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),qS(C,[`.${E}`],[],t,(P=>{l.allvar.apply(P)})))}}if(typeof p=="object"&&p){const v=`${r}-i${Gb(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),qS(p,[`.${v}`],[],t,(y=>{l.inline.apply(y)})))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:o}};return u4(u,{className:r,selector:c,[RN]:e,toString:()=>(i.rules.styled.cache.has(r)||u(),r)})},gVe=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,s,o]of t){e===""&&(e=a),i.push(a),n.push(...o);for(const l in s){const c=s[l];(r[l]===void 0||c!=="undefined"||o.includes(c))&&(r[l]=c)}}return[e,i,r,new Set(n)]},hZ=(t,e,i,r)=>{const n=[];e:for(let[a,s,o]of t){if(o)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=m,h=!0}++m}if(f&&f.length&&(s={["@media "+f.join(", ")]:s}),!h)continue e}}}(n[c]=n[c]||[]).push([r?"cv":`${l}-${a[l]}`,s,u])}return n},vVe={},yVe=NR(),bVe=(t,e)=>yVe(t,(()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=Gb(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let s=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let o of[].concat(n["@import"]))o=o.includes('"')||o.includes("'")?o:`"${o}"`,e.sheet.insertRule(`@import ${o};`,s++);delete n["@import"]}qS(n,[],[],t,(s=>{e.rules.global.apply(s)}))}}return""};return u4(r,{toString:r})})),IVe=NR(),wVe=(t,e)=>IVe(t,(()=>i=>{const r=`${vg(t.prefix)}k-${Gb(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];qS(i,[],[],t,(o=>a.push(o)));const s=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(s)}return r};return u4(n,{get name(){return n()},toString:n})})),SVe=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+vg(this.prefix)+vg(this.scale)+this.token}toString(){return this.computedValue}},TVe=NR(),UVe=(t,e)=>TVe(t,(()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${vg(t.prefix)}t-${Gb(r)}`}`,a={},s=[];for(const l in r){a[l]={};for(const c in r[l]){const u=`--${vg(t.prefix)}${l}-${c}`,d=sfe(String(r[l][c]),t.prefix,l);a[l][c]=new SVe(c,d,l,t.prefix),s.push(`${u}:${d}`)}}const o=()=>{if(s.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${s.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return o()},selector:n,toString:o}})),DVe=NR(),ofe=t=>{let e=!1;const i=DVe(t,(r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},s=typeof r.root=="object"?r.root||null:globalThis.document||null,o=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:o,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...Q$e},utils:typeof r.utils=="object"&&r.utils||{}},c=uVe(s),u={css:hVe(l,c),globalCss:bVe(l,c),keyframes:wVe(l,c),createTheme:UVe(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:n,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(o)),u}));return e||i.reset(),i},EVe=()=>lZ||(lZ=ofe()),cr=(...t)=>EVe().css(...t);function PVe({variant:t}){return cr({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const CVe=cr({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),RVe=cr({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),MVe=cr({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function NVe({drawPosition:t,sideNumber:e}){return cr({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function AVe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return cr({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const d4=cr({fontSize:"smaller",color:"gray"});function lfe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fZ={exports:{}},mZ;function _Ve(){return mZ||(mZ=1,(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",s=0;s<arguments.length;s++){var o=arguments[s];o&&(a=n(a,r(o)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var s="";for(var o in a)e.call(a,o)&&a[o]&&(s=n(s,o));return s}function n(a,s){return s?a?a+" "+s:a+s:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(fZ)),fZ.exports}var kVe=_Ve();const $y=lfe(kVe);function OVe({individualParticipant:t,className:e}){const{city:i,state:r,countryCode:n}=t?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",s=document.createElement("div");return s.className=$y(d4(),e),s.innerHTML=a,s}const xVe=cr({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),LVe=cr({display:"block"}),FVe=cr({position:"fixed",right:0,left:0}),BVe=cr({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),$Ve=cr({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),VVe=cr({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),jVe=cr({fontWeight:"600",fontSize:"20px"}),gZ=cr({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),vZ="Nothing to see here";function md(t){return typeof t=="function"}function MN(t){return typeof t=="string"}function yZ(t){return Array.isArray(t)}function GVe(t){if(t)for(;t.firstChild;)t.firstChild.remove()}const GT=(()=>{const t=FVe(),e={},i=".5",r=[];let n;const a=[];let s=[],o;const l=m=>{{const g=s.pop();g&&g.remove()}},c=()=>{o&&(o.style.opacity="0",o.style.display="none")},u=m=>{const g=s.length;if(m&&e[g]===!1)return;const v=a.pop(),y=r.pop();md(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),c(),l()},d=()=>{o=document.createElement("div"),o.className=xVe(),o.id="cmdl-backdrop",o.onclick=()=>u(!0),document.body.appendChild(o)},p=({config:m})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,o||d(),o.style.display="",m?.backdrop!==!1&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity="1")},h=({config:m,attr:g,attrs:v,unit:y="em",value:b})=>{let I;return MN(g)?I=zV({element:m,attr:g}):yZ(v)&&(I=v.map(w=>zV({element:m,attr:w})).find(Boolean)),I!==void 0&&(b=I),Number.isNaN(b)?b:`${b}${y}`},f=({buttons:m,config:g,modalNumber:v})=>{const y=document.createElement("div");y.className=gZ(),y.style.padding=h({config:g,attrs:["footer.padding","padding"],value:i});const b={label:g?.dictionary?.close||"Close",onClick:()=>GT.close(),intent:"is-info"};for(const I of m){if(I.hide)continue;const w={...b,...I},T=document.createElement("button");w.disabled!==void 0&&(T.disabled=w.disabled),w.id&&(T.id=w.id),T.className=w?.footer?.className||"button font-medium",T.classList.add(w.intent||"is-info"),T.style="margin-right: .5em;",T.innerHTML=w.label||w.text||"",T.onclick=S=>{S.stopPropagation(),md(w.onClick)&&w.onClick({e:S,content:r[v]}),w.close!==!1&&(md(w.close)&&w.close(),GT.close())},y.appendChild(T)}return y};return{close:u,open:({title:m="",content:g,buttons:v,footer:y,config:b,onClose:I}={})=>{p({config:b}),a.push(I);const w=s.length+1;e[w]=b?.clickAway;const T=document.createElement("section"),S=`cmdl-${w}`;T.className=LVe(),T.role="dialog",T.tabIndex=-1,T.id=S;const D=document.createElement("div");D.className=BVe(),D.style.maxWidth=`${b?.maxWidth||450}px`,D.onclick=()=>u(!0);const C=document.createElement("div");C.className=$Ve(),b?.className&&C.classList.add(b.className),b?.style&&Object.assign(C.style,b.style),C.onclick=V=>V.stopPropagation();const E=document.createElement("div"),P=document.createElement("div");E.appendChild(P),C.appendChild(E);const R=({title:V,config:F})=>{E.className=V?VVe():"",E.style.padding=h({config:F,attrs:["title.padding","padding"],value:i}),P.className=V?jVe():"",P.innerHTML=V};m&&R({title:m});const M=document.createElement("div");C.appendChild(M);const A=({content:V,config:F})=>{M.style.fontSize=h({config:F,attr:"fontSize",value:"15px"}),M.style.position="relative",M.style.padding=h({config:F,attrs:["content.padding","padding"],value:i}),md(V)?r[w]=V(M):V instanceof HTMLElement?M.appendChild(V):MN(V)?M.innerHTML=V:M.innerHTML=vZ};A({content:g,config:b});let N;if(yZ(v))N=f({buttons:v,config:b,modalNumber:w}),C.appendChild(N);else if(y){const V=document.createElement("div");V.className=gZ(),V.style.padding=h({config:b,attrs:["footer.padding","padding"]}),y instanceof HTMLElement?V.appendChild(y):MN(y)?V.innerHTML=y:V.innerHTML=vZ,N=V,C.appendChild(V)}D.appendChild(C),T.appendChild(D),document.body.appendChild(T),s.push(T);const k=({content:V,config:F})=>{r[w]=void 0,GVe(M),A({content:V,config:F})},x=({buttons:V,config:F})=>{N&&N.remove(),N=f({buttons:V,config:F,modalNumber:w}),C.appendChild(N)},O=({onClose:V})=>{a.length=0,a.push(V)};return{setContent:k,setButtons:x,update:({content:V,buttons:F,title:j,config:q,onClose:W})=>{b=q||b,V&&k({content:V,config:b}),F&&x({buttons:F,config:b}),W&&O({onClose:W}),j&&R({title:j,config:b})}}}}})();function zV({element:t,attr:e}){if(!MN(e))return;const i=e.split(".");for(const r of i)if(t=t?.[r],!t)return;return t}function HVe({individualParticipant:t,attribute:e,className:i}){const r=t?.person,n=zV({element:r,attr:e});if(!n)return"";const a=document.createElement("div");return a.className=$y(d4(),i),a.innerHTML=n,a}function zVe({individualParticipant:t,className:e}){const i=t?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=$y(d4(),e),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}function qVe(t){const e=t?.composition?.configuration?.participantDetail;if(e==="TEAM")return zVe(t);if(t?.composition?.configuration?.showAddress??e==="ADDRESS")return OVe(t);if(e){const i=HVe({...t,attribute:e});if(i&&typeof i!="string")return i}return document.createElement("div")}const WVe=cr({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function YVe({className:t,composition:e,side:i}){const r=i?.seedValue==="~"?"":i?.seedValue!==void 0&&i.seedValue||i?.seedNumber;if(!r)return"";const n=e?.configuration||{},{bracketedSeeds:a}=n,s=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],o=`${s[0]}${r}${s[1]}`,l=n.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t||"",c.innerHTML=o,c}const KVe=cr({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function ZVe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){const a=e?.configuration,s=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",o=t?.rankings,l=t?.ratings,c=a?.scaleAttributes,u=c?.scaleType,d=c?.scaleName,p=c?.accessor,h=u==="RATING"?l:o,f=h?.SINGLES?.find(D=>D?.scaleName===d)?.scaleValue,m=h?.DOUBLES?.find(D=>D?.scaleName===d)?.scaleValue,g=f&&p?f[p]:f||"",v=m&&p?m[p]:m||"",y=s==="SINGLES"?g:v,b=a?.scaleAttributes?.fallback,I=!n&&(y||b&&(g||v)),w=document.createElement("span"),T=a?.scaleAttributes?.scaleColor,S=T==="green"||T==="red"?T:void 0;return I&&(w.className=$y(i,KVe(S?{color:S}:{}))),w.innerHTML=I||"",w}var XVe=Object.defineProperty,_i=(t,e)=>{for(var i in e)XVe(t,i,{get:e[i],enumerable:!0})};function Gx(){return"2.2.36"}var p4={};_i(p4,{competitionGovernor:()=>cfe,drawsGovernor:()=>nve,entriesGovernor:()=>hwe,eventGovernor:()=>Iwe,generationGovernor:()=>Lwe,matchUpFormatGovernor:()=>aP,matchUpGovernor:()=>Wwe,mocksGovernor:()=>u8,participantGovernor:()=>$Se,policyGovernor:()=>FIe,publishingGovernor:()=>cTe,queryGovernor:()=>GIe,reportGovernor:()=>yTe,scheduleGovernor:()=>bTe,scoreGovernor:()=>K6,tieFormatGovernor:()=>NTe,tournamentGovernor:()=>$Te,venueGovernor:()=>eUe});var cfe={};_i(cfe,{getLinkedTournamentIds:()=>ZR,getTournamentIds:()=>YR,linkTournaments:()=>eve,mutate:()=>ufe,query:()=>rve,unlinkTournament:()=>ive,unlinkTournaments:()=>tve});var ufe={};_i(ufe,{linkTournaments:()=>eve,unlinkTournament:()=>ive,unlinkTournaments:()=>tve});var Hb="SINGLES",wr="SINGLES",ly="DOUBLES",mr="DOUBLES",oc="TEAM",kr="TEAM",JVe={SINGLES_MATCHUP:Hb,SINGLES:wr,DOUBLES_MATCHUP:ly,DOUBLES:mr,TEAM_MATCHUP:oc,TEAM:kr},dfe={[wr]:[wr,"S"],[mr]:[mr,"D"],[kr]:[kr,"T"],S:[wr,"S"],D:[mr,"D"],T:[kr,"T"]};function ea(t,e){return(t??0)-(e??0)}function ri(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Dd(t){return isNaN(t)?!1:t&&(t&t-1)===0}function bZ(t){if(!t.length)return;let e=[...t].sort(ea),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function QVe(t){if(!Dd(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function h4(t){return isNaN(t)?0:t%2&&t+1||t}function f4(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function vn(t){return!isNaN(parseFloat(t))}function pfe(t){let e=ri(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function hD(t){if(isNaN(t))return!1;for(;!Dd(t);)t++;return t}function Rc(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function mi(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function eje(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function tje(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function hfe(t,e,i,r,n=2){let a=1-Math.random(),s=1-Math.random(),o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=hfe(t,e,i):(o=Math.pow(o,i),o*=e-t,o+=t),r&&(o=tje(o,r)),parseFloat(o.toFixed(n))}function s_(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function yi(t){return Array.isArray(t)?t?.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function ije(t){return Array.isArray(t)?t?.map(e=>e===null?void 0:e):t}function co(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function HT(t){return mi(t)?t:1/0}function Nl(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function rje(t){return ffe(Nl(t))}function ffe(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function nje(t,e,i){return i.indexOf(t)===e}function mfe(t){return t.filter(nje)}function yl(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Tu(t){let e=Math.floor(Math.random()*t.length);return t[e]}function yt(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function ap(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function En(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function IZ(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function go(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function aje(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function sje(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Ra(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function gfe(t,[e,...i]){return t.length?[t.slice(0,e),...gfe(t.slice(e),[...i,e])]:[]}function oje(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function vfe(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function yfe(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function qV(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let s=i?!!(Math.floor(a/e)%2):!1,o=a%e,l=s?e-1-o:o;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function lje(t,e=1){if(!Array.isArray(t)||!t.every(mi))return[];let i=Math.min(...t,e),r=Math.max(...t);return yt(i,r+1).filter(n=>!t.includes(n))}function gl(t){return typeof t=="function"}function Yr(t){return typeof t=="string"}function qi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function cje(t,e){if(!qi(t)||!qi(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function bfe(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(qi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var uje=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function WV(t,e){if(t===void 0)return null;if(!qi(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>WV(a))}:{[n]:e?r(t[n]):WV(t[n])}))}function YV(t){return Array.isArray(t)?t.length+t.map(YV).reduce((e,i)=>e+i,0):qi(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>YV(t[e])).reduce((e,i)=>e+i,0):0}function dje(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=YV(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}function Hx(t,e){return!Array.isArray(t)||!Yr(e)?!1:En(t,dfe[e]).length}var oe={success:!0},Ife="error",pje={SUCCESS:oe,ERROR:Ife};function wfe({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:s}=n;if(typeof a!="number"||typeof s!="number"||s>e||s<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==yi(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...oe}}var hje={};_i(hje,{addNotice:()=>Ii,callListener:()=>nj,createInstanceState:()=>Kje,cycleMutationStatus:()=>H4,deepCopyEnabled:()=>G4,deleteNotice:()=>z4,deleteNotices:()=>BR,disableNotifications:()=>_me,enableNotifications:()=>_N,getDevContext:()=>cc,getMethods:()=>xme,getNotices:()=>Lme,getProvider:()=>aj,getTopics:()=>Jc,getTournamentId:()=>bw,getTournamentRecord:()=>q4,getTournamentRecords:()=>Iw,globalLog:()=>$me,handleCaughtError:()=>sL,hasTopic:()=>nL,removeTournamentRecord:()=>Bme,setDeepCopy:()=>hC,setDevContext:()=>pC,setGlobalLog:()=>Ame,setGlobalMethods:()=>kme,setGlobalSubscriptions:()=>Xje,setMethods:()=>Ome,setStateMethods:()=>Vme,setStateProvider:()=>Yje,setSubscriptions:()=>Jje,setTournamentId:()=>fC,setTournamentRecord:()=>Fme,setTournamentRecords:()=>aL,timeKeeper:()=>Zje});var KV={message:"Chronological error; time violation.",code:"ANACHRONISM"},uC={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Sfe={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},ZV={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},hn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},et={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},AR={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},zT={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},zb={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},At={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Tfe={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},lc={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Vy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},m4={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},g4={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},qT={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Ufe={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Dfe={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},fje={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},v4={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},_R={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},zx={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},mje={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},fD={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},mD={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},y4={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},qx={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Efe={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},kR={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Nd={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Pfe={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Cfe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Rfe={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Mfe={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Nfe={message:"Invalid action",code:"ERR_INVALID_ACTION"},XV={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Afe={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},_fe={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},kfe={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},b4={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Ofe={message:"Existing round",code:"ERR_EXISTING_ROUND"},gje={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},gc={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},en={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},I4={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},jy={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},w4={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},xfe={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},xh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Lr={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Vc={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Lfe={message:"Event exists",code:"ERR_EXISTING_EVENT"},Ffe={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Bfe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},S4={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},$fe={message:"Missing stage",code:"ERR_MISSING_STAGE"},Gy={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Vfe={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},jfe={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Gfe={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},JV={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},OR={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},NN={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},vje={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},gD={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},fh={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},T4={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},U4={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Hfe={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},vD={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},eo={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},fw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ls={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},wm={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ko={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},al={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},D4={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Wx={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},yje={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},zfe={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},E4={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},qfe={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},P4={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},bje={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},xR={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Ije={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},C4={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},wje={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},Yx={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Sje={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Tje={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},mw={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Yt={message:"Missing value",code:"ERR_MISSING_VALUE"},Wfe={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Yfe={message:"Missing date",code:"ERR_MISSING_DATE"},Kfe={message:"No valid dates",code:"ERR_NO_VALID_DATES"},o_={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},AN={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Zfe={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ba={message:"Invalid Date",code:"ERR_INVALID_DATE"},yu={message:"Invalid time",code:"ERR_INVALID_TIME"},Xfe={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},QV={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Jfe={message:"Invalid score",code:"ERR_INVALID_SCORE"},Kx={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Uje={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},R4={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Qfe={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Zx={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},ej={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},Xx={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},gw={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ed={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},wl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},eme={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Pd={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},tme={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},vw={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},LR={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},oa={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},ime={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},_n={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},rme={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Dje={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},nme={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},zg={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},ame={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},sme={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},ome={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},yD={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Jx={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},M4={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},tj={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},lme={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Eje={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Pje={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},cme={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},ume={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},ij={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},N4={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},A4={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},dme={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},_4={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},WT={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},pme={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},bD={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},hme={message:"Court exists",code:"ERR_EXISTING_COURT"},fme={message:"Venue exists",code:"ERR_EXISTING_VENUE"},yw={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},qg={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},mme={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},k4={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},gme={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},vme={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Cje={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},O4={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},yme={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},x4={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},L4={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Qx={message:"Missing context",code:"ERR_MISSING_CONTEXT"},bme={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},yI={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Ime={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},ID={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},wme={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},eL={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Sme={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Tme={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Sm={message:"Invalid object",code:"ERR_INVALID_OBJECT"},JE={message:"Invalid gender",code:"ERR_INVALID_GENDER"},dC={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Se={message:"Invalid values",code:"ERR_INVALID_VALUES"},Ume={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},F4={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Dme={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},tL={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},B4={message:"Value unchanged",code:"ABORT_UNCHANGED"},za={message:"Not found",code:"ERR_NOT_FOUND"},iL={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Eme={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},$4={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Pme={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Cme={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},rj={message:"Existing stage",code:"ERR_EXISTING_STAGE"},V4={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},rL={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Rme={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},FR={message:"Scores present",code:"ERR_SCORES_PRESENT"},Rje={ANACHRONISM:KV,CANNOT_CHANGE_WINNING_SIDE:Xx,CANNOT_MODIFY_TIEFORMAT:R4,CANNOT_MODIFY_PARTICIPANT_TYPE:Qfe,CANNOT_REMOVE_MAIN_STRUCTURE:Sfe,CANNOT_REMOVE_PARTICIPANTS:Zx,CATEGORY_MISMATCH:ej,COURT_EXISTS:hme,COURT_NOT_FOUND:bD,DRAW_DEFINITION_NOT_FOUND:lc,DRAW_ID_EXISTS:Pfe,DRAW_POSITION_ACTIVE:zx,DRAW_POSITION_ASSIGNED:qT,DRAW_POSITION_NOT_CLEARED:Dfe,DRAW_POSITION_NOT_FOUND:fje,DRAW_SIZE_MISMATCH:Efe,DUPLICATE_ENTRY:uC,DUPLICATE_VALUE:Ume,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:ume,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:cme,EVENT_EXISTS:Lfe,EVENT_NOT_FOUND:Vc,EXISTING_DRAW_DEFINITIONS:Tfe,EXISTING_END_TIME:k4,EXISTING_FLIGHT:Eme,EXISTING_MATCHUP_ID:Cme,EXISTING_OUTCOME:Pme,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:yD,EXISTING_PARTICIPANT:Jx,EXISTING_POLICY_TYPE:P4,EXISTING_PROFILE:$4,EXISTING_ROUND:Ofe,EXISTING_STAGE:rj,EXISTING_STRUCTURE:V4,INCOMPATIBLE_MATCHUP_STATUS:NN,INCOMPLETE_SOURCE_STRUCTURE:m4,INSUFFICIENT_DRAW_POSITIONS:A4,INVALID_ACTION:Nfe,INVALID_ASSIGNMENT:XV,INVALID_BOOKINGS:o_,INVALID_CATEGORY:dC,INVALID_COLLECTION_DEFINITION:Tme,INVALID_CONFIGURATION:Sme,INVALID_DATE_AVAILABILITY:AN,INVALID_DATE:Ba,INVALID_DRAW_DEFINITION:zb,INVALID_DRAW_POSITION_FOR_SEEDING:g4,INVALID_DRAW_POSITION:fD,INVALID_DRAW_SIZE:qx,INVALID_END_TIME:mme,INVALID_ENTRIES:Bfe,INVALID_EVENT_TYPE:xh,INVALID_GAME_SCORES:QV,INVALID_GENDER:JE,INVALID_MATCHUP_FORMAT:T4,INVALID_MATCHUP_STATUS:gD,INVALID_MATCHUP_STATUS_BYE:Gfe,INVALID_MATCHUP:al,INVALID_OBJECT:Sm,INVALID_PARTICIPANT_ID:Ed,INVALID_PARTICIPANT_IDS:wl,INVALID_PARTICIPANT_ROLE:eme,INVALID_PARTICIPANT_SEEDING:Cfe,INVALID_PARTICIPANT_TYPE:Pd,INVALID_PARTICIPANT:gw,INVALID_POLICY_DEFINITION:qfe,INVALID_RECORDS:ZV,INVALID_SCALE_ITEM:yI,INVALID_SEED_NUMBER:_fe,INVALID_SEED_POSITION:kfe,INVALID_SET_NUMBER:wje,INVALID_SIDE_NUMBER:C4,INVALID_SCORE:Jfe,INVALID_STAGE:Gy,INVALID_START_TIME:vme,INVALID_STRUCTURE:Vy,INVALID_STOP_TIME:gme,INVALID_TIE_FORMAT:fh,INVALID_TIME:yu,INVALID_TIME_ITEM:O4,INVALID_TOURNAMENT_DATES:Xfe,INVALID_TOURNAMENT_RECORD:AR,INVALID_VALUES:Se,INVALID_WINNING_SIDE:Kx,MATCHUP_NOT_FOUND:Ls,METHOD_NOT_FOUND:rL,MISSING_ASSIGNMENTS:S4,MISSING_ASYNC_STATE_PROVIDER:yme,MISSING_AVOIDANCE_POLICY:zfe,MISSING_BIRTH_DATE:Wfe,MISSING_COLLECTION_DEFINITION:Hfe,MISSING_COURT_ID:mw,MISSING_COURTS_INFO:pme,MISSING_DATE_AVAILABILITY:Zfe,MISSING_DATE:Yfe,MISSING_DRAW_DEFINITION:At,MISSING_DRAW_ID:Nd,MISSING_DRAW_POSITION:mD,MISSING_DRAW_POSITIONS:_R,MISSING_DRAW_SIZE:kR,MISSING_ENTRIES:Ffe,MISSING_EVENT:Lr,MISSING_QUALIFIED_PARTICIPANTS:ime,MISSING_MATCHUP_FORMAT:U4,MISSING_MATCHUP_ID:eo,MISSING_MATCHUP_IDS:fw,MISSING_MATCHUP:ko,MISSING_MATCHUPS:wm,MISSING_PARTICIPANT_COUNT:ame,MISSING_PARTICIPANT_ID:oa,MISSING_PARTICIPANT_IDS:zg,MISSING_PARTICIPANT_ROLE:tme,MISSING_PARTICIPANT:vw,MISSING_PARTICIPANTS:LR,MISSING_PENALTY_ID:_4,MISSING_PENALTY_TYPE:dme,MISSING_PERSON_DETAILS:ome,MISSING_POLICY_ATTRIBUTES:E4,MISSING_POLICY_DEFINITION:Wx,MISSING_POLICY_TYPE:D4,MISSING_POSITION_ASSIGNMENTS:jfe,MISSING_ROUND_NUMBER:gje,MISSING_SCHEDULE:bme,MISSING_SCORING_POLICY:Ije,MISSING_SEED_ASSIGNMENTS:Afe,MISSING_SEEDCOUNT_THRESHOLDS:Mfe,MISSING_SEEDING_POLICY:yje,MISSING_SET_NUMBER:Sje,MISSING_SET_OBJECT:Yx,MISSING_SIDE_NUMBER:Tje,MISSING_STAGE:$fe,MISSING_STRUCTURE_ID:gc,MISSING_STRUCTURE:jy,MISSING_MAIN_STRUCTURE:w4,MISSING_STRUCTURES:I4,MISSING_TARGET_LINK:b4,MISSING_TIE_FORMAT:vD,MISSING_TIME_ITEM:x4,MISSING_TIME_ITEMS:L4,MISSING_TOURNAMENT_ID:zT,MISSING_TOURNAMENT_RECORD:et,MISSING_TOURNAMENT_RECORDS:hn,MISSING_VALUE:Yt,MISSING_VENUE_ID:qg,MODIFICATIONS_FAILED:Ime,NO_CANDIDATES:eL,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:N4,NO_MODIFICATIONS_APPLIED:ID,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:ij,NO_PARTICIPANT_REMOVED:nme,NO_VALID_ACTIONS:Dme,NO_VALID_ATTRIBUTES:tL,NO_VALID_DATES:Kfe,NOT_FOUND:za,NOT_IMPLEMENTED:iL,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:M4,PARTICIPANT_ID_EXISTS:rme,PARTICIPANT_NOT_CHECKED_IN:sme,PARTICIPANT_NOT_FOUND:_n,PARTICIPANT_PAIR_EXISTS:Dje,PENALTY_NOT_FOUND:WT,POLICY_NOT_ATTACHED:bje,POLICY_NOT_FOUND:xR,SCHEDULE_NOT_CLEARED:Ufe,SCHEDULED_MATCHUPS:Rme,SCORES_PRESENT:FR,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Rfe,STAGE_SEQUENCE_LIMIT:Vfe,STRUCTURE_NOT_FOUND:en,TEAM_NOT_FOUND:F4,UNABLE_TO_ASSIGN_COURT:wme,UNLINKED_STRUCTURES:xfe,UNRECOGNIZED_DRAW_TYPE:v4,UNRECOGNIZED_MATCHUP_FORMAT:OR,UNRECOGNIZED_MATCHUP_STATUS:JV,VALUE_UNCHANGED:B4,VENUE_EXISTS:fme},Jr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Mme={addNotice:Vje,callListener:qje,cycleMutationStatus:$je,deleteNotice:Hje,deleteNotices:Gje,disableNotifications:Mje,enableNotifications:Nje,getMethods:j4,getNotices:jje,getTopics:zje,getTournamentId:Nme,getTournamentRecord:Aje,getTournamentRecords:_je,removeTournamentRecord:Lje,setMethods:Bje,setSubscriptions:Fje,setTournamentId:Oje,setTournamentRecord:kje,setTournamentRecords:xje,handleCaughtError:Wje};function Mje(){Jr.disableNotifications=!0}function Nje(){Jr.disableNotifications=!1}function Nme(){return Jr.tournamentId}function Aje(t){return Jr.tournamentRecords[t]}function _je(){return Jr.tournamentRecords}function kje(t){let e=t?.tournamentId;return e?(Jr.tournamentRecords[e]=t,{success:!0}):{error:AR}}function Oje(t){return t?Jr.tournamentRecords[t]?(Jr.tournamentId=t,{success:!0}):{error:et}:(Jr.tournamentId=void 0,{success:!0})}function xje(t){Jr.tournamentRecords=t;let e=Object.keys(t);e.length===1?Jr.tournamentId=e[0]:e.length||(Jr.tournamentId=void 0)}function Lje(t){if(typeof t!="string")return{error:Se};if(!Jr.tournamentRecords[t])return{error:za};delete Jr.tournamentRecords[t];let e=Object.keys(Jr.tournamentRecords);return e.length===1?Jr.tournamentId=e[0]:e.length||(Jr.tournamentId=void 0),{success:!0}}function Fje(t){return typeof t.subscriptions!="object"?{error:Se}:(Object.keys(t.subscriptions).forEach(e=>{typeof t.subscriptions[e]=="function"?Jr.subscriptions[e]=t.subscriptions[e]:delete Jr.subscriptions[e]}),{...oe})}function Bje(t){return typeof t!="object"?{error:Se}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Jr.methods[e]=t[e])}),{...oe})}function $je(){let t=Jr.modified;return Jr.modified=!1,t}function Vje({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Jr.disableNotifications||(Jr.modified=!0),!(Jr.disableNotifications||!Jr.subscriptions[t]&&!r)))return i&&(Jr.notices=Jr.notices.filter(n=>!(n.topic===t&&n.key===i))),Jr.notices.push({topic:t,payload:e,key:i}),{...oe}}function j4(){return Jr.methods??{}}function jje({topic:t}){return Jr.notices.filter(e=>e.topic===t).map(e=>e.payload)}function Gje(){Jr.notices=[]}function Hje({topic:t,key:e}){Jr.notices=Jr.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function zje(){return{topics:Object.keys(Jr.subscriptions)}}function qje({topic:t,notices:e},i){let r=Jr.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i?.[t];n&&typeof n=="function"&&n(e)}function Wje({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:Nme(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}var Er={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},qa=Mme,wZ=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function Yje(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(En(Object.keys(t),wZ).length!==wZ.length)throw new Error("Global state provider is missing required methods");return qa=t,{success:!0}}function Kje(){if(qa.createInstanceState){try{qa.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:yme}}function cc(t){return!t||typeof t!="object"?Er.devContext??!1:typeof Er.devContext!="object"?!1:Object.keys(t).every(e=>Er.devContext?.[e]===t[e])&&Er.devContext}function Zje(t="reset",e="default"){let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Er.timers).filter(r=>r!=="default"||Er.timers[r].startTime).map(r=>{let n=Er.timers[r],a=n.state==="stopped"?0:(i-(n?.startTime??0))/1e3,s=n.elapsedTime+a;return{state:Er.timers[r].state,elapsedTime:s.toFixed(2),timer:r}});{let r=Er.timers[e].state==="stopped"?0:(i-(Er.timers[e]?.startTime??0))/1e3,n=Er.timers[e].elapsedTime+r;return{state:Er.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}}if(!Er.timers[e]||t==="reset"){if(e==="allTimers")return Er.timers={default:{elapsedTime:0}},!0;Er.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Er.timers[e].elapsedTime||(Er.timers[e].elapsedTime=0),t==="stop"&&Er.timers[e].state!=="stopped"&&(Er.timers[e].state="stopped")&&(Er.timers[e].elapsedTime+=(i-(Er.timers[e]?.startTime??0))/1e3),t==="start"&&(Er.timers[e].startTime=i)&&(Er.timers[e].state="active"),Er.timers[e]}function Ame(t){gl(t)?Er.globalLog=t:delete Er.globalLog}function pC(t){Er.devContext=t}function _me(){qa.disableNotifications()}function _N(){qa.enableNotifications()}function hC(t,e){typeof t=="boolean"&&(Er.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Er.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Er.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Er.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Er.deepCopyAttributes.threshold=e.threshold))}function G4(){return{enabled:Er.deepCopy,...Er.deepCopyAttributes}}function Xje(t){return t?.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Er.globalSubscriptions[e]=t.subscriptions[e]}),{...oe}):{error:Yt,info:"missing subscriptions"}}function Jje(t){return t?.subscriptions?qa.setSubscriptions({subscriptions:t.subscriptions}):{error:Yt,info:"missing subscriptions"}}function kme(t){return t?typeof t!="object"?{error:Se}:(Object.keys(t).forEach(e=>{gl(t[e])&&(Er.globalMethods[e]=t[e])}),{...oe}):{error:Yt,info:"missing method declarations"}}function Ome(t){return t?typeof t!="object"?{error:Se}:qa.setMethods(t):{error:Yt,info:"missing method declarations"}}function H4(){return qa.cycleMutationStatus()}function Ii(t){if(typeof t?.topic!="string")return;let e=Er.globalSubscriptions[t.topic];return qa.addNotice(t,e)}function xme(){return{...Er.globalMethods,...qa.getMethods()}}function Lme(t){return qa.getNotices(t)}function z4({key:t,topic:e}){return qa.deleteNotice({key:t,topic:e})}function BR(){return qa.deleteNotices()}function Jc(){return qa.getTopics()}function nL(t){return Jc()?.topics?.includes(t)}async function nj(t){return qa.callListener(t,Er.globalSubscriptions)}function bw(){return qa.getTournamentId()}function q4(t){return qa.getTournamentRecord(t)}function Iw(){return qa.getTournamentRecords()}function Fme(t){return qa.setTournamentRecord(t)}function aL(t){return qa.setTournamentRecords(t)}function fC(t){return qa.setTournamentId(t)}function Bme(t){return qa.removeTournamentRecord(t)}function aj(){return qa}function sL({engineName:t,methodName:e,params:i,err:r}){let n=gl(qa.handleCaughtError)&&qa.handleCaughtError||Mme.handleCaughtError,{tournamentRecord:a,...s}=i;return n({params:s,engineName:t,methodName:e,err:r})}function $me(t,e){if(Er.globalLog)try{Er.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Ame()}else console.log(e,t)}function Vme(t,e,i,r){if(!qi(t))return{error:Se};vn||(i=1);let n=Array.isArray(e)?e:[],a={},s=(o,l=0)=>{Object.keys(o).forEach(c=>{gl(o[c])?a[c]=o[c]:qi(o[c])&&(e===!0||n?.includes(c))&&(i===void 0||l<i)&&s(o[c],l+1)})};return s(t),r?kme(a):Ome(a),{methods:a}}function Qje(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ft(t,e,i,r){if(typeof t!="object"||t===null)return t;G4()?.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=Qje(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(o=>Ft(o))}:{[s]:r?t[s]:Ft(t[s])}))}function ue({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e?.stack)&&(e.stack=[]),e&&Array.isArray(e?.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&(e.context||(e.context={}),Object.assign(e.context,Ft(t))),e&&!e?.error&&!e?.success&&Object.assign(e,{...oe}),e??{success:!0}}var ps="FEMALE",Pf="OTHER",ww="MIXED",Xn="MALE",W4={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:ps,MIXED:ww,OTHER:Pf,MALE:Xn,ANY:"ANY"};function Mv(t){return[ps,"F"].includes(t)}function Cb(t){return[Xn,"M"].includes(t)}function tc(t){return[ww,"X"].includes(t)}function mh(t){return["ANY","A"].includes(t)}function Ns(t){if(t){if(Mv(t))return ps;if(tc(t))return ww;if(Cb(t))return Xn;if(mh(t))return"ANY"}return Pf}function Sp(t){return Mv(t)||Cb(t)}var eGe="MIXED events can not contain mixed singles or { gender: ANY } collections",tGe="events with { gender: ANY } can not contain MIXED singles collections";function oL(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&Sp(i)&&Ns(i)!==Ns(n)?ue({result:{valid:!1,error:JE},context:{gender:n},stack:e}):tc(i)&&(mh(n)||tc(n)&&r!==mr)?ue({result:{error:JE,valid:!1},info:eGe,stack:e}):mh(i)&&tc(n)&&r!==mr?ue({result:{error:JE,valid:!1},info:tGe,stack:e}):{valid:!0}}var iGe="normal",SZ="timed",rGe="final",Y4="NOAD",nGe={S:iGe,F:rGe};function lL(t,e){if((t?.bestOf||t?.exactly)&&t?.setFormat)return aGe(t,e)}function mC(t){return!isNaN(Number(t))&&Number(t)}function jme(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function aGe(t,e){let i=mC(t.bestOf)||void 0,r=mC(t.exactly)||void 0,n=i||r;if(t.setFormat?.timed&&t.simplified&&n===1)return jme(t.setFormat);let a=n&&`SET${n}`||"",s=TZ(t.setFormat,e),o=s&&`S:${s}`||"",l=TZ(t.finalSetFormat,e),c=n&&n>1&&l&&s!==l&&`F:${l}`||"";if(a&&s)return[a,o,c].filter(u=>u).join("-")}function TZ(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return jme(t);if(t.tiebreakSet)return UZ(t.tiebreakSet);let i=mC(t.setTo);if(i){let r=t.NoAD&&Y4||"",n=UZ(t.tiebreakFormat),a=n&&`/${n}`||"",s=mC(t.tiebreakAt),o=s&&(s!==i||e)&&`@${s}`||"";if(n!==!1)return`${i}${r}${a}${o}`}}}function UZ(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&mC(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?Y4:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function js(t){if(Yr(t)){let e=t.startsWith("T")&&SZ||t.startsWith("SET")&&"SET"||"";if(e===SZ){let i=Hme(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e==="SET")return sGe(t)}}function sGe(t){let e=t.split("-"),i=$R(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&DZ(e[1]),s=e&&DZ(e[2]),o=a&&a.timed||s&&s.timed,l=r&&r<6||o&&n,c=!e[2]||s,u=a,d=Ft({setFormat:a,exactly:n,bestOf:r});if(s&&(d.finalSetFormat=s),l&&u&&c)return d}function DZ(t){if(t?.[1]===":"){let e=t.split(":"),i=nGe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let f=EZ(r);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(r.startsWith("T"))return Hme(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&zme(n[2])||!1,s=!n?.[2]||a,o=n?$R(n[1]):void 0,l=Gme(r),c=l!==!1,u=c&&l||o,d=EZ(r.split("/")[1]),p=d!==!1,h={setTo:o};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,o&&s&&p&&c&&h||!1}}}function Gme(t,e=!0){let i=t?.indexOf("@")>0&&t.split("@");if(i)return(e?$R(i[1]):i[1])||!1}function EZ(t){if(t)if(t.startsWith("TB")){let e=Gme(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i?.[1],n=i&&zme(i[2]),a=!i?.[2]||n,s=$R(r);if(s&&a){let o={tiebreakTo:s};return e&&typeof e=="string"&&!mi(e)&&(o.modifier=e),n&&(o.NoAD=!0),o}else return!1}else return!1}function Hme(t){let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=$R(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2],s=[void 0,"P","G"].includes(a);if(a&&!s){let o=e.match(/^(\d+)(@)([A-Za-z]+)$/)?.[3];return o?(n.modifier=o,n):void 0}return a&&(n.based=i[2]),n}function zme(t){return t&&t.indexOf(Y4)>=0}function $R(t){return isNaN(Number(t))?0:Number(t)}function Al({matchUpFormat:t}){if(!Yr(t)||t==="")return!1;let e=js(t),i=/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),r=i?.[1],n=i?.[2],a=i?.[3],s=/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(t),o=s?.[1],l=s?.[2],c=s?.[3];return lL(e,!!(i&&n&&r===a||s&&l&&o===c))===t}var l_=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,qme=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Tp=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Nv=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function c_(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ui(t.scheduledTime)),!e)return;let i=zr(t.scheduledTime),r=Ui(e);return r&&i&&(r+=`T${i}`),r}function oGe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function wD(t){let e=typeof t=="string"?t?.split(" "):[];return t&&e?.length>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Nv.test(Sw(t,!0,!0)))}function tl(t){return cy(t)||l_.test(t)}function lGe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+3600*e.getHours();return cGe(i,{displaySeconds:!1})}function cGe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(_c).join(":")}var K4=t=>{let e=gC(t)||cy(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${_c(r)}-${_c(e.getUTCDate())}`};function uGe(t){let e=gC(t)||cy(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Au(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),s=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,s].join(e):i==="MDY"?[n,a,s].join(e):i==="YDM"?[s,a,n].join(e):i==="DYM"?[a,s,n].join(e):i==="MYD"?[n,s,a].join(e):[s,n,a].join(e)}function u_(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function dGe(t){return u_(t).getTime()}function gC(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function YT(t,e){if(!tl(t)||!tl(e))return[];let i=Ui(t)+"T00:00",r=Ui(e)+"T00:00",n=new Date(i),a=new Date(r),s=gC(a)&&gC(n)&&c(n,a),o=[],l=0;if(s){let u=n,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,o.push(new Date(u)),d=u.setDate(u.getDate()+1)}return o.map(u=>Au(u));function c(u,d){return u<=d}}var pGe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function cy(t){return typeof t!="string"?!1:pGe.test(t)}function Z4(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function Ji(t){let e=zr(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function hGe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[_c(e),_c(i)].join(":")}function d_(t){return Z4(t)?t.split(":").slice(0,2).map(_c).join(":"):void 0}function zr(t){return cy(t)&&t.indexOf("T")>0?d_(t.split("T").reverse()[0]):d_(t)}function Ui(t){return cy(t)||Tp.test(t)?t.split("T")[0]:void 0}function CE(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ui(i.toISOString())}function p_(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function fGe(t){let e=p_(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(_c).join(":")}function mGe(t){let e=p_(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),e.hours?.[0]==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Sw(t,e,i){let r=Ui(t),n=zr(t),a=r?n:t;return t?e&&(r&&i&&t||fGe(a))||mGe(a):void 0}function Wme(t,e){let i=p_(t),r=p_(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function X4(t,e=7){let i=Ui(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return Au(n)}function gGe(t){return X4(t)}function vGe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),Au(n,i)}function yGe(t,e,i){let r=new Date(t,0);return Au(new Date(r.setDate(e)),i)}function Gn(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(_c),n=u_(e).setHours(i,r,0,0);return u_(n)}function VR(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Qo(t,e){let i=zr(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return zr(J4(Gn(i),r).toISOString())}function J4(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function _c(t){return t.toString()[1]?t:"0"+t}function Lh(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var Yme={addDays:X4,addWeek:gGe,addMinutesToTimeString:Qo,convertTime:Sw,getIsoDateString:c_,getUTCdateString:K4,DateHHMM:lGe,extractDate:Ui,extractTime:zr,formatDate:Au,getDateByWeek:vGe,isISODateString:cy,isDate:gC,isTimeString:Z4,offsetDate:u_,offsetTime:dGe,sameDay:Lh,timeStringMinutes:Ji,timeToDate:Gn,timeUTC:uGe,validTimeValue:wD,validDateString:l_,timeValidation:Nv,dateValidation:Tp},bGe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),IGe=t=>t.filter(Boolean).every(vn);function bI(t){let e=t.category;if(typeof e!="object")return{error:dC};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s}=e,o=e.categoryName,l;if(!(bGe([i,r,n,o],"string")&&IGe([a,s])&&[r,n].filter(Boolean).every(tl)))return{error:dC};let c=t.consideredDate??Ui(new Date().toLocaleDateString("sv"));if(!tl(c))return{error:Ba};let[u]=c.split("-").slice(0,3).map(V=>parseInt(V)),d=CE(c,-1),[p,h]=d.split("-").slice(1,3).map(V=>parseInt(V)),f=`${_c(p)}-${_c(h)}`,m=CE(c,1),[g,v]=m.split("-").slice(1,3).map(V=>parseInt(V)),y=`${_c(g)}-${_c(v)}`,b=s&&CE(c,-1*365*s),I=a&&CE(c,-1*365*a),w=[],T=V=>!w.includes(V)&&w.push(V);i=i??o;let S=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,C=i?.includes("-"),E=C&&i?.match(D),P=i?.match(S),R=(V,F)=>`${V}-${F}`,M=V=>{let F=u-V,j=R(F,y);e.ageMinDate&&e.ageMinDate!==j&&T(`Invalid submitted ageMinDate: ${n}`),n=j,i&&(e.ageMax&&e.ageMax!==V-1&&(T(`Invalid submitted ageMax: ${a}`),I=void 0),a=V-1)},A=V=>{let F=u-V-1,j=R(F,y);e.ageMin&&e.ageMin>V&&T(`Invalid submitted ageMin: ${s}`),e.ageMax&&e.ageMax>V&&T(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==j&&T(`Invalid submitted ageMinDate: ${n}`),n=j,i&&(e.ageMax&&e.ageMax!==V&&(T(`Invalid submitted ageMax: ${a}`),b=void 0),a=V)},N=V=>{let F=u-V,j=R(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&T(`Invalid submitted ageMaxDate: ${r}`),r=j,i&&(e.ageMin&&e.ageMin!==V+1&&(T(`Invalid submitted ageMin: ${s}`),b=void 0),s=V+1)},k=V=>{let F=u-V-1,j=R(F,f);e.ageMaxDate&&e.ageMaxDate!==j&&T(`Invalid submitted ageMaxDate: ${r}`),r=j,i&&(e.ageMin&&e.ageMin!==V&&(T(`Invalid submitted ageMin: ${s}`),b=void 0),s=V)},x=V=>{let[F,j,q]=(V.match(S)||[]).slice(1),W=parseInt(j);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&T(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(W)):F==="O"&&N(W),q==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&T(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(W)):q==="O"&&k(W),r=r??b,n=n??I};if(E){if(r=void 0,n=void 0,a=void 0,s=void 0,e.ageMin){let j=u-e.ageMin;r=R(j,f)}if(e.ageMax){let j=u-e.ageMax-1;n=R(j,y)}let[V,F]=(i?.match(D)??[]).slice(1).map(j=>parseInt(j));V<=F?(s=V,a=F,l=!0):T(`Invalid combined age range ${i}`)}else C?i?.split("-").forEach(x):P?x(i):(s&&N(s),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(T(`Invalid submitted ageMin: ${e.ageMin}`),s=void 0);let O=Ft({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:s});return w.length&&(O.errors=w),O}function vC({category:t}){if(!qi(t))return{error:Se};let e=bI({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!vn(i)?ue({result:{error:Se},context:{ratingMax:i}}):r&&!vn(r)?ue({result:{error:Se},context:{ratingMin:r}}):{...e}}function jR({childCategory:t,withDetails:e,category:i}){let r=vC({category:i}),n=vC({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),s=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),o=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=i?.ratingType&&t?.ratingType&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=i?.ballType&&t?.ballType&&i.ballType!==t.ballType,d=Ft({invalidRatingRange:c,invalidAgeMinDate:o,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:s,invalidAgeMin:a,valid:!c&&!o&&!l&&!u&&!s&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function GR({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:s}){a=a??s?.gender;let o="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ue({result:{errors:l,error:Sm},stack:o});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!Hx([wr,mr],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!c?.length].concat([m,d,v,y].map(mi)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let w=wfe({collectionValueProfiles:c,matchUpCount:h});w.errors&&l.push(...w.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Al({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),r){let w=oL({referenceGender:a,matchUpType:g,gender:I});if(w.error)return ue({context:{referenceGender:a,gender:I},result:w,stack:o})}if(t&&n&&b){let w=jR({category:n,childCategory:b});if(!w.valid)return ue({result:{error:dC},context:w,stack:o})}return l.length?ue({result:{errors:l,error:Tme},stack:o}):{valid:!0}}function Oo(t){let e=!!(t?.enforceCategory!==!1&&t?.category),i=!!(t?.enforceGender!==!1&&t?.gender),r=t?.checkCollectionIds,n=t?.tieFormat,a=t?.event,s="validateTieFormat",o=[],l=wGe({...t,stack:s});if(l?.error)return l;let c,u=n.collectionDefinitions.every(m=>{let{setValue:g,scoreValue:v,collectionValue:y}=m;(g||v)&&!y&&(c=!0);let{valid:b,errors:I}=GR({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:m,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return b?!0:(Array.isArray(I)&&o.push(...I),!1)}),d=typeof n.winCriteria?.valueGoal=="number"&&n.winCriteria?.valueGoal>0&&!c||n.winCriteria?.aggregateValue;if(!(d||n.winCriteria?.aggregateValue))return c?o.push("aggregateValue is required"):o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ue({context:{tieFormat:n,errors:o,aggregateValueImperative:c},result:{error:fh},stack:s});let p=n.collectionDefinitions.map(({collectionId:m})=>m),h=!r||p.length===yi(p).length,f=u&&d&&h;return f?{valid:f,errors:o}:ue({result:{error:fh},context:{tieFormat:n,errors:o},stack:s})}function wGe(t){let{tieFormat:e,stack:i}=t;return!t||!e||!qi(e)?ue({result:{error:fh},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):qi(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...oe}:ue({result:{error:fh},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):ue({result:{error:fh},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}var KT="resourceSubType",ZT="resourceType",XT="identifier",SGe={RESOURCE_SUB_TYPE:KT,RESOURCE_TYPE:ZT,IDENTIFIER:XT};function Et(t,e,i,r,n=0){if(aj().makeDeepCopy)return aj().makeDeepCopy(t,e,i,r);let a=G4(),{stringify:s,toJSON:o,ignore:l,modulate:c}=a||{};if(!a?.enabled&&!i||typeof t!="object"||gl(t)||t===null||typeof a?.threshold=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||gl(l)&&!l(h)),p=(h,f)=>{u[h]=gl(f?.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=gl(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=Q4(f);Object.assign(u,...g)}else r&&h==="extensions"?u[h]=[]:Array.isArray(s)&&s.includes(h)?p(h,f):Array.isArray(o)&&o.includes(h)&&gl(f?.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:oGe(f)?u[h]=new Date(f).toISOString():u[h]=Et(f,e,i,r,n+1)}return u}function Q4(t){return t?.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}function Kme(t=1,e){return yt(0,t).map(()=>lr(e))}function lr(t){let e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);let i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=e[i&255]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]+"-"+e[r&255]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[n&63|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[a&255]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255];return typeof t=="string"?`${t}_${s.replace(/-/g,"")}`:s}var Zme={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Xme={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Jme={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Qme={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},ege={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},tge={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},ige={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},rge={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},nge={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},age={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},_u="SET3-S:6/TB7",TGe="SET3-S:6NOAD",sge="SET3-S:6/TB7-F:TB10",UGe="SET3-S:4/TB7",DGe="SET3-S:4/TB5@3",EGe="SET1-S:T20",PGe="SET1-S:8/TB7",CGe="SET1-S:8/TB7@7",RGe={FORMAT_STANDARD:_u,FORMAT_STANDARD_NOAD:TGe,FORMAT_ATP_DOUBLES:sge,FORMAT_SHORT_SETS:UGe,FORMAT_FAST4:DGe,FORMAT_PRO_SET:PGe,FORMAT_COLLEGE_PRO_SET:CGe,TIMED20:EGe},oge={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},lge={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},cge={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},uge={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},dge={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},pge={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},hge={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},h_="COLLEGE_DEFAULT",sj="COLLEGE_JUCO",oj="COLLEGE_D3",fge="DOMINANT_DUO",mge="DOMINANT_DUO_MIXED",gge="LAVER_CUP",vge="TEAM_DOUBLES_3_AGGREGATION",yge="TIME_TENNIS_DUAL",bge="TIME_TENNIS_PRO_CIRCUIT",Ige="USTA_BREWER_CUP",wge="USTA_OZAKI_CUP",Sge="USTA_COLLEGE",Tge="USTA_GOLD_TEAM_CHALLENGE",Uge="USTA_LEVEL_1",Dge="USTA_INTERSECTIONAL",Ege="USTA_SECTION_BATTLE",Pge="USTA_SOUTHERN_LEVEL_5",Cge="USTA_TOC",Rge="USTA_WTT_ITT",Mge="USTA_ZONAL",MGe={COLLEGE_D3:oj,COLLEGE_DEFAULT:h_,COLLEGE_JUCO:sj,DOMINANT_DUO:fge,DOMINANT_DUO_MIXED:mge,LAVER_CUP:gge,TEAM_DOUBLES_3_AGGREGATION:vge,TIME_TENNIS_DUAL:yge,TIME_TENNIS_PRO_CIRCUIT:bge,USTA_BREWER_CUP:Ige,USTA_OZAKI_CUP:wge,USTA_COLLEGE:Sge,USTA_GOLD_TEAM_CHALLENGE:Tge,USTA_INTERSECTIONAL:Dge,USTA_LEVEL_1:Uge,USTA_SECTION_BATTLE:Ege,USTA_SOUTHERN_LEVEL_5:Pge,USTA_TOC:Cge,USTA_WTT_ITT:Rge,USTA_ZONAL:Mge},Nge="STANDARD",PZ={[Nge]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[oj]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:_u,matchUpCount:6,matchUpValue:1},tieFormatName:oj,valueGoal:5},[h_]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:_u,matchUpCount:6,matchUpValue:1},tieFormatName:h_,valueGoal:4},[sj]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:_u,matchUpCount:6,matchUpValue:1},tieFormatName:sj,valueGoal:5},[gge]:pge,[fge]:oge,[mge]:ige,[vge]:Xme,[yge]:rge,[bge]:tge,[Ige]:nge,[wge]:age,[Sge]:lge,[Tge]:Zme,[Dge]:ege,[Uge]:cge,[Ege]:Qme,[Pge]:Jme,[Rge]:uge,[Cge]:hge,[Mge]:dge},NGe=t=>{let e=t?.namedFormat&&Object.keys(PZ).includes(t.namedFormat)?t.namedFormat:Nge,i=Array.isArray(t?.uuids)?t?.uuids:[],r,{category:n,gender:a}=t?.event??{},s=Et(PZ[e],!1,!0),o=l=>{if(!t?.isMock&&!t?.event?.isMock||!t.event)return i?.pop()??lr();let c=t?.event?.eventId;return i.pop()??`${c}-COL-${l+1}`};return s.hydrate?(r={winCriteria:{valueGoal:s.valueGoal},collectionDefinitions:[{collectionId:o(0),matchUpFormat:sge,collectionName:"Doubles",matchUpType:mr,...s.doubles},{collectionId:o(1),matchUpFormat:_u,collectionName:"Singles",matchUpType:wr,...s.singles}]},s.tieFormatName&&(r.tieFormatName=s.tieFormatName)):(s.collectionDefinitions.forEach((l,c)=>l.collectionId=o(c)),r=s),t?.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Qf=NGe,Up="SINGLES",II="SINGLES",jc="DOUBLES",em="DOUBLES",ta="TEAM",_l="TEAM",AGe="RATING",_Ge="BOTH",kGe={AGE:"AGE",BOTH:_Ge,DOUBLES:jc,DOUBLES_EVENT:em,RATING:AGe,SINGLES:Up,SINGLES_EVENT:II,TEAM_EVENT:_l,TEAM:ta},Dt="MAIN",zt="QUALIFYING",ws="CONSOLATION",$a="VOLUNTARY_CONSOLATION",wn="PLAY_OFF",cL=[Dt,zt,ws,wn,$a],wI={[zt]:1,[Dt]:2,[wn]:3,[ws]:3,[$a]:4},Age="finishingPositions",_ge="aggregateEventStructures",kge={[Dt]:1,[wn]:2,[ws]:3,[zt]:4,[$a]:5},OGe={[wn]:1,[Dt]:2,[ws]:3,[zt]:4,[$a]:5},uL="CLUSTER",xGe="SEPARATE",uy="WATERFALL",dL="ITEM",To="CONTAINER",dd="DRAW",pL="RANDOM",Uu="TOP_DOWN",dy="BOTTOM_UP",Fh="POSITION",Bh="WINNER",$h="LOSER",Dp="FIRST_MATCHUP",kl="AD_HOC",LGe="AD_HOC",SD="FEED_IN",JT="COMPASS",QT="OLYMPIC",FGe="SINGLE_ELIMINATION",sp="SINGLE_ELIMINATION",HR="DOUBLE_ELIMINATION",eU="FIRST_MATCH_LOSER_CONSOLATION",zR="FIRST_ROUND_LOSER_CONSOLATION",Hy="LUCKY_DRAW",hL="CURTIS_CONSOLATION",BGe="CURTIS_CONSOLATION",e5="FEED_IN_CHAMPIONSHIP_TO_SF",yC="FEED_IN_CHAMPIONSHIP_TO_SF",t5="FEED_IN_CHAMPIONSHIP_TO_QF",bC="FEED_IN_CHAMPIONSHIP_TO_QF",i5="FEED_IN_CHAMPIONSHIP_TO_R16",IC="FEED_IN_CHAMPIONSHIP_TO_R16",Oge="MODIFIED_FEED_IN_CHAMPIONSHIP",wC="MODIFIED_FEED_IN_CHAMPIONSHIP",qR="FEED_IN_CHAMPIONSHIP",$Ge="DOUBLE_ROUND_ROBIN",zu="ROUND_ROBIN",Vh="ROUND_ROBIN_WITH_PLAYOFF",xge="DECIDER",Lge="BACKDRAW",r5={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},n5={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},py="WIN_RATIO",Tw="ROUND_OUTCOME",Fge=[JT,hL,bC,IC,yC,qR,t5,i5,e5,eU,zR,Hy,wC,QT,wn,Vh],VGe=[kl,JT,hL,HR,bC,IC,yC,qR,SD,eU,zR,Hy,wC,QT,wn,zu,Vh,sp],Bge={MAIN:Dt,QUALIFYING:zt,CONSOLATION:ws,ITEM:dL,CONTAINER:To,FIRST_MATCHUP:Dp,WINNER:Bh,LOSER:$h,AD_HOC:kl,FEED_IN:SD,FLEX_ROUNDS:LGe,COMPASS:JT,PLAY_OFF:wn,OLYMPIC:QT,KNOCKOUT:FGe,SINGLE_ELIMINATION:sp,DOUBLE_ELIMINATION:HR,CURTIS:hL,FICSF:e5,FICQF:t5,FICR16:i5,MFIC:Oge,VOLUNTARY_CONSOLATION:$a,FIRST_MATCH_LOSER_CONSOLATION:eU,FIRST_ROUND_LOSER_CONSOLATION:zR,MODIFIED_FEED_IN_CHAMPIONSHIP:wC,FEED_IN_CHAMPIONSHIP_TO_R16:IC,FEED_IN_CHAMPIONSHIP_TO_QF:bC,FEED_IN_CHAMPIONSHIP_TO_SF:yC,FEED_IN_CHAMPIONSHIP:qR,LUCKY_DRAW:Hy,ROUND_ROBIN_WITH_PLAYOFF:Vh,ROUND_ROBIN:zu,DECIDER:xge,BACKDRAW:Lge,COMPASS_ATTRIBUTES:r5,OLYMPIC_ATTRIBUTES:n5,DRAW:dd,RANDOM:pL,TOP_DOWN:Uu,BOTTOM_UP:dy,WATERFALL:uy,WIN_RATIO:py,ROUND_OUTCOME:Tw,MULTI_STRUCTURE_DRAWS:Fge,generatedDrawTypes:VGe,stageOrder:wI,finishOrder:kge,AGGREGATE_EVENT_STRUCTURES:_ge,FINISHING_POSITIONS:Age},jGe=Bge,Fs="tournamentRecords",a5="policyDefinitions",pa="tournamentRecord",s5="onlineResource",Gs="drawDefinition",$ge="tieFormatName",o5="matchUpFormat",jh="participantId",Vge="scheduleDates",GGe="tournamentId",HGe="scheduleDate",zGe="roundNumber",fL="structureId",l5="participant",WR="matchUpIds",jge="entryStage",qGe="policyType",Gge="structures",c5="eventType",Fp="matchUpId",mL="tieFormat",gL="inContext",vL="structure",yL="courtIds",WGe="personId",bL="venueIds",u5="matchUps",Hge="courtId",zge="eventId",ef="matchUp",qge="drawId",ku="error",Tm="event",TD="param",d5="uuids",YGe="averageMatchUpMinutes",KGe="recoveryMinutes",ZGe="periodLength",XGe="number",Zo="object",Rs="array",hs="_validate",Wge="_message",uc="_invalid",Bo="_ofType",p5="_anyOf",tU="_oneOf",CZ={[s5]:t=>En(Object.keys(t),[KT,ZT,XT]).length===3,[$ge]:t=>t&&Qf({namedFormat:t}),[d5]:t=>!t||Array.isArray(t)&&t.every(Yr),[mL]:t=>!Oo({tieFormat:t}).error,[c5]:t=>[Up,jc,ta].includes(t),[jge]:t=>cL.includes(t)},JGe={[Fs]:hn,[pa]:et,[a5]:Wx,[Gs]:At,[jh]:oa,[o5]:U4,[GGe]:zT,[fL]:gc,[WR]:fw,[l5]:vw,[s5]:Sm,[c5]:xh,[Gge]:I4,[Fp]:eo,[mL]:fh,[vL]:jy,[Hge]:mw,[u5]:wm,[zge]:Vc,[ef]:ko,[yL]:Yt,[bL]:Yt,[qge]:Nd,[Tm]:Lr},QGe={[Fs]:Zo,[a5]:Zo,[pa]:Zo,[Gs]:Zo,[s5]:Zo,[Vge]:Rs,[l5]:Zo,[WR]:Rs,[Gge]:Rs,[mL]:Zo,[vL]:Zo,[yL]:Rs,[bL]:Rs,[u5]:Rs,[ef]:Zo,[Tm]:Zo,[d5]:Rs};function Gt(t,e,i){if(!t&&!qi(t))return{error:Se};if(!e?.length||t?._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Se};let{paramError:r,errorParam:n}=iHe(t,e);if(!r)return{valid:!0};let a=r[hs]&&(r[ku]||r[uc])||t?.[n]===void 0&&(r[ku]||r[uc]||JGe[n]||Se)||Se,s=n??(r[tU]&&Object.keys(r[tU]).join(", "));return ue({info:{param:s,message:r[Wge]},result:{error:a},stack:i})}function Yge(t,e){let i=Object.keys(t),r=Object.keys(e);return En(i,r)}function eHe(t,e){if(!e)return;let i=Yge(t,e);return i.length!==1?{error:Se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function tHe(t,e){if(!e)return;let i=Yge(t,e).filter(r=>t[r]);return i.length<1?{error:Se}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function iHe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:s,_validate:o,_info:l,...c})=>{let u=a&&eHe(t,a);if(u?.error)return u.error;u&&Object.assign(c,u);let d=s&&tHe(t,s);if(d?.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=o&&!gl(o),g=t[f]!==void 0&&!o&&rHe(t,f,n),v=c[f]&&[void 0,null].includes(t[f]),y=m||g||v||o&&t[f]!==void 0&&!nHe(t[f],o)||CZ[f]&&!CZ[f](t[f]);return y&&(i=f,r=l),y});return!p.length||h}),errorParam:i,paramInfo:r}}function rHe(t,e,i){return i=i||QGe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function nHe(t,e){return gl(e)?e(t):!0}var h5="DYNAMIC",yg="RANKING",rg="RATING",hy="SCALE",gh="SEEDING",aHe={RANKING:yg,RATING:rg,SCALE:hy,SEEDING:gh};function UD(t){let e=Gt(t,[{[l5]:!0}]);if(e.error)return e;let i=t.participant.timeItems?.filter(({itemType:n})=>n?.startsWith(hy)&&[yg,rg,gh].includes(n.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let n=s=>i.filter(o=>o?.itemType===s).sort((o,l)=>new Date(o.createdAt||void 0).getTime()-new Date(l.createdAt||void 0).getTime()).pop(),a=yi(i.map(({itemType:s})=>s));for(let s of a){let o=n(s);if(o){let[,l,c,u,d]=o.itemType.split("."),p=d?`${u}.${d}`:u,h=l===gh&&"seedings"||l===yg&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:o.itemValue,scaleDate:o.itemDate,scaleName:p})}}}return{...oe,...r}}function SI(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,s,o){if(!a||!s)return;let l=Object.keys(a),c=Object.keys(s),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=s[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return n(y,m,b)!==!1?b:void 0}).filter(Boolean);o[h]=v}else g&&(o[h]={},n(g,m,o[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(s[h]||p&&s[h]!==!1)&&(o[h]=v)}}}}var lj="voluntaryConsolation",Cf="competitiveBands",f5="roundRobinTally",Gh="positionActions",Va="matchUpActions",kN="rankingPoints",tm="roundNaming",DD="participant",SC="progression",Wg="scheduling",TC="avoidance",sHe="participant",oHe="display",Gc="scoring",Iu="seeding",iU="feedIn",lHe="audit",f_="draws",cHe={POLICY_TYPE_VOLUNTARY_CONSOLATION:lj,POLICY_TYPE_COMPETITIVE_BANDS:Cf,POLICY_TYPE_ROUND_ROBIN_TALLY:f5,POLICY_TYPE_POSITION_ACTIONS:Gh,POLICY_TYPE_MATCHUP_ACTIONS:Va,POLICY_TYPE_RANKING_POINTS:kN,POLICY_TYPE_ROUND_NAMING:tm,POLICY_TYPE_PARTICIPANT:DD,POLICY_TYPE_PROGRESSION:SC,POLICY_TYPE_SCHEDULING:Wg,POLICY_TYPE_AVOIDANCE:TC,POLICY_TYPE_DISPLAY:oHe,POLICY_TYPE_PRIVACY:sHe,POLICY_TYPE_FEED_IN:iU,POLICY_TYPE_SCORING:Gc,POLICY_TYPE_SEEDING:Iu,POLICY_TYPE_AUDIT:lHe,POLICY_TYPE_DRAWS:f_};function bg({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let s=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),o=Et(s,!1,n);if(o){let l=e?.[DD];if(i?.withScaleValues){let{ratings:c,rankings:u}=UD({participant:o});o.rankings=u,o.ratings=c}if(l?.participant)return SI({template:l.participant,source:o})}return o}var uHe="element required",dHe="missing name";function uo(t){if(!t||typeof t!="object")return{error:Yt};if(t.element&&typeof t?.element!="object")return{error:Se};if(!t?.name)return{error:Yt,info:dHe};if(!t?.element){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=uo({element:i,name:t.name});if(r.error)return ue({result:r,stack:"removeExtension"})}return{...oe}}return{error:Yt,info:uHe}}return t?.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>e?.name!==t.name),{...oe}):{...oe,info:za}}function Ep({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function nr(t){if(typeof t!="object")return{error:Yt};let e="addExtension";if(t?.element&&typeof t.element!="object")return ue({result:{error:Se},stack:e});if(!Ep({extension:t.extension}))return ue({result:{error:Se,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=nr({extension:t.extension,element:r});if(n.error)return ue({result:n,stack:e})}return{...oe}}else return ue({result:{error:Yt},stack:e});if(t.element.extensions||(t.element.extensions=[]),t?.creationTime??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...oe}}function m5(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?nr({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:et}}function IL(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?nr({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:lc}}function Yg(t){return!t||typeof t!="object"?{error:Yt}:t.event?nr({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Vc}}function Kge(t){if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:oa};let e=t.tournamentRecord?.participants||[],i=bg({participantId:t.participantId,tournamentParticipants:e});return i?nr({creationTime:t.creationTime,extension:t.extension,element:i}):{error:_n}}function g5(t){return!t||typeof t!="object"?{error:Yt}:t.tournamentRecord?uo({element:t.tournamentRecord,name:t.name}):{error:et}}function Zge(t){return!t||typeof t!="object"?{error:Yt}:t.drawDefinition?uo({element:t.drawDefinition,name:t.name}):{error:lc}}function wL(t){return!t||typeof t!="object"?{error:Yt}:t?.event?uo({element:t.event,name:t.name}):{error:Vc}}function Xge(t){if(!t||typeof t!="object")return{error:Yt};if(!t.participantId)return{error:oa};let e=t.tournamentRecord?.participants||[],i=bg({participantId:t.participantId,tournamentParticipants:e});return i?uo({element:i,name:t.name}):{error:_n}}function YR({tournamentRecords:t}){return{tournamentIds:qi(t)?Object.keys(t):[],...oe}}var pHe="extensionQueries";function Ci({discover:t,element:e,name:i,...r}){if(!e||!i){if(t&&r){let a=Object.keys(r).filter(l=>typeof t=="boolean"||Array.isArray(t)&&t.includes(l)).find(l=>Array.isArray(r[l]?.extensions)?r[l].extensions.find(c=>c?.name===i):!1),s=a&&r[a];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(l=>l.extensions?.length));let o=s?.extensions?.find(l=>l?.name===i);return{extension:o,info:o?void 0:za}}return ue({result:{error:Yt},stack:pHe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(a=>a?.name===i);return{extension:n,info:n?void 0:za}}var hHe="activeSuspension",UC="appliedPolicies",Jge="context",SL="delegatedOutcome",bd="disabled",TI="disableAutoCalc",TL="disableLinks",m_="display",$v="drawDeletions",fHe="drawProfile",g_="entryProfile",mHe="eventProfile",gHe="eventWithdrawalRequests",vHe="factory",qu="flightProfile",cj="groupingAttribute",im="lineUps",fy="linkedTournamentsIds",UL="matchUpHistory",v5="participantRepresentatives",ED="personRequests",sT="positionActions",yHe="rankingPoints",bHe="registration",Bp="roundTarget",KR="scheduleLimits",rm="scheduleTiming",UI="schedulingProfile",IHe="statusDetail",rU="subOrder",nm="tally",QE="tieFormatModification",Qge={ACTIVE_SUSPENSION:hHe,APPLIED_POLICIES:UC,CONTEXT:Jge,DELEGATED_OUTCOME:SL,DISABLED:bd,DISABLE_LINKS:TL,DISABLE_AUTO_CALC:TI,DISPLAY:m_,DRAW_DELETIONS:$v,DRAW_PROFILE:fHe,ENTRY_PROFILE:g_,EVENT_PROFILE:mHe,EVENT_WITHDRAWAL_REQUESTS:gHe,FLIGHT_PROFILE:qu,GROUPING_ATTRIBUTE:cj,LINEUPS:im,LINKED_TOURNAMENTS:fy,MATCHUP_HISTORY:UL,PARTICIPANT_REPRESENTATIVES:v5,PERSON_REQUESTS:ED,POSITION_ACTIONS:sT,RANKING_POINTS:yHe,REGISTRATION:bHe,ROUND_TARGET:Bp,SCHEDULE_LIMITS:KR,SCHEDULE_TIMING:rm,SCHEDULING_PROFILE:UI,STATUS_DETAIL:IHe,SUB_ORDER:rU,TALLY:nm,TIE_FORMAT_MODIFICATIONS:QE,FACTORY:vHe},RZ=[SL,bd,TI,TL,qu,im,fy,UL,v5,ED,Bp,KR,rm,UI,rU,nm,QE];function eve({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let e=YR({tournamentRecords:t}),{tournamentIds:i}=e;return i?.length>1?nr({tournamentRecords:t,discover:!0,extension:{name:fy,value:{tournamentIds:i}}}):{...oe}}function tve({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let e=uo({name:fy,tournamentRecords:t,discover:!0});return ue({result:e,stack:"unlinkTournaments"})}function ive({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Se};if(!e)return{error:zT};let i=YR({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:zT};let n;return r.every(a=>{let s=t[a],{extension:o}=Ci({element:s,name:fy});if(!o)return!0;let l=o?.value?.tournamentIds||[];if(!l?.length||l.length===1&&l.includes(e)||a===e){let d=g5({name:fy,tournamentRecord:s});return d.error&&(n=d.error),d.success}let c=l.filter(d=>d!==e);o.value={tournamentIds:c};let u=m5({tournamentRecord:s,extension:o});return u.error&&(n=u.error),u.success}),n?{error:n}:{...oe}}var rve={};_i(rve,{getLinkedTournamentIds:()=>ZR,getTournamentIds:()=>YR});function ZR({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:hn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{let i=t[e],r=i?.tournamentId,{extension:n}=Ci({element:i,name:fy}),a=(n?.value?.tournamentIds||[]).filter(s=>s!==r);return{[e]:a}}))}}var nve={};_i(nve,{adHocPositionSwap:()=>Zye,addAdHocMatchUps:()=>QL,addDrawDefinitionTimeItem:()=>b6,addFinishingRounds:()=>d0,addGoesTo:()=>gy,addPlayoffStructures:()=>JL,addQualifyingStructure:()=>Kye,addVoluntaryConsolationStage:()=>jye,addVoluntaryConsolationStructure:()=>s6,allPlayoffPositionsFilled:()=>g6,alternateDrawPositionAssignment:()=>Mye,assignDrawPosition:()=>wbe,assignDrawPositionBye:()=>bc,attachConsolationStructures:()=>vbe,attachPlayoffStructures:()=>O6,attachQualifyingStructure:()=>y6,attachStructures:()=>XL,autoSeeding:()=>U5e,automatedPlayoffPositioning:()=>kD,automatedPositioning:()=>w0,checkValidEntries:()=>iF,deleteAdHocMatchUps:()=>Tbe,drawMatic:()=>s7,findDrawDefinition:()=>$6,generateAdHocMatchUps:()=>rF,generateAdHocRounds:()=>a7,generateAndPopulatePlayoffStructures:()=>_6,generateDrawDefinition:()=>F0,generateDrawMaticRound:()=>Y6,generateDrawStructuresAndLinks:()=>z6,generateDrawTypeAndModifyDrawDefinition:()=>q6,generateQualifyingStructure:()=>D6,generateVoluntaryConsolation:()=>Ybe,getAssignedParticipantIds:()=>Jy,getAvailableMatchUpsCount:()=>eF,getAvailablePlayoffProfiles:()=>U0,getDrawDefinitionTimeItem:()=>L5,getDrawParticipantRepresentativeIds:()=>F6,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>M0,getEligibleVoluntaryConsolationParticipants:()=>L6,getMatchUpsMap:()=>rs,getParticipantIdFinishingPositions:()=>B6,getPositionAssignments:()=>AC,getPositionsPlayedOff:()=>OD,getRandomQualifierList:()=>G6,getSeedingThresholds:()=>u6,getSeedsCount:()=>N0,getStructureSeedAssignments:()=>Hc,getTeamLineUp:()=>my,getValidGroupSizes:()=>b0,isAdHoc:()=>xo,isCompletedStructure:()=>qh,isValidForQualifying:()=>H6,luckyLoserDrawPositionAssignment:()=>Uye,modifyDrawDefinition:()=>ybe,modifyDrawName:()=>x6,modifySeedAssignment:()=>Oye,mutate:()=>ave,positionActions:()=>j6,pruneDrawDefinition:()=>Ibe,qualifierDrawPositionAssignment:()=>v6,qualifierProgression:()=>xye,query:()=>Ebe,removeDrawPositionAssignment:()=>RC,removeRoundMatchUps:()=>Ube,removeSeededParticipant:()=>Yye,removeStructure:()=>$ye,renameStructures:()=>Bye,resetDrawDefinition:()=>bbe,resetQualifyingStructure:()=>Gye,resetVoluntaryConsolationStructure:()=>wve,setDrawParticipantRepresentativeIds:()=>sve,setPositionAssignments:()=>Cye,setStructureOrder:()=>Lye,setSubOrder:()=>Dbe,shiftAdHocRounds:()=>Pye,swapAdHocRounds:()=>Rye,swapDrawPositionAssignments:()=>qye,updateTeamLineUp:()=>Lw,withdrawParticipantAtDrawPosition:()=>gye});var ave={};_i(ave,{adHocPositionSwap:()=>Zye,addAdHocMatchUps:()=>QL,addDrawDefinitionTimeItem:()=>b6,addPlayoffStructures:()=>JL,addQualifyingStructure:()=>Kye,addVoluntaryConsolationStage:()=>jye,addVoluntaryConsolationStructure:()=>s6,alternateDrawPositionAssignment:()=>Mye,assignDrawPosition:()=>wbe,assignDrawPositionBye:()=>bc,attachConsolationStructures:()=>vbe,attachPlayoffStructures:()=>O6,attachQualifyingStructure:()=>y6,attachStructures:()=>XL,automatedPlayoffPositioning:()=>kD,automatedPositioning:()=>w0,deleteAdHocMatchUps:()=>Tbe,luckyLoserDrawPositionAssignment:()=>Uye,modifyDrawDefinition:()=>ybe,modifyDrawName:()=>x6,modifySeedAssignment:()=>Oye,pruneDrawDefinition:()=>Ibe,qualifierDrawPositionAssignment:()=>v6,qualifierProgression:()=>xye,removeDrawPositionAssignment:()=>RC,removeRoundMatchUps:()=>Ube,removeSeededParticipant:()=>Yye,removeStructure:()=>$ye,renameStructures:()=>Bye,resetDrawDefinition:()=>bbe,resetQualifyingStructure:()=>Gye,resetVoluntaryConsolationStructure:()=>wve,setDrawParticipantRepresentativeIds:()=>sve,setPositionAssignments:()=>Cye,setStructureOrder:()=>Lye,setSubOrder:()=>Dbe,shiftAdHocRounds:()=>Pye,swapAdHocRounds:()=>Rye,swapDrawPositionAssignments:()=>qye,updateTeamLineUp:()=>Lw,withdrawParticipantAtDrawPosition:()=>gye});var y5=t=>e=>t[e],b5=(t=[])=>t.map(Pa).filter(Boolean),uj=(t=[])=>t.map(Fi).filter(Boolean),Fi=(t={})=>y5(t)("participantId"),Pa=(t={})=>y5(t)("matchUpId"),DC=(t={})=>y5(t)("drawId");function sve({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:lc};if(!Array.isArray(t))return{error:Se};let i=uj(e?.entries||[]);return t.length&&En(t,i).length<t.length?{error:Se}:IL({drawDefinition:e,extension:{name:v5,value:t}})}var sl="ABANDONED",Uw="AWAITING_RESULT",$p="CANCELLED",Tn="COMPLETED",PD="DEAD_RUBBER",br="DEFAULTED",ra="DOUBLE_DEFAULT",ln="DOUBLE_WALKOVER",ed="IN_PROGRESS",Ol="INCOMPLETE",I5="NOT_PLAYED",wa="RETIRED",Kg="SUSPENDED",Pn="TO_BE_PLAYED",Fr="WALKOVER",wHe=[Uw,Tn,br,ed,Ol,wa,Kg],ove=[Uw,Tn,br,ln,ra,ed,Ol,wa,Kg,Fr],lve=[sl,Uw,"BYE",$p,Tn,PD,br,ln,ra,ed,Ol,I5,wa,Kg,Pn,Fr],cve=["BYE",ln,ra,Tn,br,wa,Fr],uve=[sl,Uw,$p,PD,ed,Ol,I5,Kg,Pn,void 0],la=[$p,sl,Tn,PD,br,ln,ra,wa,Fr],w5=[sl,Tn,br,ln,ra,ed,wa,Fr],dve=[ed,Ol,Kg,Pn],DL={ABANDONED:sl,AWAITING_RESULT:Uw,BYE:"BYE",CANCELLED:$p,COMPLETED:Tn,DEAD_RUBBER:PD,DEFAULTED:br,DOUBLE_WALKOVER:ln,DOUBLE_DEFAULT:ra,IN_PROGRESS:ed,INCOMPLETE:Ol,NOT_PLAYED:I5,RETIRED:wa,SUSPENDED:Kg,TO_BE_PLAYED:Pn,WALKOVER:Fr};function Dw(t,e,i){let r=d=>Ci({element:d,name:Bp})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===_ge&&OGe,s=i?.mode===Age&&kge,o=s||a||wI,l=d=>d?.stage===Dt&&d?.stageSequence===1,c=d=>l(d)?-1:o[d?.stage],u=d=>d?.matchUps.every(({matchUpStatus:p})=>la.includes(p)?1:-1);return n&&u(t)-u(e)||a&&c(t)-c(e)||(t?.stage&&o[t.stage]||0)-(e?.stage&&o[e.stage]||0)||(r(t)||0)-(r(e)||0)||!s&&!a&&(e?.positionAssignments?.length??1/0)-(t?.positionAssignments?.length??1/0)||(t?.stageSequence??0)-(e?.stageSequence??0)||(v_(t)||0)-(v_(e)||0)}function v_(t){return(t?.matchUps||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((n,a)=>n+a,0);return!e||r<e?r:e},void 0)}function oi(t){let e=Gt(t,[{[Gs]:!0,[fL]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Wu({drawDefinition:i}),a=n?.map(l=>l.structures?[...l.structures].concat(l):l).flat(),s=a?.find(l=>l.structureId===r);if(!s)return{error:en};let o=s.structureType===dL?a?.find(l=>l.structures?.some(c=>c.structureId===r)):void 0;return{structure:s,containingStructure:o}}function Wu({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:s,stage:o}){let l=!e&&At||!e?.structures&&I4||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=f=>{let m=Ci({element:f,name:Bp})?.extension?.value;return!n||n===m},u=e?.structures?.filter(p).filter(h).filter(c).sort((f,m)=>Dw(f,m,a))??[],d=t?Object.assign({},...cL.map(f=>{let m=u?.filter(g=>g.stage===f);return m?.length&&{[f]:m}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(f){return!o&&!Array.isArray(s)||o&&f.stage===o||Array.isArray(s)&&s.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function pve({drawDefinition:t}){if(!t)return{error:At};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Tr({structure:i}),a=n?.map(Fi).filter(Boolean)??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Tr({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:At};if({structure:i,error:r}=oi({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Tr({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=jfe,{positionAssignments:n,error:r}}function ca({drawDefinition:t,structureId:e,structure:i}){let r=Tr({drawDefinition:t,structureId:e,structure:i})?.positionAssignments||[],n=r?.filter(c=>c.participantId??c.bye??c.qualifier),a=r&&r?.length===n?.length,s=r?.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),o=r?.filter(c=>!c.participantId&&c.bye),l=r?.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:n,qualifierPositions:l,byePositions:o}}var S5="addDrawDefinition",EL="addMatchUps",Ig="addParticipants",T5="addScaleItems",hve="addEvent",fve="addVenue",Of="audit",U5="dataIssue",D5="deleteParticipants",E5="deleteVenue",P5="deletedDrawIds",C5="deletedMatchUpIds",R5="modifyDrawDefinition",mve="modifyDrawEntries",gve="modifyEventEntries",M5="modifyMatchUp",Ss="modifyParticipants",N5="modifyPositionAssignments",A5="modifySeedAssignments",zy="modifyTournamentDetail",qy="modifyVenue",dj="mutations",pj="publishEvent",vve="publishEventSeeding",yve="publishOrderOfPlay",bve="publishParticipants",_5="unPublishEvent",k5="unPublishEventSeeding",O5="unPublishOrderOfPlay",SHe="unPublishParticipants",PL="updateInContextMatchUp",THe={ADD_DRAW_DEFINITION:S5,ADD_MATCHUPS:EL,ADD_PARTICIPANTS:Ig,ADD_SCALE_ITEMS:T5,ADD_EVENT:hve,ADD_VENUE:fve,AUDIT:Of,DATA_ISSUE:U5,DELETE_PARTICIPANTS:D5,DELETE_VENUE:E5,DELETED_DRAW_IDS:P5,DELETED_MATCHUP_IDS:C5,MODIFY_DRAW_DEFINITION:R5,MODIFY_DRAW_ENTRIES:mve,MODIFY_EVENT_ENTRIES:gve,MODIFY_MATCHUP:M5,MODIFY_PARTICIPANTS:Ss,MODIFY_POSITION_ASSIGNMENTS:N5,MODIFY_SEED_ASSIGNMENTS:A5,MODIFY_TOURNAMENT_DETAIL:zy,MODIFY_VENUE:qy,MUTATIONS:dj,PUBLISH_EVENT_SEEDING:vve,PUBLISH_EVENT:pj,PUBLISH_ORDER_OF_PLAY:yve,PUBLISH_PARTICIPANTS:bve,UNPUBLISH_EVENT_SEEDING:k5,UNPUBLISH_EVENT:_5,UNPUBLISH_ORDER_OF_PLAY:O5,UPDATE_INCONTEXT_MATCHUP:PL};function CL(t,e){if(!t)return{error:At};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e?.filter(Boolean);return t.updatedAt=r,t.structures?.filter(Boolean).forEach(a=>{(!n?.length||n?.includes(a.structureId))&&(a.updatedAt=r)}),{...oe}}function wg({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&CL(t),Ii({payload:{matchUps:i,tournamentId:e,eventId:r},topic:EL}),{...oe}}function tf({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&CL(t),Ii({topic:C5,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)z4({key:a});return{...oe}}function Hi({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&Cr({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),Ii({topic:M5,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...oe}):(console.log(ko),{error:ko})}function UHe({tournamentId:t,inContextMatchUp:e}){return e?(Ii({payload:{inContextMatchUp:e,tournamentId:t},topic:PL,key:e.matchUpId}),{...oe}):{error:ko}}function XR({tournamentId:t,eventId:e,drawDefinition:i}){return i?(CL(i),Ii({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:S5,key:i.drawId}),{...oe}):(console.log(At),{error:At})}function DHe({tournamentId:t,eventId:e,drawId:i}){return Ii({payload:{drawId:i,tournamentId:t,eventId:e},topic:P5,key:i}),z4({key:i}),{...oe}}function Cr({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(CL(t,i),Ii({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:R5,key:t.drawId}),{...oe}):{error:At}}function Ive({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:At};if(!i)return{error:jy};let n=i.seedAssignments,a=i.structureId,s=t.drawId;return Ii({payload:{tournamentId:e,eventId:r,drawId:s,structureId:a,seedAssignments:n},topic:A5,key:t.drawId}),Cr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...oe}}function Sg({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:At};if(!i)return{error:jy};let n=Tr({structure:i}),a=i.structureId,s=t.drawId,o=r?.eventId;return Ii({topic:N5,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:o,drawId:s},key:a}),Cr({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:o}),{...oe}}function wve({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){if(!e)return{error:At};let n=e.structures?.find(s=>s.stage===$a);if(!n)return{error:en};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],tf({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(s=>s.entryStage!==$a)),Cr({tournamentId:t?.tournamentId,eventId:r?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...oe}}function x5({drawPositions:t,structure:e}){if([zt,Dt].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Tr({structure:e});i?.filter(({drawPosition:r})=>t?.includes(r))?.forEach(r=>{nr({element:r,extension:{name:TL,value:!0}})})}function RL(t){let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(e?.audit?.[sT]===!1)return;let{extension:n}=Ci({name:sT,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let o=r.structures.find(l=>l.stage===Dt);if(o){let l=Tr({structure:o}).positionAssignments?.map(({drawPosition:c,participantId:u,bye:d,qualifier:p})=>({drawPosition:c,participantId:u,qualifier:p,bye:d}));a.push({name:"initialMainAssignments",initialAssignments:l})}}let s={value:a.concat(i),name:sT};nr({element:r,extension:s})}function CD({tournamentRecord:t,drawDefinition:e,event:i}){let r=(t?.events||i&&[i])?.map(o=>o?.drawDefinitions).flat().filter(Boolean)||e&&[e]||[],n={},a={},s=r.map(o=>o?.structures?.filter(l=>l?.structures)).flat().filter(Boolean);for(let o of s){let{structures:l,structureId:c}=o??{};l&&c&&(n[c]=l?.map(u=>u.structureId))&&l.forEach(u=>a[u.structureId]=o?.structureId)}return{containedStructures:n,containerStructures:a}}function ML(t){let{sides:e,matchUpType:i}=t||{},r=t.potentialParticipants?.length?t.potentialParticipants.flat().map(a=>i===mr?a?.individualParticipantIds||[]:a.participantId).flat():[],n=(e||[]).map(a=>i===mr&&(a?.participant?.individualParticipantIds||[])||a?.participantId&&[a.participantId]||[]).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function Qc(t){return t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var JR="SIGN_IN_STATUS",Sve="SIGNED_OUT",EC="SIGNED_IN",Ro="TEAM",Bi="INDIVIDUAL",vc="GROUP",Ei="PAIR",hr="TEAM",eP={TEAM_PARTICIPANT:Ro,INDIVIDUAL:Bi,GROUP:vc,TEAM:hr,PAIR:Ei},EHe={INDIVIDUAL:Bi,GROUP:vc,PAIR:Ei,TEAM:hr,SIGN_IN_STATUS:JR,SIGNED_OUT:Sve,SIGNED_IN:EC};function NL({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Et(e,t?.convertExtensions,!0):e,a=n.filter(l=>l.participantType===hr),s=n.filter(l=>l.participantType===vc),o=n.filter(l=>l.participantType===Ei);return n.forEach(l=>{if(l.participantType===Bi){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.teamParticipantIds?.includes(u.participantId)&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),o.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),s.forEach(u=>{(u?.individualParticipantIds||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function Tve(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function PHe(t){let e=Object.assign({},...ng.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Tve(e[t])}var ng=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Uve({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n?.map(({person:o})=>o)].flat().filter(Boolean);function s(o){let{nationalityCode:l}=o||{};if(l){let c=ng.find(({iso:u})=>u===l);i&&c?.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=c.ioc),e&&c?.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=c.iso2),c?.label&&!o.countryName&&(o.countryName=c.label)}}a.forEach(s)}function CHe({participantMap:t,template:e}){let i=Object.values(t);for(let r of i){let n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(let a of n.individualParticipantIds){let s=t[a].participant;n.individualParticipants.push(e?SI({template:e,source:s}):s)}}}}function Zg(t){let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let n of Object.values(r)){let a=n.participants?.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:n.tournamentId}}return{error:_n}}function Dve(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Zg({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:Yt}}function eu(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=Dve(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:Se,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:L4};let a=n.timeItems.filter(o=>o?.itemType===r).filter(o=>!i?.length||i.some(l=>o?.itemSubTypes?.includes(l))).sort((o,l)=>{let c=new Date(o.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),s=Et(a.pop(),!1,!0);if(s){let o={timeItem:s,...oe};return e&&Object.assign(o,{previousItems:a}),o}else return{info:za}}function L5({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Nd};if(!e.timeItems)return{info:za};let{timeItem:n,previousItems:a,info:s}=eu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function QR({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Lr};if(!r.timeItems)return{info:za};let{timeItem:n,previousItems:a,info:s}=eu({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:s}}function AL({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:et};if(!e.timeItems)return{info:za};let{timeItem:n,previousItems:a,info:s}=eu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:s}}function F5({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:et};if(!i)return{error:oa};let a=Zg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:s}=a;if(!s?.timeItems)return{info:za};let{timeItem:o,previousItems:l,info:c}=eu({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return o&&{timeItem:o,previousItems:l}||{info:c}}var RHe={[vc]:"groupParticipantIds",[Ei]:"pairParticipantIds",[hr]:"teamParticipantIds"},MHe={[vc]:"groups",[hr]:"teams"};function Eve({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:s,withISO2:o,withIOC:l}){let c=[],u={};for(let p of i.participants??[]){let h=p?.participantId;h&&_He({participantMap:u,participantId:h})}for(let p of i.participants??[]){let h=Et(p,e,s),{participantId:f,individualParticipantIds:m,participantType:g}=h;if(!u[f]){c.push(f);continue}if(Object.assign(u[f].participant,h),m){let v=AHe({individualParticipantIds:m,participantCopy:h,participantMap:u,participantType:g,participantId:f});v.missingParticipantIds.length&&c.push(...v.missingParticipantIds)}if(r&&(u[f].participant.signedIn=NHe(h)),n){let{ratings:v,rankings:y,seedings:b}=UD({participant:h});u[f].participant.seedings=b,u[f].participant.rankings=y,u[f].participant.ratings=v}(l||o)&&Uve({participant:u[f].participant,withISO2:o,withIOC:l})}if(t){let p=qi(t)?t:void 0;CHe({participantMap:u,template:p})}let d;return a&&(d=NL({participants:Object.values(u).map(({participant:p})=>p),participantsProfile:{convertExtensions:e},deepCopy:!1}).groupInfo),{missingParticipantIds:c,participantMap:u,groupInfo:d}}function NHe(t){let{timeItem:e}=eu({itemType:JR,element:t});return e?.itemValue===EC}function AHe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){let a=[];for(let s of t){let o=i[s]?.participant;if(!o){a.push(s);continue}if(o[RHe[r]].push(n),[hr,vc].includes(r)){let{participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p}=e,h=MHe[r];o[h].push({participantRoleResponsibilities:l,participantOtherName:c,participantName:u,participantId:d,teamId:p})}if(r===Ei){let l=t.find(c=>c!==s);i[s].pairIdMap[n]=l,i[s].pairIdMap[l]=n}}return{missingParticipantIds:a}}function _He({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[wr]:{...i},[mr]:{...i},[hr]:{...i},...i}}}function Wy({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){if(e)return Eve({...t,...r,tournamentRecord:i});let a=Et(i.participants,!1,!0)||[];(t?.withIOC||t?.withISO2)&&a.forEach(o=>Uve({participant:o,...t}));let s;if((n||t?.withGroupings)&&a?.length&&({participantsWithGroupings:a,groupInfo:s}=NL({participantsProfile:t,deepCopy:!1,participants:a})),t?.withScaleValues&&a?.length)for(let o of a){let{ratings:l,rankings:c}=UD({participant:o});o.rankings=c,o.ratings=l}return{participants:a,groupInfo:s}}function er({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:D4};let s={};return i&&o(i),a&&o(a),r&&o(r),n&&o(n),{appliedPolicies:s,...oe};function o(l){let c=l?.extensions?.find(u=>u.name===UC)?.value;if(c)for(let u of Object.keys(c))(t?e.includes(u):!e.length||e.includes(u))&&(s[u]=Et(c[u],!1,!0))}}function Um({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:D4};let{appliedPolicies:a}=er({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),s={};for(let o of t){let l=a?.[o];l&&(s[o]=l)}return Object.keys(s).length?{policyDefinitions:s}:{info:xR.message}}var Pve="WALKOVER",MZ="RETIRED",B5="COMPETITIVE",PC="ROUTINE",CC="DECISIVE",ON="winRatio",kHe={[Cf]:{policyName:"Competitive Bands Default",profileBands:{[CC]:20,[PC]:50}}},$5=kHe;function Dm({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let s=Um({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let o=t?.[Cf]??s?.[Cf]??$5[Cf];a.policies[Cf]=o}return a}function Yy({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:et};let{appliedPolicies:a}=er({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:xR?.message}}function e0({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){e=e??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=Yy({policyType:Wg,tournamentRecord:t,event:r}),a=(t?Ci({element:t,name:rm}).extension:void 0)?.value,s=(r&&Ci({name:rm,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:s,categoryName:e,categoryType:i,policy:n}}}function V5({drawDefinition:t,attributes:e}){let{extension:i}=Ci({element:t,name:g_}),r=i?.value||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:g_,value:r},IL({drawDefinition:t,extension:i}),{entryProfile:r}}function t0({drawDefinition:t}){let{extension:e}=Ci({element:t,name:g_});return{entryProfile:e?.value||{}}}var Ou="ALTERNATE",i0="CONFIRMED",ol="DIRECT_ACCEPTANCE",r0="FEED_IN",n0="JUNIOR_EXEMPT",am="LUCKY_LOSER",a0="ORGANISER_ACCEPTANCE",s0="QUALIFIER",OHe="REGISTERED",o0="SPECIAL_EXEMPT",tu="UNGROUPED",Ky="UNPAIRED",nU="WILDCARD",Hh="WITHDRAWN",xN=[i0,ol,n0,a0,o0],Cve=[r0,am,s0],Zy=[i0,ol,r0,n0,a0,o0,nU],td=[i0,ol,n0,am,s0,a0,o0,nU],Rve=[Ou,i0,ol,r0,n0,am,a0,s0,OHe,o0,tu,Ky,nU,Hh],xHe={ALTERNATE:Ou,CONFIRMED:i0,DIRECT_ACCEPTANCE:ol,DIRECT_ENTRY_STATUSES:Zy,DRAW_SPECIFIC_STATUSES:Cve,EQUIVALENT_ACCEPTANCE_STATUSES:xN,FEED_IN:r0,JUNIOR_EXEMPT:n0,LUCKY_LOSER:am,ORGANISER_ACCEPTANCE:a0,QUALIFIER:s0,SPECIAL_EXEMPT:o0,STRUCTURE_SELECTED_STATUSES:td,UNGROUPED:tu,UNPAIRED:Ky,VALID_ENTRY_STATUSES:Rve,WILDCARD:nU,WITHDRAWN:Hh};function j5({stage:t,drawDefinition:e}){let{entryProfile:i}=t0({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&cL.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return V5({drawDefinition:e,attributes:n}),!0}return r}function LHe({stage:t,drawDefinition:e}){let{entryProfile:i}=t0({drawDefinition:e});return i[t]?.alternates||0}function FHe({stage:t,drawDefinition:e}){let{entryProfile:i}=t0({drawDefinition:e});return i[t]?.wildcardsCount||0}function hj({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Ew({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:s,stages:o,stage:l}){let c=i.entries?.reduce((u,d)=>{let p=Ci({name:Bp,element:d})?.extension?.value,h=l&&d.entryStage===l||o?.length&&d.entryStage&&o.includes(d.entryStage),f=!n||d.entryStatus&&n.includes(d.entryStatus),m=d.entryStageSequence??1;return h&&(!r||m===r)&&f&&(!s||!p||s===p)?u.concat(d):u},[])??[];if(a&&l===wn){let{playoffEntries:u,error:d}=BHe({provisionalPositioning:t,drawDefinition:i,structureId:a});return d&&console.log("playoff entries error"),(u?.length?u:c).filter(p=>!e||p.placementGroup===e)}return c}function BHe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Fh&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:s}=n.source,{structure:o}=oi({drawDefinition:e,structureId:s});o?.structureType===To&&(o.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{let{participantId:g}=m,v=Ci({element:m,name:nm}).extension?.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a?.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,w=[...a??[]].sort(ea).indexOf(I)+1;r.push({entryStage:wn,entryStatus:r0,placementGroup:w,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:r}}function $He({stage:t,drawDefinition:e}){return Zy.reduce((i,r)=>(hj({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function Hc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){let a,s=[];n||({structure:n,error:a}=oi({drawDefinition:i,structureId:r}));let o=Tr({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:en};r||(r=n.structureId);let{stage:l,stageSequence:c}=n,u=l===wn&&i&&Ew({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:l}),d=u?u.filter(f=>f.placementGroup===1).sort((f,m)=>f.GEMscore<m.GEMscore&&1||f.GEMscore>m.GEMscore&&-1||0).map((f,m)=>{let g=m+1;return{participantId:f.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],p=d?.slice(0,e?d.length:o.length/2);p.length?s=p:n.seedAssignments?s=n.seedAssignments:a=Afe;let h=n.seedLimit??n?.positionAssignments?.length;return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:l,error:a}}function zd(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function tP({item:t,drawDefinition:e,structure:i,event:r}){if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:e.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId)||(r.tieFormat?r.tieFormat:r.tieFormats?.find(n=>t.tieFormatId===n.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let n=e.tieFormats?.find(a=>i.tieFormatId===a.tieFormatId);if(n)return n}}}function Zs({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:tP({item:i,drawDefinition:t,structure:e,event:r})||tP({item:e,drawDefinition:t,structure:e,event:r})||zd(t)||zd(r)}}function VHe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function rs({drawDefinition:t,structure:e}){let i={},r=[];return(t?.structures??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:s,structures:o}=n,l=Array.isArray(o);if(l)l&&o.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=s;i[a]={matchUps:c,itemStructureIds:[]},c?.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Tg({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=e?.mappedMatchUps??t;let n=t[i],a=(n?.itemStructureIds||[]).map(s=>{let{matchUps:o,structureName:l}=t[s];return r?o.map(c=>Object.assign(Et(c,!0,!0),{containerStructureId:i,structureId:s,structureName:l})):o}).flat();return(n?.matchUps||[]).concat(...a)}function Mve({groupedOrder:t,roundPositionsCount:e}){if(!t||t?.length<=e)return t;let i=Ra(t,t.length/e).map(n=>n.reduce((a,s)=>a+s)),r=i.slice().sort(ea);return i.map(n=>r.indexOf(n)+1)}function _L(t){if(!qi(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>mi(a)||a===void 0||a===null);return r&&n}function iu(t){return Array.isArray(t)?t.every(_L):!1}function vo({matchUps:t=[],interpolate:e}){if(!iu(t))return{roundMatchUps:[],error:Se};let i=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return!p.roundNumber||d.includes(h)?d:d.concat(h)},[]).sort(ea).map(d=>{let p=t.filter(m=>m.roundNumber===d),h=p.find(({matchUpType:m})=>m===kr)?p.filter(({matchUpType:m})=>m===kr):p,f=m=>m.sort((g,v)=>ea(g.roundPosition,v.roundPosition));return{[d]:f(h)}}),r=t.reduce((d,p)=>{let h=typeof p.roundNumber=="string"?ri(p.roundNumber):p.roundNumber;return d[h]||(d[h]=Ft({abbreviatedRoundName:p.abbreviatedRoundName,finishingRound:p.finishingRound,roundName:p.roundName})),d},{}),n=Object.assign({},...i);if(e){let d=Math.max(...Object.keys(n).map(h=>ri(h)).filter(h=>!isNaN(h))),p=n[d]?.length;if(p>1&&Dd(p)){let h=d+1,f=h+p/2;yt(h,f).forEach((m,g)=>{n[m]=yt(0,p/(2+g*2)).map(()=>({}))})}}let a=0,s=Object.assign({},...Object.keys(n).map(d=>{let p=n[d]?.length,h=n[d]?.filter(m=>!la.includes(m.matchUpStatus)&&!m.score?.scoreStringSide1)?.length,f=p&&p===h;return a=Math.max(a,p),{[d]:{matchUpsCount:p,inactiveCount:h,inactiveRound:f}}})),o=0,l=0,c=Object.keys(n).map(d=>ri(d)).filter(d=>!isNaN(d));c.forEach(d=>{let p=n[d].sort((f,m)=>f.roundPosition-m.roundPosition),h=p.map(f=>f?.drawPositions||[]).flat();if(s[d].roundNumber=d,s[d].roundFactor=s[d].matchUpsCount?a/s[d].matchUpsCount:1,s[d].finishingRound=r[d]?.finishingRound,s[d].roundName=r[d]?.roundName,s[d].abbreviatedRoundName=r[d]?.abbreviatedRoundName,s[d].finishingPositionRange=n[d]?.[0]?.finishingPositionRange,d===1||!s[d-1]){let f=h.sort(ea),m=Ra(f,2);s[d].drawPositions=f,s[d].pairedDrawPositions=m}else{let f=s[d-1],m=f.drawPositions,g=f.matchUpsCount/s[d].matchUpsCount,v=Ra(m,g),y=p.map(b=>{let{roundPosition:I}=b,w=[...b.drawPositions||[],void 0,void 0].slice(0,2);if(!I)return w;let T=w?.filter(Boolean)||[];if(!T?.length)return[void 0,void 0];if(d<3&&T?.length===2)return w?.slice().sort(ea);let S=En(m,T).length!==T?.length;if(T?.length&&S)return T?.length===1?[T[0],void 0]:w?.slice().sort(ea);let D=(I-1)*2;return v.slice(D,D+2).map(C=>T?.find(E=>C.includes(E)))});s[d].drawPositions=y?.flat(),s[d].pairedDrawPositions=y}s[d+1]&&s[d+1].matchUpsCount===s[d].matchUpsCount&&(s[d+1].feedRound=!0,s[d+1].feedRoundIndex=l,s[d].preFeedRound=!0,l+=1),s[d]&&!s[d].feedRound&&(s[d].roundIndex=o,o+=1)});let u=!!Object.values(s).find(({matchUpsCount:d})=>!Dd(d));return{hasNoRoundPositions:t.some(d=>!d.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:c,roundProfile:s,...oe}}function LN(t){if(!Array.isArray(t))return"";let e=t.filter(vn);return e.length?yi([Math.min(...e),Math.max(...e)]).join("-"):""}function jHe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:At};if(!e)return{error:gc};let{structure:r}=oi({drawDefinition:t,structureId:e});if(r?.stage!==ws)return{error:Gy,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=n?.filter(d=>d.target.structureId===e)||[],s=a?.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[])||[],o=Object.assign({},...s.map(d=>{let p=Tg({structureId:d,matchUpsMap:i}),h=vo({matchUps:p}).roundProfile;return{[d]:h}})),l=Tg({matchUpsMap:i,structureId:e}),{roundProfile:c}=vo({matchUps:l}),u={};return a?.forEach(d=>{let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=o[p],b=y[1]?.drawPositions,I=y[h]?.matchUpsCount;if(!I)return;let w=I?b.length/I:0,T=b.length/w,S=b.slice(),D=Mve({roundPositionsCount:T,groupedOrder:m}),C=D?.length||1;if(C<=T){let R=b.length/C,M=Ra(S,R);f===dy&&M.forEach(A=>A.reverse()),S=D?.length&&D?.map(A=>M[A-1]).flat()||M.flat()}let E=Ra(S,w);if(g){let R=yt(0,g.interleave).map(()=>{}),M=yt(0,g.offset).map(()=>{});E=E.map(N=>[N,...R]),E.unshift(M),E=E.flat(1);let A=E.length-g.offset;E=E.slice(0,A)}u[v]||(u[v]={});let P=c?.[v]?.feedRound?2:1;E.forEach((R,M)=>{let A=1+M*P;u[v][A]||(u[v][A]=LN(R))})}),{sourceDrawPositionRanges:u}}function Nve({drawDefinition:t}){if(typeof t!="object")return{error:zb};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((s,o)=>{let{stage:l}=o;return s[l]?s[l].push(o):s[l]=[o],s},{});for(let s of Object.keys(n)){let o=n[s].find(({stageSequence:c})=>c===1);if(!o)continue;let{structureId:l}=o;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:s})}return{exitProfiles:e};function a({exitProfiles:s,exitProfile:o,structureId:l,targetRound:c,aggregator:u,stage:d}){s[l]||(s[l]=[]),o==="0"&&[ws,wn].includes(d)||s[l].push(o);let p=r.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${o}-${f}`,structureId:g,exitProfiles:s,targetRound:m,aggregator:u,stage:v})}}}function GHe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){if(!t)return{error:At};if(!i)return{error:gc};if(!e){let s=Tg({matchUpsMap:r,structureId:i});if({roundProfile:e}=vo({matchUps:s}),!e)return{error:Yt}}let n=(Math.min(...e?.[1]?.drawPositions??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{let o=e?.[s]?.matchUpsCount,l=e?.[1]?.drawPositions??[],c=Ra(l,l.length/o),u=c.map(LN),d=c.map(g=>g.map(v=>v-n)).map(LN),p=a.map(g=>{if(g>s)return;let v=e?.[g]?.drawPositions??[];return Ra(v,v.length/o)}).filter(Boolean),h=yt(0,o).map(g=>p.map(v=>v[g]).flat().filter(Boolean).sort(ea)).map(g=>yi(g)),f=h.map(g=>oje(g).map(LN).join(", ")),m=Object.assign({},...yt(0,o).map(g=>({[g+1]:{firstRoundDrawPositionsRange:u[g],firstRoundOffsetDrawPositionsRange:d[g],possibleDrawPositions:h[g],drawPositionsRange:f[g]}})));return{[s]:m}}))}}function G5({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],t=t??vo({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find(({drawPosition:a})=>a)||!!r?.find(({drawPositions:a})=>a?.length);return(!e?.drawType||e.drawType!==Hy)&&!i?.structures&&t&&n}function xo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!e?.find(n=>n?.roundPosition),r=!!e?.find(n=>n?.drawPositions?.length);return!t?.structures&&t?.stage!==$a&&(!e.length||!i&&!r)}var H5={[tm]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Dt]:"",[wn]:"P",[zt]:"Q",[ws]:"C"}}},HHe=H5;function Ave({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=vo({matchUps:r}),{structureAbbreviation:s,stage:o}=i,l=xo({structure:i}),c=G5({structure:i}),u=i.structures,d={},p=H5[tm],h=i.stage===zt,f=h?Math.max(...(e?.structures??[]).filter(R=>R.stage===zt).map(({stageSequence:R})=>R??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(t?.affixes?.preQualifying||p.affixes.preQualifying)||"",v=t?.roundNamingMap||p.roundNamingMap||{},y=t?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},b=t?.affixes?.preFeedRound||p.affixes.preFeedRound,I=t?.affixes?.roundNumber||p.affixes.roundNumber,w=(t?.namingConventions||p.namingConventions).round,T=o&&o!==Dt?o[0]:"",S=t?.stageConstants||p.stageConstants,D=o&&S?.[o]||T,C=`${g}${D}${m}`,E=n?Object.keys(n):[],P=h&&S?.[zt]?`${S?.[zt]}-`:"";if(u||l||c)Object.assign(d,...E.map(R=>{let M=`${P}${w} ${R}`,A=`${I}${R}`;return{[R]:{roundName:M,abbreviatedRoundName:A}}}));else{let R=h&&(t?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...E.map(M=>{if(!n?.[M])return;let{matchUpsCount:A,preFeedRound:N}=n[M],k=A*2,x=R?.[n?.[M].finishingRound]||R&&`${I}${k}`||v[A]||`${I}${k}`,O=N?`-${b}`:"",V=`${x}${O}`,F=[C,s,V].filter(Boolean).join("-"),j=`${y[A]||`${I}${k}`}${O}`,q=[C,s,j].filter(Boolean).join("-");return{[M]:{abbreviatedRoundName:q,roundName:F}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var zHe=(t,e)=>(t||0)+(e||0);function _ve(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Pve||i<=e[CC]&&CC||i<=e[PC]&&PC||B5}function kve({score:t}){let e=t?.sets||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(zHe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function qHe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Ove(t){return t.map(qHe).sort().map(e=>parseFloat(e.toFixed(2)))}function l0({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:ko};let{score:r,winningSide:n}=i;if(!n)return{error:Se};let a=!e&&t&&Yy({policyType:Cf,tournamentRecord:t}).policy,s=e||a?.profileBands||$5[Cf].profileBands,o=kve({score:r}),l=Ove([o]),c=_ve(l,s),u=Array.isArray(l)?l[0]:l;return{...oe,competitiveness:c,pctSpread:u}}function xve({matchUp:t}){if(!t)return{error:ko};if(t&&!t.sides)return{error:al};if(t&&!t.hasContext)return{error:Qx};let e=(t.sides??[])?.map(s=>s?.participantId).filter(Boolean),i=t.sides?.filter(s=>s.participant?.participantType===Bi).map(s=>s.participantId).filter(Boolean)??[],r=((t.sides??[])?.map(s=>s.participant?.individualParticipants).filter(Boolean)??[]).map(s=>(s??[]).map(o=>o?.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=yi(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...oe}}var y_="CHECK_IN",b_="CHECK_OUT",WHe="SCHEDULE",Pw="SCHEDULE.ASSIGNMENT.VENUE",zh="SCHEDULE.ALLOCATION.COURTS",Ug="SCHEDULE.ASSIGNMENT.COURT",kL="SCHEDULE.COURT.ORDER",Cw="SCHEDULE.DATE",YHe="COMPLETED.DATE",z5="HOME_PARTICIPANT_ID",q5="SCHEDULE.ASSIGN.OFFICIAL",Rw="SCHEDULE.TIME.SCHEDULED",pd="SCHEDULE.TIME.START",xf="SCHEDULE.TIME.STOP",vh="SCHEDULE.TIME.RESUME",sm="SCHEDULE.TIME.END",OL="SCHEDULE.TIME.MODIFIERS",Lve="TO_BE_ANNOUNCED",Fve="NEXT_AVAILABLE",Bve="FOLLOWED_BY",$ve="AFTER_REST",Vve="RAIN_DELAY",KHe="NOT_BEFORE",fj=[Lve,Fve,Bve,$ve,Vve],ZHe="ELIGIBILITY",XHe="REGISTRATION",JHe="SUSPENSION",QHe="MEDICAL",eze="PENALTY",jve="SCALE",Gve="RATING",Hve="RANKING",W5="SEEDING",Xg="PUBLISH",yc="PUBLIC",Jg="STATUS",tze="MODIFICATION",ize="RETRIEVAL",rze="other",nze={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:fj,AFTER_REST:$ve,ALLOCATE_COURTS:zh,ASSIGN_COURT:Ug,ASSIGN_OFFICIAL:q5,ASSIGN_VENUE:Pw,CHECK_IN:y_,CHECK_OUT:b_,COMPLETED_DATE:YHe,COURT_ORDER:kL,ELIGIBILITY:ZHe,END_TIME:sm,FOLLOWED_BY:Bve,MEDICAL:QHe,MODIFICATION:tze,NEXT_AVAILABLE:Fve,NOT_BEFORE:KHe,OTHER:rze,PENALTY:eze,PUBLIC:yc,PUBLISH:Xg,RANKING:Hve,RATING:Gve,RAIN_DELAY:Vve,REGISTRATION:XHe,RESUME_TIME:vh,RETRIEVAL:ize,SCALE:jve,SCHEDULE:WHe,SCHEDULED_DATE:Cw,SCHEDULED_TIME:Rw,SEEDING:W5,START_TIME:pd,STATUS:Jg,STOP_TIME:xf,SUSPENSION:JHe,TIME_MODIFIERS:OL,TO_BE_ANNOUNCED:Lve};function Mw({matchUp:t}){if(!t)return{error:ko};if(!t.hasContext)return{error:Qx};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:al};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=xve({matchUp:t}),n=(t.timeItems??[]).filter(o=>o?.itemType&&[y_,b_].includes(o.itemType)).sort((o,l)=>(o.createdAt?new Date(o.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(o=>o.itemValue).filter(o=>n.filter(l=>l?.itemValue===o).reverse()[0].itemType===y_);e?.forEach((o,l)=>{let c=r?.[l],u=o?.length&&o.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r?.forEach((o,l)=>{a.includes(o)&&(e?.[l]??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let s=r?.reduce((o,l)=>a.includes(l)&&o,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:s,checkedInParticipantIds:a,...oe}}var On=t=>e=>{let i=qi(e)&&e?.matchUpType||Yr(e)&&e;return i&&dfe[t].includes(i)};function iP(t){let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=e?.map(({matchUpFormatCodes:a})=>a?.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>(a?.length||0)-(s?.length||0))||[],n=r.includes(i)?i:r[0];return e?.find(({matchUpFormatCodes:a,averageTimes:s})=>a?.find(o=>n===o)&&s)?.averageTimes}function rP(t){let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return e?.find(({matchUpFormatCodes:n,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:o=0,lessThan:l=360}=a;if(i>o&&i<l)return!0}return n?.find(o=>o===r)&&s})?.recoveryTimes}function zve({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>(a.categoryNames?.length||0)-(n.categoryNames?.length||0)).find(({categoryTypes:n,categoryNames:a})=>!a?.length&&!n?.length||a?.includes(e)||n?.includes(i))).find(Boolean)}function aze({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:s,policy:o}){let l=e?.matchUpRecoveryTimes&&rP({...e,averageMinutes:i,matchUpFormat:n}),c=t?.matchUpRecoveryTimes&&rP({...t,averageMinutes:i,matchUpFormat:n}),u=o?.matchUpRecoveryTimes&&rP({...o,averageMinutes:i,matchUpFormat:n}),d=[l,c,u,o?.defaultTimes?.recoveryTimes,r?.recoveryTimes];return zve({categoryName:a,categoryType:s,timesBlockArray:d})}function sze({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:s}){let o=a?.matchUpAverageTimes&&iP({...a,matchUpFormat:t}),l=n?.matchUpAverageTimes&&iP({...n,matchUpFormat:t}),c=s?.matchUpAverageTimes&&iP({...s,matchUpFormat:t}),u=[o,l,c,s?.defaultTimes?.averageTimes,r?.averageTimes];return zve({categoryName:e,categoryType:i,timesBlockArray:u})}var qve="DOUBLES_SINGLES",Wve="SINGLES_DOUBLES",xu="total",mj="participantConflict",Wm="matchUpConflict",Yve="ISSUE_IDS",vv="CONFLICT",yv="WARNING",gj="ERROR",vj="ISSUE",FN="STATE",oze={SINGLES_DOUBLES:Wve,DOUBLES_SINGLES:qve,TOTAL:xu,CONFLICT_MATCHUP_ORDER:Wm,CONFLICT_PARTICIPANTS:mj,SCHEDULE_ISSUE_IDS:Yve,SCHEDULE_CONFLICT:vv,SCHEDULE_WARNING:yv,SCHEDULE_ERROR:gj,SCHEDULE_ISSUE:vj,SCHEDULE_STATE:FN};function c0({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}){if(!i)return{error:et};s=s??o?.eventType??II;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=e0({tournamentRecord:i,categoryName:n,categoryType:a,event:o}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return xL({eventType:s,timingDetails:u})}function xL({timingDetails:t,eventType:e}){let i=sze(t),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(e)&&i.minutes[e]||i.minutes.default),a=aze({...t,averageMinutes:n}),s=Object.keys(a?.minutes||{}),o=a?.minutes&&(s?.includes(e)&&a.minutes[e]||a.minutes.default),l=On(II)(e)?Wve:qve,c=a?.minutes&&(s?.includes(l)&&a.minutes[l]||o);return{averageMinutes:n,recoveryMinutes:o,typeChangeRecoveryMinutes:c}}function aB(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Xy({timeItems:t,itemType:e}){let i=t.filter(n=>n&&n.itemType===e).sort((n,a)=>aB(n)-aB(a)).pop(),r=i&&aB(i);return{itemValue:i?.itemValue,timeStamp:r}}function Kve({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:Rw});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledTime:r}:e}function Nw({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:Cw});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{scheduledDate:r}:e}function fb(t){if(qme.test(t)){let e=K4();return new Date(`${e}T${t}`)}else return new Date(t)}function lze({matchUp:t}){if(!t)return{error:ko};if(!t.timeItems)return{error:L4};let e=t.timeItems.filter(r=>[pd,xf,vh,sm].includes(r?.itemType)).sort((r,n)=>fb(r.itemValue).getTime()-fb(n.itemValue).getTime()),i=e.reduce((r,n)=>{let a,s=n?.itemType?.split("."),o=`SCHEDULE.TIME.${n?.itemType?.startsWith("SCHEDULE.TIME")&&s[2]}`;switch(o){case pd:a=0;break;case sm:if(r.lastValue&&[pd,vh].includes(r.lastType)){let l=fb(n.itemValue).getTime()-fb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;case xf:if([pd,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let l=fb(n.itemValue).getTime()-fb(r.lastValue).getTime();a=r.milliseconds+l}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:o,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([pd,vh].includes(i.lastType)){let r=new Date().getTime()-fb(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:cze(i.milliseconds),relevantTimeItems:e}}function cze(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function uze({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:e.reduce((r,n)=>{let a=n.itemType===pd&&n;return a&&(!r||i(a)<i(r))?a:r},void 0)?.itemValue}}function u0(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:Se};let n=Qc(t);i.venueId||(i.venueId=lr());let a;for(let s of Object.values(n)){let o=dze({disableNotice:!0,tournamentRecord:s,context:r,venue:i});if(o?.error)return o;a=o.venue}return e||Ii({topic:fve,payload:{venue:i}}),Ft({...oe,venue:a})}function dze({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=lr()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:fme}:(i&&nr({element:r,extension:{value:i,name:Jge}}),t.venues.push(r),{...oe,venue:Et(r)})):{error:Yt,info:"missing venue"}:{error:et}}function rf({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:et};if(!i)return{error:qg};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(ZR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let s=t[a],o=rf({tournamentRecord:s,venueId:i});if(o.success&&o.venue)return u0({tournamentRecord:e,venue:o.venue}),{...oe,venue:r}}}return r?{...oe,venue:r}:{error:yw}}function Y5({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=rf({tournamentRecords:i,tournamentRecord:r,venueId:n});return Et(a,t,!0)}function Aw({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:et};if(!i)return{error:mw};let r="findCourt",n,a;if((e.venues??[]).forEach(s=>{(s.courts??[]).forEach(o=>{o.courtId===i&&(n=o,a=s)})}),n)return{...oe,court:n,venue:a};if(t){let s=(ZR({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of s){let l=t[o],c=Aw({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&u0({tournamentRecord:e,venue:c.venue}),{...oe,court:n,venue:a}}}return ue({result:{error:bD},stack:r})}function K5(t){return Et(Aw(t),!1,!0)}function LL({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:et};if(!i)return{error:mw};let r=Aw({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:s,courtName:o,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(r.court);return{...oe,courtInfo:Et(n,!1,e)}}function aU(t){let e=Gt(t,[{[pa]:!0},{venueId:!0,[ku]:qg}]);if(e.error)return e;let{tournamentRecord:i,venueId:r}=t,n=rf({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map(l=>(({courtInfo:c})=>({...c}))(LL({courtId:l.courtId,internalUse:!0,tournamentRecord:i}))),s=n.venue&&(({venueId:l,venueName:c,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:c,venueId:l}))(n.venue),o=s&&{...s,courtsInfo:a};return{...oe,venueData:Et(o,!1,!0)}}function pze({matchUp:t}){let e=t?.timeItems||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:e.reduce((r,n)=>{let a=n.itemType===sm&&n;return a&&(!r||i(a)>i(r))?a:r},void 0)?.itemValue}}function Rn({event:t,eventId:e}){if(!t)return{error:Lr};let i=Ci({name:qu,element:t})?.extension,r=e?Et(i?.value,!1,!0):i?.value;return e&&t.drawDefinitions?.forEach(n=>{r?.flights?.forEach(a=>{a.drawId===n.drawId&&Object.assign(a,{drawDefinition:n})})}),{flightProfile:r}}function Lo(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},s=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},o=Object.values(s).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=o.find(d=>{let p=(d?.drawDefinitions??[]).find(h=>h.drawId===r);if(p)c=p,l=a[d.eventId].tournamentId;else{let h=(d&&Rn({event:d})?.flightProfile)?.flights?.find(f=>f.drawId===r);if(h)return l=a[d.eventId].tournamentId,{entries:h.drawEntries,drawName:h.drawName,tournamentId:l,drawId:r}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=o.find(u=>u?.eventId===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ue({result:{error:Vc},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ue({result:{error:lc},context:{drawId:r,eventId:i},stack:n})}}function FL(t){let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:s,scheduleTiming:o,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:ko};if(n&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let w=t.drawDefinition||e?.drawDefinitions?.find(S=>S.drawId===u.drawId);!w&&a&&({drawDefinition:w,event:e}=Lo({drawId:u.drawId,tournamentRecord:a}));let T=u.structureId&&w?.structures?.find(({structureId:S})=>S===u.structureId);i=t.matchUpType||T?.matchUpType||w?.matchUpType||e?.eventType!==ta&&e?.eventType}let{milliseconds:d,time:p}=lze({matchUp:u}),{startTime:h}=uze({matchUp:u}),{endTime:f}=pze({matchUp:u}),m,{eventIds:g,drawIds:v}=r??{};if((!g||g.includes(u.eventId))&&(!v||v.includes(u.drawId))){let w=ne=>ne.createdAt?new Date(ne.createdAt).getTime():0,T=new Map,S=u.timeItems?.toSorted((ne,le)=>w(ne)-w(le))??[];for(let ne of S)T.set(ne.itemType,ne.itemValue);let D=T.get(z5),C=T.get(zh),E=T.get(Rw),P=T.get(OL),R=T.get(Cw),M=T.get(q5),A=T.get(kL),N=T.get(Pw),k=T.get(Ug),x,O,V,F,j,q=u.matchUpType??i;if(o&&E&&n&&q){let ne={matchUpFormat:u.matchUpFormat??l,...o};({averageMinutes:O=0,recoveryMinutes:V=0,typeChangeRecoveryMinutes:F=0}=xL({timingDetails:ne,eventType:q})),(O||V)&&(x=f?Qo(zr(f),V):Qo(E,O+V)),F&&(j=f?Qo(zr(f),F):Qo(E,O+F))}!R&&E&&(R=Ui(E));let W=c_({scheduledDate:R,scheduledTime:E}),z={},H=(a&&N&&aU({tournamentRecord:a,venueId:N}))?.venueData||{};N&&(z[N]=H);let{venueName:Z,venueAbbreviation:J,courtsInfo:ie}=H,K=(k&&ie?.find(ne=>ne.courtId===k))?.courtName;for(let ne of C||[]){if(!a)break;ne.venueId&&!z[ne.venueid]&&(z[ne.venueId]=aU({venueId:ne.venueId,tournamentRecord:a})?.venueData);let le=z[ne.venueId];ne.venueName=le?.venueName;let re=le?.courtsInfo?.find(me=>me.courtId===ne.courtId);ne.courtName=re?.courtName}m=Ft({typeChangeTimeAfterRecovery:j,timeAfterRecovery:x,scheduledDate:R,scheduledTime:E,isoDateString:W,homeParticipantId:D,venueAbbreviation:J,allocatedCourts:C,timeModifiers:P,venueName:Z,venueId:N,courtOrder:A,courtName:K,courtId:k,official:M,typeChangeRecoveryMinutes:F,recoveryMinutes:V,averageMinutes:O,milliseconds:d,startTime:h,endTime:f,time:p})}else m=Ft({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:y}=Nw({matchUp:u}),{scheduledTime:b}=Kve({matchUp:u});if(s&&c?.displaySettings?.draws){let w=c.displaySettings.draws,T=(w?.[u.drawId]??w?.default)?.scheduleDetails;if(T){let S=(T.find(D=>y&&D.dates?.includes(y))??T.find(D=>!D.dates?.length))?.attributes;if(S){let D=Object.assign({},...Object.keys(m).map(C=>({[C]:!0})),S);m=SI({source:m,template:D})}}}let I=u.matchUpStatus&&la.includes(u.matchUpStatus)&&(Ui(f)||Ui(y)||Ui(b))||void 0;return{schedule:m,endDate:I}}function hze({drawPositions:t,roundProfile:e,roundNumber:i}){let r=[void 0,void 0];if(yfe(t))return{orderedDrawPositions:r,displayOrder:r};let n=e?.[i],a=n?.pairedDrawPositions?.find(o=>go(o||[],t.filter(Boolean)))??r,s=n?.feedRound;if(vfe(t)){let o=[...t].sort(ea);return{orderedDrawPositions:o.length===2?o:a,displayOrder:s?o:a}}if(s){let o=[t.find(l=>!isNaN(ri(l))),void 0];return{orderedDrawPositions:o,displayOrder:o}}return{orderedDrawPositions:a,displayOrder:a}}function I_({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=o=>o===void 0?-1:o,s=i.map(o=>{let{collectionAssignments:l,participantId:c}=o,u=l?.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((o,l)=>a(o.substitutionOrder)-a(l.substitutionOrder));for(let o of s){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=o;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Yu({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:et};if(!Array.isArray(i)||i.length>2)return{error:wl};if(!i.length)return ue({result:{error:zg},stack:r});t=t??e?.participants??[];let n=t.filter(o=>o.participantType===Ei&&En(i,o.individualParticipantIds).length===i.length&&o.individualParticipantIds.length===i.length),a=n[0];if(!a)return ue({result:{error:_n},stack:r});let s=Et(n.slice(1),!1,!0);return{participant:Et(a),duplicatedPairParticipants:s,...oe}}function my({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:At};if(typeof e!="string")return{error:oa};let{extension:i}=Ci({element:t,name:im});return{lineUp:(i?.value||{})[e]}}function fze({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:s,sideLineUps:o,matchUpType:l}){if(!s||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{let{assignedParticipantIds:f,substitutions:m}=I_({collectionPosition:i,collectionId:s,lineUp:p});if(l===mr){if(f?.length<=2){let g=n?.[f[0]]?.pairIdMap?.[f[1]],v=(g&&n[g]?.participant||Yu({participantIds:f,tournamentParticipants:t}).participant)?.participantId;return{[d]:{participantId:v,teamParticipant:h,substitutions:m}}}else if(f?.length>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let g=f?.[0];return g&&{[d]:{participantId:g,teamParticipant:h,substitutions:m}}}};if(!r?.length){let d=o?.map(p=>{let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||my({participantId:h.teamParticipantId,drawDefinition:a})?.lineUp;return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=r?.map(d=>{let p=e.find(g=>g.drawPosition===d)?.participantId,h=o?.find(g=>g?.drawPosition===d),f=h?.teamParticipant||p&&n?.[p]?.participant||t?.find(({participantId:g})=>g===p),m=h?.lineUp||my({participantId:p,drawDefinition:a})?.lineUp;return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function BL(t){let e=Gt(t,[{[ef]:!0}]);if(e.error)return e;let i=t?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let n=i.sides.find(({participant:a})=>a)?.participant?.participantType;r=n===Bi&&wr||n===Ei&&mr||n===hr&&hr||void 0}return{matchUpType:r}}function mze({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:s,sideNumber:o}){let l=i.find(h=>h.drawPosition&&h.drawPosition===a),c=a&&t,u=o&&e,d=c?c[a]?.participantId:l?.participantId,p=l?gze({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:o}):{...u?.[o]};if(s&&(o===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let h=c[a]?.teamParticipant,f=c[a]?.participant,m=c[a]?.substitutions;f&&(p.participant=f),m&&(p.substitutions=m),h&&(p.teamParticipant=h)}return p}function gze({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let s=vze({seedAssignments:e,participantId:i});Object.assign(a,s,{participantId:i}),s?.seedNumber&&s?.seedValue===""&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function vze({seedAssignments:t,participantId:e}){return t?.find(i=>!i.seedProxy&&i.participantId===e)}function Zve({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:s,initialRoundOfPlay:o,additionalContext:l,roundNamingProfile:c,tournamentRecord:u,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:h,seedAssignments:f,usePublishState:m,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,publishStatus:w,scoringActive:T,matchUpTieId:S,isRoundRobin:D,roundProfile:C,sideLineUps:E,structure:P,context:R,matchUp:M,event:A}){l=l??{};let N=Zs({drawDefinition:I,structure:P,matchUp:M,event:A})?.tieFormat,{roundOffset:k,structureId:x,structureName:O,stage:V,stageSequence:F}=P,{drawId:j,drawName:q,drawType:W}=I??{},z=N?.collectionDefinitions,H=M.collectionId&&z?.find(ve=>ve.collectionId===M.collectionId),Z=M.collectionId?H?.matchUpFormat:M.matchUpFormat??P?.matchUpFormat??I?.matchUpFormat??A?.matchUpFormat,J=M.matchUpType||H?.matchUpType||P?.matchUpType||I?.matchUpType||!On(ta)(A?.eventType)&&A?.eventType,ie=h?"BYE":M.matchUpStatus,{schedule:K,endDate:ne}=FL({scheduleVisibilityFilters:t,afterRecoveryTimes:s,tournamentRecord:u,usePublishState:m,scheduleTiming:y,drawDefinition:I,matchUpFormat:Z,publishStatus:w,matchUpType:J,matchUp:M,event:A}),le=d??M.drawPositions??[],{collectionPosition:re,collectionId:me,roundPosition:he}=M,Ie=M.roundNumber??l.roundNumber,Le=me?fze({tournamentParticipants:i,positionAssignments:r,collectionPosition:re,participantMap:g,drawDefinition:I,drawPositions:le,collectionId:me,sideLineUps:E,matchUpType:J}):void 0,ot=c?.[Ie]?.roundName||l.roundName,at=c?.[Ie]?.abbreviatedRoundName||l.abbreviatedRoundName,dt=C?.[Ie]?.feedRound,It=C?.[Ie]?.preFeedRound,ze=C?.[Ie]?.roundFactor,Ct=n?.[Ie],ke=he?Ct?.[he]:void 0,mt=e?.[Ie],Be=H?.category?{...R?.category||{},...H.category}:R?.category??A?.category,ut=M.processCodes?.length&&M.processCodes||H?.processCodes?.length&&H?.processCodes||P?.processCodes?.length&&P?.processCodes||I?.processCodes?.length&&I?.processCodes||A?.processCodes?.length&&A?.processCodes||u?.processCodes,it=b?.withCompetitiveness&&l0({...v,matchUp:M}),xe=M.finishingPositionRange??l.finishingPositionRange,Ze=V!==zt&&mi(o)&&o+(Ie||0),st=ve=>Ft(ve,void 0,!0),qe={...st(R),...st({matchUpFormat:J===ta?void 0:Z,tieFormat:J!==ta?void 0:N,gender:H?.gender??A?.gender,endDate:M.endDate??ne,discipline:A?.discipline,category:Be,finishingPositionRange:xe,abbreviatedRoundName:at,drawPositionsRange:ke,competitiveProfile:it,structureName:O,stageSequence:F,drawPositions:le,matchUpStatus:ie,processCodes:ut,isRoundRobin:D,matchUpTieId:S,preFeedRound:It,matchUpType:J,roundFactor:ze,roundOffset:k,structureId:x,roundNumber:Ie,roundOfPlay:Ze,feedRound:dt,roundName:ot,drawName:q,drawType:W,schedule:K,drawId:j,stage:V}),...Et(st(M),!0,!0)};if(Z&&M.score?.scoreStringSide1){let ve=js(Z),{bestOf:$e,finalSetFormat:De,setFormat:je}=ve??{};(De?.tiebreakSet||je?.tiebreakSet||je?.timed)&&(qe.score.sets=qe.score.sets.sort((Oe,nt)=>Oe.setNumber-nt.setNumber).map((Oe,nt)=>(nt+1===$e?(De?.tiebreakSet||De?.timed)&&(Oe.tiebreakSet=!0):(je?.tiebreakSet||je?.timed)&&(Oe.tiebreakSet=!0),Oe.tiebreakSet&&[1,2].includes(Oe.winningSide)&&(Oe.side1Score=Oe.winningSide===1?1:0,Oe.side2Score=Oe.winningSide===2?1:0),Oe)))}if(Array.isArray(le)){let{orderedDrawPositions:ve,displayOrder:$e}=hze({drawPositions:le,roundProfile:C,roundNumber:Ie}),De=C?.[Ie]?.feedRound,je=$e[0]!==ve[0],Oe=ve.concat(void 0,void 0).slice(0,2).map((nt,Fe)=>{let wt=Fe+1,pt=je?3-wt:wt,Mt=mze({...Le,positionAssignments:r,displaySideNumber:pt,seedAssignments:f,drawPosition:nt,isFeedRound:De,sideNumber:wt}),Wi=M.sides?.find(Vi=>Vi.sideNumber===wt),Qt=he?(he-1)*2+Fe+1:void 0,tr=Qt?mt?.[Qt]:void 0;return st({sourceDrawPositionRange:tr,...Wi,...Mt})});Object.assign(qe,Et({sides:Oe},!0,!0))}if(i&&qe.sides){let ve=p?.[DD],$e=De=>{let je=g?.[De]?.participant;return je&&SI({template:ve?.participant,source:je})};if(qe.sides.filter(Boolean).forEach(De=>{if(De.participantId){let je=Et($e(De.participantId)||(i?bg({policyDefinitions:p,participantId:De.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:b}):void 0),void 0,!0);if(je){let Oe,nt;if(I?.entries){let Fe=I.entries.find(pt=>pt.participantId===De.participantId),wt=A?.entries?.find(pt=>pt.participantId===De.participantId);Oe=Fe?.entryStatus||wt?.entryStatus,je.entryStatus=Oe,Fe?.entryStage&&(nt=Fe.entryStage,je.entryStage=nt)}a===!1?Object.assign(De,{participant:{entryStage:nt,entryStatus:Oe}}):Object.assign(De,{participant:je})}}if(De?.participant?.individualParticipantIds?.length&&!De.participant.individualParticipants?.length){let je=De.participant.individualParticipantIds.map(Oe=>$e(Oe)||(i?bg({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:b,participantId:Oe}):void 0));a!==!1&&Object.assign(De.participant,{individualParticipants:je})}}),!qe.matchUpType){let{matchUpType:De}=BL({matchUp:qe});De&&Object.assign(qe,{matchUpType:De})}if(b?.inferGender&&(!qe.gender||qe.gender===ww)&&qe.sides?.length===2&&qe.matchUpType!==ta){let De=qe.sides.map(je=>{if(On(wr)(qe.matchUpType))return je.participant?.person?.sex;if(je.participant?.individualParticipants?.length===2){let Oe=yi(je.participant.individualParticipants.map(nt=>nt.person?.sex)).filter(Boolean);if(Oe.length===1)return Oe[0]}});if(De.filter(Boolean).length===2&&yi(De).length===1){let je=De[0];qe.inferredGender=je}}}if(qe.tieMatchUps){let ve=qe.matchUpStatus==="BYE",$e=qe.sides?.map(({participant:De,drawPosition:je,sideNumber:Oe,lineUp:nt})=>{let Fe=De?.participantType===ta&&De;return{teamParticipant:Fe&&Ft({participantRoleResponsibilities:Fe.participantRoleResponsibilities,participantOtherName:Fe.participanOthertName,participantName:Fe.participantName,participantId:Fe.participantId,teamId:Fe.teamId}),drawPosition:je,sideNumber:Oe,lineUp:nt}});qe.tieMatchUps=qe.tieMatchUps.map(De=>{let je=qe.matchUpId,Oe={finishingPositionRange:qe.finishingPositionRange,abbreviatedRoundName:at,roundNumber:Ie,roundName:ot};return Zve({tieDrawPositions:le,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:$e,drawPositionsRanges:n,initialRoundOfPlay:o,roundNamingProfile:c,additionalContext:Oe,appliedPolicies:p,isCollectionBye:ve,usePublishState:m,publishStatus:w,matchUpTieId:je,isRoundRobin:D,roundProfile:C,matchUp:De,event:A,tournamentParticipants:i,positionAssignments:r,tournamentRecord:u,seedAssignments:f,participantMap:g,contextContent:v,scheduleTiming:y,contextProfile:b,drawDefinition:I,scoringActive:T,structure:P,context:R})})}let ft=qe.sides?.filter(ve=>ve?.participantId).length===2,_t=!qe.winningSide;if(Object.assign(qe,{readyToScore:T&&ft&&_t,hasContext:!0}),ft){let{allParticipantsCheckedIn:ve,checkedInParticipantIds:$e}=Mw({matchUp:qe});Object.assign(qe,{allParticipantsCheckedIn:ve,checkedInParticipantIds:$e})}return Array.isArray(b?.exclude)&&b?.exclude.forEach(ve=>delete qe[ve]),qe}function yze({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:zh});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{allocatedCourts:Et(r,!1,!0)}:e}function bze({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:Ug});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{courtId:r}:e}function Ize({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:Pw});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{venueId:r}:e}function Rf(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:s,matchUpFormats:o,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:h,roundNames:f,filterMatchUpTypes:m=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:y,scheduledDate:b,participantIds:I,processContext:w,tournamentIds:T,matchUpTypes:S,structureIds:D,readyToScore:C,courtIds:E,eventIds:P,venueIds:R,drawIds:M,stages:A}=t,N=Array.isArray(I)?I.filter(Boolean):[],k=Array.isArray(a)?a.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(A)?A.filter(Boolean):[],V=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],j=Array.isArray(f)?f.filter(Boolean):[],q=Array.isArray(p)?p.filter(Boolean):[],W=Array.isArray(l)?l.filter(Boolean):[],z=Array.isArray(h)&&g?h.filter(Boolean):[],H=Array.isArray(S)&&m?S.filter(Boolean):[],Z=Array.isArray(E)?E.filter(Boolean):[],J=Array.isArray(R)?R.filter(Boolean):[],ie=Array.isArray(o)&&o.filter(Boolean)||typeof c=="string"&&[c]||[],K=Array.isArray(y)&&y.filter(Boolean)||typeof b=="string"&&b.length&&[b]||[],ne=Array.isArray(T)?T.filter(Boolean):[],le=Array.isArray(P)?P.filter(Boolean):[],re=Array.isArray(M)?M.filter(Boolean):[],me=Array.isArray(D)?D.filter(Boolean):[];return e.filter(he=>{if(C&&!On(oc)(he)&&!he.readyToScore||he.winningSide&&s&&![1,2].includes(he.winningSide)||d!==void 0&&(d&&!he.tieMatchUps||!d&&he.tieMatchUps)||n!==void 0&&(n&&!he.collectionId||!n&&he.collectionId)||O.length&&!O.includes(he.stage)||V.length&&!V.includes(he.stageSequence)||F.length&&(!he.collectionId||!F.includes(he.collectionId))||j.length&&(!he.roundName||!j.includes(he.roundName))||q.length&&(!he.roundNumber||!q.includes(he.roundNumber))||W.length&&(!he.roundPosition||!W.includes(he.roundPosition))||k.length&&(!he.matchUpStatus||!k.includes(he.matchUpStatus))||x.length&&he.matchUpStatus&&x.includes(he.matchUpStatus)||z.length&&!z.includes(he.matchUpId)||H.length&&(!he.matchUpType||!Hx(H,he.matchUpType))||ie.length&&(!he.matchUpFormat||!ie.includes(he.matchUpFormat)))return!1;if(K?.length){let{scheduledTime:Ie}=Kve({matchUp:he}),{scheduledDate:Le}=Nw({matchUp:he}),ot=Ui(Ie)||Le;if(!K.find(at=>Lh(at,ot)))return!1}if(Z.length){let{courtId:Ie}=bze({matchUp:he}),{allocatedCourts:Le}=yze({matchUp:he}),ot=Le?.map(({courtId:at})=>at);if(!Z.filter(Boolean).includes(Ie)||ot?.includes(Ie))return!1}if(J.length){let{venueId:Ie}=Ize({matchUp:he});if(!J.filter(Boolean).includes(Ie))return!1}if(w){if(ne.length&&!ne.includes(he.tournamentId)||le.length&&!le.includes(he.eventId)||re.length&&!re.includes(he.drawId)||me.length&&!me.includes(he.structureId))return!1;let Ie=he.sides?.map(({participantId:Le})=>Le).filter(Boolean)??[];if(r&&Ie.length<r||N.length&&!N.some(Le=>Ie.includes(Le)))return!1}return!0})}function ar(t){let{provisionalPositioning:e,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:s,context:o={},structure:l,inContext:c,event:u}=t,{seedAssignments:d,contextContent:p,exitProfiles:h,matchUpsMap:f}=t,m={},g={};if(!l)return{collectionPositionMatchUps:m,error:jy,roundMatchUps:g,matchUps:[]};let v=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],y=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],b=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],I=!o?.eventId||!v?.length&&!r?.eventIds?.filter(Boolean).length||v?.includes(o.eventId)||r?.eventIds?.includes(o.eventId),w=!y?.length||y.includes(l.structureId),T=!s||!b?.length||b.includes(s.drawId);if(!I||!w||!T)return{collectionPositionMatchUps:m,roundMatchUps:g,matchUps:[]};a&&!p&&(p=Dm({tournamentRecord:i,contextProfile:a,drawDefinition:s}));let{appliedPolicies:S}=er({drawDefinition:s}),D={...t.tournamentAppliedPolicies,...S,...t.policyDefinitions},C=D?.scoring?.structures,E=l.stage&&C?.stage?.[l.stage],P=l.stageSequence&&E?.stageSequence?.[l.stageSequence],R=D?.scoring?.requireAllPositionsAssigned||E?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned;f||(f=rs({drawDefinition:s,structure:l}));let{positionAssignments:M,allPositionsAssigned:A}=ca({structure:l}),N=!R||A,{seedAssignments:k}=Hc({provisionalPositioning:e,drawDefinition:s,structure:l});d=d??k;let{structureId:x}=l;h=h||s&&Nve({drawDefinition:s}).exitProfiles;let O=h?.[x],V=O?.length&&(O[0].split("-").map(Z=>parseInt(Z)).reduce((Z,J)=>Z+J)||0),F=!!l.structures,j=Tg({matchUpsMap:f,structureId:x,inContext:c}),q=D?.[tm],W=Ave({roundNamingPolicy:q,drawDefinition:s,structure:l,matchUps:j}),{roundNamingProfile:z,roundProfile:H}=W;if(g=W?.roundMatchUps??[],n&&(j=Rf({matchUps:j,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),c){let{sourceDrawPositionRanges:Z}=jHe({drawDefinition:s,matchUpsMap:f,structureId:x}),J=s?GHe({drawDefinition:s,roundProfile:H,matchUpsMap:f,structureId:x}).drawPositionsRanges:void 0,ie=t.tournamentParticipants,K=t.participantMap;!ie?.length&&!K&&i&&({participants:ie=[],participantMap:K}=Wy({participantsProfile:t.participantsProfile,useParticipantMap:t.useParticipantMap,policyDefinitions:t.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:c})),j=j.map(ne=>Zve({scheduleVisibilityFilters:t.scheduleVisibilityFilters,hydrateParticipants:t.hydrateParticipants,afterRecoveryTimes:t.afterRecoveryTimes,usePublishState:t.usePublishState,scheduleTiming:t.scheduleTiming,publishStatus:t.publishStatus,sourceDrawPositionRanges:Z,tournamentParticipants:ie,positionAssignments:M,drawPositionsRanges:J,initialRoundOfPlay:V,roundNamingProfile:z,tournamentRecord:i,appliedPolicies:D,seedAssignments:d,contextContent:p,participantMap:K,contextProfile:a,drawDefinition:s,scoringActive:N,isRoundRobin:F,roundProfile:H,structure:l,context:o,matchUp:ne,event:u})),(j?.filter(ne=>Array.isArray(ne.tieMatchUps))).forEach(ne=>{let le=ne.tieMatchUps;j=j.concat(...le)}),r&&(j=Rf({processContext:!0,...r,matchUps:j}))}else(j?.filter(Z=>Array.isArray(Z.tieMatchUps))).forEach(Z=>{let J=Z.tieMatchUps;j=j.concat(...J)});return n&&(j=Rf({matchUps:j,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(j=Rf({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:j})),(n?.matchUpTypes||n?.matchUpIds||c)&&(g=vo({matchUps:j}).roundMatchUps??[]),Zs({drawDefinition:s,structure:l,event:u})?.tieFormat&&({collectionPositionMatchUps:m}=VHe({matchUps:j})),{collectionPositionMatchUps:m,roundMatchUps:g,isRoundRobin:F,roundProfile:H,matchUpsMap:f,matchUps:j}}function Vv({matchUp:t}){return t?la.includes(t?.matchUpStatus)||t?.winningSide:!1}function $L({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structureId:b,inContext:I,structure:w,context:T,event:S}){!w&&b&&({structure:w}=oi({drawDefinition:g,structureId:b}));let D=ar({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:o,usePublishState:l,matchUpFilters:c,contextFilters:u,contextContent:d,participantMap:p,scheduleTiming:h,publishStatus:f,contextProfile:m,drawDefinition:g,exitProfiles:v,matchUpsMap:y,structure:w,inContext:I,context:T,event:S}),C=[],E=[],P=[],R=[],M=[];if(D.error)return D;let{matchUps:A}=D,{assignedPositions:N}=ca({structure:w}),k=N?.filter(O=>O.participantId).map(O=>O.drawPosition),x;return A.filter(O=>{let V=c?.matchUpTypes?.length===1&&c.matchUpTypes[0]===kr;return!(O.matchUpType!==kr&&V)}).forEach(O=>{if(O.matchUpStatus===sl){C.push(O);return}O.matchUpType===kr&&(x=!0);let V=!!O.collectionId,F=V&&O.sides?.every(Z=>Z.participantId),j=!V&&O.drawPositions?.filter(Boolean).length===2,q=!V&&O.drawPositions?.every(Z=>k?.includes(Z)),W=N?.filter(Z=>Z.bye).map(Z=>Z.drawPosition),z=!V&&O.drawPositions?.find(Z=>W?.includes(Z)),H=dve.includes(O.matchUpStatus)&&(F||j&&(!t||q));return z?M.push(O):Vv({matchUp:O})?E.push(O):H?P.push(O):R.push(O)}),{includesTeamMatchUps:x,abandonedMatchUps:C,completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:R,byeMatchUps:M,structure:w}}function wze({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:At};if(!i)return{error:gc};let{links:r}=RD({drawDefinition:t,structureId:i}),n=r.source.reduce((s,o)=>!o.source.roundNumber||o.source.roundNumber===e?s.concat(o):s,[]),a=r.target.reduce((s,o)=>!o.target.roundNumber||o.target.roundNumber===e?s.concat(o):s,[]);return{links:{source:n,target:a}}}function sB({finishingPositions:t,linkCondition:e,linkType:i,source:r}){let n=r.find(a=>{let s=!a.source?.finishingPositions||!t||go(t,a.source?.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[Bh,$h].includes(n?.linkType)&&!n?.source?.roundNumber?ue({result:{error:Se},stack:"getTargetLink",context:n}):n}function RD({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>(n.source?.structureId===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),n.target?.structureId===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r),{source:[],target:[]})}:{error:gc}:{error:At}}function Sze({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(s=>s.roundNumber===i&&!s.matchUpTieId),a=t.filter(s=>s.roundNumber===i+1&&!s.matchUpTieId);if(a.length){let s;return a.length===n.length?s=a.find(o=>o.roundPosition===r):a.length===n.length/2&&(s=a.find(o=>o.roundPosition===Math.ceil(r/2))),{matchUp:s}}return{message:"no progression found"}}function oB({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:b4};let{target:{structureId:a,feedProfile:s,groupedOrder:o,roundNumber:l,positionInterleave:c}}=n,{structure:u}=oi({drawDefinition:r,structureId:a}),{positionAssignments:d}=Tr({structure:u}),p=(e?.filter(C=>C.structureId===u?.structureId)).filter(C=>C.roundNumber===l&&!C.matchUpTieId),h=p.length,f=yt(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c?.interleave&&m!==.5){let C=c.offset+(i-1)*c.interleave,E=i+C;g=Math.ceil(E/2),v=1-E%2}let y=f,b=f[g-1],I=Mve({roundPositionsCount:f.length,groupedOrder:o}),w=I?.length||1;if(w<=f.length){let C=h/w,E=Ra(f,C);s===dy&&E.forEach(P=>P.reverse()),y=I?.length&&I?.map(P=>E[P-1]).flat()||y}s===Uu?b=y[g-1]:s===dy?((!I?.length||w>f.length)&&(g=p.length+1-g),b=y[g-1]):s===pL&&cc()&&console.log(iL,{feedProfile:s});let T=b&&p.reduce((C,E)=>E.roundPosition===b?E:C,void 0),S;T?.feedRound?(v=0,S=Math.min(...(T.drawPositions||[]).filter(Boolean))):S=T?.drawPositions?.length===2&&T?.drawPositions[v];let D=d?.find(({drawPosition:C})=>C===S);if(D){let{extension:C}=Ci({element:D,name:TL});if(C?.value)return{disabledDrawPosition:S}}return{matchUp:T,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function yo({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(o=>o.matchUpId===n));let{structure:s}=oi({structureId:a?.structureId,drawDefinition:r});return s?.finishingPosition===Tw?Tze({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:s,matchUp:a}):Uze({matchUp:a})}function Tze({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:s}=n,{links:o}=wze({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=o?.source,c=sB({source:l,linkType:Bh}),u=sB({linkCondition:Dp,linkType:$h,source:l}),d=sB({source:l,linkType:$h}),p=u&&d;d||(d=u);let h=c?.target?.feedProfile,f=d?.target?.feedProfile,m=u?.target?.feedProfile,g,v,y,b,I,w,T,S,D,C;if(e&&(a||s)&&(T=a&&h!==dd&&t.find(({matchUpId:R})=>R===a),b=s&&f!==dd&&t.find(({matchUpId:R})=>R===s),T||b))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:T}};let{roundPosition:E}=n;C=C||t.filter(R=>R.structureId===r.structureId);let P=C.reduce((R,M)=>M.roundNumber===n.roundNumber&&!M.matchUpTieId?R+1:R,0);return d&&!b&&f!==dd&&({matchUpDrawPositionIndex:w,targetDrawPosition:I,matchUp:b}=oB({targetLink:d,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==dd&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=oB({targetLink:u,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),c&&!T&&h!==dd&&({matchUpDrawPositionIndex:D,targetDrawPosition:S,matchUp:T}=oB({targetLink:c,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),T||(C=C||t.filter(R=>R.structureId===r.structureId),{matchUp:T}=Sze({structureMatchUps:C,matchUp:n})),Ft({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:w,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:T,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||s)})}function Uze({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function Dze({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{let{matchUpId:n,structureId:a,drawPositions:s=[]}=r,{structure:o}=oi({drawDefinition:t,structureId:a});if(o?.finishingPosition===py){let{roundNumber:l}=r,c=l&&ri(l)+1,u=o.matchUps??[],{roundMatchUps:d}=vo({matchUps:u});if(c&&d?.[c]){let p=[...s].sort(ea).map((h,f)=>{let m=d[c].find(g=>g.drawPositions?.includes(h));return{matchUpId:m?.matchUpId,roundNumber:c,schedule:m?.schedule,sideNumber:f+1,structureName:o.structureName}});Object.assign(r,{sidesTo:p})}}else{let l=yo({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:c}=l.targetMatchUps,{loserMatchUp:u}=l.targetMatchUps;!r.winnerMatchUpId&&c&&(r.winnerMatchUpId=c.matchUpId),!r.loserMatchUpId&&u&&(r.loserMatchUpId=u.matchUpId);let d=lB({upcomingMatchUp:c}),p=lB({upcomingMatchUp:u});if(r.matchUpStatus!=="BYE"&&u?.matchUpStatus==="BYE"){let{matchUp:f}=Xve({matchUp:u,drawDefinition:t,inContextDrawMatchUps:e})||{};p=f&&lB({upcomingMatchUp:f})||p}let h=r.schedule?.timeAfterRecovery;if(h&&(d?.schedule?.scheduledTime&&Ji(d.schedule.scheduledTime)<Ji(h)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId),p?.schedule?.scheduledTime&&Ji(p.schedule.scheduledTime)<Ji(h)&&(i[p.matchUpId]=r.matchUpId,p.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:d,loserTo:p}),r.drawPositions?.filter(Boolean).length){let f=l.targetLinks?.loserTargetLink?.linkCondition===Dp,m=Eze(r);if(m.length){let g=uj(c?.sides),v=uj(u?.sides),y=m.find(({participantId:I})=>g.includes(I))?[]:m,b=m.find(({participantId:I})=>v.includes(I))?[]:m;u&&f&&b.length<2&&b.push({bye:!0,tbd:!0}),y?.length&&c&&(!l.targetMatchUpIds&&c&&(c=e.find(({matchUpId:I})=>I===c.matchUpId)),c.potentialParticipants||(c.potentialParticipants=[]),c.potentialParticipants.push(y)),b?.length&&u&&(l.targetMatchUpIds||(c=e.find(({matchUpId:I})=>I===u.matchUpId)),u.potentialParticipants||(u.potentialParticipants=[]),u.potentialParticipants.push(b))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Eze(t){return t?.sides?.map(({participant:e,participantId:i,qualifier:r})=>e||i&&{participantId:i}||r&&{qualifier:r}).filter(Boolean)||[]}function Xve({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||t?.matchUpStatus===Pn)return{matchUp:t};if(n==="BYE"){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:o})=>o===t.winnerMatchUpId):{winnerMatchUp:s}=yo({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r})?.targetMatchUps||{},Xve({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function lB(t){if(t?.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:s}))(t.upcomingMatchUp)}function qn(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=MD(t);if(i.error)return ue({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:s,byeMatchUps:o,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...s??[],...o??[]),matchUpsMap:l}}function MD(t){if(!t?.drawDefinition)return{error:At};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:s,participantsProfile:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:w,event:T}=t,S=[],D=[],C=[],E=[],P=[];v&&!i&&(i=Dm({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:T}));let R;!e?.length&&u&&(e=u?.participants,(I||o?.withGroupings)&&e?.length&&({participantsWithGroupings:e,groupInfo:R}=NL({participants:e,participantsProfile:o})));let{structures:M}=Wu({drawDefinition:y});if(!M)return{error:en};r||(r=rs({drawDefinition:y}));let A=y&&Nve({drawDefinition:y}).exitProfiles;M.forEach(x=>{let{byeMatchUps:O=[],pendingMatchUps:V=[],upcomingMatchUps:F=[],completedMatchUps:j=[],abandonedMatchUps:q=[]}=$L({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,hydrateParticipants:t.hydrateParticipants,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:A,matchUpsMap:r,structure:x,context:w,event:T});S=S.concat(...q),D=D.concat(...j),C=C.concat(...F),E=E.concat(...V),P=P.concat(...O)});let N=x=>(!h&&!b&&!p||(h&&(x=Rf({matchUps:x,...h})),p&&(x=Rf({matchUps:x,...p,processContext:!0}))),x),k={abandonedMatchUps:N(S),completedMatchUps:N(D),upcomingMatchUps:N(C),pendingMatchUps:N(E),byeMatchUps:N(P),matchUpsMap:r,...oe,groupInfo:R};if(b){let x=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:V,upcoming:F,pending:j,bye:q}=x,W=[].concat(...O&&S||[],...V&&D||[],...F&&C||[],...j&&E||[],...q&&P||[]);Dze({inContextDrawMatchUps:W,drawDefinition:y})}return k}function nf(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,inContext:g,context:v,event:y}=t;if(!y)return{error:Lr};let{eventId:b,eventName:I,endDate:w,eventType:T,category:S,gender:D,matchUpFormat:C}=y??{},E={...v,...Ft({indoorOutDoor:y.indoorOutdoor??u?.indoorOutdoor,surfaceCategory:y.surfaceCategory??u?.surfaceCategory,endDate:y.endDate??u?.endDate,tournamentId:u?.tournamentId,matchUpFormat:C,eventName:I,eventType:T,category:S,eventId:b,gender:D})};w&&(E.endDate=w),f&&!i&&(i=Dm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:y}));let P;if(!e?.length&&!r&&u){let A=Wy({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:g});r=A.participantMap,e=A.participants??[],P=A.groupInfo}let R=y.drawDefinitions??[],M=e0({tournamentRecord:u,event:y}).scheduleTiming;return{matchUps:R.flatMap(A=>{let{matchUps:N}=qn({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:E,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:A,contextContent:i,matchUpFilters:h,participantMap:r,scheduleTiming:M,nextMatchUps:m,inContext:g,event:y});return N??[]}),groupInfo:P}}function Wa(t){let e=Gt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!t?.tournamentRecord)return{error:et};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:s,useParticipantMap:o,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,usePublishState:d,contextProfile:p,matchUpFilters:h,contextFilters:f,nextMatchUps:m,context:g}=t,v=t.tournamentId??c.tournamentId,y=c?.events??[];r||({participants:r,participantMap:i}=Wy({participantsProfile:a,useParticipantMap:o,tournamentRecord:c,contextProfile:p,inContext:u}));let{appliedPolicies:b}=er({tournamentRecord:c}),I={...g,tournamentId:v,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},w=Dm({policyDefinitions:l,tournamentRecord:c,contextProfile:p});return{matchUps:y.flatMap(T=>(I.eventDrawsCount=T.drawDefinitions?.length??0,nf({context:I,scheduleVisibilityFilters:n,tournamentAppliedPolicies:b,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:w,contextFilters:f,contextProfile:p,matchUpFilters:h,participantMap:i,nextMatchUps:m,participants:r,inContext:u,event:T}).matchUps??[])).concat(...c.matchUps??[])}}function Cd({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}){if(typeof r!="object"||!Object.keys(r).length)return{error:hn};let u=Object.keys(r).map(d=>{let p=r[d];return Wa({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:p,usePublishState:a,matchUpFilters:s,contextFilters:o,nextMatchUps:l,inContext:c}).matchUps??[]}).flat();return{...oe,matchUps:u}}function _w(t,e){return Pze(t,e)||(t?.stageSequence||0)-(e?.stageSequence||0)||t?.roundNumber&&e.roundNumber&&t?.roundNumber-e?.roundNumber||(t?.roundPosition??0)-(e?.roundPosition??0)}function Pze(t,e){return(wI[t?.stage]||0)-(wI[e?.stage]||0)}function po(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:w,eventType:T,category:S,gender:D,matchUpFormat:C}=y??{},E={...v,surfaceCategory:y?.surfaceCategory??u?.surfaceCategory,indoorOutDoor:y?.indoorOutdoor??u?.indoorOutdoor,matchUpFormat:C,eventType:T,eventName:I,category:S,eventId:b,endDate:w,gender:D},P;return!e?.length&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=Wy({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!r&&(r=Dm({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...qn({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:r,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function qb({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Et(t),r=e.split("."),n=[],a;o({targetElement:i,attributes:r});let s={value:a};return n.length&&(s.values=n),s;function o({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l?.[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>o({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),n.includes(l[h])||n.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?n.includes(f)||n.push(f):(a=f,n.push(f))}}}}var Jve=t=>e=>!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(i=>({[i]:qb({element:e,accessor:i})?.value}))||typeof t=="object"&&Object.keys(t).map(i=>({[i]:qb({element:e,accessor:i})?.value}))||(typeof t=="string"&&qb({element:e,accessor:t}))?.value,xl=Jve;function d0({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:s,fmlc:o}){if(!iu(a))return[];let{roundProfile:l,roundNumbers:c=[]}=vo({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let u=n?r-n:0,d=u&&l?.[r-u]?.matchUpsCount,p=l&&Object.values(l).map(xl("matchUpsCount")),h=(g,v)=>{let y=Math.min(...g);d&&v&&y===1&&(y=d);let b=Math.max(...g);return e&&b>e&&(b=e),[y,b]},f=l&&Object.assign({},...c.map(g=>{let v=(r??0)+1-g-u,y=l[g].matchUpsCount,b={finishingPositionRange:{},finishingRound:v},I=p?.slice(g-1).reduce((R,M)=>R+(M||0),0),w=o&&g!==1,T=1+t+(w?i??0:0),S=1,D=yt(T,s?T+y*2:I+T+S),C=I+S-y,E=h(D.slice(C)),P=h(D.slice(0,C),!0);return b.finishingPositionRange={loser:E,winner:P},{[g]:b}})),m=cc({finishingRound:!0});return a.filter(Boolean).forEach(g=>{let v=g.roundNumber&&f[g.roundNumber];m&&!v&&console.log({roundFinishingData:f,matchUp:g}),g.finishingRound=v?.finishingRound,g.finishingPositionRange=v?.finishingPositionRange}),a}function gy({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){if(!e)return{error:At};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=qn({inContext:!0,drawDefinition:e,matchUpsMap:i})),!i?.drawMatchUps.some(n=>n.finishingPositionRange)&&e?.structures?.length===1&&!e?.structures[0].structures){let n=i?.drawMatchUps??[];d0({matchUps:n})}return(t??[]).filter(({collectionId:n})=>!n).forEach(n=>{let{matchUpId:a,structureId:s}=n,o=yo({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:c}=o.targetMatchUps,u=l?.matchUpId,d=c?.matchUpId,p=Tg({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===a);if(p&&(u&&(r.winnerMatchUpIds[p.matchUpId]=u,Object.assign(p,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(r.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let h=c.finishingPositionRange&&[...n.finishingPositionRange.loser,...c.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];n.finishingPositionRange.loser=f,p.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function id(t){let e=Qc(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(i))return{error:wm};if(!Array.isArray(r))return{error:Nd};let o=t.matchUpIds?.length?t.matchUpIds:i.map(y=>y.matchUpId);if(!Array.isArray(o))return{error:fw};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((y,b)=>y.concat(b.events??[]).map(I=>(I.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:y})=>y===Fh),f=i;if(h.length){f=Cd({nextMatchUps:!0,tournamentRecords:e}).matchUps;let y=h.reduce((b,I)=>{let w=I.source?.structureId,T=I.target?.structureId;return w&&T&&(u[T]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of y)l[b]=[];for(let b of f??[]){let I=b.containerStructureId||b.structureId;y.includes(I)&&l[I].push(b.matchUpId)}}let m=y=>{c[y]||(c[y]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[y]=[])},g=(y,b)=>{c[y].matchUpIds.forEach(I=>{c[b].matchUpIds.push(I)}),c[b].matchUpIds.push(y),c[y].dependentMatchUpIds.push(b),n&&c[y].participantIds.forEach(I=>c[b].participantIds.push(I))},v=y=>{let b=Object.keys(l).length;for(let I of y||[]){let{matchUpId:w,winnerMatchUpId:T,loserMatchUpId:S}=I;if(!o.length||o.includes(w)){if(m(w),n){let{individualParticipantIds:E}=ML(I);c[w].participantIds=E}T&&(m(T),g(w,T),d[T].push(w)),S&&(m(S),g(w,S),d[S].push(w)),c[w].sources.push(d[w]);let D=d[w].map(E=>c[E].sources[0]).flat(),C=d[w].map(E=>c[E].sources[1]).flat();if(c[w].sources.push(D,C),b){let E=I.containerStructureId||I.structureId,P=u[E];if(l[P])for(let R of l[P])m(R),g(R,w),d[R].push(w)}}}};if(s)gy({drawDefinition:s}),f?.length||(f=po({drawDefinition:s}).matchUps),v(f);else{if(f?.length||(f=Cd({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let y=p?.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:I=[]})=>I.map(({drawId:w})=>w))).flat(1/0):[];y&&(r=y)}for(let y of r){let b=f?.filter(I=>I.drawId===y).sort(_w);if(!b?.find(({roundPosition:I})=>!I)){let I=b?.find(({tournamentId:T})=>T),{drawDefinition:w}=Lo({tournamentRecord:e[I?.tournamentId],drawId:y});w&&gy({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...oe}}function ua(t){let e=t?.matchUp,i=t?.score||e?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o,side1PointScore:l,side2PointScore:c}=r||{},u=n||a||s||o||l||c;return!!(i?.sets?.length>1||u)}function p0({matchUpStatus:t}){return cve.includes(t)}function Cze({matchUpStatus:t}){return w5.includes(t)}function yj({matchUpStatus:t}){return uve.includes(t)}function Z5({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){let a=r?.find(({participantId:o})=>o),s=i?.filter(Z5)?.length;return ua({score:n})||s||e&&a||t&&Cze({matchUpStatus:t})&&![br,Fr,ed].includes(t)}function h0(t){let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,{containedStructures:s}=CD({drawDefinition:e}),o=r?s[r]||[]:[],l={isCollectionMatchUp:!1};if(!a){let S=oi({drawDefinition:e,structureId:r});if(S.error)return S;a=i?S.containingStructure??S.structure:S.structure}if(xo({structure:a}))return{structure:a,isAdHoc:!0,error:fD};let{matchUps:c}=qn({inContext:!0,matchUpFilters:l,drawDefinition:e,event:n}),u=c?.filter(S=>S.structureId===r||o.includes(S.structureId)),{matchUpDependencies:d}=id({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let S of c??[]){if(S.structureId===r||o.includes(S.structureId)){h.push(...S.drawPositions??[]);let D=S.roundNumber;for(let C of(S.drawPositions??[]).filter(Boolean))(!f[C]||D&&f[C]>D)&&(f[C]=D)}Z5(S)&&(m.push(S),p.push(S.matchUpId,...d?.[S?.matchUpId]?.matchUpIds||[]))}let g=yi(h.filter(Boolean)).sort(ea),v=yi(p),y=yi(u?.map(({matchUpId:S,drawPositions:D})=>v.includes(S)?D:[]).flat().filter(Boolean)).sort(ea),{positionAssignments:b}=Tr({drawDefinition:e,structure:a}),I=b?.filter(S=>S.bye).map(S=>S.drawPosition),w=b?.filter(S=>S.qualifier).map(S=>S.drawPosition),T=g?.filter(S=>!y.includes(S))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:w,inactiveDrawPositions:T,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function DI({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&i?.includes(t)).map(({roundNumber:i})=>i).sort(ea)[0]}}var jm={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},X5=[];function Sl(t,e){Yr(t)&&(t={method:t}),(e||cc())&&X5.push(t)}function Rze(t){return X5.slice()}function Mze(t){let e=Rze().map(i=>{let{color:r,keyColors:n,method:a,newline:s}=i,o=Object.keys(jm).includes(r)?jm[r]:jm.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&jm[n[u]]?jm[n[u]]:jm.brightwhite;return`${jm.white}${u}: ${d}${i[u]}`}).join(", "),c=a?.length<15?"		":"	";return[s?`
`:"",o,a,c,jm.white,l,jm.reset,`
`].join("")});e?.length&&console.log(...e)}function Nze(){X5.length=0}function _s(t){return[br,Fr,wa].includes(t)}function bc({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:s,structureId:o,structure:l,event:c}){if(!r)return{error:At};if(l||({structure:l}=oi({drawDefinition:r,structureId:o})),!l)return{error:en};o||({structureId:o}=l);let u="assignDrawPositionBye";Sl({method:u,color:"cyan",drawPosition:n}),s??=rs({drawDefinition:r});let{positionAssignments:d}=Tr({structure:l}),{activeDrawPositions:p}=h0({drawDefinition:r,structureId:o});if(d?.find(P=>P.drawPosition===n)?.bye)return{...oe};let h=!!(a&&s.drawMatchUps.find(P=>P.loserMatchUpId===a?.matchUpId&&_s(P.matchUpStatus)));if(p?.includes(n)&&!h)return{error:zx};let f=d?.find(P=>P.drawPosition===n);if(!f)return{error:fD};let{filled:m,containsBye:g,assignedParticipantId:v}=Aze(f);if(g)return{...oe};if(m&&!g&&!h)return ue({result:{error:qT},stack:u});let y=er({tournamentRecord:i,drawDefinition:r,event:c}).appliedPolicies??{},b=qn({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:w}=ar({provisionalPositioning:t,drawDefinition:r,matchUpFilters:I,matchUpsMap:s,structure:l});if(d?.forEach(P=>{P.drawPosition===n&&(P.bye=!0,h&&(P.participantId=void 0))}),l.structureType===To)return _ze({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:w}),Sg({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),NZ({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:o,stack:u});let{roundProfile:T,roundMatchUps:S}=vo({matchUps:w}),D=(T&&Object.keys(T).map(P=>parseInt(P)).reverse())?.find(P=>T?.[P].drawPositions?.includes(n)),C=D?S?.[D].find(({drawPositions:P})=>P?.includes(n)):void 0;C&&Qve({tournamentRecord:i,drawDefinition:r,matchUp:C,event:c});let E=C?.drawPositions?.find(P=>P!==n);if(C&&E){let P=J5({sourceDrawPositions:C.drawPositions,matchUpId:C.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:r,matchUpsMap:s});if(P.error)return P}return Sg({tournamentId:i?.tournamentId,drawDefinition:r,structure:l,event:c}),NZ({assignedParticipantId:v,isPositionAction:e,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:o,stack:u})}function NZ({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:s}){return e&&RL({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:s}}),ue({result:{...oe},stack:s})}function Aze(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function Qve({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Hi({tournamentId:t?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function _ze({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{a.drawPositions?.includes(i)&&Qve({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function J5({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:s,event:o}){Sl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(b=>b.matchUpId===s),c=e.find(b=>b.matchUpId===s)?.structureId,{structure:u}=oi({drawDefinition:n,structureId:c}),{positionAssignments:d}=Tr({structure:u}),p=d?.filter(b=>b.bye).map(b=>b.drawPosition),h=l?.drawPositions?.find(b=>b!==t),f=h&&p?.includes(h),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=yo({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:s});if(v&&v.structureId===u?.structureId&&kze({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:o}),g&&f&&g.structureId!==u?.structureId){let{roundNumber:b}=g;if(b===1){let I=bc({structureId:m.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:o});if(I.error)return I}else eye({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:m,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:o})}return{...oe}}function kze({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:s,event:o}){let l="advanceWinner",c=s.drawMatchUps.find(A=>A.matchUpId===a.matchUpId),u=e.find(A=>A.matchUpId===a.matchUpId)?.structureId,{structure:d}=oi({drawDefinition:n,structureId:u}),{positionAssignments:p}=Tr({structure:d}),h=p?.find(({drawPosition:A})=>A===t)?.bye,f=c.drawPositions?.filter(Boolean),m=p?.filter(A=>f?.includes(A.drawPosition)),g=p?.find(({drawPosition:A})=>A===t),v=i?.find(A=>A!==t),y=(v&&m?.find(({drawPosition:A})=>A===v))?.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),f?.length>1&&h&&!y)return ue({result:{error:qT},stack:l});let I=f?.find(A=>A!==t),w=b,T=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=T.map(A=>!A&&!w||A===t?(w=!0,t):A).sort(ea);if(!w)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),ue({result:{error:qT},stack:l});let D=p?.find(({drawPosition:A})=>A===I)?.bye,C=p?.find(({drawPosition:A})=>A===t)?.bye;Object.assign(c,{matchUpStatus:C||D?"BYE":Pn,score:void 0,winningSide:void 0,drawPositions:S});let E=c.drawPositions.find(A=>!T.includes(A));Sl({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:D,drawPositionIsBye:C}),Hi({tournamentId:r?.tournamentId,matchUp:c,eventId:o?.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:P},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:M}}=yo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(D||C){let A=D?t:I;if(A)J5({drawPositionToAdvance:A,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:s});else if(C&&P&&R)if(R.feedRound)eye({loserTargetDrawPosition:M,tournamentRecord:r,loserTargetLink:P,drawDefinition:n,loserMatchUp:R,matchUpsMap:s});else{let N=1-a.roundPosition%2,k=R.drawPositions[N],x=bc({structureId:P.target.structureId,drawPosition:k,tournamentRecord:r,drawDefinition:n,event:o});if(x.error)return x}}}function eye({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{roundNumber:o}=n;Sl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:c}=DI({drawPosition:t,matchUps:l});if(c===o){let u=bc({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:s});if(u.error)return u}}function tye({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:s}=ar({drawDefinition:i,matchUpsMap:r,structure:n,event:a});s.forEach(o=>{let l=t.filter(({drawPosition:c})=>o.drawPositions?.includes(c)).filter(c=>c.bye).length;o.winningSide||(Object.assign(o,{matchUpStatus:l?"BYE":Pn}),Hi({tournamentId:e?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:o}))})}function f0(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:l}=t,{structure:c}=oi({drawDefinition:a,structureId:s}),u=(ca({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u?.drawPosition),!r)return{error:mD};i||(i=u?.participantId);let{activeDrawPositions:d}=h0({drawDefinition:a,structureId:s});return d.includes(r)?{error:zx}:(e||({matchUps:e}=qn({inContext:!0,drawDefinition:a,matchUpsMap:o})),bj({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:s,drawPosition:r,matchUpsMap:o,event:l}).drawPositionCleared?(Sg({tournamentId:n?.tournamentId,drawDefinition:a,structure:c,event:l}),{...oe,participantId:i}):{error:Dfe})}function bj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:s}){let{structure:o}=oi({drawDefinition:i,structureId:a});if(!o)return{error:en};let l=ca({drawDefinition:i,structure:o}).positionAssignments||[],c=l.some(v=>{if(v.drawPosition===r)return delete v.participantId,delete v.qualifier,delete v.bye,!0});if(o.structureType===To)return tye({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:o}),{drawPositionCleared:c,...oe};let u={isCollectionMatchUp:!1},{matchUps:d}=ar({drawDefinition:i,matchUpFilters:u,matchUpsMap:n,structure:o,event:s}),{roundProfile:p,roundMatchUps:h}=vo({matchUps:d}),f=(p&&Object.keys(p))?.map(v=>ri(v)),m=r,g=f?.map(v=>{let y=p?.[v]?.pairedDrawPositions?.find(E=>E.includes(m)),b=y?.find(E=>E!==m),I=l.find(E=>E.drawPosition===b),w=p?.[v+1],T=I?.bye,S=w?.pairedDrawPositions?.find(E=>E.includes(b)),D=T&&S&&w&&w.drawPositions?.includes(b),C=y&&{pairedDrawPositionByeAdvancedPair:!D&&S,pairedDrawPosition:b,targetDrawPosition:m,relevantPair:y,roundNumber:v};return D&&(m=b),C}).filter(v=>v?.targetDrawPosition)?.reduce((v,y)=>{let{roundNumber:b,relevantPair:I,targetDrawPosition:w,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:S}=y,D={roundNumber:b,targetDrawPosition:w,relevantPair:I},C=S&&{roundNumber:b+1,targetDrawPosition:T,relevantPair:S,subsequentRoundRemoval:!0},E=[D,C].filter(Boolean);return v.concat(...E)},[]);return g?.forEach(({roundNumber:v,targetDrawPosition:y,relevantPair:b})=>{let I=h?.[v].find(w=>go(w.drawPositions?.filter(Boolean),b.filter(Boolean)));I&&(Oze({inContextDrawMatchUps:t,targetDrawPosition:y,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:v,matchUpsMap:n}),iye({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:I,drawPosition:r,matchUpsMap:n,structure:o,event:s}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function Oze({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:s}){let{structure:o}=oi({drawDefinition:r,structureId:s});if(!o)return{error:en};if(o.structureType===To)return;n=n||rs({drawDefinition:r});let l=(n?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:c}=DI({drawPosition:e,matchUps:l}),u=l?.filter(p=>p.roundNumber>=a&&p.roundNumber!==c&&p.drawPositions?.includes(e)),d=Tr({drawDefinition:r,structureId:s}).positionAssignments??[];return u?.forEach(p=>iye({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:o})),{...oe}}function iye({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c="removeDrawPosition",u=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide;s=s??rs({drawDefinition:r});let h=s.mappedMatchUps[o.structureId].matchUps,{initialRoundNumber:f}=DI({drawPosition:a,matchUps:h});if(n.roundNumber&&f&&n.roundNumber>f){let S=(n.drawPositions??[]).map(D=>D===a?void 0:D);n.drawPositions=S}if(n.matchUpType===kr){let S=(t?.find(D=>D.matchUpId===n.matchUpId)?.sides??[]).reduce((D,C,E)=>C.drawPosition===a?E:D,void 0);S!==void 0&&n.sides?.[S]?.lineUp&&(delete n.sides?.[S].lineUp,Hi({tournamentId:i?.tournamentId,context:`${c}-TEAM`,eventId:l?.eventId,matchUp:n,drawDefinition:r}))}let m=yo({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:S})=>n.drawPositions?.includes(S)).filter(S=>S.bye).length,w=I&&"BYE"||n.matchUpStatus&&_s(n.matchUpStatus)&&n.matcHUpStatus||Pn;n.matchUpStatus=w,n.matchUpStatus&&_s(n.matchUpStatus)&&(n.winningSide=void 0);let T=u?.find(S=>!n.drawPositions?.includes(S));if(u?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(T&&Sl({method:c,color:"brightyellow",removedDrawPosition:T}),Hi({tournamentId:i?.tournamentId,context:`${c}-${a}`,eventId:l?.eventId,matchUp:n,drawDefinition:r})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:S,roundNumber:D}=v;if(D===1){let C=S[b];bj({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s})}else{let C=Math.min(...S.filter(Boolean)),E=xze({loserMatchUpDrawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:s,event:l});if(E.error)return ue({result:E,stack:c});let P=(s?.mappedMatchUps||{})[v.structureId].matchUps,{initialRoundNumber:R}=DI({drawPosition:C,matchUps:P});R===1&&(Sl({method:c,color:"brightyellow",loserMatchUpDrawPosition:C}),bj({structureId:v.structureId,drawPosition:C,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:s}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...oe}}function xze({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:s}){let{structure:o}=oi({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Tr({structure:o});if(l?.find(c=>c.drawPosition===t)?.bye){let c=f0({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:s});if(c.error)return c}return{...oe}}function Jy({drawDefinition:t,stages:e}){if(!t)return{error:At};let i=(t?.structures??[]).filter(n=>!e?.length||n.stage&&e.includes(n.stage)),r=yi(i.map(n=>{let{positionAssignments:a}=Tr({structure:n});return a?a.map(Fi):[]}).flat().filter(Boolean));return{...oe,assignedParticipantIds:r}}function Id(t){let e=(t?.entries??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:s}=n,o=`_${a||Dt}${s||""}`;return r[o]||(r[o]=[]),r[o].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let s=a+1;return{...n,entryPosition:s}})).flat()}function Uv(t){return[Ky,tu].includes(t)}function w_({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:s,extension:o,eventSync:l,drawId:c,stage:u,event:d}){if(!n||!Array.isArray(n))return{error:Ed,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Lr};if(a&&!Rve.includes(a))return{error:tj};if(s&&!cL.includes(s))return{error:Gy};let p="modifyEntriesStatus",h=[];if(!a&&!o)return ue({result:{error:Yt},info:"Missing entryStatus",stack:p});if(o&&!Ep({extension:o,requiredAttributes:["name"]}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:o},stack:p});let f=[];d?.drawDefinitions?.forEach(C=>{let E=Jy({stages:u&&[u],drawDefinition:C}).assignedParticipantIds??[];f.push(...E)});let m=i?.participants??[];if(!n.every(C=>{let E=bg({tournamentParticipants:m,participantId:C})?.participantType;return!(E&&[Ei,Ro].includes(E)&&Uv(a))&&!(a&&d?.eventType&&E===Bi&&[jc,_l].includes(d.eventType)&&[Ou,...xN].includes(a))}))return{error:tj};let g=d&&Rn({event:d}).flightProfile,v=g?.flights?.find(C=>C.drawId===c),y=C=>{let E=(C||[]).filter(R=>!u||!R.entryStage||u===R.entryStage).filter(({participantId:R})=>n.includes(R)),P=R=>a&&f.includes(R.participantId)&&!(xN.includes(R.entryStatus)&&xN.includes(a));return E.every(R=>P(R)&&!e?!1:(a&&(R.entryStatus=a,delete R.entryPosition),s&&(R.entryStage=s,delete R.entryPosition),o&&(o.value?nr({element:R,extension:o}):uo({element:R,name:o.name})),!0))?{...oe}:{error:yD}},b=({flight:C,drawDefinition:E})=>{d&&(d.entries=Id({entries:d.entries??[]})),C&&(C.drawEntries=Id({entries:C.drawEntries})),E&&(E.entries=Id({entries:E.entries}))},I=C=>{let{flight:E,drawDefinition:P}=C,R="updateDrawEntries";if(E){let M=y(E.drawEntries);if(M.error)return ue({result:M,stack:R})}if(P){let M=y(P.entries);if(M.error)return ue({result:M,stack:R});h.includes(P.drawId)||h.push(P.drawId)}return{...oe}},w=d?.entries?.find(({entryPosition:C})=>C)??(v?.drawEntries?.find(({entryPosition:C})=>C)||r?.entries?.find(({entryPosition:C})=>C));if(t&&!w&&b({flight:v,drawDefinition:r}),v||r){let C=I({flight:v,drawDefinition:r});if(C.error)return ue({result:C,stack:p})}let T=d?.drawDefinitions?.map(({drawId:C})=>C)??[],S=g?.flights?.filter(C=>!T.includes(C.drawId))||[];for(let C of S){let E=C&&I({flight:C});if(E?.error)return ue({result:E,stack:p})}let D=g?.flights?.length===1&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!v&&!r&&a&&Cve.includes(a))return{error:ume};if(!v&&!r||a===Hh||l&&D){let C=y(d?.entries);if(C?.error)return ue({result:C,stack:p});let E;if(a===Hh&&(g?.flights?.every(P=>{let R=y(P.drawEntries);return R.error?(E=R.error,!1):(P.drawEntries=P.drawEntries.filter(({participantId:M})=>!n.includes(M)),!0)}),d?.drawDefinitions?.every(P=>{let R=y(P.entries);return R.error?(E=R.error,!1):(P.entries=P.entries?.filter(({participantId:M})=>!n.includes(M)),!0)})),E)return ue({result:{error:E},stack:p})}t&&b({flight:v,drawDefinition:r});for(let C of d?.drawDefinitions??[])h.length&&!h.includes(C.drawId)||Cr({tournamentId:i.tournamentId,eventId:d?.eventId,drawDefinition:C});return{...oe}}function yh({requireTimeStamp:t,scaleAttributes:e,participant:i}){if(!i)return{error:vw};if(!qi(e))return{error:Se};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:s}=e,o=[hy,n,a,s].join("."),l=i.timeItems.filter(c=>c?.itemType===o).filter(c=>!t||c?.itemDate).sort((c,u)=>(c.createdAt?new Date(c.createdAt).getTime():0)-(u.createdAt?new Date(u.createdAt).getTime():0)).pop();if(l){let[c,u,d,p]=l.itemType?.split(".")??[];if(c!==hy)return{error:yI};let h=(r&&qb({element:l.itemValue,accessor:r}))?.value||l.itemValue,f={eventType:d,scaleDate:l.itemDate,scaleValue:h,scaleName:p,scaleType:u};return{...oe,scaleItem:f}}}return{...oe,scaleItem:void 0}}function Lze({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){let a={},s=u=>[hy,gh,n.eventType,u].join("."),o=Object.assign({},...(r.timeItems||[]).filter(({itemType:u})=>u.split(".")[1]===gh).map(({itemType:u,itemValue:d})=>({[u]:d}))),l=(t?.stageSeedingScaleNames&&Object.values(t?.stageSeedingScaleNames)||Array.isArray(t?.seedingScaleNames)&&t.seedingScaleNames||[]).map(s),c=En(Object.keys(o),l);if((!e||!Object.keys(o).length&&!t?.drawIds?.length||c.length)&&c.length){if(t?.stageSeedingScaleNames){let u=Object.keys(t.stageSeedingScaleNames).map(p=>{let h=s(t.stageSeedingScaleNames[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else if(c){let u=c.map(d=>o[d]);a.seedValue=u.pop()}}else if(!e&&typeof i=="object"){let u=Object.keys(i).map(p=>{let h=s(i[p]),f=o[h];return[p,f]}).filter(p=>p[1]).map(p=>({[p[0]]:{seedValue:p[1]}})),d=Object.assign({},...u);a.seedAssignments=d}else{let{categoryName:u,ageCategoryCode:d}=n.category||{},p=[d,n.eventId,u].filter(Boolean),h;for(let f of p){let m={eventType:n.eventType,scaleType:gh,scaleName:f},g=yh({scaleAttributes:m,participant:r});if(g.scaleItem){h=g.scaleItem;break}}if(h&&(!e||t?.published&&!t?.published?.drawIds?.length)){let f=h.scaleValue;a.seedValue=f}}return a}function Fze({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:s,entry:o}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=o,p=d?.length&&t?Object.assign({},...Q4(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:s,eventId:a});i.events[a]=Ft(h,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function m0(t){let e=Gt(t,[{[pa]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=yc}=t,n=`${Xg}.${Jg}`;return Et(AL({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function Bze(t){let{tournamentId:e}=t??{};return!!e}function ru({event:t,status:e=yc}){let i=`${Xg}.${Jg}`;return QR({itemType:i,event:t})?.timeItem?.itemValue?.[e]}function Q5({drawDetails:t,drawId:e}){return t?.[e]?.publishingDetail?.published}function kw(t){let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:s,event:o}=t??{};if(e&&!Bze(e))return{error:Se};if(n&&!o)return{error:Vc};if(Array.isArray(r)&&r?.length){let d={};for(let p of r){if(!Yr(p))return{error:Se};let h=Lo({tournamentRecord:e,eventId:p})?.event;if(!h)return{error:Vc};let f=cB({event:h});d[p]=f}return{...oe,publishState:d}}if(o){let d=cB({event:o}),p={};if(s)return i?{publishState:{status:{published:!!d.status.publishedDrawIds?.includes(s),drawDetail:d.status.drawDetails?.[s]},...oe}}:{error:lc};if(Array.isArray(a)&&a?.length){let h=o.drawDefinitions?.map(DC)??[];for(let f of a){if(!Yr(f))return{error:Se};if(!h.includes(f))return{error:lc};p[f]={status:{published:!!d.status.publishedDrawIds.includes(f),drawDetail:d.status.drawDetails?.[f]}}}}else p=d;return{...oe,publishState:p}}let l=[],c=!1,u={};for(let d of e?.events??[]){let p=cB({event:d});u[d.eventId]=p,p.status.published&&(l.push(d.eventId),c=!0);for(let{drawId:h}of d.drawDefinitions??[]){let f=p.status?.publishedDrawIds?.includes(h);f&&(u[h]={status:{published:f}})}}if(e){let d=m0({tournamentRecord:e});u.tournament=d??{},(d?.orderOfPlay?.published||d?.participants?.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...oe,publishState:u}}function cB({event:t}){let e=ru({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of t.drawDefinitions?.map(DC)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>Q5({drawDetails:r,drawId:o})),a=n?.length?n:e.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};let s=a?.length>0;return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:s}}}function rye(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r==="BYE"||e[i].scheduleItems.push({...u,scheduledDate:Ui(u?.scheduledDate),scheduledTime:zr(u?.scheduledTime),checkScoreHasValue:ua({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:s,roundNumber:o,matchUpId:l,potential:c,drawId:d})}function $ze({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:s,roundNumber:o,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=r?m:g;r&&(f.winCount+=1,n===Fr&&(f.walkoverWinCount+=1),n===br&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=o),i===1&&(f.participantWon=r))}function AZ(t){let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:s,withEvents:o,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:w,collectionId:T,matchUpType:S,winningSide:D,matchUpId:C,schedule:E,eventId:P,drawId:R,sides:M}=t,A=a&&M?.length===2&&Object.assign({},...M.map(({sideNumber:N},k)=>{let x=M[1-k].participantId;return N&&{[N]:x}}).filter(Boolean));for(let N of M){let{participantId:k,sideNumber:x,bye:O}=N;if(O)continue;let V=D===x,F=W=>{let z=n[W]?.participant,H=z?.participantType,Z=[{participantId:W,participantType:H}];if(H!==Ro)for(let J of z?.individualParticipantIds||[]){let ie=n[J]?.participant;Z.push({participantType:ie?.participantType,participantId:J})}return Z},j=(W,z)=>{if(s){if(n[W].matchUps[C]={participantWon:V,matchUpType:S,structureId:f,sideNumber:x,matchUpId:C,eventId:P,drawId:R,stage:g},a){let H=F(z);n[W].matchUps[C].opponentParticipantInfo=H}T&&(n[W].matchUps[C].collectionId=T)}a&&z&&(n[W].opponents[z]={participantId:z,matchUpId:C,eventId:P,drawId:R}),v&&$ze({finishingPositionRange:c,participantMap:n,participantWon:V,finishingRound:u,matchUpStatus:d,participantId:W,stageSequence:p,roundNumber:h,structureId:f,matchUpId:C,drawId:R,stage:g}),(i||e)&&rye({participantMap:n,participantId:W,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:h,structureId:f,matchUpId:C,schedule:E,drawId:R,score:m})},q=({participant:W,partnerParticipantId:z})=>{let H=(Z,J)=>{Z&&(Z.partnerParticipantIds||(Z.partnerParticipantIds=[]),Z.partnerParticipantIds.includes(J)||Z.partnerParticipantIds.push(J))};l&&H(W?.draws?.[R],z),o&&H(W?.events?.[P],z),s&&H(W?.matchUps?.[C],z)};if(k&&n[k]){let W=A?.[x];j(k,W);let z=n[k]?.participant.participantType===Ei,H=n[k]?.participant.individualParticipantIds||[];if(I){if(r){let Z=J=>n[J].matchUps[I]={participantWon:y===x,matchUpId:I,matchUpType:kr,sideNumber:x};Z(k),H.forEach(Z)}if(l&&!n[k].draws[R]){let Z=w.find(K=>K.sideNumber===x)?.participant?.participantId,J=n[Z]?.draws?.[R]?.entryStatus,ie=K=>n[K].draws[R]={entryStatus:J,eventId:P,drawId:R};ie(k),H.forEach(ie)}}if(z&&(H.forEach(Z=>n[Z]&&j(Z,W)),H.forEach((Z,J)=>{let ie=H[1-J],K=n[Z];K&&q({participant:K,partnerParticipantId:ie})}),o&&w)){let Z=w.find(J=>J.sideNumber===x)?.participant?.participantId;if(Z){let J=n[Z]?.events[P];J?(n[k].events[P]={...J},H.forEach(ie=>n[ie].events[P]={...J})):console.log("Missing teamEntry",{eventId:P,teamParticipantId:Z})}}if(D){let Z=J=>{V?(n[J].counters[S].wins+=1,n[J].counters.wins+=1,d===Fr&&(n[J].counters[S].walkoverWins+=1,n[J].counters.walkoverWins+=1),d===br&&(n[J].counters[S].defaultWins+=1,n[J].counters.defaultWins+=1)):(n[J].counters[S].losses+=1,n[J].counters.losses+=1,d===Fr&&(n[J].counters[S].walkovers+=1,n[J].counters.walkovers+=1),d===br&&(n[J].counters[S].defaults+=1,n[J].counters.defaults+=1))};Z(k),H.forEach(Z)}}}}function VL(t,e){return(t||"").localeCompare(e||"")}function Vze(t){let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:s,matchUpFilters:o,participantMap:l,contextProfile:c,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,withOpponents:g,withMatchUps:v,withSeeding:y,withEvents:b,withDraws:I}=t,w=e?.participantIds,T=N=>{let k=[N];return l[N]?.participant.individualParticipantIds?.forEach(x=>k.push(x)),k.some(x=>!w?.length||w.includes(x))?k:[]},S={withMatchUps:v||d,withEvents:b||d,withDraws:I||d,withPotentialMatchUps:u,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:h,withTeamMatchUps:f,withStatistics:m,participantMap:l,withOpponents:g,withSeeding:y},D=[],C={},E=[],P={},R={},M={},A=({eventType:N,scaleNames:k,participantId:x})=>l[x]?.participant?.rankings?.[N]?.find(O=>k.includes(O.scaleName))?.scaleValue;for(let N of n?.events||[]){if(e?.eventIds&&!e.eventIds.includes(N.eventId))continue;let{drawDefinitions:k=[],extensions:x=[],eventType:O,eventName:V,category:F,entries:j,eventId:q,gender:W}=N,{flightProfile:z}=Rn({event:N}),H=z?.flights??[],Z=kw({event:N}).publishState;Z&&(P[q]=Z);let J=Z?.status?.publishedSeeding;if(b||y||d){let K=i?Object.assign({},...Q4(x??[])):{};R[q]={...K,eventName:V,eventType:O,category:F,eventId:q,gender:W};let ne=[F?.categoryName,F?.ageCategoryCode].filter(Boolean);for(let le of j){let{participantId:re}=le;if(!re||!l[re])continue;let me=A({eventType:O,scaleNames:ne,participantId:re}),he,Ie;if(y){let ot=l[re].participant;({seedAssignments:he,seedValue:Ie}=Lze({publishedSeeding:J,usePublishState:a,withSeeding:y,participant:ot,event:N}))}let Le=ot=>{if(l[ot]?.events?.[q])return;let at=l[ot];Fze({convertExtensions:i,seedAssignments:he,participant:at,withSeeding:y,seedValue:Ie,eventId:q,ranking:me,entry:le})};Le(re),(l[re].participant.individualParticipantIds||[]).forEach(Le)}}let ie=P?.[q]?.publishedSeeding;if(I||d||y){let K=le=>le?Object.assign({},...le.map(({participantId:re,seedValue:me,seedNumber:he})=>({[re]:{seedValue:me,seedNumber:he}}))):void 0,ne=yi([...k.map(DC),...H.map(DC)]);for(let le of ne){let re=k.find(ve=>ve.drawId===le),me=[F?.categoryName,F?.ageCategoryCode].filter(Boolean),{structures:he=[],drawOrder:Ie,drawName:Le,drawType:ot}=re??{},at=H?.find(ve=>ve.drawId===le),dt=re?.entries||at?.drawEntries,It=at?.flightNumber,ze=(re?.structures||[]).sort((ve,$e)=>Dw(ve,$e)).map(({structureId:ve,structures:$e})=>[ve,...($e||[]).map(({structureId:De})=>De)]).flat(1/0),Ct,ke,mt,Be,ut=0,it=he.filter(({stage:ve,stageSequence:$e})=>ve===Dt&&$e===1||ve===zt).flatMap(ve=>{let{positionAssignments:$e}=Tr({structure:ve}),{seedAssignments:De,stageSequence:je,stage:Oe}=ve;return Oe===Dt?(ut=$e?.length??0,mt=$e,Be=De):je===1&&(Ct=$e,ke=De),$e}).map(({participantId:ve})=>ve).filter(Boolean),xe=K(Be),Ze=K(ke),st=re?dt.filter(({participantId:ve})=>it.includes(ve)):dt,qe=!a||ie?.published&&(ie?.drawIds?.length===0||ie?.drawIds?.includes(le));for(let ve of st){if(!l[ve.participantId])continue;let{entryStatus:$e,entryStage:De,entryPosition:je,participantId:Oe}=ve,nt=A({participantId:Oe,scaleNames:me,eventType:O}),Fe=wt=>{if(!l[wt]||l[wt].draws?.[le])return;let pt=y&&qe,Mt=pt?{}:void 0,Wi=pt?xe?.[Oe]?.seedValue||xe?.[Oe]?.seedNumber:void 0,Qt=Wi?xe?.[Oe]:void 0,tr=pt?Ze?.[Oe]?.seedValue||Ze?.[Oe]?.seedNumber:void 0,Vi=tr?Ze?.[Oe]:void 0;Mt&&Wi&&(Mt[Dt]=Qt),Mt&&tr&&(Mt[zt]=Vi);let $i=Wi||tr;$i&&(l[wt].participant.seedings[O]||(l[wt].participant.seedings[O]=[]),Qt&&l[wt].participant.seedings[O].push({...Qt,scaleName:le}),Vi&&l[wt].participant.seedings[O].push({...Vi,scaleName:le}),Mt&&(l[wt].events[q].seedAssignments||(l[wt].events[q].seedAssignments={}),Object.keys(Mt).forEach(Wr=>l[wt].events[q].seedAssignments[Wr]=Mt[Wr]))),(I||d)&&(l[wt].draws[le]=Ft({seedAssignments:Mt,entryPosition:je,entryStatus:$e,entryStage:De,seedValue:$i,eventId:q,ranking:nt,drawId:le},!1,!1,!0))};[tu,Ky].includes($e)||(Fe(Oe),(l[Oe].participant.individualParticipantIds||[])?.forEach(Fe))}let ft=(re?.structures??[]).reduce((ve,$e)=>(ve.includes($e.stage)||ve.push($e.stage),ve),[]),_t=(re?.links??[]).length;M[le]={qualifyingPositionAssignments:Ct,qualifyingSeedAssignments:ke,mainPositionAssignments:mt,qualifyingSeedingMap:Ze,mainSeedAssignments:Be,orderedStructureIds:ze,mainSeedingMap:xe,flightNumber:It,linksCount:_t,drawOrder:Ie,drawName:Le,drawType:ot,drawSize:ut,drawId:le,stages:ft}}}if(d||h||f||m||g||v||I){let K=!!h||u,ne=nf({afterRecoveryTimes:!!h,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:l,contextFilters:s,matchUpFilters:o,contextProfile:c,nextMatchUps:K,event:N})?.matchUps??[];for(let le of ne){let{finishingPositionRange:re,potentialParticipants:me,tieMatchUps:he=[],sides:Ie=[],winningSide:Le,matchUpType:ot,matchUpId:at,eventId:dt,drawId:It,collectionId:ze,stageSequence:Ct,finishingRound:ke,matchUpStatus:mt,roundPosition:Be,roundNumber:ut,structureId:it,schedule:xe,score:Ze,stage:st}=le;C[at]=le;let qe={finishingPositionRange:re,finishingRound:ke,stageSequence:Ct,roundPosition:Be,collectionId:ze,roundNumber:ut,structureId:it,schedule:xe,eventId:dt,drawId:It,score:Ze,stage:st};AZ({...qe,...S,matchUpStatus:mt,winningSide:Le,matchUpType:ot,matchUpId:at,sides:Ie});for(let ft of he){let{winningSide:_t,sides:ve=[],matchUpId:$e,matchUpStatus:De,matchUpType:je}=ft;AZ({...qe,...S,winningSide:_t,tieWinningSide:Le,matchUpTieId:at,matchUpId:$e,sides:ve,matchUpSides:Ie,matchUpStatus:De,matchUpType:je})}Array.isArray(me)&&(K||h||p)&&me.flat().map(Fi).filter(Boolean)?.forEach(ft=>{T(ft)?.forEach(_t=>{l[_t]&&(l[_t].potentialMatchUps[at]=Ft({tournamentId:n?.tournamentId,matchUpId:at,eventId:dt,drawId:It}))}),(h||p)&&rye({potential:!0,participantMap:l,participantId:ft,matchUpStatus:mt,roundPosition:Be,structureId:it,matchUpType:ot,roundNumber:ut,matchUpId:at,schedule:xe,drawId:It,score:Ze})})}E.push(...ne)}}if(m||d||h){let N=Object.values(l);for(let k of N){let{wins:x,losses:O,[wr]:{wins:V,losses:F},[mr]:{wins:j,losses:q}}=k.counters,W=(z,H,Z)=>{let J=H+Z,ie=H,K=J&&ie/J;k.statistics[z]={denominator:J,numerator:ie,statValue:K,statCode:z}};if(m&&(W(ON,x,O),W(`${ON}.${wr}`,V,F),W(`${ON}.${mr}`,j,q)),d){let z=(H=[])=>Math.abs(H[0]-H[1]);for(let H of Object.keys(k.draws)){let{orderedStructureIds:Z=[],flightNumber:J}=M[H]||{};if(k.structureParticipation&&Z.length){let ie,K=0,ne=Z.map(le=>{let re=k.structureParticipation[le];if(!re)return;ie||(ie=re?.finishingPositionRange),z(ie)>z(re?.finishingPositionRange)&&(ie=re?.finishingPositionRange);let me=re.stage!==zt;return me&&(K+=1),Ft({...re,participationOrder:me?K:void 0,flightNumber:J})}).filter(Boolean);k.draws[H]&&(k.draws[H].finishingPositionRange=ie,k.draws[H].structureParticipation=ne)}}}if(h){let z=qi(h)?h.scheduledMinutesDifference:0,H=k.scheduleItems||[],Z=k.potentialMatchUps||{},J=H.reduce((K,ne)=>{let{scheduledDate:le,scheduledTime:re}=ne;return K[le]||(K[le]=[]),re&&K[le].push(ne),K},{});Object.values(J).forEach(K=>K.sort(Wme));for(let K of H){let{typeChangeTimeAfterRecovery:ne,timeAfterRecovery:le,scheduledDate:re,scheduledTime:me}=K,he=J[re],Ie=Ji(me);for(let Le of he){if(Le.matchUpId===K.matchUpId||_s(Le.matchUpStatus)&&!Le.checkScoreHasValue)continue;let ot=K.matchUpType!==Le.matchUpType&&ne||le,at=K.drawId===Le.drawId,dt=Z[K.matchUpId]&&Z[Le.matchUpId],It=Ji(Le.scheduledTime),ze=Math.abs(It-Ie),Ct=It>=Ie;if((z&&!isNaN(z)?ze<=z:Ct&&Ji(Le.scheduledTime)<Ji(ot))&&!(dt&&at)&&Ct){let ke=[K.matchUpId,Le.matchUpId].sort(VL).join("|");k.scheduleConflicts[ke]={priorScheduledMatchUpId:K.matchUpId,matchUpIdWithConflict:Le.matchUpId}}}}let ie=k.participant.participantId;Object.keys(k.scheduleConflicts).length&&D.push(ie),l[ie].scheduleConflicts=k.scheduleConflicts}}}return{participantIdsWithConflicts:D,eventsPublishStatuses:P,derivedEventInfo:R,derivedDrawInfo:M,mappedMatchUps:C,participantMap:l,matchUps:E}}function g0({participantFilters:t={},tournamentRecord:e,participants:i=[]}){if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:s,participantRoles:o,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=qp(h)&&e?.events?.filter(I=>h?.includes(I.eventId))||e?.events||[],g=n&&jze({drawEntryStatuses:n,tournamentEvents:m}),v=s&&Gze({eventEntryStatuses:s,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((I,w)=>I.concat(...(w.drawDefinitions||[]).map(T=>pve({drawDefinition:T}).allPositionedParticipantIds).filter(Boolean)),[]),b=I=>r?.reduce((w,T)=>{let{accessor:S,value:D}=T,{values:C}=qb({element:I,accessor:S});return w&&C?.includes(D)},!0);if(i=i?.filter(I=>{let w=eu({element:I,itemType:JR})?.timeItem?.itemValue,{participantRoleResponsibilities:T,participantType:S,participantRole:D,participantId:C,person:E}=I,P=Array.isArray(f)&&f?.length&&E?.sex&&f.includes(E.sex);return p?f&&P||a&&y.includes(C)||a===!1&&!y.includes(C)||g?.includes(C)||v?.includes(C)||u?.includes(C)||d&&w===d||c&&S&&qp(c)&&c.includes(S)||o&&D&&qp(o)&&o.includes(D)||l&&qp(T)&&qp(l)&&l.find(R=>T?.includes(R))||r?.length&&qp(r)&&b(I):(!f||P)&&(a===void 0||a&&y.includes(C)||a===!1&&!y.includes(C))&&(!g||g.includes(C))&&(!v||v.includes(C))&&(!u||u.includes(C))&&(!d||w===d)&&(!c||S&&qp(c)&&c.includes(S))&&(!o||D&&qp(o)&&o.includes(D))&&(!l||qp(T)&&qp(l)&&l.find(R=>T?.includes(R)))&&(!r?.length||qp(r)&&b(I))}),m.length&&h){let I=m.filter(w=>h.includes(w.eventId)).map(w=>{let T=(w.entries||[]).map(D=>D.participantId);if(On(Up)(w.eventType))return T;let S=(e?.participants??[]).filter(D=>T.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return T.concat(...S)}).flat(1);i=i?.filter(w=>I.includes(w.participantId))}return i}function qp(t){return t&&Array.isArray(t)&&t.length}function jze({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return yi(e.reduce((r,n)=>{let{flightProfile:a}=Rn({event:n}),s=a?.flights?.map(({drawEntries:l})=>Array.isArray(l)?l.filter(i).map(Fi):[]).flat()||[],o=n.drawDefinitions?.map(({entries:l})=>l?l.filter(i).map(Fi):[])||[];return r.concat(...s,...o)},[]))}function Gze({eventEntryStatuses:t,tournamentEvents:e}){return yi(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Fi);return i.concat(...n)},[]))}function un(t){let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:s,withScheduleItems:o,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,contextProfile:v,withOpponents:y,withMatchUps:b,internalUse:I,withSeeding:w,withEvents:T,withDraws:S,withISO2:D,withIOC:C}=t;if(!l)return{error:et};(b||n)&&id({tournamentRecord:l});let E=Eve({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:I,withISO2:D,withIOC:C}),{participantMap:P}=E,R=Vze({withMatchUps:b??n,withEvents:T??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:o,policyDefinitions:s,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:f,contextFilters:m,matchUpFilters:g,participantMap:P,withOpponents:y,contextProfile:v,withSeeding:w}),{participantIdsWithConflicts:M,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,mappedMatchUps:x}=R,O=R.matchUps;P=R.participantMap;let V=c??r,F=({potentialMatchUps:Z,scheduleConflicts:J,scheduleItems:ie,participant:K,statistics:ne,opponents:le,matchUps:re,events:me,draws:he})=>{let Ie=Object.values(he),Le=Object.values(le);return y&&Ie?.forEach(ot=>{ot.opponents=Le.filter(at=>at.drawId===ot.drawId)}),Ft({...K,scheduleConflicts:c?Object.values(J):void 0,draws:S||n?Ie:void 0,events:T||n?Object.values(me):void 0,matchUps:b||n?Object.values(re):void 0,opponents:y?Le:void 0,potentialMatchUps:V?Object.values(Z):void 0,statistics:f?Object.values(ne):void 0,scheduleItems:o?ie:void 0},!1,!1,!0)},j=new Map;for(let Z of Object.keys(P))j.set(Z,F(P[Z]));let q=[...j.values()],W=s?.[DD]?.participant,z=g0({participants:q,participantFilters:i,tournamentRecord:l});if(e){let Z=qi(e)?e:void 0;for(let J of z)for(let ie of J.individualParticipantIds??[]){J.individualParticipants||(J.individualParticipants=[]);let K=j.get(ie),ne=Z?SI({template:Z,source:K}):K;J.individualParticipants.push(ne)}}let H=W?z.map(Z=>SI({source:Z,template:W})):z;return{participantMap:t.returnParticipantMap!==!1?P:void 0,mappedMatchUps:t.returnMatchUps!==!1?x:void 0,matchUps:t.returnMatchUps!==!1?O:void 0,missingParticipantIds:E.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:A,derivedEventInfo:N,derivedDrawInfo:k,participants:H,...oe}}function Wb({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){if(!e)return{error:At};let n=e.entries?.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!r||r===a.entryStage));return t&&n}function ND(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:At};let{entryProfile:s}=t0({drawDefinition:i}),o=a&&r&&s?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&s?.[a]?.qualifiersCount||0,l={};if(!n)return{qualifiersCount:o,roundQualifiersCounts:l};let{structure:c}=oi({drawDefinition:i,structureId:n}),u=i.links?.filter(h=>h?.target?.structureId===c?.structureId),d=0;if(u?.length)for(let h of u){let f=oi({structureId:h.source.structureId,drawDefinition:i})?.structure;if(f?.stage===zt){let m=h.source.roundNumber,g=h.target.roundNumber,v=0;if(f.structureType===To){let y=f.structures?.length??0,b=h.source.finishingPositions?.length??0;v=y*b}else v=ar({matchUpFilters:{roundNumbers:[m]},structure:f,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps?.length||0;l[g]||(l[g]=0),l[g]+=v,d+=v}}let p=Object.keys(l);if(p.length<=1){let h=p[0]||1;l[h]=Math.max(l[h]||0,o)}return d=Math.max(d,o),{qualifiersCount:d,roundQualifiersCounts:l}}function S_({stage:t,drawDefinition:e}){let{entryProfile:i}=t0({drawDefinition:e});return i?.[t]?.drawSize||0}function Hze(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=S_({stage:n,drawDefinition:i}),{qualifiersCount:s}=ND({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-s}function nye({stage:t,drawDefinition:e}){return!!(t===$a||j5({stage:t,drawDefinition:e})&&S_({stage:t,drawDefinition:e}))}function aye({entryStatus:t=ol,drawDefinition:e,stageSequence:i,stage:r}){if(t===Ou)return LHe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...oe}:{error:cme};let n=Hze({drawDefinition:e,stageSequence:i,stage:r}),a=FHe({drawDefinition:e,stage:r}),s=hj({entryStatus:nU,drawDefinition:e,stage:r}),o=hj({entryStatus:ol,drawDefinition:e,stage:r}),l=s+o,c=l>=n,u=n-l;return r!==$a&&c?{error:ij}:t===nU?s<a?{...oe}:{error:ij}:{positionsAvailable:u,...oe}}function e6(t){let e=Gt(t,[{[Gs]:!0,[jge]:!0}]);if(e.error)return e;let{suppressDuplicateEntries:i=!0,entryStatus:r=ol,entryStageSequence:n,entryStage:a=Dt,ignoreStageSpace:s,drawDefinition:o,entryPosition:l,participant:c,roundTarget:u,extensions:d,extension:p,drawType:h,event:f}=t,m="addDrawEntry";if(h!==kl&&!nye({stage:a,drawDefinition:o}))return ue({result:{error:Gy},stack:m});let g=aye({stageSequence:n,stage:a,drawDefinition:o,entryStatus:r});if(!s&&!g.success&&(!h||h!==kl))return{error:g.error};if(p&&!Ep({extension:p}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:p},stack:m});let v=t.participantId||c?.participantId;if(!v)return ue({result:{error:oa},stack:m});let y=r===am&&Wb({participantId:v,drawDefinition:o,entryStatus:r}),b=a===$a&&Wb({participantId:v,drawDefinition:o,entryStage:a}),I=Wb({participantId:v,drawDefinition:o}),w=r!==am&&a!==$a&&I;if(w)return i?(Ii({payload:{drawId:o.drawId,eventId:f?.eventId,error:uC,participantId:v},topic:U5}),{...oe}):ue({result:{error:uC},context:{participantId:v},stack:m});if(y||b)return ue({context:{invalidEntry:w,invalidLuckyLoser:y,invalidVoluntaryConsolation:b},result:{error:Jx},stack:m});let T=Ft({entryStageSequence:n,participantId:v,entryPosition:l,entryStatus:r,entryStage:a,extensions:d});return p&&nr({element:T,extension:p}),u&&nr({extension:{name:"roundEntry",value:u},element:T}),o.entries||(o.entries=[]),o.entries.push(T),Cr({drawDefinition:o}),{...oe}}function zze(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ol,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:s,drawDefinition:o,stageSequence:l,stage:c=Dt,roundTarget:u,extension:d,event:p}=t,h=o.drawType===kl;if(!c)return{error:$fe};if(!o)return{error:At};if(!Array.isArray(s))return{error:wl};if(!h&&!nye({stage:c,drawDefinition:o}))return{error:Gy};if(d&&!Ep({extension:d}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:d},stack:e});let f=aye({drawDefinition:o,stageSequence:l,entryStatus:r,stage:c});if(!a&&!f.success&&!h)return{error:f.error};let m=f.positionsAvailable??0;if(!a&&!h&&c!==$a&&m<s.length)return{error:M4};let g=[],v=o.drawId,y=p?.eventId,b=s.reduce((I,w)=>{let T=r===am&&Wb({participantId:w,drawDefinition:o,entryStatus:r}),S=c===$a&&Wb({entryStage:c,drawDefinition:o,participantId:w}),D=Wb({participantId:w,drawDefinition:o});return r!==am&&c!==$a&&D&&(g.push(w),i&&Ii({payload:{error:uC,participantId:w,eventId:y,drawId:v},topic:U5})),T||S?I.concat(w):I},[]);return g.length&&!i?ue({context:{eventId:y,drawId:v,duplicateEntries:g},result:{error:uC},stack:e}):(s.filter(I=>I&&!b.includes(I)).forEach(I=>{let w={entryStageSequence:l,entryStage:c,participantId:I,entryStatus:r};d&&nr({element:w,extension:d}),u&&nr({extension:{name:Bp,value:u},element:w}),o.entries||(o.entries=[]),o.entries.push(w)}),n&&(o.entries=Id({entries:o.entries})),Cr({drawDefinition:o}),b?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:b,duplicateEntries:g,...oe}:{...oe})}function t6({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,entryStage:l,extension:c,drawId:u,event:d}){if(!n?.length)return{error:zg};if(!d)return{error:Vc};if(!u)return{error:Nd};let p=(d.entries||[]).map(Fi);if(n.filter(m=>!p.includes(m)).length)return{error:Ffe};if(a){let m=zze({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:s,roundTarget:o,extension:c});if(m.error)return m}let{flightProfile:h}=Rn({event:d}),f=h?.flights.find(m=>m.drawId===u);return f?.drawEntries&&(n.forEach(m=>{let g=s===am&&uB({participantId:m,entryStatus:s,flight:f}),v=l===$a&&uB({participantId:m,entryStage:l,flight:f});!(s!==am&&l!==$a&&uB({flight:f,participantId:m}))&&!g&&!v&&f.drawEntries.push({participantId:m,entryStatus:s,entryStage:l})}),e&&(f.drawEntries=Id({entries:f.drawEntries}))),{...oe}}function uB({participantId:t,entryStatus:e,entryStage:i,flight:r}){let n=r.drawEntries?.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&n}function v0({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:Lr};if(!Array.isArray(e)||e.some(d=>!Yr(d)))return ue({result:{error:Ed},stack:a});let s=(n.drawDefinitions??[]).flatMap(d=>Jy({drawDefinition:d}).assignedParticipantIds??[]),o=(i?.length&&n.entries?.filter(d=>d.entryStatus&&i.includes(d.entryStatus))||[]).map(Fi).filter(d=>!s.includes(d)),l=(r&&n.entries?.filter(d=>d.entryStage&&d.entryStage===r)||[]).map(Fi).filter(d=>!s.includes(d));if(e.length?e=e.filter(d=>(!i?.length||o.includes(d))&&(!r||l.includes(d))):o.length&&l.length?e=En(o,l):o.length?e=o:l.length&&(e=l),e?.length&&s.some(d=>e.includes(d)))return ue({result:{error:yD},stack:a});if(!e?.length)return{...oe,participantIdsRemoved:[]};let c=[];n.entries=(n.entries??[]).filter(d=>{let p=!e.includes(d?.participantId);return p||c.push(d.participantId),p}),t&&(n.entries=Id({entries:n.entries}));let{flightProfile:u}=Rn({event:n});return u?.flights?.forEach(d=>{d.drawEntries=(d.drawEntries||[]).filter(p=>!e.includes(p.participantId))}),n.drawDefinitions?.forEach(d=>{d.entries=(d.entries??[]).filter(p=>!e.includes(p.participantId))}),{...oe,participantIdsRemoved:c}}var sye={[Va]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},AD=sye;function op(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=ol,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:s,entryStage:o=Dt,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return ue({result:{error:wl},stack:g});let v=yi(t.participantIds??[]);if(!m)return{error:Lr};if(!v?.length)return ue({result:{error:zg},stack:g});if(!m?.eventId)return{error:Vc};let y=er({tournamentRecord:l,event:m}).appliedPolicies??{},b=s?.[Va]??y?.[Va]??AD[Va],I=(n??b?.participants?.enforceGender)!==!1,w=[],T=[];if(p&&(!Array.isArray(p)||!p.every(N=>Ep({extension:N})))||h&&!Ep({extension:h}))return ue({context:Ft({extension:h,extensions:p}),result:{error:Se},info:"Invalid extension(s)",stack:g});let S=!!l,D=[],C,E=l?.participants?.filter(N=>{if(!v.includes(N.participantId))return!1;let k=On(wr)(m.eventType)&&N.participantType===Bi&&!Uv(i),x=m.eventType===mr&&N.participantType===Ei;return k&&(!m.gender||!I||tc(m.gender)||mh(m.gender)||Ns(m.gender)===Ns(N.person?.sex))||x&&!Uv(i)?!0:m.eventType===mr&&N.participantType===Bi&&Uv(i)?m.gender&&I&&!(tc(m.gender)||mh(m.gender))&&Ns(m.gender)!==Ns(N.person?.sex)?(D.push({participantId:N.participantId,sex:N.person?.sex}),!1):!0:k&&m.gender&&I&&!(tc(m.gender)||mh(m.gender))&&Ns(m.gender)!==Ns(N.person?.sex)?(D.push({participantId:N.participantId,sex:N.person?.sex}),!1):m.eventType===hr&&(N.participantType===hr||Uv(i)&&N.participantType===Bi)}).map(N=>N.participantId)??[],P=v.filter(N=>!S||E.includes(N));m.entries||(m.entries=[]);let R=m.entries.map(N=>N.participantId||N.participant?.participantId);if(P.forEach(N=>{if(!R.includes(N)){let k=Ft({participantId:N,entryStatus:i,entryStage:o,extensions:p});h&&nr({element:k,extension:h}),d&&nr({extension:{name:Bp,value:d},element:k}),a&&(k.entryStageSequence=a),w.push(k.participantId),m.entries?.push(k)}}),f&&!Uv(o)){let N=t6({participantIds:P,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:i,roundTarget:d,entryStage:o,extension:h,drawId:f,event:m});N.error&&(C=N.error)}if(m.eventType&&[em,_l].includes(m.eventType)){let N=(m.entries||[]).map(V=>V.participantId),k=(m.entries||[]).filter(V=>Uv(V.entryStatus)).map(V=>V.participantId),x=(l?.participants??[]).filter(V=>N.includes(V.participantId)&&V.participantType&&[Ei,hr].includes(V.participantType)).map(V=>V.individualParticipantIds).flat(1/0),O=k.filter(V=>x.includes(V));O.length&&(T.push(...O),v0({participantIds:O,autoEntryPositions:!1,event:m}))}if(P.length!==v.length)return ue({context:{mismatchedGender:D,gender:m.gender},result:{error:wl},stack:g});r&&(m.entries=Id({entries:m.entries||[]}));let M=w.length,A=T.length;return ue({result:{...oe,addedEntriesCount:M,removedEntriesCount:A},stack:g,info:C})}var oye="ADMINISTRATION",qze="CAPTAIN",Wze="COACH",vs="COMPETITOR",lye="MEDIA",cye="MEDICAL",i6="OFFICIAL",uye="OTHER",dye="SECURITY",r6={ADMINISTRATION:oye,CAPTAIN:qze,COACH:Wze,COMPETITOR:vs,MEDIA:lye,MEDICAL:cye,OFFICIAL:i6,OTHER:uye,SECURITY:dye};function n6({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ue({result:{error:et},stack:a});if(!i||!e)return ue({result:{error:Yt},stack:a});let s=(r.participants??[]).find(u=>u.participantId===i);if(!s)return ue({result:{error:_n},stack:a});if(![hr,vc].includes(s.participantType))return ue({result:{participantType:s.participantType,error:Pd},stack:a});let o=pye({individualParticipantIds:e,groupingParticipant:s,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=o;if(c)return ue({result:o,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l?.filter(h=>!d.includes(h));op({participantIds:p,entryStatus:tu,tournamentRecord:r,event:u})}}return l&&Ii({topic:Ss,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...oe,...o}}function pye({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let s=[];if(!e)return{removed:s};let o=[],l=[];a||({participants:a,mappedMatchUps:n}=un({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=a?.find(({participantId:p})=>p===e.participantId)?.events?.map(({eventId:p})=>p),u=(e.individualParticipantIds??[]).filter(p=>{let h=t?.includes(p),f=h&&a?.find(g=>g.participantId===p)?.matchUps.filter(({eventId:g})=>c.includes(g)).map(({matchUpId:g})=>n?.[g]).filter(({winningSide:g,score:v})=>g||ua({score:v})),m=h&&!f?.length;if(h&&!m&&l.push(p),m){s.push(p);for(let g of i.events??[])for(let v of g.drawDefinitions??[]){let{extension:y}=Ci({element:v,name:im}),b=y?.value[e.participantId];y&&b&&(y.value[e.participantId]=b.filter(w=>w.participantId!==p),nr({element:v,extension:y}),XR({drawDefinition:v}));let I=po({drawDefinition:v,inContext:!1}).matchUps??[];for(let w of I){let T=w.sides??[];for(let S of T){let D=S.lineUp??[];D.find(C=>C.participantId===p)&&(S.lineUp=D.filter(C=>C.participantId!==p),Hi({tournamentId:i?.tournamentId,drawDefinition:v,matchUp:w}))}}}}else o.push(p);return!m});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:o,removed:s};return l.length&&!r&&{...d,cannotRemove:l,error:Zx}||d}function jL({participantRole:t=vs,individualParticipantIds:e=[],groupingTypes:i=[Ro,vc],tournamentRecord:r}){if(!r)return{error:et};let n=r.participants??[],{participants:a,mappedMatchUps:s}=un({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),o=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=pye({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:s,participants:a});c&&o++}),o?oe:{error:nme}}function Ow(t){let e=Gt(t,[{[pa]:!0},{participantIds:!0,[Bo]:Rs,[ku]:zg}]);if(e.error)return e;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=t,a=r.participants?.length||0;if(!a)return{...oe};let s=(r.events||[])?.filter(({eventType:f})=>f===ta).map(f=>f?.drawDefinitions?.map(({drawId:m})=>m)).flat(1/0),o=un({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],l=f=>{let m=(Wa({matchUpFilters:{drawIds:f,matchUpTypes:[mr]},tournamentRecord:r}).matchUps??[]).flatMap(({sides:g})=>g?.map(({participantId:v})=>v||[])).filter(Boolean);return En(m,n)},c=s?.length?l(s):[],u=o.filter(f=>f.draws?.filter(m=>(!s?.length||!s?.includes(m.drawId))&&m.positionAssignments).length);if(c?.length||u.length)return{error:yD};let d={},p={};for(let f of r.events||[]){let m=v0({participantIds:n,event:f});if(m.error)return m;d[f.eventId]=m.participantIdsRemoved}r.participants=(r.participants??[]).filter(f=>{let m=n.includes(f.participantId)||f.participantType===Ei&&f.individualParticipantIds?.some(g=>n.includes(g));if(!m&&f.participantType===ta&&f.individualParticipantIds?.some(g=>n.includes(g))&&(f.individualParticipantIds=f.individualParticipantIds.filter(g=>!n.includes(g))),m&&i&&f.participantType&&[Ei,hr].includes(f.participantType))for(let g of f.individualParticipantIds||[])n.includes(g)||(p[f.participantId]||(p[f.participantId]=[]),p[f.participantId].push(g));return!m});let h=a-r.participants.length;if(jL({individualParticipantIds:n,tournamentRecord:r}),i)for(let f of r.events||[]){let m=d[f.eventId].map(g=>p[g]||[]).flat();op({participantIds:m,entryStatus:tu,tournamentRecord:r,event:f})}return h&&Ii({payload:{participantIds:n,tournamentId:r.tournamentId},topic:D5}),h?{...oe,participantsRemovedCount:h}:{error:Zx}}function hye({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){let s=n.entries??[];if(r){let{flightProfile:l}=Rn({event:n}),c=l?.flights?.find(u=>u.drawId===r);c?s=c.drawEntries:e.entries&&(s=e?.entries)}let o=s.filter(l=>(!i?.length||!l.entryStatus||i.includes(l.entryStatus))&&(!a||!l.entryStage||l.entryStage===a)&&(!t||l.entryStatus&&td.includes(l.entryStatus)));return{entries:s,stageEntries:o}}function fye({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:s}){let o="destroyGroupEntry";if(!e)return{error:et};if(!r)return ue({result:{error:oa},stack:o});if(!s)return{error:Lr};if(!s.eventType||![em,_l].includes(s.eventType))return ue({result:{error:xh},stack:o});let l=e.participants??[],c=l.find(v=>v.participantId===r);if(!c)return ue({result:{error:_n},stack:o});if(!c.participantType||![Ei,Ro].includes(c.participantType)||c.participantType===Ro&&s.eventType!==_l||c.participantType===Ei&&s.eventType!==em)return{error:Pd};let u=(s.entries??[]).find(v=>v.participantId===r);if(!u)return{error:lme};let{stageEntries:d}=hye({selected:!1,drawDefinition:i,drawId:n,event:s,stage:a}),p=d.map(Fi),h=l.filter(({participantId:v})=>p.includes(v)).map(({individualParticipantIds:v})=>v).flat().filter(Boolean),f=c.individualParticipantIds?.filter(v=>ap(v,h).length===1),m=v0({participantIds:[r],event:s});if(m.error||f?.length&&(m=op({participantIds:f,entryStatus:tu,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:s}),m.error))return m;let g;return t&&Ow({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...oe,participantRemoved:g}}function a6({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return fye({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function mye(t){if(!t.tournamentRecord)return{error:et};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let s=fye({participantId:a,...i});s.success&&(r+=1),s.error&&n.push(s.error)}return r?{destroyedCount:r,...oe}:{error:n}}function RC(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:s,drawId:o}=t,l="removeDrawPositionAssignment",c=f0(t);if(c.error)return ue({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t,f=er({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([Ou,Hh].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=Zg({tournamentRecord:g,participantId:u}),{participantType:y,individualParticipantIds:b}=v??{};if(n&&y===Ei){let I=a6({tournamentRecord:g,drawDefinition:r,participantId:u,event:p});if(I.error)return ue({result:I,stack:l});b&&w_({participantIds:b,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}else w_({participantIds:[u],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:o,event:p})}if(i){let g=bc({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:h,matchUpsMap:s,event:p});if(g.error)return ue({result:g,stack:l})}let{structure:m}=oi({drawDefinition:r,structureId:h});return x5({structure:m,drawPositions:[d]}),RL({appliedPolicies:f,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function gye(t){return Object.assign(t,{entryStatus:Hh}),RC(t)}var ag=({finishingPosition:t=Tw,hasExistingDrawDefinition:e,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:s,structureOrder:o,seedingProfile:l,matchUpFormat:c,structureType:u,structureName:d,matchUps:p=[],matchUpType:h,structureId:f,roundOffset:m,roundLimit:g,stageOrder:v,structures:y,tieFormat:b,stage:I})=>{let w={structureId:f??lr(),structureAbbreviation:r,finishingPosition:t,seedAssignments:n,matchUpFormat:c,stageSequence:a,structureName:d};(s||e&&b)&&(w.tieFormat=b),o&&(w.structureOrder=o),u&&(w.structureType=u),l&&(typeof l=="string"?w.seedingProfile=l:typeof l=="object"&&typeof l.positioning=="string"&&(w.seedingProfile=l.positioning)),h&&(w.matchUpType=h),m&&(w.roundOffset=m),v&&(w.stageOrder=v),g&&(w.roundLimit=g),I&&(w.stage=I),i&&(w.qualifyingRoundNumber=i);let T=p.flatMap(({drawPositions:S})=>S).filter(Boolean);return y?w.structures=y:(w.matchUps=p,w.positionAssignments=yi(T).sort((S,D)=>S-D).map(S=>({drawPosition:S}))),w},kc=ag;function Ij(t){return Yr(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ys(t){return Yr(t)?Ij(t.replace(/_/g," ")):""}function s6({structureName:t=ys($a),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:At};let a=kc({stage:$a,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),Cr({drawDefinition:i,structureIds:[a.structureId]}),{...oe}}function o6({drawPositions:t}){if(!t?.length)return{error:_R};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=yi(i.map(GL)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function GL(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ea).join("|")}function vye({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),s=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],s[v]])});let h=a.shift(),f=a.pop(),m=s.shift();a=[h,m,...a].filter(Boolean),s=[...s,f].filter(Boolean)});let o=a.shift(),l=a.pop(),c=s.shift();a=[o,c,...a].filter(Boolean),s=[...s,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return GL(h)}))}function Yze({rounds:t,hash:e}){return t?.length?t?.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Yt}}var Kze={getRoundRobinGroupMatchUps:o6,determineRoundNumber:Yze,drawPositionsHash:GL,groupRounds:vye};function y0(t){let{hasExistingDrawDefinition:e,groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:s,qualifyingOnly:o,seedingProfile:l,stage:c=Dt,matchUpType:u,roundTarget:d,structureId:p,groupNames:h,tieFormat:f,drawSize:m,idPrefix:g,isMock:v,uuids:y}=t,b=t.structureName??r?.["0"]?.name??ys(Dt),{groupCount:I,groupSize:w}=Zze({structureOptions:a,appliedPolicies:s,drawSize:m}),T=py,S,D=yt(1,I+1).map(E=>{let P=Xze({groupSize:w,structureOrder:E,matchUpType:u,drawSize:m,idPrefix:g,isMock:v});S=Array.isArray(P)?Math.max(...P.map(({roundNumber:M})=>M??0)):0;let R=h?.[E-1]??`${i} ${E}`;return ag({structureId:y?.pop(),hasExistingDrawDefinition:e,structureType:dL,finishingPosition:T,qualifyingOnly:o,structureOrder:E,structureName:R,tieFormat:f,matchUps:P})}),C=ag({structureId:p??y?.pop(),hasExistingDrawDefinition:e,structureType:To,finishingPosition:T,seedingProfile:l,structureName:b,stageSequence:n,structures:D,tieFormat:f,stage:c});return d&&nr({extension:{name:Bp,value:d},element:C}),{structures:[C],maxRoundNumber:S,groupCount:I,links:[],groupSize:w,...oe}}function Zze({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e?.groupSize,n=e?.groupSizeLimit||8,{validGroupSizes:a}=b0({groupSizeLimit:n,drawSize:i}),s=a&&Math.max(...a);r&&a?.includes(r)||(r&&r>4||!a?.includes(4)?r=s:r=4);let o=Math.ceil(i/r);return{groupSize:r,groupCount:o}}function b0(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=yt(3,e+1).filter(n=>{let a=Math.ceil(i/n),s=a*n-i,o=Math.ceil(i/a),l=Math.ceil(s/a);return(!s||s<n)&&o===n&&o>=3&&l<2});return{...oe,validGroupSizes:r}}function Xze({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:s}){let o=(t-1)*i,l=yt(1+o,i+1+o),c=o6({drawPositions:l}).uniqueMatchUpGroupings??[],u=vye({groupSize:i,drawPositionOffset:o});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=GL(h),m=d(f),g=[1,r],v=Jze({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:n,uuids:s}),y={matchUpStatus:m?Pn:"BYE",matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function Jze({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:n?.pop()||lr()}function l6(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!mi(i))return{seedBlocks:void 0,...ue({result:{error:Se},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=hD(i);if(e){let h=Math.min(e,n),f=[],m=1;for(yt(0,h).forEach(()=>{f.push([m]),m++});m<n;){let g=yt(m,m+h);m+=h,f.push(g)}return{...oe,seedBlocks:f}}let a=yt(1,n+1),s=[],o=n/2;for(;o>1;){let h=Ra(a,o),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],w=m[m.length-1];r&&f>4?f===8?v=y?w:I:v=b?I:w:v=y?I:w,go(m,s)||s.push(v)}),o=o/2}let l=a.filter(h=>!s.includes(h));for(;l.length;)l.length%2===0?s.push(l.pop()):s.push(l.shift());let c=yt(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return yt(0,u).forEach(h=>{p.push(s.slice(d,d+c[h])),d+=c[h]}),{...oe,seedBlocks:p}}function c6({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!mi(e))return{seedGroups:void 0,...ue({result:{error:Se},context:{drawSize:e},stack:i})};if(t){if(!mi(t))return{seedGroups:void 0,...ue({context:{roundRobinGroupsCount:t},result:{error:Se},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:yt(0,n).map(()=>{let a=yt(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=l6({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function u6({roundRobinGroupsCount:t,participantsCount:e}){if(t){let{validGroupSizes:n}=b0({drawSize:e});if(!n?.map(a=>Math.ceil(e/a))?.includes(t))return ue({context:{roundRobinGroupsCount:t},result:{error:Se}})}let{seedGroups:i}=c6({drawSize:e,roundRobinGroupsCount:t}),r=i?.map(n=>Math.min(...n))||[];return{...oe,seedingThresholds:r}}function sU(t){if(!t)return 1/0;if(mi(t))return ri(t);let e=t.split("-")[0];return mi(e)?ri(e):1/0}function Qze({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ea),e.reverse(),e}function eqe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function tqe({positioning:t,size:e}){let i=Qze({size:e}),r=[],n=[],a=p=>p[0],s=p=>p[p.length-1],o=(p,h)=>(t&&[uL,uy].includes(t)&&h%2?s(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!n.includes(f))){let f=o(p,h);return n.push(f),f}},c=p=>{let h=p.filter(f=>!n.includes(f));if(h.length)return n.push(...h),h},u=(p,h)=>{let f=o(p,h);if(!n.includes(f))return n.push(f),f},d=yt(1,e+1);for(let p of i)if(p===1){let h=Ra(d,2),f=h.map(l).filter(Boolean);f.length&&r.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&r.push(m)}else{let h=Ra(d,p).map(u).filter(Boolean);h.length&&r.push(h)}return{divisions:i,divisionGroupings:r}}function xw({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:s}){let o=[];if(!s)return{error:jy};let{matchUps:l,roundMatchUps:c}=ar({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:s}),{seedAssignments:u}=Hc({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:s}),{positionAssignments:d}=ca({structure:s}),p=d?.length,h=u?.length??0,f=[],m=Object.keys(c).map(k=>parseInt(k)).sort((k,x)=>k-x).map(k=>{let x=c[k].map(V=>V.drawPositions).flat(1/0).filter(Boolean),O=x.filter(V=>!f.includes(V));return f=f.concat(...x),O}).filter(k=>k.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let y=g?.length||0,b=m.filter(k=>k.filter(x=>x<=h).length),{stage:I,structureType:w,roundLimit:T}=s,S=w===To,D=!S&&m?.length,C=!S&&I===zt&&T,E=b.flat(1/0),P=D?E?.length:0,R=a?p:h,M=G5({drawDefinition:n,structure:s,matchUps:l}),A=M?0:!D&&R||R&&E.length<R&&R-E.length||0;if(C){let k=s?.matchUps?s.matchUps.filter(({roundNumber:O})=>O===s.roundLimit).length:0,x=g.length/k;if(!D){let O=I0(r),V=Ra(g,x),F=1,j=yt(0,V[0].length).map(()=>{let q=yt(F,F+V.length);return F+=V.length,q});({validSeedBlocks:o}=yye({drawPositionBlocks:V,nonRandom:r?.nonRandom,positioning:O,seedGroups:j}))}}else S?{validSeedBlocks:o}=iqe({nonRandom:r?.nonRandom,seedingProfile:r,structure:s}):D?o=b.map(k=>({seedNumbers:k,drawPositions:k})):M&&Ra(g,2).map((k,x)=>({drawPositions:[k[0]],seedNumbers:[x+1]})).forEach(k=>o.push(k));if(!S&&!M&&!C){let{blocks:k}=rqe({drawPositionOffset:v,seedNumberOffset:P,seedCountGoal:A,seedingProfile:r,baseDrawSize:y});k.forEach(x=>o.push(x))}let N=o.flatMap(k=>k.drawPositions).reduce((k,x)=>g?.includes(x)&&k,!0);return!M&&!D&&!S&&!N?{error:kfe,validSeedBlocks:[],isContainer:S,isFeedIn:D}:{isLuckyStructure:M,validSeedBlocks:o,isContainer:S,isFeedIn:D}}function iqe({seedingProfile:t,structure:e,nonRandom:i}){let r=e.structures||[],n=r.length,a=Tr({structure:e})?.positionAssignments,s=I0(t),o=a?.length??0,{seedGroups:l}=c6({roundRobinGroupsCount:n,drawSize:o}),c=r.map(u=>Tr({structure:u}).positionAssignments?.map(d=>d.drawPosition));return yye({drawPositionBlocks:c,positioning:s,seedGroups:l,nonRandom:i})}function yye({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=tqe({size:i.length,positioning:e}),s=[];return i.forEach((o,l)=>{let c=eqe({blockPattern:a,index:l});o.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==uy?h=r?h:co(h):l%2&&h.reverse();let f=h.find(m=>!s.includes(m));f&&(s.push(f),n.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function rqe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:s}=t,o=1,l=[],{seedBlocks:c}=l6({cluster:I0(n)===uL,participantsCount:s,roundRobinGroupsCount:i});o=0;for(let d of c){if(o+1>a)break;let p=d.map(f=>f+e),h=u(o+1,d.length).map(f=>+f+r);o+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function T_({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:s}=oi({drawDefinition:e,structureId:n});t||(t=er({drawDefinition:e}).appliedPolicies);let o=i?.validSeedBlocks;return!o&&s&&(o=xw({appliedPolicies:t,drawDefinition:e,structure:s})?.validSeedBlocks),t?.seeding?.validSeedPositions?.ignore?!0:t?.seeding?.validSeedPositions?.strict?(o.find(l=>l.seedNumbers.includes(a))?.drawPositions||[]).includes(r):[].concat(...o.map(l=>l.drawPositions)).includes(r)}function bye(t){let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:s}=t,{structure:o}=oi({drawDefinition:i,structureId:a}),{seedAssignments:l}=Hc({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:o}),{positionAssignments:c}=ca({structure:o}),u=c?.filter(R=>R.participantId??R.bye??R.qualifier)?.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:d}=er({drawDefinition:i}),p=(n?.validSeedBlocks||o&&xw({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:o})?.validSeedBlocks||[]).filter(R=>R.drawPositions.filter(M=>!u?.includes(M)).length)[0],h=l?.map(R=>R.participantId).filter(Boolean),f=c?.map(R=>R.participantId).filter(Boolean),m=h?.filter(R=>f?.includes(R)),g=h?.filter(R=>!f?.includes(R)),v=l?.filter(R=>g?.includes(R.participantId)),y=l?.filter(R=>!R.participantId),b=(v?.length&&v.length>0?v.length:y?.length??0)&&p?.drawPositions.filter(R=>!u?.includes(R))||[],I=s?co(b):b,w=[],T=I.map(()=>{let R=P(v,w)?.participantId;return R&&w.push(R),R}).filter(Boolean),S=l?.filter(R=>m?.includes(R.participantId)).map(R=>R.seedNumber),D=(p?.seedNumbers||[]).filter(R=>!S?.includes(R)),C=l?.filter(R=>D.includes(R.seedNumber)).map(R=>R.participantId),E=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?T:C,unplacedSeedNumbers:D,unfilledPositions:I,unplacedSeedAssignments:v};function P(R,M){let A=R.filter(x=>!M.includes(x.participantId)),N=Math.min(...A.map(x=>sU(x.seedValue))),k=A.filter(x=>sU(x.seedValue)===N);return co(k).pop()}}function I0(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function _D({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:s,seedNumber:o,seedValue:l,eventId:c,event:u}){let d="assignSeed",{structure:p}=oi({drawDefinition:i,structureId:s}),{positionAssignments:h}=ca({structure:p}),f=Hc({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(w=>w.seedNumber),g=Wb({drawDefinition:i,participantId:n});if(n&&!g)return ue({result:{error:Ed},context:{participantId:n},stack:d});let v=u?Rn({event:u}).flightProfile?.flights?.length:0,y=v&&v>1,b=h?.find(w=>w.participantId===n)?.drawPosition;if(b&&!T_({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:s,seedNumber:o}))return ue({result:{error:g4},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(o)||f.push({seedNumber:o,seedValue:l});let I;return f.forEach(w=>{w.participantId===n&&w.seedNumber!==o&&(w.participantId=void 0),w.seedNumber===o&&(w.participantId=n,!r?.groupSeedingThreshold&&!y&&(w.seedValue=l??o),I=!0)}),I?(Ive({tournamentId:e?.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...oe}):ue({result:{error:_fe},stack:d})}function d6({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:s}){let o=t?.sides?.[e]?.sideNumber,l=o&&a.sides?.find(p=>p.sideNumber===o),{extension:c}=Ci({element:n,name:im}),u=c?.value||{},d=Et(u[i],!1,!0);if(l)a?.sides?.forEach(p=>{p.sideNumber===o&&(p.lineUp=d)});else{a.sides=[1,2].map(h=>({...a.sides?.find(f=>f.sideNumber===h)??{},sideNumber:h}));let p=a.sides.find(h=>h.sideNumber===o);p&&(p.lineUp=d)}Hi({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:s?.eventId,drawDefinition:n,matchUp:a})}function Iye(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,s=i.roundNumber>1&&i.roundNumber-1,o=Tg({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=o.find(({drawPositions:f,roundNumber:m})=>m===s&&f?.includes(a)));let l=e?.roundPosition,c=l%2?1:-1,u=l+c,d=s&&o.find(({roundNumber:f,roundPosition:m})=>f===s&&m===u),p=d?.matchUpStatus,h=[ln,ra].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function nqe({drawPosition:t,drawPositions:e}){let i=!1,r=!!e?.includes(t);return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ea).filter(Boolean),positionAdded:i,positionAssigned:r}}function wye({structureId:t,matchUpsMap:e,matchUp:i}){let r=i?.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Tg({matchUpsMap:e,structureId:t}).find(({roundNumber:s,roundPosition:o})=>s===i?.roundNumber&&o===a)}}function Sye({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(o=>o.matchUpId===i),{pairedPreviousMatchUp:s}=wye({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&s){let o=s?.matchUpId,l=t.find(u=>u.matchUpId===o),c=a?.structureId===l?.structureId?a?.roundPosition<l?.roundPosition&&1||2:a.structureId===l?.structureId&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=Yr(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function BN({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,s)=>a.drawPositions?.includes(e)?s+1:n,void 0)}function Yb({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:s,matchUpsMap:o,matchUpId:l,event:c}){let u="assignMatchUpDrawPosition";o||(o=rs({drawDefinition:n})),t||(t=qn({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[]);let d=t.find(M=>M.matchUpId===l),p=d?.structureId,h=n?.structures?.find(M=>M.structureId===p);if(!h)return{error:en};let f=o?.drawMatchUps?.find(M=>M.matchUpId===l),m=f?.drawPositions??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=nqe({drawPositions:m,drawPosition:s}),{positionAssignments:b}=Tr({drawDefinition:n,structure:h}),I=b?.filter(M=>y.includes(M.drawPosition))?.find(({bye:M})=>M),w=f?.matchUpStatus&&_s(f.matchUpStatus)&&y.filter(Boolean).length<2;a=I&&"BYE"||a||w&&f.matchUpStatus||f?.matchUpStatus&&[ln,ra].includes(f.matchUpStatus)&&f.matchUpStatus||Pn;let T=!!(_s(f?.matchUpStatus)&&f?.winningSide);if(f&&g){t=qn({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[];let M=w&&BN({inContextDrawMatchUps:t,drawPosition:s,matchUpId:l})||T&&f.winningSide||void 0;f?.matchUpStatusCodes&&Sye({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:o,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:M,matchUpStatus:T?f?.matchUpStatus:a}),Hi({tournamentId:i?.tournamentId,eventId:d?.eventId,context:u,drawDefinition:n,matchUp:f})}let S=yo({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:C,loserTargetDrawPosition:E},targetLinks:{loserTargetLink:P}}=S,R=Tg({structureId:h.structureId,matchUpsMap:o});if(v&&I){if(D)if(["BYE",ln,ra].includes(a)){let M=Yb({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}else{let{structureId:M}=D;M!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(v&&T){if(D){let M=Yb({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(M.error)return M}}else if(D&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:M}=Iye({targetMatchUp:f,drawPosition:s,matchUpsMap:o,structure:h});if(M){let A=Yb({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:o});if(A.error)return A}}if(f?.matchUpType===kr){let M=t?.find(({matchUpId:k})=>k===f.matchUpId),A=(M?.sides??[]).reduce((k,x,O)=>x.drawPosition===s?O:k,void 0),N=b?.find(k=>k.drawPosition===s)?.participantId;N&&A!==void 0&&d6({inContextTargetMatchUp:M,drawPositionSideIndex:A,teamParticipantId:N,tournamentRecord:i,drawDefinition:n,matchUp:f})}if(P?.linkCondition===Dp&&y.filter(Boolean).length===2&&!I&&R.filter(({drawPositions:M,roundNumber:A})=>A===1&&go(M,y)).every(({matchUpStatus:M})=>[Tn,wa].includes(M))&&C){let{structureId:M}=C,A=bc({drawPosition:E,tournamentRecord:i,drawDefinition:n,structureId:M,matchUpsMap:o,event:c});if(A.error)return A}return v?{...oe}:ue({result:{error:qT},context:{drawPosition:s},stack:u})}function Tye({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){let a=CD({drawDefinition:e})?.containedStructures?.[n.structureId]?.map(({structureId:u})=>u)||[];a.push(n?.structureId);let s=i?.map(({drawPosition:u})=>u)||[],o=t?.filter(u=>a.includes(u.structureId)&&En(u.drawPositions??[],s).length)??[],l=o.map(({matchUpId:u})=>u),c=r?.drawMatchUps?.filter(u=>l.includes(u.matchUpId))??[];return{drawPositions:s,matchUps:c,targetMatchUps:o}}function p6({lineUp:t}){if(!Array.isArray(t))return;let e={};return yi(t.flatMap(({collectionAssignments:i})=>i?.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:s}=I_({collectionPosition:a,collectionId:r,lineUp:t});s.forEach(o=>{e[o]||(e[o]=[]),e[o].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function vy(t){return`${t} must be an array`}function HL({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(vy("lineUp")),{valid:!1,errors:i,error:Se};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:s,collectionAssignments:o}=a;return s?typeof s!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(o)?o.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(vy("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=yi(t.map(Fi)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?Se:void 0}}function Lw({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:At};if(typeof e!="string")return{error:oa};let n=HL({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=Ci({element:t,name:im}),s=a?.value||{};return s[e]=p6({lineUp:r}),nr({element:t,extension:{name:im,value:s}}),XR({drawDefinition:t}),{...oe}}function h6({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:s,event:o}){if(!r)return{error:At};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Tye({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:s});for(let d of u)d.matchUpType===oc&&(d.sides??[]).forEach((p,h)=>{if(p?.drawPosition&&l?.includes(p.drawPosition)){let f=c.find(({matchUpId:m})=>m===d.matchUpId);if(f?.sides?.[h]){if(delete f.sides[h].lineUp,e===!1){let m=d.tieFormat,g=p.participantId;m&&g&&Lw({drawDefinition:r,participantId:g,lineUp:[],tieFormat:m})}Hi({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:o?.eventId,drawDefinition:r,matchUp:f})}}});return{...oe}}function Pp({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:o,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){let h="assignDrawPosition";if(!o&&!i)return ue({result:{error:oa},stack:h});u=u??rs({drawDefinition:a}),e||({matchUps:e}=qn({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=oi({drawDefinition:a,structureId:d});if(f.error)return ue({result:f,stack:h});let{structure:m}=f;if(!m)return{error:en};if(xo({structure:m}))return ue({result:{error:al},stack:h});let{seedAssignments:g}=Hc({provisionalPositioning:t,drawDefinition:a,structure:m}),v=g?.find(E=>E.participantId===o)?.seedNumber,{appliedPolicies:y}=er({tournamentRecord:n,drawDefinition:a,structure:m,event:p});if(v&&!T_({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return ue({result:{error:g4},context:{drawPosition:c},stack:h});let b=ca({structure:m}).positionAssignments||[],I=b?.find(E=>E.drawPosition===c);if(!I)return ue({result:{error:fD},context:{drawPosition:c},stack:h});if(b?.map(Fi).includes(o))return ue({result:{error:yD},context:{drawPosition:c},stack:h});let{containsParticipant:w,containsBye:T}=C(I);if(T){let E=f0({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(E.error)return ue({result:E,stack:h})}if(w&&I.participantId!==o){let{activeDrawPositions:E}=h0({drawDefinition:a,structureId:d});if(E.includes(c))return ue({result:{error:zx},stack:h});h6({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m})}if(I.participantId=o,i&&(I.qualifier=!0),m.stage===Dt&&(!m.stageSequence||m.stageSequence>1)||m.stage&&[ws,wn].includes(m.stage)){let E=m.stage===zt?zt:Dt,P=(a.structures?.find(R=>R?.stage===E&&R?.stageSequence===1)?.seedAssignments??[]).find(R=>R.participantId===o);if(P?.participantId){let{participantId:R,seedNumber:M,seedValue:A}=P;_D({eventId:p?.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:s,participantId:R,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(m.structureType!==To)aqe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{tye({positionAssignments:b,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:E,matchUps:P,targetMatchUps:R}=Tye({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(E&&P?.length===1&&P[0].matchUpType===kr){let M=(R?.[0].sides??[]).reduce((A,N,k)=>E?.includes(N.drawPosition)?k:A,void 0);d6({inContextTargetMatchUp:R[0],teamParticipantId:o,matchUp:P[0],drawPositionSideIndex:M,tournamentRecord:n,drawDefinition:a})}}let S=a.entries?.find(E=>E.participantId===o),D=p?.entries?.find(E=>E.participantId===o);return!S&&D&&e6({entryStatus:D.entryStatus,entryStage:m.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:o,event:p}),Sg({tournamentId:n?.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...oe};function C(E){let P=E.bye,R=E.qualifier,M=E.participantId;return{containsBye:P,containsQualifier:R,containsParticipant:M,filled:P||R||M}}}function aqe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s,structure:o,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=ar({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:s,structure:o,event:l}),{roundMatchUps:d}=vo({matchUps:u}),{initialRoundNumber:p}=DI({drawPosition:a,matchUps:u}),h=p&&d?.[p].find(f=>f.drawPositions?.includes(a));if(h){let f=Yb({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:s});if(f.error)return ue({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...oe}}function f6(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:At};let d=er({tournamentRecord:n,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:h}=t;h||(h=rs({drawDefinition:a}),Object.assign(t,{matchUpsMap:h})),p||({matchUps:p}=qn({inContext:!0,drawDefinition:a,matchUpsMap:h}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Tr({drawDefinition:a,structureId:l}),m=f?.find(I=>I.drawPosition===o);if(m?.participantId){let I=m.participantId,w=Pp({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});return w.success?b({appliedPolicies:d,removedParticipantId:I}):ue({result:w,stack:u})}let g=f0({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(g.error)return ue({result:g,stack:u});let v=g.participantId,y=Pp({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:s,drawPosition:o,structureId:l,matchUpsMap:h,event:c});if(!y.success)return ue({result:y,stack:u});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:w}){let{structure:T}=oi({drawDefinition:a,structureId:l});x5({drawPositions:[o],structure:T});let S={[e]:s,name:r,drawPosition:o,structureId:l};return RL({appliedPolicies:I,drawDefinition:a,positionAction:S}),ue({context:{removedParticipantId:w},result:{...oe},stack:u})}}function sqe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return f6({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function Uye(t){return sqe(t)}function Dye({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let s of i.matchUps)e[s.matchUpId]&&(s.roundNumber=e[s.matchUpId],Hi({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:s}))}function Eye(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=Gt(t,i);if(r.error)return r;let n=oi(t);if(n.error)return n;let a=n.structure;if(!xo({structure:a}))return ue({result:{error:Vy,message:"structure must be adHoc"}});let{roundMatchUps:s=[],roundNumbers:o}=vo({matchUps:a?.matchUps});return o?.length?{valid:!0,structure:a,roundMatchUps:s,roundNumbers:o}:{error:wm}}function Pye(t){let e=Eye(t,[{targetRoundNumber:!0,roundNumber:!0,[Bo]:XGe}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:s}=t;if(!n?.includes(s)||!n?.includes(a))return ue({result:{error:Se},info:"roundNumbers must be valid rounds"});let o=a>s,l=o?yt(s+1,a+1):yt(a,s),c={};return l.forEach(u=>(r?.[u]??[]).forEach(({matchUpId:d})=>{c[d]=u-(o?1:-1)})),r?.[s]?.forEach(({matchUpId:u})=>c[u]=a),Dye({params:t,modMap:c,structure:i}),{...oe}}function Cye({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:At};if(!Array.isArray(t))return{error:Se};let a="setPositionAssignments";for(let o of t){let{structureId:l,positionAssignments:c}=o;if(!c)continue;let u=oi({drawDefinition:r,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:en};let p=Tr({structure:d}).positionAssignments?.map(({drawPosition:g})=>g),h=c?.map(({drawPosition:g})=>g);if(En(p,h).length!==p?.length)return ue({result:{error:Se},info:"drawPositions do not match",stack:a});let f=rs({drawDefinition:r}),{matchUps:m}=qn({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let g of c||[]){let{drawPosition:v,participantId:y,bye:b,qualifier:I}=g;if(b){let w=bc({tournamentRecord:i,drawDefinition:r,drawPosition:v,matchUpsMap:f,structureId:l,structure:d,event:n});if(w?.error)return w}else if(I)c.forEach(w=>{w.drawPosition===v&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(y){let w=Pp({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:r,participantId:y,drawPosition:v,matchUpsMap:f,structureId:l,event:n});if(w?.error)return w}}Sg({tournamentId:i?.tournamentId,drawDefinition:r,structure:d,event:n})}let s=t.map(({structureId:o})=>o);return Cr({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:s}),{...oe}}function Rye(t){let e=Eye(t,[{roundNumbers:!0,[Bo]:Rs,[hs]:s=>s.length===2&&s.every(vn)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(s=>n?.includes(s)))return ue({result:{error:Se,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((s,o)=>(r?.[s]??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-o]})),Dye({params:t,modMap:a,structure:i}),{...oe}}function Mye({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return f6({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function Nye({drawDefinition:t,structureId:e}){if(!t)return{error:At};let{structure:i}=oi({drawDefinition:t,structureId:e}),r=(t?.links||[]).filter(n=>n.source?.structureId===e).map(n=>n.target?.structureId);return{playoffStructures:(t?.structures||[]).filter(n=>r.includes(n.structureId)),structure:i}}function zL({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:s}){if(!a)return{error:Lr};let o={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Wu({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:s});if(l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function m6({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:s}){if(!e)return{error:et};let o={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=zL({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:s});if(u&&l.push(...u),d)for(let p of Object.keys(d))o[p]||(o[p]=[]),o[p].push(...d[p])}return{structures:l,stageStructures:o}}function qh(t){if(!t?.drawDefinition)return!1;let e=$L(t),i=e?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r?.filter(({matchUpType:s})=>s===kr),n=n?.filter(({matchUpType:s})=>s===kr),a=a?.filter(({matchUpType:s})=>s===kr)),!!(r?.length&&!n?.length&&!a?.length)}function g6(t){let{drawDefinition:e,structureId:i}=t;if(!e)return{error:At};let{playoffStructures:r}=Nye({drawDefinition:e,structureId:i});if(!r?.length)return!1;let n=e?.entries?.filter(s=>s?.entryStatus&&td.includes(s.entryStatus))?.length??0,a=0;return(r||[]).reduce((s,o)=>!!((Tr({structure:o}).positionAssignments??[])?.filter(l=>(l.participantId&&a++,l?.bye??l?.participantId)).length&&s),!!r.length)||a===n}function wj({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i?.[n]){let s=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(o=>{let l=wj({accessors:s,significantCharacters:t,value:o});r.push(...l)});else if(i=i[n],s.length){let o=wj({accessors:s,significantCharacters:t,value:i});r.push(...o)}else a({value:i})}function a({value:s}){if(s&&["string","number"].includes(typeof s)){let o=t?s.slice(0,t):s;r.push(o)}}return r}function oqe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:E4};if(!Array.isArray(r))return{error:LR};let n={};return t.forEach(a=>{let s=r.find(l=>l.participantId===a),{values:o}=Aye({policyAttributes:e,idCollections:i,participants:r,participant:s});o&&o.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function Aye({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:E4};if(!r)return{error:vw};let n=[];return t.forEach(a=>{let{directive:s,groupings:o,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(...wj({significantCharacters:c,value:r,accessors:u}))}else if(s){let u=a?.includeIds,d=(e?.[s]||[]).filter(p=>!u||u.includes(p));d?.length&&i?.length&&d.forEach(p=>{let h=i.find(f=>f.participantId===p);if(h?.individualParticipantIds?.includes(r.participantId)){let f=h?.participantId;n.push(f)}})}else o&&Object.keys(o).forEach(u=>{o[u].includes(r.participantId)&&n.push(u)})}),{values:yi(n)}}function _Z({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let s=n[a.participantId],{values:o}=Aye({participants:e,policyAttributes:i,idCollections:r,participant:s});return{...a,values:o}})}function _ye({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r?.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,s=t?t[a]||[]:[],o=!!i.some(l=>s.includes(l));return{[n]:{participantGroups:s,includesGroupsToAvoid:o}}}))}function lqe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=_ye(t);return i.map(a=>{let s=e.filter(c=>a.includes(c)),o=n(s),l=s.filter(c=>!o.includes(c)).filter(c=>{let u=kZ(c);return!r[u]?.includesGroupsToAvoid});return{unassigned:s,unpaired:o,pairedNoConflict:l}});function n(a){return a.filter(o=>!s(o));function s(o){let l=kZ(o);return!a.includes(l)}}}function cqe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=_ye(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),s=a.length===n.length?a:[],o=n.filter(l=>r[l]?.includesGroupsToAvoid).length;return{unassigned:a,unpaired:s,pairedNoConflict:o?[]:a,conflictsCount:o}})}function kZ(t){return Number(t%2?t+1:t-1)}function uqe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function dqe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let s=r.map(o=>a?cqe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):lqe({groupsToAvoid:t,chunkedDrawPositions:o,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:o,unpaired:l,pairedNoConflict:c}}else{let o=s.map(u=>u.map(d=>d.unassigned).filter(d=>d?.length)).filter(u=>u?.length),l=s.map(u=>u.map(d=>d.unpaired).filter(d=>d?.length)).filter(u=>u?.length),c=s.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d?.length)).filter(u=>u?.length);return{unassigned:o,unpaired:l,pairedNoConflict:c}}}function kye({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function pqe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map(c=>[c,r[c].filter(u=>e.includes(u))]).filter(c=>c[1].length).map(([c,u])=>({[c]:u}))),s=Object.keys(a).reduce((c,u)=>a[u].length>c?a[u].length:c,0),o=Object.keys(a).filter(c=>a[c].length===s),l=Tu(i?o:Object.keys(a));return n=t&&a[n]?.length?n:l,{participantId:n&&a[n]?Tu(a[n]):Tu(e),groupKey:n}}function hqe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function fqe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:s,groupKey:o}){let l=n.reduce((D,C)=>C.length>D?C.length:D,0)<=2,c=kye({positionAssignments:t,participantIds:e}),u=hqe({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=pqe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:s,groupKey:o}),h=uqe({participantId:d,allGroups:s}),f=dqe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=v?.length&&v[0],b=g?.length&&g[0],I=a&&y?y:b,w=a?b:y,T=I?.length&&I||w?.length&&w,S;if(T?.length){let D=yl(T);S=yl(D)}else{let D=yl(m[0]);S=yl(D)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function U_({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(o=>o.drawPosition),a=o6({drawPositions:n}).uniqueMatchUpGroupings??[],s=Object.assign({},...r.map(o=>({[o.drawPosition]:o})));a.forEach(o=>{go(s[o[0]].values||[],s[o[1]].values||[])&&(i.push(o),r.conflict=!0)})}):e.forEach(r=>{go(r[0]?.values||[],r[1]?.values||[])&&(i.push(r),r.conflict=!0)}),i}function mqe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let s=a.map(o=>o.drawPosition);return a.filter(o=>e.includes(o.drawPosition)).map(o=>{let l=e.filter(c=>!s?.includes(c)).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=U_({isRoundRobin:n,groupedParticipants:[[o,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=U_({isRoundRobin:n,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:o.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function OZ(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:s,idCollections:o,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(b=>b?.length).filter(Boolean)),p=d>2,h=Et(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||n?.includes(b.drawPosition))).map(b=>b.drawPosition);yt(0,r).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:w}=fqe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(T=>{T.drawPosition===w&&(T.participantId=I)})});let m=_Z({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ra(m,d),v=U_({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=mqe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=gqe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=_Z({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:s,idCollections:o}),g=Ra(m,d),v=U_({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=XV;c.push(I)}if(b.qualifier&&b.participantId){let I=XV;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function gqe({candidatePositionAssignments:t,swapOptions:e}){let i=yl(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=yl(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),s=t.find(c=>c.drawPosition===n)??{},o={participantId:s?.participantId,qualifier:s?.qualifier,bye:s?.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,o),Object.assign(s,l),{...oe}}function vqe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){if(!u)return{error:zfe};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=oi({drawDefinition:a,structureId:c}),{matchUps:b}=ar({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&Dd(m)&&!g){let j=QVe(m)||0,q=b.reduce((W,z)=>z.roundNumber>W?z.roundNumber:W,0);g=q<j?1:q-j+1}let{positionAssignments:I}=ca({structure:y}),w=NL({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:o}).participantsWithGroupings,T=I?.filter(j=>!j.participantId),S=I?.map(j=>j.drawPosition),D=y?.structureType===To,C=D?{structure:y,matchUps:b,allDrawPositions:S,roundsToSeparate:g}:{matchUps:b,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:P}=D?yqe(C):bqe(C),R={groupParticipants:o.filter(j=>j.participantType===vc).map(j=>j.participantId),teamParticipants:o.filter(j=>j.participantType===hr).map(j=>j.participantId),pairParticipants:o.filter(j=>j.participantType===Ei).map(j=>j.participantId)},M=oqe({targetParticipantIds:e,policyAttributes:f,idCollections:R,participants:o});if(M.error)return ue({result:M,stack:v});let A=Object.assign({},...e.map(j=>{let q=Object.keys(M).filter(W=>(M[W]??[]).includes(j));return{[j]:q}})),N=kye({participantIds:e,positionAssignments:I});if(N.length>(T?.length||0))return{error:A4};let k,x=N.length,O=yt(0,h).map(()=>OZ({initialPositionAssignments:I,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:R,allGroups:M,drawSize:d}));if(k=O.reduce((j,q)=>!j||(q.conflicts||0)<(j.conflicts||0)?q:j,void 0),!k||k.conflicts){let j=yt(0,h).map(()=>OZ({initialPositionAssignments:I,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:R,allGroups:M,drawSize:d}));k=O.concat(...j).filter(q=>!q.errors?.length).reduce((q,W)=>!q||(W.conflicts||0)<(q.conflicts||0)?W:q,void 0)}if(!k)return{error:eL};let V=(Tr({structure:y})?.positionAssignments??[]).filter(j=>j.participantId).map(j=>j.participantId),F=k.positionAssignments.filter(j=>!V.includes(j.participantId));for(let j of F)if(j.bye){let q=bc({tournamentRecord:n,drawDefinition:a,structureId:c,matchUpsMap:l,event:p,...j});if(q.error)return ue({result:q,stack:v})}else if(j.participantId){let q=Pp({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,event:p,...j});if(q.error)return ue({result:q,stack:v,context:{assignment:j}})}return{...oe}}function yqe(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function bqe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(ea),a=Math.max(...n),s=t.filter(u=>u>a),o=n.length,l=yt(o===2?1:2,o).filter(u=>u===f4(u)),c=l.slice(0,e||l.length).reverse().map(u=>Ra(n,u));return s.length&&console.log({fedDrawPositions:s}),{drawPositionGroups:r,drawPositionChunks:c}}function Iqe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){let h="positionUnseededParticipants";u||({structure:u}=oi({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=ca({structure:u}),{seedAssignments:m}=Hc({provisionalPositioning:t,drawDefinition:a,structure:u}),g=m?.map(C=>C.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,b=v===zt?Ci({element:u,name:Bp})?.extension?.value:void 0,I=Ew({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:Zy,structureId:c,roundTarget:b,stage:v}),w=I.filter(C=>!g?.includes(C.participantId)).map(C=>C.participantId),T=f?.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!r&&w.length>(T?.length||0))return ue({result:{error:A4},context:{unseededParticipantsCount:w.length,unfilledDrawPositionsCount:T?.length},stack:h});let{appliedPolicies:S}=er({tournamentRecord:n,drawDefinition:a,event:p}),D=S?.[TC];if(u.stage===wn){let C=I.reduce((E,P)=>(E[P.groupingValue]||(E[P.groupingValue]=[]),E[P.groupingValue].push(P.participantId),E),{});Object.keys(C).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:C}))}return D&&o?vqe({provisionalPositioning:t,unseededParticipantIds:w,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,participants:o,matchUpsMap:l,structureId:c,avoidance:D,drawSize:d}):wqe({provisionalPositioning:t,unseededParticipantIds:w,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:s,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function wqe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?co(r):r.reverse();for(let h of e){let f=p.pop();if(!n||f){let m=Pp({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:s,seedBlockInfo:o,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m?.error&&console.log("!!!!!",{result:m}),m?.error)return ue({result:m,stack:"randomUnseededDistribution"})}}return{...oe}}function Sqe(t){let e=t.structure??oi(t).structure,i="positionQualifiers",r=[];if(e.stage===ws)return ue({result:{error:Gy},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:s}=Tqe(t);for(let o of Object.keys(n)){let l=a?.filter(c=>s[o].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[o]>(l||0))return ue({result:{error:N4},context:{unfilledDrawPositions:l},stack:i});yt(0,n[o]).forEach(()=>{let c=yl(l);r.push(c),a?.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...oe,qualifierDrawPositions:r}}function Tqe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=oi({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=ca({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:s,roundQualifiersCounts:o}=ND({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(o?Object.keys(o):[]).map(m=>ri(m)),{matchUps:c}=ar({structure:e}),{roundProfile:u}=vo({matchUps:c}),d=Object.assign({},...l.filter(m=>u?.[m]).map(m=>({[m]:u?.[m]?.drawPositions?.filter(Boolean)??[]}))),p=r?.filter(m=>m.qualifier).map(m=>m.drawPosition),h=s-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=r?.filter(v=>v.qualifier&&d[m]?.drawPositions?.includes(v.drawPosition)).map(v=>v.drawPosition);return{[m]:(o?.[m]??0)-(g?.length??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:o,positionAssignments:r,roundDrawPositions:d,qualifiersCount:s}}function xZ({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=oi({drawDefinition:a,structureId:u})),u||(u=p?.structureId),r||(r=er({drawDefinition:a}).appliedPolicies),!n){let v=p&&xw({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:s,structure:p});v?.error&&m.push(v.error),n=v?.validSeedBlocks}return c=c??n?.length??0,yt(0,c).forEach(()=>{if(g<(c||0)){let v=Uqe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:s,seedBlockInfo:o,participants:l,structureId:u,matchUpsMap:d,event:h});v?.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...oe,seedPositions:f}}function Uqe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:s,structureId:o,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=bye({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:o}),{appliedPolicies:p}=er({drawDefinition:r}),{avoidance:h}=p??{};h&&s&&u?.length>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:mD};f.push(g);let v=Pp({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:o,event:c});if(!v.success)return v}return{...oe,seedPositions:f}}function Dqe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=ca({structure:i}),{seedAssignments:n}=Hc({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(s=>s.participantId).map(s=>({[s.participantId]:s})));return r?.map(s=>a[s.participantId]?{...s,seedNumber:a[s.participantId].seedNumber,seedValue:a[s.participantId].seedValue}:"").filter(Boolean)}function Eqe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>Pqe(a,i,r,t));let n=r.map(a=>Array.isArray(a)?co(a):a).flat(1/0);return pfe(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function Pqe(t,e,i,r){if(e-i.length>t.drawPositions.length)i.push(...t.drawPositions);else{let n=Sj(Ra(t.drawPositions,2));Cqe(n,i,r)}}function Cqe(t,e,i){let r,n=i[e.length];for(;r=$N(t,n);)e.push(r),n=i[e.length]}function $N(t,e){return Array.isArray(t)&&t.length!==2?t.pop():Array.isArray(t[0])?Mqe(t,e):Rqe(t,e)}function Rqe(t,e){return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift()}function Mqe(t,e){let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return $N(e?n:t[Math.round(Math.random())],e)}return i<r?$N(t[1],e):$N(t[0],e)}function Sj(t){let e=Math.floor(t.length/2);return t.length>2?[Sj(t.slice(0,e)),Sj(t.slice(e))]:t}function Nqe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:s,structure:o}){a||(a=xw({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:o}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;i?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=Dqe({provisionalPositioning:t,drawDefinition:r,structure:o})??[],h=yi([].concat(...e.map(I=>I.drawPositions))),f=p.filter(I=>h.includes(I.drawPosition)),m=(I,w)=>sU(I.seedValue)-sU(w.seedValue),g=d.reduce((I,w)=>{let T=f.filter(S=>w.drawPositions?.includes(S.drawPosition)).sort(m);return I.concat(...T)},[]).map(I=>I.drawPosition),v=Eqe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:s}),y=LZ({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,s),b=LZ({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,s);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function LZ({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r?.sort((n,a)=>n-a)).filter(r=>r?.[0]+1===r?.[1]);return t.map(r=>i.find(n=>n?.includes(r))).filter(Boolean).map(r=>r?.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function Aqe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:s,isFeedIn:o}){let l=r?.seeding?.seedingProfile,c=s.stage===zt,{positionAssignments:u}=ca({structure:s}),d=u?.filter(N=>N.participantId).map(N=>N.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=ar({provisionalPositioning:t,matchUpFilters:p,structure:s}),m=f?.[1]||[],g=s.structureType===To?h:m,v=yi([].concat(...g.map(N=>N.drawPositions))),y=Math.min(...v)-1,b=d?.filter(N=>v.includes(N)),I=N=>{let k=Math.ceil(N.length/2),x=[N.slice(0,k),N.slice(k)],O=x.map(Z=>[].concat(...Z.flat(1/0)).length),V=Math.min(...O.flat(1/0)),F=Math.max(...O.flat(1/0)),j=O.indexOf(F),q=V!==F,W=co(x),[z,H]=!V||q?[x[j],x[1-j]]:[W[0],W[1]];return{greaterHalf:z,lesserHalf:H}},w=N=>{let{greaterHalf:k,lesserHalf:x}=I(N),{greaterHalf:O,lesserHalf:V}=I(k),F=co(O.flat(1/0)).pop(),j=O.flat().filter(q=>q!==F);return{newlyFilteredChunks:[...x,...V,j],drawPosition:F}},T=N=>!e.includes(N),S=N=>!b?.includes(N),D=N=>{let k=Ra(N.sort(ea),Math.ceil(N.length/4)).map(V=>V.filter(S)),x=[].concat(...k.flat(1/0)).length,O=[];for(let V=0;V<x;V++){let{newlyFilteredChunks:F,drawPosition:j}=w(k);O.push(j),k=F}return O},{validSeedBlocks:C}=xw({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:s}),E=C?.map(N=>N.drawPositions?.map(k=>k+y)),P;if(o){let N=v.length,{seedBlocks:k}=l6({cluster:I0(l)===uL,participantsCount:N});P=k.map(x=>x.map(O=>O+y)).map(D).filter(x=>x.length)}else c?P=E?.map(N=>N.filter(S)):P=E?.map(D).filter(N=>N.length);let R=g.map(N=>N.drawPositions).map(N=>N?.sort((k,x)=>k-x)).filter(N=>N?.[0]+1===N?.[1]),M=N=>R.reduce((k,x)=>x.includes(N)?x.reduce((O,V)=>V!==N?V:O,void 0):k,void 0),A=P.map(N=>N.map(M)).flat(1/0).filter(S).filter(T).filter(Boolean);if(c&&!s.structures){let N=a%4,k=A.slice(0,N),x=f[s.roundLimit]?.length,O=Ra(A.slice(N),x).map(co).flat();A=k.concat(O)}return{unseededByePositions:A}}function _qe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){let a={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:o}=ar({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=o?.[1]||[],c=r?.structureType===To,u=c?s:l,d=c?r?.structures?.length||0:s.length,{structureId:p,stage:h,stageSequence:f}=r,m=Ew({entryStatuses:td,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=ND({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=ca({structure:r}),I=b?.map(E=>E.drawPosition),w=y?.filter(E=>E.bye).length,T=y?.filter(E=>E.bye).map(E=>E.drawPosition),S=u.map(E=>E.drawPositions).filter(E=>E?.reduce((P,R)=>!T?.includes(R)&&P,!0)).flat(1/0).filter(E=>I?.includes(E)),D=y?.length,C=D?D-v:0;return C>d&&r.stageSequence===1&&r.stage!==ws&&(C=d),{placedByes:w,byesCount:C,relevantMatchUps:u,placedByePositions:T,roundMatchUps:o,positionsToAvoidDoubleBye:S}}function FZ({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:s,structureId:o,structure:l,seedLimit:c,seedsOnly:u,event:d}){l||({structure:l}=oi({drawDefinition:r,structureId:o})),o||(o=l?.structureId);let p=!(l?.structures??l?.stage===zt),{byesCount:h,placedByes:f,relevantMatchUps:m}=_qe({provisionalPositioning:t,drawDefinition:r,matchUpsMap:s,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...oe};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=Nqe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),w=l?.structureType&&[To,dL].includes(l.structureType)&&i?.seeding?.containerByesIgnoreSeeding,T=p&&y?.length?y:v,{unseededByePositions:S}=Aqe({provisionalPositioning:t,seedOrderByePositions:T,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:I}),D=R=>R%2,C=(R,M)=>(R||[]).every(A=>D(A)?M!==A+1:M!==A-1),E=[].concat(...T);if(!u)for(;S.length;){let R=S.find(M=>C(E,M));R?(E.push(R),S=S.filter(M=>M!==R)):(E.push(...S),S=[])}w&&(E=co(E),cc({ignoreSeededByes:w})&&console.log({byePositions:E}));let P=E.slice(0,g);for(let R of P){let M=bc({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:R,matchUpsMap:s,structureId:o,structure:l,event:d});if(M?.error)return M}return{...oe,unseededByePositions:S,byeDrawPositions:P}}function w0(t){let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:s,placementGroup:o,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(_me(),e=Et(e,!1,!0));let g=N=>(i||_N(),ue({result:N,stack:"automatedPositioning"})),v=N=>(i||_N(),N),y=oi({drawDefinition:e,structureId:c});if(y.error)return g(y);let b=y.structure;if(!b)return{error:en};let I=t.appliedPolicies||er({drawDefinition:e,structure:b,event:f})?.appliedPolicies,{qualifiersCount:w}=ND({stageSequence:b.stageSequence,provisionalPositioning:r,stage:b.stage,drawDefinition:e,structureId:c}),T=Zy;if(!Ew({stageSequence:b.stageSequence,provisionalPositioning:r,stage:b.stage,placementGroup:o,drawDefinition:e,entryStatuses:T,structureId:c})?.length&&!w)return v({...oe});let S=t.matchUpsMap??rs({drawDefinition:e}),D=t.inContextDrawMatchUps??qn({inContext:!0,drawDefinition:e,matchUpsMap:S})?.matchUps,C=[],E=xw({provisionalPositioning:r,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:P}=E;m.push({validSeedBlocks:P});let R=t.participants||(s?un({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:s})?.participants:[]);if(I0(b.seedingProfile||l)===uy){let N=a?FZ({provisionalPositioning:r,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(N?.error)return g(N);C=N.unseededByePositions,m.push({action:"positionByes",unseededByePositions:C});let k=b.seedingProfile?{positioning:b.seedingProfile}:l;if(N=xZ({seedingProfile:k,provisionalPositioning:r,inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:f}),N.error)return g(N);m.push({seedPositions:N.seedPositions,action:"positionSeedBlocks"})}else{if(p!==Hy){let k=b.seedingProfile?{positioning:b.seedingProfile}:l,x=xZ({seedingProfile:k,provisionalPositioning:r,inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:f});if(x.error)return g(x);m.push({action:"positionSeedBlocks",seedPositions:x.seedPositions})}let N=a?FZ({provisionalPositioning:r,tournamentRecord:s,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(N?.error)return g(N);C=N?.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:N?.byeDrawPositions,unseededByePositions:C})}let M={};if(!d){let N=Sqe({inContextDrawMatchUps:D,tournamentRecord:s,appliedPolicies:I,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b});if(N.error||(N.conflicts&&(M.qualifierConflicts=N.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:N.qualifierDrawPositions}),N=Iqe({provisionalPositioning:r,inContextDrawMatchUps:D,unseededByePositions:C,multipleStructures:n,tournamentRecord:s,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structureId:c,structure:b,drawSize:h,event:f}),N.error))return g(N);N.conflicts&&(M.unseededConflicts=N.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=Tr({drawDefinition:e,structure:b});return Cr({drawDefinition:e,structureIds:[c]}),i||_N(),{positionAssignments:A,conflicts:M,...oe,positioningReport:m}}function kD(t){let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,placeByes:o,seedsOnly:l}=t;if(!n)return{error:lc};if(!qh({drawDefinition:n,structureId:s})&&!i)return{error:m4};let c=Nye({drawDefinition:n,structureId:s}).playoffStructures?.sort((p,h)=>v_(p)-v_(h)),u=[],d=[];if(c)for(let p of c){let{structureId:h}=p,f=w0({structureId:h,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:o,seedsOnly:l});if(f.error)return f;f.positionAssignments&&u.push({positionAssignments:f.positionAssignments,structureId:h}),f.positioningReport&&d.push(f.positioningReport)}return{...oe,structurePositionAssignments:u,positioningReports:d}}function Oye({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:s}){if(!i)return{error:At};if(!n)return{error:gc};let o=(e?.participants??[]).find(p=>p.participantId===r);if(e&&!o)return{error:Ed};let{structure:l}=oi({drawDefinition:i,structureId:n});if(!l)return{error:en};if(!(!t||vn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>vn(p)&&ri(p)>0)))return{error:Se};let{seedAssignments:c}=Hc({drawDefinition:i,structure:l}),u=c?.map(p=>p.seedNumber),d=c?.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return Ive({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:i,structure:l}),{...oe}}function v6({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return f6({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function MC({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=RD({drawDefinition:i,structureId:r})||{},s=(a?.target||[]).filter(({linkType:o})=>o===n).filter(({target:o})=>!t||t===o.roundNumber).map(o=>{let l=o.source.structureId,{structure:c}=oi({structureId:l,drawDefinition:i});if(!(e&&c?.finishingPosition!==e))return o}).filter(Boolean);return{sourceStructureIds:s.map(({source:o})=>o.structureId),relevantLinks:s}}var kqe=(t,e)=>{let i=[...new Set(e.slice(0,t.length))],r=[...i].sort((o,l)=>o-l),n=new Set,a=[];i.forEach(o=>{let l=t.indexOf(o);if(l!==-1&&!n.has(l))a.push(l),n.add(l);else{let c=r.indexOf(o),u=t.findIndex((d,p)=>!n.has(p));for(;n.has(u)&&u===-1&&n.size<t.length;)u=t.findIndex((d,p)=>!n.has(p)&&p>u);a.push(c),n.add(c)}});let s=t.filter((o,l)=>!n.has(l));return[...a,...s]};function xye({targetRoundNumber:t=1,tournamentRecord:e,drawDefinition:i,event:r,randomList:n}){let a=Gt({drawDefinition:i,event:r,tournamentRecord:e},[{[Gs]:!0,[Tm]:!0,[pa]:!0}]);if(a.error)return a;let s=[],o=[],l=i.structures?.find(g=>g.stage===Dt&&g.stageSequence===1);if(!l)return ue({result:{error:w4}});let c=(er({tournamentRecord:e,drawDefinition:i,structure:l,event:r}).appliedPolicies??{})[Gh]?.requireCompletedStructures,{qualifierPositions:u,positionAssignments:d}=ca({structure:l});if(!u.length)return ue({result:{error:N4}});let p=yt(0,u.length);n&&(p=kqe(p,n));let h=d.map(g=>g.participantId).filter(Boolean),{relevantLinks:f}=MC({structureId:l.structureId,targetRoundNumber:t,linkType:Bh,drawDefinition:i})||{},{relevantLinks:m}=MC({structureId:l.structureId,targetRoundNumber:t,linkType:Fh,drawDefinition:i})||{};for(let g of f){let v=i.structures?.find(b=>b.structureId===g.source.structureId);if(v?.stage!==zt)continue;let y=qh({structureId:g.source.structureId,drawDefinition:i});if(!c||y){let b=v.qualifyingRoundNumber,{matchUps:I}=ar({matchUpFilters:{...b&&{roundNumbers:[b]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:v});for(let w of I){let T=w.matchUpStatus==="BYE"&&w.sides?.find(({participantId:D})=>D),S=w.sides.find(D=>D?.sideNumber===w.winningSide);if(S||T){let{participantId:D}=S||T||{};D&&!h.includes(D)&&o.push(D)}}}}for(let g of m){let v=i?.structures?.find(y=>y.structureId===g.source.structureId);if(v?.stage===zt&&qh({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:y}=Tr({structure:v}),b=y?.map(I=>{let w=I.participantId,T=Ci({element:I,name:nm}).extension?.value;return T?{participantId:w,groupOrder:T?.groupOrder}:{}}).filter(({groupOrder:I,participantId:w})=>I===1&&!h.includes(w)).map(({participantId:I})=>I)??[];b&&o.push(...b)}}return o.length?(p.forEach((g,v)=>{let y=o[v],b=u[g].drawPosition;y&&v6({qualifyingParticipantId:y,structureId:l.structureId,drawPosition:b,tournamentRecord:e,drawDefinition:i})?.success&&s.push({participantId:y,drawPosition:b})}),ue({result:Ft({...oe,assignedParticipants:s})})):ue({result:{error:ime}})}function Lye({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>mi(i)))&&ue({result:{error:Se},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>HT(i.structureOrder)-HT(r.structureOrder)),{...oe}):{error:At}}function qL({drawDefinition:t}){let e=t.structures??[],i=t.links??[],r=new Map,n=g=>{let v=r.get(g)||r.set(g,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(g);if(v&&!v?.stage){let y=e.find(b=>b.structureId===g);v.stage=y?.stage}return v},a={},s={},o=i.map(g=>{let v=g.source.structureId,y=g.target.structureId,b=n(v),I=n(y);return[dy,Uu,pL,uy].includes(g.target.feedProfile)?(b?.targets.push(y),I?.sources.push(v)):g.target.feedProfile===dd&&(I?.drawSources.push(v),b?.drawTargets.push(y)),s[y]=s[y]||g.target.feedProfile===dd,a[y]=yi([...a[y]||[],v]).filter(Boolean),[g.source.structureId,g.target.structureId]});for(let g of r.keys()){let v=r.get(g);if(v){let y=v.targets??[];for(;y.length;){let b=y.pop(),I=b&&r[b];I?.targets?.length?y.push(...I.targets):I&&(v.rootStage=I.stage)}if(v.rootStage||(v.rootStage=v.stage),!v.targets?.length){let b=v.sources??[];for(;b.length;){let I=b.pop(),w=I&&r[I];if(w?.sources?.length){for(let T of w.sources)v.progeny?.includes(T)||v.progeny?.push(T);b.push(...w.sources)}}}}}let l=0;for(let g of r.keys()){let v=r.get(g);if(v&&v.rootStage===zt){let y=[v.drawTargets?.[0]],b=0;for(;y.length;){b+=1;let I=y.pop(),w=I?r.get(I):void 0;w?.drawTargets?.length&&y.push(w.drawTargets[0])}v.distanceFromMain=b,b>l&&(l=b)}}let c=o.length;yt(0,Math.ceil(c/2)).forEach(()=>{o=yt(0,c).map(g=>{let v=o[g],y=o.reduce((b,I)=>go(v,I)?b.concat(...I):b,[])||[];return yi(v.concat(...y))})});let u=o[0],d=(g,v)=>En(g,v).length===g.length,p=o.slice(1).reduce((g,v)=>g&&d(v,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(g=>{let{structureId:v,stage:y}=g;h.find(b=>b.includes(v))||(h.push([v]),y!==$a&&f.push([v]))});let m=p&&f.length===1;return!i?.length&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:s,structureGroups:h}}function Fye({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=qL({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...oe}}function y6(t){let e=Gt(t,[{[pa]:!0,[Gs]:!0}]);if(e.error)return e;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=t;return Oqe({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function Oqe(t){let e=Gt(t,[{[Gs]:!0,[vL]:!0},{link:!0,[Bo]:Zo,[Ife]:b4}]);if(e.error)return e;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:s}=t,o=s.target.structureId,l=oi({drawDefinition:i,structureId:o});if(l.error)return ue({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:l});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(s),Fye({drawDefinition:i});let c=ar({structure:n})?.matchUps||[];return wg({drawDefinition:i,tournamentId:r,matchUps:c,eventId:a}),Cr({drawDefinition:i,structureIds:[n.structureId]}),{...oe}}function Bye({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Se};if(!t)return{error:At};let i=Object.assign({},...e.map(r=>{if(!qi(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Yt};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let s=i[a.structureId];s&&(a.structureName=s)}}return{...oe}}function b6({drawDefinition:t,timeItem:e}){if(!t)return{error:lc};if(!e)return{error:x4};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:O4};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),XR({drawDefinition:t}),{...oe}}function $ye(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=Gt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let s=i.structures??[],o=s.find(v=>v.structureId===r);if(!o)return{error:en};let l=s.find(({stage:v,stageSequence:y})=>v===Dt&&y===1),c=r===l?.structureId,u=s.filter(({stage:v})=>v===zt).map(xl("structureId"));if(c&&!u.length)return{error:Sfe};let d=u.includes(r),p=xqe({isQualifyingStructure:d,structure:o,...t});if(p?.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=Fqe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:m,removedStructureIds:g}=Bqe({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:r});if(Lqe({removedMatchUpIds:m,drawDefinition:i}),c){let v=(l.matchUps??[])?.map(xl("matchUpId"));m.push(...v),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&Fye({drawDefinition:i}),tf({tournamentId:e?.tournamentId,matchUpIds:m,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),Cr({drawDefinition:i,eventId:n?.eventId}),{...oe,removedMatchUpIds:m,removedStructureIds:g}}function xqe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:s}){let o=[r];if(t){let l=u=>i.links?.find(d=>d.target.structureId===u),c=l(r)?.source.structureId;for(;c;)o.push(c),c=l(c)?.source.structureId}if(qn({matchUpFilters:{structureIds:o},drawDefinition:i}).matchUps?.some(({score:l})=>ua({score:l}))){let l=er({tournamentRecord:e,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(s??l?.[Gc]?.allowDeletionWithScoresPresent?.structures))return{error:FR}}return{...oe}}function Lqe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=qn({drawDefinition:e});i?.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function Fqe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let s=(n.structures??[]).map(xl("structureId")),o=u=>n.links?.map(d=>d.source.structureId===u&&d.target.structureId!==r?.structureId&&d.target.structureId).filter(Boolean)??[],l=u=>n.links?.map(d=>t.includes(d.source.structureId)&&d.target.structureId===u&&d.source.structureId).filter(Boolean)??[],c=new Map;return s.forEach(u=>c.set(u,e?l(u):o(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function Bqe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:s}){let o=[],l=[];for(;a?.length;){let c=a.pop();l.push(...jqe({idBeingRemoved:c,drawDefinition:n}));let u=Vqe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:s});o.push(...u.removedStructureIds);let d=$qe({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:s});d?.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:o}}function $qe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){return t&&e.get(t)?.filter(n=>n!==i?.structureId||r===i.structureId)}function Vqe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter(s=>s.source.structureId!==i&&s.target.structureId!==i)??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function jqe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=oi({structureId:t,drawDefinition:e}),r=ar({structure:i}).matchUps;return b5(r)}function D_({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:At};if(!j5({drawDefinition:e,stage:r}))return{error:Gy};let n=$He({drawDefinition:e,stage:r}),{qualifiersCount:a}=ND({drawDefinition:e,stageSequence:t,stage:r}),s=n+a;if(i<s)return{error:Efe};let{entryProfile:o}=V5({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return Cr({drawDefinition:e}),{...oe,entryProfile:o}}function Vye({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?j5({drawDefinition:e,stage:i})?(V5({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Cr({drawDefinition:e}),{...oe}):{error:Gy}:{error:At}}function Gqe({drawDefinition:t,drawSize:e}){if(!t)return{error:At};let i=D_({stage:$a,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Cr({drawDefinition:t}),{...oe})}function jye(t){return Gqe(t)}function Gye({tournamentRecord:t,drawDefinition:e,event:i,structureId:r}){if(!e)return{error:At};let n=e.structures?.find(s=>s.stage===zt&&s.structureId===r);if(!n)return{error:en};if(n.matchUps?.some(({matchUpStatus:s,score:o})=>ua({score:o})??la.includes(s)))return{error:FR};let a=n.matchUps?.map(({matchUpId:s})=>s)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],tf({tournamentId:t?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),Cr({tournamentId:t?.tournamentId,eventId:i?.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...oe}}var Hqe="qualifierDrawPositionAssignment",zqe="withdrawParticipantAtDrawPosition",qqe="alternateDrawPositionAssignment",Wqe="luckyLoserDrawPositionAssignment",BZ="removeDrawPositionAssignment",Hye="swapDrawPositionAssignments",Yqe="modifyPairAssignment",Kqe="adHocPositionSwap",Zqe="modifyParticipantOtherName",$Z="assignDrawPosition",Xqe="removeSeededParticipant",Jqe="assignDrawPositionBye",Qqe="modifySeedAssignment",zye="addPenalty",I6="MODIFY_PAIR",WL="QUALIFIER",w6="ALTERNATE",S6="WITHDRAW",EI="ASSIGN",Tj="REMOVE",T6="LUCKY",nP="REMOVE_SEED",YL="SWAP",NC="NICKNAME",Kb="SEED_VALUE",PI="PENALTY",eWe={MODIFY_PAIR_ASSIGNMENT:I6,QUALIFYING_PARTICIPANT:WL,ALTERNATE_PARTICIPANT:w6,WITHDRAW_PARTICIPANT:S6,ASSIGN_PARTICIPANT:EI,LUCKY_PARTICIPANT:T6,REMOVE_ASSIGNMENT:Tj,SWAP_PARTICIPANTS:YL,ADD_NICKNAME:NC,REMOVE_SEED:nP,ADD_PENALTY:PI,ASSIGN_BYE:"BYE",SEED_VALUE:Kb};function qye({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:At};if(!r)return{error:gc};if(i?.length!==2)return{error:Se,drawPositions:i};let a=rs({drawDefinition:e}),{matchUps:s}=qn({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:o}=oi({drawDefinition:e,structureId:r});if(!o)return{error:en};let l=er({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},c;if(o.structureType===To?c=rWe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}):c=tWe({inContextDrawMatchUps:s,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:o,event:n}),c.error)return c;if(x5({structure:o,drawPositions:i}),RL({appliedPolicies:l,drawDefinition:e,positionAction:{name:Hye,drawPositions:i,structureId:r}}),Sg({tournamentId:t?.tournamentId,drawDefinition:e,structure:o,event:n}),n.eventType===_l){let u=ar({matchUpFilters:{matchUpTypes:[oc]},inContext:!0,structure:o}).matchUps.filter(p=>p.drawPositions?.some(h=>i.includes(h))),d=ar({matchUpFilters:{matchUpTypes:[oc]},structure:o}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(h=>{let f=h?.drawPosition;if(i.includes(f)){let m=h.participantId,g=d.find(({matchUpId:y})=>y===p.matchUpId),v=p?.sides?.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0);d6({inContextTargetMatchUp:p,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return Cr({drawDefinition:e,structureIds:[r]}),{...oe}}function tWe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a?.positionAssignments.filter(c=>r?.includes(c.drawPosition));if(!o)return{error:Se,structure:a,info:"Missing positionAssignments"};if(o.filter(({bye:c})=>c).length===2)return{...oe};if(o.filter(({qualifier:c})=>c).length===2)return{...oe};let l=o.some(({qualifier:c})=>c);return o.some(({bye:c})=>c)&&!l?Wye({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s}):iWe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s})}function Wye({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=r.find(({bye:f})=>f),l=r.find(({participantId:f})=>f),c=o.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=RC({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return h.error||(h=RC({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),h.error)||(bc({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:s}),h=Pp({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:s}),h.error)?h:{...oe}}function iWe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:s}){let o=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>o[l.drawPosition]||l),h6({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:s}),{...oe}}function rWe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:s}){let o=a.structures?.reduce((c,u)=>{let d=u?.positionAssignments.filter(p=>r?.includes(p.drawPosition));return d&&c.push(...d),c},[]);if(o.filter(({bye:c})=>c).length===2)return{...oe};if(o.filter(({qualifier:c})=>c).length===2)return{...oe};h6({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:o,structure:a,event:s});let l=o.some(({qualifier:c})=>c);if(o.some(({bye:c})=>c)&&!l)Wye({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:o,matchUpsMap:n,structure:a,event:s});else{let c=Et(o,!1,!0);o.forEach((u,d)=>{let p=c[1-d].participantId;u.qualifier=c[1-d].qualifier,u.participantId=p})}return{...oe}}function Yye({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!t)return{error:et};if(!e)return{error:At};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Dt,zt].includes(a.stage)||a.stage===Dt&&a.stageSequence!==1?ue({result:{error:Vy},stack:n}):a.seedAssignments?.find(s=>s.participantId===i)?{...oe}:ue({info:"participant not seeded",result:{error:za},context:{participantId:i}}):ue({result:{error:en},stack:n})}function S0({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Bh}){return!r||!n?{error:gc}:{link:Ft({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:dd,roundNumber:t,structureId:n}})}}function Fw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>T0({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function T0({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:s,matchUpType:o,collectionId:l,processCodes:c}=e||{},u=i??s??0,d=p=>{if(!n&&!r?.isMock)return a?.pop()??lr();let h=e?.collectionId;return a?.pop()??`${r?.matchUpId}-${h}-TMU-${p+1}`};return yt(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Pn,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:o,isMock:n}})}function U6({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:r?.pop()||lr()}function E_({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:s,nodes:o}){let l=0,c=[],u=1,d=i-1,p=o?.length;for(;l<(p||0);){let h=o?.[l],f=o?.[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=U6({roundPosition:u,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y?.drawPosition).filter(Boolean),matchUpStatus:Pn,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),u++,l+=2}return{roundNodes:c,matchUps:r}}function Cp({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:s,drawSize:o,isMock:l,uuids:c}){if(isNaN(o)||o<2||r&&o<=r)return{matchUps:[],roundsCount:0};if(r&&(!Dd(o)||o%r)){let g=r;for(;g<o;)g=2*g;o=g}let u=r&&!(o%2)&&(!isNaN(r)||i&&!isNaN(i))&&(o/r===Math.round(o/r)||i&&o/i===Math.round(o/i));if(!Dd(o)&&!u)return{matchUps:[],roundsCount:0};let d=yt(1,o+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=E_({matchUpType:n,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)r&&p.length===r&&(a=f-1),{roundNodes:p,matchUps:h}=E_({nodes:p,matchUpType:n,roundNumber:f,idPrefix:s,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=d0({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:o,matchUps:h,roundsCount:m,roundLimit:a}}function D6(t){let e="generateQualifyingStructure";if(!t.drawDefinition)return ue({result:{error:At},stack:e});if(t.drawSize&&!mi(t.drawSize)||t.participantsCount&&!mi(t.participantsCount)||t.qualifyingPositions&&!mi(t.qualifyingPositions))return ue({result:{error:Se},stack:e});let i=t.drawSize??h4(t.participantsCount),{hasExistingDrawDefinition:r,qualifyingRoundNumber:n,qualifyingPositions:a,targetStructureId:s,structureOptions:o,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,matchUpFormat:d,structureName:p,structureId:h,roundTarget:f,tieFormat:m,drawType:g,idPrefix:v,isMock:y,uuids:b}=t;if(!t.drawSize)return ue({result:{error:kR},context:{drawSize:i},stack:e});if(a&&a>=t.drawSize)return ue({result:{error:Se},context:{drawSize:i,qualifyingPositions:a},stack:e});let I,w,T,S,D=0,C,E=1,{structureProfiles:P}=qL({drawDefinition:u}),R=P[s];if(!R)return ue({result:{error:en},context:{targetStructureId:s},stack:e});let M=u.matchUpType,A=f?`${f}-`:"",N=R.stage===zt,k=l?.[tm]?.namingConventions?.pre??HHe[tm]?.namingConventions?.pre,x=N&&k?`${k}-`:"",O=p??(A?`${x}${ys(zt)} ${A}`:`${x}${ys(zt)}`);if(g===zu){let{maxRoundNumber:j,structures:q,groupCount:W}=y0({structureName:p??O,structureId:h??b?.pop(),hasExistingDrawDefinition:r,stage:zt,structureOptions:o,appliedPolicies:l,qualifyingOnly:c,stageSequence:E,matchUpType:M,roundTarget:f,tieFormat:m,idPrefix:v,drawSize:i,isMock:y,uuids:b});D=W,I=j,T=q[0],C=[1]}else({drawSize:i,matchUps:S,roundLimit:I,roundsCount:w}=Cp({qualifyingRoundNumber:n,qualifyingPositions:a,matchUpType:M,idPrefix:v,drawSize:i,isMock:y,uuids:b})),I||(I=w),T=kc({structureName:p??O,structureId:h??b?.pop(),qualifyingRoundNumber:I,stage:zt,matchUpFormat:d,stageSequence:E,matchUpType:M,roundLimit:I,matchUps:S}),f&&nr({extension:{name:Bp,value:f},element:T}),D=S?.filter(j=>j.roundNumber===I)?.length;let V=g===zu?Fh:Bh,F=T&&I&&S0({sourceStructureId:T.structureId,sourceRoundNumber:I,targetStructureId:s,finishingPositions:C,linkType:V})?.link;return m&&(S=ar({structure:T})?.matchUps||[],S?.forEach(j=>{let{tieMatchUps:q}=Fw({tieFormat:m,matchUp:j,isMock:y});Object.assign(j,{tieMatchUps:q,matchUpType:M})})),{qualifyingDrawPositionsCount:i,qualifiersCount:D,...oe,structure:T,link:F}}function Kye(t){if(!t.tournamentRecord)return{error:et};let e=nWe(t);return e.error,e}function nWe(t){if(!t.drawDefinition)return{error:At};if(!t.targetStructureId)return{error:gc};let e=D6(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:Se}:y6({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function Zye(t){let e=Gt(t,[{[Gs]:!0,[fL]:!0,[Fp]:!0},{[zGe]:!0,[hs]:d=>Number.isInteger(d)&&d>0},{[hs]:d=>Array.isArray(d)&&d.length===2&&d.every(Yr),[uc]:wl,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:s}=oi({drawDefinition:i,structureId:r});if(!s)return{error:en};if(!xo({structure:s}))return{error:Vy};let o=d=>d.sides?.map(p=>p.participantId).some(p=>t.participantIds.includes(p)),l=d=>d.roundNumber===t.roundNumber,c=d=>!ua(d),u=(s?.matchUps??[]).filter(l).filter(c).filter(o);if(u.length!==2)return{error:wl};for(let d of u){let p=d?.sides?.find(h=>t.participantIds.includes(h?.participantId));if(p){let h=t.participantIds.find(f=>f!==p?.participantId);p.participantId=h,Hi({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:d})}}return Cr({drawDefinition:i,structureIds:[r]}),{...oe}}function aWe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:s,uuids:o,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=yt(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=U6({roundPosition:y.roundPosition,roundNumber:i,idPrefix:n,uuids:o}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Pn,roundNumber:i,matchUpId:b};t&&(I.matchUpType=r),s&&(I.isMock=!0),a.push(I);let w={children:[y,v]};h.push(w)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function Dg(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:s,finishingPositionOffset:o,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??A(e);let g=sWe({drawSize:a}),v=g.length,y=0;if(i?.length)y=i.reduce((N,k)=>N+k,0);else if(e){let N=e-a;i=g.filter(k=>k<=N?(N-=k,!0):!1),y=i.reduce((k,x)=>k+x,0),r=i.length}else n>=v?r=0:c&&(r=v-c,n=0),i=g.filter((N,k)=>c&&!r||r&&k>=n+r||k<n?0:N),y=i.reduce((N,k)=>N+k,0),r=i.length;let b=[...g,...i].sort((N,k)=>k-N),I=b.length,w=[...(l??[]).map(N=>N-1),...(s??[]).map(N=>I-N)].map(N=>b[N]).reduce((N,k)=>N+k,0);y=y-w;let T=0,S=[],D,C=1,E=yt(0,a).map((N,k)=>({drawPosition:k+1+y})),P=y+1;for(let N of g){if({roundNodes:D,matchUps:S}=E_({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),C++,i.includes(N)){let k=Nl(i)[N],x=yt(0,k),O=I+1-C,V=s?.includes(O)??l?.includes(C);x.forEach(()=>{({roundNodes:D,matchUps:S,drawPosition:P}=aWe({drawPosition:!V&&P||void 0,nodes:D,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:T})),C++,T+=1})}E=D}I!==C-1&&console.log("ERROR");let R=a-y;S=d0({finishingPositionOffset:u?R:o,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let M=D?.length?D[0]:D;return M&&(M.roundNumber=C-1,M.matchUps=S),{draw:M,matchUps:S,roundsCount:I};function A(N){let k=f4(N);return k>N?k/2:k}}function sWe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return yt(0,e).reverse().map(i=>Math.pow(2,i))}function oT(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,stageSequence:o=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=Dt,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!s||!c||s?.[l])||g<2||f&&o>f)return{};let I=[],w=[],T=[],S=t.matchUpType??p?.matchUpType,D=e+1,C=e+g,E=`${D}-${C}`,P=s?.[l],R=r&&`${r} `||"",M=s?.[E]??n?.[E],A=t.structureName||M?.name||P?.name&&(i?`${R}${P?.name}`:P.name)||`${R}${E}`,N=M?.abbreviation??P?.abbreviation,k=t.structureId??P?.structureId??b?.pop(),x={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?Dg(x):Cp(x),V=kc({structureAbbreviation:N,stageSequence:o,structureName:A,matchUpType:S,roundOffset:d,structureId:k,matchUps:O,stage:m});I.push(...O),w.push(V);let F=Math.ceil(Math.log(g)/Math.log(2)),j=u?Math.min(u-d,F):(!a||D<a)&&F||0;return g>2&&yt(1,j+1).forEach(W=>q(W)),{structureId:V.structureId,matchUps:I,structureName:A,structures:w,links:T,...oe};function q(W){let z=g/Math.pow(2,W);if(z<2)return;let H=g/Math.pow(2,W)+e;if(a&&H+1>a)return;let{structures:Z,structureId:J,matchUps:ie,links:K}=oT({finishingPositionOffset:H,exitProfile:`${l}-${W}`,roundOffset:d+W,stageSequence:o+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:s,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(V.structureId&&J){let ne={linkType:$h,source:{roundNumber:W,structureId:V.structureId},target:{roundNumber:1,feedProfile:Uu,structureId:J}};K&&V&&K.push(ne),K?.length&&T.push(...K)}return Z?.length&&w.push(...Z),ie?.length&&I.push(...ie),{structureId:J,childLinks:K,structures:w}}}function E6({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=oi({drawDefinition:t,structureId:i});if(r.error)return ue({result:r});let{matchUps:n}=ar({structure:r.structure,matchUpsMap:e});return{...vo({matchUps:n}),matchUps:n,matchUpsMap:e}}function VZ({finishingPositions:t,drawDefinition:e,structureId:i}){let{roundProfile:r}=E6({drawDefinition:e,structureId:i});return(r&&Object.keys(r))?.reduce((n,a)=>(Xye(r?.[a]).forEach(s=>{t.forEach(o=>{oWe({position:o,rangeDefinition:s})&&(n[o]={roundNumber:a})})}),n),{})}function oWe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return yt(i,(r||i)+1).includes(t)}function Xye(t){return[yi(t?.finishingPositionRange?.loser||[]),yi(t?.finishingPositionRange?.winner||[])]}function lWe(t){return Xye(t).map(e=>yt(e[0],e[1]&&e[1]+1||e[0]+1))}function OD({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Se,context:{structureIds:e}};if(!t)return{error:At};e=e??(t.structures??[]).filter(a=>a.stage!==zt).map(({structureId:a})=>a);let r=e.map(a=>{let{roundProfile:s}=E6({drawDefinition:t,matchUpsMap:i,structureId:a});return(s&&Object.values(s))?.map(lWe).flat()}).flat(),n=r.filter(a=>a?.length===1).sort(ea).flat();return{positionsNotPlayedOff:yi(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function Jye({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:At};if(!r)return{error:gc};if(!e)return{error:Yt,info:"missing playoffPositions"};let n=OD({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,s=e.filter(v=>!a.includes(v)),o=VZ({finishingPositions:s,drawDefinition:i,structureId:r}),l=Object.values(o).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)).filter(v=>!t.includes(v)),c=VZ({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>ri(v)):[],p=l.filter(v=>!d.includes(v)).sort(ea),{roundProfile:h}=E6({drawDefinition:i,structureId:r}),f=p.map(v=>{let y=h?.[v].finishingPositionRange.loser,[b,I]=y??[0,0];return yt(b,(I||b)+1)}).flat().sort(ea),{playoffRoundsRanges:m}=cWe({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function cWe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,s=yt(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:s,roundNumber:i}})}}function U0({drawDefinition:t,structureId:e}){if(!t)return{error:At};let{matchUps:i,matchUpsMap:r}=po({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=OD({drawDefinition:t,matchUpsMap:r}),{structures:s}=Wu({drawDefinition:t}),o=s.filter(c=>!e&&c.stage!==$a||c.structureId===e),l={};for(let c of o){let u=c?.structureId,d=uWe({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function uWe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=RD({drawDefinition:e,structureId:n});if(i.structureType===To||i.structures){let h=Tr({structure:i})?.positionAssignments?.length,f=i.structures.length,m=(h??0)/f,g=a.source?.flatMap(({source:E})=>E?.finishingPositions||[])||[],v=yt(1,m+1).filter(E=>!g.includes(E)),y=r.find(E=>E.containerStructureId===n&&E.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],b=a?.source.map(({target:E})=>E.structureId),{positionsPlayedOff:I=[],positionsNotPlayedOff:w=[]}=OD({structureIds:b,drawDefinition:e}),T=[...I,...w],S=yt(y[0],y[1]+1).filter(E=>!T.includes(E)),D=Ra(S,S.length/v.length),C=v.map((E,P)=>{let R=D[P],M=[Math.min(...R||[]),Math.max(...R||[])].join("-");return{finishingPosition:E,finishingPositions:R,finishingPositionRange:M}});return{positionsNotPlayedOff:S,playoffFinishingPositionRanges:C,finishingPositionsAvailable:v,finishingPositionsPlayedOff:g,positionsPlayedOff:I,groupCount:f,groupSize:m}}let s=a?.source?.filter(h=>h.linkCondition!==Dp).map(h=>h.source?.roundNumber)||[],o=a?.source?.filter(h=>h.linkCondition===Dp).map(h=>h.source?.roundNumber)||[],l=Jye({excludeRoundNumbers:s,playoffPositions:t,drawDefinition:e,structureId:n}),c=l?.playoffSourceRounds?[...l?.playoffSourceRounds||[]]:void 0,u=[...l?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=l;for(let h of o){let f=a?.source.find(b=>b.source.roundNumber===h),m=f?.target.roundNumber,g=f?.target.structureId,v=r.filter(({roundNumber:b,structureId:I})=>I===g&&b===m),y=v.filter(({sides:b})=>b.find(I=>I.participantFed&&!I.participantId)).length;if(c&&y===v.length){c.push(h);let b=d?.[h]?.finishingPositionRange?.loser;if(b){let I=Math.min(...b),w=I+y,T=yt(I,w),S={finishingPositionRange:[I,w-1].join("-"),finishingPositions:T,roundNumber:h};u.push(S)}}}return c&&c.sort(ea),u.sort((h,f)=>h.roundNumber-f.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function dWe({playoffGroups:t,drawDefinition:e,structureId:i}){if(!e)return{error:At};if(!Yr(i)||!Array.isArray(t))return{error:Se};let r=t.map(({finishingPositions:n})=>n).flat();return{positionRangeMap:U0({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges?.filter(n=>r.includes(n.finishingPosition))?.reduce((n,a)=>(n[a.finishingPosition]=a,n),{})}}function Qye(t){let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:s=Dt,matchUpType:o,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:o,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=n?Dg(h):Cp(h),m=kc({structureName:a||i?.["0"]?.name||ys(Dt),structureId:l||p?.pop(),stageSequence:r,matchUpType:o,matchUps:f,stage:s}),g=[m],v=[];if(u>2){let y=u/2,{matchUps:b}=Cp({finishingPositionOffset:e+y,idPrefix:c&&`${c}-c`,drawSize:y,matchUpType:o,isMock:d}),I=ys(ws),w=i?.["0-1"]?.name??t.consolationStructureName??(a?`${a} ${I}`:I),T=kc({structureName:w,matchUps:b,structureId:p?.pop(),stage:ws,stageSequence:1,matchUpType:o});g.push(T);let S={linkType:$h,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Uu,structureId:T.structureId}};v.push(S)}return{...oe,structures:g,links:v}}function ebe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let s=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),o=n?.roundGroupedOrder||[],l=n?.roundFeedProfiles;return yt(1+e,r+1+e).map(c=>{let u=l?.[c-1]?l[c-1]:c%2&&Uu||dy,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:$h,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=o[c-1];return h&&(p.target.groupedOrder=h),cc()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Dp,p.target.feedProfile=Uu),s.includes(d)?p:void 0}).filter(Boolean)}function tbe(t){let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:s,stage:o=Dt,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=s?Dg(f):Cp(f),v=t.structureName??n?.["0"]?.name??ys(Dt),y=ag({structureId:c||h?.pop(),structureName:v,stageSequence:r,matchUpType:l,matchUps:m,stage:o}),b=[y],I=[];if(u>2){let w=[0,2].slice(0,u/16).map((T,S)=>{let D=S+1,{consolationStructure:C}=pWe({idPrefix:d&&`${d}-c${S}`,structureId:h?.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:D,roundOffset:T,matchUpType:l,drawSize:u,isMock:p,index:S,uuids:h});b.push(C);let E=ebe({consolationStructure:C,roundsCount:2,mainStructure:y,roundOffset:T});return{consolationStructure:C,links:E}}).map(T=>T.links).flat();if(I.push(...w),u>=4&&u<=16||u>32){let{matchUps:T}=Cp({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),S=n?.["3-4"]?.name??ys(wn),D=a?.[S]||S,C=e?`${e} ${D}`:D,E=ag({structureId:h?.pop(),matchUps:T,stageSequence:2,stage:wn,structureName:C,matchUpType:l}),P={linkType:$h,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:E.structureId,feedProfile:Uu,roundNumber:1}};b.push(E),I.push(P)}}return{structures:b,links:I,...oe}}function pWe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:s,idPrefix:o,drawSize:l,isMock:c,index:u,uuids:d}){let p=l/(2*Math.pow(2,n)),{matchUps:h,roundsCount:f}=Dg({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:o,isMock:c,uuids:d}),m=u===0&&i?.["0-1"]?.name||u===1&&i?.["0-3"]?.name||`${ys(ws)} ${u+1}`,g=r?.[m]||m,v=t?`${t} ${g}`:g;return{consolationStructure:ag({matchUps:h,stage:ws,structureName:v,stageSequence:e,matchUpType:a,structureId:s}),consolationRoundsCount:f}}function Ib(t){let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:s,stage:o=Dt,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||t.policyDefinitions?.[iU]||t.appliedPolicies?.[iU],y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=a?Dg(y):Cp(y),I=kc({structureName:s||r?.["0"]?.name||ys(Dt),structureId:l||m?.pop(),stageSequence:i,matchUpType:c,matchUps:b,stage:o}),w=[I],T=[],S=h/2,{matchUps:D,roundsCount:C}=Dg({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let E=r?.["0-1"]?.name??ys(ws),P=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${E}`:E,R=kc({matchUps:D,structureId:m?.pop(),stage:ws,stageSequence:1,structureName:P,matchUpType:c});w.push(R);let M=ebe({consolationStructure:R,mainStructure:I,roundsCount:C,feedPolicy:v,fmlc:g});T.push(...M)}return{...oe,structures:w,links:T}}function ibe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:s,playoffGroups:o,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){c=c||n?.[iU];let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=dWe({structureId:r,drawDefinition:s,playoffGroups:o});if(b)return ue({result:{error:b},stack:f});if(!(!I||o?.every(w=>{let{finishingPositions:T=[]}=w;if(!T.length)return!1;let S=[...T].sort(ea).map((D,C)=>(T[C+1]||D)-D).every(D=>D<2);return(!t||S)&&T.every(D=>I[D])})))return ue({context:{validFinishingPositions:Object.values(I)},result:{error:Se},stack:f});for(let w of o){let T=w.finishingPositions,S=I&&T.map(N=>I[N]?.finishingPositions).flat(),D=u*T.length,C=hD(D),E=C===2&&sp||w.drawType||sp;S&&(m=Math.min(...S)-1);let P=S&&`${Math.min(...S)}-${Math.max(...S)}`,R=w.structureName||P&&w.playoffAttributes?.[P]?.name||w.playoffAttributes?.["0"]?.name,M={addNameBaseToAttributeName:w.addNameBaseToAttributeName,playoffStructureNameBase:w.playoffStructureNameBase,finishingPositionNaming:w.finishingPositionNaming,finishingPositionLimit:w.finishingPositionLimit,structureId:w.structureId??h?.pop(),playoffAttributes:w.playoffAttributes,structureNameMap:w.structureNameMap,sequenceLimit:w.sequenceLimit,structureName:R,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:m,stage:wn,stageSequence:a,matchUpType:l,drawSize:C,isMock:p,uuids:h},A=({playoffStructures:N,playoffLinks:k})=>{let[x]=N,O=PM({playoffStructureId:x.structureId,finishingPositions:T,sourceStructureId:r});y.push(O),y.push(...k),v.push(...N),g.push({structureId:x.structureId,finishingPositions:T}),m+=D};if(E===sp){let{matchUps:N}=Cp({finishingPositionLimit:m+D,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:C,isMock:p,uuids:h}),k=kc({structureId:w.structureId??h?.pop(),matchUpFormat:e,stage:wn,structureName:R,stageSequence:a,matchUps:N});v.push(k);let x=PM({playoffStructureId:k.structureId,finishingPositions:T,sourceStructureId:r});y.push(x),m+=D,g.push({structureId:k.structureId,finishingPositions:T})}else if([JT,QT,wn].includes(E)){let N={playoffAttributes:w.playoffAttributes??i,playoffStructureNameBase:w.playoffStructureNameBase,structureId:w.structureId??h?.pop(),structureName:w.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:wn,roundOffset:0,stageSequence:a,drawSize:C,isMock:p,uuids:h};E===JT?Object.assign(N,{playoffAttributes:w?.playoffAttributes??i??r5,roundOffsetLimit:3}):E===QT&&Object.assign(N,{playoffAttributes:w?.playoffAttributes??i??n5,roundOffsetLimit:2});let k=oT(N);if(k.error)return k;if(k.links?.length&&y.push(...k.links),k.structures?.length&&v.push(...k.structures),v.sort(Dw),k.structureId){let x=PM({playoffStructureId:k.structureId,finishingPositions:T,sourceStructureId:r});y.push(x),g.push({structureId:k.structureId,finishingPositions:T})}m+=D}else if([eU,qR,IC,bC,yC,wC].includes(E)){let N=[h?.pop(),h?.pop()],k={playoffStructureNameBase:w.playoffStructureNameBase,structureId:w.structureId??h?.pop(),playoffAttributes:w.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:N,stage:wn,structureName:R,matchUpType:l,feedPolicy:c,drawSize:C,isMock:p},x={[eU]:{fmlc:!0,feedRounds:1},[wC]:{feedRounds:1},[IC]:{feedsFromFinal:3},[bC]:{feedsFromFinal:2},[yC]:{feedsFromFinal:1}};Object.assign(k,x[E]||{});let{structures:O,links:V}=Ib(k),[F]=O,j=PM({playoffStructureId:F.structureId,finishingPositions:T,sourceStructureId:r});y.push(j),y.push(...V),v.push(...O),g.push({structureId:F.structureId,finishingPositions:T}),m+=D}else if([zu].includes(E)){let{structures:N,links:k}=y0({...M,structureOptions:w.structureOptions||{groupSize:4}});A({playoffStructures:N,playoffLinks:k})}else if([zR].includes(E)){let{structures:N,links:k}=Qye(M);A({playoffStructures:N,playoffLinks:k})}else if([BGe].includes(E)){let{structures:N,links:k}=tbe(M);A({playoffStructures:N,playoffLinks:k})}else if([kl].includes(E)){let N=kc({structureId:w.structureId??h?.pop(),structureName:w.structureName,finishingPosition:ON,stage:wn,stageSequence:a,matchUps:[]});A({playoffStructures:[N],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function PM({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Fh,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:dd,roundNumber:1}}}function hWe(t){let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ue({result:{error:Yt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:s,groupCount:o,groupSize:l,event:c}=t,u=ibe({requireSequential:r,sourceStructureId:i,playoffGroups:s,groupCount:o,...t});if(u.error)return ue({result:u,stack:e});let{structures:d=[],links:p=[],finishingPositionTargets:h,positionRangeMap:f}=u,m=h?.map(({finishingPositions:D})=>D).flat().map(D=>f[D].finishingPositions).flat();a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:v}=qn({inContext:!0,drawDefinition:a}),y=d.map(({structureId:D})=>D),b=g?.filter(({structureId:D})=>y.includes(D)).map(Pa),I=v?.drawMatchUps?.filter(({matchUpId:D})=>b?.includes(D));if(I?.length){let D=Zs({drawDefinition:a,event:c})?.tieFormat;D&&I.forEach(C=>{let{tieMatchUps:E}=Fw({isMock:t.isMock,tieFormat:D,matchUp:C});Object.assign(C,{tieMatchUps:E,matchUpType:oc})})}let{positionAssignments:w}=Tr({structureId:i,drawDefinition:a}),T={};w?.forEach(D=>{let C=Ci({element:D,name:nm})?.extension?.value?.groupOrder;C&&(T[C]||(T[C]=[]),T[C].push(D.participantId))});let S=kD({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return S.error&&S.error?.code!==m4.code?ue({result:S,stack:e}):{structures:d,links:p,positionsPlayedOff:m,drawDefinition:a,...oe}}function WS({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),s=Math.max(...i);return(t-r)*(s-a)/(n-r)+a}var rbe="NTRP",fWe={ELO:"ELO",NTRP:rbe,TRN:"TRN",UTR:"UTR",WTN:"WTN"},mWe={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[rbe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Da=mWe;function gWe({sourceRatingType:t,sourceRating:e}){let i=Da[t].range,r=i[0]>i[1],n=Da.ELO.range;return WS({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function vWe({targetRatingType:t,sourceRating:e}){let i=Da[t].decimalsCount||0,r=Da[t].range,n=r[0]>r[1],a=Math.max(...r),s=Da.ELO.range,o=WS({targetRange:r,sourceRange:s,value:e}),l=parseFloat(o.toFixed(i));return n?a-l:l}function jZ(t){let e=Gt(t,[{ratings:!0,[Bo]:Zo}]);if(e.error)return e;let i=t.matchUpType&&[wr,mr].includes(t.matchUpType)?t.matchUpType:wr,r=Object.keys(Da),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:"ELO",a=t.ratings[i]?t.ratings[i].reduce((d,p)=>d.includes(p.scaleName)?d:d.concat(p.scaleName),[]):[];if(!a)return{error:za};let s=t.ratings[i]?.find(d=>d.scaleName===n)??t.ratings[i][0];if(a[0]===n)return s;let o=s.scaleName,l=Da[s.scaleName].accessor,c=l?s.scaleValue[l]:s.scaleValue,u=gWe({sourceRatingType:o,sourceRating:c});return{convertedRating:vWe({targetRatingType:n,sourceRating:u}),sourceRating:c}}function yWe({participantResults:t,sides:e,score:i}){let r=e.find(({sideNumber:o})=>o===1),n=e.find(({sideNumber:o})=>o===2),a=r?.participant?.ratings,s=n?.participant?.ratings;if(a?.[wr]&&s?.[wr]){let o="ELO",{convertedRating:l}=jZ({ratings:a,targetRatingType:o}),{convertedRating:c}=jZ({ratings:s,targetRatingType:o}),{side1pressure:u,side2pressure:d}=bWe({side1ConvertedRating:l,side2ConvertedRating:c,score:i});u&&t[r?.participantId].pressureScores.push(u),d&&t[n?.participantId].pressureScores.push(d);let p=Math.max(...Da.ELO.range),h=s_((c-l)/p),f=s_((l-c)/p);t[r?.participantId].ratingVariation.push(h),t[n?.participantId].ratingVariation.push(f)}}function bWe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),s=Da.ELO.range,o=Math.max(...s),l=(o-r)*0,c=(r+l)/o*a,u=i?.sets?.reduce((y,b)=>y+(b?.side1Score??0),0),d=i?.sets?.reduce((y,b)=>y+(b.side2Score??0),0),p=t>e?2:1,h=(u||0)*(n+(p===1?c:0)),f=(d||0)*(n+(p===2?c:0)),m=h+f,g=m?s_(h/m):0,v=m?s_(f/m):0;return{side1pressure:g,side2pressure:v}}function P6({winningSide:t,matchUpFormat:e=_u,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],s=n?.sets,o=typeof t=="number"&&t-1,l=js(e),c=C6(l?.bestOf??1);if(typeof o=="number"&&(i===br&&r?.setsCreditForDefaults||i===Fr&&r?.setsCreditForWalkovers))a[o]=c;else for(let u of s||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof o=="number"&&i===wa&&(+a[1-o]===c&&(a[1-o]-=1),r?.setsCreditForRetirements&&(a[o]=c)),a}function nbe({matchUpFormat:t=_u,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let s=typeof e=="number"&&e-1,o=js(t),l=o?.bestOf??1,c=C6(l),u=o?.setFormat?.tiebreakAt||0,d=[[],[]];if(typeof s=="number"&&(i===br&&r?.gamesCreditForDefaults||i===Fr&&r?.gamesCreditForWalkovers)){let p=o?.setFormat?.setTo||0,h=c*p;d[s].push(h)}else a.forEach((p,h)=>{let f=(p.setNumber||h+1)>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",m=o?.[f]?.based,g=o?.[f].tiebreakSet,{side1Score:v,side2Score:y}=p;GZ(m)&&!g&&(d[0].push(ri(v||0)),d[1].push(ri(y||0))),g&&p.winningSide&&r?.gamesCreditForTiebreakSets!==!1&&d[p.winningSide-1].push(1)});if(i===wa&&typeof s=="number"){let p=a.length>c&&o?.finalSetFormat?"finalSetFormat":"setFormat",h=o?.[p];if(GZ(h.based)){let f=h?.setTo||0,m=v=>{if(!(!o||v===""))return+v===u-1||+v===u?ri(u||0)+1:+v<u?f:u},g=P6({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(v=>v[s]<=v[1-s]).reduce((v,y)=>v+(y?1:0),0)>g[1-s]){let v=d[s].length,y=m(d[1-s][v-1]);y&&(d[s][v-1]=y)}c>d[s].length&&r?.gamesCreditForRetirements&&d[s].push(f)}}return[d[0].reduce((p,h)=>p+h,0),d[1].reduce((p,h)=>p+h,0)]}function abe({matchUpFormat:t,score:e}){let i=t?js(t):void 0,r=i?.bestOf??1,n=C6(r),a=[0,0],s=[0,0];return e?.sets?.forEach((o,l)=>{let c=(o.setNumber||l+1)>n&&i?.finalSetFormat?"finalSetFormat":"setFormat",u=i?.[c]?.based;if(sbe(u)){let{side1Score:d,side2Score:p}=o;d&&(s[0]+=ri(d||0)),p&&(s[1]+=ri(p||0))}else o.side1TiebreakScore&&(s[0]+=ri(o.side1TiebreakScore||0)),o.side2TiebreakScore&&(s[1]+=ri(o.side2TiebreakScore||0)),(o.side1TiebreakScore||o.side2TiebreakScore)&&o.winningSide&&(a[o.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:a}}function C6(t){return t&&Math.ceil(t/2)||1}function sbe(t){return t==="P"}function GZ(t){return!sbe(t)}function IWe({participantResults:t,groupingTotal:e,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:s}){let o=i&&js(i)||{},l=o.bestOf,c=l&&Math.ceil(l/2)||1,u=o.setFormat?.setTo,d=Math.pow(10,r?.precision||3);Object.keys(t).forEach(p=>{let h=t[p].setsWon,f=t[p].setsLost,m=r?.groupTotalSetsPlayed||e==="setsPct"?s:a*c||h+f,g=Math.round(h/m*d)/d;(g===1/0||isNaN(g))&&(g=m);let v=t[p].tieMatchUpsWon,y=t[p].tieMatchUpsLost,b=v+y,I=Math.round(v/b*d)/d;(I===1/0||isNaN(I))&&(I=v);let w=t[p].matchUpsWon,T=t[p].matchUpsLost,S=w+T,D=Math.round(w/S*d)/d;(D===1/0||isNaN(D))&&(D=w);let C=t[p].gamesWon||0,E=t[p].gamesLost||0,P=(a||0)*c*(u||0),R=r?.groupTotalGamesPlayed||e==="gamesPct"?n:Math.max(P,C+E),M=Math.round(C/R*d)/d;(M===1/0||isNaN(M))&&(M=0);let A=t[p].pointsWon+t[p].pointsLost,N=Math.round(t[p].pointsWon/A*d)/d;(N===1/0||isNaN(N))&&(N=0),t[p].setsWon=h,t[p].setsLost=f,t[p].setsPct=g,t[p].tieMatchUpsWon=v,t[p].tieMatchUpsPct=I,t[p].matchUpsPct=D,t[p].gamesWon=C,t[p].gamesLost=E,t[p].gamesPct=M,t[p].pointsPct=N,t[p].result=`${t[p].matchUpsWon}/${t[p].matchUpsLost}`})}function D0({participantIds:t,pressureRating:e,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:s}){let o={},l=n?.excludeMatchUpStatuses||[],c=s?.filter(h=>(h.tieMatchUps||!l.includes(h.matchUpStatus))&&(!t?.length||En(t,[YS(h,0),YS(h,1)]).length===2)),u=c?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>m?.sets?.length??0):h?.sets?.length??0)?.reduce((h,f)=>h+f,0),d=h=>h?.sets?.reduce((f,m)=>f+(m?.side1Score??0)+(m?.side2Score??0),0)??0,p=c?.flatMap(({score:h,tieMatchUps:f})=>f?f.filter(({matchUpStatus:m})=>!l.includes(m)).flatMap(({score:m})=>d(m)):d(h))?.reduce((h,f)=>h+f,0);for(let h of c??[]){let{matchUpStatus:f,tieMatchUps:m,tieFormat:g,score:v,winningSide:y,sides:b}=h,I=g&&h._disableAutoCalc&&g.collectionDefinitions.every(({scoreValue:S})=>S),w=y&&wWe(h),T=y&&SWe(h);if(!w&&!T)if(f&&la.includes(f)){let S=YS(h,0),D=YS(h,1);S&&(Ym(o,S),o[S].matchUpsCancelled+=1),D&&(Ym(o,D),o[D].matchUpsCancelled+=1)}else if(m?.length){a=0;for(let S of m){if(S.winningSide){let D=b?.find(({sideNumber:E})=>E===S.winningSide)?.participantId,C=b?.find(({sideNumber:E})=>E===S.winningSide)?.participantId;D&&C&&(Ym(o,D),Ym(o,C),o[D].tieMatchUpsWon+=1,o[C].tieMatchUpsLost+=1,On(wr)(S.matchUpType)?(o[D].tieSinglesWon+=1,o[C].tieSinglesLost+=1):On(mr)(S.matchUpType)&&(o[D].tieDoublesWon+=1,o[C].tieDoublesLost+=1))}HZ({score:S.score,manualGamesOverride:I,participantResults:o,sides:b})}}else HZ({manualGamesOverride:I,participantResults:o,score:v,sides:b});else if(Ym(o,w),Ym(o,T),m?.length){a=0;for(let S of m){let{matchUpType:D}=S,C=On(mr)(D),E=On(wr)(D);S.winningSide&&(S.winningSide===y?(w&&(o[w].tieMatchUpsWon+=1,E&&(o[w].tieSinglesWon+=1),C&&(o[w].tieDoublesWon+=1)),T&&(o[T].tieMatchUpsLost+=1,E&&(o[T].tieSinglesLost+=1),C&&(o[T].tieDoublesLost+=1))):S.winningSide!==y&&(T&&(o[T].tieMatchUpsWon+=1,E&&(o[T].tieSinglesWon+=1),C&&(o[T].tieDoublesWon+=1)),w&&(o[w].tieMatchUpsLost+=1,E&&(o[w].tieSinglesLost+=1),C&&(o[w].tieDoublesLost+=1)))),zZ({matchUpFormat:S.matchUpFormat,matchUpStatus:S.matchUpStatus,matchUpType:S.matchUpType,score:S.score,sides:S.sides,winningParticipantId:w,losingParticipantId:T,manualGamesOverride:I,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:y})}obe({winningParticipantId:w,losingParticipantId:T,participantResults:o,matchUpStatus:f})}else zZ({matchUpFormat:h.matchUpFormat??r,matchUpType:h.matchUpType,isTieMatchUp:void 0,winningParticipantId:w,manualGamesOverride:I,losingParticipantId:T,participantResults:o,pressureRating:e,matchUpStatus:f,tallyPolicy:n,winningSide:y,score:v,sides:b});if(I){let S=v?.sets?.reduce((P,R)=>P+(R?.side1Score??0),0),D=v?.sets?.reduce((P,R)=>P+(R.side2Score??0),0),C=b?.find(({sideNumber:P})=>P===1)?.participantId,E=b?.find(({sideNumber:P})=>P===2)?.participantId;Ym(o,C),Ym(o,E),C&&(o[C].gamesWon+=S,o[C].gamesLost+=D),E&&(o[E].gamesWon+=D,o[E].gamesLost+=S)}}return IWe({participantResults:o,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:u}),{participantResults:o}}function wWe(t){let e=t.winningSide-1;return YS(t,e)}function SWe(t){let e=1-(t.winningSide-1);return YS(t,e)}function YS(t,e){if(!t?.sides)return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ym(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function HZ({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],s=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(s[c-1]+=1),a[0].push(ri(u||0)),a[1].push(ri(d||0))}let o=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(Ym(e,u),e[u].setsWon+=s[c],e[u].setsLost+=s[1-c],t||(e[u].gamesWon+=o[c],e[u].gamesLost+=o[1-c]))})}function zZ({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:s,isTieMatchUp:o,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let h=u&&u-1,f=1-h;n&&l===wr&&yWe({participantResults:r,sides:p,score:d}),o||obe({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:s});let m=P6({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=nbe({matchUpStatus:s,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=abe({score:d,matchUpFormat:a});t&&(r[t].setsWon+=m[h],r[t].setsLost+=m[f],e||(r[t].gamesWon+=g[h],r[t].gamesLost+=g[f]),r[t].pointsWon+=v[h],r[t].pointsLost+=v[f]),i&&(r[i].setsWon+=m[f],r[i].setsLost+=m[h],e||(r[i].gamesWon+=g[f],r[i].gamesLost+=g[h]),r[i].pointsWon+=v[f],r[i].pointsLost+=v[h])}function obe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Fr&&(i[e].walkovers+=1),r===br&&(i[e].defaults+=1),r===wa&&(i[e].retirements+=1),_s(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function TWe(t,e,i,r){t.groups&&Object.keys(t.groups).sort(r).forEach(n=>{let a=t.groups[n].map(o=>e[o]).join(", "),s=`${n} ${t.attribute}: ${a}`;i.push(s)})}function UWe(t,e,i,r){if(t.excludedDirectives?.length){let n=t.excludedDirectives.map(({attribute:o})=>o).join(", "),a=`${n.length} directives were excluded due to participants limit}`;r.push(a);let s=`Excluded: ${n}`;r.push(s)}else{let n=(c,u)=>Number.parseFloat(t.reversed?c:u)-Number.parseFloat(t.reversed?u:c),a=t.groups?Object.values(t.groups).flat(1/0).length:t.participantIds?.length??0,s=t.reversed?" in reverse order":"",o=t.groups?"grouped":"separated",l=`Step ${e+1}: ${a} particiants were ${o}${s} by ${t.attribute}`;if(r.push(l),t.idsFilter){let c=`${t.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(c)}TWe(t,i,r,n)}r.push("----------------------")}function DWe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(s=>{s.participantId&&s.participant&&(r[s.participantId]=s.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,s)=>{UWe(a,s,r,n)}),n.push("Final Order:"),e.forEach(a=>{let{participantId:s,resolved:o}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[s]} => resolved: ${!!o}`)}),n.join(`\r
`)}function lbe({participantResults:t,participantIds:e,attribute:i}){return cbe({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:s}=n,o=s?.[i];return!isNaN(o)&&a&&(r[o]?r[o].push(a):r[o]=[a]),r},{})}function cbe(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var EWe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],dB={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function qZ(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!PWe(t))return{};let s=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",o=lbe({participantResults:i,attribute:s});a.push({attribute:s,groups:o});let l=Object.keys(o).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>o[g]).map(g=>{let v=ube({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(y=>y.resolved?y:{...y,subGroup:[v].concat(...y.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let y=parseInt(g.subGroup?.join("")||0);g.resolved?(g.position=v+1,d=g.position):(c&&y>c&&(d+=u,u=0),g.position=d,u+=1),c=y});let h=l.map(({position:g})=>g),f=Nl(h);return l.forEach(g=>{let{participantId:v,position:y}=g||{},b=i[v];g.GEMscore=m(b);let I=f[y];g?.position!==void 0&&(I>1&&(g.ties=I,r&&(g.subOrder=r[v])),g.rankOrder=y,g.groupOrder=y+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(g){return(Array.isArray(n?.GEMscore)?Object.keys(dB).filter(v=>n.GEMscore.includes(v)):Object.keys(dB)).map(v=>(g[v]||0)*Math.pow(10,dB[v].toFixed(3))).reduce((v,y)=>v+y,0)}}function PWe({participantResults:t,participantsCount:e}){let i=cbe({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function CWe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:s,matchUps:o,reversed:l}){let{participantResults:c}=D0({participantIds:s&&e,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=lbe({participantResults:c,participantIds:e,attribute:a}),d=[{attribute:a,reversed:l,groups:u,idsFilter:s,groupTotals:r}],p;return Object.keys(u).length>1&&e.length&&(p=Object.keys(u).map(h=>parseFloat(h)).sort((h,f)=>l?h-f:f-h).map(h=>u[h]).map(h=>{let f=ube({participantResults:c,disableHeadToHead:t,participantIds:h,matchUpFormat:i,tallyPolicy:n,matchUps:o});return d.push(...f.report??[]),f.order}).map((h,f)=>h.map(m=>m.resolved?m:{...m,subGroup:[f].concat(...m.subGroup??[])})).flat()),{order:p,report:d}}function ube({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let s=[],o=[],l;if(i?.length===1)return{order:[{resolved:!0,participantId:i[0]}]};if(i?.length===2&&(!n?.headToHead||!n.headToHead.disabled&&!e)){let u=RWe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return o.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:o}}}let c=(n?.tallyDirectives||EWe).filter(u=>{let d=!(vn(u.maxParticipants)&&i?.length>u.maxParticipants);return d||s.push(u),d});return s.length&&o.push({excludedDirectives:s,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,groupTotals:h,disableHeadToHead:f})=>(l=CWe({disableHeadToHead:f,participantIds:i,matchUpFormat:r,groupTotals:h,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),o.push(l.report),!l.order)),l.order?{order:l.order,report:o}:{order:i?.map(u=>({participantId:u})),report:o}}function RWe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function xD({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:s}){if(!n?.length||!iu(n))return{error:wm};let o=yi(n.map(({structureId:I})=>I));if(o.length!==1)return ue({result:{error:Se,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let l=n.filter(I=>I&&I.matchUpStatus!=="BYE"),c=l.length&&yi(l.map(({drawPositions:I})=>I).flat()).length,u=l.filter(I=>Vv({matchUp:I})).length===l.length;u||(s=0);let d=n.every(({matchUpType:I,tieMatchUps:w})=>I===kr&&w?.every(T=>Vv({matchUp:T}))),p=t?.[f5],h=n.filter(I=>Vv({matchUp:I})??I.matchUpType===kr),{participantResults:f}=D0({matchUps:h,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:s}),m,g,{groupOrder:v,report:y}=qZ({matchUps:h,participantResults:f,participantsCount:c,matchUpFormat:r,subOrderMap:a,tallyPolicy:p});if(i&&MWe({participantResults:f}),u&&v)m=y,g=v,v.forEach(I=>{let{participantId:w,groupOrder:T,rankOrder:S,subOrder:D,ties:C,GEMscore:E}=I,P=f[w];Object.assign(P,{groupOrder:T,rankOrder:S,GEMscore:E,subOrder:D,ties:C})});else{let{groupOrder:I,report:w}=qZ({requireCompletion:!1,participantResults:f,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});m=w,g=I,I&&I.forEach(T=>{let{participantId:S,groupOrder:D,GEMscore:C}=T,E=f[S];Object.assign(E,{provisionalOrder:D,GEMscore:C})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:m};if((u||d)&&(b.order=g),e||cc({tally:!0})){let I=DWe({matchUps:n,report:m,order:g});cc({tally:!0})&&console.log(I),b.readableReport=I}return b}function MWe({participantResults:t}){let e=n=>n.reduce((a,s)=>a+parseFloat(s),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:s}=a,o=s?.length?i(s):0;return{participantId:n,averagePressure:o}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function dbe({positionAssignments:t}){let e=(t||[]).filter(xl(jh)).map(n=>{let{extension:a}=Ci({element:n,name:rU}),s=ri(a?.value),o=!isNaN(s)&&s;return o&&{participantId:n.participantId,subOrder:o}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=Nl(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function R6({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!iu(n))return{error:Se};if(!t)return{error:Se};let{policyDefinitions:s}=Um({policyTypes:[f5],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:o}=dbe({positionAssignments:t}),l=n.length?xD({policyDefinitions:s,matchUpFormat:r,subOrderMap:o,matchUps:n}):void 0;if(l?.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:nm};nr({element:h,extension:m}),c[f].ties||uo({element:h,name:rU})}else uo({element:h,name:nm}),uo({element:h,name:rU})}),Cr({drawDefinition:i}),{...oe,participantResults:c,bracketComplete:u,report:d}}function pbe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function qr(t){let e=Gt(t,[{[Gs]:!0,[Fp]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:s,matchUpId:o,inContext:l,context:c,event:u}=t,{structures:d=[]}=Wu({drawDefinition:a}),p=t.contextContent||n&&Dm({contextProfile:n,drawDefinition:a});for(let h of d){let{matchUps:f}=ar({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:s,inContext:l,structure:h,context:c,event:u}),{matchUp:m}=pbe({matchUps:f,matchUpId:o});if(m)return{matchUp:m,structure:h}}return{error:Ls}}function KL(t){return!qi(t)||!t.notes?{error:Yt}:qi(t.element)?!Yr(t.notes)&&!t.notes?.testing?{error:Se}:(Object.assign(t.element,{notes:t.notes}),{...oe}):{error:Se}}function M6(t){return qi(t)?qi(t.element)?(t.element.notes&&delete t.element.notes,{...oe}):{error:Se}:{error:Yt}}var ZL={matchUpStatus:Pn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function lp(t){let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,tournamentRecord:s,drawDefinition:o,matchUpStatus:l,removeScore:c,winningSide:u,matchUpId:d,event:p,notes:h,score:f}=t,m=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:er({policyTypes:[Gc],tournamentRecord:s,drawDefinition:o,structure:n,event:p})?.appliedPolicies,g=r.matchUpType===kr;if(g&&o){if(d&&r.matchUpId!==d){let S=qr({drawDefinition:o,matchUpId:d,event:p});if(!S.matchUp)return{error:Ls};({matchUp:r,structure:n}=S)}}else r.matchUpId!==d&&console.log("!!!!!");l&&[Fr,ln].includes(l)||c?Object.assign(r,{...ZL}):f&&(r.score=f);let v=l&&r?.matchUpStatus===br&&l!==br;l&&(r.matchUpStatus=l),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),u&&(r.winningSide=u),t.removeWinningSide&&(r.winningSide=void 0),!n&&o&&({structure:n}=qr({drawDefinition:o,matchUpId:d,event:p})),l&&!r.winningSide&&ua(r)&&!la.includes(l)&&![Uw,Kg,Ol].includes(l)&&(r.matchUpStatus=ed);let y;if((v&&r?.processCodes?.length||l===br)&&(y=m?.[Gc]?.processCodes?.incompleteAssignmentsOnDefault),!r.collectionId){let S=n?.structureType===To,D=xo({structure:n});if(G5({drawDefinition:o,structure:n})||D||S){let C=R=>{i=g?"SET1-S:T100":i??r.matchUpFormat??R?.matchUpFormat??o?.matchUpFormat??p?.matchUpFormat;let M=g?{matchUpTypes:[kr]}:void 0,{matchUps:A}=ar({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:M,drawDefinition:o,structure:R,event:p});return D&&(R.positionAssignments=yi(A.flatMap(N=>(N.sides??[]).map(k=>k.participantId)).filter(Boolean)).map(N=>({participantId:N}))),R6({positionAssignments:R.positionAssignments,tournamentRecord:s,drawDefinition:o,matchUpFormat:i,matchUps:A,event:p})},E=S&&n.structures.find(R=>R?.matchUps.find(M=>M.matchUpId===d)),P=C(E||n);if(P.error)return ue({result:P,stack:e})}}if(h){let S=KL({element:r,notes:h});if(S.error)return ue({result:S,stack:e})}let b=s?.tournamentId,I=Jc().topics.includes(PL),w=(I||y)&&rs({drawDefinition:o}),T=w&&qn({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:o,matchUpsMap:w}).matchUps?.[0];if(I&&T&&UHe({tournamentId:b,inContextMatchUp:T}),Array.isArray(y)&&T&&!T.sides?.every(({participantId:S})=>S))if(l===br)r.processCodes=yi([...r.processCodes??[],...y]);else for(let S of y||[]){let D=S&&r?.processCodes?.lastIndexOf(S);r?.processCodes?.splice(D,1)}return Hi({eventId:p?.eventId,context:e,drawDefinition:o,tournamentId:b,matchUp:r}),{...oe}}function N6(t){let{propagateExitStatus:e,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:s,structure:o,matchUp:l}=t,c=p0({matchUpStatus:a})||[$p,sl].includes(a)&&s||r,u=l?.sides?.map(m=>m.participantId).filter(Boolean).length||n?.sides?.map(m=>m.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(xo({structure:o})&&u===1||a===br&&u||NWe({structure:o,matchUp:l,inContextMatchUp:n})||t.appliedPolicies?.[Gc]?.requireParticipantsForScoring===!1||_s(a)&&u===1&&e))return ue({result:{error:S4},stack:d});let p=[Fr].includes(a),h=c?a:t.winningSide&&Tn||Ol,f=lp({...t,winningSide:t.winningSide,matchUpStatusCodes:c&&i||[],matchUpStatus:h,removeScore:p});return ue({result:f,stack:d})}function NWe({structure:t,matchUp:e,inContextMatchUp:i}){let{drawPositions:r}=e,{positionAssignments:n}=ca({structure:t}),a=n?.filter(o=>r?.includes(o.drawPosition)&&o.participantId),s=i?.sides?.every(o=>o.participantId);return a?.length===2||s}function hbe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>mi(r?.groupValue)&&r?.groupNumber).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>ri(r));return{groupValueGroups:e,groupValueNumbers:i}}function AWe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(y=>y.collectionId===t.collectionId),s=[0,0],o=[0,0],l=a.every(y=>la.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),mi(p)?a.forEach(y=>{y.winningSide&&(s[y.winningSide-1]+=p)}):mi(m)?a.forEach(y=>{y.score?.sets?.forEach(b=>{b.winningSide&&(s[b.winningSide-1]+=m)})}):mi(f)?a.forEach(y=>{y.score?.sets?.forEach(b=>{let{side1TiebreakScore:I=0,side2TiebreakScore:w=0,side1Score:T=0,side2Score:S=0}=b;(y.matchUpStatus===Tn||y.winningSide||b.winningSide)&&(T||S?(s[0]+=T,s[1]+=S):(I||w)&&b.winningSide&&(s[b.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=_We({collectionDefinition:t,collectionPosition:b});mi(I)&&(s[y.winningSide-1]+=I)}}),mi(d)){let y;if(h?.aggregateValue)l&&(mi(p||m||f)&&s[0]!==s[1]?y=s[0]>s[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h?.valueGoal)y=s.reduce((b,I,w)=>I>=h.valueGoal?w+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,w,T)=>w>=b?T+1:I,0)}y&&(g?i[u].values[y-1]+=d:o[y-1]+=d)}else g?(i[u].values[0]+=s[0]||0,i[u].values[1]+=s[1]||0):o=s;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):o.forEach((y,b)=>r[b]+=y||0)}function _We({collectionDefinition:t,collectionPosition:e}){return(t.collectionValueProfiles||[])?.find(i=>i.collectionPosition===e)?.matchUpValue}function E0(t){let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:s,event:o}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((I,w)=>I+w)))return{error:Se};if(!s)return{error:ko};let l=Zs({matchUp:s,drawDefinition:r,structure:a,event:o})?.tieFormat||t?.tieFormat;if(!l)return{error:vD};let c=Oo({tieFormat:l});if(c.error)return c;let u=l?.collectionDefinitions||[],d=s?.tieMatchUps??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=hbe(l);for(let I of u)AWe({collectionDefinition:I,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let I of f){let w=h[I],{allGroupMatchUpsCompleted:T,matchUpCount:S,winCriteria:D,groupValue:C,sideWins:E,values:P}=w,R;if(D?.aggregateValue)T&&P[0]!==P[1]&&(R=P[0]>P[1]?1:2);else if(D?.valueGoal)R=P.reduce((M,A,N)=>A>=D.valueGoal?N+1:M,void 0);else{let M=Math.floor(S/2)+1;R=E.reduce((A,N,k)=>N>=M?k+1:A,void 0)}R&&(p[R-1]+=C||0)}let m=p.map((I,w)=>(I||0)+e[w]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l?.winCriteria){let{valueGoal:I,aggregateValue:w,tallyDirectives:T}=l.winCriteria;if(I?b=m.map((S,D)=>({sideNumber:D+1,points:S})).find(({points:S})=>S>=I)?.sideNumber:w&&d.every(S=>S.matchUpStatus&&la.includes(S.matchUpStatus)||S.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&T){let S=s.matchUpId,D=s.hasContext?s:n?.drawMatchUps?.[S]||r&&qr({inContext:!0,drawDefinition:r,matchUpId:S})?.matchUp;if(D){let{completedTieMatchUps:C,order:E}=xD({matchUps:[D]});if(C&&E?.length){let P=E[0].participantId;b=D.sides.find(({participantId:R})=>R===P)?.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function P0({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){t||(t=qr({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e})?.matchUp);let{extension:a}=Ci({element:e,name:im}),s=Et(a?.value||{},!1,!0),o=({displaySideNumber:l,drawPosition:c,sideNumber:u})=>({drawPosition:c,sideNumber:u,displaySideNumber:l});r.sides=t?.sides?.map(l=>{let c=l.participantId,u=c&&s[c]||void 0,{lineUp:d,...p}=r.sides?.find(({sideNumber:f})=>f===l.sideNumber)??{},h=d?.length?d:u;return{...o(l),...p,lineUp:h}}),Hi({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function ls(t){if(t)return Et(t,!1,!0)}function A6(t){let e=Gt(t,[{[Fs]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:o})=>o),s=n.map(o=>(o.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...s),i.eventIds.push(...a),i.drawIds.push(...s),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function fbe({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=A6({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&r?.[n].includes(e)||i&&r?.[n].includes(i))}function Em(t){let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:s,event:o}=t,l=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord?.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||t.tournamentRecord?.tournamentId;l&&fbe({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:et};let d=qr({drawDefinition:i,event:o,matchUpId:s});if(d.error)return d;if(!d.matchUp)return{error:Ls};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:al};P0({tournamentId:u?.tournamentId,eventId:o?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Ci({name:TI,element:p});if(f?.value)if(n)uo({element:p,name:TI});else return{...oe,score:p.score};let m=Zs({drawDefinition:i,structure:h,matchUp:p,event:o})?.tieFormat;p.tieFormat=ls(m);let g=E0({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:o}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,w=y?.side1Score||y?.side2Score;if(e&&!p.score&&!w)return{...oe};let T={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},S=v&&[1,2].includes(v),D=S&&Tn||Z5({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:T})&&ed||Pn,C=!!(p.winningSide&&!S),E=p.tieMatchUps.find(({score:R,winningSide:M,matchUpStatus:A})=>R?.sets?.length&&(R.sets[0].side1Score||R.sets[0].side2Score)||A&&la.includes(A)||M),P;if(p.tieFormat&&!S&&!E){let R=Zs({drawDefinition:i,structure:h,event:o})?.tieFormat;R&&JSON.stringify(m)===JSON.stringify(R)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return lp({appliedPolicies:t.appliedPolicies,matchUpStatus:D,score:T,removeWinningSide:C,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:s,matchUp:p,event:o}),{...oe,score:T,removeWinningSide:C,tieFormatRemoved:P,winningSide:v}}function kWe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:s,sourceMatchUpId:o,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){let h="directWinner";if(s){let f=c.drawPositions||[],m=f[t],g=s.source.structureId,v=oi({structureId:g,drawDefinition:l});if(v.error)return v;let{structure:y}=v,{positionAssignments:b}=ca({structureId:g,drawDefinition:l}),I=b?.find(E=>E.drawPosition===n)?.participantId,w=s.target.structureId,{positionAssignments:T}=ca({structureId:w,drawDefinition:l}),S=T?.find(E=>E.participantId===I)?.drawPosition,D=T?.filter(E=>{let P=f.includes(E.drawPosition),R=!E.participantId&&!E.bye&&!E.qualifier;return P&&R}).map(E=>E.drawPosition),C=D?.includes(m);if(I&&s.target.roundNumber===1&&C)Pp({drawPosition:m,participantId:I,structureId:w,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(I&&D?.length){let E=D.pop();E&&Pp({participantId:I,structureId:w,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:E,matchUpsMap:d,event:p})}else if(S){let E=Yb({drawPosition:S,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(E.error)return ue({result:E,stack:h})}else if(y?.stage!==zt){let E="winner target position unavaiallble";console.log(E),ue({stack:h,result:{error:E}})}if(y?.seedAssignments&&y.structureId!==w){let E=y.seedAssignments.find(({participantId:R})=>R===I),P=E?.participantId;E&&P&&_D({eventId:c?.eventId,structureId:w,...E,tournamentRecord:a,drawDefinition:l,participantId:P})}}else{let f=Yb({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:o,drawDefinition:l,matchUpsMap:d});if(f.error)return f}if(u&&i){let f=u.sides?.find(m=>m.sideNumber===i);if(f?.lineUp){let m=u.roundPosition,g=c.roundPosition,v=m===g&&m!==1||Math.floor(m/2)===g?2:1,y=d?.drawMatchUps?.find(({matchUpId:w})=>w===c.matchUpId),b=[1,2].map(w=>({...y.sides?.find(T=>T.sideNumber===w)||{},sideNumber:w}));y.sides=b;let I=y.sides.find(w=>w.sideNumber===v);if(I){let w=f.lineUp?.filter(T=>T?.participantId);I.lineUp=p6({lineUp:w}),Hi({tournamentId:a?.tournamentId,eventId:c?.eventId,matchUp:y,context:h,drawDefinition:l})}}}return{...oe}}function OWe(t){let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:s,tournamentRecord:o,loserTargetLink:l,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:h}=t,f="directLoser",m=l.linkCondition,g=u.drawPositions||[],v=m===Dp&&u.roundNumber===2&&Math.min(...g.filter(Boolean)),y=v||g[e],b=v||g[1-e],I=l.source.structureId,{structure:w}=oi({structureId:I,drawDefinition:c}),{matchUps:T}=ar({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:w,event:h}),S=T.filter(z=>z.drawPositions?.includes(s)).filter(z=>{let H=z.sides.find(J=>J.drawPosition===s),Z=z.matchUpStatus===Fr||z.matchUpStatus===br&&!ua(z);return H?.sideNumber===z.winningSide&&!Z}),D=m===Dp&&S.length===0,{positionAssignments:C}=ca({structureId:I,drawDefinition:c}),E=C?.find(z=>z.drawPosition===s)?.participantId,P={loserParticipantId:E},R=l.target.structureId,{positionAssignments:M}=ca({structureId:R,drawDefinition:c}),A=M?.filter(({drawPosition:z})=>g.includes(z)),N=A?.some(z=>z.participantId&&E&&z.participantId===E),k=n&&[wa,Fr,br].includes(a||"");if(N)return{...oe,stack:f};let x=A?.filter(z=>{let H=g.includes(z.drawPosition),Z=!z.participantId&&!z.bye&&!z.qualifier;return H&&Z}).map(z=>z.drawPosition),O=x?.includes(y),V=l.target.roundNumber>1&&x?.length,F=l.target.roundNumber===1&&O;if(v){let z=j();if(z.context&&Object.assign(P,z.context),z.error)return ue({result:z,stack:f})}else if(F){let z=W();if(z.context&&Object.assign(P,z.context),z.error)return ue({result:z,stack:f})}else if(E&&V){x.sort(ea);let z=x[0],H=Pp({participantId:E,structureId:R,drawPosition:z,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:h});if(H.error)return ue({result:H,stack:f});if(!H.error&&k&&n)return{stack:f,context:{progressExitStatus:!0,loserParticipantId:E}}}else return ue({context:{loserDrawPosition:s,loserTargetLink:l,targetDrawPositionIsUnfilled:O},result:{error:O?fD:mje},stack:f});if(w?.seedAssignments&&w.structureId!==R){let z=w.seedAssignments.find(({participantId:Z})=>Z===E),H=z?.participantId;z&&H&&_D({eventId:u?.eventId,structureId:R,...z,tournamentRecord:o,drawDefinition:c,participantId:H})}if(d&&r){let z=d.sides?.find(H=>H.sideNumber===3-r);if(z?.lineUp){let{roundNumber:H,eventId:Z}=u,{roundPosition:J}=d,ie=H===1?2-J%2:1,K=p?.drawMatchUps?.find(({matchUpId:re})=>re===u.matchUpId),ne=[1,2].map(re=>({...K.sides?.find(me=>me.sideNumber===re)||{},sideNumber:re}));K.sides=ne;let le=K.sides.find(re=>re.sideNumber===ie);le&&(le.lineUp=p6({lineUp:z.lineUp}),Hi({tournamentId:o?.tournamentId,matchUp:K,context:f,drawDefinition:c,eventId:Z}))}}return ue({result:{...oe},stack:f,context:P});function j(){let z="loserLinkFedFMLC";return ue(D?{result:W(),stack:z}:{result:q(),stack:z})}function q(){let z=bc({drawPosition:b,structureId:R,tournamentRecord:o,drawDefinition:c,event:h});return ue({result:z,stack:"assignLoserPositionBye"})}function W(){let z=E?Pp({drawPosition:y,participantId:E,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:h}):{error:oa};return!z.error&&k&&n?{stack:f,context:{progressExitStatus:!0}}:ue({result:z,stack:"assignLoserDrawPosition"})}}function mbe(t){let e="directParticipants",i=N6(t);if(i.error)return ue({result:i,stack:e});let r=p0({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,matchUpStatusCodes:l,tournamentRecord:c,drawDefinition:u,matchUpStatus:d,dualMatchUp:p,matchUpsMap:h,winningSide:f,targetData:m,matchUpId:g,structure:v,matchUp:y,event:b}=t,I=!!y.collectionId,w=xo({structure:v}),T=y.drawPositions,S;if(I){let{matchUpTieId:D,matchUpsMap:C}=t,E=Em({appliedPolicies:t.appliedPolicies,matchUpId:D,tournamentRecord:c,drawDefinition:u,matchUpsMap:C,event:b});if(S=E&&{tieMatchUpResult:E},T=a.find(({matchUpId:P})=>P===D)?.drawPositions,!n)return ue({result:{...oe,...S},stack:e})}if(w)return ue({result:{...oe,...S},stack:e});if(T){let D=s?s-1:f-1,C=1-D,E=T[D],P=T[C],R={},{targetLinks:{loserTargetLink:M,winnerTargetLink:A,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:k,loserMatchUpDrawPositionIndex:x,winnerMatchUp:O,loserMatchUp:V,byeMatchUp:F}}=m;if(O){let j=kWe({sourceMatchUpStatus:r&&d||Tn,winnerMatchUpDrawPositionIndex:k,sourceMatchUpId:g,inContextDrawMatchUps:a,projectedWinningSide:s,winningDrawPosition:E,tournamentRecord:c,winnerTargetLink:A,drawDefinition:u,winnerMatchUp:O,dualMatchUp:p,matchUpsMap:h,event:b});if(j.error)return ue({result:j,stack:e})}if(V){let j=OWe({sourceMatchUpStatus:r&&d||Tn,loserMatchUpDrawPositionIndex:x,inContextDrawMatchUps:a,projectedWinningSide:s,propagateExitStatus:o,loserDrawPosition:P,tournamentRecord:c,loserTargetLink:M,drawDefinition:u,loserMatchUp:V,matchUpsMap:h,dualMatchUp:p,event:b});if(j.context?.progressExitStatus&&Object.assign(R,j.context,{sourceMatchUpStatus:r&&d||Tn,sourceMatchUpStatusCodes:l||[],loserMatchUp:V,matchUpsMap:h}),j.error)return ue({result:j,stack:e})}if(F){let j=F.drawPositions||[],q=Math.min(...j.filter(Boolean)),W=N.target.structureId,z=bc({drawPosition:q,structureId:W,tournamentRecord:c,drawDefinition:u,event:b});if(z.error)return ue({result:z,stack:e})}return ue({result:{...oe,...S},stack:e,context:R})}else return ue({result:{error:_R},stack:e})}function _6(t){let e="genPlayoffStructure";if(!t.drawDefinition)return ue({result:{error:At},stack:e});let i=U0(t);if(i.error)return ue({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:s,finishingPositionLimit:o,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=Et(t.drawDefinition,!1,!0),{structure:I}=oi({structureId:r,drawDefinition:b});if(!I)return ue({result:{error:en},stack:e});if(I.structureType===To||I.structures)return hWe({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:w,playoffRounds:T}=i,{playoffPositionsReturned:S,error:D,playoffSourceRounds:C,playoffRoundsRanges:E}=Jye(t);if(D)return ue({result:{error:D},stack:e});let P=h?.length&&Object.assign({},...h),R=f||typeof h=="object"&&h.map(J=>Object.keys(J)).flat(),M=Array.isArray(R)&&R.map(J=>!isNaN(J)&&ri(J)).filter(Boolean);if(M){if(!Array.isArray(M))return ue({result:{error:Se},context:{validRoundNumbers:M},stack:e});M.forEach(J=>{if(!T?.includes(J))return ue({result:{error:Se},context:{roundNumber:J},stack:e})})}c&&c.forEach(J=>{if(!S?.includes(J))return ue({result:{error:Se},context:{playoffPosition:J},stack:e})});let A=M||C,N=M?w:E,k=[],x=[];for(let J of A??[]){let ie=N?.find(Le=>Le.roundNumber===J);if(!ie)return ue({result:{error:Se},context:{roundNumber:J},stack:e});let K=ie.finishingPositions.length,ne=Math.min(...ie.finishingPositions)-1,le=2,re=J&&P?.[J]&&le+P[J]-1,me=oT({exitProfile:`0-${J}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:ne,playoffAttributes:l,exitProfileLimit:p,stage:wn,roundOffset:0,drawDefinition:b,sequenceLimit:re,stageSequence:le,drawSize:K,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:s,finishingPositionLimit:o,roundOffsetLimit:u});if(me.error)return ue({result:me,stack:e});let{structures:he,links:Ie}=me;if(he?.length&&k.push(...he),Ie?.length&&x.push(...Ie),me.structureId&&J){let Le={linkType:$h,source:{structureId:r,roundNumber:J},target:{structureId:me.structureId,feedProfile:Uu,roundNumber:1}};x.push(Le)}}if(!k.length)return ue({result:{error:Se},info:"No structures generated",stack:e});b.structures.push(...k),b.links.push(...x);let{matchUps:O,matchUpsMap:V}=qn({inContext:!0,drawDefinition:b}),F=k.map(({structureId:J})=>J),j=O?.filter(({structureId:J})=>F.includes(J)).map(Pa),q=V?.drawMatchUps?.filter(({matchUpId:J})=>j?.includes(J));if(q?.length){let J=Zs({drawDefinition:b,event:v})?.tieFormat;J&&q.forEach(ie=>{let{tieMatchUps:K}=Fw({matchUp:ie,tieFormat:J,isMock:g});Object.assign(ie,{tieMatchUps:K,matchUpType:kr})})}O?.filter(J=>Vv({matchUp:J})&&J.structureId===r)?.forEach(J=>{let{matchUpId:ie,score:K,winningSide:ne}=J,le=yo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ie}),re=mbe({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:V,winningSide:ne,targetData:le,matchUpId:ie,structure:I,matchUp:J,score:K,event:v});re.error&&console.log(re.error)}),O?.filter(J=>J.matchUpStatus==="BYE"&&J.structureId===r)?.forEach(J=>{let{matchUpId:ie}=J,K=yo({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:ie}),{targetLinks:{loserTargetLink:ne},targetMatchUps:{loserMatchUpDrawPositionIndex:le,loserMatchUp:re}}=K;if(ne&&re){let me=ne.target.structureId,he=re.drawPositions[le],Ie=bc({drawPosition:he,structureId:me,tournamentRecord:d,drawDefinition:b,event:v});Ie.error&&console.log(Ie.error)}});let W=[],z=gy({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:V}).goesToMap,{structure:H}=oi({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:Z}=ar({structure:H});return Z.forEach(J=>{let ie=z?.loserMatchUpIds[J.matchUpId];if(ie&&J.loserMatchUpId!==ie){J.loserMatchUpId=ie;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:J};W.push(ne)}let K=z?.winnerMatchUpIds[J.matchUpId];if(K&&J.winnerMatchUpId!==K){J.winnerMatchUpId=K;let ne={tournamentId:d?.tournamentId,eventId:t.event?.eventId,context:e,matchUp:J};W.push(ne)}}),{structures:k,matchUpModifications:W,links:x,drawDefinition:b,...oe}}function gbe({element:t}){if(!t)return{error:Se};if(!t.timeItems)return{};if(!Array.isArray(t.timeItems))return{error:Se};let e=(i,r)=>(n,a)=>(a[i]&&(n[a[i]]=a[r]),n);return t.timeItems.reduce(e("itemType","itemValue"),{})}function Vp(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:x4};let a=Dve(t);if(a.error)return a;if(!(qi(n)&&Yr(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:O4};if(!a.timeItems)a.timeItems=[];else if(xWe({element:a,duplicateValues:e,timeItem:n}))return{...oe};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let s=new Date().toISOString();Object.assign(n,{createdAt:s})}return r&&(a.timeItems=a.timeItems.filter(({itemType:s})=>n.itemType!==s)),r&&!n.itemValue||a.timeItems.push(n),{...oe}}function xWe({element:t,duplicateValues:e,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,s=r&&eu({itemSubTypes:n,itemType:r,element:t})?.timeItem;return s&&JSON.stringify(s?.itemValue)===JSON.stringify(a)&&!e}function k6({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:et};if(!n)return{error:oa};let s=Zg({tournamentRecord:i,participantId:n});return s.error?s:Vp({element:s.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function C0(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;if(!i)return{error:et};let s=Vp({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a});if(s.error)return s;let o=gbe({element:i});return Ii({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:o},topic:zy}),s}function Bw(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Vp({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:Vc}}function vbe(t){return XL({...t,itemType:"attachConsolationStructures"})}function O6(t){return XL({...t,itemType:"attachPlayoffStructures"})}function XL({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:s}){let o="attachStructures";if(!r)return{error:At};if(!Array.isArray(n)||!Array.isArray(a))return ue({result:{error:Se},stack:o});let l=g=>[g.source.structureId,g.source.roundNumber||g.source.finishingPositions?.join("|"),g.target.roundNumber].join("|"),c=r.links?.map(l);if(a.some(g=>{let v=l(g);return c?.includes(v)}))return ue({result:{error:V4},info:"playoff structure exists",stack:o});a.length&&r.links?.push(...a);let u=n.map(({structureId:g})=>g),d=r.structures?.map(({structureId:g})=>g);r.structures=(r.structures??[]).map(g=>u.includes(g.structureId)?n.find(({structureId:v})=>v===g.structureId):g);let p=n?.filter(({structureId:g})=>!d?.includes(g));p.length&&r.structures.push(...p),gy({drawDefinition:r});let h=n.map(g=>ar({structure:g})?.matchUps||[]).flat();wg({tournamentId:i?.tournamentId,eventId:s?.eventId,drawDefinition:r,matchUps:h});let f=n.map(({structureId:g})=>g);if(Cr({drawDefinition:r,structureIds:f}),e?.length){let g={};e.forEach(y=>{let b=y.matchUp?.matchUpId;b&&(g[b]=y)});let v=y=>{y.matchUps.forEach(b=>{if(g[b.matchUpId]){let{tieMatchUps:I,...w}=g[b.matchUpId].matchUp;if(Object.assign(b,w),I?.length){let T={};I.forEach(S=>g[S.matchUpId]=S),b.tieMatchUps.forEach(S=>Object.assign(S,T[S.matchUpId]))}g[b.matchUpId].matchUp=b,Hi(g[b.matchUpId])}})};r.structures.forEach(y=>{if(d?.includes(y.structureId))if(y.structures)for(let b of y.structures)v(b);else v(y)})}let m=p.map(xl("structureId"));if(i){let g={itemValue:{structureIds:f,drawId:r.drawId},itemType:t};Vp({element:i,timeItem:g})}return{...oe,addedStructureIds:m}}function JL(t){let{structures:e,links:i,matchUpModifications:r,error:n}=_6(t);if(n)return{error:n};let a=t.drawDefinition;return O6({tournamentId:t.tournamentRecord?.tournamentId,eventId:t.event?.eventId||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function yy(t){let e=Gt(t,[{_anyOf:{[Fs]:!1,[pa]:!1,[Gs]:!1,[Tm]:!1},[a5]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=WZ(t,r);if(n.error)return n;i.push(...n?.applied??[]),t.drawDefinition&&Cr({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:et};for(let a of n){let s=t.tournamentRecords[a],o=WZ(t,s);if(o.error)return o;i.push(...o?.applied??[])}}else return{error:et};return i.length?{...oe,applied:i}:{error:P4}}function WZ(t,e){let i=er(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:Wx};for(let a of n)if(!i[a]||t.allowReplacement){let s=t.policyDefinitions[a];if(!s)continue;if(!qi(s))return{error:Se};let{policyName:o,...l}=s;if(!l||!Object.keys(l).length||o&&!Yr(o))return{error:Se};i[a]=t.policyDefinitions[a],r.push(a)}return r?.length?{...nr({element:e,extension:{name:UC,value:i}}),applied:r}:{applied:r,error:P4}}function x6({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||typeof r!="string")return ue({result:{error:Se},context:{drawName:r}});i||(i=Rn({event:a}).flightProfile);let s=i?.flights?.find(o=>o.drawId===n);if(s){s.drawName=r;let o={name:qu,value:{...i,flights:i.flights}};Yg({event:a,extension:o})}return e&&(e.drawName=r,Cr({tournamentId:t?.tournamentId,drawDefinition:e})),!s&&!e?{error:At}:{...oe,flight:s}}function ybe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){if(!qi(i))return{error:Se};let a=Rn({event:n}).flightProfile,s=i.drawName&&x6({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(s?.error)return s?.error;let o=s?.flight||a?.flights?.find(l=>l.drawId===r);if(!o&&!e)return{error:At};if(o){let l={name:qu,value:{...a,flights:a.flights}};Yg({event:n,extension:l})}return e&&(i.policyDefinitions&&yy({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Cr({tournamentId:t?.tournamentId,drawDefinition:e})),{...oe}}function bbe({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){if(!i)return{error:At};let r=rs({drawDefinition:i}),n=s=>r?.drawMatchUps?.find(o=>o.matchUpId===s);for(let s of i.structures||[]){let{positionAssignments:o,stage:l,stageSequence:c}=s;o&&(c!==1||![zt,Dt].includes(l))&&(s.positionAssignments=o.map(p=>(delete p.participantId,p)),s.seedAssignments=[]);let{matchUps:u,isRoundRobin:d}=ar({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:s});for(let p of u){let{matchUpId:h,roundNumber:f}=p,m=p.sides||[],g=n(h);if(g){if(delete g.extensions,delete g.notes,g.matchUpStatus!=="BYE"&&Object.assign(g,ZL),f&&f>1&&g.drawPositions?.length&&!d){let v=m?.map(({drawPosition:b,participantFed:I})=>!I&&b).filter(Boolean),y=g.drawPositions.map(b=>v.includes(b)?void 0:b);g.drawPositions=y}e?delete g.timeItems:g.timeItems?.length&&(g.timeItems=g.timeItems.filter(v=>v.itemType&&![zh,Ug,Pw,q5,Cw,Rw].includes(v.itemType))),Hi({tournamentId:t?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:g})}}}i.extensions=i.extensions.filter(s=>s.name!==sT);let a=(i.structures||[]).map(({structureId:s})=>s);return Cr({drawDefinition:i,structureIds:a}),{...oe}}function R0({tournamentRecord:t}){if(!t)return{error:et};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(t.events?.map(r=>{let n=r.eventId;return i[n]=r,(r?.drawDefinitions||[]).map(a=>({drawDefinition:a,eventId:n}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:n})=>{let a=0,s=0,o=0,{allStructuresLinked:l}=qL({drawDefinition:r}),c=i[n],u=(r?.structures||[]).map(b=>{let{stage:I,stageSequence:w,structureId:T}=b,S=wI[I],{inContextStructureMatchUps:D}=h0({drawDefinition:r,structure:b,event:c}),C=D?.filter(({winningSide:q})=>q),E=C.filter(Boolean).length||0;s+=E,o+=D.length-s;let P=Math.max(C.filter(({roundNumber:q})=>q===1).map(({roundPosition:q})=>q)),{positionAssignments:R}=Tr({structure:b}),M=R?.filter(({participantId:q})=>q);a+=M?.length??0;let A=(R?.length??0)-(M?.length??0),{roundMatchUps:N,roundProfile:k,roundNumbers:x,maxMatchUpsCount:O}=vo({matchUps:D}),V=k&&Object.keys(k).filter(q=>!k[q].inactiveRound).map(q=>parseInt(q)),F=k&&Object.keys(k).filter(q=>k[q].inactiveRound).map(q=>parseInt(q)),j=k&&Object.values(k).every(q=>q.inactiveRound);return{positionsAssignedCount:M?.length??0,maxWinningSideFirstRoundPosition:P,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:O,inactiveRounds:F,roundMatchUps:N,activeRounds:V,roundNumbers:x,roundProfile:k,structureId:T,stageSequence:w,orderNumber:S,stage:I}}),d=u.find(b=>b.orderNumber===2&&b.stageSequence===1),p=u.filter(({inactiveStructure:b})=>!b).length,{links:h}=RD({structureId:d.structureId,drawDefinition:r}),f=ri(d.activeRounds[0])===1&&d.activeRounds.length===1&&p===1,m=u?.every(({inactiveStructure:b})=>b),g=!h.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),v=r.drawId;a&&!s&&e.positionsNoOutcomes.push(v),m&&e.inactive.push(v),f&&e.matchPlay.push(v),g&&e.canBePruned.push(v);let y={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:o,positionsAssignedCount:a,allStructuresLinked:l,structuresData:u,inactiveDraw:m,isMatchPlay:f,drawId:v};e.drawAnalysis[v]=y}),{...oe,drawsAnalysis:e}}function Ibe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){if(!e)return{error:et};if(!i)return{error:At};let n=[],{drawsAnalysis:a}=R0({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),o=a.drawAnalysis[r],{structures:[l]}=Wu({stageSequence:1,drawDefinition:i,stage:Dt}),c=o.structuresData.find(({structureId:h})=>l.structureId===h),u=(l.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=u.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let d=n.map(Pa),p=u.map(Pa).filter(h=>!d.includes(h));if(s){let h=n.filter(({roundNumber:y})=>!c.inactiveRounds.includes(y)).filter(({winningSide:y})=>y),f=h.map(Pa),m=d.filter(y=>!f.includes(y));p.push(...m);let g=h.flatMap(y=>y.drawPositions??[]).filter(Boolean).flat(),v=Object.assign({},...g.map((y,b)=>({[y]:b+1})));if(h.forEach(y=>{t?y.drawPositions=y.drawPositions.map(b=>v[b]):delete y.drawPositions}),t){let y=l?.positionAssignments?.filter(b=>g.includes(b.drawPosition)).map(b=>(b.drawPosition=v[b.drawPosition],b));l.positionAssignments=y}else l.positionAssignments=[];l.matchUps=h,n=h}tf({tournamentId:e?.tournamentId,matchUpIds:p,drawDefinition:i}),Cr({drawDefinition:i})}return{...oe,matchUps:n}}function wbe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:s,bye:o}){if(!e)return{error:At};if(!r)return{error:mD};if(!n)return{error:gc};if(o){let l=bc({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:s});if(l.error)return l}else{if(a)return{error:iL};{let l=Pp({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:s});if(l.error)return l}}return{...oe}}function Sbe(t){let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??i?.structures?.find(l=>l.matchUps?.some(({matchUpId:c})=>e.includes(c)))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:en};let n=i.structures?.find(l=>l.structureId===r);if(!n)return{error:en};let a=n?.matchUps,s=a?.find(l=>!!l.roundPosition);if(n.structures||s||n.finishingPosition===Tw)return{error:Vy};let o=a.filter(({roundNumber:l})=>t.roundNumbers?.includes(l)).map(Pa);return e=e.filter(l=>!o.includes(l)),t.roundNumbers&&!e.length&&(e=o),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function Tbe(t){let e=Gt(t,[{[Gs]:!0},{[tU]:{[WR]:!1,roundNumbers:!1},[uc]:Se,[Bo]:Rs}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:s,event:o}=t,l=Sbe(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=d?.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!n)return!1;if(b||ua({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!r)return!1;return p?.includes(v)})??[],m=f.map(Pa),g=f.map(({tieMatchUps:v})=>v?.map(Pa)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),tf({tournamentId:a?.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:o?.eventId,drawDefinition:s});let v=yi(c.matchUps.map(xl("roundNumber"))),y=lje(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,Hi({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:o?.eventId,drawDefinition:s,matchUp:I}))})}if(h.length){c.positionAssignments=yi(c.matchUps.flatMap(S=>(S.sides??[]).map(D=>D.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=c?.matchUpFormat??s?.matchUpFormat??o?.matchUpFormat,I=l.existingMatchUps.some(S=>S.matchUpType===oc)?{matchUpTypes:[oc]}:void 0,{matchUps:w}=ar({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:I,structure:c,event:o});xo({structure:c})&&(c.positionAssignments=yi(w.flatMap(S=>(S.sides??[]).map(D=>D.participantId)).filter(Boolean)).map(S=>({participantId:S})));let T=R6({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:s,matchUpFormat:b,matchUps:w,event:o});T.error&&console.log(T)}Cr({structureIds:[u],eventId:o?.eventId,drawDefinition:s})}return!m.length&&p.length?{error:FR}:{...oe,deletedMatchUpsCount:[...m,...g].length}}function Ube({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:et};if(!i)return{error:At};if(!n)return ue({result:{error:Yt},info:"roundNumber required"});let s=oi({drawDefinition:i,structureId:r});if(s.error)return s;let o=s.structure;return o?.structures?{error:Vy}:xo({structure:o})?LWe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:o}):(console.log("not implemented"),{...oe})}function LWe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let s=n?.matchUps??[],o=[],l=[],c=!1;if(s.reduce((u,d)=>{let p=d?.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ea).includes(r)){let u=s.filter(d=>{let p=d.roundNumber===r&&(!la.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&o.push(...d.tieMatchUps.map(Pa))),!p});l.length&&(tf({matchUpIds:[...o,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Hi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...oe}}function QL(t){let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:At};let s=t?.structureId;if(!s&&r.structures?.length===1&&(s=r.structures?.[0]?.structureId),typeof s!="string")return{error:gc};if(!iu(n))return{error:Se,info:vy("matchUps")};let o=r.structures?.find(p=>p.structureId===s);if(!o)return{error:en};let l=(o?.matchUps).find(p=>!!p.roundPosition);if(o.structures||l||o.finishingPosition===Tw)return{error:Vy};let c=Wa({tournamentRecord:i,inContext:!1})?.matchUps?.map(Pa)??[],u=n.map(Pa);if(go(c,u))return{error:Cme,info:"One or more matchUpIds already present in tournamentRecord"};o.matchUps.push(...n);let d=n.map(({tieMatchUps:p})=>p).filter(Boolean).flat();return e||(wg({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),Cr({drawDefinition:r,structureIds:[s]})),{...oe}}function Dbe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!e)return{error:At};if(!r)return{error:gc};if(!i)return{error:mD};let{structure:s}=oi({drawDefinition:e,structureId:r});if(!s)return{error:en};let o=s;s.structures&&s.structureType===To&&(o=s.structures?.find(h=>h.positionAssignments?.find(f=>f.drawPosition===i)));let l=o?.positionAssignments,c=l?.find(h=>h.drawPosition===i);c&&nr({element:c,extension:{name:rU,value:n}});let u=(a?.eventType===kr||e.matchUpType===kr||(a?.tieFormat??e?.tieFormat??s?.tieFormat))&&{matchUpTypes:[kr]},{matchUps:d}=ar({structure:o,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=s?.matchUpFormat??e.matchUpFormat;return R6({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Cr({drawDefinition:e,structureIds:[r]}),{...oe}}var Ebe={};_i(Ebe,{addGoesTo:()=>gy,allPlayoffPositionsFilled:()=>g6,checkValidEntries:()=>iF,findDrawDefinition:()=>$6,getAssignedParticipantIds:()=>Jy,getAvailableMatchUpsCount:()=>eF,getAvailablePlayoffProfiles:()=>U0,getDrawDefinitionTimeItem:()=>L5,getDrawParticipantRepresentativeIds:()=>F6,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>M0,getEligibleVoluntaryConsolationParticipants:()=>L6,getMatchUpsMap:()=>rs,getParticipantIdFinishingPositions:()=>B6,getPositionAssignments:()=>AC,getPositionsPlayedOff:()=>OD,getRandomQualifierList:()=>G6,getSeedingThresholds:()=>u6,getSeedsCount:()=>N0,getStructureSeedAssignments:()=>Hc,getTeamLineUp:()=>my,getValidGroupSizes:()=>b0,isAdHoc:()=>xo,isCompletedStructure:()=>qh,isValidForQualifying:()=>H6,positionActions:()=>j6});function L6({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:s,drawDefinition:o,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){if(!o)return{error:At};let f=[Dt,wn];i&&f.push(zt);let m=h?.eventType?{matchUpTypes:[h.eventType]}:void 0,g=o?.matchUpType?{matchUpTypes:[o.matchUpType]}:void 0,v=e&&h?nf({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:s,inContext:!0,event:h})?.matchUps??[]:po({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:s,inContext:!0,drawDefinition:o})?.matchUps??[],y=Ew({stage:$a,drawDefinition:o}).map(({participantId:x})=>x),b={},I={},w={},T={};n||(n=Um({policyTypes:[lj],tournamentRecord:s,drawDefinition:o,event:h}).policyDefinitions);let S=n?.[lj];t=t.length&&t||S?.excludedMatchUpStatuses||[],e=e??S?.includeEventParticipants,d=d??S?.allEntries,r=r??S?.finishingRoundLimit,a=a??S?.roundNumberLimit,l=l??S?.matchUpsLimit,c===void 0&&(c=S?.requirePlay!==void 0?S.requirePlay:!0),u===void 0&&(u=S?.requireLoss!==void 0?S.requireLoss:!0),p=p??S?.winsLimit;for(let x of v){if(c&&x.winningSide&&![1,2].includes(x.winningSide)&&x.matchUpStatus!==ln||x.finishingRound&&r&&x.finishingRound>=r||x.finishingRound&&a&&x.finishingRound<=a)continue;let O=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===3-x.winningSide),V=x.sides?.find(({sideNumber:F})=>x.winningSide&&F===x.winningSide);if(x.sides?.forEach(F=>{let j=F?.participant?.participantId;j&&(w[j]=F.participant,x.matchUpStatus===ln&&!c&&(I[j]=F.participant,b[j]||(b[j]=0),(!x.matchUpStatus||!t.includes(x.matchUpStatus))&&(b[j]+=1)))}),O?.participant){let F=O.participant.participantId;I[F]=O.participant,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}if(V?.participant){let F=V.participant.participantId;T[F]||(T[F]=0),T[F]+=1,b[F]||(b[F]=0),x.matchUpStatus&&!t.includes(x.matchUpStatus)&&(b[F]+=1)}}let D=s?.participants&&!c&&!u&&d,C=D?((e&&h?h.entries:o.entries)??[]).filter(x=>![Hh,tu].includes(x.entryStatus)).map(({participantId:x})=>x):[],E=Object.keys(I),P=D?(s?.participants??[]).filter(({participantId:x})=>C.includes(x)):u&&Object.values(I)||Object.values(w),R=x=>!u||E.includes(x),M=x=>!c||(b[x]||0)>=0,A=x=>!p||(T[x]||0)<=p,N=x=>!l||b[x]<=l,k=x=>!y.includes(x);return{eligibleParticipants:P.filter(x=>R(x.participantId)&&M(x.participantId)&&A(x.participantId)&&N(x.participantId)&&k(x.participantId)).map(x=>({...x,individualParticipants:x.individualParticipantIds?.map(O=>s?.participants?.find(V=>V.participantId===O))})),losingParticipantIds:E,...oe}}function eF(t){let e=Gt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(i.structures?.length===1&&i.structures?.[0]?.structureId);if(typeof n!="string")return{error:gc};let a=i.structures?.find(f=>f.structureId===n);if(!a)return{error:en};let s,o=(a.matchUps??[])?.reduce((f,m)=>(m.roundPosition&&(s=!0),(m?.roundNumber||0)>f?m.roundNumber:f),0);if(a.structures||s||a.finishingPosition===Tw)return{error:Vy};let l=i?.entries?.filter(f=>{let m=f.entryStatus;return td.includes(m)})??[],c=Math.floor(l?.length/2)||1,u=r??o??1,d=a.matchUps?.filter(f=>f.roundNumber===u)?.length??0,p=c-d,h=p>0?p:0;return{...oe,availableMatchUpsCount:h,lastRoundNumber:o,roundMatchUpsCount:c}}function F6({drawDefinition:t}){let e=Ci({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:e.extension?.value||[]}}function FWe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:At};let r=qn({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Et(r.matchUps,!1,!0),a=yi(n.reduce((o,l)=>o.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),s=Object.assign({},...a.map(o=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(o));return{[o]:l}}));return{participantIds:a,participantIdMatchUps:s}}function B6({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:At};let{participantIds:r,participantIdMatchUps:n}=FWe({tournamentParticipants:e?.participants,drawDefinition:i}),a=r?.map(s=>{let o=n[s].filter(d=>[Tn,"BYE"].includes(d.matchUpStatus)||d.winningSide),l=o.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===s).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[s]:{relevantMatchUps:o,finishingPositionRanges:l,finishingPositionRange:u}}})||[];return Object.assign({},...a)}function Qg({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:et};if(!r)return{error:Nd};if(!e&&t){if(typeof i!="string"&&(i=fbe({tournamentRecords:t,drawId:r}),!i))return{error:zT};if(e=t[i],!e)return{error:et}}let n=e&&Lo({tournamentRecord:e,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...oe}:ue({result:{error:lc},stack:"findDrawDefinition"})}function $6(t){let{drawDefinition:e,error:i}=Qg(t);return i?{error:i}:{drawDefinition:Et(e)}}function BWe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){let s=a?.entries?.filter(({entryStatus:o})=>[tu,Ky].includes(o)).map(({participantId:o})=>o)||[];if(s.length){let o=r.individualParticipantIds,l=e?t.filter(({participantId:u})=>s.includes(u)):void 0,c=e?t.filter(({participantId:u})=>o.includes(u)):void 0;return{validModifyAssignedPairAction:Ft({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:Yqe,availableIndividualParticipantIds:s,availableIndividualParticipants:l,existingIndividualParticipantIds:o,existingIndividualParticipants:c,type:I6},!1,!1,!0)}}return{}}function by(t){let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if(n?.linkCondition===Dp&&i?.matchUp?.matchUpStatus==="BYE")return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:s},targetLinks:o}=i,l=a&&yo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),c=l?.targetMatchUps?.loserMatchUp,u=l?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=c?.sides[u]?.participant,p=_s(a?.matchUpStatus),h=p&&!d,f=a?.sides?.reduce((b,I)=>I?.participant?++b:b,0)??0,m=a?.winningSide&&p&&f===1,g=s?.drawPositions?.filter(Boolean).length||0;if(!m&&(a?.winningSide&&!h||s?.winningSide&&g===2&&(!s.feedRound||!_s(s?.matchUpStatus))))return!0;let v=s&&yo({matchUpId:s.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),y=l&&by({relevantLink:o?.loserTargetLink,targetData:l,inContextDrawMatchUps:e,drawDefinition:r});return!!(v&&by({targetData:v,inContextDrawMatchUps:e,drawDefinition:r})||y)}var Pbe={[Gh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[zt,Dt],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[NC,PI,WL,Kb],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},VN="positionAction",Uj="matchUpAction";function Cbe({actionType:t=VN,appliedPolicies:e,drawDefinition:i,structure:r}){let n=t===VN&&Gh||t===Uj&&Va,a=t===VN&&Pbe||t===Uj&&sye,s=n&&(e?.[n]||a?.[n]),o=i.links?.filter(d=>d?.target?.structureId===r?.structureId)?.map(({target:d})=>d.feedProfile)??[],{enabledStructures:l,disabledStructures:c}=s||{},u=c?.find(d=>{let{stages:p,stageSequences:h,structureTypes:f,feedProfiles:m}=d;return(!m?.length||Array.isArray(m)&&m.some(g=>o.includes(g)))&&(!p?.length||Array.isArray(p)&&p?.includes(r?.stage))&&(!f?.length||Array.isArray(f)&&f?.includes(r?.structureType))&&(!h?.length||Array.isArray(h)&&h.includes(r?.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:s}}function YZ({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Rbe({enabledStructures:t,drawDefinition:e,structure:i}){if(t===!1)return{};if(!t?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},s=e.links?.filter(o=>o?.target?.structureId===i?.structureId)?.map(({target:o})=>o.feedProfile)||[];return{policyActions:t.find(o=>{let{stages:l,stageSequences:c,structureTypes:u,feedProfiles:d}=o||{},p=!l?.length||Array.isArray(l)&&l.includes(r),h=!c?.length||Array.isArray(c)&&c.includes(n),f=!u?.length||Array.isArray(u)&&u.includes(a),m=!d?.length||Array.isArray(d)&&d.some(g=>s.includes(g));return h&&f&&m&&o&&p})}}function Wo({action:t,policyActions:e}){let i=!e?.enabledActions||e?.disabledActions?.length&&e.disabledActions.includes(t);return i?!1:(e?.enabledActions.length===0||e?.enabledActions.includes(t))&&!i}var Mbe="replaceTieMatchUpParticipantId",Nbe="assignTieMatchUpParticipantId",Dj="removeTieMatchUpParticipantId",KZ="assignMatchUpSideParticipant",$We="removeMatchUpSideParticipant",Abe="substituteParticipant",Ej="REMOVE_SUBSTITUTION",_be="REPLACE_PARTICIPANT",V6="REMOVE_PARTICIPANT",Pj="setMatchUpStatus",Cj="SUBSTITUTION",kbe="SCHEDULE",VWe="PENALTY",Rj="REFEREE",Obe="STATUS",Mj="START",xbe="SCORE",jWe={REPLACE_TEAM_POSITION_METHOD:Mbe,ASSIGN_TEAM_POSITION_METHOD:Nbe,REMOVE_TEAM_POSITION_METHOD:Dj,REPLACE_PARTICIPANT:_be,SUBSTITUTION_METHOD:Abe,REMOVE_SUBSTITUTION:Ej,REMOVE_PARTICIPANT:V6,SCHEDULE_METHOD:Pj,SUBSTITUTION:Cj,SCHEDULE:kbe,PENALTY:VWe,REFEREE:Rj,STATUS:Obe,SCORE:xbe,START:Mj,END:"END"};function GWe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:s,participantId:o,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){let h=[],f=n.sides?.find(A=>A.participant),m=tc(n.gender)&&n.sideNumber&&n.sides?.filter(A=>A.particiapntId).length===1&&f?.participant?.person?.sex,g=n.matchUpType,v=(s??r?.participants?.enforceGender)!==!1?n.gender:void 0,y=n.sides?.flatMap(A=>A.participant?.individualParticipants||A.participant).filter(Boolean)?.map(Fi),b=n.sides?.filter(A=>!l||A.sideNumber===l).flatMap(A=>A.participant?.individualParticipants||A.participant).filter(Boolean),I=b?.map(Fi),w=e?.find(A=>A.matchUpId===n.matchUpTieId)?.sides?.map(A=>A?.participant?.individualParticipants?.filter(({participantId:N,person:k})=>!I?.includes(N)&&(!v||mh(v)||k.sex===v||tc(v)&&!m||m&&k.sex!==m))),T=l?w?.[l-1]:w?.map((A,N)=>({participants:A,sideNumber:N+1})),S=l?w?.[l-1]?.map(Fi):w?.map((A,N)=>({participants:A?.map(Fi),sideNumber:N+1})),D=l&&(On(Hb)(g)&&!I?.length||On(ly)(g)&&(I?.length??0)<2)||!l&&(On(Hb)(g)&&(I?.length??0)<2||On(ly)(g)&&(I?.length??0)<4),C=S?.filter(A=>!y?.includes(A)),E=T?.filter(({participantId:A})=>C.includes(A));if(D&&C?.length&&h.push({availableParticipantIds:C,method:Nbe,availableParticipants:E,type:EI,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),I?.length&&(!ua(u)||p?.substitutions?.length)&&h.push({method:Dj,type:V6,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),E?.length&&(!l&&I?.length||l&&p?.participant)&&h.push({availableParticipantIds:C,method:Mbe,availableParticipants:E,type:_be,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Wo({policyActions:a,action:Ej})&&p?.substitutions?.length){let A=p.participant?.participantType===Bi&&[p.participantId]||p.participant?.participantType===Ei&&p.participant.individualParticipantIds||[],N=p.substitutions.map(k=>k.participantId).filter(k=>A.includes(k));(!o||N.includes(o))&&h.push({method:Dj,type:Ej,substitutedParticipantIds:N,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let P=t?.[Va],R=P?.substituteWithoutScore,M=P?.substituteAfterCompleted;if(Wo({policyActions:a,action:Cj})&&i.length===2&&(!l&&I?.length||l&&p?.participant)&&(R||ua(u))&&(M||u.matchUpStatus&&!la.includes(u.matchUpStatus))&&b?.length&&T.length){let A=b.map(Fi);h.push({info:"list of team players available for substitution",method:Abe,availableParticipantIds:S,existingParticipantIds:A,availableParticipants:T,existingParticipants:b,type:Cj,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function HWe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:s,drawPosition:o,validActions:l,structureId:c,structure:u,drawId:d,event:p}){if(i.includes(o))return{};let h=l.find(S=>S.type===EI)?.availableParticipantIds,f=a?.[Gh]?.otherFlightEntries,m=a?.[Gh]?.restrictQualifyingAlternates,g=(s.entries??[]).filter(({entryStage:S})=>!m||(u.stage===zt?S===zt:S!==zt)).sort((S,D)=>(S.entryPosition??1/0)-(D.entryPosition??1/0)).map(({participantId:S})=>S).filter(Boolean),{allPositionedParticipantIds:v}=pve({drawDefinition:s}),y=r.map(S=>S.participantId).filter(Boolean),b=g.filter(S=>u.stage&&[zt,Dt,wn].includes(u.stage)?!v?.includes(S):!y.includes(S)),I=(p?.entries??[]).filter(S=>S.entryStatus===Ou&&Lbe({restrictQualifyingAlternates:m,structure:u,entry:S})&&(u.stage&&[zt,Dt,wn].includes(u.stage)?!v?.includes(S.participantId):!y.includes(S.participantId))).sort((S,D)=>(S.entryPosition??1/0)-(D.entryPosition??1/0)).map(S=>S.participantId),w=yi(b.concat(I));if(f){let S=(p?Rn({event:p}).flightProfile:void 0)?.flights?.filter(D=>D.drawId!==d).map(D=>D.drawEntries.filter(C=>C.participantId&&![Hh,tu,Ky].includes(C.entryStatus)&&!g.includes(C.participantId)).map(({participantId:C})=>C)).flat().filter(Boolean);S?.length&&w.push(...S)}h?.length&&(w=w.filter(S=>!h.includes(S)));let T=n?t?.filter(S=>w.includes(S.participantId)):void 0;return T?.forEach(S=>{let D=(s.entries??[]).find(C=>C.participantId===S.participantId);S.entryPosition=D?.entryPosition}),T?.sort((S,D)=>(S.entryPosition||1/0)-(D.entryPosition||1/0)),w.length?{validAlternatesAction:Ft({payload:{drawId:d,structureId:c,drawPosition:o},willDisableLinks:e,method:qqe,availableAlternatesParticipantIds:w,type:w6,availableAlternates:T})}:{}}function Lbe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===zt&&!t||i.entryStage===Dt&&r===ws)return!0}function zWe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Ou&&Lbe({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(Fi)}function qWe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:s,matchUpId:o,structure:l,matchUp:c,drawId:u,event:d}){let p=[],h=l?.matchUps??[],f=c.sides?.find(D=>D.sideNumber===s)?.participantId,m=h.filter(({roundNumber:D})=>D===c.roundNumber),g=n?.entries?.filter(({entryStatus:D})=>D&&Zy.includes(D)).map(Fi)??[],v=m.map(D=>(D.sides??[]).flatMap(Fi)).flat().filter(Boolean),y=g.filter(D=>!i.includes(D)&&(!t||!v.includes(D))),b=e?.filter(D=>y?.includes(D.participantId)).map(D=>Et(D,void 0,!0));b?.forEach(D=>{let C=(n.entries??[]).find(E=>E.participantId===D.participantId);D.entryPosition=C?.entryPosition}),y.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:KZ,type:EI,availableParticipantIds:y,participantsAvailable:b});let I=d?.entries??[],w=zWe({eventEntries:I,structure:l}),T=yi(g.concat(w));if(r){let D=(d?Rn({event:d}):void 0)?.flights?.filter(C=>C.drawId!==u).flatMap(C=>C.drawEntries.filter(E=>E.participantId&&![Hh,tu,Ky].includes(E.entryStatus)).map(({participantId:E})=>E)).filter(Boolean);D?.length&&T.push(...D)}T=T.filter(D=>!i.includes(D)&&!y.includes(D)&&(!t||!v.includes(D)));let S=e?.filter(D=>T.includes(D.participantId)).map(D=>Et(D,void 0,!0));if(S?.forEach(D=>{let C=(n.entries??[]).find(E=>E.participantId===D.participantId);D.entryPosition=C?.entryPosition}),S?.sort((D,C)=>(D.entryPosition||1/0)-(C.entryPosition||1/0)),T.length&&p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},availableParticipantIds:T,participantsAvailable:S,method:KZ,type:Ou}),!ua(c)&&s&&f){p.push({payload:{drawId:u,matchUpId:o,structureId:a,sideNumber:s},method:$We,type:V6});let D=k=>k.sides.map(Fi),C=({matchUpId:k})=>k!==c.matchUpId,E=k=>!ua(k),P=c.sides?.find(k=>k.sideNumber!==s)?.participantId,R=h.filter(({roundNumber:k})=>k!==c.roundNumber).filter(C).map(D),M=[P,...R.filter(k=>k.includes(f)).flat()].filter(Boolean),A=k=>!M.flat().includes(k),N=m.filter(E).filter(C).map(D).flat().filter(A);if(N.length){let k=e?.filter(x=>N.includes(x.participantId)).map(x=>Et(x,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:c.roundNumber,structureId:a,sideNumber:s,matchUpId:o,drawId:u},swappableParticipantIds:N,method:Kqe,type:YL,swappableParticipants:k})}}return p}function tF(t){if(!t)return{error:Se};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&Yr(t.tournamentId)&&t.tournamentRecords?.[t.tournamentId]);if(!c)return{error:et};if(!l||!Yr(l))return{error:eo};if(o&&![1,2].includes(o))return ue({result:{error:Se},context:{sideNumber:o}});if(!e){let K=(Wa({tournamentRecord:c}).matchUps??[]).find(le=>le.matchUpId===l);i=(c?.events??[]).find(le=>le.eventId===K?.eventId);let ne=(i?.drawDefinitions??[]).find(le=>le.drawId===K?.drawId);ne&&(e=ne)}if(!e)return{error:At};let u=un({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=qr({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Ls};let f=er({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,n??{});let m=f?.[Gh]?.otherFlightEntries,g=f?.[Va]??AD[Va],{enabledStructures:v}=Cbe({actionType:Uj,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=Rbe({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??rs({drawDefinition:e}),I=t.inContextDrawMatchUps??qn({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,w=I?.find(K=>K.matchUpId===l),T=o&&w?.sides?.find(K=>K.sideNumber===o),S=w?.sides?.map(K=>K.participantId||K.participant?.participantid).filter(Boolean)??[],{assignedPositions:D,allPositionsAssigned:C}=ca({structure:h}),{structureId:E}=h??{},P=[];if(!E)return{validActions:P};let R=xo({structure:h}),M=!!p.collectionId;if(R&&!M){let K=qWe({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:o,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});P.push(...K)}let A=qh({drawDefinition:e,structure:h}),N=D?.filter(K=>K.participantId).map(K=>K.drawPosition),k=D?.filter(K=>K.bye).map(K=>K.drawPosition),x=p.matchUpStatus==="BYE"||!M&&p.drawPositions?.reduce((K,ne)=>k?.includes(ne)||K,!1);if(x)return{validActions:P,isByeMatchUp:x};Wo({policyActions:y,action:Rj})&&P.push({type:Rj,payload:{matchUpId:l}});let O=!p0({matchUpStatus:p.matchUpStatus}),V=f?.scoring?.structures,F=h?.stage&&V?.stage&&V?.stage[h.stage],j=h?.stageSequence&&F?.stageSequence&&F.stageSequence[h.stageSequence],q=!(f?.scoring?.requireAllPositionsAssigned||F?.requireAllPositionsAssigned||j?.requireAllPositionsAssigned)||C,W=p.sides&&p.sides.filter(K=>K?.participantId).length===2,z=p.matchUpStatus&&[ln,ra].includes(p.matchUpStatus),H=yo({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),Z=by({inContextDrawMatchUps:I,drawDefinition:e,targetData:H}),J=(w?.drawPositions?.length===2&&w.drawPositions.every(K=>N?.includes(K))&&w?.sides?.length===2&&w.sides.every(({participantId:K})=>K)||W)&&!(z&&Z),ie={method:zye,type:PI,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&P.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:Pj,type:kbe}),Wo({policyActions:y,action:PI})&&(T?.participant||!o&&S?.length)&&P.push(ie),O&&J&&P.push({type:Obe}),q&&J){let{matchUpId:K,matchUpFormat:ne}=p,le={drawId:d,matchUpId:K,matchUpFormat:ne,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};P.push({info:"set outcome and winningSide",method:Pj,type:xbe,payload:le}),Wo({policyActions:y,action:Mj})&&P.push({type:Mj}),Wo({policyActions:y,action:"END"})&&P.push({type:"END"})}if(M&&w){let K=GWe({specifiedPolicyDefinitions:n,inContextDrawMatchUps:I,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:w,policyActions:y,enforceGender:a,participantId:s,sideNumber:o,matchUpId:l,matchUp:p,drawId:d,side:T});P.push(...K)}return{structureIsComplete:A,validActions:P,isDoubleExit:z,...oe}}function WWe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:s,drawPosition:o,structureId:l,structure:c,drawId:u,event:d}){if(n.includes(o)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=s.links?.reduce((v,y)=>{let b=y.source?.structureId,I=y.target?.structureId;return v.sourceStructureIds.includes(b)||v.sourceStructureIds.push(b),v.targetStructureIds.includes(I)||v.targetStructureIds.push(I),v},{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],m=s.links?.filter(v=>v.target?.structureId===c.structureId)??[];for(let v of m){let y=v?.source?.structureId,{structure:b}=oi({structureId:y,drawDefinition:s}),I=b?.finishingPosition===Tw&&(p?.length!==1||h?.length!==1),w={};if(I){let{matchUps:D}=ar({drawDefinition:s,structure:c,event:d}),{initialRoundNumber:C}=DI({drawPosition:o,matchUps:D}),E=s.links?.find(P=>P.target?.structureId===c?.structureId&&P.target.roundNumber===C)?.source?.roundNumber;w.roundNumbers=[E]}let{completedMatchUps:T}=$L({structureId:y,inContext:!0,matchUpFilters:w,drawDefinition:s}),S=a.map(D=>D.participantId).filter(Boolean);T?.filter(({matchUpType:D,winningSide:C})=>C&&(d?.eventType!==ta||D===ta)).map(({winningSide:D,sides:C})=>D&&C?.[1-(D-1)]).map(Fi).filter(D=>D&&!S.includes(D))?.forEach(D=>{f.includes(D)||f.push(D)})}let g=t?.filter(v=>f?.includes(v.participantId));return g?.forEach(v=>{let y=(s.entries??[]).find(b=>b.participantId===v.participantId);v.entryPosition=y?.entryPosition}),f?.length?{validLuckyLosersAction:{type:T6,method:Wqe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:o}}}:{}}function YWe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:s,returnParticipants:o,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){let{drawId:m}=c,g=[],v,y,b=[],I=l?.[Iu]?.validSeedPositions?.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=bye({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h})),b?.length||(b=s.filter(w=>!w.participantId&&!w.bye&&!w.qualifier).map(w=>w.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:Jqe,type:"BYE"}),a&&I){let w=s.map(E=>E.participantId).filter(Boolean),T={structureIds:t},{completedMatchUps:S}=MD({inContext:!0,matchUpFilters:T,drawDefinition:c}),D=yi((S??[]).filter(({matchUpType:E})=>f?.eventType!==ta||E===ta)?.map(({sides:E})=>E?.map(Fi)).flat().filter(E=>E&&!w.includes(E))),C=o?n?.filter(E=>D?.includes(E.participantId)).map(E=>Et(E,void 0,!0)):void 0;return C?.forEach(E=>{let P=(c.entries??[]).find(R=>R.participantId===E.participantId);E.entryPosition=P?.entryPosition}),C?.length&&g.push(Ft({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:$Z,type:EI,availableParticipantIds:D,participantsAvailable:C})),{validAssignmentActions:g}}if(b.includes(p)||d){let w;if(y?.length){let S=y.filter(D=>v?.includes(D.participantId));S.sort(KWe),w=S.map(D=>D.participantId)}else w=e;let T=o?n?.filter(S=>w.includes(S.participantId)).map(S=>Et(S,void 0,!0)):void 0;T?.length&&g.push(Ft({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:$Z,type:EI,availableParticipantIds:w,participantsAvailable:T}))}return{validAssignmentActions:g}}function KWe(t,e){return t.bye||sU(t.seedValue)<sU(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function ZWe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:s,structureId:o,drawId:l}){let c=[],u=[],d=[],p=[],h=i.map(w=>w.participantId).filter(Boolean),f=n?.[Gh],m=!f?.disableRoundRestrictions&&t[s],g=f?.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=MC({targetRoundNumber:m,linkType:Bh,drawDefinition:a,structureId:o})||{};v?.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=MC({targetRoundNumber:m,linkType:Fh,drawDefinition:a,structureId:o})||{};b?.length&&p.push(...b);for(let w of y){let T=a.structures?.find(D=>D.structureId===w.source.structureId);if(T?.stage!==zt)continue;let S=qh({structureId:w.source.structureId,drawDefinition:a});if(!g||S){let D=T.qualifyingRoundNumber,{matchUps:C}=ar({matchUpFilters:{roundNumbers:[D],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:T});for(let E of C){let P=E.sides.find(M=>M?.sideNumber===E.winningSide),R=E.matchUpStatus==="BYE"&&E.sides?.find(({participantId:M})=>M);if(P||R){let{participantId:M,participant:A}=P||R||{};M&&!h.includes(M)&&(A&&r&&c.push(A),u.push(M))}}}}for(let w of I){let T=a.structures?.find(D=>D.structureId===w.source.structureId);if(T?.stage!==zt)continue;let S=qh({structureId:w.source.structureId,drawDefinition:a});if(!g||S){let{positionAssignments:D}=Tr({structure:T}),C=D?.map(E=>{let P=E.participantId,R=Ci({element:E,name:nm}).extension?.value;return R?{participantId:P,groupOrder:R?.groupOrder}:{}}).filter(({groupOrder:E,participantId:P})=>E===1&&!h.includes(P)).map(({participantId:E})=>E)??[];if(C&&u.push(...C),r){let E=e.filter(({participantId:P})=>C.includes(P));c.push(...E)}}}return u.length&&d.push(Ft({qualifyingParticipants:r?c:void 0,method:Hqe,type:WL,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:s,structureId:o,drawId:l}})),{validAssignmentActions:d,sourceStructureIds:p}}function XWe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:s,byeDrawPositions:o,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(n.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=r?.filter(E=>E!==u&&!(c&&o.includes(E))),v=a?.filter(E=>m(E)&&g?.includes(E.drawPosition))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=ar({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>go(E,y)),w=Object.assign({},...I.map(E=>E.sides?.filter(({sourceDrawPositionRange:P})=>P).map(({drawPosition:P,sourceDrawPositionRange:R})=>({[P]:R}))).flat()),T=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>T.includes(E.participantId)),D=Object.assign({},...S.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=D?.[E.participantId],R=w[E.drawPosition];return Ft({...E,participant:s?Et(P,!1,!0):void 0,sourceDrawPositionRange:R})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:Hye,type:YL,availableAssignments:C}}:{}}function j6(t){let e=Gt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:s,drawPosition:o,event:l}=t,c=t.tournamentParticipants??(a&&un({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=oi({structureId:t.structureId,drawDefinition:s});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:en};let p=d.structureId;if(u=h0({drawDefinition:s,structureId:p}),o===void 0&&!u.isAdHoc)return{error:mD};if(u.isAdHoc)return tF(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=er({tournamentRecord:a,drawDefinition:s,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=Cbe({actionType:VN,appliedPolicies:v,drawDefinition:s,structure:d}),w=y?.activePositionOverrides||[],{sourceStructureIds:T}=MC({finishingPosition:py,targetRoundNumber:1,linkType:Fh,drawDefinition:s,structureId:p})||{},S;T?.length&&(S=T.every(ie=>qh({structureId:ie,drawDefinition:s})));let D=T.length,C=T.length&&!S,{policyActions:E}=Rbe({enabledStructures:b,drawDefinition:s,structure:d}),P=![zt,Dt].includes(d.stage)||d.stageSequence!==1,{drawId:R}=s,M=[],{assignedPositions:A,positionAssignments:N}=ca({structure:d}),k=A?.find(ie=>ie.drawPosition===o),x=!!k;if(!N?.map(ie=>ie.drawPosition)?.includes(o))return{error:fD};let{stage:O,stageSequence:V}=d,F=[O];O===ws&&F.push(Dt),O===Dt&&F.push(ws);let j=Ew({entryStatuses:Zy,provisionalPositioning:n,drawDefinition:s,stageSequence:V,structureId:p,stages:F}),q=Jy({drawDefinition:s,stages:F}).assignedParticipantIds??[],W=j.filter(ie=>!q.includes(ie.participantId)).map(ie=>ie.participantId),z=g.includes(o),H=m.includes(o);if(I)return{info:"Actions Disabled for structure",isActiveDrawPosition:H,isDrawPosition:!0,hasPositionAssigned:x,validActions:[],isByePosition:z};if(Wo({policyActions:E,action:EI})&&!H&&N&&!C&&(!k||z)){let{validAssignmentActions:ie}=YWe({positionSourceStructureIds:T,unassignedParticipantIds:W,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:v,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,event:l});ie?.forEach(K=>M.push(K))}if(Wo({policyActions:E,action:WL})&&!H){let{validAssignmentActions:ie}=ZWe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:N,returnParticipants:r,appliedPolicies:v,drawDefinition:s,drawPosition:o,structureId:p,drawId:R});ie?.forEach(K=>M.push(K))}let{participantId:Z}=k||{},J=Z&&c.find(ie=>ie.participantId===Z);if(k){Wo({policyActions:E,action:Tj})&&!H&&(M.push({type:Tj,method:BZ,payload:{drawId:R,structureId:p,drawPosition:o},willDisableLinks:P}),z||M.push({type:S6,method:zqe,payload:{drawId:R,structureId:p,drawPosition:o},willDisableLinks:P}),Wo({policyActions:E,action:"BYE"})&&!z&&M.push({type:"BYE",method:BZ,payload:{drawId:R,structureId:p,drawPosition:o,replaceWithBye:!0},willDisableLinks:P}));let ie=d.stage===zt||d.stage===Dt&&d.stageSequence===1;if(!z&&YZ({activePositionOverrides:w,activeDrawPositions:m,action:Kb})&&Wo({policyActions:E,action:Kb})&&T_({drawDefinition:s,structureId:p,drawPosition:o})&&ie){let{seedAssignments:K}=Hc({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne,seedValue:le}=K?.find(re=>re.participantId===Z)??{};M.push({type:Kb,method:Qqe,participant:J,seedNumber:ne,payload:{drawId:R,structureId:p,participantId:Z,seedValue:le}})}if(!z&&YZ({activePositionOverrides:w,activeDrawPositions:m,action:nP})&&Wo({policyActions:E,action:nP})&&T_({drawDefinition:s,structureId:p,drawPosition:o})&&ie){let{seedAssignments:K}=Hc({returnAllProxies:!0,drawDefinition:s,structure:d}),{seedNumber:ne}=K?.find(le=>le.participantId===Z)??{};M.push({method:Xqe,type:nP,participant:J,seedNumber:ne,payload:{participantId:Z,structureId:p,drawId:R}})}if(!z&&Z){if(Wo({policyActions:E,action:PI})){let K={type:PI,method:zye,participant:J,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};M.push(K)}if(Wo({policyActions:E,action:NC})){let K={type:NC,method:Zqe,participant:J,payload:{participantId:Z,otherName:void 0}};M.push(K)}}if(Wo({policyActions:E,action:YL})){let{validSwapAction:K}=XWe({possiblyDisablingAction:P,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:N,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:z,drawPosition:o,structureId:p,structure:d,drawId:R});K&&M.push(K)}}if(Wo({policyActions:E,action:w6})&&!C){let{validAlternatesAction:ie}=HWe({possiblyDisablingAction:P,tournamentParticipants:c,positionAssignments:N,activeDrawPositions:m,returnParticipants:r,appliedPolicies:v,drawDefinition:s,drawPosition:o,validActions:M,structureId:p,structure:d,drawId:R,event:l});ie&&M.push(ie)}if(Wo({policyActions:E,action:T6})&&!C&&!H&&N){let{validLuckyLosersAction:ie}=WWe({sourceStructuresComplete:S,possiblyDisablingAction:P,isWinRatioFedStructure:D,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:N,drawDefinition:s,drawPosition:o,structureId:p,structure:d,drawId:R});ie&&M.push(ie)}if(J?.participantType===Ei&&Wo({policyActions:E,action:I6})){let{validModifyAssignedPairAction:ie}=BWe({tournamentParticipants:c,returnParticipants:r,drawPosition:o,participant:J,drawId:R,event:l});ie&&M.push(ie)}return{isActiveDrawPosition:H,isDrawPosition:!0,hasPositionAssigned:x,isByePosition:z,validActions:M,...oe}}function M0({policyDefinitions:t,appliedPolicies:e,drawType:i}){let r=t?.[f_]?.drawTypeCoercion,n=e?.[f_]?.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&r?.[i])??(typeof n=="boolean"?n:void 0)??(i&&n?.[i])??!0}var G6=({drawDefinition:t})=>{let e=Gt({drawDefinition:t},[{[Gs]:!0}]);if(e.error)return e;let i=t.structures?.find(n=>n.stage===Dt&&n.stageSequence===1);if(!i)return ue({result:{error:w4}});let{qualifierPositions:r}=ca({structure:i});return yt(0,r.length).sort(()=>Math.random()-.5)};function H6({structureId:t,drawDefinition:e}){if(!e)return{error:At};if(!Yr(t))return{error:Se};let i=RD({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!En([dy,Uu,pL,uy],r).length;return{...oe,valid:n}}function AC({tournamentRecord:t,drawDefinition:e,stage:i=Dt,structureId:r,structure:n}){if(!t)return{error:et};if(!n&&!e)return{error:At};if(!n&&!r&&e?.structures?.filter(o=>o.stage===i).length===1&&(n=e.structures.find(o=>o.stage===i)),!n&&!r)return{error:gc};let{error:a,positionAssignments:s}=Tr({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n?.structureId,error:a}}function Fbe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Se};let i=hD(t);return i?{drawSize:i}:ue({result:{error:Se},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function N0(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:s,event:o}=t||{},l="getSeedsCount",c=t?.participantsCount??t?.participantCount;if(!i){let f=Um({tournamentRecord:a,drawDefinition:s,event:o});if(f.error)return ue({result:f,stack:l});i=f.policyDefinitions}let u=mi(c);if(c&&!u)return ue({result:{error:Se},context:{participantsCount:c},stack:l});if(n&&!u)return ue({result:{error:ame},stack:l});if(isNaN(r))if(c)({drawSize:r}=Fbe({participantsCount:c}));else return ue({result:{error:kR},stack:l});let d=n&&c||r;if(d&&d>r)return{error:M4};let p=i?.[Iu];if(!p)return{error:qfe};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=r:r===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:Mfe}}function iF({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:s,event:o}){if((!s||!n)&&i&&({participants:s,participantMap:n}=un({tournamentRecord:i})),!s)return{error:LR};if(!Array.isArray(s))return{error:Se};if(!o)return{error:Lr};let l=e?.[Va]??r?.[Va]??AD[Va],c=(a??l?.participants?.enforceGender)!==!1,{eventType:u,gender:d}=o,p=u===em,h=u===_l&&hr||p&&Ei||Bi,f=Object.assign({},...(t??o.entries??[]).map(v=>({[v.participantId]:v.entryStatus}))),m=Object.keys(f),g=s.filter(v=>m.includes(v.participantId)).filter(v=>{let y=JWe({participant:v,participantType:h,eventType:u,entryStatusMap:f}),b=QWe({genderEnforced:c,participantMap:n,eventGender:d,participant:v,isDoubles:p,mismatch:y});return y||!b});if(g.length){let v=g.map(y=>y.participantId);return{error:Bfe,invalidParticipantIds:v}}return{...oe,valid:!0}}function JWe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[em,_l].includes(i)&&t.participantType===Bi&&(Uv(n)||n===Hh);return t.participantType!==e&&!a}function QWe(t){let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:s}=t,o=!n&&a&&yi(e?.individualParticipantIds?.map(d=>i?.[d]?.participant?.person?.sex).filter(Boolean)??[])||[],l=!r||!o?.length||mh(r)||Sp(r)&&Ns(o[0])===Ns(r)||tc(r)&&(o.length===1&&e.individualParticipantIds?.length===1||o.length===2),c=e?.person?.sex,u=!e?.person||!r||tc(r)||mh(r)||Sp(r)&&Ns(c)===Ns(r);return!s||l&&u}function Bbe({hasExistingDrawDefinition:t,qualifyingProfiles:e,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:s,uuids:o}){let l="generateQualifyingSTructures",c=[],u=[],d=[],p=(y,b)=>y.stageSequence-b.stageSequence,h=(y,b)=>y.roundTarget-b.roundTarget,f=0,m=0,g,v=1;for(let y of e.sort(h)){let b=y.structureProfiles||[];v=y.roundTarget||v;let I=1,w=0,T,S,D;for(let C of(b||[]).sort(p)){let E=h4(C.drawSize||C.participantsCount),{qualifyingRoundNumber:P,structureOptions:R,matchUpFormat:M,structureName:A,structureId:N,drawType:k}=C,x=C.matchUpType,O=C.qualifyingPositions||e3e({drawSize:E,qualifyingRoundNumber:P}),V,F,j;if(!mi(E))return ue({result:{error:kR},stack:l});let q=e.length>1?`${v}-`:"",W=b.length>1||q?I:"",z=A||(q||W?`${ys(zt)} ${q}${W}`:ys(zt));if(k===zu){let{structures:H,groupCount:Z,maxRoundNumber:J}=y0({structureName:C.structureName||z,structureId:N||o?.pop(),hasExistingDrawDefinition:t,stage:zt,structureOptions:R,appliedPolicies:i,qualifyingOnly:r,stageSequence:I,matchUpType:x,roundTarget:v,tieFormat:n,drawSize:E,idPrefix:a,isMock:s,uuids:o});w=Z,V=J,F=H[0],g=[1]}else({drawSize:E,matchUps:j,roundLimit:V}=Cp({qualifyingRoundNumber:P,qualifyingPositions:O,matchUpType:x,drawSize:E,idPrefix:a,isMock:s,uuids:o})),F=kc({structureName:C.structureName||z,structureId:N||o?.pop(),qualifyingRoundNumber:V,hasExistingDrawDefinition:t,stage:zt,qualifyingOnly:r,matchUpFormat:M,stageSequence:I,matchUpType:x,roundLimit:V,tieFormat:n,matchUps:j}),v&&nr({extension:{name:Bp,value:v},element:F}),w=j?.filter(H=>H.roundNumber===V)?.length||0;if(I>1){let{link:H}=S0({sourceStructureId:S,sourceRoundNumber:T,targetStructureId:F.structureId,finishingPositions:D===Fh?[1]:void 0,linkType:D});d.push(H),f+=(E||0)-w}else f+=E||0;D=k===zu?Fh:Bh,S=F.structureId,T=V,n&&(j=ar({structure:F})?.matchUps||[],j?.forEach(H=>{let{tieMatchUps:Z}=Fw({tieFormat:n,matchUp:H,isMock:s});Object.assign(H,{tieMatchUps:Z,matchUpType:x})})),u.push(F),I+=1}m+=w,c.push({qualifiersCount:w,finalQualifyingRoundNumber:T,finalQualifyingStructureId:S,finishingPositions:g,roundTarget:v,linkType:D}),v+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:f,qualifyingDetails:c,structures:u,...oe,links:d}}function e3e({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function $be(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=ri(t.drawSize),n=e&&t.drawType!==kl&&(typeof e=="boolean"||e<=2)&&r===2&&sp||t.drawType||sp,a=Fge.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=sp;else if(r<4&&i)return{...ue({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:qx},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function t3e(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:ys(Dt),...t,stage:Dt},{structures:a,groupCount:s}=y0(n);if(s<1)return{error:Sme};let o=i?.playoffGroups||[{finishingPositions:[1],structureName:ys(wn)}],[l]=a,{structures:c,links:u}=ibe({sourceStructureId:l.structureId,requireSequential:r,drawDefinition:e,playoffGroups:o,groupCount:s,...t});return c&&a.push(...c),{...oe,structures:a,links:u}}function i3e({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),s=r.map((c,u)=>{let d=r.indexOf(c)%2?Uu:dy,p=1+u;return{linkType:$h,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),o={linkType:Bh,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Uu,roundNumber:n,structureId:t.structureId}},l=[{linkType:Bh,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Uu,roundNumber:1,structureId:i.structureId}},{linkType:$h,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:Uu,roundNumber:1,structureId:i.structureId}}];return[...s,o,...l]}function r3e({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let s=[],{matchUps:o}=Dg({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=ag({structureName:t||ys(Dt),structureId:a?.pop(),stageSequence:1,stage:Dt,matchUpType:e,matchUps:o});s.push(l);let c=r/2,{matchUps:u}=Dg({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=ag({structureName:ys(Lge),matchUps:u,structureId:a?.pop(),stage:ws,stageSequence:2,matchUpType:e});s.push(d);let{matchUps:p}=Cp({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),h=ag({structureName:ys(xge),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:wn,matchUpType:e});s.push(h);let f=i3e({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:s,links:f,...oe}}function n3e(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:s,isMock:o,uuids:l}=t;if(!mi(s)||s<2)return{matchUps:[],roundsCount:0};if(Dd(s))return Cp(t);let c=a3e(s),u=c.shift(),d=yt(1,(u?.participantsCount||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=E_({roundNumber:h,matchUpType:n,idPrefix:a,matchUps:p,isMock:o,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=yt(1,v+1);r&&v===r&&(f=h-1);let b=y.map(I=>{let w=U6({roundPosition:I,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:w}});p.push(...b),h++}let m=h-1;return p=d0({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function a3e(t){let e=ri(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),s=a===1,o=!!(!s&&a%2);i=!s&&o?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:o})}return n}function Vbe(t){let{playoffAttributes:e,stageSequence:i=1,stage:r=Dt,tieFormat:n,matchUpType:a,drawSize:s,uuids:o}=t,l=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||l()||o?.pop(),u=t.appliedPolicies??er(t),d=t.policyDefinitions?.[iU]||u?.[iU];t.skipRounds=t.skipRounds||s<=4&&(d?.feedFromMainFinal?0:1)||0;let p=t.structureName??e?.["0"]?.name??ys(Dt),h=()=>{let{matchUps:f}=Cp(t);return{structures:[kc({stageSequence:i,structureName:p,matchUpType:a,structureId:c,tieFormat:n,matchUps:f,stage:r})],links:[],...oe}};return{generators:{[kl]:()=>({structures:[kc({finishingPosition:py,stageSequence:i,structureName:p,matchUps:[],matchUpType:a,structureId:c,stage:r})],links:[],...oe}),[Hy]:()=>{let{matchUps:f}=n3e(t);return{structures:[kc({stageSequence:i,structureName:p,matchUpType:a,structureId:c,matchUps:f,stage:r})],links:[],...oe}},[sp]:()=>h(),[HR]:()=>r3e(t),[JT]:()=>oT({...t,roundOffsetLimit:3,playoffAttributes:e??r5}),[QT]:()=>oT({...t,roundOffsetLimit:2,playoffAttributes:e??n5}),[wn]:()=>oT(t),[SD]:()=>{let{matchUps:f}=Dg({drawSize:s,uuids:o,matchUpType:a});return{structures:[kc({stageSequence:i,structureName:p,matchUpType:a,structureId:c,stage:Dt,tieFormat:n,matchUps:f})],links:[],...oe}},[zR]:()=>Qye(t),[eU]:()=>Ib({...t,feedRounds:1,fmlc:!0}),[Oge]:()=>Ib({...t,feedRounds:1}),[e5]:()=>Ib({...t,feedsFromFinal:1}),[t5]:()=>Ib({...t,feedsFromFinal:2}),[i5]:()=>Ib({...t,feedsFromFinal:3}),[qR]:()=>Ib(t),[hL]:()=>tbe(t),[zu]:()=>y0(t),[Vh]:()=>t3e(t)}}}function z6(t){let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:s,tieFormat:o,isMock:l,uuids:c}=t||{},u=ri(t.drawSize),d=t.drawTypeCoercion??M0({appliedPolicies:r,drawType:t.drawType}),p="generateDrawStructuresAndLinks",h=$be({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:d,drawSize:u});if(h.error)return h;let f=h.drawType,m=[],g=[],v=t?.matchUpType??wr,y=s?.structures?.filter(({stage:W})=>W===zt);y&&m.push(...y);let b=y?.map(({structureId:W})=>W),I=s?.structures?.find(({stage:W,stageSequence:z})=>W===Dt&&z===1),w=s?.links?.filter(W=>W.target.structureId===I?.structureId&&b?.includes(W.source.structureId)),T=(W,z)=>{if(W.linkType===Fh&&z?.structures){let H=W.source.finishingPositions||[];return z.structures.length*H.length}else if(W.linkType===Bh&&z?.matchUps?.length){let H=W.source.roundNumber;return z.matchUps.filter(({roundNumber:Z})=>Z===H).length}},S=y?.map(W=>{let z=w?.find(K=>K.target.structureId===W.structureId),H=Tr({structure:W})?.positionAssignments?.length??0;if(!z)return H;let Z=z?.source.structureId,J=s.structures?.find(K=>K.structureId===Z),ie=T(z,J)||0;return H-ie}).filter(Boolean).reduce((W,z)=>W+z,0),D=w?.map(W=>{let z=W.source.structureId,H=y?.find(Z=>Z.structureId===z);return T(W,H)}).filter(Boolean).reduce((W,z)=>W+z,0),C=!!(I&&!I?.matchUps?.length);if(y?.length&&!C)return{error:rj};let E=!y?.length&&t.qualifyingProfiles,P=E?.length&&Bbe({idPrefix:t.idPrefix,qualifyingProfiles:E,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,isMock:l,uuids:c});if(P?.error)return P;let{qualifyingDrawPositionsCount:R,qualifyingDetails:M,qualifiersCount:A}=P||{qualifyingDrawPositionsCount:S,qualifiersCount:D};R&&(P?.structures&&m.push(...P.structures),P?.links&&g.push(...P.links)),Object.assign(t,Ft({drawSize:u,matchUpType:v,tieFormat:o}));let N=f!==kl&&(!u||u<2||!a&&![SD,Hy].includes(f)&&([Vh,zu].includes(f)&&u<3||![zu,Vh].includes(f)&&!Dd(u)));if(N&&!R)return ue({context:{drawSize:u,invalidDrawSize:N},result:{error:qx},stack:p});let{generators:k,error:x}=Vbe(t);if(x)return{error:x};let O=k[f];if(!O)return{error:v4};let V=O?.();if(V.error)return V;let{structures:F,links:j}=V;if(F?.length){let W=F.find(({stage:z,stageSequence:H})=>z===Dt&&H===1);if(I&&W){if(C){let z=W.structureId;if(W.structureId=I.structureId,j?.length)for(let H of j)H.source.structureId===z&&(H.source.structureId=I.structureId),H.target.structureId===z&&(H.target.structureId=I.structureId)}else if(!i)return{error:rj}}m.push(...F)}m.sort(Dw),j?.length&&g.push(...j);let q=V.structures.find(({stage:W,stageSequence:z})=>W===Dt&&z===1);for(let W of M||[]){let{finalQualifyingRoundNumber:z,finalQualifyingStructureId:H,roundTarget:Z,finishingPositions:J,linkType:ie}=W,K=q&&S0({targetStructureId:q.structureId,sourceStructureId:H,sourceRoundNumber:z,finishingPositions:J,targetEntryRound:Z,linkType:ie})?.link;if(K?.error)return K;K&&g.push(K)}return w&&g.push(...w),{...oe,qualifyingResult:{qualifyingDrawPositionsCount:R,qualifiersCount:A},structures:m,links:g}}function q6(t){let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ue({result:{error:At},stack:n});let a=e?t.drawDefinition:Et(t.drawDefinition,!1,!0),{tieFormat:s,matchUpType:o}=t;if(s){let b=Oo({tieFormat:s});if(b.error)return b}s=ls(s??Zs({drawDefinition:a})?.tieFormat),o=o??(a.matchUpType||wr),t.tieFormat=s,t.matchUpType=o;let l=S_({drawDefinition:a,stage:Dt});t.drawSize=t.drawSize??l,!l&&t.drawSize&&D_({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Dt});let c=rs({drawDefinition:a}).drawMatchUps.map(Pa),u=z6(t);if(u.error)return ue({result:u,stack:n});let{structures:d,links:p,qualifyingResult:h}=u;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,h?.qualifiersCount||0);if(h?.qualifyingDrawPositionsCount&&!S_({stage:zt,drawDefinition:a})){let b=D_({drawSize:h.qualifyingDrawPositionsCount,stage:zt,drawDefinition:a});if(b.error)return b}if(f){let b=Vye({qualifiersCount:f,drawDefinition:a,stage:Dt});if(b.error)return b}let m=t.drawSize??l;Object.assign(t,Ft({drawSize:m,matchUpType:o,tieFormat:s}));let{matchUps:g,matchUpsMap:v}=qn({drawDefinition:a});s&&g?.forEach(b=>{if(!c.includes(b.matchUpId)){let{tieMatchUps:I}=Fw({tieFormat:s,matchUp:b,isMock:r});Object.assign(b,{tieMatchUps:I,matchUpType:o})}});let{inContextDrawMatchUps:y}=gy({drawDefinition:a,matchUpsMap:v});return Cr({tournamentId:t.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...oe,structures:d,matchUps:g,links:p}}function A0(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,s;if(!Gbe({scaleItem:n}))return{error:yI};if(r&&Array.isArray(i.participants)&&(s=i.participants.find(o=>o.participantId===r),s)){if(s.participantType===Ro&&n?.eventType!==_l)return{error:yI};let o=Hbe({removePriorValues:e,participant:s,scaleItem:n});if(o.error)return o;a=!o.valueChanged;let{topics:l}=Jc();l.includes(Ss)&&Ii({topic:Ss,payload:{tournamentId:i.tournamentId,participants:[s]}})}return a&&{...oe,info:B4,existingValue:n?.scaleValue}||s&&{...oe,newValue:n?.scaleValue}||{error:_n}}function jbe(t){let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:et};if(!r.participants)return{error:LR};let s=0,o={},l=[];for(let d of e){let p=d?.participantId;if(Array.isArray(d?.scaleItems))for(let h of d.scaleItems)if(Gbe({scaleItem:h}))Array.isArray(o[p])||(o[p]=[]),o[p].push(h);else return{error:yI}}for(let d of r.participants){let{participantId:p}=d||{};if(Array.isArray(o[p]))for(let h of o[p]){if(d.participantType===Ro&&h?.eventType!==_l)return ue({context:{participantId:p,scaleItem:h,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:yI}});Hbe({participant:d,scaleItem:h,removePriorValues:i}),l.push(d),s++}}let c=s?void 0:ID,{topics:u}=Jc();if(u.includes(Ss)&&s&&Ii({topic:Ss,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:d,drawId:p,...h}=a,f=h.scaleAttributes?.scaleType&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let m={itemType:T5,itemValue:h};if(f&&(m.itemSubTypes=f),p||d){let{drawDefinition:g,event:v}=Lo({tournamentRecord:r,eventId:d,drawId:p});p&&b6({drawDefinition:g,timeItem:m}),d&&Bw({event:v,timeItem:m})}else C0({tournamentRecord:r,timeItem:m})}}return n&&u.includes(Of)&&Ii({topic:Of,payload:n}),Ft({...oe,modificationsApplied:s,info:c})}function Gbe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e?.includes(r)).length===i.length}function Hbe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:vw};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:yI};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:s}=yh({scaleAttributes:i,participant:e}),o=c=>[void 0,null,""].includes(c),l=!(o(s?.scaleValue)&&o(i.scaleValue))&&JSON.stringify(s?.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[hy,c,u,d].join("."),h=Ft({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...oe,valueChanged:l,newValue:i.scaleValue}}function W6(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=Gt(t,[{[pa]:!0},{modifiedScaleValues:!0,[Bo]:Zo}]);if(n.error)return n;for(let a in i){let s=A0({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(s.error)return s}return{...oe}}function oU(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:oa};let{participant:a,tournamentId:s}=Zg({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...yh({participant:a,scaleAttributes:i}),tournamentId:s}:{error:_n}}var s3e=(t=0)=>250/Math.pow(t+5,.4),o3e=()=>1;function l3e(t=3,e=2){let i=t/e;return isNaN(i)?NS.kDefault():i}var NS={nSpread:400,diffThreshold:.125,kCalc:s3e,kMultiplier:l3e,kDefault:o3e};function zbe(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Da,winnerCountables:n=1,loserCountables:a=0,ratingType:s="ELO",maxCountables:o,countables:l}=t||{},c=r?.[s];if(!c)return{error:Yt};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,h=d?u.slice().reverse():u,f=(k,x)=>parseFloat(x)>=Math.min(...k)&&parseFloat(x)<=Math.max(...k);(!f(u,e)||!f(u,i))&&(f(u,e)||(e=c.defaultInitialization),f(u,i)||(i=c.defaultInitialization));let m=WS({targetRange:Da.ELO.range,sourceRange:h,value:d?u[0]-e:e}),g=WS({targetRange:Da.ELO.range,sourceRange:h,value:d?u[0]-i:i}),v=(k,x)=>1/(1+Math.pow(10,(x-k)/NS.nSpread)),y=v(m,g),b=v(g,m),I=NS.kCalc(n),w=NS.kCalc(a),T=NS.kMultiplier(o,l),S=m+T*I*(1-y),D=g+T*w*(0-b),C=WS({sourceRange:Da.ELO.range,value:S,targetRange:h}),E=WS({sourceRange:Da.ELO.range,value:D,targetRange:h}),P=d?u[0]-C:C,R=parseFloat(P.toFixed(p)),M=d?u[0]-E:E,A=parseFloat(M.toFixed(p)),N=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(C>E&&N>NS.diffThreshold||R<0||A<0)&&(R=e,A=i),{newWinnerRating:R,newLoserRating:A}}var c3e=t=>t?.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0])||[0,0];function qbe(t){let e=Gt(t,[{[pa]:!0},{matchUpIds:!0,[Bo]:Rs,[ku]:fw},{ratingType:!1,[hs]:y=>Da[y]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:s,considerGames:o,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=Da[a],{accessor:p}=d,h={},f=(t.matchUps||s&&po({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:la}}).matchUps||Wa({matchUpFilters:{matchUpIds:c,matchUpStatuses:la},tournamentRecord:n,inContext:!0}).matchUps)??[],m=`${a}.${h5}`,g=u?m:a;f.sort(_w);for(let y of f){let{endDate:b,matchUpFormat:I,score:w,sides:T,winningSide:S}=y,D=y.matchUpType,C={eventType:D,scaleName:a,scaleType:rg},E={scaleName:m,eventType:D,scaleType:rg},P=Object.assign({},...(T??[]).map(F=>{let{sideNumber:j,participant:q}=F;return j&&{[j]:[q?.participantId,...q?.individualParticipantIds??[]].filter(Boolean).flat()}})),R=Object.assign({},...Object.values(P).flat().map(F=>{let j=h[F],q=!s||j?oU({scaleAttributes:E,tournamentRecord:n,participantId:F}).scaleItem:void 0,W=oU({tournamentRecord:n,scaleAttributes:C,participantId:F}).scaleItem,z=p?{[p]:void 0}:void 0;return F&&{[F]:q??W??{scaleName:g,eventType:D,scaleDate:b,scaleType:rg,scaleValue:z}}})),M=I?js(I):{},A=M?.bestOf||1,N=M?.setsTo||1,k=o?A&N:A,x=w?.sets&&c3e(w.sets)||S===1&&[1,0]||[0,1],O=S?P[S]:[],V=S?P[3-S]:[];for(let F of O){let j=R[F]?.scaleValue,q=typeof j=="object"?j[p]:j;for(let W of V){let z=R[W]?.scaleValue,H=typeof z=="object"?z[p]:z,Z=S?x[S]:[0,0],J=S?x[3-S]:[0,0],{newWinnerRating:ie,newLoserRating:K}=zbe({winnerCountables:Z,loserCountables:J,maxCountables:k,winnerRating:q,loserRating:H,ratingType:a}),ne=p?{...j,[p]:ie}:ie,le=p?{...z,[p]:K}:K;R[F].scaleValue=ne,R[W].scaleValue=le,R[F].scaleName=g,R[W].scaleName=g}}Object.assign(h,R),i&&W6({tournamentRecord:n,modifiedScaleValues:h,removePriorValues:r})}let v=f.map(({matchUpId:y})=>y);return{...oe,modifiedScaleValues:h,outputScaleName:g,processedMatchUpIds:v}}function rF(t){let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:s}=t;if(typeof i!="object")return{error:At};let{participantIdPairings:o,matchUpsCount:l}=t,c=eF(t);if(c.error)return ue({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ue({result:{error:Se,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(o&&!Array.isArray(o)||l&&!mi(l)||e&&!Array.isArray(e)||!o&&!l)return{error:Se,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:Se,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(u||0))return{error:Se,info:"roundNumber error"};let h=r??(n&&(u??0)+1||u||1);o=o??yt(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=g=>{if(!t.idPrefix)return;let v=i.drawId,y=t.idPrefix??"ah";return`${v}-${y}-${h}-${g}`},m=o?.map((g,v)=>{let y=g?.participantIds??[void 0,void 0];y.push(void 0,void 0);let b=y.slice(0,2).map((w,T)=>Ft({sideNumber:T+1,participantId:w})),I=e[v]??f(v)??lr();return{roundNumber:h,matchUpStatus:Pn,matchUpId:I,sides:b}});if(m?.length){let g=Zs({drawDefinition:i,event:s})?.tieFormat;g&&m.forEach(v=>{let{tieMatchUps:y}=Fw({tieFormat:g,matchUp:v,isMock:a});Object.assign(v,{tieMatchUps:y,matchUpType:kr})})}return{roundNumber:h,matchUpsCount:m?.length??0,matchUps:m,...oe}}function u3e({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),s=Object.keys(i),o=[],l=ZZ({actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[pB(l)];o.push(l);let u=l.value,d=l,p=1,h=0,f=s.length,m;do f-=1,m=s.length*i[s[0]].length;while(m>t&&f>5);let g=[];s.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=Zb(y,b.opponent);if(!g.includes(I)){let w=ZZ({stipulated:[[y,b.opponent]],actorsCount:s.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(pB(w))){c.push(pB(w)),o.push(w);let{maxDelta:T,value:S}=w;T<d.maxDelta&&(d=w),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(I),p+=1}}}),o=o.filter(b=>Math.abs(b.value-u)<5)}),o.sort((y,b)=>y.maxDiff-b.maxDiff);let v=yl(o);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function pB(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function ZZ({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let s=[].concat(...e),o=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=Zb(p,h),m=i[f];o.push({participantIds:d,value:m}),l+=i[f]}),Ra(t,a).map(d=>co(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>s.includes(f)||h,!1)){s.push(...p);let h=d.value;l+=h,o.push({participantIds:p,value:h})}}),o.sort((d,p)=>d.value-p.value);let c=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Zb(h,f),g=r[m];return g>d?g:d},0),u=o.reduce((d,p)=>{let[h,f]=p.participantIds,m=Zb(h,f),g=n[m];return g>d?g:d},0);return{value:l,participantIdPairings:o,maxDelta:c,maxDiff:u}}function Zb(t,e){return[t,e].sort(VL).join("|")}function Wbe({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let s=Zb(a,n);i.includes(s)||i.push(s)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function d3e({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(Fi);if(r.length===2){let[n,a]=r,s=Zb(n,a);e.includes(s)||e.push(s)}}return{encounters:e}}function p3e({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(s=>r(n,s));i[n]=a.sort((s,o)=>s.value-o.value)}function r(n,a){let s=Zb(n,a);return{opponent:a,value:e[s]}}return{pairingValues:i}}var h3e=0;function f3e({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){let a=Da[r]?.defaultInitialization??h3e;return n.split("|").map(s=>{if(i===jc){let o=t?.find(l=>l.participantId===s)?.individualParticipantIds;return o?o?.map(l=>e[l]||a):a*2}else return e[s]||a})}function m3e(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:s,deltaObjects:o,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;n.forEach(b=>{let I=f3e({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:b}),w=typeof d=="number"&&d||.5,T=d&&(Math.round(Math.random())?w:w*-1)||0,S=Math.abs(I[0]-I[1])+T,D=Math.abs(I[0]-I[1]);o[b]=D,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=n.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:h}=p3e({possiblePairings:r,valueObjects:l}),{candidate:f,candidatesCount:m,deltaCandidate:g,iterations:v}=u3e({valueSortedPairings:p,maxIterations:a,pairingValues:h,deltaObjects:o,valueObjects:l}),{participantIdPairings:y}=s?g:f;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:f}}var g3e=100,v3e=100,y3e=4e3;function Y6(t){let{encounterValue:e=g3e,sameTeamValue:i=v3e,maxIterations:r=y3e,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:s,iterationMatchUps:o,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:h,structureId:f,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:w}=t;if(!p)return{error:At};if(!t.structure&&!f)return{error:en};let T=t.structure||oi({drawDefinition:p,structureId:f}).structure;if(!qi(T))return{error:jy};if(!d?.length)return{error:zg};let S=[...o??[],...T?.matchUps??[]],{encounters:D}=d3e({matchUps:S}),C=l?.participants??[],E={};if(c){let Z=yi(T?.matchUps?T.matchUps.map(({roundNumber:ie})=>ie):[]),J=Math.max(...Z,0);if(J){let ie=T?.matchUps?.filter(({roundNumber:ne})=>ne===J).map(({matchUpId:ne})=>ne),K=qbe({ratingType:v??w?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:ie});if(K.error)return K;K.modifiedScaleValues&&(E=K.modifiedScaleValues)}}let{valueObjects:P}=b3e({tournamentParticipants:C,encounterValue:e,sameTeamValue:i,encounters:D}),{uniquePairings:R,possiblePairings:M,deltaObjects:A}=Wbe({participantIds:d}),N=Object.values(E).length?E:t.adHocRatings,k={tournamentParticipants:C,possiblePairings:M,uniquePairings:R,maxIterations:r,adHocRatings:N,deltaObjects:A,valueObjects:P,eventType:g,scaleName:v,salted:I},{candidatesCount:x,participantIdPairings:O,deltaCandidate:V,iterations:F,candidate:j}=m3e(k);if(!x)return{error:eL};let q,W;if(a){let Z=rF({structureId:T?.structureId,ignoreLastRoundNumber:s,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:h,matchUpIds:m,idPrefix:y,isMock:b,event:w});if(Z.error)return Z;q=Z.roundNumber,W=Z.matchUps}let{maxDelta:z,maxDiff:H}=j;return{roundNumber:q,participantIdPairings:O,modifiedScaleValues:E,candidatesCount:x,deltaCandidate:V,...oe,iterations:F,matchUps:W,maxDelta:z,maxDiff:H}}function b3e({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let s of t)n[s]||(n[s]=0),n[s]+=i;let a=e?.filter(({participantType:s})=>s===hr);if(a)for(let s of a){let o=s.individualParticipantIds??[],{uniquePairings:l}=Wbe({participantIds:o});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function Ybe(t){let{drawType:e=sp,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:s,placeByes:o,isMock:l,event:c}=t,u=t?.drawDefinition;if(!u)return{error:At};let d=$a,p=Ew({stageSequence:1,drawDefinition:u,stage:d}),h=[zu,HR,Vh].includes(e)?p.length:hD(p.length);if(!a&&e===SD&&p.length<2||e===zu&&p.length<3)return{error:qx};let{tieFormat:f,matchUpType:m}=t;if(f){let P=Oo({tieFormat:f});if(P.error)return P}f=ls(f??Zs({drawDefinition:u})?.tieFormat),m=m??u.matchUpType;let{structures:g}=Wu({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:Vfe};if(g?.[0]?.matchUps?.length)return{error:V4};let v=g?.[0]?.structureId;Object.assign(t,Ft({structureName:t.structureName??ys($a),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=Vbe(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:v4};let I=b?.();if(I.error)return I;let{structures:w,links:T}=I,S=w.map(P=>ar({structure:P}).matchUps).flat();f&&S.forEach(P=>{let{tieMatchUps:R}=Fw({matchUp:P,tieFormat:f,isMock:l});Object.assign(P,{tieMatchUps:R,matchUpType:m})}),(!r||!i)&&(u=Et(u,!1,!0)),u.links||(u.links=[]),T.length&&u.links.push(...T);let D=w.map(({structureId:P})=>P);u.structures||(u.structures=[]);let C=u.structures.map(({structureId:P})=>P);u.structures=u.structures.map(P=>D.includes(P.structureId)?w.find(({structureId:R})=>R===P.structureId):P);let E=w.filter(({structureId:P})=>!C.includes(P));return E.length&&u.structures.push(...E),s&&w0({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:v,placeByes:o,drawSize:h,event:c}),i&&Cr({drawDefinition:u}),{links:T,structures:w,...oe}}var K6={};_i(K6,{addGame:()=>iIe,addPoint:()=>tIe,addSet:()=>nIe,addShot:()=>rIe,analyzeScore:()=>i7,analyzeSet:()=>kC,calculateHistoryScore:()=>Jbe,checkScoreHasValue:()=>ua,checkSetIsComplete:()=>sF,clearHistory:()=>eIe,generate:()=>Kbe,generateScoreString:()=>bh,generateTieMatchUpScore:()=>E0,getSetComplement:()=>n7,getTiebreakComplement:()=>uF,helpers:()=>lIe,isValidMatchUpFormat:()=>Al,keyValueScore:()=>RIe,mutate:()=>Xbe,parseMatchUpFormat:()=>js,parseScoreString:()=>M_,query:()=>kIe,redo:()=>aIe,reverseScore:()=>Zbe,setServingSide:()=>Qbe,stringifyMatchUpFormat:()=>lL,tidyScore:()=>_Ie,umo:()=>oIe,undo:()=>sIe,validateMatchUpScore:()=>OIe,validateScore:()=>r7,validateSetScore:()=>t7,validateTieFormat:()=>Oo});var Kbe={};_i(Kbe,{generateScoreString:()=>bh,generateTieMatchUpScore:()=>E0,reverseScore:()=>Zbe});function bh(t){let{winnerFirst:e=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:s,autoComplete:o,winningSide:l,sets:c}=t;if(!c)return{error:Yt,info:"missing sets"};let u=s&&js(s),{bestOf:d,finalSetFormat:p,setFormat:h}=u??{},f=n||!(!e||!l||l===1),m=r?I3e({matchUpStatus:a}):"",g=c?.sort(w3e).map(v).filter(Boolean).join(" ")||"";if(!m)return g;if(l===2)return`${m} ${g}`;return`${g} ${m}`;function v(y){let b=d&&y.setNumber===d&&p?p:h,I=W=>vn(W?.side1Score)||vn(W?.side2Score),w=(W=>vn(W?.side1TiebreakScore)||vn(W?.side2TiebreakScore))(y),T=b?.tiebreakSet||!I(y)&&w,{side1Score:S,side2Score:D,side1TiebreakScore:C,side2TiebreakScore:E}=y,P=C||(vn(C)||w&&o?0:""),R=E||(vn(E)||w&&o?0:"");if(T){let W=I(y)&&!w,z=W?S:P,H=W?D:R;return`[${(f?[H,z]:[z,H]).join("-")}]`}let M=w?Math.min(P,R):"",A=M===P?1:2,N=vn(M)?`(${M})`:"",k=S||(vn(S)||o?0:""),x=D||(vn(D)||o?0:""),O=W=>!i&&A===W?N:"",V=`${k}${O(1)}`,F=`${x}${O(2)}`,j=i&&w?`(${M})`:"",q=f?`${[F,V].join("-")}${j}`:`${[V,F].join("-")}${j}`;return["-"," "].includes(q)&&(q=""),q}}function I3e({matchUpStatus:t}){let e={[wa]:"RET",[Fr]:"WO",[ra]:"DF/DF",[ln]:"WO/WO",[Kg]:"SUS",[sl]:"ABN",[br]:"DEF",[PD]:"DR"};return t&&e[t]||""}function w3e(t,e){return t.setNumber-e.setNumber}function Zbe(t){if(!t?.score)return{error:Yt};let{sets:e}=t.score,i=e.map(s=>{let{side1TiebreakScore:o,side2TiebreakScore:l,winningSide:c,side1Score:u,side2Score:d,setNumber:p}=s;return Ft({winningSide:c?3-c:void 0,side1TiebreakScore:l,side2TiebreakScore:o,side1Score:d,side2Score:u,setNumber:p})}),r=t?.setTBlast,n=bh({setTBlast:r,sets:i}),a=bh({sets:i,reversed:!0,setTBlast:r});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:a},...oe}}var Xbe={};_i(Xbe,{addGame:()=>iIe,addPoint:()=>tIe,addSet:()=>nIe,addShot:()=>rIe,calculateHistoryScore:()=>Jbe,clearHistory:()=>eIe,redo:()=>aIe,setServingSide:()=>Qbe,umo:()=>oIe,undo:()=>sIe});function Qy({matchUp:t}){let{extension:e}=Ci({name:UL,element:t});if(!e)return{error:za};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...oe}}function Jbe(t){if(!t)return{error:Yt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:ko};let r=Qy({matchUp:e})?.history||[];if(!Array.isArray(r))return{error:Se,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:U4};if(!Al({matchUpFormat:n}))return{error:T4};let a=js(n),{bestOf:s,finalSetFormat:o,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=E=>[1,2].includes(E),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),w=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=w(),S=I(),D=b(),C=0;for(let E of r){C+=1,g=u.sets.length+1===s;let P=g&&o?o:l,{tiebreakAt:R,setTo:M,NoAD:A,tiebbreakFormat:N}=P,k=D.side1Score===R&&D.side1Score===D.side2Score,x=!!P.tiebreakSet,O=x?P.tiebreakSet:N,{tiebreakTo:V,NoAD:F}=O||{},j=()=>{p=void 0,h=[0,0],f=3-f,D.side1TiebreakScore="",D.side2TiebreakScore="",D.side1PointScore="",D.side2PointScore="",v=0},q=H=>{D.winningSide=H;let{s:Z,...J}=D;u.sets.push(J),T=w(),S=I(),D=b(),j()},W=H=>{S.winningSide=H;let{g:Z,...J}=S;D.games.push(J),T=w(),S=I(),j();let ie=`side${H}Score`;D[ie]+=1},z=H=>{T.winningSide=H;let{p:Z,...J}=T;S.points.push(J),T=w(),v=0;let ie=()=>h.reduce((ne,le)=>ne+le)%4/4>.5?f:3-f,K=H-1;if(k||x){h[K]+=1,p=ie(),D[`side${H}TiebreakScore`]=h[K],D[`side${3-H}TiebreakScore`]=h[1-K];let ne=F?1:2;if(h[K]>=V&&h[K]>=h[1-K]+ne)return W(H),{gameCompleted:!0}}else if(h[1-K]===4&&h[K]===3?h[1-K]-=1:h[K]+=1,D.side1PointScore=c[h[0]],D.side2PointScore=c[h[1]],h[K]===5||h[K]===4&&h[1-K]<3||A&&h[K]===4)return W(H),{gameCompleted:!0}};if(y(E.srv)&&(f=E.srv),["p","s","g","o"].includes(E.u)&&d.push(E.u),E.shotOutcome&&(T.shots.push(E),E.shotType==="SERVE"&&["OUT","NET"].includes(E.shotOutcome)&&(v+=1),v===2)){let H=3-f;z(H)}if(y(E.p)||mi(E.pointNumber)){let H=E.winningSide||E.p;if(z(H)?.gameCompleted)continue}if(y(E.g)||mi(E.gameNumber)){let H=E.winningSide||E.g;S.winningSide=H;let Z=`side${H}Score`,J=`side${3-H}Score`;if(d.length&&(d.includes("p"),d=[]),W(H),D[Z]===M&&D[Z]-D[J]>=(A?1:2)&&(q(H),g))break}if(y(E.s)||mi(E.setNumber)){let H=E.winningSide||E.s;if(q(H),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return C!==r.length&&console.log({error:"Match completed with excess history"}),(D.side1Score||D.side2Score||D.games.length||D.side1TiebreakScore||D.side2TiebreakScore)&&u.sets.push(D),u.scoreStringSide1=bh({...u,matchUpFormat:n}),u.scoreStringSide2=bh({...u,matchUpFormat:n,reversed:!0}),f=p||f,i&&(e.score=u),{...oe,servingSide:f,score:u}}function eb({undoHistory:t,history:e,matchUp:i}){return nr({element:i,extension:{value:{history:e,undoHistory:t},name:UL}})}function Qbe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:C4};let{history:i=[]}=Qy({matchUp:t});return i.push({srv:e}),eb({matchUp:t,history:i})}function eIe({matchUp:t}){return eb({matchUp:t})}function tIe({matchUp:t,point:e}){if(!e||!t)return{error:Yt};if(typeof e!="object")return{error:Se,context:{point:e}};let{history:i=[]}=Qy({matchUp:t});return i.push(e),eb({matchUp:t,history:i})}function iIe({matchUp:t,game:e}){if(typeof e!="object")return{error:Se,context:{game:e}};let{history:i=[]}=Qy({matchUp:t});return i.push(e),eb({matchUp:t,history:i})}function rIe({matchUp:t,shot:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Qy({matchUp:t});return i.push(e),eb({matchUp:t,history:i})}function nIe({matchUp:t,set:e}){if(typeof e!="object")return{error:Yt};let{history:i=[]}=Qy({matchUp:t});return i.push(e),eb({matchUp:t,history:i})}function aIe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Qy({matchUp:t});return i.length&&e.push(i.pop()),eb({matchUp:t,history:e,undoHistory:i})}function sIe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Qy({matchUp:t});return i.push(e.pop()),eb({matchUp:t,history:e,undoHistory:i})}var oIe={},lIe={};_i(lIe,{keyValueScore:()=>RIe,parseMatchUpFormat:()=>js,stringifyMatchUpFormat:()=>lL,tidyScore:()=>_Ie});var S3e="COMPLETED",T3e="WO/WO",cIe=["RET","DEF","WO",T3e,"ABN","SUS","INT"],Nj="DEFAULTED",uIe="WALKOVER",dIe="ABANDONED",pIe="SUSPENDED",hIe="RETIRED",fIe="INTERRUPTED",U3e=[hIe,Nj,uIe],D3e="Enter Score",CI="()",Iy="[]",Z6=["up","left","shift+tab"],X6=["enter","down","tab","right"],P_="backspace",mIe="r",gIe="s",vIe="a",yIe="d",bIe="w",IIe="i",nF=[mIe,yIe,bIe,vIe,gIe,IIe],aF="space",hB=["[","("],C_=[...Z6,...X6,aF,"]"],wIe="-",E3e="/",Xb=wIe,Ih=wIe,SIe=[E3e],P3e=0,C3e=["=","+","num_1","num_2","shift+=","shift+-"],J6=["0","1","2","3","4","5","6","7","8","9"].concat(nF),TIe=J6.map(t=>`shift+${t}`),UIe=[Xb,P_].concat(C_,SIe),DIe=[J6,TIe,UIe].join(","),R3e=[DIe,Z6,X6,C3e].join(","),M3e={OUTCOMEKEYS:nF,SIDE1KEYS:J6,SIDE2KEYS:TIe,MODIFIERS:UIe,PROMPT:D3e,MOVEUP:Z6,MOVEDOWN:X6,HOTKEYS:R3e};function fS({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=EIe({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==" "?" ":"";return t+r+i}else return i+" "+t}function EIe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of cIe){let r=t?.indexOf(i);r===0?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t?.trim()||(t=""),{scoreString:t,removed:e}}function Aj({analysis:t,scoreString:e,sets:i,lowSide:r}){let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:s,removed:o}=EIe({scoreString:e});if(e=s,o)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(m=>m!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=lT({brackets:Iy,scoreString:e}),f=A3e(e);if(f>=0){n=e.slice(0,f);let{isTiebreakEntry:m}=lT({brackets:CI,scoreString:n}),{lastOpenBracketIndex:g,isTiebreakEntry:v}=lT({brackets:Iy,scoreString:n}),y=n&&n[n.length-1].trim(),b=n&&!isNaN(y),I=t.isIncompleteSetScore;if(h&&v){let w=n.slice(g+1).split(Ih),T=w?.length>0&&w[0]!==void 0&&!isNaN(parseInt(w[0]))&&parseInt(w[0])||void 0,S=w?.length>1&&w[1]!==void 0&&parseInt(w[1])||void 0,D=[T,S];if(S){let C=r===1?1:0;D[C]=(D?.[1-C]||0)+(p?1:2),(D[C]||0)<d&&(D[C]=d),n=e.slice(0,g+1),n+=D.join(Ih)}else T!==void 0?(n=e.slice(0,g+1),n+=T):(n=e.slice(0,g),I=!0);l.side1TiebreakScore=D[0]||0,l.side2TiebreakScore=D[1]||0}if(n.length||(n=void 0),I){let w=l.side1Score?.toString();if(w){let T=w?.slice(0,w.length-1);l.side1Score=!isNaN(T)&&parseInt(T)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]}else if(b){let w=l.side2Score?.toString(),T=l.side1Score?.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let S=w?.slice(0,w.length-1);l.side2Score=!isNaN(S)&&parseInt(S)||void 0}else{let S=T?.slice(0,T.length-1);l.side1Score=!isNaN(S)&&parseInt(S)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else m?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!v?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function lT({brackets:t=CI,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...ap(i,n)),s=Math.max(...ap(r,n));return{isTiebreakEntry:a>s,lastOpenBracketIndex:a}}function N3e({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Iy.split(""),a=t.split(""),s=Math.max(...ap(r,a)),o=Math.max(...ap(n,a)),l=Math.max(...ap(Ih,a));return i&&s>o&&l>s}function A3e(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function PIe(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function XZ({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){let n=js(t),{bestOf:a}=n,s=Math.ceil(a/2),o=r?.reduce((l,c)=>{let{winningSide:u}=c;return u&&l[u-1]++,l},[0,0])?.indexOf(s)+1||void 0;return U3e.includes(e)&&i&&(o=i),{matchUpWinningSide:o}}function sF({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:s}){if(!s)return{error:Yt,info:"missing set"};e=e||i&&js(i);let o=n&&e.finalSetFormat||e?.setFormat||{},{side1Score:l,side2Score:c}=s,{setTo:u,tiebreakAt:d}=o,p=l||c,h=oF({set:s}),f=Math.abs(l-c),m=l>=u||c>=u,g=r||l>=u&&c>=u||d&&d<u&&(l===d||c===d),v=t||g&&(h===1&&s.side1TiebreakScore>s.side2TiebreakScore||h===2&&s.side2TiebreakScore>s.side1TiebreakScore),y=!g&&o.NoAD||g||r&&o.tiebreakFormat?.NoAD?1:2,b=f>=y;return!!((a&&p||m&&(b||g)||r)&&(!g||v))}function oF({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Q6({analysis:t,set:e}){let i=oF({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return sF({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function _3e({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=ri(r);let{validSide2Score:s,requiresTiebreak:o}=k3e({analysis:t,set:a,value:r});if(s){n=!0,e=(e||"")+r,a.side2Score=r;let l=Q6({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,o){let c=CI.split("")[0];e+=c}else t.isDecidingSet||(e+=" ")}return{sets:i,scoreString:e,updated:n}}function k3e({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:s}=r,{side1Score:o}=e,l,c;return n&&n<a?o===n?l=i<=a:l=i<=n:o===a?s?l=i<a:l=i<=a+1:o===a-1?s?l=i<=a:l=i<=a+1:o===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=o===a&&i===n||o===n&&i===a:c=o>=a&&i>=a&&o!==i),{validSide2Score:l,requiresTiebreak:c}}function CIe({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let s;return e===mIe?r?(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"RET"}),n=t===2?1:2,a=hIe):(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=Nj):e===yIe?(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"DEF"}),n=t===2?1:2,a=Nj):e===bIe?(s=!0,i=[],r="WO",n=t===2?1:2,a=uIe):e===gIe&&r?(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"SUS"}),a=pIe,n=void 0):e===vIe?(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"ABN"}),a=dIe,n=void 0):e===IIe&&r&&(s=!0,r=fS({scoreString:r,lowSide:t,outcome:"INT"}),a=fIe,n=void 0),{updated:s,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function O3e(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:s,lowSide:o,value:l}=t,c,u;!e?.length&&l!==P_&&(e=[{setNumber:1}]);let d=e.length-1;if(nF.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":s.finalSetIsComplete||n?i="final set is already complete":s.isIncompleteSetScore?i="incomplete set scoreString":s.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=CIe({lowSide:o,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===P_){if({scoreString:r,sets:e,outcomeRemoved:u}=Aj({analysis:s,scoreString:r,sets:e}),r?.trim()===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(s.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===aF){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!n&&!s.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===Xb&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&s.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=ri((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=ri(h),p=e[d].side1Score.toString(),c=!0}else{let h=ri((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=ri(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?r=h+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function x3e({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){let s,o,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=Iy.split("");if(t.isMatchTiebreakEntry||(r+=u),n[t.setNumber-1]){let{lastOpenBracketIndex:d}=lT({brackets:Iy,scoreString:r}),p=(r.slice((d??0)+1)+(e?"":a)).split(Ih);if((p[i-1]?.length||0)>=2)o="tiebreak digit limit";else if(e){i===1&&(p[0]=(p[0]||"")+a),i===2&&(p[1]=(p[1]||"")+a);let h=[p[0]||0,p[1]||0].map(g=>ri(g)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<l&&(h[f]=l);let m=n[n.length-1];m.side1TiebreakScore=h[0],m.side2TiebreakScore=h[1],r=r.slice(0,(d??0)+1),r+=h.join(Ih),s=!0}else{let h=[p[0]||0,p[1]||0].map(m=>ri(m)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let d=PIe({lowValue:ri(a||0),tiebreakTo:l,NoAD:c}),p=[ri(a),d];i===2&&p.reverse();let h={side1TiebreakScore:p[0],side2TiebreakScore:p[1],setNumber:n?.length+1||1};n.push(h),r+=p.join(Ih),s=!0}return{info:o,scoreString:r,sets:n,updated:s}}function L3e({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:s}=t?.setFormat||{},o=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(s&&r===n||r>n)return{scoreString:i};let l=f(),c=[r,l];e===2&&c.reverse();let u=CI.split("")[0],d=c.join(Xb)+(o?u:" ");i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=Q6({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return o?r+1:r+1===n?r+(s?1:2):n}}function F3e({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){let a=(n?.filter(V=>V?.winningSide)?.length||0)+(i?0:1),s=js(t),o=a===s?.bestOf,l=o&&s?.finalSetFormat||s?.setFormat||{},c=l?.timed,u=o&&n[s?.bestOf-1],d=u?.winningSide,{isTiebreakEntry:p}=lT({brackets:CI,scoreString:e}),{isTiebreakEntry:h}=lT({brackets:Iy,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=e?.[e.length-1]?.trim(),v=e&&!isNaN(g),y=!f&&g===Xb,b=p&&hB.includes(g),I=h&&hB.includes(g),w=h&&g===Ih,T=e?.split(""),[S]=Iy.split(""),D=T&&Math.max(...ap(S,T)),C=T&&Math.max(...ap(Ih,T)),E=T&&C>D,P=n[n.length-1]?.winningSide,R=n?.length&&!P,M=cIe.find(V=>e?.indexOf(V)>=0),A=!isNaN(r),N=r===aF,k=C_.includes(r),x=e?.split("").find(V=>hB.includes(V)),O=k&&h&&!I&&(w||!N3e({scoreString:e}));return{isTiebreakSetValue:m&&A,matchUpScoringFormat:s,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:R,isSpace:N,isCloser:k,isTiebreakCloser:k&&x&&f&&v,isDecidingSet:o,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:A,hasOpener:x,hasOutcome:M,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:P,isInvalidSetTiebreakValue:N&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:w}}function RIe(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:s}=t,{matchUpFormat:o,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!DIe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=XZ({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});a=h;let f=F3e({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:o});if(SIe.includes(i)&&(i=Xb),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&ri(i)===0&&(f.isTiebreakCloser=!0),C_.includes(i)&&f.hasOpener&&(i=""),C_.includes(i)&&(i=aF),f.lastSetIsComplete){let m=r?.length&&r[r.length-1];r&&m!==" "&&(r+=" ")}if(f.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:s,winningSide:a}=O3e({analysis:f,lowSide:e,scoreString:r,sets:n,matchUpStatus:s,winningSide:a,value:i}));else if(nF.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:s,winningSide:a,updated:u}=CIe({lowSide:e,sets:n,scoreString:r,matchUpStatus:s,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===P_)u=!0,{scoreString:r,sets:n}=Aj({analysis:f,scoreString:r,sets:n,lowSide:e}),r||(n=[]),s=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Xb&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=Aj({analysis:f,scoreString:r,sets:n,lowSide:e}),s=void 0);else if(i===Ih&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,r+=Ih);else if([Xb,Ih].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:n,scoreString:r,updated:u}=_3e({analysis:f,scoreString:r,sets:n,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?CI:Iy,g=m.split("").reverse()[0],v=m.split("")[0],y=n[n.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:w}=b||{},T=oF({set:y});if(!f.isTiebreakSet){let D=parseInt(r.split(v).reverse()[0]),C=PIe({lowValue:D,tiebreakTo:I,NoAD:w});T===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=D):(y.side1TiebreakScore=D,y.side2TiebreakScore=C)}r=(r||"")+g,f.isDecidingSet||(r+=" ");let S=Q6({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=x3e({analysis:f,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(f.isSetTiebreakEntry){let[m]=CI.split(""),g=Math.max(...ap(m,r.split(""))),v=r.slice(g+1),y=v&&ri(v)===P3e,b=ri(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:w,NoAD:T}=I||{};!y&&v.length<2?T&&b>w-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!n.length){u=!0;let{scoreString:m,set:g}=L3e({analysis:f,lowSide:e,scoreString:r,value:ri(i)});g&&(g.setNumber=n?.length+1||1),n=n?.concat(g).filter(Boolean)||[g],r=m||void 0}else console.log("error: unknown outcome")}if(u){n=n?.filter(Boolean);let{matchUpWinningSide:m}=XZ({sets:n,winningSide:a,matchUpStatus:s,matchUpFormat:o});return a=m,m&&(!s||[Pn,Ol].includes(s))?(s=S3e,n=n.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):r&&!a&&![pIe,dIe,fIe].includes(s)&&(s=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:s,info:d}}var lF="\\d+-\\d+",_C="\\d+-\\d+\\(\\d+\\)",e7="\\[\\d+-\\d+\\]",B3e="\\d+-\\d+\\(\\d+-\\d+\\)",$3e=new RegExp(`(${lF}),`,"g"),V3e=new RegExp(`(${_C}),`,"g"),j3e=[lF,_C,e7,B3e],G3e=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],H3e=G3e.map(t=>{let e=t.split("").map(i=>j3e[i]).join(" ");return new RegExp(`^${e}$`)});function JZ(t){return!t||H3e.some(e=>e.test(t))}function z3e(t){let e="[];()",i=["[","("],r=Object.assign({},...e.split("").map(s=>({[s]:0}))),n="",a=t.split("").map(s=>{let o=e.includes(s)&&s,l=i.includes(o);if(l&&o)return r[o]+=1,n=o,s;if(!l&&o&&n&&o!==n){r[n]-=1;let c="[];".includes(n)&&"[];"||"()".includes(n)&&"()"||"",u=c.split("").find(d=>d!==n);if(c.includes(o))r[n]||(n="");else return r[o]||(n=""),u}return s}).join("");return t!==a?a:t}function jN(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function q3e(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function lU(t){let e=(i=>i?.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function R_(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function QZ(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function W3e(t){return t.startsWith("(")&&t.endsWith(")")}function Y3e({score:t,applied:e}){t=z3e(t);let i=/\)(\d+)/g;if(i.test(t))for(let T of t.match(i)){let S=T.replace(")",") ");t=t.replace(T,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let T of a||[]){let[S]=T.match(n).slice(1),D=S.replace(/ /g,"");t=t.replace(T,`(${D})`)}let s=/\(\(\d-\d\)\)/g;if(s.test(t)){let T=t.match(s);T.length&&T.forEach(S=>{let D=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,D)})}if(s=/\(\((\d)\)\)/g,s.test(t)){let T=t.match(s);T.length&&T.forEach(S=>{let D=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,D)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);t=t.replace(o,"-"),["- "," -"].forEach(T=>{let S=new RegExp(`(\\d+)${T}(\\d+)`,"g"),D=t.match(S);D&&D.forEach(C=>t=t.replace(C,C.split(T).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(T=>{let[S]=T.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(T,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(T=>{let[S]=T.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&S==="6"?t=t.replace(T,"(6-0)"):t=t.replace(T,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(T=>{let[S]=T.match(/(\d\/\d)\/,/).slice(1);t=t.replace(T,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(T=>{let[S]=T.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(T,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(T,`(6-${S})`):t=t.replace(T,`(${S})`)});let p,h,f,m,g,v=()=>{g=Nl(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[T]=t.match(y).slice(1);t=t.replace(y,T+")")}if(g["("]===g[")"]&&g["("]>1){let T=t.split(")(").join(") (").split(" ");T.every(W3e)?t=T.map(S=>{let D=S.slice(1,S.length-1);return D.length>2?D:S}).join(" "):t=T.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(T=>g[T])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(T=>g[T]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let T=[],S=0;for(let D of t.split("").reverse())D===")"&&(S?T.push("("):S+=1),D==="("&&(S-=1),T.push(D);T.reverse(),t=T.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let T="",S=0;for(let D of t.split(""))D==="("&&(S?T+=")":S+=1),D===")"&&(S-=1),T+=D;t=T}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let w=T=>{let S=T.indexOf("("),D=T.indexOf(")");return S>=0&&D>=0&&S<D};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let T=t.slice(1,t.length-1);w(T)&&(t=T,v())}return{score:t,applied:e}}function cF(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=ap("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,s)=>s%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function K3e({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[$3e,V3e].forEach(i=>{let r=t.match(i);r?.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(cF).join(" "),{score:t,applied:e}}function Z3e({score:t}){if(typeof t!="string")return{score:t};let e=p=>p?.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(jN),a=0,s="";for(let p of n){let h=ap(p,r).filter(v=>!a||v>a)[0],f=r.slice(a,h-1),m=r[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");s+=b,a=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,w=[b,I].sort().reverse().join("-"),T=[f.join(" "),[w,p].join("")].join(" ");s+=T,a=h+1}}}}if(n.length&&s.length){let p=r.slice(a).join(" ");return s=[s,p].join(" "),{score:s.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let o=r.map(p=>q3e(p)&&"bracket"||lU(p)&&"set");if(o.includes("set")&&o.includes("bracket")){let p,h="";return r.forEach((f,m)=>{o[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=o[m]}),{score:h.trim()}}r=t.split(" ");let l,c=r.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=ap("tiebreak",c);if(u.length){let p="";r.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!lU(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(e7).test(p)&&"super"||new RegExp(_C).test(p)&&"tiebreak"||new RegExp(lF).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function X3e({score:t,applied:e}){for(let D of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${D}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(R=>parseInt(R)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(D).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[D,C,E,P,R,M]=t.match(i).slice(1);t=t.replace(i,`${D}${C}-${E} ${P}-${R}${M}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(D=>(n.test(D)&&(D=D.replace("("," (")),a.test(D)&&(D=D.replace(")",") ")),D)).join(" "),e.push("spaceConsiderationPatterns")});let s=cF(t);s!==t&&(t=s,e.push("deDashMash"));let o=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(o.test(t)){let[D,C,E]=t.match(o).slice(1),[P,R]=C.split("");t=`${D}-${P} ${R}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[D,C]=t.match(c).slice(1),E=D.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let R=E.match(l).slice(1,3).join("-"),M=P.match(l).slice(1,3).join("-");t=`${R} ${M}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[D,C]=t.match(u).slice(1),E=D.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let R=E.match(l).slice(1,3).join("-"),M=P.match(l).slice(1,3).join("-");t=`${R} ${M}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let D=t.match(d)[0],C=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[D,C,E]=t.match(h).slice(1),P=C.split(""),R=`${D}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,R),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m?.length){let D=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(D).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g?.forEach(D=>{let C=D.slice(0,D.length-1).split(" ").join("-");t=t.replace(D,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g?.forEach(D=>{let C=" "+D.slice(1).split(" ").join("-");t=t.replace(D,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let D=t.match(v)[0],C=D.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(D,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let D=t.match(b),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;D.forEach(P=>{let[R,M]=P.match(C).slice(1),A=`${R}-${M}`;E=E.replace(P,A)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[D,C,E]=t.match(I).slice(1);D.replace(/\D/g,"").length>=4&&(t=D+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let w=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let D of t.match(w)||[]){let[C,E,P,R]=D.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[M,A]=E.split("-").map(N=>parseInt(N));Math.abs(M-A)===1&&(t=t.replace(D,`${C}${E}(${P})${R}`),e.push("spaceSeparatedSetPattern"))}let T=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let D of t.match(T)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,R]=D.match(C).slice(1),[M,A]=E.split("-").map(N=>parseInt(N));Math.abs(M-A)===1&&(t=t.replace(D,`${E}(${P})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let D of t.match(S)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=D.match(C).slice(1);t=t.replace(D,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function J3e({score:t,matchUpStatus:e}){let i=t?.split(" ");t=i.map(o=>{if(o.endsWith("]")){let l=o.split("[");if(lU(l[0]))return l[0]+`(${l[1].slice(0,l[1].length-1)})`}return o}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let o of t.match(r)){let l=o.replace(" ","-").match(/\((.*)\)/)?.[1];if(vn(l)&&l?.[0]>2){if([2,4].includes(l.length))l=l.split("").join("-");else if(l.length===3){let c=l.indexOf("1");l=R_(l.split(""),c)}}t=t.replace(o,`(${l})`)}i=t?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((o,l)=>{let c=[void 0,"","COMPLETED"].includes(e)||l!==a;if(n.test(o)&&c){let[u,d,p]=Array.from(o.match(n)).slice(1),h=Math.min(d,p);return`${u}(${h})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1),u=l.split("");return`${u[0]}-${u[1]}(${c})`}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(o=>{if(n.test(o)){let[l,c]=Array.from(o.match(n)).slice(1);return lU(l)?`${l}(${c})`:l}return o}).join(" "),i=t?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(o=>{if(n.test(o)){let[l]=o.match(n).slice(1);return`[${l<9?10:parseInt(l)+2}-${l}]`}return o}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let o=t.match(s)[1];t=t.replace(s,`(${o}) `)}return{score:t}}function Q3e({score:t,attributes:e,identifier:i}){if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let u of n||[]){let d=u.match(/^\((.*)\)$/)?.slice(1)?.[0],p=t.split(u)[0].split(")").reverse()[0].replace(/\D/g,"");if(d?.length===2&&p?.length>=2){let m=p.slice(p.length-2).split("").map(g=>parseInt(g));if(Math.abs(m[0]-m[1])===1)continue}let h=QZ(d),f=cF(h);t=t.replace(u,`(${f})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);t.match(a)?.forEach(u=>{let d=QZ(u.match(/^\[(.*)\]$/)[1]);t=t.replace(u,`(${d}) `).trim()});let s=[")","]"],o=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&s.some(u=>t.endsWith(u))&&o.some(u=>t.includes(u))){let u="",d=t.split(/[)\]]/).filter(Boolean).map(g=>(g.startsWith(",")&&(g=g.slice(1)),g.trim())),p=d.every(g=>g.includes(",")||jN(g)),h=d.every(g=>g.includes("/")||jN(g)),f=d.every(g=>g.includes("-")||jN(g)),m=p&&","||f&&"-"||h&&"/";if(m){let g;d.forEach(v=>{if(v.startsWith("("))if(g==="set"&&(u+=" "),v.includes(m))u+=v.slice(1).split(m).map(y=>y.trim()).join("-"),g="set";else{let y=v.slice(1);u+=`(${y}) `,g="tiebreak"}else if(v.startsWith("[")){let y=v.slice(1).split(m).map(I=>parseInt(I.trim())),b=Math.min(...y);g==="set"?u+=`(${b}) `:u+=`[${y.join("-")}] `,g="tiebreak"}}),t=u.trim()}}let l=Nl(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&lU(t)&&vn(e?.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function MIe({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let o=`${r[0]}-${r[1]}`;return r[2]&&(o+=` (${r[2]})`),n(),r.push(r),o};n();let s=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let o=e.shift(),l=vn(o)&&parseInt(o),c=r[0]!==void 0&&r[1]!==void 0;if(vn(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,s())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&vn(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&s()}}return{sets:i}}function _j(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=R_(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=R_(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function NIe(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e?.toString().split(""),a=n?.every(o=>vn(o)),s=o=>Math.abs(o[0]-o[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let o=a?n.map(c=>parseInt(c)):e.split("").map(c=>parseInt(c)),{sets:l}=MIe({score:e});if(o.length,e.length===3&&s(o.slice(0,2))===1){let[c,u,d]=o;e=`${c}-${u}(${d})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&o[0]===1){let[c,u,d]=o;e=`[${c}${u}-${d}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&s(o.slice(0,2))===1&&"987654".split("").includes(o[0].toString())){let[c,u,d,p]=o,h=Math.min(d,p);e=`${c}-${u}(${h})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&o[0]===1&&o[2]===1){let[c,u,d,p]=o;e=`[${c}${u}-${d}${p}]`,i.push("bigSuper")}else if(e.length===4){let[c,u,d,p]=o;e=`${c}${u} ${d}${p}`,i.push("split4")}else if(e.length===5&&s(o.slice(0,2))===1){let[c,u,d,p,h]=o;e=`${c}-${u}(${d}) ${p}-${h}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&s(o.slice(3))===1){let[c,u,d,p,h]=o;e=`${c}-${u} ${d}-${p}(${h})`,i.push("numericTiebreakPattern5")}else if(o.length===7)if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&o[4]===1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p} [${h}${f}-${m}]`,i.push("numericTiebreakPattern6")}else if(s(o.slice(0,2))===1&&s(o.slice(3,5))>1&&s(o.slice(5,7))>1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u}(${d}) ${p}-${h} ${f}-${m}`,i.push("numericTiebreakPattern7")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))===1&&s(o.slice(5,7))>1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p}(${h}) ${f}-${m}`,i.push("numericTiebreakPattern8")}else if(s(o.slice(0,2))>1&&s(o.slice(2,4))>1&&s(o.slice(4,6))===1){let[c,u,d,p,h,f,m]=o;e=`${c}-${u} ${d}-${p} ${h}-${f}(${m})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let c=_j(e);c&&e!==c&&i.push("parsedSuperPattern"),e=c??e}else{let c=Ra(e.split(""),2).map(v=>v.join("")),u=c.map(v=>{let[y,b]=v.split("").map(T=>parseInt(T)),I=Math.abs(y-b),w=y>b?1:2;return I>1&&w||w*-1}),d=u.reduce((v,y)=>v>0&&y>0,1),p=Nl(u),h=u.map(v=>Math.abs(v)),f=Nl(h),m=u[0]<0,g=!m&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[c.slice(0,2).join(" "),c.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(d)e=c.join(" "),i.push("chunkSplit");else if(o.length===6){if(p[1]===2||p[2]===2)if(!Object.values(f).includes(3))e=c.join(" "),i.push("chunkSplit");else{let[v,y,b,I,w,T]=o,S=u.reduce((D,C,E)=>C<0?E:D,void 0);if(S===0){let D=Math.min(b,I);e=`${v}-${y}(${D}) ${w}-${T}`,i.push("chunkSplitTiebreak1")}else if(S===1){let D=Math.min(w,T);e=`${v}-${y} ${b}-${I}(${D})`,i.push("chunkSplitTiebreak2")}else e=`${v}-${y} ${b}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(o.length===8){let[v,y,b,I,w,T,S,D]=o;m||g?o[5]===1&&(m?e=`${v}-${y}(${b}) ${I}-${w} [${T}${S}-${D}]`:e=`${v}-${y} ${b}-${I}(${w}) [${T}${S}-${D}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:r}}function AIe(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,s=e[0]>0&&e[0]===e[1],o=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:s,setWinners:i,totalSets:o,winningSide:a}}function e4e({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),s=a.length;t=a.map((u,d)=>{if(new RegExp(_C).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!lU(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&vn(u))return u.split("").join("-");u=cF(u);let p=new RegExp(`^${e7}$`).test(u)&&"super"||new RegExp(`^${_C}$`).test(u)&&"tiebreak"||new RegExp(`^${lF}$`).test(u)&&"standard"||"unknown";if(r.push(p),s>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(w=>parseInt(w)>v||d&&parseInt(w)<=n)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:o,setWinners:l,totalSets:c}=AIe(t);if(c===1&&i?.removed==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...o)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...o)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function t4e({score:t}){let{setsTied:e,winningSide:i}=AIe(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let o=t.match(r).slice(1)[0],l=o<=8?10:o+2;t=t.replace(r,` [${l}-${o}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let s=a.split("(").join("").split(")").join("").split("-");if(!s.every(o=>vn(o)))return{score:t};if(s[0]==="76"){let o=s[1].length===2?Math.min(...s[1].split("").map(l=>parseInt(l))):s[1];t=[...n.slice(0,n.length-1),`7-6(${o})`].join(" ")}else{s=s.map(c=>parseInt(c));let o=Math.max(...s),l=Math.abs(s[0]-s[1]);if(o>=10){if(l>2&&s.every(c=>+c>=10)){let c=s.map(u=>u===o?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(s=c)}t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" ")}else n.length===3&&o>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${s.join("-")}]`].join(" "))}return{score:t}}function i4e({score:t}){return t=t?.toString().toLowerCase()||"",{score:t}}function r4e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function n4e({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=R_(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=NIe({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function a4e({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&_j(t)?{score:_j(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function s4e({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t?.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function o4e({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=e?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function l4e({score:t,profile:e,applied:i}){t=t?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleDefaulted"),{score:s.trim(),matchUpStatus:"defaulted",applied:i}}let n=e?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t?.endsWith(s));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:t?.replace(a,"").trim(),applied:i}):{score:t}}function c4e({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function u4e({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function d4e({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function p4e({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function h4e({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[s,o]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${s}-${o}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>vn(i))&&e.length===4&&(t=e)}return{score:t}}function f4e({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var m4e={handleTiebreakSlashSeparation:p4e,handleSetSlashSeparation:u4e,punctuationAdjustments:Y3e,handleGameSeparation:d4e,joinFloatingTiebreak:Z3e,handleBracketSpacing:K3e,handleSpaceSeparator:h4e,separateScoreBlocks:n4e,matchKnownPatterns:X3e,removeDanglingBits:c4e,removeErroneous:a4e,handleDefaulted:l4e,handleWalkover:s4e,properTiebreak:J3e,handleNumeric:NIe,handleRetired:o4e,containedSets:Q3e,sensibleSets:e4e,stringScore:i4e,superSquare:t4e,setBuilder:MIe,excisions:f4e,replaceOh:r4e},fB={},g4e=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],v4e=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function _Ie(t){if(!t.score)return{error:Se};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:s,profile:o}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=m4e[v]({profile:o,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(s||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(g4e);let m=JZ(h);return m||(h=e.toString().replace(/\D/g,""),d?.removed&&(d.removed=void 0),f(v4e),m=JZ(h),m||(h="")),u.forEach(g=>{fB[g]||(fB[g]=0),fB[g]+=1}),{matchUpStatus:c?.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var kIe={};_i(kIe,{analyzeScore:()=>i7,analyzeSet:()=>kC,checkScoreHasValue:()=>ua,checkSetIsComplete:()=>sF,getSetComplement:()=>n7,getTiebreakComplement:()=>uF,isValidMatchUpFormat:()=>Al,parseScoreString:()=>M_,validateMatchUpScore:()=>OIe,validateScore:()=>r7,validateSetScore:()=>t7,validateTieFormat:()=>Oo});function t7(t,e,i,r){if(!e)return{isValid:!0};let n=js(e);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,tiebreakSet:c}=a,u=c?.tiebreakTo,d=!!u&&!s,p=t.side1TiebreakScore,h=t.side2TiebreakScore,f=p!==void 0&&h!==void 0,m=d&&f?p:t.side1Score||t.side1||0,g=d&&f?h:t.side2Score||t.side2||0,v=Math.max(m,g),y=Math.min(m,g),b=v-y;if(d)return r?{isValid:!0}:m===0&&g===0?{isValid:!1,error:"Tiebreak-only set requires both scores"}:v<u?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${u}, got ${v}`}:b<2?{isValid:!1,error:`Tiebreak-only set must be won by at least 2 points, got ${v}-${y}`}:v===u&&y>u-2?{isValid:!1,error:`Tiebreak-only set at ${u}-${y} requires playing past ${u}`}:v>u&&b!==2?{isValid:!1,error:`Tiebreak-only set past ${u} must be won by exactly 2 points, got ${v}-${y}`}:{isValid:!0};let I=p!==void 0||h!==void 0,w=s&&v===s+1&&y===s;if(I||w){if(s){if(v!==s+1)return{isValid:!1,error:`Tiebreak set winner must have ${s+1} games, got ${v}`};if(y!==s)return{isValid:!1,error:`Tiebreak set loser must have ${s} games when tied, got ${y}`}}if(I&&l){let T=Math.max(p||0,h||0),S=Math.min(p||0,h||0),D=T-S,C=l.tiebreakTo||7;if(T<C)return{isValid:!1,error:`Tiebreak winner must reach ${C} points, got ${T}`};if(D<2)return{isValid:!1,error:`Tiebreak must be won by 2 points, got ${T}-${S}`};if(S>=C-1&&D>2)return{isValid:!1,error:`Tiebreak score ${T}-${S} is invalid`}}}else{if(s&&o){if(m===s+1&&g<s-1)return{isValid:!1,error:`With tiebreak format, if side 1 has ${s+1} games, side 2 must be at least ${s-1}, got ${g}`};if(g===s+1&&m<s-1)return{isValid:!1,error:`With tiebreak format, if side 2 has ${s+1} games, side 1 must be at least ${s-1}, got ${m}`}}if(r)return s&&(v>s+10||y>s+10)?{isValid:!1,error:`Set score ${v}-${y} exceeds expected range for ${s}-game sets`}:{isValid:!0};if(s&&v<s)return{isValid:!1,error:`Set winner must reach ${s} games, got ${v}`};if(b<2)return{isValid:!1,error:`Set must be won by at least 2 games, got ${v}-${y}`};if(o){if(y>=o)return{isValid:!1,error:`When tied at ${o}-${o}, must play tiebreak. Use format like ${o+1}-${o}(5)`};if(v>s+1)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${s+1}-${s-1}. Got ${v}-${y}`}}else if(v>s+10)return{isValid:!1,error:`Set score ${v}-${y} exceeds reasonable limits`}}return{isValid:!0}}function OIe(t,e,i){if(!t||t.length===0)return{isValid:!0};let r=e?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[wa,Fr,br].includes(i||"");for(let s=0;s<t.length;s++){let o=t[s],l=s+1===n,c=o.winningSide!==void 0,u=t7(o,e,l,a||i===void 0&&!c);if(!u.isValid)return{isValid:!1,error:`Set ${s+1}: ${u.error}`}}return{isValid:!0}}function i7({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],s=(a?.filter(w=>w?.winningSide)||[]).reduce((w,T)=>{let{winningSide:S}=T;if(!S)return w;let D=S-1;return w[D]++,w},[0,0]),o=r?r-1:void 0,l=o!==void 0&&[0,1].includes(o)?1-o:void 0,c=o!==void 0&&s[o],u=l!==void 0&&s[l],d=e?js(e):void 0,p=Math.max(...s),h=Nl(s)[p],f=d?.setFormat?.timed||d?.finalSetFormat?.timed,m=d?.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[br,wa,Fr].includes(v),b=!d||!a.length||a.every((w,T)=>{let S=T+1,D=S===m,C=S===a.length,{side1Score:E,side2Score:P,side1TiebreakScore:R,side2TiebreakScore:M,winningSide:A}=w,N=Math.max(E??0,P??0),k=R??M,{finalSetFormat:x,setFormat:O}=d,V=D&&x||O;if(k){let{tiebreakTo:F,NoAD:j}=V?.tiebreakFormat||{},q=Math.max(R??0,M??0);if(j&&q>F||q<F&&A&&(C&&!y||!C))return!1}return V.setTo?!(!V.noTiebreak&&N>V.setTo+1):!0}),I=(!e||p===g)&&h===1&&s.indexOf(p)+1||void 0;return{valid:!!(b&&(r&&c>u&&r===I||r&&y||!r&&!I&&(![Tn,br,wa,Fr].includes(v)||f&&v===Tn)))}}function r7({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:Se};let{sets:a,scoreStringSide1:s,scoreStringSide2:o}=n,l="scoreString must be a string!";if(s!==void 0&&typeof s!="string")return{error:Se,info:l};if(o!==void 0&&typeof o!="string")return{error:Se,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Se,info:vy("sets")};if(a?.length){let c=a.map(d=>d?.setNumber).filter(Boolean);if(c.length!==yi(c).length)return{error:Se,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(w=>![void 0,null].includes(w))).every(I=>I.every(w=>mi(w))))return{error:Se,info:"non-numeric values"};if(![b,y].filter(I=>![void 0,null].includes(I)).every(I=>mi(I)))return{error:Se,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Se,info:"winningSide must be 1 or 2"}}let{valid:u}=i7({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:Jfe,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var n7=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let s=ri(i);s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n);let o;return a&&!n?(s>r&&(o=r),o=s<r?r:r-1):o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[e?s:o,e?o:s]},uF=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let s=y4e({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:s,e?s:a]};function y4e(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function M_({tiebreakTo:t=7,scoreString:e="",matchUpFormat:i}){let r,n=3;if(i)try{r=js(i);let s=i?.match(/SET(\d+)/)?.[1];n=s?Number.parseInt(s):3}catch{}return e?.split(" ").filter(Boolean).map((s,o)=>a({set:s,setNumber:o+1}));function a({set:s,setNumber:o}){let l=/\(([^)]+)\)/,c=/\[([^\]]+)\]/,u=l.exec(s),d=c.exec(s),p=s?.startsWith("[")&&d,h=!1;if(r&&p){let b=o===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(b){let I=b.tiebreakSet?.tiebreakTo,w=b.setTo;h=!!I&&!w}}let f,m,g,v,y;if(p){let b=d[1].split("-").map(I=>parseInt(I));h?(f=b[0],m=b[1],y=f>m&&1||f<m&&2||void 0):(g=b[0],v=b[1],y=g>v&&1||g<v&&2||void 0)}else{let b=(u&&s.replace(u[0],"")||d&&s.replace(d[0],"")||s).split("-").map(I=>Number.parseInt(I));if(f=b[0],m=b[1],y=f>m&&1||f<m&&2||void 0,u){let I=u[1],w=uF({lowValue:I,isSide1:y===2,tiebreakTo:t});Array.isArray(w)&&([g,v]=w)}if(d&&!p){let I=d[1].split("-").map(w=>Number.parseInt(w));g=I[0],v=I[1]}}return{side1Score:f,side2Score:m,side1TiebreakScore:g,side2TiebreakScore:v,winningSide:y,setNumber:o}}}function b4e({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=oF({set:n});return sF({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i,isTimedSet:r})&&a||void 0}function kC(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:Yx};let{setNumber:r}=e||{},{bestOf:n,exactly:a}=i||{},s=n||a,o=!!(r&&s&&r===s),l=o&&i?.finalSetFormat||i?.setFormat,c=!!l?.tiebreakSet,u=!!l?.timed,d=!c&&!u,p=!!(r&&s&&r<=s),h=[e?.side1Score,e?.side2Score],f=[e?.side1PointScore,e?.side2PointScore],m=[e?.side1TiebreakScore,e?.side2TiebreakScore],g=h.filter(O=>O!==void 0).length,v=f.filter(O=>O!==void 0).length,y=m.filter(O=>O!==void 0).length,b=h?.filter(O=>!isNaN(O)).length,I=m?.filter(O=>!isNaN(O)).length,{tiebreakAt:w}=l||{},T=w&&h.filter(O=>O>=w).length===2,S=T&&(h[0]>h[1]&&1||h[1]>h[0]&&2||void 0),D=!!(I&&!b),C=!!e?.winningSide,{error:E,result:P}=I4e({sideTiebreakScores:m,sideGameScores:h,setFormat:l,setObject:e}),{error:R,result:M}=w4e({sideTiebreakScores:m,setObject:e,setFormat:l}),A=d&&!D&&P||c&&D&&M||u,N=p&&!(c&&!D)&&!(d&&D)&&(!C||A),k=b4e({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:o,isTiebreakSet:D,setObject:e}),x={expectTiebreakSet:c,expectTimedSet:u,hasTiebreakCondition:T,isCompletedSet:C,isDecidingSet:o,isTiebreakSet:D,isValidSet:N,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:S,setFormat:l,sideGameScores:h,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:v,sideTiebreakScores:m,sideTiebreakScoresCount:y,winningSide:k};return e?.winningSide!==void 0&&(D?(x.isValidTiebreakSetOutcome=M,M||(x.tiebreakSetError=R)):(x.isValidStandardSetOutcome=P,P||(x.standardSetError=E))),x}function I4e({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:Yx};let n=!!e?.tiebreakSet,a=!!e?.timed;if(!e||n||a)return{result:!1,error:Se};if(i?.filter(S=>!isNaN(S)).length!==2)return{result:!1,error:QV};let{setTo:s,tiebreakAt:o,tiebreakFormat:l,NoAD:c}=e||{};if(!(s&&i?.find(S=>S>=s)))return{result:!1,error:QV};let u=[1,2].includes(t?.winningSide);if(!t||!u)return{result:!1,error:Kx};let d=t?.winningSide-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=o&&l,v=r?.filter(S=>!isNaN(S)).length===2,y=r?.[d],b=r?.[p],I=o&&i.filter(S=>S>=o).length===2;if(g){let{NoAD:S,tiebreakTo:D}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(D))return{result:!1,error:{message:"tiebreakTo error"}};if(!(D&&r?.find(M=>M>=D)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=o<s?s:s+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,P=y-b,R=b>=D-1;if(P&&R&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let w=c?1:2,T=f>=s-1;return m&&T&&!I&&m<w?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>w&&h>s?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function w4e({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:Yx};let r=!!e?.tiebreakSet,n=!!e?.timed;if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t?.winningSide);if(!t||!a)return{result:!1,error:Kx};let{tiebreakSet:s}=e||{},{NoAD:o,tiebreakTo:l}=s||{};if(i?.filter(g=>!isNaN(g)).length!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find(g=>g>=l))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=t?.winningSide-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=o?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}function S4e(t){let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:s,isMock:o,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===ta&&s===ta){let d=e?.structures?.find(({stage:p})=>p===Dt)?.tieFormat;c=c||d||n&&l?.tieFormat?.tieFormatName===n&&l.tieFormat||n&&Qf({namedFormat:n,hydrateCollections:i,isMock:o,event:l})||l?.tieFormat||Qf({event:l,isMock:o,hydrateCollections:i}),u=void 0}else u||(c=void 0,l?.matchUpFormat||(u=_u));if(c){let d=Oo({gender:l?.gender,enforceGender:r,tieFormat:c});if(d.error)return d}return{tieFormat:c,matchUpFormat:u}}function T4e(t){let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:s,tieFormat:o,idPrefix:l,isMock:c,event:u}=t,d=t.qualifyingProfiles,p=d?.length?Bbe({hasExistingDrawDefinition:!0,uuids:t.uuids,qualifyingProfiles:d,appliedPolicies:r,qualifyingOnly:n,tieFormat:o,idPrefix:l,isMock:c}):void 0;if(p?.error)return p;e.structures=e.structures?.filter(({structureId:w})=>w!==i),e.links=e.links?.filter(({source:w})=>w.structureId!==i);let{qualifiersCount:h,qualifyingDrawPositionsCount:f,qualifyingDetails:m}=p??{};f&&(p?.structures&&e.structures?.push(...p.structures),p?.links&&e.links?.push(...p.links));let g=e.structures?.find(({stage:w,stageSequence:T})=>w===Dt&&T===1),{qualifiersCount:v}=ND({stageSequence:1,drawDefinition:e,structureId:s,stage:Dt}),y=Math.max(h??0,v??0),b=Vye({qualifiersCount:y,drawDefinition:e,stage:Dt});if(b.error||(b=D_({drawSize:f,stage:zt,drawDefinition:e}),b.error))return b;U4e({drawDefinition:e,drawEntries:a,event:u});let I=D4e({mainStructure:g,qualifyingDetails:m,drawDefinition:e});return I.error?I:{drawDefinition:e,structureId:s}}function U4e({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===zt)){let n={...r,entryStage:r.entryStage??Dt,drawDefinition:t,event:i};e6(n)}}function D4e({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){for(let r of e||[]){let{finalQualifyingRoundNumber:n,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:o,linkType:l}=r,c=t&&S0({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:n,finishingPositions:o,targetEntryRound:s,linkType:l})?.link;if(c?.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function xIe(t){let{participantIds:e}=t,i=t.drawDefinition?.entries?.filter(r=>{let n=r.entryStatus;return!t.restrictEntryStatus||td.includes(n)}).map(Fi)??[];if(e){let r=e.filter(n=>!i?.includes(n));if(r?.length)return ue({result:{error:Ed},info:{invalidParticipantIds:r}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:Se,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Se,info:"roundsCount must be less than 32"}:{participantIds:e}}function a7(t){let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:s,isMock:o,event:l}=t,c,u=xIe(t);if(u.error)return u;for(let d of yt(1,i+1)){let p=rF({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:c,idPrefix:s,isMock:o,event:l});if(p.error)return ue({result:p,info:{iteration:d}});p.matchUps?.length&&e.push(...p.matchUps),c=(p?.roundNumber??1)+1}return{matchUps:e}}function E4e(t){let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,s=t.scaleAccessor??Da[r]?.accessor,o=e.participants??[];for(let l of i??[]){let c=o?.find(d=>d.participantId===l),u=eX({scaleName:`${r}.${h5}`,participant:c,eventType:n});!u&&r&&(u=eX({scaleAccessor:s,participant:c,scaleName:r,eventType:n})),u&&!a[l]&&(a[l]=u)}return a}function eX({scaleType:t=rg,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){let a=(i&&yh({scaleAttributes:{eventType:n??II,scaleType:t,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return e&&qi(a)?a[e]:a}function s7(t){let e=C4e(t);if(e?.error)return e;let i=xIe(t);if(i.error)return i;let r=P4e(t);if(r.error)return r;let n=E4e(t),a=t.tournamentRecord?.isMock??t.isMock,s=t.eventType??t.event?.eventType,o=[],l=[],c;for(let u of yt(1,(t.roundsCount??1)+1)){let d=Y6({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:o,adHocRatings:n,roundNumber:c,eventType:s,isMock:a});if(d.error)return d;let{matchUps:p,...h}=d;h.modifiedScaleValues&&(n=h.modifiedScaleValues),l.push({...h,iteration:u,matchUpsCount:p?.length}),c=(h?.roundNumber??1)+1,p?.length&&o.push(...p)}return{...oe,matchUps:o,roundResults:l}}function P4e(t){if(t.structureId)return t.structureId;let e=t.drawDefinition,i=e?.structures?.filter(n=>n.stageSequence===1)?.reduce((n,a)=>{let s=a.stage&&wI[a.stage];return xo({structure:a})&&s>(wI[n?.stage]||1)?a:n},void 0),r=e?.structures?.find(n=>n.structureId===i?.structureId);return r?xo({structure:r})?{structure:r}:{error:zb}:{error:en}}function C4e(t){return t.roundsCount&&typeof t.roundsCount!="number"?{error:Se,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==kl?{error:zb}:!Array.isArray(t.drawDefinition?.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Se,info:"Missing Entries"}:{error:void 0}}function R4e(t){let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:s}=t,o=s?.entries?.filter(({entryStage:u,entryStatus:d})=>(!u||u===Dt)&&d&&td.includes(d)),l=o?.map(Fi),c=o?Math.floor(o.length/2):0;if(t.automated)return M4e({...t,participantIds:l});{let u=a7({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:n,isMock:a,event:s});if(u.error)return u;u.matchUps?.length&&QL({matchUps:u.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:s})}return{...oe}}function M4e(t){let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:s}=t.drawMatic??{},o=s7({...t,eventType:t.drawMatic?.eventType??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:s??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return o.error?o:(o?.matchUps?.length&&QL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:o.matchUps,event:t.event,structureId:r}),{...oe})}function N4e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,seedsCount:c}){r=r??n;let u=oi({drawDefinition:s,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:en};let{positionAssignments:p}=ca({structure:d}),h=p?.length||0;if(c>h)return{error:Rfe};let f=d.structures?.length,m=mi(o?.groupSeedingThreshold)&&o?.groupSeedingThreshold,g=c6({roundRobinGroupsCount:f,drawSize:h})?.seedGroups,{seedsCount:v}=N0({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:h});return v&&a?.[Iu]&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=yt(1,c+1).map(y=>{let b=g?.find(T=>T.includes(y)),I=b&&Math.min(...b),w=m&&y>=m?I:y;return{participantId:void 0,seedNumber:y,seedValue:w}}),Cr({drawDefinition:s,structureIds:[l]}),{...oe,seedLimit:c}}function $w({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:s,stage:o}){if(!e)return{error:et};return a=a??s?.entries??[],{scaledEntries:a.filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||!u.entryStageSequence||u.entryStageSequence===n)&&td.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=oU({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function LIe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Wu({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r?.find(({structureId:h})=>!n.includes(h));if(!a)return ue({result:{error:en},stack:e});let s=a?.structureId,{seedsCount:o,stageEntries:l,seedLimit:c}=B4e({...t,structureId:s});(t.seededParticipants||t.event||t.seedingScaleName)&&k4e({...t,seedsCount:o,structure:a,structureId:s});let u=t.automated!==!1&&t.drawType!==kl&&!(t.qualifyingOnly&&t.stage!==zt),d=(r?.length||0)>1,p=u?_4e({...t,multipleStructures:d,seedLimit:c,structureId:s}):{};return p?.error?ue({result:p,stack:e}):{...p,stageEntries:l,structureId:s,seedsCount:o}}function A4e({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{let a=Ci({name:Bp,element:n})?.extension?.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&Zy.includes(n.entryStatus)})}function _4e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=w0({...t,seedsOnly:e});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function k4e(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(Fi);e?O4e({...t,enteredParticipantIds:a}):(n||i)&&x4e({...t,enteredParticipantIds:a})}function O4e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structureId:l,structure:c,event:u}=t,d=c?xw({provisionalPositioning:e,appliedPolicies:a,drawDefinition:s,seedingProfile:o,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;_D({provisionalPositioning:e,tournamentRecord:n,drawDefinition:s,seedingProfile:o,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function x4e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:s,drawDefinition:o,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=d?.category||{};d?.eventType;let f=L4e({...t})||l&&F4e({...t}),m=f?.length??0;m<e&&(e=m),f?.filter(({participantId:g})=>r.includes(g)).slice(0,a||e).forEach((g,v)=>{let y=v+1,{participantId:b,scaleValue:I}=g,w=n?.[y]||I||y;_D({provisionalPositioning:i,tournamentRecord:s,drawDefinition:o,seedingProfile:c,participantId:b,structureId:u,seedNumber:y,seedValue:w,event:d})})}function L4e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:s}=t,{categoryName:o,ageCategoryCode:l}=s?.category||{},c=s?.eventType,u={scaleName:i||o||l||s.eventId,scaleType:gh,eventType:c};return $w({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function F4e(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:s,ageCategoryCode:o}=r?.category||{},l=r?.eventType;return $w({scaleAttributes:{scaleName:s||o,scaleType:yg,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function B4e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=A4e(t);e>i.length&&(e=i.length);let{seedLimit:r}=N4e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function $4e(t){let e=q6({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:s,seedingProfile:o,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=V4e({ignoreStageSpace:n,drawDefinition:i,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===Hy?0:ri(t.seedsCount??0),y=LIe({...t,qualifyingOnly:!d||s,appliedPolicies:a,drawDefinition:i,seedingProfile:o,participants:l,stage:Dt,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;y.positioningReport?.length&&f.push({[Dt]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===kl&&t.roundsCount&&R4e({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:f,conflicts:m,structureId:b}}function V4e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let s of a){if(r&&s.entryStage&&s.entryStage!==Dt)continue;let o={...s,ignoreStageSpace:e??n===kl,entryStage:s.entryStage??Dt,event:t.event,drawDefinition:i,drawType:n},l=e6(o);if(r&&l.error)return l}return{error:void 0}}var j4e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),G4e=j4e;function H4e(t){let{drawId:e=lr(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=G4e();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function o7(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:s,event:o}=t,l=Gt(t,[{[Gs]:!0,[o5]:!0}]);if(l.error)return l;if(!Al({matchUpFormat:n}))return{error:OR};let c="setMatchUpFormat";if(s){let u=qr({drawDefinition:r,matchUpId:s,event:o});if(u.error)return u;let d=u.matchUp;if(d?.matchUpType===ta)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:al};d&&(d.matchUpFormat=n,Hi({tournamentId:i?.tournamentId,eventId:o?.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if(o?.eventType===ta)return{error:xh};for(let u of e){let d=oi({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if(o?.eventType===ta)return{error:xh};let u=oi({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),Cr({drawDefinition:r,structureIds:e}),{...oe}}function z4e({tieFormat:t}){let e=Oo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=lr());return{tieFormat:t}}function q4e({existingQualifyingStructures:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:s}){if((r||a)&&!(r&&s?.matchUpFormat===r||s?.tieFormat&&a&&JSON.stringify(s.tieFormat)===JSON.stringify(a))){if(a){let o=z4e({tieFormat:a});if(o.error)return o;let l=t?.every(c=>c.tieFormat);(!t?.length||l)&&(i.tieFormat=o.tieFormat??a)}else if(r){let o=o7({tournamentRecord:e,drawDefinition:i,matchUpFormat:r,event:s});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(i.matchUpType=n)}return{error:void 0}}var FIe={};_i(FIe,{attachPolicies:()=>yy,findPolicy:()=>Yy,getAppliedPolicies:()=>er,getPolicyDefinitions:()=>Um,mutate:()=>BIe,query:()=>VIe,removePolicy:()=>$Ie});var BIe={};_i(BIe,{attachPolicies:()=>yy,removePolicy:()=>$Ie});function $Ie(t){let e=Gt(t,[{[qGe]:!0,_anyOf:{[Fs]:!1,[pa]:!1,[Gs]:!1,[Tm]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return tX(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:et};for(let a of n){let s=t.tournamentRecords[a],o=tX(t,s);if(o.error)return o;i=!0}}else return{error:et};return i?{...oe}:{error:xR}}function tX(t,e){let i=er(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?nr({element:e,extension:{name:UC,value:i}}):uo({element:e,name:UC}),{...oe}):{error:xR}}var VIe={};_i(VIe,{findPolicy:()=>Yy,getAppliedPolicies:()=>er,getPolicyDefinitions:()=>Um});var jIe={[Iu]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Vh]:{positioning:uy},[zu]:{positioning:uy}},positioning:xGe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},kj=jIe;function W4e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ue({info:"policyDefinitions must be an object",result:{error:Se},stack:r});let n={[TC]:t?.[TC]};return e?Y4e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&yy({drawDefinition:i,policyDefinitions:n}),!t?.[Iu]&&!e?.[Iu]&&(yy({policyDefinitions:kj,drawDefinition:i}),t&&Object.assign(t,kj)),{error:void 0}}function Y4e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e?.[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(yy({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function K4e(t){let{tournamentRecord:e,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:s,drawType:o,stack:l,event:c}=t,u=t.drawId?c?.drawDefinitions?.find(v=>v.drawId===t.drawId):void 0,d=u?.structures?.find(v=>v.stage===Dt&&v.stageSequence===1)?.structureId,p=u?u.structures?.filter(v=>v.stage===zt):[],h=p?.length===1&&!p[0].matchUps?.length&&p[0].structureId;u&&o!==u.drawType&&(u.drawType=o);let f=u??H4e({processCodes:t.processCodes,drawId:t.drawId,drawType:o}),m=q4e({existingQualifyingStructures:p,tournamentRecord:e,drawDefinition:f,matchUpFormat:n,matchUpType:a,tieFormat:s,event:c});if(m.error)return ue({result:m,stack:l});let g=W4e({appliedPolicies:r,policyDefinitions:i,drawDefinition:f,stack:l});return g.error?g:{drawDefinition:f,structureId:d,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:h}}function Z4e(t){let e="generateOrGetExisting",i=[],r=[],n=K4e(t);if(n.error)return ue({result:n,stack:e});let a=n.existingDrawDefinition,s=n.drawDefinition??{},o=n.structureId,l=t.drawEntries??t.eventEntries??[],c=n.existingQualifyingPlaceholderStructureId&&T4e({...t,...n})||$4e({...t,...n,entries:l});return c.error?ue({result:c,stack:e}):(c.positioningReports?.length&&i.push(...c.positioningReports??[]),c.conflicts?.length&&r.push(...c.conflicts??[]),s=c.drawDefinition,o=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:s,structureId:o,conflicts:r,entries:l})}function X4e(t){let{qualifyingPlaceholder:e,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:s,drawDefinition:o,seedingProfile:l,participants:c,structureId:u,tieFormat:d,entries:p,stack:h}=t,f=e&&!n?.length&&!i,m=[];if(n){let g=(I,w)=>I.stageSequence-w.stageSequence,v=(I,w)=>I.roundTarget-w.roundTarget,y=[],b=1;n.sort(v);for(let I of n){if(!Array.isArray(I.structureProfiles))return ue({info:vy("structureProfiles"),result:{error:Yt},stack:h});b=I.roundTarget||b;let w=I.structureProfiles?.sort(g)||[],T=1;for(let S of w){let{qualifyingRoundNumber:D,qualifyingPositions:C,seededParticipants:E,seedingScaleName:P,seedsCount:R=0,seedByRanking:M,placeByes:A,drawSize:N}=S,k=LIe({...t,seedingProfile:S.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:D,preparedStructureIds:y,qualifyingPositions:C,seededParticipants:E,stage:zt,seedingScaleName:P,appliedPolicies:a,drawDefinition:o,qualifyingOnly:s,seedByRanking:M,participants:c,roundTarget:b,seedsCount:R,placeByes:A,drawSize:N,entries:p});if(k.error)return k;k.structureId&&y.push(k.structureId),T+=1,k.conflicts?.length&&m.push(...k.conflicts),k.positioningReport?.length&&r.push({[zt]:k.positioningReport})}b+=1}}else if(u&&f){let g=kc({structureName:ys(zt),stage:zt,qualifyingOnly:s,tieFormat:d}),{link:v}=S0({sourceStructureId:g.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:Fh});o.structures||(o.structures=[]),o.structures.push(g),o.links||(o.links=[]),o.links.push(v)}return{qualifyingConflicts:m,error:void 0}}var GIe={};_i(GIe,{addGoesTo:()=>gy,allCompetitionMatchUps:()=>Cd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allPlayoffPositionsFilled:()=>g6,allTournamentMatchUps:()=>Wa,analyzeDraws:()=>R0,analyzeMatchUp:()=>xC,analyzeTournament:()=>v7,bulkUpdatePublishedEventIds:()=>b7,calculateWinCriteria:()=>jw,categoryCanContain:()=>jR,checkMatchUpIsComplete:()=>Vv,checkValidEntries:()=>iF,compareTieFormats:()=>om,competitionScheduleMatchUps:()=>L0,courtGridRows:()=>SF,credits:()=>J4e,drawMatchUps:()=>_7,eventMatchUps:()=>DF,filterMatchUps:()=>Rf,filterParticipants:()=>g0,findDrawDefinition:()=>$6,findExtension:()=>Ci,findVenue:()=>rf,getAggregateTeamResults:()=>g7,getAllDrawMatchUps:()=>qn,getAllEventData:()=>I7,getAllStructureMatchUps:()=>ar,getAllowedDrawTypes:()=>dF,getAllowedMatchUpFormats:()=>h7,getAppliedPolicies:()=>er,getAssignedParticipantIds:()=>Jy,getAvailableMatchUpsCount:()=>eF,getAvailablePlayoffProfiles:()=>U0,getCategoryAgeDetails:()=>bI,getCheckedInParticipantIds:()=>Mw,getCompetitionDateRange:()=>hF,getCompetitionMatchUps:()=>OC,getCompetitionParticipants:()=>l7,getCompetitionPenalties:()=>f7,getCompetitionVenues:()=>_0,getCourtInfo:()=>LL,getCourts:()=>k7,getDrawData:()=>gF,getDrawDefinitionTimeItem:()=>L5,getDrawParticipantRepresentativeIds:()=>F6,getDrawStructures:()=>Wu,getDrawTypeCoercion:()=>M0,getEligibleVoluntaryConsolationParticipants:()=>L6,getEntriesAndSeedsCount:()=>TF,getEvent:()=>L7,getEventData:()=>vF,getEventMatchUpFormatTiming:()=>U7,getEventProperties:()=>O7,getEventPublishStatus:()=>ru,getEventStructures:()=>zL,getEventTimeItem:()=>QR,getEvents:()=>x7,getFlightProfile:()=>Rn,getHomeParticipantId:()=>C7,getLinkedTournamentIds:()=>ZR,getMatchUpCompetitiveProfile:()=>l0,getMatchUpContextIds:()=>R7,getMatchUpDailyLimits:()=>PF,getMatchUpDailyLimitsUpdate:()=>D7,getMatchUpDependencies:()=>id,getMatchUpFormat:()=>M7,getMatchUpFormatTiming:()=>c0,getMatchUpFormatTimingUpdate:()=>T7,getMatchUpScheduleDetails:()=>FL,getMatchUpType:()=>BL,getMatchUpsMap:()=>rs,getMatchUpsStats:()=>N7,getMatchUpsToSchedule:()=>yF,getMaxEntryPosition:()=>S7,getModifiedMatchUpFormatTiming:()=>UF,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>c7,getParticipantIdFinishingPositions:()=>B6,getParticipantMembership:()=>u7,getParticipantResults:()=>D0,getParticipantScaleItem:()=>oU,getParticipantSchedules:()=>d7,getParticipantSignInStatus:()=>p7,getParticipantTimeItem:()=>F5,getParticipants:()=>un,getPersonRequests:()=>tb,getPolicyDefinitions:()=>Um,getPositionAssignments:()=>AC,getPositionsPlayedOff:()=>OD,getPredictiveAccuracy:()=>P7,getProfileRounds:()=>wF,getPublishState:()=>kw,getRandomQualifierList:()=>G6,getRoundMatchUps:()=>vo,getRounds:()=>A7,getScaleValues:()=>UD,getScaledEntries:()=>$w,getScheduledRoundsDetails:()=>k0,getSchedulingProfile:()=>Cm,getSchedulingProfileIssues:()=>w7,getSeedingThresholds:()=>u6,getSeedsCount:()=>N0,getStructureSeedAssignments:()=>Hc,getTeamLineUp:()=>my,getTieFormat:()=>mF,getTimeItem:()=>eu,getTournamentIds:()=>YR,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>pF,getTournamentPersons:()=>m7,getTournamentPoints:()=>fF,getTournamentPublishStatus:()=>m0,getTournamentStructures:()=>m6,getTournamentTimeItem:()=>AL,getValidGroupSizes:()=>b0,getVenueData:()=>aU,getVenuesAndCourts:()=>Pm,isAdHoc:()=>xo,isCompletedStructure:()=>qh,isValidForQualifying:()=>H6,isValidMatchUpFormat:()=>Al,matchUpActions:()=>tF,participantScaleItem:()=>yh,participantScheduledMatchUps:()=>E7,positionActions:()=>j6,publicFindCourt:()=>K5,publicFindVenue:()=>Y5,tallyParticipantResults:()=>xD,tieFormatGenderValidityCheck:()=>oL,tournamentMatchUps:()=>EF,validMatchUp:()=>_L,validMatchUps:()=>iu,validateCollectionDefinition:()=>GR,validateLineUp:()=>HL});function J4e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var HIe={};_i(HIe,{filterParticipants:()=>g0,getCompetitionParticipants:()=>l7,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>c7,getParticipantMembership:()=>u7,getParticipantScaleItem:()=>oU,getParticipantSchedules:()=>d7,getParticipantSignInStatus:()=>p7,getParticipantTimeItem:()=>F5,getParticipants:()=>un,getScaleValues:()=>UD,participantScaleItem:()=>yh,validateLineUp:()=>HL});function l7(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:hn};let i=[],r={},n={},a={},s=[],o={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=un({...t,tournamentRecord:c});Object.assign(o,d),Object.assign(r,p),Object.assign(n,m),Object.assign(a,g),i.push(...h??[]),s.push(...f??[]),u?.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:o,participants:i,...oe,matchUps:s}}function c7({tournamentRecord:t,participantId:e}){if(!t)return{error:et};if(!e)return{error:oa};let i=[e].concat((t.participants??[]).filter(r=>r?.participantType&&[hr,Ei].includes(r.participantType)&&r.individualParticipantIds?.includes(e)).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=(r?.entries??[]).map(a=>a.participantId);return go(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function u7({tournamentRecord:t,participantId:e}){if(!t)return{error:et};if(!e)return{error:oa};let{participants:i}=un({participantFilters:{participantTypes:[hr,Ei,vc]},tournamentRecord:t});return(i??[]).filter(r=>r.individualParticipantIds?.includes(e)).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function d7({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:et};if(typeof t!="object")return{error:Sm,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Wa({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),s=id({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],o={};for(let l of a){let{sides:c}=l,u,d=c?.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);s[l.matchUpId]&&!u&&(u=(s[l.matchUpId]||[]).map(f=>n[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat()??[];for(let h of d){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].matchUps.push(l)}let p=u?.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat()||[];for(let h of p){let{participantId:f}=h;o[f]||(o[f]={potentialMatchUps:[],participant:h,matchUps:[]}),o[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(o).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...oe}}function p7({tournamentRecord:t,participantId:e}){if(!t)return{error:et};if(!e)return{error:oa};let{participant:i}=Zg({tournamentRecord:t,participantId:e});if(!i)return{error:_n};let{timeItem:r}=eu({itemType:JR,element:i});return r&&r.itemValue===EC&&EC}var zIe={};_i(zIe,{analyzeDraws:()=>R0,analyzeTournament:()=>v7,getAggregateTeamResults:()=>g7,getAllowedDrawTypes:()=>dF,getAllowedMatchUpFormats:()=>h7,getAppliedPolicies:()=>er,getCompetitionDateRange:()=>hF,getCompetitionPenalties:()=>f7,getPolicyDefinitions:()=>Um,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>pF,getTournamentPersons:()=>m7,getTournamentPoints:()=>fF,getTournamentStructures:()=>m6,getTournamentTimeItem:()=>AL});function h7({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:et};let{appliedPolicies:r}=er({tournamentRecord:t});return(r?.[Gc]?.matchUpFormats||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function dF({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:et};let{appliedPolicies:r}=er({tournamentRecord:t});return(r?.[f_]?.allowedDrawTypes||[]).filter(({categoryNames:n,categoryTypes:a})=>!e&&!a||e&&n?.includes(e)||i&&a?.includes(i))}function pF({tournamentRecord:t}){if(!t)return{error:et};let e=(t?.participants??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:s}=a||{};i[s]?i[s].participants.push(n):i[s]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function f7({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let e=[];for(let i of Object.values(t)){let{penalties:r}=pF({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function qIe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:s,category:o,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var Q4e={[DD]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},e5e=Q4e;function Vw(t){let{tournamentRecord:e}=t??{};if(!e)return{error:et};let i=(({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:w})=>({tournamentId:o,tournamentRank:l,tournamentStatus:c,formalName:u,tournamentName:d,promotionalName:p,onlineResources:h,localTimeZone:f,activeDates:m,startDate:g,endDate:v,hostCountryCode:y,venues:b,notes:I,updatedAt:w}))(e),r=un({participantFilters:{participantRoles:[oye,i6,lye,cye,dye]},policyDefinitions:e5e,tournamentRecord:e})?.participants??[];r&&(i.tournamentContacts=r);let n=kw({tournamentRecord:e})?.publishState,a=n?.tournament?.status?.publishedEventIds||[],s=[];for(let o of e.events??[])if(!t?.usePublishState||a.includes(o.eventId)){let l=qIe({event:o}).eventInfo;l&&s.push(l)}return i.timeItemValues=gbe({element:e}),i.publishState=n?.tournament,i.eventInfo=s,{tournamentInfo:Et(Ft(i),!1,!0),...oe}}function hF({tournamentRecords:t}){if(!qi(t))return{error:hn};let e=Object.keys(t??{}).reduce((n,a)=>{let s=t[a],{tournamentInfo:{startDate:o,endDate:l}}=Vw({tournamentRecord:s}),c=o&&new Date(Ui(o));(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let u=l&&new Date(Ui(l));return(!n.endDate||u&&u>n.endDate)&&(n.endDate=u),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ui(e.startDate.toISOString()),r=e.endDate&&Ui(e.endDate.toISOString());return!i||!r?{error:Yfe}:{startDate:i,endDate:r}}function m7({tournamentRecord:t,participantFilters:e}){if(!t)return{error:et};let i=t.participants||[];e&&(i=g0({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:s}=a.person;r[s]?r[s].participantIds.push(a.participantId):r[s]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function g7(t){let e=Gt(t,[{[pa]:!0}]);if(e.error)return e;let i=t.finishingPositionRangeBounsPoints||{},r={},n=d=>{let p=d?.individualParticipants?.map(h=>h.teams?.length===1&&h.teams[0]);return d?.teams?.length===1&&d?.teams?.[0]||p?.[0].participantId===p?.[1].participantId&&p?.[0]},{matchUps:a,participants:s}=un({participantFilters:{participantTypes:[Bi]},withRankingProfile:!0,withStatistics:!0,...t});for(let d of s??[]){if(d.participantType===Ro)continue;d.draws?.[0]?.drawId==="draw-0-3"&&console.log(d.participantType,d.draws[0].finishingPositionRange);let p=n(d);if(p)for(let h of d?.draws??[]){let f=h?.finishingPositionRange?.join("-");if(f&&i?.[f]){let m=p?.participantId,g=h?.drawId,v=`${m}|${g}|${f}`;r[v]=i[f]}}}let o=d=>({teamName:d,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),l=(d,p,h)=>{d[p]===void 0&&(d[p]=0),d[p]+=h},c={},u={};for(let d of a??[]){let{sides:p,matchUpFormat:h}=d,f=h&&js(h);if(p?.length===2&&f.setFormat?.timed&&(!f.finalSetFormat||f.finalSetFormat?.timed))for(let m of p){let g=n(m.participant),v=g?.participantId,y=m.participant?.participantId,b=g?.participantName,I=m.sideNumber,w=m.participant?.individualParticipantIds||y&&[y]||[];if(w.forEach(T=>{T&&!c[T]&&(c[T]=o(b))}),v&&I){u[v]||(u[v]=o(b));let T=[...w.map(D=>c[D]),u[v]];d.winningSide&&(I===d.winningSide?T.forEach(D=>l(D,"win",1)):T.forEach(D=>l(D,"loss",1)));let S=d.score?.sets||[];for(let D of S){let C=D?.[`side${3-I}Score`]||0,E=D?.[`side${I}Score`]||0,P=E-C;T.forEach(R=>l(R,"pointsPlayed",E+C)),T.forEach(R=>l(R,"points",E)),T.forEach(R=>l(R,"diff",P))}}}}for(let d of Object.keys(r)){let[p]=d.split("|");u[p]&&(u[p].bonus+=r[d],u[p].pointsPct=parseFloat((u[p].points/u[p].pointsPlayed).toFixed(2)),u[p].standingPoints=u[p].win+u[p].bonus)}for(let d of Object.keys(c))c[d].pointsPct=parseFloat((c[d].points/c[d].pointsPlayed).toFixed(2));return{...oe,individualResults:c,teamResults:u}}function t5e(t){let e=t.participants?.filter(({participantType:a})=>a===hr)?.length===2,i=t.events?.length===1&&t.events[0],r=i?.drawDefinitions?.length===1&&i.drawDefinitions[0],n=(r?.structures?.length===1&&r.structures[0])?.positionAssignments?.length===2;return!!(i.tieFormat&&e&&n)}function v7({tournamentRecord:t}){if(!t)return{error:et};let{drawsAnalysis:e}=R0({tournamentRecord:t}),i={isDual:t5e(t),drawsAnalysis:e},r=un({tournamentRecord:t});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{...oe,analysis:i}}function WIe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function i5e(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:s,category:o,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!r&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!r||!m.startDate||new Date(r)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!f.drawTypes?.length||f.drawTypes?.includes(s))&&(!f.drawSizes?.length||f.drawSizes.includes(a))&&(!f.stages?.length||f.stages.includes(p))&&(!f.levels?.length||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!f.flights?.flightNumbers?.length||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!f.category?.ageCategoryCodes||f.category.ageCategoryCodes.includes(o?.ageCategoryCode))&&(!f.eventTypes?.length||f.eventTypes?.includes(n)))}}function iX({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){let s=(f,m)=>{if(f){if(Array.isArray(m)){let g=m.find(v=>v.flight===f||v.f===f);return g.value||g.v}if(typeof m=="object"){let g=m.flights||m.f;if(Array.isArray(g))return g[f-1]}}},o=(f,m)=>{let g=f?.value||f?.v||(mi(f)?f:0),v=WIe(a,f?.level);return{value:s(m,v)||mi(v)&&v||g}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let f=i.find(v=>v.drawSize===r||v.drawSizes?.includes(r)),m=i.find(v=>v.drawSize&&v.threshold&&r>v.drawSize),g=i.find(v=>!v.drawSize&&!v.drawSizes?.length);h!==void 0&&(f=f?.[h],m=m?.[h],g=g?.[h]),u=o(f,e).value,d=o(m,e).value,p=o(g,e).value,l=u||d||p,c=u&&f.requireWin||d&&m.requireWin||g?.requireWin}else if(typeof i=="object"){let f=i?.drawSizes?.[r],m=i;h!==void 0&&(f=f?.[h],m=m?.[h]),u=o(f,e).value,p=o(m,e).value,l=u||p,c=u?f.requireWin:m?.requireWin}else mi(i)&&h===void 0&&(l=i);return e&&n?.pct?.[e]&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:c}}function fF({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){if(!i)return{error:et};let{policyDefinitions:n}=Um({policyTypes:[kN],tournamentRecord:i}),a=e?.[kN]??n?.[kN];if(!a)return{error:Wx};let s=a.awardProfiles,o=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=un({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c?.filter(v=>v.draws?.length),f={},m={},g={};for(let v of h??[]){let{participantType:y,participantId:b,person:I,draws:w}=v;for(let T of w){let{drawId:S,structureParticipation:D,eventId:C}=T,E=u[C],P=d[S],R=P?.drawType,{category:M,eventType:A}=E||{},N=T.startDate||E.startDate||i.startDate,k=T.endDate||E.endDate||i.endDate;if(A===_l&&b!==Ro)continue;let x;if(s){let O=l,V=0,F=0,j=0,q;for(let W of D){let{finishingPositionRange:z,participationOrder:H,participantWon:Z,flightNumber:J,rankingStage:ie,winCount:K}=W;V+=K||0;let ne=P?.drawSize,{awardProfile:le}=i5e({awardProfiles:s,participation:W,eventType:A,startDate:N,category:M,drawSize:ne,drawType:R,endDate:k,level:r});if(le){if(!ne)continue;let re=Array.isArray(z)&&Math.max(...z),me=yi(z||[]).join("-"),he=re&&ie!==zt&&z?.includes(ne);le.requireWinForPoints!==void 0&&(O=le.requireWinForPoints),le.requireWinFirstRound!==void 0&&(o=le.requireWinFirstRound);let{finishingPositionPoints:Ie={},finishingPositionRanges:Le,finishingRound:ot,pointsPerWin:at,flights:dt}=le,It=Array.isArray(le.perWinPoints)?le.perWinPoints?.find(mt=>mt.participationOrders?.includes(H)):le.perWinPoints,ze=Ie.participationOrders,Ct=0,ke;if((!ze||ze.includes(H))&&Le&&re){let mt=Le[re];mt&&({awardPoints:Ct,requireWin:ke}=iX({flightNumber:J,valueObj:mt,drawSize:ne,flights:dt,level:r}))}if(!Ct&&ot&&H===1&&re){let mt=ot[re];mt&&({awardPoints:Ct,requireWin:ke}=iX({participantWon:Z,flightNumber:J,valueObj:mt,drawSize:ne,flights:dt,level:r}))}if(he&&o!==void 0&&(O=o),ke!==void 0&&(O=ke),Ct>F&&(!O||K)&&(F=Ct,q=re),!Ct&&at&&K&&(j+=K*at,q=me),!Ct&&K&&It){let mt=WIe(r,It?.level);mt?j+=K*mt:It.value&&(j+=K*It.value)}}if(x=F+j,y===Ro){let re=(v.matchUps||[]).filter(({structureId:me})=>me===W.structureId);for(let{matchUpId:me}of re){let he=p[me],Ie=he.sides.find(Le=>Le.participantId===b).sideNumber;if(he.winningSice===Ie)for(let Le of he.tieMatchUps)Le.winningSide}}}if(j||F){let W={winCount:V,positionPoints:F,rangeAccessor:q,perWinPoints:j,eventType:A,drawId:S,points:x},z=I?.personId;z?(f[z]||(f[z]=[]),f[z].push(W)):y===Ei?(g[b]||(g[b]=[]),g[b].push(W)):y===Ro&&(m[b]||(m[b]=[]),m[b].push(W))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...oe}}var YIe={};_i(YIe,{compareTieFormats:()=>om,getTieFormat:()=>mF,tieFormatGenderValidityCheck:()=>oL,validateCollectionDefinition:()=>GR});function N_(t){if(!t)return{};let e=[],i=t.tieFormatName,r=t.collectionDefinitions?.map(n=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:o,category:l,gender:c}=n;e.includes(s)||e.push(s);let u=l?.ageCategoryCode;return[o,a===ly?"D":"S",u,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function om({considerations:t={},descendant:e,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:s}=N_(e),{matchUpFormats:o,tieFormatDesc:l}=N_(i),c=yi((a??[]).filter(w=>!(o??[]).includes(w)).concat((o??[]).filter(w=>!(a??[]).includes(w)))),u=!!(t?.collectionName&&e.collectionDefinitions.map(({collectionName:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionName:w})=>w).join("|")),d=!!(t?.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")),p=Object.assign({},...(e?.collectionDefinitions||[]).map(w=>({[w.collectionId]:w}))),h=Object.assign({},...(i?.collectionDefinitions||[]).map(w=>({[w.collectionId]:w})));r.collectionIds=IZ(Object.keys(p),Object.keys(h)),n.collectionIds=IZ(Object.keys(h),Object.keys(p)),r.collectionsValue=rX(p),n.collectionsValue=rX(h),r.groupsCount=i?.collectionGroups?.length??(0-(e?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let f=r.collectionsValue.totalValue-n.collectionsValue.totalValue,m=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((w,T)=>{let S=r.collectionsValue.assignmentValues[T];return!S||w.valueKey!==S.valueKey||w.value!==S.value?!0:Array.isArray(w.value)?w.value.every((D,C)=>S.value[C]===D):!1}),y=u||d||l!==s||g||v||f!==0,b=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:s,ancestorDesc:l,...oe,different:y,invalid:I}}function rX(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(VL).reduce((n,a)=>{let s=t[a],{collectionValueProfiles:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=s,h={collectionValueProfiles:o,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g])&&(!Array.isArray(h[g])||h[g].length>0));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(o):h[m];i.push({valueKey:m,value:g})}return r+=c,o?.length?n+o.reduce((g,v)=>g+v.value,0):c?mi(u)?n+u*c:mi(d)?n+d*c:mi(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function y7(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=KIe(t);return{matchUp:Et(e,!0,!0),error:i}}function KIe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,matchUpId:o,inContext:l,eventId:c,drawId:u,event:d}){if(!i)return{error:et};if(typeof o!="string")return{error:eo};if(!a||!d){let f=(Wa({tournamentRecord:i,nextMatchUps:s}).matchUps??[]).find(m=>m.matchUpId===o);if(!f)return{error:Ls};({eventId:c,drawId:u}=f),{event:d,drawDefinition:a}=Lo({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:lc};n&&!r&&(r=Dm({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??i.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??i.indoorOutdoor,endDate:d?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:c??d?.eventId,drawId:u},{participants:h=[]}=Wy({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(s){let f=(po({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:s,inContext:l,event:d}).matchUps??[]).find(g=>g.matchUpId===o);if(!f)return{error:Ls};let m=a?.structures?.find(g=>g.structureId===f.structureId);return{drawDefinition:a,structure:m,matchUp:f}}else{let{matchUp:f,structure:m}=qr({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:o,inContext:l,event:d});return{matchUp:f,structure:m,drawDefinition:a}}}function mF({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:s,event:o}){if(!t)return{error:et};if(!s&&!o&&!i&&!r)return ue({result:{error:Yt},stack:"getTieFormat"});a&&!o&&(o=t.events?.find(h=>h.eventId===a));let l=y7({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:s,event:o});if(r&&l?.error)return l;if(!e&&l?.drawDefinition&&(e=l?.drawDefinition),n=n??l?.structure,!n&&i&&!r){if(!e)return{error:Nd};let h=oi({drawDefinition:e,structureId:i});if(h.error)return h;n=h.structure}let c=(n?.tieFormat||n?.tieFormatId)&&Zs({structure:n,drawDefinition:e,event:o})?.tieFormat,u=(e?.tieFormat||e?.tieFormatId)&&Zs({drawDefinition:e,event:o})?.tieFormat,d=Zs({event:o})?.tieFormat,p=Zs({matchUp:l?.matchUp,drawDefinition:e,structure:n,event:o})?.tieFormat;return{...oe,matchUp:l?.matchUp,structureDefaultTieFormat:ls(c),eventDefaultTieFormat:ls(d),drawDefaultTieFormat:ls(u),tieFormat:ls(p),structure:n}}var ZIe={};_i(ZIe,{bulkUpdatePublishedEventIds:()=>b7,getAllEventData:()=>I7,getCourtInfo:()=>LL,getDrawData:()=>gF,getEventData:()=>vF,getEventPublishStatus:()=>ru,getPublishState:()=>kw,getTournamentPublishStatus:()=>m0,getVenueData:()=>aU});function b7({tournamentRecord:t,outcomes:e}){if(!t)return{error:et};if(!e?.length)return{error:Yt,info:"Missing outcomes"};let i=e.reduce((n,a)=>{let{drawId:s,eventId:o}=a;return o&&s&&(n[o]?n[o].includes(s)||n[o].push(s):n[o]=[s]),n},{}),r=Object.keys(i);return{publishedEventIds:(t.events?.filter(n=>r.includes(n.eventId))).filter(n=>{let a=ru({event:n}),{drawDetails:s,drawIds:o}=a??{},{eventId:l}=n;return i[l].filter(c=>{let u=s?Object.keys(a.drawDetails).filter(d=>Q5({drawId:d,drawDetails:s})):[];return o?.includes(c)||u.includes(c)}).length}).map(n=>n.eventId),eventIdPublishedDrawIdsMap:i}}function XIe({dates:t=[],extension:e}){if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=qi(e.value)?e.value?.dates:void 0;if(Array.isArray(i))return i?.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function JIe({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){let n={...Et(r,t,!0),venueId:i.venueId},{extension:a}=Ci({name:bd,element:r});if(e&&a){let s=qi(a.value)?a.value?.dates:void 0,o=a?.value===!0?[]:n.dateAvailability.map(l=>{let c=l.date;if(!(!c||s.includes(c)))return l}).filter(Boolean);n.dateAvailability=o}return{inContextCourt:n}}function Pm(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},s=[],o=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:h}=Ci({name:bd,element:p});if(h?.value)continue}s.includes(p.venueId)||(c.push(Et(p,e,!0)),s.push(p.venueId));for(let h of p.courts??[])if(!o.includes(h.courtId)){if(i){let{extension:m}=Ci({name:bd,element:h});if(XIe({extension:m,dates:n}))continue}let{inContextCourt:f}=JIe({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),o.push(h.courtId)}}}),{courts:l,venues:c,...oe}}function r5e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:hn};let n=Et(e.venues??[],t).filter(s=>{if(!i)return s;let{extension:o}=Ci({name:bd,element:s});return!o?.value&&s}).filter(Boolean),a=n.reduce((s,o)=>{let l=(o?.courts||[]).filter(c=>{if(!i&&!r?.length)return c;let{extension:u}=Ci({name:bd,element:c});return XIe({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=JIe({convertExtensions:t,ignoreDisabled:i,venue:o,court:c});return u});return l.length?s.concat(l):s},[]);return{venues:n,courts:a}}function _0({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:hn}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:s}=r5e({tournamentRecord:a,dates:i});return s?.forEach(o=>{let{venueId:l,courts:c}=o;(!e||c?.length)&&!r.venueIds.includes(l)&&(r.venues.push(o),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function I7({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:et};let i=t.events||[],r=t?.participants||[],{tournamentInfo:n}=Vw({tournamentRecord:t}),{venues:a}=Pm({tournamentRecord:t}),s=i.map(o=>{let{eventId:l}=o,c=qIe({event:o}).eventInfo,u=e0({tournamentRecord:t,event:o}).scheduleTiming,d=(o.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:w,updatedAt:T})=>({matchUpFormat:w,updatedAt:T,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=MD({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:o});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=ru({event:o});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:s}}}function QIe({publishStatus:t,drawId:e}){return t?.drawDetails?t.drawDetails?.[e]?.publishingDetail?.published:t?.drawIds?t.drawIds.includes(e):!0}var ewe="PUBLIC",n5e="ADMIN",a5e={PUBLIC_DISPLAY:ewe,ADMIN_DISPLAY:n5e};function gF(t){let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:s,status:o=yc,pressureRating:l,refreshResults:c,contextProfile:u,drawDefinition:d,noDeepCopy:p,sortConfig:h,context:f,event:m}=t;if(!d)return{error:At};let g=(({matchUpFormat:k,updatedAt:x,drawType:O,drawName:V,drawId:F})=>({matchUpFormat:k,updatedAt:x,drawName:V,drawType:O,drawId:F}))(d);g.display=Ci({element:d,name:m_}).extension?.value;let v={},y,b,{allStructuresLinked:I,sourceStructureIds:w,hasDrawFeedProfile:T,structureGroups:S}=qL({drawDefinition:d});if(!I)return{error:xfe};let D=t?.eventPublishState??kw({event:m}).publishState,C=t?.publishStatus??ru({event:m,status:o}),E=D?.status?.drawDetails?.[d.drawId],P=!!D?.status?.published,R=E?.structureDetails,M=!1,A=!1,N=S.map(k=>{let x={},O=k.map(V=>{let{structure:F}=oi({drawDefinition:d,structureId:V}),{seedAssignments:j}=Hc({drawDefinition:d,structure:F});return F?.stage===Dt&&F.stageSequence===1&&(y=j),F?.stage===zt&&(v[F.stageSequence??0]=j),F}).sort((V,F)=>Dw(V,F,h)).map(V=>{if(!V)return;let F=V?.structureId,j=[];V.stage&&[Dt,ws,wn].includes(V.stage)&&(j=y),V?.stage===zt&&(j=v[V.stageSequence??0]);let{matchUps:q,roundMatchUps:W,roundProfile:z}=ar({seedAssignments:V?.seedAssignments?.length?void 0:j,context:{drawId:g.drawId,...f},hydrateParticipants:t.hydrateParticipants,participantsProfile:t.participantsProfile,tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:s,publishStatus:C,contextProfile:u,drawDefinition:d,inContext:a,structure:V,event:m}),{positionAssignments:H}=Tr({structure:V}),Z=H?.filter(xl(jh)).map(ne=>{let le=Ci({element:ne,name:nm})?.extension?.value,{drawPosition:re,participantId:me}=ne;return A=!0,{participantResult:le,participantId:me,drawPosition:re}});if(q.length&&(!Z?.length&&t.allParticipantResults||c&&!V.structures)){let{subOrderMap:ne}=dbe({positionAssignments:H}),le=q.some(me=>me.matchUpType===oc)?q.filter(me=>me.matchUpType===oc):q,re=xD({matchUpFormat:V.matchUpFormat,matchUps:le,policyDefinitions:r,pressureRating:l,subOrderMap:ne});b=re?.report,Z=H?.filter(xl(jh)).map(me=>{let{drawPosition:he,participantId:Ie}=me;return A=!0,{participantResult:Ie&&re?.participantResults?.[Ie],participantId:Ie,drawPosition:he}})}let J=V?(({stageSequence:ne,structureName:le,structureType:re,matchUpFormat:me,stage:he})=>({stageSequence:ne,structureName:le,structureType:re,matchUpFormat:me,stage:he}))(V):{},ie=Ci({element:V,name:m_}).extension?.value;J.display=ie?.[ewe]??ie,J.sourceStructureIds=w[F],J.hasDrawFeedProfile=T[F],J.positionAssignments=H,J.structureActive=q.reduce((ne,le)=>{let re=[ln,ra,ed,Tn,$p,br,wa,Fr].includes(le.matchUpStatus);return ne||re||!!le.winningSide||!!le.score?.scoreStringSide1},!1);let K=q.reduce((ne,le)=>ne&&["BYE",Tn,wa,Fr,br,sl].includes(le.matchUpStatus),!!q.length);return J.structureCompleted=K,x[F]=K,J.structureActive&&(M=!0),{...J,participantResults:Z,seedAssignments:j,roundMatchUps:W,roundProfile:z,structureId:F,report:b}});return O.forEach(V=>{i||delete V.positionAssignments,V.sourceStructuresComplete=V.sourceStructureIds?.every(F=>x[F])}),O}).flat().filter(k=>!s||R?.[k?.structureId]?.published||!0);return g.drawActive=M,g.participantPlacements=A,g.drawGenerated=N?.reduce((k,x)=>k||!!x?.roundMatchUps,!1),g.drawCompleted=N?.reduce((k,x)=>k&&x.structureCompleted,!0),g.drawPublished=s?P&&QIe({publishStatus:C,drawId:g.drawId}):void 0,{structures:!s||g.drawPublished?p&&N||Et(N,!1,!0):void 0,drawInfo:p?g:Et(g,!1,!0),...oe}}function vF(t){let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=yc,contextProfile:s,sortConfig:o}=t,l=Gt(t,[{tournamentRecord:!0},{[p5]:{event:!1,eventId:!1}}]);if(l.error)return l;let c=Et(t.tournamentRecord,!1,!0),u=t.event?void 0:Lo({tournamentRecord:c,eventId:t.eventId}).event,d=t.event?Et(t.event,!1,!0):u&&Et(u,!1,!0)||void 0;if(!d)return{error:Vc};let{eventId:p}=d,{tournamentId:h,endDate:f}=c,m=ru({event:d,status:a}),g=kw({event:d}).publishState??{},v=!!g?.status?.published,{participants:y}=un({withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:c}),b=({stage:M,drawId:A})=>{if(!n)return!0;let N=m?.drawDetails?.[A]?.stageDetails;return!N||!Object.keys(N).length?!0:N[M]?.published},I=({structureId:M,drawId:A})=>{if(!n)return!0;let N=m?.drawDetails?.[A]?.structureDetails;return!N||!Object.keys(N).length?!0:N[M]?.published},w=({drawId:M})=>n?QIe({publishStatus:m,drawId:M}):!0,T=({drawId:M,structure:A})=>{if(!n)return A;let N=m?.drawDetails?.[M]?.structureDetails?.[A.structureId]?.roundLimit;if(mi(N)){let k=yt(1,N+1),x={},O={};for(let V of k)A.roundMatchUps[V]&&(x[V]=A.roundMatchUps[V],O[V]=A.roundProfile[V]);A.roundMatchUps=x,A.roundProfile=O}return A},S=d.drawDefinitions||[],D=!n||v?S.filter(w).map(M=>(({drawInfo:A,structures:N})=>({...A,structures:N}))(gF({allParticipantResults:t.allParticipantResults,hydrateParticipants:t.hydrateParticipants,context:{eventId:p,tournamentId:h,endDate:f},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:y,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:c,usePublishState:n,contextProfile:s,drawDefinition:M,publishStatus:m,sortConfig:o,event:d}))).map(({structures:M,...A})=>{let N=M?.filter(({stage:k,structureId:x})=>I({structureId:x,drawId:A.drawId})&&b({stage:k,drawId:A.drawId})).map(k=>T({drawId:A.drawId,structure:k}));return{...A,structures:N}}).filter(M=>M.structures?.length):void 0,C=(Array.isArray(c.venues)?c.venues:[]).map(M=>(({venueData:A})=>({...A}))(aU({venueId:M.venueId,tournamentRecord:c}))),E=(({eventId:M,eventName:A,eventType:N,eventLevel:k,surfaceCategory:x,matchUpFormat:O,category:V,gender:F,startDate:j,endDate:q,ballType:W,discipline:z})=>({eventId:M,eventName:A,eventType:N,eventLevel:k,surfaceCategory:x,matchUpFormat:O,category:V,gender:F,startDate:j,endDate:q,ballType:W,discipline:z}))(d);E.display=Ci({element:d,name:m_}).extension?.value;let{tournamentInfo:P}=Vw({tournamentRecord:c}),R={tournamentInfo:P,venuesData:C,eventInfo:E,drawsData:D};return R.eventInfo.publishState=g,R.eventInfo.published=g?.status?.published,{...oe,eventData:R,participants:y}}var twe={};_i(twe,{courtGridRows:()=>SF,findVenue:()=>rf,getMatchUpsToSchedule:()=>yF,getPersonRequests:()=>tb,getProfileRounds:()=>wF,getScheduledRoundsDetails:()=>k0,getSchedulingProfile:()=>Cm,getSchedulingProfileIssues:()=>w7,publicFindCourt:()=>K5});function cU({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=ML(r);i=i??r.schedule?.timeAfterRecovery;let a=c=>{t[c]||(t[c]=[]),t[c]=yi(t[c].concat(...n))},s=c=>{i&&(!e[c]||i>e[c])&&(e[c]=i)},o=r.winnerTo?.matchUpId||r.winnerMatchUpId;o&&(i&&s(o),a(o));let l=r.loserTo?.matchUpId||r.loserMatchUpId;l&&(i&&s(l),a(l)),r.sidesTo?.length&&r.sidesTo.forEach(({matchUpId:c})=>{c&&(i&&s(c),a(c))})}function yF(t){let e=Gt(t,[{[u5]:!0}]);if(e.error)return e;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,orderedMatchUpIds:o,clearDate:l,matchUps:c}=t,u=s?Object.keys(s):[],d=(o??[]).map(h=>c.find(f=>f.matchUpId===h)).filter(Boolean).filter(h=>{let f=!l&&(r.includes(h.matchUpId)||u.includes(h.matchUpId)),m=["BYE",br,Tn,sl,wa,Fr,ln,ra].includes(h?.matchUpStatus);return n||!f&&!h.winningSide&&!m}),p=i&&a?d.reduce((h,f)=>{let{drawId:m,tournamentId:g}=f;return h.matchUpMap[g]||(h.matchUpMap[g]={}),h.matchUpMap[g][m]?h.matchUpMap[g][m].push(f):h.matchUpMap[g][m]=[f],cU({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:f}),h},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function bF({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:s,eventType:o,eventId:l}){if(!Al({matchUpFormat:r}))return{error:OR};let c=Object.keys(i).filter(d=>!s||d===s),u;return c.forEach(d=>{if(u)return;let p=i[d],h=l?Lo({tournamentRecord:p,eventId:l})?.event:void 0;return u=c0({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:h}),u?.averageMinutes||u?.recoveryMinutes}),{recoveryMinutes:u?.recoveryMinutes||t,averageMinutes:u?.averageMinutes||e,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||t}}function k0(t){let e=Gt(t,[{[p5]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Bo]:Rs}]);if(e.error)return e;let{scheduleCompletedMatchUps:i,periodLength:r=30}=t,n=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{};if(typeof n!="object")return{error:hn};let a={},s=[],o=t.rounds.toSorted((f,m)=>(f.sortOrder??0)-(m.sortOrder??0)),l=t.containedStructureIds??Object.assign({},...Object.values(n).map(f=>CD({tournamentRecord:f}).containedStructures)),c=t.matchUps??Cd({nextMatchUps:!0,tournamentRecords:n}).matchUps,u=0,d={},p={},h={};return{scheduledRoundsDetails:o.flatMap(f=>{let m=f.periodLength||r,g=[];l?.[f.structureId]?g.push(...l[f.structureId]):g.push(f.structureId);let v=c?Rf({tournamentIds:[f.tournamentId],roundNumbers:[f.roundNumber],matchUpIds:f.matchUpIds,eventIds:[f.eventId],drawIds:[f.drawId],processContext:!0,structureIds:g,matchUps:c}).sort(_w):[],{segmentNumber:y,segmentsCount:b}=f.roundSegment||{};if(mi(y)&&Dd(v?.length)&&Dd(b)&&y>0&&y<=b&&b<v?.length&&!f.matchUpIds?.length){let S=v.length/b,D=S*(y-1);v=v.slice(D,D+S)}let I=n[f.tournamentId],w=Lo({drawId:f.drawId,tournamentRecord:I}).event,T=[];for(let S of v){let D=S.matchUpFormat;D&&(a[D]||(a[D]=[],a[D].push(S)),T.push(D))}for(let S of T){let{eventType:D,category:C}=w??{},{categoryName:E,ageCategoryCode:P}=C??{},{typeChangeRecoveryMinutes:R,recoveryMinutes:M,averageMinutes:A,error:N}=bF({categoryName:E??P,categoryType:C?.categoryType,tournamentId:f.tournamentId,eventId:f.eventId,tournamentRecords:n,matchUpFormat:S,eventType:D});if(N)return{error:N,round:f};let k=v.filter(O=>(i||!la.includes(O.matchUpStatus))&&O.matchUpStatus!=="BYE").map(Pa);k.forEach(O=>{h[O]={typeChangeRecoveryMinutes:R,recoveryMinutes:M,averageMinutes:A},d[O]=M,p[O]=A}),s.push(...k),u=Math.max(A||0,u);let x=`${A}|${m}`;return{roundPeriodLength:m,recoveryMinutes:M,averageMinutes:A,matchUpIds:k,hash:x}}}),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:s,minutesMap:h,...oe}}function iwe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t?.map(o=>{let l=Ui(o?.scheduleDate);if(!l){n.push(`Invalid date: ${o?.scheduledDate}`);return}let c=(o?.venues||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!e?.includes(p)){n.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&r.includes(f.drawId);return m||n.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...o,venues:c}}).filter(Boolean),s=n.length;return{updatedSchedulingProfile:a,modifications:s,issues:n}}function IF({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Se};let{venueIds:i,tournamentsMap:r}=o5e({tournamentRecords:t}),n,a,s=e.every(o=>{let{scheduleDate:l,venues:c}=o;return tl(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=r?.[m]?.[y]?.[b]?.[g]?.includes(v);I||(a="Invalid rounds");let{segmentNumber:w,segmentsCount:T}=f||{},S=!f||mi(w)&&Dd(T)&&w<=T;return S||(a="Invalid segment"),I&&S}):(n=yw,!1):(a="rounds should be an array",!1)}):!1});return!s&&!n&&(n=Se),{valid:!!s,error:n,info:a}}function s5e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],s=[],o=[],l=(e?.venues||[]).map(({venueId:u,courts:d})=>(!r||d?.length)&&u),c=e?.tournamentId;if(c){n.push(c),i[c]={};let u=e?.events||[];for(let d of u){let p=d.eventId;s.push(p),i[c][p]={};let h=f=>parseInt(f);for(let f of d.drawDefinitions||[]){let m=f.drawId;o.push(m),i[c][p][m]={};let{structures:g}=Wu({drawDefinition:f});for(let v of g||[]){let y=v.structureId,{matchUps:b}=ar({structure:v}),{roundMatchUps:I}=vo({matchUps:b}),w=I&&Object.keys(I).map(h);if(i[c][p][m][y]=w,a.push(y),v.structures?.length)for(let T of v.structures)a.push(T.structureId),i[c][p][m][T.structureId]=w}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:s,drawIds:o}}function o5e(t){let e=t?.tournamentRecords&&Object.values(t?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:s,tournamentIds:o}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=s5e({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:o,structureIds:s,venueIds:r,eventIds:n,drawIds:a}}function Cm({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let{extension:i}=Ci({element:e,name:UI,tournamentRecords:t,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:n}=_0({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:s}=A6({tournamentRecords:t}),{updatedSchedulingProfile:o,modifications:l,issues:c}=iwe({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:s});if(l){r=o;let u=LD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function LD({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=IF({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?nr({tournamentRecords:t,discover:!0,extension:{name:UI,value:i}}):uo({element:e,name:UI,tournamentRecords:t,discover:!0})}function O0(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=Cm({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=_0({tournamentRecords:i}),{eventIds:n,drawIds:a}=A6({tournamentRecords:i}),{updatedSchedulingProfile:s,modifications:o,issues:l}=iwe({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return o?{...LD({schedulingProfile:s,tournamentRecords:i}),modifications:o,issues:l}:{...oe,modifications:o,issues:l}}function w7(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:AR};if(!Array.isArray(e))return{error:Se};if(!e.every(tl))return{error:Ba};let n=[],a=0,s={},{schedulingProfile:o}=Cm({tournamentRecords:i});if(!o)return{issues:n,...oe};let{matchUps:l}=Cd({nextMatchUps:!0,tournamentRecords:i});for(let u of o){let{scheduleDate:d,venues:p=[]}=u;if(!e?.length||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=k0({tournamentRecords:i,periodLength:r,matchUps:l,rounds:f}),{matchUpDependencies:y}=id({tournamentRecords:i,matchUps:l}),b=I=>{let w;return v?.find((T,S)=>{let D=T.matchUpIds.includes(I);return D&&(w=S),D}),w};if(g?.forEach((I,w)=>{let T=g.slice(w+1),S=En(T,y?.[I]?.matchUpIds||[]);S.length&&m.push({matchUpId:I,shouldBeAfter:S})}),m.length){a+=m.length;let I=m.map(({matchUpId:w,shouldBeAfter:T})=>{let S=b(w),D=yi(T.map(b));return s[d]||(s[d]={}),s[d][S]||(s[d][S]=[]),D.forEach(C=>{s[d][S].includes(C)||s[d][S].push(C)}),{matchUpId:w,matchUpRoundIndex:S,earlierRoundIndices:D,shouldBeAfter:T}});n.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:s,...oe}}function tb(t){let{tournamentRecords:e,requestType:i}=t,r=Gt(t,[{[Fs]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:s}=Ci({element:a,name:ED}),o=s?.value||[];for(let l of o){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...oe}}function Oj(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:s,eventId:o,drawId:l}=t,c=r?e:s,u=[n,o,l,c,a].join("|");return Ft({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:o,drawId:l,id:u})}function nX({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:s,categoryType:o}=n||{},{categoryName:l,ageCategoryCode:c}=s||{},u=Nl(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=bF({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:o,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function l5e(t){return(t||[]).reduce((e,i)=>{let r=(i.finishingPositionRange?.winner||[]).reduce((a,s)=>a+s,0),n=(i.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function aX(t){let e=t.length,i=t.filter(({sides:c})=>c?.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||la.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>c?.scheduledDate&&c?.scheduledTime&&u!=="BYE").length||0,a=e-i,s=a===r,o=a-n,l=a-n;return{unscheduledCount:o,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:s,byeCount:i}}function wF({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:AR};t={[i.tournamentId]:i}}if(e){let a=IF({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=Cm({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:za};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:s})=>a.map(({rounds:o})=>o.map(l=>{let c=Oj(l);return c.roundSegment?.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Ft({id:r?c.id:void 0,scheduleDate:s,...c})}))).flat(1/0),segmentedRounds:n}}function SF({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Se};let r=i?.reduce((s,o)=>{let l=o.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>s?c:s},1),n=e?Math.max(e,r):r,a=yt(0,n).map(s=>({matchUps:yt(0,i.length).map(o=>{let l=i[o],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:s+1,venueId:u,courtId:c}}})}));return i.forEach((s,o)=>{for(let l of s.matchUps){let c=l.schedule?.courtOrder;c&&(a[c-1].matchUps[o]=l)}}),{courtPrefix:t,rows:a.map((s,o)=>Object.assign({rowId:`rowId-${o+1}`},...s.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}var rwe={};_i(rwe,{getEntriesAndSeedsCount:()=>TF,getMaxEntryPosition:()=>S7});function TF({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Lr};let{entries:s,stageEntries:o}=hye({drawDefinition:e,drawId:r,stage:a,event:n}),l=o.length,{drawSize:c}=Fbe({participantsCount:l}),u=N0({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ue({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:s,seedsCount:d,stageEntries:o}}function S7(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>ri(n||0)),0)}var nwe={};_i(nwe,{allCompetitionMatchUps:()=>Cd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allTournamentMatchUps:()=>Wa,analyzeMatchUp:()=>xC,calculateWinCriteria:()=>jw,checkMatchUpIsComplete:()=>Vv,competitionScheduleMatchUps:()=>L0,drawMatchUps:()=>_7,eventMatchUps:()=>DF,filterMatchUps:()=>Rf,getAllDrawMatchUps:()=>qn,getAllStructureMatchUps:()=>ar,getCheckedInParticipantIds:()=>Mw,getCompetitionMatchUps:()=>OC,getEventMatchUpFormatTiming:()=>U7,getHomeParticipantId:()=>C7,getMatchUpCompetitiveProfile:()=>l0,getMatchUpContextIds:()=>R7,getMatchUpDailyLimits:()=>PF,getMatchUpDailyLimitsUpdate:()=>D7,getMatchUpDependencies:()=>id,getMatchUpFormat:()=>M7,getMatchUpFormatTiming:()=>c0,getMatchUpFormatTimingUpdate:()=>T7,getMatchUpScheduleDetails:()=>FL,getMatchUpType:()=>BL,getMatchUpsStats:()=>N7,getModifiedMatchUpFormatTiming:()=>UF,getParticipantResults:()=>D0,getPredictiveAccuracy:()=>P7,getRoundMatchUps:()=>vo,getRounds:()=>A7,isValidMatchUpFormat:()=>Al,matchUpActions:()=>tF,participantScheduledMatchUps:()=>E7,tallyParticipantResults:()=>xD,tournamentMatchUps:()=>EF,validMatchUp:()=>_L,validMatchUps:()=>iu});function awe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let i=[],r;for(let n of Object.values(t)){let{extension:a}=Ci({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let s=n.events??[];for(let o of s){let{eventId:l}=o,{extension:c}=Ci({name:e,element:o});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function T7({tournamentRecords:t}){return awe({extensionName:rm,tournamentRecords:t})}var mB="ADULT",gB="JUNIOR",CM="WHEELCHAIR",swe={[Wg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[mr]:30,default:60}}]},defaultDailyLimits:{[wr]:2,[mr]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[_u],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[CM],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[mB,CM],minutes:{default:60,[mr]:30}},{categoryTypes:[gB],minutes:{default:60,[mr]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[mB,CM],minutes:{default:30}},{categoryTypes:[gB],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[mB,gB],minutes:{default:30}},{categoryTypes:[CM],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},c5e=swe;function U7({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Lr};let n=[],a;if(e?.length){let d=[];n=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h?.matchUpFormat)&&Al({matchUpFormat:h?.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Yy({policyType:Gc,tournamentRecord:t,event:r});if(d?.matchUpFormats)n=d?.matchUpFormats;else{let{extension:p}=Ci({name:rm,element:r}),h,f;p?.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=c5e[Wg],n=yi([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:s,eventId:o,category:l}=r,c=l?.categoryName??l?.ageCategoryCode??o;if(!o)return{error:Lr};let u=n.map(({matchUpFormat:d,description:p})=>{let h=c0({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:s,event:r});return{matchUpFormat:d,description:p,...h}});return Ft({eventMatchUpFormatTiming:u,info:a})}function UF(t){let e=Gt(t,[{[pa]:!0},{[hs]:m=>Al({matchUpFormat:m}),[uc]:OR,[o5]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=Ci({name:rm,element:n}),s=a?.value,{extension:o}=Ci({element:i,name:rm}),l=o?.value,c=s?.matchUpAverageTimes&&iP({...s,matchUpFormat:r}),u=l?.matchUpAverageTimes&&iP({...l,matchUpFormat:r}),d=[c,u].find(m=>m),p=s?.matchUpRecoveryTimes&&rP({...s,matchUpFormat:r}),h=l?.matchUpRecoveryTimes&&rP({...l,matchUpFormat:r}),f=[p,h].find(m=>m);return{matchUpFormat:r,recoveryTimes:f,averageTimes:d}}function D7({tournamentRecords:t}){return awe({extensionName:KR,tournamentRecords:t})}var x0=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function E7({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!iu(e))return{error:wm};if(!Array.isArray(t))return{error:Se};let i=e.filter(Boolean).filter(({schedule:r})=>x0({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,s=Ui(a?.scheduledDate),o=zr(a?.scheduledTime);return s&&o&&(r[s]?r[s].push(n):r[s]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>Wme(zr(n.schedule?.scheduledTime),zr(a.schedule?.scheduledTime)))}),{...oe,scheduledMatchUps:i}}function u5e({tournamentRecords:t}){let e={},i=[];for(let r of Object.values(t))for(let n of r.events??[]){let a=ru({event:n}),s=a?.drawDetails;qi(s)?(Object.assign(e,s),i.push(...Object.keys(s).filter(o=>Q5({drawId:o,drawDetails:s})))):a?.drawIds?.length&&i.push(...a.drawIds)}return{drawIds:i,detailsMap:e}}function A_({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:o,drawId:l,structureId:c,roundNumber:u})=>`${o}|${l}|${c}${u}`;t?.length&&t.map(({venues:o})=>o.map(({rounds:l})=>l)).flat().forEach(o=>{o.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let n=[],a={noScheduledDate:[]};for(let o of e){let l=o.schedule||{},c=l.scheduledDate&&Ui(l.scheduledDate)||l.scheduledTime&&Ui(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(o)}let s=Object.keys(a).sort();for(let o of s){let l=a[o],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&zr(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}for(let d of Object.keys(c)){let p=c[d].sort((h,f)=>(h.roundNumber||0)-(f.roundNumber||0));c[d]=p}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[r(h)]||0,g=i[r(f)]||0;return m-g}),n.push(...p)}}return n}function DF(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Lr};let{eventId:I,eventName:w,endDate:T,eventType:S,category:D,gender:C}=b??{},E={...y,...Ft({surfaceCategory:b.surfaceCategory??u?.surfaceCategory,indoorOutDoor:b.indoorOutdoor??u?.indoorOutdoor,tournamentId:g??u?.tournamentId,endDate:T??u?.endDate,eventName:w,eventType:S,category:D,eventId:I,gender:C})},P;!e&&u&&({participants:e,participantMap:r,groupInfo:P}=Wy({participantsProfile:s,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Dm({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let R=ru({event:b});return{...(b.drawDefinitions??[]).reduce((M,A)=>{let N=MD({hydrateParticipants:t.hydrateParticipants,context:E,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:s,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:r,publishStatus:R,contextProfile:f,drawDefinition:A,nextMatchUps:m,inContext:v,event:b});return Object.keys(N)?.forEach(k=>{Array.isArray(N[k])&&(M[k]||(M[k]=[]),M[k]=M[k].concat(N[k]))}),M},{}),...oe,groupInfo:P}}function EF(t){if(!t?.tournamentRecord)return{error:et};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,inContext:o=!0,usePublishState:l,contextFilters:c,matchUpFilters:u,contextProfile:d,nextMatchUps:p,context:h}=t,f=t.tournamentId??s.tournamentId,m=s?.events??[],{participants:g,participantMap:v,groupInfo:y}=Wy({participantsProfile:r,tournamentRecord:s,contextProfile:d,inContext:o});d&&!e&&(e=Dm({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));let{appliedPolicies:b}=er({tournamentRecord:s}),I=c?.eventIds??[];return{...m.filter(w=>!I.includes(w.eventId)).map(w=>{let T={eventDrawsCount:Rn({event:w}).flightProfile?.flights?.length||w.drawDefinitions?.length||0,...h};return DF({hydrateParticipants:t.hydrateParticipants,context:T,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextProfile:d,contextContent:e,matchUpFilters:u,participantMap:v,participants:g,tournamentId:f,nextMatchUps:p,inContext:o,event:w})}).reduce((w,T)=>((T&&Object.keys(T).filter(S=>!["success","matchUpsMap"].includes(S)))?.forEach(S=>{Array.isArray(T[S])&&(w[S]||(w[S]=[]),w[S]=w[S].concat(T[S]),w.matchUpsCount!==void 0?w.matchUpsCount+=T[S].length:w.matchUpsCount=T[S].length)}),w),{matchUpsCount:0}),groupInfo:y,participants:g}}function OC({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u}){if(typeof r!="object"||!Object.keys(r).length)return{error:hn};let d=Object.keys(r).map(f=>{let m=r[f];return EF({scheduleVisibilityFilters:t,hydrateParticipants:e,participantsProfile:i,policyDefinitions:a,tournamentRecord:m,usePublishState:s,matchUpFilters:o,contextFilters:l,nextMatchUps:c,inContext:u})}),p={},h={};return{...d.reduce((f,m)=>(Object.keys(m).forEach(g=>{if(g==="groupInfo")Object.assign(h,m[g]);else if(g==="participants")for(let v of m[g]??[])p[v.participantId]=v;else Array.isArray(m[g])&&(f[g]||(f[g]=[]),f[g]=f[g].concat(m[g]))}),f),{}),groupInfo:h,mappedParticipants:p}}function L0(t){if(typeof t?.tournamentRecords!="object"||!Object.keys(t?.tournamentRecords).length)return{error:hn};let{courts:e,venues:i}=Pm(t),r=Cm(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:s,activeTournamentId:o,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=yc,sortCourtsData:h}=t,f=o??bw()??Object.keys(l)[0],m=d?m0({tournamentRecord:l[f],status:p}):void 0,g=s?OC({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Tn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!m?.orderOfPlay?.published)return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,y;d&&({drawIds:v,detailsMap:y}=u5e({tournamentRecords:l})),v?.length&&(t.contextFilters||(t.contextFilters={}),t.contextFilters?.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(M=>v.includes(M)):t.contextFilters.drawIds=v),m?.eventIds?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(M=>m.eventIds.includes(M)):t.matchUpFilters.eventIds=m.eventIds),m?.scheduledDates?.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(M=>m.scheduledDates.includes(M)):t.matchUpFilters.scheduledDates=m.scheduledDates),s&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters?.excludeMatchUpStatuses?.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Tn)||t.matchUpFilters.excludeMatchUpStatuses.push(Tn):t.matchUpFilters.excludeMatchUpStatuses=[Tn]);let{completedMatchUps:b,upcomingMatchUps:I,pendingMatchUps:w,groupInfo:T,mappedParticipants:S}=OC({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),D=[...I??[],...w??[]];y&&(!v?.length||Object.keys(y).length)&&(D=D.filter(M=>{let{drawId:A,structureId:N,stage:k}=M;if(!y?.[A]?.publishingDetail?.published)return!1;let x=Object.keys(y[A].stageDetails??{});if(x.length){let V=x.filter(j=>!y[A].stageDetails[j].published),F=x.filter(j=>y[A].stageDetails[j].published);return V.length&&V.includes(k)?!1:F.length&&F.includes(k)?!0:V.length&&!V.includes(k)&&!F.length}let O=Object.keys(y[A].structureDetails??{});if(O.length){let V=O.filter(j=>!y[A].structureDetails[j].published),F=O.filter(j=>y[A].structureDetails[j].published);return V.length&&V.includes(N)?!1:F.length&&F.includes(N)?!0:V.length&&!V.includes(N)&&!F.length}return!0}));let C=n?A_({matchUps:D,schedulingProfile:r}):D,E=e?.map(M=>{let A=R(M);return{surfaceCategory:M?.surfaceCategory??"",matchUps:A,...M}}),P={completedMatchUps:s?g:b,mappedParticipants:t.hydrateParticipants?void 0:S,dateMatchUps:C,courtsData:E,groupInfo:T,venues:i};if(c){let{rows:M,courtPrefix:A}=SF({minRowsCount:u,courtsData:E});P.courtPrefix=A,P.rows=M}return{...P,...oe};function R({courtId:M}){let A=(a?C.concat(b??[]):C).filter(N=>N.schedule?.courtId===M||N.schedule?.allocatedCourts?.map(({courtId:k})=>k).includes(M));return h?A_({matchUps:A,schedulingProfile:r}):A}}function PF({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:hn};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:s}=d5e({tournamentRecord:a});r=s}),{matchUpDailyLimits:r}}function d5e(t){let e=Gt(t,[{[pa]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=Yy({policyType:Wg,tournamentRecord:i}),{extension:n}=Ci({element:i,name:KR}),a=n?.value?.dailyLimits,s=r?.defaultDailyLimits;return{matchUpDailyLimits:a||s}}function P7(t){let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:s,zoneDoubling:o,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!r&&!e)return{error:et};if(l&&![wr,mr].includes(l))return{error:Se,info:{matchUpType:l}};if(e&&!iu(e))return{error:Se,context:{matchUps:e}};let f=Da[c],m=f?.ascending??t.ascending??!1,g=f?.accessor??t.valueAccessor,v=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,y=mi(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[wr,mr]},w=r?.participants;e?.[0]?.hasContext?p?e=e.filter(A=>A.drawId===p):u&&(e=e.filter(A=>A.eventId===u)):e===void 0&&(e=p&&!n&&[]||!p&&u&&!h&&[]||p&&po({inContext:!0,drawDefinition:n,contextFilters:I,contextProfile:b,participants:w})?.matchUps||!p&&u&&nf({inContext:!0,contextFilters:I,contextProfile:b,participants:w,event:h})?.matchUps||Wa({tournamentRecord:r,contextFilters:I,contextProfile:b})?.matchUps||[]),l&&(e=e.filter(A=>A.matchUpType===l));let T=e.filter(({winningSide:A,score:N,sides:k,matchUpStatus:x})=>![wa,br,Fr,PD,sl].includes(x??"")&&ua({score:N})&&k?.length===2&&A),S=h5e({matchUps:T,excludeMargin:a,exclusionRule:s,valueAccessor:g,ascending:m,scaleName:c}),D=!o||On(wr)(l)?y:(y||0)*2,C=y?T.map(({competitiveProfile:A,matchUpType:N,score:k,sides:x})=>{let O=owe({singlesForDoubles:i,valueAccessor:g,matchUpType:N,scaleName:c,sides:x}),V=Math.abs(O[0].value-O[1].value);return{competitiveness:A?.competitiveness,valuesGap:V,score:k}}).filter(({valuesGap:A})=>A<=D):[],E=p5e({zoneData:C}),P=E&&[].concat(Object.values(E)).flat().length,R=P&&Object.assign({},...Object.keys(E).map(A=>({[A]:Math.round(1e4*E[A].length/P)/100}))),M=T.length-(C?.length||0);return{...oe,relevantMatchUps:T,zoneDistribution:R,zoneData:C,accuracy:S,nonZone:M}}function p5e({zoneData:t}){let e={[B5]:[],[PC]:[],[CC]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function owe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let s=e?.range.sort(),o=l=>{let c=l?.[e?.valueAccessor];return{exclude:e&&c>=s[0]&&c<=s[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l?.individualParticipants;if(u?.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=sX({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=o(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=sX({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:h,exclusionValue:f}=o(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function sX({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){let a=t?wr:i,s=r?.rankings?.[a]?.find(c=>c.scaleName===n),o=(r?.ratings?.[a]?.find(c=>c.scaleName===n)||s)?.scaleValue,l=e?o?.[e]:o;return{scaleValue:o,value:l}}function h5e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let s={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Yt};let f=h-1,m=owe({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:n,sides:d});if(e){let w=m.map(({exclusionValues:T})=>T).flat();if(w.length){s.excluded.push({scoreString:p?.scoreStringSide1,exclusionValues:w,winningSide:h,sideValues:m});continue}}if(m.filter(w=>![void 0,"",null].includes(w.value)).length<2){s.excluded.push({scoreString:p?.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){s.excluded.push({scoreString:p?.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=r?g:g*-1,I=h===1?p?.scoreStringSide1:p?.scoreStringSide2;b>0?s.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):s.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let o=s.affirmative.length+s.negative.length,l=o&&s.affirmative.length/o*100;return s.percent=l?Math.round(100*l)/100:0,s}function jw({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=hbe({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:s,collectionGroupNumber:o,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=o&&r.includes(o);if(mi(p||d))n=!0;else{if(h)continue;if(typeof l=="number"&&mi(l))i+=l;else if(Array.isArray(s)&&s?.length)for(let f of s)i+=f.matchUpValue;else typeof u=="number"&&mi(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...oe}:{valueGoal:Math.floor(i/2)+1,...oe}}function C7(t){let{timeStamp:e,schedule:i,matchUp:r}=t,n=Gt(t,[{[ef]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:s}=Xy({timeItems:r?.timeItems||[],itemType:z5});return!i||s&&e&&new Date(s).getTime()>new Date(e).getTime()?{homeParticipantId:a}:i}function R7({matchUps:t,matchUpId:e}){if(!iu(t))return{error:Se};let i=t.find(o=>o.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:s}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:s}}function FD(t,e){if(!qi(t))return{error:Se};if(!Array.isArray(e))return{error:Se};let i={};for(let{param:r,error:n,attr:a}of e){let s=f5e({params:t,param:r,attr:a,error:n});if(s?.error)return s;i[r]=s}return i}function f5e({params:t,param:e,attr:i,error:r}){if(e===vL&&qi(t.drawDefinition)&&Yr(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===ef){let n=KIe({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:za,info:{param:e}}}function M7(t){let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=Gt(t,[{[pa]:!0},{[p5]:{[fL]:!1,[Fp]:!1,[qge]:!1,[Tm]:!1}}]);if(a[ku])return a;let s=FD(t,[{[TD]:ef,[ku]:Yt}])?.matchUp;if(i&&s?.error)return s;!n&&s?.drawDefinition&&(n=s?.drawDefinition);let o=s?.structure;if(!o&&e&&!i){if(!n)return{error:Nd};let p=oi({drawDefinition:n,structureId:e});if(p.error)return p;o=p.structure}let l=o?.matchUpFormat,c=n?.matchUpFormat,u=r?.matchUpFormat,d=s?.matchUp?.matchUpFormat||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function N7({profileBands:t,tournamentRecord:e,matchUps:i}){if(!iu(i))return{error:wm};let r=!t&&Yy({policyType:Cf,tournamentRecord:e}).policy,n=t||r?.profileBands||$5[Cf].profileBands,a=i.filter(({winningSide:p})=>p),s=a.map(kve),o=(p,h)=>{let f=_ve(h,n);return p[f]+=1,p},l=Ove(s).reduce((p,h)=>o(p,h),{[B5]:0,[PC]:0,[CC]:0,[Pve]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===MZ).length;return u.push({[MZ]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...oe}}var{stageOrder:oX}=jGe;function m5e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(oX[t?.stage]||0)-(oX[e?.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function A7({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:s,withSplitRounds:o,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:Se,inContextMatchUps:r};if(s&&!n){if(typeof s!="object")return{error:AR};n={[s.tournamentId]:s}}let h=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||o))&&h)return{error:hn};let f=Object.assign({},...Object.values(n??{}).map(({venues:T=[],tournamentId:S})=>({[S]:T?.map(({venueId:D})=>D)}))),m=Object.values(n??{}).map(({events:T=[],tournamentId:S,startDate:D,endDate:C})=>T.map(E=>({...E,validVenueIds:f[S],startDate:E.startDate??D,endDate:E.endDate??C}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||o)&&wF({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(T=>({[T.id]:T}))),b=r||n&&Cd({tournamentRecords:n,matchUpFilters:l})?.matchUps||[],I=[],w=b&&Object.values(b.reduce((T,S)=>{let D=Oj(S).id,C=g?.[D],E=[...T[D]?.matchUps??[],S],{containerStructureId:P,stageSequence:R,structureName:M,tournamentId:A,isRoundRobin:N,matchUpType:k,roundNumber:x,roundOffset:O,structureId:V,eventName:F,roundName:j,drawName:q,eventId:W,drawId:z}=S,H=N?P:V;return{...T,[D]:{id:u?D:void 0,structureId:H,stageSequence:R,segmentsCount:C,structureName:M,tournamentId:A,matchUpType:k,roundNumber:x,roundOffset:O,eventName:F,roundName:j,drawName:q,matchUps:E,eventId:W,drawId:z}}},{})).map(T=>{let{minFinishingSum:S,winnerFinishingPositionRange:D}=l5e(T.matchUps),C=T.segmentsCount;if(C){let x=T.matchUps.length/C;return Ra(T.matchUps.sort((O,V)=>O.roundPosition-V.roundPosition),x).map((O,V)=>{let{unscheduledCount:F,incompleteCount:j,matchUpsCount:q,isScheduled:W,isComplete:z,byeCount:H}=aX(O),Z=nX({matchUps:T.matchUps,tournamentRecords:n,events:m,round:T});return Ft({...T,...p,roundSegment:{segmentsCount:C,segmentNumber:V+1},winnerFinishingPositionRange:D,unscheduledCount:F,incompleteCount:j,minFinishingSum:S,matchUpsCount:q,isScheduled:W,roundTiming:Z,isComplete:z,byeCount:H,matchUps:O})})}let{unscheduledCount:E,incompleteCount:P,matchUpsCount:R,isScheduled:M,isComplete:A,byeCount:N}=aX(T.matchUps),k=nX({matchUps:T.matchUps,tournamentRecords:n,events:m,round:T});return Ft({...T,...p,winnerFinishingPositionRange:D,unscheduledCount:E,incompleteCount:P,minFinishingSum:S,matchUpsCount:R,isScheduled:M,roundTiming:k,isComplete:A,byeCount:N})}).flat().filter(T=>{if(t){let V=Ui(t),F=u?T.id:Oj(T).id;if(V&&y[F]&&Ui(y[F].scheduleDate)===V)return!1}let{isComplete:S,isScheduled:D}=T,C=!i||!S,E=!e||!D,P=d||c?m?.find(({eventId:V})=>V===T.eventId):void 0,R=P?.startDate??s?.startDate,M=P?.endDate??s?.endDate,A=!c||!R||new Date(c)>=new Date(R),N=!c||!M||new Date(c)<=new Date(M),k=A&&N,x=!d||P?.validVenueIds.includes(d),O=C&&E&&x&&k;return O||I.push(T),O}).sort(m5e)||[];return{...oe,rounds:w,excludedRounds:I}}function xC(t){let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:s}=t||{};if(!e)return{error:ko};s=s||e?.matchUpFormat;let o=js(s),l=!!e?.winningSide,c=e.score?.sets,u=c?.length,d=r&&r-1,p=!!c?.find((H,Z)=>H.setNumber===r&&Z===d),h=c?.filter(H=>H?.winningSide)||[],f=h?.length||0,m=r&&c?.slice(r)||[],g=!!(u&&r&&m?.reduce((H,Z)=>(!Z||!Z.side1Score&&!Z.side2Score&&!Z.side1TiebreakScore&&!Z.side2TiebreakScore&&!Z.side1PointScore&&!Z.side2PointScore)&&H,!0)),v=r<=u&&c.find(H=>H.setNumber===r),y=v&&kC({setObject:v,matchUpScoringFormat:o}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:w}=y||{},T=!!(v&&!b&&g||r&&r===u+1&&!l),S=[1,2].includes(i),D=S?i-1:0,C=v&&S&&(!n&&!a&&I[D]!==void 0&&I[D]||n&&w[D]!==void 0&&w[D]),E=!!C,P=h?.map(H=>kC({setObject:H,matchUpScoringFormat:o}).isValidSetOutcome).reduce((H,Z)=>H&&Z,!0),R=h.reduce((H,Z)=>{let{winningSide:J}=Z,ie=J-1;return H[ie]++,H},[0,0]),M=e?.winningSide,A=M&&M-1,N=1-A,k=R[A],x=R[N],O=Math.max(...R),V=Nl(R)[O],{bestOf:F,exactly:j}=o??{},q=F&&Math.ceil(F/2)||j||1,W=O===q&&V===1&&R.indexOf(O)+1||void 0,z=k>x&&M===W;return{completedSetsHaveValidOutcomes:P,validMatchUpWinningSide:z,calculatedWinningSide:W,matchUpScoringFormat:o,validMatchUpOutcome:W&&P&&z,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:E,existingValue:C,isExistingSet:p,isActiveSet:T,...y}}function _7({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:s,tournamentRecord:o,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:w,eventName:T,endDate:S,eventType:D,category:C,gender:E}=I??{},P={...b,...Ft({surfaceCategory:I?.surfaceCategory??o?.surfaceCategory,indoorOutDoor:I?.indoorOutdoor??o?.indoorOutdoor,endDate:S??I?.endDate??o?.endDate,tournamentId:v??o?.tournamentId,eventName:T,eventType:D,category:C,eventId:w,gender:E})},R;return!t?.length&&o&&({participants:t,participantMap:p,groupInfo:R}=Wy({participantsProfile:r,useParticipantMap:s,tournamentRecord:o,contextProfile:f,inContext:y})),I&&f&&!u&&(u=Dm({policyDefinitions:a,tournamentRecord:o,contextProfile:f,drawDefinition:m,event:I})),{...MD({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var lwe={};_i(lwe,{getCompetitionVenues:()=>_0,getCourts:()=>k7,getVenuesAndCourts:()=>Pm,publicFindVenue:()=>Y5});function k7({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Et(r.courts||[]);return a.forEach(s=>Object.assign(s,{venueId:n})),a}).flat()}:{error:et}}var cwe={};_i(cwe,{categoryCanContain:()=>jR,getCategoryAgeDetails:()=>bI,getEvent:()=>L7,getEventProperties:()=>O7,getEventStructures:()=>zL,getEventTimeItem:()=>QR,getEvents:()=>x7,getFlightProfile:()=>Rn,getScaledEntries:()=>$w});function O7({tournamentRecord:t,event:e}){if(!t)return{error:et};if(!e)return{error:Lr};let i=e.entries||[],r=t.participants||[],n=e.category?.categoryName||e.category?.ageCategoryCode,{eventType:a}=e,s=i.map(d=>d.participantId),o=r.filter(d=>s.includes(d.participantId)),l,c,u;return{entryScaleAttributes:o.map(d=>{let{participantId:p,participantName:h,name:f}=d,m={scaleType:W5,eventType:a,scaleName:n},g=yh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Hve,eventType:a,scaleName:n};let v=yh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;m={scaleType:Gve,eventType:a,scaleName:n};let y=yh({participant:d,scaleAttributes:m})?.scaleItem?.scaleValue;return l=!!(l||g),c=!!(c||v),u=!!(u||y),{participantId:p,participantName:h||f,seed:g,ranking:v,rating:y}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function x7({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:s}){if(!t)return{error:et};let{tournamentId:o}=t,l=(t.events??[]).filter(({eventId:u})=>!n||Array.isArray(n)&&n.includes(u)).map(u=>{let d=u.drawDefinitions?.map(DC);if(a?.length&&!En(a,d).length)return;let p=Et(u);return r&&Object.assign(p,{tournamentId:o}),s&&Object.assign(p,s),p}).filter(Boolean),c={};if(e){let u=un({withScaleValues:!0,tournamentRecord:t}).participantMap,d=p=>p.reduce((h,f)=>h+parseFloat(f),0);for(let p of l){let h=i??p.eventType,f=p.eventId;c[f]||(c[f]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let m=(p.entries??[]).filter(({entryStatus:T})=>td.includes(T)).map(Fi),g=T=>{if(T?.ratings?.[h])for(let S of T?.ratings?.[h]??[]){let D=S.scaleName;c[f].ratings[D]||(c[f].ratings[D]=[]);let C=Da[D]?.accessor;if(C){let E=parseFloat(S.scaleValue?.[C]);E&&c[f].ratings[D].push(E)}}if(T?.rankings?.[h])for(let S of T?.rankings?.[h]??[]){let D=S.scaleName;c[f].ranking[D]||(c[f].ranking[D]=[]),S.scaleValue&&c[f].ranking[D].push(S.scaleValue)}};for(let T of m){let S=u?.[T]?.participant;if(S?.participantType!==Bi)for(let D of S?.individualParticipantIds??[]){let C=u?.[D]?.participant;g(C)}else g(S)}let v=c[f].ratings;for(let T of Object.keys(v)){let S=v[T];if(!S.length)continue;let D=bZ(S)?.toFixed(2);c[f].ratingsStats[T]={avg:parseFloat((d(S)/S.length).toFixed(2)),median:D?parseFloat(D):void 0,max:Math.max(...S),min:Math.min(...S)}}let y=(T,S)=>{let D=C=>{if(c[f].draws?.[T]&&C?.ratings?.[h])for(let E of C?.ratings?.[h]??[]){let P=E.scaleName;c[f].draws[T]?.ratings[P]||(c[f].draws[T].ratings[P]=[]);let R=Da[P]?.accessor;if(R){let M=parseFloat(E.scaleValue?.[R]);M&&c[f].draws[T].ratings[P].push(M)}}if(c[f].draws?.[T]&&C?.rankings?.[h])for(let E of C?.rankings?.[h]??[]){let P=E.scaleName;c[f].draws[T]?.ranking[P]||(c[f].draws[T].ranking[P]=[]);let R=E.scaleValue;R&&c[f].draws[T].ranking[P].push(R)}};for(let C of S.filter(Boolean)){let E=u?.[C]?.participant;if(E?.participantType!==Bi)for(let P of E?.individualParticipantIds??[]){let R=u?.[P]?.participant;D(R)}else D(E)}},b=[],I=T=>a?.length&&a.includes(T)||b.includes(T);for(let T of p.drawDefinitions??[]){let S=T.drawId;if(I(S))continue;let D=Jy({drawDefinition:T}).assignedParticipantIds??[];c[f].draws[S]||(c[f].draws[S]={ratingsStats:{},ratings:{},ranking:{}}),b.push(S),y(S,D)}let w=Rn({event:p}).flightProfile;for(let T of w?.flights??[]){let S=T.drawId;if(I(S))continue;let D=T.drawEntries.map(Fi);y(S,D)}for(let T of b){let S=c[f].draws[T].ratings;for(let D of Object.keys(S)){let C=S[D];if(!C.length)continue;let E=bZ(C)?.toFixed(2);c[f].draws[T].ratingsStats[D]={avg:parseFloat((d(C)/C.length).toFixed(2)),median:E?parseFloat(E):void 0,max:Math.max(...C),min:Math.min(...C)}}}}}return Ft({eventScaleValues:c,events:l,...oe})}function L7({tournamentRecord:t,drawDefinition:e,context:i,event:r}){if(!t)return{error:et};if(!r)return{error:Lr};let n=Et(r);i&&Object.assign(n,i);let a=e&&n.drawDefinitions?.find(({drawId:s})=>e.drawId===s);return Ft({drawDefinition:a,event:n})}function g5e(t){let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=b5e(t),n=I5e({...t,policyDefinitions:r,appliedPolicies:i}),a=y5e(t),s=w5e({...t,consideredEntries:a,appliedPolicies:i});if(s?.error)return ue({result:s,stack:e});let o=S5e({...t,consideredEntries:a}),l=v5e({...t,appliedPolicies:i,policyDefinitions:r,drawSize:o});if(l.error)return ue({result:l,stack:e});let c=l.drawType;if(isNaN(o)&&c!==kl)return ue({result:{error:kR},stack:e});let u=r?.[Iu]??i?.[Iu],d=t.seedingProfile??u?.seedingProfile?.drawTypes?.[c??""]??u?.seedingProfile;t.seedingProfile&&(r[Iu]||(r[Iu]={...kj[Iu]}),r[Iu].seedingProfile=d);let p=T5e({...t,drawType:c});return p?.error?ue({result:p,stack:e}):{drawSize:o,drawType:c,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function v5e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??M0({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),s=$be({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return s.error?s:{drawType:s.drawType}}function uwe(t){return t?.filter(e=>e.entryStatus&&[...td,s0].includes(e.entryStatus))}function y5e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||uwe(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Dt)}function b5e(t){let{tournamentRecord:e,event:i}=t,r={...t?.appliedPolicies,...er({tournamentRecord:e,event:i}).appliedPolicies??{}},n=Et(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function I5e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){return t??e?.[Va]?.participants?.enforceGender??i?.[Va]?.participants?.enforceGender}function w5e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:s,event:o}=t;return o&&s&&iF({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:s,event:o})}function S5e(t){return!t.drawSize&&t.consideredEntries.length&&![kl,HR,SD,zu,Vh].includes(t.drawType??"")&&hD(t.consideredEntries.length)||t.drawSize&&ri(t.drawSize)||!1}function T5e(t){let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&dF({tournamentRecord:e,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:y4}:{...oe}}function dwe(t){let{drawDefinition:e,appliedPolicies:i}=t,r=i?.[tm],n=rs({drawDefinition:e});return e.structures?.forEach(a=>{let s=Tg({structureId:a.structureId,matchUpsMap:n}),o=Ave({roundNamingPolicy:r,drawDefinition:e,structure:a,matchUps:s}),{roundNamingProfile:l,roundProfile:c}=o;(a.structures||[a]).forEach(u=>{(u.matchUps??[]).forEach(d=>{let p=d?.roundNumber?.toString();if(p){let h=l?.[p]?.roundName,f=l?.[p]?.abbreviatedRoundName,m=c?.[p]?.feedRound;Object.assign(d,{abbreviatedRoundName:f,feedRound:m,roundName:h})}})})}),{drawDefinition:e}}function F0(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:s}=un({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),o=uwe(r?.entries)??[],l=g5e({...t,participantMap:s,participants:a,eventEntries:o});if(l.error)return ue({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=r?.eventType,g=t.matchUpType??m,v=S4e({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return ue({result:v,stack:n});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return ue({result:{error:Se},stack:n});let I=Z4e({...t,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:o,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:r});if(I.error)return ue({result:I,stack:n});let{existingDrawDefinition:w,positioningReports:T,drawDefinition:S,structureId:D,conflicts:C,entries:E}=I;if(!S)return ue({result:{error:Se},stack:n});let P=X4e({...t,existingDrawDefinition:w,positioningReports:T,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:D,entries:E,params:t,stack:n});if(P.error)return P;let{qualifyingConflicts:R}=P;return S.drawName=t.drawName??(p&&ys(p)),d&&typeof e=="object"&&d>=4&&s6({...e,drawDefinition:S,matchUpType:g}),t.hydrateRoundNames&&c?.[tm]&&dwe({drawDefinition:S,appliedPolicies:c}),{existingDrawDefinition:!!w,qualifyingConflicts:R,positioningReports:T,drawDefinition:S,structureId:D,...oe,conflicts:C}}function pwe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Yt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:o},l)=>({[o]:l+1})));n=n||t.scaleName;let s=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:o})=>({scaleItems:[{scaleValue:a[o],eventType:t.eventType,scaleType:gh,scaleName:n,scaleDate:s}],participantId:o}))}}function U5e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:s,event:o,stage:l,sortDescending:c,scaleSortMethod:u}){let d=TF({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:s,event:o,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Se};let m=$w({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=pwe({scaleAttributes:r,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:n});return{scaleItemsWithParticipantIds:g}}var hwe={};_i(hwe,{addDrawEntries:()=>t6,addEventEntries:()=>op,addEventEntryPairs:()=>ywe,destroyPairEntries:()=>mye,destroyPairEntry:()=>a6,getEntriesAndSeedsCount:()=>TF,getMaxEntryPosition:()=>S7,modifyEntriesStatus:()=>w_,modifyEventEntries:()=>bwe,mutate:()=>fwe,promoteAlternate:()=>gwe,promoteAlternates:()=>B7,query:()=>rwe,removeDrawEntries:()=>vwe,removeEventEntries:()=>v0,setEntryPosition:()=>F7,setEntryPositions:()=>mwe});var fwe={};_i(fwe,{addDrawEntries:()=>t6,addEventEntries:()=>op,addEventEntryPairs:()=>ywe,destroyPairEntries:()=>mye,destroyPairEntry:()=>a6,modifyEntriesStatus:()=>w_,modifyEventEntries:()=>bwe,promoteAlternate:()=>gwe,promoteAlternates:()=>B7,removeDrawEntries:()=>vwe,removeEventEntries:()=>v0,setEntryPosition:()=>F7,setEntryPositions:()=>mwe});function F7({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let s="setEntryPositions";if(!t)return{error:et};if(!i)return ue({result:{error:oa},stack:s});if(r!==void 0&&!Number.isSafeInteger(r))return{error:Se,entryPosition:r};(a?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),(e?.entries||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let o=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=Id({entries:a.entries})),e?.entries&&(o(e),e.entries=Id({entries:e.entries}))),{...oe}}function mwe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:et};if(!Array.isArray(e))return{error:Se};for(let n of e){let{participantId:a,entryPosition:s}=n,o=F7({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:s,event:r});if(o.error)return o}return r?.entries&&(r.entries=Id({entries:r.entries})),i?.entries&&(i.entries=Id({entries:i.entries})),{...oe}}function gwe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Se,participantId:e}:B7({...t,participantIds:[e].filter(Boolean)})}function B7({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Dt,eventId:a,event:s}){if(!t)return{error:et};if(!Array.isArray(i))return{error:Se,participantIds:i};if(!s)return{error:Lr};let o="promoteAlternates";if(s){let l=lX({element:s,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=lX({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ue({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...oe},stack:o}):l}return{...oe}}function lX({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Ou),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),s=n.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),o=a.length?a:[s].filter(Boolean);if(!o?.length)return{error:lme};let l=o.filter(({entryStatus:d})=>d!==Ou);if(l.length)return{error:tj,invalidEntryStatus:l};let c=o.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:Eje,invalidStage:c};let u=e&&o.filter(d=>d.stageSequence!==e);if(u?.length)return{error:Pje,invalidStageSequence:u};for(let d of o){d.entryStatus=ol;let p=d?.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Ou&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===ol&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>ri(f||0)),0);d.entryPosition=h||0}return{...oe}}function vwe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:Lr};if(!r)return{error:Nd};if(!e?.length)return{error:zg};let s=Jy({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(go(s,e))return{error:yD};let o=u=>{let d=u.participantId;return!e.includes(d)},{flightProfile:l}=Rn({event:a}),c=l?.flights?.find(u=>u.drawId===r);return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),t&&(c.drawEntries=Id({entries:c.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),t&&(i.entries=Id({entries:i.entries}))),{...oe}}function Rp(t){let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:s}=t,o=t.tournamentId?t.tournamentRecords?.[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&t.tournamentRecords?.[t.activeTournamentId]);if(!o)return{error:et};if(!s)return ue({result:{error:vw},stack:e});s.participantId||(s.participantId=lr()),o.participants||(o.participants=[]);let{participantId:l,individualParticipantIds:c}=s;if(o.participants.reduce((m,g)=>g.participantId===l||m,!1))return{error:rme};let{participantType:u,participantRole:d}=s;if(!u||!Object.keys(eP).includes(u))return{error:Pd,participantType:u};if(!d)return{error:tme};let p=o.participants||[],h=p.filter(m=>m.participantType===Bi).map(m=>m.participantId);if(u!==Bi&&s.person)return{error:Se,person:s.person};if(c&&!Array.isArray(c))return{error:Se,individualParticipantIds:c};if(u===Ei){if(s.person)return{error:Se,person:s.person};if(s.individualParticipantIds){if(s.individualParticipantIds.length!==2&&!a)return ue({info:"PAIR must be 2 individualParticipantIds",result:{error:wl},stack:e});{let v=p.filter(y=>y.participantType===Bi).map(y=>y.participantId);if(!Array.isArray(s.individualParticipantIds))return ue({result:{error:wl},stack:e});if(!s.individualParticipantIds.reduce((y,b)=>v.includes(b)&&y,!0))return ue({result:{error:wl},stack:e})}}else return ue({result:{error:zg},stack:e});let m=p.filter(v=>v.participantType===Ei).map(v=>({individualParticipantIds:v.individualParticipantIds,participant:v})),g=s.participantType===Ei&&m.find(v=>En(v.individualParticipantIds,s.individualParticipantIds).length===2);if(g&&!i)return{...oe,existingParticipant:!0,participant:r&&Et(g.participant)};if(!s.participantName){let v=p.filter(b=>s.individualParticipantIds?.includes(b.participantId)),y=v.map(b=>b.person?.standardFamilyName).filter(Boolean).join("/");v.length===1&&(y+="/Unknown"),s.participantName=y}}else if(u===Bi){if(!s.person?.standardFamilyName||!s.person?.standardGivenName)return{error:ome};if(!s.participantName){let m=`${s.person.standardFamilyName.toUpperCase()}, ${s.person.standardGivenName}`;s.participantName=m}}else if(u&&[hr,vc].includes(u)){if(c||(s.individualParticipantIds=[]),s.individualParticipantIds?.length)for(let m of s.individualParticipantIds){if(typeof m!="string")return ue({result:{participantId:m,error:Se},stack:e});if(!h.includes(m))return ue({result:{participantId:m,error:_n},stack:e})}}else return{error:Pd};o.participants.push(s),n||Ii({payload:{tournamentId:o.tournamentId,participants:[s]},topic:Ig});let f={participant:r&&Et(s),...oe};return Ft(f)}function Ku({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:et};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=lr())});let a=r.filter(d=>!n.includes(d.participantId)),s=r.filter(d=>n.includes(d.participantId)),o=a.filter(d=>d.participantType===Bi),l=a.filter(d=>d.participantType!==Bi),c=o.concat(...l),u=[];if(c.length){for(let p of c){let h=Rp({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&Ii({topic:Ig,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&Et(u),addedCount:u.length,...oe};return s.length&&Object.assign(d,{notAdded:s,info:Jx}),Ft(d)}else return{info:"No new participants to add",addedCount:0,...oe}}function ywe(t){let e=Gt(t,[{[pa]:!0,[Tm]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Ou,participantIdPairs:n=[],entryStage:a=Dt,tournamentRecord:s,drawDefinition:o,event:l,uuids:c}=t;if(l.eventType!==mr)return{error:xh};let u=[],d=new Map;for(let I of s.participants??[]){let{participantType:w,participantId:T,person:S,individualParticipantIds:D}=I;w===Bi&&S?.sex?d.set(T,S.sex):w===Ei&&D&&u.push(D)}let p=n.filter(I=>{if(I.length!==2)return!0;if(!l.gender||mh(l.gender))return!1;if(!d.has(I[0])||!d.has(I[1]))return!0;let w=I.map(S=>d.get(S)),T=Cb(l.gender)&&(!Cb(w[0])||!Cb(w[1]))||Mv(l.gender)&&(!Mv(w[0])||!Mv(w[1]));return tc(l.gender)&&(w.sort(VL),(!Mv(w[0])||!Cb(w[1]))&&(T=!0)),T});if(p.length)return{error:wl,invalidParticipantIdPairs:p};let h=n.map(I=>({participantId:c?.pop()??lr(),participantRole:vs,individualParticipantIds:I,participantType:Ei})),f=i?h:h.filter(I=>!u.find(w=>En(w,I.individualParticipantIds).length===2)),m,g=[];if(f){let I=Ku({allowDuplicateParticipantIdPairs:i,participants:f,returnParticipants:!0,tournamentRecord:s});if(I.error)return I;g=I.participants||[],m=I.info}let v=n.map(I=>{let w=g.find(S=>En(S.individualParticipantIds,I).length===2);if(w)return w;let{participant:T}=Yu({tournamentRecord:s,participantIds:I});return T}).map(I=>I.participantId),y=op({participantIds:v,tournamentRecord:s,drawDefinition:o,entryStatus:r,entryStage:a,event:l});f.length&&Ii({payload:{participants:f},topic:Ig});let b=f.map(Fi);return{...y,info:m,newParticipantIds:b}}function bwe({entryStatus:t=ol,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Dt,tournamentRecord:n,event:a}){if(!n)return{error:et};if(!a)return{error:Lr};let s=n.participants??[],o=s.filter(m=>m.participantType===Bi).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!o.includes(m));if(l.length)return{error:wl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:wl,invalidParticipantIdPairs:c};let u=s.filter(m=>m.participantType===Ei).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>En(g,m).length===2)).map(m=>({participantType:Ei,participantRole:vs,individualParticipantIds:m})),p=Ku({participants:d,tournamentRecord:n});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Yu({tournamentRecord:n,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:r})),f=e.map(m=>({entryStatus:tu,participantId:m,entryStage:r}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===r),a.entries=a.entries.concat(...h,...f),{...oe}}var Iwe={};_i(Iwe,{addDrawDefinition:()=>B0,addEvent:()=>BD,addFlight:()=>NF,assignSeedPositions:()=>_we,attachFlightProfile:()=>q7,categoryCanContain:()=>jR,deleteDrawDefinitions:()=>CF,deleteEvents:()=>Owe,deleteFlightAndFlightDraw:()=>Nwe,deleteFlightProfileAndFlightDraws:()=>Ewe,generate:()=>wwe,generateEventsFromTieFormat:()=>Twe,getCategoryAgeDetails:()=>bI,getEvent:()=>L7,getEventProperties:()=>O7,getEventStructures:()=>zL,getEventTimeItem:()=>QR,getEvents:()=>x7,getFlightProfile:()=>Rn,getScaledEntries:()=>$w,modifyEvent:()=>xwe,modifyEventMatchUpFormatTiming:()=>Pwe,modifyPairAssignment:()=>Awe,mutate:()=>Uwe,query:()=>cwe,refreshEventDrawOrder:()=>z7,removeEventMatchUpFormatTiming:()=>RF,removeScaleValues:()=>W7,removeSeeding:()=>kwe,setEventDates:()=>G7,setEventDisplay:()=>MF,setEventEndDate:()=>j7,setEventStartDate:()=>V7,updateDrawIdsOrder:()=>H7,validateCategory:()=>vC});var wwe={};_i(wwe,{generateEventsFromTieFormat:()=>Twe});function D5e({tournamentId:t,event:e}){return e?(Ii({payload:{tournamentId:t,event:e},key:e.eventId,topic:hve}),{...oe}):{error:Lr}}var E5e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},P5e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},C5e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Swe={COLLEGE_D3:E5e,COLLEGE_DEFAULT:P5e,COLLEGE_JUCO:C5e,DOMINANT_DUO:oge,DOMINANT_DUO_MIXED:ige,LAVER_CUP:pge,TEAM_DOUBLES_3_AGGREGATION:Xme,TIME_TENNIS_DUAL:rge,TIME_TENNIS_PRO_CIRCUIT:tge,USTA_BREWER_CUP:nge,USTA_OZAKI_CUP:age,USTA_COLLEGE:lge,USTA_GOLD_TEAM_CHALLENGE:Zme,USTA_INTERSECTIONAL:ege,USTA_LEVEL_1:cge,USTA_SECTION_BATTLE:Qme,USTA_SOUTHERN_LEVEL_5:Jme,USTA_TOC:hge,USTA_WTT_ITT:uge,USTA_ZONAL:dge};function BD({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){if(!e)return{error:et};if(e.events||(e.events=[]),!r)return{error:Lr};let{startDate:n,endDate:a}=e;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let o=Ft({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:Se,context:o}}let s={eventType:II,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===_l){if(r.tieFormat){let o=Oo({tieFormat:r.tieFormat});if(o.error)return o}else if(r.tieFormatName){if(!Swe[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:Se};let o=Qf({isMock:e?.isMock,namedFormat:r.tieFormatName,event:r});s.tieFormat=o}}if(s.eventId||(s.eventId=lr()),e.events.reduce((o,l)=>o||l.eventId===s.eventId,void 0))return{error:Lfe};{let o=s;if(e.events.push(o),!t){let{topics:l}=Jc();if(l.includes(EL)){let d=nf({event:r}).matchUps??[];wg({tournamentId:e?.tournamentId,eventId:r.eventId,matchUps:d})}let{drawDefinitions:c,...u}=r;for(let d of c||[])XR({drawDefinition:d});D5e({tournamentId:e?.tournamentId,event:u})}return{...oe,event:s}}}function Twe(t){let e=Gt(t,[{[tU]:{[mL]:!0,[$ge]:!0}},{[pa]:!0}]);if(e.error)return e;let i=t.tieFormat||Qf({namedFormat:t.tieFormatName}),r=t.uuids||[Kme(i.collectionDefinitions.length)],n={[Xn]:[],[ps]:[]};if(t.addEntriesFromTeams){let s=t.tournamentRecord.participants?.filter(o=>o.participantType===Ro)?.flatMap(o=>o.individualParticipantIds??[]);for(let o of t.tournamentRecord.participants??[])if(s?.includes(o.participantId)){let l=o.person?.sex;if(l&&Sp(l)){let c=Ns(l);c&&n[c].push(o.participantId)}}}let a=[];for(let s of i.collectionDefinitions??[]){let o=r?.pop()?.toString()||lr(),l=s.matchUpType,c=s.gender,u={matchUpFormat:s.matchUpFormat,eventName:s.collectionName,category:s.category,gender:c,eventType:l,eventId:o};if(t.addEntriesFromTeams){let d=l===em?tu:t.entryStatus||ol,p=tc(c)?[...n[Xn],...n[ps]]:n[Ns(c)||Pf]??[];if(p.length){let h=op({participantIds:p,entryStatus:d,event:u});if(h.error)return h}}if(a.push(u),t.addEvents!==!1){let d=BD({internalUse:!0,tournamentRecord:t.tournamentRecord,event:u});if(d.error)return d}}return{...oe,events:a}}var Uwe={};_i(Uwe,{addDrawDefinition:()=>B0,addEvent:()=>BD,addFlight:()=>NF,assignSeedPositions:()=>_we,attachFlightProfile:()=>q7,deleteDrawDefinitions:()=>CF,deleteEvents:()=>Owe,deleteFlightAndFlightDraw:()=>Nwe,deleteFlightProfileAndFlightDraws:()=>Ewe,modifyEvent:()=>xwe,modifyEventMatchUpFormatTiming:()=>Pwe,modifyPairAssignment:()=>Awe,refreshEventDrawOrder:()=>z7,removeEventMatchUpFormatTiming:()=>RF,removeScaleValues:()=>W7,removeSeeding:()=>kwe,setEventDates:()=>G7,setEventDisplay:()=>MF,setEventEndDate:()=>j7,setEventStartDate:()=>V7,updateDrawIdsOrder:()=>H7,validateCategory:()=>vC});function $D({removePriorValues:t=!0,status:e=yc,statusObject:i,event:r}){if(!qi(i))return{error:Se};let n=ru({event:r,status:e}),a=`${Xg}.${Jg}`,s={itemValue:{[e]:{...n,...i}},itemType:a};return Bw({timeItem:s,removePriorValues:t,event:r})}function VD(t){let e=Gt(t,[{[pa]:!0,[Tm]:!0},{eventDataParams:!1,[Bo]:Zo}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=yc,event:s,drawIdsToRemove:o,drawIdsToAdd:l}=t,{appliedPolicies:c}=er({tournamentRecord:n,event:s}),u={...c,...t.policyDefinitions},d=s?.drawDefinitions?.map(({drawId:w})=>w)??[],p=t.drawDetails?Object.keys(t.drawDetails):[],h=p.length?[]:t.drawIds,f=(l??[]).concat(...o??[],...h??[],...p),m=f.filter(w=>!d.includes(w));if(m.length)return ue({result:{error:lc},context:{invalidDrawIds:m}});let g=ru({event:s,status:a}),v=Object.keys(g?.drawDetails||{}).filter(w=>d.includes(w)).reduce((w,T)=>(w[T]=g.drawDetails[T],w),{});for(let w of d)if((!f.length||f.includes(w))&&(o?.includes(w)||h?.length&&!h.includes(w)?v[w]={...v[w],publishingDetail:{published:!1}}:(l?.includes(w)||h?.includes(w)||!h?.length)&&(v[w]={...v[w],publishingDetail:{published:!0}})),t.drawDetails?.[w]){let T=t.drawDetails[w],S=T.structureDetails??v[w].structureDetails,D=T.stageDetails??v[w].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:E=[],publishingDetail:P={},stagesToRemove:R=[],stagesToAdd:M=[]}=T;if((E||M)&&(P.published=!0),v[w]={publishingDetail:P,structureDetails:S,stageDetails:D},E.length||C.length){let N=(s?.drawDefinitions?.find(x=>x.drawId===w)?.structures??[]).map(({structureId:x})=>x),k=(E??[]).concat(C??[]).filter(x=>!N.includes(x));if(k.length)return ue({result:{error:en},context:{invalidStructureIds:k}});S=S??{};for(let x of N)C.includes(x)?S[x]={published:!1}:S[x]={published:!0};v[w].structureDetails=S}let A=(s?.drawDefinitions?.find(N=>N.drawId===w)?.structures??[]).map(({stage:N})=>N);if(M.length){for(let N of M)D[N]={published:!0};for(let N of A)D[N]||(D[N]={published:!1})}if(M.length||R.length){for(let N of R)D[N]={published:!1};for(let N of A)D[N]||(D[N]={published:!0})}(M.length||R.length)&&(v[w].stageDetails=D)}$D({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:s});let{topics:y}=Jc(),b=y.includes(pj),I=b||t.returnEventData?vF({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:s})?.eventData:void 0;return b&&Ii({payload:{eventData:I,tournamentId:n.tournamentId},topic:pj}),{...oe,eventData:I}}var Dwe="deleteDrawDefinitions",xj="autoSchedulingAudit",GN="deleteEvents",R5e={AUTO_SCHEDULING_AUDIT:xj,DELETE_EVENTS:GN,DELETE_DRAW_DEFINITIONS:Dwe};function CF(t){if(!t.tournamentRecord)return{error:et};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:s,eventId:o,force:l}=t,{appliedPolicies:c}=er({tournamentRecord:a,event:r}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let D=Lo({tournamentRecord:a,eventId:o,drawId:d});if(D.error)return D;r=D.event}let p=[],h=[],f=[];if(!r?.drawDefinitions)return ue({info:"event has no drawDefinition",result:{...oe},stack:e});let m=r.drawDefinitions.map(({drawId:D})=>D);if(i.length||(i=m),i=i.filter(D=>m.includes(D)),!i.length)return ue({info:"nothing to do; no matching drawIds in event.",result:{...oe},stack:e});let g=Et(Rn({event:r}).flightProfile,!1,!0),v=({participantId:D,drawPosition:C,qualifier:E,bye:P})=>({bye:P,qualifier:E,drawPosition:C,participantId:D}),y=l??c?.[Gc]?.allowDeletionWithScoresPresent?.drawDefinitions,b=ru({event:r})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],w,T=[],S=r.drawDefinitions.filter(D=>{if(i.includes(D.drawId)){let C=po({event:r,drawDefinition:D})?.matchUps??[];if(C.some(({score:V})=>ua({score:V}))&&!y)return T.push(D.drawId),!0;let{drawId:E,drawType:P,drawName:R}=D,M=g?.flights?.find(V=>V.drawId===D.drawId);M&&(M.drawEntries=M.drawEntries?.filter(V=>td.includes(V.entryStatus))),I.includes(E)&&(I=I.filter(V=>V!==E),w=!0);let A=Wu({stageSequence:1,drawDefinition:D,stage:Dt})?.structures?.[0],N=(A?AC({structureId:A.structureId,tournamentRecord:a,drawDefinition:D}):void 0)?.positionAssignments?.map(v),k=Wu({stage:zt,drawDefinition:D})?.structures,x=k?.length?k.map(V=>{let F=V.stageSequence;return{positionAssignments:AC({structureId:V.structureId,tournamentRecord:a,drawDefinition:D})?.positionAssignments.map(v),stageSequence:F}}):void 0,O={action:Dwe,payload:{drawDefinitions:[D],eventId:o??r?.eventId,auditData:s}};f.push(O),p.push(Ft({tournamentId:a.tournamentId,eventId:o??r?.eventId,qualifyingPositionAssignments:x,positionAssignments:N,auditData:s,drawType:P,drawName:R,drawId:E})),C?.forEach(({matchUpId:V})=>h.push(V))}return!i.includes(D.drawId)});if(T.length&&!l)return ue({context:{drawIdsWithScoresPresent:T},result:{error:FR},stack:e});if(r.drawDefinitions=S,g&&Yg({event:r,extension:{name:qu,value:g}}),O0({tournamentRecord:a}),w){let D={};for(let E of I)D[E]=b.drawDetails?.[E]??{published:!0};let C=$D({statusObject:{drawDetails:D},event:r});if(C.error)return{error:C.error}}if(f.length)if(nL(Of)){let D=a.tournamentId;Ii({topic:Of,payload:{tournamentId:D,detail:f}});let C=(eu({element:r,itemType:$v})?.timeItem?.itemValue||0)+1;Vp({element:r,timeItem:{itemType:$v,itemValue:C},removePriorValues:!0})}else M5e({appliedPolicies:c,event:r,deletedDrawsDetail:p,auditData:s});if(h.length&&tf({tournamentId:a?.tournamentId,matchUpIds:h}),i.forEach(D=>DHe({drawId:D})),n&&w){let D=VD({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(D.error)return{...oe,info:D.error}}return{...oe}}function M5e({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){if(t?.audit?.[$v]===!1)return;let{extension:n}=Ci({name:$v,element:e}),a={...r,deletedDrawsDetail:i},s={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:$v};nr({element:e,extension:s})}function Ewe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){if(!e)return{error:et};if(!r)return{error:Lr};let{flightProfile:a}=Rn({event:r});if(a){let s=a.flights?.map(({drawId:l})=>l).filter(Boolean),o=CF({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return o.error?o:wL({event:r,name:qu})}return{...oe}}function $7(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,s=t?.tournamentRecords??(t?.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(s).length)return{error:hn};let o=Object.keys(s).filter(c=>!n||n===c);if(n&&!o.includes(n))return{error:Se};let l;for(let c of o){let u=s[c],{event:d}=Lo({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=N5e({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...oe}:{error:Vc}}function N5e({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:et};if(r&&!Array.isArray(r))return{error:Se};if(e&&!Array.isArray(e))return{error:Se};let a=rm;if(n){let{extension:s}=Ci({element:n,name:a}),o=s?.value||{},l=cX({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});nr({element:n,extension:{name:a,value:l}})}else{let{extension:s}=Ci({element:t,name:a}),o=s?.value||{},l=cX({...o,matchUpFormat:i,averageTimes:r,recoveryTimes:e});nr({extension:{name:a,value:l},element:t})}return{...oe}}function cX(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let s=n?.length&&i.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l})=>l?.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>l?.categoryNames?.length||l?.categoryTypes?.length);let o=a?.length&&e.map(l=>l?.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:l.matchUpFormatCodes?.filter(c=>c!==r)}:l).filter(({matchUpFormatCodes:l,averageTimes:c})=>l?.length||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:s?.length&&s||i,matchUpRecoveryTimes:o?.length&&o||e}}function Pwe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:s,event:o}=t;if(!e)return{error:et};if(!Al({matchUpFormat:n}))return{error:Se};if(!o)return{error:Lr};let{averageTimes:l=[],recoveryTimes:c=[]}=UF({tournamentRecord:e,matchUpFormat:n,event:o}),u=o.category,d=u?.categoryName||u?.ageCategoryCode||o?.eventId,p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{if(b.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!(b.categoryNames?.includes(d)&&(b.categoryNames=b.categoryNames.filter(I=>I!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=r&&!isNaN(ri(r)),g=i&&!isNaN(ri(i)),v=l.map(f).filter(b=>b?.categoryNames?.length),y=c.map(f).filter(b=>b?.categoryNames?.length);return m&&(Object.assign(p.minutes,{[o?.eventType||wr]:r}),v.push(p)),g&&(Object.assign(h.minutes,{[o?.eventType||wr]:i}),y.push(h)),!m&&!g?{error:Se}:$7({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:n,eventId:s})}function RF(t){if(t.event)return uX({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Gt(t,[{[Fs]:!0,[zge]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=Lo({tournamentRecord:n,eventId:r});if(a)return uX({event:a})}}return{error:Vc}}function uX({event:t}){return wL({event:t,name:rm})}var Cwe={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function Rwe(t){return!Array.isArray(t)||yi(t).length!==t.length?!1:t.every(e=>Object.keys(Cwe).includes(e))}function V7({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:et};if(!e)return{error:Lr};if(!Tp.test(i))return{error:Ba};let r=Mwe(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,s=new Date(Ui(i)).getTime();if(!n||!a||s<n||s>a)return{error:Ba};let o=e.endDate&&new Date(Ui(e.endDate)).getTime();return o&&s>o&&(e.endDate=i),e.startDate=i,{...oe}}function j7(t){let{tournamentRecord:e,event:i,endDate:r}=t;if(!e)return{error:et};if(!i)return{error:Lr};if(!Tp.test(r))return{error:Ba};let n=Mwe(e);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:s}=n,o=new Date(Ui(r)).getTime();if(!a||!s||o<a||o>s)return{error:Ba};let l=i.startDate&&new Date(Ui(i.startDate)).getTime();return l&&o<l&&(i.startDate=r),i.endDate=r,{...oe}}function G7(t){let e=Gt(t,[{tournamentRecord:!0,event:!0},{[hs]:l=>Tp.test(l),[uc]:Ba,startDate:!1,endDate:!1},{[hs]:l=>l.filter(Boolean).every(c=>Tp.test(c)),[uc]:Ba,activeDates:!1},{[hs]:Rwe,weekdays:!1}]);if(e.error)return e;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:s}=t,o=t.activeDates?.filter(Boolean);if(a&&s){let l=new Date(Ui(a)).getTime(),c=new Date(Ui(s)).getTime();if(l>c)return{error:Se}}if(o){let l=a||i.startDate,c=s||i.endDate,u=!l||o.every(p=>new Date(p)>=new Date(l)),d=!c||o.every(p=>new Date(p)<=new Date(c));if(!u||!d)return{error:Ba}}if(a){let l=V7({tournamentRecord:i,event:n,startDate:a});if(l.error)return l}if(s){let l=j7({tournamentRecord:i,event:n,endDate:s});if(l.error)return l}return o&&(n.activeDates=o),r&&(n.weekdays=r),{...oe}}function Mwe(t){let{startDate:e,endDate:i}=t;return!Tp.test(e)||!Tp.test(i)?ue({result:{error:Xfe},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ui(e)).getTime(),tournamentEndDate:new Date(Ui(i)).getTime()}}function H7({event:t,orderedDrawIdsMap:e}){if(typeof t!="object")return{error:Lr};if(!e)return{error:Yt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Se,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(n=>!isNaN(n)))return{error:Se,info:"drawOrder must be numeric"};if(yi(i).length!==i.length)return{error:Se,info:"drawOrder values must be unique"};if(t.drawDefinitions?.length){let n=(t.drawDefinitions||[]).map(({drawId:s})=>s),a=Object.keys(e);if(a?.length&&En(n,a).length!==n.length)return{error:Se,info:"Missing drawIds"};t.drawDefinitions.forEach(s=>{s.drawOrder=e[s.drawId]})}let{flightProfile:r}=Rn({event:t});return r?.flights?.forEach(n=>{n.flightNumber=e[n.drawId]}),{...oe}}function z7({tournamentRecord:t,event:e}){if(!t)return{error:et};if(!e)return{error:Lr};let{flightProfile:i}=Rn({event:e}),r=i?.flights&&Object.assign({},...i.flights.sort((n,a)=>n.flightNumber-a.flightNumber).map((n,a)=>({[n.drawId]:a+1})))||e.drawDefinitions?.length&&Object.assign({},...e.drawDefinitions.sort((n,a)=>n.drawOrder-a.drawOrder).map((n,a)=>({[n.drawId]:a+1})))||void 0;return r?H7({event:e,orderedDrawIdsMap:r}):{...oe}}function Nwe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){if(!e)return{error:et};if(!r)return{error:Nd};if(!n)return{error:Lr};let{flightProfile:s}=Rn({event:n});if(s&&s.flights?.find(o=>o.drawId===r)){let o=s.flights.filter(c=>c.drawId!==r),l={name:qu,value:{...s,flights:o}};Yg({event:n,extension:l})}if(n.drawDefinitions?.find(o=>o.drawId===r)){let o=CF({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(o.error)return o}return z7({tournamentRecord:e,event:n})}function Awe(t){let e=Gt(t,[{[Tm]:!0,[pa]:!0,[d5]:!1},{replacementIndividualParticipantId:!0,[hs]:g=>Yr(g),existingIndividualParticipantId:!0,[ku]:oa,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:s,event:o,uuids:l}=t;if(e.error)return e;if(o?.eventType!==jc)return{error:xh};if(!(o?.entries?.filter(({entryStatus:g})=>[tu,Ky].includes(g)).map(({participantId:g})=>g)||[]).includes(i))return{error:Ed};let c=(n.participants||[]).find(g=>g.participantId===s);if(c?.participantType!==Ei)return{error:gw,participant:c};let u=c.individualParticipantIds,d=[i,...u.filter(g=>g!==r)],{participant:p}=Yu({participantIds:d,tournamentRecord:n}),h;if(p)h=p.participantId;else{let g={participantId:l?.pop(),participantRole:vs,individualParticipantIds:d,participantType:Ei},v=Rp({participant:g,returnParticipant:!0,tournamentRecord:n});if(v.error)return v;h=v.participant.participantId}let{flightProfile:f}=Rn({event:o});if(a){let g=f?.flights?.find(({drawId:v})=>v===a.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===s?{...v,participantId:h}:v)),a.entries=a.entries.map(v=>v.participantId===s?{...v,participantId:h}:v);for(let v of a.structures||[])if(v.structures){v.positionAssignments=void 0;for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===s?{...b,participantId:h}:b)}else v.positionAssignments&&(v.positionAssignments=v.positionAssignments.map(y=>y.participantId===s?{...y,participantId:h}:y))}o.entries=o.entries.map(g=>g.participantId===s&&{...g,participantId:h}||g.participantId===i&&{...g,participantId:r}||g);let m=n.events.some(({entries:g,eventId:v,drawDefinitions:y})=>o.eventId===v?y.some(({drawId:b,entries:I})=>b===a?.drawId?!1:I?.find(w=>w.participantId===s)):g?.find(b=>b.participantId===s));if(!m){let g=Ow({addIndividualParticipantsToEvents:!1,participantIds:[s],tournamentRecord:n});if(g.error)return g}return{...oe,participantOtherEntries:m,newPairParticipantId:h}}function B0(t){let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:s,tournamentRecord:o,drawDefinition:l,event:c}=t;if(!l)return{error:At};if(!c)return{error:Lr};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:Se,info:"drawDefintions count mismatch"};let{flightProfile:m}=Rn({event:c}),g=e&&m?.flights?.find(R=>R.flightNumber===e.flightNumber),v=m?.links?.find(R=>R?.target?.drawId===u)?.source?.drawId;if(v&&!c.drawDefinitions.find(R=>R.drawId===v))return ue({result:{error:At},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ue({result:{error:zb},info:{relevantFlight:g}});let y=p?.every(({participantId:R,entryStatus:M})=>{let A=g?.drawEntries.find(N=>N.participantId===R);return!M||A?.entryStatus===M}),b=!s||h&&p?.every(({participantId:R,entryStatus:M,entryStage:A})=>h.find(N=>N.participantId===R&&(!N.entryStage||N.entryStage===A))?.entryStatus===M);if(g&&!y)return ue({result:{error:zb},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach(R=>{if(R?.entryStatus&&td.includes(R?.entryStatus)){let M=h?.filter(Boolean).find(A=>A.participantId===R.participantId);M&&R.entryStatus&&M?.entryStatus!==R.entryStatus&&(M.entryStatus=R.entryStatus,f+=1)}}),h&&!b)return ue({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:zb}});let I=m?.flights?.map(({flightNumber:R})=>!isNaN(R)&&ri(R))?.filter(Boolean)||[],w=c.drawDefinitions.map(({drawOrder:R})=>R&&ri(R))?.filter(Boolean)||[],T=Math.max(0,...w,...I)+1,S=m?.flights?.find(R=>R.drawId===u),D;if(S){S.drawName=l.drawName,D={name:qu,value:{...m,flights:m.flights}};let R=S.flightNumber;R&&!w.includes(R)?T=R:S.flightNumber=T}else{let R=m?.flights||[];R.push({manuallyAdded:!0,flightNumber:T,drawEntries:p,drawName:d,drawId:u}),D={name:qu,value:{...m||{},flights:R}}}Yg({event:c,extension:D}),Object.assign(l,{drawOrder:T});let C=c.drawDefinitions.find(R=>R.drawId===u),E=o?.tournamentId,P=c.eventId;if(C){if(!a)return{error:Pfe};let R=po({drawDefinition:C})?.matchUps?.map(Pa)??[],M=po({drawDefinition:l})?.matchUps;if(!i){R?.length&&tf({matchUpIds:R,action:"modifyDrawDefinition",tournamentId:E,eventId:P}),M?.length&&wg({matchUps:M,tournamentId:E,eventId:P}),c.drawDefinitions=c.drawDefinitions.map(N=>N.drawId===u?l:N);let A=l.structures?.map(({structureId:N})=>N);Cr({drawDefinition:l,tournamentId:E,structureIds:A,eventId:P})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:R}=po({drawDefinition:l,event:c});R&&wg({tournamentId:o?.tournamentId,matchUps:R}),XR({drawDefinition:l,tournamentId:E,eventId:P})}return{...oe,modifiedEventEntryStatusCount:f}}function _we(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,assignments:o,drawId:l,event:c}=t,u=0;if(!o?.length)return{error:S4};if(!r)return{error:et};if(!l)return{error:Nd};let d=Hc({provisionalPositioning:e,drawDefinition:n,structureId:s});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));o.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v?.participantId).filter(Boolean);if(g.length!==mfe(g).length)return{error:Cfe};for(let v of m){let y=_D({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:s,event:c});if(y?.error)return y;y?.success&&u++}return u?{...oe,modifications:u}:{error:ID}}function q7({deleteExisting:t,event:e,flightProfile:i}){let r="attachFlightProfile";if(!i)return ue({result:{error:Yt},stack:r});if(!e)return ue({result:{error:Lr},stack:r});let{flightProfile:n}=Rn({event:e});return n&&!t?ue({result:{error:$4},stack:r}):e.drawDefinitions?.length?ue({result:{error:Tfe},stack:r}):(Yg({event:e,extension:{name:qu,value:i}}),{flightProfile:Et(i,!1,!0),...oe})}function A5e({tournamentRecord:t,scaleAttributes:e,participantIds:i}){if(!t)return{error:et};if(!i)return{error:zg};if(!e)return{error:Yt,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,s=[jve,r,n,a].join(".");return t.participants?.forEach(o=>{i.includes(o.participantId)&&o.timeItems&&(o.timeItems=o.timeItems.filter(l=>l&&l?.itemType!==s))}),{...oe}}function W7({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:s}){if(!a)return{error:Lr};if(r&&!Array.isArray(r))return ue({result:{error:Se},info:vy("entryStatus"),stack:"removeScaleValues"});let o=a.entries;if(n){let{flightProfile:c}=Rn({event:a}),u=c?.flights?.find(d=>d.drawId===n);u?o=u.drawEntries:o=i?.entries}let l=(o||[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||r.includes(c.entryStatus))).map(Fi);return A5e({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function MF({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=yc,event:n}){if(!e)return ue({result:{error:et}});if(!n)return ue({result:{error:Lr}});if(!qi(i))return ue({result:{error:Yt}});if(qi(i.draws))for(let s of Object.keys(i.draws)){let o=i.draws[s].scheduleDetails??[];if(o.length){let l=[];for(let c of o){let u=l.find(d=>cje(d.attributes,c.attributes));u?.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[s].scheduleDetails=l}}let a=$D({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...oe}}function kwe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:s}){if(!t)return{error:et};if(!a)return{error:Lr};r=r||a.category?.categoryName||a.category?.ageCategoryCode;let o={eventType:a.eventType,scaleType:gh,scaleName:r};return W7({tournamentRecord:t,scaleAttributes:o,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:s})}function Owe(t){let e=Gt(t,[{[pa]:!0},{eventIds:!0,[Bo]:Rs}]);if(e.error)return e;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=t,a=[],s=[],o=[],l=[];if(r.events=(r.events||[]).filter(c=>{if(n.includes(c.eventId)){let p={action:GN,payload:{events:[c]}};a.push(p),s.push({tournamentId:r.tournamentId,eventName:c.eventName,eventType:c.eventType,category:c.category,eventId:c.eventId,gender:c.gender})}let u=c.eventType===jc?(c.entries||[]).map(({entryStatus:p,participantId:h})=>p!==tu&&h).filter(Boolean):[],d=n.includes(c.eventId);return d?l.push(...u):o.push(...u),!d}),i){let c=l.filter(u=>!o.includes(u));r.participants=r.participants.filter(({participantId:u})=>!c.includes(u))}if(O0({tournamentRecord:r}),a.length)if(nL(Of)){let c=r.tournamentId;Ii({topic:Of,payload:{type:GN,tournamentId:c,detail:a}})}else C0({tournamentRecord:r,timeItem:{itemValue:s,itemType:GN}});return{...oe}}function xwe(t){let e=Gt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Zo}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=O5e(t),s=x5e({enteredParticipants:a}),{enteredParticipantGenders:o,enteredParticipantTypes:l}=s,c=Rn({event:r})?.flightProfile?.flights,u=!r.drawDefinitions?.length&&!c?.length,d=L5e({noFlightsNoDraws:u,enteredParticipantGenders:o,eventUpdates:i,stack:n});if(d.error)return d;let p=F5e({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(p.error)return p;let h=_5e({...t,...s,enteredParticipants:a,stack:n});if(h.error)return h;let f=k5e({...t,stack:n});return f.error?f:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...oe})}function _5e(t){let e=t.eventUpdates?.category;if(!e)return{...oe};let i=vC({category:e});if(i.error)return i;if(t.event.eventType===ta){let r=t.event?.drawDefinitions?.map(s=>zd(s))??[],n=zd(t.event),a=(nf(t)?.matchUps??[]).map(s=>zd(s))??[];if(![n,...r,...a].filter(Boolean).every(s=>s.collectionDefinitions.every(o=>!o.category||jR({category:t.eventUpdates.category,childCategory:o.category}))))return ue({result:{error:dC},stack:t.stack})}if(t.enteredParticipants?.length){let r=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,n=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,a=t.enteredParticipants.map(l=>l.participantType===Bi?l:l.individualParticpants??[]).flat(),s=bI({category:e,consideredDate:r}),o=bI({category:e,consideredDate:n});if(s?.ageMinDate||s?.ageMaxDate||o?.ageMinDate||o?.ageMaxDate)for(let l of a){let c=l.person?.birthDate;if(!c)return ue({result:{error:Wfe},stack:t.stack});let u=new Date(c).getTime();if(s.ageMinDate||s.ageMaxDate){let d=new Date(s.ageMinDate).getTime(),p=new Date(s.ageMaxDate).getTime();if(u<d||u>p)return ue({result:{error:ej},stack:t.stack})}if(o.ageMin||o.ageMax){let d=new Date(o.ageMinDate).getTime(),p=new Date(o.ageMaxDate).getTime();if(u<d||u>p)return ue({result:{error:ej},stack:t.stack})}}}return{...oe}}function k5e(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=G7({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return ue({result:a,stack:n})}return{...oe}}function O5e(t){let{tournamentRecord:e,event:i}=t,r=i?.entries?.filter(({entryStatus:n})=>{let a=n;return[...td,Ou].includes(a)}).map(({participantId:n})=>n)??[];return r?un({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function x5e({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{let s=a.person?.sex?[a.person.sex]:a.individualParticpants?.map(o=>o.person?.sex)||[];return e.push(...s),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=yi(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function L5e({noFlightsNoDraws:t,enteredParticipantGenders:e,eventUpdates:i,stack:r}){let n=!e.length||!i.gender||mh(i.gender)||e.length===1&&e[0]===i.gender||t&&tc(i.gender);return i.gender&&!n?ue({context:{gender:i.gender,validGender:n},result:{error:JE},stack:r}):{...oe}}function F5e({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(ta)&&[ta]||t.includes(Bi)&&[Up]||t.includes(Ei)&&[jc]||[jc,Up,ta]).includes(e.eventType??"");return e.eventType&&!r?ue({context:{participantType:e.eventType,validEventType:r},result:{error:xh},stack:i}):{...oe}}function NF({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){let s="addFlight";if(!n)return ue({result:{error:Lr},stack:s});if(!i)return ue({result:{error:Yt},stack:s});if(e?.length){let h=(n.entries??[]).map(Fi),f=e.map(Fi);if(En(f,h).length!==f.length)return ue({result:{error:Se},stack:s})}let o=Rn({event:n})?.flightProfile,l=o?.flights?.map(({flightNumber:h})=>!isNaN(h)&&ri(h))?.filter(Boolean)||[],c=Math.max(0,...l)+1,u={drawId:r||lr(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),(o?.flights||[]).find(({drawId:h})=>h===u.drawId))return ue({result:{error:Eme},stack:s});let d=(o?.flights||[]).concat(u),p={name:qu,value:{...o||{},flights:d}};return Yg({event:n,extension:p})}var Lwe={};_i(Lwe,{drawMatic:()=>s7,garman:()=>Gwe,generateAdHocMatchUps:()=>rF,generateAdHocRounds:()=>a7,generateAndPopulatePlayoffStructures:()=>_6,generateCourts:()=>Y7,generateDrawDefinition:()=>F0,generateDrawMaticRound:()=>Y6,generateDrawStructuresAndLinks:()=>z6,generateDrawTypeAndModifyDrawDefinition:()=>q6,generateFlightProfile:()=>V5e,generateLineUps:()=>jwe,generateQualifyingStructure:()=>D6,generateSeedingScaleItems:()=>pwe,generateStatCrew:()=>j5e,generateVoluntaryConsolation:()=>Ybe,roundRobinGroups:()=>Kze});var B5e="splitLevelBased",Fwe="splitWaterfall",Bwe="splitShuttle",$5e={SPLIT_LEVEL_BASED:B5e,SPLIT_WATERFALL:Fwe,SPLIT_SHUTTLE:Bwe};function V5e(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:s,sortDescending:o,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Lr};let f=p.entries??[],{flightProfile:m}=Rn({event:p});if(m&&i&&!s)return{error:$4};let g=t.scaledEntries??$w({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:o,event:p,stage:h}).scaledEntries,v=g.map(Fi),y=co(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||Zy.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,w=Math.ceil(I/c),T=Ra(b,w);u===Fwe?T=qV(b,c):u===Bwe&&(T=qV(b,c,!0));function S(E){return(E||[]).map(({participantId:P,scaleValue:R})=>{let M=f.find(A=>A.participantId===P);return M?.scaleValue&&R&&(M.scaleValue=R),M}).sort((P,R)=>P.scaleValue-R.scaleValue).map((P,R)=>(P.scaleValue&&(P.seedNumber=R+1),P))}let D=yt(0,c).map(E=>{let P=E+1;return{flightNumber:P,drawId:d?.pop()??lr(),drawEntries:S(T[E]),drawName:l?.length&&l[E]||`${e} ${P}`}}),C={scaleAttributes:n,splitMethod:u,flights:D};if(i){let E=q7({flightProfile:C,deleteExisting:s,event:p});return{splitEntries:cc()&&T||void 0,...E}}else return{flightProfile:C,...oe}}function $we({json:t,tagName:e}){let i=Object.keys(t).filter(a=>Array.isArray(t[a])).map(a=>({key:a,value:t[a].filter(s=>typeof s=="object"&&Object.keys(s).length===1)})),r=Object.keys(t).filter(a=>typeof t[a]=="object"&&!Array.isArray(t[a])).map(a=>({key:a,value:t[a]})),n=Object.keys(t).filter(a=>["string","number"].includes(typeof t[a])).map(a=>({key:a,value:t[a]}));return Vwe({tagName:e,attributes:n,childArrays:i,childObjects:r})}function Vwe(t){let{tagName:e,attributes:i=[],childArrays:r=[],childObjects:n}=t,a=`\r
`,s=h=>{let f=Object.keys(h)[0],m=h[f];return{key:f,value:m}},o=r?.map(({key:h,value:f})=>Vwe({tagName:h,childObjects:f.map(s)})).join(`\r
`),l=n?.map(({key:h,value:f})=>$we({tagName:h,json:f??[]})).join(`\r
`),c=i?.map(({key:h,value:f})=>`${h}="${f}"`).join(" "),u=c?` ${c}`:"";if(e==="childArray")return l;let d=l?.length?`${a}${l}${a}`:"",p=o?.length?`${a}${o}${a}`:"";return`<${e}${u}>${d}${p}</${e}>`}function j5e(t){let e=Gt(t,[{[pa]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:s,matchUps:o,mappedMatchUps:l}=un({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),c=i.participants.filter(b=>b.participantType===hr),u=o?.filter(b=>b.matchUpType===hr)??[],d=u?.reduce((b,I)=>{let w=I?.tieMatchUps??[];return w&&[...b,...w]},[])??[],p=o?.filter(b=>b.matchUpType===wr)??[],h=o?.filter(b=>b.matchUpType===mr)??[],f=d.length===p.length+h.length,m=u.length===1&&f,g={mappedMatchUps:l,participantMap:s,tournamentName:a,tournamentId:n,tournament:f?"N":"Y",startDate:r},v=[],y=[];if(m){let b=u[0],{json:I,xml:w}=dX({teamParticipants:c,teamMatchUp:b,...g,doubles:h,singles:p});y.push(I),v.push(w)}else for(let b of u){let I=b?.sides?.map(({participant:D})=>D?.participantId).filter(Boolean);if(I?.length!==2)continue;let w=I.map(D=>D&&s?.[D]?.participant),{xml:T,json:S}=dX({doubles:b.tieMatchUps?.filter(D=>D.matchUpType===mr),singles:b.tieMatchUps?.filter(D=>D.matchUpType===wr),teamParticipants:w,teamMatchUp:b,...g});y.push(S),v.push(T)}return{json:y,xml:v,...oe}}function dX({teamParticipants:t,mappedMatchUps:e,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:s,startDate:o,doubles:l,singles:c}){let u=t?.find(I=>I.participantRoleResponsibilities?.includes("Home")),d=t?.filter(I=>I.participantId!==u?.participantId),p=Au(o,"/","MDY"),h=u?.participantName||d?.[1]?.participantName,f=u?.participantId||d?.[1]?.participantId,m=d?.[0]?.participantName,g=d?.[0]?.participantId,v={},y=t.map(I=>({team:{...z5e({teamParticipant:I,teamMatchUp:a,uniValues:v,participantMap:i,mappedMatchUps:e,homeid:f})}})),b=Ft({venue:{tournamentname:s?r:void 0,neutralgame:u?"N":"Y",gameid:n,officials:{},tournament:s,rules:{},homename:h,visname:m,homeid:f,visid:g,date:p},childArray:y,singles_matches:c?.map(I=>pX({matchUp:I,homeid:f,uniValues:v})),doubles_matches:l?.map(I=>pX({matchUp:I,homeid:f,uniValues:v}))});return{json:b,xml:$we({json:b,tagName:"tngame"})}}function G5e({homeid:t,uniValues:e,participant:i}){if(!i)return{};let r=i.individualParticipants?.length===2,n=r?yi(i.individualParticipants?.map(m=>m.teams?.[0]?.participantId)):[],a=r?yi(i.individualParticipants?.map(m=>m.teams?.[0]?.teamId)):[],s=!r&&i.teams?.[0]?.participantId||n?.length===1&&n[0]||void 0,o=!r&&i.teams?.[0]?.teamId||a?.length===1&&a[0]||s,l=r?void 0:i.participantName,c=i.individualParticipants?.[0]?.participantName,u=i.individualParticipants?.[1]?.participantName,d=t&&(s===t?"H":"V")||"",p=r?void 0:e[s][i.participantId],h=e[s][i.individualParticipants?.[0]?.participantId],f=e[s][i.individualParticipants?.[1]?.participantId];return Ft({vh:d,uni:p,uni_1:h,uni_2:f,team:o,name:l,name_1:c,name_2:u})}function H5e({sets:t,sideNumber:e}){return Object.assign({},...t?.map(i=>{let{setNumber:r,side1Score:n,side2Score:a,side1TiebreakScore:s,side2TiebreakScore:o}=i,l=`set_${r}`,c=`tie_${r}`,u=e===1?n:a,d=e===1?s:o;return{[l]:u,[c]:d}})??[])}function z5e({teamParticipant:t,teamMatchUp:e,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:s,participantName:o}=t,l=n&&(s===n?"H":"V")||"",c=i?.[s]?.matchUps,u=c&&Object.keys(c),d=e?.sides?.find(({participant:I})=>I.participantId===s)?.sideNumber,p=e?.score?.sets?.[0]?.[`side${d}Score`]??0;a[s]={};let h={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],m=[],g=0;for(let I of u??[]){let w=r?.[I],T=w.sides.find(({participant:D})=>D.participantId===s)?.sideNumber,S=w.score?.sets?.[0]?.[`side${T}Score`]??0;g+=S;for(let D of w.tieMatchUps??[]){let{matchUpType:C,winningSide:E}=D,P=E&&(E===T?"w":"l")||"";P&&(h[C][P]+=1);let R=P==="w"?"1":"0",M=P==="l"?"1":"0";if(C===wr){let A=m.length+1;m.push({singles_pair:{pair:A,won:R,lost:M,tied:"0"}})}else if(C===mr){let A=f.length+1;f.push({doubles_pair:{pair:A,won:R,lost:M,tied:"0"}})}}}let v=[{singles:{childArray:m,won:h.SINGLES.w,lost:h.SINGLES.l}},{doubles:{childArray:f,won:h.DOUBLES.w,lost:h.DOUBLES.l}}],y=[],b=1;for(let I of t.individualParticipantIds){let w=i?.[I];if(w){let{participant:T,counters:S}=w,D={won:S?.DOUBLES?.wins||0,lost:S?.DOUBLES?.losses||0},C={won:S?.SINGLES?.wins||0,lost:S?.SINGLES?.losses||0},{participantName:E,participantId:P}=T;a[s][P]=b,y.push({player:{name:E,uni:b,singles:C,doubles:D}})}b+=1}return{vh:l,id:s,name:o,score:p||g,totals:v,childArray:y}}function pX({matchUp:t,homeid:e,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:s}=t??{},o=s?.map(l=>{let{sideNumber:c,participant:u}=l,d=H5e({sets:t.score?.sets,sideNumber:c});return{[a===wr?"singles_score":"doubles_score"]:{...G5e({homeid:e,uniValues:i,participant:u}),...d}}});return{[a===wr?"singles_match":"doubles_match"]:{match:r,order:n,childArray:o}}}var q5e="DESC",Lj="DESC",W5e={ASC:"ASC",ASCENDING:"ASC",DESC:q5e,DESCENDING:Lj};function jwe(t){let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:s,attach:o,event:l}=t;if(l?.eventType!==_l)return{error:xh};if(!r)return{error:et};if(!e&&!n)return{error:lc};if(e=e??Zs({drawDefinition:n,event:l})?.tieFormat,Oo({tieFormat:e}).error)return{error:fh};if(typeof a!="object"&&!i)return{error:Se,context:{scaleAccessor:a}};let c={},u=(n?.entries??l?.entries??[]).filter(P=>P?.entryStatus===ol).map(Fi),{participants:d=[]}=un({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:P})=>u.includes(P)),h=P=>P===yg?"rankings":"ratings",f=l?.category?.categoryName??l?.category?.ageCategoryCode,{scaleName:m=f,scaleType:g=yg,sortOrder:v,accessor:y}=a||{},b=h(g),I=(P,R)=>{let M=P[b]?.[R];if(!M&&i&&(M=P[b]?.[Hb]),Array.isArray(M)){let A=M.find(N=>N.scaleName===m)?.scaleValue;if(vn(A))return A;if(y&&typeof A=="object")return A[y]}return 0},w=(P,R,M)=>{let A=v===Lj?R:P,N=v===Lj?P:R;return I(A,M)-I(N,M)},T=(P,R)=>w(P,R,Hb),S=(P,R)=>w(P,R,ly),D=[],C=e?.collectionDefinitions??[];for(let P of p){let R=P.individualParticipants?.sort(T)??[],M=s?R:P.individualParticipants?.sort(S)??[],A={};for(let k of C){let x=[],{collectionId:O,matchUpCount:V,matchUpType:F,gender:j}=k,q=On(Hb)(F);yt(0,V).forEach(W=>{let z=q?R:M??[],H=W+1,Z=[];yt(0,q?1:2).forEach(J=>{let ie=z?.find(K=>{let ne=Ns(j),le=ne&&(Sp(j)&&ne||tc(j)&&[Xn,ps][J]);return(!le||le===K.person?.sex)&&!x.includes(K.participantId)})?.participantId;ie&&(Z.push(ie),x.push(ie),A[ie]||(A[ie]=[]),A[ie].push({collectionPosition:H,collectionId:O}))}),q||D.push(Z)})}let N=Object.keys(A).map(k=>({collectionAssignments:A[k],participantId:k}));c[P.participantId]=N}let E=[];for(let P of D){let{participant:R}=Yu({tournamentParticipants:d,participantIds:P});if(!R){let M={individualParticipantIds:P,participantRole:vs,participantType:Ei};E.push(M)}}if(o){for(;E.length;)Rp({participant:E.pop(),tournamentRecord:r});nr({element:n,extension:{name:im,value:c}})}return{...oe,lineUps:c,participantsToAdd:E}}function Y7(t){if(!t)return{error:Yt};let e=Gt(t,[{dates:!1,[hs]:s=>Array.isArray(s)&&s.every(tl)},{uuids:!1,[hs]:s=>Array.isArray(s)&&s.every(Yr)},{startTime:!1,endTime:!1,[hs]:Z4},{idPrefix:!1,namePrefix:!1,[hs]:Yr},{count:!0,[hs]:vn}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&YT(i,r)||[],a=yt(1,t.count+1).map(s=>Ft({courtId:t.uuids?.pop()??(t.idPrefix&&`${t.idPrefix}-${s}`)??lr(),courtName:t.courtNames?.pop()??(t.namePrefix&&`${t.namePrefix} ${s}`),dateAvailability:n.map(o=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:o}))}));return{...oe,courts:a}}var Gwe={};_i(Gwe,{default:()=>Z5e,garman:()=>qwe});function $0({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Lh(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function jD(t){let e=Gt(t,[{courtDate:!0,_ofType:Zo}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Gn(r.startTime);(r.bookings||[]).filter(o=>!o.bookingType||!i.includes(o.bookingType)).sort((o,l)=>d_(o.startTime).localeCompare(d_(l.startTime))).forEach(o=>{let l={startTime:zr(a.toISOString()),endTime:o.startTime};Gn(o.startTime)>a&&n.push(l),Gn(o.endTime)>a&&(a=Gn(o.endTime))});let s={startTime:zr(a.toISOString()),endTime:r.endTime};return Gn(r.endTime)>a&&n.push(s),{timeSlots:n}}function Y5e({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=s=>{let{timeSlots:o}=jD({includeBookingTypes:e,courtDate:s});return!!o?.filter(a)?.length};function a(s){let o=Gn(s.startTime),l=Gn(s.endTime);return o>i||l<r?!1:VR(i,l)>=t}return{enoughTime:n}}function Hwe(t){let e=Gt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Rs}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,s=t.courts,o=Gn(n),l=J4(o,i),{enoughTime:c}=Y5e({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:o,periodEndTime:l});return{availableToScheduleCount:(s?.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=$0({date:a,court:u});return!!(d&&c(d))})||[]).length,...oe}}function AF(t){let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(a)||!a.length)return{error:Se,courts:a};if(!Array.isArray(s))return{error:o_};if(!tl(n))return{error:Ba};i&&(Array.isArray(i)?i.includes(n)&&(s=[]):s=[]);let{courtBookings:o,unassignedBookings:l}=s.reduce((p,h)=>{let{courtId:f}=h;return f?p.courtBookings[f]?p.courtBookings[f].push(h):p.courtBookings[f]=[h]:p.unassignedBookings.push(h),p},{courtBookings:{},unassignedBookings:[]}),c=a.map((p,h)=>{let{courtId:f,courtName:m}=p,g=o[f]||[],v=$0({date:n,court:p})||{},{bookings:y=[],startTime:b,endTime:I,date:w}=v,T=[e[h]&&{startTime:b,endTime:e[h]},...Et(y,!1,!0),...g].filter(Boolean);return{courtId:f,courtName:m,dateAvailability:{bookings:T,startTime:b,endTime:I,date:w}}});l.sort((p,h)=>Ji(p.startTime)-Ji(h.startTime));let u=()=>c.map(p=>{let h=p.dateAvailability,{timeSlots:f=[]}=jD({courtDate:h});return{courtName:p.courtName,courtId:p.courtId,timeSlots:f}}).flat(),d=[];for(let p of l){let{startTime:h,endTime:f,averageMinutes:m,recoveryMinutes:g,matchUpId:v}=p,y=Ji(h),b=Ji(f),I=u().reduce((w,{courtId:T,courtName:S,timeSlots:D})=>{let C;return D.find(({startTime:E,endTime:P})=>{C=Ji(E)-y;let R=y>=Ji(E);return b<=Ji(P)&&w.startDifference!==0&&((C===0||C+r>=0)&&(w.startDifference===void 0||C<w.startDifference)||R)})?{courtName:S,courtId:T,startDifference:C}:w},{});if(I.courtId){let w={averageMinutes:m,recoveryMinutes:g,matchUpId:v,startTime:h,endTime:f};d.push(w),c.find(({courtId:T})=>T===I.courtId)?.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:p})}return{virtualCourts:c.map(({courtId:p,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:p})),assignedBookings:d}}function _F({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function zwe(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return yt(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function uU({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,s)=>{let o=$0({date:t,court:s}),l=n&&(o?.[n]||s[n]);return l&&(!a||e&&Ji(l)<Ji(a)||i&&Ji(l)>Ji(a))?l:a},void 0)}function K5e({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||uU({courts:r,scheduleDate:n,startTime:!0}),i=i||uU({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let s=Gn(e),o=Gn(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=$0({court:l,date:n}),{timeSlots:u}=jD({courtDate:c});u?.forEach(d=>{let p=Gn(d.startTime),h=Gn(d.endTime);if(p>o||p<s||h<s)return!1;if(VR(p,h)>=t){let f=zr(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function K7(t){let e=Gt(t,[{courts:!0,_ofType:Rs}]);if(e.error)return e;let{date:i=K4(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:s}=t,{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||_F({averageMatchUpMinutes:c}),i=Ui(i),r=zr(r),n=zr(n);let h=0,f=0,m=0,g=0,v=0;!s&&d&&(s=zwe({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:y}=AF({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:s}),{firstTimeSlotStartTime:b}=K5e({averageMinutes:c,courts:y,startTime:r,endTime:n,date:i});o&&b&&(r=b??r);let I=Ji(r),w=Ji(n)-I,T=Math.floor(w/a),S=yt(0,T+1).map(D=>{let C=I+D*a,E=hGe(C),P=Hwe({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:R=0}=P,M=R>f?R-f:0;v+=D?R:0;let A=D?v/D:R,N=a*A/c,k=D?N*(D-1)+A:A,x=R?f&&k-h||M:0;h=k,f=R,m+=x;let O=ri(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:R,newCourts:M,totalMatchUps:g}});return{scheduleTimes:S.reduce((D,C)=>{let E=yt(0,C.add).map(()=>({scheduleTime:C.periodStart}));return D.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var qwe={getCourtsAvailableAtPeriodStart:Hwe,generateTimeSlots:jD,getScheduleTimes:K7,courtGenerator:zwe},Z5e=qwe,aP={};_i(aP,{isValid:()=>Al,isValidMatchUpFormat:()=>Al,parse:()=>js,stringify:()=>lL});var Wwe={};_i(Wwe,{allCompetitionMatchUps:()=>Cd,allDrawMatchUps:()=>po,allEventMatchUps:()=>nf,allTournamentMatchUps:()=>Wa,analyzeMatchUp:()=>xC,applyLineUps:()=>gSe,assignMatchUpSideParticipant:()=>Kwe,assignTieMatchUpParticipantId:()=>__,bulkMatchUpStatusUpdate:()=>pSe,calculateWinCriteria:()=>jw,checkInParticipant:()=>X7,checkMatchUpIsComplete:()=>Vv,checkOutParticipant:()=>Z7,competitionScheduleMatchUps:()=>L0,disableTieAutoCalc:()=>cSe,drawMatchUps:()=>_7,enableTieAutoCalc:()=>sSe,eventMatchUps:()=>DF,filterMatchUps:()=>Rf,findMatchUp:()=>y7,getAllDrawMatchUps:()=>qn,getAllStructureMatchUps:()=>ar,getCheckedInParticipantIds:()=>Mw,getCompetitionMatchUps:()=>OC,getEventMatchUpFormatTiming:()=>U7,getHomeParticipantId:()=>C7,getMatchUpCompetitiveProfile:()=>l0,getMatchUpContextIds:()=>R7,getMatchUpDailyLimits:()=>PF,getMatchUpDailyLimitsUpdate:()=>D7,getMatchUpDependencies:()=>id,getMatchUpFormat:()=>M7,getMatchUpFormatTiming:()=>c0,getMatchUpFormatTimingUpdate:()=>T7,getMatchUpScheduleDetails:()=>FL,getMatchUpType:()=>BL,getMatchUpsStats:()=>N7,getModifiedMatchUpFormatTiming:()=>UF,getParticipantResults:()=>D0,getPredictiveAccuracy:()=>P7,getRoundMatchUps:()=>vo,getRounds:()=>A7,isValidMatchUpFormat:()=>Al,matchUpActions:()=>tF,mutate:()=>Ywe,participantScheduledMatchUps:()=>E7,query:()=>nwe,removeDelegatedOutcome:()=>oSe,removeMatchUpSideParticipant:()=>e8,removeTieMatchUpParticipantId:()=>Xwe,replaceTieMatchUpParticipantId:()=>Q7,resetAdHocMatchUps:()=>fSe,resetMatchUpLineUps:()=>o8,resetScorecard:()=>c8,resetTieFormat:()=>l8,setDelegatedOutcome:()=>hSe,setMatchUpFormat:()=>uSe,setMatchUpStatus:()=>V0,setOrderOfFinish:()=>mSe,substituteParticipant:()=>lSe,tallyParticipantResults:()=>xD,toggleParticipantCheckInState:()=>kF,tournamentMatchUps:()=>EF,updateTieMatchUpScore:()=>Em,validMatchUp:()=>_L,validMatchUps:()=>iu});var Ywe={};_i(Ywe,{applyLineUps:()=>gSe,assignMatchUpSideParticipant:()=>Kwe,assignTieMatchUpParticipantId:()=>__,bulkMatchUpStatusUpdate:()=>pSe,checkInParticipant:()=>X7,checkOutParticipant:()=>Z7,disableTieAutoCalc:()=>cSe,enableTieAutoCalc:()=>sSe,findMatchUp:()=>y7,removeDelegatedOutcome:()=>oSe,removeMatchUpSideParticipant:()=>e8,removeTieMatchUpParticipantId:()=>Xwe,replaceTieMatchUpParticipantId:()=>Q7,resetAdHocMatchUps:()=>fSe,resetMatchUpLineUps:()=>o8,resetScorecard:()=>c8,resetTieFormat:()=>l8,setDelegatedOutcome:()=>hSe,setMatchUpFormat:()=>uSe,setMatchUpStatus:()=>V0,setOrderOfFinish:()=>mSe,substituteParticipant:()=>lSe,toggleParticipantCheckInState:()=>kF,updateTieMatchUpScore:()=>Em});function Kwe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&typeof i!="string")return{error:Ed};if(!e)return{error:At};if(!n)return{error:eo};let s=r===void 0;if(s&&(r=1),![1,2].includes(r))return ue({result:{error:Se,context:{sideNumber:r}}});let{matchUp:o,structure:l}=qr({drawDefinition:e,matchUpId:n,event:a});if(!o)return{error:Ls};if(!(!l?.structures&&!(e.drawType&&e.drawType!==kl)&&!l?.matchUps?.find(({roundPosition:c})=>!!c)))return{error:y4};if(!i&&(o?.score?.scoreStringSide1||la.includes(o?.matchUpstatus)||o?.matchUpStatus&&[ln,ra].includes(o.matchUpStatus)))return{error:Zx,info:"matchUp has completed status or score"};if(o){if(o.sides=[1,2].map(c=>{let u=o.sides?.find(d=>d.sideNumber===c)??{sideNumber:c};return r===c?{...u,participantId:i}:u}),s)for(let c of o.sides)c.sideNumber&&(c.sideNumber=3-c.sideNumber);Hi({tournamentId:t?.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:o})}return{...oe,sidesSwapped:s}}function Ll({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s,event:o}){let{matchUp:l}=qr({drawDefinition:r,event:o,matchUpId:a});if(!l)return{error:Ls};let c=Vp({removePriorValues:t,element:l,duplicateValues:i,timeItem:s});return n||Hi({tournamentId:e?.tournamentId,eventId:o?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function Z7(t){let e=[{[pa]:!0},{[Gs]:!0},{[jh]:!0},{[Fp]:!0}],i=Gt(t,e);if(i.error)return i;let r=FD(t,[{[TD]:ef,attr:{[gL]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&w5.includes(c)||c&&la.includes(c)||ua({score:u}))return{error:Nfe};let d=Mw({matchUp:l});if(d?.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!h?.includes(s))return{error:Ed};if(!p?.includes(s))return{error:sme};let f=xve({matchUp:l});if(f?.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m?.indexOf(s);return v!==void 0&&[0,1].includes(v)&&(g?.[v]??[]).forEach(y=>{Ll({drawDefinition:a,matchUpId:o,timeItem:{itemType:b_,itemValue:y}})}),Ll({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:b_}}),{...oe,checkedOut:!0}}function X7(t){let e=[{[pa]:!0},{[Gs]:!0},{[jh]:!0},{[Fp]:!0}],i=Gt(t,e);if(i[ku])return i;let r=FD(t,[{[TD]:ef,attr:{[gL]:!0}}]);if(r[ku])return r;let{tournamentRecord:n,drawDefinition:a,participantId:s,matchUpId:o}=t,l=Mw({matchUp:r?.matchUp?.matchUp});if(l?.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!u?.includes(s))return{[ku]:Ed};let d={...oe,checkedIn:!0};return c?.includes(s)||Ll({tournamentRecord:n,drawDefinition:a,matchUpId:o,timeItem:{itemValue:s,itemType:y_}}),d}function kF(t){let e=Gt(t,[{[jh]:!0,[Gs]:!0,[Fp]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&t.tournamentRecords?.[i]);if(!r)return{error:et};let n=FD(t,[{[TD]:ef,attr:{[gL]:!0},[ku]:Ls}]).matchUp?.matchUp;if(!n)return{error:Ls};let{checkedInParticipantIds:a=[]}=Mw({matchUp:n}),{participantId:s,matchUpId:o,drawDefinition:l}=t;return s&&a.includes(s)?Z7({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n}):X7({tournamentRecord:r,drawDefinition:l,participantId:s,matchUpId:o,matchUp:n})}function J7({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){if(!t)return{error:et};if(!e)return{error:Nd};if(!r)return{error:Vc};let n=rs({drawDefinition:e}),{matchUp:a}=qr({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:Ls};let{matchUp:s,structure:o}=qr({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!s)return{error:Ls};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=s;if(p&&!Hx([wr,mr],p))return{error:al};let{positionAssignments:h}=Tr({structure:o}),f=h?.filter(T=>c?.includes(T.drawPosition)),{matchUp:m}=qr({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=m?.sides?.map(Fi)??[],v=f?.map(Fi)??[],y=[...g,...v],{participants:b}=un({tournamentRecord:t,participantFilters:{participantTypes:[hr],participantIds:y}}),{matchUp:I}=qr({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),w=Zs({matchUp:m,drawDefinition:e,structure:o,event:r})?.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:s,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:w,structure:o,...oe}}function Q7(t){let e=J7(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:s,substitution:o,event:l}=t;if(!r||!a)return ue({result:{error:oa},stack:i});if(r===a)return{...oe};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u?.matchUpType,v=u?.sides?.find(O=>O.participant?.participantId===r||O.participant?.individualParticipantIds?.includes(r));if(!v)return{error:_n};let y=un({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(y.length!==2)return ue({result:{error:oa},stack:i});if(y[0].participantType!==y[1].participantType)return ue({result:{error:Pd},stack:i});let{appliedPolicies:b}=er({tournamentRecord:n,drawDefinition:s,event:l}),I=t.policyDefinitions?.[Va]??b?.[Va]??AD[Va],w=y.find(({participantId:O})=>O===a);if((t.enforceGender??I?.participants?.enforceGender)!==!1&&Sp(u?.gender)&&Ns(u?.gender)!==Ns(w?.person?.sex))return{error:gw,info:"Gender mismatch"};let T=I?.processCodes?.substitution;P0({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:s,dualMatchUp:h});let S=h?.sides?.find(({sideNumber:O})=>O===v.sideNumber);if(!S)return ue({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:za},stack:i});if(u?.sides?.flatMap(O=>O.participant?.individualParticipantIds||O.participant?.participantId||[])?.includes(a))return ue({result:{error:Jx},stack:i});let D=c?.sides?.find(({sideNumber:O})=>O===v.sideNumber)?.participantId,C=S.lineUp,E=C?.find(({participantId:O})=>a===O),P=C?.reduce((O,V)=>V.substitutionOrder>O?V.substitutionOrder:O,0),R=C?.map(O=>{let V=Et(O,!1,!0);if(![r,a].includes(V.participantId))return V;if(!o&&[r,a].includes(V.participantId)&&(V.collectionAssignments=V.collectionAssignments?.filter(F=>!(F.collectionPosition===d&&F.collectionId===p))),o&&r===V.participantId&&(V.collectionAssignments=V.collectionAssignments.map(F=>F.collectionPosition===d&&F.collectionId===p&&F.substitutionOrder===void 0?{...F,substitutionOrder:P}:F)),V.participantId===a){V.collectionAssignments||(V.collectionAssignments=[]);let F={collectionId:p,collectionPosition:d};o&&(F.previousParticipantId=r,F.substitutionOrder=(P??0)+1),V.collectionAssignments.push(F)}return V})??[];if(!E){let O={collectionId:p,collectionPosition:d};o&&(O.substitutionOrder=(P??0)+1,O.previousParticipantId=r);let V={collectionAssignments:[O],participantId:a};R.push(V)}let M=g===mr,{assignedParticipantIds:A}=I_({lineUp:C,collectionPosition:d,collectionId:p}),{assignedParticipantIds:N}=I_({lineUp:R,collectionPosition:d,collectionId:p});if(S.lineUp=R,D&&m){let O=Lw({participantId:D,lineUp:R,drawDefinition:s,tieFormat:m});if(O.error)return ue({result:O,stack:i})}else console.log("team participantId not found");let k,x;if(M){let{tournamentRecord:O}=t,V=Yu({participantIds:N,tournamentRecord:O});if(!V.participant){let j=Rp({returnParticipant:!0,pairOverride:!0,tournamentRecord:O,participant:{participantRole:vs,individualParticipantIds:N,participantType:Ei}});if(j.error)return ue({result:j,stack:i});k=j.participant?.participantId}V=Yu({participantIds:A,tournamentRecord:O});let F=V.participant?.participantId;F&&Ow({participantIds:[F],tournamentRecord:O}).success&&(x=F)}if(o||v.substitutions?.length===1){if(o)T&&f&&(f.processCodes=yi([...f?.processCodes??[],...T]));else for(let O of T||[]){let V=f?.processCodes?.lastIndexOf(O);V!==void 0&&f?.processCodes?.splice(V,1)}f&&Hi({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:s})}return h&&Hi({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:s}),{...oe,modifiedLineUp:R,participantRemoved:x,participantAdded:k}}function Zwe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!t||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:Se};let s=i?.lineUp||my({participantId:e,drawDefinition:r})?.lineUp,o=[],l=[];return{modifiedLineUp:s?.map(c=>{if(!n.includes(c.participantId))return c;let u=c.collectionAssignments?.filter(d=>{let p=d.collectionId===a&&d.collectionPosition===t;return p&&(d.previousParticipantId&&o.push(d.previousParticipantId),l.push({participantId:c.participantId,...d})),!p});return{participantId:c.participantId,collectionAssignments:u}}).filter(Boolean)||[],assignmentsRemoved:l,previousParticipantIds:o}}function X5e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r=(i.events||[]).filter(a=>a?.eventType===ta&&a?.entries?.some(s=>s.participantId===e)),n=a=>!t.includes(a.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:s}=Rn({event:a});s?.flights?.forEach(o=>{o.drawEntries=(o.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(o=>{o.entries=(o.entries||[]).filter(n)})}return{...oe}}function OF({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ue({result:{error:et},stack:n});if(!e||!t)return ue({result:{error:Yt},stack:n});let a=r.participants??[],s=a.find(d=>d.participantId===e);if(!s)return ue({result:{error:_n},stack:n});if(s?.participantType&&![hr,vc].includes(s.participantType))return ue({context:{participantType:s.participantType},result:{error:Pd},stack:n});let o=t.filter(d=>a.find(p=>p.participantId===d)?.participantType!==Bi);if(o.length)return ue({result:{error:wl,invalidParticipantIds:o},stack:n});s.individualParticipantIds||(s.individualParticipantIds=[]);let l=s.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&jL({individualParticipantIds:c,tournamentRecord:r}),s.individualParticipantIds=s.individualParticipantIds.concat(...c));let{topics:u}=Jc();if(u.includes(Ss)){let d=a.find(({participantId:p})=>p===e);Ii({topic:Ss,payload:{participants:[d]}})}return X5e({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Et(s,!1,!0),added:c.length,...oe}}function xF(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:s}=t;if(!n)return{error:et};if(!s)return{error:vw};if(!s.participantId)return Rp({tournamentRecord:n,participant:s});let{participant:o}=Zg({participantId:s.participantId,tournamentRecord:n});if(!o)return Rp({tournamentRecord:n,participant:s});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=s;if(h&&o.participantType!==h)return{error:Qfe};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),u&&Yr(u)&&(v.participantOtherName=u),d&&Yr(d)&&(v.participantName=d),Array.isArray(c)){let{participants:y}=un({participantFilters:{participantTypes:[Bi]},tournamentRecord:n}),b=y?.map(Fi);if(b){let I=c.filter(w=>Yr(w)&&b.includes(w));([vc,kr].includes(h||o.participantType)||h===Ei&&(I.length===2||a))&&(v.individualParticipantIds=I),o.participantType===eP.PAIR&&e&&(v.participantName=J5e({individualParticipants:y,newValues:v}))}}return Object.keys(r6).includes(p)&&(v.participantRole=p),Object.keys(eP).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),o.participantType===eP.INDIVIDUAL&&g&&Q5e({updateParticipantName:e,existingParticipant:o,newValues:v,person:g}),Object.assign(o,Ft(v)),i&&OF({individualParticipantIds:[o.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),Ii({topic:Ss,payload:{tournamentId:n.tournamentId,participants:[o]}}),{participant:Et(o),...oe}}function J5e({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n?.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function Q5e({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:s,nationalityCode:o,personId:l,birthdate:c,tennisId:u,sex:d}=r;d&&Object.keys(W4).includes(d)&&(n.sex=d);let p;if(Yr(l)&&(n.personId=l),o&&Yr(o)&&(e6e(o)||o==="")&&(n.nationalityCode=o),a&&typeof Yr(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),s&&typeof Yr(s)&&s.length>1&&(n.standardGivenName=s,p=!0),p&&t){let h=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=h}c&&tl(c)&&(n.birthdate=c),u&&Yr(u)&&(n.tennisId=u),Object.assign(e.person,n)}function e6e(t){return ng.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function __(t){let e=J7(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:s,event:o}=t;if(!s)return ue({result:{error:oa},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ue({result:{error:C4},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if(c?.sides?.flatMap(F=>F.participant?.individualParticipantIds||F.participant?.participantId||[])?.includes(s))return ue({result:{...oe},stack:i});r=r??(t.sideNumber?l?.sides?.find(F=>F.sideNumber===t.sideNumber)?.participantId:void 0);let v=un({participantFilters:{participantIds:[s]},tournamentRecord:n})?.participants?.[0];if(!v)return ue({result:{error:_n},stack:i});let{appliedPolicies:y}=er({tournamentRecord:n,drawDefinition:a,event:o}),b=t.policyDefinitions?.[Va]??y?.[Va]??AD[Va];if((t.enforceGender??b?.participants?.enforceGender)!==!1&&Sp(c?.gender)&&Ns(c?.gender)!==Ns(v.person?.sex))return{error:gw,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:w}=v;if(On(wr)(f)&&w!==Bi)return{error:Pd};let T=w===Bi?[s]:I,S=r&&p?.find(({participantId:F})=>F===r)||p?.find(({individualParticipantIds:F})=>go(T,F));if(!S)return{error:F4};if(r||(r=S.participantId),!r)return{error:_n};let D=u?.find(F=>F.participantId===S?.participantId)?.drawPosition,C=m?.sides?.find(F=>F.participantId===r)?.sideNumber,E=c?.sides?.find(F=>D&&F.drawPosition===D)?.sideNumber,P=C??E??t.sideNumber;if(!g)return{error:vD};if(!g.collectionDefinitions?.find(F=>F.collectionId===h))return{error:Hfe};P0({tournamentId:n.tournamentId,eventId:o.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=m?.sides?.find(F=>F.sideNumber===P),M=c?.sides?.find(F=>F.sideNumber===P),A=(R?.lineUp??my({participantId:r,drawDefinition:a})?.lineUp)?.filter(F=>F.collectionAssignments?.find(j=>j.collectionPosition===d&&j.collectionId===h&&!j.previousParticipantId))?.map(F=>F?.participantId),N=A?.length>1&&A||(w===Ei?v.individualParticipantIds:[s]),k=Zwe({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:R,drawDefinition:a,participantIds:N,collectionId:h});if(k.error)return ue({result:k,stack:i});let{modifiedLineUp:x}=k,O;if(f===mr){if(w!==Ei){let F=vB({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return ue({result:F,stack:i});if(F=V({side:M}),F.error)return F;O=F.deletedParticipantId,R&&(R.lineUp=x),m&&Hi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(w===Ei)for(let F of N)vB({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:F,collectionId:h,tieFormat:g})}else{let F=vB({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:x,participantId:s,collectionId:h,tieFormat:g});if(F?.error)return F}if(R&&(R.lineUp=x),m&&Hi({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:a}),O){let{error:F}=Ow({participantIds:[O],tournamentRecord:n});F&&console.log("cleanup")}return{...oe,modifiedLineUp:x};function V({side:F}){let j;if(F.participant){let q=F.participant.individualParticipantIds||[];if(q.filter(Boolean).length===1){let{participant:W}=Yu({participantIds:q,tournamentRecord:n});q.push(s);let{participant:z}=Yu({participantIds:q,tournamentRecord:n});if(!z&&W){W.individualParticipantIds=q;let H=xF({pairOverride:!0,tournamentRecord:n,participant:W});if(H.error)return H}else j=W?.participantId}}else{let q=Rp({participant:{individualParticipantIds:[s],participantRole:vs,participantType:Ei},pairOverride:!0,tournamentRecord:n});if(q.error)return q}return{...oe,deletedParticipantId:j}}}function vB({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:s}){let o=my({participantId:e,drawDefinition:i})?.lineUp,l=(r||o)?.find(u=>u?.participantId===n),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let u={collectionAssignments:[c],participantId:n};r.push(u)}return Lw({participantId:e,lineUp:r,drawDefinition:i,tieFormat:s})}function Xwe(t){let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return ue({result:{error:oa},stack:a});let s=J7(t);if(s.error)return s;let{appliedPolicies:o}=er({tournamentRecord:e,drawDefinition:i,event:n}),l=(t.policyDefinitions?.[Va]??o?.[Va]??AD[Va])?.processCodes?.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=s;if(!g)return ue({result:{error:ko},stack:a});let b=u?.sides?.find(P=>P.participant?.participantId===r||P.participant?.individualParticipantIds?.includes(r));if(!b)return ue({result:{error:_n},stack:a});let I=t.policyDefinitions?.[Gc]??o?.[Gc];if(!b.substitutions?.length&&(ua({score:u?.score})||u?.winningSide)&&I?.requireParticipantsForScoring!==!1)return ue({result:{error:Pme},stack:a});let w=c?.sides?.find(({sideNumber:P})=>P===b.sideNumber)?.participantId;if(!w)return ue({result:{error:_n},stack:a});let T=un({participantFilters:{participantIds:[r]},tournamentRecord:e})?.participants?.[0];if(!T)return ue({result:{error:_n},stack:a});if(m===wr&&T.participantType===Ei)return ue({result:{error:gw},stack:a});let S=T.participantType===Bi?[r]:T.individualParticipantIds;P0({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let D=g.sides?.find(({sideNumber:P})=>P===b.sideNumber);if(!D&&(g.sides?.filter(({lineUp:P})=>!P).length||0)<2){let P=h?.map(({participantId:R})=>({drawPosition:d?.find(M=>M.participantId===R)?.drawPosition,teamParticipantId:R}));D=g.sides?.find(R=>P?.find(({drawPosition:M})=>M===R.drawPosition)?.teamParticipantId===w)}if(!D)return ue({result:{error:_n,context:{participantId:r}}});let{modifiedLineUp:C,previousParticipantIds:E}=Zwe({collectionPosition:p,teamParticipantId:w,dualMatchUpSide:D,participantIds:S,drawDefinition:i,collectionId:f});if(D.lineUp=C,w&&y&&Lw({participantId:w,lineUp:C,drawDefinition:i,tieFormat:y}),m===mr&&T.participantType===Bi){let P=u?.sides?.find(A=>A.sideNumber===D?.sideNumber),{participantId:R}=P??{},M=R&&un({participantFilters:{participantIds:[R]},tournamentRecord:e,withDraws:!0})?.participants?.[0];if(M){let A=M?.individualParticipantIds?.filter(N=>N!==r)??[];if(E&&A.push(...E),A.length>2)return ue({result:{error:wl},stack:a});if(M.draws?.length){if(A.length===1){let{participant:N}=Yu({participantIds:A,tournamentRecord:e});if(!N){let k=Rp({participant:{participantRole:vs,individualParticipantIds:A,participantType:Ei},pairOverride:!0,tournamentRecord:e});if(k.error)return ue({result:k,stack:a})}}}else if(A.length){M.individualParticipantIds=A;let N=xF({participant:M,pairOverride:!0,tournamentRecord:e});if(N.error)return ue({result:N,stack:a})}else{let N=Ow({participantIds:[R],tournamentRecord:e});N.error&&console.log("cleanup",{result:N})}}else return ue({result:{error:_n},stack:a})}if(b.substitutions?.length===1&&!u?.sides?.find(P=>P.sideNumber!==b.sideNumber)?.substitutions?.length&&v?.processCodes?.length){for(let P of l||[]){let R=v.processCodes.lastIndexOf(P);v.processCodes.splice(R,1)}Hi({tournamentId:e?.tournamentId,matchUp:v,context:a,drawDefinition:i})}return Hi({tournamentId:e?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...oe,modifiedLineUp:C}}function e8(t){let e=Gt(t,[{[pa]:!0,[Gs]:!0,[Fp]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:Se,sideNumber:r};let{matchUp:s,structure:o}=qr({drawDefinition:i,matchUpId:n,event:a});return s?xo({structure:o})?(s.sides?.forEach(l=>{(!r||l.sideNumber===r)&&delete l.participantId}),Hi({tournamentId:t.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:s}),{...oe}):{error:y4}:{error:Ls}}function t6e({matchUpStatuses:t=["BYE",Fr,br],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){let n=e?.reduce((u,d)=>!u||d.roundNumber>u.roundNumber?d:u,void 0),a=n?.drawPositions?.find(u=>u!==i),s=r.filter(u=>u?.drawPositions?.includes(a)).map(u=>u.matchUpStatus),o=r.filter(u=>u?.drawPositions?.includes(i)).map(u=>u.matchUpStatus),l=go(s||[],t),c=go(o||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:o}}function i6e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:s,dualMatchUp:o,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=oi({drawDefinition:a,structureId:s});if(d?.structureType===To)return{...oe};c=c??rs({drawDefinition:a});let p=(c?.mappedMatchUps||{})[s].matchUps,{initialRoundNumber:h}=DI({drawPosition:i,matchUps:p}),f=p?.filter(g=>g.roundNumber>=l&&g.roundNumber!==h&&g.drawPositions?.includes(i)),{positionAssignments:m}=Tr({drawDefinition:a,structureId:s});for(let g of f??[])r6e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:o,matchUpsMap:c,matchUp:g,event:u});return{...oe}}function r6e({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:o,matchUpsMap:l,matchUp:c,event:u}){let d="removeSubsequentDrawPosition";if(o){let h=t.find(({matchUpId:m})=>c.matchUpId===m).sides?.find(m=>m.drawPosition===r)?.sideNumber,f=c.sides?.find(m=>m.sideNumber===h);f&&delete f.lineUp}c.drawPositions=(c.drawPositions||[]).map(h=>h===r?void 0:h).filter(Boolean);let p=e.filter(({drawPosition:h})=>c.drawPositions?.includes(h)).filter(h=>h.bye).length;return c.matchUpStatus=p&&"BYE"||_s(c.matchUpStatus)&&c.matchUpStatus||Pn,_s(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Sye({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Hi({tournamentId:n?.tournamentId,eventId:u?.eventId,context:`${d}-${r}`,drawDefinition:s,matchUp:c}),{...oe}}function GD(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:s,dualMatchUp:o,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=xo({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:_R};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:w}}=l,T=lp({...t,matchUpStatus:a||Pn,removeWinningSide:!0});if(T.error)return T;let S;if(p){let{matchUpTieId:x,matchUpsMap:O}=t;if(S=Em({appliedPolicies:t.appliedPolicies,matchUpId:x,tournamentRecord:r,drawDefinition:n,matchUpsMap:O,event:d}),!e&&!S.removeWinningSide)return{...oe}}if(h)return{...oe};let{matchUps:D}=ar({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:s,structure:u}),{positionAssignments:C}=ca({structure:u}),E=m-1,P=1-E,R=f[E],M=f[P],{winnerParticipantId:A,loserParticipantId:N}=C?.reduce((x,O)=>(O.drawPosition===M&&(x.loserParticipantId=O.participantId),O.drawPosition===R&&(x.winnerParticipantId=O.participantId),x),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},k=D.filter(x=>x.drawPositions?.includes(M));if(I&&Jwe({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:s}),b){let{winnerHadMatchUpStatus:x}=t6e({drawPositionMatchUps:k,loserDrawPosition:M,sourceMatchUps:D}),O=g.linkCondition===Dp;if(x&&O){let F=Math.min(...b.drawPositions);Fj({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:s,event:d})}let V=n6e({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:N,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:b,dualMatchUp:o,matchUpsMap:s,event:d});if(V.error)return V}if(w){let x=Math.min(...w.drawPositions);Fj({targetLink:y,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:x,matchUpsMap:s,event:d})}return{...oe,...S&&{tieMatchUpResult:S}}}function Jwe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:o,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let m=a.target.structureId,{structure:g}=oi({drawDefinition:o,structureId:m});if(!g)return{error:en};let{positionAssignments:v}=ca({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(S=>S.participantId!==r);let y=v?.find(S=>S.participantId===r)?.drawPosition,{matchUps:b}=ar({drawDefinition:o,structure:g,event:d}),I=b.map(S=>S.drawPositions).flat(1/0).filter(Boolean),w=Nl(I);if((y?w[y]:void 0)===1)v?.forEach(S=>{S.participantId===r&&delete S.participantId});else{let S=b.filter(({drawPositions:D})=>D.includes(y));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:S,winnerTargetLink:a})}let T=c?.drawMatchUps?.find(({matchUpId:S})=>S===l.matchUpId);T&&Hi({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:T,context:f,drawDefinition:o})}return h&&i6e({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:s,drawDefinition:o,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...oe}}function n6e({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,dualMatchUp:l,event:c}){let u="removeDirectedLoser",d=r.target.structureId,{structure:p}=oi({drawDefinition:a,structureId:d});if(!p)return{error:en};let{positionAssignments:h}=ca({structure:p}),f=h?.find(m=>m.participantId===e)?.drawPosition;if(h?.forEach(m=>{m.participantId===e&&delete m.participantId}),n&&t){let m=o?.drawMatchUps?.find(({matchUpId:g})=>g===s.matchUpId);m.matchUpStatusCodes=t===ln?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(m=>m.participantId!==e),l){let m=s?.sides.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0),g=o?.drawMatchUps?.find(({matchUpId:y})=>y===s.matchUpId),v=g?.sides?.[m];v&&(delete v.lineUp,Hi({tournamentId:i?.tournamentId,eventId:c?.eventId,matchUp:g,context:u,drawDefinition:a}))}return{...oe}}function Fj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:s}){let o=a.target.structureId,l="removeDirectedBye";Sl({color:"brightyellow",method:l,drawPosition:r});let c=f0({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:o,event:s});return ue({result:c,stack:l})}function a6e(t){let{matchUpFormat:e,score:i}=t,r=i?.sets?.length,n=e&&js(e),{setFormat:a,finalSetFormat:s,bestOf:o}=n??{};return(o&&r===o&&s||a)?.timed||!1}function s6e({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return ue({result:{error:gD},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=ca({structure:i}),s=a?.filter(o=>o.bye).map(o=>o.drawPosition);return r.drawPositions?.some(o=>s?.includes(o))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Hi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...oe}):ue({result:{error:Gfe},info:"matchUp does not include BYE",stack:n})}function sP(t){let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:s,event:o}=t,l="doubleExitAdvancement";if(s.structureType===To)return ue({result:{...oe},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u,m=_s(p?.matchUpStatus)&&!p.sides?.map(v=>v.participantId??v.participant).filter(Boolean).length,g=p?.matchUpStatus===ln;if(p&&p.matchUpStatus!=="BYE"){let{loserTargetLink:v}=d;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let y=Qwe({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:v,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:o});if(y.error)return ue({result:y,stack:l})}else if(!g){let{feedRound:y,drawPositions:b,matchUpId:I}=p,w=y?2:2-b.indexOf(f);w=m?p.winningSide:w;let T=hX({...t,targetMatchUp:p,walkoverWinningSide:w,tournamentRecord:e,sourceMatchUp:c,matchUpId:I});if(T.error)return ue({result:T,stack:l})}}if(h){let v=hX({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(v.error)return ue({result:v,stack:l})}return ue({result:{...oe},stack:l})}function hX(t){let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s}=t,o=r.structures.find(({structureId:H})=>H===a.structureId),l=t.matchUpStatus===ra?ra:ln,c=t.matchUpStatus===ra?br:Fr,u="conditionallyAdvanceDrawPosition",d=s.drawMatchUps.find(H=>H.matchUpId===a.matchUpId);if(!d)return{error:ko};let p=n?.drawPositions||[],h=d.drawPositions?.filter(Boolean),f=n?.structureId===a.structureId;if(f&&go(p,h)&&(h=h.filter(H=>!p.includes(H))),f&&h.length>1)return ue({result:{error:qT},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=Iye(t),v=yo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:w,loserMatchUp:T}=y;if(T){let{loserTargetLink:H}=b,Z=Qwe({loserTargetDrawPosition:I,loserMatchUp:T,tournamentRecord:i,loserTargetLink:H,drawDefinition:r,matchUpsMap:s});if(Z.error)return ue({result:Z,stack:u})}let S=d.drawPositions?.filter(Boolean)||[],D=S.length===1,C=t.walkoverWinningSide||D&&BN({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=_s(d.matchUpStatus)&&!S.length,P=d.finishingRound===1,R=E&&!P?l:c,M=e.find(H=>H.matchUpId===g.matchUpId),A=[],N;n&&(n?.structureId===M?.structureId?n.roundPosition<g?.roundPosition?N=1:N=2:a.feedRound?n.structureId===a.structureId?N=2:N=1:C&&(N=3-C));let k=t.matchUpStatus,x=g?.matchUpStatus;N===1?A=[{matchUpStatus:RM(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:RM(x),previousMatchUpStatus:x,sideNumber:2}]:N===2&&(A=[{matchUpStatus:RM(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:RM(k),previousMatchUpStatus:k,sideNumber:2}]),A.length&&(A=A.map(H=>Ft(H)));let O=lp({...t,winningSide:C,matchUp:d,matchUpStatusCodes:A,matchUpStatus:R});if(O.error)return ue({result:O,stack:u});if(E)return sP({...t,matchUpStatus:R,targetData:v});if(!w)return ue({result:{...oe},stack:u});let V=h.length===2?h[C-1]:h[0],{positionAssignments:F}=Tr({structure:o}),j=F?.find(H=>H.drawPosition===V),q=s.drawMatchUps.find(H=>H.matchUpId===w.matchUpId),W=q?.drawPositions?.filter(Boolean),z=W.length===1;if(V){if(j?.bye){let H=yo({matchUpId:q.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(z){let Z=W.filter(Boolean)[0],J=BN({drawPosition:Z,matchUpId:q.matchUpId,inContextDrawMatchUps:e}),ie=lp({appliedPolicies:t.appliedPolicies,matchUpId:q.matchUpId,matchUp:q,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:J});return ie.error?ue({result:ie,stack:u}):J5({drawPositionToAdvance:Z,matchUpId:q.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}else if(_s(w.matchUpStatus)){let Z=sP({...t,matchUpId:q.matchUpId,matchUpStatus:R,targetData:H});if(Z.error)return ue({result:Z,stack:u})}return ue({result:{...oe},stack:u})}return Yb({matchUpId:w.matchUpId,drawPosition:V,inContextDrawMatchUps:e,drawDefinition:r})}else if(m){if(!q)return{error:ko};if(z){let J=W[0],ie=BN({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:J});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let H=_s(q.matchUpStatus)?c:l,Z=lp({matchUpId:q.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:q,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:H});if(Z.error)return ue({result:Z,stack:u});if(H===l){let J=sP({...t,matchUpId:a.matchUpId,matchUpStatus:H,targetData:v});if(J.error)return J}}return ue({result:{...oe},stack:u})}function Qwe(t){let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:s,loserMatchUp:o}=t,l=r?.target?.structureId,{structure:c}=oi({drawDefinition:n,structureId:l});return c?bc({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:l,matchUpsMap:a,loserMatchUp:o,event:s}):{error:jy}}function RM(t){return t===ln?Fr:t===ra?br:t}function o6e(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,s=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),o="attemptToSetMatchUpStatus",l=r==="BYE",c=a.winningSide,u=[ln,ra].includes(r),d=p0({matchUpStatus:r}),p=yj({matchUpStatus:r}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>lp({...t,removeScore:[$p,Fr].includes(r),matchUpStatus:r||Pn});return h&&{error:JV}||f&&HN(t)||m&&l6e(t)||c&&GD(t)||p&&g()||l&&s6e({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:JV}||u&&c6e(t)||s&&HN(t)||t.propagateExitStatus&&HN(t)||ue({result:{error:gD,info:"matchUpStatus: "+r},stack:o})}function l6e(t){let e=GD(t);return e.error?e:sP(t)}function c6e(t){let e=HN({...t,removeScore:!0});return e.error?e:sP(t)}function HN(t){let e="scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide){let n=GD(t);if(n.error)return ue({result:n,stack:e})}let i=!!t.matchUp.collectionId,r=lp({...t});if(i){let{matchUpTieId:n,drawDefinition:a,matchUpsMap:s}=t,o=Em({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,event:t.event,drawDefinition:a,matchUpsMap:s});if(o.error)return ue({result:o,stack:e});Object.assign(r,{tieMatchUpResult:o})}return ue({result:r,stack:e})}function u6e({drawDefinition:t,structure:e,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=Tr({drawDefinition:t,structure:e}),a=n?.filter(({drawPosition:l})=>r?.includes(l))?.map(l=>{let{extension:c}=Ci({element:l,name:nm});return c?.value?.groupOrder}),{containerStructures:s}=CD({drawDefinition:t}),o=s[e.structureId];return{structureIds:RD({drawDefinition:t,structureId:o})?.links?.source?.filter(l=>go(a,l.source?.finishingPositions||[])).map(l=>l.source.structureId)}}function eSe({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===py&&qh({drawDefinition:t,structure:e})){let{structureIds:n}=u6e({drawDefinition:t,structure:e,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function d6e(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===dd){let o=r.sides.find(({sideNumber:c})=>c!==a).participantId,l=i.find(c=>c.structureId===s.target.structureId&&c.roundNumber===s.target.roundNumber&&c.sides.some(({participantId:u})=>u===o));if(l?.matchUpStatus===Pn){let c=yo({matchUpId:l.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!by({inContextDrawMatchUps:i,drawDefinition:n,targetData:c})){let{structure:u}=oi({structureId:l.structureId,drawDefinition:n}),d=Tr({structure:u}).positionAssignments;for(let p of d||[])if(p.participantId===o){let h=r.sides.find(({sideNumber:f})=>f===a).participantId;if(p.participantId=h,u?.positionAssignments)u.positionAssignments=d;else if(u?.structures){let f=Object.assign({},...(d||[]).map(m=>({[m.drawPosition]:m.participantId})));for(let m of u.structures)m.positionAssignments?.forEach(g=>g.participantId=f[g.drawPosition])}Sg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:u}),e=!0}}}}return{...oe,qualifierReplaced:e}}function p6e(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,s=t.targetData.targetLinks?.winnerTargetLink;if(s.target.feedProfile===dd){let o=r.sides.find(({sideNumber:u})=>u===a)?.participantId,l=i.filter(u=>u.structureId===s.target.structureId&&u.roundNumber===s.target.roundNumber&&u.sides.some(({participantId:d,qualifier:p})=>p&&!d)),c=Tu(l);if(c?.matchUpStatus===Pn){let u=yo({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!by({inContextDrawMatchUps:i,drawDefinition:n,targetData:u})){let d=c.sides.find(f=>f.qualifier&&!f.participantId)?.drawPosition,{structure:p}=oi({structureId:c.structureId,drawDefinition:n});if(!p)return{error:en};let h=Tr({structure:p}).positionAssignments;for(let f of h||[])if(f.drawPosition===d&&!f.participantId){if(f.participantId=o,p.positionAssignments)p.positionAssignments=h;else if(p.structures){let m=Object.assign({},...(h||[]).map(g=>({[g.drawPosition]:g.participantId})));for(let g of p.structures)g.positionAssignments?.forEach(v=>v.participantId=m[v.drawPosition])}Sg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:p}),e=!0}}}}return{...oe,qualifierPlaced:e}}function h6e(t){let e="attemptToSetWinningSide",i,r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:s,dualMatchUp:o,winningSide:l,structure:c,matchUp:u}=t;if(o?._disableAutoCalc&&a!==!1)return N6(t);if(u.winningSide&&u.winningSide!==l){let{connectedStructureIds:f}=eSe({drawDefinition:s,structure:c,matchUp:u});f.length&&(console.log({connectedStructureIds:f}),i=!0);let m=GD(t);if(m.error)return m}let d=mbe(t);if(d.context?.progressExitStatus&&Object.assign(r,d.context),d.error)return ue({result:d,stack:e});let p,h;return t.qualifierChanging&&n?.[SC]?.autoReplaceQualifiers&&(p=d6e(t).qualifierReplaced),t.qualifierAdvancing&&n?.[SC]?.autoPlaceQualifiers&&(h=p6e(t).qualifierPlaced),ue({result:Ft({...oe,...d,connectedStructures:i,qualifierReplaced:p,qualifierPlaced:h,context:r}),stack:e})}var zN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function tSe(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:s}=t,{matchUpId:o}=s,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";Sl({color:"brightyellow",method:c,matchUpId:o,iteration:l,keyColors:zN});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:h}}=a;if(d&&d.matchUpStatus!=="BYE"){let{stage:g,roundNumber:v,roundPosition:y,structureName:b}=d;Sl({winner:"winner",roundPosition:y,structureName:b,roundNumber:v,keyColors:zN,stage:g}),fX({...t,targetMatchUp:d,sourceMatchUp:s,iteration:l})}let f=u?.matchUpStatus==="BYE"&&(u?.feedRound||u?.roundNumber===1),m=a?.targetLinks?.loserTargetLink?.linkCondition===Dp;if(f&&m){let g=e.filter(({roundNumber:b,structureId:I})=>I===s.structureId&&b===1),v=g.map(({roundPosition:b})=>b),y=Ra(v.sort(),2).find(b=>b.includes(s.roundPosition));if((g.filter(({roundPosition:b})=>y.includes(b))?.map(({matchUpStatus:b})=>b)).every(b=>[ra,ln].includes(b)))return ue({result:{...oe},stack:c})}if(u&&(u.matchUpStatus!=="BYE"||f)){let g=e.find(({matchUpId:S})=>S===u.matchUpId),{structure:v}=oi({drawDefinition:r,structureId:g.structureId}),{stage:y,roundNumber:b,roundPosition:I,feedRound:w,structureName:T}=u;if(Sl({loser:"loser",roundPosition:I,structureName:T,roundNumber:b,keyColors:zN,feedRound:w,stage:y}),i?.progression?.doubleExitPropagateBye||f)Fj({drawPosition:p,targetLink:h,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let S=fX({...t,targetMatchUp:u,structure:v,iteration:l});if(S.error)return ue({result:S,stack:c})}}return ue({result:{...oe},stack:c})}function fX(t){let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:s,structure:o,iteration:l}=t,c="conditionallyRemoveDrawPosition";Sl({method:c,structureName:o?.structureName,iteration:l});let u=yo({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=u,p=s?.drawMatchUps.find(I=>I.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=d?.drawPositions?.filter(Boolean)?.find(I=>a.drawPositions.includes(I));else if(!n)g=En(a?.drawPositions||[],d?.drawPositions||[])?.[0];else if(m=wye({structureId:o.structureId,matchUp:n,matchUpsMap:s})?.pairedPreviousMatchUp,f=[ln,ra].includes(m?.matchUpStatus),h=m?.drawPositions?.filter(Boolean)||[],[...la,"BYE"].includes(m?.matchUpStatus)||m?.winningSide){let I=n.drawPositions||[],w=a.drawPositions?.filter(Boolean);go(I,w)&&(w=w?.filter(T=>!I.includes(T))),g=I.concat(h).find(T=>w?.includes(T))}if(d&&g){let{stage:I,roundNumber:w,roundPosition:T,structureName:S}=d;Sl({method:"removeDirectedWinner",drawPositionToRemove:g,color:"brightgreen",roundPosition:T,structureName:S,roundNumber:w,keyColors:zN,stage:I}),Jwe({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:s})}let v=tSe({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:s,structure:o,iteration:l});if(v.error)return ue({result:v,stack:c});let y=f6e({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=lp({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ue({result:v,stack:c}):{...oe}}function f6e({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus==="BYE"?"BYE":t?[ra,br].includes(e?.matchUpStatus)?br:Fr:Pn}function m6e(t){let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=t.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===dd){let s=r.sides?.find(({sideNumber:l})=>l===r.winningSide)?.participantId,o=i.find(l=>l.structureId===a.target.structureId&&l.roundNumber===a.target.roundNumber&&l.sides?.some(({participantId:c})=>c===s));if(o&&o.matchUpStatus===Pn){let l=yo({matchUpId:o.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!by({inContextDrawMatchUps:i,drawDefinition:n,targetData:l})){let{structure:c}=oi({structureId:o.structureId,drawDefinition:n}),u=Tr({structure:c}).positionAssignments;for(let d of u||[])if(d.participantId===s){if(d.participantId=void 0,c?.positionAssignments)c.positionAssignments=u;else if(c?.structures){let p=Object.assign({},...(u||[]).map(h=>({[h.drawPosition]:h.participantId})));for(let h of c?.structures||[])h.positionAssignments?.forEach(f=>f.participantId=p[f.drawPosition])}Sg({tournamentId:t.tournamentRecord?.tournamentId,event:t.event,drawDefinition:n,structure:c}),e=!0}}}}return{qualifierRemoved:e}}function g6e(t){let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([ln,ra].includes(e?.matchUpStatus)&&![ln,ra].includes(i)){let g=tSe(t);if(g.error)return ue({result:g,stack:a})}let s=i===ln,o=ua({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=t?.inContextMatchUp?.collectionId&&a6e(t.inContextMatchUp),c=t.removeScore||!l&&![Ol,sl].includes(i||Ol),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!ua({score:r}),d=g=>{let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:w}=t;if(I?._disableAutoCalc&&w!==!1)return N6({...t,removeWinningSide:u});let{connectedStructureIds:T}=eSe({drawDefinition:b,structure:y,matchUp:e});T.length&&(console.log({connectedStructureIds:T}),v=!0),Object.assign(t,{removeScore:g});let S=GD(t);if(S.error)return S;if(t.removingQualifier&&t.appliedPolicies?.[SC]?.autoRemoveQualifiers){let D=m6e(t);return{...oe,connectedStructures:v,...D}}return{...oe,connectedStructures:v}};if(u&&n&&t.isCollectionMatchUp)return mX(t);let p=[$p,sl].includes(i)&&t.dualWinningSideChange,h=i&&i!==Pn,f=t.propagateExitStatus&&_s(i),m=(n||p||f)&&h6e(t)||o&&d(c)||h&&o6e(t)||u&&d(c)||e&&mX({...t,removeScore:!0})||{...oe};return ue({result:m,stack:a})}function mX(t){let e="ndd:scoreModification";if(t.isCollectionMatchUp&&t.dualMatchUp?.winningSide&&!t.projectedWinningSide&&!t.autoCalcDisabled){let r=GD(t);if(r.error)return r}let i=lp({...t});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,event:a,matchUpsMap:s}=t,{removeWinningSide:o}=Em({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:n,matchUpsMap:s,event:a});o&&console.log("REMOVE WINNING SIDE")}return ue({result:i,stack:e})}function t8(t){let e=Gt(t,[{[pa]:!0,[Gs]:!0,[Fp]:!0},{homeParticipantId:!0,[ku]:oa}]);if(e.error)return e;let i=FD(t,[{[TD]:ef,attr:{[gL]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map(u=>u?.participantId);if(t.homeParticipantId&&!r?.includes(t.homeParticipantId))return{error:Ed};let{disableNotice:n,homeParticipantId:a,removePriorValues:s,tournamentRecord:o,drawDefinition:l,matchUpId:c}=t;return Ll({duplicateValues:!1,removePriorValues:s,tournamentRecord:o,drawDefinition:l,disableNotice:n,matchUpId:c,timeItem:{itemType:z5,itemValue:a}})}function iSe({timeStamp:t,schedule:e,matchUp:i}){let{itemValue:r,timeStamp:n}=Xy({timeItems:i?.timeItems||[],itemType:OL});return!e||n&&t&&new Date(n).getTime()>new Date(t).getTime()?{timeModifiers:r}:e}function ev(t){let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,scheduledTime:o,matchUpId:l}=t;if(!l)return ue({result:{error:eo},stack:e});if(!wD(o))return ue({result:{error:yu},stack:e});if(!i){let h=qr({drawDefinition:a,matchUpId:l});if(h.error)return ue({result:h,stack:e});i=h.matchUp}let c=Ui(o),u=Nw({matchUp:i}).scheduledDate,d=c&&!u;if((iSe({matchUp:i}).timeModifiers||[])?.length){let h=rSe({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h?.error)return ue({result:h,stack:e})}let p=Sw(o,!0,d);return Ll({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:s,matchUpId:l,timeItem:{itemType:Rw,itemValue:p}})}function rSe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:s}){let o="addMatchUpTimeModifiers";if(!a)return ue({result:{error:eo},stack:o});if(n!==void 0&&!Array.isArray(n))return ue({info:vy("timeModifiers"),result:{error:Se},stack:o});if(!s){let d=qr({drawDefinition:i,matchUpId:a});if(d.error)return ue({result:d,stack:o});s=d.matchUp}let l=iSe({matchUp:s}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...oe};if(c.some(d=>fj.includes(d))){l=l.filter(p=>!fj.includes(p));let d=ev({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ue({result:d,stack:o})}let u=n?.length?[...c,...l]:void 0;return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:OL,itemValue:u}})}function LF({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:eo};let s=t&&Tp.test(t);if(t&&!s)return{error:Ba};let o={itemValue:Ui(t),itemType:Cw};return Ll({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o})}function FF({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtIds:o}){if(!i&&!e)return{error:et};if(!s)return{error:eo};let l=qr({drawDefinition:r,matchUpId:s});if(l.error)return l;if(l?.matchUp?.matchUpType!==oc)return{error:al};if(!(o===void 0||Array.isArray(o)&&o.length&&o.every(u=>typeof u=="string")))return{error:Se,context:{courtIds:o}};let c;if(o){let u=e||i&&{[i.tournamentId]:i},d=Pm({tournamentRecords:u});if(d.error)return d;let p=d.courts?.filter(h=>o.includes(h.courtId));if(p?.length!==o.length)return{error:Se,context:{courtIds:o}};c=p?.map(h=>({venueId:h.venueId,courtId:h.courtId}))}return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:zh,itemDate:a,itemValue:c}})}function HD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:s}){if(!i)return{error:et};if(!a)return{error:eo};if(s){let o=rf({tournamentRecords:e,tournamentRecord:i,venueId:s});if(o.error)return o}return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Pw,itemValue:s}})}function Gw({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:s,courtId:o}){if(!i&&!e)return{error:et};if(!s)return{error:eo};if(o){let l=Aw({tournamentRecords:e,tournamentRecord:i,courtId:o});if(l.error)return l;let c=l.venue?.venueId;HD({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,venueId:c})}return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:s,timeItem:{itemType:Ug,itemDate:a,itemValue:o}})}function Qd(t,e){let i=qme.test(t)?t:zr(t),r=Ui(t)||Ui(e)||Au(new Date);return new Date(`${r}T${i}`).getTime()}function BF(t){let e="addMatchUpScheduleItems",i=Gt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Bo]:Zo}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:s=!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:h,schedule:f,event:m}=t,g,v;if(p)g=p.find(N=>N.matchUpId===h);else{let N=qr({drawDefinition:u,event:m,matchUpId:h});if(N.error)return N;g=N.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:w,resumeTime:T,homeParticipantId:S,scheduledDate:D,scheduledTime:C,startTime:E,stopTime:P,timeModifiers:R,venueId:M}=f;s&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=id({drawDefinition:u}));let A=r?.[h]?.matchUpIds;if(f.scheduledDate&&s&&A){let N=n?.filter(k=>(k.schedule?.scheduledDate||Ui(k.schedule?.scheduledTime))&&A.includes(k.matchUpId)).map(({schedule:k})=>{let x=c_(k);return new Date(x).getTime()});if(N?.length){let k=c_(f),x=new Date(k).getTime();if(Math.max(...N)>=x){if(a)return ue({result:{error:KV},stack:e});v=KV}}}if(D!==void 0){let N=LF({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledDate:D,matchUpId:h});if(N?.error)return ue({result:N,stack:e,context:{scheduledDate:D}})}if(C!==void 0){let N=ev({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,scheduledTime:C,matchUpId:h,matchUp:g});if(N?.error)return ue({result:N,stack:e,context:{scheduledTime:C}})}if(E!==void 0){let N=r8({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,startTime:E,event:m});if(N?.error)return ue({result:N,stack:e,context:{startTime:E}})}if(P!==void 0){let N=a8({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,stopTime:P,event:m});if(N?.error)return ue({result:N,stack:e,context:{stopTime:P}})}if(T!==void 0){let N=s8({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,resumeTime:T,matchUpId:h,event:m});if(N?.error)return ue({result:N,stack:e,context:{resumeTime:T}})}if(y!==void 0){let N=n8({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,endTime:y,event:m});if(N?.error)return ue({result:N,stack:e,context:{endTime:y}})}if(I!==void 0){let N=FF({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtIds:I});if(N?.error)return ue({result:N,stack:e,context:{courtIds:I}})}if(b!==void 0&&D!==void 0){let N=Gw({courtDayDate:D,disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,courtId:b});if(N?.error)return ue({result:N,stack:e,context:{courtId:b}})}if(M!==void 0){let N=HD({disableNotice:!0,removePriorValues:o,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:h,venueId:M});if(N?.error)return ue({result:N,stack:e,context:{venueId:M}})}if(w!==void 0&&mi(w)){let N=i8({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,courtOrder:w,matchUpId:h});if(N?.error)return ue({result:N,stack:e,context:{courtOrder:w}})}if(R!==void 0){let N=rSe({disableNotice:!0,removePriorValues:o,tournamentRecord:c,drawDefinition:u,timeModifiers:R,matchUpId:h,matchUp:g});if(N?.error)return ue({result:N,stack:e,context:{timeModifiers:R}})}return Yr(S)&&t8({disableNotice:!0,homeParticipantId:S,removePriorValues:o,tournamentRecord:c,drawDefinition:u,matchUpId:h}),d||Hi({tournamentId:c?.tournamentId,eventId:m?.eventId,context:e,drawDefinition:u,matchUp:g}),v?{...oe,warnings:[v]}:{...oe}}function i8({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:eo};if(n&&!mi(n))return{error:Se,info:"courtOrder must be numeric"};let s=n&&ri(n);return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:kL,itemValue:s}})}function nSe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:s}){if(!s)return{error:eo};if(!n)return{error:oa};if(e){let l=un({tournamentRecord:e,participantFilters:{participantTypes:[Bi],participantRoles:[i6]}}).participants??[];if(!bg({tournamentParticipants:l,participantId:n}))return{error:_n}}let o={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(o.itemSubTypes=[a]),Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:s,timeItem:o})}function r8({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:s}){if(!n)return{error:eo};if(!wD(a))return{error:yu};let{matchUp:o}=qr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Nw({matchUp:o}),c=(o?.timeItems??[]).filter(u=>[xf,vh,sm].includes(u?.itemType)).map(u=>Qd(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Qd(a,l)<c){o?.timeItems&&(o.timeItems=o.timeItems.filter(d=>d.itemType!==pd));let u=Sw(a,!0,!0);return Ll({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:pd,itemValue:u}})}else return{error:vme}}function n8({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:s,event:o}){if(!a)return{error:eo};if(!wD(s))return{error:yu};let{matchUp:l}=qr({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=Nw({matchUp:l}),u=(l?.timeItems??[]).filter(d=>[pd,vh,xf].includes(d?.itemType)).map(d=>Qd(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Qd(s,c)>u){l?.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==sm));let d=Sw(s,!0,!0);return Ll({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:sm,itemValue:d}})}else return{error:mme}}function a8({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:s}){if(!n)return{error:eo};if(!wD(a))return{error:yu};let{matchUp:o}=qr({drawDefinition:i,event:s,matchUpId:n}),{scheduledDate:l}=Nw({matchUp:o}),c=o?.timeItems??[];if(c.reduce((f,m)=>m.itemType===sm||f,void 0))return{error:k4};let u=c.filter(f=>[pd,vh,xf].includes(f?.itemType)).sort((f,m)=>Qd(f.itemValue,l)-Qd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===xf,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Qd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Qd(a,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Sw(a,!0,!0),itemType:xf};return Ll({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:f})}else return{error:gme}}function s8({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:s}){if(!a)return{error:eo};if(!wD(n))return{error:yu};let{matchUp:o}=qr({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:l}=Nw({matchUp:o}),c=o?.timeItems??[];if(c.reduce((f,m)=>m.itemType===sm||f,void 0))return{error:k4};let u=c.filter(f=>[pd,vh,xf].includes(f?.itemType)).sort((f,m)=>Qd(f.itemValue,l)-Qd(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===vh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Qd(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Qd(n,l)>h){if(o?.timeItems&&p){let m=d.createdAt;o.timeItems=o.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Sw(n,!0,!0),itemType:vh};return Ll({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:f})}else return{error:Cje}}function v6e(t){let{targetData:e,matchUpsMap:i}=t,{targetMatchUps:{loserMatchUp:r}}=e,n=_s(r?.matchUpStatus),a=!!i?.drawMatchUps.find(s=>s.loserMatchUpId===r?.matchUpId&&_s(s.matchUpStatus));return a&&r?.matchUpStatus===ln||a&&n}function y6e({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:s,matchUp:o,event:l,score:c}){let u=Et(n,void 0,!0);for(let p of u?.tieMatchUps||[])p.matchUpId===o.matchUpId&&(p.winningSide=r,p.score=c,!ua({score:c})&&!e?Object.assign(p,{...ZL}):e&&(p.matchUpStatus=e));a=a??Zs({matchUp:o,structure:s,drawDefinition:t,event:l})?.tieFormat;let{winningSide:d}=E0({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:s,tieFormat:a,event:l});return{projectedWinningSide:d}}function b6e(t){let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,s=i.sides.find(w=>w.sideNumber===i.winningSide),o=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=s,{drawPosition:u,participantId:d}=o,p="swapWinnerLoser",{matchUps:h}=ar(t),f=h.filter(({drawPositions:w,roundNumber:T})=>w?.includes(l)&&T>a);cc({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{w.drawPositions=w.drawPositions?.map(T=>T===l?u:T)||[],Hi({tournamentId:e?.tournamentId,eventId:t.event?.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:m,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:T})=>w===m&&T>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y?.target.structureId,b?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:T})=>w!==m&&I.includes(T)).forEach(({stage:w,stageSequence:T,structureId:S})=>{v.includes(S)||v.push(S),n.structures.filter(({stage:D,stageSequence:C})=>D===w&&C>T).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:T}=Tr({structure:w}),S=T?.find(({participantId:C})=>C===c),D=T?.find(({participantId:C})=>C===d);S&&(S.participantId=d),D&&(D.participantId=c)}),lp({...t})}function zD(t){let e="setMatchUpStatus";t.matchUpStatus&&[Fr,ln].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:s,disableAutoCalc:o,enableAutoCalc:l,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:p,event:h,score:f}=t;if(!c)return{error:At};if(u&&[$p,Ol,sl,Pn].includes(u)&&d)return{error:Se,winningSide:d,matchUpStatus:u};if(![void 0,...lve].includes(u))return ue({result:{error:gD},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let m=rs({drawDefinition:c}),{matchUps:g}=qn({nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,event:h}),v=m.drawMatchUps.find(W=>W.matchUpId===p),y=g?.find(W=>W.matchUpId===p);if(!v||!g)return{error:Ls};if((v.winningSide||d)&&u==="BYE")return{context:"Cannot have Bye with winningSide",error:NN,matchUpStatus:u};let b=y?.structureId,{structure:I}=oi({drawDefinition:c,structureId:b}),w=On(kr)(v.matchUpType),T=y?.drawPositions?.filter(Boolean),S=y?.matchUpTieId,D=yo({matchUpId:S||p,inContextDrawMatchUps:g,drawDefinition:c});Object.assign(t,{inContextDrawMatchUps:g,inContextMatchUp:y,matchUpTieId:S,matchUpsMap:m,targetData:D,structure:I,matchUp:v});let C=u===Pn&&f?.scoreStringSide1===""&&f?.scoreStringSide2===""&&!d;if(v6e(t)&&C)return{error:vje};let E=by(t),P;if(w){if(o)nr({extension:{name:TI,value:!0},element:v});else if(l){let W=v.winningSide,{winningSide:z,scoreStringSide1:H,scoreStringSide2:Z,set:J}=E0({drawDefinition:c,matchUpsMap:m,structure:I,matchUp:v,event:h}),ie={scoreStringSide1:H,scoreStringSide2:Z,sets:J?[J]:[]};if(P=z!==W,E&&P)return ue({stack:"winningSideWithDownstreamDependencies",result:{error:Xx},context:{winningSide:d,matchUp:v}});uo({name:TI,element:v}),Object.assign(t,{winningSide:z,dualWinningSideChange:P,projectedWinningSide:z,score:ie})}P0({tournamentId:s?.tournamentId,inContextDualMatchUp:y,eventId:h?.eventId,dualMatchUp:v,drawDefinition:c})}if(w&&u&&[Uw].includes(u))return{info:"Not supported for matchUpType: TEAM",error:Se};if(f&&!w&&!r){let W=v.matchUpFormat??I?.matchUpFormat??c?.matchUpFormat??h?.matchUpFormat,z=r7({existingMatchUpStatus:v.matchUpStatus,matchUpFormat:W,matchUpStatus:u,winningSide:d,score:f});if(z.error)return z}let R=er({policyTypes:[SC,Gc],tournamentRecord:s,drawDefinition:c,event:h})?.appliedPolicies??{};qi(t.policyDefinitions)&&Object.assign(R,t.policyDefinitions);let M=w6e({assignedDrawPositions:T,propagateExitStatus:n,inContextMatchUp:y,appliedPolicies:R,drawDefinition:c,matchUpStatus:u,structure:I,matchUp:v});if(M?.error)return M;let A=y?.stage===zt&&y.finishingRound===1,N=A&&d,k=A&&v.winningSide&&!d&&(!t.matchUpStatus||t.matchUpStatus&&yj({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!ua({outcome:t.outcome})),x=N&&d!==v.winningSide&&v.winningSide;if(Object.assign(t,{qualifierAdvancing:N,qualifierChanging:x,removingQualifier:k,appliedPolicies:R}),S){let{matchUp:W}=qr({matchUpId:S,inContext:!0,drawDefinition:c,matchUpsMap:m,event:h});if(W){let z=Zs({matchUp:W,drawDefinition:c,structure:I,event:h})?.tieFormat,{projectedWinningSide:H}=y6e({drawDefinition:c,matchUpStatus:u,dualMatchUp:W,matchUpsMap:m,winningSide:d,tieFormat:z,structure:I,matchUp:v,event:h,score:f}),Z=W.winningSide;P=H!==Z;let J=W._disableAutoCalc;Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:H,autoCalcDisabled:J,matchUpTieId:S,dualMatchUp:W,tieFormat:z})}}let O=p0({matchUpStatus:u});if(!S){if(E&&!d&&(u&&yj({matchUpStatus:u})||u&&[ln,ra].includes(u)))return{error:NN,activeDownstream:E,winningSide:d};if(d&&d===v.winningSide&&u&&!O)return{context:"winningSide must include directing matchUpStatus",error:NN,directingMatchUpStatus:O,matchUpStatus:u}}let{schedule:V}=t;if(V){let W=BF({disableNotice:!0,tournamentRecords:a,tournamentRecord:s,drawDefinition:c,matchUpId:p,schedule:V});if(W.error)return W}let F=!w&&!P&&d&&v.winningSide&&v.winningSide!==d;if(i&&F&&v.roundPosition)return b6e(t);let j=d&&!S||t.projectedWinningSide;Sl({activeDownstream:E,matchUpWinner:j,method:e,winningSide:d});let q=!E&&g6e(t)||j&&I6e(t)||(O||t.autoCalcDisabled)&&aSe(t)||{error:Dme};return ue({result:q,stack:e})}function I6e(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?aSe(t):ue({stack:"winningSideWithDownstreamDependencies",result:{error:Xx},context:{winningSide:i,matchUp:e}})}function aSe(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!ua({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&Pn||t.winningSide&&Tn||Ol:t.matchUpStatus||Tn,s=t.removeScore||[$p,Fr].includes(a)&&![Ol,sl].includes(a),o=lp({...t,matchUpStatus:a,removeWinningSide:n,removeScore:s});if(o.error)return o;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Em({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(o,{tieMatchUpResult:d})}return o}function w6e({assignedDrawPositions:t,propagateExitStatus:e,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:s,matchUp:o}){if(r?.[Gc]?.requireParticipantsForScoring===!1)return{...oe};let l=i?.sides?.map(d=>d.participantId).filter(Boolean).length,c=o?.sides?[]:Tr({structureId:s?.structureId,drawDefinition:n}).positionAssignments,u=l&&l===2||o.collectionId&&xo({structure:s})&&l&&l>=1||t?.length===2&&c?.filter(d=>t.includes(d.drawPosition)).every(d=>d.participantId);return a&&[Fr,br,ln].includes(a)&&l===1&&e?{...oe}:a&&ove.includes(a)&&!u?ue({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:u},result:{error:gD}}):{...oe}}function sSe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:At};let{matchUp:n}=qr({drawDefinition:e,matchUpId:i,event:r});return n?.matchUpType!==oc?{error:al}:zD({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function oSe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:At};if(!i)return{error:eo};let{matchUp:r}=qr({drawDefinition:t,event:e,matchUpId:i});return r?uo({name:SL,element:r}):{error:Ls}}function S6e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:s}){let o="substituteParticipant";if(!r)return{error:At};if(!a)return{error:eo};if(!e||!t)return ue({result:{error:oa},stack:o});let{matchUp:l}=qr({drawDefinition:r,matchUpId:a,event:s});if(!l)return{error:Ls};if(!l.collectionId)return ue({result:{error:al},stack:o});let c=rs({drawDefinition:r}),{matchUps:u}=qn({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:c}),d=u?.find(h=>h.matchUpId===a),p=u?.find(h=>h.matchUpId===d?.matchUpTieId)?.sides?.find(h=>h.participant.individualParticipants.some(({participantId:f})=>f===e));return!p||n&&p.sideNumber!==n?{error:Ed}:p.participant?.individualParticipants?.map(Fi).filter(h=>h!==e)?.includes(t)?Q7({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:s}):ue({result:{error:Ed},stack:o})}function lSe(t){return S6e(t)}function cSe({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:At};let{matchUp:r}=qr({drawDefinition:t,matchUpId:e,event:i});return nr({extension:{name:TI,value:!0},element:r})}function uSe(t){let e="setMatchUpFormat",i=Gt(t,[{tournamentRecord:!0},{[hs]:w=>Al({matchUpFormat:w}),[uc]:OR,matchUpFormat:!0}]);if(i.error)return ue({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:s,matchUpFormat:o,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return ue({result:{error:Se,scheduledDates:a},stack:e});if(c&&!Hx([Up,jc],c))return ue({result:{error:xh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v?.length)&&!n)return ue({result:{error:At},stack:e});if(h&&u&&n){let w=o7({tournamentRecord:r,drawDefinition:n,matchUpFormat:o,structureIds:v,structureId:l,matchUpId:u});if(w.error)return w;g+=1}let I=w=>{let T=[];for(let S of w.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(s)&&!s.includes(S.stageSequence)||v?.length&&!v.includes(S.structureId))continue;v?.length&&S.matchUpFormat!==o&&(S.matchUpFormat=o,T.push(S.structureId),g+=1);let D=((m||a)&&ar({matchUpFilters:{matchUpStatuses:[Pn]},structure:S}).matchUps)??[],C=(a&&ar({matchUpFilters:{matchUpStatuses:[Pn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(D?.length){let E=C?C.map(Pa):D.map(Pa);for(let P of D)E.includes(P.matchUpId)&&(P.matchUpFormat=a?.length?o:void 0,Hi({tournamentId:r?.tournamentId,eventId:f?.eventId,context:e,drawDefinition:w,matchUp:P}))}}return!T.length&&w.matchUpFormat!==o&&(w.matchUpFormat=o,g+=1),T};for(let w of r?.events||[])if(!(y?.length&&!y.includes(w.eventId)||c&&c!==w.eventType||c===ta))if(Array.isArray(s)||Array.isArray(p)||v?.length||b?.length)for(let T of w.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(T.drawId))continue;let S=I(T);Cr({structureIds:S,drawDefinition:T})}else w.matchUpFormat!==o&&(w.matchUpFormat=o,g+=1);return g?{...oe,modificationsCount:g}:{...oe,info:ID}}function o8({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:At};let a=qr({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:al};let s=qr({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,o=0;return(a?.sides||[]).forEach(l=>{l.lineUp&&delete l.lineUp}),(s?.sides||[]).forEach(l=>{if(o+=1,t===!1){let c=s?.tieFormat,u=l.participantId;c&&u&&Lw({drawDefinition:i,participantId:u,lineUp:[],tieFormat:c})}Hi({tournamentId:e?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})}),{...oe,modificationsCount:o}}function dSe(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=t;if(!n)return{sets:[]};let s=n.sets||[],o=bh({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),l=bh({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,setTBlast:a,sets:s}),c=bh({matchUpFormat:e,matchUpStatus:i,winningSide:r,setTBlast:a,sets:s}),u=o===c?l:o;return r&&(o=r===1?c:u,l=r===2?c:u),{score:{sets:s,scoreStringSide1:o,scoreStringSide2:l}}}function T6e({sourceMatchUpStatusCodes:t,propagateExitStatus:e,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:s,matchUpsMap:o,event:l}){let c="progressExitStatus";Sl({matchUpId:s?.matchUpId,matchUpStatus:i,color:"magenta",method:c});let u=_s(i)&&i!==wa&&i||Fr,d=qn({inContext:!0,drawDefinition:a,matchUpsMap:o})?.matchUps,p=u,h=d?.find(f=>f.matchUpId===s?.matchUpId);if(h?.matchUpId&&p){let f,m=h.matchUpStatusCodes?.map(y=>typeof y=="string"?y:"WO")??[],g=h.sides?.find(y=>y.participantId===r);if(g?.sideNumber)if(h?.sides?.reduce((y,b)=>b?.participantId?y+1:y,0)===1&&m.length===0)f=g.sideNumber===1?2:1,m[0]=t[0];else if(!_s(s.matchUpStatus))f=g.sideNumber===1?2:1,m[0]=t[0];else{let y=m[0];m[g.sideNumber-1]=t[0];let b=g.sideNumber===1?2:1;m[b-1]=y,p=ln,f=void 0}let v=zD({matchUpStatus:p,matchUpId:s.matchUpId,matchUpStatusCodes:m,allowChangePropagation:!0,propagateExitStatus:e,tournamentRecord:n,drawDefinition:a,winningSide:f,event:l});return ue({result:v,stack:c,context:{progressExitStatus:!0}})}return ue({result:{error:ko},stack:c})}function V0(t){let e=Gt(t,[{[Fp]:!0,[Gs]:!0}]);if(e.error)return e;let i="setMatchUpStatus",r=Qc(t);if(!t.drawDefinition){let w=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=w);let T=Lo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:w});if(T.error)return T;T.drawDefinition&&(t.drawDefinition=T.drawDefinition),t.event=T.event}let{disableScoreValidation:n,propagateExitStatus:a,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpId:d,schedule:p,event:h,notes:f}=t,m=t.matchUpFormat||t.outcome?.matchUpFormat,{policy:g}=Yy({policyType:Gc,tournamentRecord:o,event:h}),v=t.allowChangePropagation!==void 0&&t.allowChangePropagation||g?.allowChangePropagation!==void 0&&g.allowChangePropagation||void 0,{outcome:y,setTBlast:b}=t;if(y?.winningSide&&![1,2].includes(y.winningSide))return{error:Kx};if(m){let w=o7({tournamentRecord:o,drawDefinition:u,matchUpFormat:m,matchUpId:d,event:h});if(w.error)return w}if(y?.score?.sets&&!y.score.scoreStringSide1){let{score:w}=dSe({...y,setTBlast:b});y.score=w,y.score.sets=y.score.sets.filter(T=>T.side1Score||T.side2Score||T.side1TiebreakScore||T.side2TiebreakScore)}let I=zD({matchUpStatusCodes:y?.matchUpStatusCodes,matchUpStatus:y?.matchUpStatus,winningSide:y?.winningSide,allowChangePropagation:v,disableScoreValidation:n,score:y?.score,propagateExitStatus:a,tournamentRecords:r,policyDefinitions:s,tournamentRecord:o,disableAutoCalc:l,enableAutoCalc:c,drawDefinition:u,matchUpFormat:m,matchUpId:d,schedule:p,event:h,notes:f});if(I.context?.progressExitStatus){let w=!0,T=0;for(;w&&T<10;){w=!1,T+=1;let S=T6e({sourceMatchUpStatusCodes:I.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:I.context.sourceMatchUpStatus,loserParticipantId:I.context.loserParticipantId,propagateExitStatus:t.propagateExitStatus,tournamentRecord:t.tournamentRecord,loserMatchUp:I.context.loserMatchUp,matchUpsMap:I.context.matchUpsMap,drawDefinition:t.drawDefinition,event:t.event});S.context?.loserMatchUp&&(Object.assign(I.context,S.context),w=!0)}}return ue({result:I,stack:i})}function pSe(t){if(!t?.outcomes)return{error:Yt};if(!Array.isArray(t.outcomes))return{error:Yt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:et};let s=i.filter(o=>o.tournamentId===n);if(s.length){let o=U6e({outcomes:s,tournamentRecord:a});if(o.error)return o}}return{...oe}}function U6e(t){let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:o}=s;a[o]||(a[o]=[]),a[o].push(s)});for(let s of Object.keys(a)){let{event:o}=Lo({tournamentRecord:i,eventId:s});for(let l of a[s]){let{drawId:c}=l,u=o?.drawDefinitions?.find(d=>d.drawId===c);if(u&&c){let{matchUpFormat:d,matchUpId:p}=l,h=V0({schedule:l?.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:u,matchUpFormat:d,matchUpId:p,outcome:l,drawId:c,event:o});if(h.error)return h}}}return{...oe}}function D6e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){if(!r&&!t)return{error:At};if(!i)return{error:Yt,info:"missing outcome"};if(!r&&!e)return{error:ko};if(!r){let n=qr({drawDefinition:t,matchUpId:e});if(n.error)return n;r=n.matchUp}return typeof i!="object"||!i.score?.scoreStringSide1||!i.score?.scoreStringSide2?{error:Se}:nr({element:r,extension:{name:SL,value:i}})}function hSe(t){return D6e(t)}function l8(t){let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=Gt(t,[{[pa]:!0,[Fp]:!0}],e);if(a.error)return a;let s=FD(t,[{[TD]:ef}]);if(s[ku])return s;let o=t.tournamentRecord?.tournamentId,{matchUp:l,structure:c}=s?.matchUp??{};if(!l?.tieMatchUps)return ue({result:{error:al},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...oe};let u=Zs({structure:c,drawDefinition:i,event:r})?.tieFormat;if(!u)return ue({result:{error:za},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let m of u.collectionDefinitions){let{matchUpCount:g,collectionId:v}=m;p.push(v);let y=(l.tieMatchUps||[]).filter(b=>b.collectionId===v);if(y.length>g)y.sort((b,I)=>(b.matchUpStatus===Pn?1:0)-(I.matchUpStatus===Pn?1:0)),h.push(...y.slice(0,g)),d.push(...y.slice(3).map(Pa));else if(h.push(...y),y.length<g){let b=g-y.length,I=T0({collectionDefinition:m,matchUpsLimit:b,matchUp:l,uuids:n});f.push(...I)}}for(let m of l?.tieMatchUps||[])m.collectionId&&!p.includes(m.collectionId)&&d.push(m.matchUpId);return f.length&&(h.push(...f),wg({eventId:r?.eventId,matchUps:f,drawDefinition:i,tournamentId:o})),d.length&&tf({matchUpIds:d,eventId:r?.eventId,drawDefinition:i,tournamentId:o}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,Hi({structureId:c?.structureId,eventId:r?.eventId,context:e,drawDefinition:i,tournamentId:o,matchUp:l})),{...oe,newMatchUps:f,deletedMatchUpIds:d}}function c8(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return ue({result:{error:At},stack:a});if(!r)return ue({result:{error:eo},stack:a});if(!Yr(r))return ue({result:{error:Se,matchUpId:r},stack:a});let s=rs({drawDefinition:i}),{matchUps:o}=qn({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:s}),l=s.drawMatchUps.find(m=>m.matchUpId===r),c=o?.find(m=>m.matchUpId===r);if(!l||!o)return{error:Ls};if(l.matchUpType!==_l)return{error:al};let u=yo({inContextDrawMatchUps:o,drawDefinition:i,matchUpId:r}),d=c?.structureId,{structure:p}=oi({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:o,inContextMatchUp:c,matchUpsMap:s,targetData:u,structure:p,matchUp:l}),by(t))return{error:Xx};if(l.tieMatchUps?.length)for(let m of l.tieMatchUps){let g=zD({matchUpId:m.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(g.error)return ue({result:g,stack:a})}let h=er({tournamentRecord:e,drawDefinition:i,event:n})?.appliedPolicies,f=Em({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:s,matchUpId:r});if(f.error)return ue({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let m=Zs({drawDefinition:i,structure:p,event:n})?.tieFormat;if(l.tieFormat&&m){let{matchUpCountDifference:g,descendantDifferences:v,ancestorDifferences:y,valueDifference:b}=om({descendant:l.tieFormat,ancestor:m});if(v.collectionIds.length===1&&!y.collectionIds.length&&!y.groupsCount&&g===1&&b===1){let I=l8({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(I.error)return I}}}return{...oe}}function fSe(t){let e=Gt(t,[{[Gs]:!0,[Tm]:!0},{[tU]:{[WR]:!1,roundNumbers:!1},[Wge]:"At least one must be provided",[Bo]:Rs}]);if(e.error)return e;let i=Sbe(t);if(i.error)return i;let{matchUpIds:r}=i,n=On(_l)(t.event.eventType),{tournamentRecord:a,drawDefinition:s,event:o}=t;for(let l of r){if(n){let u=c8({tiebreakReset:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(u.error||t.removeAssignments&&o8({inheritance:!1,drawDefinition:s,matchUpId:l}).error)return u}let c=zD({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:s,matchUpId:l,event:o});if(c.error)return c;if(t.removeAssignments){let u=e8({...t,matchUpId:l});if(u.error)return u}}return{...oe}}function E6e({tournamentRecord:t,drawDefinition:e,finishingOrder:i}){if(!e)return{error:At};let r="setOrderOfFinish";if(!Array.isArray(i))return ue({info:vy("finishingOrder"),result:{error:Se},stack:r});let{completedMatchUps:n,matchUpsMap:a}=MD({inContext:!0,drawDefinition:e}),s=n?.map(Pa)??[],o=i.map(Pa),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(n??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:w,roundNumber:T,structureId:S}=b;return y.matchUpTypes.includes(w)||y.matchUpTypes.push(w),y.roundNumbers.includes(T)||y.roundNumbers.push(T),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return ue({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Se},stack:r});let p,h,f={},m=[],g=[];if(!i.every(({orderOfFinish:y,matchUpId:b})=>(m.push(b),y&&g.push(y),f[b]=y,p=s.includes(b),h=y===void 0||mi(y)&&Math.floor(y)>0,p&&h)))return ue({result:{error:p?Se:gD},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n?.filter(y=>y.structureId===u[0]&&y.roundNumber===c[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:b}=y||{};if(b){if(!mi(b))return ue({context:{orderOfFinish:b,matchUp:y},result:{error:Se},stack:r});g.push(b)}}if(mfe(g).length!==g.length||Math.max(...g)>g.length)return ue({info:"Values not unique or greater than expected number of values",result:{error:Se},stack:r});if(u.length){let y=$L({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:a});if(y.error)return ue({result:y,stack:r});y.completedMatchUps?.forEach(b=>{b.orderOfFinish=f[b.matchUpId],Hi({tournamentId:t.tournamentId,context:"setOrderOfFinish",drawDefinition:e,matchUp:b})})}return{...oe}}function mSe(t){return E6e(t)}function gSe(t){let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,s="applyLineUps",o=Gt(t,[{[pa]:!0,[Gs]:!0,[Fp]:!0},{lineUps:!0,[Bo]:Rs}],s);if(o.error)return o;let l=e.participants||[],c=qr({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(c.error)return c;if(!c.matchUp)return{error:Ls};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:h}=u;if(h!==kr)return{error:al};if(!p?.length)return{error:_R};let f=Zs({matchUp:u,drawDefinition:i,structure:d,event:a})?.tieFormat,m={};for(let v of n){if(!Array.isArray(v))return{error:Se,lineUp:v};let y={},b=[];for(let D of v){if(typeof D!="object")return{error:Se,lineUpAssignment:D};let{participantId:C,collectionAssignments:E=[]}=D;if(!Array.isArray(E))return{error:Se,collectionAssignments:E};let P=l.find(M=>M.participantId===C);if(!P)return{error:_n};if(P.participantType!==Bi)return{error:Pd};let R=u.sides?.find(M=>M.participant?.individualParticipantIds?.includes(C))?.sideNumber;R&&b.push(R);for(let M of E){if(typeof M!="object")return{error:Se,collectionAssignment:M};let{collectionId:A,collectionPosition:N}=M,k=f?.collectionDefinitions?.find(V=>V.collectionId===A);if(!k)return{error:Se,collectionId:A};let x=`${A}-${N}`;y[x]||(y[x]=[]);let O=y[x].length;if(On(wr)(k.matchUpType)&&O||k.matchUpType===mr&&O>1)return{info:"Excessive collectionPosition assignments",error:Se};y[x].push(C)}}let I=Object.values(y);for(let D of I)if(D.length===2){let{participant:C}=Yu({tournamentParticipants:l,participantIds:D});if(!C){let E=Rp({participant:{participantType:Ei,participantRole:vs,individualParticipantIds:D},pairOverride:!0,tournamentRecord:e});if(E.error)return E}}let w=Nl(b),T=(w[1]||0)>(w[2]||0)&&1||(w[2]||0)>(w[1]||0)&&2||void 0,S=Object.keys(m).map(D=>parseInt(D));T&&!S.includes(T)&&(m[T]=v)}if(!Object.keys(m).length)return{error:B4};if(c=qr({drawDefinition:i,matchUpId:r}),c.error)return c;if(!c.matchUp)return{error:Ls};let{matchUp:g}=c;g.sides||(g.sides=[]);for(let v of[1,2]){let y=g.sides.find(I=>I.sideNumber===v),b=m[v];if(b)y?y.lineUp=b:g.sides.push({lineUp:b,sideNumber:v});else continue}return Hi({tournamentId:e?.tournamentId,context:s,drawDefinition:i,matchUp:g}),{...oe}}var u8={};_i(u8,{anonymizeTournamentRecord:()=>FSe,generate:()=>vSe,generateEventWithDraw:()=>HF,generateOutcome:()=>y8,generateOutcomeFromScoreString:()=>d8,generateParticipants:()=>qD,generateTournamentRecord:()=>xSe,modifyTournamentRecord:()=>BSe,mutate:()=>LSe});var vSe={};_i(vSe,{generateEventWithDraw:()=>HF,generateOutcome:()=>y8,generateOutcomeFromScoreString:()=>d8,generateParticipants:()=>qD,generateTournamentRecord:()=>xSe});function d8(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a}=t;if(!n)return{outcome:{...ZL,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:Se,winningSide:r};let s=n&&M_({scoreString:n,matchUpFormat:e}),o=n?.trim().startsWith("["),l=r;if(!l&&e&&s){let p={side1:0,side2:0};s.forEach(h=>{h.winningSide===1?p.side1++:h.winningSide===2&&p.side2++}),p.side1>p.side2?l=1:p.side2>p.side1&&(l=2)}let c={},u=bh({sets:s,matchUpFormat:e,setTBlast:a}),d=bh({sets:s,reversed:!0,matchUpFormat:e,setTBlast:a});return o?(c.scoreStringSide1=u,c.scoreStringSide2=d):l===2?(c.scoreStringSide1=d,c.scoreStringSide2=u):(c.scoreStringSide1=u,c.scoreStringSide2=d),c.sets=M_({scoreString:c.scoreStringSide1,matchUpFormat:e}),Ft({outcome:{matchUpStatus:i,winningSide:l,score:c}})}function p8({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){let n=(e?.[r.matchUpId]?.matchUpIds||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function j0({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function P6e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function LC({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:s=0,scheduleTime:o,matchUp:l}){let c=zr(l?.schedule?.endTime),u=c?Qo(c,ri(s)):Qo(o,ri(r)+ri(s)),d=i&&(c?Qo(zr(c),i):Qo(o,ri(r)+ri(i))),p=a?.[l.matchUpId]?.participantIds||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(f=>{j0({individualParticipantProfiles:e,participantId:f});let m=e[f].priorMatchUpType!==l.matchUpType&&d||u;h.includes(f)?P6e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:m,participantId:f,scheduleTime:o}):(e[f].timeAfterRecovery=m,e[f].bookings.push({scheduleTime:o,timeAfterRecovery:m}))}),cU({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:l})}function ySe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){let a,s=n.minutesMap?.[r]?.recoveryMinutes,o=(n.minutesMap?.[r]?.averageMinutes||0)+(s||0),l=Qo(i,o),c=e?.[r]?.dependentMatchUpIds||[];if(c.length){let u=c.reduce((d,p)=>{let h=t[p];if(!h)return d;let f={scheduleTime:h,matchUpId:p};return h&&!d.matchUpId||Ji(h)<Ji(d.scheduleTime)?f:d},{});u.scheduleTime&&Ji(l)>Ji(u.scheduleTime)&&(a=u)}return{scheduledDependent:a}}function C6e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>i===mr&&(r?.participant?.individualParticipants||[])||r?.participant&&[r.participant]||[]).flat()}var G0="DO_NOT_SCHEDULE",R6e={DO_NOT_SCHEDULE:G0};function h8({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:s}){let o=C6e(s).map(({person:h})=>h?.personId);if(i){let h=(s?.potentialParticipants||[]).flat().map(({person:f})=>f?.personId);o.push(...h)}let l=o.map(h=>r[h]?.map(f=>({...f,personId:h}))).filter(Boolean).flat().filter(h=>h.requestType===G0&&Lh(a,h.date)),c=[],u=s?.matchUpId,d=Gn(zr(n),Ui(a)),p=zr(J4(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(n>m&&n<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:n}),e[f]?(e[f].scheduleTimes.includes(n)||e[f].scheduleTimes.push(n),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function Bj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=ML(i),s=(t[i.matchUpId]||[]).filter(o=>!go(o,a)).flat();[...a,...s].forEach(o=>{if(j0({individualParticipantProfiles:e,participantId:o}),!e[o].potentialCounted[i.drawId]){let l=e[o].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[xu]?l[xu]+=r:r>0&&(l[xu]=r),s.includes(o)&&(e[o].potentialCounted[i.drawId]=!0)}})}function M6e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:s,matchUpDependencies:o,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){let p=[];i||(n=d?.filter(m=>{let g=m.schedule||{},v=m.matchUpStatus==="BYE";return v&&p.push({tournamentId:m.tournamentId,matchUpId:m.matchUpId}),!v&&x0({schedule:g})&&(!c||m.schedule.scheduledDate===c)}),i=n.map(Pa));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:m})=>i.includes(m));for(let m of f){Bj({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:m});let g=m.schedule?.scheduledTime;if(g){s[m.matchUpId]=g;let v=u?.[m.matchUpId]?.recoveryMinutes;LC({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:o,averageMatchUpMinutes:r,recoveryMinutes:v,scheduleTime:g,matchUp:m})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:h}}function $F({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:s,matchUps:o}){if(typeof r!="object")return{error:hn};if(!iu(o)&&!Array.isArray(i))return{error:wm};a=a??_F({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=e0({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=o?.filter(d=>{let p=d.schedule;return x0({schedule:p})&&(!s||d.schedule.scheduledDate===s)}));let u=i?.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!=="BYE");return{bookings:u?.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f?.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=xL({timingDetails:v,eventType:g}),{courtId:I,venueId:w}=p,T=zr(p.scheduledTime),S=Qo(T,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:T,courtId:I,endTime:S,venueId:w}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function N6e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:s,periodLength:o,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(s&&!a&&(a={[s.tournamentId]:s}),typeof a!="object"||!Object.keys(a).length)return{error:hn};o=o??_F({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:h,venues:f}=Pm({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=h?.filter(w=>!u||u.includes(w.venueId))??[];c=c??uU({courts:m,scheduleDate:l,startTime:!0}),p=p??uU({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=$F({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:o,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:o,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=K7(y),I=u?.length===1&&u[0]||f?.length===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v?.map(xl("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function A6e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,s,o,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash,o=e,s=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:s,averageMinutes:o}),{groupedRounds:r}}function bSe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){let m={},g=[],v=[],y=[];for(let b of f){let{rounds:I=[],venueId:w}=b,{scheduledRoundsDetails:T,greatestAverageMinutes:S,orderedMatchUpIds:D,minutesMap:C}=k0({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:I});y.push(...D??[]);let{groupedRounds:E}=A6e({scheduledRoundsDetails:T,greatestAverageMinutes:S,garmanSinglePass:!0}),P,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:P}=N6e({averageMatchUpMinutes:E[0]?.averageMinutes,scheduleDate:Ui(u),venueIds:[b.venueId],clearScheduleDates:o,tournamentRecords:l,periodLength:c,matchUps:p}));let M=M6e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:P,greatestAverageMinutes:S,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:o,scheduleDate:u,minutesMap:C,matchUps:p});({dateScheduledMatchUpIds:P}=M);let A=M,{byeScheduledMatchUpDetails:N,clearDate:k}=M;N?.length&&v.push(...N);let{matchUpsToSchedule:x,matchUpMap:O}=yF({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:P,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:k,matchUps:p}),V=h.filter(F=>F.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:V.length,greatestAverageMinutes:S,scheduledRoundsDetails:T,dateScheduledMatchUps:A,matchUpsToSchedule:x,scheduleTimes:R,groupedRounds:E,venueCourts:V,minutesMap:C,matchUpMap:O},o||g.push(...P)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function _6e(t,e){let i=Ji(t.scheduleTime),r=Ji(t.timeAfterRecovery),n=Ji(e.scheduleTime),a=Ji(e.timeAfterRecovery),s=i===n||r===a,o=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return Ft({hasOverlap:s||o||c||l||u,startAisContained:o,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function f8({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let s=(i?.[n.matchUpId]?.participantIds||[]).flat(),o=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,l=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,c=s.every(p=>{j0({individualParticipantProfiles:t,participantId:p});let h=t[p];if(!h.timeAfterRecovery)return!0;let f=zr(n?.schedule?.endTime),m=f?Qo(f,ri(l)):Qo(r,ri(o)+ri(l));return![...Object.keys(h.potentialBookings).filter(g=>g!==n.drawId).map(g=>h.potentialBookings[g]).flat(),...h.bookings].find(g=>_6e({scheduleTime:r,timeAfterRecovery:m},g).hasOverlap)}),u=e[n.matchUpId],d=(u?VR(Gn(u),Gn(r),!1):0)>=0;return{enoughTime:c&&d}}function ISe({autoSchedulingAudit:t,tournamentRecords:e}){Ii({topic:Of,payload:t});let i=s=>s?Object.values(s).reduce((o,l)=>o+l.length||0,0):0,r=(t?.schedulingProfile||[]).reduce((s,o)=>s+o.venues.reduce((l,c)=>l+c.rounds.length,0),0),n={scheduledDatesCount:t.scheduledDates?.length,noTimeMatchUpIdsCount:i(t?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t?.overLimitMatchUpIds),requestConflictsCount:i(t?.requestConflicts),profileRoundsCount:r},a={itemType:xj,itemValue:n};for(let s of Object.values(e)){let o=s.tournamentId;nL(Of)?Ii({payload:{type:xj,tournamentId:o,detail:n},topic:Of}):C0({tournamentRecord:s,timeItem:a})}}function m8({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=ML(r),{matchUpId:a,matchUpType:s}=r,o=(r.roundPosition&&t[a]||[]).flat(),l=yi(n.concat(...o));return l.forEach(c=>{j0({individualParticipantProfiles:e,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=e[c];if(u)return[s,xu].find(d=>{let p=u.counters?.[d]||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function FC({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:s,tournamentRecord:o,matchUpDetails:l,matchUpIds:c,schedule:u}){if(!o)return{error:et};if(!l&&(!c||!Array.isArray(c)))return{error:fw};if(!l&&(!u||typeof u!="object"))return{error:bme};let d,p=[],h=0;if(r&&!n){let g=id({tournamentRecords:s,tournamentRecord:o});n=g.matchUpDependencies,d=g.matchUps}d||(d=Wa({tournamentRecord:o})?.matchUps??[]);let f=d.reduce((g,v)=>{let{matchUpId:y,drawId:b,matchUpStatus:I}=v;return(e||I!=="BYE")&&(t||!la.includes(I))&&(g[b]?g[b].push(y):g[b]=[y]),g},{}),m=l?.map(g=>g.matchUpId);for(let g of Object.keys(f)){let{drawDefinition:v}=Qg({tournamentRecord:o,drawId:g});if(!v)continue;let y=f[g].filter(I=>c?.includes(I)??m?.includes(I)),b=po({inContext:!1,drawDefinition:v}).matchUps;for(let I of y){let w=l?.find(S=>S.matchUpId===I)?.schedule||u,T=BF({schedule:w,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:s,tournamentRecord:o,checkChronology:r,drawDefinition:v,drawMatchUps:b,matchUpId:I});if(T?.warnings?.length&&p.push(...T.warnings),T?.success&&(h+=1),T.error)return T}}return p.length?{...oe,scheduled:h,warnings:p}:{...oe,scheduled:h}}function H0(t){let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:s,checkChronology:o,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!n)return FC(t);let u=Gt(t,[{[Fs]:!0},{[tU]:{matchUpContextIds:!1,matchUpDetails:!1},[uc]:Se,[Bo]:Rs}]);if(u.error)return u;if((!l||n)&&!c)return{error:Yt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=id({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:m}=f,g=n?.filter(y=>y.tournamentId===m).map(Pa),v=l?.filter(y=>y?.tournamentId===m);if(g?.length||v?.length){let y=FC({matchUpDetails:v,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:f,checkChronology:o,matchUpIds:g,schedule:c});if(y.warnings?.length&&d.push(...y.warnings),y.scheduled&&(p+=y.scheduled),y.error)return y}}return d.length?{...oe,scheduled:p,warnings:d}:{...oe,scheduled:p}}function k6e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){let g={},v={},y={},b={},I={},w={},T={},S={},D={},C={};for(let R of n){let M=Ui(R?.scheduleDate),A=R?.venues||[],N={},k={},x=(Z,J)=>{Z.forEach(ie=>{let K=k[ie].counters;K[J]?K[J]+=1:K[J]=1,K[xu]?K[xu]+=1:K[xu]=1})};y[M]={},b[M]={},g[M]={},v[M]={},T[M]=[],S[M]=[],D[M]=[],C[M]=[];let O={};h.forEach(Z=>{Z.schedule?.scheduledDate&&Lh(M,Ui(Z.schedule.scheduledDate))&&cU({matchUpPotentialParticipantIds:N,matchUpNotBeforeTimes:O,matchUp:Z})});let{allDateScheduledByeMatchUpDetails:V,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=bSe({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:O,matchUpScheduleTimes:w,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:M,matchUps:h,courts:f,venues:A}),q=10,W=0,z,H=10;for(;!z;){for(let{venueId:Z}of A){let J=0,ie=F[Z];for(;ie.courtsCount&&ie.scheduleTimes?.length&&ie.matchUpsToSchedule?.length&&J<=ie.courtsCount;){let{scheduleTime:K,attempts:ne=0}=ie.scheduleTimes.shift(),le=ie.matchUpsToSchedule.find(re=>{let{matchUpId:me,matchUpType:he}=re,{participantIdsAtLimit:Ie,relevantParticipantIds:Le}=m8({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpDailyLimits:o,matchUp:re});if(Ie.length)return S[M].includes(me)||S[M].push(me),!1;let{scheduledDependent:ot}=ySe({matchUpScheduleTimes:w,matchUpDependencies:s,scheduleTime:K,matchUpId:me,details:ie});if(ot)return!1;let{dependenciesScheduled:at,remainingDependencies:dt}=p8({matchUpScheduleTimes:w,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:re});if(!at)return b[M][me]||(b[M][me]=[]),b[M][me].push({scheduleTime:K,remainingDependencies:dt}),!1;let{enoughTime:It}=f8({individualParticipantProfiles:k,matchUpNotBeforeTimes:O,matchUpDependencies:s,scheduleTime:K,details:ie,matchUp:re});if(!It)return y[M][me]||(y[M][me]=[]),y[M][me].push({scheduleTime:K}),!1;let ze=ie.greatestAverageMinutes,{conflicts:Ct}=h8({potentials:e,averageMatchUpMinutes:ze,requestConflicts:C,personRequests:d,scheduleTime:K,scheduleDate:M,matchUp:re});if(Ct?.length)return I[M]||(I[M]=[]),I[M].push(...Ct),!1;x(Le,he);let ke=ie.minutesMap?.[me]?.recoveryMinutes;return LC({matchUpPotentialParticipantIds:N,individualParticipantProfiles:k,matchUpNotBeforeTimes:O,averageMatchUpMinutes:ze,matchUpDependencies:s,recoveryMinutes:ke,scheduleTime:K,matchUp:re}),w[me]=K,!0});ie.matchUpsToSchedule=ie.matchUpsToSchedule.filter(({matchUpId:re})=>re!==le?.matchUpId),le?J+=1:(v[M][Z]||(v[M][Z]=[]),v[M][Z].push({scheduleTime:K,attempts:ne+1}))}ie.matchUpsToSchedule?.length&&(v[M][Z]=v[M][Z]?.filter(K=>{let ne=K.attempts<q;return ne&&ie.scheduleTimes.push(K),!ne})),(!ie.scheduleTimes?.length||!ie.matchUpsToSchedule?.length)&&(ie.complete=!0)}W+=1,z=A.every(({venueId:Z})=>F[Z].complete)||W===H}for(let{venueId:Z}of A){let J=F[Z].matchUpMap;Object.keys(J).forEach(ie=>{let K=c[ie];K&&Object.keys(J[ie]).forEach(ne=>{let{drawDefinition:le}=Qg({tournamentRecord:K,drawId:ne});le&&J[ie][ne].forEach(({matchUpId:re})=>{let me=w[re];if(me){let he=me.split(":").map(_c).join(":"),Ie=`${Ui(M)}T${he}`;m?T[M].push(re):(ev({drawDefinition:le,scheduledTime:Ie,matchUpId:re}).success&&T[M].push(re),Z&&HD({tournamentRecord:K,drawDefinition:le,matchUpId:re,venueId:Z}))}})})}),D[M]=F[Z].matchUpsToSchedule.map(Pa),g[M][Z]=F[Z].scheduleTimes.sort((ie,K)=>Ji(ie.scheduleTime)-Ji(K.scheduleTime))}!m&&V?.length&&H0({matchUpDetails:V,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let Z of R.venues)for(let J of Z.rounds){let ie=(J.matchUps?.map(({matchUpId:ne})=>ne)||[]).filter(ne=>T[M].includes(ne));J.canScheduledMatchUpIds=ie;let K=Math.round(ie.length/J.matchUpsCount*1e4)/100;(K===1/0||isNaN(K))&&(K=0),J.possibleToSchedulePct=K,J.matchUpsCount===ie.length&&(J.possibleToSchedule=!0)}}let E=n.map(({scheduleDate:R})=>R),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:T,schedulingProfile:u,noTimeMatchUpIds:D,requestConflicts:C,scheduledDates:E};return ISe({tournamentRecords:c,autoSchedulingAudit:P}),{...oe,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:S,scheduledMatchUpIds:T,noTimeMatchUpIds:D,requestConflicts:C,scheduledDates:E}}function gX({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Yt,stack:"getEarliestCourtTime"};let a=uU({scheduleDate:n,courts:[r],startTime:!0}),s=uU({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||s;let o=$0({court:r,date:n}),{timeSlots:l}=jD({courtDate:o}),c=Gn(e),u=Gn(i);return{earliestCourtTime:l?.reduce((d,p)=>{let h=Gn(p.startTime),f=Gn(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(VR(m,f)>=t){let g=zr(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:s}}function O6e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:s,matchUpDailyLimits:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){let g={},v={},y={},b={},I={},w={},T={},S={},D={};for(let P of n??[]){let R=Ui(P?.scheduleDate),M=P?.venues||[],A={},N={},k=(le,re)=>{le.forEach(me=>{let he=N[me].counters;he[re]?he[re]+=1:he[re]=1,he[xu]?he[xu]+=1:he[xu]=1})};g[R]={},v[R]={},w[R]=[],T[R]=[],S[R]=[],D[R]=[];let x={};h?.forEach(le=>{le.schedule?.scheduledDate&&Lh(R,Ui(le.schedule.scheduledDate))&&cU({matchUpPotentialParticipantIds:A,matchUpNotBeforeTimes:x,matchUp:le})});let{allDateScheduledByeMatchUpDetails:O,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:F,allDateMatchUpIds:j}=bSe({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:I,matchUpDependencies:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:R,matchUps:h,courts:f,venues:M}),q=h?.filter(({matchUpId:le})=>V.includes(le)),{bookings:W}=$F({dateScheduledMatchUps:q,tournamentRecords:c,scheduleDate:R,periodLength:u}),{virtualCourts:z}=AF({scheduleDate:R,periodLength:u,bookings:W,courts:f}),H=z?.reduce((le,re)=>{let{earliestCourtTime:me,courtEndTime:he}=gX({date:R,averageMinutes:0,court:re});return(!le.startTime||Gn(me)<Gn(le.startTime))&&(le.startTime=me),(!le.endTime||Gn(he)>Gn(le.endTime))&&(le.endTime=he),le},{}),Z=H.startTime,J=({courtId:le,booking:re})=>z?.find(me=>me.courtId===le)?.dateAvailability[0].bookings.push(re),ie=10,K=0,ne;for(;!ne;){for(let{venueId:le}of M){let re=F[le],me=re.matchUpsToSchedule.length,he=[],Ie=[],Le,ot=0;for(;!Le;){for(let at of re.matchUpsToSchedule){if(Ie.length===re.courtsCount||he.length===re.courtsCount){Le=!0;break}let{matchUpId:dt,matchUpType:It}=at,{participantIdsAtLimit:ze,relevantParticipantIds:Ct}=m8({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,matchUpDailyLimits:o,matchUp:at});if(ze.length){T[R].includes(dt)||T[R].push(dt);continue}let{dependenciesScheduled:ke,remainingDependencies:mt}=p8({matchUpScheduleTimes:I,matchUpDependencies:s,allDateMatchUpIds:j,matchUp:at});if(!ke){v[R][dt]||(v[R][dt]=[]),v[R][dt].push({remainingDependencies:mt});continue}let Be=[],ut=z?.reduce((it,xe)=>{if(Ie.includes(xe.courtId))return it;let{earliestCourtTime:Ze}=gX({averageMinutes:re.greatestAverageMinutes,startTime:Z,date:R,court:xe});if(it.scheduleTime&&Ji(Ze)>=Ji(it.scheduleTime))return it;let{scheduledDependent:st}=ySe({matchUpScheduleTimes:I,matchUpDependencies:s,scheduleTime:Ze,matchUpId:dt,details:re});if(st)return it;let{enoughTime:qe}=f8({individualParticipantProfiles:N,matchUpNotBeforeTimes:x,matchUpDependencies:s,scheduleTime:Ze,details:re,matchUp:at});if(!qe)return g[R][dt]||(g[R][dt]=[]),g[R][dt].includes(Ze)||g[R][dt].push(Ze),it;let ft=re.minutesMap?.[dt]?.averageMinutes||re.greatestAverageMinutes,{conflicts:_t}=h8({potentials:e,averageMatchUpMinutes:ft,requestConflicts:D,personRequests:p,scheduleTime:Ze,scheduleDate:R,matchUp:at});if(_t?.length)return Be.push(..._t),!1;k(Ct,It);let ve=re.minutesMap?.[dt]?.recoveryMinutes;return LC({matchUpPotentialParticipantIds:A,individualParticipantProfiles:N,matchUpNotBeforeTimes:x,averageMatchUpMinutes:ft,matchUpDependencies:s,recoveryMinutes:ve,scheduleTime:Ze,matchUp:at}),(!it.scheduleTime||Ji(Ze)<Ji(it.scheduleTime))&&(it.averageMatchUpMinutes=ft,it.recoveryMinutes=ve,it.scheduleTime=Ze,it.courtName=xe.courtName,it.courtId=xe.courtId),it},{});if(ut.scheduleTime){let{averageMatchUpMinutes:it,recoveryMinutes:xe,scheduleTime:Ze,courtId:st}=ut;I[dt]=Ze,b[dt]=st,he.push(dt),Ie.push(st);let qe=Ze,ft=Qo(qe,it);J({courtId:st,booking:{averageMatchUpMinutes:it,recoveryMinutes:xe,periodLength:u,matchUpId:dt,startTime:qe,courtId:st,endTime:ft,venueId:le}}),re.matchUpsToSchedule=re.matchUpsToSchedule.filter(_t=>_t.matchUpId!==dt)}else Be?.length&&(y[R]||(y[R]=[]),y[R].push(...Be))}(Ie.length===re.courtsCount||he.length===re.courtsCount||!re.matchUpsToSchedule.length)&&(Le=!0),re.matchUpsToSchedule.length&&he<re.courtsCount&&(Gn(Z)<Gn(H.endTime)?Z=Qo(Z,u):(Le=!0,re.complete=!0)),ot+=1,!Le&&ot>=me&&(Le=!0)}re.matchUpsToSchedule?.length||(re.complete=!0)}K+=1,ne=M.every(({venueId:le})=>F[le].complete)||K===ie}for(let{venueId:le}of M){let re=F[le].matchUpMap;Object.keys(re).forEach(me=>{let he=c[me];he&&Object.keys(re[me]).forEach(Ie=>{let{drawDefinition:Le}=Qg({tournamentRecord:he,drawId:Ie});Le&&re[me][Ie].forEach(({matchUpId:ot})=>{let at=I[ot],dt=b[ot];if(at){let It=at.split(":").map(_c).join(":"),ze=`${Ui(R)}T${It}`;m||(ev({drawDefinition:Le,scheduledTime:ze,matchUpId:ot}),Gw({courtDayDate:R,tournamentRecords:c,tournamentRecord:he,drawDefinition:Le,matchUpId:ot,courtId:dt})),w[R].push(ot)}})})}),S[R]=F[le].matchUpsToSchedule.map(Pa)}!m&&O?.length&&H0({matchUpDetails:O,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let le of P.venues)for(let re of le.rounds){let me=(re.matchUps??[]).map(({matchUpId:Ie})=>Ie)?.filter(Ie=>w[R].includes(Ie));re.canScheduledMatchUpIds=me;let he=Math.round((me?.length||0)/re.matchUpsCount*1e4)/100;(he===1/0||isNaN(he))&&(he=void 0),re.possibleToSchedulePct=he,re.matchUpsCount===me?.length&&(re.possibleToSchedule=!0)}}let C=(n??[]).map(({scheduleDate:P})=>P),E={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:w,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:C};return ISe({tournamentRecords:c,autoSchedulingAudit:E}),{...oe,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:T,scheduledMatchUpIds:w,noTimeMatchUpIds:S,requestConflicts:D,scheduledDates:C}}function VF(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=la,scheduledDates:r,venueIds:n}=t,a=Qc(t),s=qi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!s?.length)return{error:hn};let o=0;for(let l of s){let c=a[l],u=x6e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;o+=u.clearedScheduleCount??0}return{...oe,clearedScheduleCount:o}}function x6e({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=la,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:et};if(!Array.isArray(e)||!Array.isArray(n))return{error:Se};n.length&&t.push("venueId");let a=Wa({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],s={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&x0({schedule:u,scheduleAttributes:t})&&(!n?.length||n.includes(u.venueId))&&(s[d]||(s[d]=[]),s[d].push(p))});let o=i.tournamentId,l=0;for(let c in s){let{event:u,drawDefinition:d}=Lo({tournamentRecord:i,drawId:c}),p=po({drawDefinition:d,matchUpFilters:{matchUpIds:s[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=m?.itemType&&![zh,Ug,Pw,kL,Cw,Rw].includes(m?.itemType);return g||(f=!0),g}),f&&(Hi({context:"clear schedules",eventId:u?.eventId,drawDefinition:d,tournamentId:o,matchUp:h}),l+=1)}}return{...oe,clearedScheduleCount:l}}function jF(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:s,useGarman:o,dryRun:l,pro:c}=t,u=Gt(t,[{[Fs]:!0},{[hs]:C=>!C||Array.isArray(C)&&C.every(tl),[Vge]:!1,[Bo]:Rs}]);if(u.error)return u;let d=Cm({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...oe};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>CD({tournamentRecord:C}).containedStructures)),g=n.map(C=>{if(tl(C))return Ui(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>tl(C)&&Ui(C)).filter(C=>C&&(!n.length||g.includes(C)));if(!v.length)return{error:Kfe};if(r&&!l){let C=Array.isArray(r)?r:[];VF({tournamentRecords:a,scheduledDates:C})}let y=Pm({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Cd({matchUpFilters:{matchUpTypes:[wr,mr]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=id({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:w}=PF({tournamentRecords:a}),{personRequests:T}=tb({requestType:G0,tournamentRecords:a}),S=f.filter(C=>{let E=Ui(C?.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),D={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:w,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:f,personRequests:T,periodLength:s,matchUps:b,dryRun:l,courts:y};return c?O6e(D):k6e(D)}function GF(t){let{tournamentRecord:e,tournamentRecords:i,activeTournamentId:r,...n}=t||{};return n.tournamentId||(n.tournamentId=lr()),n.startDate&&!cy(n.startDate)&&!l_.test(n.startDate)?{error:Ba}:n.endDate&&!cy(n.endDate)&&!l_.test(n.endDate)?{error:Ba}:(n.extensions&&(n.extensions=n.extensions.filter(Ep)),{...n})}function g8({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:s}){if(!i)return{error:et};let o={},l=(i.participants??[]).filter(({participantType:f,participantRole:m})=>f===Bi&&m===vs),c=0;for(let f of l){let m=a&&qb({element:f,accessor:a})?.value||r&&f.person?.[r]||e&&f[e];if(m){if(!Object.keys(o).includes(m)){o[m]={participantName:n?.[c]??m,participantId:s?.pop()??lr(),individualParticipantIds:[],participantRole:vs,participantType:hr};let g={value:r??e,name:cj};nr({element:o[m],extension:g}),c+=1}o[m].individualParticipantIds.push(f.participantId)}}let u=Object.keys(o),d=(i.participants??[]).map(f=>{if(f.participantType!==hr||f.participantRole!==vs)return;let{extension:m}=Ci({name:cj,element:f}),g=m?.value;if(u.includes(g))return f.participantId}).filter(Boolean),p=0,h=[];return Object.keys(o).forEach(f=>{let m=o[f],{participantId:g}=m;d.includes(g)||(i.participants||(i.participants=[]),t&&i.participants.push(m),h.push(m),p++)}),t&&p?(Ii({payload:{tournamentId:i.tournamentId,participants:h},topic:Ig}),{...oe,participantsAdded:p}):h.length?{...oe,newParticipants:h}:{error:Uje}}var L6e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],F6e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function wSe({count:t=1,participantsCount:e=32}={}){let i=co(F6e),r=i.slice(0,t);return{cities:yt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Tu(r))}}function SSe({count:t=1,participantsCount:e=32}={}){let i=co(L6e),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:yt(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Tu(r))}}function TSe({count:t=1,participantsCount:e=32}={}){let i=yt(0,t).map(()=>yt(0,5).map(()=>Rc(0,9)).join(""));return{postalCodes:yt(0,e).map(r=>r<t?i[r]:Tu(i))}}function k_({idPrefix:t,participantType:e,index:i,uuids:r}){let n=Yr(e)?e[0]:"X";return t?`${t}-${n}-${i}`:r?.pop()||lr()}function USe(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r?.[a],state:i?.[a],city:e?.[a],countryCode:n}}var B6e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function yB(t){let{count:e=100,sex:i}=t||{};if(!e||i&&!Sp(i))return{personData:[],error:Se};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:s}=B6e,o=ng.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/s.length),d=yt(0,l).flatMap(()=>{let m=Et(n,!1,!0);return yt(0,n.length).map(()=>yl(m))}),p=yt(0,c).flatMap(()=>{let m=Et(a,!1,!0);return yt(0,a.length).map(()=>yl(m))}),h=yt(0,u).flatMap(()=>{let m=Et(s,!1,!0);return yt(0,s.length).map(()=>yl(m))}),f={};for(let m=0;m<r;m++){let g=d.pop(),v=i||Tu([Xn,ps]),y=v===Xn?h.pop():p.pop(),b=Tu(o);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function DSe(t){let e=t?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:s,category:o,sex:l}=t||{};if(isNaN(e))return{error:Se};let c=a?.[Xn]||Cb(l)&&e||0,u=a?.[ps]||Mv(l)&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&yB({count:c,sex:Xn}).personData||[],h=u&&yB({count:u,sex:ps}).personData||[],f=[...p,...h,...d&&yB({count:d}).personData||[]],m=f.filter(D=>!l||c&&u||D.sex===l),g=[];if(Array.isArray(s)){let D=s.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![Xn,ps].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!ng.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(D.length)m=D;else return{error:Se}}let v=s?m:co(m);if(v.length<e){let{maleFirstNames:D,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:R}=f.reduce((M,A)=>{let{firstName:N,lastName:k,nationalityCode:x}=A;return A.sex===Xn?(M.maleFirstNames.includes(N)||M.maleFirstNames.push(N),M.maleLastNames.includes(k)||M.maleLastNames.push(k)):(M.femaleFirstNames.includes(N)||M.femaleFirstNames.push(N),M.femaleLastNames.includes(k)||M.femaleLastNames.push(k)),M.nationalityCodes.includes(x)||M.nationalityCodes.push(x),M},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});yt(0,e-v.length).forEach(()=>{let M=l||Tu([Xn,ps]),A=Tu(R),N=Tu(M===Xn?D:E),k=Tu(M===Xn?C:P),x={firstName:N,lastName:k,sex:M,nationalityCode:A};v.push(x)})}let{ageMinDate:y,ageMaxDate:b}=bI({consideredDate:r,category:o}),I=ri(y?.slice(0,4)||0)||ri(b?.slice(0,4)||0)-3,w=ri(b?.slice(0,4)||0)||ri(y?.slice(0,4)||0)+3,T=(y||b)&&[I,w],S=v.slice(0,e).map((D,C)=>{let[E,P]=T||[],R=T&&yl(yt(E,P)),M=yl(yt(0,365)),A=R&&yGe(R,M);return Object.assign(Ft({extensions:i||[{name:"regionCode",value:C+1}],birthDate:A,isMock:n}),D)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var $6e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function O_({nameRoot:t="TEAM",count:e=1}={}){let i=co($6e).slice(0,e);return i.length<e&&yt(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function qD(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Da,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:s,categories:o,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:h,teamSize:f=8,personIds:m,idPrefix:g,uuids:v,personExtensions:y,addressProps:b,gendersCount:I,matchUpType:w,personData:T,sex:S,inContext:D,withISO2:C,withIOC:E,scaleAllParticipants:P}=t,R=h===Ei||w===ly,M=h===hr||w===hr;i&&(!Array.isArray(i)||!i.every(ke=>vn(ke))||i.length!==2)&&(i=void 0),e=P?p:e;let A=1e3,N=e&&e>A?e:A;i=i||[1,N],i[1]+=1;let k=p*(R&&2||M&&(f??8)||1),x=DSe({count:k,personExtensions:y,consideredDate:s,gendersCount:I,personData:T,category:l,sex:S});if(x.error)return x;let{nationalityCodes:O,persons:V}=x,F={},j={},q={},W={},z=ke=>{Object.assign(F,ke.doublesRankings),Object.assign(j,ke.singlesRankings),Object.assign(W,ke.doublesRatings),Object.assign(q,ke.singlesRatings)};if(qi(l)){let ke=vX({scaledParticipantsCount:e,ratingsParameters:r,participantType:h,ratingsValues:a,rankingRange:i,category:l});z(ke)}Array.isArray(o)&&o.forEach(ke=>{let mt=vX({scaledParticipantsCount:e,ratingsParameters:r,participantType:h,ratingsValues:a,rankingRange:i,category:ke});z(mt)});let H=ng.filter(ke=>u==="IOC"&&ke.ioc||ke.iso);function Z(ke){let mt=Math.ceil(k/ke);return n&&mt>n?Math.ceil(k/n):ke}let{postalCodesProfile:J,postalCodesCount:ie,statesProfile:K,citiesProfile:ne,citiesCount:le,statesCount:re}=b||{},me=ke=>Object.keys(ke).map(mt=>yt(0,K[mt]).map(()=>mt)).flat(),he=ne&&me(ne)||b?.cities||wSe({count:le||k,participantsCount:k}).cities,Ie=K&&me(K)||b?.states||SSe({count:re||k,participantsCount:k}).states,Le=J&&me(J)||b?.postalCodes||TSe({count:ie||k,participantsCount:k}).postalCodes,ot={cities:he,states:Ie,postalCodes:Le},at=Z(c),dt=at?co(H).slice(0,c):d&&H.filter(ke=>d.includes(ke.iso))||H,It=co(yt(0,Math.ceil(k/(at||1))).map(()=>dt).flat(1/0)),ze=O_({count:p}).names;return{participants:yt(0,p).map(ke=>{let mt=R&&2||M&&(f??8)||1,Be=yt(0,mt).map(st=>{let qe=ke*mt+st;return Ct(qe)}),ut=Be.map(st=>st.participantId),it=Be.map(st=>st.person.standardFamilyName).join("/"),xe=R?Ei:hr,Ze={participantId:k_({participantType:xe,index:ke,idPrefix:g,uuids:v}),participantName:R?it:ze[ke],participantRole:vs,individualParticipantIds:ut,participantType:xe};return D&&(Ze.individualParticipants=Be),R||M?[Ze,...Be]:Be}).flat(),...oe};function Ct(ke){let mt=V[ke],{nationalityCode:Be,participantExtensions:ut,participantTimeItems:it,extensions:xe,firstName:Ze,birthDate:st,lastName:qe,personId:ft,sex:_t}=mt||{},ve=Ze||"GivenName",$e=qe||"FamilyName",De=`${ve} ${$e}`,je=It[ke],Oe=O?.length&&Be||je&&(u==="IOC"?je.ioc||je.iso:je.iso||je.ioc)||Be;It?.length&&!Oe&&!Be&&console.log("%c Invalid Nationality Code",{participantIndex:ke,country:je});let nt=USe({...ot,participantIndex:ke,nationalityCode:Oe}),Fe=Ft({participantId:k_({participantType:Bi,index:ke,idPrefix:g,uuids:v}),extensions:ut,timeItems:it,participantRole:vs,participantType:Bi,participantName:De,person:{personId:ft||m?.length&&m[ke]||lr(),birthDate:tl(st)?st:void 0,addresses:[nt],standardFamilyName:$e,standardGivenName:ve,nationalityCode:Oe,extensions:xe,sex:_t}});if(E&&Oe){let pt=ng.find(({iso:Mt})=>Mt===Oe);pt?.ioc&&(Fe.person.iocNationalityCode=pt.ioc),pt?.label&&(Fe.person.countryName=pt.label)}if(C&&Oe){let pt=ng.find(({iso:Mt})=>Mt===Oe);pt?.iso2&&(Fe.person.iso2NationalityCode=pt.iso2),pt?.label&&(Fe.person.countryName=pt.label)}let wt=pt=>{let Mt=pt.categoryName||pt.ratingType||pt.ageCategoryCode,Wi=j[Mt]?.[ke],Qt=F[Mt]?.[ke];MM({scaleValue:Wi,eventType:II,scaleType:yg,participant:Fe,category:pt}),MM({scaleValue:Qt,eventType:em,scaleType:yg,participant:Fe,category:pt});let tr=q[Mt]?.[ke],Vi=W[Mt]?.[ke];MM({scaleValue:tr,eventType:II,scaleType:rg,participant:Fe,category:pt}),MM({scaleValue:Vi,eventType:em,scaleType:rg,participant:Fe,category:pt})};return Array.isArray(o)?o.forEach(pt=>wt(pt)):l&&wt(l),Fe}}function MM({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,s=[hy,r,i,a].join("."),o={itemValue:t,itemType:s};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function vX(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,s=e.rankingRange||t.rankingRange||[1,1e3],o={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:h}=e,f=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!h){let[m,g]=s||[];if(l[f]=co(yt(m,g)).slice(0,i||Rc(20,30)),[Ei,hr].includes(n)){let[v,y]=s||[];o[f]=co(yt(v,y)).slice(0,i||Rc(20,30))}}if(h&&r[h]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...r[h],...v||{}},{attributes:b={},decimalsCount:I,accessors:w,range:T,step:S}=y,D=M=>{let A={},N=Object.keys(M||{});for(let k of N){let x=M[k];if(typeof x=="object"&&x.generator){let{range:O}=x,[V,F]=O.slice().sort();A[k]=Rc(V,F)}else A[k]=x}return A},C=T[0]>T[1]?2:.7,[E,P]=T.slice().sort(),R=yt(0,2e3).map(()=>hfe(E,P,C,S,I)).filter(M=>(!m||M<=m)&&(!g||M>=g)).slice(0,i||Rc(20,30)).map(M=>w?Object.assign({},...w.map(A=>({[A]:M})),D(b)):M);c[f]=[...a,...R],[Ei,hr].includes(n)&&(u[f]=[...a,...R])}return{singlesRankings:l,doublesRankings:o,singlesRatings:c,doublesRatings:u}}function v8(t){let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,s=0,o=0,l={},c={[Xn]:0,[ps]:0,[ww]:0,[Pf]:0,ANY:0};(qi(t.tieFormat)?t.tieFormat:Qf({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach(h=>{let{category:f,collectionId:m,matchUpType:g,matchUpCount:v,gender:y}=h;if(Sp(y)){let b=Ns(y),I=v*(g===mr?2:1);b&&c[b]<I&&(c[b]=I)}else tc(y)&&(c[Xn]<v&&(c[Xn]=v),c[ps]<v&&(c[ps]=v));if(f){let b=JSON.stringify(f);l[b]=f}if(m||(h.collectionId=lr()),On(mr)(g)){let b=v;o+=v,n=Math.max(n,b)}if(On(wr)(g)){let b=v;s+=v,a=Math.max(a,b)}});let u=Object.keys(l).length?Math.max(s,o*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function V6e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=Bi}=t||{},a=r||0,s={[ps]:0,[ww]:0,[Pf]:0,[Xn]:0,ANY:0},o=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:w,stage:T})=>{let S=y===jc,D=y===ta,C=!!(m||T===zt||I||w);if(D){u=Math.max(u,v+f),b=typeof b=="object"?b:Qf({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:R,genders:M}=v8({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,E),l=Math.max(l,R),C||(o=Math.max(o,P)),Object.keys(M).forEach(A=>s[A]+=M[A])}else if(S)if(C){let E=(v+f)*2;d+=E,w&&(s[w]+=E)}else v+f&&v+f>o&&(o=v+f);else if(C){let E=v+f;w&&(s[w]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e?.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let w of v){let{tieFormatName:T,tieFormat:S}=w;p({...w,tieFormatName:T||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,o*2,l);return o&&(n=Ei),(r||a)<h&&(r=h),r&&o&&[Ei,ta].includes(n)&&(l&&Math.floor(l/2)>o?r=Math.floor(l/2):(!l||o*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!e?.length&&!i?.length?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:s}}function ESe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(t?.participantsCount===0)return{addedCount:0,...oe};let{participantsCount:s,participantType:o,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=V6e({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t?.teamKey,p=qD({consideredDate:n,...t,participantsCount:s,participantType:o,gendersCount:u,uuids:a}).participants,h=0,f=Ku({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=g8({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Bi).map(Fi),g=t?.idPrefix?`${hr}-${t.idPrefix}`:void 0,v=yt(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=k_({index:y,participantType:o,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:vs,individualParticipantIds:b,participantType:hr,participantId:I}});return f=Ku({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...oe})}function PSe({drawProfiles:t,category:e,gender:i}){let r={},n=t?.reduce((s,o)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Dt,drawSize:p=0}=o||{};Object.keys(s).includes(d)||(s[d]=0);let h=(c||p)-l;return u||i||e||d===zt?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=h):s[d]=Math.max(s[d],h),s},{}),a=Object.keys(r);return a.forEach(s=>n[s]+=r[s]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function CSe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Dt]||0,a=e[zt]||0;return{stageParticipants:{QUALIFYING:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(0,a),MAIN:r?.filter(({participantType:s})=>s===i).filter(({participantId:s})=>!t.includes(s)).slice(a,a+n)}}}var j6e={[Fr]:2,[ln]:1,[ra]:1,[wa]:1,[br]:4};function y8(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=j6e,matchUpFormat:n=_u,pointsPerMinute:a=1,sideWeight:s=4}=t;if(!Al({matchUpFormat:n}))return{error:T4};if(typeof r!="object")return{error:Se};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(s))return{error:Se};let o=Object.keys(r).filter(E=>Object.keys(DL).includes(E)&&E!==Tn);if(Object.keys(o).reduce((E,P)=>E+r[P],0)>100)return{error:Se,matchUpStatusProfile:r};let l=o.reduce((E,P)=>(E.pointer=E.pointer+r[P],E.valueMap.push([E.pointer,P]),E),{pointer:0,valueMap:[]}),c=Rc(1,100),u=(l.valueMap.find(E=>c<=E[0])??[100,Tn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(_s(u)){i=i||Rc(1,2);let E={score:d,matchUpStatus:u,winningSide:i};if(!(u===br&&Rc(1,100)>100-e))return{outcome:E}}else if([ln,ra].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=js(n),{bestOf:h=1,exactly:f,setFormat:m,finalSetFormat:g}=p??{},v=[],y=Rc(0,1),b=i?[i-1]:[...yt(0,s).map(()=>y),1-y],I=[wa,br,Ol,Kg].includes(u)&&(yl(yt(1,f||h))||1),w,T=yt(1,(f??h)+1);for(let E of T){let P=E===(f??h),{set:R,incomplete:M,winningSideNumber:A}=G6e({setFormat:P&&g||m,incomplete:I===E,pointsPerMinute:a,matchUpStatus:u,weightedRange:b,setNumber:E});if(v.push(R),M){w=A;break}if(xC({matchUp:{score:{sets:v},matchUpFormat:n}}).calculatedWinningSide)break}let S=xC({matchUp:{score:{sets:v},matchUpFormat:n,winningSide:i}}),D=w?i||w:S.calculatedWinningSide,{score:C}=dSe({winningSide:D,score:{sets:v},matchUpStatus:u});return{outcome:{winningSide:D,matchUpStatus:u,score:C}}}function G6e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let s={setNumber:a},{setTo:o,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,h=Rc(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+yl([1,-1])*v,b=eje(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let w=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(r){let[D,C]=I;return Object.assign(s,{side1Score:D,side2Score:C}),la.includes(i)?{set:s,incomplete:r,winningSideNumber:m}:{set:s,incomplete:r}}w||(I[Rc(0,1)]+=1),w=I[0]>I[1]?1:2,w!==m&&I.reverse();let[T,S]=I;return Object.assign(s,{side1Score:T,side2Score:S,winningSide:m}),{set:s}}else{if(r)return s.side1Score=Rc(0,c),s.side2Score=Rc(0,c),la.includes(i)&&(m=t[h]+1),{set:s,incomplete:r,winningSideNumber:m};{let g=yt(1,o+1).map(S=>yt(0,o+2-S).map(()=>S)).flat(),v=g[Rc(0,g.length-1)],y=o&&n7({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:o}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[S,D]=y;Object.assign(s,{side1Score:S,side2Score:D})}let w=kC({matchUpScoringFormat:{setFormat:n},setObject:s}),T;if(w.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:D}=l||u||{},C=yt(1,D+1).map(R=>yt(0,D+2-R).map(()=>R)).flat(),E=C[Rc(0,C.length-1)],P=uF({isSide1:!0,tiebreakNoAd:S,tiebreakTo:D,lowValue:E});if(P)if(b){let R=P[0]>P[1]?1:2;I?R!==I&&P.reverse():f&&P.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=P,T=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else w.leadingSide===2?[s.side1TiebreakScore,s.side2TiebreakScore]=P:[s.side2TiebreakScore,s.side1TiebreakScore]=P}s.winningSide=w.winningSide||w.leadingSide||I||T}}return{set:s}}function x_(t){let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:s,event:o}=t;if(!s)return{error:At};let l=t.matchUpFormat||s.matchUpFormat||o?.matchUpFormat,c=s.structures.slice().sort(Dw),u=0,{matchUps:d,matchUpsMap:p}=qn({matchUpFilters:{matchUpTypes:[kr],roundNumbers:[1]},contextFilters:{stages:[Dt,zt]},inContext:!0,drawDefinition:s});if(d?.length){let v=o?.category?.ageCategoryCode||o?.category?.categoryName;if(v){let y=jwe({singlesOnly:!0,tournamentRecord:n,drawDefinition:s,scaleAccessor:{scaleName:v,sortOrder:"ASC",scaleType:yg},event:o});if(y.error)return y;let{lineUps:b,participantsToAdd:I}=y;Ku({tournamentRecord:n,participants:I}),nr({element:s,extension:{name:im,value:b}})}else{let y=d[0]?.structureId,{positionAssignments:b}=Tr({drawDefinition:s,structureId:y});if(b?.length){let{participants:I}=un({participantFilters:{participantTypes:[kr]},tournamentRecord:n}),w=T=>{let S=T.tieMatchUps.filter(On(wr)),D=T.tieMatchUps.filter(On(mr));S.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(R=>{let{drawPosition:M}=R,A=I?.find(N=>{let{participantId:k}=N;return b.find(x=>x.participantId===k)?.drawPosition===M});if(A){let N=A.individualParticipantIds?.[E];N&&__({teamParticipantId:A.participantId,participantId:N,tournamentRecord:n,drawDefinition:s,tieMatchUpId:P,event:o})}})}),D.forEach((C,E)=>{let P=C.matchUpId;C.sides.forEach(R=>{let{drawPosition:M}=R,A=I?.find(N=>{let{participantId:k}=N;return b.find(x=>x.participantId===k)?.drawPosition===M});A&&A.individualParticipantIds?.slice(E*2,E*2+2)?.forEach(N=>{__({teamParticipantId:A.participantId,participantId:N,tournamentRecord:n,drawDefinition:s,tieMatchUpId:P,event:o})})})})};d.forEach(w)}}}let h=typeof i=="string"&&i,f=h&&Tn,m=c.length===2&&c[0].finishingPosition===py&&En(c.map(({stage:v})=>v),[Dt,wn]).length===2,g=c.map(({structureId:v})=>v);for(let v of g){if(u>=a)break;let y=s.structures.find(w=>w.structureId===v),b=ar({contextFilters:{matchUpTypes:[mr,wr]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}).matchUps;b.length;let I=b.filter(({winningSide:w})=>!w).sort(_w).map(Pa);for(let w of I){if(!isNaN(a)&&u>=a)break;let{matchUps:T}=ar({matchUpFilters:{matchUpTypes:[mr,wr]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:s,matchUpsMap:p,structure:y,event:o}),S=T.find(C=>C.matchUpId===w),D=[ln,ra].includes(S.matchUpStatus);if(S?.readyToScore&&!D){let C=H6e({matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:s,targetMatchUp:S,matchUpFormat:l,matchUpStatus:f,scoreString:h,winningSide:!r&&1,event:o});if(C?.error)return C;u+=1}}m&&y.finishingPosition===py&&t.completeRoundRobinPlayoffs&&kD({structureId:y.structureId,applyPositioning:!0,drawDefinition:s})}return{...oe,completedCount:u}}function RSe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:s,matchUpFormat:o,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus==="BYE")return;let{matchUpId:d}=a||{},{outcome:p}=d8({matchUpFormat:o,matchUpStatus:s,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),V0({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function H6e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:s,targetMatchUp:o,scoreString:l,winningSide:c,event:u}=t;if(l||a)return RSe(t);let{matchUpId:d}=o||{},{outcome:p}=y8({matchUpStatusProfile:e,matchUpFormat:s,winningSide:c});return V0({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function MSe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:s}){let o=Rn({event:s}).flightProfile,{eventName:l,eventType:c,category:u}=s,{startDate:d}=r,p=[],h=u?.categoryName||u?.ageCategoryCode||u?.ratingType,f=s.drawDefinitions?.map(({drawId:m})=>m);if(Array.isArray(o?.flights))for(let[m,g]of o.flights.entries()){let{drawId:v,stage:y,drawName:b,drawEntries:I}=g;p.push(g.drawId);let w=n[m],{seedsCount:T,generate:S=!0}=w||{};if(S){let D=I.filter(xl(jh)).map(xl(jh)),C=h||l;if(r&&T&&T<=D.length&&yt(1,T+1).forEach((A,N)=>{let k={scaleValue:A,scaleName:C,scaleType:gh,eventType:c,scaleDate:d},x=D[N];A0({tournamentRecord:r,participantId:x,scaleItem:k})}),f?.includes(v))break;let E=F0({...w,matchUpType:c,seedingScaleName:C,tournamentRecord:r,drawEntries:I,drawName:b,drawId:v,isMock:a,event:s,stage:y});if(E.error)return{error:E.error,drawIds:[]};let{drawDefinition:P}=E;if(!P)return{error:lc};let R=n[m]?.drawExtensions;if(Array.isArray(R)&&R.filter(Ep).forEach(A=>nr({element:P,extension:A})),E=B0({suppressNotifications:!0,tournamentRecord:r,drawDefinition:P,event:s}),E.error)return{error:E.error,drawIds:[]};if(w?.withPlayoffs){let A=P.structures?.[0].structureId,N=JL({idPrefix:w.idPrefix,...w.withPlayoffs,tournamentRecord:r,drawDefinition:P,structureId:A,isMock:a,event:s});if(N?.error)return N}let M=w?.completionGoal;if(w?.automated!==!1&&(e||M)){let A=w?.matchUpFormat,N=x_({completeAllMatchUps:!M&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:M,drawDefinition:P,matchUpFormat:A,event:s});if(N.error)return{error:N.error,drawIds:[]};let k=N.completedCount;if(w?.drawType===Vh){let x=P.structures?.find(F=>F.stage===Dt);if(!x)return{error:en};let O=kD({structureId:x.structureId,tournamentRecord:r,drawDefinition:P});if(O.error)return{error:O.error,drawIds:[]};let V=M?M-(k??0):void 0;if(O=x_({completeAllMatchUps:!M&&e,completionGoal:M?V:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:P,matchUpFormat:A,event:s}),O.error)return{error:O.error,drawIds:[]}}}}}return{...oe,drawIds:p}}function NSe(t){let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:s,event:o,uuids:l}=t,{category:c,gender:u,eventType:d}=o,p=On(Up)(d)&&Bi||On(jc)(d)&&Ei||d,h=i[Dt]||0,f=i[zt]||0,m=a.drawProfiles?.length?h+f:a.participantsProfile?.participantsCount??0,g=Sp(u)?u:void 0,v=e?.idPrefix?`E-${s}-${e?.idPrefix}`:void 0,{participants:y}=qD({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:r,category:c,idPrefix:v,sex:g}),b=Ku({tournamentRecord:n,participants:y});if(b.error)return b;let I=y?.filter(({participantType:T})=>T===p),w=y?.map(Fi);return{uniqueDrawParticipants:I,uniqueParticipantIds:w}}function z6e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=sp,qualifyingPositions:s=0,stage:o=Dt,drawSize:l=0,drawName:c,drawId:u}=r,d=l-s,p=i.slice(0,d).map(Fi);if(p.length){let m=op({participantIds:p,autoEntryPositions:t,entryStage:o,tournamentRecord:e,event:n});if(m.error)return m}let h=p.map(m=>({entryStatus:ol,entryStage:o,participantId:m})),f=NF({drawName:c||a,qualifyingPositions:s,drawEntries:h,drawId:u,event:n,stage:o});return f.error?f:{...oe}}function ASe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:s,event:o}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Dt,drawSize:h=0}=c,f=h-u,m=d||s||a||p===zt,g=m?t.slice(l,l+f):i[p||Dt]||[];m&&(l+=f);let v=z6e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:c,event:o});if(v.error)return v}return{...oe}}function _Se(t){let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=Up,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:w,tieFormatName:T,processCodes:S,discipline:D,eventLevel:C,timeItems:E,ballType:P,category:R}=u,M=u.eventId||lr(),A=u.tieFormat||(v===ta?Qf({namedFormat:T,event:{eventId:M,category:R,gender:m},hydrateCollections:s,isMock:h}):void 0),N=c.participants;for(let K of b)!m&&K.gender&&(m=K?.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:x,uniqueParticipantStages:O}=PSe({drawProfiles:b,category:R,gender:m}),V=On(Up)(v)&&Bi||On(jc)(v)&&Ei||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:j=[]}=O?NSe({event:{eventType:v,category:R,gender:m},uniqueParticipantsCount:x,participantsProfile:r,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:q}=u;typeof q!="object"&&(q={});let W=R?.categoryName||R?.ageCategoryCode||R?.ratingType;g=g||W||"Generated Event";let z={...q,surfaceCategory:w,processCodes:S,discipline:D,eventLevel:C,eventName:g,eventType:v,tieFormat:A,ballType:P,category:R,eventId:M,gender:m};if(I?.length&&Array.isArray(I)){let K=I.filter(Ep);K?.length&&Object.assign(z,{extensions:K})}if(Array.isArray(E)&&E.forEach(K=>Bw({event:J,timeItem:K})),typeof y=="object")for(let K of Object.keys(y))yy({policyDefinitions:{[K]:y[K]},event:z});z.category&&(z.category.categoryName=W);let H,Z=BD({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(Z.error)return Z;let J=Z?.event,{stageParticipants:ie}=CSe({allUniqueParticipantIds:e,stageParticipantsCount:k,eventParticipantType:V,targetParticipants:N});if(b?.length){let K=ASe({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:ie,tournamentRecord:c,drawProfiles:b,category:R,gender:m,event:J});if(K.error)return K;let ne=MSe({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:b,isMock:h,event:J});if(ne.error)return ne;H=ne.drawIds}else if(u?.participantsProfile?.participantsCount){let K=F.map(Fi);if(K.length){let ne=op({participantIds:K,autoEntryPositions:a,tournamentRecord:c,entryStage:Dt,event:J});if(ne.error)return ne}}return p&&VD({tournamentRecord:c,event:J}),{drawIds:H,eventId:M,uniqueParticipantIds:j}}function b8({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!tl(e))return{error:Ba};let n="addSchedulingProfileRound",{extension:a}=Ci({name:UI,tournamentRecords:t,discover:!0}),s=a?.value||[],o=s.find(p=>Lh(e,p.scheduleDate));if(!o){let{startDate:p,endDate:h}=hF({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Ba};o={scheduleDate:e,venues:[]},s.push(o)}let l=o.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},o.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>qi(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return ue({result:{error:Ofe},stack:n});l.rounds.push(r);let d=LD({tournamentRecords:t,schedulingProfile:s});return d.error?d:{...oe}}function q6e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Se};let i=CD({tournamentRecord:e}).containedStructures,r=Wa({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let s of t){let{scheduleDate:o,venues:l=[]}=s;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=r.filter(v=>{let y=f?.indexOf("-")>0&&f.split("-").map(I=>+I),b=v.finishingPositionRange?.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||En(b,y).length===2||yi(b).length===yi(y).length&&En(b,y).length===yi(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:w}=g,T=g.structureId;y&&!f&&(T=Object.keys(i).find(C=>i[C].includes(T))??T);let S={tournamentId:n,structureId:T,roundNumber:y,roundSegment:m,eventId:v,drawId:h},D=b8({tournamentRecords:{[n]:e},round:S,scheduleDate:o,venueId:d});if(D.error)return D;a.push({structureName:I,roundName:w,drawName:b,...S})}}}}return{scheduledRounds:a}}function HF(t){let e=Gt(t,[{drawProfile:!0,_ofType:Zo}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:s,hydrateCollections:o,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=Et(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=_u,drawType:b=sp,tournamentAlternates:I=0,alternatesCount:w=0,qualifyingPositions:T,qualifyingProfiles:S,generate:D=!0,eventExtensions:C,drawExtensions:E,completionGoal:P,tieFormatName:R,buildTeams:M,seedsCount:A,timeItems:N,drawName:k,category:x,idPrefix:O,publish:V,gender:F,stage:j}=g,q=g.drawSize||(g.ignoreDefaults?void 0:32),W=g.eventId||lr(),z=p.eventType||p.matchUpType||Up,H=z===jc?Ei:Bi,Z=qi(p.tieFormat)&&p.tieFormat||z===hr&&Qf({event:{eventId:W,category:x,gender:F},namedFormat:R,hydrateCollections:o,isMock:d})||void 0,J=x?.categoryName||x?.ageCategoryCode||x?.ratingType,ie=p.eventName||J||`Generated ${z}`,K=u?.participants||[],ne=(S?.map(Be=>Be.structureProfiles||[]).flat().reduce((Be,ut)=>{let it=!ut.participantsCount||ut.participantsCount>ut.drawSize?ut.drawSize:ut.participantsCount||0;return Be+it},0)||0)*(H===Ei?2:1),le=(!p.participantsCount||p.participantsCount>q?q:p.participantsCount)||0,re={eventName:ie,eventType:z,tieFormat:Z,category:x,eventId:W,gender:F};Array.isArray(N)&&N.forEach(Be=>Bw({event:re,timeItem:Be}));let{eventAttributes:me}=p;if(typeof me!="object"&&(me={}),Object.assign(re,me),C?.length&&Array.isArray(C)){let Be=C.filter(Ep);Be?.length&&Object.assign(re,{extensions:Be})}let he=[];if(r?.participantsCount===0||p.uniqueParticipants||ne||!u||F||x){let Be=(le||0)+w+ne,ut=Be,it={[Xn]:0,[ps]:0},xe,Ze;z===hr&&({teamSize:xe,genders:Ze}=v8({alternatesCount:w,tieFormatName:R,tieFormat:Z,drawSize:q}),Object.keys(Ze).forEach(ft=>{let _t=Ns(ft);_t&&Sp(ft)&&Ze[_t]&&(it[_t]=q*Ze[_t])}),ut=xe*((q||0)+ne));let st=r?.idPrefix?`D-${f}-${r?.idPrefix}`:void 0,qe=qD({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:ut,consideredDate:u?.startDate,sex:F||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:H,gendersCount:it,idPrefix:st,category:x}).participants;if(re.category&&(re.category.categoryName=J),u){let ft=Ku({participants:qe,tournamentRecord:u});if(ft.error)return ft}if(qe.forEach(({participantId:ft})=>he.push(ft)),K=qe,z===hr){let ft=Ze[Xn]?qe.filter(({participantType:pt,person:Mt})=>pt===Bi&&Mt?.sex===Xn).map(Fi):[],_t=Ze[ps]?qe.filter(({participantType:pt,person:Mt})=>pt===Bi&&Mv(Mt?.sex)).map(Fi):[],ve=qe.filter(({participantType:pt})=>pt===Bi).map(Fi).filter(pt=>!ft.includes(pt)&&!_t.includes(pt)),$e=[...g.teamNames??[],...O_({count:Be}).names],De=xe-(Ze[Xn]+Ze[ps]),je=0,Oe=0,nt=0,Fe=yt(0,Be).map(pt=>{let Mt=_t.slice(je,je+Ze[ps]),Wi=ft.slice(Oe,Oe+Ze[Xn]),Qt=ve.slice(nt,nt+De);je+=Ze[ps],Oe+=Ze[Xn],nt+=De;let tr=M!==!1?[...Mt,...Wi,...Qt]:[];return{participantName:$e[pt]||`Team ${pt+1}`,participantOtherName:`TM${pt+1}`,participantRole:vs,individualParticipantIds:tr,participantType:hr,participantId:lr()}}),wt=Ku({participants:Fe,tournamentRecord:u});if(!wt.success)return wt;K=Fe}}let Ie=Be=>{let{participantType:ut}=Be;return On(Up)(z)&&ut===Bi||On(jc)(z)&&ut===Ei?!0:z===hr&&ut===hr},Le=Be=>!p.gender||Be.person?.sex===p.gender?!0:Be.individualParticipantIds?.some(ut=>{let it=K.find(xe=>xe.participantId===ut);return it&&Le(it)}),ot=K.filter(Ie).filter(Le).filter(({participantId:Be})=>!i.includes(Be)),at=ot.slice(0,le).map(Be=>Be.participantId);if(d&&at?.length){let Be=op({autoEntryPositions:s,entryStage:j,tournamentRecord:u,participantIds:at,event:re});if(Be.error)return Be}let dt=ne?ot.slice(le,le+ne).map(Be=>Be.participantId):0;if(d&&dt?.length){let Be=0,ut=1,it=(Ze,st)=>Ze.stageSequence-st.stageSequence,xe=(Ze,st)=>Ze.roundTarget-st.roundTarget;for(let Ze of S.sort(xe)){ut=Ze.roundTarget||ut;let st=1,qe;for(let ft of Ze.structureProfiles.sort(it)){let _t=(ft.drawSize||h4(ft.participantsCount))-(qe||0),ve=dt.slice(Be,Be+_t),$e=op({entryStage:zt,entryStageSequence:st,autoEntryPositions:s,tournamentRecord:u,participantIds:ve,roundTarget:ut,event:re});if($e.error)return $e;qe=ft.qualifyingPositions,Be+=_t,st+=1}ut+=1}}let It=v&&u?.participants?.filter(({participantId:Be})=>!at.includes(Be)).filter(Ie).filter(Le).slice(0,w||q-le||I).map(Be=>Be.participantId);if(d&&It?.length){let Be=op({participantIds:It,autoEntryPositions:!1,entryStatus:Ou,tournamentRecord:u,event:re});if(Be.error)return Be.error}let ze=J||ie;u&&A&&A<=at.length&&yt(1,A+1).forEach((Be,ut)=>{let it={scaleName:ze,scaleDate:h,scaleType:W5,scaleValue:Be,eventType:z},xe=at[ut];A0({tournamentRecord:u,participantId:xe,scaleItem:it})});let Ct=F0({...Et(p,!1,!0),tournamentRecord:u,seedingScaleName:ze,matchUpFormat:y,eventId:W,isMock:d,event:re});if(Ct.error)return Ct;if(!Ct.drawDefinition)return{error:lc};let{drawDefinition:ke}=Ct,mt=ke.drawId;if(Array.isArray(E)&&E.filter(Ep).forEach(Be=>nr({element:ke,extension:Be})),D){if(B0({drawDefinition:ke,event:re,suppressNotifications:!0}),p.withPlayoffs){let ut=ke.structures?.[0].structureId,it=JL({...p.withPlayoffs,tournamentRecord:u,drawDefinition:ke,structureId:ut,idPrefix:O,isMock:d,event:re});if(it?.error)return it}let Be=p.automated===!1;if(d&&!Be){let ut=it=>{let xe=x_({completeAllMatchUps:it.completeAllMatchUps,completionGoal:it.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:re});if(xe.error)return xe;let Ze=xe.completedCount;if(b===Vh){let st=ke.structures?.find(_t=>_t.stage===Dt);if(!st)return{error:en};kD({structureId:st.structureId,tournamentRecord:u,drawDefinition:ke});let qe=P?P-(Ze??0):void 0,ft=x_({completionGoal:P?qe:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:ke,matchUpFormat:y,event:re});if(ft.error)return ft}};if(P&&ut({completionGoal:P}),p.outcomes){let{matchUps:it}=po({inContext:!0,drawDefinition:ke,event:re});for(let xe of p.outcomes){let{matchUpStatus:Ze=Tn,matchUpStatusCodes:st,stageSequence:qe=1,matchUpIndex:ft=0,structureOrder:_t,matchUpFormat:ve,drawPositions:$e,roundPosition:De,stage:je=Dt,roundNumber:Oe,winningSide:nt,scoreString:Fe}=xe,wt=it?.reduce((Qt,tr)=>{let{structureId:Vi,matchUpId:$i}=tr;return Qt[Vi]?Qt[Vi].push($i):Qt[Vi]=[$i],Qt},{})??[],pt=Object.assign({},...Object.keys(wt).map((Qt,tr)=>({[Qt]:tr+1}))),Mt=it?.filter(Qt=>(!je||Qt.stage===je)&&(!qe||Qt.stageSequence===qe)&&(!Oe||Qt.roundNumber===Oe)&&(!De||Qt.roundPosition===De)&&(!_t||pt[Qt.structureId]===_t)&&(!$e||En($e,Qt.drawPositions).length===2))?.[ft],Wi=RSe({matchUpStatusCodes:st,tournamentRecord:u,drawDefinition:ke,targetMatchUp:Mt,matchUpFormat:ve,matchUpStatus:Ze,scoreString:Fe,winningSide:nt});if(Wi?.error)return Wi}}a&&ut({completeAllMatchUps:a})}V&&VD({tournamentRecord:u,event:re})}else{let Be=NF({drawEntries:ke.entries,drawName:k||b,qualifyingPositions:T,drawId:mt,event:re,stage:j});if(Be.error)return Be}return{...oe,event:Ft(re),uniqueParticipantIds:he,targetParticipants:K,drawDefinition:ke,eventId:W,drawId:mt}}var kSe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),W6e=kSe;function L_(t){return parseInt(t)}function yX({startTime:t="",endTime:e=""}={}){if(!t||!e||!Nv.test(t)||!Nv.test(e))return!1;let[i,r]=t.split(":").map(L_),[n,a]=e.split(":").map(L_);return n<i?!1:!(i===n&&a<r)}function Y6e(t,e){let[i,r]=t.startTime.split(":").map(L_),[n,a]=e.startTime.split(":").map(L_);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function OSe({dateAvailability:t}){if(!t)return{error:Zfe};if(!Array.isArray(t))return{error:AN};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:AN};let{date:n,startTime:a,endTime:s,bookings:o=[]}=r;if(!a||!s)return{error:AN};if(n&&!Tp.test(n))return{error:Ba,dateAvailability:{date:n},info:e};if(!Nv.test(a))return{error:yu,dateAvailability:{startTime:a},info:i};if(!Nv.test(s))return{error:yu,dateAvailability:{endTime:s},info:i};if(a===s)return{error:yu,dateAvailability:{startTime:a,endTime:s},info:"startTime and endTime are equivalent"};if(!yX({startTime:a,endTime:s}))return{error:yu,dateAvailability:{startTime:a,endTime:s},info:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:o_};for(let l of o){if(typeof l!="object")return{error:o_};let{startTime:c,endTime:u}=l;if(!Nv.test(c))return{error:yu,booking:{startTime:c},info:i};if(!Nv.test(u))return{error:yu,booking:{endTime:u},info:i};if(c===u)return{error:yu,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!yX({startTime:c,endTime:u}))return{error:yu,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function zF({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=rf({tournamentRecord:t,venueId:i});if(!a)return{error:yw};a.courts||(a.courts=[]);let s={...kSe(),venueId:i,courtId:r};if(s.courtId||(s.courtId=lr()),a.courts.some(o=>o.courtId===s.courtId))return{error:hme};{let o=(n?.dateAvailability||[]).map(u=>({...u,date:Ui(u.date),startTime:zr(u.startTime),endTime:zr(u.endTime),bookings:u.bookings?.map(({startTime:d,endTime:p,bookingType:h})=>({startTime:zr(d),endTime:zr(p),bookingType:h}))})),l=Object.keys(s);for(let u of l)if(n?.[u])if(u==="dateAvailability"){let d=OSe({dateAvailability:o});if(!d.valid&&d.error)return d;s.dateAvailability=o}else s[u]=n[u];let c=s;return a.courts.push(c),e||Ii({payload:{venue:a,tournamentId:t.tournamentId},topic:qy,key:a.venueId}),{...oe,court:Et(s),venueId:i}}}function I8(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:qg};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let s of Object.values(r)){let{venue:o}=rf({tournamentRecord:s,venueId:i});if(o){let l=K6e({...t,tournamentRecord:s});for(let c of l?.courts??[])n.push(c?.courtId);if(l.error)return l;a=!0}}return a?{...oe,courtIds:n}:{error:yw}}function K6e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:s,startTime:o,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:qg};let h=rf({tournamentRecord:r,venueId:d});if(h.error)return h;let{venue:f}=h;if(!vn(s)||!n)return{error:pme};s=s??n.length;let m=yt(0,s).map(g=>{let v=a?.[g],y=v?p.map(b=>({date:Au(b),startTime:o,endTime:c,...v})):e;return v&&o&&c&&y.push({startTime:o,endTime:c}),{courtName:n[g]||i&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=l?.pop()||u&&`${u}-${v+1}`;return zF({disableNotice:!0,tournamentRecord:r,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==s?ue({info:"not all courts could be generated",result:{error:Se}}):(f&&Ii({payload:{venue:f,tournamentId:r.tournamentId},topic:qy,key:f.venueId}),{...oe,courts:Et(m)})}function w8({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,s=[];for(let[o,l]of i.entries()){let{venueAbbreviation:c,venueId:u=r?.pop()??lr(),dateAvailability:d,startTime:p="07:00",endTime:h="19:00",courtTimings:f,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${o+1}`,venueAbbreviation:c,venueId:u},w=u0({tournamentRecord:t,venue:I});if(w.error){if(e)continue;return w}s.push(u);let T=YT(n,a),S=!Array.isArray(d)&&[{startTime:p,endTime:h}].concat(T.map(D=>({date:Au(D),startTime:p,endTime:h})));if(m||g){let D=I8({dateAvailability:d||S,tournamentRecord:t,courtTimings:f,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:h,venueId:u,dates:T});if(D.error)return D}}return s}function Z6e(t){let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:s,uuids:o}=t,l=0;for(let u of i){let d=[],{tieFormatName:p=h_,teamProfiles:h=[],teamsCount:f=0,category:m,idPrefix:g,gender:v}=u,y=u.leagueName??u.eventName??`League ${l+1}`,b=u.leagueId??u.eventId??o?.pop()??lr();r.push(b);let I=qi(u.tieFormat)&&u.tieFormat||Qf({event:{eventId:b,category:m,gender:v},namedFormat:p,isMock:t.isMock})||void 0;if(!I)return{error:vD};let w=Math.max(f,h.length),T=yt(0,w),{genders:S,teamSize:D}=v8({tieFormat:I,drawSize:w}),C={[ps]:0,[ww]:0,[Pf]:0,[Xn]:0,ANY:0};Object.keys(S).forEach(P=>C[P]+=S[P]);for(let P of T){let R=h?.[P]?.teamName??`Team ${P+1}`,M=h?.[P]?.teamId||o?.pop()||lr(),A=u.startDate??t.startDate,N=qD({...u?.participantsProfile,participantsCount:D,consideredDate:A,gendersCount:C,category:m,uuids:o}).participants,k=N.map(q=>q.participantId),x=hr,O=M??k_({participantType:x,idPrefix:g,index:P,uuids:o});d.push({participantId:O,entryStatus:ol,entryStage:Dt});let V=h?.[P]?.venueIds??[],F={participantId:O,participantRole:vs,participantName:R,individualParticipantIds:k,participantType:x,homeVenueIds:V};V.forEach(q=>!n.includes(q)&&n.push(q)),s.push(...k),s.push(O);let j=Ku({participants:[F,...N],tournamentRecord:e});if(j.error)return j}let E={eventName:y,entries:d,eventType:hr,tieFormat:I,category:m,eventId:b,gender:v};if(e.events||(e.events=[]),e.events.push(E),d.length){let P=(vn(u.roundsCount)&&u.roundsCount)??u.roundsCount===$Ge?(w-1)*2:w-1,R=F0({automated:u.automated,tournamentRecord:e,drawType:kl,roundsCount:P,drawSize:w,event:E});if(R.error)return R;let{drawDefinition:M}=R;if(M){let A=M?.drawId;B0({drawDefinition:M,event:E,suppressNotifications:!0}),a.push(A)}}l++}let c=n.map(u=>({venueId:u}));w8({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:o})}var X6e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function xSe(t){let{startDate:e,endDate:i}=t??{},{tournamentName:r=yl(X6e),ratingsParameters:n=Da,tournamentExtensions:a,policyDefinitions:s,schedulingProfile:o,venueProfiles:l,uuids:c}=t??{},u=t?.isMock===!1?void 0:!0;if(e&&!tl(e)||i&&!tl(i))return{error:Ba};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:Se};if(!e){let y=new Date;e=Au(i??y),i=Au(y.setDate(y.getDate()+7))}if(!i){let y=new Date(e);i=Au(y.setDate(y.getDate()+7))}let d=GF({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:u}),p=l?.length?w8({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a?.length&&Array.isArray(a)){let y=a.filter(b=>Ep({extension:b}));y?.length&&Object.assign(d,{extensions:y,isMock:u})}if(typeof s=="object")for(let y of Object.keys(s))yy({policyDefinitions:{[y]:s[y]},tournamentRecord:d});if(!t?.leagueProfiles?.length||t.eventProfiles?.length||t.drawProfiles?.length||t.participantsProfile){let y=ESe({tournamentRecord:d,...t});if(!y.success)return y}let h=[],f=[],m=[];if(t.leagueProfiles){let y=Z6e({allUniqueParticipantIds:h,tournamentRecord:d,...t,eventIds:f,venueIds:p,drawIds:m});if(y?.error)return y}if(t.drawProfiles){let y=J6e({allUniqueParticipantIds:h,ratingsParameters:n,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}if(t.eventProfiles){let y=Q6e({allUniqueParticipantIds:h,ratingsParameters:n,tournamentRecord:d,...t,eventIds:f,drawIds:m});if(y?.error)return y}let{scheduledRounds:g=void 0,schedulerResult:v={}}=o?e7e({...t,tournamentRecord:d}):{};return H4(),Ft({...oe,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:f,venueIds:p,drawIds:m})}function J6e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,s=0;for(let o of i){let l=HF({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:o,drawIndex:s,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(o?.addEvent!==!1){if(l=BD({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),n.push(u)}p?.length&&r.push(...p),s+=1}}function Q6e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let s of e){let o=_Se({...t,eventIndex:a,eventProfile:s});if(o.error)return o;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=o;c&&n.push(...c),r.push(l),u?.length&&i.push(...u),a+=1}}function e7e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,s=q6e({schedulingProfile:e,tournamentRecord:i});if(s.error)return s;let o=s.scheduledRounds;if(r){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:jF({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:n}),scheduledRounds:o}}return{scheduledRounds:o}}var LSe={};_i(LSe,{anonymizeTournamentRecord:()=>FSe,modifyTournamentRecord:()=>BSe});function FSe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:et};let s=Array.isArray(t)?RZ.concat(...t):RZ,o=O=>Array.isArray(t)?O?.extensions?.filter(V=>s.includes(V.name)):O?.extensions,l={};i.extensions=o(i);let c=a||lr();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${Au(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let O of i.participants||[]){O.extensions=o(O),O.onlineResources=[];let V=lr();l[O.participantId]=V,O.participantId=V}for(let O of i.participants||[])Array.isArray(O.individualParticipantIds)&&(O.individualParticipantIds=O.individualParticipantIds.map(V=>l[V]));let u=0;for(let O of i.venues||[]){O.venueAbbreviation=`V${u}`,O.extensions=o(O),O.venueName=`Venue #${u}`,O.onlineResources=[],O.addresses=[];let V=lr();l[O.venueId]=V,O.isMock=!0,u+=1;let F=0;for(let j of O.courts||[])j.courtName=`V${u}C${F}`,j.extensions=o(j),j.onlineResources=[],j.isMock=!0,F+=1}let d=1;for(let O of i.events||[]){O.extensions=o(O),O.onlineResources=[],O.isMock=!0;let V=lr();l[O.eventId]=V,O.eventId=V;let F=O.category?.categoryName||O.category?.ageCategoryCode||O.category?.ratingType||O.gender;if(O.eventName=`Event ${d} ${F}`,Array.isArray(O.entries))for(let q of O.entries)q.participantId=l[q.participantId];for(let q of O.drawDefinitions||[]){q.extensions=o(q);let W=lr();if(l[q.drawId]=W,q.drawId=W,q.isMock=!0,Array.isArray(q.entries))for(let H of q.entries)H.participantId=l[H.participantId];let z=H=>{H.extensions=o(H);let Z=lr();l[H.structureId]=Z,H.structureId=Z;for(let J of H.positionAssignments||[])J.participantId&&(J.participantId=l[J.participantId]);for(let J of H.seedAssignments||[])J.participantId&&(J.participantId=l[J.participantId]);for(let J of H.matchUps||[]){J.isMock=!0;for(let ie of J.sides||[])ie.lineUp&&(ie.lineUp=ie.lineUp.map(({participantId:K,collectionAssignments:ne})=>({participantId:l[K],collectionAssignments:ne})))}};for(let H of q.structures||[])if(z(H),Array.isArray(H.structures))for(let Z of H.structures)z(Z);for(let H of q.links||[])H.source.structureId=l[H.source.structureId],H.target.structureId=l[H.target.structureId]}let{extension:j}=Ci({name:qu,element:O});Array.isArray(j?.value?.flights)&&j?.value.flights?.forEach(q=>{if(q.drawId=l[q.drawId],Array.isArray(q.drawEntries))for(let W of q.drawEntries)W.participantId=l[W.participantId]}),d+=1}let p=i.startDate||Au(new Date),h=(i.participants||[]).filter(({participantType:O})=>O===Bi),f=h.reduce((O,V)=>{let F=V.person?.sex,j=Ns(F);return j&&Sp(F)?O[j]+=1:O[Pf]+=1,O},{[Xn]:0,[ps]:0,[Pf]:0}),m=Object.assign({},...Object.keys(f).map(O=>({[O]:DSe({category:{ageCategoryCode:"O18"},count:f[O],personExtensions:[],consideredDate:p,sex:O})?.persons||[]}))),g={[Xn]:0,[ps]:0,[Pf]:0},v=h.length,y=h.reduce((O,V)=>{let F=V.person?.addresses?.[0]||{},{city:j,state:q,postalCode:W}=F;return O.cities.includes(j)||O.cities.push(j),O.states.includes(q)||O.states.push(q),O.postalCodes.includes(W)||O.postalCodes.push(W),O},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,w=y.states.length,{cities:T}=wSe({count:I||v,participantsCount:v}),{states:S}=SSe({count:w||v,participantsCount:v}),{postalCodes:D}=TSe({count:b||v,participantsCount:v}),C={cities:T,states:S,postalCodes:D};h.forEach((O,V)=>{let F=O?.person,j=F?.sex||Pf,q=Ui(F?.birthDate)?.split("-")[0],W=g[j],z=m[j][W];if(g[j]+=1,q){let[,H,Z]=z?.birthDate?.split("-")||[],J=[q,H,Z].join("-");z.birthDate=J}if(F?.addresses){let H=USe({...C,participantIndex:V,nationalityCode:z.nationalityCode});z.addresses=[H]}z.personId=n?.[V]||lr(),e?(z.standardFamilyName=z.lastName,z.standardGivenName=z.firstName,O.participantName=`${z.standardGivenName} ${z.standardFamilyName}`):(z.standardFamilyName=F?.standardFamilyName,z.standardGivenName=F?.standardGivenName),delete z.firstName,delete z.lastName,z.extensions=o(F),O.person=z,l[F?.personId]=z.personId}),(i.participants||[]).filter(({participantType:O})=>O===Ei).forEach(O=>{let{individualParticipantIds:V}=O;O.participantName=t7e({individualParticipantIds:V,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:O})=>O===hr),P=E.length,R=O_({count:P}).names;E.forEach((O,V)=>{O.participantName=R[V]});let M=(i.participants||[]).filter(({participantType:O})=>O===vc),A=M.length,N=O_({count:A,nameRoot:"Group"}).names;M.forEach((O,V)=>{O.participantName=N[V]});let{extension:k}=Ci({element:i,name:UI});Array.isArray(k?.value)&&k?.value.forEach(O=>{O.tournamentId=l[O.tournamentId],O.structureId=l[O.structureId],O.eventId=l[O.eventId],O.drawId=l[O.drawId]});let{extension:x}=Ci({element:i,name:ED});return Array.isArray(x?.value)&&x?.value.forEach(O=>{O.personId=l[O.personId]}),{...oe}}function t7e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r?.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function BSe(t){let{ratingsParameters:e=Da,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,schedulingProfile:l,tournamentRecord:c,autoSchedule:u,eventProfiles:d,periodLength:p,venueProfiles:h,drawProfiles:f,isMock:m,uuids:g}=t;if(!c)return{error:et};let v=[],y=[],b=[];d?.forEach(C=>{let E=c.events?.find((P,R)=>C.eventIndex!==void 0&&R===C.eventIndex||C.eventName&&P.eventName===C.eventName||C.eventId&&P.eventId===C.eventId);E?.gender&&(C.gender=E.gender)});let I=c.participants?.length||void 0;I&&i?.idPrefix&&(i.idPrefix=`${i.idPrefix}-${I}`);let w=ESe({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:d,drawProfiles:f,uuids:g});if(!w.success)return w;if(d){let C=c.events?.length||0;for(let E of d){let{ratingsParameters:P}=E,R=c.events?.find((M,A)=>E.eventIndex!==void 0&&A===E.eventIndex||E.eventName&&M.eventName===E.eventName||E.eventId&&M.eventId===E.eventId);if(R){let{gender:M,category:A,eventType:N}=R,{drawProfiles:k,publish:x}=E,O=On(Up)(N)&&Bi||On(jc)(N)&&Ei||N;if(k){let{stageParticipantsCount:V,uniqueParticipantsCount:F,uniqueParticipantStages:j}=PSe({drawProfiles:k,category:A,gender:M}),{uniqueDrawParticipants:q=[],uniqueParticipantIds:W=[]}=j?NSe({event:{eventType:N,category:A,gender:M},uniqueParticipantsCount:F,participantsProfile:i,ratingsParameters:P,tournamentRecord:c,eventProfile:E,uuids:g}):{};v.push(...W);let{stageParticipants:z}=CSe({targetParticipants:c.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:V,eventParticipantType:O}),H=ASe({uniqueDrawParticipants:q,autoEntryPositions:a,stageParticipants:z,tournamentRecord:c,drawProfiles:k,category:A,gender:M,event:R});if(H.error||(H=MSe({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:o,tournamentRecord:c,drawProfiles:k,isMock:m,event:R}),H.error))return H;b.push(...H.drawIds)}x&&VD({tournamentRecord:c,event:R})}else{let M=_Se({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:o,ratingsParameters:P,tournamentRecord:c,eventProfile:E,eventIndex:C,uuids:g});if(M.error)return M;let{eventId:A,drawIds:N,uniqueParticipantIds:k}=M;N&&b.push(...N),y.push(A),k?.length&&v.push(...k),C+=1}}}if(f){let C=(c.events||[]).map(E=>E.drawDefinitions?.map(()=>1)||[]).flat().reduce((E,P)=>E+P,0);for(let E of f){let P=HF({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:o,ratingsParameters:e,tournamentRecord:c,drawProfile:E,drawIndex:C,uuids:g});if(P.error)return P;let{drawId:R,eventId:M,event:A,uniqueParticipantIds:N}=P;if(P=BD({tournamentRecord:c,event:A,internalUse:!0}),P.error)return P;R&&b.push(R),y.push(M),N?.length&&v.push(...N),C+=1}}let T=h?.length?w8({tournamentRecord:c,venueProfiles:h}):[],S,D={};if(l?.length){let C={[c.tournamentId]:c},E=LD({tournamentRecords:C,schedulingProfile:l});if(E.error)return E;if(u){let{tournamentId:P}=c,R={[P]:c};D=jF({tournamentRecords:R,periodLength:p})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:S,schedulerResult:D,...oe,eventIds:y,venueIds:T,drawIds:b}}var $Se={};_i($Se,{addDynamicRatings:()=>W6,addIndividualParticipantIds:()=>OF,addParticipant:()=>Rp,addParticipants:()=>Ku,addPenalty:()=>oTe,addPersonRequests:()=>qSe,addPersons:()=>lTe,createGroupParticipant:()=>JSe,createTeamsFromParticipantAttributes:()=>g8,deleteParticipants:()=>Ow,filterParticipants:()=>g0,findParticipant:()=>XSe,getCompetitionParticipants:()=>l7,getPairedParticipant:()=>Yu,getParticipantEventDetails:()=>c7,getParticipantMembership:()=>u7,getParticipantScaleItem:()=>oU,getParticipantSchedules:()=>d7,getParticipantSignInStatus:()=>p7,getParticipantTimeItem:()=>F5,getParticipants:()=>un,getScaleValues:()=>UD,mergeParticipants:()=>sTe,modifyIndividualParticipantIds:()=>WSe,modifyParticipant:()=>xF,modifyParticipantName:()=>QSe,modifyParticipantOtherName:()=>KSe,modifyParticipantsSignInStatus:()=>YSe,modifyPenalty:()=>nTe,modifyPersonRequests:()=>HSe,mutate:()=>VSe,participantScaleItem:()=>yh,query:()=>HIe,regenerateParticipantNames:()=>ZSe,removeIndividualParticipantIds:()=>n6,removeParticipantIdsFromAllTeams:()=>jL,removePenalty:()=>iTe,removePersonRequests:()=>zSe,removeRatings:()=>tTe,scaledTeamAssignment:()=>eTe,setParticipantScaleItem:()=>A0,setParticipantScaleItems:()=>jbe,validateLineUp:()=>HL});var VSe={};_i(VSe,{addDynamicRatings:()=>W6,addIndividualParticipantIds:()=>OF,addParticipant:()=>Rp,addParticipants:()=>Ku,addPenalty:()=>oTe,addPersonRequests:()=>qSe,addPersons:()=>lTe,createGroupParticipant:()=>JSe,createTeamsFromParticipantAttributes:()=>g8,deleteParticipants:()=>Ow,findParticipant:()=>XSe,mergeParticipants:()=>sTe,modifyIndividualParticipantIds:()=>WSe,modifyParticipant:()=>xF,modifyParticipantName:()=>QSe,modifyParticipantOtherName:()=>KSe,modifyParticipantsSignInStatus:()=>YSe,modifyPenalty:()=>nTe,modifyPersonRequests:()=>HSe,regenerateParticipantNames:()=>ZSe,removeIndividualParticipantIds:()=>n6,removeParticipantIdsFromAllTeams:()=>jL,removePenalty:()=>iTe,removePersonRequests:()=>zSe,removeRatings:()=>tTe,scaledTeamAssignment:()=>eTe,setParticipantScaleItem:()=>A0,setParticipantScaleItems:()=>jbe});function jSe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function GSe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:s,endTime:o}=n;return n.requestType===G0&&(a=Ui(a),s=zr(s),o=zr(o),a&&s&&o)?{date:a,startTime:s,endTime:o,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=jSe(),t[e].push(n);return{mergeCount:r.length}}function S8(t){let{tournamentRecords:e,personRequests:i}=t,r=Gt(t,[{[Fs]:!0}]);if(r.error)return r;if(!i)return{...oe};let n=Object.values(e);for(let a of n){let s=a.participants??[],o=[];for(let l of Object.keys(i))if(bg({tournamentParticipants:s,personId:l})){let c=i[l];c.length&&o.push({personId:l,requests:c})}Object.keys(o).length&&nr({element:a,extension:{value:o,name:ED}})}return{...oe}}function HSe(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=Gt(t,[{[Fs]:!0},{requests:!0,[Bo]:Rs,[uc]:Se}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:s}=tb({tournamentRecords:e}),o=c=>{s&&(s[c]=s[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&s?.[r])o(r);else if(s)for(let c of Object.keys(s))o(c);let l=i.filter(c=>!c.requestId);return l.length&&GSe({personRequests:s,personId:r,requests:l}),S8({tournamentRecords:e,personRequests:s})}function zSe(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,s=Gt(t,[{[Fs]:!0}]);if(s.error)return s;let{personRequests:o}=tb({tournamentRecords:e}),l=u=>{o&&(o[u]=o[u].filter(d=>(!i||d.requestType!==i)&&(!r||d.requestId!==r)&&(!a||d.date!==a)),o?.[u]?.length||delete o[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&o?.[n])l(n);else if(o)for(let u of Object.keys(o))l(u)}return c||!o||!Object.keys(o).length?uo({name:ED,tournamentRecords:e,discover:!0}):S8({tournamentRecords:e,personRequests:o})}function qSe(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=Gt(t,[{[Fs]:!0,[WGe]:!0},{requests:!0,[Bo]:Rs,[uc]:Se}]);if(n.error)return n;let{personRequests:a}=tb({tournamentRecords:e}),{mergeCount:s}=GSe({personRequests:a,personId:i,requests:r});return s&&a?S8({tournamentRecords:e,personRequests:a}):{error:Se}}function WSe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ue({result:{error:et},stack:r});if(!e||!t)return ue({result:{error:Yt},stack:r});let n=i.participants||[],a=n.find(h=>h.participantId===e);if(!a)return ue({result:{error:_n},stack:r});if(![hr,vc].includes(a.participantType))return ue({result:{error:Pd},context:{participantType:a.participantType},stack:r});let s=t.filter(h=>n.find(f=>f.participantId===h)?.participantType!==Bi);if(s.length)return ue({result:{error:wl,invalidParticipantIds:s},stack:r});let o=a.individualParticipantIds||[],l=t.filter(h=>!o.includes(h)),c=o.filter(h=>!t.includes(h)),u=OF({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ue({result:u,stack:r});let d=n6({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ue({result:d,stack:r});let{topics:p}=Jc();if(p.includes(Ss)){let h=n.find(({participantId:f})=>f===e);Ii({topic:Ss,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function YSe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:et};if(!Array.isArray(e))return{error:Yt};if(![EC,Sve].includes(i))return{error:Se,signInState:i};let r=t.participants||[];if(!r.length)return{error:LR};let n=r.map(Fi),a=e.filter(c=>!n.includes(c));if(a.length)return{error:Se,context:{invalidParticipantIds:a}};let s=[],o=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=k6({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:JR,itemValue:i,createdAt:o}});if(d.error)return d;s.push(c)}}let{topics:l}=Jc();return s.length&&l.includes(Ss)&&Ii({topic:Ss,payload:{tournamentId:t.tournamentId,participants:s}}),{...oe}}function KSe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:et};if(!e)return{error:oa};let{participant:r}=Zg({tournamentRecord:t,participantId:e});if(!r)return{error:_n};r.participantOtherName=i;let{topics:n}=Jc();return n.includes(Ss)&&Ii({topic:Ss,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...oe}}function bX({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),r=m=>/^[a-z]*$/.test(i(m)),n=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),s=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),o=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=Ij(e?.standardGivenName??""),h=Ij(e?.standardFamilyName??"");if(!t)return`${p}${d}${h}`;l(t)&&!o(t)&&!s(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),h=h.toLowerCase()):n(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:s(t)&&(o(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function i7e({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,s=r&&i[r];if(r!==Ro&&s){let{personFormat:o,doublesJoiner:l}=s;r===Bi&&(e.participantName=bX({person:a,personFormat:o})),r===Ei&&(e.participantName=n?.map(c=>{let u=t[c]?.person;return bX({person:u,personFormat:o})}).filter(Boolean).join(l??"/"))}}function ZSe({tournamentRecord:t,formats:e}){if(!t)return{error:et};if(!qi(e))return{error:Yt};let i=t.participants??[],r=bfe(i,"participantId");for(let n of i)i7e({participant:n,participantMap:r,formats:e});return{...oe}}function XSe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,s=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Yt,stack:"publicFindParticipant"};let o,l;for(let c of Object.values(s)){l=c.tournamentId;let u=c.participants||[];if(o=bg({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),o)break}return{participant:o,tournamentId:l,...oe}}function JSe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=uye,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:et};if(!a)return{error:Yt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Se};let s=(un({participantFilters:{participantTypes:[Bi]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!s.includes(u))return{error:Pd,participantId:u};let o=Ft({participantId:n||lr(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:vc,participantRole:i}),l=Rp({participant:o,tournamentRecord:r});if(l.error)return l;let{topics:c}=Jc();return c.includes(Ig)&&Ii({topic:Ig,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...oe,participant:Et(o)}}function QSe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:et};if(!i)return{error:oa};if(!e)return{error:Yt,info:"Missing participantName"};let{participant:r}=Zg({tournamentRecord:t,participantId:i});if(!r)return{error:_n};r.participantName=e;let{topics:n}=Jc();return n.includes(Ss)&&Ii({topic:Ss,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...oe}}function eTe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:s,scaleAttributes:o,teamNameBase:l,teamsCount:c,eventId:u,event:d}){if(!s)return{error:et};if(!Array.isArray(a)&&!mi(c)&&!u||!mi(r)||n&&!Array.isArray(n)||o&&(typeof o!="object"||!Object.keys(o).length))return{error:Se};if(!o&&!n.length||!n&&!(e&&o))return{error:Yt,info:"Missing scaling details"};if(u&&!a){if(d?.eventType!==_l)return{error:xh};a=d?.entries?.filter(({entryStatus:v})=>v===ol).map(Fi)}if(!a?.length&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Yt};let p=e??n.map(({participantId:v})=>v);i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let h=a?.slice(r).concat(...a.slice(0,r))??[],f=[];for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(h.includes(y)){if(b!==Ro)return{error:Pd,participant:v};f.push(v)}}if(c&&f.length<c){let v=c-(f?.length||0),y=l??"Team",b=yt(0,v).map(S=>({participantName:`${y} ${S+1}`,participantType:Ro,participantRole:vs})),{participants:I=[]}=Ku({participants:b,returnParticipants:!0,tournamentRecord:s}),w=I.map(Fi),T=s.participants?.filter(({participantId:S})=>w.includes(S))??[];f.push(...T)}if(!f.length)return{error:F4};if(t)for(let v of f)v.individualParticipantIds=[];else{let v=f.map(y=>y).flat();e?.length?p=p.filter(y=>!v.includes(y)):n=n?.filter(({participantId:y})=>!v.includes(y))}if(!e?.length&&!n?.length)return{error:eL,info:"Nothing to be done"};if(!n.length){for(let v of s.participants??[]){let{participantId:y,participantType:b}=v;if(!p.includes(y))continue;if(b!==Bi)return{error:Pd,participant:v};let I=yh({scaleAttributes:o,participant:v})?.scaleItem,w=o?.accessor?I?.scaleValue?.[o?.accessor]:I?.scaleValue,T={participantId:y,scaleValue:w};n.push(T)}if(!n.length)return{error:_n}}n.sort((v,y)=>o?.sortOrder?(y?.scaleValue||0)-(v?.scaleValue||0):(v?.scaleValue||1/0)-(y?.scaleValue||1/0));for(let v of n)if(!v.participantId)return{error:Se,scaledParticipant:v};let m=0;for(;m<n.length;){for(let v of f){if(m+1>n.length)break;let y=n[m];v.individualParticipantIds.push(y.participantId),m++}f.reverse()}let g=f.map(Fi);for(let v of s.events??[]){if(v.eventType!==_l)continue;let y=(v.entries??[]).filter(b=>g.includes(b.participantId));for(let b of y){let I=b.participantId,w=f.find(S=>S.participantId===I)?.individualParticipantIds;v.entries=(v.entries??[]).filter(S=>!w.includes(S.participantId)),(v.drawDefinitions??[]).forEach(S=>{S.entries=(S.entries??[]).filter(D=>!w.includes(D.participantId))});let{flightProfile:T}=Rn({event:v});(T?.flights||[]).forEach(S=>{S.drawEntries=(S.drawEntries||[]).filter(D=>!w.includes(D.participantId))})}}return{...oe,scaledParticipants:n}}function tTe(t){let e=Gt(t,[{[pa]:!0,[c5]:!0},{ratingType:!1,[hs]:s=>Da[s]}]);if(e.error)return e;let i=`${t.ratingType}.${h5}`,r=t.asDynamic?i:t.ratingType,n=[hy,rg,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let s of a)s.timeItems&&(s.timeItems=s.timeItems.filter(o=>o.itemType!==n));return{...oe}}function iTe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=r7e({...t,tournamentRecord:i});if(r.error&&r.error!==WT)return r}return{...oe}}function r7e({tournamentRecord:t,penaltyId:e}){if(!t)return{error:et};if(!e)return{error:_4};let i=t?.participants??[],r=[],n=!1,a;return i.forEach(s=>{let o=!1;s.penalties=(s.penalties??[]).filter(l=>(l.penaltyId===e&&(o=!0,n||(a=l,n=!0)),o&&r.push(s),l.penaltyId!==e))}),a&&Ii({topic:Ss,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...oe,penalty:a}:{error:WT}}var n7e=({penaltyId:t=lr()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),rTe=n7e;function nTe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=a7e({...t,tournamentRecord:i});if(r.error&&r.error!==WT||r.success)return r}return{error:WT}}function a7e({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:et};if(!e)return{error:Se,modifications:e};if(!i)return{error:_4};let r=t?.participants??[],n=Object.keys(rTe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:tL};let s,o=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),s||(s=u)),u)),c&&o.push(l)}),s&&Ii({topic:Ss,payload:{tournamentId:t.tournamentId,participants:o}}),s?{...oe,penalty:s}:{error:WT}}function aTe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:yi(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=yi(t[n].map(s=>JSON.stringify(s)).concat(e[n].map(s=>JSON.stringify(s)))).map(s=>JSON.parse(s));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=aTe(t[n],e[n],i):r[n]=e[n];return r},{})}function sTe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:et};e.participants||(e.participants=[]);let r=t.filter(xl(jh)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=aTe(c,n[c.participantId],i);return a.push(u),u}return c});let s=e.participants.map(xl(jh))||[],o=t.filter(({participantId:c})=>!s.includes(c)),{topics:l}=Jc();return o.length&&(e.participants=e.participants.concat(...o),l.includes(Ig)&&Ii({topic:Ig,payload:{participants:o}})),a.length&&l.includes(Ss)&&Ii({topic:Ss,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:o.length,...oe}}function oTe(t){let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let a of Object.values(r)){let s=(un({tournamentRecord:a}).participants??[])?.map(Fi).filter(o=>i.includes(o));s.length&&(n=s7e({...t,penaltyId:t.penaltyId??n,tournamentRecord:a,participantIds:s}).penaltyId)}return n?{...oe,penaltyId:n}:{error:_n}}function s7e({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:s,matchUpId:o,issuedAt:l,notes:c}){if(!e)return{error:et};if(!i)return{error:oa};if(!n)return{error:dme};let u=(e?.participants??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:_n};let d=new Date().toISOString(),p=Object.assign(rTe({penaltyId:s}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:o,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>nr({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),Ii({topic:Ss,payload:{tournamentId:e.tournamentId,participants:u}}),{...oe,penaltyId:p.penaltyId}}function lTe({participantRole:t=vs,tournamentRecord:e,persons:i}){if(!e)return{error:et};if(!Array.isArray(i))return{error:Se};if(!Object.keys(r6).includes(t))return{error:eme};let r=(e.participants||[]).map(({person:f})=>f?.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=lr()),n.push(f.personId),f)),s=(f,m)=>Object.assign({},...Object.keys(f).filter(g=>!m.includes(g)).map(g=>({[g]:f[g]}))),o=a.map(f=>Ft({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:Bi,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Ku({participants:o,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=un({participantFilters:{participantTypes:[Bi]},tournamentRecord:e})?.participants??[];if(t===vs&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:m})=>{Array.isArray(m)&&m.forEach(g=>{let v=[f,g.personId].map(y=>bg({tournamentParticipants:p,personId:y})).filter(Boolean);if(v.length===2){let y=v.map(Fi);d.push(Ft({extensions:g.participantExtensions,timeItems:g.timeItems,participantRole:vs,individualParticipantIds:y,participantType:Ei}))}})}),d.length){if(u=Ku({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...oe,addedCount:h,newPersonIds:n}}var cTe={};_i(cTe,{bulkUpdatePublishedEventIds:()=>b7,getAllEventData:()=>I7,getCourtInfo:()=>LL,getDrawData:()=>gF,getEventData:()=>vF,getEventPublishStatus:()=>ru,getPublishState:()=>kw,getTournamentPublishStatus:()=>m0,getVenueData:()=>aU,mutate:()=>uTe,publishEvent:()=>VD,publishEventSeeding:()=>dTe,publishOrderOfPlay:()=>gTe,publishParticipants:()=>mTe,query:()=>ZIe,setEventDisplay:()=>MF,unPublishEvent:()=>vTe,unPublishEventSeeding:()=>pTe,unPublishOrderOfPlay:()=>fTe,unPublishParticipants:()=>hTe});var uTe={};_i(uTe,{publishEvent:()=>VD,publishEventSeeding:()=>dTe,publishOrderOfPlay:()=>gTe,publishParticipants:()=>mTe,setEventDisplay:()=>MF,unPublishEvent:()=>vTe,unPublishEventSeeding:()=>pTe,unPublishOrderOfPlay:()=>fTe,unPublishParticipants:()=>hTe});function dTe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=yc,drawIds:a=[],event:s}){if(!r)return{error:et};if(!s)return{error:Lr};let o=ru({event:s,status:n}),l=(o?.seeding?.seedingScaleNames||i)&&{...o?.seeding?.seedingScaleNames,...i},c=(o?.seeding?.stageSeedingScaleNames||e)&&{...o?.seeding?.stageSeedingScaleNames,...e},u=Ft({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return $D({statusObject:{seeding:u},removePriorValues:t,status:n,event:s}),Ii({topic:vve,payload:{tournamentId:r.tournamentId,eventId:s.eventId,drawIds:a}}),{...oe}}function pTe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=yc,drawIds:n,stages:a,event:s}){if(!i)return{error:et};if(!s)return{error:Lr};let o=ru({event:s});if(o){let l=o.seeding;if(Array.isArray(a)&&l.stageSeedingScaleNames)for(let c of a)l.stageSeedingScaleNames[c]&&delete l.stageSeedingScaleNames[c];Array.isArray(e)&&l?.seedingScaleNames&&(l.seedingScaleNames=l.seedingScaleNames.filter(c=>!e.includes(c))),Array.isArray(n)&&l?.drawIds&&(l.drawIds=l.drawIds.filter(c=>!n.includes(c))),(!Object.values(l.stageSeedingScaleNames??{}).length&&!l.seedingScaleNames?.length&&!l.drawIds?.length||!a&&!e&&!n?.length)&&(delete l.stageSeedingScaleNames,delete l.seedingScaleNames,delete l.drawIds,l.published=!1),$D({statusObject:{seeding:l},removePriorValues:t,status:r,event:s})}return Ii({topic:k5,payload:{tournamentId:i.tournamentId,eventId:s.eventId}}),{...oe}}function hTe(t){let e=Qc(t);if(!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=o7e({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function o7e({removePriorValues:t=!0,tournamentRecord:e,status:i=yc}){if(!e)return{error:et};let r=`${Xg}.${Jg}`,{timeItem:n}=eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Vp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({payload:{tournamentId:e.tournamentId},topic:SHe}),{...oe}}function fTe(t){let e=Qc(t);if(!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=l7e({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function l7e({removePriorValues:t=!0,tournamentRecord:e,status:i=yc}){if(!e)return{error:et};let r=`${Xg}.${Jg}`,{timeItem:n}=eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Vp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({topic:O5,payload:{tournamentId:e.tournamentId}}),{...oe}}function mTe(t){let e=Qc(t);if(!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=c7e({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function c7e({removePriorValues:t,tournamentRecord:e,status:i=yc}){if(!e)return{error:et};let r=`${Xg}.${Jg}`,{timeItem:n}=eu({element:e,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i].participants={published:!0},Vp({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Ii({payload:{tournamentId:e.tournamentId},topic:bve}),{...oe}}function gTe(t){let e=Qc(t);if(!Object.keys(e).length)return{error:hn};for(let i of Object.values(e)){let r=u7e({tournamentRecord:i,...t});if(r.error)return r}return{...oe}}function u7e({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=yc,eventIds:n=[]}){if(!i)return{error:et};let a=`${Xg}.${Jg}`,{timeItem:s}=eu({element:i,itemType:a}),o=s?.itemValue||{[r]:{}};return o[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Vp({timeItem:{itemValue:o,itemType:a},element:i,removePriorValues:e}),Ii({topic:yve,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...oe}}function vTe({removePriorValues:t=!0,tournamentRecord:e,status:i=yc,event:r}){if(!e)return{error:et};if(!r)return{error:Lr};let n=`${Xg}.${Jg}`,{timeItem:a}=QR({itemType:n,event:r}),s=a?.itemValue||{[i]:{}};return delete s[i].structureIds,delete s[i].drawDetails,delete s[i].drawIds,Bw({event:r,timeItem:{itemValue:s,itemType:n},removePriorValues:t}),$D({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),Ii({topic:_5,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...oe}}var yTe={};_i(yTe,{getEntryStatusReports:()=>p7e,getParticipantStats:()=>d7e,getStructureReports:()=>f7e,getVenuesReport:()=>g7e});function d7e({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:s,matchUps:o}){if(!n)return{error:et};if(o&&!Array.isArray(o))return{error:al};if(o=o??Wa({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!o?.length)return{error:wm};let l=[];e&&l.push(e),r&&l.push(r);let c=l.length?{participantIds:l}:{participantTypes:[Ro]},u=un({participantFilters:c,tournamentRecord:n}).participants??[];if(!u.every(({participantType:S})=>S===Ro))return{error:wl};l.length||l.push(...u.map(Fi));let d=new Map,p=new Map,h=new Map,f=new Map,m=(S,D="")=>p.get(S)||p.set(S,{participantName:D,participantId:S,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(S);for(let S of u){let{participantId:D,individualParticipantIds:C}=S;f.set(D,C??[]),m(D,S.participantName)}if(r&&!f.get(r))return ue({result:{error:_n},context:{teamParticipantId:r}});if(e&&!f.get(e))return ue({result:{error:_n},context:{opponentParticipantId:e}});let g=[],v=S=>{let D=[[],[]];for(let E of S){let P=E.participant;if(P?.participantName){d.set(P.participantId,{participantName:P.participantName,ratings:P.ratings});let R=p.get(P.participantId);R&&(R.participantName=P.participantName)}}let C=({side:E,individualParticipantIds:P})=>E.participantId&&(!P?.length||P.includes(E.participantId))&&[E.participantId]||E.participant?.individualParticipantIds?.length&&(!P?.length||En(P,E.participant?.individualParticipantIds).length===E.participant?.individualParticipantIds?.length)&&E.participant.individualParticipantIds;if(f.size){let E=(P,R)=>{for(let M of S){if(!M.participant)continue;let A=C({individualParticipantIds:R,side:M});if(A?.length){let N=M.sideNumber;if(!N)continue;let k=[P];i&&k.push(...A),D[N-1]=k;let x=p.get(P);for(let O of A.filter(Boolean))x&&!x.competitorIds.includes(O)&&x.competitorIds.push(O)}}};if(r)(!e||S.every(P=>P.participant&&(C({individualParticipantIds:f.get(r),side:P})||C({individualParticipantIds:f.get(e),side:P}))))&&E(r,f.get(r));else for(let[P,R]of f)E(P,R)}else if(i)for(let E of S){if(!E.participant)continue;let P=C({individualParticipantIds:[],side:E}),R=E.sideNumber;R&&(D[R-1]=P)}return D};for(let S of o){if(!qi(S))return{error:al};let{matchUpStatus:D,matchUpFormat:C,matchUpType:E,winningSide:P,score:R,sides:M}=S;if(!M||!R||E===oc||D==="BYE")continue;let A=v(M);if(!A.filter(Boolean).length)continue;let N=t&&P&&l0({matchUp:S})?.competitiveness;g.push(S);let k=P6({matchUpStatus:D,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:R}),x=nbe({matchUpStatus:D,matchUpFormat:C,tallyPolicy:s,winningSide:P,score:R}),{pointsTally:O,tiebreaksTally:V}=abe({matchUpFormat:C,score:R});A.forEach((F,j)=>{for(let q of F){let W=d.get(q)?.participantName,z=m(q,W);if(z){let H=(ne,le)=>le.forEach((re,me)=>z[ne][me]+=re),Z=j?[...V].reverse():V,J=j?[...O].reverse():O,ie=j?[...x].reverse():x,K=j?[...k].reverse():k;if(H("tiebreaks",Z),H("points",J),H("games",ie),H("sets",K),P){let ne=P-1===j?0:1;z.matchUps[ne]+=1}if(N){let ne=N.toLowerCase();z.competitiveness[ne]||(z.competitiveness[ne]=[0,0]),z.competitiveness[ne][j]+=1}if(D){let ne=D.toLowerCase();z.matchUpStatuses[ne]||(z.matchUpStatuses[ne]=0),z.matchUpStatuses[ne]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,w=(S,D)=>(S??0)+(D??0);for(let[S,D]of p.entries()){for(let C of y){let E=D[C].reduce(w);if(E){let P=D[C][0]/E,R=`${C}Ratio`,M=parseFloat(P.toFixed(2));D[R]=M,h.set(S,!0),I.has(R)||I.set(R,[]),I.get(R)?.push(M)}}for(let C of b){let E=D.competitiveness?.[C]?.reduce(w);if(E){let P=D.competitiveness[C][0]/E,R=`${C}Ratio`,M=parseFloat(P.toFixed(2));D[R]=M}}}if(!r){let S=(D,C)=>C-D;for(let D of p.values())for(let C of y){let E=`${C}Ratio`;if(typeof D[E]=="number"){let P=I.get(E)?.sort(S).indexOf(D[E]);if(typeof P=="number"&&P>=0){let R=`${C}Rank`;D[R]=P+1}}}}let T={relevantMatchUps:g,...oe};return r?(T.teamStats=p.get(r),e&&(T.opponentStats=p.get(e))):T.participatingTeamsCount=h.size,T.allParticipantStats=[...p.values()],T}function F_({participant:t,eventType:e}){let i=t?.person?.personId,r=t?.person?.personOtherIds?.[0],n=t?.person?.tennisId,a=t?.ratings?.[e]?.find(({scaleName:c})=>c==="WTN"),s=a?.scaleValue,{wtnRating:o,confidence:l}=s||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:l,wtnRating:o,personId:i,tennisId:n}}function p7e({tournamentRecord:t}){if(!t)return{error:et};let e=t.tournamentId,{participantMap:i}=un({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Wa({matchUpFilters:{matchUpTypes:[Hb,ly]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h?.flatMap(m=>f===ly?m?.participant?.individualParticipantIds:m?.participant?.participantId||m.participantId).filter(Boolean)).filter(Boolean),n=[],a={},s={},o={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:w}=f;a[h]||(a[h]=[]);let{participant:T,events:S}=i?.[h]??{},D=F_({participant:T,eventType:g}),C=S?.[m]?.ranking;b===S6&&n.push(h),a[h].push({participantType:T?.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:b,entryStage:I,...D,ranking:C,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(S=>{let{drawId:D,entries:C}=S;l+=1;let E=({stage:A,stageSequence:N})=>A===Dt&&N===1||A===zt,P=(S.structures??[]).filter(E).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),R=({participantId:A})=>P.includes(A),M=A=>{let{participantId:N,entryStatus:k,entryStage:x}=A;m(k);let O=i?.[N]?.draws?.[D]?.seedAssignments?.[Dt];return{qualifyingSeeding:i?.[N]?.draws?.[D]?.seedAssignments?.[zt],participantId:N,mainSeeding:O,entryStatus:k,entryStage:x,drawId:D}};return C?.filter(R).map(M)}),I=S=>{let D=S.participantId,C=i?.[D].participant.individualParticipantIds?.filter(E=>r.includes(E));return D&&{[D]:{individualParticipantIds:C}}};v===em?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),D=C=>{S[C.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:C})})};b.forEach(D)})():b.forEach(S=>{c({id:S?.participantId,eventType:v,eventId:y,entry:S})});let w=Object.values(f).reduce((S,D)=>S+D.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/w*100}),o[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let T=Object.assign({},...td.flatMap(S=>[{[S+"_count"]:f[S]?.count},{[S+"_pct"]:f[S]?.pct}]));s[y]={tournamentId:e,eventId:y,...T}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Bi&&f===vs),d=u.filter(({participant:h})=>!r.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(o).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(s).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(o).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function h7e({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=f=>{let m=f?.matchUpFormat;m&&(n[m]||(n[m]=0),n[m]+=1)},s=e.filter(f=>i?f.eventId===i:f.drawId===r).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>(g?.participant?.individualParticipants||[g?.participant]).filter(Boolean)).forEach(g=>f[g.participantId]=g),f),{}),o=Object.values(s),l=o.map(f=>F_({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(o.length-l.length)/o.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l?.length?u.totalWTN/l.length:0,p=l?.length?u.totalConfidence/l.length:0,h=Object.values(n).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:n,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function f7e(t){let{tournamentRecord:e,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=t;if(!e)return{error:zT};let a=[],s={},o={},l=[],c=Object.assign({},...(i??[]).map(({name:m,label:g,accessor:v})=>{let y=Ci({element:e,name:m})?.extension?.value,b=v?qb({element:y,accessor:v})?.value:y;return{[g??m]:b}})),u=e?.tournamentId,d=Wa({participantsProfile:{withScaleValues:!0},tournamentRecord:e}).matchUps??[],p=m=>eu({itemType:T5,itemSubTypes:[gh],element:{timeItems:m}})?.timeItem?.itemValue?.scaleBasis,h=({positionManipulations:m})=>{m?.forEach(g=>{let{structureId:v,name:y}=g,b=g.drawPositions??[g.drawPosition];s[v]??=[],s[v].push(`${y}: ${b.join("/")}`)})},f=e?.events?.flatMap(({timeItems:m,drawDefinitions:g=[],extensions:v,eventType:y,eventName:b,eventId:I,category:w})=>{let T=v?.find(A=>A.name===qu)?.value?.flights?.map(A=>({[A.drawId]:A.flightNumber})),S=T&&Object.assign({},...T),D=v?.find(A=>A.name===$v),C=m?.find(A=>A.itemType===$v),E=D?.value?.length??C?.itemValue??0,P=Object.values(S??{}),R=S&&Math.min(...P),M=p(m);return o[I]={seedingBasis:M?JSON.stringify(M):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:E,tournamentId:u,eventId:I},g.filter(A=>!r||!T||S[A.drawId]===R).flatMap(A=>{let{matchUpFormat:N,tieFormat:k,timeItems:x,extensions:O,structures:V,drawName:F,drawType:j,drawId:q}=A,{matchUpFormatCounts:W,matchUpsCount:z,avgConfidence:H,pctNoRating:Z,avgWTN:J}=h7e({eventType:y,matchUps:d,drawId:q}),ie=p(x)??M,K=m7e({extensions:O}),ne=K?.length??0;return h({positionManipulations:K}),o[I].totalPositionManipulations+=ne,o[I].generatedDrawsCount+=1,ne>o[I].maxPositionManipulations&&(o[I].maxPositionManipulations=ne),V?.filter(le=>(le.stageSequence===1||!n)&&[zt,Dt,ws,wn].includes(le.stage)).map(le=>{let re=[Dt,wn].includes(le.stage)?d.find(wt=>wt.structureId===le.structureId&&wt.finishingRound===1&&wt.winningSide):void 0;le.stage===Dt&&a.push({eventName:b,drawName:F,structureId:le.structureId});let me=re?.sides?.find(wt=>wt.sideNumber===re.winningSide)?.participant,he=me?.participantType===Ro&&me.participantId,Ie=me?.participantType===Ei?me.individualParticipants:[],Le=F_({participant:Ie?.[0]??me,eventType:y}),{personId:ot,personOtherId:at,tennisId:dt,confidence:It,wtnRating:ze}=Le||{},Ct=F_({participant:Ie?.[1],eventType:y}),{personId:ke,personOtherId:mt,tennisId:Be,confidence:ut,wtnRating:it}=Ct||{},{ageCategoryCode:xe,categoryName:Ze,subType:st}=w??{},qe=le.matchUpFormat??N,ft=(W[qe]??0)/z*100,{tieFormatName:_t,tieFormatDesc:ve}=N_(k),{tieFormatName:$e,tieFormatDesc:De}=N_(le.tieFormat),je=ve===De,Oe=!je&&$e,nt=le.tieFormat&&!je&&De,Fe=K?.filter(wt=>wt.structureId===le.structureId)?.length??0;return{...c,tournamentId:u,eventId:I,structureId:le.structureId,drawId:q,eventType:y,category:st,categoryName:Ze,ageCategoryCode:xe,flightNumber:S?.[q],drawType:j,stage:le.stage,seedingBasis:ie?JSON.stringify(ie):void 0,winningPersonId:ot,winningPersonOtherId:at,winningPersonTennisId:dt,winningPersonWTNrating:ze,winningPersonWTNconfidence:It,winningPerson2Id:ke,winningPerson2OtherId:mt,winningPerson2TennisId:Be,winningPerson2WTNrating:it,winningPerson2WTNconfidence:ut,winningTeamId:he,positionManipulations:Fe,pctNoRating:Z,matchUpFormat:qe,pctInitialMatchUpFormat:ft,matchUpsCount:z,drawTieFormatName:_t,drawTieFormatDesc:ve,tieFormatName:Oe,tieFormatDesc:nt,avgConfidence:H,avgWTN:J}})})});return a.forEach(({eventName:m,drawName:g,structureId:v})=>{s[v]?.length&&l.push({eventName:m,drawName:g,actions:s[v]})}),{eventStructureReports:Object.values(o),structureReports:f,flightReports:l}}function m7e({extensions:t}){return t?.find(({name:e})=>e===sT)?.value?.slice(1)}function g7e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:Se,dates:n};if(!Array.isArray(r))return{error:Se,venueIds:r};if(!(e&&Object.keys(e).filter(u=>!i||u===i)||[]).length)return{error:hn};if(!n.every(tl))return{error:Ba};let a=Pm({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let s=a?.venues?.filter(({venueId:u})=>!r?.length||r.includes(u)),o=a.courts?.reduce((u,d)=>(d.dateAvailability?.forEach(p=>{let h=p.date;u.includes(h)||u.push(h)}),u),[]).filter(u=>!n.length||n.includes(u)),l={venueIds:s?.map(({venueId:u})=>u)},{matchUps:c}=Cd({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:s?.map(u=>v7e(o,u,c))}}function v7e(t,e,i){let{venueId:r,courts:n,venueName:a}=e,s={};return t.forEach(o=>{let l=0,c=0,u=0;for(let h of n){let f=h.dateAvailability.find(g=>g.date===o),m=(f&&jD({courtDate:f}).timeSlots)?.reduce((g,v)=>{let{startTime:y,endTime:b}=v,I=Ji(b)-Ji(y);return g+I},0);m&&(u+=1),l+=m}let d=i.filter(({schedule:h})=>h.venueId===r&&Lh(o,h.scheduledDate));d.forEach(({schedule:h})=>{let f=zr(h.scheduledTime),m=Qo(f,h.averageMinutes),g=Ji(m)-Ji(f);c+=g});let p=l?(c/l*100).toFixed(2):"100";s[o]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:s}}var bTe={};_i(bTe,{addMatchUpCourtOrder:()=>i8,addMatchUpEndTime:()=>n8,addMatchUpOfficial:()=>nSe,addMatchUpResumeTime:()=>s8,addMatchUpScheduleItems:()=>BF,addMatchUpScheduledDate:()=>LF,addMatchUpScheduledTime:()=>ev,addMatchUpStartTime:()=>r8,addMatchUpStopTime:()=>a8,addSchedulingProfileRound:()=>b8,allocateTeamMatchUpCourts:()=>FF,assignMatchUpCourt:()=>Gw,assignMatchUpVenue:()=>HD,bulkRescheduleMatchUps:()=>PTe,bulkScheduleMatchUps:()=>H0,bulkScheduleTournamentMatchUps:()=>FC,bulkUpdateCourtAssignments:()=>TTe,calculateScheduleTimes:()=>T8,clearMatchUpSchedule:()=>RTe,clearScheduledMatchUps:()=>VF,courtGridRows:()=>SF,findMatchUpFormatTiming:()=>bF,findVenue:()=>rf,generateBookings:()=>$F,generateVirtualCourts:()=>AF,getMatchUpsToSchedule:()=>yF,getPersonRequests:()=>tb,getProfileRounds:()=>wF,getScheduledRoundsDetails:()=>k0,getSchedulingProfile:()=>Cm,getSchedulingProfileIssues:()=>w7,matchUpScheduleChange:()=>CTe,modifyMatchUpFormatTiming:()=>$7,mutate:()=>ITe,proAutoSchedule:()=>STe,proConflicts:()=>DTe,publicFindCourt:()=>K5,query:()=>twe,removeEventMatchUpFormatTiming:()=>RF,removeMatchUpCourtAssignment:()=>wTe,reorderUpcomingMatchUps:()=>ETe,scheduleMatchUps:()=>UTe,scheduleProfileRounds:()=>jF,setMatchUpDailyLimits:()=>MTe,setMatchUpHomeParticipantId:()=>t8,setSchedulingProfile:()=>LD,toggleParticipantCheckInState:()=>kF,validateSchedulingProfile:()=>IF});var ITe={};_i(ITe,{addMatchUpCourtOrder:()=>i8,addMatchUpEndTime:()=>n8,addMatchUpOfficial:()=>nSe,addMatchUpResumeTime:()=>s8,addMatchUpScheduleItems:()=>BF,addMatchUpScheduledDate:()=>LF,addMatchUpScheduledTime:()=>ev,addMatchUpStartTime:()=>r8,addMatchUpStopTime:()=>a8,addSchedulingProfileRound:()=>b8,allocateTeamMatchUpCourts:()=>FF,assignMatchUpCourt:()=>Gw,assignMatchUpVenue:()=>HD,bulkRescheduleMatchUps:()=>PTe,bulkScheduleMatchUps:()=>H0,bulkScheduleTournamentMatchUps:()=>FC,bulkUpdateCourtAssignments:()=>TTe,calculateScheduleTimes:()=>T8,clearMatchUpSchedule:()=>RTe,clearScheduledMatchUps:()=>VF,findMatchUpFormatTiming:()=>bF,generateBookings:()=>$F,generateVirtualCourts:()=>AF,matchUpScheduleChange:()=>CTe,modifyMatchUpFormatTiming:()=>$7,proAutoSchedule:()=>STe,proConflicts:()=>DTe,removeEventMatchUpFormatTiming:()=>RF,removeMatchUpCourtAssignment:()=>wTe,reorderUpcomingMatchUps:()=>ETe,scheduleMatchUps:()=>UTe,scheduleProfileRounds:()=>jF,setMatchUpDailyLimits:()=>MTe,setMatchUpHomeParticipantId:()=>t8,setSchedulingProfile:()=>LD,toggleParticipantCheckInState:()=>kF,validateSchedulingProfile:()=>IF});function T8({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:s,scheduleDate:o,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:hn};s=s??_F({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Pm({dates:[o],ignoreDisabled:!0,tournamentRecords:a}),h=d?.filter(E=>!c||c.includes(E.venueId));l||(l=h?.reduce((E,P)=>{let R=P.dateAvailability?.find(M=>!M.date||Lh(o,M.date))?.startTime??P.startTime;return R&&(!E||Ji(R)<Ji(E))?R:E},void 0)),u||(u=h?.reduce((E,P)=>{let R=P.dateAvailability?.find(M=>!M.date||Lh(o,M.date))?.endTime??P.endTime;return R&&(!E||Ji(R)>Ji(E))?R:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:R}=e0({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:R}}})).flat()),g=L0({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:o,venueIds:c}}),v=g?.dateMatchUps??[],y=g?.completedMatchUps??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},w=b?.map(({eventId:E,schedule:P,matchUpFormat:R})=>{let{event:M,scheduleTiming:A}=m[E],N=M?.eventType,k={...A,defaultTiming:I,matchUpFormat:R},{averageMinutes:x,recoveryMinutes:O}=xL({eventType:N,timingDetails:k}),{courtId:V,venueId:F}=P,j=zr(P.scheduledTime),q=Qo(j,x);return{recoveryMinutes:O,averageMinutes:x,periodLength:s,startTime:j,endTime:q,courtId:V,venueId:F}}),T={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:o,clearScheduleDates:n,periodLength:s,startTime:l,endTime:u,bookings:w,courts:h},{scheduleTimes:S}=K7(T),D=c?.length===1&&c[0]||p?.length===1&&p[0].venueId||void 0,C=b.map(Pa);return{venueId:D,scheduleTimes:S,dateScheduledMatchUpIds:C}}function wTe(t){let e=Gt(t,[{[Fs]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:s,courtId:o,drawId:l}=t,c=r[n];if(!c)return{error:et};let{drawDefinition:u,event:d}=Qg({tournamentRecord:c,drawId:l});if(!u)return{error:At};let p=qr({drawDefinition:u,event:d,matchUpId:s});if(p.error)return p;if(p?.matchUp?.matchUpType===oc){let{itemValue:h}=Xy({timeItems:p.matchUp.timeItems??[],itemType:zh}),f=o&&h.filter(m=>m.courtId!==o);return Ll({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:s,timeItem:{itemType:zh,itemValue:f}})}else return Gw({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:s})}function STe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!iu(r))return{error:Se};if(r.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Qx};let n=L0({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,s=[],o=h=>[(h.sides||[]).map(f=>[f.participantId,f.participant?.individualParticipantIds]),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a?.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(qi(y)&&(y.matchUpId&&(m.push(y.matchUpId),s.push(y)),y.sides)){let b=o(y);g.push(...b)}});let v=Object.values(f).filter(y=>qi(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:h})=>h&&h!=="BYE"&&(t||!la.includes(h))).sort(_w);let c=id({matchUps:r.concat(s),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;r.length&&l.length;){let h=l.shift(),f=[];for(;r.length&&h.availableCourts.length;){let m=r.concat(f).map(D=>D.matchUpId),g=r.shift(),v=g?.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(D=>c[v].matchUpIds.includes(D)),I=v&&d.some(D=>c[v].dependentMatchUpIds.includes(D)),w=h.matchUpIds.some(D=>y.includes(D)),T=o(g),S=h.participantIds.some(D=>T.includes(D));if(g&&!w&&!b&&!S&&!I){let D=h.availableCourts.shift();Object.assign(g.schedule,D.schedule),Object.assign(D,g),u.push(g),h.participantIds.push(...T),h.matchUpIds.push(v)}else g&&f.push(g)}r.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return n=H0({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:u,notScheduled:r}}function TTe(t){let{courtDayDate:e}=t,i=Gt(t,[{courtAssignments:!0,[Bo]:Rs,[uc]:Yt},{[Fs]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,s)=>{let{tournamentId:o}=s;return a[o]||(a[o]=[]),a[o].push(s),a},{}),n;return Object.keys(r).every(a=>{let s=t[Fs][a];if(!s)return n={error:et},!1;let o=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(o).every(l=>{let{drawDefinition:c}=Lo({tournamentRecord:s,drawId:l});return c?(o[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=Gw({tournamentRecord:s,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h?.success;n={error:wme}}),!0):(n={error:At},!1)})}),n||oe}function UTe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:o={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Gt(t,[{[Fs]:!0,[WR]:!0},{[hs]:tl,[uc]:Ba,[HGe]:!0},{[hs]:H=>!H||!isNaN(H),[YGe]:!1,[uc]:Se,[KGe]:!1,[ZGe]:!1}]);if(I.error)return I;let w=t.competitionMatchUps??Cd({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],T=t.matchUpDependencies??id({includeParticipantDependencies:!0,matchUps:w,tournamentRecords:e}).matchUpDependencies;w.forEach(H=>{H.schedule?.scheduledDate&&Lh(f,Ui(H.schedule.scheduledDate))&&cU({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:H})});let S=m.map(H=>w.find(Z=>Z.matchUpId===H)).filter(Boolean),{venueId:D,scheduleTimes:C,dateScheduledMatchUpIds:E}=T8({tournamentRecords:e,remainingScheduleTimes:d,startTime:zr(v),endTime:zr(y),scheduleDate:Ui(f),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},R=[],M={},A={},N={};w.filter(({matchUpId:H})=>E?.includes(H)).forEach(H=>{Bj({matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUp:H,value:1});let Z=H.schedule?.scheduledTime;if(Z){M[H.matchUpId]=Z;let J=a?.[H.matchUpId];LC({recoveryMinutes:J||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:T,scheduleTime:Z,matchUp:H})}});let k=S.filter(H=>{let Z=E?.includes(H.matchUpId),J=["BYE",br,Tn,sl,wa,Fr].includes(H?.matchUpStatus);return!Z&&!H.winningSide&&!J}),{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:V}=k.reduce((H,Z)=>{let{drawId:J,tournamentId:ie,matchUpType:K}=Z,{participantIdsAtLimit:ne,relevantParticipantIds:le}=m8({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,matchUpDailyLimits:c,matchUp:Z});return ne?.length?(H.overLimitMatchUpIds.push(Z.matchUpId),H.participantIdsAtLimit.push(...ne),H):(le.forEach(re=>{j0({individualParticipantProfiles:o,participantId:re});let me=o[re].counters;me[K]?me[K]+=1:me[K]=1,me[xu]?me[xu]+=1:me[xu]=1}),H.matchUpMap[ie]||(H.matchUpMap[ie]={}),H.matchUpMap[ie][J]?H.matchUpMap[ie][J].push(Z):H.matchUpMap[ie][J]=[Z],cU({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:l,matchUp:Z}),H)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});k=k.filter(({matchUpId:H})=>!O.includes(H));let F=0,j=C?.length??0,{personRequests:q}=tb({tournamentRecords:e,requestType:G0});for(;C?.length&&k.length&&F<=j;){F++;let{scheduleTime:H}=C.shift(),Z=k.find(J=>{let{matchUpId:ie}=J,{dependenciesScheduled:K,remainingDependencies:ne}=p8({matchUpScheduleTimes:M,matchUpDependencies:T,allDateMatchUpIds:i,matchUp:J});if(!K)return N[ie]||(N[ie]=[]),N[ie].push({scheduleTime:H,remainingDependencies:ne}),!1;let{enoughTime:le}=f8({individualParticipantProfiles:o,matchUpNotBeforeTimes:l,matchUpDependencies:T,scheduleTime:H,matchUp:J});if(!le)return A[ie]||(A[ie]=[]),A[ie].push({scheduleTime:H}),!1;let{conflicts:re}=h8({potentials:u,averageMatchUpMinutes:r,requestConflicts:P,personRequests:q,scheduleTime:H,scheduleDate:f,matchUp:J});if(re?.length)return!1;let me=a?.[J.matchUpId];return LC({recoveryMinutes:me||n,matchUpPotentialParticipantIds:s,individualParticipantProfiles:o,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:T,scheduleTime:H,matchUp:J}),M[J.matchUpId]=H,!0});k=k.filter(({matchUpId:J})=>J!==Z?.matchUpId),Z||R.push(H)}k.forEach(H=>{Bj({individualParticipantProfiles:o,matchUpPotentialParticipantIds:s,value:-1,matchUp:H})});let W=[];Object.keys(x).forEach(H=>{let Z=e[H];Z&&Object.keys(x[H]).forEach(J=>{let{drawDefinition:ie}=Qg({tournamentRecord:Z,drawId:J});ie&&x[H][J].forEach(({matchUpId:K})=>{let ne=M[K];if(ne){let le=ne.split(":").map(_c).join(":"),re=`${Ui(f)}T${le}`;b?W.push(K):(ev({drawDefinition:ie,matchUpId:K,scheduledTime:re}).success&&W.push(K),D&&HD({tournamentRecords:e,tournamentRecord:Z,drawDefinition:ie,matchUpId:K,venueId:D}))}})})});let z=b5(k);return{...oe,requestConflicts:Object.values(P),remainingScheduleTimes:C?.map(({scheduleTime:H})=>H),individualParticipantProfiles:o,matchUpNotBeforeTimes:l,participantIdsAtLimit:V,skippedScheduleTimes:R,overLimitMatchUpIds:O,scheduledMatchUpIds:W,noTimeMatchUpIds:z,recoveryTimeDeferred:A,dependencyDeferred:N}}function DTe({tournamentRecords:t,matchUps:e}){if(!iu(e))return{error:wm};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Qx};let i=Math.max(...e.map(({schedule:h})=>h?.courtOrder||1).map(h=>ri(h))),r=yt(1,i+1).map(h=>e.filter(f=>ri(f.schedule?.courtOrder)===h)),n={},a={},s={};r.flat().filter(Boolean).sort(_w).forEach(({schedule:h})=>delete h[FN]);let o=yi(e.map(({drawId:h})=>h)),l=id({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:o}).matchUpDependencies,c=r.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:w,potentialParticipants:T}=g,S=I?.courtId;n[v]=f,a[S]=[],m.matchUpIds.push(v),s[v]=g;let D=l[v].matchUpIds;D.length&&m.sourceMatchUpIds.push(...D);let C=w?.map(P=>[P.participant?.individualParticipantIds,P.participantId]).flat().filter(Boolean)??[],E=T?.flat().map(({individualParticipantIds:P,participantId:R})=>[P,R]).flat().filter(Boolean)||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!s[h].schedule[FN]){s[h].schedule[FN]=f,s[h].schedule[Yve]=g,d[n[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=s[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Nl(h.participantIds),b=Object.keys(y).filter(T=>y[T]>1),I=h.matchUpIds.filter(T=>l[T].participantIds.some(S=>b.includes(S)));I.forEach(T=>{v[T]||(v[T]={}),v[T][vv]||(v[T][vv]=I.filter(S=>S!==T))});let w=m&&h.participantIds.filter(T=>m.participantIds.includes(T));w&&w.forEach(T=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(D=>l[D].participantIds.includes(T));S.forEach(D=>{v[D]||(v[D]={}),v[D][yv]||(v[D][yv]=S.filter(C=>C!==D))})}),h.matchUpIds.forEach(T=>{let S=l[T].matchUpIds;for(let C of g){let E=C.matchUpIds.filter(P=>S.includes(P));E?.length&&(E.forEach(P=>p(P,gj,Wm,[T])),p(T,gj,Wm,E))}if(v[T]?.[vv]&&p(T,vv,mj,v[T][vv]),h.sourceMatchUpIds.includes(T)){let C=h.matchUpIds.filter(E=>l[E].matchUpIds.includes(T));p(T,vv,Wm,C),h.matchUpIds.filter(E=>l[E].matchUpIds.includes(T)).forEach(E=>p(E,vv,Wm,[T]))}let D=m?.matchUpIds?.filter(C=>u(T,C)>1);if(D?.length&&(p(T,vj,Wm,D),D.forEach(C=>p(C,vj,Wm,[T]))),v[T]?.[yv]&&p(T,yv,mj,v[T][yv]),m?.targetMatchUpIds?.includes(T)){let C=s[T].schedule.courtId,E=S.filter(P=>m.matchUpIds.includes(P));E.some(P=>s[P].schedule.courtId===C)||(E.forEach(P=>p(P,yv,Wm,[T])),p(T,yv,Wm,E))}})}),{courtIssues:a,rowIssues:d}}function ETe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ue({result:{error:hn},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ue({result:{error:Yt},stack:e});let a=r?.length;if(!a)return{...oe};let s=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(n?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=r[h].schedule.scheduledTime,m=o({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)s++;else return m}),s===a?oe:ue({result:{error:Ime},stack:e});function o({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Qg({tournamentRecord:p,drawId:d});return h?ev({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:lc}}}function PTe(t){let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:fw};if(typeof e!="object")return{error:Se};let n=Qc(t),a=[],s=[];for(let l of Object.values(n)){let c=y7e({tournamentRecord:l,scheduleChange:e,matchUpIds:i,dryRun:r});if(c.error)return c;Array.isArray(c.notRescheduled)&&s.push(...c.notRescheduled);let u=b5(c.notRescheduled),d=[];c.rescheduled?.forEach(p=>{let{matchUpId:h}=p;u.includes(h)&&d.push(h),a.push(p)}),d.length&&(s=c?.notRescheduled?.filter(({matchUpId:p})=>!d.includes(p))||[])}let o=!!(a.length&&!s.length);return{...oe,rescheduled:a,notRescheduled:s,allRescheduled:o}}function y7e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){if(!t)return{error:et};if(!i||!Array.isArray(i))return{error:fw};if(typeof e!="object")return{error:Se};let n=[],a=[],{minutesChange:s,daysChange:o}=e;if(!s&&!o)return{...oe};if(s&&isNaN(s))return{error:Se};if(o&&isNaN(o))return{error:Se};let{matchUps:l}=Wa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:I})=>!la.includes(I),u=l?.filter(I=>x0({schedule:I.schedule})).filter(I=>c({matchUpStatus:I.matchUpStatus}));if(!u?.length)return{...oe};let{tournamentInfo:d}=Vw({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u?.reduce((I,w)=>{let{matchUpId:T,drawId:S}=w;return I[S]?I[S].push(T):I[S]=[T],I},{}),m=1440;for(let I of Object.keys(f)){let w=Qg({tournamentRecord:t,drawId:I});if(w.error)return w;let T=w.drawDefinition,S=f[I].filter(D=>i.includes(D));for(let D of S)if(D&&T){let C=u.find(N=>N.matchUpId===D)?.schedule,{scheduledTime:E,scheduledDate:P}=C,R,M,A;if(!R&&o&&P){let N=Ui(P);A=CE(N,o),R=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(s&&E){let N=Ui(E),k=Ji(zr(E))+s;if(R=k<0||k>m,!R){let x=Qo(E,s),O=N&&A||P===N&&N;M=O?`${O}T${x}`:x}}if(R)a.push(D);else{if(!r){if(M){let N=ev({scheduledTime:M,drawDefinition:T,matchUpId:D});if(N.error)return N}if(A){let N=LF({scheduledDate:A,drawDefinition:T,matchUpId:D});if(N.error)return N}}(M||A)&&n.push(D)}}}let g=Wa({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:I})=>n.includes(I)),y=g.filter(({matchUpId:I})=>a.includes(I)),b=v.length&&!y.length;return{...oe,rescheduled:v,notRescheduled:y,allRescheduled:b}}function CTe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:hn};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:s,courtDayDate:o}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:h}=n||{};if(!c&&!p)return ue({result:{error:Yt},stack:e});let{matchUps:f}=Cd({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f?.find(({matchUpId:I})=>I===c),g=f?.find(({matchUpId:I})=>I===p),v=0;if(s&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I?.success&&v++,I.error)return ue({result:I,stack:e})}else if(a&&s&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:s,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:o});if(I.success&&v++,I.error)return ue({result:I,stack:e,info:"source"});let w=y({tournamentId:h,sourceCourtId:s,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:o});if(w.success&&v++,w.error)return ue({result:w,stack:e,info:"target"})}else return{error:Yt};return v?oe:ue({result:{error:ID},stack:e});function y(I){let{tournamentRecords:w,tournamentId:T,matchUp:S,drawId:D}=I,C=w[T],{drawDefinition:E}=Qg({tournamentRecord:C,drawId:D});return S.matchUpType===kr?b({...I,tournamentRecord:C,drawDefinition:E}):Gw({...I,tournamentRecord:C,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:w,tournamentRecord:T,drawDefinition:S,sourceCourtId:D,courtDayDate:C,matchUpId:E,matchUp:P,courtId:R}){let M=[R].concat(P.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==D));return FF({removePriorValues:I,tournamentRecords:w,tournamentRecord:T,drawDefinition:S,courtDayDate:C,matchUpId:E,courtIds:M})}}function RTe({scheduleAttributes:t=[zh,Ug,Pw,Cw,Rw,pd,sm,vh,xf],tournamentRecord:e,drawDefinition:i,matchUpId:r}){let n="clearMatchUpSchedule",a=i?po({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:Wa({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps?.[0];if(!a)return{error:Ls};let s=(a.timeItems??[]).filter(o=>o?.itemType&&!t.includes(o?.itemType));return a.timeItems=s,Hi({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...oe}}function MTe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:hn};if(typeof r!="object")return{error:Sm};let a=Object.keys(n).filter(s=>!i||i===s);if(i&&!a.includes(i))return{error:Se};for(let s of a){let o=n[s],l=nr({extension:{name:KR,value:{dailyLimits:r}},element:o});if(l.error)return l}return{...oe}}var NTe={};_i(NTe,{addCollectionDefinition:()=>E8,addCollectionGroup:()=>LTe,aggregateTieFormats:()=>BTe,compareTieFormats:()=>om,getTieFormat:()=>mF,modifyCollectionDefinition:()=>U8,modifyTieFormat:()=>FTe,mutate:()=>ATe,orderCollectionDefinitions:()=>OTe,query:()=>YIe,removeCollectionDefinition:()=>D8,removeCollectionGroup:()=>kTe,tieFormatGenderValidityCheck:()=>oL,validateCollectionDefinition:()=>GR});var ATe={};_i(ATe,{addCollectionDefinition:()=>E8,addCollectionGroup:()=>LTe,aggregateTieFormats:()=>BTe,modifyCollectionDefinition:()=>U8,modifyTieFormat:()=>FTe,orderCollectionDefinitions:()=>OTe,removeCollectionDefinition:()=>D8,removeCollectionGroup:()=>kTe});function wy({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:s}){let o="getTieFormat",l;if(e=r?.structureId??e,i=n?.matchUpId??i,(i||e)&&!t)return{error:At};if(a&&s)l=zd(s);else if(i){if(t&&(!n||!r)){let c=qr({drawDefinition:t,matchUpId:i});if(c.error)return c;if(c.matchUp?.matchUpType!==oc)return ue({result:{error:al},stack:o});r||(r=c.structure),n||(n=c.matchUp)}l=tP({item:n,drawDefinition:t,structure:r,event:s})||tP({item:r,drawDefinition:t,structure:r,event:s})||zd(t)||zd(s)}else if(t&&e){if(!r){let c=oi({drawDefinition:t,structureId:e});if(c.error)return c;r=c?.structure}l=tP({item:r,drawDefinition:t,structure:r,event:s})||zd(t)||zd(s)}else l=zd(t)||zd(s);return l?{...oe,structure:r,tieFormat:l,matchUp:n}:ue({result:{error:vD},stack:o})}function B_({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![la].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ed&&!ua(t))}function bB({from:t,to:e}){let i=Object.keys(t),r=En(i,Object.keys(e)).length===i.length,n=i.filter(s=>t[s]!==e[s]).map(s=>({countChange:e[s]-t[s],collectionId:s})),a=i.every(s=>t[s]===e[s]);return{equivalent:r&&a,matchUpsCountChanges:n}}function b7e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:s,event:o,uuids:l}){let c="updateTieFormat",u=e?.tournamentId,d=0,p=0,h=0,f=0,m=n?.collectionDefinitions.reduce((T,S)=>(T[S.collectionId]=(T[S.collectionId]||0)+S.matchUpCount,T),{}),g=({tieFormat:T})=>{let S=T?.collectionDefinitions.reduce((D,C)=>(D[C.collectionId]=(D[C.collectionId]||0)+C.matchUpCount,D),{});return bB({from:S,to:m}).equivalent},v=wy({drawDefinition:i})?.tieFormat,y=wy({event:o})?.tieFormat;if(o&&a){for(let T of o.drawDefinitions??[])b({drawDefinition:T});o.tieFormat=ls(n),f+=1}else if(s){if(!s.tieMatchUps)return ue({result:{error:al},stack:c});let T=Nl(s.tieMatchUps?.map(({collectionId:P})=>P)),S=bB({to:m,from:T}),{changes:D,changesArePossible:C,cannotChangeReaon:E}=IX({matchUp:s,check:S});if(S.equivalent)if(B_({matchUp:s,updateInProgressMatchUps:t}))s.tieFormat=ls(n),f+=1;else return ue({result:{error:R4},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(C)w({tieFormat:n,matchUp:s,changes:D,uuids:l});else return ue({context:{collectionMap:m,matchUpMap:T},result:{error:fh},info:E||"specified changes not possible",stack:c});p+=1,Hi({eventId:o?.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:s})}else if(r){let T=I({inheritedTieFormat:v??y,structure:r})?.modifiedMatchUpsCount;T&&(p+=T,d+=1,f+=1);let S=!r.tieFormat||om({ancestor:r.tieFormat,descendant:n}).different;S&&(r.tieFormat=ls(n),d+=1,f+=1),(T||S)&&i&&Cr({structureIds:[r.structureId],eventId:o?.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=ls(n),f+=1;else return{error:At};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...oe,tieFormat:n};function b({drawDefinition:T}){let S=T.structures||[],D=[];for(let C of S){if(C.tieFormat)continue;let E=I({inheritedTieFormat:y,structure:C})?.modifiedMatchUpsCount;if(E){d+=1,p+=E;let P=C.structureId;D.push(P)}}return Cr({structureIds:D,eventId:o?.eventId,drawDefinition:T}),D.length}function I({inheritedTieFormat:T,structure:S}){let D=0,C=ar({matchUpFilters:{matchUpTypes:[kr]},structure:S})?.matchUps||[];for(let E of C){let P=B_({matchUp:E,updateInProgressMatchUps:t}),R=!1,M=Nl(E.tieMatchUps?.map(({collectionId:N})=>N)),A=bB({from:M,to:m});if(A.equivalent)E.tieFormat&&g(E)&&P&&(E.tieFormat=ls(n),R=!0);else{let{changes:N,changesArePossible:k}=IX({matchUp:E,check:A});if(k&&!E.tieFormat)w({changes:N,matchUp:E,tieFormat:n,uuids:l});else if(T)(!E.tieFormat||om({ancestor:T,descendant:E.tieFormat}).different)&&(E.tieFormat=T,R=!0);else return ue({result:{error:vD},stack:c})}R&&(D+=1,Hi({tournamentId:e?.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:E}))}return{modifiedMatchUpsCount:D}}function w({uuids:T,matchUp:S,tieFormat:D,changes:C}){S.tieFormat=ls(D);let E=[],P=[];return C.forEach(R=>{if(R.countChange>0){let M=Math.max(0,...S.tieMatchUps.filter(k=>k.collectionId===R.collectionId).map(xl("collectionPosition"))),A=D.collectionDefinitions.find(k=>k.collectionId===R.collectionId),N=T0({matchUpsLimit:R.countChange,collectionPositionOffset:M,collectionDefinition:A,matchUp:S,uuids:T});P.push(...Et(N,!1,!0)),h+=P.length,S.tieMatchUps.push(...N)}else{let M=R.toBePlayedTieMatchUpIds.slice(0,Math.abs(R.countChange));console.log("remove",M.length),E.push(...M),S.tieMatchUps=S.tieMatchUps.filter(({matchUpId:A})=>!M.includes(A))}}),P.length&&wg({matchUps:P,drawDefinition:i,tournamentId:u,eventId:a}),E.length&&tf({matchUpIds:E,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:E,matchUpsAdded:P}}}function IX({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let s=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===Pn).map(xl("matchUpId")),o=s.length+a>=0||a>0;return!o&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:s,collectionId:n,countChange:a}),o}),changes:r,cannotChangeReaon:i}}function qF({appliedPolicies:t,drawDefinition:e,auditData:i}){if(!t?.audit?.[QE])return;let{extension:r}=Ci({name:QE,element:e}),n={value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:QE};nr({element:e,extension:n})}function U8({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:s,matchUpCount:o,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let w="modifyCollectionDefinition";if(s&&!Al({matchUpFormat:s}))return ue({result:{error:Se},context:{matchUpFormat:s},stack:w});if(r&&typeof r!="string")return ue({result:{error:Se},context:{collectionName:r},stack:w});if(f&&!Object.values(W4).includes(f))return ue({result:{error:Se},context:{gender:f},stack:w});if(p&&typeof p!="object")return ue({result:{error:Se},context:{category:p},stack:w});let T={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(T).filter(Boolean).length&&!i&&!r&&!s&&!o&&!c)return ue({result:{error:Yt},stack:w});if(Object.values(T).filter(Boolean).length>1)return ue({info:"Only one value assignment allowed per collectionDefinition",result:{error:Se},stack:w});let S=wy({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return ue({result:S,stack:w});let{matchUp:D,structure:C,tieFormat:E}=S,P=ls(E),R=E?.collectionDefinitions.find(W=>W.collectionId===l),M=P?.collectionDefinitions.find(W=>W.collectionId===l);if(!R)return ue({info:"source collectionDefinition",result:{error:za},context:{collectionId:l},stack:w});let A=v??y??b??I;if(g?.length){let W=wfe({matchUpCount:o??R?.matchUpCount??0,collectionValueProfiles:g});if(W.errors)return ue({result:{error:Se},info:W.errors,stack:w})}else if(A&&!mi(A))return ue({result:{error:Se},info:"value is not an integer",context:{value:A},stack:w});let N=(W,z)=>En(Object.keys(W),Object.keys(z)).length===Object.keys(W).length&&En(Object.values(W),Object.values(z)).length===Object.values(W).length,k=g&&(!R.collectionValueProfiles||!N(R.collectionValueProfiles,g)),x=mi(v)&&R.collectionValue!==v||mi(y)&&R.matchUpValue!==y||mi(b)&&R.scoreValue!==b||mi(I)&&R.setValue!==I||k,O=[];if(x&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,T),O.push({collectionId:l,...Ft(T)})),(mi(b)||mi(I))&&M.collectionGroupNumber){let W=M.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(z=>{let{collectionGroupNumber:H,...Z}=z;return H===W?Z:z}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:z})=>z!==W),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:V,valueGoal:F}=jw(P),j=Ft({aggregateValue:V,valueGoal:F});if((j.aggregateValue!==E?.winCriteria.aggregateValue||j.valueGoal!==E?.winCriteria.valueGoal)&&(P.winCriteria=j,O.push({collectionId:l,winCriteria:j})),mi(i)&&R.collectionOrder!==i&&(M.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),r&&R.collectionName!==r&&(M.collectionName=r,O.push({collectionId:l,collectionName:r})),s&&R.matchUpFormat!==s&&(M.matchUpFormat=s,O.push({collectionId:l,matchUpFormat:s})),mi(o)&&R.matchUpCount!==o&&(M.matchUpCount=o,O.push({collectionId:l,matchUpCount:o})),c&&R.matchUpType!==c)return ue({result:{error:iL},context:{matchUpType:c},stack:w});p&&R.category!==p&&(M.category=p,O.push({collectionId:l,category:p})),f&&R.gender!==f&&(M.gender=f,O.push({collectionId:l,gender:f}));let q=Ft(P);if(S=Oo({tieFormat:q}),S.error)return ue({result:S,stack:w});if(!O.length)return ue({result:{...oe,modifications:O}});if(E?.tieFormatName!==n?(q.tieFormatName=n,O.push({tieFormatName:n})):O.length&&(delete q.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),S=b7e({tieFormat:q,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:D,event:m}),!S.error){let{appliedPolicies:W}=er({tournamentRecord:e}),z=Ft({collectionDefinition:M,drawId:a?.drawId,action:w,structureId:u,matchUpId:d,eventId:h});qF({appliedPolicies:W,drawDefinition:a,auditData:z})}return ue({result:{...S,modifications:O},stack:w})}function I7e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){let s=[];return n&&a?s=[a]:i&&r?s=ar({matchUpFilters:{matchUpTypes:[kr]},structure:r})?.matchUps??[]:e&&(s=po({matchUpFilters:{matchUpTypes:[kr]},drawDefinition:e})?.matchUps??[]),{targetMatchUps:s.filter(o=>!o.winningSide&&o.matchUpStatus!==Tn&&(t||o.matchUpStatus!==ed&&!ua(o)))}}function w7e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let s of r){let o=!!s.tieFormat;o&&(s.tieFormat=ls(n));let l;if(t){let c=er({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=Em({matchUpId:s.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}o&&!l&&Hi({tournamentId:e?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:s,drawDefinition:i})}return{...oe}}function _Te({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:s,structure:o,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=jw(l);l.winCriteria=Ft({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:m}=I7e({updateInProgressMatchUps:t,drawDefinition:a,structureId:s,structure:o,matchUpId:c,matchUp:u});w7e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=Ft(l),v=Oo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(o)o.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:At};return Cr({drawDefinition:a,eventId:p?.eventId}),{...oe}}function kTe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:s,matchUp:o,eventId:l,event:c}){if(!e)return{error:Yt};if(isNaN(e))return{error:Se};let u="removeCollectionGroup",d=o?void 0:wy({drawDefinition:r,structureId:a,matchUpId:s,eventId:l,event:c});if(d?.error)return ue({result:d,stack:u});let p=d?.structure;o=o??d?.matchUp;let h=d?.tieFormat,f=h?.winCriteria.valueGoal,m=h?.winCriteria.aggregateValue,g=ls(h);if(d=Oo({tieFormat:g}),d.error)return ue({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=_Te({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:s,matchUp:o,eventId:l,event:c}),!d.error){let{appliedPolicies:y}=er({tournamentRecord:i}),b=Ft({drawId:r?.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:s,eventId:l});qF({appliedPolicies:y,drawDefinition:r,auditData:b})}return ue({result:{...d,modifiedCollectionIds:v},stack:u})}function dU({tieFormat:t,orderMap:e}){let i=ls(t);return i.collectionDefinitions?.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions?.sort((r,n)=>HT(r.collectionOrder)-HT(n.collectionOrder)),i}function OTe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:s,event:o}){if(typeof n!="object"||!Object.values(n).every(u=>mi(u)))return ue({result:{error:Se},context:{orderMap:n}});let l=i?oi({drawDefinition:e,structureId:i}):void 0;if(l?.error)return l;let c=l?.structure;if(a&&o?.tieFormat)wX({tournamentRecord:t,event:o,orderMap:n});else if(r){let u=e&&qr({drawDefinition:e,matchUpId:r});if(u?.error)return u;if(s=u.matchUp,!s)return{error:ko};let d=mF({tournamentRecord:t,matchUpId:r,structure:c,drawDefinition:e,event:o})?.tieFormat;s.tieFormat=dU({tieFormat:d,orderMap:n}),Hi({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:e,matchUp:s})}else if(i)if(c?.tieFormat)c.tieFormat=dU({tieFormat:c.tieFormat,orderMap:n}),xTe({eventId:o?.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),Cr({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)$j({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else if(o?.tieFormat)wX({structureIds:[i],tournamentRecord:t,orderMap:n,event:o});else return{error:za};else if(e?.tieFormat)$j({tournamentRecord:t,drawDefinition:e,orderMap:n,event:o});else return{error:za};return{...oe}}function wX({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=dU({tieFormat:r.tieFormat,orderMap:i});e?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])$j({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function $j({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??n?.tieFormat,s=dU({tieFormat:a,orderMap:r});i?.length||(e.tieFormat=s);let o=[];for(let l of e.structures??[])i?.length&&!i.includes(l.structureId)||((l.tieFormat||i?.includes(l.structureId))&&(l.tieFormat=dU({tieFormat:l.tieFormat??e.tieFormat??n?.tieFormat,orderMap:r})),xTe({eventId:n?.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),o.push(l.structureId));Cr({drawDefinition:e,structureIds:o})}function xTe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){let a=ar({matchUpFilters:{matchUpTypes:[kr]},structure:i})?.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=dU({tieFormat:s.tieFormat,orderMap:r}),Hi({tournamentId:t?.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function D8({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:s,matchUpId:o,eventId:l,matchUp:c,event:u}){let d="removeCollectionDefinition",p=c?void 0:wy({drawDefinition:r,structureId:s,matchUpId:o,eventId:l,event:u});if(p?.error)return ue({result:p,stack:d});let h=p?.structure;c=c??p?.matchUp;let f=p?.tieFormat,m=ls(f);if(p=Oo({tieFormat:m}),p.error)return ue({result:p,stack:d});let g=m?.collectionDefinitions?.find(P=>P.collectionId===a);if(!g)return ue({result:{error:za,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(P=>P.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(P=>{let{collectionGroupNumber:R,...M}=P;return M}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:P})=>P!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=jw(m);m.winCriteria=Ft({aggregateValue:v,valueGoal:y});let b=f?.winCriteria.valueGoal,I=f?.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(n?m.tieFormatName=n:delete m.tieFormatName);let w=[];o&&c?w=[c]:s&&h?w=ar({matchUpFilters:{matchUpTypes:[kr]},structure:h})?.matchUps??[]:r?w=po({matchUpFilters:{matchUpTypes:[kr]},drawDefinition:r})?.matchUps??[]:u&&(w=nf({matchUpFilters:{matchUpTypes:[kr]}})?.matchUps??[]);let T=(w||[]).filter(P=>{let R=P.tieMatchUps?.filter(A=>A.collectionId===a)?.some(ua),M=e&&P.tieFormat?om({descendant:P.tieFormat,ancestor:m})?.different:!1;return t&&!R||!P.winningSide&&P.matchUpStatus!==Tn&&(t||P.matchUpStatus!==ed&&!ua(P)&&!M)});if(!T.length)return{error:ID};let{appliedPolicies:S}=er({tournamentRecord:i});if(o&&c&&t){let P=c.tieMatchUps?.filter(R=>R.collectionId===a);for(let R of P??[]){let M=zD({matchUpId:R.matchUpId,tieMatchUpId:c?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(M.error||(M=qr({drawDefinition:r,matchUpId:o}),M.error))return M;c=M?.matchUp}}let D=[];for(let P of T){for(let R of P?.sides??[])R.lineUp=(R.lineUp??[]).map(M=>({participantId:M.participantId,collectionAssignments:(M?.collectionAssignments??[]).filter(A=>A.collectionId!==a)}));if(P.tieMatchUps=(P.tieMatchUps??[]).filter(R=>{let M=R.collectionId===a;return M&&D.push(R.matchUpId),!M}),P.tieFormat&&(P.tieFormat=ls(m)),t){let R=Em({matchUpId:P.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:r,event:u});if(R.error)return R}Hi({tournamentId:i?.tournamentId,eventId:u?.eventId,drawDefinition:r,context:d,matchUp:P})}D.length&&tf({tournamentId:i?.tournamentId,matchUpIds:D,eventId:u?.eventId,drawDefinition:r});let C=Ft(m);if(p=Oo({tieFormat:C}),p.error)return ue({result:p,stack:d});if(l&&u)u.tieFormat=C;else if(o&&c)c.tieFormat=C;else if(h)h.tieFormat=C;else if(r)r.tieFormat=C;else if(!c||!r)return{error:At};Cr({drawDefinition:r,eventId:u?.eventId});let E=Ft({drawId:r?.drawId,action:d,collectionId:a,structureId:s,matchUpId:o,eventId:l});return qF({appliedPolicies:S,drawDefinition:r,auditData:E}),{tieFormat:C,deletedMatchUpIds:D,targetMatchUps:T,...oe}}function LTe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:s,matchUpId:o,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return ue({result:{error:Yt},stack:d});let p=l?void 0:wy({drawDefinition:r,structureId:s,matchUpId:o,eventId:c,event:u});if(p?.error)return ue({result:p,stack:d});let h=p?.structure;l=l||p?.matchUp;let f=p?.tieFormat,m=f?.winCriteria.valueGoal,g=ls(f);if(p=Oo({tieFormat:g}),p.error)return ue({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&n.includes(b))return ue({info:"collectionIds cannot be part of other collectionGroups",result:{error:Se},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>n.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],_Te({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:s,structure:h,tieFormat:g,matchUpId:o,matchUp:l,eventId:c,event:u})}function E8({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:s,drawDefinition:o,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){let g="addCollectionDefinition",v=er({tournamentRecord:r,drawDefinition:o,event:m}).appliedPolicies??{},y=n?.[Va]??v?.[Va];a=a??y?.participants?.enforceCategory;let b=(c??y?.participants?.enforceGender)!==!1,I=!!((i??m?.category)&&a!==!1),w=!!((s??m?.gender)&&b),T=GR({referenceCategory:i??m?.category,collectionDefinition:e,referenceGender:s,checkCategory:I,checkGender:w,event:m});if(T.error)return ue({result:T,stack:g});let S=p?.tieFormat?void 0:wy({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(S?.error)return ue({result:{error:S.error},stack:g});let D=S?.structure;p=p??S?.matchUp;let C=p?.tieFormat??S?.tieFormat,E=ls(C);if(S=Oo({tieFormat:E}),S?.error)return ue({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=lr();else if(E.collectionDefinitions.map(({collectionId:F})=>F).includes(e.collectionId))return ue({context:{collectionId:e.collectionId},result:{error:Ume}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((F,j)=>(F.collectionOrder||0)-(j.collectionOrder||0)).forEach((F,j)=>F.collectionOrder=j+1);let{aggregateValue:P,valueGoal:R}=jw(E);E.winCriteria=Ft({aggregateValue:P,valueGoal:R});let M=C?.winCriteria.valueGoal,A=C?.winCriteria.aggregateValue;(M&&M!==R||P&&!A)&&(l?E.tieFormatName=l:delete E.tieFormatName);let N=[],k=[],x=[],O=Ft(E);if(S=Oo({tieFormat:O}),S?.error)return ue({result:{error:S.error},stack:g});if(h&&m){m.tieFormat=O;for(let F of m.drawDefinitions??[])if(!F.tieFormat)for(let j of F.structures??[]){if(j.tieFormat)continue;let q=IB({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});k.push(...q.newMatchUps),x.push(...q.targetMatchUps),N.push(j.structureId)}NM({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(u&&D){D.tieFormat=O;let F=IB({updateInProgressMatchUps:t,collectionDefinition:e,structure:D,uuids:f});k.push(...F.newMatchUps),x=F.targetMatchUps,NM({modifiedMatchUps:x,eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(d&&p){if(!B_({matchUp:p,updateInProgressMatchUps:t}))return ue({result:{error:R4},stack:g});p.tieFormat=O;let F=T0({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...F),k.push(...F),NM({modifiedMatchUps:[p],eventId:m?.eventId,modifiedStructureIds:N,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else if(o){o.tieFormat=O;for(let F of o.structures??[]){let j=IB({updateInProgressMatchUps:t,collectionDefinition:e,structure:F,uuids:f});N.push(F.structureId),k.push(...j.newMatchUps),x.push(...j.targetMatchUps)}NM({modifiedMatchUps:x,eventId:m?.eventId,tournamentRecord:r,drawDefinition:o,addedMatchUps:k,stack:g})}else return{error:At};let V=Ft({drawId:o?.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});return qF({appliedPolicies:v,drawDefinition:o,auditData:V}),{tieFormat:O,targetMatchUps:x,addedMatchUps:k,...oe}}function IB({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){let n=[],a=(ar({matchUpFilters:{matchUpTypes:[kr]},structure:i})?.matchUps).filter(s=>B_({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let o=T0({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...o),n.push(...o)}return{newMatchUps:n,targetMatchUps:a}}function NM({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:s}){wg({tournamentId:e?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach(o=>{Hi({tournamentId:e?.tournamentId,drawDefinition:r,context:s,matchUp:o,eventId:a})}),Cr({structureIds:t,drawDefinition:r,eventId:a})}function FTe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!Oo({tieFormat:i}).valid)return ue({result:{error:fh},info:"falied validation",stack:d});let p=wy({drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(p.error)return ue({result:p,stack:d});let{matchUp:h,tieFormat:f}=p,m=ls(f),g=om({descendant:i,ancestor:m,considerations:n});if(g.invalid)return ue({context:{invalid:g.invalid},result:{error:fh},stack:d});if(!g?.different)return ue({result:{...oe},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:C})=>C),y=i.collectionDefinitions.map(({collectionId:C})=>C),b=v.filter(C=>!y.includes(C)),I=i.collectionDefinitions.filter(({collectionId:C})=>!v.includes(C)),w=I.map(xl("collectionId")),T=[],S,D=i.tieFormatName;for(let C of i.collectionDefinitions){if(w.includes(C.collectionId))continue;let E=U8({updateInProgressMatchUps:t,...C,tournamentRecord:r,tieFormatName:D,drawDefinition:a,structureId:s,matchUpId:o,eventId:l,event:u});if(E.modifications&&T.push(...E.modifications),E.error)return ue({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let C of I){let E=E8({updateInProgressMatchUps:t,collectionDefinition:C,tournamentRecord:r,drawDefinition:a,tieFormatName:D,structureId:s,matchUpId:o,matchUp:h,eventId:l,uuids:c,event:u});if(E.error)return ue({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let C of b){let E=D8({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:D,collectionId:C,structureId:s,matchUpId:o,eventId:l,matchUp:h,event:u});if(E.error)return ue({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}return f?.tieFormatName!==D?(S.tieFormatName=D,T.push({tieFormatName:D})):(T.length||w.length||b.length)&&(delete S.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((C,E)=>HT(C.collectionOrder)-HT(E.collectionOrder)).map((C,E)=>({...C,collectionOrder:E+1})),{processedTieFormat:ls(S),modifications:T,...oe}}function BTe({tournamentRecord:t}){if(!t)return{error:et};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=c=>{if(!c.tieFormat)return;let u;for(let d of r)om({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);if(u)c.tieFormatId=u,delete c.tieFormat;else{let d=Et(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=lr()),c.tieFormatId=d.tieFormatId,delete c.tieFormat,r.push(d),e+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let c of i.drawDefinitions??[]){n({tieFormat:c.tieFormat});for(let u of c.structures??[])n({tieFormat:u.tieFormat})}let a=(c,u)=>{let d=o.matchUps?.find(p=>p.matchUpId===c);d&&(d.tieFormatId=u,delete d.tieFormat,Hi({tournamentId:t?.tournamentId,eventId:i.eventId,matchUp:d}))},s=c=>{let u=Et(c.tieFormat,void 0,!0);u.tieFormatId||(u.tieFormatId=lr()),r.push(u),e+=1,a(c.matchUpId,u.tieFormatId)},o=nf({matchUpFilters:{matchUpTypes:[oc]},event:i}),l=o.matchUps??[];for(let c of l){let u;for(let d of r)c.tieFormat&&om({descendant:c.tieFormat,ancestor:d}).different||(u=d.tieFormatId);u?a(c.matchUpId,u):s(c)}r.length&&(i.tieFormats=r)}return{...oe,addedCount:e}}var $Te={};_i($Te,{addDrawDefinitionExtension:()=>IL,addEventExtension:()=>Yg,addEventTimeItem:()=>Bw,addExtension:()=>nr,addNotes:()=>KL,addOnlineResource:()=>YTe,addParticipantExtension:()=>Kge,addParticipantTimeItem:()=>k6,addTimeItem:()=>Vp,addTournamentExtension:()=>m5,addTournamentTimeItem:()=>C0,analyzeDraws:()=>R0,analyzeTournament:()=>v7,copyTournamentRecord:()=>jTe,createTournamentRecord:()=>GF,generate:()=>VTe,getAggregateTeamResults:()=>g7,getAllowedDrawTypes:()=>dF,getAllowedMatchUpFormats:()=>h7,getAppliedPolicies:()=>er,getCompetitionDateRange:()=>hF,getCompetitionPenalties:()=>f7,getPolicyDefinitions:()=>Um,getTournamentInfo:()=>Vw,getTournamentPenalties:()=>pF,getTournamentPersons:()=>m7,getTournamentPoints:()=>fF,getTournamentStructures:()=>m6,getTournamentTimeItem:()=>AL,hydrateTournamentRecord:()=>HTe,mutate:()=>GTe,query:()=>zIe,removeDrawDefinitionExtension:()=>Zge,removeEventExtension:()=>wL,removeExtension:()=>uo,removeNotes:()=>M6,removeOnlineResource:()=>WTe,removeParticipantExtension:()=>Xge,removeTournamentExtension:()=>g5,setTournamentCategories:()=>XTe,setTournamentDates:()=>WF,setTournamentEndDate:()=>QTe,setTournamentName:()=>KTe,setTournamentNotes:()=>ZTe,setTournamentStartDate:()=>JTe,setTournamentStatus:()=>qTe});var VTe={};_i(VTe,{copyTournamentRecord:()=>jTe,createTournamentRecord:()=>GF});function jTe(t){let e=Gt(t,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord,n=1440*60*1e3,a=(i&&r?new Date(Ui(r)).getTime()-new Date(Ui(i)).getTime():0)/n,s=t.endDate||X4(t.startDate,a),o=p=>p?.filter(({itemType:h})=>t.itemTypeList?.includes(h)),l=p=>p?.filter(({name:h})=>t.extensionList?.includes(h)),c=p=>{let{timeItems:h,extensions:f,...m}=p;return Et({...m,timeItems:o(h),extensions:l(f)},!1,!0)},u=p=>{let{drawDefinitions:h,timeItems:f,extensions:m,startDate:g,endDate:v,...y}=p;return Et({extensions:l(m),timeItems:o(f),startDate:t.startDate,endDate:s,...y},!1,!0)},d={participants:t.copyParticipants?t.tournamentRecord.participants?.map(c)??[]:[],parentOrganisation:Et({...t.tournamentRecord.parentOrganisation},!1,!0),venues:Et(t.tournamentRecord.venues??[],!1,!0),extensions:l(t.tournamentRecord.extensions),timeItems:o(t.tournamentRecord.timeItems),events:t.tournamentRecord.events?.map(u)??[],weekdays:[...t.tournamentRecord.weekdays??[]],tournamentName:t.tournamentName,startDate:t.startDate,tournamentId:lr(),endDate:s};return{...oe,tournamentRecord:d}}var GTe={};_i(GTe,{addDrawDefinitionExtension:()=>IL,addEventExtension:()=>Yg,addEventTimeItem:()=>Bw,addExtension:()=>nr,addNotes:()=>KL,addOnlineResource:()=>YTe,addParticipantExtension:()=>Kge,addParticipantTimeItem:()=>k6,addTimeItem:()=>Vp,addTournamentExtension:()=>m5,addTournamentTimeItem:()=>C0,hydrateTournamentRecord:()=>HTe,removeDrawDefinitionExtension:()=>Zge,removeEventExtension:()=>wL,removeExtension:()=>uo,removeNotes:()=>M6,removeOnlineResource:()=>WTe,removeParticipantExtension:()=>Xge,removeTournamentExtension:()=>g5,setTournamentCategories:()=>XTe,setTournamentDates:()=>WF,setTournamentEndDate:()=>QTe,setTournamentName:()=>KTe,setTournamentNotes:()=>ZTe,setTournamentStartDate:()=>JTe,setTournamentStatus:()=>qTe});function HTe(t){let{tournamentRecord:e,eventProfiles:i=[],directives:r,policyDefinitions:n}=t;return e?((e.events||[]).forEach(a=>{let s=i.find(o=>o.eventId&&o.eventId===a.eventId);(s?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&a.drawDefinitions?.forEach(o=>{(s?.policyDefinitions?.[tm]||n?.[tm])&&dwe({drawDefinition:o,appliedPolicies:n})})}),{tournamentRecord:e}):{error:et}}var S7e="ABANDONED",T7e="ACTIVE",U7e="CANCELLED",D7e="COMPLETED",E7e="IN_PROGRESS",zTe={ABANDONED:S7e,ACTIVE:T7e,CANCELLED:U7e,COMPLETED:D7e,IN_PROGRESS:E7e};function qTe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(zTe).includes(e)?{error:Se,info:"Unknown status"}:(t.tournamentStatus=e,{...oe}):{error:et}}function WTe(t){let e=Gt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ue({result:{error:za}});mS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ue(s?{result:{error:za}}:{result:{error:_n}});if(s){if(c.person?.personId!==s)return ue({result:{error:gw}});mS({element:c.person,onlineResource:r})}else mS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ue({result:{error:bD}});mS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ue({result:{error:yw}});mS({element:c,onlineResource:r})}else mS({element:i,onlineResource:r}),Ii({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:zy});return{...oe}}function mS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!(r?.[KT]===e[KT]&&r?.[ZT]===e[ZT]&&r?.[XT]===e[XT]));t.onlineResources=i}function YTe(t){let e=Gt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:s,courtId:o,venueId:l}=t;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return ue({result:{error:za}});gS({element:i.parentOrganisation,onlineResource:r})}else if(a||s){let c=(i.participants??[]).find(u=>s&&u.person?.personId===s||u.participantId===a);if(!c)return ue(s?{result:{error:za}}:{result:{error:_n}});if(s){if(c.person?.personId!==s)return ue({result:{error:gw}});gS({element:c.person,onlineResource:r})}else gS({element:c,onlineResource:r})}else if(o){let c=(i.venues??[]).filter(u=>!l||u.venueId===l).flatMap(u=>(u.courts??[]).filter(d=>d.courtId===o))?.[0];if(!c)return ue({result:{error:bD}});gS({element:c,onlineResource:r})}else if(l){let c=(i.venues??[]).find(u=>u.venueId===l);if(!c)return ue({result:{error:yw}});gS({element:c,onlineResource:r})}else gS({element:i,onlineResource:r}),Ii({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:zy});return{...oe}}function gS({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>r?.[KT]!==e[KT]&&r?.[ZT]!==e[ZT]&&r?.[XT]!==e[XT]);return i.push(e),t.onlineResources=i,{...oe}}function KTe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:et};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&Ii({topic:zy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...oe}}function ZTe({tournamentRecord:t,notes:e}){if(!t)return{error:et};let i=e?KL({element:t,notes:e}):M6({element:t});return i.error?i:(Ii({topic:zy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...oe})}function XTe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,Ii({topic:zy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...oe}):{error:et}}function P7e({tournamentRecord:t}){if(!t)return{error:et};let{startDate:e,endDate:i}=t,r=YT(e,i),n=[];for(let a of t.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:s,endTime:o}=(a.dateAvailability??[]).reduce((u,d)=>{let p=Ji(u.startTime),h=Ji(u.endTime);return d.startTime&&Ji(d.startTime)<p&&(u.startTime=d.startTime),d.endTime&&Ji(d.endTime)>h&&(u.endTime=d.endTime),u},{startTime:"08:00",endTime:"18:00"}),l=r.map(u=>a.dateAvailability?.find(d=>d.date===u)??{date:u,startTime:s,endTime:o}),c=a.dateAvailability?.find(u=>!u.date);c&&l.unshift(c),a.dateAvailability=l}return{...oe}}function WF(t){let{tournamentRecord:e,startDate:i,endDate:r,weekdays:n}=t,a=t.activeDates?.filter(Boolean),s=Gt(t,[{tournamentRecord:!0},{[hs]:h=>Tp.test(h),[uc]:Ba,startDate:!1,endDate:!1},{[hs]:h=>h.filter(Boolean).every(f=>Tp.test(f)),[uc]:Ba,activeDates:!1},{[hs]:Rwe,weekdays:!1}]);if(s.error)return s;if(r&&i&&new Date(r)<new Date(i))return{error:Se};if(r&&i&&new Date(i)>new Date(r))return{error:Se};if(a?.length){let h=i||e.startDate,f=r||e.endDate,m=!h||a.every(v=>new Date(v)>=new Date(h)),g=!f||a.every(v=>new Date(v)<=new Date(f));if(!m||!g)return{error:Ba}}let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(o=!0);let l=YT(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let c=YT(e.startDate,e.endDate),u=l.filter(h=>!c.includes(h)),d=c.filter(h=>!l.includes(h));for(let h of e.events??[])i&&h.startDate&&new Date(h.startDate)<new Date(i)&&(h.startDate=i),r&&h.startDate&&new Date(h.startDate)>new Date(r)&&(h.startDate=i??r),r&&h.endDate&&new Date(h.endDate)>new Date(r)&&(h.endDate=r),i&&h.endDate&&new Date(h.endDate)<new Date(i)&&(h.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r),a&&(e.activeDates=a),n&&(e.weekdays=n);let p=o&&C7e({tournamentRecord:e})?.unscheduledMatchUpIds;return P7e({tournamentRecord:e}),Ii({payload:Ft({parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,activeDates:a,startDate:i,weekdays:n,endDate:r}),topic:zy}),{...oe,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:u}}function JTe({tournamentRecord:t,startDate:e}){return e?WF({tournamentRecord:t,startDate:e}):{error:Ba}}function QTe({tournamentRecord:t,endDate:e}){return e?WF({tournamentRecord:t,endDate:e}):{error:Ba}}function C7e({tournamentRecord:t}){let e=Wa({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let s of e){let{schedule:o,matchUpId:l}=s;if(o&&o.scheduledDate){let c=new Date(o.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(o.scheduledDate)||n.push(o.scheduledDate))}}return n.length&&!VF({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:Ufe}:{unscheduledMatchUpIds:a}}var eUe={};_i(eUe,{addCourt:()=>zF,addCourts:()=>I8,addVenue:()=>u0,deleteCourt:()=>cUe,deleteVenue:()=>M8,deleteVenues:()=>nUe,disableCourts:()=>aUe,disableVenues:()=>sUe,enableCourts:()=>oUe,enableVenues:()=>lUe,generate:()=>tUe,generateCourts:()=>Y7,getCompetitionVenues:()=>_0,getCourts:()=>k7,getVenuesAndCourts:()=>Pm,modifyCourt:()=>N8,modifyCourtAvailability:()=>C8,modifyVenue:()=>uUe,mutate:()=>iUe,publicFindVenue:()=>Y5,query:()=>lwe});var tUe={};_i(tUe,{generateCourts:()=>Y7});var iUe={};_i(iUe,{addCourt:()=>zF,addCourts:()=>I8,addVenue:()=>u0,deleteCourt:()=>cUe,deleteVenue:()=>M8,deleteVenues:()=>nUe,disableCourts:()=>aUe,disableVenues:()=>sUe,enableCourts:()=>oUe,enableVenues:()=>lUe,modifyCourt:()=>N8,modifyCourtAvailability:()=>C8,modifyVenue:()=>uUe});function P8(t){if(!t?.tournamentRecord&&!Array.isArray(t?.venueMatchUps))return{error:et};if(!t?.courtId)return{error:mw};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:s}=Cm({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:o}=Wa({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:o,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{let h=p.schedule?.allocatedCourts?.map(({courtId:f})=>f);return p.schedule?.courtId===u||h?.includes(u)});return A_({matchUps:d,schedulingProfile:s})}}function R7e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:et};if(!r)return{error:qg};let{schedulingProfile:n}=Cm({tournamentRecord:e}),{matchUps:a}=Wa({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:s({matchUps:a,venueId:r})};function s({matchUps:o,venueId:l}){let c=o.filter(u=>{let d=u.schedule?.allocatedCourts?.map(({venueId:p})=>p);return u.schedule?.venueId===l||d?.includes(l)});return A_({matchUps:c,schedulingProfile:n})}}function C8({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!t)return{error:et};if(!n)return{error:mw};let s=OSe({dateAvailability:e});if(s.error)return s;let{updatedDateAvailability:o,totalMergeCount:l}=M7e(e);e=o;let c=Aw({tournamentRecord:t,courtId:n});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=P8({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p?.length){let h=er({tournamentRecord:t})?.appliedPolicies,f=a??h?.[Wg]?.allowDeletionWithScoresPresent?.courts,m=[];m.length&&(f||console.log("throw error: scheduled court matchUps",m.length))}return u&&(u.dateAvailability=e,!i&&d&&Ii({payload:{venue:d,tournamentId:t.tournamentId},topic:qy,key:d.venueId})),{...oe,totalMergeCount:l}}function M7e(t){let e=0,i=t.reduce((n,a)=>{let{date:s,startTime:o,endTime:l,bookings:c}=a;return n[s]||(n[s]=[]),n[s].push({startTime:o,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(Y6e);let{mergedAvailability:a,mergeCount:s}=N7e(i[n]);r.push(...a.map(o=>({date:n,...o}))),e+=s}),{updatedDateAvailability:r,totalMergeCount:e}}function N7e(t){let e,i,r,n=t.length,a=0,s=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(VR(Gn(i),Gn(c),!1)>0){let p={startTime:e,endTime:i};r?.length&&(p.bookings=r),s.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let o={startTime:e,endTime:i};return r?.length&&(o.bookings=r),s.push(o),{mergedAvailability:s,mergeCount:a}}function R8({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Rme,info:e}}function rUe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:eo};if(!e&&!r)return{error:Nd};let a;if(!e){if(!t)return{error:et};({drawDefinition:e}=Lo({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=qr({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:et};let s=Wa({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=pbe({matchUps:s,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(s=>[Ug,zh].includes(s.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:s})=>![Ug,zh].includes(s)),Hi({tournamentId:t?.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...oe}):{error:Ls}}function M8(t){if(typeof t?.venueId!="string")return{error:qg};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:et};let a=Cd({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],s=er({tournamentRecord:e})?.appliedPolicies,o=r??s?.[Wg]?.allowDeletionWithScoresPresent?.venues;if(!a.length||o)for(let l of Object.values(n)){for(let u of a){let d=rUe({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:l});if(d.error)return d}let c;l.venues=(l.venues??[]).filter(u=>u?.venueId!==i?!0:(c=!0,!1)),c&&Ii({payload:{venueId:i,tournamentId:l.tournamentId},topic:E5,key:i})}else return R8({matchUpsCount:a.length});return O0({tournamentRecords:n}),{...oe}}function nUe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:et};if(!Array.isArray(e))return{error:Se};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,s=M8({tournamentRecord:t,venueId:a,force:i});if(s.error)return s}}return{...oe}}function aUe(t){let{courtIds:e,dates:i}=t,r=Qc(t),n=[{[Fs]:!0,[yL]:!0}],a=Gt(t,n);if(a.error)return a;for(let s of Object.values(r))A7e({tournamentRecord:s,courtIds:e,dates:i});return{...oe}}function A7e({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>nr({extension:{value:r,name:bd},creationTime:!1,element:a});for(let a of t.venues||[])for(let s of a.courts||[])if(e?.includes(s.courtId)){let o=n(s);if(o.error)return o}return{...oe}}function sUe(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[Fs]:!0,[bL]:!0}],a=Gt(t,n);if(a.error)return a;let s=Object.keys(e).filter(o=>!i||o===i);for(let o of s){let l=e[o];_7e({tournamentRecord:l,venueIds:r})}return{...oe}}function _7e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e?.includes(i.venueId)){let r=nr({creationTime:!1,element:i,extension:{name:bd,value:!0}});if(r.error)return r}return{...oe}}function oUe(t){let e=Qc(t),i=[{[Fs]:!0}];!t.enableAll&&i.push({[yL]:!0});let r=Gt(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:s}=t;for(let o of Object.values(e))k7e({tournamentRecord:o,courtIds:a,enableAll:n,dates:s});return{...oe}}function k7e({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e?.includes(a.courtId))if(Array.isArray(r)){let{extension:s}=Ci({element:a,name:bd});if(s){let o=s.value;Array.isArray(o.dates)&&(o.dates=o.dates.filter(l=>!r.includes(l))),nr({extension:{name:bd,value:o},creationTime:!1,element:a})}}else uo({element:a,name:bd});return{...oe}}function lUe(t){let e=Qc(t),i=[{[Fs]:!0}];!t.enableAll&&i.push({[bL]:!0});let r=Gt(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let s of Object.values(e))for(let o of s.venues||[])(a||n?.includes(o.venueId))&&uo({element:o,name:bd});return{...oe}}function cUe(t){let{courtId:e,disableNotice:i,force:r}=t,n=Qc(t),a=Gt(t,[{[Fs]:!0,[Hge]:!0}]);if(a.error)return a;let s,o;for(let l of Object.values(n)){if(o=O7e({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),o.error&&o.error!==bD)return o;o.success&&(s=!0)}return s?{...oe}:o}function O7e({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){let n=Aw({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:s}=P8({tournamentRecord:t,courtId:i}),o=er({tournamentRecord:t})?.appliedPolicies,l=r??o?.[Wg]?.allowDeletionWithScoresPresent?.courts;if(!s?.length||l){for(let c of s??[]){let u=rUe({matchUpId:c.matchUpId,drawId:c.drawId,tournamentRecord:t});if(u.error)return u}a&&(a.courts=(a.courts??[]).filter(c=>c.courtId!==i),e||Ii({payload:{venue:a,tournamentId:t.tournamentId},topic:qy,key:a.venueId}))}else return R8({matchUpsCount:s.length});return{...oe}}function N8(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,s=Qc(t);if(!Object.keys(s).length)return{error:hn};let o,l;for(let c of Object.values(s)){let u=x7e({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u?.error)return u;o=!0}return o?{...oe}:l}function x7e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:et};if(!n)return{error:mw};if(!r||typeof r!="object")return{error:Sm};let s=Aw({tournamentRecord:t,courtId:n});if(s.error)return s;let{venue:o,court:l}=s,c=Object.keys(W6e()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:tL};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=C8({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||Ii({payload:{venue:o,tournamentId:t.tournamentId},topic:qy,key:o?.venueId}),{...oe,court:Et(l)}}var L7e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),F7e=L7e;function uUe(t){let{modifications:e,venueId:i,force:r}=t,n=Qc(t);if(!Object.keys(n).length)return{error:hn};if(typeof i!="string")return{error:qg};let a,s;for(let o of Object.values(n)){let l=B7e({tournamentRecord:o,modifications:e,venueId:i,force:r});if(l.success&&(s=!0),l.error&&(a=l.error),l.error&&l.error!==yw)return l}return O0({tournamentRecords:n}),s?{...oe}:{error:a}}function B7e({tournamentRecord:t,modifications:e,venueId:i,force:r}){if(!t)return{error:et};if(!e||typeof e!="object")return{error:Sm};if(!i)return{error:qg};let n=er({tournamentRecord:t})?.appliedPolicies,a=r??n?.[Wg]?.allowDeletionWithScoresPresent?.venues,{matchUps:s}=R7e({tournamentRecord:t,venueId:i}),o=rf({tournamentRecord:t,venueId:i});if(o.error)return o;let l=o.venue,c=Object.keys(F7e()).filter(g=>g!=="venueId");if(!Object.keys(e).filter(g=>c.includes(g)).length)return{error:tL};let u=c.filter(g=>!["courts","onlineResources"].includes(g)),d=Object.keys(e).filter(g=>u.includes(g));l&&d.forEach(g=>Object.assign(l,{[g]:e[g]}));let p=l?.courts?.map(g=>g.courtId)??[],h=e.courts?.map(g=>g.courtId)||[],f=h.length?p.filter(g=>!h.includes(g)):e?.courts&&p,m=[];if(f?.length){let g=l?.courts?.filter(v=>f.includes(v.courtId))?.map(v=>{let y=P8({courtId:v.courtId,tournamentRecord:t,venueMatchUps:s});for(let b of y.matchUps??[])m.push({matchUpId:b.matchUpId,drawId:b.drawId});return y.matchUps?.length??0}).reduce((v,y)=>v+y);if(l&&(!g||a))l.courts=l.courts?.filter(v=>h.includes(v.courtId)),FC({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return R8({matchUpsCount:g})}if(e.courts)for(let g of e.courts){let{courtId:v}=g||{},y=N8({modifications:g,disableNotice:!0,tournamentRecord:t,venueMatchUps:s,courtId:v,force:r});if(y.error===bD&&(y=zF({disableNotice:!0,tournamentRecord:t,venueId:i,court:g})),y.error)return y}return O0({tournamentRecord:t}),l&&Ii({payload:{venue:l,tournamentId:t.tournamentId},topic:qy,key:l?.venueId}),{...oe,venue:Et(l)}}var A8={};_i(A8,{JSON2CSV:()=>q7e,UUID:()=>lr,UUIDS:()=>Kme,allNumeric:()=>vfe,attributeFilter:()=>SI,chunkArray:()=>Ra,chunkByNth:()=>qV,chunkSizeProfile:()=>gfe,constantToString:()=>ys,countValues:()=>rje,createMap:()=>bfe,dateTime:()=>Yme,definedAttributes:()=>Ft,dehydrateMatchUps:()=>j7e,extractAttributes:()=>Jve,flattenJSON:()=>_8,generateDateRange:()=>YT,generateHashCode:()=>dje,generateRange:()=>yt,generateTimeCode:()=>jSe,groupValues:()=>ffe,hasAttributeValues:()=>uje,instanceCount:()=>Nl,intersection:()=>En,isConvertableInteger:()=>mi,isNumeric:()=>vn,isOdd:()=>pfe,isPowerOf2:()=>Dd,makeDeepCopy:()=>Et,matchUpScheduleSort:()=>V7e,matchUpSort:()=>_w,nearestPowerOf2:()=>f4,nextPowerOf2:()=>hD,noNulls:()=>ije,noNumeric:()=>yfe,numericSort:()=>ea,occurrences:()=>aje,overlap:()=>go,randomMember:()=>Tu,randomPop:()=>yl,shuffleArray:()=>co,structureSort:()=>Dw,subSort:()=>sje,undefinedToNull:()=>WV,unique:()=>yi,visualizeScheduledMatchUps:()=>$7e});function $7e({scheduledMatchUps:t,showGlobalLog:e}){Nze();let i=t?.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:s}=t.find(o=>o.structureId===n);return{[n]:`${a} ${s}`}})};i?.forEach(n=>{Sl({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(o=>o.structureId===n),s=vo({matchUps:a})?.roundMatchUps||[];Object.keys(s).forEach(o=>{Sl({roundNumber:o,keyColors:{roundNumber:"brightcyan"}},!0),s[o].forEach(({matchUpId:l,schedule:c})=>{let u=zr(c.scheduledTime);Sl({matchUpId:l,time:u,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Mze()}var{extractTime:SX,timeStringMinutes:TX}=Yme;function V7e(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=TX(SX(i.scheduledTime)),a=TX(SX(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function j7e({tournamentRecord:t}){if(!t)return{error:et};if(typeof t!="object"||!t.tournamentId)return{error:Se};let{matchUps:e}=Wa({tournamentRecord:t,inContext:!1});if(e?.length){let i=G7e({tournamentRecord:t});z7e(e,i)}return{...oe}}function G7e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var H7e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function z7e(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,s=e[r]||e[n]||e[a],o=i.matchUpFormat===s?void 0:i.matchUpFormat;for(let l of Object.keys(i))H7e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}function q7e(t,e){if(e&&typeof e!="object")return{error:Se};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:s,onlyHeaderRow:o,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Se};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>_8(A,g)),y=Object.values(i).flat();r&&l.push(...y);let b=v.reduce((A,N)=>Object.keys(N).every(k=>!A.includes(k)&&A.push(k)||!0)&&A,[]).filter(A=>!l?.length||l.includes(A)),I=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(N=>({[N]:A})).flat()).flat()),w=(A,N)=>e?.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0,T=b.reduce((A,N)=>{let k=I[N];return k?A.includes(k)||A.push(k):A.push(N),A},[]).sort(w);Object.keys(u).forEach(A=>!T.includes(A)&&T.unshift(A)),Object.keys(i).forEach(A=>!T.includes(A)&&T.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!T.includes(A)&&T.unshift(A));let S=T.map(A=>u[A]||A);if(o)return[S];let D=A=>`${h}${A}${h}`,C=[],E=A=>Object.values(T.reduce((N,k,x)=>{let O=i[k],V=(O?.length?A[O.find(q=>A[q])]:A[k])||p?.[k]||"",F=d[k]?.[V]||V,j=gl(c[k])?c[k](F):F;return N[k]=D(j),j&&(C[x]=(C[x]||0)+1),N},{})),P=v.map(E),R=s&&[...C].map((A,N)=>!A&&N).filter(vn).reverse();if(R){let A=N=>N.filter((k,x)=>!R.includes(x));P=P.map(A),S=A(S)}let M=P.map(A=>A.join(f));return a?M.map(A=>{let N=A.split(f);return Object.assign({},...N.map((k,x)=>({[S[x]]:k})))}):n?[S.map(D).join(f),...M].join(m):M.join(m)}function _8(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,_8(t[n],e,i.concat(n))),{})}var{FACTORY:UX}=Qge;function W7e({tournamentRecord:t,value:e}){let{extension:i}=Ci({element:t,name:UX}),r={name:UX,value:{...i?.value,...e}};nr({element:t,extension:r})}function dUe({timeStamp:t}){let e=Iw(),i=H4();return i&&Object.values(e).forEach(r=>{W7e({tournamentRecord:r,value:{version:Gx(),timeStamp:t}})}),i}function pUe({engineType:t,methodName:e,elapsed:i,params:r,result:n}){let a=cc();if(typeof a!="object")return;let s={method:e},o=n?.error&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&a.params?.includes(e),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(s.elapsed=i),!u&&(o||c)&&(s.params=r),!u&&(o||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&a.result?.includes(e))&&(s.result=n),Object.keys(s).length>1&&$me(s,t)}function k8({methodName:t,params:e,start:i}){let r={error:rL,methodName:t},n=i?Date.now()-i:0;return pUe({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function Y7e(t,e){if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:et};let i=e.drawId||e.matchUp?.drawId;if(i){let{event:a,drawDefinition:s,tournamentId:o}=Lo({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),o&&(e.tournamentId=o),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Lo({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:Vc};e.tournamentId=s,e.event=a}let r=e.tournamentId??bw();if(!r&&e)return e;let n=t[r];return r&&!n?{error:et}:(n&&(e.tournamentRecord=n),e)}function O8(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),s=bw();i&&(i.activeTournamentId=s);let o=i?.tournamentRecord||q4(s),l=typeof i?.tournamentRecord=="object"&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||Iw(),c=i?Et(i,void 0,!0):void 0,u=i?Y7e(l,i):void 0;if(u?.error)return u;let d=K7e({params:u,tournamentRecords:l,tournamentRecord:o,methodName:r,method:e}),p=Date.now()-a;return pUe({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function K7e({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(cc())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return sL({engineName:"engine",methodName:r,params:i,err:a})}}function YF(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=Jc();for(let s of[...a].sort(Z7e)){let o=Lme({topic:s});o?.length&&nj({topic:s,notices:o})}e&&n&&a.includes(dj)&&nj({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:dj})}var DX={[k5]:5,[_5]:5,[O5]:5,[A5]:5,[N5]:5,[R5]:5,[mve]:5,[gve]:5,[M5]:1,[PL]:1,[Ss]:5,[qy]:5,[C5]:4,[D5]:4,[E5]:4,[P5]:4,[EL]:3,[S5]:2};function Z7e(t,e){return(DX[e]||0)-(DX[t]||0)}function X7e({convertExtensions:t,removeExtensions:e}){let i=Iw();return{tournamentId:bw(),tournamentRecords:Et(i,t,!1,e)}}function J7e(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=t?.tournamentId??bw();if(typeof r!="string")return{};let n=q4(r);return{tournamentRecord:Et(n,e,!1,i)}}function Q7e(){let t=Iw(),{extension:e}=Ci({name:fy,tournamentRecords:t,discover:!0}),i=e?.value?.tournamentIds||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),aL(t)}function EX(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Sm}:t?.tournamentId?Fme(e?Et(t):t):{error:Se}}function BC(t,e=!0){if(typeof t!="object")return{error:Sm};if(fC(),Array.isArray(t)){if(t.filter(i=>i?.tournamentId).length!==t.length)return{error:ZV};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t?.tournamentId)t={[t.tournamentId]:t},fC(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:ZV};return aL(e?Et(t):t)}function e8e(t,e,i,r,n,a){let s=Vme(i,r,n,a);if(s.error)return s;let o=s.methods??[];return Object.keys(o).filter(l=>gl(o[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:o[l],...c});if(cc())return u();try{return u()}catch(d){sL({engineName:"engine",methodName:l,params:c,err:d})}}}),{...oe,...t}}function vS(t,e){return e?.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function hUe(t,e){t.importMethods=(i,r,n,a)=>e8e(t,e,i,r,n,a),t.getTournament=i=>J7e(i),t.getState=i=>X7e({convertExtensions:i?.convertExtensions,removeExtensions:i?.removeExtensions}),t.version=()=>Gx(),t.reset=()=>(aL({}),vS(t)),t.devContext=i=>(pC(i),vS(t)),t.getDevContext=i=>cc(i),t.newTournamentRecord=(i={})=>{let r=GF(i),n=r.tournamentId;return r.error?r:(EX(r),fC(n),{...oe,tournamentId:n})},t.setState=(i,r,n)=>{hC(r,n);let a=BC(i,r);return vS(t,a)},t.setTournamentId=i=>fC(i),t.getTournamentId=()=>bw(),t.setTournamentRecord=(i,r,n)=>{hC(r,n);let a=EX(i,r);return vS(t,a)},t.removeTournamentRecord=i=>{let r=Bme(i);return vS(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=Q7e();return vS(t,i)}}function t8e(t,e,i){if(!Array.isArray(e))return{error:Se,message:"directives must be an array"};let r=xme(),n=Date.now(),a=i&&Et(Iw(),!1,!0),s=[];for(let c of e){if(typeof c!="object")return{error:Se,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Se,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return k8({methodName:u,start:n,params:p});if(d){let f=s[s.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=O8(t,r[u],p,u,"sync");if(h?.error)return a&&BC(a),{...h,rolledBack:!!a};s.push({...h,methodName:u})}let o=Date.now(),l=dUe({timeStamp:o});return YF({directives:e,mutationStatus:l,timeStamp:o}),BR(),{success:s.every(c=>c.success),results:s}}function PX(t,e){if(!qi(e))return{error:Se,message:"args must be an object"};let i=Object.values(e).filter(gl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Se};let r=i?Object.keys(e).find(h=>gl(e[h])):Yr(e.method)&&e.method;if(!r)return{error:rL};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=s.rollbackOnError&&Et(Iw(),!1,!0),l=n||t[r]||j4()[r];if(!l)return k8({methodName:r,params:s});let c=O8(t,l,s,r,"sync")??{};c?.error&&o&&BC(o);let u=Date.now(),d=dUe({timeStamp:u}),p=c?.success&&s?.delayNotify!==!0&&s?.doNotNotify!==!0;return p&&YF({directives:[{method:l,params:s}],mutationStatus:d,timeStamp:u}),(p||!c?.success||s?.doNotNotify)&&BR(),c}var i8e=(()=>{let t={executionQueue:(e,i)=>t8e(t,e,i),execute:e=>PX(t,e)};return hUe(t,PX),t})(),x8=i8e;function CX(t,e){if(!qi(e))return{error:Se,message:"args must be an object"};let i=Object.values(e).filter(gl).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Se};let r=i?Object.keys(e).find(l=>gl(e[l])):Yr(e.method)&&e.method;if(!r)return{error:rL};let{[r]:n,...a}=e,s=e?.params?{...e.params}:{...a},o=n||t[r]||j4()[r];return o?O8(t,o,s,r,"ask"):k8({methodName:r,params:s})}(()=>{let t={execute:e=>CX(t,e)};return hUe(t,CX),t})();var Jb={},Xm;function fUe(t,e=!0){if(!t)return{error:Yt};if(typeof t!="object")return{error:Sm};if(t.matchUpId)Xm=t.matchUpId,Jb[Xm]=e?Et(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Jb[i.matchUpId]=e?Et(i):i,Xm||(Xm=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Jb[i.matchUpId]=e?Et(i):i,Xm||(Xm=i.matchUpId));return e?Et(t):t}function r8e(){return Jb[Xm]}function n8e(){return Object.values(Jb)}function a8e(){Xm=void 0,Jb={}}function s8e(t){return Et(Jb[Xm],t?.convertExtensions,!1,t?.removeExtensions)}(()=>{let t={getState:i=>s8e(i),version:()=>Gx(),reset:()=>(a8e(),{...oe}),drawId:void 0,error:void 0,success:!1,devContext:i=>(pC(i),t),setState:(i,r,n)=>{hC(r,n);let a=fUe(i);return e(a)}};function e(i){return i?.error?(t.error=i.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=i.drawId),t}return o8e(t,[K6]),t})();function o8e(t,e){e.forEach(i=>{Object.keys(i).forEach(r=>{t[r]=n=>{if(cc())return RX(t,{params:n,governor:i,methodName:r});try{return RX(t,{params:n,governor:i,methodName:r})}catch(a){sL({engineName:"matchUpEngine",methodName:r,params:n,err:a})}}})})}function RX(t,{params:e,governor:i,methodName:r}){t.error=void 0,t.success=!1;let n=e?.matchUp||r8e(),a=e?.matchUps||n8e(),s=e?.rollbackOnError&&Et(n,!1,!0);e={...e,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let o=i[r](e);if(o?.error)return s&&fUe(s),{...o,rolledBack:!!s};let l=o?.success&&e?.delayNotify!==!0&&e?.doNotNotify!==!0;return l&&YF(),(l||!o?.success||e?.doNotNotify)&&BR(),o}var wB=!1;(()=>{let t={version:()=>Gx(),setDeepCopy:(r,n)=>(hC(r,n),t),devContext:r=>(pC(r),wB=!0,t)};return i([u8]),t;function e(r,n){let a=r({...n});return a?.error||YF(),BR(),wB&&(pC(!1),wB=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=s=>{if(cc()){let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&BC(o.tournamentRecord),o}else try{let o=e(n[a],s);return!o?.error&&s?.setState&&o?.tournamentRecord&&BC(o.tournamentRecord),o}catch(o){let l;typeof o=="string"?l=o.toUpperCase():o instanceof Error&&(l=o.message),console.log("ERROR",{params:JSON.stringify(s),method:a,error:l})}}})})}})();x8.importMethods(p4,!0,1);var mUe=x8,l8e={getTournamentPoints:fF},c8e=l8e,u8e={calculateNewRatings:zbe,generateDynamicRatings:qbe},d8e=u8e,p8e={...c8e,...d8e};x8.importMethods(p8e);var h8e={[TC]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},f8e={[Gh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Kb,nP]}},m8e={[Gh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Kb,NC,PI],disabledActions:[]}]}},g8e={[Gh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},v8e={[DD]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},y8e={[Gc]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:_u,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[Dt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[sl]:[],[$p]:[],[br]:[],[Ol]:[],[wa]:[],[Fr]:[]}}},SB="Personal circumstance",b8e={[Gc]:{requireAllPositionsAssigned:!1,stage:{[Dt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:_u,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:_u,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[sl]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[$p]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Ol]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[br]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Fr]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:SB,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[wa]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:SB,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Hh]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:SB,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},I8e={[Iu]:{seedingProfile:{positioning:uL},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},w8e={POLICY_AVOIDANCE_COUNTRY:h8e,POLICY_POSITION_ACTIONS_DEFAULT:Pbe,POLICY_POSITION_ACTIONS_DISABLED:g8e,POLICY_POSITION_ACTIONS_NO_MOVEMENT:m8e,POLICY_POSITION_ACTIONS_UNRESTRICTED:f8e,POLICY_PRIVACY_DEFAULT:v8e,POLICY_ROUND_NAMING_DEFAULT:H5,POLICY_SCHEDULING_DEFAULT:swe,POLICY_SCORING_DEFAULT:y8e,POLICY_SCORING_USTA:b8e,POLICY_SEEDING_ITF:I8e,POLICY_SEEDING_DEFAULT:jIe},S8e={ratingsParameters:Da,matchUpFormats:RGe,countryToFlag:Tve,tieFormats:Swe,countries:ng,policies:w8e,flagIOC:PHe},T8e={};_i(T8e,{activeMatchUpStatuses:()=>w5,auditConstants:()=>R5e,completedMatchUpStatuses:()=>la,directingMatchUpStatuses:()=>cve,displayConstants:()=>a5e,drawDefinitionConstants:()=>Bge,entryStatusConstants:()=>xHe,errorConditionConstants:()=>Rje,eventConstants:()=>kGe,extensionConstants:()=>Qge,flightConstants:()=>$5e,genderConstants:()=>W4,keyValueConstants:()=>M3e,matchUpActionConstants:()=>jWe,matchUpStatusConstants:()=>DL,matchUpTypes:()=>JVe,nonDirectingMatchUpStatuses:()=>uve,particicipantsRequiredMatchUpStatuses:()=>ove,participantConstants:()=>EHe,participantRoles:()=>r6,participantTypes:()=>eP,penaltyConstants:()=>V8e,policyConstants:()=>cHe,positionActionConstants:()=>eWe,ratingConstants:()=>fWe,recoveryTimeRequiredMatchUpStatuses:()=>wHe,requestConstants:()=>R6e,resourceContants:()=>SGe,resultConstants:()=>pje,scaleConstants:()=>aHe,scheduleConstants:()=>oze,sortingConstants:()=>W5e,surfaceConstants:()=>W8e,tieFormatConstants:()=>MGe,timeItemConstants:()=>nze,topicConstants:()=>THe,tournamentConstants:()=>zTe,upcomingMatchUpStatuses:()=>dve,validMatchUpStatuses:()=>lve,venueConstants:()=>Z8e,weekdayConstants:()=>Cwe});var U8e="Coaching",D8e="Ball Abuse",E8e="Racket Abuse",P8e="Verbal Abuse",C8e="INELIGIBILITY",R8e="Physical Abuse",M8e="Unsportmanlike Conduct",N8e="Dress Code Violation",A8e="Equipment Violation",_8e="Leaving the court",k8e="Failure to complete",O8e="No Show",x8e="Other",L8e="REFUSAL_TO_PLAY",F8e="PROHIBITED_SUBSTANCE",B8e="Puncuality",$8e="Failure to sign in",V8e={COACHING:U8e,BALL_ABUSE:D8e,RACKET_ABUSE:E8e,VERBAL_ABUSE:P8e,PHYSICAL_ABUSE:R8e,INELIGIBILITY:C8e,UNSPORTSMANLIKE_CONDUCT:M8e,PROHIBITED_SUBSTANCE:F8e,DRESS_CODE_VIOLATION:N8e,EQUIMENT_VIOLATION:A8e,LEAVING_THE_COURT:_8e,REFUSAL_TO_PLAY:L8e,FAILURE_TO_COMPLETE:k8e,NO_SHOW:O8e,OTHER:x8e,PUNCTUALITY:B8e,FAILUIRE_TO_SIGN_IN:$8e},j8e="CLAY",G8e="HARD",H8e="GRASS",z8e="CARPET",q8e="ARTIFICIAL",W8e={CLAY:j8e,HARD:G8e,GRASS:H8e,CARPET:z8e,ARTIFICIAL:q8e},Y8e="INDOOR",K8e="OUTDOOR",Z8e={INDOOR:Y8e,OUTDOOR:K8e};const X8e=cr({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function J8e({matchUp:t,individualParticipant:e,spacer:i}){const r=e?.person?.iso2NationalityCode||"",n=r?S8e.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),s=t?.matchUpType?.toLowerCase();return i||(a.className=X8e({variant:s})),a.innerHTML=i?"":n,a}function TB({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:s}){if(s==="scale")return ZVe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const o=e?.configuration||{},l=document.createElement("div");if(s==="flag"&&o.flags)return J8e({matchUp:r,individualParticipant:t,spacer:n});if(s==="seeding"){const c=YVe({className:i,composition:e,side:a});return typeof c=="string"?l:c}return l}const Q8e="Qualifier",e9e="BYE",t9e="TBD";function MX(t){const{isWinningSide:e,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:s}=t||{},o=e?"winner":void 0,l=t.eventHandlers||{},c=s?.configuration,u={QUALIFIER:c?.placeHolders?.qualifier||Q8e,BYE:c?.placeHolders?.bye||e9e,TBD:c?.placeHolders?.tbd||t9e},d=n?.participantName,p=b=>{md(l?.participantClick)&&(b.stopPropagation(),l.participantClick({individualParticipant:n,pointerEvent:b,matchUp:a,side:i}))},h=document.createElement("div");h.classList.add("tmx-i"),h.setAttribute("sideNumber",r),h.setAttribute("id",n?.participantId),h.onclick=p;const f=document.createElement("div");f.className=CVe({variant:o});const m=c?.flags&&TB({...t,type:"flag"});if(m)f.appendChild(m);else{const b=TB({type:"scale",...t});b&&f.appendChild(b)}const g=document.createElement("div");if(g.className=RVe({variant:o}),d){const b=document.createElement("span");if(e&&c?.winnerColor)b.style.color=typeof c.winnerColor=="string"?c.winnerColor:"green";else if(c?.genderColor){const I=n?.person?.sex,w=I==="MALE"&&"#2E86C1"||I==="FEMALE"&&"#AA336A"||"";b.style.color=typeof c.genderColor=="string"?c.genderColor:w}b.innerHTML=d,g.appendChild(b)}else{const b=document.createElement("abbr");b.className=PVe({variant:c.showAddress?"showAddress":""}),b.innerHTML=i?.bye&&u.BYE||i?.qualifier&&u.QUALIFIER||u.TBD,g.appendChild(b)}const v=TB({...t,className:WVe(),type:"seeding"});v&&g.appendChild(v),f.appendChild(g),h.appendChild(f);const y=qVe(t);return h.appendChild(y),{element:h}}const i9e=cr({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{in_progress:{backgroundColor:"#199f01ff"},awaiting_result:{backgroundColor:"#199f01ff"},defaulted:{backgroundColor:"#df164c"},dead_rubber:{backgroundColor:"#df164c"},cancelled:{backgroundColor:"#df164c"},incomplete:{backgroundColor:"#f7ae04ff"},suspended:{backgroundColor:"#f7ae04ff"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}}),{WALKOVER:r9e,DEFAULTED:n9e,DOUBLE_WALKOVER:a9e,DOUBLE_DEFAULT:s9e}=DL;function o9e({matchUpStatus:t}){const e=t?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended"].includes(e)?e:void 0,r=[r9e,a9e].includes(t||"")?"WO":[n9e,s9e].includes(t||"")?"DEF":t?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=i9e(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",t||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}function l9e(t){return t instanceof Element||t}const c9e=cr({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function u9e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=c9e(),e}const d9e=cr({flexDirection:"column",position:"relative",display:"flex"}),p9e=cr({alignItems:"stretch",display:"flex"}),h9e=cr({marginInlineEnd:".25rem",color:"green"});function f9e({dim:t="20px"}={}){const e=h9e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}const{WALKOVER:m9e,DEFAULTED:g9e,DOUBLE_WALKOVER:v9e,RETIRED:y9e}=DL;function L8({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:s,matchUp:o}){const{winningSide:l,matchUpType:c,isRoundRobin:u,matchUpStatus:d}=o||{},p=r?.configuration;let h;const f=s?o?.sides?.find(P=>P.sideNumber===s):void 0;n||(n=f?.participant,h=p?.allDrawPositions||p?.drawPositions&&f?.drawPosition&&(o?.roundNumber===t||f?.participantFed||u)?f?.drawPosition:"");const m=c==="DOUBLES",g=m?n?.individualParticipants?.[0]:n,v=m&&n?.individualParticipants?.[1],y=!!(s===l||d==="BYE"&&n),b=p?.winnerChevron&&y,I=p?.teamLogo,w=[y9e,v9e,m9e,g9e].includes(d)&&!y,T=p?.gameScoreOnly,S=document.createElement("div");if(i&&(S.className=NVe({drawPosition:h,sideNumber:s})),S.classList.add("tmx-p"),S.setAttribute("id",n?.participantId||""),I){const P=u9e({teamLogo:I});S.appendChild(P)}const D=document.createElement("div");D.className=MVe(m?{variant:"doubles"}:{});const C=document.createElement("div");C.className=AVe({winnerChevron:b,isDoubles:m});const E=MX({individualParticipant:g,eventHandlers:e,isWinningSide:y,composition:r,sideNumber:s,matchUp:o,side:f}).element;if(C.appendChild(E),v){const P=MX({individualParticipant:v,eventHandlers:e,isWinningSide:y,composition:r,sideNumber:s,matchUp:o,side:f}).element;C.appendChild(P)}else m&&a&&l9e(a)&&C.appendChild(a);if(D.appendChild(C),S.appendChild(D),i){const P=document.createElement("div");if(y&&!T){const R=f9e();typeof R=="string"?P.innerHTML=R:P.appendChild(R)}else if(w){const R=o9e({matchUpStatus:d});P.appendChild(R)}S.appendChild(P)}return S}const b9e=cr({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function gUe({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=b9e(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const s=md(t?.roundHeaderClick);s&&(a.onclick=u=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:u}));const o=s?"":"",l=i?.[r]?.roundName,c=l&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${l}</div>
        <div style="font-weight: bold">${o}</div>
      </div>
  `;return a.innerHTML=c||"",a}const vUe=cr({flexDirection:"column",display:"flex"}),I9e=cr({flexDirection:"row",display:"flex"}),yUe=cr({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),w9e=cr({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),S9e=cr({fontWeight:"bold",color:"blue",height:"1em"}),NX=cr({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),T9e=cr({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function U9e(){return cr({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})()}const D9e=cr({});function E9e({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t?.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return cr(e)()}function P9e({variant:t}){return cr({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const C9e=cr({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),R9e=cr({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),AX=cr({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function M9e({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");md(t?.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:u})),a.className=$y(P9e({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const s=document.createElement("div");s.className=C9e();const o=document.createElement("div");o.className=R9e();const l=document.createElement("div");l.className=AX(),l.innerHTML=e?"Entry status:&nbsp;":"",o.appendChild(l);const c=document.createElement("div");return c.className=AX(),c.innerHTML=e||"",o.appendChild(c),s.appendChild(o),a.appendChild(s),{element:a}}const oP={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function N9e({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=t?.configuration||{},a=n?.connectorWidth||16,s=n.centerInfo?oP.centerInfo*r:0,o=n.scheduleInfo?oP.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+s,c=l*i,u=(l+o)*i;return cr({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const bUe=t=>cr({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),A9e=cr({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),IUe=cr({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),_9e=cr({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function k9e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=IUe(),e.value=String(t||""),e}function O9e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,s=i.side2TiebreakScore||i.side1TiebreakScore,o=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&o,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=k9e({value:c});else if(p=document.createElement("p"),p.className=IUe({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const h=document.createElement("span");h.className=A9e(),h.innerHTML=s&&!l?String(o):"",p.appendChild(h)}return p}function x9e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,s=i?.configuration?.gameScoreOnly,o=n?.score?.sets||[],l=i?.configuration?.scoreBox,c=t?r===2?t:t-1:void 0,u=h=>{md(e?.scoreClick)&&(h.stopPropagation(),e.scoreClick({pointerEvent:h,matchUp:n}))},d=document.createElement("div");d.className=bUe(c)({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),d.classList.add("sideScore"),d.classList.add("tmx-scr"),d.onclick=u;const p=document.createElement("div");p.className=_9e();for(const h of o||[]){const f=O9e({gameScoreOnly:s,scoreStripes:a,sideNumber:r,set:h});p.appendChild(f)}return d.appendChild(p),d}const L9e=cr({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var Vj={exports:{}},F9e=Vj.exports,_X;function B9e(){return _X||(_X=1,(function(t,e){(function(i,r){t.exports=r()})(F9e,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var N=["th","st","nd","rd"],k=A%100;return"["+A+(N[(k-20)%10]||N[k]||N[0])+"]"}},b=function(A,N,k){var x=String(A);return!x||x.length>=N?A:""+Array(N+1-x.length).join(k)+A},I={s:b,z:function(A){var N=-A.utcOffset(),k=Math.abs(N),x=Math.floor(k/60),O=k%60;return(N<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function A(N,k){if(N.date()<k.date())return-A(k,N);var x=12*(k.year()-N.year())+(k.month()-N.month()),O=N.clone().add(x,d),V=k-O<0,F=N.clone().add(x+(V?-1:1),d);return+(-(x+(k-O)/(V?O-F:F-O))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:h,w:u,d:c,D:f,h:l,m:o,s,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},w="en",T={};T[w]=y;var S="$isDayjsObject",D=function(A){return A instanceof R||!(!A||!A[S])},C=function A(N,k,x){var O;if(!N)return w;if(typeof N=="string"){var V=N.toLowerCase();T[V]&&(O=V),k&&(T[V]=k,O=V);var F=N.split("-");if(!O&&F.length>1)return A(F[0])}else{var j=N.name;T[j]=N,O=j}return!x&&O&&(w=O),O||!x&&w},E=function(A,N){if(D(A))return A.clone();var k=typeof N=="object"?N:{};return k.date=A,k.args=arguments,new R(k)},P=I;P.l=C,P.i=D,P.w=function(A,N){return E(A,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function A(k){this.$L=C(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[S]=!0}var N=A.prototype;return N.parse=function(k){this.$d=(function(x){var O=x.date,V=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var j=F[2]-1||0,q=(F[7]||"0").substring(0,3);return V?new Date(Date.UTC(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,q)):new Date(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,q)}}return new Date(O)})(k),this.init()},N.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},N.$utils=function(){return P},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(k,x){var O=E(k);return this.startOf(x)<=O&&O<=this.endOf(x)},N.isAfter=function(k,x){return E(k)<this.startOf(x)},N.isBefore=function(k,x){return this.endOf(x)<E(k)},N.$g=function(k,x,O){return P.u(k)?this[x]:this.set(O,k)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(k,x){var O=this,V=!!P.u(x)||x,F=P.p(k),j=function(K,ne){var le=P.w(O.$u?Date.UTC(O.$y,ne,K):new Date(O.$y,ne,K),O);return V?le:le.endOf(c)},q=function(K,ne){return P.w(O.toDate()[K].apply(O.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(ne)),O)},W=this.$W,z=this.$M,H=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return V?j(1,0):j(31,11);case d:return V?j(1,z):j(0,z+1);case u:var J=this.$locale().weekStart||0,ie=(W<J?W+7:W)-J;return j(V?H-ie:H+(6-ie),z);case c:case f:return q(Z+"Hours",0);case l:return q(Z+"Minutes",1);case o:return q(Z+"Seconds",2);case s:return q(Z+"Milliseconds",3);default:return this.clone()}},N.endOf=function(k){return this.startOf(k,!1)},N.$set=function(k,x){var O,V=P.p(k),F="set"+(this.$u?"UTC":""),j=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[V],q=V===c?this.$D+(x-this.$W):x;if(V===d||V===h){var W=this.clone().set(f,1);W.$d[j](q),W.init(),this.$d=W.set(f,Math.min(this.$D,W.daysInMonth())).$d}else j&&this.$d[j](q);return this.init(),this},N.set=function(k,x){return this.clone().$set(k,x)},N.get=function(k){return this[P.p(k)]()},N.add=function(k,x){var O,V=this;k=Number(k);var F=P.p(x),j=function(z){var H=E(V);return P.w(H.date(H.date()+Math.round(z*k)),V)};if(F===d)return this.set(d,this.$M+k);if(F===h)return this.set(h,this.$y+k);if(F===c)return j(1);if(F===u)return j(7);var q=(O={},O[o]=r,O[l]=n,O[s]=i,O)[F]||1,W=this.$d.getTime()+k*q;return P.w(W,this)},N.subtract=function(k,x){return this.add(-1*k,x)},N.format=function(k){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var V=k||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),j=this.$H,q=this.$m,W=this.$M,z=O.weekdays,H=O.months,Z=O.meridiem,J=function(ne,le,re,me){return ne&&(ne[le]||ne(x,V))||re[le].slice(0,me)},ie=function(ne){return P.s(j%12||12,ne,"0")},K=Z||function(ne,le,re){var me=ne<12?"AM":"PM";return re?me.toLowerCase():me};return V.replace(v,(function(ne,le){return le||(function(re){switch(re){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return W+1;case"MM":return P.s(W+1,2,"0");case"MMM":return J(O.monthsShort,W,H,3);case"MMMM":return J(H,W);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return J(O.weekdaysMin,x.$W,z,2);case"ddd":return J(O.weekdaysShort,x.$W,z,3);case"dddd":return z[x.$W];case"H":return String(j);case"HH":return P.s(j,2,"0");case"h":return ie(1);case"hh":return ie(2);case"a":return K(j,q,!0);case"A":return K(j,q,!1);case"m":return String(q);case"mm":return P.s(q,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null})(ne)||F.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(k,x,O){var V,F=this,j=P.p(x),q=E(k),W=(q.utcOffset()-this.utcOffset())*r,z=this-q,H=function(){return P.m(F,q)};switch(j){case h:V=H()/12;break;case d:V=H();break;case p:V=H()/3;break;case u:V=(z-W)/6048e5;break;case c:V=(z-W)/864e5;break;case l:V=z/n;break;case o:V=z/r;break;case s:V=z/i;break;default:V=z}return O?V:P.a(V)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return T[this.$L]},N.locale=function(k,x){if(!k)return this.$L;var O=this.clone(),V=C(k,x,!0);return V&&(O.$L=V),O},N.clone=function(){return P.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},A})(),M=R.prototype;return E.prototype=M,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach((function(A){M[A[1]]=function(N){return this.$g(N,A[0],A[1])}})),E.extend=function(A,N){return A.$i||(A(N,R,E),A.$i=!0),E},E.locale=C,E.isDayjs=D,E.unix=function(A){return E(1e3*A)},E.en=T[w],E.Ls=T,E.p={},E}))})(Vj)),Vj.exports}var $9e=B9e();const V9e=lfe($9e);function j9e({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=t?.schedule||{},{dateTime:{extractDate:s,extractTime:o}}=A8,l=o(i);let c=s(r),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=r?V9e(c).format(u):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",h=document.createElement("div");h.className=L9e(),h.classList.add("tmx-sch"),md(e?.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{md(e?.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="",g.append(y)}return h}function kX({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){const s=(i?.configuration||{})?.scheduleInfo,o=a?.score?.scoreStringSide1,l=i?.configuration?.scoreBox&&o,c=a?.readyToScore&&e?.scoreClick&&!mUe.checkScoreHasValue({matchUp:a}),u=document.createElement("div");if(u.className=$y(d9e(),n),u.classList.add("tmx-sd"),u.setAttribute("sideNumber",String(r)),s&&r===1){const h=j9e({matchUp:a,eventHandlers:e});u.appendChild(h)}const d=document.createElement("div");d.className=p9e();const p=L8({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(d.appendChild(p),l){const h=document.createElement("div");h.style.border="1px solid lightgray",d.appendChild(h)}if(o){const h=x9e({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});d.appendChild(h)}if(c){const h=m=>{md(e?.scoreClick)&&(m.stopPropagation(),e.scoreClick({pointerEvent:m,matchUp:a}))},f=document.createElement("div");f.className=bUe(void 0)({...!l&&r===1&&{sideNumber:1},fontSize:"small"}),f.onclick=h,f.innerHTML="[Score]",d.appendChild(f)}return u.appendChild(d),u}function Hw(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:s}=t,{roundFactor:o,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=r,h=t.isFinalRound||(c?Number.parseInt(String(c))===1:!1),f=p==="QUALIFYING"&&h,m=h,g=l?Number.parseInt(String(l))===i:!1,v=u==="DOUBLES",y=(s||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||n&&"m1"||"m2",b=N9e({composition:e,isDoubles:v,roundFactor:o})({isFirstRound:g,link:y}),I=e?.configuration||{},{resultsInfo:w,centerInfo:T}=I||{},S=t.eventHandlers||{},D=A=>{md(S?.matchUpClick)&&S.matchUpClick({pointerEvent:A,matchUp:r})},C=document.createElement("div");C.className=$y(e?.theme,t?.className,"matchup",D9e()),C.classList.add("tmx-m"),C.setAttribute("id",r?.matchUpId),C.onclick=D;const E=document.createElement("div");E.className=E9e({configuration:I});const P=({sideNumber:A})=>{const N=r?.sides?.find(k=>k.sideNumber===A)?.participant?.entryStatus?.replace("_"," ");return M9e({eventHandlers:S,entryStatus:N,sideNumber:A,className:A===2?b:void 0,matchUp:r})},R=kX({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:r}),M=kX({className:!T&&b,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:r});if(E.appendChild(R),T){const A=P({sideNumber:1}),N=P({sideNumber:2});E.appendChild(A.element),E.appendChild(N.element)}if(E.appendChild(M),w){const A=G9e({score:r.score});E.appendChild(A)}if(C.appendChild(E),a===r.matchUpId){const A=document.createElement("div");A.className=U9e(),C.appendChild(A)}return C}function G9e({score:t}){const e=t?.sets?.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),i=e?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=T9e(),r){const a=document.createElement("div");a.className=NX({variant:"points"}),a.innerHTML="PTS",n.appendChild(a)}for(const a of e||[]){const s=document.createElement("div");s.setAttribute("key",String(a.setNumber)),s.className=NX({variant:"set"}),s.innerHTML=String(a.setNumber),n.appendChild(s)}return n}function wUe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:s,roundFactor:o,roundNumber:l,roundProfile:c,minWidth:u,matchUps:d,context:p,isLucky:h}){const f=d.filter(E=>E.roundNumber===l).sort((E,P)=>(E.roundPosition||0)-(P.roundPosition||0)),m=f.every(({roundPosition:E,drawPositions:P})=>!E&&!P),g=s?.configuration||{},v=document.createElement("div");if(v.className=vUe(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",String(l)),g.roundHeader){const E=gUe({roundProfile:c,roundMatchUps:f,roundNumber:l,eventHandlers:i,context:p});v.appendChild(E)}const y=document.createElement("div");y.className=yUe({variant:m?"adHoc":void 0}),u&&(y.style.minWidth=u);let b,I,w;if(n){const E=R=>(R||[]).reduce((M,A)=>A+M,0);f.sort((R,M)=>{const A=E(R.drawPositions)-E(M.drawPositions),N=R.drawPositions||[],k=M.drawPositions||[],x=(N.length?Math.min.apply(null,N):0)-(k.length?Math.min.apply(null,k):0);return A||x});const P=f.reduce((R,M)=>(R[M.structureId]=M.structureName,R),{});b=Object.values(P),I=Object.keys(P),w=Object.keys(A8.instanceCount(f.map(({structureId:R})=>R))).length}else m&&f.sort((E,P)=>(E.roundOrder??0)-(P.roundOrder??0));const T=w&&f.length/w,S=Object.keys(c).map(E=>parseInt(E)),D=S.indexOf(l),C=D===0&&"first"||D===S.length-1&&"last";return f.forEach((E,P)=>{const R=T&&!(P%T),M=T&&Math.floor(P/T),A=T&&b[M];if(R){const x=document.createElement("div");x.className=w9e({...M===0&&{variant:0},...C&&{roundOrder:C}}),y.appendChild(x);const O=document.createElement("div");if(O.className=S9e(),md(i?.groupHeaderClick)){const{drawId:V,containerStructureId:F}=f[0];y.onclick=j=>i.groupHeaderClick({structureId:I[M],containerStructureId:F,pointerEvent:j,drawId:V})}l===t&&(O.innerHTML=A),y.appendChild(O)}const N=P%2===0;o?E.roundFactor=o:t>1&&(E.roundFactor=Math.pow(2,l-t));const k=Hw({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:s,isAdHoc:m,isLucky:h,matchUp:E,moiety:N});y.appendChild(k)}),v.appendChild(y),v}function SUe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:s,matchUps:o,minWidth:l,context:c}){const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:h}=mUe.getRoundMatchUps({matchUps:o});a=a||c?.structureId||o?.[0]?.structureId;const f=o.some(({isRoundRobin:y})=>y),m=p||h,g=document.createElement("div");g.className=I9e(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const v=u.length?Math.max.apply(null,u):0;for(const y of u){if(y<t)continue;const b=wUe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:y===v,isRoundRobin:f,searchActive:r,composition:n,roundNumber:y,roundProfile:d,matchUps:o,minWidth:l,context:c,isLucky:m});g.appendChild(b)}if(s&&typeof s!="boolean"){const y=document.createElement("div");y.className=vUe();const b=document.createElement("div");b.className=yUe(),b.appendChild(s),y.appendChild(b),g.appendChild(y)}return g}const OX=cr({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function TUe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?$y(OX(),e):OX(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:zw}=ofe({theme:{lineHeights:{scheduleInfo:`${oP.scheduleInfo}rem`,centerInfo:`${oP.centerInfo}rem`,gameScore:`${oP.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),xX=zw("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),H9e=zw("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),z9e=zw("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),q9e=zw("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),LX=zw("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),W9e=zw("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),Y9e=zw("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),$C={Australian:{configuration:{flags:!0},theme:xX},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:LX},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:LX},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:z9e},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:H9e},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:q9e},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:Y9e},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:xX},Night:{configuration:{flags:!0},theme:W9e}},K9e="Timed set",UUe="Tiebreak",Z9e="No-Ad",jj="Set",X9e="Ad";function FX(t=!1){return{descriptor:t?"Final set":"Best of",bestOf:t?void 0:3,advantage:X9e,what:jj,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}}function J9e(t){return!!(t?.tiebreakSet?.tiebreakTo&&!t?.setTo)}function Q9e(t,e){const{what:i,setTo:r,tiebreakAt:n,tiebreakTo:a,winBy:s,minutes:o,advantage:l}=t,c={setTo:r};return i===jj&&l===Z9e&&(c.NoAD=!0),e&&i===jj&&(c.tiebreakAt=n,c.tiebreakFormat={tiebreakTo:a},s===1&&(c.tiebreakFormat.NoAD=!0)),i===K9e&&(c.minutes=o,c.timed=!0),i===UUe&&(c.tiebreakSet={tiebreakTo:a},s===1&&(c.tiebreakSet.NoAD=!0)),c}function DUe(t){return t<=1?[]:[t-1,t]}function eYe(t,e){return DUe(t).includes(e)?e:t}function tYe(t,e){const i=e(t),r=FX(!1),n=FX(!0),a={setFormat:{...r,...i.setFormat},finalSetFormat:{...n,...i.finalSetFormat}};return a.setFormat.bestOf=i.bestOf||3,J9e(i.finalSetFormat)&&(a.finalSetFormat.what=UUe,a.finalSetFormat.tiebreakTo=i.finalSetFormat.tiebreakSet.tiebreakTo,a.finalSetFormat.winBy=i.finalSetFormat.tiebreakSet.NoAD?1:2),a}const EUe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}],Ys="none",ih="";function qN(t){return typeof t=="function"}let If,Nn;const UB="Timed set",KS="Tiebreak",BX="No-Ad",Zp="Set",lP="Ad",Ps={setFormat:{descriptor:"Best of",bestOf:3,advantage:lP,what:Zp,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:lP,what:Zp,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function $X(t){const e=Ps[t?"finalSetFormat":"setFormat"],i=document.getElementById(t?"finalSetTiebreak":"setTiebreak")?.checked||!1;return Q9e(e,i)}function PUe(){const t=$X();Nn={bestOf:Ps.setFormat.bestOf,setFormat:t},document.getElementById("finalSetOption")?.checked&&(Nn.finalSetFormat=$X(1));const e=p4.scoreGovernor.stringifyMatchUpFormat(Nn),i=EUe.some(n=>n.format===e),r=document.getElementById("matchUpFormatSelector");if(r){const n=r.value,a=i?e:"Custom";if(n!==a){const s=r.onchange;r.onchange=null,r.value=a,r.onchange=s}}return e}function ld(t){const e=t||PUe();If=e;const i=document.getElementById("matchUpFormatString");i&&(i.innerHTML=e)}const mb=(t,e)=>e&&t.finalSetFormat||t.setFormat,AS=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",onChangeCallback:"updateFinalSetVisibility",value:3},{getValue:(t,e)=>{const i=mb(t,e),r=i?.NoAD?BX:lP;return i?.timed||i?.tiebreakSet?void 0:r},options:[lP,BX],onChange:"changeAdvantage",defaultValue:lP,id:"advantage",whats:[Zp]},{getValue:(t,e)=>{const i=mb(t,e);return i||console.log({pmf:t}),i?.timed?UB:i?.tiebreakSet?KS:Zp},options:[Zp,KS,UB],finalSetLabel:`${Zp}${ih}`,onChange:"changeWhat",onChangeCallback:"updateWhatValue",pluralize:!0,id:"what"},{getValue:(t,e)=>mb(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[Zp],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{const i=mb(t,e);return i.tiebreakFormat?.tiebreakTo||i.tiebreakSet?.tiebreakTo},options:[5,7,9,10,12],onChange:"changeTiebreakTo",whats:[Zp,KS],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>mb(t,e).tiebreakAt,options:t=>{const e=Ps[t?"finalSetFormat":"setFormat"].setTo;return DUe(e)},onChange:"changeTiebreakAt",id:"tiebreakAt",defaultValue:6,whats:[Zp],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{const i=mb(t,e);if(i.tiebreakFormat)return i.tiebreakFormat?.NoAD?1:2},whats:[Zp,KS],onChange:"changeWinBy",prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=mb(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],onChange:"changeMinutes",whats:[UB],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],RE={changeWhat:(t,e,i)=>{const r=i===Zp,n=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(n);a.style.display=r?"":Ys,AS.forEach(s=>{if(s.whats){const{prefix:o="",suffix:l="",pluralize:c}=s,u=s.whats.includes(i),d=e?`${s.id}-${e}`:s.id,p=document.getElementById(d);if(p.style.display===Ys&&u){const h=Nn.bestOf,f=!e&&c&&h>1?"s":"",m=s.defaultValue;p.innerHTML=`${o}${m}${f}${l}${ih}`,Ps[e?"finalSetFormat":"setFormat"][s.id]=m}p.style.display=u?"":Ys}}),ld()},changeCount:(t,e,i)=>{const r=e?"finalSetFormat":"setFormat";Ps[r].setTo=i;const n=Ps[r].tiebreakAt,a=eYe(i,n);if(a!==n){Ps[r].tiebreakAt=a;const s=document.getElementById(e?`tiebreakAt-${e}`:"tiebreakAt");s&&(s.innerHTML=`@${a}${ih}`)}ld()},changeTiebreakAt:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].tiebreakAt=i,ld()},updateWhatValue:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].what=i},changeAdvantage:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].advantage=i,ld()},changeTiebreakTo:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].tiebreakTo=i,ld()},changeWinBy:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].winBy=i,ld()},changeMinutes:(t,e,i)=>{Ps[e?"finalSetFormat":"setFormat"].minutes=i,ld()},pluralize:(t,e,i)=>{const r=Ps[e?"finalSetFormat":"setFormat"].what,n=e?`what-${e}`:"what",a=document.getElementById(n),s=i>1?"s":"";a.innerHTML=`${r}${s}${ih}`,ld()},updateFinalSetVisibility:(t,e,i)=>{const r=i>1,n=document.getElementById("finalSetOption"),a=document.querySelector('label[for="finalSetOption"]');n&&a&&(r?(n.style.display="",a.style.display=""):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change"))),n.style.display="none",a.style.display="none"))}};function KF({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e,config:i,modalConfig:r}={}){If=t,Nn=aP.parse(If);const n=tYe(If,aP.parse);Ps.setFormat=n.setFormat,Ps.finalSetFormat=n.finalSetFormat;const a=()=>{const M=document.getElementById("matchUpFormatSelector"),A=M?.value&&M.value!=="Custom"?If:PUe();qN(e)&&e(A)},s=[{onClick:()=>{ZS(),e?.("")},label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{ZS(),a()}}],o="switch is-rounded is-danger",l=document.createElement("div");l.addEventListener("click",M=>{const A=M.target;!A.closest(".dropdown")&&!A.classList.contains("mfcButton")&&ZS()});const c=document.createElement("div");c.id="matchUpFormatString",c.innerHTML=If,c.style.fontSize="1.5em",c.style.color="blue",c.style.marginBottom="1em",l.appendChild(c);const u=document.createElement("div");u.style.marginBlockEnd="1em";const d={options:[{value:"Custom",label:"Custom",selected:!1},...EUe.filter(M=>M.format).map(M=>({selected:M.format===If,value:M.format,label:M.name}))]},p=document.createElement("select");p.id="matchUpFormatSelector",p.className="input",p.style.width="100%",p.style.backgroundColor="#ffffff",p.style.color="#363636",p.style.border="1px solid #b5b5b5";for(const M of d.options){const A=document.createElement("option");A.value=M.value||"",A.text=M.label||"",A.style.backgroundColor="#ffffff",A.style.color="#363636",M.selected&&(A.selected=!0),p.appendChild(A)}p.onchange=M=>{If=M.target.value,ld(If),Nn=aP.parse(If),Ps.setFormat=Nn.setFormat,Ps.setFormat.bestOf=Nn.bestOf,Nn.finalSetFormat&&(Ps.finalSetFormat=Nn.finalSetFormat);const A=Nn.finalSetFormat;I.style.display=A?"":Ys,w.style.display=A?"":Ys,y.checked=A;const N=A?.tiebreakSet?.tiebreakTo&&!A?.setTo;S.checked=!!A?.tiebreakFormat,S.style.display=N?Ys:"";const k=document.getElementById("finalSetTiebreakToggle");k&&(k.style.display=N?Ys:""),m.checked=Nn.setFormat.tiebreakFormat,AS.forEach(x=>{if(x.getValue){const O=x.getValue(Nn),V=document.getElementById(x.id);if(V&&O){const{prefix:F="",suffix:j="",pluralize:q}=x,W=Nn.bestOf,z=q&&W>1?"s":"";V.innerHTML=`${F}${O}${z}${j}${ih}`,V.style.display=""}else V&&(V.style.display=Ys);if(A){const F=x.getValue(Nn,!0),j=document.getElementById(`${x.id}-1`);if(j&&F){const{prefix:q="",suffix:W="",pluralize:z}=x,H=Nn.bestOf,Z=z&&H>1?"s":"";j.innerHTML=`${q}${F}${Z}${W}${ih}`,j.style.display=""}else j&&(j.style.display=Ys)}}})},u.appendChild(p),l.appendChild(u);const h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.gap="0.5em",h.style.marginBottom="1em",AS.map(M=>{const A=M.getValue?M.getValue(Nn):void 0;return VX({...M,value:A})}).forEach(M=>h.appendChild(M)),h.id="setFormat",l.appendChild(h);const f=document.createElement("div");f.className="field",f.style.fontSize="1em";const m=document.createElement("input");m.className=o,m.name="setTiebreak",m.id="setTiebreak",m.type="checkbox",m.checked=!!Nn.setFormat.tiebreakFormat,m.onchange=M=>{const A=M.target.checked;AS.filter(({tb:N})=>N).forEach(N=>{const k=document.getElementById(N.id);if(k){if(k.style.display===Ys&&A){const{prefix:x="",suffix:O="",pluralize:V,defaultValue:F}=N,j=Nn.bestOf,q=V&&j>1?"s":"";k.innerHTML=`${x}${F}${q}${O}${ih}`}k.style.display=A?"":Ys}}),ld()},f.appendChild(m);const g=document.createElement("label");g.setAttribute("for","setTiebreak"),g.id="setTiebreakToggle",g.innerHTML="Tiebreak",g.style.marginRight="1em",f.appendChild(g);const v=Nn.bestOf>1,y=document.createElement("input");y.className="switch is-rounded is-info",y.type="checkbox",y.name="finalSetOption",y.checked=!!Nn.finalSetFormat,y.id="finalSetOption",y.style.display=v?"":"none",y.onchange=M=>{const A=M.target.checked;I.style.display=A?"":Ys,w.style.display=A?"":Ys,ld()},f.appendChild(y);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",b.style.display=v?"":"none",f.appendChild(b),l.appendChild(f);const I=document.createElement("div");I.style.display=Nn.finalSetFormat?"flex":Ys,I.style.flexWrap="wrap",I.style.gap="0.5em",I.style.marginBottom="1em",I.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[],finalSet:!0}].concat(AS.map(M=>{const A=M.getValue?M.getValue(Nn,!0):void 0;return{...M,value:A}})).filter(M=>M.finalSet!==!1).map(M=>VX({...M,index:1})).forEach(M=>I.appendChild(M)),l.appendChild(I);const w=document.createElement("div");w.id="finalSetConfig",w.style.display=Nn.finalSetFormat?"":Ys,w.className="field",w.style.fontSize="1em";const T=Nn.finalSetFormat?.tiebreakSet?.tiebreakTo&&!Nn.finalSetFormat?.setTo,S=document.createElement("input");S.className=o,S.name="finalSetTiebreak",S.id="finalSetTiebreak",S.type="checkbox",S.checked=Nn.finalSetFormat?!!Nn.finalSetFormat.tiebreakFormat:!!Nn.setFormat.tiebreakFormat,S.style.display=T?Ys:"",w.onchange=M=>{const A=M.target.checked;AS.filter(({tb:N})=>N).forEach(N=>{const k=document.getElementById(`${N.id}-1`);if(k.style.display===Ys&&A){const{prefix:x="",suffix:O="",pluralize:V,defaultValue:F}=N,j=Nn.bestOf,q=V&&j>1?"s":"";k.innerHTML=`${x}${F}${q}${O}${ih}`}k.style.display=A?"":Ys}),ld()},w.appendChild(S);const D=document.createElement("label");D.setAttribute("for","finalSetTiebreak"),D.id="finalSetTiebreakToggle",D.innerHTML="Tiebreak",D.style.marginRight="1em",D.style.display=T?Ys:"",w.appendChild(D),l.appendChild(w);const C={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},E=r?.fontSize||r?.style?.fontSize||C.fontSize,P={...C,...r,fontSize:E,style:{...C.style,...i?.style||{},...r?.style||{}}},R=GT.open({title:"Score format",content:l,buttons:s,config:P});return setTimeout(()=>{if(Nn.finalSetFormat?.tiebreakSet?.tiebreakTo&&!Nn.finalSetFormat?.setTo){const A=document.getElementById("what-1");A&&(A.innerHTML=`${KS}${ih}`),RE.changeWhat(new Event("click"),1,KS)}const M=document.querySelector(".modal.is-active");if(M){const A=new MutationObserver(N=>{N.forEach(k=>{k.removedNodes.forEach(x=>{x===M&&(ZS(),A.disconnect())})})});A.observe(document.body,{childList:!0})}},0),R}function iYe({index:t,finalSetLabel:e,label:i,prefix:r="",suffix:n="",value:a,pluralize:s}){const o=!t&&s&&(Ps.setFormat.bestOf||1)>1?"s":"";return i||t&&e||`${r}${a}${o}${n}${ih}`}function VX(t){const{id:e,initiallyHidden:i,index:r,value:n}=t,a=document.createElement("button");return a.className="mfcButton",a.id=r?`${e}-${r}`:e,a.innerHTML=iYe(t),a.onclick=s=>rYe({e:s,button:a,...t}),a.style.display=n||t.label?"":Ys,i&&(a.style.display=Ys),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="inherit",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}function rYe(t){const{e,id:i,button:r,pluralize:n,options:a,onChange:s,onChangeCallback:o,index:l,prefix:c="",suffix:u=""}=t,d=Ps.setFormat.bestOf||1,p=!l&&n&&d>1?"s":"",h=(qN(a)?a(l):a).map(f=>({text:`${f}${p}`,onClick:()=>{r.innerHTML=`${c}${f}${p}${u}${ih}`,s&&qN(RE[s])&&RE[s](e,l,f),o&&qN(RE[o])&&RE[o](e,l,f),Ps[l?"finalSetFormat":"setFormat"][i]=f,ld()}}));nYe(e,h)}let ME=null,cP=null;function ZS(){ME&&document.body.contains(ME)&&ME.remove(),cP&&(document.removeEventListener("click",cP),cP=null),ME=null}function nYe(t,e){ZS();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const r=document.createElement("div");r.className="dropdown-menu",r.style.backgroundColor="white",r.style.border="1px solid #ddd",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{ZS()};e.forEach(s=>{const o=document.createElement("div");o.style.padding="0.5em 1em",o.style.cursor="pointer",o.style.backgroundColor="white",o.style.color="#363636",o.style.fontSize="1rem",o.style.lineHeight="1.5",o.textContent=s.text,o.onclick=l=>{l.preventDefault(),l.stopPropagation(),n(),setTimeout(()=>{s.onClick()},0)},o.onmouseenter=()=>{o.style.backgroundColor="#f5f5f5",o.style.color="#363636"},o.onmouseleave=()=>{o.style.backgroundColor="white",o.style.color="#363636"},r.appendChild(o)}),i.appendChild(r);const a=t.target.getBoundingClientRect();i.style.left=`${a.left}px`,i.style.top=`${a.bottom}px`,document.body.appendChild(i),ME=i,setTimeout(()=>{cP=s=>{i.contains(s.target)||n()},document.addEventListener("click",cP)},100)}function CUe(){return"0.8.11"}var jX={exports:{}},GX;function aYe(){return GX||(GX=1,(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},r(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected||p===9&&u.selected&&u.tabSelect?(d.preventDefault(),u.select(void 0,void 0,d)):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];n.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||c.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function r(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var n=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function s(l,c){return n.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function o(){s("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)),e.$=a,e.$$=s,t.exports&&(t.exports=e),e})()})(jX)),jX.exports}aYe();function $_(t,e,i={},r=0,n=""){const a=Object.keys(i).reduce((o,l)=>{let c=i[l];return typeof c=="function"&&(c=c(r)),`${o} ${l}="${c}"`},t);n+=`<${a}></${t}>`;const s=r+1;return s<e?$_(t,e,i,s,n):n}function F8(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}document.createRange();if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let r;return e.parentNode?r=e.parentNode:e.host?r=e.host:e.defaultView&&(r=e.defaultView),r?t(r,i):i};Event.prototype.composedPath=function(){return t(this.target)}}const HX=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join("");F8(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${HX(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${HX(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`);F8(`<div class="days">
  <div class="days-of-week">${$_("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${$_("span",42)}</div>
</div>`);F8(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${$_("span",6,{class:"week"})}</div>
</div>`);["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{});const ZF=Object.freeze(Object.defineProperty({__proto__:null,cModal:GT,compositions:$C,courthiveComponentsVersion:CUe,getMatchUpFormatModal:KF,renderContainer:TUe,renderMatchUp:Hw,renderParticipant:L8,renderRound:wUe,renderRoundHeader:gUe,renderStructure:SUe},Symbol.toStringTag,{value:"Module"}));function pU(){GT.close()}function Kr(t){const{title:e,content:i,buttons:r,footer:n,onClose:a,config:s}=t,l=s||{padding:!e&&!r?"":".5",maxWidth:500};return GT.open({title:e,content:i,footer:n,buttons:r,config:l,onClose:a})}async function sYe({callback:t}){const e={providerId:""},r=(await oC()).data?.providers,n=r.map(({value:u})=>({label:u.organisationName,value:u.organisationId})),a=r.map(({value:u})=>u.organisationName),s=()=>{const u=r.find(({value:d})=>d.organisationId===e.providerId)?.value;u&&Pt(t)&&t(u)},o=u=>{const d=u.target.value,p=d===""||a.includes(d),h=document.getElementById("selectButton");h.disabled=!p,e.providerId=p?d:""},l=u=>{const d=document.getElementById("selectButton");e.providerId=u,d.disabled=!u};Kr({title:"Select provider",content:u=>{pn(u,[{typeAhead:{list:n,callback:l},placeholder:"Type provider name",label:"Provider",field:"provider",width:"100%",onInput:o}])},buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:s,intent:"is-primary",id:"selectButton",label:"Select",disabled:!0,close:!0}]})}var WN={exports:{}},oYe=WN.exports,zX;function lYe(){return zX||(zX=1,(function(t,e){(function(i,r){t.exports=r()})(oYe,function(){var i=function(B,G){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,ee){X.__proto__=ee}||function(X,ee){for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(X[ae]=ee[ae])})(B,G)},r=function(){return(r=Object.assign||function(B){for(var G,X=1,ee=arguments.length;X<ee;X++)for(var ae in G=arguments[X])Object.prototype.hasOwnProperty.call(G,ae)&&(B[ae]=G[ae]);return B}).apply(this,arguments)};function n(B,G,X){for(var ee,ae=0,de=G.length;ae<de;ae++)!ee&&ae in G||((ee=ee||Array.prototype.slice.call(G,0,ae))[ae]=G[ae]);return B.concat(ee||Array.prototype.slice.call(G))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Qm,s=Object.keys,o=Array.isArray;function l(B,G){return typeof G!="object"||s(G).forEach(function(X){B[X]=G[X]}),B}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function d(B,G){return u.call(B,G)}function p(B,G){typeof G=="function"&&(G=G(c(B))),(typeof Reflect>"u"?s:Reflect.ownKeys)(G).forEach(function(X){f(B,X,G[X])})}var h=Object.defineProperty;function f(B,G,X,ee){h(B,G,l(X&&d(X,"get")&&typeof X.get=="function"?{get:X.get,set:X.set,configurable:!0}:{value:X,configurable:!0,writable:!0},ee))}function m(B){return{from:function(G){return B.prototype=Object.create(G.prototype),f(B.prototype,"constructor",B),{extend:p.bind(null,B.prototype)}}}}var g=Object.getOwnPropertyDescriptor,v=[].slice;function y(B,G,X){return v.call(B,G,X)}function b(B,G){return G(B)}function I(B){if(!B)throw new Error("Assertion Failed")}function w(B){a.setImmediate?setImmediate(B):setTimeout(B,0)}function T(B,G){if(typeof G=="string"&&d(B,G))return B[G];if(!G)return B;if(typeof G!="string"){for(var X=[],ee=0,ae=G.length;ee<ae;++ee){var de=T(B,G[ee]);X.push(de)}return X}var ge=G.indexOf(".");if(ge!==-1){var ye=B[G.substr(0,ge)];return ye==null?void 0:T(ye,G.substr(ge+1))}}function S(B,G,X){if(B&&G!==void 0&&!("isFrozen"in Object&&Object.isFrozen(B)))if(typeof G!="string"&&"length"in G){I(typeof X!="string"&&"length"in X);for(var ee=0,ae=G.length;ee<ae;++ee)S(B,G[ee],X[ee])}else{var de,ge,ye=G.indexOf(".");ye!==-1?(de=G.substr(0,ye),(ge=G.substr(ye+1))===""?X===void 0?o(B)&&!isNaN(parseInt(de))?B.splice(de,1):delete B[de]:B[de]=X:S(ye=!(ye=B[de])||!d(B,de)?B[de]={}:ye,ge,X)):X===void 0?o(B)&&!isNaN(parseInt(G))?B.splice(G,1):delete B[G]:B[G]=X}}function D(B){var G,X={};for(G in B)d(B,G)&&(X[G]=B[G]);return X}var C=[].concat;function E(B){return C.apply([],B)}var ut="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(E([8,16,32,64].map(function(B){return["Int","Uint","Float"].map(function(G){return G+B+"Array"})}))).filter(function(B){return a[B]}),P=new Set(ut.map(function(B){return a[B]})),R=null;function M(B){return R=new WeakMap,B=(function G(X){if(!X||typeof X!="object")return X;var ee=R.get(X);if(ee)return ee;if(o(X)){ee=[],R.set(X,ee);for(var ae=0,de=X.length;ae<de;++ae)ee.push(G(X[ae]))}else if(P.has(X.constructor))ee=X;else{var ge,ye=c(X);for(ge in ee=ye===Object.prototype?{}:Object.create(ye),R.set(X,ee),X)d(X,ge)&&(ee[ge]=G(X[ge]))}return ee})(B),R=null,B}var A={}.toString;function N(B){return A.call(B).slice(8,-1)}var k=typeof Symbol<"u"?Symbol.iterator:"@@iterator",x=typeof k=="symbol"?function(B){var G;return B!=null&&(G=B[k])&&G.apply(B)}:function(){return null};function O(B,G){return G=B.indexOf(G),0<=G&&B.splice(G,1),0<=G}var V={};function F(B){var G,X,ee,ae;if(arguments.length===1){if(o(B))return B.slice();if(this===V&&typeof B=="string")return[B];if(ae=x(B)){for(X=[];!(ee=ae.next()).done;)X.push(ee.value);return X}if(B==null)return[B];if(typeof(G=B.length)!="number")return[B];for(X=new Array(G);G--;)X[G]=B[G];return X}for(G=arguments.length,X=new Array(G);G--;)X[G]=arguments[G];return X}var j=typeof Symbol<"u"?function(B){return B[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Be=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],mu=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Be),q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(B,G){this.name=B,this.message=G}function z(B,G){return B+". Errors: "+Object.keys(G).map(function(X){return G[X].toString()}).filter(function(X,ee,ae){return ae.indexOf(X)===ee}).join(`
`)}function H(B,G,X,ee){this.failures=G,this.failedKeys=ee,this.successCount=X,this.message=z(B,G)}function Z(B,G){this.name="BulkError",this.failures=Object.keys(G).map(function(X){return G[X]}),this.failuresByPos=G,this.message=z(B,this.failures)}m(W).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(H).from(W),m(Z).from(W);var J=mu.reduce(function(B,G){return B[G]=G+"Error",B},{}),ie=W,K=mu.reduce(function(B,G){var X=G+"Error";function ee(ae,de){this.name=X,ae?typeof ae=="string"?(this.message="".concat(ae).concat(de?`
 `+de:""),this.inner=de||null):typeof ae=="object"&&(this.message="".concat(ae.name," ").concat(ae.message),this.inner=ae):(this.message=q[G]||X,this.inner=null)}return m(ee).from(ie),B[G]=ee,B},{});K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError;var ne=Be.reduce(function(B,G){return B[G+"Error"]=K[G],B},{}),le=mu.reduce(function(B,G){return["Syntax","Type","Range"].indexOf(G)===-1&&(B[G+"Error"]=K[G]),B},{});function re(){}function me(B){return B}function he(B,G){return B==null||B===me?G:function(X){return G(B(X))}}function Ie(B,G){return function(){B.apply(this,arguments),G.apply(this,arguments)}}function Le(B,G){return B===re?G:function(){var X=B.apply(this,arguments);X!==void 0&&(arguments[0]=X);var ee=this.onsuccess,ae=this.onerror;this.onsuccess=null,this.onerror=null;var de=G.apply(this,arguments);return ee&&(this.onsuccess=this.onsuccess?Ie(ee,this.onsuccess):ee),ae&&(this.onerror=this.onerror?Ie(ae,this.onerror):ae),de!==void 0?de:X}}function ot(B,G){return B===re?G:function(){B.apply(this,arguments);var X=this.onsuccess,ee=this.onerror;this.onsuccess=this.onerror=null,G.apply(this,arguments),X&&(this.onsuccess=this.onsuccess?Ie(X,this.onsuccess):X),ee&&(this.onerror=this.onerror?Ie(ee,this.onerror):ee)}}function at(B,G){return B===re?G:function(X){var ee=B.apply(this,arguments);l(X,ee);var ae=this.onsuccess,de=this.onerror;return this.onsuccess=null,this.onerror=null,X=G.apply(this,arguments),ae&&(this.onsuccess=this.onsuccess?Ie(ae,this.onsuccess):ae),de&&(this.onerror=this.onerror?Ie(de,this.onerror):de),ee===void 0?X===void 0?void 0:X:l(ee,X)}}function dt(B,G){return B===re?G:function(){return G.apply(this,arguments)!==!1&&B.apply(this,arguments)}}function It(B,G){return B===re?G:function(){var X=B.apply(this,arguments);if(X&&typeof X.then=="function"){for(var ee=this,ae=arguments.length,de=new Array(ae);ae--;)de[ae]=arguments[ae];return X.then(function(){return G.apply(ee,de)})}return G.apply(this,arguments)}}le.ModifyError=H,le.DexieError=W,le.BulkError=Z;var ze=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ct(B){ze=B}var ke={},mt=100,ut=typeof Promise>"u"?[]:(function(){var B=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[B,c(B),B];var G=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[G,c(G),B]})(),Be=ut[0],mu=ut[1],ut=ut[2],mu=mu&&mu.then,it=Be&&Be.constructor,xe=!!ut,Ze=function(B,G){je.push([B,G]),qe&&(queueMicrotask(Vi),qe=!1)},st=!0,qe=!0,ft=[],_t=[],ve=me,$e={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:re,pgp:!1,env:{},finalize:re},De=$e,je=[],Oe=0,nt=[];function Fe(B){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var G=this._PSD=De;if(typeof B!="function"){if(B!==ke)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Mt(this,this._value))}this._state=null,this._value=null,++G.ref,(function X(ee,ae){try{ae(function(de){if(ee._state===null){if(de===ee)throw new TypeError("A promise cannot be resolved with itself.");var ge=ee._lib&&$i();de&&typeof de.then=="function"?X(ee,function(ye,Ee){de instanceof Fe?de._then(ye,Ee):de.then(ye,Ee)}):(ee._state=!0,ee._value=de,Wi(ee)),ge&&Wr()}},Mt.bind(null,ee))}catch(de){Mt(ee,de)}})(this,B)}var wt={get:function(){var B=De,G=Vl;function X(ee,ae){var de=this,ge=!B.global&&(B!==De||G!==Vl),ye=ge&&!zs(),Ee=new Fe(function(Pe,Ae){Qt(de,new pt(jp(ee,B,ge,ye),jp(ae,B,ge,ye),Pe,Ae,B))});return this._consoleTask&&(Ee._consoleTask=this._consoleTask),Ee}return X.prototype=ke,X},set:function(B){f(this,"then",B&&B.prototype===ke?wt:{get:function(){return B},set:wt.set})}};function pt(B,G,X,ee,ae){this.onFulfilled=typeof B=="function"?B:null,this.onRejected=typeof G=="function"?G:null,this.resolve=X,this.reject=ee,this.psd=ae}function Mt(B,G){var X,ee;_t.push(G),B._state===null&&(X=B._lib&&$i(),G=ve(G),B._state=!1,B._value=G,ee=B,ft.some(function(ae){return ae._value===ee._value})||ft.push(ee),Wi(B),X&&Wr())}function Wi(B){var G=B._listeners;B._listeners=[];for(var X=0,ee=G.length;X<ee;++X)Qt(B,G[X]);var ae=B._PSD;--ae.ref||ae.finalize(),Oe===0&&(++Oe,Ze(function(){--Oe==0&&Yn()},[]))}function Qt(B,G){if(B._state!==null){var X=B._state?G.onFulfilled:G.onRejected;if(X===null)return(B._state?G.resolve:G.reject)(B._value);++G.psd.ref,++Oe,Ze(tr,[X,B,G])}else B._listeners.push(G)}function tr(B,G,X){try{var ee,ae=G._value;!G._state&&_t.length&&(_t=[]),ee=ze&&G._consoleTask?G._consoleTask.run(function(){return B(ae)}):B(ae),G._state||_t.indexOf(ae)!==-1||(function(de){for(var ge=ft.length;ge;)if(ft[--ge]._value===de._value)return ft.splice(ge,1)})(G),X.resolve(ee)}catch(de){X.reject(de)}finally{--Oe==0&&Yn(),--X.psd.ref||X.psd.finalize()}}function Vi(){Sc($e,function(){$i()&&Wr()})}function $i(){var B=st;return qe=st=!1,B}function Wr(){var B,G,X;do for(;0<je.length;)for(B=je,je=[],X=B.length,G=0;G<X;++G){var ee=B[G];ee[0].apply(null,ee[1])}while(0<je.length);qe=st=!0}function Yn(){var B=ft;ft=[],B.forEach(function(ee){ee._PSD.onunhandled.call(null,ee._value,ee)});for(var G=nt.slice(0),X=G.length;X;)G[--X]()}function $l(B){return new Fe(ke,!1,B)}function tn(B,G){var X=De;return function(){var ee=$i(),ae=De;try{return jl(X,!0),B.apply(this,arguments)}catch(de){G&&G(de)}finally{jl(ae,!1),ee&&Wr()}}}p(Fe.prototype,{then:wt,_then:function(B,G){Qt(this,new pt(null,null,B,G,De))},catch:function(B){if(arguments.length===1)return this.then(null,B);var G=B,X=arguments[1];return typeof G=="function"?this.then(null,function(ee){return(ee instanceof G?X:$l)(ee)}):this.then(null,function(ee){return(ee&&ee.name===G?X:$l)(ee)})},finally:function(B){return this.then(function(G){return Fe.resolve(B()).then(function(){return G})},function(G){return Fe.resolve(B()).then(function(){return $l(G)})})},timeout:function(B,G){var X=this;return B<1/0?new Fe(function(ee,ae){var de=setTimeout(function(){return ae(new K.Timeout(G))},B);X.then(ee,ae).finally(clearTimeout.bind(null,de))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&f(Fe.prototype,Symbol.toStringTag,"Dexie.Promise"),$e.env=cf(),p(Fe,{all:function(){var B=F.apply(null,arguments).map(yn);return new Fe(function(G,X){B.length===0&&G([]);var ee=B.length;B.forEach(function(ae,de){return Fe.resolve(ae).then(function(ge){B[de]=ge,--ee||G(B)},X)})})},resolve:function(B){return B instanceof Fe?B:B&&typeof B.then=="function"?new Fe(function(G,X){B.then(G,X)}):new Fe(ke,!0,B)},reject:$l,race:function(){var B=F.apply(null,arguments).map(yn);return new Fe(function(G,X){B.map(function(ee){return Fe.resolve(ee).then(G,X)})})},PSD:{get:function(){return De},set:function(B){return De=B}},totalEchoes:{get:function(){return Vl}},newPSD:Uo,usePSD:Sc,scheduler:{get:function(){return Ze},set:function(B){Ze=B}},rejectionMapper:{get:function(){return ve},set:function(B){ve=B}},follow:function(B,G){return new Fe(function(X,ee){return Uo(function(ae,de){var ge=De;ge.unhandleds=[],ge.onunhandled=de,ge.finalize=Ie(function(){var ye,Ee=this;ye=function(){Ee.unhandleds.length===0?ae():de(Ee.unhandleds[0])},nt.push(function Pe(){ye(),nt.splice(nt.indexOf(Pe),1)}),++Oe,Ze(function(){--Oe==0&&Yn()},[])},ge.finalize),B()},G,X,ee)})}}),it&&(it.allSettled&&f(Fe,"allSettled",function(){var B=F.apply(null,arguments).map(yn);return new Fe(function(G){B.length===0&&G([]);var X=B.length,ee=new Array(X);B.forEach(function(ae,de){return Fe.resolve(ae).then(function(ge){return ee[de]={status:"fulfilled",value:ge}},function(ge){return ee[de]={status:"rejected",reason:ge}}).then(function(){return--X||G(ee)})})})}),it.any&&typeof AggregateError<"u"&&f(Fe,"any",function(){var B=F.apply(null,arguments).map(yn);return new Fe(function(G,X){B.length===0&&X(new AggregateError([]));var ee=B.length,ae=new Array(ee);B.forEach(function(de,ge){return Fe.resolve(de).then(function(ye){return G(ye)},function(ye){ae[ge]=ye,--ee||X(new AggregateError(ae))})})})}),it.withResolvers&&(Fe.withResolvers=it.withResolvers));var rn={awaits:0,echoes:0,id:0},ha=0,Jt=[],sr=0,Vl=0,nd=0;function Uo(B,G,X,ee){var ae=De,de=Object.create(ae);return de.parent=ae,de.ref=0,de.global=!1,de.id=++nd,$e.env,de.env=xe?{Promise:Fe,PromiseProp:{value:Fe,configurable:!0,writable:!0},all:Fe.all,race:Fe.race,allSettled:Fe.allSettled,any:Fe.any,resolve:Fe.resolve,reject:Fe.reject}:{},G&&l(de,G),++ae.ref,de.finalize=function(){--this.parent.ref||this.parent.finalize()},ee=Sc(de,B,X,ee),de.ref===0&&de.finalize(),ee}function Hs(){return rn.id||(rn.id=++ha),++rn.awaits,rn.echoes+=mt,rn.id}function zs(){return!!rn.awaits&&(--rn.awaits==0&&(rn.id=0),rn.echoes=rn.awaits*mt,!0)}function yn(B){return rn.echoes&&B&&B.constructor===it?(Hs(),B.then(function(G){return zs(),G},function(G){return zs(),$n(G)})):B}function wc(){var B=Jt[Jt.length-1];Jt.pop(),jl(B,!1)}function jl(B,G){var X,ee=De;(G?!rn.echoes||sr++&&B===De:!sr||--sr&&B===De)||queueMicrotask(G?(function(ae){++Vl,rn.echoes&&--rn.echoes!=0||(rn.echoes=rn.awaits=rn.id=0),Jt.push(De),jl(ae,!0)}).bind(null,B):wc),B!==De&&(De=B,ee===$e&&($e.env=cf()),xe&&(X=$e.env.Promise,G=B.env,(ee.global||B.global)&&(Object.defineProperty(a,"Promise",G.PromiseProp),X.all=G.all,X.race=G.race,X.resolve=G.resolve,X.reject=G.reject,G.allSettled&&(X.allSettled=G.allSettled),G.any&&(X.any=G.any))))}function cf(){var B=a.Promise;return xe?{Promise:B,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{}}function Sc(B,G,X,ee,ae){var de=De;try{return jl(B,!0),G(X,ee,ae)}finally{jl(de,!1)}}function jp(B,G,X,ee){return typeof B!="function"?B:function(){var ae=De;X&&Hs(),jl(G,!0);try{return B.apply(this,arguments)}finally{jl(ae,!1),ee&&queueMicrotask(zs)}}}function fa(B){Promise===it&&rn.echoes===0?sr===0?B():enqueueNativeMicroTask(B):setTimeout(B,0)}(""+mu).indexOf("[native code]")===-1&&(Hs=zs=re);var $n=Fe.reject,$o="",cl="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",uf="String expected.",Gl=[],Hl="__dbnames",Od="readonly",zl="readwrite";function ma(B,G){return B?G?function(){return B.apply(this,arguments)&&G.apply(this,arguments)}:B:G}var ou={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function lu(B){return typeof B!="string"||/\./.test(B)?function(G){return G}:function(G){return G[B]===void 0&&B in G&&delete(G=M(G))[B],G}}function Tc(){throw K.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Kt(B,G){try{var X=Mn(B),ee=Mn(G);if(X!==ee)return X==="Array"?1:ee==="Array"?-1:X==="binary"?1:ee==="binary"?-1:X==="string"?1:ee==="string"?-1:X==="Date"?1:ee!=="Date"?NaN:-1;switch(X){case"number":case"Date":case"string":return G<B?1:B<G?-1:0;case"binary":return(function(ae,de){for(var ge=ae.length,ye=de.length,Ee=ge<ye?ge:ye,Pe=0;Pe<Ee;++Pe)if(ae[Pe]!==de[Pe])return ae[Pe]<de[Pe]?-1:1;return ge===ye?0:ge<ye?-1:1})(ul(B),ul(G));case"Array":return(function(ae,de){for(var ge=ae.length,ye=de.length,Ee=ge<ye?ge:ye,Pe=0;Pe<Ee;++Pe){var Ae=Kt(ae[Pe],de[Pe]);if(Ae!==0)return Ae}return ge===ye?0:ge<ye?-1:1})(B,G)}}catch{}return NaN}function Mn(B){var G=typeof B;return G!="object"?G:ArrayBuffer.isView(B)?"binary":(B=N(B),B==="ArrayBuffer"?"binary":B)}function ul(B){return B instanceof Uint8Array?B:ArrayBuffer.isView(B)?new Uint8Array(B.buffer,B.byteOffset,B.byteLength):new Uint8Array(B)}function ns(B,G,X){var ee=B.schema.yProps;return ee?(G&&0<X.numFailures&&(G=G.filter(function(ae,de){return!X.failures[de]})),Promise.all(ee.map(function(ae){return ae=ae.updatesTable,G?B.db.table(ae).where("k").anyOf(G).delete():B.db.table(ae).clear()})).then(function(){return X})):X}var to=(Ts.prototype.execute=function(B){var G=this["@@propmod"];if(G.add!==void 0){var X=G.add;if(o(X))return n(n([],o(B)?B:[],!0),X).sort();if(typeof X=="number")return(Number(B)||0)+X;if(typeof X=="bigint")try{return BigInt(B)+X}catch{return BigInt(0)+X}throw new TypeError("Invalid term ".concat(X))}if(G.remove!==void 0){var ee=G.remove;if(o(ee))return o(B)?B.filter(function(ae){return!ee.includes(ae)}).sort():[];if(typeof ee=="number")return Number(B)-ee;if(typeof ee=="bigint")try{return BigInt(B)-ee}catch{return BigInt(0)-ee}throw new TypeError("Invalid subtrahend ".concat(ee))}return X=(X=G.replacePrefix)===null||X===void 0?void 0:X[0],X&&typeof B=="string"&&B.startsWith(X)?G.replacePrefix[1]+B.substring(X.length):B},Ts);function Ts(B){this["@@propmod"]=B}function ki(B,G){for(var X=s(G),ee=X.length,ae=!1,de=0;de<ee;++de){var ge=X[de],ye=G[ge],Ee=T(B,ge);ye instanceof to?(S(B,ge,ye.execute(Ee)),ae=!0):Ee!==ye&&(S(B,ge,ye),ae=!0)}return ae}var fn=(Zr.prototype._trans=function(B,G,X){var ee=this._tx||De.trans,ae=this.name,de=ze&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(B==="readonly"?"read":"write"," ").concat(this.name));function ge(Pe,Ae,Te){if(!Te.schema[ae])throw new K.NotFound("Table "+ae+" not part of transaction");return G(Te.idbtrans,Te)}var ye=$i();try{var Ee=ee&&ee.db._novip===this.db._novip?ee===De.trans?ee._promise(B,ge,X):Uo(function(){return ee._promise(B,ge,X)},{trans:ee,transless:De.transless||De}):(function Pe(Ae,Te,_e,Ce){if(Ae.idbdb&&(Ae._state.openComplete||De.letThrough||Ae._vip)){var Re=Ae._createTransaction(Te,_e,Ae._dbSchema);try{Re.create(),Ae._state.PR1398_maxLoop=3}catch(Me){return Me.name===J.InvalidState&&Ae.isOpen()&&0<--Ae._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ae.close({disableAutoOpen:!1}),Ae.open().then(function(){return Pe(Ae,Te,_e,Ce)})):$n(Me)}return Re._promise(Te,function(Me,Ne){return Uo(function(){return De.trans=Re,Ce(Me,Ne,Re)})}).then(function(Me){if(Te==="readwrite")try{Re.idbtrans.commit()}catch{}return Te==="readonly"?Me:Re._completion.then(function(){return Me})})}if(Ae._state.openComplete)return $n(new K.DatabaseClosed(Ae._state.dbOpenError));if(!Ae._state.isBeingOpened){if(!Ae._state.autoOpen)return $n(new K.DatabaseClosed);Ae.open().catch(re)}return Ae._state.dbReadyPromise.then(function(){return Pe(Ae,Te,_e,Ce)})})(this.db,B,[this.name],ge);return de&&(Ee._consoleTask=de,Ee=Ee.catch(function(Pe){return console.trace(Pe),$n(Pe)})),Ee}finally{ye&&Wr()}},Zr.prototype.get=function(B,G){var X=this;return B&&B.constructor===Object?this.where(B).first(G):B==null?$n(new K.Type("Invalid argument to Table.get()")):this._trans("readonly",function(ee){return X.core.get({trans:ee,key:B}).then(function(ae){return X.hook.reading.fire(ae)})}).then(G)},Zr.prototype.where=function(B){if(typeof B=="string")return new this.db.WhereClause(this,B);if(o(B))return new this.db.WhereClause(this,"[".concat(B.join("+"),"]"));var G=s(B);if(G.length===1)return this.where(G[0]).equals(B[G[0]]);var X=this.schema.indexes.concat(this.schema.primKey).filter(function(ye){if(ye.compound&&G.every(function(Pe){return 0<=ye.keyPath.indexOf(Pe)})){for(var Ee=0;Ee<G.length;++Ee)if(G.indexOf(ye.keyPath[Ee])===-1)return!1;return!0}return!1}).sort(function(ye,Ee){return ye.keyPath.length-Ee.keyPath.length})[0];if(X&&this.db._maxKey!==$o){var de=X.keyPath.slice(0,G.length);return this.where(de).equals(de.map(function(Ee){return B[Ee]}))}!X&&ze&&console.warn("The query ".concat(JSON.stringify(B)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(G.join("+"),"]"));var ee=this.schema.idxByName;function ae(ye,Ee){return Kt(ye,Ee)===0}var ge=G.reduce(function(Te,Ee){var Pe=Te[0],Ae=Te[1],Te=ee[Ee],_e=B[Ee];return[Pe||Te,Pe||!Te?ma(Ae,Te&&Te.multi?function(Ce){return Ce=T(Ce,Ee),o(Ce)&&Ce.some(function(Re){return ae(_e,Re)})}:function(Ce){return ae(_e,T(Ce,Ee))}):Ae]},[null,null]),de=ge[0],ge=ge[1];return de?this.where(de.name).equals(B[de.keyPath]).filter(ge):X?this.filter(ge):this.where(G).equals("")},Zr.prototype.filter=function(B){return this.toCollection().and(B)},Zr.prototype.count=function(B){return this.toCollection().count(B)},Zr.prototype.offset=function(B){return this.toCollection().offset(B)},Zr.prototype.limit=function(B){return this.toCollection().limit(B)},Zr.prototype.each=function(B){return this.toCollection().each(B)},Zr.prototype.toArray=function(B){return this.toCollection().toArray(B)},Zr.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Zr.prototype.orderBy=function(B){return new this.db.Collection(new this.db.WhereClause(this,o(B)?"[".concat(B.join("+"),"]"):B))},Zr.prototype.reverse=function(){return this.toCollection().reverse()},Zr.prototype.mapToClass=function(B){var G,X=this.db,ee=this.name;function ae(){return G!==null&&G.apply(this,arguments)||this}(this.schema.mappedClass=B).prototype instanceof Tc&&((function(Ee,Pe){if(typeof Pe!="function"&&Pe!==null)throw new TypeError("Class extends value "+String(Pe)+" is not a constructor or null");function Ae(){this.constructor=Ee}i(Ee,Pe),Ee.prototype=Pe===null?Object.create(Pe):(Ae.prototype=Pe.prototype,new Ae)})(ae,G=B),Object.defineProperty(ae.prototype,"db",{get:function(){return X},enumerable:!1,configurable:!0}),ae.prototype.table=function(){return ee},B=ae);for(var de=new Set,ge=B.prototype;ge;ge=c(ge))Object.getOwnPropertyNames(ge).forEach(function(Ee){return de.add(Ee)});function ye(Ee){if(!Ee)return Ee;var Pe,Ae=Object.create(B.prototype);for(Pe in Ee)if(!de.has(Pe))try{Ae[Pe]=Ee[Pe]}catch{}return Ae}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=ye,this.hook("reading",ye),B},Zr.prototype.defineClass=function(){return this.mapToClass(function(B){l(this,B)})},Zr.prototype.add=function(B,G){var X=this,ee=this.schema.primKey,ae=ee.auto,de=ee.keyPath,ge=B;return de&&ae&&(ge=lu(de)(B)),this._trans("readwrite",function(ye){return X.core.mutate({trans:ye,type:"add",keys:G!=null?[G]:null,values:[ge]})}).then(function(ye){return ye.numFailures?Fe.reject(ye.failures[0]):ye.lastResult}).then(function(ye){if(de)try{S(B,de,ye)}catch{}return ye})},Zr.prototype.upsert=function(B,G){var X=this,ee=this.schema.primKey.keyPath;return this._trans("readwrite",function(ae){return X.core.get({trans:ae,key:B}).then(function(de){var ge=de??{};return ki(ge,G),ee&&S(ge,ee,B),X.core.mutate({trans:ae,type:"put",values:[ge],keys:[B],upsert:!0,updates:{keys:[B],changeSpecs:[G]}}).then(function(ye){return ye.numFailures?Fe.reject(ye.failures[0]):!!de})})})},Zr.prototype.update=function(B,G){return typeof B!="object"||o(B)?this.where(":id").equals(B).modify(G):(B=T(B,this.schema.primKey.keyPath),B===void 0?$n(new K.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(B).modify(G))},Zr.prototype.put=function(B,G){var X=this,ee=this.schema.primKey,ae=ee.auto,de=ee.keyPath,ge=B;return de&&ae&&(ge=lu(de)(B)),this._trans("readwrite",function(ye){return X.core.mutate({trans:ye,type:"put",values:[ge],keys:G!=null?[G]:null})}).then(function(ye){return ye.numFailures?Fe.reject(ye.failures[0]):ye.lastResult}).then(function(ye){if(de)try{S(B,de,ye)}catch{}return ye})},Zr.prototype.delete=function(B){var G=this;return this._trans("readwrite",function(X){return G.core.mutate({trans:X,type:"delete",keys:[B]}).then(function(ee){return ns(G,[B],ee)}).then(function(ee){return ee.numFailures?Fe.reject(ee.failures[0]):void 0})})},Zr.prototype.clear=function(){var B=this;return this._trans("readwrite",function(G){return B.core.mutate({trans:G,type:"deleteRange",range:ou}).then(function(X){return ns(B,null,X)})}).then(function(G){return G.numFailures?Fe.reject(G.failures[0]):void 0})},Zr.prototype.bulkGet=function(B){var G=this;return this._trans("readonly",function(X){return G.core.getMany({keys:B,trans:X}).then(function(ee){return ee.map(function(ae){return G.hook.reading.fire(ae)})})})},Zr.prototype.bulkAdd=function(B,G,X){var ee=this,ae=Array.isArray(G)?G:void 0,de=(X=X||(ae?void 0:G))?X.allKeys:void 0;return this._trans("readwrite",function(ge){var Pe=ee.schema.primKey,ye=Pe.auto,Pe=Pe.keyPath;if(Pe&&ae)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==B.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var Ee=B.length,Pe=Pe&&ye?B.map(lu(Pe)):B;return ee.core.mutate({trans:ge,type:"add",keys:ae,values:Pe,wantResults:de}).then(function(Re){var Te=Re.numFailures,_e=Re.results,Ce=Re.lastResult,Re=Re.failures;if(Te===0)return de?_e:Ce;throw new Z("".concat(ee.name,".bulkAdd(): ").concat(Te," of ").concat(Ee," operations failed"),Re)})})},Zr.prototype.bulkPut=function(B,G,X){var ee=this,ae=Array.isArray(G)?G:void 0,de=(X=X||(ae?void 0:G))?X.allKeys:void 0;return this._trans("readwrite",function(ge){var Pe=ee.schema.primKey,ye=Pe.auto,Pe=Pe.keyPath;if(Pe&&ae)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(ae&&ae.length!==B.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var Ee=B.length,Pe=Pe&&ye?B.map(lu(Pe)):B;return ee.core.mutate({trans:ge,type:"put",keys:ae,values:Pe,wantResults:de}).then(function(Re){var Te=Re.numFailures,_e=Re.results,Ce=Re.lastResult,Re=Re.failures;if(Te===0)return de?_e:Ce;throw new Z("".concat(ee.name,".bulkPut(): ").concat(Te," of ").concat(Ee," operations failed"),Re)})})},Zr.prototype.bulkUpdate=function(B){var G=this,X=this.core,ee=B.map(function(ge){return ge.key}),ae=B.map(function(ge){return ge.changes}),de=[];return this._trans("readwrite",function(ge){return X.getMany({trans:ge,keys:ee,cache:"clone"}).then(function(ye){var Ee=[],Pe=[];B.forEach(function(Te,_e){var Ce=Te.key,Re=Te.changes,Me=ye[_e];if(Me){for(var Ne=0,Ve=Object.keys(Re);Ne<Ve.length;Ne++){var He=Ve[Ne],rt=Re[He];if(He===G.schema.primKey.keyPath){if(Kt(rt,Ce)!==0)throw new K.Constraint("Cannot update primary key in bulkUpdate()")}else S(Me,He,rt)}de.push(_e),Ee.push(Ce),Pe.push(Me)}});var Ae=Ee.length;return X.mutate({trans:ge,type:"put",keys:Ee,values:Pe,updates:{keys:ee,changeSpecs:ae}}).then(function(Te){var _e=Te.numFailures,Ce=Te.failures;if(_e===0)return Ae;for(var Re=0,Me=Object.keys(Ce);Re<Me.length;Re++){var Ne,Ve=Me[Re],He=de[Number(Ve)];He!=null&&(Ne=Ce[Ve],delete Ce[Ve],Ce[He]=Ne)}throw new Z("".concat(G.name,".bulkUpdate(): ").concat(_e," of ").concat(Ae," operations failed"),Ce)})})})},Zr.prototype.bulkDelete=function(B){var G=this,X=B.length;return this._trans("readwrite",function(ee){return G.core.mutate({trans:ee,type:"delete",keys:B}).then(function(ae){return ns(G,B,ae)})}).then(function(ge){var ae=ge.numFailures,de=ge.lastResult,ge=ge.failures;if(ae===0)return de;throw new Z("".concat(G.name,".bulkDelete(): ").concat(ae," of ").concat(X," operations failed"),ge)})},Zr);function Zr(){}function ql(B){function G(ge,ye){if(ye){for(var Ee=arguments.length,Pe=new Array(Ee-1);--Ee;)Pe[Ee-1]=arguments[Ee];return X[ge].subscribe.apply(null,Pe),B}if(typeof ge=="string")return X[ge]}var X={};G.addEventType=de;for(var ee=1,ae=arguments.length;ee<ae;++ee)de(arguments[ee]);return G;function de(ge,ye,Ee){if(typeof ge!="object"){var Pe;ye=ye||dt;var Ae={subscribers:[],fire:Ee=Ee||re,subscribe:function(Te){Ae.subscribers.indexOf(Te)===-1&&(Ae.subscribers.push(Te),Ae.fire=ye(Ae.fire,Te))},unsubscribe:function(Te){Ae.subscribers=Ae.subscribers.filter(function(_e){return _e!==Te}),Ae.fire=Ae.subscribers.reduce(ye,Ee)}};return X[ge]=G[ge]=Ae}s(Pe=ge).forEach(function(Te){var _e=Pe[Te];if(o(_e))de(Te,Pe[Te][0],Pe[Te][1]);else{if(_e!=="asap")throw new K.InvalidArgument("Invalid event config");var Ce=de(Te,me,function(){for(var Re=arguments.length,Me=new Array(Re);Re--;)Me[Re]=arguments[Re];Ce.subscribers.forEach(function(Ne){w(function(){Ne.apply(null,Me)})})})}})}}function Ya(B,G){return m(G).from({prototype:B}),G}function ad(B,G){return!(B.filter||B.algorithm||B.or)&&(G?B.justLimit:!B.replayFilter)}function Xe(B,G){B.filter=ma(B.filter,G)}function di(B,G,X){var ee=B.replayFilter;B.replayFilter=ee?function(){return ma(ee(),G())}:G,B.justLimit=X&&!ee}function Ri(B,G){if(B.isPrimKey)return G.primaryKey;var X=G.getIndexByKeyPath(B.index);if(!X)throw new K.Schema("KeyPath "+B.index+" on object store "+G.name+" is not indexed");return X}function Mi(B,G,X){var ee=Ri(B,G.schema);return G.openCursor({trans:X,values:!B.keysOnly,reverse:B.dir==="prev",unique:!!B.unique,query:{index:ee,range:B.range}})}function mn(B,G,X,ee){var ae=B.replayFilter?ma(B.filter,B.replayFilter()):B.filter;if(B.or){var de={},ge=function(ye,Ee,Pe){var Ae,Te;ae&&!ae(Ee,Pe,function(_e){return Ee.stop(_e)},function(_e){return Ee.fail(_e)})||((Te=""+(Ae=Ee.primaryKey))=="[object ArrayBuffer]"&&(Te=""+new Uint8Array(Ae)),d(de,Te)||(de[Te]=!0,G(ye,Ee,Pe)))};return Promise.all([B.or._iterate(ge,X),Ma(Mi(B,ee,X),B.algorithm,ge,!B.keysOnly&&B.valueMapper)])}return Ma(Mi(B,ee,X),ma(B.algorithm,ae),G,!B.keysOnly&&B.valueMapper)}function Ma(B,G,X,ee){var ae=tn(ee?function(de,ge,ye){return X(ee(de),ge,ye)}:X);return B.then(function(de){if(de)return de.start(function(){var ge=function(){return de.continue()};G&&!G(de,function(ye){return ge=ye},function(ye){de.stop(ye),ge=re},function(ye){de.fail(ye),ge=re})||ae(de.value,de,function(ye){return ge=ye}),ge()})})}var Uc=(gr.prototype._read=function(B,G){var X=this._ctx;return X.error?X.table._trans(null,$n.bind(null,X.error)):X.table._trans("readonly",B).then(G)},gr.prototype._write=function(B){var G=this._ctx;return G.error?G.table._trans(null,$n.bind(null,G.error)):G.table._trans("readwrite",B,"locked")},gr.prototype._addAlgorithm=function(B){var G=this._ctx;G.algorithm=ma(G.algorithm,B)},gr.prototype._iterate=function(B,G){return mn(this._ctx,B,G,this._ctx.table.core)},gr.prototype.clone=function(B){var G=Object.create(this.constructor.prototype),X=Object.create(this._ctx);return B&&l(X,B),G._ctx=X,G},gr.prototype.raw=function(){return this._ctx.valueMapper=null,this},gr.prototype.each=function(B){var G=this._ctx;return this._read(function(X){return mn(G,B,X,G.table.core)})},gr.prototype.count=function(B){var G=this;return this._read(function(X){var ee=G._ctx,ae=ee.table.core;if(ad(ee,!0))return ae.count({trans:X,query:{index:Ri(ee,ae.schema),range:ee.range}}).then(function(ge){return Math.min(ge,ee.limit)});var de=0;return mn(ee,function(){return++de,!1},X,ae).then(function(){return de})}).then(B)},gr.prototype.sortBy=function(B,G){var X=B.split(".").reverse(),ee=X[0],ae=X.length-1;function de(Ee,Pe){return Pe?de(Ee[X[Pe]],Pe-1):Ee[ee]}var ge=this._ctx.dir==="next"?1:-1;function ye(Ee,Pe){return Kt(de(Ee,ae),de(Pe,ae))*ge}return this.toArray(function(Ee){return Ee.sort(ye)}).then(G)},gr.prototype.toArray=function(B){var G=this;return this._read(function(X){var ee=G._ctx;if(ee.dir==="next"&&ad(ee,!0)&&0<ee.limit){var ae=ee.valueMapper,de=Ri(ee,ee.table.core.schema);return ee.table.core.query({trans:X,limit:ee.limit,values:!0,query:{index:de,range:ee.range}}).then(function(ye){return ye=ye.result,ae?ye.map(ae):ye})}var ge=[];return mn(ee,function(ye){return ge.push(ye)},X,ee.table.core).then(function(){return ge})},B)},gr.prototype.offset=function(B){var G=this._ctx;return B<=0||(G.offset+=B,ad(G)?di(G,function(){var X=B;return function(ee,ae){return X===0||(X===1?--X:ae(function(){ee.advance(X),X=0}),!1)}}):di(G,function(){var X=B;return function(){return--X<0}})),this},gr.prototype.limit=function(B){return this._ctx.limit=Math.min(this._ctx.limit,B),di(this._ctx,function(){var G=B;return function(X,ee,ae){return--G<=0&&ee(ae),0<=G}},!0),this},gr.prototype.until=function(B,G){return Xe(this._ctx,function(X,ee,ae){return!B(X.value)||(ee(ae),G)}),this},gr.prototype.first=function(B){return this.limit(1).toArray(function(G){return G[0]}).then(B)},gr.prototype.last=function(B){return this.reverse().first(B)},gr.prototype.filter=function(B){var G;return Xe(this._ctx,function(X){return B(X.value)}),(G=this._ctx).isMatch=ma(G.isMatch,B),this},gr.prototype.and=function(B){return this.filter(B)},gr.prototype.or=function(B){return new this.db.WhereClause(this._ctx.table,B,this)},gr.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},gr.prototype.desc=function(){return this.reverse()},gr.prototype.eachKey=function(B){var G=this._ctx;return G.keysOnly=!G.isMatch,this.each(function(X,ee){B(ee.key,ee)})},gr.prototype.eachUniqueKey=function(B){return this._ctx.unique="unique",this.eachKey(B)},gr.prototype.eachPrimaryKey=function(B){var G=this._ctx;return G.keysOnly=!G.isMatch,this.each(function(X,ee){B(ee.primaryKey,ee)})},gr.prototype.keys=function(B){var G=this._ctx;G.keysOnly=!G.isMatch;var X=[];return this.each(function(ee,ae){X.push(ae.key)}).then(function(){return X}).then(B)},gr.prototype.primaryKeys=function(B){var G=this._ctx;if(G.dir==="next"&&ad(G,!0)&&0<G.limit)return this._read(function(ee){var ae=Ri(G,G.table.core.schema);return G.table.core.query({trans:ee,values:!1,limit:G.limit,query:{index:ae,range:G.range}})}).then(function(ee){return ee.result}).then(B);G.keysOnly=!G.isMatch;var X=[];return this.each(function(ee,ae){X.push(ae.primaryKey)}).then(function(){return X}).then(B)},gr.prototype.uniqueKeys=function(B){return this._ctx.unique="unique",this.keys(B)},gr.prototype.firstKey=function(B){return this.limit(1).keys(function(G){return G[0]}).then(B)},gr.prototype.lastKey=function(B){return this.reverse().firstKey(B)},gr.prototype.distinct=function(){var B=this._ctx,B=B.index&&B.table.schema.idxByName[B.index];if(!B||!B.multi)return this;var G={};return Xe(this._ctx,function(ae){var ee=ae.primaryKey.toString(),ae=d(G,ee);return G[ee]=!0,!ae}),this},gr.prototype.modify=function(B){var G=this,X=this._ctx;return this._write(function(ee){var ae=typeof B=="function"?B:function(Me){return ki(Me,B)},de=X.table.core,Pe=de.schema.primaryKey,ge=Pe.outbound,ye=Pe.extractKey,Ee=200,Pe=G.db._options.modifyChunkSize;Pe&&(Ee=typeof Pe=="object"?Pe[de.name]||Pe["*"]||200:Pe);function Ae(Me,He){var Ve=He.failures,He=He.numFailures;_e+=Me-He;for(var rt=0,ct=s(Ve);rt<ct.length;rt++){var Rt=ct[rt];Te.push(Ve[Rt])}}var Te=[],_e=0,Ce=[],Re=B===dl;return G.clone().primaryKeys().then(function(Me){function Ne(He){var rt=Math.min(Ee,Me.length-He),ct=Me.slice(He,He+rt);return(Re?Promise.resolve([]):de.getMany({trans:ee,keys:ct,cache:"immutable"})).then(function(Rt){var Bt=[],St=[],kt=ge?[]:null,Ot=Re?ct:[];if(!Re)for(var xt=0;xt<rt;++xt){var ei=Rt[xt],dr={value:M(ei),primKey:Me[He+xt]};ae.call(dr,dr.value,dr)!==!1&&(dr.value==null?Ot.push(Me[He+xt]):ge||Kt(ye(ei),ye(dr.value))===0?(St.push(dr.value),ge&&kt.push(Me[He+xt])):(Ot.push(Me[He+xt]),Bt.push(dr.value)))}return Promise.resolve(0<Bt.length&&de.mutate({trans:ee,type:"add",values:Bt}).then(function(zi){for(var Ur in zi.failures)Ot.splice(parseInt(Ur),1);Ae(Bt.length,zi)})).then(function(){return(0<St.length||Ve&&typeof B=="object")&&de.mutate({trans:ee,type:"put",keys:kt,values:St,criteria:Ve,changeSpec:typeof B!="function"&&B,isAdditionalChunk:0<He}).then(function(zi){return Ae(St.length,zi)})}).then(function(){return(0<Ot.length||Ve&&Re)&&de.mutate({trans:ee,type:"delete",keys:Ot,criteria:Ve,isAdditionalChunk:0<He}).then(function(zi){return ns(X.table,Ot,zi)}).then(function(zi){return Ae(Ot.length,zi)})}).then(function(){return Me.length>He+rt&&Ne(He+Ee)})})}var Ve=ad(X)&&X.limit===1/0&&(typeof B!="function"||Re)&&{index:X.index,range:X.range};return Ne(0).then(function(){if(0<Te.length)throw new H("Error modifying one or more objects",Te,_e,Ce);return Me.length})})})},gr.prototype.delete=function(){var B=this._ctx,G=B.range;return!ad(B)||B.table.schema.yProps||!B.isPrimKey&&G.type!==3?this.modify(dl):this._write(function(X){var ee=B.table.core.schema.primaryKey,ae=G;return B.table.core.count({trans:X,query:{index:ee,range:ae}}).then(function(de){return B.table.core.mutate({trans:X,type:"deleteRange",range:ae}).then(function(Ee){var ye=Ee.failures,Ee=Ee.numFailures;if(Ee)throw new H("Could not delete some values",Object.keys(ye).map(function(Pe){return ye[Pe]}),de-Ee);return de-Ee})})})},gr);function gr(){}var dl=function(B,G){return G.value=null};function _m(B,G){return B<G?-1:B===G?0:1}function df(B,G){return G<B?-1:B===G?0:1}function qs(B,G,X){return B=B instanceof km?new B.Collection(B):B,B._ctx.error=new(X||TypeError)(G),B}function cu(B){return new B.Collection(B,function(){return Gp("")}).limit(0)}function uu(B,G,X,ee){var ae,de,ge,ye,Ee,Pe,Ae,Te=X.length;if(!X.every(function(Re){return typeof Re=="string"}))return qs(B,uf);function _e(Re){ae=Re==="next"?function(Ne){return Ne.toUpperCase()}:function(Ne){return Ne.toLowerCase()},de=Re==="next"?function(Ne){return Ne.toLowerCase()}:function(Ne){return Ne.toUpperCase()},ge=Re==="next"?_m:df;var Me=X.map(function(Ne){return{lower:de(Ne),upper:ae(Ne)}}).sort(function(Ne,Ve){return ge(Ne.lower,Ve.lower)});ye=Me.map(function(Ne){return Ne.upper}),Ee=Me.map(function(Ne){return Ne.lower}),Ae=(Pe=Re)==="next"?"":ee}_e("next"),B=new B.Collection(B,function(){return ga(ye[0],Ee[Te-1]+ee)}),B._ondirectionchange=function(Re){_e(Re)};var Ce=0;return B._addAlgorithm(function(Re,Me,Ne){var Ve=Re.key;if(typeof Ve!="string")return!1;var He=de(Ve);if(G(He,Ee,Ce))return!0;for(var rt=null,ct=Ce;ct<Te;++ct){var Rt=(function(Bt,St,kt,Ot,xt,ei){for(var dr=Math.min(Bt.length,Ot.length),zi=-1,Ur=0;Ur<dr;++Ur){var Kl=St[Ur];if(Kl!==Ot[Ur])return xt(Bt[Ur],kt[Ur])<0?Bt.substr(0,Ur)+kt[Ur]+kt.substr(Ur+1):xt(Bt[Ur],Ot[Ur])<0?Bt.substr(0,Ur)+Ot[Ur]+kt.substr(Ur+1):0<=zi?Bt.substr(0,zi)+St[zi]+kt.substr(zi+1):null;xt(Bt[Ur],Kl)<0&&(zi=Ur)}return dr<Ot.length&&ei==="next"?Bt+kt.substr(Bt.length):dr<Bt.length&&ei==="prev"?Bt.substr(0,kt.length):zi<0?null:Bt.substr(0,zi)+Ot[zi]+kt.substr(zi+1)})(Ve,He,ye[ct],Ee[ct],ge,Pe);Rt===null&&rt===null?Ce=ct+1:(rt===null||0<ge(rt,Rt))&&(rt=Rt)}return Me(rt!==null?function(){Re.continue(rt+Ae)}:Ne),!1}),B}function ga(B,G,X,ee){return{type:2,lower:B,upper:G,lowerOpen:X,upperOpen:ee}}function Gp(B){return{type:1,lower:B,upper:B}}var km=(Object.defineProperty(ni.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ni.prototype.between=function(B,G,X,ee){X=X!==!1,ee=ee===!0;try{return 0<this._cmp(B,G)||this._cmp(B,G)===0&&(X||ee)&&(!X||!ee)?cu(this):new this.Collection(this,function(){return ga(B,G,!X,!ee)})}catch{return qs(this,cl)}},ni.prototype.equals=function(B){return B==null?qs(this,cl):new this.Collection(this,function(){return Gp(B)})},ni.prototype.above=function(B){return B==null?qs(this,cl):new this.Collection(this,function(){return ga(B,void 0,!0)})},ni.prototype.aboveOrEqual=function(B){return B==null?qs(this,cl):new this.Collection(this,function(){return ga(B,void 0,!1)})},ni.prototype.below=function(B){return B==null?qs(this,cl):new this.Collection(this,function(){return ga(void 0,B,!1,!0)})},ni.prototype.belowOrEqual=function(B){return B==null?qs(this,cl):new this.Collection(this,function(){return ga(void 0,B)})},ni.prototype.startsWith=function(B){return typeof B!="string"?qs(this,uf):this.between(B,B+$o,!0,!0)},ni.prototype.startsWithIgnoreCase=function(B){return B===""?this.startsWith(B):uu(this,function(G,X){return G.indexOf(X[0])===0},[B],$o)},ni.prototype.equalsIgnoreCase=function(B){return uu(this,function(G,X){return G===X[0]},[B],"")},ni.prototype.anyOfIgnoreCase=function(){var B=F.apply(V,arguments);return B.length===0?cu(this):uu(this,function(G,X){return X.indexOf(G)!==-1},B,"")},ni.prototype.startsWithAnyOfIgnoreCase=function(){var B=F.apply(V,arguments);return B.length===0?cu(this):uu(this,function(G,X){return X.some(function(ee){return G.indexOf(ee)===0})},B,$o)},ni.prototype.anyOf=function(){var B=this,G=F.apply(V,arguments),X=this._cmp;try{G.sort(X)}catch{return qs(this,cl)}if(G.length===0)return cu(this);var ee=new this.Collection(this,function(){return ga(G[0],G[G.length-1])});ee._ondirectionchange=function(de){X=de==="next"?B._ascending:B._descending,G.sort(X)};var ae=0;return ee._addAlgorithm(function(de,ge,ye){for(var Ee=de.key;0<X(Ee,G[ae]);)if(++ae===G.length)return ge(ye),!1;return X(Ee,G[ae])===0||(ge(function(){de.continue(G[ae])}),!1)}),ee},ni.prototype.notEqual=function(B){return this.inAnyRange([[-1/0,B],[B,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ni.prototype.noneOf=function(){var B=F.apply(V,arguments);if(B.length===0)return new this.Collection(this);try{B.sort(this._ascending)}catch{return qs(this,cl)}var G=B.reduce(function(X,ee){return X?X.concat([[X[X.length-1][1],ee]]):[[-1/0,ee]]},null);return G.push([B[B.length-1],this.db._maxKey]),this.inAnyRange(G,{includeLowers:!1,includeUppers:!1})},ni.prototype.inAnyRange=function(Ve,G){var X=this,ee=this._cmp,ae=this._ascending,de=this._descending,ge=this._min,ye=this._max;if(Ve.length===0)return cu(this);if(!Ve.every(function(He){return He[0]!==void 0&&He[1]!==void 0&&ae(He[0],He[1])<=0}))return qs(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var Ee=!G||G.includeLowers!==!1,Pe=G&&G.includeUppers===!0,Ae,Te=ae;function _e(He,rt){return Te(He[0],rt[0])}try{(Ae=Ve.reduce(function(He,rt){for(var ct=0,Rt=He.length;ct<Rt;++ct){var Bt=He[ct];if(ee(rt[0],Bt[1])<0&&0<ee(rt[1],Bt[0])){Bt[0]=ge(Bt[0],rt[0]),Bt[1]=ye(Bt[1],rt[1]);break}}return ct===Rt&&He.push(rt),He},[])).sort(_e)}catch{return qs(this,cl)}var Ce=0,Re=Pe?function(He){return 0<ae(He,Ae[Ce][1])}:function(He){return 0<=ae(He,Ae[Ce][1])},Me=Ee?function(He){return 0<de(He,Ae[Ce][0])}:function(He){return 0<=de(He,Ae[Ce][0])},Ne=Re,Ve=new this.Collection(this,function(){return ga(Ae[0][0],Ae[Ae.length-1][1],!Ee,!Pe)});return Ve._ondirectionchange=function(He){Te=He==="next"?(Ne=Re,ae):(Ne=Me,de),Ae.sort(_e)},Ve._addAlgorithm(function(He,rt,ct){for(var Rt,Bt=He.key;Ne(Bt);)if(++Ce===Ae.length)return rt(ct),!1;return!Re(Rt=Bt)&&!Me(Rt)||(X._cmp(Bt,Ae[Ce][1])===0||X._cmp(Bt,Ae[Ce][0])===0||rt(function(){Te===ae?He.continue(Ae[Ce][0]):He.continue(Ae[Ce][1])}),!1)}),Ve},ni.prototype.startsWithAnyOf=function(){var B=F.apply(V,arguments);return B.every(function(G){return typeof G=="string"})?B.length===0?cu(this):this.inAnyRange(B.map(function(G){return[G,G+$o]})):qs(this,"startsWithAnyOf() only works with strings")},ni);function ni(){}function va(B){return tn(function(G){return Ar(G),B(G.target.error),!1})}function Ar(B){B.stopPropagation&&B.stopPropagation(),B.preventDefault&&B.preventDefault()}var xd="storagemutated",Ld="x-storagemutated-1",Vo=ql(null,xd),pf=(Vn.prototype._lock=function(){return I(!De.global),++this._reculock,this._reculock!==1||De.global||(De.lockOwnerFor=this),this},Vn.prototype._unlock=function(){if(I(!De.global),--this._reculock==0)for(De.global||(De.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var B=this._blockedFuncs.shift();try{Sc(B[1],B[0])}catch{}}return this},Vn.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},Vn.prototype.create=function(B){var G=this;if(!this.mode)return this;var X=this.db.idbdb,ee=this.db._state.dbOpenError;if(I(!this.idbtrans),!B&&!X)switch(ee&&ee.name){case"DatabaseClosedError":throw new K.DatabaseClosed(ee);case"MissingAPIError":throw new K.MissingAPI(ee.message,ee);default:throw new K.OpenFailed(ee)}if(!this.active)throw new K.TransactionInactive;return I(this._completion._state===null),(B=this.idbtrans=B||(this.db.core||X).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=tn(function(ae){Ar(ae),G._reject(B.error)}),B.onabort=tn(function(ae){Ar(ae),G.active&&G._reject(new K.Abort(B.error)),G.active=!1,G.on("abort").fire(ae)}),B.oncomplete=tn(function(){G.active=!1,G._resolve(),"mutatedParts"in B&&Vo.storagemutated.fire(B.mutatedParts)}),this},Vn.prototype._promise=function(B,G,X){var ee=this;if(B==="readwrite"&&this.mode!=="readwrite")return $n(new K.ReadOnly("Transaction is readonly"));if(!this.active)return $n(new K.TransactionInactive);if(this._locked())return new Fe(function(de,ge){ee._blockedFuncs.push([function(){ee._promise(B,G,X).then(de,ge)},De])});if(X)return Uo(function(){var de=new Fe(function(ge,ye){ee._lock();var Ee=G(ge,ye,ee);Ee&&Ee.then&&Ee.then(ge,ye)});return de.finally(function(){return ee._unlock()}),de._lib=!0,de});var ae=new Fe(function(de,ge){var ye=G(de,ge,ee);ye&&ye.then&&ye.then(de,ge)});return ae._lib=!0,ae},Vn.prototype._root=function(){return this.parent?this.parent._root():this},Vn.prototype.waitFor=function(B){var G,X=this._root(),ee=Fe.resolve(B);X._waitingFor?X._waitingFor=X._waitingFor.then(function(){return ee}):(X._waitingFor=ee,X._waitingQueue=[],G=X.idbtrans.objectStore(X.storeNames[0]),(function de(){for(++X._spinCount;X._waitingQueue.length;)X._waitingQueue.shift()();X._waitingFor&&(G.get(-1/0).onsuccess=de)})());var ae=X._waitingFor;return new Fe(function(de,ge){ee.then(function(ye){return X._waitingQueue.push(tn(de.bind(null,ye)))},function(ye){return X._waitingQueue.push(tn(ge.bind(null,ye)))}).finally(function(){X._waitingFor===ae&&(X._waitingFor=null)})})},Vn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},Vn.prototype.table=function(B){var G=this._memoizedTables||(this._memoizedTables={});if(d(G,B))return G[B];var X=this.schema[B];if(!X)throw new K.NotFound("Table "+B+" not part of transaction");return X=new this.db.Table(B,X,this),X.core=this.db.core.table(B),G[B]=X},Vn);function Vn(){}function Fd(B,G,X,ee,ae,de,ge,ye){return{name:B,keyPath:G,unique:X,multi:ee,auto:ae,compound:de,src:(X&&!ge?"&":"")+(ee?"*":"")+(ae?"++":"")+du(G),type:ye}}function du(B){return typeof B=="string"?B:B?"["+[].join.call(B,"+")+"]":""}function Na(B,G,X){return{name:B,primKey:G,indexes:X,mappedClass:null,idxByName:(ee=function(ae){return[ae.name,ae]},X.reduce(function(ae,de,ge){return ge=ee(de,ge),ge&&(ae[ge[0]]=ge[1]),ae},{}))};var ee}var pl=function(B){try{return B.only([[]]),pl=function(){return[[]]},[[]]}catch{return pl=function(){return $o},$o}};function Q(B){return B==null?function(){}:typeof B=="string"?(G=B).split(".").length===1?function(X){return X[G]}:function(X){return T(X,G)}:function(X){return T(X,B)};var G}function fe(B){return[].slice.call(B)}var Ue=0;function tt(B){return B==null?":id":typeof B=="string"?B:"[".concat(B.join("+"),"]")}function Yi(B,G,Ee){function ee(Ne){if(Ne.type===3)return null;if(Ne.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var Ce=Ne.lower,Re=Ne.upper,Me=Ne.lowerOpen,Ne=Ne.upperOpen;return Ce===void 0?Re===void 0?null:G.upperBound(Re,!!Ne):Re===void 0?G.lowerBound(Ce,!!Me):G.bound(Ce,Re,!!Me,!!Ne)}function ae(_e){var Ce,Re=_e.name;return{name:Re,schema:_e,mutate:function(Me){var Ne=Me.trans,Ve=Me.type,He=Me.keys,rt=Me.values,ct=Me.range;return new Promise(function(Rt,Bt){Rt=tn(Rt);var St=Ne.objectStore(Re),kt=St.keyPath==null,Ot=Ve==="put"||Ve==="add";if(!Ot&&Ve!=="delete"&&Ve!=="deleteRange")throw new Error("Invalid operation type: "+Ve);var xt,ei=(He||rt||{length:1}).length;if(He&&rt&&He.length!==rt.length)throw new Error("Given keys array must have same length as given values array.");if(ei===0)return Rt({numFailures:0,failures:{},results:[],lastResult:void 0});function dr(Ho){++Kl,Ar(Ho)}var zi=[],Ur=[],Kl=0;if(Ve==="deleteRange"){if(ct.type===4)return Rt({numFailures:Kl,failures:Ur,results:[],lastResult:void 0});ct.type===3?zi.push(xt=St.clear()):zi.push(xt=St.delete(ee(ct)))}else{var kt=Ot?kt?[rt,He]:[rt,null]:[He,null],Ki=kt[0],Go=kt[1];if(Ot)for(var Ws=0;Ws<ei;++Ws)zi.push(xt=Go&&Go[Ws]!==void 0?St[Ve](Ki[Ws],Go[Ws]):St[Ve](Ki[Ws])),xt.onerror=dr;else for(Ws=0;Ws<ei;++Ws)zi.push(xt=St[Ve](Ki[Ws])),xt.onerror=dr}function mf(Ho){Ho=Ho.target.result,zi.forEach(function(gf,oE){return gf.error!=null&&(Ur[oE]=gf.error)}),Rt({numFailures:Kl,failures:Ur,results:Ve==="delete"?He:zi.map(function(gf){return gf.result}),lastResult:Ho})}xt.onerror=function(Ho){dr(Ho),mf(Ho)},xt.onsuccess=mf})},getMany:function(Me){var Ne=Me.trans,Ve=Me.keys;return new Promise(function(He,rt){He=tn(He);for(var ct,Rt=Ne.objectStore(Re),Bt=Ve.length,St=new Array(Bt),kt=0,Ot=0,xt=function(zi){zi=zi.target,St[zi._pos]=zi.result,++Ot===kt&&He(St)},ei=va(rt),dr=0;dr<Bt;++dr)Ve[dr]!=null&&((ct=Rt.get(Ve[dr]))._pos=dr,ct.onsuccess=xt,ct.onerror=ei,++kt);kt===0&&He(St)})},get:function(Me){var Ne=Me.trans,Ve=Me.key;return new Promise(function(He,rt){He=tn(He);var ct=Ne.objectStore(Re).get(Ve);ct.onsuccess=function(Rt){return He(Rt.target.result)},ct.onerror=va(rt)})},query:(Ce=Pe,function(Me){return new Promise(function(Ne,Ve){Ne=tn(Ne);var He,rt,ct,kt=Me.trans,Rt=Me.values,Bt=Me.limit,xt=Me.query,St=Bt===1/0?void 0:Bt,Ot=xt.index,xt=xt.range,kt=kt.objectStore(Re),Ot=Ot.isPrimaryKey?kt:kt.index(Ot.name),xt=ee(xt);if(Bt===0)return Ne({result:[]});Ce?((St=Rt?Ot.getAll(xt,St):Ot.getAllKeys(xt,St)).onsuccess=function(ei){return Ne({result:ei.target.result})},St.onerror=va(Ve)):(He=0,rt=!Rt&&"openKeyCursor"in Ot?Ot.openKeyCursor(xt):Ot.openCursor(xt),ct=[],rt.onsuccess=function(ei){var dr=rt.result;return dr?(ct.push(Rt?dr.value:dr.primaryKey),++He===Bt?Ne({result:ct}):void dr.continue()):Ne({result:ct})},rt.onerror=va(Ve))})}),openCursor:function(Me){var Ne=Me.trans,Ve=Me.values,He=Me.query,rt=Me.reverse,ct=Me.unique;return new Promise(function(Rt,Bt){Rt=tn(Rt);var Ot=He.index,St=He.range,kt=Ne.objectStore(Re),kt=Ot.isPrimaryKey?kt:kt.index(Ot.name),Ot=rt?ct?"prevunique":"prev":ct?"nextunique":"next",xt=!Ve&&"openKeyCursor"in kt?kt.openKeyCursor(ee(St),Ot):kt.openCursor(ee(St),Ot);xt.onerror=va(Bt),xt.onsuccess=tn(function(ei){var dr,zi,Ur,Kl,Ki=xt.result;Ki?(Ki.___id=++Ue,Ki.done=!1,dr=Ki.continue.bind(Ki),zi=(zi=Ki.continuePrimaryKey)&&zi.bind(Ki),Ur=Ki.advance.bind(Ki),Kl=function(){throw new Error("Cursor not stopped")},Ki.trans=Ne,Ki.stop=Ki.continue=Ki.continuePrimaryKey=Ki.advance=function(){throw new Error("Cursor not started")},Ki.fail=tn(Bt),Ki.next=function(){var Go=this,Ws=1;return this.start(function(){return Ws--?Go.continue():Go.stop()}).then(function(){return Go})},Ki.start=function(Go){function Ws(){if(xt.result)try{Go()}catch(Ho){Ki.fail(Ho)}else Ki.done=!0,Ki.start=function(){throw new Error("Cursor behind last entry")},Ki.stop()}var mf=new Promise(function(Ho,gf){Ho=tn(Ho),xt.onerror=va(gf),Ki.fail=gf,Ki.stop=function(oE){Ki.stop=Ki.continue=Ki.continuePrimaryKey=Ki.advance=Kl,Ho(oE)}});return xt.onsuccess=tn(function(Ho){xt.onsuccess=Ws,Ws()}),Ki.continue=dr,Ki.continuePrimaryKey=zi,Ki.advance=Ur,Ws(),mf},Rt(Ki)):Rt(null)},Bt)})},count:function(Me){var Ne=Me.query,Ve=Me.trans,He=Ne.index,rt=Ne.range;return new Promise(function(ct,Rt){var Bt=Ve.objectStore(Re),St=He.isPrimaryKey?Bt:Bt.index(He.name),Bt=ee(rt),St=Bt?St.count(Bt):St.count();St.onsuccess=tn(function(kt){return ct(kt.target.result)}),St.onerror=va(Rt)})}}}var de,ge,ye,Ae=(ge=Ee,ye=fe((de=B).objectStoreNames),{schema:{name:de.name,tables:ye.map(function(_e){return ge.objectStore(_e)}).map(function(_e){var Ce=_e.keyPath,Ne=_e.autoIncrement,Re=o(Ce),Me={},Ne={name:_e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Ce==null,compound:Re,keyPath:Ce,autoIncrement:Ne,unique:!0,extractKey:Q(Ce)},indexes:fe(_e.indexNames).map(function(Ve){return _e.index(Ve)}).map(function(ct){var He=ct.name,rt=ct.unique,Rt=ct.multiEntry,ct=ct.keyPath,Rt={name:He,compound:o(ct),keyPath:ct,unique:rt,multiEntry:Rt,extractKey:Q(ct)};return Me[tt(ct)]=Rt}),getIndexByKeyPath:function(Ve){return Me[tt(Ve)]}};return Me[":id"]=Ne.primaryKey,Ce!=null&&(Me[tt(Ce)]=Ne.primaryKey),Ne})},hasGetAll:0<ye.length&&"getAll"in ge.objectStore(ye[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),Ee=Ae.schema,Pe=Ae.hasGetAll,Ae=Ee.tables.map(ae),Te={};return Ae.forEach(function(_e){return Te[_e.name]=_e}),{stack:"dbcore",transaction:B.transaction.bind(B),table:function(_e){if(!Te[_e])throw new Error("Table '".concat(_e,"' not found"));return Te[_e]},MIN_KEY:-1/0,MAX_KEY:pl(G),schema:Ee}}function wi(B,G,X,ee){var ae=X.IDBKeyRange;return X.indexedDB,{dbcore:(ee=Yi(G,ae,ee),B.dbcore.reduce(function(de,ge){return ge=ge.create,r(r({},de),ge(de))},ee))}}function Rr(B,ee){var X=ee.db,ee=wi(B._middlewares,X,B._deps,ee);B.core=ee.dbcore,B.tables.forEach(function(ae){var de=ae.name;B.core.schema.tables.some(function(ge){return ge.name===de})&&(ae.core=B.core.table(de),B[de]instanceof B.Table&&(B[de].core=ae.core))})}function Zt(B,G,X,ee){X.forEach(function(ae){var de=ee[ae];G.forEach(function(ge){var ye=(function Ee(Pe,Ae){return g(Pe,Ae)||(Pe=c(Pe))&&Ee(Pe,Ae)})(ge,ae);(!ye||"value"in ye&&ye.value===void 0)&&(ge===B.Transaction.prototype||ge instanceof B.Transaction?f(ge,ae,{get:function(){return this.table(ae)},set:function(Ee){h(this,ae,{value:Ee,writable:!0,configurable:!0,enumerable:!0})}}):ge[ae]=new B.Table(ae,de))})})}function Sa(B,G){G.forEach(function(X){for(var ee in X)X[ee]instanceof B.Table&&delete X[ee]})}function ur(B,G){return B._cfg.version-G._cfg.version}function Ka(B,G,X,ee){var ae=B._dbSchema;X.objectStoreNames.contains("$meta")&&!ae.$meta&&(ae.$meta=Na("$meta",Om("")[0],[]),B._storeNames.push("$meta"));var de=B._createTransaction("readwrite",B._storeNames,ae);de.create(X),de._completion.catch(ee);var ge=de._reject.bind(de),ye=De.transless||De;Uo(function(){return De.trans=de,De.transless=ye,G!==0?(Rr(B,X),Pe=G,((Ee=de).storeNames.includes("$meta")?Ee.table("$meta").get("version").then(function(Ae){return Ae??Pe}):Fe.resolve(Pe)).then(function(Ae){return _e=Ae,Ce=de,Re=X,Me=[],Ae=(Te=B)._versions,Ne=Te._dbSchema=Yl(0,Te.idbdb,Re),(Ae=Ae.filter(function(Ve){return Ve._cfg.version>=_e})).length!==0?(Ae.forEach(function(Ve){Me.push(function(){var He=Ne,rt=Ve._cfg.dbschema;pu(Te,He,Re),pu(Te,rt,Re),Ne=Te._dbSchema=rt;var ct=Aa(He,rt);ct.add.forEach(function(Ot){Za(Re,Ot[0],Ot[1].primKey,Ot[1].indexes)}),ct.change.forEach(function(Ot){if(Ot.recreate)throw new K.Upgrade("Not yet support for changing primary key");var xt=Re.objectStore(Ot.name);Ot.add.forEach(function(ei){return Wl(xt,ei)}),Ot.change.forEach(function(ei){xt.deleteIndex(ei.name),Wl(xt,ei)}),Ot.del.forEach(function(ei){return xt.deleteIndex(ei)})});var Rt=Ve._cfg.contentUpgrade;if(Rt&&Ve._cfg.version>_e){Rr(Te,Re),Ce._memoizedTables={};var Bt=D(rt);ct.del.forEach(function(Ot){Bt[Ot]=He[Ot]}),Sa(Te,[Te.Transaction.prototype]),Zt(Te,[Te.Transaction.prototype],s(Bt),Bt),Ce.schema=Bt;var St,kt=j(Rt);return kt&&Hs(),ct=Fe.follow(function(){var Ot;(St=Rt(Ce))&&kt&&(Ot=zs.bind(null,null),St.then(Ot,Ot))}),St&&typeof St.then=="function"?Fe.resolve(St):ct.then(function(){return St})}}),Me.push(function(He){var rt,ct,Rt=Ve._cfg.dbschema;rt=Rt,ct=He,[].slice.call(ct.db.objectStoreNames).forEach(function(Bt){return rt[Bt]==null&&ct.db.deleteObjectStore(Bt)}),Sa(Te,[Te.Transaction.prototype]),Zt(Te,[Te.Transaction.prototype],Te._storeNames,Te._dbSchema),Ce.schema=Te._dbSchema}),Me.push(function(He){Te.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Te.idbdb.version/10)===Ve._cfg.version?(Te.idbdb.deleteObjectStore("$meta"),delete Te._dbSchema.$meta,Te._storeNames=Te._storeNames.filter(function(rt){return rt!=="$meta"})):He.objectStore("$meta").put(Ve._cfg.version,"version"))})}),(function Ve(){return Me.length?Fe.resolve(Me.shift()(Ce.idbtrans)).then(Ve):Fe.resolve()})().then(function(){Us(Ne,Re)})):Fe.resolve();var Te,_e,Ce,Re,Me,Ne}).catch(ge)):(s(ae).forEach(function(Ae){Za(X,Ae,ae[Ae].primKey,ae[Ae].indexes)}),Rr(B,X),void Fe.follow(function(){return B.on.populate.fire(de)}).catch(ge));var Ee,Pe})}function Do(B,G){Us(B._dbSchema,G),G.db.version%10!=0||G.objectStoreNames.contains("$meta")||G.db.createObjectStore("$meta").add(Math.ceil(G.db.version/10-1),"version");var X=Yl(0,B.idbdb,G);pu(B,B._dbSchema,G);for(var ee=0,ae=Aa(X,B._dbSchema).change;ee<ae.length;ee++){var de=(function(ge){if(ge.change.length||ge.recreate)return console.warn("Unable to patch indexes of table ".concat(ge.name," because it has changes on the type of index or primary key.")),{value:void 0};var ye=G.objectStore(ge.name);ge.add.forEach(function(Ee){ze&&console.debug("Dexie upgrade patch: Creating missing index ".concat(ge.name,".").concat(Ee.src)),Wl(ye,Ee)})})(ae[ee]);if(typeof de=="object")return de.value}}function Aa(B,G){var X,ee={del:[],add:[],change:[]};for(X in B)G[X]||ee.del.push(X);for(X in G){var ae=B[X],de=G[X];if(ae){var ge={name:X,def:de,recreate:!1,del:[],add:[],change:[]};if(""+(ae.primKey.keyPath||"")!=""+(de.primKey.keyPath||"")||ae.primKey.auto!==de.primKey.auto)ge.recreate=!0,ee.change.push(ge);else{var ye=ae.idxByName,Ee=de.idxByName,Pe=void 0;for(Pe in ye)Ee[Pe]||ge.del.push(Pe);for(Pe in Ee){var Ae=ye[Pe],Te=Ee[Pe];Ae?Ae.src!==Te.src&&ge.change.push(Te):ge.add.push(Te)}(0<ge.del.length||0<ge.add.length||0<ge.change.length)&&ee.change.push(ge)}}else ee.add.push([X,de])}return ee}function Za(B,G,X,ee){var ae=B.db.createObjectStore(G,X.keyPath?{keyPath:X.keyPath,autoIncrement:X.auto}:{autoIncrement:X.auto});return ee.forEach(function(de){return Wl(ae,de)}),ae}function Us(B,G){s(B).forEach(function(X){G.db.objectStoreNames.contains(X)||(ze&&console.debug("Dexie: Creating missing table",X),Za(G,X,B[X].primKey,B[X].indexes))})}function Wl(B,G){B.createIndex(G.name,G.keyPath,{unique:G.unique,multiEntry:G.multi})}function Yl(B,G,X){var ee={};return y(G.objectStoreNames,0).forEach(function(ae){for(var de=X.objectStore(ae),ge=Fd(du(Pe=de.keyPath),Pe||"",!0,!1,!!de.autoIncrement,Pe&&typeof Pe!="string",!0),ye=[],Ee=0;Ee<de.indexNames.length;++Ee){var Ae=de.index(de.indexNames[Ee]),Pe=Ae.keyPath,Ae=Fd(Ae.name,Pe,!!Ae.unique,!!Ae.multiEntry,!1,Pe&&typeof Pe!="string",!1);ye.push(Ae)}ee[ae]=Na(ae,ge,ye)}),ee}function pu(B,G,X){for(var ee=X.db.objectStoreNames,ae=0;ae<ee.length;++ae){var de=ee[ae],ge=X.objectStore(de);B._hasGetAll="getAll"in ge;for(var ye=0;ye<ge.indexNames.length;++ye){var Ee=ge.indexNames[ye],Pe=ge.index(Ee).keyPath,Ae=typeof Pe=="string"?Pe:"["+y(Pe).join("+")+"]";!G[de]||(Pe=G[de].idxByName[Ae])&&(Pe.name=Ee,delete G[de].idxByName[Ae],G[de].idxByName[Ee]=Pe)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(B._hasGetAll=!1)}function Om(B){return B.split(",").map(function(G,X){var de=G.split(":"),ee=(ae=de[1])===null||ae===void 0?void 0:ae.trim(),ae=(G=de[0].trim()).replace(/([&*]|\+\+)/g,""),de=/^\[/.test(ae)?ae.match(/^\[(.*)\]$/)[1].split("+"):ae;return Fd(ae,de||null,/\&/.test(G),/\*/.test(G),/\+\+/.test(G),o(de),X===0,ee)})}var nv=(Ds.prototype._createTableSchema=Na,Ds.prototype._parseIndexSyntax=Om,Ds.prototype._parseStoresSpec=function(B,G){var X=this;s(B).forEach(function(ee){if(B[ee]!==null){var ae=X._parseIndexSyntax(B[ee]),de=ae.shift();if(!de)throw new K.Schema("Invalid schema for table "+ee+": "+B[ee]);if(de.unique=!0,de.multi)throw new K.Schema("Primary key cannot be multiEntry*");ae.forEach(function(ge){if(ge.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!ge.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),ae=X._createTableSchema(ee,de,ae),G[ee]=ae}})},Ds.prototype.stores=function(X){var G=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,X):X;var X=G._versions,ee={},ae={};return X.forEach(function(de){l(ee,de._cfg.storesSource),ae=de._cfg.dbschema={},de._parseStoresSpec(ee,ae)}),G._dbSchema=ae,Sa(G,[G._allTables,G,G.Transaction.prototype]),Zt(G,[G._allTables,G,G.Transaction.prototype,this._cfg.tables],s(ae),ae),G._storeNames=s(ae),this},Ds.prototype.upgrade=function(B){return this._cfg.contentUpgrade=It(this._cfg.contentUpgrade||re,B),this},Ds);function Ds(){}function tE(B,G){var X=B._dbNamesDB;return X||(X=B._dbNamesDB=new Hp(Hl,{addons:[],indexedDB:B,IDBKeyRange:G})).version(1).stores({dbnames:"name"}),X.table("dbnames")}function rS(B){return B&&typeof B.databases=="function"}function Bd(B){return Uo(function(){return De.letThrough=!0,B()})}function nS(B){return!("from"in B)}var Eo=function(B,G){if(!this){var X=new Eo;return B&&"d"in B&&l(X,B),X}l(this,arguments.length?{d:1,from:B,to:1<arguments.length?G:B}:{d:0})};function xm(B,G,X){var ee=Kt(G,X);if(!isNaN(ee)){if(0<ee)throw RangeError();if(nS(B))return l(B,{from:G,to:X,d:1});var ae=B.l,ee=B.r;if(Kt(X,B.from)<0)return ae?xm(ae,G,X):B.l={from:G,to:X,d:1,l:null,r:null},cM(B);if(0<Kt(G,B.to))return ee?xm(ee,G,X):B.r={from:G,to:X,d:1,l:null,r:null},cM(B);Kt(G,B.from)<0&&(B.from=G,B.l=null,B.d=ee?ee.d+1:1),0<Kt(X,B.to)&&(B.to=X,B.r=null,B.d=B.l?B.l.d+1:1),X=!B.r,ae&&!B.l&&sb(B,ae),ee&&X&&sb(B,ee)}}function sb(B,G){nS(G)||(function X(ee,Ee){var de=Ee.from,ge=Ee.to,ye=Ee.l,Ee=Ee.r;xm(ee,de,ge),ye&&X(ee,ye),Ee&&X(ee,Ee)})(B,G)}function iE(B,G){var X=ob(G),ee=X.next();if(ee.done)return!1;for(var ae=ee.value,de=ob(B),ge=de.next(ae.from),ye=ge.value;!ee.done&&!ge.done;){if(Kt(ye.from,ae.to)<=0&&0<=Kt(ye.to,ae.from))return!0;Kt(ae.from,ye.from)<0?ae=(ee=X.next(ye.from)).value:ye=(ge=de.next(ae.from)).value}return!1}function ob(B){var G=nS(B)?null:{s:0,n:B};return{next:function(X){for(var ee=0<arguments.length;G;)switch(G.s){case 0:if(G.s=1,ee)for(;G.n.l&&Kt(X,G.n.from)<0;)G={up:G,n:G.n.l,s:1};else for(;G.n.l;)G={up:G,n:G.n.l,s:1};case 1:if(G.s=2,!ee||Kt(X,G.n.to)<=0)return{value:G.n,done:!1};case 2:if(G.n.r){G.s=3,G={up:G,n:G.n.r,s:0};continue}case 3:G=G.up}return{done:!0}}}}function cM(B){var G,X,ee=(((G=B.r)===null||G===void 0?void 0:G.d)||0)-(((X=B.l)===null||X===void 0?void 0:X.d)||0),ae=1<ee?"r":ee<-1?"l":"";ae&&(G=ae=="r"?"l":"r",X=r({},B),ee=B[ae],B.from=ee.from,B.to=ee.to,B[ae]=ee[ae],X[ae]=ee[G],(B[G]=X).d=uM(X)),B.d=uM(B)}function uM(X){var G=X.r,X=X.l;return(G?X?Math.max(G.d,X.d):G.d:X?X.d:0)+1}function av(B,G){return s(G).forEach(function(X){B[X]?sb(B[X],G[X]):B[X]=(function ee(ae){var de,ge,ye={};for(de in ae)d(ae,de)&&(ge=ae[de],ye[de]=!ge||typeof ge!="object"||P.has(ge.constructor)?ge:ee(ge));return ye})(G[X])}),B}function rE(B,G){return B.all||G.all||Object.keys(B).some(function(X){return G[X]&&iE(G[X],B[X])})}p(Eo.prototype,((mu={add:function(B){return sb(this,B),this},addKey:function(B){return xm(this,B,B),this},addKeys:function(B){var G=this;return B.forEach(function(X){return xm(G,X,X)}),this},hasKey:function(B){var G=ob(this).next(B).value;return G&&Kt(G.from,B)<=0&&0<=Kt(G.to,B)}})[k]=function(){return ob(this)},mu));var hf={},aS={},sv=!1;function $d(B){av(aS,B),sv||(sv=!0,setTimeout(function(){sv=!1,nE(aS,!(aS={}))},0))}function nE(B,G){G===void 0&&(G=!1);var X=new Set;if(B.all)for(var ee=0,ae=Object.values(hf);ee<ae.length;ee++)ov(ge=ae[ee],B,X,G);else for(var de in B){var ge,ye=/^idb\:\/\/(.*)\/(.*)\//.exec(de);ye&&(de=ye[1],ye=ye[2],(ge=hf["idb://".concat(de,"/").concat(ye)])&&ov(ge,B,X,G))}X.forEach(function(Ee){return Ee()})}function ov(B,G,X,ee){for(var ae=[],de=0,ge=Object.entries(B.queries.query);de<ge.length;de++){for(var ye=ge[de],Ee=ye[0],Pe=[],Ae=0,Te=ye[1];Ae<Te.length;Ae++){var _e=Te[Ae];rE(G,_e.obsSet)?_e.subscribers.forEach(function(Ne){return X.add(Ne)}):ee&&Pe.push(_e)}ee&&ae.push([Ee,Pe])}if(ee)for(var Ce=0,Re=ae;Ce<Re.length;Ce++){var Me=Re[Ce],Ee=Me[0],Pe=Me[1];B.queries.query[Ee]=Pe}}function hu(B){var G=B._state,X=B._deps.indexedDB;if(G.isBeingOpened||B.idbdb)return G.dbReadyPromise.then(function(){return G.dbOpenError?$n(G.dbOpenError):B});G.isBeingOpened=!0,G.dbOpenError=null,G.openComplete=!1;var ee=G.openCanceller,ae=Math.round(10*B.verno),de=!1;function ge(){if(G.openCanceller!==ee)throw new K.DatabaseClosed("db.open() was cancelled")}function ye(){return new Fe(function(_e,Ce){if(ge(),!X)throw new K.MissingAPI;var Re=B.name,Me=G.autoSchema||!ae?X.open(Re):X.open(Re,ae);if(!Me)throw new K.MissingAPI;Me.onerror=va(Ce),Me.onblocked=tn(B._fireOnBlocked),Me.onupgradeneeded=tn(function(Ne){var Ve;Ae=Me.transaction,G.autoSchema&&!B._options.allowEmptyDB?(Me.onerror=Ar,Ae.abort(),Me.result.close(),(Ve=X.deleteDatabase(Re)).onsuccess=Ve.onerror=tn(function(){Ce(new K.NoSuchDatabase("Database ".concat(Re," doesnt exist")))})):(Ae.onerror=va(Ce),Ne=Ne.oldVersion>Math.pow(2,62)?0:Ne.oldVersion,Te=Ne<1,B.idbdb=Me.result,de&&Do(B,Ae),Ka(B,Ne/10,Ae,Ce))},Ce),Me.onsuccess=tn(function(){Ae=null;var Ne,Ve,He,rt,ct,Rt=B.idbdb=Me.result,Bt=y(Rt.objectStoreNames);if(0<Bt.length)try{var St=Rt.transaction((rt=Bt).length===1?rt[0]:rt,"readonly");if(G.autoSchema)Ve=Rt,He=St,(Ne=B).verno=Ve.version/10,He=Ne._dbSchema=Yl(0,Ve,He),Ne._storeNames=y(Ve.objectStoreNames,0),Zt(Ne,[Ne._allTables],s(He),He);else if(pu(B,B._dbSchema,St),((ct=Aa(Yl(0,(ct=B).idbdb,St),ct._dbSchema)).add.length||ct.change.some(function(kt){return kt.add.length||kt.change.length}))&&!de)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Rt.close(),ae=Rt.version+1,de=!0,_e(ye());Rr(B,St)}catch{}Gl.push(B),Rt.onversionchange=tn(function(kt){G.vcFired=!0,B.on("versionchange").fire(kt)}),Rt.onclose=tn(function(){B.close({disableAutoOpen:!1})}),Te&&(ct=B._deps,St=Re,Rt=ct.indexedDB,ct=ct.IDBKeyRange,rS(Rt)||St===Hl||tE(Rt,ct).put({name:St}).catch(re)),_e()},Ce)}).catch(function(_e){switch(_e?.name){case"UnknownError":if(0<G.PR1398_maxLoop)return G.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),ye();break;case"VersionError":if(0<ae)return ae=0,ye()}return Fe.reject(_e)})}var Ee,Pe=G.dbReadyResolve,Ae=null,Te=!1;return Fe.race([ee,(typeof navigator>"u"?Fe.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(_e){function Ce(){return indexedDB.databases().finally(_e)}Ee=setInterval(Ce,100),Ce()}).finally(function(){return clearInterval(Ee)}):Promise.resolve()).then(ye)]).then(function(){return ge(),G.onReadyBeingFired=[],Fe.resolve(Bd(function(){return B.on.ready.fire(B.vip)})).then(function _e(){if(0<G.onReadyBeingFired.length){var Ce=G.onReadyBeingFired.reduce(It,re);return G.onReadyBeingFired=[],Fe.resolve(Bd(function(){return Ce(B.vip)})).then(_e)}})}).finally(function(){G.openCanceller===ee&&(G.onReadyBeingFired=null,G.isBeingOpened=!1)}).catch(function(_e){G.dbOpenError=_e;try{Ae&&Ae.abort()}catch{}return ee===G.openCanceller&&B._close(),$n(_e)}).finally(function(){G.openComplete=!0,Pe()}).then(function(){var _e;return Te&&(_e={},B.tables.forEach(function(Ce){Ce.schema.indexes.forEach(function(Re){Re.name&&(_e["idb://".concat(B.name,"/").concat(Ce.name,"/").concat(Re.name)]=new Eo(-1/0,[[[]]]))}),_e["idb://".concat(B.name,"/").concat(Ce.name,"/")]=_e["idb://".concat(B.name,"/").concat(Ce.name,"/:dels")]=new Eo(-1/0,[[[]]])}),Vo(xd).fire(_e),nE(_e,!0)),B})}function sS(B){function G(de){return B.next(de)}var X=ae(G),ee=ae(function(de){return B.throw(de)});function ae(de){return function(Ee){var ye=de(Ee),Ee=ye.value;return ye.done?Ee:Ee&&typeof Ee.then=="function"?Ee.then(X,ee):o(Ee)?Promise.all(Ee).then(X,ee):X(Ee)}}return ae(G)()}function lb(B,G,X){for(var ee=o(B)?B.slice():[B],ae=0;ae<X;++ae)ee.push(G);return ee}var E2={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(B){return r(r({},B),{table:function(G){var X=B.table(G),ee=X.schema,ae={},de=[];function ge(Te,_e,Ce){var Re=tt(Te),Me=ae[Re]=ae[Re]||[],Ne=Te==null?0:typeof Te=="string"?1:Te.length,Ve=0<_e,Ve=r(r({},Ce),{name:Ve?"".concat(Re,"(virtual-from:").concat(Ce.name,")"):Ce.name,lowLevelIndex:Ce,isVirtual:Ve,keyTail:_e,keyLength:Ne,extractKey:Q(Te),unique:!Ve&&Ce.unique});return Me.push(Ve),Ve.isPrimaryKey||de.push(Ve),1<Ne&&ge(Ne===2?Te[0]:Te.slice(0,Ne-1),_e+1,Ce),Me.sort(function(He,rt){return He.keyTail-rt.keyTail}),Ve}G=ge(ee.primaryKey.keyPath,0,ee.primaryKey),ae[":id"]=[G];for(var ye=0,Ee=ee.indexes;ye<Ee.length;ye++){var Pe=Ee[ye];ge(Pe.keyPath,0,Pe)}function Ae(Te){var _e,Ce=Te.query.index;return Ce.isVirtual?r(r({},Te),{query:{index:Ce.lowLevelIndex,range:(_e=Te.query.range,Ce=Ce.keyTail,{type:_e.type===1?2:_e.type,lower:lb(_e.lower,_e.lowerOpen?B.MAX_KEY:B.MIN_KEY,Ce),lowerOpen:!0,upper:lb(_e.upper,_e.upperOpen?B.MIN_KEY:B.MAX_KEY,Ce),upperOpen:!0})}}):Te}return r(r({},X),{schema:r(r({},ee),{primaryKey:G,indexes:de,getIndexByKeyPath:function(Te){return(Te=ae[tt(Te)])&&Te[0]}}),count:function(Te){return X.count(Ae(Te))},query:function(Te){return X.query(Ae(Te))},openCursor:function(Te){var _e=Te.query.index,Ce=_e.keyTail,Re=_e.isVirtual,Me=_e.keyLength;return Re?X.openCursor(Ae(Te)).then(function(Ve){return Ve&&Ne(Ve)}):X.openCursor(Te);function Ne(Ve){return Object.create(Ve,{continue:{value:function(He){He!=null?Ve.continue(lb(He,Te.reverse?B.MAX_KEY:B.MIN_KEY,Ce)):Te.unique?Ve.continue(Ve.key.slice(0,Me).concat(Te.reverse?B.MIN_KEY:B.MAX_KEY,Ce)):Ve.continue()}},continuePrimaryKey:{value:function(He,rt){Ve.continuePrimaryKey(lb(He,B.MAX_KEY,Ce),rt)}},primaryKey:{get:function(){return Ve.primaryKey}},key:{get:function(){var He=Ve.key;return Me===1?He[0]:He.slice(0,Me)}},value:{get:function(){return Ve.value}}})}}})}})}};function cb(B,G,X,ee){return X=X||{},ee=ee||"",s(B).forEach(function(ae){var de,ge,ye;d(G,ae)?(de=B[ae],ge=G[ae],typeof de=="object"&&typeof ge=="object"&&de&&ge?(ye=N(de))!==N(ge)?X[ee+ae]=G[ae]:ye==="Object"?cb(de,ge,X,ee+ae+"."):de!==ge&&(X[ee+ae]=G[ae]):de!==ge&&(X[ee+ae]=G[ae])):X[ee+ae]=void 0}),s(G).forEach(function(ae){d(B,ae)||(X[ee+ae]=G[ae])}),X}function ub(B,G){return G.type==="delete"?G.keys:G.keys||G.values.map(B.extractKey)}var P2={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(B){return r(r({},B),{table:function(G){var X=B.table(G),ee=X.schema.primaryKey;return r(r({},X),{mutate:function(ae){var de=De.trans,ge=de.table(G).hook,ye=ge.deleting,Ee=ge.creating,Pe=ge.updating;switch(ae.type){case"add":if(Ee.fire===re)break;return de._promise("readwrite",function(){return Ae(ae)},!0);case"put":if(Ee.fire===re&&Pe.fire===re)break;return de._promise("readwrite",function(){return Ae(ae)},!0);case"delete":if(ye.fire===re)break;return de._promise("readwrite",function(){return Ae(ae)},!0);case"deleteRange":if(ye.fire===re)break;return de._promise("readwrite",function(){return(function Te(_e,Ce,Re){return X.query({trans:_e,values:!1,query:{index:ee,range:Ce},limit:Re}).then(function(Me){var Ne=Me.result;return Ae({type:"delete",keys:Ne,trans:_e}).then(function(Ve){return 0<Ve.numFailures?Promise.reject(Ve.failures[0]):Ne.length<Re?{failures:[],numFailures:0,lastResult:void 0}:Te(_e,r(r({},Ce),{lower:Ne[Ne.length-1],lowerOpen:!0}),Re)})})})(ae.trans,ae.range,1e4)},!0)}return X.mutate(ae);function Ae(Te){var _e,Ce,Re,Me=De.trans,Ne=Te.keys||ub(ee,Te);if(!Ne)throw new Error("Keys missing");return(Te=Te.type==="add"||Te.type==="put"?r(r({},Te),{keys:Ne}):r({},Te)).type!=="delete"&&(Te.values=n([],Te.values)),Te.keys&&(Te.keys=n([],Te.keys)),_e=X,Re=Ne,((Ce=Te).type==="add"?Promise.resolve([]):_e.getMany({trans:Ce.trans,keys:Re,cache:"immutable"})).then(function(Ve){var He=Ne.map(function(rt,ct){var Rt,Bt,St,kt=Ve[ct],Ot={onerror:null,onsuccess:null};return Te.type==="delete"?ye.fire.call(Ot,rt,kt,Me):Te.type==="add"||kt===void 0?(Rt=Ee.fire.call(Ot,rt,Te.values[ct],Me),rt==null&&Rt!=null&&(Te.keys[ct]=rt=Rt,ee.outbound||S(Te.values[ct],ee.keyPath,rt))):(Rt=cb(kt,Te.values[ct]),(Bt=Pe.fire.call(Ot,Rt,rt,kt,Me))&&(St=Te.values[ct],Object.keys(Bt).forEach(function(xt){d(St,xt)?St[xt]=Bt[xt]:S(St,xt,Bt[xt])}))),Ot});return X.mutate(Te).then(function(rt){for(var ct=rt.failures,Rt=rt.results,Bt=rt.numFailures,rt=rt.lastResult,St=0;St<Ne.length;++St){var kt=(Rt||Ne)[St],Ot=He[St];kt==null?Ot.onerror&&Ot.onerror(ct[St]):Ot.onsuccess&&Ot.onsuccess(Te.type==="put"&&Ve[St]?Te.values[St]:kt)}return{failures:ct,results:Rt,numFailures:Bt,lastResult:rt}}).catch(function(rt){return He.forEach(function(ct){return ct.onerror&&ct.onerror(rt)}),Promise.reject(rt)})})}}})}})}};function dM(B,G,X){try{if(!G||G.keys.length<B.length)return null;for(var ee=[],ae=0,de=0;ae<G.keys.length&&de<B.length;++ae)Kt(G.keys[ae],B[de])===0&&(ee.push(X?M(G.values[ae]):G.values[ae]),++de);return ee.length===B.length?ee:null}catch{return null}}var pM={stack:"dbcore",level:-1,create:function(B){return{table:function(G){var X=B.table(G);return r(r({},X),{getMany:function(ee){if(!ee.cache)return X.getMany(ee);var ae=dM(ee.keys,ee.trans._cache,ee.cache==="clone");return ae?Fe.resolve(ae):X.getMany(ee).then(function(de){return ee.trans._cache={keys:ee.keys,values:ee.cache==="clone"?M(de):de},de})},mutate:function(ee){return ee.type!=="add"&&(ee.trans._cache=null),X.mutate(ee)}})}}}};function hM(B,G){return B.trans.mode==="readonly"&&!!B.subscr&&!B.trans.explicit&&B.trans.db._options.cache!=="disabled"&&!G.schema.primaryKey.outbound}function fu(B,G){switch(B){case"query":return G.values&&!G.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var lv={stack:"dbcore",level:0,name:"Observability",create:function(B){var G=B.schema.name,X=new Eo(B.MIN_KEY,B.MAX_KEY);return r(r({},B),{transaction:function(ee,ae,de){if(De.subscr&&ae!=="readonly")throw new K.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(De.querier));return B.transaction(ee,ae,de)},table:function(ee){var ae=B.table(ee),de=ae.schema,ge=de.primaryKey,Te=de.indexes,ye=ge.extractKey,Ee=ge.outbound,Pe=ge.autoIncrement&&Te.filter(function(Ce){return Ce.compound&&Ce.keyPath.includes(ge.keyPath)}),Ae=r(r({},ae),{mutate:function(Ce){function Re(xt){return xt="idb://".concat(G,"/").concat(ee,"/").concat(xt),rt[xt]||(rt[xt]=new Eo)}var Me,Ne,Ve,He=Ce.trans,rt=Ce.mutatedParts||(Ce.mutatedParts={}),ct=Re(""),Rt=Re(":dels"),Bt=Ce.type,Ot=Ce.type==="deleteRange"?[Ce.range]:Ce.type==="delete"?[Ce.keys]:Ce.values.length<50?[ub(ge,Ce).filter(function(xt){return xt}),Ce.values]:[],St=Ot[0],kt=Ot[1],Ot=Ce.trans._cache;return o(St)?(ct.addKeys(St),(Ot=Bt==="delete"||St.length===kt.length?dM(St,Ot):null)||Rt.addKeys(St),(Ot||kt)&&(Me=Re,Ne=Ot,Ve=kt,de.indexes.forEach(function(xt){var ei=Me(xt.name||"");function dr(Ur){return Ur!=null?xt.extractKey(Ur):null}function zi(Ur){return xt.multiEntry&&o(Ur)?Ur.forEach(function(Kl){return ei.addKey(Kl)}):ei.addKey(Ur)}(Ne||Ve).forEach(function(Ur,Go){var Ki=Ne&&dr(Ne[Go]),Go=Ve&&dr(Ve[Go]);Kt(Ki,Go)!==0&&(Ki!=null&&zi(Ki),Go!=null&&zi(Go))})}))):St?(kt={from:(kt=St.lower)!==null&&kt!==void 0?kt:B.MIN_KEY,to:(kt=St.upper)!==null&&kt!==void 0?kt:B.MAX_KEY},Rt.add(kt),ct.add(kt)):(ct.add(X),Rt.add(X),de.indexes.forEach(function(xt){return Re(xt.name).add(X)})),ae.mutate(Ce).then(function(xt){return!St||Ce.type!=="add"&&Ce.type!=="put"||(ct.addKeys(xt.results),Pe&&Pe.forEach(function(ei){for(var dr=Ce.values.map(function(Ki){return ei.extractKey(Ki)}),zi=ei.keyPath.findIndex(function(Ki){return Ki===ge.keyPath}),Ur=0,Kl=xt.results.length;Ur<Kl;++Ur)dr[Ur][zi]=xt.results[Ur];Re(ei.name).addKeys(dr)})),He.mutatedParts=av(He.mutatedParts||{},rt),xt})}}),Te=function(Re){var Me=Re.query,Re=Me.index,Me=Me.range;return[Re,new Eo((Re=Me.lower)!==null&&Re!==void 0?Re:B.MIN_KEY,(Me=Me.upper)!==null&&Me!==void 0?Me:B.MAX_KEY)]},_e={get:function(Ce){return[ge,new Eo(Ce.key)]},getMany:function(Ce){return[ge,new Eo().addKeys(Ce.keys)]},count:Te,query:Te,openCursor:Te};return s(_e).forEach(function(Ce){Ae[Ce]=function(Re){var Me=De.subscr,Ne=!!Me,Ve=hM(De,ae)&&fu(Ce,Re)?Re.obsSet={}:Me;if(Ne){var He=function(kt){return kt="idb://".concat(G,"/").concat(ee,"/").concat(kt),Ve[kt]||(Ve[kt]=new Eo)},rt=He(""),ct=He(":dels"),Me=_e[Ce](Re),Ne=Me[0],Me=Me[1];if((Ce==="query"&&Ne.isPrimaryKey&&!Re.values?ct:He(Ne.name||"")).add(Me),!Ne.isPrimaryKey){if(Ce!=="count"){var Rt=Ce==="query"&&Ee&&Re.values&&ae.query(r(r({},Re),{values:!1}));return ae[Ce].apply(this,arguments).then(function(kt){if(Ce==="query"){if(Ee&&Re.values)return Rt.then(function(dr){return dr=dr.result,rt.addKeys(dr),kt});var Ot=Re.values?kt.result.map(ye):kt.result;(Re.values?rt:ct).addKeys(Ot)}else if(Ce==="openCursor"){var xt=kt,ei=Re.values;return xt&&Object.create(xt,{key:{get:function(){return ct.addKey(xt.primaryKey),xt.key}},primaryKey:{get:function(){var dr=xt.primaryKey;return ct.addKey(dr),dr}},value:{get:function(){return ei&&rt.addKey(xt.primaryKey),xt.value}}})}return kt})}ct.add(X)}}return ae[Ce].apply(this,arguments)}}),Ae}})}};function fM(B,G,X){if(X.numFailures===0)return G;if(G.type==="deleteRange")return null;var ee=G.keys?G.keys.length:"values"in G&&G.values?G.values.length:1;return X.numFailures===ee?null:(G=r({},G),o(G.keys)&&(G.keys=G.keys.filter(function(ae,de){return!(de in X.failures)})),"values"in G&&o(G.values)&&(G.values=G.values.filter(function(ae,de){return!(de in X.failures)})),G)}function sd(B,G){return X=B,((ee=G).lower===void 0||(ee.lowerOpen?0<Kt(X,ee.lower):0<=Kt(X,ee.lower)))&&(B=B,(G=G).upper===void 0||(G.upperOpen?Kt(B,G.upper)<0:Kt(B,G.upper)<=0));var X,ee}function mM(B,G,_e,ee,ae,de){if(!_e||_e.length===0)return B;var ge=G.query.index,ye=ge.multiEntry,Ee=G.query.range,Pe=ee.schema.primaryKey.extractKey,Ae=ge.extractKey,Te=(ge.lowLevelIndex||ge).extractKey,_e=_e.reduce(function(Ce,Re){var Me=Ce,Ne=[];if(Re.type==="add"||Re.type==="put")for(var Ve=new Eo,He=Re.values.length-1;0<=He;--He){var rt,ct=Re.values[He],Rt=Pe(ct);Ve.hasKey(Rt)||(rt=Ae(ct),(ye&&o(rt)?rt.some(function(xt){return sd(xt,Ee)}):sd(rt,Ee))&&(Ve.addKey(Rt),Ne.push(ct)))}switch(Re.type){case"add":var Bt=new Eo().addKeys(G.values?Ce.map(function(ei){return Pe(ei)}):Ce),Me=Ce.concat(G.values?Ne.filter(function(ei){return ei=Pe(ei),!Bt.hasKey(ei)&&(Bt.addKey(ei),!0)}):Ne.map(function(ei){return Pe(ei)}).filter(function(ei){return!Bt.hasKey(ei)&&(Bt.addKey(ei),!0)}));break;case"put":var St=new Eo().addKeys(Re.values.map(function(ei){return Pe(ei)}));Me=Ce.filter(function(ei){return!St.hasKey(G.values?Pe(ei):ei)}).concat(G.values?Ne:Ne.map(function(ei){return Pe(ei)}));break;case"delete":var kt=new Eo().addKeys(Re.keys);Me=Ce.filter(function(ei){return!kt.hasKey(G.values?Pe(ei):ei)});break;case"deleteRange":var Ot=Re.range;Me=Ce.filter(function(ei){return!sd(Pe(ei),Ot)})}return Me},B);return _e===B?B:(_e.sort(function(Ce,Re){return Kt(Te(Ce),Te(Re))||Kt(Pe(Ce),Pe(Re))}),G.limit&&G.limit<1/0&&(_e.length>G.limit?_e.length=G.limit:B.length===G.limit&&_e.length<G.limit&&(ae.dirty=!0)),de?Object.freeze(_e):_e)}function Lm(B,G){return Kt(B.lower,G.lower)===0&&Kt(B.upper,G.upper)===0&&!!B.lowerOpen==!!G.lowerOpen&&!!B.upperOpen==!!G.upperOpen}function C2(B,G){return(function(X,ee,ae,de){if(X===void 0)return ee!==void 0?-1:0;if(ee===void 0)return 1;if((ee=Kt(X,ee))===0){if(ae&&de)return 0;if(ae)return 1;if(de)return-1}return ee})(B.lower,G.lower,B.lowerOpen,G.lowerOpen)<=0&&0<=(function(X,ee,ae,de){if(X===void 0)return ee!==void 0?1:0;if(ee===void 0)return-1;if((ee=Kt(X,ee))===0){if(ae&&de)return 0;if(ae)return-1;if(de)return 1}return ee})(B.upper,G.upper,B.upperOpen,G.upperOpen)}function db(B,G,X,ee){B.subscribers.add(X),ee.addEventListener("abort",function(){var ae,de;B.subscribers.delete(X),B.subscribers.size===0&&(ae=B,de=G,setTimeout(function(){ae.subscribers.size===0&&O(de,ae)},3e3))})}var gM={stack:"dbcore",level:0,name:"Cache",create:function(B){var G=B.schema.name;return r(r({},B),{transaction:function(X,ee,ae){var de,ge,ye=B.transaction(X,ee,ae);return ee==="readwrite"&&(ge=(de=new AbortController).signal,ae=function(Ee){return function(){if(de.abort(),ee==="readwrite"){for(var Pe=new Set,Ae=0,Te=X;Ae<Te.length;Ae++){var _e=Te[Ae],Ce=hf["idb://".concat(G,"/").concat(_e)];if(Ce){var Re=B.table(_e),Me=Ce.optimisticOps.filter(function(ei){return ei.trans===ye});if(ye._explicit&&Ee&&ye.mutatedParts)for(var Ne=0,Ve=Object.values(Ce.queries.query);Ne<Ve.length;Ne++)for(var He=0,rt=(Bt=Ve[Ne]).slice();He<rt.length;He++)rE((St=rt[He]).obsSet,ye.mutatedParts)&&(O(Bt,St),St.subscribers.forEach(function(ei){return Pe.add(ei)}));else if(0<Me.length){Ce.optimisticOps=Ce.optimisticOps.filter(function(ei){return ei.trans!==ye});for(var ct=0,Rt=Object.values(Ce.queries.query);ct<Rt.length;ct++)for(var Bt,St,kt,Ot=0,xt=(Bt=Rt[ct]).slice();Ot<xt.length;Ot++)(St=xt[Ot]).res!=null&&ye.mutatedParts&&(Ee&&!St.dirty?(kt=Object.isFrozen(St.res),kt=mM(St.res,St.req,Me,Re,St,kt),St.dirty?(O(Bt,St),St.subscribers.forEach(function(ei){return Pe.add(ei)})):kt!==St.res&&(St.res=kt,St.promise=Fe.resolve({result:kt}))):(St.dirty&&O(Bt,St),St.subscribers.forEach(function(ei){return Pe.add(ei)})))}}}Pe.forEach(function(ei){return ei()})}}},ye.addEventListener("abort",ae(!1),{signal:ge}),ye.addEventListener("error",ae(!1),{signal:ge}),ye.addEventListener("complete",ae(!0),{signal:ge})),ye},table:function(X){var ee=B.table(X),ae=ee.schema.primaryKey;return r(r({},ee),{mutate:function(de){var ge=De.trans;if(ae.outbound||ge.db._options.cache==="disabled"||ge.explicit||ge.idbtrans.mode!=="readwrite")return ee.mutate(de);var ye=hf["idb://".concat(G,"/").concat(X)];return ye?(ge=ee.mutate(de),de.type!=="add"&&de.type!=="put"||!(50<=de.values.length||ub(ae,de).some(function(Ee){return Ee==null}))?(ye.optimisticOps.push(de),de.mutatedParts&&$d(de.mutatedParts),ge.then(function(Ee){0<Ee.numFailures&&(O(ye.optimisticOps,de),(Ee=fM(0,de,Ee))&&ye.optimisticOps.push(Ee),de.mutatedParts&&$d(de.mutatedParts))}),ge.catch(function(){O(ye.optimisticOps,de),de.mutatedParts&&$d(de.mutatedParts)})):ge.then(function(Ee){var Pe=fM(0,r(r({},de),{values:de.values.map(function(Ae,Te){var _e;return Ee.failures[Te]?Ae:(Ae=(_e=ae.keyPath)!==null&&_e!==void 0&&_e.includes(".")?M(Ae):r({},Ae),S(Ae,ae.keyPath,Ee.results[Te]),Ae)})}),Ee);ye.optimisticOps.push(Pe),queueMicrotask(function(){return de.mutatedParts&&$d(de.mutatedParts)})}),ge):ee.mutate(de)},query:function(de){if(!hM(De,ee)||!fu("query",de))return ee.query(de);var ge=((Pe=De.trans)===null||Pe===void 0?void 0:Pe.db._options.cache)==="immutable",Te=De,ye=Te.requery,Ee=Te.signal,Pe=(function(Re,Me,Ne,Ve){var He=hf["idb://".concat(Re,"/").concat(Me)];if(!He)return[];if(!(Me=He.queries[Ne]))return[null,!1,He,null];var rt=Me[(Ve.query?Ve.query.index.name:null)||""];if(!rt)return[null,!1,He,null];switch(Ne){case"query":var ct=rt.find(function(Rt){return Rt.req.limit===Ve.limit&&Rt.req.values===Ve.values&&Lm(Rt.req.query.range,Ve.query.range)});return ct?[ct,!0,He,rt]:[rt.find(function(Rt){return("limit"in Rt.req?Rt.req.limit:1/0)>=Ve.limit&&(!Ve.values||Rt.req.values)&&C2(Rt.req.query.range,Ve.query.range)}),!1,He,rt];case"count":return ct=rt.find(function(Rt){return Lm(Rt.req.query.range,Ve.query.range)}),[ct,!!ct,He,rt]}})(G,X,"query",de),Ae=Pe[0],Te=Pe[1],_e=Pe[2],Ce=Pe[3];return Ae&&Te?Ae.obsSet=de.obsSet:(Te=ee.query(de).then(function(Re){var Me=Re.result;if(Ae&&(Ae.res=Me),ge){for(var Ne=0,Ve=Me.length;Ne<Ve;++Ne)Object.freeze(Me[Ne]);Object.freeze(Me)}else Re.result=M(Me);return Re}).catch(function(Re){return Ce&&Ae&&O(Ce,Ae),Promise.reject(Re)}),Ae={obsSet:de.obsSet,promise:Te,subscribers:new Set,type:"query",req:de,dirty:!1},Ce?Ce.push(Ae):(Ce=[Ae],(_e=_e||(hf["idb://".concat(G,"/").concat(X)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[de.query.index.name||""]=Ce)),db(Ae,Ce,ye,Ee),Ae.promise.then(function(Re){return{result:mM(Re.result,de,_e?.optimisticOps,ee,Ae,ge)}})}})}})}};function Fm(B,G){return new Proxy(B,{get:function(X,ee,ae){return ee==="db"?G:Reflect.get(X,ee,ae)}})}var Hp=(Ln.prototype.version=function(B){if(isNaN(B)||B<.1)throw new K.Type("Given version is not a positive number");if(B=Math.round(10*B)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,B);var G=this._versions,X=G.filter(function(ee){return ee._cfg.version===B})[0];return X||(X=new this.Version(B),G.push(X),G.sort(ur),X.stores({}),this._state.autoSchema=!1,X)},Ln.prototype._whenReady=function(B){var G=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?B():new Fe(function(X,ee){if(G._state.openComplete)return ee(new K.DatabaseClosed(G._state.dbOpenError));if(!G._state.isBeingOpened){if(!G._state.autoOpen)return void ee(new K.DatabaseClosed);G.open().catch(re)}G._state.dbReadyPromise.then(X,ee)}).then(B)},Ln.prototype.use=function(B){var G=B.stack,X=B.create,ee=B.level,ae=B.name;return ae&&this.unuse({stack:G,name:ae}),B=this._middlewares[G]||(this._middlewares[G]=[]),B.push({stack:G,create:X,level:ee??10,name:ae}),B.sort(function(de,ge){return de.level-ge.level}),this},Ln.prototype.unuse=function(B){var G=B.stack,X=B.name,ee=B.create;return G&&this._middlewares[G]&&(this._middlewares[G]=this._middlewares[G].filter(function(ae){return ee?ae.create!==ee:!!X&&ae.name!==X})),this},Ln.prototype.open=function(){var B=this;return Sc($e,function(){return hu(B)})},Ln.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var B=this._state,G=Gl.indexOf(this);if(0<=G&&Gl.splice(G,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}B.isBeingOpened||(B.dbReadyPromise=new Fe(function(X){B.dbReadyResolve=X}),B.openCanceller=new Fe(function(X,ee){B.cancelOpen=ee}))},Ln.prototype.close=function(X){var G=(X===void 0?{disableAutoOpen:!0}:X).disableAutoOpen,X=this._state;G?(X.isBeingOpened&&X.cancelOpen(new K.DatabaseClosed),this._close(),X.autoOpen=!1,X.dbOpenError=new K.DatabaseClosed):(this._close(),X.autoOpen=this._options.autoOpen||X.isBeingOpened,X.openComplete=!1,X.dbOpenError=null)},Ln.prototype.delete=function(B){var G=this;B===void 0&&(B={disableAutoOpen:!0});var X=0<arguments.length&&typeof arguments[0]!="object",ee=this._state;return new Fe(function(ae,de){function ge(){G.close(B);var ye=G._deps.indexedDB.deleteDatabase(G.name);ye.onsuccess=tn(function(){var Ee,Pe,Ae;Ee=G._deps,Pe=G.name,Ae=Ee.indexedDB,Ee=Ee.IDBKeyRange,rS(Ae)||Pe===Hl||tE(Ae,Ee).delete(Pe).catch(re),ae()}),ye.onerror=va(de),ye.onblocked=G._fireOnBlocked}if(X)throw new K.InvalidArgument("Invalid closeOptions argument to db.delete()");ee.isBeingOpened?ee.dbReadyPromise.then(ge):ge()})},Ln.prototype.backendDB=function(){return this.idbdb},Ln.prototype.isOpen=function(){return this.idbdb!==null},Ln.prototype.hasBeenClosed=function(){var B=this._state.dbOpenError;return B&&B.name==="DatabaseClosed"},Ln.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ln.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ln.prototype,"tables",{get:function(){var B=this;return s(this._allTables).map(function(G){return B._allTables[G]})},enumerable:!1,configurable:!0}),Ln.prototype.transaction=function(){var B=(function(G,X,ee){var ae=arguments.length;if(ae<2)throw new K.InvalidArgument("Too few arguments");for(var de=new Array(ae-1);--ae;)de[ae-1]=arguments[ae];return ee=de.pop(),[G,E(de),ee]}).apply(this,arguments);return this._transaction.apply(this,B)},Ln.prototype._transaction=function(B,G,X){var ee=this,ae=De.trans;ae&&ae.db===this&&B.indexOf("!")===-1||(ae=null);var de,ge,ye=B.indexOf("?")!==-1;B=B.replace("!","").replace("?","");try{if(ge=G.map(function(Pe){if(Pe=Pe instanceof ee.Table?Pe.name:Pe,typeof Pe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Pe}),B=="r"||B===Od)de=Od;else{if(B!="rw"&&B!=zl)throw new K.InvalidArgument("Invalid transaction mode: "+B);de=zl}if(ae){if(ae.mode===Od&&de===zl){if(!ye)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");ae=null}ae&&ge.forEach(function(Pe){if(ae&&ae.storeNames.indexOf(Pe)===-1){if(!ye)throw new K.SubTransaction("Table "+Pe+" not included in parent transaction.");ae=null}}),ye&&ae&&!ae.active&&(ae=null)}}catch(Pe){return ae?ae._promise(null,function(Ae,Te){Te(Pe)}):$n(Pe)}var Ee=(function Pe(Ae,Te,_e,Ce,Re){return Fe.resolve().then(function(){var Me=De.transless||De,Ne=Ae._createTransaction(Te,_e,Ae._dbSchema,Ce);if(Ne.explicit=!0,Me={trans:Ne,transless:Me},Ce)Ne.idbtrans=Ce.idbtrans;else try{Ne.create(),Ne.idbtrans._explicit=!0,Ae._state.PR1398_maxLoop=3}catch(rt){return rt.name===J.InvalidState&&Ae.isOpen()&&0<--Ae._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ae.close({disableAutoOpen:!1}),Ae.open().then(function(){return Pe(Ae,Te,_e,null,Re)})):$n(rt)}var Ve,He=j(Re);return He&&Hs(),Me=Fe.follow(function(){var rt;(Ve=Re.call(Ne,Ne))&&(He?(rt=zs.bind(null,null),Ve.then(rt,rt)):typeof Ve.next=="function"&&typeof Ve.throw=="function"&&(Ve=sS(Ve)))},Me),(Ve&&typeof Ve.then=="function"?Fe.resolve(Ve).then(function(rt){return Ne.active?rt:$n(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Me.then(function(){return Ve})).then(function(rt){return Ce&&Ne._resolve(),Ne._completion.then(function(){return rt})}).catch(function(rt){return Ne._reject(rt),$n(rt)})})}).bind(null,this,de,ge,ae,X);return ae?ae._promise(de,Ee,"lock"):De.trans?Sc(De.transless,function(){return ee._whenReady(Ee)}):this._whenReady(Ee)},Ln.prototype.table=function(B){if(!d(this._allTables,B))throw new K.InvalidTable("Table ".concat(B," does not exist"));return this._allTables[B]},Ln);function Ln(B,G){var X=this;this._middlewares={},this.verno=0;var ee=Ln.dependencies;this._options=G=r({addons:Ln.addons,autoOpen:!0,indexedDB:ee.indexedDB,IDBKeyRange:ee.IDBKeyRange,cache:"cloned"},G),this._deps={indexedDB:G.indexedDB,IDBKeyRange:G.IDBKeyRange},ee=G.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var ae,de,ge,ye,Ee,Pe={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:G.autoOpen};Pe.dbReadyPromise=new Fe(function(Te){Pe.dbReadyResolve=Te}),Pe.openCanceller=new Fe(function(Te,_e){Pe.cancelOpen=_e}),this._state=Pe,this.name=B,this.on=ql(this,"populate","blocked","versionchange","close",{ready:[It,re]}),this.once=function(Te,_e){var Ce=function(){for(var Re=[],Me=0;Me<arguments.length;Me++)Re[Me]=arguments[Me];X.on(Te).unsubscribe(Ce),_e.apply(X,Re)};return X.on(Te,Ce)},this.on.ready.subscribe=b(this.on.ready.subscribe,function(Te){return function(_e,Ce){Ln.vip(function(){var Re,Me=X._state;Me.openComplete?(Me.dbOpenError||Fe.resolve().then(_e),Ce&&Te(_e)):Me.onReadyBeingFired?(Me.onReadyBeingFired.push(_e),Ce&&Te(_e)):(Te(_e),Re=X,Ce||Te(function Ne(){Re.on.ready.unsubscribe(_e),Re.on.ready.unsubscribe(Ne)}))})}}),this.Collection=(ae=this,Ya(Uc.prototype,function(Ve,Ne){this.db=ae;var Ce=ou,Re=null;if(Ne)try{Ce=Ne()}catch(He){Re=He}var Me=Ve._ctx,Ne=Me.table,Ve=Ne.hook.reading.fire;this._ctx={table:Ne,index:Me.index,isPrimKey:!Me.index||Ne.schema.primKey.keyPath&&Me.index===Ne.schema.primKey.name,range:Ce,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Re,or:Me.or,valueMapper:Ve!==me?Ve:null}})),this.Table=(de=this,Ya(fn.prototype,function(Te,_e,Ce){this.db=de,this._tx=Ce,this.name=Te,this.schema=_e,this.hook=de._allTables[Te]?de._allTables[Te].hook:ql(null,{creating:[Le,re],reading:[he,me],updating:[at,re],deleting:[ot,re]})})),this.Transaction=(ge=this,Ya(pf.prototype,function(Te,_e,Ce,Re,Me){var Ne=this;Te!=="readonly"&&_e.forEach(function(Ve){Ve=(Ve=Ce[Ve])===null||Ve===void 0?void 0:Ve.yProps,Ve&&(_e=_e.concat(Ve.map(function(He){return He.updatesTable})))}),this.db=ge,this.mode=Te,this.storeNames=_e,this.schema=Ce,this.chromeTransactionDurability=Re,this.idbtrans=null,this.on=ql(this,"complete","error","abort"),this.parent=Me||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Fe(function(Ve,He){Ne._resolve=Ve,Ne._reject=He}),this._completion.then(function(){Ne.active=!1,Ne.on.complete.fire()},function(Ve){var He=Ne.active;return Ne.active=!1,Ne.on.error.fire(Ve),Ne.parent?Ne.parent._reject(Ve):He&&Ne.idbtrans&&Ne.idbtrans.abort(),$n(Ve)})})),this.Version=(ye=this,Ya(nv.prototype,function(Te){this.db=ye,this._cfg={version:Te,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Ee=this,Ya(km.prototype,function(Te,_e,Ce){if(this.db=Ee,this._ctx={table:Te,index:_e===":id"?null:_e,or:Ce},this._cmp=this._ascending=Kt,this._descending=function(Re,Me){return Kt(Me,Re)},this._max=function(Re,Me){return 0<Kt(Re,Me)?Re:Me},this._min=function(Re,Me){return Kt(Re,Me)<0?Re:Me},this._IDBKeyRange=Ee._deps.IDBKeyRange,!this._IDBKeyRange)throw new K.MissingAPI})),this.on("versionchange",function(Te){0<Te.newVersion?console.warn("Another connection wants to upgrade database '".concat(X.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(X.name,"'. Closing db now to resume the delete request.")),X.close({disableAutoOpen:!1})}),this.on("blocked",function(Te){!Te.newVersion||Te.newVersion<Te.oldVersion?console.warn("Dexie.delete('".concat(X.name,"') was blocked")):console.warn("Upgrade '".concat(X.name,"' blocked by other connection holding version ").concat(Te.oldVersion/10))}),this._maxKey=pl(G.IDBKeyRange),this._createTransaction=function(Te,_e,Ce,Re){return new X.Transaction(Te,_e,Ce,X._options.chromeTransactionDurability,Re)},this._fireOnBlocked=function(Te){X.on("blocked").fire(Te),Gl.filter(function(_e){return _e.name===X.name&&_e!==X&&!_e._state.vcFired}).map(function(_e){return _e.on("versionchange").fire(Te)})},this.use(pM),this.use(gM),this.use(lv),this.use(E2),this.use(P2);var Ae=new Proxy(this,{get:function(Te,_e,Ce){if(_e==="_vip")return!0;if(_e==="table")return function(Me){return Fm(X.table(Me),Ae)};var Re=Reflect.get(Te,_e,Ce);return Re instanceof fn?Fm(Re,Ae):_e==="tables"?Re.map(function(Me){return Fm(Me,Ae)}):_e==="_createTransaction"?function(){return Fm(Re.apply(this,arguments),Ae)}:Re}});this.vip=Ae,ee.forEach(function(Te){return Te(X)})}var Bm,mu=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",aE=(sE.prototype.subscribe=function(B,G,X){return this._subscribe(B&&typeof B!="function"?B:{next:B,error:G,complete:X})},sE.prototype[mu]=function(){return this},sE);function sE(B){this._subscribe=B}try{Bm={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{Bm={indexedDB:null,IDBKeyRange:null}}function Vd(B){var G,X=!1,ee=new aE(function(ae){var de=j(B),ge,ye=!1,Ee={},Pe={},Ae={get closed(){return ye},unsubscribe:function(){ye||(ye=!0,ge&&ge.abort(),Te&&Vo.storagemutated.unsubscribe(Ce))}};ae.start&&ae.start(Ae);var Te=!1,_e=function(){return fa(Re)},Ce=function(Me){av(Ee,Me),rE(Pe,Ee)&&_e()},Re=function(){var Me,Ne,Ve;!ye&&Bm.indexedDB&&(Ee={},Me={},ge&&ge.abort(),ge=new AbortController,Ve=(function(He){var rt=$i();try{de&&Hs();var ct=Uo(B,He);return ct=de?ct.finally(zs):ct}finally{rt&&Wr()}})(Ne={subscr:Me,signal:ge.signal,requery:_e,querier:B,trans:null}),Promise.resolve(Ve).then(function(He){X=!0,G=He,ye||Ne.signal.aborted||(Ee={},(function(rt){for(var ct in rt)if(d(rt,ct))return;return 1})(Pe=Me)||Te||(Vo(xd,Ce),Te=!0),fa(function(){return!ye&&ae.next&&ae.next(He)}))},function(He){X=!1,["DatabaseClosedError","AbortError"].includes(He?.name)||ye||fa(function(){ye||ae.error&&ae.error(He)})}))};return setTimeout(_e,0),Ae});return ee.hasValue=function(){return X},ee.getValue=function(){return G},ee}var $m=Hp;function ff(B){var G=jo;try{jo=!0,Vo.storagemutated.fire(B),nE(B,!0)}finally{jo=G}}p($m,r(r({},le),{delete:function(B){return new $m(B,{addons:[]}).delete()},exists:function(B){return new $m(B,{addons:[]}).open().then(function(G){return G.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(B){try{return G=$m.dependencies,X=G.indexedDB,G=G.IDBKeyRange,(rS(X)?Promise.resolve(X.databases()).then(function(ee){return ee.map(function(ae){return ae.name}).filter(function(ae){return ae!==Hl})}):tE(X,G).toCollection().primaryKeys()).then(B)}catch{return $n(new K.MissingAPI)}var G,X},defineClass:function(){return function(B){l(this,B)}},ignoreTransaction:function(B){return De.trans?Sc(De.transless,B):B()},vip:Bd,async:function(B){return function(){try{var G=sS(B.apply(this,arguments));return G&&typeof G.then=="function"?G:Fe.resolve(G)}catch(X){return $n(X)}}},spawn:function(B,G,X){try{var ee=sS(B.apply(X,G||[]));return ee&&typeof ee.then=="function"?ee:Fe.resolve(ee)}catch(ae){return $n(ae)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(B,G){return G=Fe.resolve(typeof B=="function"?$m.ignoreTransaction(B):B).timeout(G||6e4),De.trans?De.trans.waitFor(G):G},Promise:Fe,debug:{get:function(){return ze},set:function(B){Ct(B)}},derive:m,extend:l,props:p,override:b,Events:ql,on:Vo,liveQuery:Vd,extendObservabilitySet:av,getByKeyPath:T,setByKeyPath:S,delByKeyPath:function(B,G){typeof G=="string"?S(B,G,void 0):"length"in G&&[].map.call(G,function(X){S(B,X,void 0)})},shallowClone:D,deepClone:M,getObjectDiff:cb,cmp:Kt,asap:w,minKey:-1/0,addons:[],connections:Gl,errnames:J,dependencies:Bm,cache:hf,semVer:"4.2.1",version:"4.2.1".split(".").map(function(B){return parseInt(B)}).reduce(function(B,G,X){return B+G/Math.pow(10,2*X)})})),$m.maxKey=pl($m.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Vo(xd,function(B){jo||(B=new CustomEvent(Ld,{detail:B}),jo=!0,dispatchEvent(B),jo=!1)}),addEventListener(Ld,function(B){B=B.detail,jo||ff(B)}));var cv,jo=!1,pb=function(){};return typeof BroadcastChannel<"u"&&((pb=function(){(cv=new BroadcastChannel(Ld)).onmessage=function(B){return B.data&&ff(B.data)}})(),typeof cv.unref=="function"&&cv.unref(),Vo(xd,function(B){jo||cv.postMessage(B)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(B){if(!Hp.disableBfCache&&B.persisted){ze&&console.debug("Dexie: handling persisted pagehide"),cv?.close();for(var G=0,X=Gl;G<X.length;G++)X[G].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(B){!Hp.disableBfCache&&B.persisted&&(ze&&console.debug("Dexie: handling persisted pageshow"),pb(),ff({all:new Eo(-1/0,[[]])}))})),Fe.rejectionMapper=function(B,G){return!B||B instanceof W||B instanceof TypeError||B instanceof SyntaxError||!B.name||!ne[B.name]?B:(G=new ne[B.name](G||B.message,B),"stack"in B&&f(G,"stack",{get:function(){return this.inner.stack}}),G)},Ct(ze),r(Hp,Object.freeze({__proto__:null,Dexie:Hp,liveQuery:Vd,Entity:Tc,cmp:Kt,PropModification:to,replacePrefix:function(B,G){return new to({replacePrefix:[B,G]})},add:function(B){return new to({add:B})},remove:function(B){return new to({remove:B})},default:Hp,RangeSet:Eo,mergeRanges:sb,rangesOverlap:iE}),{default:Hp}),Hp})})(WN)),WN.exports}var cYe=lYe();const Gj=MR(cYe),qX=Symbol.for("Dexie"),VC=globalThis[qX]||(globalThis[qX]=Gj);if(Gj.semVer!==VC.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Gj.semVer} and ${VC.semVer}`);const{liveQuery:CIt,mergeRanges:RIt,rangesOverlap:MIt,RangeSet:NIt,cmp:AIt,Entity:_It,PropModification:kIt,replacePrefix:OIt,add:xIt,remove:LIt,DexieYProvider:FIt}=VC,Oc=(function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new VC("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(r){return i(r)}}),t.resetDB=e=>{t.dex.close(),VC.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,r)=>{const n=t.dex[e];return n?n.toArray(i,r).catch(r):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,r)=>new Promise((n,a)=>t.dex[e].where(i).equals(r).toArray(n,a).catch(a)),t.deleteTournament=e=>new Promise((i,r)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,r)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,r)=>new Promise((n,a)=>{t.findWhere(e,i,r).then(s=>n(s?.length?s[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((r,n)=>t.dex[e].put(i).then(r,n).catch(a=>{alert("try again:"+a),n(a)})),t.modifyOrAddUnique=(e,i,r,n)=>new Promise((a,s)=>{t.dex[e].where(i).equals(r).modify(o=>Object.assign(o,n)).then(o=>{if(o)return a("exists");t.addItem(e,n).then(a,s)},o=>{console.log({err:o}),s(o)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,r,n,a)=>new Promise((s,o)=>{t.dex[e].where(i).equals(r).modify(l=>{Object.assign(a,{item:l}),n(a)}).then(s,l=>{console.log("error:",l),o()})}),t})(),B8="3.0.63",ai={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!1,scoring:!1,scoringV2:!0,scoringApproach:"dynamicSets",scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},serverFirst:!0,version:B8,ioc:"gbr",locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};async function $8(t){ai.log?.verbose&&console.log("%c localSave","color: yellow");const e=t?.tournamentRecord??We.getTournament()?.tournamentRecord;await Oc.addTournament(e),Pt(t?.callback)&&t?.callback&&t.callback()}const V8=phe();function RUe(){localStorage.removeItem(V8)}function MUe(){return localStorage.getItem(V8)}function uYe(t){localStorage.setItem(V8,t)}function XF(t){const e=t.tournamentName?.toLowerCase()||"Error",i=t.onlineResources?.find(({name:n,resourceType:a})=>n==="tournamentImage"&&a==="URL")?.identifier,r=t.timeItems?.find(({itemType:n})=>n==="TMX")?.itemValue?.offline;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:new Date(t.startDate).toISOString()?.split("T")[0],endDate:new Date(t.endDate).toISOString()?.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i,offline:r}}}const qw=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r?.toLowerCase();e=a=>a.searchText?.includes(n),i.forEach(a=>a.addFilter(e))}else e=void 0}};function NUe({tournamentRecord:t,callback:e}){const i=zc()?.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),$8({tournamentRecord:t,callback:e})}function dYe({callback:t,autoClose:e=!0}={}){const i=o=>{const l=o.name.split(".").reverse()[0],c=new FileReader;c.onload=function(u){if(u.target?.error){console.log("file error",u.target.error);return}const d=u.target?.result;d.length&&(Pt(t)&&t?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(o):console.log("not loaded")},r=document.createElement("div");r.className="dzx-dropzone",r.id="tmxDropzone";const n=document.createElement("label");n.className="dzx-inputLabel",n.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),n.appendChild(a),r.appendChild(n),Kr({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:r}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(o=>{r.addEventListener(o,function(l){l.preventDefault(),l.stopPropagation()})});const s="dropone-dragging";r.addEventListener("dragover",function(){this.classList.add(s)},!1),r.addEventListener("dragleave",function(){this.classList.remove(s)},!1),r.addEventListener("drop",function(o){this.classList.remove(s);const l=o.dataTransfer.files,c=new DataTransfer;Array.prototype.forEach.call(l,d=>{c.items.add(d)});const u=c.files;Array.from(u).forEach(i),e&&pU()},!1)}function AUe({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"failed normal parse",note:t})}}function pYe(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function hYe({table:t}){const e=t.getData().map(i=>i.tournamentId);dYe({callback:i=>{const r=AUe({data:i});if(r){let n,a;r.tournamentId&&r.startDate?a=r:r.tuid&&r.start&&$t({message:"TMX Classic file not converted"}),n=We.setState(a),n.success?z0({tournamentRecord:a,tournamentIds:e,table:t}):console.log(n)}}})}function z0({tournamentRecord:t,tournamentIds:e,table:i,callback:r}){const n=XF(t);e?.includes(t.tournamentId)?i?.updateOrAddData([n],!0):i?.addData([n],!0),NUe({tournamentRecord:t}),Pt(r)&&r&&r()}const ht={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{selectedScheduleDate:null,draw_event:null},columns:{}};function fYe({table:t}){const e=t.getData().map(c=>c.tournamentId);let i;const n=[{control:"identifier",onInput:({inputs:c})=>{const d=c.identifier.value.length>10,p=document.getElementById("fetchButton");p&&(p.disabled=!d)}}],a=c=>i=pn(c,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"Identifier",label:"identifier",field:"identifier"}],n),s=()=>{$t({onClose:()=>ht.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},o=c=>{const u=c?.data?.tournamentRecord,d=c?.data?.tournamentId,p=e.includes(d);p?console.log({exists:p}):z0({tournamentRecord:u,tournamentIds:e,table:t,callback:()=>{}})};Kr({title:"Fetch tournament details",content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Fetch",id:"fetchButton",disabled:!0,intent:"is-primary",onClick:()=>{const c=i.identifier.value;l$e({identifier:c}).then(o,s)},close:!0}]})}function mYe({table:t}){const e=t.getData().map(o=>o.tournamentId);let i;const r=o=>i=pn(o,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),n=()=>{$t({onClose:()=>ht.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=o=>{const l=i.tournamentId.value,c=o.data.tournamentRecords?.[l];z0({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};Kr({title:"Load tournament",content:r,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const o=i.tournamentId.value;Vx({tournamentId:o}).then(a,n)},close:!0}]})}function WX(t){return Ni.dateTime.dateValidation.test(t)}const Bn=(t,e)=>i=>i?.trim().length>=t&&(!e||i?.trim().length<=e);function Ww(t,e,i){if(!t)return{elements:{}};const r={};for(const n of e||[]){if(!n?.label||n.hide)continue;const a=document.createElement("button");n.id&&(r[n.id]=a,a.id=n.id),a.style.marginRight=".5em",a.className="button font-medium",n.intent&&a.classList.add(n.intent),a.innerHTML=n.label,n.disabled&&(a.disabled=!0),a.onclick=s=>{s.stopPropagation(),!s.target.disabled&&Pt(n.onClick)&&n.onClick(),i&&Pt(i)&&i()},t.appendChild(a)}return{elements:r}}function hU(t,e){const i=Array.from(t.classList).indexOf(e);return{parent:i>=0?t:Fl(t,e),index:i>=0?i:-1}}function Fl(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function hE(t,e,i){return Fl(t,e)?.getAttribute(i)||""}function Eg(t,e){const i=[];function r(n){n.childNodes.forEach(a=>{a.childNodes.length>0&&r(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return r(t),i}const gYe="addCourts",vYe="addFlight",yYe="addDrawDefinition",_Ue="addAdHocMatchUps",bYe="addDrawEntries",IYe="addDrawDefinitionExtension",wYe="addDynamicRatings",SYe="addEvent",j8="addEventEntries",TYe="addEventEntryPairs",UYe="addEventExtension",kUe="addIndividualParticipantIds",Hj="addMatchUpScheduleItems",DYe="addOnlineResource",q0="addParticipants",YX="addParticipantTimeItem",OUe="addPlayoffStructures",EYe="addTournamentExtension",PYe="addTournamentTimeItem",CYe="addVenue",RYe="attachQualifyingStructure",MYe="attachPolicies",NYe="automatedPlayoffPositioning",G8="bulkScheduleMatchUps",xUe="deleteAdHocMatchUps",KX="deleteFlightAndFlightDraw",ZX="deleteEvents",AYe="deleteParticipants",_Ye="deleteVenues",kYe="destroyPairEntries",LUe="modifyCourt",OYe="modifyEvent",FUe="modifyEntriesStatus",V_="modifyParticipant",H8="modifyParticipantsSignInStatus",xYe="modifyTieFormmat",LYe="modifyVenue",FYe="proAutoSchedule",BUe="publishEvent",BYe="removeIndividualParticipantIds",$Ye="removeStructure",$Ue="renameStructures",VYe="resetDrawDefinition",VUe="resetMatchUpLinesUps",jUe="resetScorecard",jYe="setMatchUpFormat",z8="setMatchUpStatus",GYe="setParticipantScaleItems",HYe="setTournamentDates",zYe="setTournamentName",qYe="setTournamentNotes",WYe="unPublishEvent";function GUe({table:t,tournamentRecord:e}){const i={activeDates:(e?.activeDates||[]).join(","),tournamentName:e?.tournamentName||"",startDate:e?.startDate||"",endDate:e?.endDate||""};let r;const n=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:Bn(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"},{visible:!i.activeDates.length,label:"Select active dates",field:"activeDateSelector",id:"activeDateSelector",checkbox:!0},{visible:!!i.activeDates.length,value:i.activeDates||[],placeholder:"[datesArray]",minDate:i.startDate,maxDate:i.endDate,label:"Active Dates",maxNumberOfDates:10,field:"activeDates",id:"activeDates",date:!0}],a=({tournamentName:g,startDate:v,endDate:y})=>Bn(5)(g)&&WX(v)&&WX(y),s=({inputs:g})=>{const v=g.activeDates.value,y=g.startDate.value,b=g.endDate.value,I=a({tournamentName:g.tournamentName.value,startDate:y,endDate:b});v&&(g.activeDates.value=v.split(",").filter(T=>!(y&&new Date(T)<new Date(y)||b&&new Date(T)>new Date(b))).filter(Boolean).join(",")),y&&g.activeDates.datepicker.setOptions({minDate:y}),b&&g.activeDates.datepicker.setOptions({maxDate:b});const w=document.getElementById("saveTournamentEdits");w&&(w.disabled=!I)},l=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:s},{onFocusOut:s,control:"startDate"},{onFocusOut:s,control:"endDate"},{onChange:({inputs:g})=>{const v=g.activeDateSelector.checked,y=document.getElementById("activeDates"),b=hU(y,"field");b?.parent&&(b.parent.style.display=v?"block":"none")},control:"activeDateSelector"}],c=g=>{r=pn(g,n,l),r.activeDates?.datepicker?.update()},u=()=>Bn(5)(r.drawName.value),d=()=>{const g=r.activeDates.value?.split(",").filter(Boolean),v=r.tournamentName.value?.trim(),y=r.startDate.value,b=r.endDate.value;if(e){const I={...e,tournamentName:v,activeDates:g,startDate:y,endDate:b};qt({tournamentRecord:I,methods:[{method:HYe,params:{activeDates:g,startDate:y,endDate:b}},{method:zYe,params:{tournamentName:v}}],callback:S=>{S.success?t?.updateData([XF(I)],!0):console.log({result:S})}})}else if(We.newTournamentRecord({tournamentName:v,startDate:y,endDate:b}).success){const w=zc(),T=We.getTournament()?.tournamentRecord;if(w?.providerId){const S=D=>{const C=D.data?.provider;if(T.parentOrganisation=C,C){const E=P=>console.log("sendTournament",P);KE({tournamentRecord:T}).then(()=>{},E)}XX({tournamentRecord:T,table:t})};d$e({providerId:w.providerId}).then(S)}else XX({tournamentRecord:T,table:t})}},p=e?"Save":"Add",h=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:p,intent:"is-primary",onClick:d,close:u}],f=(g,v)=>Ww(g,h,v),m=e?"Edit tournament":"New tournament";ht.drawer.open({title:m,content:c,footer:f,side:Xt,width:"300px"})}function XX({tournamentRecord:t,table:e}){z0({tournamentRecord:t,callback:()=>e?.addData([XF(t)],!0)})}const DB="font-medium";function zj({target:t,button:e,stateChange:i}){let r=0;const n=()=>(r+=1,`Item${r}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===Xt?(a.classList.add("is-right"),a.style.cssText="margin-left: 1em"):a.style.cssText="margin-right: 1em";const s=v=>v.classList.contains("is-active"),o=()=>{s(a)&&a.classList.remove("is-active")},l=v=>s(v)?(v.classList.remove("is-active"),!1):(v.classList.add("is-active"),!0);a.onmouseleave=o,a.onclick=()=>l(a);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");Pt(e.onClick)&&(d.onclick=e.onClick),d.style.cssText="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");Pt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),a.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.setAttribute("z-index","99998");const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const v=h.querySelectorAll(".dropdown-item");for(const y of Array.from(v))y.classList.remove("is-active")},g=v=>{const y=document.createElement("a");y.className=DB;const b=v.disabled?"0.4":"1";return y.style.cssText=`text-decoration: none; opacity: ${b};`,v.color&&(y.style.color=v.color),y.classList.add("dropdown-item"),v.isActive&&y.classList.add("is-active"),v.value&&(y.value=v.value),v.class&&y.classList.add(v.class),y.onclick=I=>{if(v.disabled)return;v.value&&(u.value=v.value,a.value=v.value),I.stopPropagation(),Pt(v.onClick)&&(Pt(i)&&i(),v.onClick(I)),v.close&&o();const w=s(y);m(),w?d.innerHTML=e.label:(e.selection&&l(y),e.modifyLabel&&v.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${v?.label||n()}`))},y.innerHTML=v?.label||n(),y};for(const v of e.options||[])if(v.heading){const y=document.createElement("div");y.style.cssText="font-weight: bold",y.classList.add("dropdown-item"),y.classList.add(DB),y.innerHTML=v.heading,f.appendChild(y)}else if(v.divider){const y=document.createElement("hr");y.classList.add("dropdown-divider"),y.classList.add(DB),f.appendChild(y)}else v.hide||f.appendChild(g(v));return e.options?.length&&(e.options[0].value&&(a.value=e.options[0].value),h.appendChild(f)),a.appendChild(h),t&&t.appendChild(a),a}class Bl{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class ba{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,s;for(let o=0;o<a&&(r=r[n[o]],s=r,!!r);o++);return s}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var s in e){let o=e[s],l,c;o!=null&&typeof o=="object"&&(o.__proto__===n||o.__proto__===a)&&(l=r.findIndex(u=>u.subject===o),l>-1?i[s]=r[l].copy:(c=Object.assign(Array.isArray(o)?[]:{},o),r.unshift({subject:o,copy:c}),i[s]=this.deepClone(o,c,r)))}return i}}let YYe=class HUe extends Bl{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=ba.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=ba.elOffset(e),n,a,s;switch(this.container!==document.body&&(n=ba.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,s=r.top-1;break;case"bottom":a=r.left,s=r.top+e.offsetHeight;break;case"left":a=r.left,s=r.top-1;break;case"top":a=r.left,s=r.top;break;case"center":a=r.left+e.offsetWidth/2,s=r.top+e.offsetHeight/2;break}return{x:a,y:s,offset:r}}show(e,i){var r,n,a,s,o;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,o=this.elementPositionCoords(e,i),s=o.offset,r=o.x,n=o.y):typeof e=="number"?(s={top:0,left:0},r=e,n=i):(o=this.containerEventCoords(e),r=o.x,n=o.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,s,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var s=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0);let o=Math.max(this.container.offsetHeight,s?this.container.scrollHeight:0);if(i+this.element.offsetHeight>o)if(r)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px"}else this.element.style.height=o+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new HUe(this.table,e,this),this.childPopup}},Nr=class extends Bl{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new YYe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}};var KYe={rownum:function(t,e,i,r,n,a){return a.getPosition()}};class j_ extends Nr{static moduleName="accessor";static accessors=KYe;constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupAccessor(e.definition[a]),s&&(i=!0,r[a]={accessor:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":j_.accessors[e]?i=j_.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=ba.deepClone(e.data||{});return this.table.columnManager.traverse(function(s){var o,l,c,u;s.modules.accessor&&(l=s.modules.accessor[r]||s.modules.accessor.accessor||!1,l&&(o=s.getFieldValue(a),o!="undefined"&&(u=s.getComponent(),c=typeof l.params=="function"?l.params(o,a,i,u,n):l.params,s.setFieldValue(a,l.accessor(o,a,i,c,u,n)))))}),a}}var ZYe={method:"GET"};function qj(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(qj(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(qj(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function XYe(t){var e=qj(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function zUe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+XYe(i)),t}function JYe(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var s in r.headers)e.headers||(e.headers={}),typeof e.headers[s]>"u"&&(e.headers[s]=r.headers[s]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(o=>{o.ok?o.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+o.status,o.statusText),a(o))}).catch(o=>{console.error("Ajax Load Error - Connection Error: ",o),a(o)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function Wj(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(Wj(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(Wj(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var QYe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=Wj(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};class XS extends Nr{static moduleName="ajax";static defaultConfig=ZYe;static defaultURLGenerator=zUe;static defaultLoaderPromise=JYe;static contentTypeFormatters=QYe;constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=XS.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||XS.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||XS.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var s;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),s=this.generateConfig(r),this.sendRequest(this.url,i,s)):a}setDefaultConfig(e={}){this.config=Object.assign({},XS.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}}var eKe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},tKe={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(s){e.push(s.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(s){var o=r.find(function(l){return s&&l.definition.title&&s.trim()&&l.definition.title.trim()===s.trim()});o?n.push(o):i=!1}),i||(i=!0,n=[],e[0].forEach(function(s){var o=r.find(function(l){return s&&l.field&&s.trim()&&l.field.trim()===s.trim()});o?n.push(o):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(s){var o={};s.forEach(function(l,c){n[c]&&(o[n[c].field]=l)}),a.push(o)}),a):!1}},iKe={copyToClipboard:["ctrl + 67","meta + 67"]},rKe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},nKe={keybindings:{bindings:iKe,actions:rKe}};let aKe=class Yj extends Nr{static moduleName="clipboard";static moduleExtensions=nKe;static pasteActions=eKe;static pasteParsers=tKe;constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var s="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)s="";else switch(typeof a.value){case"object":s=JSON.stringify(a.value);break;case"undefined":s="";break;default:s=a.value}n.push(s)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=Yj.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=Yj.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};class sKe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class qUe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class W0 extends Bl{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(s=>{e.classList.add(s)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new qUe(this)),this.component}}class WUe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var YUe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Mf extends Bl{static defaultOptionList=YUe;constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var s=new Mf(n,this);this.attachColumn(s)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(Mf.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Mf.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let s=0;s<n&&(i=i[r[s]],a=i,!!i);s++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let s=0;s<a;s++)if(s==a-1)r[n[s]]=i;else{if(!r[n[s]])if(typeof i<"u")r[n[s]]={};else break;r=r[n[s]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.table.initialized&&(this.element.style.width=e+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new W0(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;e?this.setWidth(r):(this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r))}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new WUe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Mf?this.parent.getComponent():!1}}class JF{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Zl extends Bl{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&ba.elVisible(this.element),r={},n;return new Promise((a,s)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let o in n)this.data[o]=n[o];this.dispatch("row-data-save-after",this);for(let o in e)this.table.columnManager.getColumnsByFieldRoot(o).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(n);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new JF(this)),this.component}}var oKe={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,s){return Number(a)+Number(s)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};class JS extends Nr{static moduleName="columnCalcs";static calculations=oKe;constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Mf({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":JS.calculations[i.topCalc]?r.topCalc=JS.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":JS.calculations[i.bottomCalc]?r.botCalc=JS.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{i.push(a.getData()),r&&a.modules.dataTree?.open&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new Zl(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new sKe(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(s=>{this.genColumn.setField(s.getField()),this.genColumn.hozAlign=s.hozAlign,s.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter(s.definition[e+"CalcFormatter"]),params:s.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.lookupFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=s.definition.cssClass;var o=new W0(this.genColumn,n);o.getElement(),o.column=s,o.setWidth(),s.cells.push(o),a.push(o),s.visible||o.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",s,o;return n.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),o=a+"Params",s=typeof l.modules.columnCalcs[o]=="function"?l.modules.columnCalcs[o](c,i):l.modules.columnCalcs[o],l.setFieldValue(r,l.modules.columnCalcs[a](c,i,s)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(s=>{n[s.getKey()]=this.getGroupResults(s)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}class lKe extends Nr{static moduleName="dataTree";constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,s;i.push(r),r instanceof Zl&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(s=this.getChildren(r,!1,!0),s.forEach(o=>{o.create(),i.push(o)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],s=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(o=>{s.push(o);var l=this.getChildren(o,!1,!0);l.forEach(c=>{s.push(c)})})),s}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new Zl(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof Zl&&r.push(a)})),r}rowDeleting(e){var i=e.modules.dataTree;i&&i.children&&Array.isArray(i.children)&&i.children.forEach(r=>{r instanceof Zl&&r.wipe()})}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof Zl?r=e.data:e instanceof JF?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof Zl?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(s=>{s instanceof Zl&&(a.push(i?s.getComponent():s),r&&this.getTreeChildren(s,i,r).forEach(o=>{a.push(o)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}function cKe(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(s=>{var o=[];switch(s.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":s.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":s.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}o.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(o.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function uKe(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function dKe(t,e={},i){var r=[],n=[],a={},s=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},o=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"",u,d;l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(h=>{switch(h.type){case"header":r.push(p(h));break;case"group":n.push(p(h,s));break;case"calc":n.push(p(h,o));break;case"row":n.push(p(h));break}});function p(h,f){var m=[];return h.columns.forEach(g=>{var v;if(g){switch(typeof g.value){case"object":g.value=g.value!==null?JSON.stringify(g.value):"";break;case"undefined":g.value="";break}v={content:g.value,colSpan:g.width,rowSpan:g.height},f&&(v.styles=f),m.push(v)}}),m}u=this.dependencyRegistry.lookup("jspdf","jsPDF"),d=new u(l),e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(h){d.text(c,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function pKe(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=this.dependencyRegistry.lookup("XLSX"),s=a.utils.book_new(),o=new Bl(this),l="compress"in e?e.compress:!0,c=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},u;c.type="binary",s.SheetNames=[],s.Sheets={};function d(){var f=[],m=[],g={},v={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((y,b)=>y+(b&&b.width?b.width:1),0):0,r:t.length}};return t.forEach((y,b)=>{var I=[];y.columns.forEach(function(w,T){w?(I.push(!(w.value instanceof Date)&&typeof w.value=="object"?JSON.stringify(w.value):w.value),(w.width>1||w.height>-1)&&(w.height>1||w.width>1)&&m.push({s:{r:b,c:T},e:{r:b+w.height-1,c:T+w.width-1}})):I.push("")}),f.push(I)}),a.utils.sheet_add_aoa(g,f),g["!ref"]=a.utils.encode_range(v),m.length&&(g["!merges"]=m),g}if(e.sheetOnly){i(d());return}if(e.sheets)for(var p in e.sheets)e.sheets[p]===!0?(s.SheetNames.push(p),s.Sheets[p]=d()):(s.SheetNames.push(p),o.commsSend(e.sheets[p],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(f){s.Sheets[p]=f}}));else s.SheetNames.push(n),s.Sheets[n]=d();e.documentProcessing&&(s=e.documentProcessing(s));function h(f){for(var m=new ArrayBuffer(f.length),g=new Uint8Array(m),v=0;v!=f.length;++v)g[v]=f.charCodeAt(v)&255;return m}u=a.write(s,c),i(h(u),"application/octet-stream")}function hKe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function fKe(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(s=>{s&&(a[s.component.getTitleDownload()||s.component.getField()]=s.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var mKe={csv:cKe,json:uKe,jsonLines:fKe,pdf:dKe,xlsx:pKe,html:hKe};class G_ extends Nr{static moduleName="download";static downloaders=mKe;constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var s=!1;function o(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?s=e:G_.downloaders[e]?s=G_.downloaders[e]:console.warn("Download Error - No such download type found: ",e),s){var l=this.generateExportList(n);s.call(this.table,l,r||{},o.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var s=document.createElement("a"),o=this.table.options.downloadEncoder(e,i);o&&(a?window.open(window.URL.createObjectURL(o)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(o,n):(s.setAttribute("href",window.URL.createObjectURL(o)),s.setAttribute("download",n),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){switch(i){case"intercept":this.download(r.type,"",r.options,r.active,r.intercept);break}}}function QF(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function s(o){var l=i[o];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,s(o+1))}t.addEventListener("keydown",o=>{var l=t.value.length,c=o.key;if(o.keyCode>46&&!o.ctrlKey&&!o.metaKey){if(l>=i.length)return o.preventDefault(),o.stopPropagation(),!1;switch(i[l]){case r:if(c.toUpperCase()==c.toLowerCase())return o.preventDefault(),o.stopPropagation(),!1;break;case n:if(isNaN(c))return o.preventDefault(),o.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return o.preventDefault(),o.stopPropagation(),!1}}}),t.addEventListener("keyup",o=>{o.keyCode>46&&e.maskAutoFill&&s(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&s(t.value.length)}function gKe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type",n.search?"search":"text"),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%",n.selectContents&&s.select())});function o(l){(a===null||typeof a>"u")&&s.value!==""||s.value!==a?i(s.value)&&(a=s.value):r()}return s.addEventListener("change",o),s.addEventListener("blur",o),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&QF(s,n),s}function vKe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"hybrid",o=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=o,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&u();break;case 27:r();break;case 38:(s=="editor"||s=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(s=="editor"||s=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&QF(l,n),l}function yKe(t,e,i,r,n){var a=t.getValue(),s=n.verticalNavigation||"editor",o=document.createElement("input");if(o.setAttribute("type","number"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let u in n.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),o.setAttribute(u,o.getAttribute(u)+n.elementAttributes["+"+u])):o.setAttribute(u,n.elementAttributes[u]);o.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(o.removeEventListener("blur",l),o.focus({preventScroll:!0}),o.style.height="100%",o.addEventListener("blur",l),n.selectContents&&o.select())});function c(){var u=o.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):r()}return o.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:r();break;case 38:case 40:s=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),n.mask&&QF(o,n),o}function bKe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input");if(s.setAttribute("type","range"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),s.setAttribute(l,s.getAttribute(l)+n.elementAttributes["+"+l])):s.setAttribute(l,n.elementAttributes[l]);s.value=a,e(function(){t.getType()==="cell"&&(s.focus({preventScroll:!0}),s.style.height="100%")});function o(){var l=s.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return s.addEventListener("blur",function(l){o()}),s.addEventListener("keydown",function(l){switch(l.keyCode){case 13:o();break;case 27:r();break}}),s}function IKe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var h;return o.isDateTime(p)?h=p:a==="iso"?h=o.fromISO(String(p)):h=o.fromFormat(String(p),a),h.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.max&&c.setAttribute("max",a?u(n.max):n.max),n.min&&c.setAttribute("min",a?u(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(o?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(h=o.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(l=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function wKe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=o.fromFormat(String(p),"hh:mm"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function SKe(t,e,i,r,n){var a=n.format,s=n.verticalNavigation||"editor",o=a?this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"):null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(o?(o.isDateTime(c)?l=c:a==="iso"?l=o.fromISO(String(c)):l=o.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=o.fromISO(String(p)),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:s=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}let TKe=class{constructor(e,i,r,n,a,s){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(s),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&QF(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=zUe(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var s=n.getFieldValue(a);this._emptyValueCheck(s)||(this.params.multiselect&&Array.isArray(s)?s.forEach(o=>{this._emptyValueCheck(o)||(i[o]=!0)}):i[s]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_emptyValueCheck(e){return e===null||typeof e>"u"||e===""}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,s,o=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(u.test(r)&&u.test(n)))return r>n?1:-1;for(r=r.match(c),n=n.match(c),l=r.length>n.length?n.length:r.length;o<l;)if(a=r[o],s=n[o++],a!==s)return isFinite(a)&&isFinite(s)?(a.charAt(0)==="0"&&(a="."+a),s.charAt(0)==="0"&&(s="."+s),a-s):a>s?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function UKe(t,e,i,r,n){var a=new TKe(this,t,e,i,r,n);return a.input}function DKe(t,e,i,r,n){var a=this,s=t.getElement(),o=t.getValue(),l=s.getElementsByTagName("svg").length||5,c=s.getElementsByTagName("svg")[0]?s.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){u.forEach(function(y,b){b<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),b=p.cloneNode(!0);u.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),s.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){o=v,h(v)}if(s.style.whiteSpace="nowrap",s.style.overflow="hidden",s.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let v in n.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+n.elementAttributes["+"+v])):d.setAttribute(v,n.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return o=Math.min(parseInt(o),l),h(o),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),s.addEventListener("blur",function(v){r()}),s.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(o+1);break;case 37:m(o-1);break;case 13:i(o);break;case 27:r();break}}),d}function EKe(t,e,i,r,n){var a=t.getElement(),s=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,o=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(s-o)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+o;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+n.elementAttributes["+"+m])):d.setAttribute(m,n.elementAttributes[m]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),s),c=Math.max(parseFloat(c),o),c=Math.round((c-o)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",o),a.setAttribute("aria-valuemax",s),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function PKe(t,e,i,r,n){var a=t.getValue(),s=document.createElement("input"),o=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,c=!1,u=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(s.setAttribute("type","checkbox"),s.style.marginTop="5px",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let h in n.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),s.setAttribute(h,s.getAttribute(h)+n.elementAttributes["+"+h])):s.setAttribute(h,n.elementAttributes[h]);s.value=a,o&&(typeof a>"u"||a===l||a==="")&&(c=!0,s.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&s.focus({preventScroll:!0})}),s.checked=u?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(h){var f=s.checked;return u&&f?f=n.trueValue:d&&!f&&(f=n.falseValue),o?h?c?l:f:s.checked&&!c?(s.checked=!1,s.indeterminate=!0,c=!0,l):(c=!1,f):f}return s.addEventListener("change",function(h){i(p())}),s.addEventListener("blur",function(h){i(p(!0))}),s.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&r()}),s}function CKe(t,e,i,r,n){var a=t._getSelf().column,s,o,l;function c(u){var d=u.getValue(),p="input";switch(typeof d){case"number":p="number";break;case"boolean":p="tickCross";break;case"string":d.includes(`
`)&&(p="textarea");break}return p}return s=n.editorLookup?n.editorLookup(t):c(t),n.paramsLookup&&(l=typeof n.paramsLookup=="function"?n.paramsLookup(s,t):n.paramsLookup[s]),o=this.table.modules.edit.lookupEditor(s,a),o.call(this,t,e,i,r,l||{})}var RKe={input:gKe,textarea:vKe,number:yKe,range:bKe,date:IKe,time:wKe,datetime:SKe,list:UKe,star:DKe,progress:EKe,tickCross:PKe,adaptable:CKe};class q8 extends Nr{static moduleName="edit";static editors=RKe;constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=q8.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&ba.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&ba.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};r.editor=this.lookupEditor(e.definition.editor,e),r.editor&&(e.modules.edit=r)}lookupEditor(e,i){var r;switch(typeof e){case"string":this.editors[e]?r=this.editors[e]:console.warn("Editor Error - No such editor found: ",e);break;case"function":r=e;break;case"boolean":e===!0&&(typeof i.definition.formatter!="function"?this.editors[i.definition.formatter]?r=this.editors[i.definition.formatter]:r=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",i.definition.formatter));break}return r}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,s=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,o=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),s-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),s-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),o.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-o.offsetLeft:o.offsetLeft+o.offsetWidth>s&&(this.table.rowManager.element.scrollLeft+=o.offsetLeft+o.offsetWidth-s)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,s=function(){},o=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(n.currentCell===e&&!l){var y=n.chain("edit-success",[e,v],!0,!0);return y===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),v=n.transformEmptyValues(v,e),e.setValue(v,!0),y===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),s(),setTimeout(()=>{l=!1},10),!1)}}function h(){n.currentCell===e&&!l&&n.cancelEdit()}function f(v){s=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(o),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(n,u,f,p,h,d),this.currentCell&&c!==!1)if(c instanceof Node){for(o.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");o.firstChild;)o.removeChild(o.firstChild);o.appendChild(c),s();for(var m=o.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(o),!1;else return this.blur(o),!1;return!0}else return this.mouseClick=!1,this.blur(o),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}class JX{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class EB{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var MKe={},NKe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};class uP extends Nr{static moduleName="export";static columnLookups=MKe;static rowLookups=NKe;constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,s,o,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=uP.columnLookups[r],l&&(o=l.call(this.table),o=o.filter(c=>this.columnVisCheck(c))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(o)):[],o&&(o=o.map(c=>c.getComponent())),s=this.bodyToExportRows(this.rowLookup(r),o),a.concat(s)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=uP.rowLookups[e]||uP.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(s=>{var o=this.processColumnGroup(s);o&&(a.width+=o.width,a.subGroups.push(o),o.depth>r&&(r=o.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(s,o){var l=r-o;if(typeof i[o]>"u"&&(i[o]=[]),s.height=s.subGroups?1:l-s.depth+1,i[o].push(s),s.height>1)for(let c=1;c<s.height;c++)typeof i[o+c]>"u"&&(i[o+c]=[]),i[o+c].push(!1);if(s.width>1)for(let c=1;c<s.width;c++)i[o].push(!1);s.subGroups&&s.subGroups.forEach(function(c){a(c,o+1)})}return e.forEach(function(s){s.depth>r&&(r=s.depth)}),e.forEach(function(s){a(s,0)}),i.forEach(s=>{var o=[];s.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;o.push(new EB(c,l.column.getComponent(),l.width,l.height,l.depth))}else o.push(null)}),n.push(new JX("header",o))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var s=n.getData(this.colVisProp),o=[],l=0;switch(n.type){case"group":l=n.level,o.push(new EB(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{o.push(new EB(c._column.getFieldValue(s),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new JX(n.type,o,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),s=this.table.options["rowFormatter"+this.colVisPropAttach],o={};return o.rowFormatter=s!==null?s:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(o.treeElementField=this.table.modules.dataTree.elementField),o.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],o.groupHeader&&!Array.isArray(o.groupHeader)&&(o.groupHeader=[o.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,o,a));break;case"group":n.appendChild(this.generateGroupElement(l,o,a));break;case"calc":n.appendChild(this.generateCalcElement(l,o,a));break;case"row":u=this.generateRowElement(l,o,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(u);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var s=document.createElement("th"),o=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];s.colSpan=a.width,s.rowSpan=a.height,s.innerHTML=a.value,this.cloneTableStyle&&(s.style.boxSizing="border-box"),o.forEach(function(l){s.classList.add(l)}),this.mapElementStyles(a.component.getElement(),s,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,s,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),s,["width"]):a.component._column.definition.width&&(s.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,s,["border-top"]):this.mapElementStyles(a.component.getElement(),s,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),s,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),s,["border-bottom"]),n.appendChild(s)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),s=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?s.value=i.groupHeader[e.indent](s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(s.value=e.component._group.generator(s.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=s.width,a.innerHTML=s.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),s.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,s)=>{if(a){var o=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,h,f={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return o},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return f},column:l},m=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(m.forEach(function(g){o.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?o.appendChild(d):o.innerHTML=d,h=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,h.push("background-color")):p=r.styleCells&&r.styleCells[u]?r.styleCells[u]:r.firstCell,p&&(this.mapElementStyles(p,o,h),l.definition.align&&(o.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&s==0)&&(e.component._row.modules.dataTree.controlEl&&o.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),o.firstChild),e.component._row.modules.dataTree.branchEl&&o.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),o.firstChild)),n.appendChild(o),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(s){i.style[n[s]]||(i.style[n[s]]=a.getPropertyValue(s))})}}}}var AKe={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),s=[];return n.forEach(o=>{a.includes(o)&&s.push(!0)}),r.matchAll?s.length===n.length:!!s.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Tb extends Nr{static moduleName="filter";static filters=AKe;constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(s){var o=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==s){if(e.modules.filter.prevSuccess=s,e.modules.filter.emptyFunc(s))delete r.headerFilters[n];else{switch(e.modules.filter.value=s,typeof e.definition.headerFilterFunc){case"string":Tb.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,Tb.filters[e.definition.headerFilterFunc](s,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(s,h,d):p,e.definition.headerFilterFunc(s,h,d,p)},l=u;break}if(!u)switch(o){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(s).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==s},l="="}r.headerFilters[n]={value:s,func:u,type:l}}e.modules.filter.value=s,c=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==c&&(r.prevHeaderFilterChangeCheck=c,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,s=e.getField(),o,l,c,u,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),s){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},o=document.createElement("div"),o.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return o},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(n.table,u):h,c=l.call(this.table.modules.edit,u,g,a,m,h),!c){console.warn("Filter Error - Cannot add filter to "+s+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+s+" column, editor should return an instance of Node, the editor returned:",c);return}n.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),o.appendChild(c),e.contentElement.appendChild(o),r||n.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(s=>{s=this.findFilter(s),s&&(this.filterList.push(s),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:Tb.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return Tb.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return Tb.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(s=>n===s):a=this.filterList.findIndex(s=>n.field===s.field&&n.type===s.type&&n.value===s.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],s=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(o=>{o=this.findFilter(o),o&&s.push(o)}),this.table.rowManager.rows.forEach(o=>{var l=!0;s.forEach(c=>{this.filterRecurse(c,o.getData())||(l=!1)}),l&&a.push(e==="data"?o.getData("data"):o.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(s=>{this.filterRecurse(s,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}}function _Ke(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function kKe(t,e,i){return t.getValue()}function OKe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function xKe(t,e,i){var r=parseFloat(t.getValue()),n="",a,s,o,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=m!==!1?r.toFixed(m):r,a=String(a).split("."),s=a[0],o=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(s);)s=s.replace(l,"$1"+d+"$2");return c=s+o,n===!0?(c="("+c+")",f?c+h:h+c):f?n+c+h:n+h+c}function LKe(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,s=r,o=document.createElement("a"),l;function c(u,d){var p=u.shift(),h=d[p];return u.length&&typeof h=="object"?c(u,h):h}if(e.labelField&&(l=t.getData(),s=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":s=e.label;break;case"function":s=e.label(t);break}if(s){if(e.urlField&&(l=t.getData(),r=ba.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return o.setAttribute("href",n+r),e.target&&o.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,o.setAttribute("download",a)),o.innerHTML=this.emptyToSpace(this.sanitizeHTML(s)),o}else return"&nbsp;"}function FKe(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function BKe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,s=e.allowTruthy,o=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return o&&r===e.trueValue||!o&&(s&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),c||"")}function $Ke(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(o)?l=o:n==="iso"?l=r.fromISO(String(o)):l=r.fromFormat(String(o),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):s===!0||!o?o:typeof s=="function"?s(o):s}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function VKe(t,e,i){var r=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=typeof e.suffix<"u"?e.suffix:!1,o=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:r.now(),u=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(u)?d=u:n==="iso"?d=r.fromISO(String(u)):d=r.fromFormat(String(u),n),d.isValid?l?d.diff(c,o).toHuman()+(s?" "+s:""):parseInt(d.diff(c,o)[o])+(s?" "+s:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function jKe(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function GKe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,s=document.createElement("span"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';s.style.verticalAlign="middle",o.setAttribute("width","14"),o.setAttribute("height","14"),o.setAttribute("viewBox","0 0 512 512"),o.setAttribute("xml:space","preserve"),o.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var u=1;u<=a;u++){var d=o.cloneNode(!0);d.innerHTML=u<=r?l:c,s.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),s}function HKe(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,s=e&&e.min?e.min:0,o=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=s?parseFloat(u):s,c=(a-s)/100,u=Math.round((u-s)/c),typeof o){case"string":l=o;break;case"function":l=o(r);break;case"object":if(Array.isArray(o)){var d=100/o.length,p=Math.floor(u/d);p=Math.min(p,o.length-1),p=Math.max(p,0),l=o[p];break}}return n.style.backgroundColor=l,n}}function zKe(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,s=e.min?e.min:0,o=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=s?parseFloat(c):s,l=(a-s)/100,c=Math.round((c-s)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",c);var h=document.createElement("div");h.style.display="inline-block",h.style.width=c+"%",h.style.backgroundColor=u,h.style.height="100%",h.setAttribute("data-max",a),h.setAttribute("data-min",s);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=o,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof qUe)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function qKe(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function WKe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function YKe(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function KKe(t,e,i){var r=t.getValue(),n=e.size||15,a=n+"px",s,o,l=e.hasOwnProperty("onValue")?e.onValue:!0,c=e.hasOwnProperty("offValue")?e.offValue:!1,u=e.onTruthy?r:r===l;return s=document.createElement("div"),s.classList.add("tabulator-toggle"),u?(s.classList.add("tabulator-toggle-on"),s.style.flexDirection="row-reverse",e.onColor&&(s.style.background=e.onColor)):e.offColor&&(s.style.background=e.offColor),s.style.width=2.5*n+"px",s.style.borderRadius=a,e.clickable&&s.addEventListener("click",d=>{t.setValue(u?c:l)}),o=document.createElement("div"),o.classList.add("tabulator-toggle-switch"),o.style.height=a,o.style.width=a,o.style.borderRadius=a,s.appendChild(o),s}function ZKe(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(s=>{e.relativeToPage&&(s+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=s}),r}function XKe(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function JKe(t,e,i){var r,n,a;function s(o){var l=o.getValue(),c="plaintext";switch(typeof l){case"boolean":c="tickCross";break;case"string":l.includes(`
`)&&(c="textarea");break}return c}return r=e.formatterLookup?e.formatterLookup(t):s(t),e.paramsLookup&&(a=typeof e.paramsLookup=="function"?e.paramsLookup(r,t):e.paramsLookup[r]),n=this.table.modules.format.lookupFormatter(r),n.call(this,t,a||{},i)}function QKe(t,e,i){var r=e.delimiter||",",n=t.getValue(),a=this.table,s;return e.valueMap&&(typeof e.valueMap=="string"?s=function(o){return o.map(l=>ba.retrieveNestedData(a.options.nestedFieldSeparator,e.valueMap,l))}:s=e.valueMap),Array.isArray(n)?(s&&(n=s(n)),n.join(r)):n}function eZe(t,e,i){var r=e.indent||"	",n=typeof e.multiline>"u"?!0:e.multiline,a=e.replacer||null,s=t.getValue();return n&&(t.getElement().style.whiteSpace="pre-wrap"),JSON.stringify(s,a,r)}var tZe={plaintext:_Ke,html:kKe,textarea:OKe,money:xKe,link:LKe,image:FKe,tickCross:BKe,datetime:$Ke,datetimediff:VKe,lookup:jKe,star:GKe,traffic:HKe,progress:zKe,color:qKe,buttonTick:WKe,buttonCross:YKe,toggle:KKe,rownum:ZKe,handle:XKe,adaptable:JKe,array:QKe,json:eZe};class QS extends Nr{static moduleName="format";static formatters=tZe;constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupTypeFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupTypeFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupTypeFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupTypeFormatter(e,"HtmlOutput"))}lookupTypeFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];return r.formatter=this.lookupFormatter(n),r}lookupFormatter(e){var i;switch(typeof e){case"string":QS.formatters[e]?i=QS.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),i=QS.formatters.plaintext);break;case"function":i=e;break;default:i=QS.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,s,o;return e.definition.titleFormatter?(n=this.lookupFormatter(e.definition.titleFormatter),s=l=>{e.titleFormatterRendered=l},o={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,o,a,s)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}}class iZe extends Nr{static moduleName="frozenColumns";constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,s)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),s==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var o=this.getColGroupParentElement(a);i.includes(o)||(this.layoutElement(o,a),i.push(o)),o.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),o.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,s)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),s==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(o=>{this.layoutElement(o.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}class rZe extends Nr{static moduleName="frozenRows";constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}class nZe{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class eT{constructor(e,i,r,n,a,s,o){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=o,this.rows=[],this.groups=[],this.groupList=[],this.generator=s,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=o?o.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new eT(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,ba.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new nZe(this)),this.component}}class aZe extends Nr{static moduleName="groupRows";constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,s)=>{this.headerGenerator[0]=(o,l,c)=>(typeof o>"u"?"":o)+"<span>("+l+" "+(l===1?a:s.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,s)=>{var o,l;typeof a=="function"?o=a:(l=this.table.columnManager.getColumnByField(a),l?o=function(c){return l.getFieldValue(c)}:o=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:o,values:this.allowedValues?this.allowedValues[s]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof eT&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof eT?i:i.modules.group,a=e instanceof eT?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(s=>{i.push(s.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new eT(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((s,o)=>s===n[o]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}var sZe={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},oZe={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},lZe={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},cZe={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},uZe={keybindings:{bindings:lZe,actions:cZe}};let dZe=class Kj extends Nr{static moduleName="history";static moduleExtensions=uZe;static undoers=sZe;static redoers=oZe;constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return Kj.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return Kj.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof Zl)r.component===e&&(r.component=i);else if(r.component instanceof W0&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};class pZe extends Nr{static moduleName="htmlTableImport";constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var s=0;s<n.length;s++){var o=n[s],l=o.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=s);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),s={};a.forEach(u=>{s[u.toLowerCase()]=u});for(var o in n){var l=n[o],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof s[c]<"u"&&(i[s[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,s=this._findCol(n.textContent),o;s?a=!0:s={title:n.textContent.trim()},s.field||(s.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),o=n.getAttribute("width"),o&&!s.width&&(s.width=o),this._extractOptions(n,s,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=s.field,s.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(s)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var s=n.getAttribute("width");s&&(a.width=s),this.table.options.columns.push(a)}}}function hZe(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let s=t[a],o=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),s=='"'&&n&&o=='"'){e[i][r]+=s,a++;continue}if(s=='"'){n=!n;continue}if(s==","&&!n){r++;continue}if(s=="\r"&&o==`
`&&!n){r=0,i++,a++;continue}if((s=="\r"||s==`
`)&&!n){r=0,i++;continue}e[i][r]+=s}return e}function fZe(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function mZe(t){return t}function gZe(t){var e=this.dependencyRegistry.lookup("XLSX"),i=e.read(t),r=i.Sheets[i.SheetNames[0]];return e.utils.sheet_to_json(r,{header:1})}var vZe={csv:hZe,json:fZe,array:mZe,xlsx:gZe};class W8 extends Nr{static moduleName="import";static importers=vZe;constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text"),this.registerTableOption("importHeaderTransform"),this.registerTableOption("importValueTransform"),this.registerTableOption("importDataValidator"),this.registerTableOption("importFileValidator")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(s=>(console.error("Import Error:",s||"Unable to import data"),Promise.reject(s)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=W8.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.mutateData.bind(this)).then(this.validateData.bind(this)).then(this.setData.bind(this)).catch(a=>(this.dispatch("import-error",a),this.dispatchExternal("importError",a),console.error("Import Error:",a||"Unable to import file"),this.table.dataLoader.alertError(),setTimeout(()=>{this.table.dataLoader.clearAlert()},3e3),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",s=>{var o=a.files[0],l=new FileReader,c=this.validateFile(o);if(c===!0){switch(this.dispatch("import-importing",a.files),this.dispatchExternal("importImporting",a.files),i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;case"text":default:l.readAsText(o)}l.onload=u=>{r(l.result)},l.onerror=u=>{console.warn("File Load Error - Unable to read file"),n(u)}}else n(c)}),this.dispatch("import-choose"),this.dispatchExternal("importChoose"),a.click()})}importData(e,i){var r;return this.table.dataLoader.alertLoader(),new Promise((n,a)=>{setTimeout(()=>{r=e.call(this.table,i),r instanceof Promise||r?n(r):a()},10)})}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"import"))}):i=e,i}transformHeader(e){var i=[];if(this.table.options.importHeaderTransform)e.forEach(r=>{i.push(this.table.options.importHeaderTransform.call(this.table,r,e))});else return e;return i}transformData(e){var i=[];if(this.table.options.importValueTransform)e.forEach(r=>{i.push(this.table.options.importValueTransform.call(this.table,r,e))});else return e;return i}structureArrayToObject(e){var i=this.transformHeader(e.shift()),r=e.map(n=>{var a={};return n=this.transformData(n),i.forEach((s,o)=>{a[s]=n[o]}),a});return r}structureArrayToColumns(e){var i=[],r=this.transformHeader(e[0]),n=this.table.getColumns();return n[0]&&r[0]&&n[0].getDefinition().title===r[0]&&e.shift(),e.forEach(a=>{var s={};a=this.transformData(a),a.forEach((o,l)=>{var c=n[l];c&&(s[c.getField()]=o)}),i.push(s)}),i}validateFile(e){return this.table.options.importFileValidator?this.table.options.importFileValidator.call(this.table,e):!0}validateData(e){var i;return this.table.options.importDataValidator?(i=this.table.options.importDataValidator.call(this.table,e),i===!0?e:Promise.reject(i)):e}setData(e){return this.dispatch("import-imported",e),this.dispatchExternal("importImported",e),this.table.dataLoader.clearAlert(),this.table.setData(e)}}class yZe extends Nr{static moduleName="interaction";constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof W0?a=r.column.definition[e]:r instanceof Mf&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}var bZe={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},IZe={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};class dP extends Nr{static moduleName="keybindings";static bindings=bZe;static actions=IZe;constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,dP.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)dP.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:dP.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}}class wZe extends Nr{static moduleName="menu";constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var s=!(e instanceof MouseEvent),o=document.createElement("div"),l;if(o.classList.add("tabulator-menu"),s||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(o);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(o)}r.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",h=>{h.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,c.menu,u,l)}):c.action&&u.addEventListener("click",h=>{c.action(h,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),o.appendChild(u)}),o.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}class SZe extends Nr{static moduleName="moveColumn";constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-ba.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),s=n?n.getWidth()/2:0,a=e.prevColumn(),o=a?a.getWidth()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),r||(r=u.touches[0].pageX),d=u.touches[0].pageX-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=s,s=n?n.getWidth()/2:0,a=p.prevColumn(),c=o,o=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.table.modules.selectRange&&this.table.modules.selectRange.columnSelection&&this.table.modules.selectRange.mousedown&&this.table.modules.selectRange.selecting==="column"||(this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-ba.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e),this.dispatch("column-moving",e,this.moving))}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s.nextSibling)}):e.getCells().forEach(function(n,a){var s=n.getElement(!0);s.parentNode&&r[a]&&s.parentNode.insertBefore(r[a].getElement(),s)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-ba.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}var TZe={delete:function(t,e,i){t.delete()}},UZe={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};class H_ extends Nr{static moduleName="moveRow";static senders=TZe;static receivers=UZe;constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-ba.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var s=e.getElement();a.pageY-ba.elOffset(s).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(s.parentNode.insertBefore(i.placeholderElement,s),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,s,o,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),s=n?n.getHeight()/2:0,a=e.prevRow(),o=a?a.getHeight()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),r||(r=u.touches[0].pageY),d=u.touches[0].pageY-r,d>0?n&&d-l>s&&(p=n,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>o&&(p=a,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=s,s=n?n.getHeight()/2:0,a=p.prevRow(),c=o,o=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,s;a=i.getElement(),this.connection?(s=a.getBoundingClientRect(),this.startX=s.left-r+window.pageXOffset,this.startY=s.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=H_.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=H_.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}}var DZe={};class z_ extends Nr{static moduleName="mutator";static mutators=DZe;constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard","import"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutatorImport"),this.registerColumnOption("mutatorImportParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),s;e.definition[a]&&(s=this.lookupMutator(e.definition[a]),s&&(i=!0,r[a]={mutator:s,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":z_.mutators[e]?i=z_.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(s=>{var o,l,c;s.modules.mutate&&(o=s.modules.mutate[n]||s.modules.mutate.mutator||!1,o&&(a=s.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(c=s.getComponent(),l=typeof o.params=="function"?o.params(a,e,i,c):o.params,s.setFieldValue(e,o.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}function EZe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),r?(o.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",c.innerHTML=" "+r+" ",a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(o.innerHTML=" 0 ",a.appendChild(s),a.appendChild(o),a.appendChild(u)),a}function PZe(t,e,i,r,n){var a=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{s.innerHTML=d}),o.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(s),a.appendChild(o),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var CZe={rows:EZe,pages:PZe};class Y8 extends Nr{static moduleName="page";static pageCounters=CZe;constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("paginationOutOfRange",!1),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=Y8.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,s,o=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let c=e[l];c&&(r.push(c),c.type==="row"&&(s||(s=c),i++))}return this._setPageCounter(o.length,i,s?o.indexOf(s)+1:0),r}else return this._setPageButtons(),this._setPageCounter(o.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i,r;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else{if(this.page>this.max&&(console.warn("Remote Pagination Error - Server returned last page value lower than the current page"),r=this.options("paginationOutOfRange"),r))return this.setPage(typeof r=="function"?r.call(this,this.page,this.max):r);this.dispatchExternal("pageLoaded",this.getPage())}else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}var RZe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,s;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),s=i.replace(r+"=","")),s?JSON.parse(s):!1}},MZe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};class wf extends Nr{static moduleName="persistence";static moduleInitOrder=-10;static readers=RZe;static writers=MZe;constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:wf.readers[this.table.options.persistenceReaderFunc]?this.readFunc=wf.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):wf.readers[this.mode]?this.readFunc=wf.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:wf.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=wf.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):wf.writers[this.mode]?this.writeFunc=wf.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),s=i[n];a&&Object.defineProperty(i,n,{set:o=>{s=o,this.defWatcherBlock||this.save("columns"),a.set&&a.set(o)},get:()=>(a.get&&a.get(),s)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,s)=>{var o=this._findColumn(e,a),l;o&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(o[c]=a[c])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,a.columns)),n.push(o))}),e.forEach((a,s)=>{var o=this._findColumn(i,a);o||(n.length>s?n.splice(s,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},s=n.getDefinition(),o;n.isGroup?(a.title=s.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(o=Object.keys(s),o.push("width"),o.push("visible")):o=this.config.columns,o.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof s[l]!="function"&&r.indexOf(l)===-1&&(a[l]=s[l])}})),i.push(a)}),i}}let NZe=class extends Nr{static moduleName="popup";constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function s(o){a=o}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),s):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var s=!(e instanceof MouseEvent),o,l;r instanceof HTMLElement?o=r:(o=document.createElement("div"),o.innerHTML=r),o.classList.add("tabulator-popup"),o.addEventListener("click",c=>{c.stopPropagation()}),s||e.preventDefault(),l=this.popup(o),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};class AZe extends Nr{static moduleName="print";constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,s=document.createElement("div"),o=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(s.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),this.element.appendChild(l),this.table.options.printFooter&&(o.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}class _Ze extends Nr{static moduleName="reactiveData";constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(s=>{i.table.rowManager.addRowActual(s,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],s=n[1],o=n[2]?n.slice(2):!1,l,c;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),o&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(o=o.slice().reverse(),o.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),s!==0){var u=e.slice(a,typeof n[1]>"u"?n[1]:a+s);u.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==u.length-1)})}(o||s!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),s=i[r],o=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(s=l,!n.blocked&&o===n.currentVersion){n.block("key");var c={};c[r]=l,e.updateData(c),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),s)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}class kZe extends Nr{static moduleName="resizeColumns";constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,s=!1,o=r.definition.resizable,l={},c=r.getLastColumn();if(e==="header"&&(s=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:s}),(o===!0||o==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var h=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),h!==c.getWidth()&&(a.dispatch("column-resized",c),a.dispatchExternal("columnResized",c.getComponent()))}),r.modules.frozen&&(u.style.position="sticky",u.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=u,n.parentNode&&r.visible&&n.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,s,o;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),s=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),o=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(s&&o)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,s=this.table.element.getBoundingClientRect().x,o=i.element.getBoundingClientRect().left-s,l=n-this.startX,c=Math.max(a+l,o+i.minWidth);return i.maxWidth&&(c=Math.min(c,o+i.maxWidth)),c}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class OZe extends Nr{static moduleName="resizeRows";constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",s),n.addEventListener("touchstart",s,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",o),a.addEventListener("touchstart",o,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,s=this.table.element.getBoundingClientRect().y,o=i.element.getBoundingClientRect().top-s,l=n-this.startY;return Math.max(a+l,o)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function s(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function o(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),r.removeEventListener("touchmove",s),r.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),r.addEventListener("touchmove",s,{passive:!0}),r.addEventListener("touchend",o)}}class xZe extends Nr{static moduleName="resizeTable";constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}function LZe(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(s){var o=n.element;n.open=s,o&&(n.open?(r.classList.add("open"),o.style.display=""):(r.classList.remove("open"),o.style.display="none"))}return r.addEventListener("click",function(s){s.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var FZe={format:{formatters:{responsiveCollapse:LZe}}};class BZe extends Nr{static moduleName="responsiveLayout";static moduleExtensions=FZe;constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var s=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let o=function(l){l()};n={value:!1,data:{},getValue:function(){return s},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,o)})}else r.push({field:a.field,title:a.definition.title,value:s})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),o,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(c){l.innerHTML=c||r.title}),r.value instanceof Node?(o=document.createElement("div"),o.appendChild(r.value),s.appendChild(o)):s.innerHTML=r.value,n.appendChild(a),n.appendChild(s),i.appendChild(n)}),Object.keys(e).length?i:""}}function $Ze(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",s=>{s.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof JF?(r.addEventListener("change",s=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",s=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,s)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",s=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var VZe={format:{formatters:{rowSelection:$Ze}}};class jZe extends Nr{static moduleName="selectRow";static moduleExtensions=VZe;constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(s){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(s){if(s.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(s){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(s){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,s=r>=n?r:n,o=this.table.rowManager.getDisplayRows().slice(0),l=o.splice(a,s-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(s=>{a=this._deselectRow(s,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,s;if(n){if(a=r.selectedRows.findIndex(function(o){return o==n}),a>-1)return s=n.getElement(),s&&s.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}class GZe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0,!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}let HZe=class extends Bl{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,s,o,l,c,u,d,p,h,f;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),s=Math.min(this.bottom,i),o=Math.max(this.left,r),l=Math.min(this.right,n),c=this.rangeManager.getCell(a,o),u=this.rangeManager.getCell(s,l),d=c.getElement(),p=u.getElement(),h=c.row.getElement(),f=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=h.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=h.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=h.offsetTop+"px",this.element.style.height=f.offsetTop+f.offsetHeight-h.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),s={};r.forEach(o=>{s[o.field]=a[o.field]}),e.push(s)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(s=>{var o=[];return s.getCells().forEach(l=>{a.includes(l.column)&&o.push(i?l.getComponent():l)}),o}):n.forEach(s=>{s.getCells().forEach(o=>{a.includes(o.column)&&r.push(i?o.getComponent():o)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new GZe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}};var zZe={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},qZe={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},WZe={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,s,o,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),s=e.indexOf(a.row),r?o=t.length:o=e.indexOf(n.end.row)-s+1,s>-1&&(this.table.blockRedraw(),e=e.slice(s,s+o),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},YZe={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,s,o,l,c;return r&&(a=r.getBounds(),s=a.start,a.start===a.end&&(n=!0),s&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(s.column),c>-1)))?(n?o=e[0].length:o=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+o),e.forEach(u=>{var d={},p=u.length;l.forEach(function(h,f){d[h.field]=u[f%p]}),i.push(d)}),i):!1}},KZe={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},ZZe={range:function(){return this.modules.selectRange.selectedRows()}},XZe={keybindings:{bindings:zZe,actions:qZe},clipboard:{pasteActions:WZe,pasteParsers:YZe},export:{columnLookups:KZe,rowLookups:ZZe}};class JZe extends Nr{static moduleName="selectRange";static moduleInitOrder=1;static moduleExtensions=XZe;constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableOption("selectableRangeAutoFocus",!0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-moving",this.handleColumnMoving.bind(this)),this.subscribe("column-moved",this.handleColumnMoved.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;this.restoreFocus();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMoving(e,i){this.resetRanges().setBounds(i),this.overlay.style.visibility="hidden"}handleColumnMoved(e,i,r){this.activeRange.setBounds(e),this.layoutElement()}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||this.table.options.movableColumns&&this.selecting==="column"&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e),i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i),e.preventDefault()}navigate(e,i,r){var n=!1,a,s,o,l,c,u,d,p,h,f,m;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(g=>g===this.activeRange?(g.setEnd(g.start.row,g.start.col),!0):(g.destroy(),!1))),a=this.activeRange,o={top:a.top,bottom:a.bottom,left:a.left,right:a.right},s=i?a.end:a.start,l=s.row,c=s.col,e)switch(r){case"left":c=this.findJumpCellLeft(a.start.row,s.col);break;case"right":c=this.findJumpCellRight(a.start.row,s.col);break;case"up":l=this.findJumpCellUp(s.row,a.start.col);break;case"down":l=this.findJumpCellDown(s.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":c=Math.max(c-1,0);break;case"right":c=Math.min(c+1,this.getTableColumns().length-1);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(this.rowHeader&&c===0&&(c=1),i||a.setStart(l,c),a.setEnd(l,c),i||(this.selecting="cell"),n=o.top!==a.top||o.bottom!==a.bottom||o.left!==a.left||o.right!==a.right,n)return u=this.getRowByRangePos(a.end.row),d=this.getColumnByRangePos(a.end.col),p=u.getElement().getBoundingClientRect(),f=d.getElement().getBoundingClientRect(),h=this.table.rowManager.getElement().getBoundingClientRect(),m=this.table.columnManager.getElement().getBoundingClientRect(),p.top>=h.top&&p.bottom<=h.bottom||(u.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,u.getElement(),d.getElement()):u.getComponent().scrollTo(void 0,!1)),f.left>=m.left+this.getRowHeaderWidth()&&f.right<=m.right||(u.getElement().parentNode&&d.getElement().parentNode?this.autoScroll(a,u.getElement(),d.getElement()):d.getComponent().scrollTo(void 0,!1)),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpRow(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return s.getData()[e.getField()]})}findJumpCol(e,i,r,n,a){return r&&(i=i.reverse()),this.findJumpItem(n,a,i,function(s){return e.getData()[s.getField()]})}findJumpItem(e,i,r,n){var a;for(let s of r){let o=n(s);if(e){if(a=s,o)break}else if(i){if(a=s,o)break}else if(o)a=s;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i-1]?this.isEmpty(r.getData()[n[i-1].getField()]):!1,o=this.rowHeader?n.slice(1,i):n.slice(0,i),l=this.findJumpCol(r,o,!0,a,s);return l?l.getPosition()-1:i}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=this.getTableColumns(),a=this.isEmpty(r.getData()[n[i].getField()]),s=n[i+1]?this.isEmpty(r.getData()[n[i+1].getField()]):!1,o=this.findJumpCol(r,n.slice(i+1,n.length),!1,a,s);return o?o.getPosition()-1:i}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e-1]?this.isEmpty(n[e-1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(0,e),!0,a,s);return o?o.position-1:e}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=this.getTableRows(),a=this.isEmpty(n[e].getData()[r.getField()]),s=n[e+1]?this.isEmpty(n[e+1].getData()[r.getField()]):!1,o=this.findJumpRow(r,n.slice(e+1,n.length),!1,a,s);return o?o.position-1:e}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,s,o,l;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),a={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft+this.getRowHeaderWidth(),right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},o=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,l=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,o||(a.left<s.left?n.scrollLeft=a.left-this.getRowHeaderWidth():a.right>s.right&&(n.scrollLeft=Math.min(a.right-n.clientWidth,a.left-this.getRowHeaderWidth()))),l||(a.top<s.top?n.scrollTop=a.top:a.bottom>s.bottom&&(n.scrollTop=a.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new HZe(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.options("selectableRangeAutoFocus")&&this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}getRowHeaderWidth(){return this.rowHeader?this.rowHeader.getElement().offsetWidth:0}isEmpty(e){return e==null||e===""}}function QZe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=s.decimalSeparator,c=s.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(u*=-1),u}function eXe(t,e,i,r,n,a,s){var o=s.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof s.locale){case"boolean":s.locale&&(c=this.langLocale());break;case"string":c=s.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(o==="top"&&a==="desc"||o==="bottom"&&a==="asc")&&(l*=-1),l}function K8(t,e,i,r,n,a,s){var o=this.table.dependencyRegistry.lookup(["luxon","DateTime"],"DateTime"),l=s.format||"dd/MM/yyyy HH:mm:ss",c=s.alignEmptyValues,u=0;if(typeof o<"u"){if(o.isDateTime(t)||(l==="iso"?t=o.fromISO(String(t)):t=o.fromFormat(String(t),l)),o.isDateTime(e)||(l==="iso"?e=o.fromISO(String(e)):e=o.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function tXe(t,e,i,r,n,a,s){return s.format||(s.format="dd/MM/yyyy"),K8.call(this,t,e,i,r,n,a,s)}function iXe(t,e,i,r,n,a,s){return s.format||(s.format="HH:mm"),K8.call(this,t,e,i,r,n,a,s)}function rXe(t,e,i,r,n,a,s){var o=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return o-l}function nXe(t,e,i,r,n,a,s){var o=s.type||"length",l=s.alignEmptyValues,c=0,u=this.table,d;s.valueMap&&(typeof s.valueMap=="string"?d=function(h){return h.map(f=>ba.retrieveNestedData(u.options.nestedFieldSeparator,s.valueMap,f))}:d=s.valueMap);function p(h){var f;switch(d&&(h=d(h)),o){case"length":f=h.length;break;case"sum":f=h.reduce(function(m,g){return m+g});break;case"max":f=Math.max.apply(null,h);break;case"min":f=Math.min.apply(null,h);break;case"avg":f=h.reduce(function(m,g){return m+g})/h.length;break;case"string":f=h.join("");break}return f}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return o==="string"?String(p(t)).toLowerCase().localeCompare(String(p(e)).toLowerCase()):p(e)-p(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function aXe(t,e,i,r,n,a,s){var o=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return o-l}function sXe(t,e,i,r,n,a,s){var o,l,c,u,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=s.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(o=String(t).toLowerCase(),l=String(e).toLowerCase(),o===l)return 0;if(!(f.test(o)&&f.test(l)))return o>l?1:-1;for(o=o.match(h),l=l.match(h),p=o.length>l.length?l.length:o.length;d<p;)if(c=o[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return o.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var oXe={number:QZe,string:eXe,date:tXe,time:iXe,datetime:K8,boolean:rXe,array:nXe,exists:aXe,alphanum:sXe};class pP extends Nr{static moduleName="sort";static sorters=oXe;constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(s=>{delete s.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":pP.sorters[e.definition.sorter]?i=pP.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var s="",o=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?s=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?s=e.modules.sort.dir=="asc"?"desc":"asc":s="none";else switch(e.modules.sort.dir){case"asc":s="desc";break;case"desc":s="asc";break;default:s=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(o=this.getSort(),l=o.findIndex(c=>c.field===e.getField()),l>-1?(o[l].dir=s,l=o.splice(l,1)[0],s!="none"&&o.push(l)):s!="none"&&o.push({column:e,dir:s}),this.setSort(o)):s=="none"?this.clear():this.setSort(e,s),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var s;s=r.table.columnManager.findColumn(a.column),s?(a.column=s,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return pP.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,l){var c;o.column&&(c=o.column.modules.sort,c&&(c.sorter||(c.sorter=r.findSorter(o.column)),o.params=typeof c.params=="function"?c.params(o.column.getComponent(),o.dir):c.params,a.push(o)),i||r.setColumnHeader(o.column,o.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(o,l){r.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var s,o=r;o>=0;o--){let l=i[o];if(s=this._sortRow(n,a,l.column,l.dir,l.params),s!==0)break}return s})}_sortRow(e,i,r,n,a){var s,o,l=n=="asc"?e:i,c=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",s=l.getComponent(),o=c.getComponent(),r.modules.sort.sorter.call(this,e,i,s,o,r.getComponent(),n,a)}}class lXe{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class KUe{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class QX extends Bl{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new lXe(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((s,o)=>{var l=this.columnFields[o];l&&(n[l]=s)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new KUe(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(s=>{var o=[];this.columnFields.forEach(l=>{o.push(s[l])}),i.push(o)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(s=>s.findLastIndex(o=>typeof o<"u")+1),n=Math.max(...r),a=r.findLastIndex(s=>s>0)+1,i=i.slice(0,a),i=i.map(s=>s.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class cXe extends Nr{static moduleName="spreadsheet";constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new QX(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof QX?e:e instanceof KUe?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}let uXe=class extends Nr{static moduleName="tooltip";constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,s;function o(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),o)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof W0?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),s=this.popupInstance.containerEventCoords(e),this.popupInstance.show(s.x+15,s.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}};var dXe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(s){var o=s.getData();o!==n&&e==a.getFieldValue(o)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class Z8 extends Nr{static moduleName="validate";static validators=dXe;constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:Z8.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],s=this.invalidCells.indexOf(i);return e&&e.forEach(o=>{o.func.call(n,i.getComponent(),r,o.params)||a.push({type:o.type,parameters:o.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),s==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),s>-1&&this.invalidCells.splice(s,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}var PB=Object.freeze({__proto__:null,AccessorModule:j_,AjaxModule:XS,ClipboardModule:aKe,ColumnCalcsModule:JS,DataTreeModule:lKe,DownloadModule:G_,EditModule:q8,ExportModule:uP,FilterModule:Tb,FormatModule:QS,FrozenColumnsModule:iZe,FrozenRowsModule:rZe,GroupRowsModule:aZe,HistoryModule:dZe,HtmlTableImportModule:pZe,ImportModule:W8,InteractionModule:yZe,KeybindingsModule:dP,MenuModule:wZe,MoveColumnsModule:SZe,MoveRowsModule:H_,MutatorModule:z_,PageModule:Y8,PersistenceModule:wf,PopupModule:NZe,PrintModule:AZe,ReactiveDataModule:_Ze,ResizeColumnsModule:kZe,ResizeRowsModule:OZe,ResizeTableModule:xZe,ResponsiveLayoutModule:BZe,SelectRangeModule:JZe,SelectRowModule:jZe,SortModule:pP,SpreadsheetModule:cXe,TooltipModule:uXe,ValidateModule:Z8}),pXe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class ZUe{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class e2 extends Bl{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),s=0;return new Promise((o,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&ba.elVisible(a)&&(s=ba.elOffset(a).top-ba.elOffset(this.elementVertical).top,s>0&&s<this.elementVertical.clientHeight-a.offsetHeight))return o(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}o()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class hXe extends e2{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class fXe extends e2{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var s={},o;a.visible&&(a.modules.frozen||(o=a.getWidth(),s.leftPos=n,s.rightPos=n+o,s.width=o,this.isFitData&&(s.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+o>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=o),this.columns.push(a),a.modules.vdomHoz=s,n+=o))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++){let r=this.columns[i];r&&r.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var s=a.getCell(r);a.getElement().insertBefore(s.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),s.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColRight",s.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(s){console.warn("Could not removeColLeft",s.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class mXe extends Bl{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new ZUe(this.table,"column definition",YUe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:fXe,basic:hXe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r={},n=this.table.options.autoColumns==="full"?e:[e[0]],a=this.table.options.autoColumnsDefinitions;if(e&&e.length){if(n.forEach(s=>{Object.keys(s).forEach((o,l)=>{let c=s[o],u;r[o]?r[o]!==!0&&typeof c<"u"&&(r[o].sorter=this.calculateSorterFromValue(c),r[o]=!0):(u={field:o,title:o,sorter:this.calculateSorterFromValue(c)},i.splice(l,0,u),r[o]=typeof c>"u"?u:!0)})}),a)switch(typeof a){case"function":this.table.options.columns=a.call(this.table,i);break;case"object":Array.isArray(a)?i.forEach(s=>{var o=a.find(l=>l.field===s.field);o&&Object.assign(s,o)}):i.forEach(s=>{a[s.field]&&Object.assign(s,a[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(e){var i;switch(typeof e){case"undefined":i="string";break;case"boolean":i="boolean";break;case"number":i="number";break;case"object":Array.isArray(e)?i="array":i="string";break;default:!isNaN(e)&&e!==""?i="number":e.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?i="alphanum":i="string";break}return i}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Mf(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new Mf(e,this),a=n.getElement(),s=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,s=0),r&&s>-1){var o=r.getTopColumn(),l=this.columns.indexOf(o),c=o.getElement();i?(this.columns.splice(l,0,n),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,n),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof Mf)return e;if(e instanceof WUe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var s=e.indexOf(i),o,l=[];s>-1&&(e.splice(s,1),o=e.indexOf(r),o>-1?n&&(o=o+1):o=s,e.splice(o,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(s,1)[0];c.cells.splice(o,0,u)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),s=0,o=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":s=-this.element.clientWidth/2;break;case"right":s=o.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+o.offsetWidth<this.element.clientWidth)return!1;n=a+s,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,s;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?s=e/100*parseInt(n):s=parseInt(n):s=n,i+=s>a?s:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var s=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&s.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(s)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){ba.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class gXe extends e2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,s)=>{this.styleRow(a,s),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=ba.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=ba.elOffset(i).top-ba.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class vXe extends e2{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,s=this.rows(),o=this.vDomTop;o<=this.vDomBottom;o++)if(s[o]){var l=i-s[o].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=o;else break}s.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,s=this.rows();if(this.scrollTop=e,-r>a||n>a){var o=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*s.length)),this.scrollColumns(o)}else i?(r<0&&this._addTopRow(s,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(s,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(s,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(s,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,s=0,o=this.rows();if(e)a=this.vDomTop,s=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l])if(n)if(r-o[l].getElement().offsetTop>=0)s=l;else break;else if(i-o[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-o[l].getElement().offsetTop>=0)s=l;else break;return o.slice(a,s+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,s=0,o=0,l=0,c=0,u=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,w=this.elementVertical.clientHeight,T=this.table.options.rowHeight,S=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);c=(h-e+1)*this.vDomRowHeight,c<w&&(e-=Math.ceil((w-c)/this.vDomRowHeight),e<0&&(e=0)),s=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=s}if(h&&ba.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(T&&(b=w/T+this.vDomWindowBuffer/T),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=h;(b==h||o<=w+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;n.appendChild(g),v.forEach(D=>{D.rendered(),D.heightInitialized||D.calcHeight(!0)}),v.forEach(D=>{D.heightInitialized||D.setCellHeight()}),v.forEach(D=>{l=D.getHeight(),y<s?u+=l:o+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),S=this.table.rowManager.adjustTableSize(),w=this.elementVertical.clientHeight,S&&(I||this.table.options.maxHeight)&&(T=o/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w/T+this.vDomWindowBuffer/T)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-o-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((o+u)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=u+o+this.vDomBottomPad-w),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-w:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-w),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-w),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomTop-1,o=0,l=!0;l;)if(this.vDomTop){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),r.insertBefore(c.getElement(),r.firstChild),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,s--,o++):l=!1):l=!1}else l=!1;for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=s*this.vDomRowHeight),s<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomTop],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,s=this.vDomBottom+1,o=0,l=!0;l;){let c=e[s],u,d;c&&o<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,s),r.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,s++,o++):l=!1):l=!1}for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||s==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,s=!0;s;){let o=e[this.vDomBottom],l;o&&a<this.vDomMaxRenderChain?(l=o.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(o),a++):s=!1):s=!1}for(let o of r){let l=o.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class yXe extends Bl{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof Zl)return e;if(e instanceof JF)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new Zl(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var s=a.indexOf(e);s>-1&&a.splice(s,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((s,o)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,r,!0);a.push(u),this.dispatch("row-added",u,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),s(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof Zl?e:new Zl(e||{},this),s=this.findAddRowPos(i),o=-1,l,c;return r||(c=this.chain("row-adding-position",[a,s],null,{index:r,top:s}),r=c.index,s=c.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,s],null,r),r&&(o=this.rows.indexOf(r)),r&&o>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(u){var d=u.indexOf(r);d>-1&&u.splice(s?d:d+1,0,a)}),l>-1&&this.activeRows.splice(s?l:l+1,0,a),this.rows.splice(s?o:o+1,0,a)):s?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,s,o,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),s=e.indexOf(r),s>-1?n?e.splice(s+1,0,i):e.splice(s,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){o=a<s?a:s,l=s>a?s:a+1;for(let c=o;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof Zl)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof Zl)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",s=0,o=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(s=this.dataPipeline.findIndex(l=>l.handler===e),s>-1)a="dataPipeline",i&&(s==this.dataPipeline.length-1?a="display":s++);else if(s=this.displayPipeline.findIndex(l=>l.handler===e),s>-1)a="displayPipeline",i&&(s==this.displayPipeline.length-1?a="end":s++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",s=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&s<this.redrawBlockRestoreConfig.index||o.indexOf(a)<o.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:s});return}else ba.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,s,r)):(this.refreshPipelines(e,a,s,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,s,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let s=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=s||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let s=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(s||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:vXe,basic:gXe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(e){this.activeRows.forEach(function(i){i.normalizeHeight(e)})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class bXe extends Bl{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class IXe extends Bl{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var s=n[e];return a!==e&&(!s||s&&!s.includes(a))}),r.forEach(a=>{var s=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,s),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),s=!1;r?a===-1&&(n.push(e),s=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),s=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),s&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let o=a.filter(l=>r.includes(l));for(let l of o)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},s={},o={};for(let l of r){let c,u=i[l],d=this.previousTargets[l];if(d&&d.target===u)c=d.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(c=this.table.rowManager.getVisibleRows(!0).find(h=>h.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[l]=!1));break;case"column":n.components.includes("column")&&(c=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(a.row instanceof Zl?c=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}c&&(a[l]=c,o[l]={target:u,component:c})}return this.previousTargets=o,Object.keys(i).forEach(l=>{let c=a[l];s[l]=c}),s}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class wXe{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class SXe extends Bl{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,s){var o=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[c],null,c);o==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,n,typeof s>"u"?!n:s))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof s>"u"?!n:s),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class TXe{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let s=n.apply(this.table,e);a||(r=s)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class UXe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((s,o)=>{a=s.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class DXe extends Bl{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class EXe extends Bl{constructor(e){super(e),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(e,i,r){if(Array.isArray(e)){for(const a of e){var n=this.lookup(a,i,!0);if(n)break}if(n)return n;this.error(e)}else return i?this.lookupProp(e,i,r):this.lookupKey(e,r)}lookupProp(e,i,r){var n;if(this.props[e]&&this.props[e][i])return this.props[e][i];if(n=this.lookupKey(e,r),n)return this.props[e]||(this.props[e]={}),this.props[e][i]=n[i]||n,this.props[e][i]}lookupKey(e,i){var r;return this.deps[e]?r=this.deps[e]:window[e]?(this.deps[e]=window[e],r=this.deps[e]):i||this.error(e),r}error(e){console.error("Unable to find dependency",e,"Please check documentation and ensure you have imported the required library into your project")}}function PXe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function eJ(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function CXe(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((s,o)=>{s.widthFixed||s.reinitializeWidth(),(this.table.options.responsiveLayout?s.modules.responsive.visible:s.visible)&&(a=s),s.visible&&(i+=s.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function RXe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,s=0,o=[],l=[],c=0,u=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],b=0,I=0,w=0,T=a,S=0,D=0,C=[];function E(R){return g*(R.column.definition.widthGrow||1)}function P(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return f.forEach(function(R,M){var A=v?P(R):E(R);R.column.minWidth>=A?y.push(R):R.column.maxWidth&&R.column.maxWidth<A?(R.width=R.column.maxWidth,m-=R.column.maxWidth,T-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,T&&(g=Math.floor(m/T))):(C.push(R),D+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){b+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),I=m-b,w=D?Math.floor(I/D):I,S=h(C,I,w,v)):(S=D?m-Math.floor(m/D)*D:m,C.forEach(function(R){R.width=v?P(R):E(R)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),r+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),c+=f.definition.widthShrink)):(o.push({column:f,width:0}),a+=f.definition.widthGrow||1))}),n=i-r,s=Math.floor(n/a),d=h(o,n,s,!1),o.length&&d>0&&(o[o.length-1].width+=d),o.forEach(function(f){n-=f.width}),u=Math.abs(d)+n,u>0&&c&&(d=h(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),o.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var MXe={fitData:PXe,fitDataFill:eJ,fitDataTable:eJ,fitDataStretch:CXe,fitColumns:RXe};class q_ extends Nr{static moduleName="layout";static modes=MXe;constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;q_.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){var i=this.table.columnManager.columnsByIndex.find(r=>r.definition.variableHeight||r.definition.formatter==="textarea");this.dispatch("layout-refreshing"),q_.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),i&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var NXe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class X8 extends Nr{static moduleName="localize";static langs=NXe;constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=ba.deepClone(X8.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=ba.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}class AXe extends Nr{static moduleName="comms";constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(s=>{s.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}var _Xe=Object.freeze({__proto__:null,CommsModule:AXe,LayoutModule:q_,LocalizeModule:X8});class Gd{static registry={tables:[],register(e){Gd.registry.tables.push(e)},deregister(e){var i=Gd.registry.tables.indexOf(e);i>-1&&Gd.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var s=0;s<n.length;s++)a=Gd.registry.matchElement(n[s]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Gd?(a=Gd.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(o){r=r.concat(Gd.registry.lookupTable(o))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return Gd.registry.tables.find(function(i){return e instanceof Gd?i===e:i.element===e})}};static findTable(e){var i=Gd.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}}class Xa extends Gd{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(e){Xa.modulesRegistered||(Xa.modulesRegistered=!0,Xa._registerModules(_Xe,!0),e&&Xa._registerModules(e))}static _extendModule(e,i,r){if(Xa.moduleBindings[e]){var n=Xa.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),Xa._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{Xa._registerModuleBinding(i),Xa._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?Xa.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(Xa.moduleBindings[r])for(let a in n)Xa._extendModule(r,a,n[a]);else{Xa.moduleExtensions[r]||(Xa.moduleExtensions[r]={});for(let a in n)Xa.moduleExtensions[r][a]||(Xa.moduleExtensions[r][a]={}),Object.assign(Xa.moduleExtensions[r][a],n[a])}}Xa._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=Xa.moduleExtensions[e.moduleName];if(i)for(let r in i)Xa._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in Xa.moduleBindings){let a=Xa.moduleBindings[n],s=new a(this);this.modules[n]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?e.push(s):i.push(s):r.push(s)}e.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}}class kXe extends Bl{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class Dv extends Xa{static defaultOptions=pXe;static extendModule(){Dv.initializeModuleBinder(),Dv._extendModule(...arguments)}static registerModule(){Dv.initializeModuleBinder(),Dv._registerModule(...arguments)}constructor(e,i,r){super(),Dv.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new wXe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new DXe(this),this.optionsList=new ZUe(this,"table constructor"),this.dependencyRegistry=new EXe(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new mXe(this),this.rowManager=new yXe(this),this.footerManager=new bXe(this),this.dataLoader=new SXe(this),this.alertManager=new kXe(this),this._bindModules(),this.options=this.optionsList.generate(Dv.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new TXe(this,this.options,this.options.debugEventsExternal),this.eventBus=new UXe(this.options.debugEventsInternal),this.interactionMonitor=new IXe(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);s?(i++,s.updateData(a).then(()=>{i--,i||r()}).catch(o=>{n("Update Error - Unable to update row",a,o)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(s=>{var o=[];s.forEach(function(l){o.push(l.getComponent())}),n(o)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);r++,o?o.updateData(s).then(()=>{r--,i.push(o.getComponent()),r||n(i)}):this.rowManager.addRows(s).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var s=this.columnManager.findColumn(e);return s?this.columnManager.scrollToColumn(s,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}var fE=Dv;class OXe extends fE{static extendModule(){fE.initializeModuleBinder(PB),fE._extendModule(...arguments)}static registerModule(){fE.initializeModuleBinder(PB),fE._registerModule(...arguments)}constructor(e,i,r){super(e,i,PB)}}var ks=OXe;const{MALE:xXe,FEMALE:LXe}=_p;function FXe(t){const e=t.getValue(),i=t.getRow().getData(),r=i.sex||i.person?.sex,n=r?.toUpperCase()===xXe&&"#2E86C1"||r?.toUpperCase()===LXe&&"#AA336A"||"",a=document.createElement("div");return a.style.color=n,a.innerHTML=e,a}function BXe(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:FXe,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function XUe(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:r=1,targetAttribute:n,placeholder:a,onSelected:s,anchorId:o}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...h})=>({...h,participantName:"BYE",...p}))),e.forEach(p=>p.searchText=p.participantName?.toLowerCase());const c=BXe(e),u=document.getElementById(o),d=new ks(u,{placeholder:a||"No options",selectableRows:r,index:n,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:c,data:e});return ht.tables||(ht.tables=[]),ht.tables.selectionTable||(ht.tables={...ht.tables,selectionTable:d}),d.on("tableBuilt",()=>{i?.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,h)=>{const f=h?.map(m=>m.getData());Pt(s)&&s?.(f)}),{table:d}}function J8(t){const{title:e,placeholder:i,options:r,selectionLimit:n}=t,a="selectionControl",s="selectionTable",o=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{ht.tables.selectionTable?.destroy(),delete ht.tables.selectionTable},c=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${s}'></div>
    </div>
  `;Kr({title:e,content:c,buttons:o,onClose:l});const u=m=>{m?.[0]?.onClick&&(m[0].onClick(),pU())},{table:d}=XUe({targetAttribute:"participantid",selectionLimit:n,data:r,placeholder:i,onSelected:u,anchorId:s}),p=qw(d),h=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:ui,search:!0}],f=document.getElementById(a)||void 0;bo({table:d,target:f,items:h})}var Lu="top",Mp="bottom",Np="right",Fu="left",Q8="auto",Y0=[Lu,Mp,Np,Fu],fU="start",jC="end",$Xe="clippingParents",JUe="viewport",mE="popper",VXe="reference",tJ=Y0.reduce(function(t,e){return t.concat([e+"-"+fU,e+"-"+jC])},[]),QUe=[].concat(Y0,[Q8]).reduce(function(t,e){return t.concat([e,e+"-"+fU,e+"-"+jC])},[]),jXe="beforeRead",GXe="read",HXe="afterRead",zXe="beforeMain",qXe="main",WXe="afterMain",YXe="beforeWrite",KXe="write",ZXe="afterWrite",XXe=[jXe,GXe,HXe,zXe,qXe,WXe,YXe,KXe,ZXe];function lm(t){return t?(t.nodeName||"").toLowerCase():null}function Rd(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function RI(t){var e=Rd(t).Element;return t instanceof e||t instanceof Element}function cp(t){var e=Rd(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function e9(t){if(typeof ShadowRoot>"u")return!1;var e=Rd(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function JXe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!cp(a)||!lm(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(s){var o=n[s];o===!1?a.removeAttribute(s):a.setAttribute(s,o===!0?"":o)}))})}function QXe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},s=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),o=s.reduce(function(l,c){return l[c]="",l},{});!cp(n)||!lm(n)||(Object.assign(n.style,o),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const eDe={name:"applyStyles",enabled:!0,phase:"write",fn:JXe,effect:QXe,requires:["computeStyles"]};function Lf(t){return t.split("-")[0]}var Qb=Math.max,W_=Math.min,mU=Math.round;function Zj(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function tDe(){return!/^((?!chrome|android).)*safari/i.test(Zj())}function gU(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&cp(t)&&(n=t.offsetWidth>0&&mU(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&mU(r.height)/t.offsetHeight||1);var s=RI(t)?Rd(t):window,o=s.visualViewport,l=!tDe()&&i,c=(r.left+(l&&o?o.offsetLeft:0))/n,u=(r.top+(l&&o?o.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function t9(t){var e=gU(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function iDe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&e9(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Pg(t){return Rd(t).getComputedStyle(t)}function eJe(t){return["table","td","th"].indexOf(lm(t))>=0}function ib(t){return((RI(t)?t.ownerDocument:t.document)||window.document).documentElement}function t2(t){return lm(t)==="html"?t:t.assignedSlot||t.parentNode||(e9(t)?t.host:null)||ib(t)}function iJ(t){return!cp(t)||Pg(t).position==="fixed"?null:t.offsetParent}function tJe(t){var e=/firefox/i.test(Zj()),i=/Trident/i.test(Zj());if(i&&cp(t)){var r=Pg(t);if(r.position==="fixed")return null}var n=t2(t);for(e9(n)&&(n=n.host);cp(n)&&["html","body"].indexOf(lm(n))<0;){var a=Pg(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function K0(t){for(var e=Rd(t),i=iJ(t);i&&eJe(i)&&Pg(i).position==="static";)i=iJ(i);return i&&(lm(i)==="html"||lm(i)==="body"&&Pg(i).position==="static")?e:i||tJe(t)||e}function i9(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function hP(t,e,i){return Qb(t,W_(e,i))}function iJe(t,e,i){var r=hP(t,e,i);return r>i?i:r}function rDe(){return{top:0,right:0,bottom:0,left:0}}function nDe(t){return Object.assign({},rDe(),t)}function aDe(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var rJe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,nDe(typeof e!="number"?e:aDe(e,Y0))};function nJe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,s=i.modifiersData.popperOffsets,o=Lf(i.placement),l=i9(o),c=[Fu,Np].indexOf(o)>=0,u=c?"height":"width";if(!(!a||!s)){var d=rJe(n.padding,i),p=t9(a),h=l==="y"?Lu:Fu,f=l==="y"?Mp:Np,m=i.rects.reference[u]+i.rects.reference[l]-s[l]-i.rects.popper[u],g=s[l]-i.rects.reference[l],v=K0(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[h],w=y-p[u]-d[f],T=y/2-p[u]/2+b,S=hP(I,T,w),D=l;i.modifiersData[r]=(e={},e[D]=S,e.centerOffset=S-T,e)}}function aJe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||iDe(e.elements.popper,n)&&(e.elements.arrow=n))}const sJe={name:"arrow",enabled:!0,phase:"main",fn:nJe,effect:aJe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function vU(t){return t.split("-")[1]}var oJe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lJe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:mU(i*n)/n||0,y:mU(r*n)/n||0}}function rJ(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,s=t.offsets,o=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=s.x,h=p===void 0?0:p,f=s.y,m=f===void 0?0:f,g=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=s.hasOwnProperty("x"),y=s.hasOwnProperty("y"),b=Fu,I=Lu,w=window;if(c){var T=K0(i),S="clientHeight",D="clientWidth";if(T===Rd(i)&&(T=ib(i),Pg(T).position!=="static"&&o==="absolute"&&(S="scrollHeight",D="scrollWidth")),T=T,n===Lu||(n===Fu||n===Np)&&a===jC){I=Mp;var C=d&&T===w&&w.visualViewport?w.visualViewport.height:T[S];m-=C-r.height,m*=l?1:-1}if(n===Fu||(n===Lu||n===Mp)&&a===jC){b=Np;var E=d&&T===w&&w.visualViewport?w.visualViewport.width:T[D];h-=E-r.width,h*=l?1:-1}}var P=Object.assign({position:o},c&&oJe),R=u===!0?lJe({x:h,y:m},Rd(i)):{x:h,y:m};if(h=R.x,m=R.y,l){var M;return Object.assign({},P,(M={},M[I]=y?"0":"",M[b]=v?"0":"",M.transform=(w.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",M))}return Object.assign({},P,(e={},e[I]=y?m+"px":"",e[b]=v?h+"px":"",e.transform="",e))}function cJe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,s=a===void 0?!0:a,o=i.roundOffsets,l=o===void 0?!0:o,c={placement:Lf(e.placement),variation:vU(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,rJ(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,rJ(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const uJe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:cJe,data:{}};var AM={passive:!0};function dJe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,s=r.resize,o=s===void 0?!0:s,l=Rd(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,AM)}),o&&l.addEventListener("resize",i.update,AM),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,AM)}),o&&l.removeEventListener("resize",i.update,AM)}}const pJe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:dJe,data:{}};var hJe={left:"right",right:"left",bottom:"top",top:"bottom"};function YN(t){return t.replace(/left|right|bottom|top/g,function(e){return hJe[e]})}var fJe={start:"end",end:"start"};function nJ(t){return t.replace(/start|end/g,function(e){return fJe[e]})}function r9(t){var e=Rd(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function n9(t){return gU(ib(t)).left+r9(t).scrollLeft}function mJe(t,e){var i=Rd(t),r=ib(t),n=i.visualViewport,a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(n){a=n.width,s=n.height;var c=tDe();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:a,height:s,x:o+n9(t),y:l}}function gJe(t){var e,i=ib(t),r=r9(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=Qb(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),s=Qb(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+n9(t),l=-r.scrollTop;return Pg(n||i).direction==="rtl"&&(o+=Qb(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:s,x:o,y:l}}function a9(t){var e=Pg(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function sDe(t){return["html","body","#document"].indexOf(lm(t))>=0?t.ownerDocument.body:cp(t)&&a9(t)?t:sDe(t2(t))}function fP(t,e){var i;e===void 0&&(e=[]);var r=sDe(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Rd(r),s=n?[a].concat(a.visualViewport||[],a9(r)?r:[]):r,o=e.concat(s);return n?o:o.concat(fP(t2(s)))}function Xj(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function vJe(t,e){var i=gU(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function aJ(t,e,i){return e===JUe?Xj(mJe(t,i)):RI(e)?vJe(e,i):Xj(gJe(ib(t)))}function yJe(t){var e=fP(t2(t)),i=["absolute","fixed"].indexOf(Pg(t).position)>=0,r=i&&cp(t)?K0(t):t;return RI(r)?e.filter(function(n){return RI(n)&&iDe(n,r)&&lm(n)!=="body"}):[]}function bJe(t,e,i,r){var n=e==="clippingParents"?yJe(t):[].concat(e),a=[].concat(n,[i]),s=a[0],o=a.reduce(function(l,c){var u=aJ(t,c,r);return l.top=Qb(u.top,l.top),l.right=W_(u.right,l.right),l.bottom=W_(u.bottom,l.bottom),l.left=Qb(u.left,l.left),l},aJ(t,s,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function oDe(t){var e=t.reference,i=t.element,r=t.placement,n=r?Lf(r):null,a=r?vU(r):null,s=e.x+e.width/2-i.width/2,o=e.y+e.height/2-i.height/2,l;switch(n){case Lu:l={x:s,y:e.y-i.height};break;case Mp:l={x:s,y:e.y+e.height};break;case Np:l={x:e.x+e.width,y:o};break;case Fu:l={x:e.x-i.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?i9(n):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case fU:l[c]=l[c]-(e[u]/2-i[u]/2);break;case jC:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function GC(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,s=a===void 0?t.strategy:a,o=i.boundary,l=o===void 0?$Xe:o,c=i.rootBoundary,u=c===void 0?JUe:c,d=i.elementContext,p=d===void 0?mE:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=nDe(typeof g!="number"?g:aDe(g,Y0)),y=p===mE?VXe:mE,b=t.rects.popper,I=t.elements[f?y:p],w=bJe(RI(I)?I:I.contextElement||ib(t.elements.popper),l,u,s),T=gU(t.elements.reference),S=oDe({reference:T,element:b,placement:n}),D=Xj(Object.assign({},b,S)),C=p===mE?D:T,E={top:w.top-C.top+v.top,bottom:C.bottom-w.bottom+v.bottom,left:w.left-C.left+v.left,right:C.right-w.right+v.right},P=t.modifiersData.offset;if(p===mE&&P){var R=P[n];Object.keys(E).forEach(function(M){var A=[Np,Mp].indexOf(M)>=0?1:-1,N=[Lu,Mp].indexOf(M)>=0?"y":"x";E[M]+=R[N]*A})}return E}function IJe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,s=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?QUe:l,u=vU(r),d=u?o?tJ:tJ.filter(function(f){return vU(f)===u}):Y0,p=d.filter(function(f){return c.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=GC(t,{placement:m,boundary:n,rootBoundary:a,padding:s})[Lf(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function wJe(t){if(Lf(t)===Q8)return[];var e=YN(t);return[nJ(t),e,nJ(e)]}function SJe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!0:s,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=Lf(g),y=v===g,b=l||(y||!f?[YN(g)]:wJe(g)),I=[g].concat(b).reduce(function(z,H){return z.concat(Lf(H)===Q8?IJe(e,{placement:H,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):H)},[]),w=e.rects.reference,T=e.rects.popper,S=new Map,D=!0,C=I[0],E=0;E<I.length;E++){var P=I[E],R=Lf(P),M=vU(P)===fU,A=[Lu,Mp].indexOf(R)>=0,N=A?"width":"height",k=GC(e,{placement:P,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),x=A?M?Np:Fu:M?Mp:Lu;w[N]>T[N]&&(x=YN(x));var O=YN(x),V=[];if(a&&V.push(k[R]<=0),o&&V.push(k[x]<=0,k[O]<=0),V.every(function(z){return z})){C=P,D=!1;break}S.set(P,V)}if(D)for(var F=f?3:1,j=function(H){var Z=I.find(function(J){var ie=S.get(J);if(ie)return ie.slice(0,H).every(function(K){return K})});if(Z)return C=Z,"break"},q=F;q>0;q--){var W=j(q);if(W==="break")break}e.placement!==C&&(e.modifiersData[r]._skip=!0,e.placement=C,e.reset=!0)}}const TJe={name:"flip",enabled:!0,phase:"main",fn:SJe,requiresIfExists:["offset"],data:{_skip:!1}};function sJ(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function oJ(t){return[Lu,Np,Mp,Fu].some(function(e){return t[e]>=0})}function UJe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,s=GC(e,{elementContext:"reference"}),o=GC(e,{altBoundary:!0}),l=sJ(s,r),c=sJ(o,n,a),u=oJ(l),d=oJ(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const DJe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:UJe};function EJe(t,e,i){var r=Lf(t),n=[Fu,Lu].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,s=a[0],o=a[1];return s=s||0,o=(o||0)*n,[Fu,Np].indexOf(r)>=0?{x:o,y:s}:{x:s,y:o}}function PJe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,s=QUe.reduce(function(u,d){return u[d]=EJe(d,e.rects,a),u},{}),o=s[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=s}const CJe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:PJe};function RJe(t){var e=t.state,i=t.name;e.modifiersData[i]=oDe({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const MJe={name:"popperOffsets",enabled:!0,phase:"read",fn:RJe,data:{}};function NJe(t){return t==="x"?"y":"x"}function AJe(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,s=i.altAxis,o=s===void 0?!1:s,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=GC(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=Lf(e.placement),y=vU(e.placement),b=!y,I=i9(v),w=NJe(I),T=e.modifiersData.popperOffsets,S=e.rects.reference,D=e.rects.popper,C=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof C=="number"?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),P=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(T){if(a){var M,A=I==="y"?Lu:Fu,N=I==="y"?Mp:Np,k=I==="y"?"height":"width",x=T[I],O=x+g[A],V=x-g[N],F=h?-D[k]/2:0,j=y===fU?S[k]:D[k],q=y===fU?-D[k]:-S[k],W=e.elements.arrow,z=h&&W?t9(W):{width:0,height:0},H=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:rDe(),Z=H[A],J=H[N],ie=hP(0,S[k],z[k]),K=b?S[k]/2-F-ie-Z-E.mainAxis:j-ie-Z-E.mainAxis,ne=b?-S[k]/2+F+ie+J+E.mainAxis:q+ie+J+E.mainAxis,le=e.elements.arrow&&K0(e.elements.arrow),re=le?I==="y"?le.clientTop||0:le.clientLeft||0:0,me=(M=P?.[I])!=null?M:0,he=x+K-me-re,Ie=x+ne-me,Le=hP(h?W_(O,he):O,x,h?Qb(V,Ie):V);T[I]=Le,R[I]=Le-x}if(o){var ot,at=I==="x"?Lu:Fu,dt=I==="x"?Mp:Np,It=T[w],ze=w==="y"?"height":"width",Ct=It+g[at],ke=It-g[dt],mt=[Lu,Fu].indexOf(v)!==-1,Be=(ot=P?.[w])!=null?ot:0,ut=mt?Ct:It-S[ze]-D[ze]-Be+E.altAxis,it=mt?It+S[ze]+D[ze]-Be-E.altAxis:ke,xe=h&&mt?iJe(ut,It,it):hP(h?ut:Ct,It,h?it:ke);T[w]=xe,R[w]=xe-It}e.modifiersData[r]=R}}const _Je={name:"preventOverflow",enabled:!0,phase:"main",fn:AJe,requiresIfExists:["offset"]};function kJe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function OJe(t){return t===Rd(t)||!cp(t)?r9(t):kJe(t)}function xJe(t){var e=t.getBoundingClientRect(),i=mU(e.width)/t.offsetWidth||1,r=mU(e.height)/t.offsetHeight||1;return i!==1||r!==1}function LJe(t,e,i){i===void 0&&(i=!1);var r=cp(e),n=cp(e)&&xJe(e),a=ib(e),s=gU(t,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((lm(e)!=="body"||a9(a))&&(o=OJe(e)),cp(e)?(l=gU(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=n9(a))),{x:s.left+o.scrollLeft-l.x,y:s.top+o.scrollTop-l.y,width:s.width,height:s.height}}function FJe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var s=[].concat(a.requires||[],a.requiresIfExists||[]);s.forEach(function(o){if(!i.has(o)){var l=e.get(o);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function BJe(t){var e=FJe(t);return XXe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function $Je(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function VJe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var lJ={placement:"bottom",modifiers:[],strategy:"absolute"};function cJ(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function jJe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?lJ:n;return function(o,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},lJ,a),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:u,setOptions:function(v){var y=typeof v=="function"?v(u.options):v;m(),u.options=Object.assign({},a,u.options,y),u.scrollParents={reference:RI(o)?fP(o):o.contextElement?fP(o.contextElement):[],popper:fP(l)};var b=BJe(VJe([].concat(r,u.options.modifiers)));return u.orderedModifiers=b.filter(function(I){return I.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=u.elements,y=v.reference,b=v.popper;if(cJ(y,b)){u.rects={reference:LJe(y,K0(b),u.options.strategy==="fixed"),popper:t9(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(E){return u.modifiersData[E.name]=Object.assign({},E.data)});for(var I=0;I<u.orderedModifiers.length;I++){if(u.reset===!0){u.reset=!1,I=-1;continue}var w=u.orderedModifiers[I],T=w.fn,S=w.options,D=S===void 0?{}:S,C=w.name;typeof T=="function"&&(u=T({state:u,options:D,name:C,instance:h})||u)}}}},update:$Je(function(){return new Promise(function(g){h.forceUpdate(),g(u)})}),destroy:function(){m(),p=!0}};if(!cJ(o,l))return h;h.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function f(){u.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var w=I({state:u,name:v,instance:h,options:b}),T=function(){};d.push(w||T)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var GJe=[pJe,MJe,uJe,eDe,CJe,TJe,_Je,sJe,DJe],HJe=jJe({defaultModifiers:GJe}),zJe="tippy-box",lDe="tippy-content",qJe="tippy-backdrop",cDe="tippy-arrow",uDe="tippy-svg-arrow",wb={passive:!0,capture:!0},dDe=function(){return document.body};function CB(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function s9(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function pDe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function uJ(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function WJe(t){return t.split(/\s+/).filter(Boolean)}function _S(t){return[].concat(t)}function dJ(t,e){t.indexOf(e)===-1&&t.push(e)}function YJe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function KJe(t){return t.split("-")[0]}function Y_(t){return[].slice.call(t)}function pJ(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function mP(){return document.createElement("div")}function i2(t){return["Element","Fragment"].some(function(e){return s9(t,e)})}function ZJe(t){return s9(t,"NodeList")}function XJe(t){return s9(t,"MouseEvent")}function JJe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function QJe(t){return i2(t)?[t]:ZJe(t)?Y_(t):Array.isArray(t)?t:Y_(document.querySelectorAll(t))}function RB(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function hJ(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function eQe(t){var e,i=_S(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function tQe(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,s=n.popperState,o=n.props,l=o.interactiveBorder,c=KJe(s.placement),u=s.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,h=c==="right"?u.left.x:0,f=c==="left"?u.right.x:0,m=a.top-r+d>l,g=r-a.bottom-p>l,v=a.left-i+h>l,y=i-a.right-f>l;return m||g||v||y})}function MB(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function fJ(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var Sf={isTouch:!1},mJ=0;function iQe(){Sf.isTouch||(Sf.isTouch=!0,window.performance&&document.addEventListener("mousemove",hDe))}function hDe(){var t=performance.now();t-mJ<20&&(Sf.isTouch=!1,document.removeEventListener("mousemove",hDe)),mJ=t}function rQe(){var t=document.activeElement;if(JJe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function nQe(){document.addEventListener("touchstart",iQe,wb),window.addEventListener("blur",rQe)}var aQe=typeof window<"u"&&typeof document<"u",sQe=aQe?!!window.msCrypto:!1,oQe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},lQe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ah=Object.assign({appendTo:dDe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},oQe,lQe),cQe=Object.keys(ah),uQe=function(e){var i=Object.keys(e);i.forEach(function(r){ah[r]=e[r]})};function fDe(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,s=n.defaultValue;if(a){var o;r[a]=t[a]!==void 0?t[a]:(o=ah[a])!=null?o:s}return r},{});return Object.assign({},t,i)}function dQe(t,e){var i=e?Object.keys(fDe(Object.assign({},ah,{plugins:e}))):cQe,r=i.reduce(function(n,a){var s=(t.getAttribute("data-tippy-"+a)||"").trim();if(!s)return n;if(a==="content")n[a]=s;else try{n[a]=JSON.parse(s)}catch{n[a]=s}return n},{});return r}function gJ(t,e){var i=Object.assign({},e,{content:pDe(e.content,[t])},e.ignoreAttributes?{}:dQe(t,e.plugins));return i.aria=Object.assign({},ah.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var pQe=function(){return"innerHTML"};function Jj(t,e){t[pQe()]=e}function vJ(t){var e=mP();return t===!0?e.className=cDe:(e.className=uDe,i2(t)?e.appendChild(t):Jj(e,t)),e}function yJ(t,e){i2(e.content)?(Jj(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Jj(t,e.content):t.textContent=e.content)}function Qj(t){var e=t.firstElementChild,i=Y_(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(lDe)}),arrow:i.find(function(r){return r.classList.contains(cDe)||r.classList.contains(uDe)}),backdrop:i.find(function(r){return r.classList.contains(qJe)})}}function mDe(t){var e=mP(),i=mP();i.className=zJe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=mP();r.className=lDe,r.setAttribute("data-state","hidden"),yJ(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,s){var o=Qj(e),l=o.box,c=o.content,u=o.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(a.content!==s.content||a.allowHTML!==s.allowHTML)&&yJ(c,t.props),s.arrow?u?a.arrow!==s.arrow&&(l.removeChild(u),l.appendChild(vJ(s.arrow))):l.appendChild(vJ(s.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:n}}mDe.$$tippy=!0;var hQe=1,_M=[],NB=[];function fQe(t,e){var i=gJ(t,Object.assign({},ah,fDe(pJ(e)))),r,n,a,s=!1,o=!1,l=!1,c=!1,u,d,p,h=[],f=uJ(he,i.interactiveDebounce),m,g=hQe++,v=null,y=YJe(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:mP(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:ut,setProps:it,setContent:xe,show:Ze,hide:st,hideWithInteractivity:qe,enable:mt,disable:Be,unmount:ft,destroy:_t};if(!i.render)return I;var w=i.render(I),T=w.popper,S=w.onUpdate;T.setAttribute("data-tippy-root",""),T.id="tippy-"+I.id,I.popper=T,t._tippy=I,T._tippy=I;var D=y.map(function(ve){return ve.fn(I)}),C=t.hasAttribute("aria-expanded");return le(),F(),x(),O("onCreate",[I]),i.showOnCreate&&Ct(),T.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),T.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",f)}),I;function E(){var ve=I.props.touch;return Array.isArray(ve)?ve:[ve,0]}function P(){return E()[0]==="hold"}function R(){var ve;return!!((ve=I.props.render)!=null&&ve.$$tippy)}function M(){return m||t}function A(){var ve=M().parentNode;return ve?eQe(ve):document}function N(){return Qj(T)}function k(ve){return I.state.isMounted&&!I.state.isVisible||Sf.isTouch||u&&u.type==="focus"?0:CB(I.props.delay,ve?0:1,ah.delay)}function x(ve){ve===void 0&&(ve=!1),T.style.pointerEvents=I.props.interactive&&!ve?"":"none",T.style.zIndex=""+I.props.zIndex}function O(ve,$e,De){if(De===void 0&&(De=!0),D.forEach(function(Oe){Oe[ve]&&Oe[ve].apply(Oe,$e)}),De){var je;(je=I.props)[ve].apply(je,$e)}}function V(){var ve=I.props.aria;if(ve.content){var $e="aria-"+ve.content,De=T.id,je=_S(I.props.triggerTarget||t);je.forEach(function(Oe){var nt=Oe.getAttribute($e);if(I.state.isVisible)Oe.setAttribute($e,nt?nt+" "+De:De);else{var Fe=nt&&nt.replace(De,"").trim();Fe?Oe.setAttribute($e,Fe):Oe.removeAttribute($e)}})}}function F(){if(!(C||!I.props.aria.expanded)){var ve=_S(I.props.triggerTarget||t);ve.forEach(function($e){I.props.interactive?$e.setAttribute("aria-expanded",I.state.isVisible&&$e===M()?"true":"false"):$e.removeAttribute("aria-expanded")})}}function j(){A().removeEventListener("mousemove",f),_M=_M.filter(function(ve){return ve!==f})}function q(ve){if(!(Sf.isTouch&&(l||ve.type==="mousedown"))){var $e=ve.composedPath&&ve.composedPath()[0]||ve.target;if(!(I.props.interactive&&fJ(T,$e))){if(_S(I.props.triggerTarget||t).some(function(De){return fJ(De,$e)})){if(Sf.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[I,ve]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),o=!0,setTimeout(function(){o=!1}),I.state.isMounted||Z())}}}function W(){l=!0}function z(){l=!1}function H(){var ve=A();ve.addEventListener("mousedown",q,!0),ve.addEventListener("touchend",q,wb),ve.addEventListener("touchstart",z,wb),ve.addEventListener("touchmove",W,wb)}function Z(){var ve=A();ve.removeEventListener("mousedown",q,!0),ve.removeEventListener("touchend",q,wb),ve.removeEventListener("touchstart",z,wb),ve.removeEventListener("touchmove",W,wb)}function J(ve,$e){K(ve,function(){!I.state.isVisible&&T.parentNode&&T.parentNode.contains(T)&&$e()})}function ie(ve,$e){K(ve,$e)}function K(ve,$e){var De=N().box;function je(Oe){Oe.target===De&&(MB(De,"remove",je),$e())}if(ve===0)return $e();MB(De,"remove",d),MB(De,"add",je),d=je}function ne(ve,$e,De){De===void 0&&(De=!1);var je=_S(I.props.triggerTarget||t);je.forEach(function(Oe){Oe.addEventListener(ve,$e,De),h.push({node:Oe,eventType:ve,handler:$e,options:De})})}function le(){P()&&(ne("touchstart",me,{passive:!0}),ne("touchend",Ie,{passive:!0})),WJe(I.props.trigger).forEach(function(ve){if(ve!=="manual")switch(ne(ve,me),ve){case"mouseenter":ne("mouseleave",Ie);break;case"focus":ne(sQe?"focusout":"blur",Le);break;case"focusin":ne("focusout",Le);break}})}function re(){h.forEach(function(ve){var $e=ve.node,De=ve.eventType,je=ve.handler,Oe=ve.options;$e.removeEventListener(De,je,Oe)}),h=[]}function me(ve){var $e,De=!1;if(!(!I.state.isEnabled||ot(ve)||o)){var je=(($e=u)==null?void 0:$e.type)==="focus";u=ve,m=ve.currentTarget,F(),!I.state.isVisible&&XJe(ve)&&_M.forEach(function(Oe){return Oe(ve)}),ve.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||s)&&I.props.hideOnClick!==!1&&I.state.isVisible?De=!0:Ct(ve),ve.type==="click"&&(s=!De),De&&!je&&ke(ve)}}function he(ve){var $e=ve.target,De=M().contains($e)||T.contains($e);if(!(ve.type==="mousemove"&&De)){var je=ze().concat(T).map(function(Oe){var nt,Fe=Oe._tippy,wt=(nt=Fe.popperInstance)==null?void 0:nt.state;return wt?{popperRect:Oe.getBoundingClientRect(),popperState:wt,props:i}:null}).filter(Boolean);tQe(je,ve)&&(j(),ke(ve))}}function Ie(ve){var $e=ot(ve)||I.props.trigger.indexOf("click")>=0&&s;if(!$e){if(I.props.interactive){I.hideWithInteractivity(ve);return}ke(ve)}}function Le(ve){I.props.trigger.indexOf("focusin")<0&&ve.target!==M()||I.props.interactive&&ve.relatedTarget&&T.contains(ve.relatedTarget)||ke(ve)}function ot(ve){return Sf.isTouch?P()!==ve.type.indexOf("touch")>=0:!1}function at(){dt();var ve=I.props,$e=ve.popperOptions,De=ve.placement,je=ve.offset,Oe=ve.getReferenceClientRect,nt=ve.moveTransition,Fe=R()?Qj(T).arrow:null,wt=Oe?{getBoundingClientRect:Oe,contextElement:Oe.contextElement||M()}:t,pt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Qt){var tr=Qt.state;if(R()){var Vi=N(),$i=Vi.box;["placement","reference-hidden","escaped"].forEach(function(Wr){Wr==="placement"?$i.setAttribute("data-placement",tr.placement):tr.attributes.popper["data-popper-"+Wr]?$i.setAttribute("data-"+Wr,""):$i.removeAttribute("data-"+Wr)}),tr.attributes.popper={}}}},Mt=[{name:"offset",options:{offset:je}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!nt}},pt];R()&&Fe&&Mt.push({name:"arrow",options:{element:Fe,padding:3}}),Mt.push.apply(Mt,$e?.modifiers||[]),I.popperInstance=HJe(wt,T,Object.assign({},$e,{placement:De,onFirstUpdate:p,modifiers:Mt}))}function dt(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function It(){var ve=I.props.appendTo,$e,De=M();I.props.interactive&&ve===dDe||ve==="parent"?$e=De.parentNode:$e=pDe(ve,[De]),$e.contains(T)||$e.appendChild(T),I.state.isMounted=!0,at()}function ze(){return Y_(T.querySelectorAll("[data-tippy-root]"))}function Ct(ve){I.clearDelayTimeouts(),ve&&O("onTrigger",[I,ve]),H();var $e=k(!0),De=E(),je=De[0],Oe=De[1];Sf.isTouch&&je==="hold"&&Oe&&($e=Oe),$e?r=setTimeout(function(){I.show()},$e):I.show()}function ke(ve){if(I.clearDelayTimeouts(),O("onUntrigger",[I,ve]),!I.state.isVisible){Z();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ve.type)>=0&&s)){var $e=k(!1);$e?n=setTimeout(function(){I.state.isVisible&&I.hide()},$e):a=requestAnimationFrame(function(){I.hide()})}}function mt(){I.state.isEnabled=!0}function Be(){I.hide(),I.state.isEnabled=!1}function ut(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function it(ve){if(!I.state.isDestroyed){O("onBeforeUpdate",[I,ve]),re();var $e=I.props,De=gJ(t,Object.assign({},$e,pJ(ve),{ignoreAttributes:!0}));I.props=De,le(),$e.interactiveDebounce!==De.interactiveDebounce&&(j(),f=uJ(he,De.interactiveDebounce)),$e.triggerTarget&&!De.triggerTarget?_S($e.triggerTarget).forEach(function(je){je.removeAttribute("aria-expanded")}):De.triggerTarget&&t.removeAttribute("aria-expanded"),F(),x(),S&&S($e,De),I.popperInstance&&(at(),ze().forEach(function(je){requestAnimationFrame(je._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[I,ve])}}function xe(ve){I.setProps({content:ve})}function Ze(){var ve=I.state.isVisible,$e=I.state.isDestroyed,De=!I.state.isEnabled,je=Sf.isTouch&&!I.props.touch,Oe=CB(I.props.duration,0,ah.duration);if(!(ve||$e||De||je)&&!M().hasAttribute("disabled")&&(O("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,R()&&(T.style.visibility="visible"),x(),H(),I.state.isMounted||(T.style.transition="none"),R()){var nt=N(),Fe=nt.box,wt=nt.content;RB([Fe,wt],0)}p=function(){var Mt;if(!(!I.state.isVisible||c)){if(c=!0,T.offsetHeight,T.style.transition=I.props.moveTransition,R()&&I.props.animation){var Wi=N(),Qt=Wi.box,tr=Wi.content;RB([Qt,tr],Oe),hJ([Qt,tr],"visible")}V(),F(),dJ(NB,I),(Mt=I.popperInstance)==null||Mt.forceUpdate(),O("onMount",[I]),I.props.animation&&R()&&ie(Oe,function(){I.state.isShown=!0,O("onShown",[I])})}},It()}}function st(){var ve=!I.state.isVisible,$e=I.state.isDestroyed,De=!I.state.isEnabled,je=CB(I.props.duration,1,ah.duration);if(!(ve||$e||De)&&(O("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,c=!1,s=!1,R()&&(T.style.visibility="hidden"),j(),Z(),x(!0),R()){var Oe=N(),nt=Oe.box,Fe=Oe.content;I.props.animation&&(RB([nt,Fe],je),hJ([nt,Fe],"hidden"))}V(),F(),I.props.animation?R()&&J(je,I.unmount):I.unmount()}}function qe(ve){A().addEventListener("mousemove",f),dJ(_M,f),f(ve)}function ft(){I.state.isVisible&&I.hide(),I.state.isMounted&&(dt(),ze().forEach(function(ve){ve._tippy.unmount()}),T.parentNode&&T.parentNode.removeChild(T),NB=NB.filter(function(ve){return ve!==I}),I.state.isMounted=!1,O("onHidden",[I]))}function _t(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),re(),delete t._tippy,I.state.isDestroyed=!0,O("onDestroy",[I]))}}function Cg(t,e){e===void 0&&(e={});var i=ah.plugins.concat(e.plugins||[]);nQe();var r=Object.assign({},e,{plugins:i}),n=QJe(t),a=n.reduce(function(s,o){var l=o&&fQe(o,r);return l&&s.push(l),s},[]);return i2(t)?a[0]:a}Cg.defaultProps=ah;Cg.setDefaultProps=uQe;Cg.currentInput=Sf;Object.assign({},eDe,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});Cg.setDefaultProps({render:mDe});function bJ(t){const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Xt?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),t.toolTip?.content&&Cg(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=Vt),e}const o9=({target:t})=>(e=[])=>{t.style.backgroundColor=e?.length?"lightgray":LT;const i=(r,n,a)=>{const s=t.getElementsByClassName(`options_${r}`)[0];s&&(s.style.display=e?.length?n:a)};i(ya,TM,Vt),i(ui,Vt,TM),i(li,Vt,TM),i(Xt,Vt,TM)};function bo(t){const{table:e,targetClassName:i,items:r=[],onSelection:n}=t;let{target:a}=t;const s=!!a;if(!a&&i&&(a=document.getElementsByClassName(i)?.[0]),!a)return{elements:{},inputs:{}};let o=0,l=0;const c={},u={};let d;if(s){Xs(a);const v=mQe();Object.assign(c,v.elements),a.appendChild(v.anchor)}const p=Object.assign({},...[ya,ui,li,Xt,YA].map(v=>{const y=a.getElementsByClassName(`options_${v}`)?.[0];return Xs(y),{[v]:y}}).filter(Boolean)),h=o9({target:a}),f=(v,y)=>{Pt(y.onClick)&&(v.stopPropagation(),y.disabled||y.onClick(v,e),y.stateChange&&h())},m={onClick:()=>{},location:Xt};for(const v of r){const y={...m};pp(v)&&Object.assign(y,v);const b=p[y.location];if(!b){console.log(y.location,p);continue}if(y.location===ya&&(o+=1),y.location===YA){if(Pt(y.headerClick)){const I=a.getElementsByClassName("panelHeader")[0];I&&(I.onclick=y.headerClick)}l+=1}if(!y.hide&&(y.input||y.placeholder||y.search)){const I=document.createElement("p");I.style.cssText="margin-right: 1em",I.className=`control ${y.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(y.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","off"),w.setAttribute("placeholder",v.placeholder||LT),y.id&&(u[y.id]=w),y.id&&w.setAttribute("id",y.id),y.onKeyDown&&w.addEventListener("keydown",T=>y.onKeyDown(T,y)),y.onChange&&w.addEventListener("change",T=>y.onChange(T,y)),y.onKeyUp&&w.addEventListener("keyup",T=>{y.clearSearch&&T.key==="Escape"&&(T.stopPropagation(),w.value="",y.clearSearch()),y.onKeyUp(T,y)}),y.class&&w.classList.add(y.class),y.visible===!1&&(I.style.display=Vt),y.value&&(w.value=y.value),I.appendChild(w),y.search){const T=document.createElement("span");if(T.className="icon is-small is-left font-medium",T.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',I.appendChild(T),Pt(y.clearSearch)){const S=document.createElement("span");S.className="icon is-small is-right font-medium",S.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',S.onclick=D=>{D.stopPropagation(),w.value="",y.clearSearch()},I.appendChild(S)}}if(v.validator){const T=document.createElement("p");T.className="help font-medium",I.appendChild(T),w.addEventListener("input",S=>afe(v,S,w,T,v.validator))}y.id&&(c[y.id]=I,I.id=y.id),b?.appendChild(I);continue}if(!y.hide&&y.text){const I=document.createElement("div");I.className="font-medium",y.id&&(c[y.id]=I,I.id=y.id),I.innerHTML=y.text,I.onclick=w=>f(w,y),b?.appendChild(I);continue}if(!(!y.id&&(!y?.label||y.hide))){if(y.options){const I=zj({target:b,button:y,stateChange:h});y.visible===!1&&(I.style.display=Vt),y.id&&(c[y.id]=I)}else if(pp(y.selection)){const{selection:{options:I,actions:w},actionPlacement:T,threshold:S=8,...D}=y;if(I?.length<S){I.length&&(T===EK?I.unshift({divider:!0}):I.push({divider:!0})),w.forEach(P=>{const{label:R,...M}=P,A={...M,label:`<p style="font-weight: bold">${R}</p>`};T===EK?I.unshift(A):I.push(A)});const C={...D,options:I},E=zj({target:b,button:C,stateChange:h});C.visible===!1&&(E.style.display=Vt),C.id&&(c[y.id]=E)}else{const C=bJ(y);C.onclick=E=>{E.stopPropagation(),J8({title:"Select team",options:I})},y.id&&(c[y.id]=C),b?.appendChild(C)}}else if(y.tabs){const I=document.createElement("div");I.className="tabs is-toggle is-toggle-rounded";const w=document.createElement("ul");I.appendChild(w),y.tabs.forEach(T=>{const S=document.createElement("li");T.active&&S.classList.add("is-active");const D=document.createElement("a");S.appendChild(D),D.onclick=E=>{w.querySelectorAll("li").forEach(P=>P.classList.remove("is-active")),S.classList.add("is-active"),Pt(T.onClick)&&T.onClick(E,y)};const C=document.createElement("span");C.innerHTML=T.label,D.appendChild(C),w.appendChild(S)}),y.id&&(c[y.id]=I),b.appendChild(I)}else{const I=bJ(y);I.onclick=w=>f(w,y),y.id&&(c[y.id]=I),b?.appendChild(I)}(!(y?.label||y.tabs)||y.hide)&&c[y.id]&&(c[y.id].style.display=Vt)}}const g=a.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?LT:Vt),e?.on("rowSelectionChanged",(v,y)=>{Pt(n)&&n(y),o&&h(y)}),h(),d&&setTimeout(()=>d.focus(),200),{elements:c,inputs:u}}function mQe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=Vt,t.appendChild(e);const i=document.createElement("div");i.className=ahe;const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:gQe,COMPASS:vQe,ROUND_ROBIN:yQe}=Wn,{MALE:bQe,FEMALE:IQe}=So.genderConstants,{DOUBLES:IJ}=So.eventConstants,{WTN:kM}=So.ratingConstants;function wQe(t){const e=t.getData().map(r=>r.tournamentId),i=SQe();for(const r of i)z0({tournamentRecord:r,tournamentIds:e,table:t});return{...IR}}function SQe(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},participantsProfile:{scaledParticipantsCount:200,idPrefix:"p"},tournamentName:"CourtHive Challenge",drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventId:"event-id-1",drawId:"draw-id-1",eventType:IJ,gender:bQe,seedsCount:4,drawSize:16},{drawType:gQe,category:{categoryName:"U16"},eventName:"U16 Girls Singles",eventId:"event-id-2",drawId:"draw-id-2",gender:IQe,seedsCount:8,drawSize:32},{category:{ratingType:kM,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,eventId:"event-id-3",drawId:"draw-id-3",seedsCount:8,drawSize:32},{category:{ratingType:kM,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventId:"event-id-4",drawId:"draw-id-4",eventType:IJ,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},participantsProfile:{idPrefix:"p"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:kM,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,eventId:"event-id-1",drawId:"draw-id-1",drawType:vQe,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:kM,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:yQe,eventId:"event-id-2",drawId:"draw-id-2",seedsCount:4,drawSize:16}],venueProfiles:e}].map(r=>bR.generateTournamentRecord(r).tournamentRecord)}function TQe(t){const e=zc(),i=e?.roles?.includes(_x),r=e?.services?.includes("tournamentProfile"),n=[{label:"Create new tournament",onClick:()=>GUe({table:t})},{label:"Import tournament",onClick:()=>hYe({table:t})},r&&{label:"Fetch tournament",onClick:()=>fYe({table:t})},i&&{label:"Load by ID",onClick:()=>mYe({table:t})},{divider:!0},{divider:!0},{label:"Example tournaments",onClick:()=>wQe(t),close:!0}].filter(Boolean),a=qw(t),s=[{label:"Actions",options:n,align:Xt},{onKeyDown:l=>l.key==="Backspace"&&l.target.value.length===1&&a(""),onChange:l=>a(l.target.value),onKeyUp:l=>a(l.target.value),clearSearch:()=>a(""),placeholder:"Search tournaments",id:"tournamentSearch",location:ui,search:!0}],o=document.getElementById(nhe)||void 0;bo({target:o,items:s})}const UQe=t=>e=>{const i=document.createElement("table"),r=e.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr");if(r.offline){const c=e.getRow().getElement();c.style.backgroundColor="lightyellow"}const s=r.tournamentImageURL?`<img src='${r.tournamentImageURL}' style='width: ${n}' alt=''>`:"",o=(t?"":`<td style='min-width: ${n};'>${s}</td>`)+`<td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;a.innerHTML=o,i.appendChild(a);const l=document.createElement("span");return l.appendChild(i),l};function DQe({providerId:t,tournamentId:e}){const i=()=>ht.router.navigate(`/tournaments/${e}`),r=n=>{n&&(n.calendar=n.calendar.filter(a=>a.tournamentId!==e),Oc.addProvider(n).then(i))};Oc.findProvider(t).then(r)}function EQe(t,e,i){if(!t)return{};const r=document.createElement("aside");r.classList.add("menu");const n={},a=d=>p=>{p.stopPropagation(),d.onClick()};let s=0;const o=()=>(s+=1,s),l=d=>d?.heading||d?.text||d?.label||`Item ${o()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style.cssText=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style.cssText=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=a(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,r.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(c(h));r.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=CN(d);d.focus&&(u=h),n[d.field]=h,r.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),r.appendChild(p)}}return t.appendChild(r),{focusElement:u}}let Pv;function gd(t){Pv&&(Pv?.destroy(!0),Pv=void 0),t?.remove&&t.remove()}function nu(t){const{title:e,options:i,menuItems:r=[],coords:n,callback:a,config:s}=t;let{target:o,items:l}=t;if(!i?.length&&!l?.length&&!r)return;gd();const c=document.createElement("div");let u;const d=()=>{l=l?.filter(f=>!f.hide&&!f.disabled).map(f=>({...f,onClick:()=>{gd(c),Pt(f.onClick)&&f.onClick()}}))||i?.filter(f=>!f.hide&&!f.disabled).map(f=>({text:typeof f=="object"?f.option:f,style:f.style,onClick:()=>{f.subMenu?Pv.setContent("IMPLEMENT SUB MENU"):Pt(f.onClick)?(gd(c),f.onClick()):Pt(a)&&a&&(gd(c),a(typeof f=="object"?{...f,coords:n}:f))}}));const p=[{text:e,items:l},...r];return u=EQe(c,p).focusElement,c};return o=o||n?.evt?.target,o&&(Pv=Cg(o,{content:d,theme:"light-border",trigger:"click",onShown:()=>{u&&setTimeout(()=>u?.focus(),0)},...s}),Pv.show(),Pv.setProps({interactive:!0})),Pv}const PQe=(t,e,i)=>{t.delete(),i&&DQe({tournamentId:e,providerId:i})},CQe=(t,e)=>Oc.deleteTournament(t).then(e,i=>console.log(i)),RQe=(t,e)=>{const i=t.getRow(),r=zc()?.providerId||i.getData().providerId,n=()=>PQe(i,e,r),a=()=>CQe(e,n);zc()?.provider||ht?.provider?f$e({providerId:r,tournamentId:e}).then(a,l=>console.log(l)):a()},MQe=t=>e=>{const i=document.createElement("span");i.style.width="100%";const r=e.getValue(),n=()=>RQe(e,r),a=()=>{const u=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===r).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:n,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];Kr({title:$f.tr("actions.delete_tournament"),buttons:d,content:u})},s=()=>NQe({table:e.getTable(),tournamentId:r}),o=document.createElement("span");return o.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),nu({target:o,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:s}],config:{placement:wp}})},i.appendChild(o),i};function NQe({tournamentId:t,table:e}){const r=zc()?.provider,n=()=>{$t({message:"Tournament not found",onClose:()=>{ht.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=o=>{o?GUe({table:e,tournamentRecord:o}):n()},s=o=>{const l=o?.data?.tournamentRecords?.[t];a(l)};r?Vx({tournamentId:t}).then(s,o=>console.log(o)):Oc.findTournament(t).then(a,o=>console.log(o))}function AQe(t){const e=/Mobile/.test(navigator.userAgent),i=(r,n)=>{const a=n.getRow().getData().tournamentId;if(a){We.reset();const s=`/${Es}/${a}`;ht.router.navigate(s)}};return[{formatter:UQe(e),cellClick:i,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{formatter:()=>'<div class="button font-medium">Open</div>',cellClick:i,vertAlign:"middle",visible:!e,title:"Open",width:90},{formatter:MQe(),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:Xt,width:10}]}function Rm({anchorId:t}){const e=ks.findTable(`#${t}`)[0];e&&e.destroy()}function r2(){if(ht.tables)for(const t of Object.keys(ht.tables))ht.tables[t]?.destroy(),delete ht.tables[t];for(;(ht.collectionTables||[]).length;)ht.collectionTables?.pop()?.destroy()}function gDe(){const t=u=>console.log("db Error",{error:u}),e=document.getElementById("dnav");e&&(e.style.backgroundColor="");let i;const r=AQe(),n=u=>{Rm({anchorId:xV});const d=document.getElementById(xV);i=new ks(d,{height:window.innerHeight*.85,placeholder:"No tournaments",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:u,columns:r}),i.on("tableBuilt",()=>TQe(i)),i.on("scrollVertical",gd)},a=u=>{u.sort((d,p)=>new Date(p.startDate||p.start).getTime()-new Date(d.startDate||d.start).getTime()),n(u.map(XF))},s=({tournaments:u,provider:d})=>{const h=[...u].sort((f,m)=>new Date(m.tournament.startDate).getTime()-new Date(f.tournament.startDate).getTime()).map(f=>{const m=f.tournament.timeItemValues?.TMX?.offline;f.tournament.offline=m;const g=f.tournament.onlineResources?.find(({name:v,resourceType:y})=>v==="tournamentImage"&&y==="URL")?.identifier;return g&&(f.tournament.tournamentImageURL=g),{...f,provider:d}});n(h)},l=zc()?.provider||ht?.provider,c=()=>Oc.findAllTournaments().then(a,t);if(l?.organisationAbbreviation){const u=d=>{d?.data?.calendar?s(d.data.calendar):c()};p$e({providerAbbr:l.organisationAbbreviation}).then(u)}else c();return{table:i}}const vDe="leaveTournament",_Qe="providerCalendar",kQe="processDirective",OQe="tmxDirective",xQe="tmxMessage";function yDe(t){const e=AUe({data:t}),{directive:i,content:r}=e||{};i&&(i===_Qe&&r.calendar&&$t({action:{onClick:()=>LQe({providerId:r.providerId,calendar:r.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&ht.ee.emit("sendKey",i.subKey))}function LQe({providerId:t,calendar:e}){const i=()=>gDe();t&&e&&Oc.addProvider({providerId:t,calendar:e}).then(i)}const cm=Object.create(null);cm.open="0";cm.close="1";cm.ping="2";cm.pong="3";cm.message="4";cm.upgrade="5";cm.noop="6";const KN=Object.create(null);Object.keys(cm).forEach(t=>{KN[cm[t]]=t});const eG={type:"error",data:"parser error"},bDe=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",IDe=typeof ArrayBuffer=="function",wDe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,l9=({type:t,data:e},i,r)=>bDe&&e instanceof Blob?i?r(e):wJ(e,r):IDe&&(e instanceof ArrayBuffer||wDe(e))?i?r(e):wJ(new Blob([e]),r):r(cm[t]+(e||"")),wJ=(t,e)=>{const i=new FileReader;return i.onload=function(){const r=i.result.split(",")[1];e("b"+(r||""))},i.readAsDataURL(t)};function SJ(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let AB;function FQe(t,e){if(bDe&&t.data instanceof Blob)return t.data.arrayBuffer().then(SJ).then(e);if(IDe&&(t.data instanceof ArrayBuffer||wDe(t.data)))return e(SJ(t.data));l9(t,!1,i=>{AB||(AB=new TextEncoder),e(AB.encode(i))})}const TJ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",NE=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<TJ.length;t++)NE[TJ.charCodeAt(t)]=t;const BQe=t=>{let e=t.length*.75,i=t.length,r,n=0,a,s,o,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(r=0;r<i;r+=4)a=NE[t.charCodeAt(r)],s=NE[t.charCodeAt(r+1)],o=NE[t.charCodeAt(r+2)],l=NE[t.charCodeAt(r+3)],u[n++]=a<<2|s>>4,u[n++]=(s&15)<<4|o>>2,u[n++]=(o&3)<<6|l&63;return c},$Qe=typeof ArrayBuffer=="function",c9=(t,e)=>{if(typeof t!="string")return{type:"message",data:SDe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:VQe(t.substring(1),e)}:KN[i]?t.length>1?{type:KN[i],data:t.substring(1)}:{type:KN[i]}:eG},VQe=(t,e)=>{if($Qe){const i=BQe(t);return SDe(i,e)}else return{base64:!0,data:t}},SDe=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},TDe="",jQe=(t,e)=>{const i=t.length,r=new Array(i);let n=0;t.forEach((a,s)=>{l9(a,!1,o=>{r[s]=o,++n===i&&e(r.join(TDe))})})},GQe=(t,e)=>{const i=t.split(TDe),r=[];for(let n=0;n<i.length;n++){const a=c9(i[n],e);if(r.push(a),a.type==="error")break}return r};function HQe(){return new TransformStream({transform(t,e){FQe(t,i=>{const r=i.length;let n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);const a=new DataView(n.buffer);a.setUint8(0,126),a.setUint16(1,r)}else{n=new Uint8Array(9);const a=new DataView(n.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(i)})}})}let _B;function OM(t){return t.reduce((e,i)=>e+i.length,0)}function xM(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let r=0;for(let n=0;n<e;n++)i[n]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),i}function zQe(t,e){_B||(_B=new TextDecoder);const i=[];let r=0,n=-1,a=!1;return new TransformStream({transform(s,o){for(i.push(s);;){if(r===0){if(OM(i)<1)break;const l=xM(i,1);a=(l[0]&128)===128,n=l[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if(OM(i)<2)break;const l=xM(i,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(OM(i)<8)break;const l=xM(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(eG);break}n=u*Math.pow(2,32)+c.getUint32(4),r=3}else{if(OM(i)<n)break;const l=xM(i,n);o.enqueue(c9(a?l:_B.decode(l),e)),r=0}if(n===0||n>t){o.enqueue(eG);break}}}})}const UDe=4;function ro(t){if(t)return qQe(t)}function qQe(t){for(var e in ro.prototype)t[e]=ro.prototype[e];return t}ro.prototype.on=ro.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ro.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};ro.prototype.off=ro.prototype.removeListener=ro.prototype.removeAllListeners=ro.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,n=0;n<i.length;n++)if(r=i[n],r===e||r.fn===e){i.splice(n,1);break}return i.length===0&&delete this._callbacks["$"+t],this};ro.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(i){i=i.slice(0);for(var r=0,n=i.length;r<n;++r)i[r].apply(this,e)}return this};ro.prototype.emitReserved=ro.prototype.emit;ro.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ro.prototype.hasListeners=function(t){return!!this.listeners(t).length};const n2=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),Wd=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),WQe="arraybuffer";function DDe(t,...e){return e.reduce((i,r)=>(t.hasOwnProperty(r)&&(i[r]=t[r]),i),{})}const YQe=Wd.setTimeout,KQe=Wd.clearTimeout;function a2(t,e){e.useNativeTimers?(t.setTimeoutFn=YQe.bind(Wd),t.clearTimeoutFn=KQe.bind(Wd)):(t.setTimeoutFn=Wd.setTimeout.bind(Wd),t.clearTimeoutFn=Wd.clearTimeout.bind(Wd))}const ZQe=1.33;function XQe(t){return typeof t=="string"?JQe(t):Math.ceil((t.byteLength||t.size)*ZQe)}function JQe(t){let e=0,i=0;for(let r=0,n=t.length;r<n;r++)e=t.charCodeAt(r),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(r++,i+=4);return i}function EDe(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function QQe(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function eet(t){let e={},i=t.split("&");for(let r=0,n=i.length;r<n;r++){let a=i[r].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class tet extends Error{constructor(e,i,r){super(e),this.description=i,this.context=r,this.type="TransportError"}}class u9 extends ro{constructor(e){super(),this.writable=!1,a2(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,i,r){return super.emitReserved("error",new tet(e,i,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=c9(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=QQe(e);return i.length?"?"+i:""}}class iet extends u9{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||i()})),this.writable||(r++,this.once("drain",function(){--r||i()}))}else i()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};GQe(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,jQe(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=EDe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}}let PDe=!1;try{PDe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ret=PDe;function net(){}class aet extends iet{constructor(e){if(super(e),typeof location<"u"){const i=location.protocol==="https:";let r=location.port;r||(r=i?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,i){const r=this.request({method:"POST",data:e});r.on("success",i),r.on("error",(n,a)=>{this.onError("xhr post error",n,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,r)=>{this.onError("xhr poll error",i,r)}),this.pollXhr=e}}class Ff extends ro{constructor(e,i,r){super(),this.createRequest=e,a2(this,r),this._opts=r,this._method=r.method||"GET",this._uri=i,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const i=DDe(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(i);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var n;r.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Ff.requestsCount++,Ff.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=net,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ff.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ff.requestsCount=0;Ff.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",UJ);else if(typeof addEventListener=="function"){const t="onpagehide"in Wd?"pagehide":"unload";addEventListener(t,UJ,!1)}}function UJ(){for(let t in Ff.requests)Ff.requests.hasOwnProperty(t)&&Ff.requests[t].abort()}const set=(function(){const t=CDe({xdomain:!1});return t&&t.responseType!==null})();class oet extends aet{constructor(e){super(e);const i=e&&e.forceBase64;this.supportsBinary=set&&!i}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ff(CDe,this.uri(),e)}}function CDe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ret))return new XMLHttpRequest}catch{}if(!e)try{return new Wd[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const RDe=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class cet extends u9{get name(){return"websocket"}doOpen(){const e=this.uri(),i=this.opts.protocols,r=RDe?{}:DDe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,i,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const r=e[i],n=i===e.length-1;l9(r,this.supportsBinary,a=>{try{this.doWrite(r,a)}catch{}n&&n2(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=EDe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}}const kB=Wd.WebSocket||Wd.MozWebSocket;class uet extends cet{createSocket(e,i,r){return RDe?new kB(e,i,r):i?new kB(e,i):new kB(e)}doWrite(e,i){this.ws.send(i)}}class det extends u9{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const i=zQe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(i).getReader(),n=HQe();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const a=()=>{r.read().then(({done:o,value:l})=>{o||(this.onPacket(l),a())}).catch(o=>{})};a();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const r=e[i],n=i===e.length-1;this._writer.write(r).then(()=>{n&&n2(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const pet={websocket:uet,webtransport:det,polling:oet},het=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,fet=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function tG(t){if(t.length>8e3)throw"URI too long";const e=t,i=t.indexOf("["),r=t.indexOf("]");i!=-1&&r!=-1&&(t=t.substring(0,i)+t.substring(i,r).replace(/:/g,";")+t.substring(r,t.length));let n=het.exec(t||""),a={},s=14;for(;s--;)a[fet[s]]=n[s]||"";return i!=-1&&r!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=met(a,a.path),a.queryKey=get(a,a.query),a}function met(t,e){const i=/\/{2,9}/g,r=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function get(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,a){n&&(i[n]=a)}),i}const iG=typeof addEventListener=="function"&&typeof removeEventListener=="function",ZN=[];iG&&addEventListener("offline",()=>{ZN.forEach(t=>t())},!1);class jv extends ro{constructor(e,i){if(super(),this.binaryType=WQe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(i=e,e=null),e){const r=tG(e);i.hostname=r.host,i.secure=r.protocol==="https"||r.protocol==="wss",i.port=r.port,r.query&&(i.query=r.query)}else i.host&&(i.hostname=tG(i.host).host);a2(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},i.transports.forEach(r=>{const n=r.prototype.name;this.transports.push(n),this._transportsByName[n]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=eet(this.opts.query)),iG&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ZN.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=UDe,i.transport=e,this.id&&(i.sid=this.id);const r=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&jv.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const i=this.createTransport(e);i.open(),this.setTransport(i)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",i=>this._onClose("transport close",i))}onOpen(){this.readyState="open",jv.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const i=new Error("server error");i.code=e.data,this._onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(i+=XQe(n)),r>0&&i>this._maxPayload)return this.writeBuffer.slice(0,r);i+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,n2(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,i,r){return this._sendPacket("message",e,i,r),this}send(e,i,r){return this._sendPacket("message",e,i,r),this}_sendPacket(e,i,r,n){if(typeof i=="function"&&(n=i,i=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const a={type:e,data:i,options:r};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},r=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(jv.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),iG&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=ZN.indexOf(this._offlineEventListener);r!==-1&&ZN.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this._prevBufferLen=0}}}jv.protocol=UDe;class vet extends jv{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let i=this.createTransport(e),r=!1;jv.priorWebsocketSuccess=!1;const n=()=>{r||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;jv.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){r||(r=!0,u(),i.close(),i=null)}const s=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function o(){s("transport closed")}function l(){s("socket closed")}function c(d){i&&d.name!==i.name&&a()}const u=()=>{i.removeListener("open",n),i.removeListener("error",s),i.removeListener("close",o),this.off("close",l),this.off("upgrading",c)};i.once("open",n),i.once("error",s),i.once("close",o),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||i.open()},200):i.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const i=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&i.push(e[r]);return i}}let yet=class extends vet{constructor(e,i={}){const r=typeof e=="object"?e:i;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>pet[n]).filter(n=>!!n)),super(e,r)}};function bet(t,e="",i){let r=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),r=tG(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const a=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+e,r.href=r.protocol+"://"+a+(i&&i.port===r.port?"":":"+r.port),r}const Iet=typeof ArrayBuffer=="function",wet=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,MDe=Object.prototype.toString,Tet=typeof Blob=="function"||typeof Blob<"u"&&MDe.call(Blob)==="[object BlobConstructor]",Uet=typeof File=="function"||typeof File<"u"&&MDe.call(File)==="[object FileConstructor]";function d9(t){return Iet&&(t instanceof ArrayBuffer||wet(t))||Tet&&t instanceof Blob||Uet&&t instanceof File}function XN(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,r=t.length;i<r;i++)if(XN(t[i]))return!0;return!1}if(d9(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return XN(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&XN(t[i]))return!0;return!1}function Det(t){const e=[],i=t.data,r=t;return r.data=rG(i,e),r.attachments=e.length,{packet:r,buffers:e}}function rG(t,e){if(!t)return t;if(d9(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let r=0;r<t.length;r++)i[r]=rG(t[r],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=rG(t[r],e));return i}return t}function Eet(t,e){return t.data=nG(t.data,e),delete t.attachments,t}function nG(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=nG(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=nG(t[i],e));return t}const Pet=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Cet=5;var nn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(nn||(nn={}));class Ret{constructor(e){this.replacer=e}encode(e){return(e.type===nn.EVENT||e.type===nn.ACK)&&XN(e)?this.encodeAsBinary({type:e.type===nn.EVENT?nn.BINARY_EVENT:nn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===nn.BINARY_EVENT||e.type===nn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=Det(e),r=this.encodeAsString(i.packet),n=i.buffers;return n.unshift(r),n}}function DJ(t){return Object.prototype.toString.call(t)==="[object Object]"}class p9 extends ro{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const r=i.type===nn.BINARY_EVENT;r||i.type===nn.BINARY_ACK?(i.type=r?nn.EVENT:nn.ACK,this.reconstructor=new Met(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(d9(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const r={type:Number(e.charAt(0))};if(nn[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===nn.BINARY_EVENT||r.type===nn.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const s=e.substring(a,i);if(s!=Number(s)||e.charAt(i)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););r.nsp=e.substring(a,i)}else r.nsp="/";const n=e.charAt(i+1);if(n!==""&&Number(n)==n){const a=i+1;for(;++i;){const s=e.charAt(i);if(s==null||Number(s)!=s){--i;break}if(i===e.length)break}r.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(p9.isPayloadValid(r.type,a))r.data=a;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case nn.CONNECT:return DJ(i);case nn.DISCONNECT:return i===void 0;case nn.CONNECT_ERROR:return typeof i=="string"||DJ(i);case nn.EVENT:case nn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&Pet.indexOf(i[0])===-1);case nn.ACK:case nn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Met{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=Eet(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Net=Object.freeze(Object.defineProperty({__proto__:null,Decoder:p9,Encoder:Ret,get PacketType(){return nn},protocol:Cet},Symbol.toStringTag,{value:"Module"}));function Xp(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const Aet=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class NDe extends ro{constructor(e,i,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Xp(e,"open",this.onopen.bind(this)),Xp(e,"packet",this.onpacket.bind(this)),Xp(e,"error",this.onerror.bind(this)),Xp(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){var r,n,a;if(Aet.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const s={type:nn.EVENT,data:i};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const u=this.ids++,d=i.pop();this._registerAckCallback(u,d),s.id=u}const o=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!o||(l?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,i){var r;const n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},n),s=(...o)=>{this.io.clearTimeoutFn(a),i.apply(this,o)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...i){return new Promise((r,n)=>{const a=(s,o)=>s?n(s):r(o);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...a)=>(this._queue[0],n!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(n)):(this._queue.shift(),i&&i(null,...a)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:nn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case nn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case nn.EVENT:case nn.BINARY_EVENT:this.onevent(e);break;case nn.ACK:case nn.BINARY_ACK:this.onack(e);break;case nn.DISCONNECT:this.ondisconnect();break;case nn.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const r of i)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let r=!1;return function(...n){r||(r=!0,i.packet({type:nn.ACK,id:e,data:n}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:nn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let r=0;r<i.length;r++)if(e===i[r])return i.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let r=0;r<i.length;r++)if(e===i[r])return i.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const r of i)r.apply(this,e.data)}}}function WD(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}WD.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-i:t+i}return Math.min(t,this.max)|0};WD.prototype.reset=function(){this.attempts=0};WD.prototype.setMin=function(t){this.ms=t};WD.prototype.setMax=function(t){this.max=t};WD.prototype.setJitter=function(t){this.jitter=t};class aG extends ro{constructor(e,i){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,a2(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((r=i.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new WD({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const n=i.parser||Net;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new yet(this.uri,this.opts);const i=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Xp(i,"open",function(){r.onopen(),e&&e()}),a=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},s=Xp(i,"error",a);if(this._timeout!==!1){const o=this._timeout,l=this.setTimeoutFn(()=>{n(),a(new Error("timeout")),i.close()},o);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Xp(e,"ping",this.onping.bind(this)),Xp(e,"data",this.ondata.bind(this)),Xp(e,"error",this.onerror.bind(this)),Xp(e,"close",this.onclose.bind(this)),Xp(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){n2(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new NDe(this,e,i),this.nsps[e]=r),r}_destroy(e){const i=Object.keys(this.nsps);for(const r of i)if(this.nsps[r].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let r=0;r<i.length;r++)this.engine.write(i[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,i){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},i);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const gE={};function JN(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=bet(t,e.path||"/socket.io"),r=i.source,n=i.id,a=i.path,s=gE[n]&&a in gE[n].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let l;return o?l=new aG(r,e):(gE[n]||(gE[n]=new aG(r,e)),l=gE[n]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(JN,{Manager:aG,Socket:NDe,io:JN,connect:JN});function _et(){const t=MUe();return t?{authorization:`Bearer ${t}`}:void 0}const hl={timestampOffset:0,socket:void 0},Ev={},sG=[];function ket(t){console.log("tmxMessage:",{data:t})}function ADe(t){const e={transportOptions:{polling:{extraHeaders:_et()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(hl.socket)console.log("socket exists");else{const r=`${ai.socketPath||"https://courthive.net"}/tmx`;hl.socket=JN(r,e),hl.socket.on("ack",Let),hl.socket.on(xQe,ket),hl.socket.on(OQe,yDe),hl.socket.on("connect",()=>Oet(t)),hl.socket.on("disconnect",()=>console.log("disconnect")),hl.socket.on("timestamp",n=>hl.timestampOffset=new Date().getTime()-n.timestamp),hl.socket.on("connect_error",n=>{console.log("connection error:",{data:n}),$t({message:"Connection error",intent:"is-danger"}),s2()})}}function s2(){hl?.socket?.disconnect(),setTimeout(()=>delete hl.socket,1e3)}function h9({data:t,ackCallback:e}){const i=zc(),{email:r}=i||{},n=t.type??"tmx",a=()=>{if(e&&Pt(e)){const o=Ni.UUID();t.payload&&Object.assign(t.payload,{ackId:o}),xet({ackId:o,callback:e})}const s=hl.timestampOffset?new Date().getTime()+hl.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:CU(),tmxVersion:B8,timestamp:s,userId:r}),_De(n,t)};if(hl.socket)a();else try{ADe(a)}catch{sG.push({header:n,data:t,ackCallback:e})}}function _De(t,e){hl.socket.connected?hl.socket.emit(t,e):console.log("socket not connected")}function Oet(t){for(console.log("** connected"),h9({data:{type:"timestamp"}});sG.length;){const e=sG.pop();_De(e.header,e.data)}Pt(t)&&t()}function xet({ackId:t,uuid:e,callback:i}){t&&(Ev[t]=i),e&&(Ev[e]=i)}function Let(t){t.ackId&&Ev[t.ackId]&&(Ev[t.ackId](t),delete Ev[t.ackId]),t.uuid&&Ev[t.uuid]&&(Ev[t.uuid](t),delete Ev[t.uuid])}var QN={exports:{}},Fet=QN.exports,EJ;function Bet(){return EJ||(EJ=1,(function(t,e){(function(i,r){t.exports=r()})(Fet,(function(){var i=1e3,r=6e4,n=36e5,a="millisecond",s="second",o="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var N=["th","st","nd","rd"],k=A%100;return"["+A+(N[(k-20)%10]||N[k]||N[0])+"]"}},b=function(A,N,k){var x=String(A);return!x||x.length>=N?A:""+Array(N+1-x.length).join(k)+A},I={s:b,z:function(A){var N=-A.utcOffset(),k=Math.abs(N),x=Math.floor(k/60),O=k%60;return(N<=0?"+":"-")+b(x,2,"0")+":"+b(O,2,"0")},m:function A(N,k){if(N.date()<k.date())return-A(k,N);var x=12*(k.year()-N.year())+(k.month()-N.month()),O=N.clone().add(x,d),V=k-O<0,F=N.clone().add(x+(V?-1:1),d);return+(-(x+(k-O)/(V?O-F:F-O))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:h,w:u,d:c,D:f,h:l,m:o,s,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},w="en",T={};T[w]=y;var S="$isDayjsObject",D=function(A){return A instanceof R||!(!A||!A[S])},C=function A(N,k,x){var O;if(!N)return w;if(typeof N=="string"){var V=N.toLowerCase();T[V]&&(O=V),k&&(T[V]=k,O=V);var F=N.split("-");if(!O&&F.length>1)return A(F[0])}else{var j=N.name;T[j]=N,O=j}return!x&&O&&(w=O),O||!x&&w},E=function(A,N){if(D(A))return A.clone();var k=typeof N=="object"?N:{};return k.date=A,k.args=arguments,new R(k)},P=I;P.l=C,P.i=D,P.w=function(A,N){return E(A,{locale:N.$L,utc:N.$u,x:N.$x,$offset:N.$offset})};var R=(function(){function A(k){this.$L=C(k.locale,null,!0),this.parse(k),this.$x=this.$x||k.x||{},this[S]=!0}var N=A.prototype;return N.parse=function(k){this.$d=(function(x){var O=x.date,V=x.utc;if(O===null)return new Date(NaN);if(P.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var F=O.match(g);if(F){var j=F[2]-1||0,q=(F[7]||"0").substring(0,3);return V?new Date(Date.UTC(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,q)):new Date(F[1],j,F[3]||1,F[4]||0,F[5]||0,F[6]||0,q)}}return new Date(O)})(k),this.init()},N.init=function(){var k=this.$d;this.$y=k.getFullYear(),this.$M=k.getMonth(),this.$D=k.getDate(),this.$W=k.getDay(),this.$H=k.getHours(),this.$m=k.getMinutes(),this.$s=k.getSeconds(),this.$ms=k.getMilliseconds()},N.$utils=function(){return P},N.isValid=function(){return this.$d.toString()!==m},N.isSame=function(k,x){var O=E(k);return this.startOf(x)<=O&&O<=this.endOf(x)},N.isAfter=function(k,x){return E(k)<this.startOf(x)},N.isBefore=function(k,x){return this.endOf(x)<E(k)},N.$g=function(k,x,O){return P.u(k)?this[x]:this.set(O,k)},N.unix=function(){return Math.floor(this.valueOf()/1e3)},N.valueOf=function(){return this.$d.getTime()},N.startOf=function(k,x){var O=this,V=!!P.u(x)||x,F=P.p(k),j=function(K,ne){var le=P.w(O.$u?Date.UTC(O.$y,ne,K):new Date(O.$y,ne,K),O);return V?le:le.endOf(c)},q=function(K,ne){return P.w(O.toDate()[K].apply(O.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(ne)),O)},W=this.$W,z=this.$M,H=this.$D,Z="set"+(this.$u?"UTC":"");switch(F){case h:return V?j(1,0):j(31,11);case d:return V?j(1,z):j(0,z+1);case u:var J=this.$locale().weekStart||0,ie=(W<J?W+7:W)-J;return j(V?H-ie:H+(6-ie),z);case c:case f:return q(Z+"Hours",0);case l:return q(Z+"Minutes",1);case o:return q(Z+"Seconds",2);case s:return q(Z+"Milliseconds",3);default:return this.clone()}},N.endOf=function(k){return this.startOf(k,!1)},N.$set=function(k,x){var O,V=P.p(k),F="set"+(this.$u?"UTC":""),j=(O={},O[c]=F+"Date",O[f]=F+"Date",O[d]=F+"Month",O[h]=F+"FullYear",O[l]=F+"Hours",O[o]=F+"Minutes",O[s]=F+"Seconds",O[a]=F+"Milliseconds",O)[V],q=V===c?this.$D+(x-this.$W):x;if(V===d||V===h){var W=this.clone().set(f,1);W.$d[j](q),W.init(),this.$d=W.set(f,Math.min(this.$D,W.daysInMonth())).$d}else j&&this.$d[j](q);return this.init(),this},N.set=function(k,x){return this.clone().$set(k,x)},N.get=function(k){return this[P.p(k)]()},N.add=function(k,x){var O,V=this;k=Number(k);var F=P.p(x),j=function(z){var H=E(V);return P.w(H.date(H.date()+Math.round(z*k)),V)};if(F===d)return this.set(d,this.$M+k);if(F===h)return this.set(h,this.$y+k);if(F===c)return j(1);if(F===u)return j(7);var q=(O={},O[o]=r,O[l]=n,O[s]=i,O)[F]||1,W=this.$d.getTime()+k*q;return P.w(W,this)},N.subtract=function(k,x){return this.add(-1*k,x)},N.format=function(k){var x=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var V=k||"YYYY-MM-DDTHH:mm:ssZ",F=P.z(this),j=this.$H,q=this.$m,W=this.$M,z=O.weekdays,H=O.months,Z=O.meridiem,J=function(ne,le,re,me){return ne&&(ne[le]||ne(x,V))||re[le].slice(0,me)},ie=function(ne){return P.s(j%12||12,ne,"0")},K=Z||function(ne,le,re){var me=ne<12?"AM":"PM";return re?me.toLowerCase():me};return V.replace(v,(function(ne,le){return le||(function(re){switch(re){case"YY":return String(x.$y).slice(-2);case"YYYY":return P.s(x.$y,4,"0");case"M":return W+1;case"MM":return P.s(W+1,2,"0");case"MMM":return J(O.monthsShort,W,H,3);case"MMMM":return J(H,W);case"D":return x.$D;case"DD":return P.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return J(O.weekdaysMin,x.$W,z,2);case"ddd":return J(O.weekdaysShort,x.$W,z,3);case"dddd":return z[x.$W];case"H":return String(j);case"HH":return P.s(j,2,"0");case"h":return ie(1);case"hh":return ie(2);case"a":return K(j,q,!0);case"A":return K(j,q,!1);case"m":return String(q);case"mm":return P.s(q,2,"0");case"s":return String(x.$s);case"ss":return P.s(x.$s,2,"0");case"SSS":return P.s(x.$ms,3,"0");case"Z":return F}return null})(ne)||F.replace(":","")}))},N.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},N.diff=function(k,x,O){var V,F=this,j=P.p(x),q=E(k),W=(q.utcOffset()-this.utcOffset())*r,z=this-q,H=function(){return P.m(F,q)};switch(j){case h:V=H()/12;break;case d:V=H();break;case p:V=H()/3;break;case u:V=(z-W)/6048e5;break;case c:V=(z-W)/864e5;break;case l:V=z/n;break;case o:V=z/r;break;case s:V=z/i;break;default:V=z}return O?V:P.a(V)},N.daysInMonth=function(){return this.endOf(d).$D},N.$locale=function(){return T[this.$L]},N.locale=function(k,x){if(!k)return this.$L;var O=this.clone(),V=C(k,x,!0);return V&&(O.$L=V),O},N.clone=function(){return P.w(this.$d,this)},N.toDate=function(){return new Date(this.valueOf())},N.toJSON=function(){return this.isValid()?this.toISOString():null},N.toISOString=function(){return this.$d.toISOString()},N.toString=function(){return this.$d.toUTCString()},A})(),M=R.prototype;return E.prototype=M,[["$ms",a],["$s",s],["$m",o],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach((function(A){M[A[1]]=function(N){return this.$g(N,A[0],A[1])}})),E.extend=function(A,N){return A.$i||(A(N,R,E),A.$i=!0),E},E.locale=C,E.isDayjs=D,E.unix=function(A){return E(1e3*A)},E.en=T[w],E.Ls=T,E.p={},E}))})(QN)),QN.exports}var $et=Bet();const f9=MR($et);async function qt(t){const{tournamentRecord:e,methods:i,engine:r=s2e,callback:n}=t,a=zc(),s=b=>{e&&_V[r].reset(),n&&Pt(n)?n(b):b?.error&&$t({message:b.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return s();const o=_V[r];if(!o)return s();e&&o.setState(e);const l=b=>b?.parentOrganisation?.organisationId,c=o.getState()?.tournamentRecords??{},u=b=>b.timeItems?.find(({itemType:I})=>I==="TMX")?.itemValue?.offline,d=Object.values(c)?.map(u).filter(Boolean);if(d.length>1&&!d.every(b=>!b.email||b.email===d[0].email))return $t({message:"Not all linked tournaments are offline",intent:"is-danger"});const h=d.length,f=Object.values(c)?.map(b=>b.tournamentId),m=Ni.unique(Object.values(c)?.map(l)).filter(Boolean);if(m.length>1)return $t({message:"Multiple providers",intent:"is-danger"});const g=new Date().getTime(),v=Object.values(c).every(b=>{const I=f9(b.endDate).endOf("day").valueOf();return!!(I&&I>=g)}),y=b=>jet({offline:h,methods:i,factoryEngine:o,tournamentIds:f,completion:s,saveLocal:b});if(!v){Vet({state:a,providerIds:m,mutate:y});return}if(m.length&&!h){kDe({state:a,providerIds:m,mutate:y});return}await y(!0)}function Vet({state:t,providerIds:e,mutate:i}){return $t({action:{onClick:()=>e?.length?kDe({state:t,providerIds:e,mutate:i}):i(),text:"Modify?"},message:"Not in date range",intent:"is-danger",pauseOnHover:!0,duration:8e3})}function kDe({state:t,providerIds:e,mutate:i}){if(!t)return ht.provider=void 0,U2(!1),$t({message:"Not logged in",intent:"is-warning"});const r=!!(t?.providerIds?.includes(e[0])||t?.provider?.organisationId===e[0]),n=t?.roles?.includes(_x),a=ht.provider?.organisationId===e[0];return!r&&!n?$t({message:"Not authorized",intent:"is-danger"}):!r&&n&&!a?$t({action:{onClick:()=>(ht.provider={organisationId:e[0]},i(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):i(!r&&!(n&&a))}function PJ({factoryEngine:t,methods:e}){ai.log?.verbose&&console.log("%c executing locally","color: lightgreen");const i=Ni.makeDeepCopy(e);return t.executionQueue(i,!0)||{}}async function OB(t){(t||ai.saveLocal)&&await $8()}async function jet({offline:t,methods:e,completion:i,factoryEngine:r,tournamentIds:n,saveLocal:a}){const s=r.getTournament().tournamentRecord?.parentOrganisation?.organisationId;if(window.dev?.params)for(const c of e)window.dev.params[c.method]&&(c.params={...c.params,...window.dev.params[c.method]});window?.dev?.getContext().internal&&console.log({methods:e});const o=!ai.serverFirst||!s;let l;if(o||t){if(l=PJ({factoryEngine:r,methods:e}),l.error)return i(l);if(!s||t)return await OB(!0),i(l)}if(s&&(l?.success||ai.serverFirst)){const c=async u=>{const d=u?.error?.code==="ERR_MISSING_TOURNAMENT";if(ai.serverFirst&&(u?.success||d))return l=PJ({factoryEngine:r,methods:e}),l.error||await OB(a||d),i(l)};ai.log?.verbose&&console.log("%c invoking remote","color: lightblue"),h9({data:{type:"executionQueue",payload:{methods:e,tournamentIds:n,rollbackOnError:!0}},ackCallback:c}),o&&await OB(a||!1)}if(o)return i(l)}function ODe(t,e){const i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);const r=document.body.appendChild(i);r.click(),r.remove()}function xDe(t,e){const i="data:text/json;charset=utf-8,"+encodeURIComponent(pYe(e)||"");ODe(t,i)}function Get(t,e){const i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);ODe(t,i)}function LDe(){const t=l=>l.toString()[1]?l:"0"+l,e=l=>{if(!l)return"";const c=new Date(l);return[t(c.getMonth()+1),t(c.getDate()),c.getFullYear()].join("/")},{tournamentInfo:i}=We.getTournamentInfo(),{completedMatchUps:r}=We.tournamentMatchUps({context:{tournamentSanctionBody:i.parentOrganisation?.organisationName,tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventCategory:"Junior",tournamentEventType:"Tournament",...i,idType:mI}}),n=r.map(l=>{const{winningSide:c,sides:u,score:d}=l,p=u.find(({sideNumber:m})=>m===c),h=u.find(({sideNumber:m})=>m!==c);return{winnerScore:d[`scoreStringSide${c}`],...l,winners:p,losers:h}}),a=l=>l?.slice(0,1),s={columnAccessors:[""],columnTransform:{Date:["tournamentEndDate"],"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 UTR ID":["winners.participant.individualParticipants.0.person.personOtherIds.0.idValue"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 College":["winners.participant.individualParticipants.0.college"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 UTR ID":["winners.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 College":["winners.participant.individualParticipants.1.college"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.0.idValue"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 College":["losers.participant.individualParticipants.0.college"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 UTR ID":["losers.participant.individualParticipants.1.person.personOtherIds.1.idValue"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 College":["losers.participant.individualParticipants.1.college"],Score:["winnerScore"],"Id Type":["idType"],"Draw Name":[fI],"Draw Gender":["gender"],"Draw Team Type":["eventType"],"Draw Bracket Type":[""],"Draw Bracket Value":[""],"Draw Type":[nh],"Tournament Name":["tournamentName"],"Tournament URL":[""],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament City":[""],"Tournament State":[""],"Tournament Country":[""],"Tournament Country Code":[""],"Tournament Host":[""],"Tournament Location Type":[""],"Tournament Surface":[""],"Tournament Event Type":["tournamentEventType"],"Tournament Event Category":["tournamentEventCategory"],"Tournament Import Source":["tournamentEventSource"],"Tournament Sanction Body":["tournamentSanctionBody"],"Match ID":["matchUpId"],"Tournament Event Grade":[""]},functionMap:{"Winner 1 Gender":a,"Winner 2 Gender":a,"Loser 1 Gender":a,"Loser 2 Gender":a}},o=Ni.JSON2CSV(n,s);Get(`UTR-${i.tournamentId}.csv`,o)}function Het(){$t({intent:"is-success",message:"Success"})}function zet(t){$t({intent:"is-danger",message:t?.message??"Failure"})}function qet(){const t=We.getTournament().tournamentRecord,e=t?.timeItems?.find(({itemType:p})=>p==="TMX")?.itemValue?.offline,r=t?.parentOrganisation?.organisationId,n=zc(),a=n?.permissions?.includes("deleteTournament"),s=n?.roles?.includes(qpe);let o;const l=()=>{if(o.action.value==="upload"&&o.replace.checked){const p=We.getTournament().tournamentRecord;return $t({action:{onClick:()=>KE({tournamentRecord:p}).then(Het,zet),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}if(o.action.value==="claim"&&n?.provider){const p=We.getTournament().tournamentRecord;if(!p.parentOrganisation){p.parentOrganisation=n.provider,We.setState(p);const h=()=>{Oc.deleteTournament(p.tournamentId),ht.router.navigate(`/tournament/${p.tournamentId}/detail`),$t({message:"Tournament claimed",intent:"is-info"})},f=m=>{$t({message:m.message||"Not claimed",intent:"is-danger"})};KE({tournamentRecord:p}).then(h,f)}}o.action.value==="goOffline"&&n?.provider&&xB({postMutation:h=>{if(h?.success){$8();const f=document.getElementById("dnav");f&&(f.style.backgroundColor="lightyellow"),$t({message:"Offline",intent:"is-info"})}},state:n,offline:!0}),o.action.value==="goOnline"&&n?.provider&&xB({postMutation:h=>{if(h?.success){const f=()=>{Oc.deleteTournament(t.tournamentId);const v=document.getElementById("dnav");v&&(v.style.backgroundColor=""),$t({message:"Online",intent:"is-info"})},m=v=>{console.log({err:v}),xB({state:n,offline:!0})},g=We.getTournament().tournamentRecord;KE({tournamentRecord:g}).then(f,m)}},state:n,offline:!1}),o.action.value==="utrExport"&&LDe(),o.action.value==="todsExport"&&(t?xDe(`${t.tournamentId}.tods.json`,t):$t({message:"Error"}))},c=[{control:"replace",onChange:({e:p})=>{const h=document.getElementById("go");h&&(h.disabled=!p.target.checked)}},{control:"action",onChange:({e:p})=>{const h=document.getElementById("replace"),f=Fl(h,"field");f&&(f.style.display=p.target.value==="upload"?"block":"none");const m=document.getElementById("go");m&&(m.disabled=o.action.value==="upload")}}],u=[{label:"-- select action --",close:!0},r&&{label:"Upload tournament",value:"upload",close:!0},t&&{label:"Delete tournament",disabled:!a,value:"delete",close:!0},t&&!r&&n?.provider&&{label:"Claim tournament",value:"claim",close:!0},r&&!e&&{label:"Go offline - standalone mode",value:"goOffline",close:!0},r&&e&&{label:"Go online - exit standalone mode",value:"goOnline",close:!0},t&&s&&{label:"Export UTR matches",value:"utrExport"},t&&s&&{label:"Export TODS file",value:"todsExport"}].filter(Boolean);if(u.length<2)return $t({message:"No actions available"});Kr({title:"Tournament actions",content:p=>o=pn(p,[{label:"Action",field:"action",options:u},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],c),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:l,close:!0}]})}function xB({postMutation:t,state:e,offline:i}){const r={...(We.getTournamentTimeItem({itemType:"TMX"})?.timeItem??{}).itemValue};i?r.offline={email:e.email}:delete r.offline,qt({methods:[{method:PYe,params:{removePriorValues:!0,timeItem:{itemType:"TMX",itemValue:r}}}],callback:t})}function FDe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function Wet(){const{tournamentRecord:t}=We.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:mI,intent:"is-warning",onClick:LDe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?xDe(`${t.tournamentId}.tods.json`,t):$t({message:"Error"})},close:!0}],r=`${$f.tr("phrases.export")}: ${$f.tr("trn")}`;Kr({title:r,content:t.tournamentName,buttons:i})}function Yet(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function YD(t){const{e,table:i,classNames:r=[],className:n,visible:a,columns:s}=t,o=Fl(e.target,"options_right"),l=a?"":Vt,c=a?Vt:"";if(o)for(const u of o.children){const d=n?Array.from(u.classList).includes(n):Array.from(u.classList).some(p=>r.includes(p));u.style.display=d?l:c}for(const u of s)i.updateColumnDefinition(u,{formatter:a?Yet:void 0,editable:a})}function Ket(t,e){YD({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const Zet=(t,e)=>t.groups?.find(i=>i.participantRoleResponsibilities?.includes(e))?.participantName,Xet=t=>Zet(t,"CLUB"),BDe=(t,e)=>(t.events||[]).map(({eventId:i})=>e?.[i]),$De=t=>fg.countries.find(e=>e.ioc===t||e.iso===t)?.label||"",oG=/[\p{Lu}]/u,Jet=/[\p{Ll}]/u,Qet=/^[\p{Lu}](?![\p{Lu}])/u,Z0=/[_.\- ]+/,VDe=/([\p{Alpha}\p{N}_]|$)/u,ett=new RegExp("^"+Z0.source),ttt=new RegExp(Z0.source+VDe.source,"gu"),itt=new RegExp(String.raw`\d+`+VDe.source,"gu"),rtt=(t,e,i,r)=>{let n=!1,a=!1,s=!1,o=!1;for(let l=0;l<t.length;l++){const c=t[l];o=l>2?t[l-3]==="-":!0,n&&oG.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),n=!1,s=a,a=!0,l++):a&&s&&Jet.test(c)&&(!o||r)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),s=a,a=!1,n=!0):(n=e(c)===c&&i(c)!==c,s=a,a=i(c)===c&&e(c)!==c)}return t},ntt=(t,e)=>t.replace(Qet,i=>e(i)),att=(t,e,i)=>{let r="",n=!1,a=!1;const s=[...t];for(let o=0;o<s.length;o++){const l=s[o],c=oG.test(l),u=o+1<s.length&&oG.test(s[o+1]);n&&/[\p{Alpha}]/u.test(l)?(r+=l,n=!1,a=c):i&&c&&(a||u)?(r+=l,a=!0):/\d/.test(l)?(r+=l,n=!0,a=!1):Z0.test(l)?(r+=l,a=!1):(r+=e(l),n=!1,a=!1)}return r},stt=(t,e,{capitalizeAfterNumber:i})=>{const r=i?(n,a,s,o)=>{const l=o.charAt(s+n.length);return Z0.test(l)?n:a?n.slice(0,-a.length)+e(a):n}:n=>n;return t.replaceAll(itt,r).replaceAll(ttt,(n,a)=>e(a))};function ott(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,capitalizeAfterNumber:!0,...e},Array.isArray(t)?t=t.map(s=>s.trim()).filter(s=>s.length>0).join("-"):t=t.trim(),t.length===0)return"";const i=t.match(/^[_$]*/)[0];if(t=t.slice(i.length),t.length===0)return i;const r=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return t.length===1?Z0.test(t)?i:i+(e.pascalCase?n(t):r(t)):(t!==r(t)&&(t=rtt(t,r,n,e.preserveConsecutiveUppercase)),t=t.replace(ett,""),e.capitalizeAfterNumber?t=e.preserveConsecutiveUppercase?ntt(t,r):r(t):t=att(t,r,e.preserveConsecutiveUppercase),e.pascalCase&&t.length>0&&(t=n(t[0])+t.slice(1)),i+stt(t,n,e))}const{WTN:ltt,UTR:ctt}=So.ratingConstants,{SINGLES:CJ}=So.eventConstants,utt=(t,e)=>{const{participantId:i,participantName:r,participantType:n,person:a}=t,{standardFamilyName:s,standardGivenName:o}=a||{},l=t.person?.addresses?.[0],c=l?.city&&l?.state?`${l.city}, ${l.state}`:void 0,u=t.ratings?.[CJ]?.find(h=>h.scaleName===ctt)?.scaleValue,p={wtn:t.ratings?.[CJ]?.find(h=>h.scaleName===ltt)?.scaleValue,utr:u};return{searchText:`${r} ${o} ${s}`.toLowerCase(),sex:ott(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:h})=>h),ioc:$De(t.person?.nationalityCode),events:BDe(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:s,firstName:o,club:Xet(t),teams:t.teams,participantName:r,participantType:n,participantId:i,participant:t,cityState:c,ratings:p}},af=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:dtt,FEMALE:ptt}=_p,{PAIR:htt}=Vs,Yw=t=>(e,i,r)=>{const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,s=document.createElement("div"),o=e.getRow().getData(),l=o.winningSide,c=e.getValue(),u=o.participant||c?.participant||o.person&&o;if(u){const d=ai.scales[ai.activeScale],p=f=>L8({eventHandlers:{participantClick:m=>Pt(t)&&t({...m,event:m.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",genderColor:!0,winnerColor:!0,scaleAttributes:d,flag:!1}},matchUp:o.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const m=document.createElement("div");return m.className="flexrow flexjustifystart",f.individualParticipants?.forEach((g,v)=>{if(m.appendChild(p(g)),!v){const y=document.createElement("span");y.style.width="1em",y.innerHTML="&nbsp;",m.appendChild(y)}}),m};return r==="sideBySide"&&u.participantType===htt?h(u):p(u)}if(l){const d=n.field===o.winningSide;s.style.color=d?"green":"red"}else{const d=c?.sex||o?.person?.sex,p=d===dtt&&"#2E86C1"||d===ptt&&"#AA336A"||"";s.style.color=p}return s.innerHTML=(pp(c)?c.participantName:c)||"",s};function ftt(t){return t.getValue()?.length||0}function yU(t,e){const i=t?.person||t?.participant?.person,r=e?.person||e?.participant?.person;return i||r?i?.standardFamilyName&&!r?.standardFamilyName||r?.standardFamilyName&&!i?.standardFamilyName||!i?.standardFamilyName&&!r?.standardFamilyName?1:i.standardFamilyName?.localeCompare(r?.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!t?.participantName&&!e?.participantName?1:t?.participantName?.localeCompare(e?.participantName)}async function jDe({participantIds:t,participantId:e,callback:i}){(e||t)&&qt({methods:[{params:{participantIds:t||[e]},method:AYe}],callback:a=>{a.success?Pt(i)&&i&&i(a):console.log({result:a})}})}const{COMPETITOR:mtt,OFFICIAL:RJ}=jg,{INDIVIDUAL:gtt}=Vs;function GDe({participant:t,view:e,callback:i}){const r=fg.countries.map(m=>({label:fg.countryToFlag(m.iso||"")+" "+m.label,value:m.ioc})),n={nationalityCode:t?.person?.nationalityCode,firstName:t?.person?.standardGivenName,lastName:t?.person?.standardFamilyName,birthDate:t?.person?.birthDate,sex:t?.person?.sex};let a;const s=m=>n.nationalityCode=m,o=({firstName:m,lastName:g})=>Bn(2)(m||"")&&Bn(2)(g||""),l=({inputs:m})=>{const g=o({firstName:m.firstName.value,lastName:m.lastName.value}),v=document.getElementById("saveParticipant");v&&(v.disabled=!g)},c=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],u=m=>{a=pn(m,[{error:"Please enter a name of at least 3 characters",value:n.firstName||"",validator:Bn(2),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:n.lastName||"",validator:Bn(2),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!n.sex},{label:"Male",value:"MALE",selected:n.sex==="MALE"},{label:"Female",value:"FEMALE",selected:n.sex==="FEMALE"}]},{placeholder:"Birthday",value:n.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:r,callback:s},placeholder:"Country of origin",value:n.nationalityCode||"",field:"nationalityCode",label:"Country"}],c)},d=(m,g)=>Ww(m,[{label:"Cancel",close:!0},{disabled:!o(n),onClick:h,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],g),p=t?"Edit":"New";ht.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:Xt,content:u,footer:d});function h(){if(!t?.participantId)f();else{const m={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},g=[{params:{participant:{participantId:t.participantId,person:m}},method:V_}];qt({methods:g,callback:y=>{y.success?Pt(i)&&i():console.log(y)}})}}function f(){const m=a.firstName.value,g=a.lastName.value,v=a.sex.value,y={participantRole:e===RJ?RJ:mtt,participantType:gtt,participantId:Ni.UUID(),person:{nationalityCode:n.nationalityCode,standardGivenName:m,standardFamilyName:g,sex:v}};qt({methods:[{params:{participants:[y]},method:q0}],callback:w=>{w.success&&Pt(i)&&i(),w.success||console.log(w)}})}return{...IR}}function vtt({participantId:t,callback:e}){const i=We.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants?.[0];if(i)return GDe({participant:i,callback:e,view:void 0})}const eA=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(u=>u.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),s=a.getData(),{participantId:o,participantType:l}=s;nu({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>console.log("Participant profile",i.getData()?.participant)},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{vtt({participantId:o,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{jDe({participantId:o,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:n||e.target,config:{placement:wp}})},{SINGLES:ytt}=ll,HDe=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const r=e.getValue(),n=e.getRow().getData(),{participantId:a}=n,s=(o,l)=>o?.eventName?.localeCompare(l?.eventName);return r.sort(s).forEach(o=>{const l=zDe({participantId:a,event:o,eventClick:t});i.appendChild(l)}),i};function zDe({matchUpId:t,participantId:e,event:i,eventClick:r}){const n=document.createElement("span");return Pt(r)&&r&&(n.onclick=()=>r({eventId:i.eventId,participantId:e,matchUpId:t})),n.className="tag event-pill",i.gender?.toLowerCase().includes("female")?n.classList.add("is-danger"):i.gender?.toLowerCase().includes("male")?n.classList.add("is-link"):n.classList.add("is-primary"),i.eventType===ytt&&n.classList.add("is-light"),n.innerHTML=i.eventName,n}const btt=t=>e=>{e.getColumn().getDefinition();const i=e.getRow().getData(),{matchUpId:r}=i,n=document.createElement("div");n.className="tags";const a=zDe({matchUpId:r,event:i,eventClick:t});return n.append(a),n},qDe=t=>e=>{const i=e.getColumn().getDefinition(),r=document.createElement("div");r.className="tags";const n=e.getValue(),a=(s,o)=>s?.participantName?.localeCompare(o?.participantName);return n.sort(a).forEach(s=>{const o=Itt({matchUpId:i.matchUpId,team:s,teamClick:t});r.appendChild(o)}),r};function Itt({matchUpId:t,team:e,teamClick:i}){const r=document.createElement("span"),{participantId:n,participantName:a}=e;return Pt(i)&&i&&(r.onclick=()=>i({participantId:n,matchUpId:t})),r.className="tag event-pill",r.innerHTML=a,r}const lG=({maxValue:t,decimals:e,field:i})=>(r,n,a)=>{const s=e?/[^0-9.]/g:/^\D/g,o=document.createElement("input");o.style.backgroundColor="lightyellow",o.style.boxSizing="border-box",o.style.textAlign="center",o.style.padding="3px",o.style.height="100%",o.style.width="100%",o.value=r.getValue()||"",n(()=>{o.focus(),o.select()});function l(){let c=o.value;e&&(c=parseFloat(c).toFixed(2)),a(isNaN(c)?void 0:c)}return o.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),o.addEventListener("keyup",c=>{const u=c.target.value.replace(s,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=Fl(c.target,"tabulator-row")?.previousSibling,h=p&&Eg(p,"tabulator-editable");if(h)for(r of h)r.getAttribute("tabulator-field")===i&&r.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=Fl(c.target,"tabulator-row")?.nextSibling,h=p&&Eg(p,"tabulator-editable");if(h)for(r of h)r.getAttribute("tabulator-field")===i&&r.focus()}}),o.addEventListener("blur",l),o},MJ=t=>ht.columns[t]!==!1;function Fn({eventId:t,drawId:e,structureId:i,renderDraw:r,participantId:n,matchUpId:a,view:s}){const o=We.getTournament()?.tournamentRecord?.tournamentId,l=t&&We.getEvent({eventId:t,drawId:e}).event,c=l?.drawDefinitions?.length===1&&l.drawDefinitions[0];n&&c&&(e=c.drawId,r=!0),a&&(e=l.drawDefinitions.find(({drawId:d})=>We.allDrawMatchUps({drawId:d,inContext:!1}).matchUps.find(h=>h.matchUpId===a))?.drawId,r=!!e);let u=`/${Es}/${o}/${bb}/${t}`;r&&e?(u+=`/${EE}/${e}`,i&&(u+=`/${kV}/${i}`),[LV,BT,FT].includes(s||"")&&(u+=`/${OV}/${s}`)):e&&(u+=`/${Wpe}/${e}`),ht.router.navigate(u),ht.router.resolve()}const tv=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:wtt,SIGNED_OUT:Stt}=Vs;function Ttt(t,e){const i=e.getRow().getData().participantId,r=!e.getValue();qt({methods:[{params:{signInState:r?wtt:Stt,participantIds:[i]},method:H8}],callback:o=>{o.success&&e.setValue(r)}})}const Utt=({field:t})=>(e,i,r)=>{const n=document.createElement("input");n.style.backgroundColor="lightyellow",n.style.boxSizing="border-box",n.style.textAlign="center",n.style.padding="3px",n.style.height="100%",n.style.width="100%",n.value=e.getValue()||"",i(()=>{n.focus(),n.select()});function a(){const s=n.value;r(s)}return n.addEventListener("keydown",s=>{s.key==="Tab"&&(s.preventDefault(),s.stopPropagation())}),n.addEventListener("keyup",s=>{if(s.key==="Tab"&&s.shiftKey&&t){const l=Fl(s.target,"tabulator-row")?.previousSibling,c=l&&Eg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((s.key==="Enter"||s.key==="Tab")&&t){const l=Fl(s.target,"tabulator-row")?.nextSibling,c=l&&Eg(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),n.addEventListener("blur",a),n},LB="fa-check-square",Mm=t=>(e,i)=>{const r=i.getTable(),n=r.getColumns(),a=[];for(const s of n){const o=s.getDefinition();if(o.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(s.isVisible()?LB:"fa-square");const c=document.createElement("span"),u=document.createElement("span"),d=t?.[o.field]||o.displayTitle||o.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),a.push({label:c,action:function(p){p.stopPropagation(),s.toggle(),ht.columns[s.getField()]=s.isVisible(),r.redraw(),s.isVisible()?(l.classList.remove("fa-square"),l.classList.add(LB)):(l.classList.remove(LB),l.classList.add("fa-square"))}})}}return a},{WTN:Dtt,UTR:Ett}=So.ratingConstants,{FEMALE:Ptt,MALE:Ctt}=_p,NJ="ratings.utr.utrRating",AJ="ratings.wtn.wtnRating";function Rtt({data:t,replaceTableData:e}){const i=t.some(s=>s.cityState),r=t.some(s=>s.tennisId),n=t.some(s=>s.ratings?.utr),a=t.some(s=>s.ratings?.wtn);return[{cellClick:(s,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:ui,width:55},{formatter:Yw(({event:s,cell:o})=>eA(e)(s,o)),cellClick:eA(e),sorter:yU,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:Utt({field:"tennisId"}),visible:r,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:ui,editor:"list",width:80,editorParams:{itemFormatter:(s,o)=>o,values:{Male:Ctt,Female:Ptt,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:Ttt,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:ui,tooltip:!1,width:40},{sorter:(s,o)=>(s.length||0)-(o?.length||0),formatter:ftt,title:"Penalties",field:"penalties",hozAlign:ui,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:ui,minWidth:70,editor:!1,visible:!1},{sorter:(s,o)=>s?.[0]?.eventName?.localeCompare(o?.[0]?.eventName),formatter:HDe(Fn),visible:MJ("events"),title:"Events",field:"events",hozAlign:ui,minWidth:200,editor:!1,widthGrow:2},{sorter:(s,o)=>s?.[0]?.participantName?.localeCompare(o?.[0]?.participantName),formatter:qDe(()=>console.log("boo")),visible:MJ("teams"),title:"Teams",field:"teams",hozAlign:ui,minWidth:200,editor:!1,widthGrow:2},{visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:lG({maxValue:40,decimals:!0,field:AJ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:AJ,editable:!1,visible:!!a,title:Dtt,width:70},{editor:lG({maxValue:16,decimals:!0,field:NJ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:NJ,editable:!1,visible:!!n,title:Ett,width:70},{cellClick:eA(e),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,maxWidth:40}]}const{INDIVIDUAL:Mtt,GROUP:Ntt,TEAM:Att}=Vs,{OFFICIAL:_J,COMPETITOR:_tt}=jg;function ktt({view:t}={}){let e,i=[],r,n,a=[],s;const o={participantRoles:[t===_J?_J:_tt]},l=()=>{({participants:r=[],derivedEventInfo:n}=We.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:o,withEvents:!0,withISO2:!0}));const m=r.filter(({participantType:g})=>g===Mtt);return i=r.filter(({participantType:g})=>g===Ntt),a=r.filter(({participantType:g})=>g===Att),m?.map(g=>utt(g,n))||[]},c=()=>{const f=l(),m=f?.some(I=>I.cityState),g=f?.some(I=>I.tennisId),v=f?.some(I=>I.ratings?.utr),y=f?.some(I=>I.ratings?.wtn);m&&e?.showColumn("cityState"),g&&e?.showColumn("tennisId"),v&&e?.showColumn("ratings.utr.utrRating"),y&&e?.showColumn("ratings.wtn.wtnRating"),setTimeout(()=>e.replaceData(f),s?0:1e3)},u=l(),d=Rtt({data:u,replaceTableData:c}),p=(f,m)=>(Ni.isNumeric(f)&&f||0)+(Ni.isNumeric(m)&&m||0);return(f=>{Rm({anchorId:GA});const m=document.getElementById(GA),g=Fl(m,"section")?.querySelector(".tabHeader");e=new ks(m,{headerSortElement:af(["sex","signedIn","events","teams","ratings.wtn.wtnRating","ratings.utr.utrRating","cityState","tennisId"]),height:window.innerHeight*.86,placeholder:"No participants",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f});const v=y=>`Participants (${y.length})`;e.on("dataChanged",y=>g&&(g.innerHTML=v(y))),e.on("dataFiltered",(y,b)=>{g&&(g.innerHTML=v(b));const I=[],w=[];for(const E of b){const P=E.getData(),{wtn:R,utr:M}=P.ratings;Ni.isNumeric(M?.utrRating)&&w.push(parseFloat(M.utrRating)),Ni.isNumeric(R?.wtnRating)&&I.push(parseFloat(R.wtnRating))}const T=w.reduce(p,0),S=I.reduce(p,0),D=(w.length?T/w.length:0).toFixed(2),C=(I.length?S/I.length:0).toFixed(2);ai.averages&&console.log(`UTR ${D}x`),ai.averages&&console.log(`WTN ${C}x`)}),e.on("scrollVertical",gd),e.on("tableBuilt",()=>s=!0)})(u),{table:e,replaceTableData:c,teamParticipants:a,groupParticipants:i}}function Ott(t,e){YD({className:"saveTennisId",columns:["tennisId"],visible:!0,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0)}function xtt(t,e){YD({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],classNames:["saveRatings","saveTennisId"],visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0);const r=e.getData().flatMap(a=>{const s=a.ratings?.wtn,o=s?.wtnRating,l=s?.confidence||o?50:0;let c=l?{...s,wtnRating:o,confidence:l}:"";const u={method:YX,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=a.ratings?.utr?.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:"";const h={method:YX,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,h]});qt({methods:r,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:Ltt,OTHER:Ftt}=jg,{TEAM:kJ}=Vs;function WDe({individualParticipantIds:t,participantType:e=kJ,title:i="Edit team",participant:r,refresh:n,table:a}){const s="participantName",o={[s]:r?.[s]};let l;const c=()=>{},u=f=>{l=pn(f,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:o[s]||"",validator:Bn(3),field:s,onChange:c,label:"Name"}])},d=(f,m)=>Ww(f,[{label:"Cancel",onClick:()=>a?.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);ht.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>{},width:"300px",side:Xt,content:u,footer:d});function p(){a?.deselectRow(),r?.participantId?console.log("update existing"):h()}function h(){const f=e===kJ?Ltt:Ftt,m={individualParticipantIds:t||r?.individualParticipantIds||[],participantName:l[s]?.value,participantRole:f,participantType:e};qt({methods:[{params:{participants:[m]},method:q0}],callback:y=>{y.success?Pt(n)&&n&&n():console.log({result:y})}})}return{...IR}}const{TEAM:FB}=Vs;function OJ({participants:t,table:e,replaceTableData:i,participantType:r=FB}){const n=({team:o})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:kUe,params:{groupingParticipantId:o.participantId,individualParticipantIds:c}}];qt({methods:u,callback:p=>{p.success&&i()}})},a=()=>{const o=r===FB?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);WDe({refresh:i,individualParticipantIds:c,participantType:r,participant:{},table:e,title:o})},s=r===FB?"Create new team":"Create new group";return{options:t.map(o=>({onClick:()=>n({team:o}),label:o.participantName,participant:o,close:!0})),actions:[{onClick:()=>a(),close:!0,label:s}]}}const Btt=t=>e=>{if(e.key==="Enter"){const r=t.getSelectedData().map(({participantId:o})=>o),s=t.getData("active").map(({participantId:o})=>o).filter(o=>!r.includes(o));s.length===1&&(t.selectRow(s),e.target.value="",t.clearFilter())}};function $tt(t,e){YD({classNames:["saveTennisId","saveRatings"],columns:["tennisId"],visible:!1,table:e,e:t}),e.showColumn("tennisId"),e.redraw(!0);const i=We.getParticipants().participantMap,n=e.getData().map(a=>{const{tennisId:s,participantId:o}=a;if(s!==i[o].participant.person.tennisId)return{params:{participant:{participantId:o,person:{tennisId:s}}},method:V_}}).filter(Boolean);n.length&&qt({methods:n,callback:s=>{s.success||console.log(s)}})}function YDe(t){let e;const i=l=>e===Vt?!l?.eventIds?.length:l?.eventIds?.includes(e),r=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},n=We.getEvents().events||[],a={label:`<span style='font-weight: bold'>${mg}</span>`,onClick:()=>r(),close:!0},s={label:`<span style='font-weight: bold'>${i2e}</span>`,onClick:()=>r(Vt),close:!0};return{eventOptions:[a,s,{divider:!0}].concat(n.map(l=>({onClick:()=>r(l.eventId),label:l.eventName,close:!0}))),events:n}}const{WTN:Vtt,UTR:jtt}=So.ratingConstants,{FEMALE:Gtt,MALE:Htt,MIXED:ztt,ANY:qtt}=_p;function Wtt({callback:t}){let e;Kr({title:"Generate mock players",content:a=>e=pn(a,[{options:[{label:"Any",value:qtt,close:!0},{label:"Female",value:Gtt,close:!0},{label:"Male",value:Htt,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"8",value:8,close:!0},{label:"16",value:16,close:!0},{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32},{text:"Generate Ratings",header:!0},{label:"WTN",field:"wtnRating",id:"wtnRating",checkbox:!0},{label:"UTR",field:"utrRating",id:"utrRating",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,s=e.wtnRating.checked,o=e.utrRating.checked,l=e.gender.value,c=l===ztt?void 0:l,u=[s&&{ratingType:Vtt,ratingMin:14,ratingMax:19.99},o&&{ratingType:jtt,ratingMin:8,ratingMax:10}].filter(Boolean),{participants:d}=bR.generateParticipants({participantsCount:parseInt(a),scaleAllParticipants:!0,categories:u,sex:c});qt({methods:[{method:q0,params:{participants:d}}],callback:t})}}]})}function Ytt({callback:t}){const e=n=>{const a=n?.players;a?.length?Ktt(a):a&&!a.length&&ht.modal.inform({message:"Sheet Empty: No Player Rows"}),Pt(t)&&t&&t()},{extension:i}=We.findExtension({discover:!0,name:xv.REGISTRATION});i?.value||Wtt({callback:e})}function Ktt(t){console.log({registeredPlayers:t})}function Ztt({table:t,teamParticipants:e}){let i;const r=o=>o.teams.some(l=>l?.participantId===i),n=o=>{t.removeFilter(r),i=o,o&&t.addFilter(r)};return{teamOptions:[{label:`<span style='font-weight: bold'>${r2e}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(e.sort((o,l)=>o?.participantName?.localeCompare(l?.participantName)).map(o=>({onClick:()=>n(o.participantId),label:o.participantName,close:!0})))}}function KDe(t){const i=t.getSelectedData().filter(n=>!n.events?.length).map(({participantId:n})=>n),r=()=>{jDe({participantIds:i,callback:a=>{a.success&&(t.deleteRow(i),t.deselectRow())}})};Kr({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:r}]})}const{FEMALE:xJ,MALE:LJ,ANY:FJ}=_p;function Xtt(t){let e;const i=l=>l.participant?.person?.sex===e,r=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},n=[LJ,xJ],a={[LJ]:"Male",[xJ]:"Female",[FJ]:t2e};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[FJ]}</span>`,onClick:()=>r(),close:!0},{divider:!0}].concat(n.map(l=>({onClick:()=>r(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:Jtt}=Vs;function Qtt(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);qt({methods:[{params:{signInState:Jtt,participantIds:i},method:H8}],callback:a=>{a.success&&(e.forEach(s=>s.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:eit,SIGNED_OUT:tit}=Vs;function iit(t){const i=We.getParticipants({participantFilters:{participantTypes:[eit]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);qt({methods:[{params:{signInState:tit,participantIds:i},method:H8}],callback:a=>{a.success&&t()}})}function rit(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);e=(e<<5)-e+r,e=e&e}return e}const Gm={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function nit({data:t,sheetId:e,callback:i}){const n=We.getParticipants().participants.map(({participantId:c})=>c),a=fg.countries.map(c=>[c.ioc,c.iso]).flat().filter(Boolean),s=[],o=c=>c.map(u=>[u.toLowerCase(),u.toLowerCase().split(" ").join("")]).flat(),l=c=>(u=[])=>{const d=Object.keys(c),p=o(u),h=p.reduce((m,g)=>c[g]||m,void 0),f=!h&&d.filter(m=>p.find(g=>g.startsWith("*")&&m.toLowerCase().includes(g.slice(1))));return h||c[f[0]]};for(const c of t||[]){const u=Object.assign({},...Object.keys(c).map(C=>({[C.toLowerCase()]:c[C]}))),d=l(u),p={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};p.participantName=d(Gm.participantName);const h=d(["tennis id","tennisid"]);h&&(p.person.tennisId=h);const f=d(Gm.person.standardFamilyName),m=d(Gm.person.standardGivenName);if(f&&m)p.person.standardFamilyName=f,p.person.standardGivenName=m,p.participantName=`${m} ${f}`;else continue;const g=d(Gm.person.address.state),v=d(Gm.person.address.city);(v||g)&&(p.person.addresses=[{city:v,state:g}]);const y=d(Gm.person.nationalityCode);y&&a.includes(y.toUpperCase())&&(p.person.nationalityCode=y);const b=d(Gm.person.birthDate);if(Ni.dateTime.dateValidation.test(b)){const C=Ni.dateTime.extractDate(b);C&&(p.person.birthDate=C)}const I=d(Gm.person.sex);if(I){const C=I.toUpperCase();["MALE","FEMALE"].includes(C)?p.person.sex=C:["F","W","G"].includes(I[0])?p.person.sex="FEMALE":["M","B"].includes(I[0])&&(p.person.sex="MALE")}const w=d(["utr profile"]);if(w){p.onlineResources||(p.onlineResources=[]);const C=w.split("profiles/")?.reverse()[0];C&&(p.person.personOtherIds||(p.person.personOtherIds=[]),p.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:C}),w.startsWith("http")&&p.onlineResources.push({resourceSubType:"PROFILE",identifier:w,name:"UTR Profile",resource:"URL"}))}const T=d(["utr"]);if(T){p.timeItems||(p.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:T}};p.timeItems.push(C)}const S=d(["wtn"]);if(S){p.timeItems||(p.timeItems=[]);const C={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:S}};p.timeItems.push(C)}p.participantId=d(Gm.participantId)||`XXX-${rit(p.participantName)}`,n.includes(p.participantId)||s.push(Ni.definedAttributes(p))}s.length?qt({methods:[{method:q0,params:{participants:s}},{method:EYe,params:{extension:{name:Hpe,value:e}}}],callback:d=>{d.success?($t({message:`Added ${d.results[0].addedCount} participant(s)`,intent:"is-success"}),Pt(i)&&i&&i()):console.log(d)}}):$t({message:"No new participants found",intent:"is-primary"}),Pt(i)&&i&&i()}const ZDe=t=>![null,void 0].includes(t),XDe=({c:t})=>t.map(e=>ZDe(e?.v)?e:{});function BJ({header:t,rows:e,useFormat:i=!1}){const r=c=>g1e(c)&&/Date\((\d+),(\d+),(\d+)\)/.test(c),n=c=>c.f||c.v,a=c=>i||r(c.v)?n(c):c.v,s=(c,u,d)=>({...c,[t[d]]:a(u)}),o=(c,u,d)=>ZDe(u.v)?s(c,u,d):c,l=c=>c.reduce((u,d,p)=>o(u,d,p),{});return e.map(XDe).map(l)}function ait(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:r,rows:n}=i.table??{},a=r.map(({label:s})=>s.split(" ")[0]);if(a.filter(Boolean).length)return BJ({header:a,rows:n});{const[s,...o]=n,l=XDe(s).map(c=>c.v);return console.log({header:l}),BJ({header:l,rows:o})}}catch(e){return console.error("Error parsing sheet response:",e),[]}}async function sit({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i?.ok?i.text():void 0}catch(i){console.error("Error fetching sheet:",i);return}}async function oit({sheetId:t}){const e=await sit({sheetId:t});return e?ait(e):[]}const lit=`
  <b>Sharing Requirements</b>
  <ul>
    <li>Open your Google Sheet</li>
    <li>Click "Share" button (top right)</li>
    <li>Set to "Anyone with the link can view"</li>
    <li>Copy the shareable link</li>
  </ul>
  <br> 
  <b>Required Columns</b>
  <ul>
    <li><strong>First Name</strong> (or "first", "first_name")</li>
    <li><strong>Last Name</strong> (or "last", "last_name")</li>
  </ul>
  <br> 
  <b>Optional Columns</b>
  <ul>
    <li><strong>id</strong> or <strong>participantid</strong> - Unique identifier</li>
    <li><strong>Gender</strong> or <strong>sex</strong> - MALE, FEMALE, M, F, W, B, G</li>
    <li><strong>Birth Date</strong> - Format: YYYY-MM-DD</li>
    <li><strong>IOC</strong>, <strong>country</strong>, or <strong>nationality</strong> - 3-letter country code</li>
    <li><strong>City</strong> - City of residence</li>
    <li><strong>State</strong> - State/province</li>
    <li><strong>Tennis ID</strong> - Official tennis organization ID</li>
    <li><strong>UTR</strong> - Universal Tennis Rating (numeric)</li>
    <li><strong>WTN</strong> - World Tennis Number (numeric)</li>
    <li><strong>UTR Profile</strong> - Link to UTR profile page</li>
  </ul>
  <br> 
  <b>Column Name Flexibility</b>
  <ul>
    <li>Column names are case-insensitive</li>
    <li>Spaces and underscores are treated the same</li>
    <li>Partial matches work</li>
  </ul>`;function cit({callback:t}){const{extension:e}=We.findExtension({discover:!0,name:Hpe}),i=e?.value;let r;const n=d=>{r=pn(d,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])},a="Import participants",{update:s}=Kr({title:a,buttons:[],content:n}),o=()=>{const d=r.url.value;if(d){const p=d.split("/"),h=p.reduce((v,y)=>!v||y.length>v.length?y:v,void 0),f=!i||i&&h!==i,m=i||p.indexOf("docs.google.com")>0&&p.indexOf("spreadsheets")>0,g=f?h:i;if(m)m?oit({sheetId:g}).then(v=>nit({data:v,sheetId:g,callback:t})):$t({message:"URL unchanged",intent:"is-info"});else{const v=$f.tr("phrases.invalidsheeturl");$t({message:v,intent:"is-danger"}),r.url.value=""}}},l=()=>{s({buttons:u,content:n,title:a})},u=[{label:"Cancel",intent:"is-nothing"},{label:"Info",intent:"is-info",onClick:()=>{s({buttons:[{label:"Close",intent:"is-nothing",close:!0},{label:"Enter",intent:"is-primary",onClick:l,close:!1}],title:"Google Sheets Import Instructions",content:lit})},close:!1},{label:"Submit",intent:"is-primary",onClick:o,close:!0}];s({buttons:u})}const{ALTERNATE:uit,WILDCARD:dit,DIRECT_ACCEPTANCE:$J,UNGROUPED:pit}=Ju,{MAIN:VJ,QUALIFYING:hit}=Wn,{INDIVIDUAL:fit}=Vs,{TEAM:jJ,DOUBLES:mit}=ll;function git({callback:t,eventName:e,eventType:i,participantType:r,participantIds:n}={}){const a=[jJ,mit].includes(i)&&r===fit;if(!n?.length){$t({message:"Nothing to do",intent:"is-info"});return}const o=[{label:"Main",value:VJ,selected:!0},{label:"Qualifying",value:hit}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:a,label:"Direct Acceptance",value:$J,selected:!0},{hide:a,label:"Alternate",value:uit},{hide:a,label:"Wildcard",value:dit},{hide:r===jJ,label:"Ungrouped",value:pit,selected:a}];let c;Kr({title:"Add to event",content:p=>c=pn(p,[{text:`Add ${n.length} participant to ${e}`},{options:o,label:"Event stage",field:"entryStage",value:VJ},{options:l,value:$J,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,h=c.entryStage.value;Pt(t)&&t&&t({entryStatus:p,entryStage:h})}}]})}function JDe({event:t,participantType:e,table:i,callback:r}){const n=i.getSelectedData(),{eventId:a,eventName:s,eventType:o}=t,l=n.filter(u=>!u.events.map(d=>d.eventId).includes(a)).map(({participantId:u})=>u);if(!l.length&&n.length){$t({message:`All selected participants are already in ${s}`,intent:"is-info"});return}git({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),qt({methods:[{params:{eventId:a,participantIds:l,entryStatus:u,entryStage:d},method:j8}],callback:f=>{f.success?Pt(r)&&r&&r():(console.log({result:f}),f.misMatchedGender&&$t({intent:"is-danger",message:"Invalid gender"}))}})},eventName:s,participantType:e,eventType:o,participantIds:l})}const{ALTERNATE:vit,DIRECT_ACCEPTANCE:yit,UNGROUPED:bit,STRUCTURE_SELECTED_STATUSES:Iit}=Ju,{ANY:gb,FEMALE:yS,MALE:bS,MIXED:vb}=_p,{DOUBLES:uv,SINGLES:IS,TEAM:dv}=ll,{INDIVIDUAL:LM,PAIR:GJ}=Vs,{MAIN:wit}=Wn;function o2({table:t,event:e,participants:i,callback:r}={}){const n=We.getEvents().events?.length||0,a=We.getTournamentInfo()?.tournamentInfo||{},s={eventName:e?.eventName||`Event ${n+1}`,startDate:e?.startDate??a.startDate,endDate:e?.endDate??a.endDate,ageCategoryCode:e?.category?.ageCategoryCode,eventType:e?.eventType||IS,gender:e?.gender||gb},o=e?.entries?.filter(({entryStatus:T})=>[...Iit,vit].includes(T)).map(({participantId:T})=>T),l=o?We.getParticipants({participantFilters:{participantIds:o},withIndividualParticipants:!0}).participants:[];let c,u;const d=i?.[0].participantType;if(i?.length){s.eventType=d===LM&&IS||d===GJ&&uv||dv,d===LM&&(c=[IS,uv,dv]),d===GJ&&(c=[uv]),d===dv&&(c=[dv]);const T=d===LM&&Ni.unique(i.map(S=>S.participant?.person?.sex));u=[gb],T.length===1?(T[0]===yS&&u.push(yS),T[0]===bS&&u.push(bS),s.gender=T[0]):T.length>1&&u.push(vb)}const p=[],h=l.reduce((T,S)=>{const D=S.person?.sex?[S.person.sex]:S.individualParticpants?.map(C=>C.person?.sex)||[];return p.push(D),T.includes(S.participantType)?T:T.concat(S.participantType)},[]),f=[];for(const T of[...l,...(i||[]).map(S=>S.participant)].filter(S=>S)){const S=T.timeItems?.filter(({itemType:D})=>D?.startsWith(`SCALE.RANKING.${s.eventType}`)).map(({itemType:D})=>D?.split(".").pop());f.push(S)}const m=Ni.unique(...f);if(m.length===1&&(s.ageCategoryCode=m[0]),p.length){u=[gb],e.gender&&!e.gender===gb&&u.push(e.gender),e.eventType===uv&&!u.includes(vb)&&u.push(vb);const T=Ni.unique(...p);T.length===1&&!u.includes(T[0])&&u.push(...T)}else e&&(u=[gb,bS,vb,yS]);const g=()=>{},v=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}],y=T=>pn(T,[{error:"minimum of 5 characters",validator:Bn(5),placeholder:"Event name",value:s.eventName,onChange:g,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:h.length,value:s.eventType,field:"eventType",label:"Format",options:[{hide:c&&!c.includes(IS),selected:s.eventType===IS,label:"Singles",value:IS},{hide:c&&!c.includes(uv),selected:s.eventType===uv,label:"Doubles",value:uv},{hide:c&&!c.includes(dv),selected:s.eventType===dv,label:"Team",value:dv}],onChange:g},{value:s.gender,label:"Gender",field:"gender",options:[{hide:u&&!u.includes(bS),selected:s.gender===bS,label:"Male",value:bS},{hide:u&&!u.includes(yS),selected:s.gender===yS,label:"Female",value:yS},{selected:s.gender===gb,label:"Any",value:gb},{hide:u&&!u.includes(vb),selected:s.gender===vb,label:"Mixed",value:vb}],onChange:g},{value:s.ageCategoryCode,field:"ageCategoryCode",label:"Category",options:[{selected:["",void 0].includes(s.ageCategoryCode),label:"------------",value:""},{selected:s.ageCategoryCode==="U10",label:"10 and Under",value:"U10"},{selected:s.ageCategoryCode==="U12",label:"12 and Under",value:"U12"},{selected:s.ageCategoryCode==="U14",label:"14 and Under",value:"U14"},{selected:s.ageCategoryCode==="U16",label:"16 and Under",value:"U16"},{selected:s.ageCategoryCode==="U18",label:"18 and Under",value:"U18"},{label:"Custom",value:"custom",disabled:!0}],onChange:g},{value:e?.startDate??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:e?.endDate??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],v),b=()=>{const T=ht.drawer.attributes.content.ageCategoryCode.value,S=ht.drawer.attributes.content.eventName.value,D=ht.drawer.attributes.content.eventType.value,C=ht.drawer.attributes.content.startDate.value,E=ht.drawer.attributes.content.endDate.value,P=ht.drawer.attributes.content.gender.value,R={eventName:S,eventType:D,gender:P,startDate:C,endDate:E};T&&T!=="custom"&&(R.category={...e?.category,ageCategoryCode:T});const M=A=>{if(t?.deselectRow(),A.success){const N=A.results?.[0]?.event;Pt(r)&&r({...A,event:N,eventUpdates:R})}else A.error&&($t({intent:"is-warning",message:A.error?.message||"Error"}),Pt(r)&&r(A))};if(e){const A=e.eventId;qt({methods:[{method:OYe,params:{eventId:A,eventUpdates:R}}],callback:M})}else{const A=T&&T!=="custom"?{ageCategoryCode:T}:void 0,N=Ni.UUID(),k=[{params:{event:{category:A,eventId:N,eventName:S,eventType:D,gender:P,startDate:C,endDate:E}},method:SYe}];if(i?.length){const x=i.map(({participantId:F})=>F),O=d===LM&&[uv,dv].includes(D)?bit:yit,V={params:{eventId:N,participantIds:x,entryStatus:O,entryStage:wit},method:j8};k.push(V)}qt({methods:k,callback:M})}},I=(T,S)=>Ww(T,[{label:"Cancel",onClick:()=>t?.deselectRow(),close:!0},{label:"Save",onClick:b,close:!0,intent:"is-info"}],S),w=e?.eventId?"Edit event":"Add event";ht.drawer.open({title:`<b style='larger'>${w}</b>`,onClose:()=>t?.deselectRow(),width:"300px",side:Xt,content:y,footer:I})}const K_=(t,e)=>{const i=t.getSelectedData(),r=t.getData("active").map(s=>s.participantId),n=i.filter(s=>r.includes(s.participantId));o2({table:t,callback:s=>{if(t.deselectRow(),s?.success){const o=s?.results[0]?.event?.eventId;Pt(e)&&e?e({eventId:o}):o&&Fn({eventId:o})}else Pt(e)&&e&&e()},participants:n})},{INDIVIDUAL:HJ,TEAM:zJ,GROUP:qJ}=Vs,{OFFICIAL:WJ}=jg,QDe=t=>[{label:"Individuals",value:HJ,isActive:t===HJ,close:!0},{label:"Officials",value:WJ,isActive:t===WJ,close:!0},{label:"Groups",value:qJ,isActive:t===qJ,close:!0},{label:"Teams",value:zJ,isActive:t===zJ,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const r=`/tournament/${We.getTournament().tournamentRecord.tournamentId}/${Jf}/${e.value}`;ht.router.navigate(r)}}})),{INDIVIDUAL:Sit,GROUP:Tit}=Vs,{OFFICIAL:Uit}=jg,{ANY:Dit}=_p,BB="is-primary";function eEe({view:t}){const{table:e,replaceTableData:i,teamParticipants:r,groupParticipants:n}=ktt({view:t}),a=qw(e),s=t===Uit?"Officials":"Individuals",{extension:o}=We.findExtension({discover:!0,name:xv.REGISTRATION}),l=o?.value,c=zc(),u=c?.roles?.includes("superadmin")||c?.permissions?.includes("editTennisId"),d=()=>eEe({view:t}),{eventOptions:p,events:h}=YDe(e),{sexOptions:f,genders:m}=Xtt(e),{teamOptions:g}=Ztt({table:e,teamParticipants:r}),b=[{onClick:()=>iit(i),label:"Sign out players not approved for events",close:!0},{onClick:E=>Ket(E,e),label:"Edit ratings",close:!0},{onClick:E=>Ott(E,e),hide:!u,label:"Edit WTID",close:!0},{divider:!0},{heading:"Add participants"},{hide:l,label:"Generate mock participants",onClick:()=>{Ytt({callback:()=>{i(),e?.redraw(!0)}})},close:!0},{label:"Import from Google sheet",onClick:()=>cit({callback:i}),close:!0},{onClick:()=>GDe({callback:i,view:t}),label:"New participant",close:!0}],I=h.map(E=>({onClick:()=>JDe({event:E,participantType:Sit,table:e,callback:d}),label:E.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>K_(e,d),close:!0}]),w=OJ({participants:n,participantType:Tit,replaceTableData:i,table:e}),T=OJ({participants:r,table:e,replaceTableData:i}),S=Btt(e),D=[{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&a(""),S(E)},onChange:E=>a(E.target.value),onKeyUp:E=>a(E.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:ya,search:!0},{options:I,label:"Add to event",hide:!h.length,intent:"is-none",location:ya},{onClick:()=>K_(e,d),label:"Create event",hide:h.length,intent:"is-info",location:ya},{selection:T,label:"Add to team",intent:"is-none",location:ya},{selection:w,label:"Add to group",intent:"is-none",location:ya},{onClick:()=>Qtt(e),intent:BB,location:ya,label:"Sign in"},{onClick:()=>KDe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onKeyDown:E=>{E.keyCode===8&&E.target.value.length===1&&a(""),S(E)},onChange:E=>a(E.target.value),onKeyUp:E=>a(E.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:ui,search:!0},{hide:(h||[]).length<1,options:p,label:mg,modifyLabel:!0,selection:!0,location:ui},{label:g[0]?.label||"",options:g,modifyLabel:!0,selection:!0,location:ui},{options:f,label:m[Dit],modifyLabel:!0,selection:!0,location:ui},{options:QDe(t),label:s,intent:"is-info",modifyLabel:!0,location:Xt,selection:!0,align:Xt},{options:b,label:"Actions",selection:!1,location:Xt,align:Xt},{onClick:E=>$tt(E,e),class:"saveTennisId",intent:BB,label:"Save WTID",location:Xt,visible:!1},{onClick:E=>xtt(E,e),label:"Save ratings",intent:BB,class:"saveRatings",location:Xt,visible:!1}],C=document.getElementById(j3)||void 0;bo({table:e,target:C,items:D})}const Eit=t=>{const e=document.createElement("ul");return Object.keys(t).length&&t.forEach(i=>{const r=document.createElement("li");if(i.field==="sex")r.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(pp(i.value)){if(i.value){const n=document.createElement("div");n.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,r.appendChild(n),r.appendChild(i.value)}}else r.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(r)}),e};function Pit(t,e){const{individualParticipantIds:i,individualParticipants:r,participantName:n,participantType:a,participantId:s,representing:o}=t,l=i?.length||0;return{events:BDe(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:n.toLowerCase(),representing:$De(o),individualParticipants:r,participantName:n,participantType:a,participantId:s,membersCount:l}}function Cit({table:t,team:e}){const r=t.getSelectedData().map(({participantId:s})=>s);t.deselectRow();const n=[{method:BYe,params:{groupingParticipantId:e.participantId,individualParticipantIds:r,suppressErrors:!0}}];qt({methods:n,callback:s=>{s.success&&t.deleteRow(r)}})}const{ALTERNATE_PARTICIPANT:Rit,ASSIGN_PARTICIPANT:Mit,LUCKY_PARTICIPANT:Nit,QUALIFYING_PARTICIPANT:Ait,SWAP_PARTICIPANTS:_it}=sw,kit={[Rit]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[Mit]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[Nit]:{selections:"availableLuckyLosers",targetAttribute:"participantId",param:"luckyLoserParticipantId",title:"Assign lucky loser"},[Ait]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[_it]:{selections:["availableAssignments","swappableParticipants"],targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function X0(t){const{selectedParticipantIds:e,selectionLimit:i,activeOnEnter:r,selectOnEnter:n,onSelection:a,update:s,action:o}=t,l=kit[o.type];if(!l?.targetAttribute)return;const c=t.title||l.title||"Select participant";let u,d;const p=()=>{const E=l.targetAttribute,P=l.param||l.targetAttribute,R=Array.isArray(u)?u[0]?.[E]:u?.[E];if(o.type==="SWAP"){if(R)o.payload.drawPositions.push(R),a({[P]:o.payload.drawPositions});else if(u?.length===1){const M=u?.[0]?.participantId;o.payload.participantIds.push(M),a({participantIds:o.payload.participantIds})}}else R&&a({[P]:R,selected:u})},h="selectionControl",f="selectionTable",m=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:p,close:!0}],g=()=>{ht.tables.selectionTable?.destroy(),delete ht.tables.selectionTable},v=`
    <div style='min-height: 420px'>
      <div id='${h}'></div>
      <div id='${f}'></div>
    </div>
  `;s?s({title:c,content:v,buttons:m,onClose:g}):Kr({title:c,content:v,buttons:m,onClose:g});const y=E=>{u=E,i&&u?.length===i&&(pU(),p())},b=Array.isArray(l.selections)?o[l.selections.find(E=>o[E])]:o[l.selections],{table:I}=XUe({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:y,anchorId:f,data:b}),w=qw(I),T=()=>{const E=I.getData("active");if(E.length===1){if(n)u=E[0],pU(),p();else if(r){const P=u?.map(M=>M.participantId)||[],R=E[0].participantId;P.includes(R)||(Array.isArray(u)?u.push(E[0]):u=E,I.selectRow([R]),d.participantSearch.value="")}}},D=[{onKeyDown:E=>{E.key==="Backspace"&&E.target.value.length===1&&w(""),E.key==="Enter"&&T()},onChange:E=>w(E.target.value),onKeyUp:E=>w(E.target.value),clearSearch:()=>w(""),placeholder:"Search entries",id:"participantSearch",location:ui,search:!0,focus:!0}],C=document.getElementById(h)||void 0;d=bo({table:I,target:C,items:D})?.inputs}const{ASSIGN_PARTICIPANT:Oit}=sw,$B=Ni.extractAttributes,xit=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const r="1px solid #333",n=document.createElement("div");n.style.backgroundColor="white",n.style.border=r,n.style.width="99%",e.className=Ox,e.style.display=Vt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBottom=r,e.appendChild(n),t.getElement().appendChild(e);const a=t.getData(),s=d=>{const p={};return d?.map(h=>{const f=h.person?.sex||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},o=s(a.individualParticipants),l=new ks(n,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:o,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:Yw(void 0)},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",gd),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:f}},method:V_}];qt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(w=>w.getData()),I=s(b);y.forEach((w,T)=>w.update(I[T]))}}})}),bo({table:l,target:i,items:[{onClick:()=>Cit({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onClick:()=>{const d=g=>{if(g.participantId){const v=g.selected,y=(g.selected?g.selected.map($B("participantId")):[g.participantId]).filter(Boolean),b=(a.individualParticipants??[]).map($B("participantId")).concat(y);if(y?.length){const I=[{method:kUe,params:{groupingParticipantId:a.participantId,individualParticipantIds:y}},{params:{participant:{participantId:a.participantId,individualParticipantIds:b}},method:V_}];qt({methods:I,callback:T=>{T.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(v),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=a.individualParticipants?.map($B("participantId"))||[],{participants:h}=We.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:g})=>!p.includes(g));X0({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:Oit,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:Xt}]})},m9="&#9660;",tEe=" &#9654;",iEe=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${m9} </span>`,rEe=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${tEe} </span>`,nEe=Ox;function eI(t,e){const i=e.getRow(),r=i._row.element.getElementsByClassName(nEe)[0];if(r){const n=r.style.display!==Vt;r.style.display=n?Vt:"";const s=i.getCells().find(o=>o.getColumn().getDefinition().field===lhe)?._cell?.element;return s&&(s.innerHTML=n?rEe:iEe),{open:!n}}}function g9(t){return t.getRow()._row.element.getElementsByClassName(nEe)[0]?.style.display!==Vt?rEe:iEe}const{GROUP:Lit}=Vs;function Fit({view:t,replaceTableData:e}){const i=(r,n)=>{eI(r,n)?.open};return[{cellClick:(r,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:ui,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:li,resizable:!1,headerSort:!1},{headerMenu:Mm({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:ui,width:55},{cellClick:(r,n)=>i(r,n),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(r,n)=>r?.[0]?.eventName?.localeCompare(n?.[0]?.eventName),formatter:HDe(Fn),visible:t!==Lit,hozAlign:ui,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:li,field:"membersCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:li,field:"matchUpsCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:li,field:"winLoss",hozAlign:li,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:g9,responsive:!1,headerSort:!1,hozAlign:Xt,field:lhe,width:20},{cellClick:eA(e),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,width:20}]}const{TEAM:VB}=Vs;function Bit({view:t}={}){let e,i,r,n;const a=()=>({participants:i,derivedEventInfo:r}=We.getParticipants({participantFilters:{participantTypes:[t||VB]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>Pit(u,r))),s=()=>{setTimeout(()=>e.replaceData(a()),n?0:1e3)},o=Fit({view:t});return(c=>{Rm({anchorId:qA});const u=document.getElementById(qA),d=Fl(u,"section")?.querySelector(".tabHeader");e=new ks(u,{headerSortElement:af(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:Eit,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:xit,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:o}),e.on("dataChanged",p=>{const h=t===VB?"Teams":"Groups";d&&(d.innerHTML=`${h} (${p.length})`)}),e.on("dataFiltered",(p,h)=>{const f=t===VB?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("scrollVertical",gd),e.on("tableBuilt",()=>n=!0)})(a()),{table:e,replaceTableData:s}}const $it={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function Vit({callback:t}={}){const e=[{label:$f.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";Kr({title:"Create Team",content:a=>pn(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const s=a?.selection.value;if(!s||s===i)return;const o=$it[s],l=We.createTeamsFromParticipantAttributes({...o,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:q0}];qt({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:YJ}=Vs;function jit({view:t}){const{table:e,replaceTableData:i}=Bit({view:t}),r=qw(e),{eventOptions:n,events:a}=YDe(e),s=[{label:"New team",onClick:()=>WDe({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>Vit({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>K_(e,i),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===YJ).map(p=>({onClick:()=>JDe({event:p,participantType:YJ,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&r(""),onChange:p=>r(p.target.value),onKeyUp:p=>r(p.target.value),clearSearch:()=>r(""),placeholder:"Search teams",location:ya,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:ya},{onClick:()=>K_(e,i),label:"Create event",hide:a.length,intent:"is-info",location:ya},{onClick:()=>KDe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&r(""),onChange:p=>r(p.target.value),onKeyUp:p=>r(p.target.value),clearSearch:()=>r(""),placeholder:"Search teams",location:ui,search:!0},{hide:n.length<2,options:n,modifyLabel:!0,label:mg,location:ui,selection:!0},{options:QDe(t),label:c,modifyLabel:!0,intent:"is-info",location:Xt,selection:!0,align:Xt},{options:s,label:"Actions",selection:!1,location:Xt,align:Xt}],d=document.getElementById(Y3)||void 0;bo({table:e,target:d,items:u})}const{INDIVIDUAL:Git,TEAM:Hit,GROUP:zit}=Vs;function qit({participantView:t=Git}={}){const e=t.toUpperCase(),i=[Hit,zit].includes(e),r=document.getElementById("individuals"),n=document.getElementById("participantGroupings");i?(r&&(r.style.display=Vt),n&&(n.style.display="")):(n&&(n.style.display=Vt),r&&(r.style.display="")),i?jit({view:e}):eEe({view:e})}var aEe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:Wit}=ll,KD=t=>{const{potentialParticipants:e,matchUpType:i,matchUpId:r,eventName:n,roundName:a,schedule:s,eventId:o,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=s||{},m=N=>N.person?.standardFamilyName||N.participantName,g=e?.map(N=>({participantName:N.map(m).filter(Boolean).join(" or ")}))||[],v=u?.[0]?.participant||g.shift(),y=u?.[1]?.participant||g.shift(),b={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I={participantName:y?.participantName,sex:y?.person?.sex,participant:y},w=u.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),T=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,D=!!(d.winningSide||d.readyToScore),C=d.score?.scoreStringSide1,E=u.flatMap(N=>{const k=N.participant?.person;return k?[k.standardGivenName,k.standardFamilyName]:N.participant?.individualParticipants?.map(({person:x})=>[x.standardGivenName,x.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=aEe([E,v?.participantName,y?.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?Wit:i,M=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:C,matchUpStatus:t.matchUpStatus,readyToScore:D,complete:S,winningSide:T};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:w,flight:t.drawName,competitiveProfile:M,scheduledDate:p,readyToScore:D,scheduledTime:h,matchUpType:i,scoreDetail:A,winningSide:T,searchText:P,courtName:f,eventName:n,eventType:R,matchUpId:r,roundName:a,complete:S,eventId:o,matchUp:t,gender:c,drawId:l,side1:b,side2:I,score:C}};function sEe(t,e){const i=t.target.id;t.dataTransfer?.setData("itemid",i),e&&t.dataTransfer&&(t.dataTransfer.setData("itemtype",o2e),t.dataTransfer.setDragImage(ht.dragMatch,10,10)),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}const{MALE:Yit,FEMALE:Kit}=_p;function Zit(t){function e(a){const s=document.createElement("div"),o=a.getValue(),l=pp(o)&&o?.sex===Yit&&"#2E86C1"||o?.sex===Kit&&"#AA336A"||"";return s.style.color=l,s.innerHTML=(pp(o)?o.participantName:o)||"",s}function i(a){const s=document.createElement("div");return s.innerHTML=a.getValue(),s}function r(a){const s=a.getElement();return s.classList.add("tag"),s.classList.add("is-info"),s.classList.add("is-light"),t?.length||0}const n=(a,s)=>a.participantName&&!s.participantName||s.participantName&&!a.participantName||!a?.participantName&&!s?.participantName?1:a?.participantName?.localeCompare(s?.participantName);return[{titleFormatter:r,formatter:"rownum",headerSort:!1,hozAlign:li,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{title:"Flight",field:"flight"},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:n,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:n,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const KJ=Object.keys(Zpe);function Xit(t,e){return KJ.indexOf(t.issue)-KJ.indexOf(e.issue)}function Z_(t){const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(pp)).filter(s=>s.matchUpId),{courtIssues:r,rowIssues:n}=Xf.proConflicts({matchUps:i});r&&Object.keys(r)?.length,e?.length&&t.updateData(e);const a=t.getColumns()[0].getCells();n?.length&&n.forEach((s,o)=>{const l=o+1,c=a.find(u=>u.getData().rowNumber===l);if(c){c.getElement().classList.forEach(d=>{d.startsWith("matchup")&&c.getElement().classList.remove(d)});const u=c.getData();if(s.length){s.sort(Xit),u.issues=s;const d=Zpe[s[0].issue];c.getElement().classList.add(d)}else c.getElement().style.backgroundColor="white",u.issues=[]}else console.log("control cell not found",{rowNumber:l})})}function Jit(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),r=ks.findTable("#tournamentSchedule")[0],a=r.getData().flatMap(m=>Object.values(m).filter(g=>g&&typeof g=="object"&&"matchUpId"in g)).find(m=>m.matchUpId===i)||{};if(!a?.schedule?.courtId)return;let s;const o=r.getData().find(m=>(s=Object.keys(m).find(g=>{if(pp(m[g]))return m[g].matchUpId===i}),s)),{courtId:l,courtOrder:c,venueId:u}=a.schedule;o&&s&&(o[s]={schedule:{courtOrder:c,courtId:l,venueId:u}},r.updateData([o])),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:Hj,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId,removePriorValues:!0}}];qt({methods:p,engine:N3,callback:m=>!m.success&&console.log({result:m})}),a.schedule=d;const f=KD(a);e.addRow(f,!0),Z_(r)}const{SINGLES:Qit,DOUBLES:ert}=ll;function trt({scheduledDate:t}={}){const e=t;let i=[],r,n;function a(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>sEe(m,!0)),p.draggable=!0}function s({scheduledDate:d}){const p=Xf.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:So.upcomingMatchUpStatuses,matchUpTypes:[Qit,ert]},nextMatchUps:!0}).matchUps?.filter(m=>!m.schedule?.courtId&&!m.sides?.some(({bye:g})=>g))||[],h=d||e;return i=p.filter(m=>!m.schedule?.scheduledDate||m.schedule.scheduledDate===h),{rowMatchUps:i.map(KD)}}function o({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=s({scheduledDate:d});n&&n.replaceData(h)},r?0:1e3),{unscheduledMatchUps:i}}const l=Zit(i);Rm({anchorId:$b});const c=document.getElementById($b),{rowMatchUps:u=[]}=s({scheduledDate:e});return n=new ks(c,{headerSortElement:af(["flight"]),placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:u,height:250,columns:l}),n.on("tableBuilt",()=>{r=!0;const d=c?.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>Jit(p,n)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),n.on("dataChanged",d=>{const p=n.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),n.on("dataFiltered",(d,p)=>{const h=n.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),n.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:n,replaceTableData:o,unscheduledMatchUps:i}}function v9(t,e){return t?Ni.dateTime.convertTime(t,e):""}function irt(t){const e=v9(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function ZJ(t){return t.toString()[1]?t.toString():"0"+t}function rrt(t,e){let i=Math.floor(t/3600),r=Math.floor((t-i*3600)/60);return e&&(r=0,i+=1,i>23&&(i=0)),`${ZJ(i)}:${ZJ(r)}`}const nrt="modulepreload",art=function(t,e){return new URL(t,e).href},XJ={},l2=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const s=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=c(i.map(u=>{if(u=art(u,r),u in XJ)return;XJ[u]=!0;const d=u.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(r)for(let f=s.length-1;f>=0;f--){const m=s[f];if(m.href===u&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":nrt,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return n.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})},{COMPLETED:oEe}=Kh,{validateMatchUpScore:srt,validateSetScore:cG}=Tk.scoreGovernor;function ort(t){if(!t?.trim())return{error:"Score is required"};try{const e=t.trim(),i=We.tidyScore({score:e});return i?.error?{error:typeof i.error=="string"?i.error:i.error?.message||JSON.stringify(i.error)}:{tidyScore:i?.score,matchUpStatus:i?.matchUpStatus}}catch(e){return{error:e instanceof Error?e.message:"Invalid format"}}}function tI(t,e,i){const{WALKOVER:r,CANCELLED:n,DEAD_RUBBER:a}=Kh,s=[r,n,a];if(!t?.trim())return i&&s.includes(i)?{isValid:!0,sets:[],matchUpStatus:i,scoreObject:void 0}:{isValid:!1,sets:[],error:"Score is required"};try{const o=We.parseScoreString({scoreString:t.trim(),matchUpFormat:e});if(!o||o.length===0)return{isValid:!1,sets:[],error:"Invalid score format"};const l=o,c=l.map(C=>{let E=`${C.side1Score||0}-${C.side2Score||0}`;return C.side1TiebreakScore!==void 0&&(E+=`(${C.winningSide===1?C.side1TiebreakScore:C.side2TiebreakScore})`),E}).join(" "),u=l.map(C=>{let E=`${C.side2Score||0}-${C.side1Score||0}`;return C.side2TiebreakScore!==void 0&&(E+=`(${C.winningSide===2?C.side2TiebreakScore:C.side1TiebreakScore})`),E}).join(" "),d={sets:l,scoreStringSide1:c,scoreStringSide2:u},p=e?.match(/SET(\d+)/)?.[1],h=p?Number.parseInt(p):3,f=t.trim().match(/\S+/g)||[],m=Zf.parse(e),g=m?.finalSetFormat?.tiebreakSet?.tiebreakTo&&!m?.finalSetFormat?.setTo,v=m?.setFormat?.tiebreakSet?.tiebreakTo&&!m?.setFormat?.setTo;for(let C=0;C<f.length;C++){const E=f[C],P=C+1,R=P===h,M=E.startsWith("[")&&E.endsWith("]"),A=v||R&&g;if(!A&&M)return{isValid:!1,sets:l,scoreObject:d,error:`Set ${P}: Format expects regular set (e.g., 6-4), but got tiebreak-only set ${E}`};if(A&&!M)return{isValid:!1,sets:l,scoreObject:d,error:`Set ${P}: Format expects tiebreak-only set (e.g., [10-8]), but got regular set ${E}`}}let y=!1;const b=l.map((C,E)=>{const P=E+1===h;if(!cG(C,e,P,!1).isValid){y=!0;const{...M}=C;return M}return C}),I={...d,sets:b},w=srt(b,e,i);if(!w.isValid)return{isValid:!1,sets:b,scoreObject:I,error:w.error};const T=Math.ceil(h/2);let S,D=!1;if(y)S=void 0,D=!1;else{const C={side1:0,side2:0};b.forEach(E=>{E.winningSide===1?C.side1++:E.winningSide===2&&C.side2++}),C.side1>=T?S=1:C.side2>=T&&(S=2),D=C.side1>=T||C.side2>=T}return D?{isValid:!0,sets:b,scoreObject:I,winningSide:S,matchUpStatus:oEe,matchUpFormat:e,score:t.trim()}:{isValid:!1,sets:b,scoreObject:I,error:`Incomplete match - need ${T} sets to win`}}catch(o){return{isValid:!1,sets:[],error:o instanceof Error?o.message:"Invalid score format"}}}function lrt(t,e,i){if(!t||t.length===0)return{isValid:!1,sets:[],error:"At least one set is required"};if(t.filter(h=>{const f=h.side1!==void 0&&h.side2!==void 0,m=h.side1TiebreakScore!==void 0&&h.side2TiebreakScore!==void 0;return!f&&!m}).length>0&&!i)return{isValid:!1,sets:[],error:"All sets must have scores for both sides"};const n=[];let a=!1;const s=e?.match(/SET(\d+)/)?.[1],o=s?Number.parseInt(s):3;for(let h=0;h<t.length;h++){const f={side1Score:t[h].side1,side2Score:t[h].side2,side1TiebreakScore:t[h].side1TiebreakScore,side2TiebreakScore:t[h].side2TiebreakScore},m=h+1===o,g=t[h].winningSide!==void 0;if(cG(f,e,m,i||!g).isValid){let b=t[h].winningSide;if(b===void 0&&cG(f,e,m,!1).isValid){const w=t[h].side1TiebreakScore!==void 0&&t[h].side2TiebreakScore!==void 0,T=w?t[h].side1TiebreakScore||0:t[h].side1||0,S=w?t[h].side2TiebreakScore||0:t[h].side2||0;T>S?b=1:S>T&&(b=2)}n.push({...f,winningSide:b})}else a=!0,n.push({...f,winningSide:void 0})}if(a&&!i)return{isValid:!1,sets:n,error:"One or more sets have invalid scores"};const l=Math.ceil(o/2),c={side1:0,side2:0};n.forEach(h=>{h.winningSide===1?c.side1++:h.winningSide===2&&c.side2++});let u;if(c.side1>=l?u=1:c.side2>=l&&(u=2),u!==void 0&&!i){let h=0,f=0,m=-1;for(let g=0;g<n.length;g++){const v=n[g];if(v.winningSide===1?h++:v.winningSide===2&&f++,m===-1&&(h>=l||f>=l)&&(m=g),m!==-1&&g>m&&v.winningSide!==void 0)return{isValid:!1,sets:n,error:`Unnecessary set ${g+1}: match was already decided after set ${m+1}`}}}const d=t.map(h=>{const f=h.side1!==void 0&&h.side2!==void 0,m=h.side1TiebreakScore!==void 0&&h.side2TiebreakScore!==void 0;if(!f&&m)return`[${h.side1TiebreakScore}-${h.side2TiebreakScore}]`;{let v=`${h.side1}-${h.side2}`;if(m){const y=Math.min(h.side1TiebreakScore||0,h.side2TiebreakScore||0);v+=`(${y})`}return v}}).join(" "),p=tI(d,e);return{isValid:u!==void 0,sets:n,scoreObject:p.scoreObject,winningSide:u,matchUpStatus:u?oEe:void 0,matchUpFormat:e,score:d}}function lEe(t,e){if(!t)return"";const r=(t.sets||[]).map(n=>{let a=`${n.side1Score||0}-${n.side2Score||0}`;if(n.side1TiebreakScore!==void 0||n.side2TiebreakScore!==void 0){const s=n.winningSide===1?n.side2TiebreakScore:n.side1TiebreakScore;a+=`(${s})`}return a}).join(" ");if(e&&e!=="COMPLETED"&&e!=="TO_BE_PLAYED"){const n=crt(e);if(n)return r?`${r} ${n}`:n}return r}function crt(t){return{RETIRED:"ret",WALKOVER:"wo",DEFAULTED:"def",SUSPENDED:"susp",CANCELLED:"canc",INCOMPLETE:"inc",DEAD_RUBBER:"dr",IN_PROGRESS:"in",AWAITING_RESULT:"await"}[t]||""}const{RETIRED:JJ,WALKOVER:QJ,DEFAULTED:eQ}=Kh;function urt(t){const{matchUp:e,container:i,onScoreChange:r}=t;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=ai.scales[ai.activeScale],a=e?.sides?.find(C=>C.sideNumber===1),s=e?.sides?.find(C=>C.sideNumber===2),o=document.createElement("div");o.style.marginBottom="0.5em",i.appendChild(o);const l=document.createElement("div");l.style.display="none",l.style.marginTop="0.25em",l.style.padding="0.5em",l.style.backgroundColor="#f5f5f5",l.style.borderRadius="4px",l.style.flexDirection="column",l.style.gap="0.5em";const c=document.createElement("label");c.style.display="flex",c.style.alignItems="center",c.style.gap="0.5em",c.style.cursor="pointer";const u=document.createElement("input");u.type="radio",u.name="winnerSelection",u.value="1";const d=document.createElement("span");d.textContent=a?.participant?.participantName||"Side 1",d.style.fontSize="0.85em",c.appendChild(u),c.appendChild(d);const p=document.createElement("label");p.style.display="flex",p.style.alignItems="center",p.style.gap="0.5em",p.style.cursor="pointer";const h=document.createElement("input");h.type="radio",h.name="winnerSelection",h.value="2";const f=document.createElement("span");f.textContent=s?.participant?.participantName||"Side 2",f.style.fontSize="0.85em",p.appendChild(h),p.appendChild(f),l.appendChild(c),l.appendChild(p),i.appendChild(l);const m=C=>{const E={...e,score:C?.clearAll?void 0:C?.scoreObject||e.score,winningSide:C?.clearAll?void 0:C?.winningSide,matchUpStatus:C?.clearAll?void 0:C?.matchUpStatus||e.matchUpStatus};o.innerHTML="";const P=Hw({matchUp:E,isLucky:!0,composition:{configuration:{participantDetail:"TEAM",genderColor:!0,scaleAttributes:n,flag:!1}}});o.appendChild(P)};if(m(),e.matchUpFormat){const C=document.createElement("div");C.style.fontSize="0.9em",C.style.marginBottom="0.5em",C.style.display="flex",C.style.alignItems="center",C.style.gap="0.5em";const E=document.createElement("span");E.textContent="Format:",E.style.color="#666",C.appendChild(E);const P=document.createElement("button");P.textContent=e.matchUpFormat,P.className="button",P.style.fontSize="0.75em",P.style.padding="0.2em 0.5em",P.style.cursor="pointer",P.title="Click to edit format",P.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:R}=await l2(async()=>{const{getMatchUpFormatModal:M}=await Promise.resolve().then(()=>ZF);return{getMatchUpFormatModal:M}},void 0,import.meta.url);R({existingMatchUpFormat:e.matchUpFormat,callback:M=>{if(M&&M!==e.matchUpFormat){e.matchUpFormat=M,P.textContent=M;const A=document.getElementById("scoreInputV2");A&&(A.value="",A.dispatchEvent(new Event("input",{bubbles:!0}))),w.textContent="Score cleared - format changed",w.style.color="#999"}},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(R){console.error("[TidyScore] Error opening format selector:",R)}}),C.appendChild(P),i.appendChild(C)}const g=document.createElement("div");g.style.fontSize="0.9em",g.style.color="#666",g.style.marginBottom="0.5em",g.innerHTML='Enter score (e.g., 6-3 6-4)<br><small style="color: #999;">For irregular endings, add RET/WO/DEF at end, then select winner</small>',i.appendChild(g);const v=document.createElement("div");v.style.display="flex",v.style.alignItems="center",v.style.gap="0.5em";const y=document.createElement("input");y.type="text",y.className="input",y.placeholder="6-3 3-6 6-4",y.style.flex="1",y.id="scoreInputV2";const b=document.createElement("span");b.style.fontSize="1.2em",b.style.minWidth="1.5em",v.appendChild(y),v.appendChild(b),i.appendChild(v);const I=document.createElement("div");I.style.fontSize="0.9em",I.style.color="#0066cc",I.style.fontFamily="monospace",I.style.minHeight="1.5em",I.style.padding="0.25em",i.appendChild(I);const w=document.createElement("div");w.style.fontSize="0.9em",w.style.minHeight="1.5em",i.appendChild(w);let T=e.winningSide;const S=()=>{u.checked?(T=1,c.style.fontWeight="bold",c.style.color="#22c55e",p.style.fontWeight="",p.style.color=""):h.checked&&(T=2,p.style.fontWeight="bold",p.style.color="#22c55e",c.style.fontWeight="",c.style.color=""),D()};u.addEventListener("change",S),h.addEventListener("change",S);const D=()=>{const C=y.value.trim();if(!C){b.textContent="",I.textContent="",w.textContent="",w.style.color="",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,m({clearAll:!0}),r({isValid:!1,sets:[]});return}const E=ort(C);if(E.error){b.textContent="",b.style.color="red",I.textContent="",w.textContent=E.error,w.style.color="red",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,r({isValid:!1,sets:[],error:E.error});return}E.tidyScore?I.textContent=E.tidyScore:I.textContent="";const P=[JJ,QJ,eQ].includes(E.matchUpStatus||""),R=tI(E.tidyScore||C,e.matchUpFormat,E.matchUpStatus),M=R.sets&&R.sets.length>0;if(P||R.isValid){b.textContent="",b.style.color="green";let A="Valid score";E.matchUpStatus===JJ?A="Valid score - RETIRED":E.matchUpStatus===QJ?A="Valid score - WALKOVER":E.matchUpStatus===eQ&&(A="Valid score - DEFAULTED"),w.textContent=A,w.style.color="green";let N;if(P){if(l.style.display="flex",N=T,!N){m({scoreObject:R.scoreObject,matchUpStatus:E.matchUpStatus}),r({...R,isValid:!1,error:"Winner must be selected for irregular ending",matchUpStatus:E.matchUpStatus,score:E.tidyScore||C});return}}else l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,N=R.winningSide;m({scoreObject:R.scoreObject,winningSide:N,matchUpStatus:E.matchUpStatus||R.matchUpStatus}),r({...R,isValid:!0,winningSide:N,matchUpStatus:E.matchUpStatus||R.matchUpStatus,score:E.tidyScore||C})}else M&&R.scoreObject?(b.textContent="",b.style.color="orange",w.textContent=R.error||"Incomplete score",w.style.color="orange",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,m({scoreObject:R.scoreObject}),r(R)):(b.textContent="",b.style.color="red",w.textContent=R.error||"Invalid score",w.style.color="red",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,m(),r(R))};if(y.addEventListener("input",D),y.addEventListener("keyup",C=>{if(C.key==="Enter"){const E=document.getElementById("submitScoreV2");E&&!E.disabled&&E.click()}}),e.score){const C=lEe(e.score,e.matchUpStatus);y.value=C}e.winningSide===1?(u.checked=!0,c.style.fontWeight="bold",c.style.color="#22c55e"):e.winningSide===2&&(h.checked=!0,p.style.fontWeight="bold",p.style.color="#22c55e"),setTimeout(()=>{y.focus(),y.value&&D()},100)}const{RETIRED:drt,WALKOVER:cEe,DEFAULTED:prt,SUSPENDED:hrt,CANCELLED:uEe,INCOMPLETE:frt,DEAD_RUBBER:dEe,IN_PROGRESS:mrt,AWAITING_RESULT:grt}=Kh;function vrt(t,e){const i=t.substring(e).trim().toLowerCase();return/^in(\s+p(rog(ress)?)?)?$/i.exec(i)?{ending:mrt,endPos:t.length}:/^inc(omp(lete?)?)?/i.exec(i)?{ending:frt,endPos:t.length}:/^(dr|dead(\s*r(ubber)?)?)/i.exec(i)?{ending:dEe,endPos:t.length}:/^r(et(ired?)?)?/i.exec(i)?{ending:drt,endPos:t.length}:/^(w(\/o|o|alk(over?)?)?)/i.exec(i)?{ending:cEe,endPos:t.length}:/^d(ef(aulted?)?)?/i.exec(i)?{ending:prt,endPos:t.length}:/^s(usp(ended?)?)?/i.exec(i)?{ending:hrt,endPos:t.length}:/^c(anc(ell?ed?)?)?/i.exec(i)?{ending:uEe,endPos:t.length}:/^a(wait(ing(\s*r(esult)?)?)?)?/i.exec(i)?{ending:grt,endPos:t.length}:{endPos:e}}function ZD(t,e){const i=t.bestOf||3;return e===i-1&&t.finalSetFormat?t.finalSetFormat:t.setFormat}function J0(t){return!!t?.tiebreakSet?.tiebreakTo&&!t?.setTo}function yrt(t){return J0(t)?0:(t?.setTo||6)+1}function pEe(t){const e=t?.tiebreakSet,i=t?.tiebreakFormat;return e?e.tiebreakTo||10:i&&i.tiebreakTo||7}function bU(t){return/^\d$/.test(t)}function brt(t){return!bU(t)&&!uG(t)&&!dG(t)}function uG(t){return t==="("||t==="["}function dG(t){return t===")"||t==="]"}function hEe(t,e,i){const r=i?.tiebreakAt||i?.setTo||6;return t===r&&e===r}function Irt(t,e,i){const r=i?.setTo||6,n=Math.max(t,e),a=Math.min(t,e);return n<r?!1:n-a>=2?!0:(n>r+1,!1)}function wrt(t,e,i){const r=pEe(i),n=Math.max(t,e),a=Math.min(t,e);return i?.tiebreakSet?.NoAD||i?.tiebreakFormat?.NoAD?n>=r:n<r?!1:n-a>=2}function tQ(t,e){const i=typeof e=="string"?Zf.parse(e):e;if(!i)return{valid:!1,formattedScore:"",sets:[],confidence:0,errors:[{position:0,message:"Invalid matchUpFormat"}],warnings:[],ambiguities:[],suggestions:[],incomplete:!1,matchComplete:!1};const r={input:t,position:0,setIndex:0,currentSide1Buffer:"",currentSide2Buffer:"",currentTiebreakSide1Buffer:"",currentTiebreakSide2Buffer:"",sets:[],parsedFormat:i,state:"START",inTiebreak:!1,expectingTiebreakOnly:!1,isValid:!0,errors:[],warnings:[],confidence:1,ambiguities:[],suggestions:[]},n=ZD(i,0);for(J0(n)?(r.expectingTiebreakOnly=!0,r.inTiebreak=!0,r.state="PARSING_TIEBREAK_SIDE1"):r.state="PARSING_SIDE1";r.position<t.length&&r.isValid;)Srt(r);Lrt(r);let a=r.sets,s;r.irregularEnding&&(s=r.irregularEnding,(r.irregularEnding===cEe||r.irregularEnding===uEe||r.irregularEnding===dEe)&&(a=[]));const o=r.irregularEnding?!1:Frt(r),l=Brt(r);return{valid:r.isValid&&r.errors.length===0,formattedScore:l,sets:a,confidence:r.confidence,errors:r.errors,warnings:r.warnings,ambiguities:r.ambiguities,suggestions:r.suggestions,incomplete:!o&&a.length>0,matchComplete:o,matchUpStatus:s}}function Srt(t){const e=t.input[t.position];if(!bU(e)&&!uG(e)&&!dG(e)){const i=vrt(t.input,t.position);if(i.ending){t.irregularEnding=i.ending,t.irregularEndingPosition=t.position,t.position=i.endPos;return}}if(brt(e)){Trt(t);return}if(uG(e)){Urt(t);return}if(dG(e)){Drt(t);return}if(bU(e)){Ert(t,e);return}t.errors.push({position:t.position,message:`Unexpected character '${e}'`,got:e,context:$rt(t)}),t.isValid=!1}function Trt(t){if(t.state==="PARSING_SIDE1"&&t.currentSide1Buffer){t.state="PARSING_SIDE2",t.position++;return}if(t.state==="PARSING_SIDE2"&&t.currentSide2Buffer){const e=Number.parseInt(t.currentSide1Buffer),i=Number.parseInt(t.currentSide2Buffer),r=ZD(t.parsedFormat,t.setIndex);if(y9(e,i,r)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}IU(t),t.position++;return}if(t.state==="PARSING_TIEBREAK_SIDE1"&&t.currentTiebreakSide1Buffer)if(t.currentSide1Buffer&&t.currentSide2Buffer){IU(t),t.position++;return}else{t.state="PARSING_TIEBREAK_SIDE2",t.position++;return}t.position++}function Urt(t){const e=ZD(t.parsedFormat,t.setIndex);if(J0(e)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}if(t.currentSide1Buffer&&t.currentSide2Buffer){const r=Number.parseInt(t.currentSide1Buffer),n=Number.parseInt(t.currentSide2Buffer);if(hEe(r,n,e)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}}t.warnings.push(`Tiebreak indicator at position ${t.position} may be ambiguous`),t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++}function Drt(t){if(t.inTiebreak){xrt(t),t.inTiebreak=!1,t.position++;return}t.warnings.push(`Unexpected tiebreak closer at position ${t.position}`),t.position++}function Ert(t,e){const i=ZD(t.parsedFormat,t.setIndex);t.inTiebreak?Mrt(t,e,i):Prt(t,e,i)}function Prt(t,e,i){const r=yrt(i);if(t.state==="PARSING_SIDE1"||t.state==="START"){t.state="PARSING_SIDE1",t.currentSide1Buffer+=e;const n=Number.parseInt(t.currentSide1Buffer),a=t.position+1;if(a<t.input.length&&bU(t.input[a])){const s=t.input[a];Number.parseInt(t.currentSide1Buffer+s)>r&&(t.warnings.push(`Potential score issue: "${t.currentSide1Buffer}${s}" would exceed max game score ${r}`),t.state="PARSING_SIDE2")}else t.state="PARSING_SIDE2";n>r&&t.warnings.push(`Score ${n} exceeds max ${r} at position ${t.position}`),t.position++;return}if(t.state==="PARSING_SIDE2"){t.currentSide2Buffer+=e;const n=Number.parseInt(t.currentSide1Buffer),a=Number.parseInt(t.currentSide2Buffer);if(y9(n,a,i)){t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1",t.position++;return}const s=t.position+1;if(s<t.input.length&&bU(t.input[s])){const o=t.input[s];Number.parseInt(t.currentSide2Buffer+o)>r&&(Irt(n,a,i)||hEe(n,a,i)||t.warnings.push(`Set ${t.setIndex+1} may be incomplete: ${n}-${a}`),IU(t))}else s>=t.input.length;t.position++;return}t.position++}function Crt(t,e){t.currentTiebreakSide1Buffer+=e,t.position++}function Rrt(t,e,i){t.currentTiebreakSide2Buffer+=e;const r=Number.parseInt(t.currentTiebreakSide2Buffer),n=t.position+1;if(n<t.input.length&&bU(t.input[n])){const a=t.input[n],s=Number.parseInt(t.currentTiebreakSide2Buffer+a),o=Number.parseInt(t.currentTiebreakSide1Buffer);if(s>999){const u=r;wrt(o,u,i)||t.warnings.push(`Tiebreak may be incomplete: ${o}-${u}`),IU(t)}}t.position++}function Mrt(t,e,i){if(t.state==="PARSING_TIEBREAK_SIDE1"){Crt(t,e);return}if(t.state==="PARSING_TIEBREAK_SIDE2"){Rrt(t,e,i);return}t.position++}function Nrt(t){if(!t.currentTiebreakSide1Buffer||!t.currentTiebreakSide2Buffer)return null;const e=Number.parseInt(t.currentTiebreakSide1Buffer),i=Number.parseInt(t.currentTiebreakSide2Buffer);return{side1Score:0,side2Score:0,side1TiebreakScore:e,side2TiebreakScore:i,setNumber:t.setIndex+1,winningSide:e>i?1:2}}function Art(t,e,i){const r=e.currentTiebreakSide1Buffer,n=e.currentTiebreakSide2Buffer;r&&n?(t.side1TiebreakScore=Number.parseInt(r),t.side2TiebreakScore=Number.parseInt(n)):(r||n)&&_rt(t,r,n,i)}function _rt(t,e,i,r){const n=Number.parseInt(e||i),a=pEe(r),o=r?.tiebreakFormat?.NoAD?a:Math.max(a,n+2);t.side1Score>t.side2Score?(t.side1TiebreakScore=o,t.side2TiebreakScore=n):(t.side1TiebreakScore=n,t.side2TiebreakScore=o)}function y9(t,e,i){const r=i.tiebreakAt||i.setTo||6;return t===r&&e===r+1||e===r&&t===r+1}function krt(t,e){if(!t.currentSide1Buffer||!t.currentSide2Buffer)return null;const i=Number.parseInt(t.currentSide1Buffer),r=Number.parseInt(t.currentSide2Buffer);if(y9(i,r,e)&&!t.currentTiebreakSide1Buffer&&!t.currentTiebreakSide2Buffer)return null;const n={side1Score:i,side2Score:r,setNumber:t.setIndex+1};return(t.currentTiebreakSide1Buffer||t.currentTiebreakSide2Buffer)&&Art(n,t,e),i>r?n.winningSide=1:r>i&&(n.winningSide=2),n}function Ort(t){t.currentSide1Buffer="",t.currentSide2Buffer="",t.currentTiebreakSide1Buffer="",t.currentTiebreakSide2Buffer="",t.setIndex++,t.inTiebreak=!1,t.state="PARSING_SIDE1";const e=ZD(t.parsedFormat,t.setIndex);J0(e)&&(t.expectingTiebreakOnly=!0,t.inTiebreak=!0,t.state="PARSING_TIEBREAK_SIDE1")}function IU(t){const e=ZD(t.parsedFormat,t.setIndex),i=J0(e);let r=null;i?r=Nrt(t):r=krt(t,e),r&&t.sets.push(r),Ort(t)}function xrt(t){IU(t)}function Lrt(t){(t.currentSide1Buffer||t.currentSide2Buffer||t.currentTiebreakSide1Buffer||t.currentTiebreakSide2Buffer)&&IU(t)}function Frt(t){const e=t.parsedFormat.bestOf||3,i=Math.ceil(e/2),r=t.sets.filter(a=>a.winningSide===1).length,n=t.sets.filter(a=>a.winningSide===2).length;return r>=i||n>=i}function Brt(t){const e=[];for(const i of t.sets)if((!i.side1Score||i.side1Score===0)&&(!i.side2Score||i.side2Score===0)&&(i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0)){const n=i.side1TiebreakScore??0,a=i.side2TiebreakScore??0;e.push(`[${n}-${a}]`)}else{let n=`${i.side1Score||0}-${i.side2Score||0}`;if(i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0){const a=i.side1TiebreakScore??0,s=i.side2TiebreakScore??0,o=i.winningSide===1?s:a;n+=`(${o})`}e.push(n)}return e.join(" ")}function $rt(t){const e=Math.max(0,t.position-5),i=Math.min(t.input.length,t.position+5),r=t.input.substring(e,t.position),n=t.input.substring(t.position+1,i);return`...${r}[${t.input[t.position]}]${n}...`}const{RETIRED:jB,WALKOVER:GB,DEFAULTED:HB,SUSPENDED:zB,CANCELLED:qB,INCOMPLETE:WB,DEAD_RUBBER:YB,IN_PROGRESS:KB,AWAITING_RESULT:ZB}=Kh;function Vrt(t){const{matchUp:e,container:i,onScoreChange:r}=t;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=ai.scales[ai.activeScale],a=e?.sides?.find(E=>E.sideNumber===1),s=e?.sides?.find(E=>E.sideNumber===2),o=document.createElement("div");o.style.marginBottom="0.25em",i.appendChild(o);const l=document.createElement("div");l.style.display="none",l.style.marginTop="0.25em",l.style.padding="0.35em 0.5em",l.style.backgroundColor="#f5f5f5",l.style.borderRadius="4px",l.style.flexDirection="column",l.style.gap="0.35em";const c=document.createElement("label");c.style.display="flex",c.style.alignItems="center",c.style.gap="0.4em",c.style.cursor="pointer";const u=document.createElement("input");u.type="radio",u.name="winnerSelection",u.value="1";const d=document.createElement("span");d.textContent=a?.participant?.participantName||"Side 1",d.style.fontSize="0.75em",c.appendChild(u),c.appendChild(d);const p=document.createElement("label");p.style.display="flex",p.style.alignItems="center",p.style.gap="0.4em",p.style.cursor="pointer";const h=document.createElement("input");h.type="radio",h.name="winnerSelection",h.value="2";const f=document.createElement("span");f.textContent=s?.participant?.participantName||"Side 2",f.style.fontSize="0.75em",p.appendChild(h),p.appendChild(f),l.appendChild(c),l.appendChild(p),i.appendChild(l);const m=E=>{const{WALKOVER:P,CANCELLED:R,DEAD_RUBBER:M}=Kh,A=[P,R,M],N=E?.matchUpStatus&&A.includes(E.matchUpStatus);let k;E?.clearAll||N?k=void 0:k=E?.scoreObject||e.score;const x={...e,score:k,winningSide:E?.clearAll?void 0:E?.winningSide,matchUpStatus:E?.clearAll?void 0:E?.matchUpStatus||e.matchUpStatus};o.innerHTML="";const O=Hw({matchUp:x,isLucky:!0,composition:{configuration:{participantDetail:"TEAM",genderColor:!0,scaleAttributes:n,flag:!1}}});o.appendChild(O)};if(m(),e.matchUpFormat){const E=document.createElement("div");E.style.fontSize="0.9em",E.style.marginBottom="0.5em",E.style.display="flex",E.style.alignItems="center",E.style.gap="0.5em";const P=document.createElement("span");P.textContent="Format:",P.style.color="#666",E.appendChild(P);const R=document.createElement("button");R.textContent=e.matchUpFormat,R.className="button",R.style.fontSize="0.75em",R.style.padding="0.2em 0.5em",R.style.cursor="pointer",R.title="Click to edit format",R.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:M}=await l2(async()=>{const{getMatchUpFormatModal:A}=await Promise.resolve().then(()=>ZF);return{getMatchUpFormatModal:A}},void 0,import.meta.url);M({existingMatchUpFormat:e.matchUpFormat,callback:A=>{if(A&&A!==e.matchUpFormat){e.matchUpFormat=A,R.textContent=A;const N=document.getElementById("scoreInputV2");N&&(N.value="",N.dispatchEvent(new Event("input",{bubbles:!0}))),w.textContent="Score cleared - format changed",w.style.color="#999"}},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(M){console.error("[FreeScore] Error opening format selector:",M)}}),E.appendChild(R),i.appendChild(E)}const g=document.createElement("div");g.style.fontSize="0.9em",g.style.color="#666",g.style.marginBottom="0.5em",g.innerHTML='<small style="color: #999;">Tiebreaks auto-detected: "67 3"  "6-7(3)".<br> Match tiebreaks use dash: "10-7".<br> Irregular: r/w/s/c/a (ret/wo/def/susp/canc/await) or "in"/"inc"/"dr".</small>',i.appendChild(g);const v=document.createElement("div");v.style.display="flex",v.style.alignItems="center",v.style.gap="0.5em";const y=document.createElement("input");if(y.type="text",y.className="input",y.placeholder="6-3 3-6 6-4",y.style.flex="1",y.id="scoreInputV2",e.score){const E=lEe(e.score,e.matchUpStatus);y.value=E}const b=document.createElement("span");b.style.fontSize="1.2em",b.style.minWidth="1.5em",v.appendChild(y),v.appendChild(b),i.appendChild(v);const I=document.createElement("div");I.style.fontSize="0.9em",I.style.color="#0066cc",I.style.fontFamily="monospace",I.style.minHeight="1.5em",I.style.padding="0.25em",i.appendChild(I);const w=document.createElement("div");w.style.fontSize="0.9em",w.style.minHeight="1.5em",i.appendChild(w);let T=e.winningSide;const S=()=>{u.checked?(T=1,c.style.fontWeight="bold",c.style.color="#22c55e",p.style.fontWeight="",p.style.color=""):h.checked&&(T=2,p.style.fontWeight="bold",p.style.color="#22c55e",c.style.fontWeight="",c.style.color=""),D()};u.addEventListener("change",S),h.addEventListener("change",S);const D=()=>{const E=y.value.trim();if(!E){b.textContent="",I.textContent="",w.textContent="",w.style.color="",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,m({clearAll:!0}),r({isValid:!1,sets:[]});return}const P=tQ(E,e.matchUpFormat);P.formattedScore?I.textContent=P.formattedScore:I.textContent="";const R=P.matchUpStatus&&[jB,GB,HB,zB,qB,WB,YB,KB,ZB].includes(P.matchUpStatus),M=P.formattedScore?tI(P.formattedScore,e.matchUpFormat,P.matchUpStatus):{isValid:!1,sets:[],error:"No score to validate"},A=M.sets&&M.sets.length>0,N=T||M.winningSide;if(A&&M.scoreObject?m({scoreObject:M.scoreObject,winningSide:N,matchUpStatus:M.matchUpStatus||P.matchUpStatus}):R&&m({scoreObject:M.scoreObject,winningSide:N,matchUpStatus:M.matchUpStatus||P.matchUpStatus}),M.isValid||R){b.textContent="",b.style.color="green";let x="Valid score";M.matchUpStatus===jB?x="Valid score - RETIRED":M.matchUpStatus===GB?x="Valid score - WALKOVER":M.matchUpStatus===HB?x="Valid score - DEFAULTED":M.matchUpStatus===zB?x="Valid score - SUSPENDED":M.matchUpStatus===qB?x="Valid score - CANCELLED":M.matchUpStatus===WB?x="Valid score - INCOMPLETE":M.matchUpStatus===YB?x="Valid score - DEAD RUBBER":M.matchUpStatus===KB?x="Valid score - IN PROGRESS":M.matchUpStatus===ZB&&(x="Valid score - AWAITING RESULT"),w.textContent=x,w.style.color="green";let O;const V=R&&[jB,GB,HB].includes(M.matchUpStatus||P.matchUpStatus),F=R&&[qB,YB,ZB,WB,KB,zB].includes(M.matchUpStatus||P.matchUpStatus);if(V){if(l.style.display="flex",O=T,!O){r({...M,isValid:!1,error:"Winner must be selected for irregular ending",matchUpStatus:M.matchUpStatus||P.matchUpStatus,score:P.formattedScore||E});return}}else F?(l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,O=void 0):(l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,O=M.winningSide);r({...M,isValid:!0,winningSide:O,matchUpStatus:M.matchUpStatus||P.matchUpStatus,score:P.formattedScore||E})}else!M.isValid&&A?(b.textContent="",b.style.color="orange",w.textContent=M.error||"Score incomplete - continue typing",w.style.color="orange",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,r(M)):(b.textContent="",b.style.color="red",w.textContent=M.error||"Invalid score",w.style.color="red",l.style.display="none",u.checked=!1,h.checked=!1,c.style.fontWeight="",c.style.color="",p.style.fontWeight="",p.style.color="",T=void 0,m(),r(M))};let C=!1;y.addEventListener("input",()=>{D();const E=y.value,P=E.trim();if(!C&&P){const R=tQ(P,e.matchUpFormat),M=R.formattedScore?tI(R.formattedScore,e.matchUpFormat,R.matchUpStatus):{isValid:!1,winningSide:void 0},A=M.isValid&&M.winningSide!==void 0,N=E.length>0&&/[\s\-]$/.test(E);A&&N&&(C=!0)}else if(C){const R=E.length>0&&/[\s\-]$/.test(E);(P.length===0||!R)&&(C=!1)}}),y.addEventListener("keydown",E=>{C&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(E.key)&&E.preventDefault()}),y.addEventListener("keyup",E=>{if(E.key==="Enter"){const P=document.getElementById("submitScoreV2");P&&!P.disabled&&P.click()}}),e.winningSide===1?(u.checked=!0,c.style.fontWeight="bold",c.style.color="#22c55e"):e.winningSide===2&&(h.checked=!0,p.style.fontWeight="bold",p.style.color="#22c55e"),setTimeout(()=>{y.focus(),y.value&&D()},100)}function fEe(t){if(!t)return{bestOf:3,setsToWin:2};const e=t.match(/SET(\d+)/),i=e?parseInt(e[1],10):3,r=Math.ceil(i/2);return{bestOf:i,setsToWin:r}}function jrt(t,e){if(!t||t.length===0)return!0;const{bestOf:i,setsToWin:r}=fEe(e),n={side1:0,side2:0};return t.forEach(s=>{const o=s.side1Score??0,l=s.side2Score??0;o>l?n.side1++:l>o&&n.side2++}),n.side1>=r||n.side2>=r||t.length>=i?!1:t.every(s=>s.side1Score!==void 0&&s.side2Score!==void 0&&s.side1Score!==null&&s.side2Score!==null)}const mEe="tmx_settings";function b9(){try{const t=localStorage.getItem(mEe);return t?JSON.parse(t):null}catch(t){return console.error("Error loading settings from localStorage:",t),null}}function Grt(t){try{localStorage.setItem(mEe,JSON.stringify(t))}catch(e){console.error("Error saving settings to localStorage:",e)}}function XD(t,e){return(e.bestOf===1||t+1===e.bestOf)&&e.finalSetFormat?e.finalSetFormat:e.setFormat}function c2(t){return t?.tiebreakSet?.tiebreakTo!==void 0}function Hrt(t,e,i,r){const n=XD(t,r),a=n?.setTo||6,s=n?.tiebreakAt||a,o=e===1?i.side2:i.side1;return o===0?a+2:o<a-1?a:o===a-1?a+1:o===a?a+2:o>=s?o+2:a+2}function gEe(t,e,i){const r=XD(t,i);if(c2(r))return e.side1>0&&e.side2>0&&e.side1!==e.side2;const n=r?.setTo||6,a=r?.tiebreakAt||n,s=Math.max(e.side1,e.side2),o=Math.min(e.side1,e.side2),l=Math.abs(e.side1-e.side2);return s>=n&&l>=2||s===a+1&&o===a&&e.tiebreak!==void 0}function zrt(t,e,i){if(gEe(t,e,i)){if(e.side1>e.side2)return 1;if(e.side2>e.side1)return 2}}function kS(t,e){const i=Math.ceil(e/2),r=t.filter(a=>a.winningSide===1).length,n=t.filter(a=>a.winningSide===2).length;return r>=i||n>=i}function qrt(t,e){const i=e?.setTo||6,r=e?.tiebreakAt||i;return t>=i?null:t===r-1&&r<i?r+1:t<i-1?i:i+1}function Wrt(t,e,i,r,n,a,s){if(!s)return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Feature disabled in settings"};if(a.has(i))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Already used for this set"};if(kS(r,n.bestOf))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Match already complete"};const o=XD(i,n);if(c2(o))return{field1Value:t,field2Value:0,shouldApply:!1,reason:"Tiebreak-only set"};const l=qrt(t,o);return l===null?{field1Value:t,field2Value:0,shouldApply:!1,reason:"No predictable complement for this digit"}:e?{field1Value:l,field2Value:t,shouldApply:!0}:{field1Value:t,field2Value:l,shouldApply:!0}}function Yrt(t,e,i){const r=XD(t,i);if(c2(r))return!1;const n=r?.tiebreakAt||r?.setTo||6,a=Math.max(e.side1,e.side2),s=Math.min(e.side1,e.side2);return a===n+1&&s===n}function Krt(t,e,i,r,n){const a=Number.parseInt(e)||0,s=Number.parseInt(i)||0,o=r?Number.parseInt(r):void 0,l=XD(t,n);if(c2(l)){const p=a>0&&s>0&&a!==s?a>s?1:2:void 0;return{side1Score:0,side2Score:0,side1TiebreakScore:a,side2TiebreakScore:s,winningSide:p}}const u=zrt(t,{side1:a,side2:s,tiebreak:o},n),d={side1Score:a,side2Score:s,winningSide:u};if(o!==void 0){const p=l?.tiebreakFormat?.tiebreakTo||7,h=l?.tiebreakFormat?.noAd;let f;o<p-1?f=p:f=h?o+1:o+2,a>s?(d.side1TiebreakScore=f,d.side2TiebreakScore=o):(d.side1TiebreakScore=o,d.side2TiebreakScore=f)}return d}const{COMPLETED:Wp,RETIRED:iQ,WALKOVER:XB,DEFAULTED:rQ}=Kh;function Zrt(t){const{matchUp:e,container:i,onScoreChange:r}=t;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=ai.scales[ai.activeScale];let a=e.matchUpFormat||"SET3-S:6/TB7";const s=()=>{const q=fEe(a),W=Zf.parse(a);return{bestOf:q.bestOf,setFormat:W?.setFormat,finalSetFormat:W?.finalSetFormat}};let o=s();const l=()=>o.bestOf,c=q=>XD(q,o),u=document.createElement("div");if(u.style.marginBottom="0.5em",i.appendChild(u),e.matchUpFormat){const q=document.createElement("div");q.style.fontSize="0.9em",q.style.marginBottom="0.5em",q.style.display="flex",q.style.alignItems="center",q.style.gap="0.5em";const W=document.createElement("span");W.textContent="Format:",W.style.color="#666",q.appendChild(W);const z=document.createElement("button");z.textContent=e.matchUpFormat,z.className="button",z.style.fontSize="0.75em",z.style.padding="0.2em 0.5em",z.style.cursor="pointer",z.title="Click to edit format",z.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:H}=await l2(async()=>{const{getMatchUpFormatModal:Z}=await Promise.resolve().then(()=>ZF);return{getMatchUpFormatModal:Z}},void 0,import.meta.url);H({existingMatchUpFormat:e.matchUpFormat,callback:Z=>{Z&&Z!==e.matchUpFormat&&(e.matchUpFormat=Z,a=Z,z.textContent=Z,o=s(),globalThis.resetDynamicSets&&globalThis.resetDynamicSets())},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(H){console.error("[DynamicSets] Error opening format selector:",H)}}),q.appendChild(z),i.appendChild(q)}let d=Wp,p;const h=new Set,f=document.createElement("div");f.style.marginBottom="0.8em";const m=document.createElement("div");m.textContent="Irregular Ending:",m.style.fontSize="0.75em",m.style.fontWeight="500",m.style.marginBottom="0.3em",m.style.color="#444",f.appendChild(m);const g=document.createElement("div");g.style.display="flex",g.style.gap="0.5em",g.style.flexWrap="wrap",[{value:iQ,label:"Retired"},{value:XB,label:"Walkover"},{value:rQ,label:"Defaulted"}].forEach(q=>{const W=document.createElement("label");W.style.display="flex",W.style.alignItems="center",W.style.gap="0.3em",W.style.cursor="pointer";const z=document.createElement("input");z.type="radio",z.name="matchOutcome",z.value=q.value,z.checked=!1,z.addEventListener("change",Z=>{if(d=Z.target.value,d===XB){D.querySelectorAll("input").forEach(K=>{K.value=""});const ie=D.querySelectorAll(".set-row");for(let K=ie.length-1;K>0;K--)ie[K].remove();C=[]}b.style.display="block",setTimeout(()=>{typeof A=="function"&&A()},0)});const H=document.createElement("span");H.textContent=q.label,H.style.fontSize="0.75em",W.appendChild(z),W.appendChild(H),g.appendChild(W)});const y=document.createElement("button");y.textContent="Clear",y.className="button",y.style.fontSize="0.7em",y.style.padding="0.2em 0.5em",y.addEventListener("click",()=>{f.querySelectorAll('input[name="matchOutcome"]').forEach(z=>z.checked=!1),d=Wp,p=void 0,b.style.display="none",f.querySelectorAll('input[name="irregularWinner"]').forEach(z=>z.checked=!1),setTimeout(()=>{typeof A=="function"&&A()},0)}),g.appendChild(y),f.appendChild(g);const b=document.createElement("div");b.style.display="none",b.style.marginTop="0.3em",b.style.paddingLeft="1em",b.style.borderLeft="3px solid #ffeb3b";const I=document.createElement("div");I.textContent="Winner:",I.style.fontSize="0.75em",I.style.fontWeight="500",I.style.marginBottom="0.2em",I.style.color="#444",b.appendChild(I);const w=document.createElement("div");w.style.display="flex",w.style.gap="0.5em";const T=e.sides?.[0],S=e.sides?.[1];[1,2].forEach(q=>{const W=document.createElement("label");W.style.display="flex",W.style.alignItems="center",W.style.gap="0.3em",W.style.cursor="pointer";const z=document.createElement("input");z.type="radio",z.name="irregularWinner",z.value=q.toString(),z.addEventListener("change",()=>{p=q,setTimeout(()=>{typeof A=="function"&&A()},0)});const H=document.createElement("span"),Z=q===1?T:S;H.textContent=Z?.participant?.participantName||`Side ${q}`,H.style.fontSize="0.75em",W.appendChild(z),W.appendChild(H),w.appendChild(W)}),b.appendChild(w),f.appendChild(b),i.appendChild(f);const D=document.createElement("div");D.style.display="flex",D.style.flexDirection="column",D.style.gap="0.5em",i.appendChild(D);let C=[];const E=()=>{D.innerHTML="",C=[],h.clear(),d=Wp,p=void 0,f.querySelectorAll('input[name="matchOutcome"]').forEach(J=>J.checked=!1),f.querySelectorAll('input[name="irregularWinner"]').forEach(J=>J.checked=!1),b.style.display="none";const z=R(0);D.appendChild(z),z.querySelectorAll("input").forEach(J=>{J.addEventListener("input",O),J.addEventListener("keydown",V)}),P({clearAll:!0}),r({isValid:!1,sets:[]});const Z=D.querySelector("input");Z&&Z.focus()};globalThis.resetDynamicSets=E;const P=q=>{u.innerHTML="";let W;q?.clearAll?W=void 0:q?.scoreObject?W=q.scoreObject:C.length>0?W={sets:C}:W=e.score;const z={...e,score:W,winningSide:q?.clearAll?void 0:q?.winningSide,matchUpStatus:q?.clearAll?void 0:q?.matchUpStatus},H=Hw({matchUp:z,isLucky:!0,composition:{configuration:{participantDetail:"TEAM",genderColor:!0,scaleAttributes:n,flag:!1}}});u.appendChild(H)},R=q=>{const W=document.createElement("div");W.className="set-row",W.style.display="flex",W.style.alignItems="center",W.style.gap="0.5em",W.style.marginBottom="0.25em";const z=document.createElement("div");z.textContent=`Set ${q+1}:`,z.style.width="3.5em",z.style.fontSize="0.9em",z.style.fontWeight="500",z.style.color="#444",W.appendChild(z);const H=document.createElement("input");H.type="text",H.className="input",H.style.width="3em",H.style.textAlign="center",H.placeholder="0",H.dataset.setIndex=q.toString(),H.dataset.side="1";const Z=document.createElement("input");Z.type="text",Z.className="input",Z.style.width="3em",Z.style.textAlign="center",Z.placeholder="0",Z.dataset.setIndex=q.toString(),Z.dataset.side="2";const J=document.createElement("span");J.textContent="-",J.style.fontWeight="bold",J.style.color="#666",W.appendChild(H),W.appendChild(J),W.appendChild(Z);const ie=document.createElement("span");ie.className="tiebreak-container",ie.style.display="none",ie.style.marginLeft="0.5em";const K=document.createElement("span");K.textContent="(",K.style.color="#666";const ne=document.createElement("input");ne.type="text",ne.className="input tiebreak-input",ne.style.width="2.5em",ne.style.textAlign="center",ne.dataset.setIndex=q.toString(),ne.dataset.type="tiebreak";const le=document.createElement("span");le.textContent=")",le.style.color="#666",ie.appendChild(K),ie.appendChild(ne),ie.appendChild(le),W.appendChild(ie);const re=document.createElement("span");return re.className="set-indicator",re.style.fontSize="1.2em",re.style.minWidth="1.5em",W.appendChild(re),W},M=q=>{const W=D.querySelector(`input[data-set-index="${q}"][data-side="1"]`),z=D.querySelector(`input[data-set-index="${q}"][data-side="2"]`),H=D.querySelector(`input[data-set-index="${q}"][data-type="tiebreak"]`);if(!W||!z)return!1;const Z=W.value.trim(),J=z.value.trim();if(Z===""||J==="")return!1;const ie=Number.parseInt(Z)||0,K=Number.parseInt(J)||0,ne=H?.value.trim()?Number.parseInt(H.value):void 0;return gEe(q,{side1:ie,side2:K,tiebreak:ne},o)},A=()=>{d===Wp&&(b.style.display="none");const q=[];for(let Z=0;Z<l();Z++){const J=D.querySelector(`input[data-set-index="${Z}"][data-side="1"]`),ie=D.querySelector(`input[data-set-index="${Z}"][data-side="2"]`),K=D.querySelector(`input[data-set-index="${Z}"][data-type="tiebreak"]`);if(!J||!ie)break;const ne=J.value.trim(),le=ie.value.trim();if(ne===""&&le==="")break;const re=K?.value.trim(),me=Krt(Z,ne,le,re,o);q.push(me)}C=q;const W=D.querySelectorAll(".set-row"),z=kS(C,l());let H;if(z){const Z=C.filter(J=>J.winningSide!==void 0).length;H=Math.max(1,Z)}else{const Z=C.length-1;Z>=0&&C[Z].winningSide!==void 0&&C.length<l()?H=C.length+1:H=Math.max(1,C.length)}for(let Z=W.length-1;Z>=H;Z--)W[Z].remove();if(C.length>0||d!==Wp){const Z=C.some(re=>re.winningSide===void 0),K=(d!==Wp||Z?C:C.filter(re=>re.winningSide!==void 0)).map(re=>{if(re.side1Score===0&&re.side2Score===0&&(re.side1TiebreakScore!==void 0||re.side2TiebreakScore!==void 0)){const he={side1TiebreakScore:re.side1TiebreakScore,side2TiebreakScore:re.side2TiebreakScore};return re.winningSide!==void 0&&(he.winningSide=re.winningSide),he}else{const he={side1:re.side1Score,side2:re.side2Score};return re.side1TiebreakScore!==void 0&&(he.side1TiebreakScore=re.side1TiebreakScore),re.side2TiebreakScore!==void 0&&(he.side2TiebreakScore=re.side2TiebreakScore),re.winningSide!==void 0&&(he.winningSide=re.winningSide),he}}),ne=lrt(K,e.matchUpFormat,d!==Wp),le=ne.isValid&&ne.winningSide!==void 0;d!==Wp?(f.style.display="block",b.style.display="block"):(b.style.display="none",le?f.style.display="none":f.style.display="block"),d!==Wp&&(ne.matchUpStatus=d,p?(ne.winningSide=p,ne.isValid=!0):ne.isValid=!1),P(ne),r(ne)}else f.style.display="block",P(),r({isValid:!1,sets:[]})},N=()=>{const q=document.getElementById("clearScoreV2");if(q){const W=D.querySelectorAll(".set-row"),z=D.querySelector('input[data-set-index="0"][data-side="1"]'),H=D.querySelector('input[data-set-index="0"][data-side="2"]'),Z=W.length>1||z?.value.trim()!==""||H?.value.trim()!=="";q.disabled=!Z}},k=q=>{const W=D.querySelector(`input[data-set-index="${q}"][data-side="1"]`),z=D.querySelector(`input[data-set-index="${q}"][data-side="2"]`),H=D.querySelector(`.set-row:nth-child(${q+1}) .tiebreak-container`),Z=D.querySelector(`input[data-set-index="${q}"][data-type="tiebreak"]`);if(!W||!z||!H)return;const J=Number.parseInt(W.value)||0,ie=Number.parseInt(z.value)||0;Yrt(q,{side1:J,side2:ie},o)?H.style.display="inline":(H.style.display="none",Z&&(Z.value=""))},x=(q,W)=>{const z=W==="1"?"2":"1",H=D.querySelector(`input[data-set-index="${q}"][data-side="${z}"]`),Z=D.querySelector(`input[data-set-index="${q}"][data-side="${W}"]`),J=Number.parseInt(Z?.value)||0,ie=Number.parseInt(H?.value)||0;return Hrt(q,W==="1"?1:2,{side1:W==="1"?J:ie,side2:W==="2"?J:ie},o)},O=q=>{const W=q.target,z=W.dataset.type==="tiebreak",H=W.value.replace(/\D/g,"");H!==W.value&&(W.value=H);const Z=Number.parseInt(W.dataset.setIndex||"0"),J=W.dataset.side||"1",K=c(Z)?.tiebreakSet?.tiebreakTo!==void 0;if(z)W.value.length>2&&(W.value=W.value.slice(0,2));else if(K)W.value.length>3&&(W.value=W.value.slice(0,3));else{const re=x(Z,J);(Number.parseInt(W.value)||0)>re&&(W.value=re.toString())}if(!z&&(k(Z),!K)){const le=J==="1"?"2":"1",re=D.querySelector(`input[data-set-index="${Z}"][data-side="${le}"]`);if(re?.value.trim()){const me=Number.parseInt(re.value)||0,he=x(Z,le);me>he&&(re.value=he.toString())}}if(A(),N(),M(Z)&&!kS(C,l())&&jrt(C,e.matchUpFormat)){const re=C.length,me=D.querySelector(`input[data-set-index="${re}"]`);if(re<l()&&!me){const he=R(re);D.appendChild(he),he.querySelectorAll("input").forEach(Le=>{Le.addEventListener("input",O),Le.addEventListener("keydown",V)}),N()}}},V=q=>{const W=q.target,z=Number.parseInt(W.dataset.setIndex||"0"),H=W.dataset.side||"1",Z=W.dataset.type==="tiebreak",ie=b9()?.smartComplements===!0;if(H==="1"&&!Z){const K=q.code.match(/^Digit(\d)$/);if(K){const ne=Number.parseInt(K[1]);if(W.value===""){const re=q.shiftKey,me=Wrt(ne,re,z,C,o,h,ie);if(me.shouldApply){q.preventDefault(),W.value=me.field1Value.toString();const he=D.querySelector(`input[data-set-index="${z}"][data-side="2"]`);he&&(he.value=me.field2Value.toString()),h.add(z),W.dispatchEvent(new Event("input",{bubbles:!0})),setTimeout(()=>{if(A(),kS(C,l()))return;const Le=D.querySelector(`input[data-set-index="${z+1}"][data-side="1"]`);if(Le)Le.focus();else if(z+1<l()){const ot=R(z+1);D.appendChild(ot);const at=ot.querySelectorAll("input");at.forEach(It=>{It.addEventListener("input",O),It.addEventListener("keydown",V)});const dt=at[0];dt instanceof HTMLInputElement&&dt.focus(),N()}},10);return}}}}if(q.key==="Tab"){if(q.preventDefault(),q.shiftKey){if(Z){const K=D.querySelector(`input[data-set-index="${z}"][data-side="2"]`);K&&K.focus()}else if(H==="2"){const K=D.querySelector(`input[data-set-index="${z}"][data-side="1"]`);K&&K.focus()}else if(z>0){const K=D.querySelector(`input[data-set-index="${z-1}"][data-type="tiebreak"]`),ne=D.querySelector(`input[data-set-index="${z-1}"][data-side="2"]`),le=K?.closest(".tiebreak-container");K&&le&&le.style.display!=="none"?K.focus():ne&&ne.focus()}}else if(Z){const K=D.querySelector(`input[data-set-index="${z+1}"][data-side="1"]`);if(K)K.focus();else if(z+1<l()){if(!M(z)||(A(),kS(C,l())))return;const re=R(z+1);D.appendChild(re);const me=re.querySelectorAll("input");me.forEach(Ie=>{Ie.addEventListener("input",O),Ie.addEventListener("keydown",V)});const he=me[0];he instanceof HTMLInputElement&&he.focus(),N()}}else if(H==="1"){const K=D.querySelector(`input[data-set-index="${z}"][data-side="2"]`);K&&K.focus()}else if(H==="2"){A();const K=D.querySelector(`input[data-set-index="${z}"][data-type="tiebreak"]`),ne=K?.closest(".tiebreak-container");if(K&&ne&&ne.style.display!=="none")K.focus();else{const le=D.querySelector(`input[data-set-index="${z+1}"][data-side="1"]`);if(le)le.focus();else if(z+1<l()){if(!M(z)||kS(C,l()))return;const he=R(z+1);D.appendChild(he);const Ie=he.querySelectorAll("input");Ie.forEach(Le=>{Le.addEventListener("input",O),Le.addEventListener("keydown",V)}),Ie[0].focus(),N()}}}}if(q.key==="Enter"){const K=document.getElementById("submitScoreV2");K&&!K.disabled&&K.click()}if(q.key==="Backspace"&&W.value===""){if(q.preventDefault(),Z){const K=D.querySelector(`input[data-set-index="${z}"][data-side="2"]`);K&&K.focus()}else if(H==="2"){const K=D.querySelector(`input[data-set-index="${z}"][data-side="1"]`);K&&K.focus()}else if(z>0){const K=D.querySelector(`input[data-set-index="${z-1}"][data-type="tiebreak"]`),ne=D.querySelector(`input[data-set-index="${z-1}"][data-side="2"]`),le=K?.closest(".tiebreak-container");K&&le&&le.style.display!=="none"?K.focus():ne&&ne.focus()}}},F=R(0);if(D.appendChild(F),F.querySelectorAll("input").forEach(q=>{q.addEventListener("input",O),q.addEventListener("keydown",V)}),e.score?.sets&&e.score.sets.length>0){const q=Math.ceil(l()/2);let W=0,z=0,H=!1;e.score.sets.forEach((Z,J)=>{if(H)return;if(J>0){const ne=R(J);D.appendChild(ne),ne.querySelectorAll("input").forEach(re=>{re.addEventListener("input",O),re.addEventListener("keydown",V)})}const ie=D.querySelector(`input[data-set-index="${J}"][data-side="1"]`),K=D.querySelector(`input[data-set-index="${J}"][data-side="2"]`);ie&&K&&(ie.value=Z.side1Score?.toString()||"",K.value=Z.side2Score?.toString()||""),Z.winningSide===1&&W++,Z.winningSide===2&&z++,H=W>=q||z>=q})}else P();e.matchUpStatus&&e.matchUpStatus!==Wp&&[iQ,XB,rQ].includes(e.matchUpStatus)&&(d=e.matchUpStatus,f.querySelectorAll('input[name="matchOutcome"]').forEach(W=>{W.value===e.matchUpStatus&&(W.checked=!0)}),e.winningSide&&(p=e.winningSide,f.querySelectorAll('input[name="irregularWinner"]').forEach(z=>{Number.parseInt(z.value)===e.winningSide&&(z.checked=!0)}),b.style.display="block")),e.score?.sets&&e.score.sets.length>0?A():d===Wp&&(b.style.display="none"),setTimeout(()=>{const q=D.querySelector("input");q&&q.focus()},100)}function Xrt(t,e){const{matchUpFormat:i}=e;if(!t)return"";const r=Zf.parse(i),n=r?.setFormat?.bestOf||3,a=u=>u===n&&r?.finalSetFormat?r.finalSetFormat:r?.setFormat;let s="",o=0,l=0;const c=t.split(/[\s/]+|--+/).filter(u=>u.length>0);for(const u of c){if(l>=n)break;o=0;const d=u;for(;o<d.length&&!(l>=n);){const p=a(l+1),h=p?.tiebreakSet?.tiebreakTo,f=p?.setTo,m=!!h&&!f,g=h||f||6,v=p?.tiebreakAt||g;let y="",b="",I="";for(;o<d.length;){const N=d[o];if(N==="-"){o++;break}if(m){y+=N,o++;continue}const k=y+N,x=Number.parseInt(k),O=g+1;if(x>O||y.length>0&&y.length>=2)break;y+=N,o++;const V=Number.parseInt(y);if(y.length===1&&V!==1&&O<10){if(o<d.length&&d[o]==="-")continue;break}}for(;o<d.length;){const N=d[o];if(N==="-")break;if(m){b+=N,o++;continue}const k=b+N,x=Number.parseInt(k),O=g+1;if(x>g+3||b.length>0&&b.length>=2)break;b+=N,o++;const V=Number.parseInt(b);if(b.length===1&&V!==1&&O<10)break}if(!b){s&&(s+=" "),s+=y;break}let w=Number.parseInt(y),T=Number.parseInt(b),S=!1;m||(w>g+1&&(w=g,y=g.toString(),S=!0),T>g+1&&(T=g,b=g.toString(),S=!0),w===g+1&&T<g-1?(w=g,y=g.toString(),S=!0):T===g+1&&w<g-1&&(T=g,b=g.toString(),S=!0));const D=Math.abs(w-T),E=Math.max(w,T)>=g&&D>=2,P=o<d.length,R=w===v&&T===v,M=w===v+1&&T===v||T===v+1&&w===v;if(!S&&(R||M&&P)){for(;o<d.length;){const N=d[o];if(N==="-"){o++;break}I+=N,o++}s&&(s+=" "),I?(s+=`${y}-${b}(${I})`,l++):s+=`${y}-${b}(`}else if(s&&(s+=" "),m?s+=`[${y}-${b}]`:s+=`${y}-${b}`,l++,!E&&o<d.length)break}}return s}const{COMPLETED:wS,RETIRED:Jrt,WALKOVER:Qrt,DEFAULTED:ent}=Kh;function tnt(t){if(!t?.sets||t.sets.length===0)return"";const e=[];return t.sets.forEach((i,r)=>{if(r>0&&e.push(" "),e.push(i.side1Score?.toString()||"0"),e.push(i.side2Score?.toString()||"0"),i.side1TiebreakScore!==void 0||i.side2TiebreakScore!==void 0){const n=i.winningSide===1?i.side2TiebreakScore:i.side1TiebreakScore;n!==void 0&&(e.push("-"),e.push(n.toString()))}}),e.join("")}function vEe(t){const{matchUp:e,container:i,onScoreChange:r}=t;try{i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=Zf.parse(e.matchUpFormat||"SET3-S:6/TB7"),a=n?.setFormat?.setTo||6,s=n?.setFormat?.tiebreakAt||a,o=ai.scales[ai.activeScale],l={digits:"",setTo:a,tiebreakAt:s};e.score&&(l.digits=tnt(e.score));const c=document.createElement("div");if(c.style.marginBottom="0.5em",i.appendChild(c),e.matchUpFormat){const N=document.createElement("div");N.style.fontSize="0.9em",N.style.marginBottom="0.5em",N.style.display="flex",N.style.alignItems="center",N.style.gap="0.5em";const k=document.createElement("span");k.textContent="Format:",k.style.color="#666",N.appendChild(k);const x=document.createElement("button");x.textContent=e.matchUpFormat,x.className="button",x.style.fontSize="0.75em",x.style.padding="0.2em 0.5em",x.style.cursor="pointer",x.title="Click to edit format",x.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:O}=await l2(async()=>{const{getMatchUpFormatModal:V}=await Promise.resolve().then(()=>ZF);return{getMatchUpFormatModal:V}},void 0,import.meta.url);O({existingMatchUpFormat:e.matchUpFormat,callback:V=>{V&&V!==e.matchUpFormat&&(e.matchUpFormat=V,x.textContent=V,l.digits="",i.innerHTML="",vEe({matchUp:e,container:i,onScoreChange:r}))},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(O){console.error("Error opening format selector:",O)}}),N.appendChild(x),i.appendChild(N)}const u=document.createElement("div");u.style.fontSize="1.2em",u.style.color="#64B5F6",u.style.textAlign="center",u.style.padding="0.25em 0.5em",u.style.fontWeight="bold",u.style.minHeight="1.5em",u.style.maxWidth="300px",u.style.margin="0 auto",u.textContent="-",i.appendChild(u);let d=wS,p;const h=document.createElement("div");h.style.display="none",h.style.marginBottom="0.8em",h.style.padding="0.6em",h.style.backgroundColor="#fff3cd",h.style.border="2px solid #ffc107",h.style.borderRadius="4px";const f=document.createElement("div");f.textContent="Irregular Ending:",f.style.fontSize="0.8em",f.style.fontWeight="600",f.style.marginBottom="0.3em",f.style.color="#856404",h.appendChild(f);const m=document.createElement("div");m.style.marginTop="0.3em";const g=document.createElement("div");g.textContent="Winner:",g.style.fontSize="0.75em",g.style.fontWeight="500",g.style.marginBottom="0.2em",g.style.color="#856404",m.appendChild(g);const v=document.createElement("div");v.style.display="flex",v.style.gap="0.5em",v.style.flexWrap="wrap";const y=e.sides?.[0],b=e.sides?.[1];[1,2].forEach(N=>{const k=document.createElement("label");k.style.display="flex",k.style.alignItems="center",k.style.gap="0.3em",k.style.cursor="pointer";const x=document.createElement("input");x.type="radio",x.name="irregularWinner",x.value=N.toString(),x.addEventListener("change",()=>{x.checked&&(p=N,S())});const O=document.createElement("span"),V=N===1?y:b;O.textContent=V?.participant?.participantName||`Side ${N}`,O.style.fontSize="0.75em",O.style.color="#856404",k.appendChild(x),k.appendChild(O),v.appendChild(k)}),m.appendChild(v),h.appendChild(m),i.appendChild(h);const I=document.createElement("div");I.style.display="grid",I.style.gridTemplateColumns="repeat(4, 1fr)",I.style.gap="8px",I.style.width="100%",I.style.maxWidth="320px",I.style.margin="0 auto",i.appendChild(I);const w=N=>Xrt(N,{matchUpFormat:e.matchUpFormat||"SET3-S:6/TB7"}),T=N=>{c.innerHTML="";const k={...e,score:N?.clearAll?void 0:N?.scoreObject||e.score,winningSide:N?.clearAll?void 0:N?.winningSide,matchUpStatus:N?.clearAll?void 0:N?.matchUpStatus||e.matchUpStatus},x=Hw({matchUp:k,isLucky:!0,composition:{configuration:{participantDetail:"TEAM",genderColor:!0,scaleAttributes:o,flag:!1}}});x&&c.appendChild(x)},S=(N=!1)=>{const k=w(l.digits);if(k?(u.style.display="block",u.textContent=k):(u.style.display="block",u.textContent="-"),d!==wS?h.style.display="block":h.style.display="none",N){T({clearAll:!0}),r({isValid:!1,sets:[]});return}let x=tI(k,e.matchUpFormat);d!==wS&&(x.matchUpStatus=d,p?(x.winningSide=p,x.isValid=!0):x.isValid=!1),T(x),r(x);const O=document.getElementById("clearScoreV2");O&&(O.disabled=l.digits.length===0&&d===wS),P()},D=N=>{const k=w(l.digits),x=k.includes("(")&&!k.includes(")"),O=l.digits.includes("-"),V=(l.digits.match(/-/g)||[]).length,F=k.includes("[")&&O&&V===1,q=(k?tI(k,e.matchUpFormat):null)?.sets?.length||0,W=Zf.parse(e.matchUpFormat),z=W?.setFormat?.bestOf||3,H=le=>{const me=le===z&&W?.finalSetFormat?W.finalSetFormat:W?.setFormat,he=me?.tiebreakSet?.tiebreakTo,Ie=me?.setTo;return!!he&&!Ie},Z=q<z&&H(q+1),J=q>0&&H(q),ie=x||F||Z||J,K=N==="-"?l.digits+"-":l.digits+N.toString(),ne=w(K);if(k){const le=tI(k,e.matchUpFormat),re=le.sets?.[le.sets.length-1],me=k.includes("("),he=ne.includes("("),Ie=me&&he&&ne!==k&&ne.startsWith(k.substring(0,k.lastIndexOf(")"))),Le=re&&(re.side1TiebreakScore===void 0&&re.side2TiebreakScore===void 0||re.side1TiebreakScore==null&&re.side2TiebreakScore==null||Ie)&&re.side1Score!==void 0&&re.side2Score!==void 0&&(re.side1Score===re.side2Score||Math.abs(re.side1Score-re.side2Score)===1);if(le.isValid&&le.winningSide&&!ie&&!Le||!ie&&N!=="-"&&ne===k)return}N==="-"?l.digits.endsWith("-")||(l.digits+="-"):l.digits+=N.toString(),S()},C=()=>{l.digits.length>0&&(l.digits=l.digits.slice(0,-1),S())},E=()=>{l.digits="",d=wS,p=void 0,h.querySelectorAll('input[name="irregularWinner"]').forEach(x=>x.checked=!1),h.querySelectorAll('input[name="matchOutcome"]').forEach(x=>x.checked=!1),S(!0)};globalThis.resetDialPad=E;const P=()=>{const N=I.querySelector('[data-button="retired"]'),k=I.querySelector('[data-button="defaulted"]'),x=w(l.digits),O=x.includes("-")&&x.length>2;N&&(N.disabled=!O),k&&(k.disabled=!O)};[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"RET",value:"retired",isSpecial:!0,requiresScore:!0},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"WO",value:"walkover",isSpecial:!0},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"DEF",value:"defaulted",isSpecial:!0,requiresScore:!0},{label:"",value:"delete",isSpecial:!0},{label:"0",value:0},{label:"-",value:"minus",isSpecial:!0},{label:"",value:"empty",isSpecial:!0,disabled:!0}].forEach(N=>{const k=document.createElement("button");k.className="button",k.textContent=N.label,k.style.cssText=`
        height: 55px !important;
        width: 100% !important;
        padding: 0.5em !important;
      `,N.label.length>1&&!N.isSpecial?k.style.fontSize="1.3em":N.isSpecial&&["RET","WO","DEF"].includes(N.label)?(k.style.fontSize="0.95em",k.style.backgroundColor="#ffe0b2"):N.isSpecial?(k.style.fontSize="1.3em",k.style.backgroundColor="#f0f0f0"):k.style.fontSize="1.3em",(N.value==="retired"||N.value==="defaulted")&&(k.dataset.button=N.value),N.disabled&&(k.disabled=!0,k.style.visibility="hidden"),N.requiresScore&&(k.disabled=!0),k.onclick=()=>{N.value==="delete"?C():N.value==="minus"?D("-"):N.value==="retired"?(d=Jrt,p=void 0,h.querySelectorAll('input[name="irregularWinner"]').forEach(O=>O.checked=!1),S()):N.value==="walkover"?(d=Qrt,p=void 0,l.digits="",h.querySelectorAll('input[name="irregularWinner"]').forEach(O=>O.checked=!1),S()):N.value==="defaulted"?(d=ent,p=void 0,h.querySelectorAll('input[name="irregularWinner"]').forEach(O=>O.checked=!1),S()):N.value==="empty"||D(N.value)},I.appendChild(k)});const M=N=>{if(N.key>="0"&&N.key<="9")N.preventDefault(),D(Number.parseInt(N.key));else if(N.key==="Backspace"||N.key==="Delete")N.preventDefault(),C();else if(N.key==="-"||N.key===" "||N.key==="/")N.preventDefault(),D("-");else if(N.key===")"){N.preventDefault();const k=w(l.digits);k.includes("(")&&!k.includes(")")&&(l.digits+="-",S())}};i.setAttribute("tabindex","-1"),i.style.outline="none",i.addEventListener("keydown",M),setTimeout(()=>i.focus(),100);const A=()=>{i.removeEventListener("keydown",M)};globalThis.cleanupDialPad=A,e.matchUpStatus&&e.matchUpStatus!==wS&&(d=e.matchUpStatus,h.querySelectorAll('input[name="matchOutcome"]').forEach(k=>{k.value===e.matchUpStatus&&(k.checked=!0)}),e.winningSide&&(p=e.winningSide,h.querySelectorAll('input[name="irregularWinner"]').forEach(x=>{parseInt(x.value)===e.winningSide&&(x.checked=!0)}),m.style.display="block")),T(null),S()}catch(n){console.error("Error rendering dial pad:",n),i.innerHTML=`<p style="color: red;">Error: ${n instanceof Error?n.message:"Unknown error"}</p>`}}function int(t){const{matchUp:e,callback:i}=t,r=ai.scoringApproach||"tidyScore";console.log("Scoring approach:",r);const n=document.createElement("div");n.style.padding="1em";const a=!!(e.score?.sets?.length||e.matchUpStatus);let s=null,o=!1;const l=u=>{s=u,o&&(u.sets?.length>0||u.score)&&(o=!1);const d=document.getElementById("submitScoreV2");if(d){const h=u.isValid||o&&a;d.disabled=!h}const p=document.getElementById("clearScoreV2");if(p){const h=document.getElementById("scoreInputV2");if(h)p.disabled=!h.value.trim();else{const f=u.sets&&u.sets.length>0;p.disabled=!f}}},c=()=>{window.cleanupDialPad&&(window.cleanupDialPad(),window.cleanupDialPad=void 0),window.resetDialPad&&(window.resetDialPad=void 0),window.resetDynamicSets&&(window.resetDynamicSets=void 0)};r==="tidyScore"?urt({matchUp:e,container:n,onScoreChange:l}):r==="freeScore"?Vrt({matchUp:e,container:n,onScoreChange:l}):r==="dynamicSets"?Zrt({matchUp:e,container:n,onScoreChange:l}):r==="dialPad"?vEe({matchUp:e,container:n,onScoreChange:l}):n.innerHTML="<p>Unknown scoring approach...</p>",Kr({title:"Score Entry",content:n,config:void 0,buttons:[{onClick:()=>{c()},label:"Cancel",intent:"none",close:!0},{id:"clearScoreV2",label:"Clear",intent:"none",disabled:!0,close:!1,onClick:()=>{if(o=!0,r==="tidyScore"||r==="freeScore"){const u=document.getElementById("scoreInputV2");u&&(u.value="",u.dispatchEvent(new Event("input",{bubbles:!0})),u.focus())}else r==="dynamicSets"?window.resetDynamicSets&&window.resetDynamicSets():r==="dialPad"&&window.resetDialPad&&window.resetDialPad()}},{id:"submitScoreV2",label:"Submit Score",intent:"is-primary",disabled:!0,onClick:()=>{s&&(s.isValid||o&&a)&&(c(),i(s))},close:!0}]}),setTimeout(()=>{const u=document.getElementById("clearScoreV2");u&&(u.style.backgroundColor="#ffeb3b",u.style.color="#333",s&&l(s))},0)}function Q0(t){const{matchUpId:e,callback:i}=t,r={withScaleValues:!0},n=t.matchUp??We.findMatchUp({participantsProfile:r,matchUpId:e}).matchUp;int({matchUp:n,callback:s=>{const{matchUpStatus:o,matchUpFormat:l,winningSide:c,score:u}=s,p=u&&We.parseScoreString({scoreString:u})||[],h=[{method:z8,params:{allowChangePropagation:!0,drawId:n.drawId,outcome:{score:{sets:p},matchUpFormat:l,matchUpStatus:o,winningSide:c},matchUpId:e}}];qt({methods:h,callback:m=>{pU(),Pt(i)&&i({...m,outcome:s})}})}})}var Gv=()=>typeof window>"u",ic=()=>typeof document<"u",rnt=class{state;constructor(e,i,r,n){this.state={degreesHours:null,degreesMinutes:null,options:i,element:e,instanceId:r,isMobileView:!1,isTouchMouseMove:!1,disabledTime:null,cloned:null,isModalRemove:!0,isInitialized:!1,customId:n,eventHandlersRegistered:!1,isDestroyed:!1}}get degreesHours(){return this.state.degreesHours}get degreesMinutes(){return this.state.degreesMinutes}get options(){return this.state.options}get element(){return this.state.element}get instanceId(){return this.state.instanceId}get isMobileView(){return this.state.isMobileView}get isTouchMouseMove(){return this.state.isTouchMouseMove}get disabledTime(){return this.state.disabledTime}get cloned(){return this.state.cloned}get isModalRemove(){return this.state.isModalRemove}get isInitialized(){return this.state.isInitialized}get customId(){return this.state.customId}get eventHandlersRegistered(){return this.state.eventHandlersRegistered}get isDestroyed(){return this.state.isDestroyed}setDegreesHours(e){this.state={...this.state,degreesHours:e}}setDegreesMinutes(e){this.state={...this.state,degreesMinutes:e}}setOptions(e){this.state={...this.state,options:e}}setIsMobileView(e){this.state={...this.state,isMobileView:e}}setIsTouchMouseMove(e){this.state={...this.state,isTouchMouseMove:e}}setDisabledTime(e){this.state={...this.state,disabledTime:e}}setCloned(e){this.state={...this.state,cloned:e}}setIsModalRemove(e){this.state={...this.state,isModalRemove:e}}setIsInitialized(e){this.state={...this.state,isInitialized:e}}setEventHandlersRegistered(e){this.state={...this.state,eventHandlersRegistered:e}}setIsDestroyed(e){this.state={...this.state,isDestroyed:e}}updateOptions(e){this.state={...this.state,options:{...this.state.options,clock:{...this.state.options.clock,...e.clock||{}},ui:{...this.state.options.ui,...e.ui||{}},labels:{...this.state.options.labels,...e.labels||{}},behavior:{...this.state.options.behavior,...e.behavior||{}},callbacks:{...this.state.options.callbacks,...e.callbacks||{}}}}}reset(){this.state={...this.state,degreesHours:null,degreesMinutes:null,isTouchMouseMove:!1,disabledTime:null,cloned:null,isModalRemove:!0,isInitialized:!1,isDestroyed:!0,eventHandlersRegistered:!1}}getModalElement(){return ic()===!1?null:document.querySelector(`[data-owner-id="${this.state.instanceId}"]`)}getInput(){return this.state.element?.querySelector("input")}getClockFace(){let e=this.getModalElement();return e?this.state.isMobileView?e.querySelector(".tp-ui-clock-face.mobile"):e.querySelector(".tp-ui-clock-face:not(.mobile)"):null}getClockHand(){let e=this.getModalElement();return e?this.state.isMobileView?e.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-clock-hand"):e.querySelector(".tp-ui-clock-hand:not(.mobile)"):null}getCircle(){let e=this.getModalElement();return e?this.state.isMobileView?e.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-circle-hand"):e.querySelector(".tp-ui-circle-hand:not(.mobile)"):null}getTipsWrapper(){let e=this.getModalElement();return e?this.state.isMobileView?e.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-tips-wrapper"):e.querySelector(".tp-ui-tips-wrapper:not(.mobile)"):null}getTipsWrapperFor24h(){let e=this.getModalElement();return e?this.state.isMobileView?e.querySelector(".tp-ui-mobile-clock-wrapper .tp-ui-tips-wrapper-24h"):e.querySelector(".tp-ui-tips-wrapper-24h:not(.mobile)"):null}getMinutes(){return this.getModalElement()?.querySelector(".tp-ui-minutes")||null}getHour(){return this.getModalElement()?.querySelector(".tp-ui-hour")||null}getAM(){return this.getModalElement()?.querySelector(".tp-ui-am")||null}getPM(){return this.getModalElement()?.querySelector(".tp-ui-pm")||null}getHourText(){return this.getModalElement()?.querySelector(".tp-ui-hour-text")||null}getMinutesText(){return this.getModalElement()?.querySelector(".tp-ui-minute-text")||null}getHeader(){return this.getModalElement()?.querySelector(".tp-ui-header")||null}getInputWrappers(){return this.getModalElement()?.querySelectorAll(".tp-ui-input-wrapper")||null}getDots(){return this.getModalElement()?.querySelector(".tp-ui-dots")||null}getMinutesTips(){return this.getModalElement()?.querySelector(".tp-ui-minutes-time")||null}getHourTips(){return this.getModalElement()?.querySelector(".tp-ui-hour-time-12")||null}getAllValueTips(){let e=this.getModalElement();return e?[...e.querySelectorAll(".tp-ui-value-tips"),...e.querySelectorAll(".tp-ui-value-tips-24h")]:[]}getOpenElementData(){let e=this.state.element?.querySelectorAll("[data-open]");if(e?.length>0){let i=[];return e.forEach(({dataset:r})=>i.push(r.open??"")),[...new Set(i)]}return null}getOpenElement(){let e=this.getInput(),i=this.getOpenElementData();return i===null?(e?.setAttribute("data-open","tp-ui-input"),[e]):i.map(r=>this.state.element?.querySelectorAll(`[data-open='${r}']`))[0]??""}getCancelButton(){return this.getModalElement()?.querySelector(".tp-ui-cancel-btn")||null}getOkButton(){return this.getModalElement()?.querySelector(".tp-ui-ok-btn")||null}getActiveTypeMode(){return this.getModalElement()?.querySelector(".tp-ui-type-mode.active")||null}getKeyboardClockIcon(){return this.getModalElement()?.querySelector(".tp-ui-keyboard-icon-wrapper")||null}getFooter(){return this.getModalElement()?.querySelector(".tp-ui-footer")||null}getWrapper(){return this.getModalElement()?.querySelector(".tp-ui-wrapper")||null}},up={DEFAULT_DELAY:300,MODAL_ANIMATION:150,SCROLLBAR_RESTORE:400,MODAL_REMOVE:300,CLOCK_ANIMATION:600,TIPS_ANIMATION:401,MOBILE_TOGGLE:450,CLOCK_SCALE_DELAY:150},nnt=class{core;emitter;timeouts=[];constructor(e,i){this.core=e,this.emitter=i,this.setupEventListeners()}setupEventListeners(){this.emitter.on("animation:clock",()=>{this.handleAnimationSwitchTipsMode()})}runWithAnimation(e,i=up.MODAL_ANIMATION){if(this.core.options.ui.animation){let r=setTimeout(e,i);this.timeouts.push(r)}else e()}clearAllTimeouts(){this.timeouts.forEach(clearTimeout),this.timeouts=[]}setAnimationToOpen(){this.clearAllTimeouts(),this.core.getModalElement()?.classList.add("opacity"),this.runWithAnimation(()=>{this.core.getModalElement()?.classList.add("show")})}removeAnimationToClose(){this.clearAllTimeouts(),this.core.getModalElement()&&this.runWithAnimation(()=>{let e=this.core.getModalElement();e?.classList.remove("show"),e?.classList.remove("opacity")})}handleAnimationClock(){this.core.options.ui.animation&&this.runWithAnimation(()=>{this.core.getClockFace()?.classList.add("tp-ui-clock-animation");let e=setTimeout(()=>{this.core.getClockFace()?.classList.remove("tp-ui-clock-animation")},up.CLOCK_ANIMATION);this.timeouts.push(e)})}handleAnimationSwitchTipsMode(){let e=this.core.getClockHand();if(!e)return;e.classList.add("tp-ui-tips-animation");let i=setTimeout(()=>{this.core.getClockHand()?.classList.remove("tp-ui-tips-animation")},up.TIPS_ANIMATION);this.timeouts.push(i)}destroy(){this.clearAllTimeouts()}},ant=()=>{if(ic()===!1)return 0;let t=document.createElement("div");t.className="tp-ui-measure",document.body.appendChild(t);let e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},snt=(t,e)=>t?t.classList.contains(e):!1,FM=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,r)=>Number(t)+r),JB=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,r)=>Number(e)-r).reverse(),nQ=(t="")=>{let e=t.replace(/(AM|PM|am|pm)/,a=>` ${a}`),i=new Date(`September 20, 2000 ${e}`),r=i.getHours().toString().padStart(2,"0"),n=i.getMinutes().toString().padStart(2,"0");return`${r}:${n}`},aQ=t=>{let[e,i]=t.split(":");return`${e.padStart(2,"0")}:${i.padStart(2,"0")}`},yEe=(t,e)=>{if(t.length<2)return!1;let i=t.map(r=>{let[n,a]=r.trim().split("-"),s,o;if(e==="12h"){if(!/\s?(AM|PM|am|pm)\s?$/.test(n.trim())||!/\s?(AM|PM|am|pm)\s?$/.test(a.trim()))throw new Error(`Invalid 12h format: "${r}"`);s=nQ(n.trim()),o=nQ(a.trim())}else{if(/\s?(AM|PM|am|pm)\s?/.test(n.trim())||/\s?(AM|PM|am|pm)\s?/.test(a.trim()))throw new Error(`Invalid 24h format: "${r}"`);s=aQ(n.trim()),o=aQ(a.trim())}return{start:s,end:o,original:r}});for(let r=0;r<i.length;r++)for(let n=r+1;n<i.length;n++){let a=i[r],s=i[n];if(a.start<=s.end&&a.end>=s.start||s.start<=a.end&&s.end>=a.start)throw new Error(`Overlapping intervals: "${a.original}" and "${s.original}"`)}return!1},ont=()=>typeof window<"u"&&window.crypto&&typeof window.crypto.randomUUID=="function"?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),lnt='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M160-200q-33 0-56.5-23.5T80-280v-400q0-33 23.5-56.5T160-760h640q33 0 56.5 23.5T880-680v400q0 33-23.5 56.5T800-200H160Zm0-80h640v-400H160v400Zm160-40h320v-80H320v80ZM200-440h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80ZM200-560h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80Zm120 0h80v-80h-80v80ZM160-280v-400 400Z"/></svg>',cnt='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="m612-292 56-56-148-148v-184h-80v216l172 172ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 320q133 0 226.5-93.5T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160Z"/></svg>',unt=["00","13","14","15","16","17","18","19","20","21","22","23"],sQ=["12","1","2","3","4","5","6","7","8","9","10","11"],pG=["00","05","10","15","20","25","30","35","40","45","50","55"],dnt=(t,e)=>{let{ui:{iconTemplate:i,enableSwitchIcon:r,animation:n,theme:a,mobile:s,editable:o,iconTemplateMobile:l},labels:{time:c,mobileTime:u,am:d,pm:p,cancel:h,ok:f,mobileMinute:m,mobileHour:g},clock:{type:v}}=t,y=s?"mobile":"",b=`<button aria-label="Keyboard" type="button" class="tp-ui-keyboard-icon">${i||lnt}</button>`,I=l||`<button aria-label="Clock" type="button" class="tp-ui-keyboard-icon">${l||cnt}</button>`;return`<div class="tp-ui-modal normalize ${y}" data-theme="${a}" role="dialog" aria-modal="true" aria-labelledby="tp-ui-label-${e}" data-owner-id="${e}" style='transition:${n?"opacity 0.15s linear":"none"}'><div class="tp-ui-wrapper ${y}" tabindex="0"><div class="tp-ui-select-time ${y}" id="tp-ui-label-${e}">${y?u:c}</div><div class="tp-ui-header ${y}"><div class="tp-ui-wrapper-time ${y} ${v==="24h"?"tp-ui-wrapper-time-24h":""}" role="group" aria-label="${y?u:c}"><div class="tp-ui-input-wrapper ${y}"><div class="tp-ui-input-ripple-wrapper ${y}" data-md3-ripple><input name="hour" ${!o&&!y?"readonly":""} class="tp-ui-hour ${y}" tabindex="0" type="number" min="0" max="${v==="12h"?"12":"23"}" aria-label="${y?g:"Hour"}" role="spinbutton" aria-valuenow="12"></div><div class="tp-ui-hour-text ${y}">${g}</div></div><div class="tp-ui-dots ${y}" aria-hidden="true"><span></span><span></span></div><div class="tp-ui-input-wrapper ${y}"><div class="tp-ui-input-ripple-wrapper ${y}" data-md3-ripple><input name="minutes" ${!o&&!y?"readonly":""} class="tp-ui-minutes ${y}" tabindex="0" type="number" min="0" max="59" aria-label="${y?m:"Minute"}" role="spinbutton" aria-valuenow="0"></div><div class="tp-ui-minute-text ${y}">${m}</div></div></div>${v!=="24h"?`<div class="tp-ui-wrapper-type-time ${y}" role="group" aria-label="Period"><div class="tp-ui-type-mode tp-ui-am ${y?"mobile":"tp-ui-ripple"}" data-md3-ripple tabindex="0" role="button" aria-label="${d}" aria-pressed="false" data-type="AM">${d}</div><div class="tp-ui-type-mode tp-ui-pm ${y?"mobile":"tp-ui-ripple"}" data-md3-ripple tabindex="0" role="button" aria-label="${p}" aria-pressed="false" data-type="PM">${p}</div></div>`:""}</div><div class="tp-ui-mobile-clock-wrapper ${y}"><div class="tp-ui-body ${y}"><div class="tp-ui-clock-face ${y}" role="group" aria-label="Clock"><div class="tp-ui-dot ${y}" aria-hidden="true"></div><div class="tp-ui-clock-hand ${y}" aria-hidden="true"><div class="tp-ui-circle-hand ${y}"></div></div><div class="tp-ui-tips-wrapper ${y}" role="listbox" aria-label="Time"></div>${v==="24h"?`<div class="tp-ui-tips-wrapper-24h ${y}" role="listbox" aria-label="24h"></div>`:""}</div></div></div><div class="tp-ui-footer ${y}" ${y?'data-view="mobile"':""}>${r?`<div class="tp-ui-keyboard-icon-wrapper ${y}" tabindex="0" role="button" aria-pressed="false" aria-label="Toggle" data-view="desktop">${y?I:b}</div>`:""}<div class="tp-ui-wrapper-btn ${y}"><div class="tp-ui-cancel-btn ${y}" data-md3-ripple tabindex="0" role="button" aria-pressed="false" aria-label="${h}">${h}</div><div class="tp-ui-ok-btn ${y}" data-md3-ripple tabindex="0" role="button" aria-pressed="false" aria-label="${f}">${f}</div></div></div></div><div class="timepicker-announcer sr-only" role="status" aria-live="polite" aria-atomic="true"></div></div>`},pnt=class{core;emitter;timeouts=[];originalOverflow;originalPaddingRight;constructor(e,i){this.core=e,this.emitter=i}runWithTimeout(e,i=up.DEFAULT_DELAY){let r=setTimeout(e,i);this.timeouts.push(r)}clearAllTimeouts(){this.timeouts.forEach(clearTimeout),this.timeouts=[]}clearExistingModal(){if(ic()===!1)return;let e=document.querySelector(".tp-ui-modal");e&&e.remove()}setModalTemplate(){if(ic()===!1)return;this.clearExistingModal();let e=dnt(this.core.options,this.core.instanceId);if(this.core.options.ui.inline?.enabled){let r=document.getElementById(this.core.options.ui.inline.containerId);if(!r)return;r.innerHTML="",r.insertAdjacentHTML("beforeend",e);let n=r.querySelector(".tp-ui-modal");if(n){n.classList.add("tp-ui--inline");let{showButtons:a}=this.core.options.ui.inline;(a===!1||a===void 0)&&n.querySelectorAll(".tp-ui-wrapper-btn, .tp-ui-wrapper-btn.mobile").forEach(s=>s.style.display="none")}return}let{appendModalSelector:i}=this.core.options.ui;i?document.querySelector(i)?.insertAdjacentHTML("beforeend",e):document.body.insertAdjacentHTML("beforeend",e)}setScrollbarOrNot(){ic()!==!1&&(this.core.options.ui.inline?.enabled||(this.core.options.ui.enableScrollbar?this.runWithTimeout(()=>{Gv()||this.runWithTimeout(()=>{typeof document<"u"&&(document.body.style.overflowY=this.originalOverflow||"",document.body.style.paddingRight=this.originalPaddingRight||"")},up.SCROLLBAR_RESTORE)},400):(this.originalOverflow=document.body.style.overflowY,this.originalPaddingRight=document.body.style.paddingRight,document.body.style.paddingRight=`${ant()}px`,document.body.style.overflowY="hidden")))}removeBackdrop(){if(this.core.options.ui.inline?.enabled||this.core.options.ui.backdrop)return;let e=this.core.getModalElement(),i=this.core.getOpenElement();e?.classList.add("removed"),i.forEach(r=>r?.classList.add("disabled"))}setNormalizeClass(){let e=this.core.getModalElement();e&&(e.classList.add("tp-ui-normalize"),e.querySelectorAll(":scope > div").forEach(i=>i.classList.add("tp-ui-normalize")))}setShowClassToBackdrop(){if(this.core.options.ui.inline?.enabled){this.core.getModalElement()?.classList.add("show"),this.setInitialFocus();return}this.core.options.ui.backdrop&&this.runWithTimeout(()=>{this.core.getModalElement()?.classList.add("show"),this.setInitialFocus()},up.MODAL_ANIMATION)}setInitialFocus(){if(!this.core.options.behavior.focusTrap)return;let e=this.core.getWrapper();e&&typeof requestAnimationFrame<"u"&&requestAnimationFrame(()=>{e.focus()})}setFlexEndToFooterIfNoKeyboardIcon(){let e=this.core.getFooter();!this.core.options.ui.enableSwitchIcon&&e&&(e.style.justifyContent="flex-end")}destroy(){this.clearAllTimeouts(),!Gv()&&!this.core.options.ui.inline?.enabled&&(document.body.style.overflowY=this.originalOverflow||"",document.body.style.paddingRight=this.originalPaddingRight||""),this.clearExistingModal()}},Av=(t,e,i,r)=>{let n={hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};if(!t)return n;let a=t.value.trim();if(!i&&!a)return n;if(typeof i=="boolean"&&i){let m=new Date,[g,v]=m.toLocaleTimeString().split(":"),y=g.padStart(2,"0");if(/[a-z]/i.test(v)&&e==="12h"){let[b,I]=v.split(" ");return{hour:y,minutes:b,type:I}}return{hour:y,minutes:v,type:void 0}}if(typeof i=="object"){let{time:m,locales:g,preventClockType:v}=i,y=m??new Date;if(v&&r){let[T,S]=new Date(y).toLocaleTimeString().split(":");if(/[a-z]/i.test(S)){let[D,C]=S.split(" ");return{hour:T,minutes:D,type:C}}return{hour:T.padStart(2,"0"),minutes:S,type:void 0}}let b=new Date(y).toLocaleTimeString(g||"en-US",{hour:"2-digit",minute:"2-digit",hour12:e==="12h"}),[I,w]=b.split(":");if(e==="12h"&&/[a-z]/i.test(w)){let T=w.trim().split(" "),S=T[0],D=T[1]||"AM";return{hour:I,minutes:S,type:D}}return{hour:I,minutes:w.replace(/\D/g,""),type:void 0}}let[s,o]=a.split(" "),[l="",c=""]=s.split(":"),u=l.replace(/\D/g,""),d=c.replace(/\D/g,""),p={hour:u.padStart(2,"0"),minutes:d.padStart(2,"0"),type:e==="12h"?o:void 0};if(u.length>2||d.length>2)return{...p,error:"Invalid input: too many digits.",currentHour:l,currentMin:c};if(/[a-z]/i.test(s))return{...p,error:"Input contains invalid letters."};if(a.includes(" ")&&(!o||a.length>8||o!=="AM"&&o!=="PM"))return{...p,error:"Invalid AM/PM format or length.",currentLength:a.length,currentType:o};let h=Number(u),f=Number(d);if(e==="12h"){if(h<1||h>12||f<0||f>59||o!=="AM"&&o!=="PM")return{...p,error:"Invalid 12h time.",currentHour:h,currentMin:f,currentType:o}}else if(h<0||h>23||f<0||f>59)return{...p,error:"Invalid 24h time.",currentHour:h,currentMin:f};return p},oQ=(t,e,i)=>{let r=Number(t);if(Number.isNaN(r))return!1;switch(e){case"hour":return i==="24h"?r>=0&&r<=23:r>0&&r<=12;case"minutes":return r>=0&&r<=59;default:return}},hnt=t=>{if(!t)return;let{disabledTime:e,type:i}=t.clock;if(!e||!Object.keys(e).length)return;let{hours:r,minutes:n,interval:a}=e;if(a){delete e.hours,delete e.minutes;let s=Array.isArray(a)?a:[a];if(!i)throw new Error("clockType required for interval");return yEe(s,i),{value:s.map(o=>{let[l,c]=o.trim().split("-"),{hour:u,minutes:d,type:p}=Av({value:l.trim()},i),{hour:h,minutes:f,type:m}=Av({value:c.trim()},i),g=FM(u,h).map(I=>Number(I)===0?"00":String(Number(I))),v=[],y=Number(d),b=Number(f);if(m===p)return y>0&&b<=0?(v.push(g[0],g[g.length-1]),g=g.slice(1,-1)):b<59&&b>0&&y<=0?(v.push(void 0,g[g.length-1]),g=g.slice(0,-1)):b>0&&y>0?(v.push(g[0],g[g.length-1]),g=g.slice(1,-1)):b===0&&y===0&&(v.push(void 0,g[g.length-1]),g.pop()),{removedStartedHour:v[0]!==void 0&&Number(v[0])<=9?`0${v[0]}`:v[0],removedEndHour:v[1]!==void 0&&Number(v[1])<=9?`0${v[1]}`:v[1],rangeArrHour:g,startMinutes:FM(d,59).map(I=>Number(I)<=9?`0${I}`:`${I}`),endMinutes:JB(0,f).map(I=>Number(I)<=9?`0${I}`:`${I}`),startType:p,endType:m};{let I=FM(u,12).map(String),w=JB(1,h).map(String),T=[],S=[];return y>0&&b<=0?(S.push(w[w.length-1]),T.push(I[0]),w.pop(),I.shift()):b<59&&b>0&&y<=0?(T.push(I[0]),S.push(w[w.length-1]),w.pop()):b>0&&y>0?(S.push(w[w.length-1]),T.push(I[0]),w.pop(),I.shift()):b===0&&y===0&&(S.push(w[w.length-1]),T.push(I[0]),w.pop()),{startType:p,endType:m,amHours:I,pmHours:w,removedAmHour:T[0]&&Number(T[0])<=9?`0${T[0]}`:T[0],removedPmHour:S[0]&&Number(S[0])<=9?`0${S[0]}`:S[0],startMinutes:Number(d)===0?[]:FM(d,59).map(D=>Number(D)<=9?`0${D}`:`${D}`),endMinutes:JB(0,f).map(D=>Number(D)<=9?`0${D}`:`${D}`)}}}).reduce((o,l)=>(Object.entries(l).forEach(([c,u])=>{Array.isArray(u)?o[c]=Array.isArray(o[c])?[...o[c],...u]:[...u]:o[c]=u}),o),{isInterval:!0,clockType:i,intervals:s})}}return r?.forEach(s=>{if(i==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(i==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),n?.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r?.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:n?.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}},lQ=(t,e,i,r)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(n=>oQ(n,e,i)).some(n=>n===!1);if(typeof t=="string"||typeof t=="number")return!!oQ(t,e,i)}},cQ="tp-ui",fnt="mousedown mouseup mousemove mouseleave mouseover",mnt="touchstart touchmove touchend",gnt=`${fnt} ${mnt}`,gP="active",vnt=class{core;emitter;isAnimating=!1;constructor(e,i){this.core=e,this.emitter=i,this.setupEventListeners()}setupEventListeners(){this.emitter.on("switch:view",()=>{this.toggleMobileClockFace()})}isCurrentTimeEnabled(e){let i=this.core.options.clock.currentTime;return typeof i=="boolean"?i:!!i?.[e]}preventClockTypeByCurrentTime(){if(!this.isCurrentTimeEnabled("preventClockType"))return;let e=this.core.getInput();if(!e)return;let{currentTime:i,clockType:r}={currentTime:this.core.options.clock.currentTime,clockType:this.core.options.clock.type},{type:n}=Av(e,r,i,!0);this.core.updateOptions({clock:{type:n?"12h":"24h"}})}updateInputValueWithCurrentTimeOnStart(){if(!this.isCurrentTimeEnabled("updateInput"))return;let e=this.core.getInput();if(!e)return;let{hour:i,minutes:r,type:n}=Av(e,this.core.options.clock.type,this.core.options.clock.currentTime);e.value=n?`${i}:${r} ${n}`:`${i}:${r}`}checkMobileOption(){this.core.setIsMobileView(!!this.core.options.ui.mobile),this.core.options.ui.mobile&&this.core.updateOptions({ui:{editable:!0}})}getDisableTime(){let e=hnt(this.core.options);this.core.setDisabledTime(e||null)}getInputValueOnOpenAndSet(){let e=this.core.getInput();if(!e)return;let i=Av(e,this.core.options.clock.type,this.core.options.clock.currentTime),r=this.core.getHour(),n=this.core.getMinutes(),a=this.core.getActiveTypeMode(),s=this.core.getAM();if(i===void 0){r&&(r.value="12"),n&&(n.value="00");let p={hour:r?.value||"12",minutes:n?.value||"00",type:a?.dataset.type,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes};this.emitter.emit("open",p),this.core.options.clock.type!=="24h"&&s&&s.classList.add(gP);return}let[o,l,c]=e.value.split(":").join(" ").split(" ");e.value.length===0&&(o=i.hour,l=i.minutes,c=i.type),r&&(r.value=o.padStart(2,"0")),n&&(n.value=l.padStart(2,"0"));let u=this.core.getModalElement()?.querySelector(`[data-type='${c}']`);this.core.options.clock.type!=="24h"&&u&&u.classList.add(gP);let d={...i,type:a?.dataset.type,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes};this.emitter.emit("open",d)}getInputValue(e,i,r){return Av(e,i,r)}toggleMobileClockFace(){if(this.isAnimating)return;let e=this.core.getModalElement();if(!e)return;let i=e.querySelector(".tp-ui-wrapper"),r=this.core.getKeyboardClockIcon(),n=e.querySelector(".tp-ui-mobile-clock-wrapper"),a=e.querySelectorAll("*"),s=e.querySelector(".tp-ui-select-time"),o=this.core.getHour(),l=this.core.getMinutes(),c=this.core.getClockFace();if(!i)return;let u=i.classList.contains("expanded"),d=this.core.isMobileView;u?this.collapseClockFace(i,n,a,r,s,o,l,c,d):this.expandClockFace(i,n,a,r,s,o,l,c)}collapseClockFace(e,i,r,n,a,s,o,l,c){this.isAnimating=!0,this.switchView(a,n,s,o,!0),r.forEach(u=>{u!==i&&u!==e&&u!==a&&(u.classList.remove("expanded"),c&&u.classList.add("mobile"))}),a&&(a.classList.remove("expanded"),c&&a.classList.add("mobile")),typeof requestAnimationFrame<"u"?requestAnimationFrame(()=>{i?.classList.remove("expanded"),c&&i?.classList.add("mobile"),e?.classList.remove("expanded"),c&&e?.classList.add("mobile"),c?l?.classList.remove("scale-in"):l?.classList.add("scale-in"),setTimeout(()=>{this.isAnimating=!1},up.MOBILE_TOGGLE)}):this.isAnimating=!1,n?.setAttribute("aria-label","Show clock face"),n?.setAttribute("aria-pressed","false")}expandClockFace(e,i,r,n,a,s,o,l){this.isAnimating=!0,o?.classList.contains("active")&&o?this.emitter.emit("select:minute",{minutes:o.value}):s&&this.emitter.emit("select:hour",{hour:s.value}),r.forEach(c=>{c!==i&&c!==e&&c!==a&&(c.classList.remove("mobile"),c.classList.add("expanded"))}),a&&(a.classList.remove("mobile"),a.classList.add("expanded")),this.switchView(a,n,s,o,!1),typeof requestAnimationFrame<"u"?requestAnimationFrame(()=>{e.classList.remove("mobile"),e.classList.add("expanded"),requestAnimationFrame(()=>{i&&(i.classList.remove("mobile"),i.classList.add("expanded")),l&&l.classList.remove("scale-in"),setTimeout(()=>{l&&l.classList.add("scale-in")},up.CLOCK_SCALE_DELAY),setTimeout(()=>{this.isAnimating=!1},up.MOBILE_TOGGLE)})}):this.isAnimating=!1,n?.setAttribute("aria-label","Hide clock face"),n?.setAttribute("aria-pressed","true")}switchView(e,i,r,n,a){a?(e?.classList.remove("mobile"),i?.classList.remove("mobile"),r?.classList.remove("mobile"),n?.classList.remove("mobile"),this.updateClockFaceAccessibility(!1)):(e?.classList.add("mobile"),i?.classList.add("mobile"),r?.classList.add("mobile"),n?.classList.add("mobile"),this.updateClockFaceAccessibility(!0))}updateClockFaceAccessibility(e){let i=this.core.getClockFace();if(!i)return;let r=i.querySelector(".tp-ui-tips-wrapper"),n=i.querySelector(".tp-ui-tips-wrapper-24h"),a=i.querySelectorAll(".tp-ui-tip");e?(i.setAttribute("aria-hidden","true"),r?.setAttribute("aria-hidden","true"),n?.setAttribute("aria-hidden","true"),a.forEach(s=>{s.setAttribute("tabindex","-1"),s.setAttribute("aria-hidden","true")})):(i.removeAttribute("aria-hidden"),r?.removeAttribute("aria-hidden"),n?.removeAttribute("aria-hidden"),a.forEach(s=>{s.setAttribute("tabindex","0"),s.removeAttribute("aria-hidden")}))}destroy(){}},ynt=class{core;emitter;constructor(e,i){this.core=e,this.emitter=i}setTheme(){let e=this.core.getModalElement();if(!e)return;let{theme:i}=this.core.options.ui;i&&e.setAttribute("data-theme",i)}setInputClassToInputElement(){let e=this.core.getInput();e&&(snt(e,"tp-ui-input")||e.classList.add("tp-ui-input"))}setDataOpenToInputIfDoesntExistInWrapper(){let e=this.core.getOpenElementData(),i=this.core.getInput();e===null&&i&&i.setAttribute("data-open","tp-ui-input")}setClassTopOpenElement(){let e=this.core.getOpenElement();for(let i of e)i&&i.classList.add("tp-ui-open-element")}setTimepickerClassToElement(){let e=this.core.element;if(!e)return;e.classList.add(cQ);let i=this.core.options.ui.cssClass;i&&i!==cQ&&e.classList.add(i)}destroy(){let e=this.core.getModalElement();e&&e.removeAttribute("data-theme")}},QB=class bEe extends Error{constructor(e,i){super(`[TimepickerUI] ${e}`),this.code=i,this.name="TimepickerError",Object.setPrototypeOf(this,bEe.prototype)}},e$={INVALID_PARAMETER:"INVALID_PARAMETER"},bnt=class{core;emitter;constructor(e,i){this.core=e,this.emitter=i}setErrorHandler(){let e=this.core.getInput();if(!e)return!0;let{error:i,currentHour:r,currentMin:n,currentType:a,currentLength:s}=Av(e,this.core.options.clock.type);if(this.removeErrorHandler(),i){if(ic()===!1)return!1;let o=document.createElement("div");o.classList.add("tp-ui-invalid-text"),o.innerHTML="<b>Invalid Time Format</b>",e.classList.add("tp-ui-invalid-format"),e.nextElementSibling?.classList.contains("tp-ui-invalid-text")||e.after(o);let l={error:i,rejectedHour:void 0,rejectedMinute:void 0,inputHour:r,inputMinute:n,inputType:a,inputLength:s};return this.emitter.emit("error",l),!1}return!0}removeErrorHandler(){let e=this.core.getInput();if(!e)return;e.classList.remove("tp-ui-invalid-format");let i=e.nextElementSibling;i?.classList.contains("tp-ui-invalid-text")&&i.remove()}checkDisabledValuesOnStart(){if(!this.core.options.clock.disabledTime)return;let{disabledTime:e,type:i}=this.core.options.clock;if(e.interval){if(!i)throw new QB("clockType is required when using disabledTime.interval",e$.INVALID_PARAMETER);let o=Array.isArray(e.interval)?e.interval:[e.interval];try{yEe(o,i)}catch(l){throw new QB(`Invalid disabledTime.interval: ${l.message}`,e$.INVALID_PARAMETER)}return}let{hours:r,minutes:n}=e,a=r?lQ(r,"hour",i):!0,s=n?lQ(n,"minutes",i):!0;if(!a||!s)throw new QB("Invalid hours or minutes in disabledTime option",e$.INVALID_PARAMETER)}destroy(){this.removeErrorHandler()}},Int=class{core;emitter;cleanupHandlers=[];constructor(e,i){this.core=e,this.emitter=i}handleOpenOnClick(){let e=this.core.getOpenElement();if(!e)return;let i=()=>{this.core.isDestroyed||this.emitter.emit("show",{})};e.forEach(r=>{r.addEventListener("click",i),this.cleanupHandlers.push(()=>r.removeEventListener("click",i))})}handleOpenOnEnterFocus(){let e=this.core.getInput();if(!e)return;let i=r=>{r.key==="Enter"&&!this.core.isDestroyed&&this.emitter.emit("show",{})};e.addEventListener("keydown",i),this.cleanupHandlers.push(()=>e.removeEventListener("keydown",i))}handleCancelButton(){let e=this.core.getCancelButton();if(!e)return;let i=()=>{this.core.isDestroyed||this.emitter.emit("cancel",{})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handleOkButton(){let e=this.core.getOkButton();if(!e)return;let i=()=>{if(this.core.isDestroyed)return;let r=this.core.getHour(),n=this.core.getMinutes(),a=this.core.getActiveTypeMode();this.emitter.emit("confirm",{hour:r?.value,minutes:n?.value,type:a?.textContent||void 0})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handleBackdropClick(){let e=this.core.getModalElement();if(!e)return;let i=r=>{this.core.isDestroyed||r.target===e&&this.emitter.emit("cancel",{})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handleEscClick(){if(ic()===!1)return;let e=i=>{this.core.isDestroyed||i.key==="Escape"&&this.emitter.emit("cancel",{})};document.addEventListener("keydown",e),this.cleanupHandlers.push(()=>document.removeEventListener("keydown",e))}handleAmClick(){let e=this.core.getAM();if(!e)return;let i=()=>{if(this.core.isDestroyed)return;let r=this.core.getPM();e.classList.add("active"),r?.classList.remove("active"),this.emitter.emit("select:am",{});let n=this.core.getHour(),a=this.core.getMinutes();this.emitter.emit("update",{hour:n?.value,minutes:a?.value,type:"AM"})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handlePmClick(){let e=this.core.getPM();if(!e)return;let i=()=>{if(this.core.isDestroyed)return;let r=this.core.getAM();e.classList.add("active"),r?.classList.remove("active"),this.emitter.emit("select:pm",{});let n=this.core.getHour(),a=this.core.getMinutes();this.emitter.emit("update",{hour:n?.value,minutes:a?.value,type:"PM"})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handleHourEvents(){let e=this.core.getHour();if(!e)return;let i=()=>{if(this.core.isDestroyed)return;e.classList.add("active");let r=this.core.getMinutes();r?.classList.remove("active"),this.emitter.emit("select:hour",{hour:e.value});let n=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:e.value,minutes:r?.value,type:n?.textContent||void 0})};if(e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i)),this.core.options.ui.editable){let r=e.value,n=()=>{if(!this.core.isDestroyed&&e.value!==r){r=e.value,this.emitter.emit("animation:clock",{}),this.emitter.emit("select:hour",{hour:e.value});let a=this.core.getMinutes(),s=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:e.value,minutes:a?.value,type:s?.textContent||void 0})}};e.addEventListener("blur",n),this.cleanupHandlers.push(()=>e.removeEventListener("blur",n))}}handleMinutesEvents(){let e=this.core.getMinutes();if(!e)return;let i=()=>{if(this.core.isDestroyed)return;e.classList.add("active");let r=this.core.getHour();r?.classList.remove("active"),this.emitter.emit("select:minute",{minutes:e.value});let n=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:r?.value,minutes:e.value,type:n?.textContent||void 0})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}handleKeyboardInput(){let e=this.core.getHour(),i=this.core.getMinutes();if(e){let r=n=>{if(this.core.isDestroyed||n.key!=="ArrowUp"&&n.key!=="ArrowDown")return;n.preventDefault();let a=parseInt(e.value)||0,s=parseInt(e.getAttribute("max")||"23");parseInt(e.getAttribute("min")||"0");let o=this.core.options.clock.type==="12h",l;n.key==="ArrowUp"?o?l=a>=12?1:a+1:l=a>=s?0:a+1:o?l=a<=1?12:a-1:l=a<=0?s:a-1,e.value=l.toString().padStart(2,"0"),this.emitter.emit("animation:clock",{}),this.emitter.emit("select:hour",{hour:e.value});let c=this.core.getMinutes(),u=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:e.value,minutes:c?.value,type:u?.textContent||void 0})};e.addEventListener("keydown",r),this.cleanupHandlers.push(()=>e.removeEventListener("keydown",r))}if(i){let r=n=>{if(this.core.isDestroyed||n.key!=="ArrowUp"&&n.key!=="ArrowDown")return;n.preventDefault();let a=parseInt(i.value)||0,s=59,o=0,l;n.key==="ArrowUp"?l=a>=s?o:a+1:l=a<=o?s:a-1,i.value=l.toString().padStart(2,"0"),this.emitter.emit("animation:clock",{}),this.emitter.emit("select:minute",{minutes:i.value});let c=this.core.getHour(),u=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:c?.value,minutes:i.value,type:u?.textContent||void 0})};i.addEventListener("keydown",r),this.cleanupHandlers.push(()=>i.removeEventListener("keydown",r))}}focusTrapHandler(){if(ic()===!1)return;let e=this.core.getWrapper();if(!e)return;let i=r=>{if(this.core.isDestroyed||r.key!=="Tab")return;let n=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),a=n[0],s=n[n.length-1];r.shiftKey&&document.activeElement===a?(s?.focus(),r.preventDefault()):!r.shiftKey&&document.activeElement===s&&(a?.focus(),r.preventDefault())};e.addEventListener("keydown",i),this.cleanupHandlers.push(()=>e.removeEventListener("keydown",i))}handleMoveHand(){if(ic()===!1)return;let e=i=>{this.core.isDestroyed||i.preventDefault()};document.addEventListener("mousedown",e,!1),document.addEventListener("touchstart",e,{passive:!1}),this.cleanupHandlers.push(()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)})}handleSwitchViewButton(){let e=this.core.getKeyboardClockIcon();if(!e)return;let i=()=>{this.core.isDestroyed||this.emitter.emit("switch:view",{})};e.addEventListener("click",i),this.cleanupHandlers.push(()=>e.removeEventListener("click",i))}destroy(){this.cleanupHandlers.forEach(e=>e()),this.cleanupHandlers=[]}},bv=class{static angleToIndex(e,i,r){let n=Math.round(e/30)%12;if(i==="24h")if(r){let a=n+12;return a===12?0:a}else return n===0?12:n;return n===0?12:n}static indexToValue(e,i,r){if(i==="24h")return e.toString().padStart(2,"0");let n=e;return n===0&&(n=12),n>12&&(n=n-12),n.toString().padStart(2,"0")}static indexToAngle(e,i){return i==="24h"?e>=12?(e-12)%12*30:e%12*30:(e===0?12:e)%12*30}static isDisabled(e,i,r){return r?r.isInterval&&r.intervals&&r.clockType?this.isDisabledByInterval(e,i,r):r.hours?r.hours.some(n=>String(n)===e||Number(n)===Number(e)||n===e):!1:!1}static isDisabledByInterval(e,i,r){if(!r.intervals)return!1;for(let n=0;n<60;n++){let a=n.toString().padStart(2,"0");if(!this.isTimeInIntervals(e,a,i,r.intervals,r.clockType))return!1}return!0}static isTimeInIntervals(e,i,r,n,a){let s=a==="12h"?`${e}:${i} ${r}`:`${e}:${i}`;for(let o of n){let[l,c]=o.split("-").map(u=>u.trim());if(this.isTimeBetween(s,l,c,a))return!0}return!1}static isTimeBetween(e,i,r,n){let a=this.timeToMinutes(e,n),s=this.timeToMinutes(i,n),o=this.timeToMinutes(r,n);return a>=s&&a<=o}static timeToMinutes(e,i){if(i==="12h"){let r=e.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!r)return 0;let n=parseInt(r[1]),a=parseInt(r[2]),s=r[3].toUpperCase();return s==="PM"&&n!==12&&(n+=12),s==="AM"&&n===12&&(n=0),n*60+a}else{let[r,n]=e.split(":").map(Number);return r*60+n}}static findNearestValid(e,i,r,n,a){let s=i==="24h"?23:12;for(let o=0;o<=s;o++){let l=o===0?[e]:[e+o,e-o];for(let c of l){let u=c;u<0&&(u+=s+1),u>s&&(u=u%(s+1));let d=this.indexToValue(u,i,r);if(!this.isDisabled(d,r,n))return u}}return e}},Iv=class{static angleToIndex(e){return Math.round(e/6)%60}static indexToValue(e){return e.toString().padStart(2,"0")}static indexToAngle(e){return e%60*6}static isDisabled(e,i,r,n,a){return n?n.isInterval&&n.intervals?this.isDisabledByInterval(e,i,r,n,a):n.minutes?n.minutes.some(s=>String(s)===e||Number(s)===Number(e)||s===e):!1:!1}static isDisabledByInterval(e,i,r,n,a){if(!n.intervals)return!1;let s=a==="12h"?`${i}:${e} ${r}`:`${i}:${e}`;for(let o of n.intervals){let[l,c]=o.split("-").map(u=>u.trim());if(this.isTimeBetween(s,l,c,a))return!0}return!1}static isTimeBetween(e,i,r,n){let a=this.timeToMinutes(e,n),s=this.timeToMinutes(i,n),o=this.timeToMinutes(r,n);return a>=s&&a<=o}static timeToMinutes(e,i){if(i==="12h"){let r=e.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!r)return 0;let n=parseInt(r[1]),a=parseInt(r[2]),s=r[3].toUpperCase();return s==="PM"&&n!==12&&(n+=12),s==="AM"&&n===12&&(n=0),n*60+a}else{let[r,n]=e.split(":").map(Number);return r*60+n}}static findNearestValid(e,i,r,n,a){for(let s=0;s<60;s++){let o=s===0?[e]:[e+s,e-s];for(let l of o){let c=l;c<0&&(c+=60),c>=60&&(c=c%60);let u=this.indexToValue(c);if(!this.isDisabled(u,i,r,n,a))return c}}return e}},OS=class{static normalizeAngle(e){let i=e%360;return i<0&&(i+=360),i}static calculateRawAngle(e,i){let r=e.x-i.x,n=e.y-i.y,a=Math.atan2(n,r)*180/Math.PI+90;return this.normalizeAngle(a)}static snapToIncrement(e,i){let r=Math.round(e/i)*i;return this.normalizeAngle(r)}static calculateDistance(e,i){let r=e.x-i.x,n=e.y-i.y;return Math.sqrt(r*r+n*n)}static isInnerCircle(e,i){return e<i*.6}static calculateShortestPath(e,i){let r=this.normalizeAngle(e),n=this.normalizeAngle(i)-r,a=n>=0?n:n+360,s=n<=0?n:n-360,o=Math.abs(a)<Math.abs(s)?a:s;return e+o}},wnt=class{config;currentAngle=0;tipsCache=new Map;cachedDimensions=new Map;constructor(t){this.config=t}getCachedDimensions(t){let e=this.cachedDimensions.get(t);if(!e){let i=(t.offsetWidth-32)/2,r=(t.offsetHeight-32)/2,n=i-9;e={width:i,height:r,radius:n},this.cachedDimensions.set(t,e)}return e}setHandAngle(t){if(Math.abs(this.currentAngle-t)<.1)return;let e=OS.calculateShortestPath(this.currentAngle,t);this.currentAngle=e,this.config.clockHand.style.transform=`rotateZ(${e}deg)`}setActiveValue(t){let e=[this.config.tipsWrapper];this.config.tipsWrapperFor24h&&e.push(this.config.tipsWrapperFor24h),e.forEach(i=>{i.querySelectorAll(".tp-ui-value-tips, .tp-ui-value-tips-24h").forEach(r=>{let n=r;n.textContent===t||Number(n.textContent)===Number(t)?(n.classList.add("active"),n.setAttribute("aria-selected","true")):(n.classList.remove("active"),n.setAttribute("aria-selected","false"))})})}renderTips(t,e,i,r,n,a=!0,s,o="",l="12"){if(ic()===!1)return;let c=s||this.config.tipsWrapper;a&&(c.innerHTML="",this.tipsCache.clear());let{width:u,height:d,radius:p}=this.getCachedDimensions(c),h=document.createDocumentFragment(),f=`${e}-${this.config.theme||"default"}`;t.forEach((m,g)=>{let v=`${f}-${m}`,y=this.tipsCache.get(v);y||(y=this.createTip(m,e,n),this.tipsCache.set(v,y));let{wrapper:b,tip:I}=y;this.updateTipState(b,I,m,i,r,n,o,l);let w=g*(360/t.length)*(Math.PI/180);b.style.left=`${u+Math.sin(w)*p}px`,b.style.bottom=`${d+Math.cos(w)*p}px`,h.appendChild(b)}),c.appendChild(h)}createTip(t,e,i){if(ic()===!1){let s={};return{wrapper:s,tip:s}}let r=document.createElement("span"),n=document.createElement("span");n.textContent=t,n.setAttribute("role","option"),n.setAttribute("aria-selected","false"),n.tabIndex=0;let a=i==="24h"&&e.includes("24")?"tp-ui-value-tips-24h":"tp-ui-value-tips";return n.classList.add(a),r.classList.add(e),this.config.theme&&(r.classList.add(this.config.theme),n.classList.add(this.config.theme)),r.appendChild(n),{wrapper:r,tip:n}}updateTipState(t,e,i,r,n,a,s,o){t.classList.remove("tp-ui-tips-disabled"),e.classList.remove("tp-ui-tips-disabled"),e.removeAttribute("aria-disabled"),e.tabIndex=0,this.checkIfDisabled(i,r,n,a,s,o)&&(t.classList.add("tp-ui-tips-disabled"),e.classList.add("tp-ui-tips-disabled"),e.setAttribute("aria-disabled","true"),e.tabIndex=-1)}checkIfDisabled(t,e,i,r,n,a){return i?e==="hours"?bv.isDisabled(t,n,i):e==="minutes"?Iv.isDisabled(t,a,n,i,r):!1:!1}setCircleSize(t){t?this.config.circle.classList.remove("small-circle"):this.config.circle.classList.add("small-circle")}setCircle24hMode(t){t?(this.config.circle.classList.add("tp-ui-circle-hand-24h"),this.config.clockHand.classList.add("tp-ui-clock-hand-24h")):(this.config.circle.classList.remove("tp-ui-circle-hand-24h"),this.config.clockHand.classList.remove("tp-ui-clock-hand-24h"))}destroy(){this.tipsCache.clear(),this.cachedDimensions.clear(),this.config.tipsWrapper.innerHTML=""}},uQ=class{static processPointerInput(e){let i=OS.calculateRawAngle(e.pointerPosition,e.clockCenter);return e.mode==="hours"?this.processHours(i,e):this.processMinutes(i,e)}static processHours(e,i){let r=i.incrementHours*30,n=OS.snapToIncrement(e,r),a=OS.calculateDistance(i.pointerPosition,i.clockCenter),s=i.clockType==="24h"&&OS.isInnerCircle(a,i.clockRadius),o=bv.angleToIndex(n,i.clockType,s),l=bv.indexToValue(o,i.clockType,i.amPm),c=bv.isDisabled(l,i.amPm,i.disabledTime);c&&(o=bv.findNearestValid(o,i.clockType,i.amPm,i.disabledTime,s));let u=bv.indexToValue(o,i.clockType,i.amPm);return{angle:bv.indexToAngle(o,i.clockType),value:u,index:o,isValid:!c,isInnerCircle:i.clockType==="24h"?s:void 0}}static processMinutes(e,i){let r=i.incrementMinutes*6,n=OS.snapToIncrement(e,r),a=Iv.angleToIndex(n),s=Iv.indexToValue(a),o=i.currentHour||"00",l=Iv.isDisabled(s,o,i.amPm,i.disabledTime,i.clockType);l&&(a=Iv.findNearestValid(a,o,i.amPm,i.disabledTime,i.clockType));let c=Iv.indexToValue(a);return{angle:Iv.indexToAngle(a),value:c,index:a,isValid:!l}}static valueToAngle(e,i,r){let n=parseInt(e,10);return i==="hours"?bv.indexToAngle(n,r):Iv.indexToAngle(n)}},Snt=class{state;renderer;clockType;disabledTime;incrementHours;incrementMinutes;isDragging=!1;callbacks;constructor(t,e,i,r,n=1,a=1,s={}){this.renderer=t,this.state={...e},this.clockType=i,this.disabledTime=r,this.incrementHours=n,this.incrementMinutes=a,this.callbacks=s}handlePointerMove(t,e,i){this.isDragging=!0;let r={pointerPosition:t,clockCenter:e,clockRadius:i,mode:this.state.mode,clockType:this.clockType,amPm:this.state.amPm,disabledTime:this.disabledTime,incrementHours:this.incrementHours,incrementMinutes:this.incrementMinutes,currentHour:this.state.hour},n=uQ.processPointerInput(r);n.isValid&&(this.state.mode==="hours"?(this.state.hour=n.value,this.state.hourAngle=n.angle,this.clockType==="24h"&&n.isInnerCircle!==void 0&&(this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n.isInnerCircle)),this.callbacks.onHourChange&&this.callbacks.onHourChange(n.value)):(this.state.minute=n.value,this.state.minuteAngle=n.angle,this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1),this.callbacks.onMinuteChange&&this.callbacks.onMinuteChange(n.value)),this.renderer.setHandAngle(n.angle),this.renderer.setActiveValue(n.value))}handlePointerUp(){this.isDragging=!1}switchMode(t){this.state.mode,this.state.mode=t;let e=t==="hours"?this.state.hourAngle:this.state.minuteAngle,i=t==="hours"?this.state.hour:this.state.minute;if(t==="hours"&&this.clockType==="24h"){let r=parseInt(i,10),n=r===0||r>=13;this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n)}else this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1);this.renderer.setHandAngle(e),this.renderer.setActiveValue(i)}setValue(t,e){let i=uQ.valueToAngle(e,t,this.clockType);if(t==="hours")if(this.state.hour=e,this.state.hourAngle=i,this.clockType==="24h"){let r=parseInt(e,10),n=r===0||r>=13;this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(n)}else this.renderer.setCircle24hMode(!1);else this.state.minute=e,this.state.minuteAngle=i,this.renderer.setCircleSize(!0),this.renderer.setCircle24hMode(!1);this.state.mode===t&&(this.renderer.setHandAngle(i),this.renderer.setActiveValue(e))}setAmPm(t){this.state.amPm=t}getState(){return{...this.state}}getHour(){return this.state.hour}getMinute(){return this.state.minute}getAmPm(){return this.state.amPm}updateDisabledTime(t){this.disabledTime=t}destroy(){this.renderer.destroy()}},Tnt=class{controller;clockFace;isActive=!1;config;cachedRect=null;cachedCenter=null;cachedRadius=null;constructor(t,e,i={}){this.controller=t,this.clockFace=e,this.config=i}attach(){this.clockFace.addEventListener("mousedown",this.handlePointerDown),this.clockFace.addEventListener("touchstart",this.handlePointerDown,{passive:!1})}detach(){this.clockFace.removeEventListener("mousedown",this.handlePointerDown),this.clockFace.removeEventListener("touchstart",this.handlePointerDown),this.removeGlobalListeners()}handlePointerDown=t=>{if(Gv())return;let e=t.target;e&&e.classList&&e.classList.contains("tp-ui-tips-disabled")||(t.preventDefault(),this.isActive=!0,this.cachedRect=this.clockFace.getBoundingClientRect(),this.cachedCenter=this.getClockCenter(),this.cachedRadius=this.getClockRadius(),this.processPointerEvent(t),document.addEventListener("mousemove",this.handlePointerMove),document.addEventListener("touchmove",this.handlePointerMove,{passive:!1}),document.addEventListener("mouseup",this.handlePointerUp),document.addEventListener("touchend",this.handlePointerUp))};handlePointerMove=t=>{if(!this.isActive)return;let e=this.getTargetElement(t);e&&e.classList&&e.classList.contains("tp-ui-tips-disabled")||(t.preventDefault(),this.processPointerEvent(t))};handlePointerUp=()=>{if(!this.isActive)return;this.isActive=!1,this.cachedRect=null,this.cachedCenter=null,this.cachedRadius=null,this.controller.handlePointerUp(),this.removeGlobalListeners();let{autoSwitchToMinutes:t,isMobileView:e,hourElement:i,minutesElement:r}=this.config;t&&i?.classList.contains("active")&&!e&&(r?.click(),r?.focus())};processPointerEvent(t){let e=this.getPointerPosition(t),i=this.cachedCenter||this.getClockCenter(),r=this.cachedRadius||this.getClockRadius();this.controller.handlePointerMove(e,i,r)}getPointerPosition(t){let e=this.cachedRect||this.clockFace.getBoundingClientRect();if("touches"in t){let i=t.touches[0]||t.changedTouches[0];return{x:i.clientX-e.left,y:i.clientY-e.top}}else return{x:t.clientX-e.left,y:t.clientY-e.top}}getTargetElement(t){if("touches"in t){let e=t.touches[0]||t.changedTouches[0];if(e&&!Gv())return document.elementFromPoint(e.clientX,e.clientY)}return t.target}getClockCenter(){let t=this.clockFace.offsetWidth,e=this.clockFace.offsetHeight;return{x:t/2,y:e/2}}getClockRadius(){return this.clockFace.offsetWidth/2}removeGlobalListeners(){ic()!==!1&&(document.removeEventListener("mousemove",this.handlePointerMove),document.removeEventListener("touchmove",this.handlePointerMove),document.removeEventListener("mouseup",this.handlePointerUp),document.removeEventListener("touchend",this.handlePointerUp))}},Unt=class{renderer;controller;dragHandlers;clockType;disabledTime;tipsWrapper;tipsWrapperFor24h;constructor(e){this.clockType=e.clockType,this.disabledTime=e.disabledTime,this.tipsWrapper=e.tipsWrapper,this.tipsWrapperFor24h=e.tipsWrapperFor24h;let i={clockFace:e.clockFace,tipsWrapper:e.tipsWrapper,tipsWrapperFor24h:e.tipsWrapperFor24h,clockHand:e.clockHand,circle:e.circle,theme:e.theme};this.renderer=new wnt(i);let r={hour:e.initialHour,minute:e.initialMinute,amPm:e.initialAmPm,hourAngle:this.calculateInitialAngle("hours",e.initialHour),minuteAngle:this.calculateInitialAngle("minutes",e.initialMinute),mode:"hours"},n={onHourChange:e.onHourChange,onMinuteChange:e.onMinuteChange};this.controller=new Snt(this.renderer,r,e.clockType,e.disabledTime,e.incrementHours||1,e.incrementMinutes||1,n),this.dragHandlers=new Tnt(this.controller,e.clockFace,e.dragConfig||{})}initialize(){this.dragHandlers.attach(),this.switchToHours()}switchToHours(){this.controller.switchMode("hours"),this.clockType==="24h"&&this.tipsWrapperFor24h&&this.tipsWrapperFor24h.classList.remove("none"),this.renderHourTips();let e=this.controller.getState();this.renderer.setActiveValue(e.hour)}switchToMinutes(){this.controller.switchMode("minutes"),this.tipsWrapperFor24h&&this.tipsWrapperFor24h.classList.add("none"),this.renderMinuteTips();let e=this.controller.getState();this.renderer.setActiveValue(e.minute)}setHour(e){this.controller.setValue("hours",e)}setMinute(e){this.controller.setValue("minutes",e)}setAmPm(e){this.controller.setAmPm(e);let i=this.controller.getState();i.mode==="hours"?(this.renderHourTips(),this.renderer.setHandAngle(i.hourAngle),this.renderer.setActiveValue(i.hour)):(this.renderMinuteTips(),this.renderer.setHandAngle(i.minuteAngle),this.renderer.setActiveValue(i.minute))}getHour(){return this.controller.getHour()}getMinute(){return this.controller.getMinute()}getAmPm(){return this.controller.getAmPm()}updateDisabledTime(e){this.controller.updateDisabledTime(e),this.controller.getState().mode==="hours"?this.renderHourTips():this.renderMinuteTips()}renderHourTips(){let e=this.controller.getState().amPm;this.clockType==="24h"?(this.renderer.renderTips(sQ,"tp-ui-hour-time-12","hours",this.disabledTime,this.clockType,!0,this.tipsWrapper,e),this.tipsWrapperFor24h&&this.renderer.renderTips(unt,"tp-ui-hour-time-24","hours",this.disabledTime,this.clockType,!0,this.tipsWrapperFor24h,e)):this.renderer.renderTips(sQ,"tp-ui-hour-time-12","hours",this.disabledTime,this.clockType,!0,void 0,e)}renderMinuteTips(){let e=this.controller.getState(),i=e.amPm,r=e.hour;this.renderer.renderTips(pG,"tp-ui-minutes-time","minutes",this.disabledTime,this.clockType,!0,void 0,i,r)}calculateInitialAngle(e,i){let r=parseInt(i,10);return e==="hours"?r%12*30:r*6}destroy(){this.dragHandlers.detach(),this.controller.destroy()}},Dnt=class{core;emitter;clockSystem=null;constructor(e,i){this.core=e,this.emitter=i,this.setupEventListeners()}setupEventListeners(){this.emitter.on("select:hour",({hour:e})=>{this.emitter.emit("animation:clock",{}),this.setHoursToClock(e||null)}),this.emitter.on("select:minute",({minutes:e})=>{this.emitter.emit("animation:clock",{}),this.setMinutesToClock(e||null)}),this.emitter.on("select:am",()=>{this.updateAmPm()}),this.emitter.on("select:pm",()=>{this.updateAmPm()})}initializeClockSystem(){let e=this.core.getClockFace(),i=this.core.getClockHand(),r=this.core.getCircle();if(!e||!i||!r)return;let n=this.core.options.clock.type==="24h",a=this.core.getTipsWrapper();if(!a)return;let s=this.core.getHour(),o=this.core.getMinutes(),l={clockFace:e,tipsWrapper:a,tipsWrapperFor24h:n&&this.core.getTipsWrapperFor24h()||void 0,clockHand:i,circle:r,clockType:this.core.options.clock.type||"12h",disabledTime:this.convertDisabledTime(),initialHour:s?.value||"12",initialMinute:o?.value||"00",initialAmPm:this.getAmPmValue(),theme:this.core.options.ui.theme,incrementHours:this.core.options.clock.incrementHours||1,incrementMinutes:this.core.options.clock.incrementMinutes||1,timepicker:null,dragConfig:{autoSwitchToMinutes:this.core.options.clock.autoSwitchToMinutes,isMobileView:this.core.isMobileView,hourElement:s,minutesElement:o},onHourChange:c=>{let u=this.core.getHour();u&&(u.value=c);let d=this.core.getMinutes(),p=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:c,minutes:d?.value,type:p?.textContent||void 0})},onMinuteChange:c=>{let u=this.core.getMinutes();u&&(u.value=c);let d=this.core.getHour(),p=this.core.getActiveTypeMode();this.emitter.emit("update",{hour:d?.value,minutes:c,type:p?.textContent||void 0})}};this.clockSystem=new Unt(l),this.clockSystem.initialize()}convertDisabledTime(){let e=this.core.disabledTime?.value;if(!e)return null;let i;return e.intervals&&(i=Array.isArray(e.intervals)?e.intervals:[e.intervals]),{hours:e.hours,minutes:e.minutes,isInterval:e.isInterval,intervals:i,clockType:e.clockType}}getAmPmValue(){if(this.core.options.clock.type==="24h")return"";let e=this.core.getActiveTypeMode();if(e){let i=e.textContent?.trim();if(i==="AM"||i==="PM")return i}return this.core.getAM()?.classList.contains("active")?"AM":"PM"}destroyClockSystem(){this.clockSystem&&(this.clockSystem.destroy(),this.clockSystem=null)}removeCircleClockClasses24h(){let e=this.core.getCircle(),i=this.core.getClockHand();e?.classList.remove("tp-ui-circle-hand-24h"),i?.classList.remove("tp-ui-clock-hand-24h")}setCircleClockClasses24h(){let e=this.core.getCircle(),i=this.core.getClockHand();e&&e.classList.add("tp-ui-circle-hand-24h"),i&&i.classList.add("tp-ui-clock-hand-24h")}setOnStartCSSClassesIfClockType24h(){if(this.core.options.clock.type==="24h"){let e=this.core.getInput();if(!e)return;let i;e.value.length>0&&(i=e.value.split(":")[0]),i&&(Number(i)>12||Number(i)===0)&&this.setCircleClockClasses24h()}}setBgColorToCircleWithMinutesTips=()=>{let e=this.core.getMinutes(),i=this.core.getCircle();if(!(!e||!i)&&e.value&&pG.includes(e.value)){let r=getComputedStyle(i).getPropertyValue("--timepicker-primary").trim();r&&(i.style.backgroundColor=r),i.classList.remove("small-circle")}};removeBgColorToCirleWithMinutesTips=()=>{let e=this.core.getMinutes(),i=this.core.getCircle();!e||!i||e.value&&pG.includes(e.value)||(i.style.backgroundColor="",i.classList.add("small-circle"))};setClassActiveToHourOnOpen=()=>{this.core.options.ui.mobile||this.core.isMobileView||this.core.getHour()?.classList.add(gP)};setMinutesToClock=e=>{this.clockSystem&&(this.removeBgColorToCirleWithMinutesTips(),e&&this.clockSystem.setMinute(e),this.clockSystem.switchToMinutes())};setHoursToClock=e=>{this.clockSystem&&(e&&this.clockSystem.setHour(e),this.clockSystem.switchToHours())};setTransformToCircleWithSwitchesHour=e=>{!this.clockSystem||!e||this.clockSystem.setHour(e)};setTransformToCircleWithSwitchesMinutes=e=>{!this.clockSystem||!e||this.clockSystem.setMinute(e)};updateAmPm=()=>{if(!this.clockSystem||this.core.options.clock.type==="24h")return;let e=this.getAmPmValue();e!==""&&this.clockSystem.setAmPm(e)};toggleClassActiveToValueTips=e=>{if(this.clockSystem)return;let i=this.core.getAllValueTips();if(!i)return;let r=i.find(n=>Number(n.innerText)===Number(e));i.forEach(n=>{n.classList.remove(gP),n.setAttribute("aria-selected","false")}),r!==void 0&&(r.classList.add(gP),r.setAttribute("aria-selected","true"))};destroy(){this.destroyClockSystem()}},Ent=class{animation;modal;config;theme;validation;events;clock;constructor(t,e){this.animation=new nnt(t,e),this.modal=new pnt(t,e),this.config=new vnt(t,e),this.theme=new ynt(t,e),this.validation=new bnt(t,e),this.events=new Int(t,e),this.clock=new Dnt(t,e)}destroy(){this.animation.destroy(),this.modal.destroy(),this.config.destroy(),this.theme.destroy(),this.validation.destroy(),this.events.destroy(),this.clock.destroy()}},X_="is-rippling",J_="ripple-hold",cT=null;function Pnt(t){let e=t.target,i=e.hasAttribute("data-md3-ripple")?e:e.closest("[data-md3-ripple]");if(!i||t.button!==0&&t.pointerType==="mouse")return;let r=i.getBoundingClientRect(),n=Math.max(r.width,r.height)*2,a=t.clientX-r.left,s=t.clientY-r.top;i.style.setProperty("--ripple-size",`${n}px`),i.style.setProperty("--ripple-x",`${a}px`),i.style.setProperty("--ripple-y",`${s}px`),i.classList.remove(X_,J_),i.offsetWidth,i.classList.add(X_,J_),i._rippleHold=!0,cT=i}function dQ(t){let e=t.target,i=(e.hasAttribute("data-md3-ripple")?e:e.closest("[data-md3-ripple]"))||cT;i&&(i._rippleHold=!1,i.classList.remove(J_),setTimeout(()=>{i.classList.remove(X_),cT===i&&(cT=null)},1e3))}function Cnt(t){let e=t.currentTarget;!e||!e._rippleHold||(e._rippleHold=!1,e.classList.remove(J_),setTimeout(()=>{e.classList.remove(X_),cT===e&&(cT=null)},1e3))}function Rnt(t){if(ic()===!1)return;let e=t||document;e.addEventListener("pointerdown",Pnt),e.addEventListener("pointerup",dQ),e.addEventListener("pointercancel",dQ),e.querySelectorAll("[data-md3-ripple]").forEach(i=>{i.addEventListener("mouseleave",Cnt)})}var Mnt=(t,e)=>{let i;return(...r)=>{clearTimeout(i),i=setTimeout(()=>{t(...r)},e)}},Nnt=class{core;managers;emitter;eventsClickMobileHandler=()=>{};mutliEventsMoveHandler=()=>{};constructor(t,e,i){this.core=t,this.managers=e,this.emitter=i}init(){if(!this.core.isDestroyed&&!this.core.isInitialized){try{this.managers.config.updateInputValueWithCurrentTimeOnStart(),this.managers.validation.checkDisabledValuesOnStart()}catch{this.core.setIsDestroyed(!0);return}this.managers.theme.setTimepickerClassToElement(),this.managers.theme.setInputClassToInputElement(),this.managers.theme.setDataOpenToInputIfDoesntExistInWrapper(),this.managers.theme.setClassTopOpenElement(),this.managers.config.getDisableTime(),this.core.options.ui.inline?.enabled||this.managers.events.handleOpenOnClick(),this.managers.events.handleOpenOnEnterFocus(),this.setupCallbackBridge(),this.core.setIsInitialized(!0)}}setupCallbackBridge(){let{callbacks:t}=this.core.options;t.onOpen&&this.emitter.on("open",t.onOpen),t.onCancel&&this.emitter.on("cancel",t.onCancel),t.onConfirm&&this.emitter.on("confirm",t.onConfirm),t.onUpdate&&this.emitter.on("update",t.onUpdate),t.onSelectHour&&this.emitter.on("select:hour",t.onSelectHour),t.onSelectMinute&&this.emitter.on("select:minute",t.onSelectMinute),t.onSelectAM&&this.emitter.on("select:am",t.onSelectAM),t.onSelectPM&&this.emitter.on("select:pm",t.onSelectPM),t.onError&&this.emitter.on("error",t.onError)}mount(){this.core.isDestroyed||(this.core.isInitialized||this.init(),this.eventsBundle())}unmount(t){let e=Mnt((...i)=>{if(i.length>2||!this.core.getModalElement())return;let[r]=i.filter(a=>typeof a=="boolean"),[n]=i.filter(a=>typeof a=="function");this.core.setIsMobileView(!!this.core.options.ui.mobile),r&&this.core.getOkButton()?.click(),this.core.setIsTouchMouseMove(!1),this.removeEventListeners(),this.managers.animation.removeAnimationToClose(),this.core.getOpenElement().forEach(a=>a?.classList.remove("disabled")),setTimeout(()=>{typeof document<"u"&&(document.body.style.overflowY="",document.body.style.paddingRight="")},up.SCROLLBAR_RESTORE),setTimeout(()=>{let a=this.core.getInput();this.core.options.behavior.focusInputAfterClose&&a?.focus();let s=this.core.getModalElement();s!==null&&(s.remove(),this.core.setIsModalRemove(!0))},up.MODAL_REMOVE),n&&n()},this.core.options.behavior.delayHandler||up.DEFAULT_DELAY);t?e(t):e()}destroy(t){if(this.core.isDestroyed)return;let e=typeof t=="function"?{callback:t}:t||{},{keepInputValue:i=!1,callback:r}=e,n=this.core.getInput(),a=i?n?.value:null;this.removeEventListeners(),this.core.getModalElement()?.remove(),this.core.getOpenElement()?.forEach(o=>{o&&(o.classList.remove("disabled","active","tp-ui-open-element"),o.classList.remove("basic","crane-straight","crane","m2","m3-green"))}),n&&(n.classList.remove("tp-ui-invalid-format","invalid-value","error","active","tp-ui-input"),n.removeAttribute("data-open"),n.removeAttribute("data-owner-id"),i&&a&&(n.value=a));let s=this.core.element;s&&(s.classList.remove("basic","crane-straight","crane","m2","m3-green"),s.classList.remove("error","active","disabled"),s.removeAttribute("data-owner-id"),s.removeAttribute("data-open"),this.core.options.ui.cssClass&&s.classList.remove(this.core.options.ui.cssClass)),s?.querySelectorAll(".tp-ui-invalid-text")?.forEach(o=>o.remove()),this.mutliEventsMoveHandler=()=>{},this.eventsClickMobileHandler=()=>{},this.core.reset(),this.managers.destroy(),this.emitter.clear(),Gv()||(document.body.style.overflowY="",document.body.style.paddingRight=""),r&&r()}eventsBundle(){if(this.core.isDestroyed||!this.core.isModalRemove)return;if(this.managers.validation.setErrorHandler(),this.managers.validation.removeErrorHandler(),!this.core.options.ui.inline?.enabled){let i=this.core.getOpenElement(),r=this.core.getInput();i.forEach(n=>n?.classList.add("disabled")),r?.blur()}if(this.managers.modal.setScrollbarOrNot(),this.managers.modal.setModalTemplate(),this.managers.modal.setNormalizeClass(),this.managers.modal.removeBackdrop(),this.core.isMobileView)this.managers.config.updateClockFaceAccessibility(!0);else{let i=this.core.getModalElement(),r=i?.querySelector(".tp-ui-mobile-clock-wrapper"),n=i?.querySelector(".tp-ui-wrapper"),a=i?.querySelectorAll("*");r?.classList.add("expanded"),n?.classList.add("expanded"),a?.forEach(s=>{!s.classList.contains("tp-ui-select-time")&&!s.classList.contains("tp-ui-mobile-clock-wrapper")&&!s.classList.contains("tp-ui-wrapper")&&s.classList.add("expanded")})}this.managers.modal.setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this.managers.theme.setTheme();let i=this.core.getWrapper();i&&this.core.options.ui.cssClass&&i.classList.add(this.core.options.ui.cssClass)},0),this.managers.animation.setAnimationToOpen(),this.managers.config.getInputValueOnOpenAndSet(),this.managers.clock.initializeClockSystem(),this.managers.clock.setOnStartCSSClassesIfClockType24h(),this.managers.clock.setClassActiveToHourOnOpen(),this.managers.events.handleCancelButton(),this.managers.events.handleOkButton(),this.managers.events.handleHourEvents(),this.managers.events.handleMinutesEvents(),this.managers.events.handleKeyboardInput(),this.core.options.ui.enableSwitchIcon&&this.managers.events.handleSwitchViewButton(),this.core.options.clock.type!=="24h"&&(this.managers.events.handleAmClick(),this.managers.events.handlePmClick()),this.core.options.behavior.focusTrap&&this.managers.events.focusTrapHandler(),this.core.options.ui.inline?.enabled||(this.managers.events.handleEscClick(),this.managers.events.handleBackdropClick());let t=this.core.getModalElement();t&&Rnt(t);let e=this.core.getClockFace();e&&typeof requestAnimationFrame<"u"&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{e?.classList.add("scale-in")})}),this.managers.modal.setShowClassToBackdrop()}removeEventListeners(){ic()!==!1&&(gnt.split(" ").forEach(t=>{document.removeEventListener(t,this.mutliEventsMoveHandler,!1)}),document.removeEventListener("mousedown",this.eventsClickMobileHandler))}},Ant=class{events=new Map;on(e,i){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(i)}once(e,i){let r=n=>{i(n),this.off(e,r)};this.on(e,r)}off(e,i){i?this.events.get(e)?.delete(i):this.events.delete(e)}emit(e,i){this.events.get(e)?.forEach(r=>{r(i)})}clear(){this.events.clear()}hasListeners(e){return(this.events.get(e)?.size??0)>0}},vE={clock:{type:"12h",incrementHours:1,incrementMinutes:1,autoSwitchToMinutes:!1,disabledTime:void 0,currentTime:void 0},ui:{theme:"basic",animation:!0,backdrop:!0,mobile:!1,enableSwitchIcon:!1,editable:!1,enableScrollbar:!1,cssClass:void 0,appendModalSelector:"",iconTemplate:"",iconTemplateMobile:"",inline:void 0},labels:{am:"AM",pm:"PM",ok:"OK",cancel:"Cancel",time:"Select time",mobileTime:"Enter Time",mobileHour:"Hour",mobileMinute:"Minute"},behavior:{focusInputAfterClose:!1,focusTrap:!0,delayHandler:300,id:void 0},callbacks:{onOpen:void 0,onCancel:void 0,onConfirm:void 0,onUpdate:void 0,onSelectHour:void 0,onSelectMinute:void 0,onSelectAM:void 0,onSelectPM:void 0,onError:void 0}};function _nt(t={}){return{clock:{...vE.clock,...t.clock||{}},ui:{...vE.ui,...t.ui||{}},labels:{...vE.labels,...t.labels||{}},behavior:{...vE.behavior,...t.behavior||{}},callbacks:{...vE.callbacks,...t.callbacks||{}}}}var knt=t=>t.replace(/[^0-9:APMapm\s]/g,""),SS=new Map,Ont=class{core;managers;lifecycle;emitter;constructor(e,i){if(Gv())throw new Error("TimepickerUI requires browser environment");let r=this.resolveInputElement(e);if(!r)throw new Error("Input element not found");let n=i?.behavior?.id,a=n||`tp-ui-${ont()}`,s=this.createWrapperElement(r),o=_nt(i||{});if(o.ui.inline?.enabled&&typeof i?.behavior?.focusTrap>"u"&&(o.behavior.focusTrap=!1),o.ui.inline?.enabled){if(!o.ui.inline.containerId)throw new Error("inline.containerId is required when inline mode is enabled");if(!Gv()&&!document.getElementById(o.ui.inline.containerId))throw new Error(`Container element with id "${o.ui.inline.containerId}" not found`)}this.emitter=new Ant,this.core=new rnt(s,o,a,n);let l=this.core.getInput();if(l){let c=Av(l,o.clock.type),u=Number(c.hour)*30,d=Number(c.minutes)*6;this.core.setDegreesHours(u),this.core.setDegreesMinutes(d)}this.managers=new Ent(this.core,this.emitter),this.lifecycle=new Nnt(this.core,this.managers,this.emitter),this.managers.config.checkMobileOption(),this.managers.config.preventClockTypeByCurrentTime(),this.setupInternalEventListeners(),SS.set(this.core.instanceId,this)}setupInternalEventListeners(){this.emitter.on("show",()=>{this.core.isDestroyed||this.lifecycle.mount()}),this.emitter.on("cancel",()=>{this.core.isDestroyed||this.lifecycle.unmount()}),this.emitter.on("confirm",e=>{if(!this.core.isDestroyed){let i=this.core.getInput();if(i&&e.hour&&e.minutes){let r=e.type?` ${e.type}`:"";i.value=`${e.hour}:${e.minutes}${r}`}this.lifecycle.unmount()}})}create(){this.lifecycle.init(),this.core.options.ui.inline?.enabled&&this.lifecycle.mount()}open(e){this.lifecycle.mount(),e&&e()}close(e,i){this.lifecycle.unmount(e?i:void 0),!e&&i&&i()}destroy(e){SS.delete(this.core.instanceId),this.lifecycle.destroy(e)}update(e,i){this.core.isDestroyed||(this.core.updateOptions(e.options),this.managers.config.checkMobileOption(),e.create&&this.create(),i&&i())}getValue(){if(this.core.isDestroyed)return{hour:"",minutes:"",type:void 0,time:"",degreesHours:null,degreesMinutes:null};let e=this.core.getHour(),i=this.core.getMinutes(),r=this.core.getActiveTypeMode(),n=e?.value||"12",a=i?.value||"00",s=this.core.options.clock.type==="24h"?void 0:r?.textContent||"AM",o="";return this.core.options.clock.type==="24h"?o=`${n.padStart(2,"0")}:${a.padStart(2,"0")}`:o=`${n}:${a.padStart(2,"0")} ${s}`,{hour:n,minutes:a,type:s,time:o,degreesHours:this.core.degreesHours,degreesMinutes:this.core.degreesMinutes}}setValue(e,i=!0){if(this.core.isDestroyed||!e||typeof e!="string")return;this.core.isInitialized||this.create();let r=knt(e.trim()),n="12",a="00",s="AM";try{if(this.core.options.clock.type==="24h"){let p=r.match(/^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/);if(!p)throw new Error("Invalid 24h format. Expected HH:MM");n=p[1].padStart(2,"0"),a=p[2]}else{let p=r.match(/^(1[0-2]|[1-9]):([0-5][0-9])\s*(AM|PM)$/i);if(!p)throw new Error("Invalid 12h format. Expected HH:MM AM/PM");n=p[1],a=p[2],s=p[3].toUpperCase()}let o=this.core.getHour(),l=this.core.getMinutes(),c=this.core.getAM(),u=this.core.getPM();if(o&&(o.value=n,o.setAttribute("aria-valuenow",n),this.core.setDegreesHours(Number(n)*30)),l&&(l.value=a,l.setAttribute("aria-valuenow",a),this.core.setDegreesMinutes(Number(a)*6)),this.core.options.clock.type!=="24h"&&c&&u&&(s==="AM"?(c.classList.add("active"),u.classList.remove("active")):(u.classList.add("active"),c.classList.remove("active"))),i){let p=this.core.getInput();p&&(p.value=r)}let d=this.core.getClockHand();d&&(d.style.transform=`rotateZ(${this.core.degreesHours||0}deg)`)}catch{return}}getElement(){return this.core.element}get instanceId(){return this.core.instanceId}get options(){return this.core.options}get isInitialized(){return this.core.isInitialized}get isDestroyed(){return this.core.isDestroyed}get hour(){return this.core.getHour()}get minutes(){return this.core.getMinutes()}get okButton(){return this.core.getOkButton()}get cancelButton(){return this.core.getCancelButton()}get clockHand(){return this.core.getClockHand()}on(e,i){this.core.isDestroyed||this.emitter.on(e,i)}once(e,i){this.core.isDestroyed||this.emitter.once(e,i)}off(e,i){this.core.isDestroyed||this.emitter.off(e,i)}resolveInputElement(e){if(ic()===!1)return null;let i=null;if(typeof e=="string"){if(i=document.querySelector(e),!i)return null}else if(e instanceof HTMLElement)i=e;else return null;return i.tagName==="INPUT"?i:i.querySelector("input")}createWrapperElement(e){if(ic()===!1)return e;let i=e.parentElement;if(e.tagName==="INPUT"&&!i?.classList.contains("tp-ui")){let r=document.createElement("div");return r.className="tp-ui",e.parentNode?.insertBefore(r,e),r.appendChild(e),r}return i&&!i.classList.contains("tp-ui")&&i.classList.add("tp-ui"),i||e}static getById(e){return SS.get(e)}static getAllInstances(){return Array.from(SS.values())}static isAvailable(e){return Gv()?!1:typeof e=="string"?document.querySelector(e)!==null:e instanceof HTMLElement?document.contains(e):!1}static destroyAll(){Array.from(SS.values()).forEach(e=>e.destroy()),SS.clear()}},xnt=Ont;function IEe({time:t,options:e,callback:i}={}){const r=document.getElementById("timevalue");r.value=Lnt(t);const n=new xnt(document.getElementById("timepicker"),{clock:{type:"12h"},behavior:{autoSwitchToMinutes:!0},callbacks:{onConfirm:()=>{const a=r.value;Pt(i)&&i&&i({time:a}),n.destroy()}},...e});n.create(),n.open()}function Lnt(t,e){const i=Fnt(t||e?.schedule?.default_time);return i.ampm?t||"":(Number(i.hours)>12?(i.hours=(Number(i.hours)-12).toString(),i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes} ${i.ampm}`)}function Fnt(t){t=t||"00:00";const e=t?.split(" ")||[],i=e[0]?.split(":")||[];return{hours:i[0]||"00",minutes:i[1]||"00",ampm:e[1]}}const{AFTER_REST:pQ,FOLLOWED_BY:hQ,NEXT_AVAILABLE:fQ,NOT_BEFORE:mQ,TO_BE_ANNOUNCED:gQ}=gO;function wEe({e:t,cell:e,callback:i,matchUpId:r,rowData:n}={}){const a=n||e.getRow().getData(),s=v=>{const y=Object.values(a).filter(T=>T?.matchUpId),I=[{params:{matchUpIds:r?[r]:y.map(({matchUpId:T})=>T),schedule:v,removePriorValues:!0},method:G8}];qt({methods:I,callback:T=>{T.success&&Pt(i)&&i&&i(v)}})},o=v=>Q0({matchUp:v,matchUpId:r,callback:i}),l=()=>s({scheduledTime:"",timeModifiers:[]}),c=({time:v})=>{const b=Ni.dateTime.convertTime(v,!0)||"";s({scheduledTime:b})},u=()=>{const y=e.getTable().getData();let b;const I=y.flatMap((D,C)=>{if(!b&&!(D.rowId===a.rowId&&(b=C+1,C)))return Object.values(D).flatMap(E=>E?.schedule?.scheduledTime)}).filter(Boolean).map(irt),w=Math.max(...I,0),T=(b??0)>1,S=w&&rrt(w,T)||"8:00 AM";IEe({time:S,callback:c})},d=v=>s({timeModifiers:[v]}),p=r?"Set match time":"Set match times",h=Object.values(e.getData()).find(v=>v?.matchUpId===r),f=h?.readyToScore||h?.winningSide||h?.score?.sets,m=[{option:p,onClick:u},f&&{option:"Enter score",onClick:()=>o(h)},{option:lE[hQ],onClick:()=>d(hQ)},{option:lE[fQ],onClick:()=>d(fQ)},{option:lE[mQ],onClick:()=>d(mQ)},{option:lE[pQ],onClick:()=>d(pQ)},{option:lE[gQ],onClick:()=>d(gQ)},{option:"Clear time settings",onClick:l}].filter(Boolean),g=t.target;nu({options:m,target:g,config:{placement:Xt}})}function Bnt({column:t,courtInfo:e}){const i=e.courtId;Kr({title:"Rename Court",content:a=>pn(a,[{value:e.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:a})=>{const s=a?.courtName.value;s.length&&s!==e.courtName&&qt({methods:[{method:LUe,params:{courtId:i,modifications:{courtName:s}}}],callback:c=>{c.success?t.updateDefinition({title:s}):console.log({result:c})}})},close:!0}]})}function $nt(t,e,i){const n=[{option:`${$f.tr("remove")} court identifiers`,onClick:s},{option:$f.tr("rename"),onClick:()=>Bnt({column:e,courtInfo:i})}],a=t.target;nu({options:n,target:a});function s(){console.log("toggle court identifiers",{column:e})}}async function Vnt(t,e){t.preventDefault();const i=t.dataTransfer?.getData("itemid"),r=[],n=e.getTable(),a=n.getData(),s=e.getRow().getData(),o=n.getData().flatMap(P=>Object.values(P).filter(R=>R.matchUpId));let l=o.find(P=>P.matchUpId===i);l||(l=ks.findTable(`#${$b}`)[0].getData().map(M=>M.matchUp).find(M=>M.matchUpId===i)||{});const c=ht.displayed.selectedScheduleDate,{courtOrder:u,courtId:d,venueId:p}=l.schedule||{},h=t.currentTarget,f=h.id;if(i===f)return;const m=l.schedule,g=f&&o.find(P=>P.matchUpId===f),v=h.getAttribute("venueId"),y=h.getAttribute("courtId"),b=h.getAttribute("courtOrder"),I=Object.keys(s).find(P=>{if(!pp(s[P]))return;const R=s[P]?.schedule||{},{courtOrder:M,courtId:A,venueId:N}=R;return M?.toString()===b?.toString()&&N===v&&A===y});let w;const T=a.find(P=>(w=Object.keys(P).find(R=>{if(!pp(P[R]))return;const M=P[R]?.schedule||{},{courtOrder:A,courtId:N,venueId:k}=M;return A===u&&k===p&&N===d}),w)),S=()=>{qt({methods:r,engine:N3,callback:R=>{R.success||console.log({result:R}),Z_(n)}})},D=({scheduledTime:P="",timeModifiers:R=[]}={})=>{const M={courtOrder:b,scheduledDate:c,venueId:v,courtId:y,scheduledTime:P,timeModifiers:R};r.push({method:Hj,params:{tournamentId:l?.tournamentId,matchUpId:l?.matchUpId,schedule:M,drawId:l?.drawId,removePriorValues:!0}}),l.schedule=M},C={scheduledDate:m?.scheduledDate,scheduledTime:m?.scheduledTime,timeModifiers:m?.timeModifiers,courtOrder:u,venueId:p,courtId:d},E=()=>{r.push({method:Hj,params:{tournamentId:g?.tournamentId,matchUpId:g?.matchUpId,schedule:C,drawId:g?.drawId,removePriorValues:!0}}),g?g.schedule=C:console.log("missing targetMatchUp")};if(f==="")T?(D(),T[w]={schedule:{courtOrder:u,venueId:p,courtId:d}},T.rowId==s.rowId?(T[I]=l,n.updateData([T])):(s[I]=l,n.updateData([T,s]))):(ks.findTable(`#${$b}`)[0].deleteRow(i),D(),s[I]=l,n.updateData([s]));else if(!T&&g){const P=ks.findTable(`#${$b}`)[0];P.deleteRow(i),D(),s[I]=l,n.updateData([s]),P.addRow(KD(g),!0),E()}else{const P=g?.schedule;D({scheduledTime:P?.scheduledTime,timeModifiers:P?.timeModifiers}),E(),T.rowId==s.rowId?(T[w]=g,T[I]=l,n.updateData([T])):(T[w]=g,s[I]=l,n.updateData([T,s]))}S()}const{SCHEDULE_STATE:jnt,SCHEDULE_ERROR:Gnt,SCHEDULE_WARNING:Hnt,SCHEDULE_CONFLICT:znt}=So.scheduleConstants;function SEe(t){const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:s="",schedule:o={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d}=r||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=o;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=M=>M.preventDefault(),u)if(e.draggable=!0,e.id=u,c)e.classList.add("matchup-complete");else{const M=o[jnt];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):M===znt?e.classList.add("matchup-conflict"):M===Kpe?e.classList.add("matchup-issue"):M===Hnt?e.classList.add("matchup-warning"):M===Gnt&&e.classList.add("matchup-error")}if(e.addEventListener("drop",M=>Vnt(M,t)),e.addEventListener("dragstart",sEe),!u)return e;const v=`${a} ${s}`,y=M=>M.person?.standardFamilyName?.toUpperCase()||M.participantName,b=n?.map(M=>M?.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=M=>{const A=d?.find(N=>M===N.sideNumber)?.participant?.participantName;if(A)return c===M?`<span style='font-weight: bold'>${A}</span>`:A},w=I(1)||b?.shift()||"Unkown",T=I(2)||b?.shift()||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=(m?.[0]&&p2e[m[0]]+"&nbsp;"||"")+v9(h),e.appendChild(S);const D=document.createElement("div");D.className="catround",D.innerHTML=v,e.appendChild(D);const C=document.createElement("div");C.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style.fontSize="1em",E.innerHTML=w,C.appendChild(E);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",C.appendChild(P);const R=document.createElement("div");if(R.className="scheduled_team",R.style.fontSize="1em",R.innerHTML=T,C.appendChild(R),c){const M=document.createElement("div");M.innerHTML=r.score?.scoreStringSide1||"",C.appendChild(M)}return e.appendChild(C),e}function qnt({values:t,valueChange:e,isValid:i}){const r=(s,o)=>l=>l.length>=s&&(!o||l.length<=o),n=s=>!isNaN(Number(s)),a=s=>e(s);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:r(5),label:"Venue name",field:"venueName",focus:!0,onChange:a},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:r(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:a},{error:"Must be a whole number",value:t.courtsCount||"",validator:n,label:"Number of courts",field:"courtsCount",onChange:a}]}function Wnt(t){return{venueAbbreviation:t?.venueAbbreviation.value,courtsCount:t?.courtsCount.value,venueName:t?.venueName.value}}const Ynt=t=>{const e=Wnt(ht.drawer.attributes.content),{venueName:i,venueAbbreviation:r,courtsCount:n}=e,a=Ni.UUID();if(!i||!r||!n){$t({message:"Invalid values",intent:"is-danger"});return}const s=[{params:{venue:{venueName:i,venueAbbreviation:r,venueId:a},returnDetails:!0},method:CYe},{params:{courtsCount:parseInt(n),venueId:a,venueAbbreviationRoot:!0},method:gYe}];qt({methods:s,callback:l=>{if(l?.success&&Pt(t)&&t){const{venue:c}=We.findVenue({venueId:a});c&&t({...l,venue:c})}}})};function TEe(t){const e=()=>{},i=o=>o&&!isNaN(Number(o)),r=({inputs:o})=>{const l=!!(Bn(2,6)(o.venueAbbreviation.value)&&i(o.courtsCount.value)&&Bn(5)(o.venueName.value)),c=document.getElementById("addVenueButton");c&&(c.disabled=!l)},n=[{control:"venueAbbreviation",onInput:r},{control:"courtsCount",onInput:r},{control:"venueName",onInput:r}],a=o=>pn(o,qnt({values:{},valueChange:e}),n),s=(o,l)=>Ww(o,[{label:"Cancel",close:!0},{onClick:()=>Ynt(t),id:"addVenueButton",intent:"is-info",disabled:!0,label:"Add",close:!0}],l);ht.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:Xt,content:a,footer:s})}function Knt({courtsData:t,count:e}){const i=n=>{n.stopPropagation(),n.preventDefault(),TEe(UEe)},r=n=>n?"":t?.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>";return e>0?Ni.generateRange(0,e).map(n=>({headerClick:a=>n===0&&i(a),title:r(n),headerHozAlign:li,formatter:SEe,headerSort:!1,resizable:!1,minWidth:150})):[]}function Znt({notice:t,notes:e,callback:i}){let r;Kr({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const o=r.notice.value,l=r.notes.value;typeof i=="function"&&i({notice:o,notes:l})},close:!0}],content:o=>{r=pn(o,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:vQ}=gO;function Xnt(t,e){const i=e.getRow().getData(),r=Object.values(i).filter(n=>n?.matchUpId);i.issues?.length&&console.log({issues:i.issues}),r.length&&wEe({e:t,cell:e,rowData:i,callback:a=>{if(pp(a)){const s=e.getTable(),o=s.getData().find(l=>l.rowId===i.rowId);Object.values(o).forEach(l=>{l?.matchUpId&&l?.schedule&&(a.scheduledTime&&(l.schedule.scheduledTime=v9(a.scheduledTime),l.schedule.timeModifiers?.[0]!==vQ&&(l.schedule.timeModifiers=[])),a.timeModifiers&&(l.schedule?.scheduledTime&&a.timeModifiers[0]!==vQ&&(l.schedule.scheduledTime=""),l.schedule&&(l.schedule.timeModifiers=a.timeModifiers)))}),s.updateData([o])}}})}function Jnt(){function t(r){const n=r.getElement();return n.classList.add("tag"),n.classList.add("is-info"),n.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(r){r.getElement().style.backgroundColor="white";const n=document.createElement("span"),a=r.getRow().getData();return n.innerHTML=a.rowNumber,n}return{titleFormatter:t,formatter:e,headerClick:()=>{Znt({notes:"",notice:"",callback:r});function r(n){console.log({result:n})}},cellClick:Xnt,headerSort:!1,resizable:!1,hozAlign:li,frozen:!0,width:55}}function Qnt({courtsData:t,courtPrefix:e}){const i=(l,c)=>{const u=c.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=c.getData()[u];wEe({e:l,cell:c,matchUpId:p,callback:()=>{const f=We.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0})?.matchUps?.[0],m=c.getRow().getData();m[u]=f,c.getTable().updateData([m])}})},r=l2e-t?.length||0,n=r<=0?1:r,a=Knt({courtsData:t,count:n}),s=Jnt(),o=(l,c)=>({headerClick:(u,d)=>$nt(u,d,l),cellClick:i,field:`${e}${c}`,title:l.courtName,headerHozAlign:li,formatter:SEe,headerSort:!1,resizable:!1,hozAlign:li,minWidth:150});return[s].concat(t?.map(o),a)}function eat({scheduledDate:t}={}){let e,i,r,n=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=Xf.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=h,I=f.concat(...m),w=Qnt({courtsData:g,courtPrefix:v});return y?.forEach((T,S)=>{T.rowId=`rowId-${S+1}`,T.rowNumber=S+1}),{rows:y,columns:w,matchUps:I,courtsCount:g?.length??0,courtsData:g,groupInfo:b}},s=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=a({scheduledDate:d}),v=g?.map(b=>b.courtId);Ni.intersection(n,v).length===v?.length||(i.setColumns(m),n=v),r=!0,i?.replaceData(h),i.matchUps=f},e?0:1e3)};Rm({anchorId:zA});const o=document.getElementById(zA),{rows:l=[],columns:c=[],courtsCount:u}=a({scheduledDate:t});return n=c.map(d=>d?.courtId).filter(Boolean),i=new ks(o,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:c}),i.on("scrollVertical",gd),i.on("tableBuilt",()=>{Z_(i),e=!0}),i.on("dataProcessed",()=>{r&&(r=!1,Z_(i))}),{table:i,replaceTableData:s,courtsCount:u}}function tat({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:r}){const a=[{params:{matchUps:r.getData("active").map(o=>o.matchUp),scheduledDate:i},method:FYe}];qt({methods:a,callback:o=>{o.success&&(t(),e({scheduledDate:i}))},engine:N3})}function iat({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:r,callback:n}){const a=Xf.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:s=[],completedMatchUps:o=[]}=a,c=s.concat(...o).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t),d=[{disabled:!u.length,option:"Clear scheduled matches",onClick:f},{disabled:!u.length,option:"Clear all matches",onClick:h},{disabled:!c.length,option:"Clear all days",onClick:p}];d.filter(m=>!m.disabled).length&&nu({target:e,options:d,config:{placement:wp}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=c.filter(({schedule:T})=>T.scheduledDate===t).filter(({roundName:T})=>!i||i===T).filter(({eventId:T})=>!r||r===T);g||(v=v?.filter(({matchUpStatus:T,winningSide:S})=>T!=="COMPLETED"&&!S));const b=(m?c:v).map(T=>T.matchUpId);qt({methods:[{method:G8,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},removePriorValues:!0,matchUpIds:b}}],callback:T=>{T.success&&n&&Pt(n)&&n()}})}}function rat({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,flightNameFilter:r,roundNameFilter:n,controlAnchor:a,eventIdFilter:s,scheduledDate:o,matchUps:l=[],table:c}){let u=o;const d=x=>{u=x},p=x=>x.eventId===s,h=x=>{c.removeFilter(p),s=x,x&&c.addFilter(p)},f=We.getEvents().events||[],g=[{label:mg,onClick:()=>h(),close:!0}].concat(f.map(x=>({onClick:()=>h(x.eventId),label:x.eventName,close:!0}))),v=x=>x.roundName===n,y=Ni.unique(l.map(x=>x.roundName)),b=x=>{c.removeFilter(v),n=x,x&&c.addFilter(v)},w=[{label:DK,onClick:()=>b(),close:!0}].concat(y.map(x=>({onClick:()=>b(x),label:x,close:!0}))),T=x=>x.flight===r,S=Ni.unique(l.map(x=>x.drawName)),D=x=>{c.removeFilter(T),r=x,x&&c.addFilter(T)},E=[{label:tC,onClick:()=>D(),close:!0}].concat(S.map(x=>({onClick:()=>D(x),label:x,close:!0}))),P=()=>{t()&&e({scheduledDate:u}),console.log("clear filters ?")},R=x=>{const O=Fl(x.target,"dropdown");iat({target:O||x?.target,scheduledDate:u,callback:P,roundNameFilter:n,eventIdFilter:s})},M=qw(c),N=[{onClick:()=>tat({scheduledDate:u,table:c,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:R,intent:"is-warning",id:"clearSchedule",close:!0}],k=[{onKeyDown:x=>x.key==="Backspace"&&x.target.value.length===1&&M(""),onChange:x=>M(x.target.value),onKeyUp:x=>M(x.target.value),clearSearch:()=>M(""),placeholder:"Search participants",location:ui,search:!0},{hide:g.length<2,options:g,id:"eventOptions",label:mg,modifyLabel:!0,location:ui,selection:!0},{hide:w.length<2,options:w,id:"roundOptions",label:DK,modifyLabel:!0,location:ui,selection:!0},{hide:E.length<2,options:E,id:"flightOptions",label:tC,modifyLabel:!0,location:ui,selection:!0},{options:N,label:"Actions",selection:!1,location:Xt,align:Xt},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];return bo({target:a,items:k}),{updateScheduledDate:d}}function nat({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:r,courtsCount:n}={}){if(!i)return{elements:void 0};let a;const s=h=>f9(h).format("dddd MMM D"),{startDate:o,endDate:l}=Xf.getCompetitionDateRange(),u=Ni.generateDateRange(o,l).map(h=>({onClick:()=>{const f=Xf.getTournamentInfo().tournamentInfo.tournamentId;ht.router.navigate(`/tournament/${f}/schedule/${h}`)},isActive:h===r,label:s(h),value:h,close:!0})),d=()=>{},p=[{clearSearch:()=>d(),placeholder:"Search participants",id:"searchParticipants",visible:!!n,location:ui,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!n,id:"highlightTeam",location:ui,align:ui},{visible:!!n&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:Xt},{label:s(r||o),value:r||o,id:c2e,options:u,modifyLabel:!0,intent:"is-info",location:Xt,align:Xt}];return a=bo({target:i,items:p})?.elements,{elements:a}}function UEe(t){let e;const{startDate:i,endDate:r}=Xf.getCompetitionDateRange(),n=new Date,a=Ni.dateTime.formatDate(n),s=n>=new Date(i)&&n<=new Date(r),o=n>new Date(r)?r:i;if(!t.scheduledDate){const b=s?a:o,I=Xf.getTournamentInfo().tournamentInfo?.tournamentId;ht.router.navigate(`/tournament/${I}/schedule/${b}`)}const l=t.scheduledDate||(s?a:o);ht.displayed.selectedScheduleDate=l;const c=document.getElementById(rhe),u=document.getElementById(G3),d=document.getElementById(H3);u.style.paddingBottom="1em",d.style.paddingBottom="1em";let p=ht.state.schedulingActive;c.style.display=p?"":Vt;const{replaceTableData:h,table:f,unscheduledMatchUps:m}=trt({scheduledDate:l}),g=()=>{p=!p,ht.state.schedulingActive=p,c.style.display=p?"":Vt,e?.scheduleMatchUps&&(e.scheduleMatchUps.style.display=p?Vt:"")},{replaceTableData:v,courtsCount:y}=eat({scheduledDate:l});rat({controlAnchor:u,matchUps:m,table:f,updateUnscheduledTable:h,updateScheduleTable:v,toggleUnscheduled:g,scheduledDate:l}),e=nat({toggleUnscheduled:g,schedulingActive:p,controlAnchor:d,scheduledDate:l,courtsCount:y}).elements}const{SUBSTITUTION:yQ,PENALTY:bQ,REMOVE_PARTICIPANT:IQ,REPLACE_PARTICIPANT:wQ}=Eq,{POLICY_TYPE_MATCHUP_ACTIONS:aat}=Cy,{ASSIGN_PARTICIPANT:hG}=sw,{TEAM:sat,DOUBLES:DEe}=ll,oat=Ni.extractAttributes;function HC(t,e,i,r){if(!e)return;const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(v=>v.remove());return}const s=e.getRow().getData(),o=e.getColumn().getDefinition(),l=s.matchUpType===DEe,c=s.eventType===sat,{matchUpId:u,drawId:d}=s,p=o.field==="side1"&&1||o.field==="side2"&&2,{validActions:h}=We.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[aat]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=r?.individualParticipant?.participantId,m={[hG]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:t$},[bQ]:{onClick:()=>console.log({data:s}),text:"Assess penalty"},[IQ]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:lat},[wQ]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:t$},[yQ]:{params:{data:s,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},method:t$,text:"Substitution"}},g=h.filter(({type:v})=>[hG,bQ,IQ,wQ,yQ].includes(v)).map(v=>{const y=m[v.type];return{onClick:()=>{Pt(y.method)?y.method({...y.params,action:v}):Pt(y.onClick)&&y.onClick()},text:y.text}});g.length===1?g[0].onClick():g.length>0&&t?.target&&nu({items:g,target:t.target,config:{placement:wp}})}function lat(t){const{action:e,callback:i,clickedParticipantId:r}=t;e.payload.participantId=r;const n=[{method:e.method,params:e.payload}];qt({methods:n,callback:s=>Pt(i)&&i&&i(s)})}function t$(t){const{sideNumber:e,callback:i,isTeam:r,isDoubles:n,data:a}=t,s=t.action.availableParticipants,o=a.matchUp.matchUpType,c=a.matchUp.sides.find(m=>e===m.sideNumber)?.participant?.individualParticipantIds,u=t.clickedParticipantId;X0({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:o===DEe&&!u?2:1,onSelection:m=>{if(m.participantId||m.selected){const g=[];(Array.isArray(m.selected)?m.selected.map(oat("participantId")):[m.participantId]).filter(Boolean).forEach(b=>{g.push({params:{...t.action.payload,substituteParticipantId:b,newParticipantId:b,existingParticipantId:u,participantId:b},method:t.action.method})}),qt({methods:g,callback:b=>{Pt(i)&&i&&i(b)}})}},action:{type:hG,participantsAvailable:s},title:r&&n?"Doubles: Select participants":void 0})}function EEe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function PEe(t){const e=t.getRow().getData(),i=document.createElement("span");if(!e.competitiveProfile?.competitiveness)return i;const{competitiveProfile:r,score:n}=e,a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=r;i.style.color=a[s],i.style.fontSize="smaller",i.innerHTML=s}return i}function I9(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.color="blue",r.style.fontSize="smaller",r.innerHTML="Enter score"),r}function SQ(t){const e=document.createElement("div");return e.style.fontWeight="bold",e.innerHTML=t.getValue(),e}function CEe(t){const{matchUpId:e,schedule:i,callback:r}=t;qt({methods:[{params:{matchUpIds:[e],schedule:i,removePriorValues:!0},method:G8}],callback:s=>{s.success&&r&&Pt(r)&&r()}})}function w9({pointerEvent:t,cell:e,matchUp:i,callback:r}){const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(p=>p.remove());return}const a=!i?.roundPosition&&!i?.drawPositions,s=e&&t.target?.getElementsByClassName("fa-ellipsis-vertical")[0],o=e?.getRow().getData()||i,l=()=>{Pt(r)&&r&&r(o)},c=i?.schedule?.scheduledTime||i?.schedule?.scheduledDate||i?.schedule?.venueId||i?.schedule?.courtId,d=[{onClick:()=>{const p={scheduledDate:"",scheduledTime:"",courtId:"",venueId:""},h=()=>{if(!e){r&&r({refresh:!0});return}e.getRow().update({...o,...p,courtName:"",venueName:""})};CEe({matchUpId:i.matchUpId,schedule:p,callback:h})},text:"Clear schedule",hide:!c},{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&d.push({onClick:()=>cat({...i,callback:l}),text:"Delete match",color:"red"}),nu({items:d,target:s||t.target,config:{placement:wp}})}function cat({drawId:t,structureId:e,matchUpId:i,callback:r}){qt({methods:[{method:xUe,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:s=>{s.success?Pt(r)&&r&&r():console.log({postMutationError:s.error})}})}const TQ=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&Yw(t)(e,i,void 0))??i},BM=t=>({cell:e,event:i,...r})=>{HC(i,e,a=>{if(a.success){const s=e.getRow(),{drawId:o,matchUpId:l}=t,c=We.findMatchUp({drawId:o,matchUpId:l}).matchUp,u=s.getData().matchUp.collectionId,p=c.tieMatchUps.filter(f=>f.collectionId===u).map(f=>KD({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},r)};function uat(t,e){const i=e.getRow(),r=i.getData(),{matchUpId:n,readyToScore:a}=r;a&&Q0({matchUpId:n,callback:o=>{if(o.success){const{matchUpStatus:l,sets:c,matchUpFormat:u,score:d,winningSide:p}=o.outcome;Object.assign(r,{matchUpStatus:l,sets:c,matchUpFormat:u,score:d}),r.winningSide=p&&`side${p}`,i.update(r),e.getTable().redraw(!0);const f=o.results.find(({methodName:m})=>m===z8)?.tieMatchUpResult;wat(f)}else console.log({result:o})}})}function dat({matchUp:t}){const e=t.sides?.find(n=>n.sideNumber===1)?.participant?.participantName||"Side 1",i=t.sides?.find(n=>n.sideNumber===2)?.participant?.participantName||"Side 2",r=(n,a)=>n?.participantName?.localeCompare(a?.participantName);return[{formatter:TQ(BM(t)),cellClick:(n,a)=>BM(t)({event:n,cell:a}),sorter:r,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:TQ(BM(t)),cellClick:(n,a)=>BM(t)({event:n,cell:a}),sorter:r,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:I9,cellClick:uat,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function pat({matchUp:t,tableElement:e,collectionMatchUps:i}){const r=i.map(s=>KD({...s,dualMatchUp:t})),n=dat({matchUp:t});return{table:new ks(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:n,data:r})}}function REe({side1:t,side2:e,side1Score:i,side2Score:r}){const n=document.createElement("div");n.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const s=hat({side1Score:i,side2Score:r});return a.appendChild(t),a.appendChild(s),a.appendChild(e),n.appendChild(a),n}function Q_({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const r=document.createElement("div");return r.className="side-name",r.innerHTML=t,i.appendChild(r),i}function hat({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const r=document.createElement("div");r.className="score-flex";const n=document.createElement("div");return n.className="score-vs",n.innerHTML="vs",r.appendChild(t),r.appendChild(n),r.appendChild(e),i.appendChild(r),i}function ek({winningSide:t,sets:e,sideNumber:i,id:r}){const n=`side${i}Score`,a=e?.[0]?.[n]||0,s=document.createElement("span");return r&&(s.id=r),s.className="side-score",i===1?s.style.paddingLeft="1rem":s.style.paddingRight="1rem",i===t&&s.classList.add("has-text-success"),s.innerHTML=String(a),s}let MEe;function NEe({title:t,content:e,footer:i}={}){if(!e||!i)return;const r=document.getElementById(nC);r&&Xs(r);const n=document.createElement("div");n.className="overlay noselect",n.id=nC;const a=document.createElement("div");a.className="overlay-center-align",n.appendChild(a);const s=document.createElement("div");if(s.className="overlay-root",a.appendChild(s),t){const u=mat({title:t});s.appendChild(u)}const o=document.createElement("div");o.className="overlay-content",typeof e=="string"?o.innerHTML=e:e&&o.appendChild(e),s.appendChild(o);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),s.appendChild(l),document.body.appendChild(n),MEe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=Vt}function fat({content:t}){const e=document.getElementById(nC)?.getElementsByClassName("overlay-content")?.[0];e&&(Xs(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function mat({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function AEe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:MEe});let e=document.getElementById(nC);Xs(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(nC)}function gat(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:ui,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:li,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const r=i.getRow(),n=r.getData();KF({callback:s=>{s&&(Object.assign(n,{matchUpFormat:s}),r.update(n),i.getTable().redraw(!0))},existingMatchUpFormat:n.matchUpFormat,modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})},title:"Score format",field:Q3,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[K3,Z3,J3,X3]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function UQ(t){return t?.[0].toUpperCase()+t?.substring(1).toLowerCase()||""}function vat({tableElement:t,tieFormat:e}){const i=(e?.collectionDefinitions?.sort((a,s)=>a.collectionOrder-s.collectionOrder)||[]).map(a=>{const{collectionValue:s,matchUpValue:o,scoreValue:l,setValue:c,matchUpType:u,gender:d}=a,p=Ni.isConvertableInteger(s)&&K3||Ni.isConvertableInteger(l)&&X3||Ni.isConvertableInteger(c)&&J3||Z3,h=s??l??c??o;return{...a,matchUpType:UQ(u),gender:UQ(d),awardValue:h,awardType:p}}),r=gat();return{table:new ks(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:r,data:i})}}function _Ee(t){const e=t?.winCriteria?.valueGoal,i=t?.collectionDefinitions?.length?t?.winCriteria?.aggregateValue&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function kEe({title:t,tieFormat:e,onClose:i}){const{content:r,inputs:n,elements:a,table:s}=yat({tieFormat:e}),o=u=>{const d=n.tieFormatName.value,p=u.map(f=>Ni.definedAttributes({collectionValue:f.awardType===K3?f.awardValue:void 0,matchUpValue:f.awardType===Z3?f.awardValue:void 0,scoreValue:f.awardType===X3?f.awardValue:void 0,setValue:f.awardType===J3?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=We.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};s.on("dataChanged",()=>{const u=o(s.getData());a.winCriteria.innerHTML=_Ee(u)});const c=Iat({table:s,onClose:u=>{const d=o(u);Pt(i)&&i(d?.collectionDefinitions?.length&&d)}});return NEe({title:t,content:r,footer:c})}function yat({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:r}=vat({tieFormat:t,tableElement:i}),n=bat();e.appendChild(n);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const s=()=>{const u=r?.getSelectedData().map(({collectionId:d})=>d);r?.deleteRow(u)},o=[{value:t?.tieFormatName||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:Bn(5),field:"tieFormatName",id:"tieFormatName",location:ui},{text:_Ee(t),id:"winCriteria",location:ui},{onClick:s,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onClick:()=>{const d={collectionName:`Collection ${r.getData().length+1}`,collectionId:Ni.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};r.addRow(d)},label:"Add collection",intent:"is-info",location:Xt}],{elements:l,inputs:c}=bo({table:r,target:a,items:o})||{};return{content:e,table:r,elements:l,inputs:c}}function bat(){const t=document.createElement("div");t.className="overlay-content-overview";const e=document.createElement("div");return e.className="overlay-content-body",t.appendChild(e),t}function Iat({table:t,onClose:e}){const i=()=>{t.destroy(),AEe()},r=document.createElement("button");r.className="button is-warning is-light",r.onclick=i,r.innerHTML="Cancel";const n=document.createElement("button");n.className="button is-info button-spacer",n.onclick=s=>{s.preventDefault(),s.stopPropagation();const o=t.getData();i(),Pt(e)&&e(o)},n.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(r),a.appendChild(n),a}function OEe({matchUpId:t,structureId:e,eventId:i,drawId:r,callback:n}){const{tieFormat:a}=We.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:r});kEe({title:"Edit scorecard",tieFormat:a,onClose:o=>{if(o){o.collectionDefinitions?.forEach((p,h)=>p.collectionOrder=h+1);const l={collectionName:!0,collectionOrder:!0};if(!rR.compareTieFormats({descendant:o,ancestor:a,considerations:l})?.different){$t({intent:"is-info",message:"No changes"});return}qt({methods:[{method:xYe,params:{modifiedTieFormat:o,considerations:l,structureId:e,matchUpId:t,drawId:r}}],callback:p=>p.success?($t({intent:"is-success",message:"Scorecard updated"}),Pt(n)&&n&&n()):$t({intent:"is-danger",message:p.error?.message||"Error"})})}}})}const $M="has-text-success",xEe="tieSide1",LEe="tieSide2";function u2({title:t,drawId:e,matchUpId:i,onClose:r}){const n=We.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=n.matchUp;if(!a||n.error||!t||!Array.isArray(a?.tieFormat?.collectionDefinitions))return;const s=d2({matchUp:a}),o=Sat({title:t,drawId:e,matchUpId:i,onClose:r});return NEe({title:t,content:s,footer:o})}function d2({matchUp:t}){const e=document.createElement("div");e.className="overlay-content-container";const i=Q_({participantName:DQ({matchUp:t,sideNumber:1})||"",justify:"end"}),r=Q_({participantName:DQ({matchUp:t,sideNumber:2})||"",justify:"start"}),{winningSide:n,score:a}=t,s=a?.sets||[],o=ek({winningSide:n,sets:s,sideNumber:1,id:xEe}),l=ek({winningSide:n,sets:s,sideNumber:2,id:LEe}),c=REe({side1:i,side2:r,side1Score:o,side2Score:l});e.appendChild(c),ht.collectionTables||(ht.collectionTables=[]);const u=t.tieFormat.collectionDefinitions?.sort((d,p)=>d.collectionOrder-p.collectionOrder)||[];for(const d of u){const p=t.tieMatchUps.filter(v=>v.collectionId===d.collectionId),h=document.createElement("div");h.className="collection";const f=document.createElement("div");f.className="title is-4",f.innerHTML=d.collectionName,h.appendChild(f);const m=document.createElement("div");h.appendChild(m);const{table:g}=pat({matchUp:t,tableElement:m,collectionMatchUps:p});ht.collectionTables.push(g),e.appendChild(h)}return e}function wat(t){const e=t?.score?.sets?.[0];if(!e)return;const i=document.getElementById(xEe),r=document.getElementById(LEe);i.classList.remove($M),r.classList.remove($M),i.innerHTML=e.side1Score,r.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add($M),t.winningSide===2&&r.classList.add($M)}function DQ({matchUp:t,sideNumber:e}){return t.sides.find(i=>i.sideNumber===e)?.participant?.participantName}function Sat({title:t,drawId:e,matchUpId:i,onClose:r}){const n=document.createElement("button");n.className="button is-warning is-light",n.onclick=()=>{OEe({matchUpId:i,drawId:e,callback:()=>u2({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},n.innerHTML="Edit scorecard";const a=u=>{if(u.success){const d=We.findMatchUp({drawId:e,matchUpId:i})?.matchUp,p=d2({matchUp:d});fat({content:p})}},s=document.createElement("button");s.className="button is-warning is-light button-spacer",s.innerHTML="Remove players",s.onclick=()=>{qt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:VUe}],callback:a})};const o=document.createElement("button");o.className="button is-info is-light button-spacer",o.innerHTML="Clear results",o.onclick=()=>{qt({methods:[{params:{drawId:e,matchUpId:i},method:jUe}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();ht.collectionTables&&ht.collectionTables.length;)ht.collectionTables.pop().destroy();AEe(),Pt(r)&&r&&r()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(n),c.appendChild(s),c.appendChild(o),c.appendChild(l),c}const{TEAM:Tat}=Vs,Uat=(t,e)=>(i,r)=>{const n=r.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=n.matchUp;if(o===Tat)u2({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||n.matchUp.score?.scoreStringSide1)if(ai.hotkeys&&!ai.device.isMobile){e({e:i,cell:r,replaceTableData:t});const u=document.querySelectorAll(".activeScoreCell");for(const d of Array.from(u))d.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else Q0({matchUp:n.matchUp,matchUpId:a,callback:t})};function FEe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}const EQ={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},Rb={"o-route":uD,"p-route":Jf,"e-route":Qp,"m-route":A3,"s-route":oy,"v-route":_3},PQ={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function Dat(){const t=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <span class="features-item-text">Overview</span>
      <span class="features-item-text">Participants</span>
      <span class="features-item-text">Events</span>
      <span class="features-item-text">Matches</span>
      <span class="features-item-text">Schedule</span>
      <span class="features-item-text">Venues</span>
    </ul>
  </div>
`,e=document.getElementById("navText");e.innerHTML=t;const i=Object.keys(Rb),r=ht.router?.current?.[0]?.data?.selectedTab,n=s=>document.querySelector(".side-bar")?.classList.contains("collapse")?s:"",a=document.getElementById("o-route");Cg(a,{dynContent:()=>!ai.device.isMobile&&n(PQ["o-route"]),onShow:s=>!!s.props.content,plugins:[EQ],placement:wp,arrow:!1}),i.forEach(s=>{const o=document.getElementById(s);Cg(o,{dynContent:()=>!ai.device.isMobile&&n(PQ[s]),onShow:l=>!!l.props.content,plugins:[EQ],placement:wp,arrow:!1}),(r===Rb[s]||!r&&Rb[s]===Jf)&&(o.style.color="blue"),o.onclick=()=>{document.querySelectorAll(".nav-icon").forEach(u=>u.style.color=""),o.style.color="blue";const l=We.getTournament()?.tournamentRecord?.tournamentId,c=`/${Es}/${l}/${Rb[s]}`;ht.router.navigate(c)}})}function S9(t){document.querySelectorAll(".nav-icon").forEach(i=>i.style.color=""),Object.keys(Rb).forEach(i=>{const r=document.getElementById(i);r&&(t===Rb[i]||!t&&Rb[i]===Jf)&&(r.style.color="blue")})}function Eat({data:t,replaceTableData:e,setFocusData:i}){const r=(c,u)=>{const p=u.getRow().getData(),{courtName:h,scheduledDate:f}=p;if(h&&f){const m=We.getTournament()?.tournamentRecord?.tournamentId,g=`/${Es}/${m}/${oy}/${f}`;ht.router.navigate(g),S9(oy)}},n=(c,u)=>{const d=u.getValue();IEe({time:d,callback:({time:h})=>{const m=Ni.dateTime.convertTime(h,!0),g=u.getRow(),v=g.getData(),{matchUpId:y}=v;m!==d&&CEe({matchUpId:y,schedule:{scheduledTime:m},callback:()=>{console.log("callback"),g.update({...v,scheduledTime:m})}})}})},a=()=>e(),s=t.some(c=>c.courtName),o=(c,u)=>HC(c,u,a),l=c=>{const u=document.createElement("div");u.className="has-text-warning-dark",u.innerHTML="Select participant";const d=({event:h,...f})=>{HC(h,c,a,f)};return c.getValue().participantName&&Yw(d)(c,u)};return[{cellClick:(c,u)=>u.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ui,width:55},{formatter:btt(Fn),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:SQ,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:SQ,minWidth:90},{cellClick:r,field:"scheduledDate",title:"Date",width:110},{cellClick:r,visible:!!s,field:"courtName",title:"Court",width:100},{cellClick:n,field:"scheduledTime",visible:!0,title:"Time",width:70},{formatter:l,cellClick:o,sorter:yU,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:l,cellClick:o,sorter:yU,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Uat(e,i),formatter:I9,sorter:FEe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:EEe,formatter:PEe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ui,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(c,u)=>w9({pointerEvent:c,cell:u,...u.getData()}),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,widthGrow:0,width:50}]}const i$=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function r$(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent(`on${e}`,i)}function yE(t,e,i,r){t&&(t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent(`on${e}`,i))}function BEe(t,e){const i=e.slice(0,e.length-1),r=[];for(let n=0;n<i.length;n++)r.push(t[i[n].toLowerCase()]);return r}function $Ee(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function Pat(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}function VEe(t){let e=t.keyCode||t.which||t.charCode;return t.code&&/^Key[A-Z]$/.test(t.code)&&(e=t.code.charCodeAt(3)),e}const zC={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":i$?173:189,"=":i$?61:187,";":i$?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},wh={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},AE={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},fl={16:!1,18:!1,17:!1,91:!1},fs={};for(let t=1;t<20;t++)zC[`f${t}`]=111+t;let Ja=[],vP=null,jEe="all";const Km=new Map,JD=t=>zC[t.toLowerCase()]||wh[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Cat=t=>Object.keys(zC).find(e=>zC[e]===t),Rat=t=>Object.keys(wh).find(e=>wh[e]===t),GEe=t=>{jEe=t||"all"},qC=()=>jEe||"all",Mat=()=>Ja.slice(0),Nat=()=>Ja.map(t=>Cat(t)||Rat(t)||String.fromCharCode(t)),Aat=()=>{const t=[];return Object.keys(fs).forEach(e=>{fs[e].forEach(({key:i,scope:r,mods:n,shortcut:a})=>{t.push({scope:r,shortcut:a,mods:n,keys:i.split("+").map(s=>JD(s))})})}),t},HEe=t=>{const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r},_at=t=>(typeof t=="string"&&(t=JD(t)),Ja.indexOf(t)!==-1),kat=(t,e)=>{let i,r;t||(t=qC());for(const n in fs)if(Object.prototype.hasOwnProperty.call(fs,n))for(i=fs[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(({element:a})=>T9(a)):r++;qC()===t&&GEe(e||"all")};function Oat(t){let e=VEe(t);t.key&&t.key.toLowerCase()==="capslock"&&(e=JD(t.key));const i=Ja.indexOf(e);if(i>=0&&Ja.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Ja.splice(0,Ja.length),(e===93||e===224)&&(e=91),e in fl){fl[e]=!1;for(const r in wh)wh[r]===e&&(Nf[r]=!1)}}const zEe=(t,...e)=>{if(typeof t>"u")Object.keys(fs).forEach(i=>{Array.isArray(fs[i])&&fs[i].forEach(r=>VM(r)),delete fs[i]}),T9(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&VM(i)});else if(typeof t=="object")t.key&&VM(t);else if(typeof t=="string"){let[i,r]=e;typeof i=="function"&&(r=i,i=""),VM({key:t,scope:i,method:r,splitKey:"+"})}},VM=({key:t,scope:e,method:i,splitKey:r="+"})=>{$Ee(t).forEach(n=>{const a=n.split(r),s=a.length,o=a[s-1],l=o==="*"?"*":JD(o);if(!fs[l])return;e||(e=qC());const c=s>1?BEe(wh,a):[],u=[];fs[l]=fs[l].filter(d=>{const p=(i?d.method===i:!0)&&d.scope===e&&Pat(d.mods,c);return p&&u.push(d.element),!p}),u.forEach(d=>T9(d))})};function CQ(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in fl)Object.prototype.hasOwnProperty.call(fl,a)&&(!fl[a]&&e.mods.indexOf(+a)>-1||fl[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!fl[16]&&!fl[18]&&!fl[17]&&!fl[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ja),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function RQ(t,e){const i=fs["*"];let r=VEe(t);if(t.key&&t.key.toLowerCase()==="capslock"||!(Nf.filter||HEe).call(this,t))return;if((r===93||r===224)&&(r=91),Ja.indexOf(r)===-1&&r!==229&&Ja.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(o=>{const l=AE[o];t[o]&&Ja.indexOf(l)===-1?Ja.push(l):!t[o]&&Ja.indexOf(l)>-1?Ja.splice(Ja.indexOf(l),1):o==="metaKey"&&t[o]&&(Ja=Ja.filter(c=>c in AE||c===r))}),r in fl){fl[r]=!0;for(const o in wh)if(Object.prototype.hasOwnProperty.call(wh,o)){const l=AE[wh[o]];Nf[o]=t[l]}if(!i)return}for(const o in fl)Object.prototype.hasOwnProperty.call(fl,o)&&(fl[o]=t[AE[o]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Ja.indexOf(17)===-1&&Ja.push(17),Ja.indexOf(18)===-1&&Ja.push(18),fl[17]=!0,fl[18]=!0);const n=qC();if(i)for(let o=0;o<i.length;o++)i[o].scope===n&&(t.type==="keydown"&&i[o].keydown||t.type==="keyup"&&i[o].keyup)&&CQ(t,i[o],n,e);if(!(r in fs))return;const a=fs[r],s=a.length;for(let o=0;o<s;o++)if((t.type==="keydown"&&a[o].keydown||t.type==="keyup"&&a[o].keyup)&&a[o].key){const l=a[o],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(JD(u[p]));d.sort().join("")===Ja.sort().join("")&&CQ(t,l,n,e)}}const Nf=function(t,e,i){Ja=[];const r=$Ee(t);let n=[],a="all",s=document,o=0,l=!1,c=!0,u="+",d=!1,p=!1;if(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"){const h=e;h.scope&&(a=h.scope),h.element&&(s=h.element),h.keyup&&(l=h.keyup),h.keydown!==void 0&&(c=h.keydown),h.capture!==void 0&&(d=h.capture),typeof h.splitKey=="string"&&(u=h.splitKey),h.single===!0&&(p=!0)}for(typeof e=="string"&&(a=e),p&&zEe(t,a);o<r.length;o++){const h=r[o].split(u);n=[],h.length>1&&(n=BEe(wh,h));let f=h[h.length-1];f=f==="*"?"*":JD(f),f in fs||(fs[f]=[]),fs[f].push({keyup:l,keydown:c,scope:a,mods:n,shortcut:r[o],method:i,key:r[o],splitKey:u,element:s})}if(typeof s<"u"&&typeof window<"u"){if(!Km.has(s)){const h=(m=window.event)=>RQ(m,s),f=(m=window.event)=>{RQ(m,s),Oat(m)};Km.set(s,{keydownListener:h,keyupListenr:f,capture:d}),r$(s,"keydown",h,d),r$(s,"keyup",f,d)}if(!vP){const h=()=>{Ja=[]};vP={listener:h,capture:d},r$(window,"focus",h,d)}}};function xat(t,e="all"){Object.keys(fs).forEach(i=>{fs[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method({},r)})})}function T9(t){const e=Object.values(fs).flat();if(e.findIndex(({element:i})=>i===t)<0&&t){const{keydownListener:i,keyupListenr:r,capture:n}=Km.get(t)||{};i&&r&&(yE(t,"keyup",r,n),yE(t,"keydown",i,n),Km.delete(t))}if((e.length<=0||Km.size<=0)&&(Array.from(Km.keys()).forEach(i=>{const{keydownListener:r,keyupListenr:n,capture:a}=Km.get(i)||{};r&&n&&(yE(i,"keyup",n,a),yE(i,"keydown",r,a),Km.delete(i))}),Km.clear(),Object.keys(fs).forEach(i=>delete fs[i]),vP)){const{listener:i,capture:r}=vP;yE(window,"focus",i,r),vP=null}}const n$={getPressedKeyString:Nat,setScope:GEe,getScope:qC,deleteScope:kat,getPressedKeyCodes:Mat,getAllKeyCodes:Aat,isPressed:_at,filter:HEe,trigger:xat,unbind:zEe,keyMap:zC,modifier:wh,modifierMap:AE};for(const t in n$){const e=t;Object.prototype.hasOwnProperty.call(n$,e)&&(Nf[e]=n$[e])}if(typeof window<"u"){const t=window.hotkeys;Nf.noConflict=e=>(e&&window.hotkeys===Nf&&(window.hotkeys=t),Nf),window.hotkeys=Nf}const{HOTKEYS:Lat,SIDE1KEYS:Fat,MODIFIERS:Bat}=Lq;function $at(){let t,e;const i=r=>{e=void 0,t=r};return Nf(Lat+",esc",(r,n)=>{if(t){const a=t.cell.getElement(),s=a.classList?.contains("tabulator-cell")?a.firstChild:a;r.preventDefault();const o=t.cell.getRow().getData();e||(e=o.matchUp);const l=Nf.shift,c=l?n.key.split(n.splitKey)[1]:n.key;c==="esc"&&(t.replaceTableData(),t=void 0);const u=Fat.some(d=>d===c)&&(l?2:1)||void 0;if(u||Bat.includes(c)){const{matchUpFormat:d,matchUpStatus:p,score:h,sets:f,winningSide:m}=e,{matchUpStatus:g,scoreString:v,winningSide:y,sets:b,updated:I}=Fv.keyValueScore({scoreString:h?.scoreStringSide1,shiftFirst:!0,sets:f||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:u,value:c});I&&(e={matchUpId:o.matchUp.matchUpId,drawId:o.matchUp.drawId,score:{scoreStringSide1:v},matchUpStatus:g,winningSide:y,sets:b,matchUpFormat:d,updated:I},s.innerText=v||"Enter score")}}if(t&&n.key==="enter"){const a=Fv.generateScoreString({sets:e.sets,reversed:!0}),s=Fv.generateScoreString({sets:e.sets}),o={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:s,scoreStringSide2:a}};Vat({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:o}),t=void 0}}),{setFocusData:i}}function Vat({outcome:t,callback:e,matchUpId:i,drawId:r}){const{matchUpStatus:n,winningSide:a,score:s}=t;qt({methods:[{method:z8,params:{outcome:{matchUpStatus:n,winningSide:a,score:s},matchUpId:i,drawId:r}}],callback:c=>{Pt(e)&&e({...c,outcome:t})}})}function jat(){let t;const{setFocusData:e}=$at(),i=()=>(We.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(KD),r=()=>{t.replaceData(i())},n=i(),a=Eat({data:n,replaceTableData:r,setFocusData:e});return(o=>{Rm({anchorId:HA});const l=document.getElementById(HA),c=Fl(l,"section")?.querySelector(".tabHeader");t=new ks(l,{headerSortElement:af(["complete","duration","score","scheduledTime"]),height:window.innerHeight*.85,placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:o}),t.on("dataFiltered",(u,d)=>{const p=d.map(v=>v.getData().matchUp);c&&(c.innerHTML=`Matches (${p.length})`);const h=document.getElementById("wtnPredictiveAccuracy"),f=We.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:p});f?.accuracy?.percent?(h.style.display="",h.innerHTML=`WTN ${f.accuracy.percent}%`):h.style.display=Vt;const m=document.getElementById("utrPredictiveAccuracy"),g=We.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:p});g?.accuracy?.percent?(m.style.display="",m.innerHTML=`UTR ${g.accuracy.percent}%`):m.style.display=Vt})})(n),{table:t,data:n,replaceTableData:r}}function tk(t){ai.activeScale=t}const{TEAM_EVENT:MQ,SINGLES:NQ,DOUBLES:AQ}=ll,{TEAM:Gat}=Vs;function Hat(){const t=new Map,e={elements:{},options:{}},{data:i,table:r,replaceTableData:n}=jat(),a=We.getEvents().events||[],s=document.getElementById(O3);s.style.display=Vt,e.options.flight=Yat({matchUpFilters:t,events:a,table:r});const o=Kat({matchUpFilters:t,components:e,events:a,table:r}),l=qat({table:r,matchUpFilters:t,statsPanel:s}),c=zat({table:r,matchUpFilters:t,data:i}),u=Wat({matchUpFilters:t,table:r}),d=m=>m.searchText?.includes(t.get("searchText")),p=m=>{m||r?.removeFilter(d),t.set("searchText",m),m&&r?.addFilter(d)},h=[{onClick:()=>r?.deselectRow(),label:"Schedule",stateChange:!0,location:ya},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{r?.removeFilter(d),t.set("searchText",""),r?.removeFilter()},placeholder:"Search matches",location:ui,search:!0},{hide:o.length<4,options:o,id:"eventOptions",label:mg,modifyLabel:!0,selection:!0,location:ui},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:tC,id:"flightOptions",modifyLabel:!0,selection:!0,location:ui},{hide:l.length<3,options:l,modifyLabel:!0,label:jpe,location:ui,selection:!0},{options:u,label:Vpe,modifyLabel:!0,selection:!0,location:ui},{hide:c.length<4,options:c,modifyLabel:!0,label:Gpe,selection:!0,location:ui},{onClick:()=>{tk(sC),n()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:Xt,text:"WTN %",hide:!0},{onClick:()=>{tk(mI),n()},id:"utrPredictiveAccuracy",intent:"is-info",location:Xt,text:"UTR %",hide:!0}],f=document.getElementById(z3);e.elements=bo({table:r,target:f,items:h})?.elements}function zat({table:t,matchUpFilters:e,data:i}){const r=o=>o.matchUpType===e.get("matchUpTypeFilter"),n=o=>{t?.removeFilter(r),e.set("matchUpTypeFilter",o),o&&t?.addFilter(r)},a={label:`<span style='font-weight: bold'>${Gpe}</span>`,onClick:()=>n(),close:!0},s=i.reduce((o,l)=>(o.includes(l.matchUpType)||o.push(l.matchUpType),o),[]);return[a,{divider:!0},s.includes(NQ)&&{label:"Singles",close:!0,onClick:()=>n(NQ)},s.includes(AQ)&&{label:"Doubles",close:!0,onClick:()=>n(AQ)},s.includes(MQ)&&{label:"Team",close:!0,onClick:()=>n(MQ)}].filter(Boolean)}function qat({table:t,matchUpFilters:e,statsPanel:i}){const r=We.getParticipants({participantFilters:{participantTypes:[Gat]}}).participants||[],n=Object.assign({},...r.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(c=>n[e.get("teamIdFilter")]?.includes(c)),s=l=>{if(e.get("teamIdFilter")&&t?.removeFilter(a),e.set("teamIdFilter",l),l){t?.addFilter(a);const{teamStats:c}=We.getParticipantStats({teamParticipantId:l});if(c?.participantName){i.style.display="";const u=Q_({participantName:c.participantName,justify:"end"}),d=Q_({participantName:"Opponents",justify:"start"}),p=[{side1Score:c.matchUps[0],side2Score:c.matchUps[1]}],h=ek({sets:p,sideNumber:1}),f=ek({sets:p,sideNumber:2});Xs(i),i.appendChild(REe({side1:u,side2:d,side1Score:h,side2Score:f}))}}else i.style.display=Vt};return[{label:`<span style='font-weight: bold'>${jpe}</span>`,onClick:()=>s(),close:!0},{divider:!0}].concat(r.sort((l,c)=>l?.participantName?.localeCompare(c?.participantName)).map(l=>({onClick:()=>s(l.participantId),label:l.participantName,close:!0})))}function Wat({matchUpFilters:t,table:e}){const i=a=>{const s=t.get("matchUpStatusFilter");if(s==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(s==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},r=a=>{e?.removeFilter(i),t.set("matchUpStatusFilter",a),a&&e?.addFilter(i)};return[{label:`<span style='font-weight: bold'>${Vpe}</span>`,onClick:()=>r(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>r("readyToScore")},{label:"Complete",close:!0,onClick:()=>r("complete")}]}function Yat({matchUpFilters:t,events:e,table:i}){const r=l=>l.drawId===t.get("drawIdFilter"),n=l=>{i?.removeFilter(r),t.set("drawIdFilter",l),l&&i?.addFilter(r)},a={label:`<span style='font-weight: bold'>${tC}</span>`,onClick:()=>n(),close:!0},s=l=>l.drawDefinitions?.map(({drawId:c,drawName:u})=>({onClick:()=>n(c),label:u,close:!0})),o=[a,{divider:!0}].concat(e.flatMap(s)).filter(Boolean);return{flightFilter:r,flightOptions:o,allFlights:a,mapFlightOptions:s}}function Kat({matchUpFilters:t,table:e,events:i,components:r}){const n=o=>o.eventId===t.get("eventIdFilter"),a=o=>{if(e?.removeFilter(n),t.set("eventIdFilter",o),e?.removeFilter(r.options.flight.flightFilter),t.set("drawIdFilter",void 0),o){e?.addFilter(n),r.options.flight.flightOptions=[r.options.flight.allFlights,{divider:!0}].concat(r.options.flight.mapFlightOptions(i.find(u=>o===u.eventId))).filter(Boolean);const l={options:r.options.flight.flightOptions,label:tC,id:"flightOptions",modifyLabel:!0,selection:!0},c=zj({button:l});r.elements.flightOptions.replaceWith(c),r.elements.flightOptions=c,r.elements.flightOptions.style.display=r.options.flight.flightOptions.length<3?Vt:""}else r.elements.flightOptions.style.display=Vt};return[{label:`<span style='font-weight: bold'>${mg}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(o=>({onClick:()=>a(o.eventId),label:o.eventName,close:!0})))}function Zat(){const t=We.getTournamentInfo().tournamentInfo;if(t?.timeItemValues?.TMX?.offline){const n=document.getElementById("dnav");n&&(n.style.backgroundColor="lightyellow")}const i=document.getElementById("provider");i&&(i.onclick=()=>ht.router.navigate("/tournaments"));const r=document.getElementById("pageTitle");r&&t?.tournamentName?(Xs(r),r.innerHTML=`<div class='tmx-title'>${t?.tournamentName}</div>`):ht.router.navigate("/tournaments")}function qEe(t){const{venueName:e,venueAbbreviation:i,addresses:r,venueId:n,courts:a}=t;return{hasLocation:r?.[0]?.longitude,courtsCount:a?.length||0,scheduledMatchUpsCount:0,address:r?.[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:n,courts:a,venue:t}}function Xat(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,width:50}]}function Jat(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const r=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{label:"Add courts",location:Xt,align:Xt}];e.appendChild(i);const n="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=n,a.style.width="99%",e.className=Ox,e.style.display=Vt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBottom=n,e.appendChild(a),t.getElement().appendChild(e);const s=Xat(),o=new ks(a,{headerSortElement:af(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:s});bo({table:o,target:i,items:r}),o.on("scrollVertical",gd),o.on("cellEdited",l=>{const c=l.getRow().getData(),u=l.getValue();if(u.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:LUe,params:{courtId:c.courtId,modifications:{courtName:u}}}];qt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const U9=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function Qat(t){const e=t.split("/");if(e[2]==="www.openstreetmap.org"){const i=e.slice(4).join(",");return U9.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function est(t){const r=t.split("/").reduce((s,o)=>o&&o[0]==="@"?o:s,void 0)?.split(","),n=r?.[0].slice(1),a=r?.[1];return{latitude:n,longitude:a}}function tst(t){const e=t.split(",");return U9.test(t)?{latitude:e[0],longitude:e[1]}:{}}function ist(t){const e=t.split("=");if(e.length>1){const i=e[1].split(","),r=[i[0],i[1]].join(",");return U9.test(r)?{latitude:i[0],longitude:i[1]}:{}}return{}}function rst(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}var _E={exports:{}};var nst=_E.exports,_Q;function ast(){return _Q||(_Q=1,(function(t,e){(function(i,r){r(e)})(nst,(function(i){var r="1.9.4";function n(U){var _,$,Y,te;for($=1,Y=arguments.length;$<Y;$++){te=arguments[$];for(_ in te)U[_]=te[_]}return U}var a=Object.create||(function(){function U(){}return function(_){return U.prototype=_,new U}})();function s(U,_){var $=Array.prototype.slice;if(U.bind)return U.bind.apply(U,$.call(arguments,1));var Y=$.call(arguments,2);return function(){return U.apply(_,Y.length?Y.concat($.call(arguments)):arguments)}}var o=0;function l(U){return"_leaflet_id"in U||(U._leaflet_id=++o),U._leaflet_id}function c(U,_,$){var Y,te,pe,we;return we=function(){Y=!1,te&&(pe.apply($,te),te=!1)},pe=function(){Y?te=arguments:(U.apply($,arguments),setTimeout(we,_),Y=!0)},pe}function u(U,_,$){var Y=_[1],te=_[0],pe=Y-te;return U===Y&&$?U:((U-te)%pe+pe)%pe+te}function d(){return!1}function p(U,_){if(_===!1)return U;var $=Math.pow(10,_===void 0?6:_);return Math.round(U*$)/$}function h(U){return U.trim?U.trim():U.replace(/^\s+|\s+$/g,"")}function f(U){return h(U).split(/\s+/)}function m(U,_){Object.prototype.hasOwnProperty.call(U,"options")||(U.options=U.options?a(U.options):{});for(var $ in _)U.options[$]=_[$];return U.options}function g(U,_,$){var Y=[];for(var te in U)Y.push(encodeURIComponent($?te.toUpperCase():te)+"="+encodeURIComponent(U[te]));return(!_||_.indexOf("?")===-1?"?":"&")+Y.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(U,_){return U.replace(v,function($,Y){var te=_[Y];if(te===void 0)throw new Error("No value provided for variable "+$);return typeof te=="function"&&(te=te(_)),te})}var b=Array.isArray||function(U){return Object.prototype.toString.call(U)==="[object Array]"};function I(U,_){for(var $=0;$<U.length;$++)if(U[$]===_)return $;return-1}var w="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function T(U){return window["webkit"+U]||window["moz"+U]||window["ms"+U]}var S=0;function D(U){var _=+new Date,$=Math.max(0,16-(_-S));return S=_+$,window.setTimeout(U,$)}var C=window.requestAnimationFrame||T("RequestAnimationFrame")||D,E=window.cancelAnimationFrame||T("CancelAnimationFrame")||T("CancelRequestAnimationFrame")||function(U){window.clearTimeout(U)};function P(U,_,$){if($&&C===D)U.call(_);else return C.call(window,s(U,_))}function R(U){U&&E.call(window,U)}var M={__proto__:null,extend:n,create:a,bind:s,get lastId(){return o},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:w,requestFn:C,cancelFn:E,requestAnimFrame:P,cancelAnimFrame:R};function A(){}A.extend=function(U){var _=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},$=_.__super__=this.prototype,Y=a($);Y.constructor=_,_.prototype=Y;for(var te in this)Object.prototype.hasOwnProperty.call(this,te)&&te!=="prototype"&&te!=="__super__"&&(_[te]=this[te]);return U.statics&&n(_,U.statics),U.includes&&(N(U.includes),n.apply(null,[Y].concat(U.includes))),n(Y,U),delete Y.statics,delete Y.includes,Y.options&&(Y.options=$.options?a($.options):{},n(Y.options,U.options)),Y._initHooks=[],Y.callInitHooks=function(){if(!this._initHooksCalled){$.callInitHooks&&$.callInitHooks.call(this),this._initHooksCalled=!0;for(var pe=0,we=Y._initHooks.length;pe<we;pe++)Y._initHooks[pe].call(this)}},_},A.include=function(U){var _=this.prototype.options;return n(this.prototype,U),U.options&&(this.prototype.options=_,this.mergeOptions(U.options)),this},A.mergeOptions=function(U){return n(this.prototype.options,U),this},A.addInitHook=function(U){var _=Array.prototype.slice.call(arguments,1),$=typeof U=="function"?U:function(){this[U].apply(this,_)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push($),this};function N(U){if(!(typeof L>"u"||!L||!L.Mixin)){U=b(U)?U:[U];for(var _=0;_<U.length;_++)U[_]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var k={on:function(U,_,$){if(typeof U=="object")for(var Y in U)this._on(Y,U[Y],_);else{U=f(U);for(var te=0,pe=U.length;te<pe;te++)this._on(U[te],_,$)}return this},off:function(U,_,$){if(!arguments.length)delete this._events;else if(typeof U=="object")for(var Y in U)this._off(Y,U[Y],_);else{U=f(U);for(var te=arguments.length===1,pe=0,we=U.length;pe<we;pe++)te?this._off(U[pe]):this._off(U[pe],_,$)}return this},_on:function(U,_,$,Y){if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}if(this._listens(U,_,$)===!1){$===this&&($=void 0);var te={fn:_,ctx:$};Y&&(te.once=!0),this._events=this._events||{},this._events[U]=this._events[U]||[],this._events[U].push(te)}},_off:function(U,_,$){var Y,te,pe;if(this._events&&(Y=this._events[U],!!Y)){if(arguments.length===1){if(this._firingCount)for(te=0,pe=Y.length;te<pe;te++)Y[te].fn=d;delete this._events[U];return}if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}var we=this._listens(U,_,$);if(we!==!1){var Ge=Y[we];this._firingCount&&(Ge.fn=d,this._events[U]=Y=Y.slice()),Y.splice(we,1)}}},fire:function(U,_,$){if(!this.listens(U,$))return this;var Y=n({},_,{type:U,target:this,sourceTarget:_&&_.sourceTarget||this});if(this._events){var te=this._events[U];if(te){this._firingCount=this._firingCount+1||1;for(var pe=0,we=te.length;pe<we;pe++){var Ge=te[pe],Ye=Ge.fn;Ge.once&&this.off(U,Ye,Ge.ctx),Ye.call(Ge.ctx||this,Y)}this._firingCount--}}return $&&this._propagateEvent(Y),this},listens:function(U,_,$,Y){typeof U!="string"&&console.warn('"string" type argument expected');var te=_;typeof _!="function"&&(Y=!!_,te=void 0,$=void 0);var pe=this._events&&this._events[U];if(pe&&pe.length&&this._listens(U,te,$)!==!1)return!0;if(Y){for(var we in this._eventParents)if(this._eventParents[we].listens(U,_,$,Y))return!0}return!1},_listens:function(U,_,$){if(!this._events)return!1;var Y=this._events[U]||[];if(!_)return!!Y.length;$===this&&($=void 0);for(var te=0,pe=Y.length;te<pe;te++)if(Y[te].fn===_&&Y[te].ctx===$)return te;return!1},once:function(U,_,$){if(typeof U=="object")for(var Y in U)this._on(Y,U[Y],_,!0);else{U=f(U);for(var te=0,pe=U.length;te<pe;te++)this._on(U[te],_,$,!0)}return this},addEventParent:function(U){return this._eventParents=this._eventParents||{},this._eventParents[l(U)]=U,this},removeEventParent:function(U){return this._eventParents&&delete this._eventParents[l(U)],this},_propagateEvent:function(U){for(var _ in this._eventParents)this._eventParents[_].fire(U.type,n({layer:U.target,propagatedFrom:U.target},U),!0)}};k.addEventListener=k.on,k.removeEventListener=k.clearAllEventListeners=k.off,k.addOneTimeEventListener=k.once,k.fireEvent=k.fire,k.hasEventListeners=k.listens;var x=A.extend(k);function O(U,_,$){this.x=$?Math.round(U):U,this.y=$?Math.round(_):_}var V=Math.trunc||function(U){return U>0?Math.floor(U):Math.ceil(U)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(U){return this.clone()._add(F(U))},_add:function(U){return this.x+=U.x,this.y+=U.y,this},subtract:function(U){return this.clone()._subtract(F(U))},_subtract:function(U){return this.x-=U.x,this.y-=U.y,this},divideBy:function(U){return this.clone()._divideBy(U)},_divideBy:function(U){return this.x/=U,this.y/=U,this},multiplyBy:function(U){return this.clone()._multiplyBy(U)},_multiplyBy:function(U){return this.x*=U,this.y*=U,this},scaleBy:function(U){return new O(this.x*U.x,this.y*U.y)},unscaleBy:function(U){return new O(this.x/U.x,this.y/U.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=V(this.x),this.y=V(this.y),this},distanceTo:function(U){U=F(U);var _=U.x-this.x,$=U.y-this.y;return Math.sqrt(_*_+$*$)},equals:function(U){return U=F(U),U.x===this.x&&U.y===this.y},contains:function(U){return U=F(U),Math.abs(U.x)<=Math.abs(this.x)&&Math.abs(U.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function F(U,_,$){return U instanceof O?U:b(U)?new O(U[0],U[1]):U==null?U:typeof U=="object"&&"x"in U&&"y"in U?new O(U.x,U.y):new O(U,_,$)}function j(U,_){if(U)for(var $=_?[U,_]:U,Y=0,te=$.length;Y<te;Y++)this.extend($[Y])}j.prototype={extend:function(U){var _,$;if(!U)return this;if(U instanceof O||typeof U[0]=="number"||"x"in U)_=$=F(U);else if(U=q(U),_=U.min,$=U.max,!_||!$)return this;return!this.min&&!this.max?(this.min=_.clone(),this.max=$.clone()):(this.min.x=Math.min(_.x,this.min.x),this.max.x=Math.max($.x,this.max.x),this.min.y=Math.min(_.y,this.min.y),this.max.y=Math.max($.y,this.max.y)),this},getCenter:function(U){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,U)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(U){var _,$;return typeof U[0]=="number"||U instanceof O?U=F(U):U=q(U),U instanceof j?(_=U.min,$=U.max):_=$=U,_.x>=this.min.x&&$.x<=this.max.x&&_.y>=this.min.y&&$.y<=this.max.y},intersects:function(U){U=q(U);var _=this.min,$=this.max,Y=U.min,te=U.max,pe=te.x>=_.x&&Y.x<=$.x,we=te.y>=_.y&&Y.y<=$.y;return pe&&we},overlaps:function(U){U=q(U);var _=this.min,$=this.max,Y=U.min,te=U.max,pe=te.x>_.x&&Y.x<$.x,we=te.y>_.y&&Y.y<$.y;return pe&&we},isValid:function(){return!!(this.min&&this.max)},pad:function(U){var _=this.min,$=this.max,Y=Math.abs(_.x-$.x)*U,te=Math.abs(_.y-$.y)*U;return q(F(_.x-Y,_.y-te),F($.x+Y,$.y+te))},equals:function(U){return U?(U=q(U),this.min.equals(U.getTopLeft())&&this.max.equals(U.getBottomRight())):!1}};function q(U,_){return!U||U instanceof j?U:new j(U,_)}function W(U,_){if(U)for(var $=_?[U,_]:U,Y=0,te=$.length;Y<te;Y++)this.extend($[Y])}W.prototype={extend:function(U){var _=this._southWest,$=this._northEast,Y,te;if(U instanceof H)Y=U,te=U;else if(U instanceof W){if(Y=U._southWest,te=U._northEast,!Y||!te)return this}else return U?this.extend(Z(U)||z(U)):this;return!_&&!$?(this._southWest=new H(Y.lat,Y.lng),this._northEast=new H(te.lat,te.lng)):(_.lat=Math.min(Y.lat,_.lat),_.lng=Math.min(Y.lng,_.lng),$.lat=Math.max(te.lat,$.lat),$.lng=Math.max(te.lng,$.lng)),this},pad:function(U){var _=this._southWest,$=this._northEast,Y=Math.abs(_.lat-$.lat)*U,te=Math.abs(_.lng-$.lng)*U;return new W(new H(_.lat-Y,_.lng-te),new H($.lat+Y,$.lng+te))},getCenter:function(){return new H((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new H(this.getNorth(),this.getWest())},getSouthEast:function(){return new H(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(U){typeof U[0]=="number"||U instanceof H||"lat"in U?U=Z(U):U=z(U);var _=this._southWest,$=this._northEast,Y,te;return U instanceof W?(Y=U.getSouthWest(),te=U.getNorthEast()):Y=te=U,Y.lat>=_.lat&&te.lat<=$.lat&&Y.lng>=_.lng&&te.lng<=$.lng},intersects:function(U){U=z(U);var _=this._southWest,$=this._northEast,Y=U.getSouthWest(),te=U.getNorthEast(),pe=te.lat>=_.lat&&Y.lat<=$.lat,we=te.lng>=_.lng&&Y.lng<=$.lng;return pe&&we},overlaps:function(U){U=z(U);var _=this._southWest,$=this._northEast,Y=U.getSouthWest(),te=U.getNorthEast(),pe=te.lat>_.lat&&Y.lat<$.lat,we=te.lng>_.lng&&Y.lng<$.lng;return pe&&we},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(U,_){return U?(U=z(U),this._southWest.equals(U.getSouthWest(),_)&&this._northEast.equals(U.getNorthEast(),_)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function z(U,_){return U instanceof W?U:new W(U,_)}function H(U,_,$){if(isNaN(U)||isNaN(_))throw new Error("Invalid LatLng object: ("+U+", "+_+")");this.lat=+U,this.lng=+_,$!==void 0&&(this.alt=+$)}H.prototype={equals:function(U,_){if(!U)return!1;U=Z(U);var $=Math.max(Math.abs(this.lat-U.lat),Math.abs(this.lng-U.lng));return $<=(_===void 0?1e-9:_)},toString:function(U){return"LatLng("+p(this.lat,U)+", "+p(this.lng,U)+")"},distanceTo:function(U){return ie.distance(this,Z(U))},wrap:function(){return ie.wrapLatLng(this)},toBounds:function(U){var _=180*U/40075017,$=_/Math.cos(Math.PI/180*this.lat);return z([this.lat-_,this.lng-$],[this.lat+_,this.lng+$])},clone:function(){return new H(this.lat,this.lng,this.alt)}};function Z(U,_,$){return U instanceof H?U:b(U)&&typeof U[0]!="object"?U.length===3?new H(U[0],U[1],U[2]):U.length===2?new H(U[0],U[1]):null:U==null?U:typeof U=="object"&&"lat"in U?new H(U.lat,"lng"in U?U.lng:U.lon,U.alt):_===void 0?null:new H(U,_,$)}var J={latLngToPoint:function(U,_){var $=this.projection.project(U),Y=this.scale(_);return this.transformation._transform($,Y)},pointToLatLng:function(U,_){var $=this.scale(_),Y=this.transformation.untransform(U,$);return this.projection.unproject(Y)},project:function(U){return this.projection.project(U)},unproject:function(U){return this.projection.unproject(U)},scale:function(U){return 256*Math.pow(2,U)},zoom:function(U){return Math.log(U/256)/Math.LN2},getProjectedBounds:function(U){if(this.infinite)return null;var _=this.projection.bounds,$=this.scale(U),Y=this.transformation.transform(_.min,$),te=this.transformation.transform(_.max,$);return new j(Y,te)},infinite:!1,wrapLatLng:function(U){var _=this.wrapLng?u(U.lng,this.wrapLng,!0):U.lng,$=this.wrapLat?u(U.lat,this.wrapLat,!0):U.lat,Y=U.alt;return new H($,_,Y)},wrapLatLngBounds:function(U){var _=U.getCenter(),$=this.wrapLatLng(_),Y=_.lat-$.lat,te=_.lng-$.lng;if(Y===0&&te===0)return U;var pe=U.getSouthWest(),we=U.getNorthEast(),Ge=new H(pe.lat-Y,pe.lng-te),Ye=new H(we.lat-Y,we.lng-te);return new W(Ge,Ye)}},ie=n({},J,{wrapLng:[-180,180],R:6371e3,distance:function(U,_){var $=Math.PI/180,Y=U.lat*$,te=_.lat*$,pe=Math.sin((_.lat-U.lat)*$/2),we=Math.sin((_.lng-U.lng)*$/2),Ge=pe*pe+Math.cos(Y)*Math.cos(te)*we*we,Ye=2*Math.atan2(Math.sqrt(Ge),Math.sqrt(1-Ge));return this.R*Ye}}),K=6378137,ne={R:K,MAX_LATITUDE:85.0511287798,project:function(U){var _=Math.PI/180,$=this.MAX_LATITUDE,Y=Math.max(Math.min($,U.lat),-$),te=Math.sin(Y*_);return new O(this.R*U.lng*_,this.R*Math.log((1+te)/(1-te))/2)},unproject:function(U){var _=180/Math.PI;return new H((2*Math.atan(Math.exp(U.y/this.R))-Math.PI/2)*_,U.x*_/this.R)},bounds:(function(){var U=K*Math.PI;return new j([-U,-U],[U,U])})()};function le(U,_,$,Y){if(b(U)){this._a=U[0],this._b=U[1],this._c=U[2],this._d=U[3];return}this._a=U,this._b=_,this._c=$,this._d=Y}le.prototype={transform:function(U,_){return this._transform(U.clone(),_)},_transform:function(U,_){return _=_||1,U.x=_*(this._a*U.x+this._b),U.y=_*(this._c*U.y+this._d),U},untransform:function(U,_){return _=_||1,new O((U.x/_-this._b)/this._a,(U.y/_-this._d)/this._c)}};function re(U,_,$,Y){return new le(U,_,$,Y)}var me=n({},ie,{code:"EPSG:3857",projection:ne,transformation:(function(){var U=.5/(Math.PI*ne.R);return re(U,.5,-U,.5)})()}),he=n({},me,{code:"EPSG:900913"});function Ie(U){return document.createElementNS("http://www.w3.org/2000/svg",U)}function Le(U,_){var $="",Y,te,pe,we,Ge,Ye;for(Y=0,pe=U.length;Y<pe;Y++){for(Ge=U[Y],te=0,we=Ge.length;te<we;te++)Ye=Ge[te],$+=(te?"L":"M")+Ye.x+" "+Ye.y;$+=_?Jt.svg?"z":"x":""}return $||"M0 0"}var ot=document.documentElement.style,at="ActiveXObject"in window,dt=at&&!document.addEventListener,It="msLaunchUri"in navigator&&!("documentMode"in document),ze=ha("webkit"),Ct=ha("android"),ke=ha("android 2")||ha("android 3"),mt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Be=Ct&&ha("Google")&&mt<537&&!("AudioNode"in window),ut=!!window.opera,it=!It&&ha("chrome"),xe=ha("gecko")&&!ze&&!ut&&!at,Ze=!it&&ha("safari"),st=ha("phantom"),qe="OTransition"in ot,ft=navigator.platform.indexOf("Win")===0,_t=at&&"transition"in ot,ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ke,$e="MozPerspective"in ot,De=!window.L_DISABLE_3D&&(_t||ve||$e)&&!qe&&!st,je=typeof orientation<"u"||ha("mobile"),Oe=je&&ze,nt=je&&ve,Fe=!window.PointerEvent&&window.MSPointerEvent,wt=!!(window.PointerEvent||Fe),pt="ontouchstart"in window||!!window.TouchEvent,Mt=!window.L_NO_TOUCH&&(pt||wt),Wi=je&&ut,Qt=je&&xe,tr=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Vi=(function(){var U=!1;try{var _=Object.defineProperty({},"passive",{get:function(){U=!0}});window.addEventListener("testPassiveEventSupport",d,_),window.removeEventListener("testPassiveEventSupport",d,_)}catch{}return U})(),$i=(function(){return!!document.createElement("canvas").getContext})(),Wr=!!(document.createElementNS&&Ie("svg").createSVGRect),Yn=!!Wr&&(function(){var U=document.createElement("div");return U.innerHTML="<svg/>",(U.firstChild&&U.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),$l=!Wr&&(function(){try{var U=document.createElement("div");U.innerHTML='<v:shape adj="1"/>';var _=U.firstChild;return _.style.behavior="url(#default#VML)",_&&typeof _.adj=="object"}catch{return!1}})(),tn=navigator.platform.indexOf("Mac")===0,rn=navigator.platform.indexOf("Linux")===0;function ha(U){return navigator.userAgent.toLowerCase().indexOf(U)>=0}var Jt={ie:at,ielt9:dt,edge:It,webkit:ze,android:Ct,android23:ke,androidStock:Be,opera:ut,chrome:it,gecko:xe,safari:Ze,phantom:st,opera12:qe,win:ft,ie3d:_t,webkit3d:ve,gecko3d:$e,any3d:De,mobile:je,mobileWebkit:Oe,mobileWebkit3d:nt,msPointer:Fe,pointer:wt,touch:Mt,touchNative:pt,mobileOpera:Wi,mobileGecko:Qt,retina:tr,passiveEvents:Vi,canvas:$i,svg:Wr,vml:$l,inlineSvg:Yn,mac:tn,linux:rn},sr=Jt.msPointer?"MSPointerDown":"pointerdown",Vl=Jt.msPointer?"MSPointerMove":"pointermove",nd=Jt.msPointer?"MSPointerUp":"pointerup",Uo=Jt.msPointer?"MSPointerCancel":"pointercancel",Hs={touchstart:sr,touchmove:Vl,touchend:nd,touchcancel:Uo},zs={touchstart:cl,touchmove:$o,touchend:$o,touchcancel:$o},yn={},wc=!1;function jl(U,_,$){return _==="touchstart"&&$n(),zs[_]?($=zs[_].bind(this,$),U.addEventListener(Hs[_],$,!1),$):(console.warn("wrong event specified:",_),d)}function cf(U,_,$){if(!Hs[_]){console.warn("wrong event specified:",_);return}U.removeEventListener(Hs[_],$,!1)}function Sc(U){yn[U.pointerId]=U}function jp(U){yn[U.pointerId]&&(yn[U.pointerId]=U)}function fa(U){delete yn[U.pointerId]}function $n(){wc||(document.addEventListener(sr,Sc,!0),document.addEventListener(Vl,jp,!0),document.addEventListener(nd,fa,!0),document.addEventListener(Uo,fa,!0),wc=!0)}function $o(U,_){if(_.pointerType!==(_.MSPOINTER_TYPE_MOUSE||"mouse")){_.touches=[];for(var $ in yn)_.touches.push(yn[$]);_.changedTouches=[_],U(_)}}function cl(U,_){_.MSPOINTER_TYPE_TOUCH&&_.pointerType===_.MSPOINTER_TYPE_TOUCH&&Na(_),$o(U,_)}function uf(U){var _={},$,Y;for(Y in U)$=U[Y],_[Y]=$&&$.bind?$.bind(U):$;return U=_,_.type="dblclick",_.detail=2,_.isTrusted=!1,_._simulated=!0,_}var Gl=200;function Hl(U,_){U.addEventListener("dblclick",_);var $=0,Y;function te(pe){if(pe.detail!==1){Y=pe.detail;return}if(!(pe.pointerType==="mouse"||pe.sourceCapabilities&&!pe.sourceCapabilities.firesTouchEvents)){var we=Q(pe);if(!(we.some(function(Ye){return Ye instanceof HTMLLabelElement&&Ye.attributes.for})&&!we.some(function(Ye){return Ye instanceof HTMLInputElement||Ye instanceof HTMLSelectElement}))){var Ge=Date.now();Ge-$<=Gl?(Y++,Y===2&&_(uf(pe))):Y=1,$=Ge}}}return U.addEventListener("click",te),{dblclick:_,simDblclick:te}}function Od(U,_){U.removeEventListener("dblclick",_.dblclick),U.removeEventListener("click",_.simDblclick)}var zl=Xe(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ma=Xe(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ou=ma==="webkitTransition"||ma==="OTransition"?ma+"End":"transitionend";function lu(U){return typeof U=="string"?document.getElementById(U):U}function Tc(U,_){var $=U.style[_]||U.currentStyle&&U.currentStyle[_];if((!$||$==="auto")&&document.defaultView){var Y=document.defaultView.getComputedStyle(U,null);$=Y?Y[_]:null}return $==="auto"?null:$}function Kt(U,_,$){var Y=document.createElement(U);return Y.className=_||"",$&&$.appendChild(Y),Y}function Mn(U){var _=U.parentNode;_&&_.removeChild(U)}function ul(U){for(;U.firstChild;)U.removeChild(U.firstChild)}function ns(U){var _=U.parentNode;_&&_.lastChild!==U&&_.appendChild(U)}function to(U){var _=U.parentNode;_&&_.firstChild!==U&&_.insertBefore(U,_.firstChild)}function Ts(U,_){if(U.classList!==void 0)return U.classList.contains(_);var $=ql(U);return $.length>0&&new RegExp("(^|\\s)"+_+"(\\s|$)").test($)}function ki(U,_){if(U.classList!==void 0)for(var $=f(_),Y=0,te=$.length;Y<te;Y++)U.classList.add($[Y]);else if(!Ts(U,_)){var pe=ql(U);Zr(U,(pe?pe+" ":"")+_)}}function fn(U,_){U.classList!==void 0?U.classList.remove(_):Zr(U,h((" "+ql(U)+" ").replace(" "+_+" "," ")))}function Zr(U,_){U.className.baseVal===void 0?U.className=_:U.className.baseVal=_}function ql(U){return U.correspondingElement&&(U=U.correspondingElement),U.className.baseVal===void 0?U.className:U.className.baseVal}function Ya(U,_){"opacity"in U.style?U.style.opacity=_:"filter"in U.style&&ad(U,_)}function ad(U,_){var $=!1,Y="DXImageTransform.Microsoft.Alpha";try{$=U.filters.item(Y)}catch{if(_===1)return}_=Math.round(_*100),$?($.Enabled=_!==100,$.Opacity=_):U.style.filter+=" progid:"+Y+"(opacity="+_+")"}function Xe(U){for(var _=document.documentElement.style,$=0;$<U.length;$++)if(U[$]in _)return U[$];return!1}function di(U,_,$){var Y=_||new O(0,0);U.style[zl]=(Jt.ie3d?"translate("+Y.x+"px,"+Y.y+"px)":"translate3d("+Y.x+"px,"+Y.y+"px,0)")+($?" scale("+$+")":"")}function Ri(U,_){U._leaflet_pos=_,Jt.any3d?di(U,_):(U.style.left=_.x+"px",U.style.top=_.y+"px")}function Mi(U){return U._leaflet_pos||new O(0,0)}var mn,Ma,Uc;if("onselectstart"in document)mn=function(){ni(window,"selectstart",Na)},Ma=function(){Ar(window,"selectstart",Na)};else{var gr=Xe(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);mn=function(){if(gr){var U=document.documentElement.style;Uc=U[gr],U[gr]="none"}},Ma=function(){gr&&(document.documentElement.style[gr]=Uc,Uc=void 0)}}function dl(){ni(window,"dragstart",Na)}function _m(){Ar(window,"dragstart",Na)}var df,qs;function cu(U){for(;U.tabIndex===-1;)U=U.parentNode;U.style&&(uu(),df=U,qs=U.style.outlineStyle,U.style.outlineStyle="none",ni(window,"keydown",uu))}function uu(){df&&(df.style.outlineStyle=qs,df=void 0,qs=void 0,Ar(window,"keydown",uu))}function ga(U){do U=U.parentNode;while((!U.offsetWidth||!U.offsetHeight)&&U!==document.body);return U}function Gp(U){var _=U.getBoundingClientRect();return{x:_.width/U.offsetWidth||1,y:_.height/U.offsetHeight||1,boundingClientRect:_}}var km={__proto__:null,TRANSFORM:zl,TRANSITION:ma,TRANSITION_END:ou,get:lu,getStyle:Tc,create:Kt,remove:Mn,empty:ul,toFront:ns,toBack:to,hasClass:Ts,addClass:ki,removeClass:fn,setClass:Zr,getClass:ql,setOpacity:Ya,testProp:Xe,setTransform:di,setPosition:Ri,getPosition:Mi,get disableTextSelection(){return mn},get enableTextSelection(){return Ma},disableImageDrag:dl,enableImageDrag:_m,preventOutline:cu,restoreOutline:uu,getSizedParentNode:ga,getScale:Gp};function ni(U,_,$,Y){if(_&&typeof _=="object")for(var te in _)Vo(U,te,_[te],$);else{_=f(_);for(var pe=0,we=_.length;pe<we;pe++)Vo(U,_[pe],$,Y)}return this}var va="_leaflet_events";function Ar(U,_,$,Y){if(arguments.length===1)xd(U),delete U[va];else if(_&&typeof _=="object")for(var te in _)pf(U,te,_[te],$);else if(_=f(_),arguments.length===2)xd(U,function(Ge){return I(_,Ge)!==-1});else for(var pe=0,we=_.length;pe<we;pe++)pf(U,_[pe],$,Y);return this}function xd(U,_){for(var $ in U[va]){var Y=$.split(/\d/)[0];(!_||_(Y))&&pf(U,Y,null,null,$)}}var Ld={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Vo(U,_,$,Y){var te=_+l($)+(Y?"_"+l(Y):"");if(U[va]&&U[va][te])return this;var pe=function(Ge){return $.call(Y||U,Ge||window.event)},we=pe;!Jt.touchNative&&Jt.pointer&&_.indexOf("touch")===0?pe=jl(U,_,pe):Jt.touch&&_==="dblclick"?pe=Hl(U,pe):"addEventListener"in U?_==="touchstart"||_==="touchmove"||_==="wheel"||_==="mousewheel"?U.addEventListener(Ld[_]||_,pe,Jt.passiveEvents?{passive:!1}:!1):_==="mouseenter"||_==="mouseleave"?(pe=function(Ge){Ge=Ge||window.event,Yi(U,Ge)&&we(Ge)},U.addEventListener(Ld[_],pe,!1)):U.addEventListener(_,we,!1):U.attachEvent("on"+_,pe),U[va]=U[va]||{},U[va][te]=pe}function pf(U,_,$,Y,te){te=te||_+l($)+(Y?"_"+l(Y):"");var pe=U[va]&&U[va][te];if(!pe)return this;!Jt.touchNative&&Jt.pointer&&_.indexOf("touch")===0?cf(U,_,pe):Jt.touch&&_==="dblclick"?Od(U,pe):"removeEventListener"in U?U.removeEventListener(Ld[_]||_,pe,!1):U.detachEvent("on"+_,pe),U[va][te]=null}function Vn(U){return U.stopPropagation?U.stopPropagation():U.originalEvent?U.originalEvent._stopped=!0:U.cancelBubble=!0,this}function Fd(U){return Vo(U,"wheel",Vn),this}function du(U){return ni(U,"mousedown touchstart dblclick contextmenu",Vn),U._leaflet_disable_click=!0,this}function Na(U){return U.preventDefault?U.preventDefault():U.returnValue=!1,this}function pl(U){return Na(U),Vn(U),this}function Q(U){if(U.composedPath)return U.composedPath();for(var _=[],$=U.target;$;)_.push($),$=$.parentNode;return _}function fe(U,_){if(!_)return new O(U.clientX,U.clientY);var $=Gp(_),Y=$.boundingClientRect;return new O((U.clientX-Y.left)/$.x-_.clientLeft,(U.clientY-Y.top)/$.y-_.clientTop)}var Ue=Jt.linux&&Jt.chrome?window.devicePixelRatio:Jt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function tt(U){return Jt.edge?U.wheelDeltaY/2:U.deltaY&&U.deltaMode===0?-U.deltaY/Ue:U.deltaY&&U.deltaMode===1?-U.deltaY*20:U.deltaY&&U.deltaMode===2?-U.deltaY*60:U.deltaX||U.deltaZ?0:U.wheelDelta?(U.wheelDeltaY||U.wheelDelta)/2:U.detail&&Math.abs(U.detail)<32765?-U.detail*20:U.detail?U.detail/-32765*60:0}function Yi(U,_){var $=_.relatedTarget;if(!$)return!0;try{for(;$&&$!==U;)$=$.parentNode}catch{return!1}return $!==U}var wi={__proto__:null,on:ni,off:Ar,stopPropagation:Vn,disableScrollPropagation:Fd,disableClickPropagation:du,preventDefault:Na,stop:pl,getPropagationPath:Q,getMousePosition:fe,getWheelDelta:tt,isExternalTarget:Yi,addListener:ni,removeListener:Ar},Rr=x.extend({run:function(U,_,$,Y){this.stop(),this._el=U,this._inProgress=!0,this._duration=$||.25,this._easeOutPower=1/Math.max(Y||.5,.2),this._startPos=Mi(U),this._offset=_.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=P(this._animate,this),this._step()},_step:function(U){var _=+new Date-this._startTime,$=this._duration*1e3;_<$?this._runFrame(this._easeOut(_/$),U):(this._runFrame(1),this._complete())},_runFrame:function(U,_){var $=this._startPos.add(this._offset.multiplyBy(U));_&&$._round(),Ri(this._el,$),this.fire("step")},_complete:function(){R(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(U){return 1-Math.pow(1-U,this._easeOutPower)}}),Zt=x.extend({options:{crs:me,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(U,_){_=m(this,_),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(U),this._initLayout(),this._onResize=s(this._onResize,this),this._initEvents(),_.maxBounds&&this.setMaxBounds(_.maxBounds),_.zoom!==void 0&&(this._zoom=this._limitZoom(_.zoom)),_.center&&_.zoom!==void 0&&this.setView(Z(_.center),_.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ma&&Jt.any3d&&!Jt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ni(this._proxy,ou,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(U,_,$){if(_=_===void 0?this._zoom:this._limitZoom(_),U=this._limitCenter(Z(U),_,this.options.maxBounds),$=$||{},this._stop(),this._loaded&&!$.reset&&$!==!0){$.animate!==void 0&&($.zoom=n({animate:$.animate},$.zoom),$.pan=n({animate:$.animate,duration:$.duration},$.pan));var Y=this._zoom!==_?this._tryAnimatedZoom&&this._tryAnimatedZoom(U,_,$.zoom):this._tryAnimatedPan(U,$.pan);if(Y)return clearTimeout(this._sizeTimer),this}return this._resetView(U,_,$.pan&&$.pan.noMoveStart),this},setZoom:function(U,_){return this._loaded?this.setView(this.getCenter(),U,{zoom:_}):(this._zoom=U,this)},zoomIn:function(U,_){return U=U||(Jt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+U,_)},zoomOut:function(U,_){return U=U||(Jt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-U,_)},setZoomAround:function(U,_,$){var Y=this.getZoomScale(_),te=this.getSize().divideBy(2),pe=U instanceof O?U:this.latLngToContainerPoint(U),we=pe.subtract(te).multiplyBy(1-1/Y),Ge=this.containerPointToLatLng(te.add(we));return this.setView(Ge,_,{zoom:$})},_getBoundsCenterZoom:function(U,_){_=_||{},U=U.getBounds?U.getBounds():z(U);var $=F(_.paddingTopLeft||_.padding||[0,0]),Y=F(_.paddingBottomRight||_.padding||[0,0]),te=this.getBoundsZoom(U,!1,$.add(Y));if(te=typeof _.maxZoom=="number"?Math.min(_.maxZoom,te):te,te===1/0)return{center:U.getCenter(),zoom:te};var pe=Y.subtract($).divideBy(2),we=this.project(U.getSouthWest(),te),Ge=this.project(U.getNorthEast(),te),Ye=this.unproject(we.add(Ge).divideBy(2).add(pe),te);return{center:Ye,zoom:te}},fitBounds:function(U,_){if(U=z(U),!U.isValid())throw new Error("Bounds are not valid.");var $=this._getBoundsCenterZoom(U,_);return this.setView($.center,$.zoom,_)},fitWorld:function(U){return this.fitBounds([[-90,-180],[90,180]],U)},panTo:function(U,_){return this.setView(U,this._zoom,{pan:_})},panBy:function(U,_){if(U=F(U).round(),_=_||{},!U.x&&!U.y)return this.fire("moveend");if(_.animate!==!0&&!this.getSize().contains(U))return this._resetView(this.unproject(this.project(this.getCenter()).add(U)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Rr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),_.noMoveStart||this.fire("movestart"),_.animate!==!1){ki(this._mapPane,"leaflet-pan-anim");var $=this._getMapPanePos().subtract(U).round();this._panAnim.run(this._mapPane,$,_.duration||.25,_.easeLinearity)}else this._rawPanBy(U),this.fire("move").fire("moveend");return this},flyTo:function(U,_,$){if($=$||{},$.animate===!1||!Jt.any3d)return this.setView(U,_,$);this._stop();var Y=this.project(this.getCenter()),te=this.project(U),pe=this.getSize(),we=this._zoom;U=Z(U),_=_===void 0?we:_;var Ge=Math.max(pe.x,pe.y),Ye=Ge*this.getZoomScale(we,_),gt=te.distanceTo(Y)||1,ti=1.42,Zi=ti*ti;function $r(io){var vM=io?-1:1,p1e=io?Ye:Ge,h1e=Ye*Ye-Ge*Ge+vM*Zi*Zi*gt*gt,f1e=2*p1e*Zi*gt,R2=h1e/f1e,pY=Math.sqrt(R2*R2+1)-R2,m1e=pY<1e-9?-18:Math.log(pY);return m1e}function Dc(io){return(Math.exp(io)-Math.exp(-io))/2}function zo(io){return(Math.exp(io)+Math.exp(-io))/2}function jd(io){return Dc(io)/zo(io)}var gu=$r(0);function oS(io){return Ge*(zo(gu)/zo(gu+ti*io))}function l1e(io){return Ge*(zo(gu)*jd(gu+ti*io)-Dc(gu))/Zi}function c1e(io){return 1-Math.pow(1-io,1.5)}var u1e=Date.now(),uY=($r(1)-gu)/ti,d1e=$.duration?1e3*$.duration:1e3*uY*.8;function dY(){var io=(Date.now()-u1e)/d1e,vM=c1e(io)*uY;io<=1?(this._flyToFrame=P(dY,this),this._move(this.unproject(Y.add(te.subtract(Y).multiplyBy(l1e(vM)/gt)),we),this.getScaleZoom(Ge/oS(vM),we),{flyTo:!0})):this._move(U,_)._moveEnd(!0)}return this._moveStart(!0,$.noMoveStart),dY.call(this),this},flyToBounds:function(U,_){var $=this._getBoundsCenterZoom(U,_);return this.flyTo($.center,$.zoom,_)},setMaxBounds:function(U){return U=z(U),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),U.isValid()?(this.options.maxBounds=U,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(U){var _=this.options.minZoom;return this.options.minZoom=U,this._loaded&&_!==U&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(U):this},setMaxZoom:function(U){var _=this.options.maxZoom;return this.options.maxZoom=U,this._loaded&&_!==U&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(U):this},panInsideBounds:function(U,_){this._enforcingBounds=!0;var $=this.getCenter(),Y=this._limitCenter($,this._zoom,z(U));return $.equals(Y)||this.panTo(Y,_),this._enforcingBounds=!1,this},panInside:function(U,_){_=_||{};var $=F(_.paddingTopLeft||_.padding||[0,0]),Y=F(_.paddingBottomRight||_.padding||[0,0]),te=this.project(this.getCenter()),pe=this.project(U),we=this.getPixelBounds(),Ge=q([we.min.add($),we.max.subtract(Y)]),Ye=Ge.getSize();if(!Ge.contains(pe)){this._enforcingBounds=!0;var gt=pe.subtract(Ge.getCenter()),ti=Ge.extend(pe).getSize().subtract(Ye);te.x+=gt.x<0?-ti.x:ti.x,te.y+=gt.y<0?-ti.y:ti.y,this.panTo(this.unproject(te),_),this._enforcingBounds=!1}return this},invalidateSize:function(U){if(!this._loaded)return this;U=n({animate:!1,pan:!0},U===!0?{animate:!0}:U);var _=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var $=this.getSize(),Y=_.divideBy(2).round(),te=$.divideBy(2).round(),pe=Y.subtract(te);return!pe.x&&!pe.y?this:(U.animate&&U.pan?this.panBy(pe):(U.pan&&this._rawPanBy(pe),this.fire("move"),U.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:_,newSize:$}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(U){if(U=this._locateOptions=n({timeout:1e4,watch:!1},U),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var _=s(this._handleGeolocationResponse,this),$=s(this._handleGeolocationError,this);return U.watch?this._locationWatchId=navigator.geolocation.watchPosition(_,$,U):navigator.geolocation.getCurrentPosition(_,$,U),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(U){if(this._container._leaflet_id){var _=U.code,$=U.message||(_===1?"permission denied":_===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:_,message:"Geolocation error: "+$+"."})}},_handleGeolocationResponse:function(U){if(this._container._leaflet_id){var _=U.coords.latitude,$=U.coords.longitude,Y=new H(_,$),te=Y.toBounds(U.coords.accuracy*2),pe=this._locateOptions;if(pe.setView){var we=this.getBoundsZoom(te);this.setView(Y,pe.maxZoom?Math.min(we,pe.maxZoom):we)}var Ge={latlng:Y,bounds:te,timestamp:U.timestamp};for(var Ye in U.coords)typeof U.coords[Ye]=="number"&&(Ge[Ye]=U.coords[Ye]);this.fire("locationfound",Ge)}},addHandler:function(U,_){if(!_)return this;var $=this[U]=new _(this);return this._handlers.push($),this.options[U]&&$.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Mn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(R(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var U;for(U in this._layers)this._layers[U].remove();for(U in this._panes)Mn(this._panes[U]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(U,_){var $="leaflet-pane"+(U?" leaflet-"+U.replace("Pane","")+"-pane":""),Y=Kt("div",$,_||this._mapPane);return U&&(this._panes[U]=Y),Y},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var U=this.getPixelBounds(),_=this.unproject(U.getBottomLeft()),$=this.unproject(U.getTopRight());return new W(_,$)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(U,_,$){U=z(U),$=F($||[0,0]);var Y=this.getZoom()||0,te=this.getMinZoom(),pe=this.getMaxZoom(),we=U.getNorthWest(),Ge=U.getSouthEast(),Ye=this.getSize().subtract($),gt=q(this.project(Ge,Y),this.project(we,Y)).getSize(),ti=Jt.any3d?this.options.zoomSnap:1,Zi=Ye.x/gt.x,$r=Ye.y/gt.y,Dc=_?Math.max(Zi,$r):Math.min(Zi,$r);return Y=this.getScaleZoom(Dc,Y),ti&&(Y=Math.round(Y/(ti/100))*(ti/100),Y=_?Math.ceil(Y/ti)*ti:Math.floor(Y/ti)*ti),Math.max(te,Math.min(pe,Y))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(U,_){var $=this._getTopLeftPoint(U,_);return new j($,$.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(U){return this.options.crs.getProjectedBounds(U===void 0?this.getZoom():U)},getPane:function(U){return typeof U=="string"?this._panes[U]:U},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(U,_){var $=this.options.crs;return _=_===void 0?this._zoom:_,$.scale(U)/$.scale(_)},getScaleZoom:function(U,_){var $=this.options.crs;_=_===void 0?this._zoom:_;var Y=$.zoom(U*$.scale(_));return isNaN(Y)?1/0:Y},project:function(U,_){return _=_===void 0?this._zoom:_,this.options.crs.latLngToPoint(Z(U),_)},unproject:function(U,_){return _=_===void 0?this._zoom:_,this.options.crs.pointToLatLng(F(U),_)},layerPointToLatLng:function(U){var _=F(U).add(this.getPixelOrigin());return this.unproject(_)},latLngToLayerPoint:function(U){var _=this.project(Z(U))._round();return _._subtract(this.getPixelOrigin())},wrapLatLng:function(U){return this.options.crs.wrapLatLng(Z(U))},wrapLatLngBounds:function(U){return this.options.crs.wrapLatLngBounds(z(U))},distance:function(U,_){return this.options.crs.distance(Z(U),Z(_))},containerPointToLayerPoint:function(U){return F(U).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(U){return F(U).add(this._getMapPanePos())},containerPointToLatLng:function(U){var _=this.containerPointToLayerPoint(F(U));return this.layerPointToLatLng(_)},latLngToContainerPoint:function(U){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Z(U)))},mouseEventToContainerPoint:function(U){return fe(U,this._container)},mouseEventToLayerPoint:function(U){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(U))},mouseEventToLatLng:function(U){return this.layerPointToLatLng(this.mouseEventToLayerPoint(U))},_initContainer:function(U){var _=this._container=lu(U);if(_){if(_._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ni(_,"scroll",this._onScroll,this),this._containerId=l(_)},_initLayout:function(){var U=this._container;this._fadeAnimated=this.options.fadeAnimation&&Jt.any3d,ki(U,"leaflet-container"+(Jt.touch?" leaflet-touch":"")+(Jt.retina?" leaflet-retina":"")+(Jt.ielt9?" leaflet-oldie":"")+(Jt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var _=Tc(U,"position");_!=="absolute"&&_!=="relative"&&_!=="fixed"&&_!=="sticky"&&(U.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var U=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ri(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ki(U.markerPane,"leaflet-zoom-hide"),ki(U.shadowPane,"leaflet-zoom-hide"))},_resetView:function(U,_,$){Ri(this._mapPane,new O(0,0));var Y=!this._loaded;this._loaded=!0,_=this._limitZoom(_),this.fire("viewprereset");var te=this._zoom!==_;this._moveStart(te,$)._move(U,_)._moveEnd(te),this.fire("viewreset"),Y&&this.fire("load")},_moveStart:function(U,_){return U&&this.fire("zoomstart"),_||this.fire("movestart"),this},_move:function(U,_,$,Y){_===void 0&&(_=this._zoom);var te=this._zoom!==_;return this._zoom=_,this._lastCenter=U,this._pixelOrigin=this._getNewPixelOrigin(U),Y?$&&$.pinch&&this.fire("zoom",$):((te||$&&$.pinch)&&this.fire("zoom",$),this.fire("move",$)),this},_moveEnd:function(U){return U&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return R(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(U){Ri(this._mapPane,this._getMapPanePos().subtract(U))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(U){this._targets={},this._targets[l(this._container)]=this;var _=U?Ar:ni;_(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&_(window,"resize",this._onResize,this),Jt.any3d&&this.options.transform3DLimit&&(U?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){R(this._resizeRequest),this._resizeRequest=P(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var U=this._getMapPanePos();Math.max(Math.abs(U.x),Math.abs(U.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(U,_){for(var $=[],Y,te=_==="mouseout"||_==="mouseover",pe=U.target||U.srcElement,we=!1;pe;){if(Y=this._targets[l(pe)],Y&&(_==="click"||_==="preclick")&&this._draggableMoved(Y)){we=!0;break}if(Y&&Y.listens(_,!0)&&(te&&!Yi(pe,U)||($.push(Y),te))||pe===this._container)break;pe=pe.parentNode}return!$.length&&!we&&!te&&this.listens(_,!0)&&($=[this]),$},_isClickDisabled:function(U){for(;U&&U!==this._container;){if(U._leaflet_disable_click)return!0;U=U.parentNode}},_handleDOMEvent:function(U){var _=U.target||U.srcElement;if(!(!this._loaded||_._leaflet_disable_events||U.type==="click"&&this._isClickDisabled(_))){var $=U.type;$==="mousedown"&&cu(_),this._fireDOMEvent(U,$)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(U,_,$){if(U.type==="click"){var Y=n({},U);Y.type="preclick",this._fireDOMEvent(Y,Y.type,$)}var te=this._findEventTargets(U,_);if($){for(var pe=[],we=0;we<$.length;we++)$[we].listens(_,!0)&&pe.push($[we]);te=pe.concat(te)}if(te.length){_==="contextmenu"&&Na(U);var Ge=te[0],Ye={originalEvent:U};if(U.type!=="keypress"&&U.type!=="keydown"&&U.type!=="keyup"){var gt=Ge.getLatLng&&(!Ge._radius||Ge._radius<=10);Ye.containerPoint=gt?this.latLngToContainerPoint(Ge.getLatLng()):this.mouseEventToContainerPoint(U),Ye.layerPoint=this.containerPointToLayerPoint(Ye.containerPoint),Ye.latlng=gt?Ge.getLatLng():this.layerPointToLatLng(Ye.layerPoint)}for(we=0;we<te.length;we++)if(te[we].fire(_,Ye,!0),Ye.originalEvent._stopped||te[we].options.bubblingMouseEvents===!1&&I(this._mouseEvents,_)!==-1)return}},_draggableMoved:function(U){return U=U.dragging&&U.dragging.enabled()?U:this,U.dragging&&U.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var U=0,_=this._handlers.length;U<_;U++)this._handlers[U].disable()},whenReady:function(U,_){return this._loaded?U.call(_||this,{target:this}):this.on("load",U,_),this},_getMapPanePos:function(){return Mi(this._mapPane)||new O(0,0)},_moved:function(){var U=this._getMapPanePos();return U&&!U.equals([0,0])},_getTopLeftPoint:function(U,_){var $=U&&_!==void 0?this._getNewPixelOrigin(U,_):this.getPixelOrigin();return $.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(U,_){var $=this.getSize()._divideBy(2);return this.project(U,_)._subtract($)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(U,_,$){var Y=this._getNewPixelOrigin($,_);return this.project(U,_)._subtract(Y)},_latLngBoundsToNewLayerBounds:function(U,_,$){var Y=this._getNewPixelOrigin($,_);return q([this.project(U.getSouthWest(),_)._subtract(Y),this.project(U.getNorthWest(),_)._subtract(Y),this.project(U.getSouthEast(),_)._subtract(Y),this.project(U.getNorthEast(),_)._subtract(Y)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(U){return this.latLngToLayerPoint(U).subtract(this._getCenterLayerPoint())},_limitCenter:function(U,_,$){if(!$)return U;var Y=this.project(U,_),te=this.getSize().divideBy(2),pe=new j(Y.subtract(te),Y.add(te)),we=this._getBoundsOffset(pe,$,_);return Math.abs(we.x)<=1&&Math.abs(we.y)<=1?U:this.unproject(Y.add(we),_)},_limitOffset:function(U,_){if(!_)return U;var $=this.getPixelBounds(),Y=new j($.min.add(U),$.max.add(U));return U.add(this._getBoundsOffset(Y,_))},_getBoundsOffset:function(U,_,$){var Y=q(this.project(_.getNorthEast(),$),this.project(_.getSouthWest(),$)),te=Y.min.subtract(U.min),pe=Y.max.subtract(U.max),we=this._rebound(te.x,-pe.x),Ge=this._rebound(te.y,-pe.y);return new O(we,Ge)},_rebound:function(U,_){return U+_>0?Math.round(U-_)/2:Math.max(0,Math.ceil(U))-Math.max(0,Math.floor(_))},_limitZoom:function(U){var _=this.getMinZoom(),$=this.getMaxZoom(),Y=Jt.any3d?this.options.zoomSnap:1;return Y&&(U=Math.round(U/Y)*Y),Math.max(_,Math.min($,U))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){fn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(U,_){var $=this._getCenterOffset(U)._trunc();return(_&&_.animate)!==!0&&!this.getSize().contains($)?!1:(this.panBy($,_),!0)},_createAnimProxy:function(){var U=this._proxy=Kt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(U),this.on("zoomanim",function(_){var $=zl,Y=this._proxy.style[$];di(this._proxy,this.project(_.center,_.zoom),this.getZoomScale(_.zoom,1)),Y===this._proxy.style[$]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Mn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var U=this.getCenter(),_=this.getZoom();di(this._proxy,this.project(U,_),this.getZoomScale(_,1))},_catchTransitionEnd:function(U){this._animatingZoom&&U.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(U,_,$){if(this._animatingZoom)return!0;if($=$||{},!this._zoomAnimated||$.animate===!1||this._nothingToAnimate()||Math.abs(_-this._zoom)>this.options.zoomAnimationThreshold)return!1;var Y=this.getZoomScale(_),te=this._getCenterOffset(U)._divideBy(1-1/Y);return $.animate!==!0&&!this.getSize().contains(te)?!1:(P(function(){this._moveStart(!0,$.noMoveStart||!1)._animateZoom(U,_,!0)},this),!0)},_animateZoom:function(U,_,$,Y){this._mapPane&&($&&(this._animatingZoom=!0,this._animateToCenter=U,this._animateToZoom=_,ki(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:U,zoom:_,noUpdate:Y}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(s(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&fn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Sa(U,_){return new Zt(U,_)}var ur=A.extend({options:{position:"topright"},initialize:function(U){m(this,U)},getPosition:function(){return this.options.position},setPosition:function(U){var _=this._map;return _&&_.removeControl(this),this.options.position=U,_&&_.addControl(this),this},getContainer:function(){return this._container},addTo:function(U){this.remove(),this._map=U;var _=this._container=this.onAdd(U),$=this.getPosition(),Y=U._controlCorners[$];return ki(_,"leaflet-control"),$.indexOf("bottom")!==-1?Y.insertBefore(_,Y.firstChild):Y.appendChild(_),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Mn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(U){this._map&&U&&U.screenX>0&&U.screenY>0&&this._map.getContainer().focus()}}),Ka=function(U){return new ur(U)};Zt.include({addControl:function(U){return U.addTo(this),this},removeControl:function(U){return U.remove(),this},_initControlPos:function(){var U=this._controlCorners={},_="leaflet-",$=this._controlContainer=Kt("div",_+"control-container",this._container);function Y(te,pe){var we=_+te+" "+_+pe;U[te+pe]=Kt("div",we,$)}Y("top","left"),Y("top","right"),Y("bottom","left"),Y("bottom","right")},_clearControlPos:function(){for(var U in this._controlCorners)Mn(this._controlCorners[U]);Mn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Do=ur.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(U,_,$,Y){return $<Y?-1:Y<$?1:0}},initialize:function(U,_,$){m(this,$),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var Y in U)this._addLayer(U[Y],Y);for(Y in _)this._addLayer(_[Y],Y,!0)},onAdd:function(U){this._initLayout(),this._update(),this._map=U,U.on("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(U){return ur.prototype.addTo.call(this,U),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var U=0;U<this._layers.length;U++)this._layers[U].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(U,_){return this._addLayer(U,_),this._map?this._update():this},addOverlay:function(U,_){return this._addLayer(U,_,!0),this._map?this._update():this},removeLayer:function(U){U.off("add remove",this._onLayerChange,this);var _=this._getLayer(l(U));return _&&this._layers.splice(this._layers.indexOf(_),1),this._map?this._update():this},expand:function(){ki(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var U=this._map.getSize().y-(this._container.offsetTop+50);return U<this._section.clientHeight?(ki(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=U+"px"):fn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return fn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var U="leaflet-control-layers",_=this._container=Kt("div",U),$=this.options.collapsed;_.setAttribute("aria-haspopup",!0),du(_),Fd(_);var Y=this._section=Kt("section",U+"-list");$&&(this._map.on("click",this.collapse,this),ni(_,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var te=this._layersLink=Kt("a",U+"-toggle",_);te.href="#",te.title="Layers",te.setAttribute("role","button"),ni(te,{keydown:function(pe){pe.keyCode===13&&this._expandSafely()},click:function(pe){Na(pe),this._expandSafely()}},this),$||this.expand(),this._baseLayersList=Kt("div",U+"-base",Y),this._separator=Kt("div",U+"-separator",Y),this._overlaysList=Kt("div",U+"-overlays",Y),_.appendChild(Y)},_getLayer:function(U){for(var _=0;_<this._layers.length;_++)if(this._layers[_]&&l(this._layers[_].layer)===U)return this._layers[_]},_addLayer:function(U,_,$){this._map&&U.on("add remove",this._onLayerChange,this),this._layers.push({layer:U,name:_,overlay:$}),this.options.sortLayers&&this._layers.sort(s(function(Y,te){return this.options.sortFunction(Y.layer,te.layer,Y.name,te.name)},this)),this.options.autoZIndex&&U.setZIndex&&(this._lastZIndex++,U.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ul(this._baseLayersList),ul(this._overlaysList),this._layerControlInputs=[];var U,_,$,Y,te=0;for($=0;$<this._layers.length;$++)Y=this._layers[$],this._addItem(Y),_=_||Y.overlay,U=U||!Y.overlay,te+=Y.overlay?0:1;return this.options.hideSingleBase&&(U=U&&te>1,this._baseLayersList.style.display=U?"":"none"),this._separator.style.display=_&&U?"":"none",this},_onLayerChange:function(U){this._handlingClick||this._update();var _=this._getLayer(l(U.target)),$=_.overlay?U.type==="add"?"overlayadd":"overlayremove":U.type==="add"?"baselayerchange":null;$&&this._map.fire($,_)},_createRadioElement:function(U,_){var $='<input type="radio" class="leaflet-control-layers-selector" name="'+U+'"'+(_?' checked="checked"':"")+"/>",Y=document.createElement("div");return Y.innerHTML=$,Y.firstChild},_addItem:function(U){var _=document.createElement("label"),$=this._map.hasLayer(U.layer),Y;U.overlay?(Y=document.createElement("input"),Y.type="checkbox",Y.className="leaflet-control-layers-selector",Y.defaultChecked=$):Y=this._createRadioElement("leaflet-base-layers_"+l(this),$),this._layerControlInputs.push(Y),Y.layerId=l(U.layer),ni(Y,"click",this._onInputClick,this);var te=document.createElement("span");te.innerHTML=" "+U.name;var pe=document.createElement("span");_.appendChild(pe),pe.appendChild(Y),pe.appendChild(te);var we=U.overlay?this._overlaysList:this._baseLayersList;return we.appendChild(_),this._checkDisabledLayers(),_},_onInputClick:function(){if(!this._preventClick){var U=this._layerControlInputs,_,$,Y=[],te=[];this._handlingClick=!0;for(var pe=U.length-1;pe>=0;pe--)_=U[pe],$=this._getLayer(_.layerId).layer,_.checked?Y.push($):_.checked||te.push($);for(pe=0;pe<te.length;pe++)this._map.hasLayer(te[pe])&&this._map.removeLayer(te[pe]);for(pe=0;pe<Y.length;pe++)this._map.hasLayer(Y[pe])||this._map.addLayer(Y[pe]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var U=this._layerControlInputs,_,$,Y=this._map.getZoom(),te=U.length-1;te>=0;te--)_=U[te],$=this._getLayer(_.layerId).layer,_.disabled=$.options.minZoom!==void 0&&Y<$.options.minZoom||$.options.maxZoom!==void 0&&Y>$.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var U=this._section;this._preventClick=!0,ni(U,"click",Na),this.expand();var _=this;setTimeout(function(){Ar(U,"click",Na),_._preventClick=!1})}}),Aa=function(U,_,$){return new Do(U,_,$)},Za=ur.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(U){var _="leaflet-control-zoom",$=Kt("div",_+" leaflet-bar"),Y=this.options;return this._zoomInButton=this._createButton(Y.zoomInText,Y.zoomInTitle,_+"-in",$,this._zoomIn),this._zoomOutButton=this._createButton(Y.zoomOutText,Y.zoomOutTitle,_+"-out",$,this._zoomOut),this._updateDisabled(),U.on("zoomend zoomlevelschange",this._updateDisabled,this),$},onRemove:function(U){U.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(U){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(U.shiftKey?3:1))},_zoomOut:function(U){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(U.shiftKey?3:1))},_createButton:function(U,_,$,Y,te){var pe=Kt("a",$,Y);return pe.innerHTML=U,pe.href="#",pe.title=_,pe.setAttribute("role","button"),pe.setAttribute("aria-label",_),du(pe),ni(pe,"click",pl),ni(pe,"click",te,this),ni(pe,"click",this._refocusOnMap,this),pe},_updateDisabled:function(){var U=this._map,_="leaflet-disabled";fn(this._zoomInButton,_),fn(this._zoomOutButton,_),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||U._zoom===U.getMinZoom())&&(ki(this._zoomOutButton,_),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||U._zoom===U.getMaxZoom())&&(ki(this._zoomInButton,_),this._zoomInButton.setAttribute("aria-disabled","true"))}});Zt.mergeOptions({zoomControl:!0}),Zt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Za,this.addControl(this.zoomControl))});var Us=function(U){return new Za(U)},Wl=ur.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(U){var _="leaflet-control-scale",$=Kt("div",_),Y=this.options;return this._addScales(Y,_+"-line",$),U.on(Y.updateWhenIdle?"moveend":"move",this._update,this),U.whenReady(this._update,this),$},onRemove:function(U){U.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(U,_,$){U.metric&&(this._mScale=Kt("div",_,$)),U.imperial&&(this._iScale=Kt("div",_,$))},_update:function(){var U=this._map,_=U.getSize().y/2,$=U.distance(U.containerPointToLatLng([0,_]),U.containerPointToLatLng([this.options.maxWidth,_]));this._updateScales($)},_updateScales:function(U){this.options.metric&&U&&this._updateMetric(U),this.options.imperial&&U&&this._updateImperial(U)},_updateMetric:function(U){var _=this._getRoundNum(U),$=_<1e3?_+" m":_/1e3+" km";this._updateScale(this._mScale,$,_/U)},_updateImperial:function(U){var _=U*3.2808399,$,Y,te;_>5280?($=_/5280,Y=this._getRoundNum($),this._updateScale(this._iScale,Y+" mi",Y/$)):(te=this._getRoundNum(_),this._updateScale(this._iScale,te+" ft",te/_))},_updateScale:function(U,_,$){U.style.width=Math.round(this.options.maxWidth*$)+"px",U.innerHTML=_},_getRoundNum:function(U){var _=Math.pow(10,(Math.floor(U)+"").length-1),$=U/_;return $=$>=10?10:$>=5?5:$>=3?3:$>=2?2:1,_*$}}),Yl=function(U){return new Wl(U)},pu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Om=ur.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Jt.inlineSvg?pu+" ":"")+"Leaflet</a>"},initialize:function(U){m(this,U),this._attributions={}},onAdd:function(U){U.attributionControl=this,this._container=Kt("div","leaflet-control-attribution"),du(this._container);for(var _ in U._layers)U._layers[_].getAttribution&&this.addAttribution(U._layers[_].getAttribution());return this._update(),U.on("layeradd",this._addAttribution,this),this._container},onRemove:function(U){U.off("layeradd",this._addAttribution,this)},_addAttribution:function(U){U.layer.getAttribution&&(this.addAttribution(U.layer.getAttribution()),U.layer.once("remove",function(){this.removeAttribution(U.layer.getAttribution())},this))},setPrefix:function(U){return this.options.prefix=U,this._update(),this},addAttribution:function(U){return U?(this._attributions[U]||(this._attributions[U]=0),this._attributions[U]++,this._update(),this):this},removeAttribution:function(U){return U?(this._attributions[U]&&(this._attributions[U]--,this._update()),this):this},_update:function(){if(this._map){var U=[];for(var _ in this._attributions)this._attributions[_]&&U.push(_);var $=[];this.options.prefix&&$.push(this.options.prefix),U.length&&$.push(U.join(", ")),this._container.innerHTML=$.join(' <span aria-hidden="true">|</span> ')}}});Zt.mergeOptions({attributionControl:!0}),Zt.addInitHook(function(){this.options.attributionControl&&new Om().addTo(this)});var nv=function(U){return new Om(U)};ur.Layers=Do,ur.Zoom=Za,ur.Scale=Wl,ur.Attribution=Om,Ka.layers=Aa,Ka.zoom=Us,Ka.scale=Yl,Ka.attribution=nv;var Ds=A.extend({initialize:function(U){this._map=U},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ds.addTo=function(U,_){return U.addHandler(_,this),this};var tE={Events:k},rS=Jt.touch?"touchstart mousedown":"mousedown",Bd=x.extend({options:{clickTolerance:3},initialize:function(U,_,$,Y){m(this,Y),this._element=U,this._dragStartTarget=_||U,this._preventOutline=$},enable:function(){this._enabled||(ni(this._dragStartTarget,rS,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Bd._dragging===this&&this.finishDrag(!0),Ar(this._dragStartTarget,rS,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(U){if(this._enabled&&(this._moved=!1,!Ts(this._element,"leaflet-zoom-anim"))){if(U.touches&&U.touches.length!==1){Bd._dragging===this&&this.finishDrag();return}if(!(Bd._dragging||U.shiftKey||U.which!==1&&U.button!==1&&!U.touches)&&(Bd._dragging=this,this._preventOutline&&cu(this._element),dl(),mn(),!this._moving)){this.fire("down");var _=U.touches?U.touches[0]:U,$=ga(this._element);this._startPoint=new O(_.clientX,_.clientY),this._startPos=Mi(this._element),this._parentScale=Gp($);var Y=U.type==="mousedown";ni(document,Y?"mousemove":"touchmove",this._onMove,this),ni(document,Y?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(U){if(this._enabled){if(U.touches&&U.touches.length>1){this._moved=!0;return}var _=U.touches&&U.touches.length===1?U.touches[0]:U,$=new O(_.clientX,_.clientY)._subtract(this._startPoint);!$.x&&!$.y||Math.abs($.x)+Math.abs($.y)<this.options.clickTolerance||($.x/=this._parentScale.x,$.y/=this._parentScale.y,Na(U),this._moved||(this.fire("dragstart"),this._moved=!0,ki(document.body,"leaflet-dragging"),this._lastTarget=U.target||U.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ki(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add($),this._moving=!0,this._lastEvent=U,this._updatePosition())}},_updatePosition:function(){var U={originalEvent:this._lastEvent};this.fire("predrag",U),Ri(this._element,this._newPos),this.fire("drag",U)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(U){fn(document.body,"leaflet-dragging"),this._lastTarget&&(fn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ar(document,"mousemove touchmove",this._onMove,this),Ar(document,"mouseup touchend touchcancel",this._onUp,this),_m(),Ma();var _=this._moved&&this._moving;this._moving=!1,Bd._dragging=!1,_&&this.fire("dragend",{noInertia:U,distance:this._newPos.distanceTo(this._startPos)})}});function nS(U,_,$){var Y,te=[1,4,2,8],pe,we,Ge,Ye,gt,ti,Zi,$r;for(pe=0,ti=U.length;pe<ti;pe++)U[pe]._code=$d(U[pe],_);for(Ge=0;Ge<4;Ge++){for(Zi=te[Ge],Y=[],pe=0,ti=U.length,we=ti-1;pe<ti;we=pe++)Ye=U[pe],gt=U[we],Ye._code&Zi?gt._code&Zi||($r=sv(gt,Ye,Zi,_,$),$r._code=$d($r,_),Y.push($r)):(gt._code&Zi&&($r=sv(gt,Ye,Zi,_,$),$r._code=$d($r,_),Y.push($r)),Y.push(Ye));U=Y}return U}function Eo(U,_){var $,Y,te,pe,we,Ge,Ye,gt,ti;if(!U||U.length===0)throw new Error("latlngs not passed");hu(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var Zi=Z([0,0]),$r=z(U),Dc=$r.getNorthWest().distanceTo($r.getSouthWest())*$r.getNorthEast().distanceTo($r.getNorthWest());Dc<1700&&(Zi=xm(U));var zo=U.length,jd=[];for($=0;$<zo;$++){var gu=Z(U[$]);jd.push(_.project(Z([gu.lat-Zi.lat,gu.lng-Zi.lng])))}for(Ge=Ye=gt=0,$=0,Y=zo-1;$<zo;Y=$++)te=jd[$],pe=jd[Y],we=te.y*pe.x-pe.y*te.x,Ye+=(te.x+pe.x)*we,gt+=(te.y+pe.y)*we,Ge+=we*3;Ge===0?ti=jd[0]:ti=[Ye/Ge,gt/Ge];var oS=_.unproject(F(ti));return Z([oS.lat+Zi.lat,oS.lng+Zi.lng])}function xm(U){for(var _=0,$=0,Y=0,te=0;te<U.length;te++){var pe=Z(U[te]);_+=pe.lat,$+=pe.lng,Y++}return Z([_/Y,$/Y])}var sb={__proto__:null,clipPolygon:nS,polygonCenter:Eo,centroid:xm};function iE(U,_){if(!_||!U.length)return U.slice();var $=_*_;return U=rE(U,$),U=uM(U,$),U}function ob(U,_,$){return Math.sqrt(ov(U,_,$,!0))}function cM(U,_,$){return ov(U,_,$)}function uM(U,_){var $=U.length,Y=typeof Uint8Array<"u"?Uint8Array:Array,te=new Y($);te[0]=te[$-1]=1,av(U,te,_,0,$-1);var pe,we=[];for(pe=0;pe<$;pe++)te[pe]&&we.push(U[pe]);return we}function av(U,_,$,Y,te){var pe=0,we,Ge,Ye;for(Ge=Y+1;Ge<=te-1;Ge++)Ye=ov(U[Ge],U[Y],U[te],!0),Ye>pe&&(we=Ge,pe=Ye);pe>$&&(_[we]=1,av(U,_,$,Y,we),av(U,_,$,we,te))}function rE(U,_){for(var $=[U[0]],Y=1,te=0,pe=U.length;Y<pe;Y++)nE(U[Y],U[te])>_&&($.push(U[Y]),te=Y);return te<pe-1&&$.push(U[pe-1]),$}var hf;function aS(U,_,$,Y,te){var pe=Y?hf:$d(U,$),we=$d(_,$),Ge,Ye,gt;for(hf=we;;){if(!(pe|we))return[U,_];if(pe&we)return!1;Ge=pe||we,Ye=sv(U,_,Ge,$,te),gt=$d(Ye,$),Ge===pe?(U=Ye,pe=gt):(_=Ye,we=gt)}}function sv(U,_,$,Y,te){var pe=_.x-U.x,we=_.y-U.y,Ge=Y.min,Ye=Y.max,gt,ti;return $&8?(gt=U.x+pe*(Ye.y-U.y)/we,ti=Ye.y):$&4?(gt=U.x+pe*(Ge.y-U.y)/we,ti=Ge.y):$&2?(gt=Ye.x,ti=U.y+we*(Ye.x-U.x)/pe):$&1&&(gt=Ge.x,ti=U.y+we*(Ge.x-U.x)/pe),new O(gt,ti,te)}function $d(U,_){var $=0;return U.x<_.min.x?$|=1:U.x>_.max.x&&($|=2),U.y<_.min.y?$|=4:U.y>_.max.y&&($|=8),$}function nE(U,_){var $=_.x-U.x,Y=_.y-U.y;return $*$+Y*Y}function ov(U,_,$,Y){var te=_.x,pe=_.y,we=$.x-te,Ge=$.y-pe,Ye=we*we+Ge*Ge,gt;return Ye>0&&(gt=((U.x-te)*we+(U.y-pe)*Ge)/Ye,gt>1?(te=$.x,pe=$.y):gt>0&&(te+=we*gt,pe+=Ge*gt)),we=U.x-te,Ge=U.y-pe,Y?we*we+Ge*Ge:new O(te,pe)}function hu(U){return!b(U[0])||typeof U[0][0]!="object"&&typeof U[0][0]<"u"}function sS(U){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),hu(U)}function lb(U,_){var $,Y,te,pe,we,Ge,Ye,gt;if(!U||U.length===0)throw new Error("latlngs not passed");hu(U)||(console.warn("latlngs are not flat! Only the first ring will be used"),U=U[0]);var ti=Z([0,0]),Zi=z(U),$r=Zi.getNorthWest().distanceTo(Zi.getSouthWest())*Zi.getNorthEast().distanceTo(Zi.getNorthWest());$r<1700&&(ti=xm(U));var Dc=U.length,zo=[];for($=0;$<Dc;$++){var jd=Z(U[$]);zo.push(_.project(Z([jd.lat-ti.lat,jd.lng-ti.lng])))}for($=0,Y=0;$<Dc-1;$++)Y+=zo[$].distanceTo(zo[$+1])/2;if(Y===0)gt=zo[0];else for($=0,pe=0;$<Dc-1;$++)if(we=zo[$],Ge=zo[$+1],te=we.distanceTo(Ge),pe+=te,pe>Y){Ye=(pe-Y)/te,gt=[Ge.x-Ye*(Ge.x-we.x),Ge.y-Ye*(Ge.y-we.y)];break}var gu=_.unproject(F(gt));return Z([gu.lat+ti.lat,gu.lng+ti.lng])}var E2={__proto__:null,simplify:iE,pointToSegmentDistance:ob,closestPointOnSegment:cM,clipSegment:aS,_getEdgeIntersection:sv,_getBitCode:$d,_sqClosestPointOnSegment:ov,isFlat:hu,_flat:sS,polylineCenter:lb},cb={project:function(U){return new O(U.lng,U.lat)},unproject:function(U){return new H(U.y,U.x)},bounds:new j([-180,-90],[180,90])},ub={R:6378137,R_MINOR:6356752314245179e-9,bounds:new j([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(U){var _=Math.PI/180,$=this.R,Y=U.lat*_,te=this.R_MINOR/$,pe=Math.sqrt(1-te*te),we=pe*Math.sin(Y),Ge=Math.tan(Math.PI/4-Y/2)/Math.pow((1-we)/(1+we),pe/2);return Y=-$*Math.log(Math.max(Ge,1e-10)),new O(U.lng*_*$,Y)},unproject:function(U){for(var _=180/Math.PI,$=this.R,Y=this.R_MINOR/$,te=Math.sqrt(1-Y*Y),pe=Math.exp(-U.y/$),we=Math.PI/2-2*Math.atan(pe),Ge=0,Ye=.1,gt;Ge<15&&Math.abs(Ye)>1e-7;Ge++)gt=te*Math.sin(we),gt=Math.pow((1-gt)/(1+gt),te/2),Ye=Math.PI/2-2*Math.atan(pe*gt)-we,we+=Ye;return new H(we*_,U.x*_/$)}},P2={__proto__:null,LonLat:cb,Mercator:ub,SphericalMercator:ne},dM=n({},ie,{code:"EPSG:3395",projection:ub,transformation:(function(){var U=.5/(Math.PI*ub.R);return re(U,.5,-U,.5)})()}),pM=n({},ie,{code:"EPSG:4326",projection:cb,transformation:re(1/180,1,-1/180,.5)}),hM=n({},J,{projection:cb,transformation:re(1,0,-1,0),scale:function(U){return Math.pow(2,U)},zoom:function(U){return Math.log(U)/Math.LN2},distance:function(U,_){var $=_.lng-U.lng,Y=_.lat-U.lat;return Math.sqrt($*$+Y*Y)},infinite:!0});J.Earth=ie,J.EPSG3395=dM,J.EPSG3857=me,J.EPSG900913=he,J.EPSG4326=pM,J.Simple=hM;var fu=x.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(U){return U.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(U){return U&&U.removeLayer(this),this},getPane:function(U){return this._map.getPane(U?this.options[U]||U:this.options.pane)},addInteractiveTarget:function(U){return this._map._targets[l(U)]=this,this},removeInteractiveTarget:function(U){return delete this._map._targets[l(U)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(U){var _=U.target;if(_.hasLayer(this)){if(this._map=_,this._zoomAnimated=_._zoomAnimated,this.getEvents){var $=this.getEvents();_.on($,this),this.once("remove",function(){_.off($,this)},this)}this.onAdd(_),this.fire("add"),_.fire("layeradd",{layer:this})}}});Zt.include({addLayer:function(U){if(!U._layerAdd)throw new Error("The provided object is not a Layer.");var _=l(U);return this._layers[_]?this:(this._layers[_]=U,U._mapToAdd=this,U.beforeAdd&&U.beforeAdd(this),this.whenReady(U._layerAdd,U),this)},removeLayer:function(U){var _=l(U);return this._layers[_]?(this._loaded&&U.onRemove(this),delete this._layers[_],this._loaded&&(this.fire("layerremove",{layer:U}),U.fire("remove")),U._map=U._mapToAdd=null,this):this},hasLayer:function(U){return l(U)in this._layers},eachLayer:function(U,_){for(var $ in this._layers)U.call(_,this._layers[$]);return this},_addLayers:function(U){U=U?b(U)?U:[U]:[];for(var _=0,$=U.length;_<$;_++)this.addLayer(U[_])},_addZoomLimit:function(U){(!isNaN(U.options.maxZoom)||!isNaN(U.options.minZoom))&&(this._zoomBoundLayers[l(U)]=U,this._updateZoomLevels())},_removeZoomLimit:function(U){var _=l(U);this._zoomBoundLayers[_]&&(delete this._zoomBoundLayers[_],this._updateZoomLevels())},_updateZoomLevels:function(){var U=1/0,_=-1/0,$=this._getZoomSpan();for(var Y in this._zoomBoundLayers){var te=this._zoomBoundLayers[Y].options;U=te.minZoom===void 0?U:Math.min(U,te.minZoom),_=te.maxZoom===void 0?_:Math.max(_,te.maxZoom)}this._layersMaxZoom=_===-1/0?void 0:_,this._layersMinZoom=U===1/0?void 0:U,$!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var lv=fu.extend({initialize:function(U,_){m(this,_),this._layers={};var $,Y;if(U)for($=0,Y=U.length;$<Y;$++)this.addLayer(U[$])},addLayer:function(U){var _=this.getLayerId(U);return this._layers[_]=U,this._map&&this._map.addLayer(U),this},removeLayer:function(U){var _=U in this._layers?U:this.getLayerId(U);return this._map&&this._layers[_]&&this._map.removeLayer(this._layers[_]),delete this._layers[_],this},hasLayer:function(U){var _=typeof U=="number"?U:this.getLayerId(U);return _ in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(U){var _=Array.prototype.slice.call(arguments,1),$,Y;for($ in this._layers)Y=this._layers[$],Y[U]&&Y[U].apply(Y,_);return this},onAdd:function(U){this.eachLayer(U.addLayer,U)},onRemove:function(U){this.eachLayer(U.removeLayer,U)},eachLayer:function(U,_){for(var $ in this._layers)U.call(_,this._layers[$]);return this},getLayer:function(U){return this._layers[U]},getLayers:function(){var U=[];return this.eachLayer(U.push,U),U},setZIndex:function(U){return this.invoke("setZIndex",U)},getLayerId:function(U){return l(U)}}),fM=function(U,_){return new lv(U,_)},sd=lv.extend({addLayer:function(U){return this.hasLayer(U)?this:(U.addEventParent(this),lv.prototype.addLayer.call(this,U),this.fire("layeradd",{layer:U}))},removeLayer:function(U){return this.hasLayer(U)?(U in this._layers&&(U=this._layers[U]),U.removeEventParent(this),lv.prototype.removeLayer.call(this,U),this.fire("layerremove",{layer:U})):this},setStyle:function(U){return this.invoke("setStyle",U)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var U=new W;for(var _ in this._layers){var $=this._layers[_];U.extend($.getBounds?$.getBounds():$.getLatLng())}return U}}),mM=function(U,_){return new sd(U,_)},Lm=A.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(U){m(this,U)},createIcon:function(U){return this._createIcon("icon",U)},createShadow:function(U){return this._createIcon("shadow",U)},_createIcon:function(U,_){var $=this._getIconUrl(U);if(!$){if(U==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var Y=this._createImg($,_&&_.tagName==="IMG"?_:null);return this._setIconStyles(Y,U),(this.options.crossOrigin||this.options.crossOrigin==="")&&(Y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),Y},_setIconStyles:function(U,_){var $=this.options,Y=$[_+"Size"];typeof Y=="number"&&(Y=[Y,Y]);var te=F(Y),pe=F(_==="shadow"&&$.shadowAnchor||$.iconAnchor||te&&te.divideBy(2,!0));U.className="leaflet-marker-"+_+" "+($.className||""),pe&&(U.style.marginLeft=-pe.x+"px",U.style.marginTop=-pe.y+"px"),te&&(U.style.width=te.x+"px",U.style.height=te.y+"px")},_createImg:function(U,_){return _=_||document.createElement("img"),_.src=U,_},_getIconUrl:function(U){return Jt.retina&&this.options[U+"RetinaUrl"]||this.options[U+"Url"]}});function C2(U){return new Lm(U)}var db=Lm.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(U){return typeof db.imagePath!="string"&&(db.imagePath=this._detectIconPath()),(this.options.imagePath||db.imagePath)+Lm.prototype._getIconUrl.call(this,U)},_stripUrl:function(U){var _=function($,Y,te){var pe=Y.exec($);return pe&&pe[te]};return U=_(U,/^url\((['"])?(.+)\1\)$/,2),U&&_(U,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var U=Kt("div","leaflet-default-icon-path",document.body),_=Tc(U,"background-image")||Tc(U,"backgroundImage");if(document.body.removeChild(U),_=this._stripUrl(_),_)return _;var $=document.querySelector('link[href$="leaflet.css"]');return $?$.href.substring(0,$.href.length-11-1):""}}),gM=Ds.extend({initialize:function(U){this._marker=U},addHooks:function(){var U=this._marker._icon;this._draggable||(this._draggable=new Bd(U,U,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ki(U,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&fn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(U){var _=this._marker,$=_._map,Y=this._marker.options.autoPanSpeed,te=this._marker.options.autoPanPadding,pe=Mi(_._icon),we=$.getPixelBounds(),Ge=$.getPixelOrigin(),Ye=q(we.min._subtract(Ge).add(te),we.max._subtract(Ge).subtract(te));if(!Ye.contains(pe)){var gt=F((Math.max(Ye.max.x,pe.x)-Ye.max.x)/(we.max.x-Ye.max.x)-(Math.min(Ye.min.x,pe.x)-Ye.min.x)/(we.min.x-Ye.min.x),(Math.max(Ye.max.y,pe.y)-Ye.max.y)/(we.max.y-Ye.max.y)-(Math.min(Ye.min.y,pe.y)-Ye.min.y)/(we.min.y-Ye.min.y)).multiplyBy(Y);$.panBy(gt,{animate:!1}),this._draggable._newPos._add(gt),this._draggable._startPos._add(gt),Ri(_._icon,this._draggable._newPos),this._onDrag(U),this._panRequest=P(this._adjustPan.bind(this,U))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(U){this._marker.options.autoPan&&(R(this._panRequest),this._panRequest=P(this._adjustPan.bind(this,U)))},_onDrag:function(U){var _=this._marker,$=_._shadow,Y=Mi(_._icon),te=_._map.layerPointToLatLng(Y);$&&Ri($,Y),_._latlng=te,U.latlng=te,U.oldLatLng=this._oldLatLng,_.fire("move",U).fire("drag",U)},_onDragEnd:function(U){R(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",U)}}),Fm=fu.extend({options:{icon:new db,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(U,_){m(this,_),this._latlng=Z(U)},onAdd:function(U){this._zoomAnimated=this._zoomAnimated&&U.options.markerZoomAnimation,this._zoomAnimated&&U.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(U){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&U.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(U){var _=this._latlng;return this._latlng=Z(U),this.update(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},setZIndexOffset:function(U){return this.options.zIndexOffset=U,this.update()},getIcon:function(){return this.options.icon},setIcon:function(U){return this.options.icon=U,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var U=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(U)}return this},_initIcon:function(){var U=this.options,_="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),$=U.icon.createIcon(this._icon),Y=!1;$!==this._icon&&(this._icon&&this._removeIcon(),Y=!0,U.title&&($.title=U.title),$.tagName==="IMG"&&($.alt=U.alt||"")),ki($,_),U.keyboard&&($.tabIndex="0",$.setAttribute("role","button")),this._icon=$,U.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ni($,"focus",this._panOnFocus,this);var te=U.icon.createShadow(this._shadow),pe=!1;te!==this._shadow&&(this._removeShadow(),pe=!0),te&&(ki(te,_),te.alt=""),this._shadow=te,U.opacity<1&&this._updateOpacity(),Y&&this.getPane().appendChild(this._icon),this._initInteraction(),te&&pe&&this.getPane(U.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ar(this._icon,"focus",this._panOnFocus,this),Mn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Mn(this._shadow),this._shadow=null},_setPos:function(U){this._icon&&Ri(this._icon,U),this._shadow&&Ri(this._shadow,U),this._zIndex=U.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(U){this._icon&&(this._icon.style.zIndex=this._zIndex+U)},_animateZoom:function(U){var _=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center).round();this._setPos(_)},_initInteraction:function(){if(this.options.interactive&&(ki(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),gM)){var U=this.options.draggable;this.dragging&&(U=this.dragging.enabled(),this.dragging.disable()),this.dragging=new gM(this),U&&this.dragging.enable()}},setOpacity:function(U){return this.options.opacity=U,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var U=this.options.opacity;this._icon&&Ya(this._icon,U),this._shadow&&Ya(this._shadow,U)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var U=this._map;if(U){var _=this.options.icon.options,$=_.iconSize?F(_.iconSize):F(0,0),Y=_.iconAnchor?F(_.iconAnchor):F(0,0);U.panInside(this._latlng,{paddingTopLeft:Y,paddingBottomRight:$.subtract(Y)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Hp(U,_){return new Fm(U,_)}var Ln=fu.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(U){this._renderer=U.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(U){return m(this,U),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&U&&Object.prototype.hasOwnProperty.call(U,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Bm=Ln.extend({options:{fill:!0,radius:10},initialize:function(U,_){m(this,_),this._latlng=Z(U),this._radius=this.options.radius},setLatLng:function(U){var _=this._latlng;return this._latlng=Z(U),this.redraw(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(U){return this.options.radius=this._radius=U,this.redraw()},getRadius:function(){return this._radius},setStyle:function(U){var _=U&&U.radius||this._radius;return Ln.prototype.setStyle.call(this,U),this.setRadius(_),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var U=this._radius,_=this._radiusY||U,$=this._clickTolerance(),Y=[U+$,_+$];this._pxBounds=new j(this._point.subtract(Y),this._point.add(Y))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(U){return U.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function mu(U,_){return new Bm(U,_)}var aE=Bm.extend({initialize:function(U,_,$){if(typeof _=="number"&&(_=n({},$,{radius:_})),m(this,_),this._latlng=Z(U),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(U){return this._mRadius=U,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var U=[this._radius,this._radiusY||this._radius];return new W(this._map.layerPointToLatLng(this._point.subtract(U)),this._map.layerPointToLatLng(this._point.add(U)))},setStyle:Ln.prototype.setStyle,_project:function(){var U=this._latlng.lng,_=this._latlng.lat,$=this._map,Y=$.options.crs;if(Y.distance===ie.distance){var te=Math.PI/180,pe=this._mRadius/ie.R/te,we=$.project([_+pe,U]),Ge=$.project([_-pe,U]),Ye=we.add(Ge).divideBy(2),gt=$.unproject(Ye).lat,ti=Math.acos((Math.cos(pe*te)-Math.sin(_*te)*Math.sin(gt*te))/(Math.cos(_*te)*Math.cos(gt*te)))/te;(isNaN(ti)||ti===0)&&(ti=pe/Math.cos(Math.PI/180*_)),this._point=Ye.subtract($.getPixelOrigin()),this._radius=isNaN(ti)?0:Ye.x-$.project([gt,U-ti]).x,this._radiusY=Ye.y-we.y}else{var Zi=Y.unproject(Y.project(this._latlng).subtract([this._mRadius,0]));this._point=$.latLngToLayerPoint(this._latlng),this._radius=this._point.x-$.latLngToLayerPoint(Zi).x}this._updateBounds()}});function sE(U,_,$){return new aE(U,_,$)}var Vd=Ln.extend({options:{smoothFactor:1,noClip:!1},initialize:function(U,_){m(this,_),this._setLatLngs(U)},getLatLngs:function(){return this._latlngs},setLatLngs:function(U){return this._setLatLngs(U),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(U){for(var _=1/0,$=null,Y=ov,te,pe,we=0,Ge=this._parts.length;we<Ge;we++)for(var Ye=this._parts[we],gt=1,ti=Ye.length;gt<ti;gt++){te=Ye[gt-1],pe=Ye[gt];var Zi=Y(U,te,pe,!0);Zi<_&&(_=Zi,$=Y(U,te,pe))}return $&&($.distance=Math.sqrt(_)),$},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return lb(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(U,_){return _=_||this._defaultShape(),U=Z(U),_.push(U),this._bounds.extend(U),this.redraw()},_setLatLngs:function(U){this._bounds=new W,this._latlngs=this._convertLatLngs(U)},_defaultShape:function(){return hu(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(U){for(var _=[],$=hu(U),Y=0,te=U.length;Y<te;Y++)$?(_[Y]=Z(U[Y]),this._bounds.extend(_[Y])):_[Y]=this._convertLatLngs(U[Y]);return _},_project:function(){var U=new j;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,U),this._bounds.isValid()&&U.isValid()&&(this._rawPxBounds=U,this._updateBounds())},_updateBounds:function(){var U=this._clickTolerance(),_=new O(U,U);this._rawPxBounds&&(this._pxBounds=new j([this._rawPxBounds.min.subtract(_),this._rawPxBounds.max.add(_)]))},_projectLatlngs:function(U,_,$){var Y=U[0]instanceof H,te=U.length,pe,we;if(Y){for(we=[],pe=0;pe<te;pe++)we[pe]=this._map.latLngToLayerPoint(U[pe]),$.extend(we[pe]);_.push(we)}else for(pe=0;pe<te;pe++)this._projectLatlngs(U[pe],_,$)},_clipPoints:function(){var U=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}var _=this._parts,$,Y,te,pe,we,Ge,Ye;for($=0,te=0,pe=this._rings.length;$<pe;$++)for(Ye=this._rings[$],Y=0,we=Ye.length;Y<we-1;Y++)Ge=aS(Ye[Y],Ye[Y+1],U,Y,!0),Ge&&(_[te]=_[te]||[],_[te].push(Ge[0]),(Ge[1]!==Ye[Y+1]||Y===we-2)&&(_[te].push(Ge[1]),te++))}},_simplifyPoints:function(){for(var U=this._parts,_=this.options.smoothFactor,$=0,Y=U.length;$<Y;$++)U[$]=iE(U[$],_)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(U,_){var $,Y,te,pe,we,Ge,Ye=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for($=0,pe=this._parts.length;$<pe;$++)for(Ge=this._parts[$],Y=0,we=Ge.length,te=we-1;Y<we;te=Y++)if(!(!_&&Y===0)&&ob(U,Ge[te],Ge[Y])<=Ye)return!0;return!1}});function $m(U,_){return new Vd(U,_)}Vd._flat=sS;var ff=Vd.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Eo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(U){var _=Vd.prototype._convertLatLngs.call(this,U),$=_.length;return $>=2&&_[0]instanceof H&&_[0].equals(_[$-1])&&_.pop(),_},_setLatLngs:function(U){Vd.prototype._setLatLngs.call(this,U),hu(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return hu(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var U=this._renderer._bounds,_=this.options.weight,$=new O(_,_);if(U=new j(U.min.subtract($),U.max.add($)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(U))){if(this.options.noClip){this._parts=this._rings;return}for(var Y=0,te=this._rings.length,pe;Y<te;Y++)pe=nS(this._rings[Y],U,!0),pe.length&&this._parts.push(pe)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(U){var _=!1,$,Y,te,pe,we,Ge,Ye,gt;if(!this._pxBounds||!this._pxBounds.contains(U))return!1;for(pe=0,Ye=this._parts.length;pe<Ye;pe++)for($=this._parts[pe],we=0,gt=$.length,Ge=gt-1;we<gt;Ge=we++)Y=$[we],te=$[Ge],Y.y>U.y!=te.y>U.y&&U.x<(te.x-Y.x)*(U.y-Y.y)/(te.y-Y.y)+Y.x&&(_=!_);return _||Vd.prototype._containsPoint.call(this,U,!0)}});function cv(U,_){return new ff(U,_)}var jo=sd.extend({initialize:function(U,_){m(this,_),this._layers={},U&&this.addData(U)},addData:function(U){var _=b(U)?U:U.features,$,Y,te;if(_){for($=0,Y=_.length;$<Y;$++)te=_[$],(te.geometries||te.geometry||te.features||te.coordinates)&&this.addData(te);return this}var pe=this.options;if(pe.filter&&!pe.filter(U))return this;var we=pb(U,pe);return we?(we.feature=ge(U),we.defaultOptions=we.options,this.resetStyle(we),pe.onEachFeature&&pe.onEachFeature(U,we),this.addLayer(we)):this},resetStyle:function(U){return U===void 0?this.eachLayer(this.resetStyle,this):(U.options=n({},U.defaultOptions),this._setLayerStyle(U,this.options.style),this)},setStyle:function(U){return this.eachLayer(function(_){this._setLayerStyle(_,U)},this)},_setLayerStyle:function(U,_){U.setStyle&&(typeof _=="function"&&(_=_(U.feature)),U.setStyle(_))}});function pb(U,_){var $=U.type==="Feature"?U.geometry:U,Y=$?$.coordinates:null,te=[],pe=_&&_.pointToLayer,we=_&&_.coordsToLatLng||G,Ge,Ye,gt,ti;if(!Y&&!$)return null;switch($.type){case"Point":return Ge=we(Y),B(pe,U,Ge,_);case"MultiPoint":for(gt=0,ti=Y.length;gt<ti;gt++)Ge=we(Y[gt]),te.push(B(pe,U,Ge,_));return new sd(te);case"LineString":case"MultiLineString":return Ye=X(Y,$.type==="LineString"?0:1,we),new Vd(Ye,_);case"Polygon":case"MultiPolygon":return Ye=X(Y,$.type==="Polygon"?1:2,we),new ff(Ye,_);case"GeometryCollection":for(gt=0,ti=$.geometries.length;gt<ti;gt++){var Zi=pb({geometry:$.geometries[gt],type:"Feature",properties:U.properties},_);Zi&&te.push(Zi)}return new sd(te);case"FeatureCollection":for(gt=0,ti=$.features.length;gt<ti;gt++){var $r=pb($.features[gt],_);$r&&te.push($r)}return new sd(te);default:throw new Error("Invalid GeoJSON object.")}}function B(U,_,$,Y){return U?U(_,$):new Fm($,Y&&Y.markersInheritOptions&&Y)}function G(U){return new H(U[1],U[0],U[2])}function X(U,_,$){for(var Y=[],te=0,pe=U.length,we;te<pe;te++)we=_?X(U[te],_-1,$):($||G)(U[te]),Y.push(we);return Y}function ee(U,_){return U=Z(U),U.alt!==void 0?[p(U.lng,_),p(U.lat,_),p(U.alt,_)]:[p(U.lng,_),p(U.lat,_)]}function ae(U,_,$,Y){for(var te=[],pe=0,we=U.length;pe<we;pe++)te.push(_?ae(U[pe],hu(U[pe])?0:_-1,$,Y):ee(U[pe],Y));return!_&&$&&te.length>0&&te.push(te[0].slice()),te}function de(U,_){return U.feature?n({},U.feature,{geometry:_}):ge(_)}function ge(U){return U.type==="Feature"||U.type==="FeatureCollection"?U:{type:"Feature",properties:{},geometry:U}}var ye={toGeoJSON:function(U){return de(this,{type:"Point",coordinates:ee(this.getLatLng(),U)})}};Fm.include(ye),aE.include(ye),Bm.include(ye),Vd.include({toGeoJSON:function(U){var _=!hu(this._latlngs),$=ae(this._latlngs,_?1:0,!1,U);return de(this,{type:(_?"Multi":"")+"LineString",coordinates:$})}}),ff.include({toGeoJSON:function(U){var _=!hu(this._latlngs),$=_&&!hu(this._latlngs[0]),Y=ae(this._latlngs,$?2:_?1:0,!0,U);return _||(Y=[Y]),de(this,{type:($?"Multi":"")+"Polygon",coordinates:Y})}}),lv.include({toMultiPoint:function(U){var _=[];return this.eachLayer(function($){_.push($.toGeoJSON(U).geometry.coordinates)}),de(this,{type:"MultiPoint",coordinates:_})},toGeoJSON:function(U){var _=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(_==="MultiPoint")return this.toMultiPoint(U);var $=_==="GeometryCollection",Y=[];return this.eachLayer(function(te){if(te.toGeoJSON){var pe=te.toGeoJSON(U);if($)Y.push(pe.geometry);else{var we=ge(pe);we.type==="FeatureCollection"?Y.push.apply(Y,we.features):Y.push(we)}}}),$?de(this,{geometries:Y,type:"GeometryCollection"}):{type:"FeatureCollection",features:Y}}});function Ee(U,_){return new jo(U,_)}var Pe=Ee,Ae=fu.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(U,_,$){this._url=U,this._bounds=z(_),m(this,$)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ki(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Mn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(U){return this.options.opacity=U,this._image&&this._updateOpacity(),this},setStyle:function(U){return U.opacity&&this.setOpacity(U.opacity),this},bringToFront:function(){return this._map&&ns(this._image),this},bringToBack:function(){return this._map&&to(this._image),this},setUrl:function(U){return this._url=U,this._image&&(this._image.src=U),this},setBounds:function(U){return this._bounds=z(U),this._map&&this._reset(),this},getEvents:function(){var U={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var U=this._url.tagName==="IMG",_=this._image=U?this._url:Kt("img");if(ki(_,"leaflet-image-layer"),this._zoomAnimated&&ki(_,"leaflet-zoom-animated"),this.options.className&&ki(_,this.options.className),_.onselectstart=d,_.onmousemove=d,_.onload=s(this.fire,this,"load"),_.onerror=s(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),U){this._url=_.src;return}_.src=this._url,_.alt=this.options.alt},_animateZoom:function(U){var _=this._map.getZoomScale(U.zoom),$=this._map._latLngBoundsToNewLayerBounds(this._bounds,U.zoom,U.center).min;di(this._image,$,_)},_reset:function(){var U=this._image,_=new j(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),$=_.getSize();Ri(U,_.min),U.style.width=$.x+"px",U.style.height=$.y+"px"},_updateOpacity:function(){Ya(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var U=this.options.errorOverlayUrl;U&&this._url!==U&&(this._url=U,this._image.src=U)},getCenter:function(){return this._bounds.getCenter()}}),Te=function(U,_,$){return new Ae(U,_,$)},_e=Ae.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var U=this._url.tagName==="VIDEO",_=this._image=U?this._url:Kt("video");if(ki(_,"leaflet-image-layer"),this._zoomAnimated&&ki(_,"leaflet-zoom-animated"),this.options.className&&ki(_,this.options.className),_.onselectstart=d,_.onmousemove=d,_.onloadeddata=s(this.fire,this,"load"),U){for(var $=_.getElementsByTagName("source"),Y=[],te=0;te<$.length;te++)Y.push($[te].src);this._url=$.length>0?Y:[_.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(_.style,"objectFit")&&(_.style.objectFit="fill"),_.autoplay=!!this.options.autoplay,_.loop=!!this.options.loop,_.muted=!!this.options.muted,_.playsInline=!!this.options.playsInline;for(var pe=0;pe<this._url.length;pe++){var we=Kt("source");we.src=this._url[pe],_.appendChild(we)}}});function Ce(U,_,$){return new _e(U,_,$)}var Re=Ae.extend({_initImage:function(){var U=this._image=this._url;ki(U,"leaflet-image-layer"),this._zoomAnimated&&ki(U,"leaflet-zoom-animated"),this.options.className&&ki(U,this.options.className),U.onselectstart=d,U.onmousemove=d}});function Me(U,_,$){return new Re(U,_,$)}var Ne=fu.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(U,_){U&&(U instanceof H||b(U))?(this._latlng=Z(U),m(this,_)):(m(this,U),this._source=_),this.options.content&&(this._content=this.options.content)},openOn:function(U){return U=arguments.length?U:this._source._map,U.hasLayer(this)||U.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(U){return this._map?this.close():(arguments.length?this._source=U:U=this._source,this._prepareOpen(),this.openOn(U._map)),this},onAdd:function(U){this._zoomAnimated=U._zoomAnimated,this._container||this._initLayout(),U._fadeAnimated&&Ya(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),U._fadeAnimated&&Ya(this._container,1),this.bringToFront(),this.options.interactive&&(ki(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(U){U._fadeAnimated?(Ya(this._container,0),this._removeTimeout=setTimeout(s(Mn,void 0,this._container),200)):Mn(this._container),this.options.interactive&&(fn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(U){return this._latlng=Z(U),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(U){return this._content=U,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var U={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ns(this._container),this},bringToBack:function(){return this._map&&to(this._container),this},_prepareOpen:function(U){var _=this._source;if(!_._map)return!1;if(_ instanceof sd){_=null;var $=this._source._layers;for(var Y in $)if($[Y]._map){_=$[Y];break}if(!_)return!1;this._source=_}if(!U)if(_.getCenter)U=_.getCenter();else if(_.getLatLng)U=_.getLatLng();else if(_.getBounds)U=_.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(U),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var U=this._contentNode,_=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof _=="string")U.innerHTML=_;else{for(;U.hasChildNodes();)U.removeChild(U.firstChild);U.appendChild(_)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var U=this._map.latLngToLayerPoint(this._latlng),_=F(this.options.offset),$=this._getAnchor();this._zoomAnimated?Ri(this._container,U.add($)):_=_.add(U).add($);var Y=this._containerBottom=-_.y,te=this._containerLeft=-Math.round(this._containerWidth/2)+_.x;this._container.style.bottom=Y+"px",this._container.style.left=te+"px"}},_getAnchor:function(){return[0,0]}});Zt.include({_initOverlay:function(U,_,$,Y){var te=_;return te instanceof U||(te=new U(Y).setContent(_)),$&&te.setLatLng($),te}}),fu.include({_initOverlay:function(U,_,$,Y){var te=$;return te instanceof U?(m(te,Y),te._source=this):(te=_&&!Y?_:new U(Y,this),te.setContent($)),te}});var Ve=Ne.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(U){return U=arguments.length?U:this._source._map,!U.hasLayer(this)&&U._popup&&U._popup.options.autoClose&&U.removeLayer(U._popup),U._popup=this,Ne.prototype.openOn.call(this,U)},onAdd:function(U){Ne.prototype.onAdd.call(this,U),U.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ln||this._source.on("preclick",Vn))},onRemove:function(U){Ne.prototype.onRemove.call(this,U),U.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ln||this._source.off("preclick",Vn))},getEvents:function(){var U=Ne.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(U.preclick=this.close),this.options.keepInView&&(U.moveend=this._adjustPan),U},_initLayout:function(){var U="leaflet-popup",_=this._container=Kt("div",U+" "+(this.options.className||"")+" leaflet-zoom-animated"),$=this._wrapper=Kt("div",U+"-content-wrapper",_);if(this._contentNode=Kt("div",U+"-content",$),du(_),Fd(this._contentNode),ni(_,"contextmenu",Vn),this._tipContainer=Kt("div",U+"-tip-container",_),this._tip=Kt("div",U+"-tip",this._tipContainer),this.options.closeButton){var Y=this._closeButton=Kt("a",U+"-close-button",_);Y.setAttribute("role","button"),Y.setAttribute("aria-label","Close popup"),Y.href="#close",Y.innerHTML='<span aria-hidden="true">&#215;</span>',ni(Y,"click",function(te){Na(te),this.close()},this)}},_updateLayout:function(){var U=this._contentNode,_=U.style;_.width="",_.whiteSpace="nowrap";var $=U.offsetWidth;$=Math.min($,this.options.maxWidth),$=Math.max($,this.options.minWidth),_.width=$+1+"px",_.whiteSpace="",_.height="";var Y=U.offsetHeight,te=this.options.maxHeight,pe="leaflet-popup-scrolled";te&&Y>te?(_.height=te+"px",ki(U,pe)):fn(U,pe),this._containerWidth=this._container.offsetWidth},_animateZoom:function(U){var _=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center),$=this._getAnchor();Ri(this._container,_.add($))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var U=this._map,_=parseInt(Tc(this._container,"marginBottom"),10)||0,$=this._container.offsetHeight+_,Y=this._containerWidth,te=new O(this._containerLeft,-$-this._containerBottom);te._add(Mi(this._container));var pe=U.layerPointToContainerPoint(te),we=F(this.options.autoPanPadding),Ge=F(this.options.autoPanPaddingTopLeft||we),Ye=F(this.options.autoPanPaddingBottomRight||we),gt=U.getSize(),ti=0,Zi=0;pe.x+Y+Ye.x>gt.x&&(ti=pe.x+Y-gt.x+Ye.x),pe.x-ti-Ge.x<0&&(ti=pe.x-Ge.x),pe.y+$+Ye.y>gt.y&&(Zi=pe.y+$-gt.y+Ye.y),pe.y-Zi-Ge.y<0&&(Zi=pe.y-Ge.y),(ti||Zi)&&(this.options.keepInView&&(this._autopanning=!0),U.fire("autopanstart").panBy([ti,Zi]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),He=function(U,_){return new Ve(U,_)};Zt.mergeOptions({closePopupOnClick:!0}),Zt.include({openPopup:function(U,_,$){return this._initOverlay(Ve,U,_,$).openOn(this),this},closePopup:function(U){return U=arguments.length?U:this._popup,U&&U.close(),this}}),fu.include({bindPopup:function(U,_){return this._popup=this._initOverlay(Ve,this._popup,U,_),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(U){return this._popup&&(this instanceof sd||(this._popup._source=this),this._popup._prepareOpen(U||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(U){return this._popup&&this._popup.setContent(U),this},getPopup:function(){return this._popup},_openPopup:function(U){if(!(!this._popup||!this._map)){pl(U);var _=U.layer||U.target;if(this._popup._source===_&&!(_ instanceof Ln)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(U.latlng);return}this._popup._source=_,this.openPopup(U.latlng)}},_movePopup:function(U){this._popup.setLatLng(U.latlng)},_onKeyPress:function(U){U.originalEvent.keyCode===13&&this._openPopup(U)}});var rt=Ne.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(U){Ne.prototype.onAdd.call(this,U),this.setOpacity(this.options.opacity),U.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(U){Ne.prototype.onRemove.call(this,U),U.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var U=Ne.prototype.getEvents.call(this);return this.options.permanent||(U.preclick=this.close),U},_initLayout:function(){var U="leaflet-tooltip",_=U+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Kt("div",_),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(U){var _,$,Y=this._map,te=this._container,pe=Y.latLngToContainerPoint(Y.getCenter()),we=Y.layerPointToContainerPoint(U),Ge=this.options.direction,Ye=te.offsetWidth,gt=te.offsetHeight,ti=F(this.options.offset),Zi=this._getAnchor();Ge==="top"?(_=Ye/2,$=gt):Ge==="bottom"?(_=Ye/2,$=0):Ge==="center"?(_=Ye/2,$=gt/2):Ge==="right"?(_=0,$=gt/2):Ge==="left"?(_=Ye,$=gt/2):we.x<pe.x?(Ge="right",_=0,$=gt/2):(Ge="left",_=Ye+(ti.x+Zi.x)*2,$=gt/2),U=U.subtract(F(_,$,!0)).add(ti).add(Zi),fn(te,"leaflet-tooltip-right"),fn(te,"leaflet-tooltip-left"),fn(te,"leaflet-tooltip-top"),fn(te,"leaflet-tooltip-bottom"),ki(te,"leaflet-tooltip-"+Ge),Ri(te,U)},_updatePosition:function(){var U=this._map.latLngToLayerPoint(this._latlng);this._setPosition(U)},setOpacity:function(U){this.options.opacity=U,this._container&&Ya(this._container,U)},_animateZoom:function(U){var _=this._map._latLngToNewLayerPoint(this._latlng,U.zoom,U.center);this._setPosition(_)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ct=function(U,_){return new rt(U,_)};Zt.include({openTooltip:function(U,_,$){return this._initOverlay(rt,U,_,$).openOn(this),this},closeTooltip:function(U){return U.close(),this}}),fu.include({bindTooltip:function(U,_){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(rt,this._tooltip,U,_),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(U){if(!(!U&&this._tooltipHandlersAdded)){var _=U?"off":"on",$={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?$.add=this._openTooltip:($.mouseover=this._openTooltip,$.mouseout=this.closeTooltip,$.click=this._openTooltip,this._map?this._addFocusListeners():$.add=this._addFocusListeners),this._tooltip.options.sticky&&($.mousemove=this._moveTooltip),this[_]($),this._tooltipHandlersAdded=!U}},openTooltip:function(U){return this._tooltip&&(this instanceof sd||(this._tooltip._source=this),this._tooltip._prepareOpen(U)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(U){return this._tooltip&&this._tooltip.setContent(U),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(U){var _=typeof U.getElement=="function"&&U.getElement();_&&(ni(_,"focus",function(){this._tooltip._source=U,this.openTooltip()},this),ni(_,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(U){var _=typeof U.getElement=="function"&&U.getElement();_&&_.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(U){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var _=this;this._map.once("moveend",function(){_._openOnceFlag=!1,_._openTooltip(U)});return}this._tooltip._source=U.layer||U.target,this.openTooltip(this._tooltip.options.sticky?U.latlng:void 0)}},_moveTooltip:function(U){var _=U.latlng,$,Y;this._tooltip.options.sticky&&U.originalEvent&&($=this._map.mouseEventToContainerPoint(U.originalEvent),Y=this._map.containerPointToLayerPoint($),_=this._map.layerPointToLatLng(Y)),this._tooltip.setLatLng(_)}});var Rt=Lm.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(U){var _=U&&U.tagName==="DIV"?U:document.createElement("div"),$=this.options;if($.html instanceof Element?(ul(_),_.appendChild($.html)):_.innerHTML=$.html!==!1?$.html:"",$.bgPos){var Y=F($.bgPos);_.style.backgroundPosition=-Y.x+"px "+-Y.y+"px"}return this._setIconStyles(_,"icon"),_},createShadow:function(){return null}});function Bt(U){return new Rt(U)}Lm.Default=db;var St=fu.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Jt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(U){m(this,U)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(U){U._addZoomLimit(this)},onRemove:function(U){this._removeAllTiles(),Mn(this._container),U._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ns(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(to(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(U){return this.options.opacity=U,this._updateOpacity(),this},setZIndex:function(U){return this.options.zIndex=U,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var U=this._clampZoom(this._map.getZoom());U!==this._tileZoom&&(this._tileZoom=U,this._updateLevels()),this._update()}return this},getEvents:function(){var U={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),U.move=this._onMove),this._zoomAnimated&&(U.zoomanim=this._animateZoom),U},createTile:function(){return document.createElement("div")},getTileSize:function(){var U=this.options.tileSize;return U instanceof O?U:new O(U,U)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(U){for(var _=this.getPane().children,$=-U(-1/0,1/0),Y=0,te=_.length,pe;Y<te;Y++)pe=_[Y].style.zIndex,_[Y]!==this._container&&pe&&($=U($,+pe));isFinite($)&&(this.options.zIndex=$+U(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Jt.ielt9){Ya(this._container,this.options.opacity);var U=+new Date,_=!1,$=!1;for(var Y in this._tiles){var te=this._tiles[Y];if(!(!te.current||!te.loaded)){var pe=Math.min(1,(U-te.loaded)/200);Ya(te.el,pe),pe<1?_=!0:(te.active?$=!0:this._onOpaqueTile(te),te.active=!0)}}$&&!this._noPrune&&this._pruneTiles(),_&&(R(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=Kt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var U=this._tileZoom,_=this.options.maxZoom;if(U!==void 0){for(var $ in this._levels)$=Number($),this._levels[$].el.children.length||$===U?(this._levels[$].el.style.zIndex=_-Math.abs(U-$),this._onUpdateLevel($)):(Mn(this._levels[$].el),this._removeTilesAtZoom($),this._onRemoveLevel($),delete this._levels[$]);var Y=this._levels[U],te=this._map;return Y||(Y=this._levels[U]={},Y.el=Kt("div","leaflet-tile-container leaflet-zoom-animated",this._container),Y.el.style.zIndex=_,Y.origin=te.project(te.unproject(te.getPixelOrigin()),U).round(),Y.zoom=U,this._setZoomTransform(Y,te.getCenter(),te.getZoom()),d(Y.el.offsetWidth),this._onCreateLevel(Y)),this._level=Y,Y}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var U,_,$=this._map.getZoom();if($>this.options.maxZoom||$<this.options.minZoom){this._removeAllTiles();return}for(U in this._tiles)_=this._tiles[U],_.retain=_.current;for(U in this._tiles)if(_=this._tiles[U],_.current&&!_.active){var Y=_.coords;this._retainParent(Y.x,Y.y,Y.z,Y.z-5)||this._retainChildren(Y.x,Y.y,Y.z,Y.z+2)}for(U in this._tiles)this._tiles[U].retain||this._removeTile(U)}},_removeTilesAtZoom:function(U){for(var _ in this._tiles)this._tiles[_].coords.z===U&&this._removeTile(_)},_removeAllTiles:function(){for(var U in this._tiles)this._removeTile(U)},_invalidateAll:function(){for(var U in this._levels)Mn(this._levels[U].el),this._onRemoveLevel(Number(U)),delete this._levels[U];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(U,_,$,Y){var te=Math.floor(U/2),pe=Math.floor(_/2),we=$-1,Ge=new O(+te,+pe);Ge.z=+we;var Ye=this._tileCoordsToKey(Ge),gt=this._tiles[Ye];return gt&&gt.active?(gt.retain=!0,!0):(gt&&gt.loaded&&(gt.retain=!0),we>Y?this._retainParent(te,pe,we,Y):!1)},_retainChildren:function(U,_,$,Y){for(var te=2*U;te<2*U+2;te++)for(var pe=2*_;pe<2*_+2;pe++){var we=new O(te,pe);we.z=$+1;var Ge=this._tileCoordsToKey(we),Ye=this._tiles[Ge];if(Ye&&Ye.active){Ye.retain=!0;continue}else Ye&&Ye.loaded&&(Ye.retain=!0);$+1<Y&&this._retainChildren(te,pe,$+1,Y)}},_resetView:function(U){var _=U&&(U.pinch||U.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),_,_)},_animateZoom:function(U){this._setView(U.center,U.zoom,!0,U.noUpdate)},_clampZoom:function(U){var _=this.options;return _.minNativeZoom!==void 0&&U<_.minNativeZoom?_.minNativeZoom:_.maxNativeZoom!==void 0&&_.maxNativeZoom<U?_.maxNativeZoom:U},_setView:function(U,_,$,Y){var te=Math.round(_);this.options.maxZoom!==void 0&&te>this.options.maxZoom||this.options.minZoom!==void 0&&te<this.options.minZoom?te=void 0:te=this._clampZoom(te);var pe=this.options.updateWhenZooming&&te!==this._tileZoom;(!Y||pe)&&(this._tileZoom=te,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),te!==void 0&&this._update(U),$||this._pruneTiles(),this._noPrune=!!$),this._setZoomTransforms(U,_)},_setZoomTransforms:function(U,_){for(var $ in this._levels)this._setZoomTransform(this._levels[$],U,_)},_setZoomTransform:function(U,_,$){var Y=this._map.getZoomScale($,U.zoom),te=U.origin.multiplyBy(Y).subtract(this._map._getNewPixelOrigin(_,$)).round();Jt.any3d?di(U.el,te,Y):Ri(U.el,te)},_resetGrid:function(){var U=this._map,_=U.options.crs,$=this._tileSize=this.getTileSize(),Y=this._tileZoom,te=this._map.getPixelWorldBounds(this._tileZoom);te&&(this._globalTileRange=this._pxBoundsToTileRange(te)),this._wrapX=_.wrapLng&&!this.options.noWrap&&[Math.floor(U.project([0,_.wrapLng[0]],Y).x/$.x),Math.ceil(U.project([0,_.wrapLng[1]],Y).x/$.y)],this._wrapY=_.wrapLat&&!this.options.noWrap&&[Math.floor(U.project([_.wrapLat[0],0],Y).y/$.x),Math.ceil(U.project([_.wrapLat[1],0],Y).y/$.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(U){var _=this._map,$=_._animatingZoom?Math.max(_._animateToZoom,_.getZoom()):_.getZoom(),Y=_.getZoomScale($,this._tileZoom),te=_.project(U,this._tileZoom).floor(),pe=_.getSize().divideBy(Y*2);return new j(te.subtract(pe),te.add(pe))},_update:function(U){var _=this._map;if(_){var $=this._clampZoom(_.getZoom());if(U===void 0&&(U=_.getCenter()),this._tileZoom!==void 0){var Y=this._getTiledPixelBounds(U),te=this._pxBoundsToTileRange(Y),pe=te.getCenter(),we=[],Ge=this.options.keepBuffer,Ye=new j(te.getBottomLeft().subtract([Ge,-Ge]),te.getTopRight().add([Ge,-Ge]));if(!(isFinite(te.min.x)&&isFinite(te.min.y)&&isFinite(te.max.x)&&isFinite(te.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var gt in this._tiles){var ti=this._tiles[gt].coords;(ti.z!==this._tileZoom||!Ye.contains(new O(ti.x,ti.y)))&&(this._tiles[gt].current=!1)}if(Math.abs($-this._tileZoom)>1){this._setView(U,$);return}for(var Zi=te.min.y;Zi<=te.max.y;Zi++)for(var $r=te.min.x;$r<=te.max.x;$r++){var Dc=new O($r,Zi);if(Dc.z=this._tileZoom,!!this._isValidTile(Dc)){var zo=this._tiles[this._tileCoordsToKey(Dc)];zo?zo.current=!0:we.push(Dc)}}if(we.sort(function(gu,oS){return gu.distanceTo(pe)-oS.distanceTo(pe)}),we.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var jd=document.createDocumentFragment();for($r=0;$r<we.length;$r++)this._addTile(we[$r],jd);this._level.el.appendChild(jd)}}}},_isValidTile:function(U){var _=this._map.options.crs;if(!_.infinite){var $=this._globalTileRange;if(!_.wrapLng&&(U.x<$.min.x||U.x>$.max.x)||!_.wrapLat&&(U.y<$.min.y||U.y>$.max.y))return!1}if(!this.options.bounds)return!0;var Y=this._tileCoordsToBounds(U);return z(this.options.bounds).overlaps(Y)},_keyToBounds:function(U){return this._tileCoordsToBounds(this._keyToTileCoords(U))},_tileCoordsToNwSe:function(U){var _=this._map,$=this.getTileSize(),Y=U.scaleBy($),te=Y.add($),pe=_.unproject(Y,U.z),we=_.unproject(te,U.z);return[pe,we]},_tileCoordsToBounds:function(U){var _=this._tileCoordsToNwSe(U),$=new W(_[0],_[1]);return this.options.noWrap||($=this._map.wrapLatLngBounds($)),$},_tileCoordsToKey:function(U){return U.x+":"+U.y+":"+U.z},_keyToTileCoords:function(U){var _=U.split(":"),$=new O(+_[0],+_[1]);return $.z=+_[2],$},_removeTile:function(U){var _=this._tiles[U];_&&(Mn(_.el),delete this._tiles[U],this.fire("tileunload",{tile:_.el,coords:this._keyToTileCoords(U)}))},_initTile:function(U){ki(U,"leaflet-tile");var _=this.getTileSize();U.style.width=_.x+"px",U.style.height=_.y+"px",U.onselectstart=d,U.onmousemove=d,Jt.ielt9&&this.options.opacity<1&&Ya(U,this.options.opacity)},_addTile:function(U,_){var $=this._getTilePos(U),Y=this._tileCoordsToKey(U),te=this.createTile(this._wrapCoords(U),s(this._tileReady,this,U));this._initTile(te),this.createTile.length<2&&P(s(this._tileReady,this,U,null,te)),Ri(te,$),this._tiles[Y]={el:te,coords:U,current:!0},_.appendChild(te),this.fire("tileloadstart",{tile:te,coords:U})},_tileReady:function(U,_,$){_&&this.fire("tileerror",{error:_,tile:$,coords:U});var Y=this._tileCoordsToKey(U);$=this._tiles[Y],$&&($.loaded=+new Date,this._map._fadeAnimated?(Ya($.el,0),R(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this)):($.active=!0,this._pruneTiles()),_||(ki($.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:$.el,coords:U})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Jt.ielt9||!this._map._fadeAnimated?P(this._pruneTiles,this):setTimeout(s(this._pruneTiles,this),250)))},_getTilePos:function(U){return U.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(U){var _=new O(this._wrapX?u(U.x,this._wrapX):U.x,this._wrapY?u(U.y,this._wrapY):U.y);return _.z=U.z,_},_pxBoundsToTileRange:function(U){var _=this.getTileSize();return new j(U.min.unscaleBy(_).floor(),U.max.unscaleBy(_).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var U in this._tiles)if(!this._tiles[U].loaded)return!1;return!0}});function kt(U){return new St(U)}var Ot=St.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(U,_){this._url=U,_=m(this,_),_.detectRetina&&Jt.retina&&_.maxZoom>0?(_.tileSize=Math.floor(_.tileSize/2),_.zoomReverse?(_.zoomOffset--,_.minZoom=Math.min(_.maxZoom,_.minZoom+1)):(_.zoomOffset++,_.maxZoom=Math.max(_.minZoom,_.maxZoom-1)),_.minZoom=Math.max(0,_.minZoom)):_.zoomReverse?_.minZoom=Math.min(_.maxZoom,_.minZoom):_.maxZoom=Math.max(_.minZoom,_.maxZoom),typeof _.subdomains=="string"&&(_.subdomains=_.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(U,_){return this._url===U&&_===void 0&&(_=!0),this._url=U,_||this.redraw(),this},createTile:function(U,_){var $=document.createElement("img");return ni($,"load",s(this._tileOnLoad,this,_,$)),ni($,"error",s(this._tileOnError,this,_,$)),(this.options.crossOrigin||this.options.crossOrigin==="")&&($.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&($.referrerPolicy=this.options.referrerPolicy),$.alt="",$.src=this.getTileUrl(U),$},getTileUrl:function(U){var _={r:Jt.retina?"@2x":"",s:this._getSubdomain(U),x:U.x,y:U.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var $=this._globalTileRange.max.y-U.y;this.options.tms&&(_.y=$),_["-y"]=$}return y(this._url,n(_,this.options))},_tileOnLoad:function(U,_){Jt.ielt9?setTimeout(s(U,this,null,_),0):U(null,_)},_tileOnError:function(U,_,$){var Y=this.options.errorTileUrl;Y&&_.getAttribute("src")!==Y&&(_.src=Y),U($,_)},_onTileRemove:function(U){U.tile.onload=null},_getZoomForUrl:function(){var U=this._tileZoom,_=this.options.maxZoom,$=this.options.zoomReverse,Y=this.options.zoomOffset;return $&&(U=_-U),U+Y},_getSubdomain:function(U){var _=Math.abs(U.x+U.y)%this.options.subdomains.length;return this.options.subdomains[_]},_abortLoading:function(){var U,_;for(U in this._tiles)if(this._tiles[U].coords.z!==this._tileZoom&&(_=this._tiles[U].el,_.onload=d,_.onerror=d,!_.complete)){_.src=w;var $=this._tiles[U].coords;Mn(_),delete this._tiles[U],this.fire("tileabort",{tile:_,coords:$})}},_removeTile:function(U){var _=this._tiles[U];if(_)return _.el.setAttribute("src",w),St.prototype._removeTile.call(this,U)},_tileReady:function(U,_,$){if(!(!this._map||$&&$.getAttribute("src")===w))return St.prototype._tileReady.call(this,U,_,$)}});function xt(U,_){return new Ot(U,_)}var ei=Ot.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(U,_){this._url=U;var $=n({},this.defaultWmsParams);for(var Y in _)Y in this.options||($[Y]=_[Y]);_=m(this,_);var te=_.detectRetina&&Jt.retina?2:1,pe=this.getTileSize();$.width=pe.x*te,$.height=pe.y*te,this.wmsParams=$},onAdd:function(U){this._crs=this.options.crs||U.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var _=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[_]=this._crs.code,Ot.prototype.onAdd.call(this,U)},getTileUrl:function(U){var _=this._tileCoordsToNwSe(U),$=this._crs,Y=q($.project(_[0]),$.project(_[1])),te=Y.min,pe=Y.max,we=(this._wmsVersion>=1.3&&this._crs===pM?[te.y,te.x,pe.y,pe.x]:[te.x,te.y,pe.x,pe.y]).join(","),Ge=Ot.prototype.getTileUrl.call(this,U);return Ge+g(this.wmsParams,Ge,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+we},setParams:function(U,_){return n(this.wmsParams,U),_||this.redraw(),this}});function dr(U,_){return new ei(U,_)}Ot.WMS=ei,xt.wms=dr;var zi=fu.extend({options:{padding:.1},initialize:function(U){m(this,U),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ki(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var U={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(U.zoomanim=this._onAnimZoom),U},_onAnimZoom:function(U){this._updateTransform(U.center,U.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(U,_){var $=this._map.getZoomScale(_,this._zoom),Y=this._map.getSize().multiplyBy(.5+this.options.padding),te=this._map.project(this._center,_),pe=Y.multiplyBy(-$).add(te).subtract(this._map._getNewPixelOrigin(U,_));Jt.any3d?di(this._container,pe,$):Ri(this._container,pe)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var U in this._layers)this._layers[U]._reset()},_onZoomEnd:function(){for(var U in this._layers)this._layers[U]._project()},_updatePaths:function(){for(var U in this._layers)this._layers[U]._update()},_update:function(){var U=this.options.padding,_=this._map.getSize(),$=this._map.containerPointToLayerPoint(_.multiplyBy(-U)).round();this._bounds=new j($,$.add(_.multiplyBy(1+U*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ur=zi.extend({options:{tolerance:0},getEvents:function(){var U=zi.prototype.getEvents.call(this);return U.viewprereset=this._onViewPreReset,U},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var U=this._container=document.createElement("canvas");ni(U,"mousemove",this._onMouseMove,this),ni(U,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ni(U,"mouseout",this._handleMouseOut,this),U._leaflet_disable_events=!0,this._ctx=U.getContext("2d")},_destroyContainer:function(){R(this._redrawRequest),delete this._ctx,Mn(this._container),Ar(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var U;this._redrawBounds=null;for(var _ in this._layers)U=this._layers[_],U._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zi.prototype._update.call(this);var U=this._bounds,_=this._container,$=U.getSize(),Y=Jt.retina?2:1;Ri(_,U.min),_.width=Y*$.x,_.height=Y*$.y,_.style.width=$.x+"px",_.style.height=$.y+"px",Jt.retina&&this._ctx.scale(2,2),this._ctx.translate(-U.min.x,-U.min.y),this.fire("update")}},_reset:function(){zi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(U){this._updateDashArray(U),this._layers[l(U)]=U;var _=U._order={layer:U,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=_),this._drawLast=_,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(U){this._requestRedraw(U)},_removePath:function(U){var _=U._order,$=_.next,Y=_.prev;$?$.prev=Y:this._drawLast=Y,Y?Y.next=$:this._drawFirst=$,delete U._order,delete this._layers[l(U)],this._requestRedraw(U)},_updatePath:function(U){this._extendRedrawBounds(U),U._project(),U._update(),this._requestRedraw(U)},_updateStyle:function(U){this._updateDashArray(U),this._requestRedraw(U)},_updateDashArray:function(U){if(typeof U.options.dashArray=="string"){var _=U.options.dashArray.split(/[, ]+/),$=[],Y,te;for(te=0;te<_.length;te++){if(Y=Number(_[te]),isNaN(Y))return;$.push(Y)}U.options._dashArray=$}else U.options._dashArray=U.options.dashArray},_requestRedraw:function(U){this._map&&(this._extendRedrawBounds(U),this._redrawRequest=this._redrawRequest||P(this._redraw,this))},_extendRedrawBounds:function(U){if(U._pxBounds){var _=(U.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new j,this._redrawBounds.extend(U._pxBounds.min.subtract([_,_])),this._redrawBounds.extend(U._pxBounds.max.add([_,_]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var U=this._redrawBounds;if(U){var _=U.getSize();this._ctx.clearRect(U.min.x,U.min.y,_.x,_.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var U,_=this._redrawBounds;if(this._ctx.save(),_){var $=_.getSize();this._ctx.beginPath(),this._ctx.rect(_.min.x,_.min.y,$.x,$.y),this._ctx.clip()}this._drawing=!0;for(var Y=this._drawFirst;Y;Y=Y.next)U=Y.layer,(!_||U._pxBounds&&U._pxBounds.intersects(_))&&U._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(U,_){if(this._drawing){var $,Y,te,pe,we=U._parts,Ge=we.length,Ye=this._ctx;if(Ge){for(Ye.beginPath(),$=0;$<Ge;$++){for(Y=0,te=we[$].length;Y<te;Y++)pe=we[$][Y],Ye[Y?"lineTo":"moveTo"](pe.x,pe.y);_&&Ye.closePath()}this._fillStroke(Ye,U)}}},_updateCircle:function(U){if(!(!this._drawing||U._empty())){var _=U._point,$=this._ctx,Y=Math.max(Math.round(U._radius),1),te=(Math.max(Math.round(U._radiusY),1)||Y)/Y;te!==1&&($.save(),$.scale(1,te)),$.beginPath(),$.arc(_.x,_.y/te,Y,0,Math.PI*2,!1),te!==1&&$.restore(),this._fillStroke($,U)}},_fillStroke:function(U,_){var $=_.options;$.fill&&(U.globalAlpha=$.fillOpacity,U.fillStyle=$.fillColor||$.color,U.fill($.fillRule||"evenodd")),$.stroke&&$.weight!==0&&(U.setLineDash&&U.setLineDash(_.options&&_.options._dashArray||[]),U.globalAlpha=$.opacity,U.lineWidth=$.weight,U.strokeStyle=$.color,U.lineCap=$.lineCap,U.lineJoin=$.lineJoin,U.stroke())},_onClick:function(U){for(var _=this._map.mouseEventToLayerPoint(U),$,Y,te=this._drawFirst;te;te=te.next)$=te.layer,$.options.interactive&&$._containsPoint(_)&&(!(U.type==="click"||U.type==="preclick")||!this._map._draggableMoved($))&&(Y=$);this._fireEvent(Y?[Y]:!1,U)},_onMouseMove:function(U){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var _=this._map.mouseEventToLayerPoint(U);this._handleMouseHover(U,_)}},_handleMouseOut:function(U){var _=this._hoveredLayer;_&&(fn(this._container,"leaflet-interactive"),this._fireEvent([_],U,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(U,_){if(!this._mouseHoverThrottled){for(var $,Y,te=this._drawFirst;te;te=te.next)$=te.layer,$.options.interactive&&$._containsPoint(_)&&(Y=$);Y!==this._hoveredLayer&&(this._handleMouseOut(U),Y&&(ki(this._container,"leaflet-interactive"),this._fireEvent([Y],U,"mouseover"),this._hoveredLayer=Y)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,U),this._mouseHoverThrottled=!0,setTimeout(s(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(U,_,$){this._map._fireDOMEvent(_,$||_.type,U)},_bringToFront:function(U){var _=U._order;if(_){var $=_.next,Y=_.prev;if($)$.prev=Y;else return;Y?Y.next=$:$&&(this._drawFirst=$),_.prev=this._drawLast,this._drawLast.next=_,_.next=null,this._drawLast=_,this._requestRedraw(U)}},_bringToBack:function(U){var _=U._order;if(_){var $=_.next,Y=_.prev;if(Y)Y.next=$;else return;$?$.prev=Y:Y&&(this._drawLast=Y),_.prev=null,_.next=this._drawFirst,this._drawFirst.prev=_,this._drawFirst=_,this._requestRedraw(U)}}});function Kl(U){return Jt.canvas?new Ur(U):null}var Ki=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(U){return document.createElement("<lvml:"+U+' class="lvml">')}}catch{}return function(U){return document.createElement("<"+U+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Go={_initContainer:function(){this._container=Kt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zi.prototype._update.call(this),this.fire("update"))},_initPath:function(U){var _=U._container=Ki("shape");ki(_,"leaflet-vml-shape "+(this.options.className||"")),_.coordsize="1 1",U._path=Ki("path"),_.appendChild(U._path),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){var _=U._container;this._container.appendChild(_),U.options.interactive&&U.addInteractiveTarget(_)},_removePath:function(U){var _=U._container;Mn(_),U.removeInteractiveTarget(_),delete this._layers[l(U)]},_updateStyle:function(U){var _=U._stroke,$=U._fill,Y=U.options,te=U._container;te.stroked=!!Y.stroke,te.filled=!!Y.fill,Y.stroke?(_||(_=U._stroke=Ki("stroke")),te.appendChild(_),_.weight=Y.weight+"px",_.color=Y.color,_.opacity=Y.opacity,Y.dashArray?_.dashStyle=b(Y.dashArray)?Y.dashArray.join(" "):Y.dashArray.replace(/( *, *)/g," "):_.dashStyle="",_.endcap=Y.lineCap.replace("butt","flat"),_.joinstyle=Y.lineJoin):_&&(te.removeChild(_),U._stroke=null),Y.fill?($||($=U._fill=Ki("fill")),te.appendChild($),$.color=Y.fillColor||Y.color,$.opacity=Y.fillOpacity):$&&(te.removeChild($),U._fill=null)},_updateCircle:function(U){var _=U._point.round(),$=Math.round(U._radius),Y=Math.round(U._radiusY||$);this._setPath(U,U._empty()?"M0 0":"AL "+_.x+","+_.y+" "+$+","+Y+" 0,"+65535*360)},_setPath:function(U,_){U._path.v=_},_bringToFront:function(U){ns(U._container)},_bringToBack:function(U){to(U._container)}},Ws=Jt.vml?Ki:Ie,mf=zi.extend({_initContainer:function(){this._container=Ws("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ws("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Mn(this._container),Ar(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zi.prototype._update.call(this);var U=this._bounds,_=U.getSize(),$=this._container;(!this._svgSize||!this._svgSize.equals(_))&&(this._svgSize=_,$.setAttribute("width",_.x),$.setAttribute("height",_.y)),Ri($,U.min),$.setAttribute("viewBox",[U.min.x,U.min.y,_.x,_.y].join(" ")),this.fire("update")}},_initPath:function(U){var _=U._path=Ws("path");U.options.className&&ki(_,U.options.className),U.options.interactive&&ki(_,"leaflet-interactive"),this._updateStyle(U),this._layers[l(U)]=U},_addPath:function(U){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(U._path),U.addInteractiveTarget(U._path)},_removePath:function(U){Mn(U._path),U.removeInteractiveTarget(U._path),delete this._layers[l(U)]},_updatePath:function(U){U._project(),U._update()},_updateStyle:function(U){var _=U._path,$=U.options;_&&($.stroke?(_.setAttribute("stroke",$.color),_.setAttribute("stroke-opacity",$.opacity),_.setAttribute("stroke-width",$.weight),_.setAttribute("stroke-linecap",$.lineCap),_.setAttribute("stroke-linejoin",$.lineJoin),$.dashArray?_.setAttribute("stroke-dasharray",$.dashArray):_.removeAttribute("stroke-dasharray"),$.dashOffset?_.setAttribute("stroke-dashoffset",$.dashOffset):_.removeAttribute("stroke-dashoffset")):_.setAttribute("stroke","none"),$.fill?(_.setAttribute("fill",$.fillColor||$.color),_.setAttribute("fill-opacity",$.fillOpacity),_.setAttribute("fill-rule",$.fillRule||"evenodd")):_.setAttribute("fill","none"))},_updatePoly:function(U,_){this._setPath(U,Le(U._parts,_))},_updateCircle:function(U){var _=U._point,$=Math.max(Math.round(U._radius),1),Y=Math.max(Math.round(U._radiusY),1)||$,te="a"+$+","+Y+" 0 1,0 ",pe=U._empty()?"M0 0":"M"+(_.x-$)+","+_.y+te+$*2+",0 "+te+-$*2+",0 ";this._setPath(U,pe)},_setPath:function(U,_){U._path.setAttribute("d",_)},_bringToFront:function(U){ns(U._path)},_bringToBack:function(U){to(U._path)}});Jt.vml&&mf.include(Go);function Ho(U){return Jt.svg||Jt.vml?new mf(U):null}Zt.include({getRenderer:function(U){var _=U.options.renderer||this._getPaneRenderer(U.options.pane)||this.options.renderer||this._renderer;return _||(_=this._renderer=this._createRenderer()),this.hasLayer(_)||this.addLayer(_),_},_getPaneRenderer:function(U){if(U==="overlayPane"||U===void 0)return!1;var _=this._paneRenderers[U];return _===void 0&&(_=this._createRenderer({pane:U}),this._paneRenderers[U]=_),_},_createRenderer:function(U){return this.options.preferCanvas&&Kl(U)||Ho(U)}});var gf=ff.extend({initialize:function(U,_){ff.prototype.initialize.call(this,this._boundsToLatLngs(U),_)},setBounds:function(U){return this.setLatLngs(this._boundsToLatLngs(U))},_boundsToLatLngs:function(U){return U=z(U),[U.getSouthWest(),U.getNorthWest(),U.getNorthEast(),U.getSouthEast()]}});function oE(U,_){return new gf(U,_)}mf.create=Ws,mf.pointsToPath=Le,jo.geometryToLayer=pb,jo.coordsToLatLng=G,jo.coordsToLatLngs=X,jo.latLngToCoords=ee,jo.latLngsToCoords=ae,jo.getFeature=de,jo.asFeature=ge,Zt.mergeOptions({boxZoom:!0});var rY=Ds.extend({initialize:function(U){this._map=U,this._container=U._container,this._pane=U._panes.overlayPane,this._resetStateTimeout=0,U.on("unload",this._destroy,this)},addHooks:function(){ni(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ar(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Mn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(U){if(!U.shiftKey||U.which!==1&&U.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),mn(),dl(),this._startPoint=this._map.mouseEventToContainerPoint(U),ni(document,{contextmenu:pl,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(U){this._moved||(this._moved=!0,this._box=Kt("div","leaflet-zoom-box",this._container),ki(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(U);var _=new j(this._point,this._startPoint),$=_.getSize();Ri(this._box,_.min),this._box.style.width=$.x+"px",this._box.style.height=$.y+"px"},_finish:function(){this._moved&&(Mn(this._box),fn(this._container,"leaflet-crosshair")),Ma(),_m(),Ar(document,{contextmenu:pl,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(U){if(!(U.which!==1&&U.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(s(this._resetState,this),0);var _=new W(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(_).fire("boxzoomend",{boxZoomBounds:_})}},_onKeyDown:function(U){U.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Zt.addInitHook("addHandler","boxZoom",rY),Zt.mergeOptions({doubleClickZoom:!0});var nY=Ds.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(U){var _=this._map,$=_.getZoom(),Y=_.options.zoomDelta,te=U.originalEvent.shiftKey?$-Y:$+Y;_.options.doubleClickZoom==="center"?_.setZoom(te):_.setZoomAround(U.containerPoint,te)}});Zt.addInitHook("addHandler","doubleClickZoom",nY),Zt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var aY=Ds.extend({addHooks:function(){if(!this._draggable){var U=this._map;this._draggable=new Bd(U._mapPane,U._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),U.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),U.on("zoomend",this._onZoomEnd,this),U.whenReady(this._onZoomEnd,this))}ki(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){fn(this._map._container,"leaflet-grab"),fn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var U=this._map;if(U._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var _=z(this._map.options.maxBounds);this._offsetLimit=q(this._map.latLngToContainerPoint(_.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(_.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;U.fire("movestart").fire("dragstart"),U.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(U){if(this._map.options.inertia){var _=this._lastTime=+new Date,$=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push($),this._times.push(_),this._prunePositions(_)}this._map.fire("move",U).fire("drag",U)},_prunePositions:function(U){for(;this._positions.length>1&&U-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var U=this._map.getSize().divideBy(2),_=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=_.subtract(U).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(U,_){return U-(U-_)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var U=this._draggable._newPos.subtract(this._draggable._startPos),_=this._offsetLimit;U.x<_.min.x&&(U.x=this._viscousLimit(U.x,_.min.x)),U.y<_.min.y&&(U.y=this._viscousLimit(U.y,_.min.y)),U.x>_.max.x&&(U.x=this._viscousLimit(U.x,_.max.x)),U.y>_.max.y&&(U.y=this._viscousLimit(U.y,_.max.y)),this._draggable._newPos=this._draggable._startPos.add(U)}},_onPreDragWrap:function(){var U=this._worldWidth,_=Math.round(U/2),$=this._initialWorldOffset,Y=this._draggable._newPos.x,te=(Y-_+$)%U+_-$,pe=(Y+_+$)%U-_-$,we=Math.abs(te+$)<Math.abs(pe+$)?te:pe;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=we},_onDragEnd:function(U){var _=this._map,$=_.options,Y=!$.inertia||U.noInertia||this._times.length<2;if(_.fire("dragend",U),Y)_.fire("moveend");else{this._prunePositions(+new Date);var te=this._lastPos.subtract(this._positions[0]),pe=(this._lastTime-this._times[0])/1e3,we=$.easeLinearity,Ge=te.multiplyBy(we/pe),Ye=Ge.distanceTo([0,0]),gt=Math.min($.inertiaMaxSpeed,Ye),ti=Ge.multiplyBy(gt/Ye),Zi=gt/($.inertiaDeceleration*we),$r=ti.multiplyBy(-Zi/2).round();!$r.x&&!$r.y?_.fire("moveend"):($r=_._limitOffset($r,_.options.maxBounds),P(function(){_.panBy($r,{duration:Zi,easeLinearity:we,noMoveStart:!0,animate:!0})}))}}});Zt.addInitHook("addHandler","dragging",aY),Zt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var sY=Ds.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(U){this._map=U,this._setPanDelta(U.options.keyboardPanDelta),this._setZoomDelta(U.options.zoomDelta)},addHooks:function(){var U=this._map._container;U.tabIndex<=0&&(U.tabIndex="0"),ni(U,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ar(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var U=document.body,_=document.documentElement,$=U.scrollTop||_.scrollTop,Y=U.scrollLeft||_.scrollLeft;this._map._container.focus(),window.scrollTo(Y,$)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(U){var _=this._panKeys={},$=this.keyCodes,Y,te;for(Y=0,te=$.left.length;Y<te;Y++)_[$.left[Y]]=[-1*U,0];for(Y=0,te=$.right.length;Y<te;Y++)_[$.right[Y]]=[U,0];for(Y=0,te=$.down.length;Y<te;Y++)_[$.down[Y]]=[0,U];for(Y=0,te=$.up.length;Y<te;Y++)_[$.up[Y]]=[0,-1*U]},_setZoomDelta:function(U){var _=this._zoomKeys={},$=this.keyCodes,Y,te;for(Y=0,te=$.zoomIn.length;Y<te;Y++)_[$.zoomIn[Y]]=U;for(Y=0,te=$.zoomOut.length;Y<te;Y++)_[$.zoomOut[Y]]=-U},_addHooks:function(){ni(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ar(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(U){if(!(U.altKey||U.ctrlKey||U.metaKey)){var _=U.keyCode,$=this._map,Y;if(_ in this._panKeys){if(!$._panAnim||!$._panAnim._inProgress)if(Y=this._panKeys[_],U.shiftKey&&(Y=F(Y).multiplyBy(3)),$.options.maxBounds&&(Y=$._limitOffset(F(Y),$.options.maxBounds)),$.options.worldCopyJump){var te=$.wrapLatLng($.unproject($.project($.getCenter()).add(Y)));$.panTo(te)}else $.panBy(Y)}else if(_ in this._zoomKeys)$.setZoom($.getZoom()+(U.shiftKey?3:1)*this._zoomKeys[_]);else if(_===27&&$._popup&&$._popup.options.closeOnEscapeKey)$.closePopup();else return;pl(U)}}});Zt.addInitHook("addHandler","keyboard",sY),Zt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var oY=Ds.extend({addHooks:function(){ni(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ar(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(U){var _=tt(U),$=this._map.options.wheelDebounceTime;this._delta+=_,this._lastMousePos=this._map.mouseEventToContainerPoint(U),this._startTime||(this._startTime=+new Date);var Y=Math.max($-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s(this._performZoom,this),Y),pl(U)},_performZoom:function(){var U=this._map,_=U.getZoom(),$=this._map.options.zoomSnap||0;U._stop();var Y=this._delta/(this._map.options.wheelPxPerZoomLevel*4),te=4*Math.log(2/(1+Math.exp(-Math.abs(Y))))/Math.LN2,pe=$?Math.ceil(te/$)*$:te,we=U._limitZoom(_+(this._delta>0?pe:-pe))-_;this._delta=0,this._startTime=null,we&&(U.options.scrollWheelZoom==="center"?U.setZoom(_+we):U.setZoomAround(this._lastMousePos,_+we))}});Zt.addInitHook("addHandler","scrollWheelZoom",oY);var s1e=600;Zt.mergeOptions({tapHold:Jt.touchNative&&Jt.safari&&Jt.mobile,tapTolerance:15});var lY=Ds.extend({addHooks:function(){ni(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ar(this._map._container,"touchstart",this._onDown,this)},_onDown:function(U){if(clearTimeout(this._holdTimeout),U.touches.length===1){var _=U.touches[0];this._startPos=this._newPos=new O(_.clientX,_.clientY),this._holdTimeout=setTimeout(s(function(){this._cancel(),this._isTapValid()&&(ni(document,"touchend",Na),ni(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",_))},this),s1e),ni(document,"touchend touchcancel contextmenu",this._cancel,this),ni(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function U(){Ar(document,"touchend",Na),Ar(document,"touchend touchcancel",U)},_cancel:function(){clearTimeout(this._holdTimeout),Ar(document,"touchend touchcancel contextmenu",this._cancel,this),Ar(document,"touchmove",this._onMove,this)},_onMove:function(U){var _=U.touches[0];this._newPos=new O(_.clientX,_.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(U,_){var $=new MouseEvent(U,{bubbles:!0,cancelable:!0,view:window,screenX:_.screenX,screenY:_.screenY,clientX:_.clientX,clientY:_.clientY});$._simulated=!0,_.target.dispatchEvent($)}});Zt.addInitHook("addHandler","tapHold",lY),Zt.mergeOptions({touchZoom:Jt.touch,bounceAtZoomLimits:!0});var cY=Ds.extend({addHooks:function(){ki(this._map._container,"leaflet-touch-zoom"),ni(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){fn(this._map._container,"leaflet-touch-zoom"),Ar(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(U){var _=this._map;if(!(!U.touches||U.touches.length!==2||_._animatingZoom||this._zooming)){var $=_.mouseEventToContainerPoint(U.touches[0]),Y=_.mouseEventToContainerPoint(U.touches[1]);this._centerPoint=_.getSize()._divideBy(2),this._startLatLng=_.containerPointToLatLng(this._centerPoint),_.options.touchZoom!=="center"&&(this._pinchStartLatLng=_.containerPointToLatLng($.add(Y)._divideBy(2))),this._startDist=$.distanceTo(Y),this._startZoom=_.getZoom(),this._moved=!1,this._zooming=!0,_._stop(),ni(document,"touchmove",this._onTouchMove,this),ni(document,"touchend touchcancel",this._onTouchEnd,this),Na(U)}},_onTouchMove:function(U){if(!(!U.touches||U.touches.length!==2||!this._zooming)){var _=this._map,$=_.mouseEventToContainerPoint(U.touches[0]),Y=_.mouseEventToContainerPoint(U.touches[1]),te=$.distanceTo(Y)/this._startDist;if(this._zoom=_.getScaleZoom(te,this._startZoom),!_.options.bounceAtZoomLimits&&(this._zoom<_.getMinZoom()&&te<1||this._zoom>_.getMaxZoom()&&te>1)&&(this._zoom=_._limitZoom(this._zoom)),_.options.touchZoom==="center"){if(this._center=this._startLatLng,te===1)return}else{var pe=$._add(Y)._divideBy(2)._subtract(this._centerPoint);if(te===1&&pe.x===0&&pe.y===0)return;this._center=_.unproject(_.project(this._pinchStartLatLng,this._zoom).subtract(pe),this._zoom)}this._moved||(_._moveStart(!0,!1),this._moved=!0),R(this._animRequest);var we=s(_._move,_,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=P(we,this,!0),Na(U)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,R(this._animRequest),Ar(document,"touchmove",this._onTouchMove,this),Ar(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Zt.addInitHook("addHandler","touchZoom",cY),Zt.BoxZoom=rY,Zt.DoubleClickZoom=nY,Zt.Drag=aY,Zt.Keyboard=sY,Zt.ScrollWheelZoom=oY,Zt.TapHold=lY,Zt.TouchZoom=cY,i.Bounds=j,i.Browser=Jt,i.CRS=J,i.Canvas=Ur,i.Circle=aE,i.CircleMarker=Bm,i.Class=A,i.Control=ur,i.DivIcon=Rt,i.DivOverlay=Ne,i.DomEvent=wi,i.DomUtil=km,i.Draggable=Bd,i.Evented=x,i.FeatureGroup=sd,i.GeoJSON=jo,i.GridLayer=St,i.Handler=Ds,i.Icon=Lm,i.ImageOverlay=Ae,i.LatLng=H,i.LatLngBounds=W,i.Layer=fu,i.LayerGroup=lv,i.LineUtil=E2,i.Map=Zt,i.Marker=Fm,i.Mixin=tE,i.Path=Ln,i.Point=O,i.PolyUtil=sb,i.Polygon=ff,i.Polyline=Vd,i.Popup=Ve,i.PosAnimation=Rr,i.Projection=P2,i.Rectangle=gf,i.Renderer=zi,i.SVG=mf,i.SVGOverlay=Re,i.TileLayer=Ot,i.Tooltip=rt,i.Transformation=le,i.Util=M,i.VideoOverlay=_e,i.bind=s,i.bounds=q,i.canvas=Kl,i.circle=sE,i.circleMarker=mu,i.control=Ka,i.divIcon=Bt,i.extend=n,i.featureGroup=mM,i.geoJSON=Ee,i.geoJson=Pe,i.gridLayer=kt,i.icon=C2,i.imageOverlay=Te,i.latLng=Z,i.latLngBounds=z,i.layerGroup=fM,i.map=Sa,i.marker=Hp,i.point=F,i.polygon=cv,i.polyline=$m,i.popup=He,i.rectangle=oE,i.setOptions=m,i.stamp=l,i.svg=Ho,i.svgOverlay=Me,i.tileLayer=xt,i.tooltip=ct,i.transformation=re,i.version=r,i.videoOverlay=Ce;var o1e=window.L;i.noConflict=function(){return window.L=o1e,this},window.L=i}))})(_E,_E.exports)),_E.exports}var tA=ast();function sst(){try{return navigator||window.navigator}catch(t){console.log(t);return}}function ost({coords:t,callback:e}){let i=16;(!t?.latitude||!t?.longitude)&&(t={latitude:0,longitude:0},i=2);const r={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${$f.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${r.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${r.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `,l=[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?c():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&c(),Pt(e)&&e&&e(t)},intent:"is-info",label:"Submit",close:!0}],c=()=>{const g=d.link.element?.value,v=est(g)||tst(g)||Qat(g)||ist(g);v.latitude?m(v):g&&v.latitude===void 0&&$t({message:"Invalid URL"})},u=g=>{g.key==="Enter"&&c()};Kr({title:"Location",content:a,buttons:l});const d=rst(r),{map:p,marker:h}=lst({successElement:d.map.element,mapElementId:d.map.id,coords:t,zoom:i});d.link.element&&(d.link.element.value="",d.link.element.focus(),d.link.element.addEventListener("keyup",u)),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};const y=new tA.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){return g&&v?(t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0):(t={latitude:0,longitude:0},p.fitWorld(),!1)}}function lst({successElement:t,mapElementId:e,coords:i,zoom:r}){if(!sst()?.onLine)return{};if(i.latitude&&i.longitude)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,r);return{};function a(s,o,l){if(isNaN(s)||isNaN(o))return{};const c=ai.locations.map_view||"map",u=tA.tileLayer(ai.leaflet[c].tileLayer,{attribution:ai.leaflet[c].attribution,maxZoom:ai.leaflet[c].maxZoom??16}),d=tA.map(e).fitWorld().addLayer(u);(s||o)&&d.setView([+s,+o],l);const p=tA.marker([+s,+o]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function cst(t,e){const i=e.getRow().getData(),{latitude:r,longitude:n}=i?.address||{};ost({coords:{latitude:r,longitude:n},callback:(s={})=>{i.address||(i.address={});const o=i.venue;o.addresses||(o.addresses=[]),o.addresses.length?Object.assign(o.addresses[0],{latitude:s.latitude,longitude:s.longitude}):o.addresses.push({latitude:s.latitude,longitude:s.longitude});const l=u=>{if(u.results?.[0]?.success){const d=e.getTable();i.address.latitude=s.latitude,i.address.longitude=s.longitude,i.hasLocation=s.latitude&&s.longitude,d.updateData([i])}},c=[{method:LYe,params:{venueId:i.venueId,modifications:{addresses:o.addresses}}}];qt({methods:c,callback:l})}})}function ust(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{cellClick:eI,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:eI,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:li,field:"courtsCount",hozAlign:li,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:li,headerSort:!0,hozAlign:li,visible:!0,minWidth:120},{title:"Time",headerHozAlign:li,field:"availableTime",headerSort:!0,hozAlign:li,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:li,cellClick:cst,field:"hasLocation",headerSort:!1,hozAlign:li,visible:!0,width:50},{cellClick:eI,formatter:g9,responsive:!1,headerSort:!1,hozAlign:Xt,field:"isOpen",width:20},{cellClick:t,formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,width:50}]}function dst({table:t}={}){const e=()=>{const{venues:n}=Xf.getVenuesAndCourts();return{rows:n.map(qEe)}},i=()=>{const{rows:n}=e();t?.replaceData(n)},r=ust();if(t)i();else{Rm({anchorId:WA});const n=document.getElementById(WA),{rows:a}=e();t=new ks(n,{headerSortElement:af(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:Jat,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:r,data:a}),t.on("scrollVertical",gd),t.on("cellEdited",s=>{const o=s.getColumn().getDefinition(),l=s.getRow().getData(),c=s.getValue();console.log({cell:s,row:l,value:c,def:o})})}return{table:t,replaceTableData:i}}function pst({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?bo({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);qt({methods:[{method:_Ye,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{label:"Add venue",onClick:()=>TEe(e),location:Xt,id:"addVenue",intent:"none"}]})?.elements:void 0}function hst(){const t=document.getElementById(q3)||void 0,{table:e}=dst();pst({table:e,controlAnchor:t,updateVenueRow:({venue:r})=>{e.updateOrAddData([qEe(r)])}})}const{POLICY_TYPE_AVOIDANCE:kQ}=Cy;function WEe({eventId:t,drawId:e}){return We.getPolicyDefinitions({policyTypes:[kQ],eventId:t,drawId:e})?.policyDefinitions?.[kQ]?.policyAttributes}const fG={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function fst({event:t}){const i=WEe({eventId:t.eventId})?.map(n=>Object.keys(fG).find(a=>fG[a].some(o=>o.directive&&o.directive===n.directive||o.key&&o.key===n.key))).filter(Boolean)??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i?.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function YEe({eventId:t}){const e=We.getEvent({eventId:t}).event;if(!e)return;const{items:i}=fst({event:e});let r;const n=!0,a=u=>r=pn(u,i),o=[{label:"Cancel",intent:Vt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(r).filter(f=>r[f].checked).flatMap(f=>fG[f]).filter(Boolean);qt({methods:[{method:MYe,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else $t({message:"Error",intent:"is-danger"})}})},close:n}],l="Set avoidances",c=(u,d)=>Ww(u,o,d);ht.drawer.open({title:l,content:a,footer:c,side:Xt,width:"300px"})}const{WTN:mst,UTR:gst}=So.ratingConstants,{TEAM:vst}=So.eventConstants,{QUALIFYING:OQ}=Wn;function p2({entry:t,derivedDrawInfo:e,participants:i,participant:r,eventType:n,categoryName:a,eventId:s}){r=r||i?.find(y=>y.participantId===t.participantId);const o=r?.draws?.filter(y=>y.eventId===s).map(y=>({...y,drawName:e[y.drawId].drawName}))??[],l=r?.person?.addresses?.[0],c=l?`${l.city}, ${l.state}`:void 0,u=n===vst?"AVERAGE":n,d=r?.ratings?.[u]?.find(y=>y.scaleName===mst)?.scaleValue,p=r?.ratings?.[u]?.find(y=>y.scaleName===gst)?.scaleValue,h={wtn:d,utr:p},f=r?.rankings?.[n]?.find(y=>y.scaleName===a)?.scaleValue,m=t.entryStage===OQ?`${s}${OQ}`:s,g=r?.seedings?.[n]?.find(y=>y.scaleName===m)?.scaleValue,v=che[t.entryStatus];return{searchText:r?.participantName.toLowerCase(),participant:r,seedNumber:g,cityState:c,...t,ranking:f,ratings:h,flights:o,status:v}}function Jp(t){return Ni.isConvertableInteger(t)&&parseInt(t.toString())>=0}const KEe=(t,e)=>i=>Jp(i)&&Number(i)>=t&&Number(i)<=e,{ORGANISER_ACCEPTANCE:yst,DIRECT_ACCEPTANCE:bst,SPECIAL_EXEMPT:Ist,JUNIOR_EXEMPT:wst,WILDCARD:Sst}=Ju,{MAIN:Tst}=Wn,ik=(t=Tst)=>[`${t}.${bst}`,`${t}.${yst}`,`${t}.${Ist}`,`${t}.${wst}`,`${t}.${Sst}`],{MAIN:xQ}=Wn;function iA(t,e=xQ){return t.entries.filter(({entryStage:i=xQ,entryStatus:r})=>ik(e).includes(`${i}.${r}`)).length}const{FEED_IN:Ust,LUCKY_DRAW:Dst,MAIN:Est,QUALIFYING:Pst,ROUND_ROBIN:LQ,ROUND_ROBIN_WITH_PLAYOFF:jM}=Wn;function Cst({event:t,isQualifying:e,maxQualifiers:i}){const r=e?Pst:Est,n=({fields:p,inputs:h})=>{const f=h[Tv].value||0,m=Jp(f)?parseInt(f):0,g=iA(t,r),v=h.qualifiersCount.value||0,y=Jp(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(h[Cc].value=k3);const I=p&&Eg(p[Cc],"help")?.[0];I&&(I.style.display=b?"":Vt);for(const w of h[Cc].options)w.label===Cc&&(w.disabled=b)},a=({drawType:p,fields:h,inputs:f})=>{const m=i?f[Tv].value:iA(t,r),g=f.qualifiersCount.value||1,v=Jp(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[Dst,Ust,LQ,jM].includes(p))&&y||Ni.nextPowerOf2(y);return f[Tv].value=b,n({fields:h,inputs:f}),b},s=({fields:p,inputs:h})=>{let f=parseInt(h[Tv].value);const m=h.qualifiersCount.value;Jp(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g&&(g.disabled=!1),i&&Jp(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[nh].value;f=a({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!Jp(v)||f<=parseInt(v))&&(g.disabled=!0)},o=({e:p,fields:h,inputs:f})=>{const m=f[qE].value,g=p.target.value;if(i||a({drawType:g,fields:h,inputs:f}),n({fields:h,inputs:f}),h){h[RS].style.display=g===jM&&m===WE?"":Vt,h[qE].style.display=g===jM?"":Vt;const v=[LQ,jM].includes(g);h[Ef].style.display=v?"":Vt}},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[Tv].value||0,g=Jp(m)?parseInt(m):0,v=iA(t,r),y=Math.max(Ni.nextPowerOf2(v),512),b=KEe(2,y)(m);f&&(f.disabled=!b);const{validGroupSizes:I}=We.getValidGroupSizes({drawSize:g,groupSizeLimit:8}),w=I.map(D=>({label:D,value:D})),T=h[Ef],S=I.includes(g)?4:I[0];Xs(T),c4(T,{options:w,value:S}),n({fields:p,inputs:h})},c=({e:p,fields:h})=>{const f=p.target.value;h&&(h[RS].style.display=f===WE?"":Vt,h[JA].style.display=f===WE?"":Vt)},u=({inputs:p})=>{const h=parseInt(p[Ef].value),f=p[RS].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?Ni.generateRange(h+1,g+1).reverse().forEach(v=>{p[RS].remove(v-2)}):g<h&&Ni.generateRange(g+1,h+1).forEach(v=>p[RS].add(new Option(v.toString(),v.toString())))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=Bn(4)(f);m&&(m.disabled=!g)};return[{onInput:({inputs:p})=>d({inputs:p,name:fI}),control:fI},{onInput:({inputs:p})=>d({inputs:p,name:aC}),control:aC},{onChange:u,control:Ef},{onChange:o,control:nh},{onChange:c,control:qE},{onInput:l,control:Tv},{onInput:s,control:XA}]}const{AD_HOC:Rst,COMPASS:Mst,CURTIS:Nst,DOUBLE_ELIMINATION:Ast,FEED_IN_CHAMPIONSHIP:_st,FEED_IN:kst,FIRST_MATCH_LOSER_CONSOLATION:Ost,FIRST_ROUND_LOSER_CONSOLATION:xst,LUCKY_DRAW:Lst,OLYMPIC:Fst,PLAY_OFF:Bst,ROUND_ROBIN:$st,ROUND_ROBIN_WITH_PLAYOFF:Vst,SINGLE_ELIMINATION:jst}=Wn;function ZEe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:Rst,hide:e},{label:"Compass",value:Mst,hide:e},{label:"Curtis consolation",value:Nst,hide:e},{label:"Double elimination",value:Ast,hide:t||e},{label:"Elimination: fed consolation",value:_st,hide:e},{label:"First match loser consolation",value:Ost,hide:e},{label:"First round loser consolation",value:xst,hide:e},{label:"Lucky",value:Lst,hide:t||e},{label:"Olympic",value:Fst,hide:e},{label:"Playoff",value:Bst,hide:e},{label:"Round robin w/ playoff",value:Vst,hide:t||e},{label:"Round robin",value:$st},{label:"Single elimination",value:jst},{label:"Staggered Entry",value:kst,hide:t||e}]}const{POLICY_TYPE_SCORING:Gst}=Cy,{MAIN:Hst}=Wn,zst={[Gst]:{requireAllPositionsAssigned:!1,stage:{[Hst]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"},{description:"Aggregate Points - Four 10 minute quarters",matchUpFormat:"SET4-S:T10P"}]}},{ROUND_ROBIN:qst,ROUND_ROBIN_WITH_PLAYOFF:FQ,SINGLE_ELIMINATION:Wst,QUALIFYING:Yst,MAIN:BQ}=Wn,{DOMINANT_DUO:Kst,COLLEGE_DEFAULT:Zst,LAVER_CUP:Xst}=So.tieFormatConstants,{POLICY_TYPE_SCORING:Jst}=Cy,{TEAM:$Q}=ll,{ENTRY_PROFILE:Qst}=So.extensionConstants;function eot({event:t,drawId:e,isQualifying:i,structureId:r}){const n=i?Yst:BQ,a=t.drawDefinitions?.length||0,s=Wst,o=e&&t.drawDefinitions?.find(S=>S.drawId===e),l=r&&We.getPositionAssignments({drawId:e,structureId:r})?.positionAssignments,c=We.findExtension({element:o,name:Qst})?.extension?.value,u=r?1:0,d=!r&&c?.[BQ]?.qualifiersCount||u,p="Qualifying",h=l?.length||Ni.nextPowerOf2(iA(t,n)),f=Math.max(h,512),m=[{label:"Custom",value:ZA}].concat(zst[Jst].matchUpFormats.map(({matchUpFormat:S,description:D})=>({selected:S==="SET3-S:6/TB7",value:S,label:D}))),g=[{label:"Dominant Duo",value:Kst,selected:!0},{label:"College Default",value:Zst},{label:"Laver Cup",value:Xst},{label:"Custom",value:ZA}],{validGroupSizes:v}=We.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),y=v.map(S=>({label:S,value:S})),b=[{label:"Group winners",value:h2e},{label:"Group positions",value:uhe},{label:"Top finishers",value:WE}],I=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],w=[{label:Cc,value:Cc,selected:!r,disabled:!!r},{label:k3,value:!1,selected:r}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:Bn(4),label:"Structure name",value:p,field:aC,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:Bn(4),selectOnFocus:!0,hide:i,label:"Draw name",field:fI,focus:!0},{options:ZEe({isQualifying:i}),label:"Draw Type",field:nh,value:s},{error:`Must be in range 2-${f}`,validator:KEe(2,f),selectOnFocus:!0,label:"Draw size",value:h,field:Tv},{visible:[qst,FQ].includes(s),options:y,label:"Group size",field:Ef,value:4},{visible:[FQ].includes(s),options:b,label:"Playoff Type",field:qE},{label:"Advance per group",options:I,field:RS,visible:!1},{label:"2nd playoff from remaining",field:JA,id:JA,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:w,label:"Creation",field:Cc,value:""},{hide:t.eventType===$Q,options:m,field:Q3,label:"Score format",value:""},{hide:t.eventType!==$Q,options:g,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!r,validator:Jp,field:XA,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function VQ({eventId:t,drawOptions:e,callback:i}){const r=ai.scales[ai.activeScale?.toLowerCase()],n={scaleAccessor:r?.accessor,scaleName:r?.scaleName},a=We.generateDrawDefinition({...e,...n,ignoreStageSpace:!0});if(a.success){const s=a.drawDefinition;qt({methods:[{method:yYe,params:{eventId:t,drawDefinition:s,allowReplacement:!0}}],callback:c=>Pt(i)&&i({drawDefinition:s,...c})})}else a.error&&$t({message:a.error?.message||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:tot}=Cy,{SEPARATE:iot}=Wn,{SEEDING:rot}=$U,XEe={[tot]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:iot,policyName:rot,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:not,FEED_IN:aot,LUCKY_DRAW:sot,MAIN:oot,QUALIFYING:lot,ROUND_ROBIN:jQ,ROUND_ROBIN_WITH_PLAYOFF:GQ}=Wn,{TIME_TENNIS_PRO_CIRCUIT:cot}=So.tieFormatConstants,{DIRECT_ENTRY_STATUSES:HQ}=Ju,{POLICY_TYPE_ROUND_NAMING:uot}=Cy;function zQ({drawName:t,matchUpFormat:e,isQualifying:i,structureId:r,callback:n,inputs:a,drawId:s,event:o}){const l=a[nh].options[a[nh].selectedIndex].getAttribute("value"),c=e||a[Q3]?.value,u=a[aC]?.value,d=a.tieFormatName?.value,p=a[fI]?.value,h=a[Tv].value||0,f=Number.parseInt(a[Ef].value),m=Ni.isConvertableInteger(h)&&Number.parseInt(h),g=[sot,aot,jQ,GQ].includes(l)&&m||Ni.nextPowerOf2(m),v=o.entries.filter(({entryStage:R,entryStatus:M})=>R===lot&&HQ.includes(M)),y=i&&v.length?v:o.entries.filter(({entryStage:R,entryStatus:M})=>(!R||R===oot)&&HQ.includes(M)),b=g<y.length?!1:a[Cc].value===Cc,I=o.eventId,w={drawEntries:y,automated:b,eventId:I,drawId:s},T=Number.parseInt(a.advancePerGroup?.value||0),S=a[JA]?.checked,D=a[qE]?.value;let C;if(l===GQ){const R=[];if(D===WE){const M=[Ni.generateRange(1,T+1)];if(S){const A=Ni.generateRange(T+1,f+1);A.length&&M.push(A)}M.forEach((A,N)=>{R.push({structureName:`Playoff ${N+1}`,finishingPositions:A})})}else D===uhe&&Ni.generateRange(1,f+1).forEach(M=>{R.push({structureName:`Playoff ${M}`,finishingPositions:[M]})});C={groupSize:f},R.length&&(C.playoffGroups=R)}else l===jQ?C={groupSize:f}:l===not&&Object.assign(w,{roundsCount:1});const E=We.getSeedsCount({participantsCount:y?.length,policyDefinitions:XEe,drawSizeProgression:!0})?.seedsCount,P=Jp(a[XA].value)&&Number.parseInt(a[XA]?.value)||0;if(r){const R=We.generateQualifyingStructure({qualifyingPositions:P,targetStructureId:r,structureOptions:C,matchUpFormat:c,structureName:u,automated:b,drawSize:g,drawType:l,drawId:s});if(R.success){const M=[{method:RYe,params:{structure:R.structure,link:R.link,eventId:I,drawId:s}}];qt({methods:M,callback:N=>{Pt(n)&&n({...R,...N.results?.[0]})}})}return}if(i?(w.drawName=t,w.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:P,structureOptions:C,matchUpFormat:c,structureName:u,seedsCount:E,drawSize:g,drawType:l}]}]):(P&&(w.qualifiersCount=P,w.qualifyingPlaceholder=!0),Object.assign(w,{seedingScaleName:I,structureOptions:C,matchUpFormat:c,seedsCount:E,drawName:p,drawSize:g,drawType:l})),m)if(d===ZA)kEe({title:"Custom scorecard",tieFormat:void 0,onClose:M=>{M&&(w.tieFormat=M,VQ({drawOptions:w,eventId:I,callback:n}))}});else{if(w.tieFormatName=d,d===cot){const R={[uot]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};w.policyDefinitions={...R}}VQ({drawOptions:w,eventId:I,callback:n})}else $t({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function wU({eventId:t,callback:e,drawId:i,drawName:r,structureId:n,isQualifying:a}){const s=We.getEvent({eventId:t}).event;if(!s)return;const{items:o,structurePositionAssignments:l}=eot({event:s,drawId:i,isQualifying:a,structureId:n}),c=Cst({maxQualifiers:l?.length,isQualifying:a,event:s});let u;const d=v=>{u=pn(v,o,c)},p=()=>a?Bn(4)(u[aC].value):Bn(4)(u[fI].value),f=[{label:"Cancel",intent:Vt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{p()?u.matchUpFormat?.value===ZA?KF({callback:y=>{y&&zQ({event:s,inputs:u,callback:e,structureId:n,matchUpFormat:y,drawId:i,drawName:r,isQualifying:a})},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}}):zQ({event:s,inputs:u,callback:e,structureId:n,drawId:i,drawName:r,isQualifying:a}):$t({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>Ww(v,f,y);ht.drawer.open({title:m,content:d,footer:g,side:Xt,width:"300px"})}const a$={high:[80,100],medium:[60,80],low:[40,60]},{ratingsParameters:dot}=fg,qQ=t=>(e,i)=>{const r=dot[t];if(!r)return 0;const{accessor:n,ascending:a}=r,s=!a,o=WQ(e),l=WQ(i);if(o<l)return 1;if(l<o)return-1;const c=e?.[n]||0,u=i?.[n]||0;return s?c-u:u-c};function WQ(t){const e=rk(t.confidence??100);return e==="high"&&100||e==="medium"&&80||e==="low"&&60||0}function rk(t){return parseInt(t.toString())>=a$.high[0]?"high":parseInt(t.toString())>=a$.medium[0]?"medium":parseInt(t.toString())>=a$.low[0]?"low":"unrated"}const{ratingsParameters:pot}=fg,YQ=t=>e=>{const i=pot[t],{accessor:r}=i,n=e.getValue(),a=n?.confidence??100,s=n?.[r],o=rk(a),l=document.createElement("span"),c={medium:"darkgreen",low:"lightblue",high:"blue"};return l.style.color=c[o],l.innerHTML=s??"",l},{SINGLES:hot}=ll,fot=t=>e=>{e.getColumn().getDefinition();const i=document.createElement("div");i.className="tags";const r=o=>t({...o,renderDraw:!0}),n=e.getValue(),a=e.getRow().getData(),{participantId:s}=a;return n?.forEach(o=>{const l=mot({flight:o,flightClick:r});i.appendChild(l)}),i};function mot({flight:t,flightClick:e}){const i=document.createElement("span");return Pt(e)&&e&&(i.onclick=()=>e(t)),i.className="tag event-pill",t.gender?.toLowerCase().includes("female")?i.classList.add("is-danger"):t.gender?.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===hot&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:got,QUALIFYING:s$}=Wn,{DIRECT_ACCEPTANCE:KQ}=Ju;function JEe({participantIds:t,group:e,eventId:i,drawId:r,callback:n}){qt({methods:[{method:FUe,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===od&&KQ||e===s$&&KQ||e,entryStage:e===s$?s$:got,eventId:i,drawId:r}}],callback:n})}const{ALTERNATE:ZQ,DIRECT_ACCEPTANCE:XQ,WITHDRAWN:JQ,UNGROUPED:vot}=Ju,{QUALIFYING:QQ}=Wn,yot=(t,e,i)=>(r,n)=>{const{participant:a}=n.getRow().getData(),s=c=>()=>{const u=p=>{if(p.success){const h=n.getRow(),f=c===od?XQ:c;ht.tables[f]?.addRow(h.getData()),h.delete()}else console.log({result:p})},d=[a.participantId];JEe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},o=()=>{const c=We.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})},l=[{onClick:s(XQ),option:"Move to accepted",action:od},{onClick:s(QQ),option:"Move to qualifying",action:QQ},{onClick:s(ZQ),option:"Move to alternates",action:ZQ},{onClick:o,option:"Unpair players",action:vot},{onClick:s(JQ),option:"Withdraw participant",action:JQ}].filter(c=>t.includes(c.action));if(l.length){const c=r.target;nu({options:l,target:c,config:{placement:wp}})}},{WTN:o$,UTR:l$}=So.ratingConstants;function bot({entries:t,exclude:e=[],eventId:i,drawId:r,actions:n=[],drawCreated:a}={}){const s=t.find(p=>p.participant?.teams?.length),o=t.find(p=>p.ratings?.utr),l=t.find(p=>p.ratings?.wtn),c=t.find(p=>p.cityState),u=t.find(p=>p.seedNumber),d=t.find(p=>p.ranking);return[{cellClick:(p,h)=>h.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({}),formatter:"rownum",headerSort:!1,hozAlign:ui,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:li,resizable:!1,width:50},{formatter:p=>Yw(void 0)(p,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!d,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{formatter:YQ(o$),sorter:qQ(o$),visible:!!l,field:"ratings.wtn",resizable:!1,title:o$,width:70},{formatter:YQ(l$),sorter:qQ(l$),visible:!!o,field:"ratings.utr",resizable:!1,title:l$,width:70},{sorter:(p,h)=>p?.[0]?.participantName?.localeCompare(h?.[0]?.participantName),formatter:qDe(()=>console.log("boo")),field:"participant.teams",visible:!!s,title:"Teams",responsive:!1,resizable:!1,minWidth:100},{visible:!!c,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:lG({maxValue:t?.length||0,decimals:!1,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!u,field:"seedNumber",hozAlign:li,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:fot(Fn),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:yot(n,i||"",r),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,maxWidth:40}].filter(({field:p})=>Array.isArray(e)&&!e?.includes(p||""))}function QEe(){const t=We.getTournament().tournamentRecord.tournamentId,e=`/${Es}/${t}/${Qp}`;ht.router.navigate(e)}function ePe(t,e){YD({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:Iot}=$U;function tPe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:r}){qt({methods:[{method:GYe,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:Iot},scaleBasis:{scaleType:e},eventId:i}}}],callback:s=>{s.success&&Pt(r)&&r&&r()}})}const{QUALIFYING:eee}=Wn,{SEEDING:wot,MANUAL:Sot}=$U;function iPe({event:t,rows:e,callback:i}){const{eventId:r,eventType:n}=t,a=e.map(({entryStage:s,participantId:o,seedNumber:l})=>{const c=s===eee?`${r}${eee}`:r;return{participantId:o,scaleItems:[{scaleValue:l,scaleType:wot,scaleName:c,eventType:n}]}});tPe({scaleItemsWithParticipantIds:a,scaleBasis:Sot,eventId:r,callback:i})}function rPe({table:t}){const e=t.getRows();let i;for(const r of e){const n=r.getData();i=n.entryStage,n.seedNumber=void 0,r.update(n)}return i}function Tot({event:t,table:e}){rPe({table:e});const i=e.getData();iPe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:Uot}=Ju,{QUALIFYING:tee}=Wn,iee=t=>e=>{const i=t?.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:Xt,label:"Cancel",visible:!1,onClick:n=>{ePe(n,e);const a=rPe({table:e}),s=We.getEvent({eventId:i})?.event,l=(s.entries?.filter(f=>f.entryStage===a&&f.entryStatus===Uot)).map(({participantId:f})=>f),{participants:c}=We.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=a===tee?`${i}${tee}`:i,d=c.map(f=>{const m=f?.seedings?.[s.eventType]?.find(g=>g.scaleName===u)?.scaleValue;if(m)return{participantId:f.participantId,seedNumber:m}}).filter(Boolean),p=Object.assign({},...d.map(f=>({[f.participantId]:f}))),h=e.getRows();for(const f of h){const m=f.getData(),g=m.participantId;p[g]&&(m.seedNumber=p[g].seedNumber,f.update(m))}}}};function Dot(t,e){YD({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t}),e.showColumn("seedNumber"),e.redraw(!0)}const{QUALIFYING:GM,MAIN:Eot}=Wn,{SEEDING:Pot,RATING:Cot}=$U,{ratingsParameters:ree}=fg;function Rot({event:t,group:e,table:i,field:r}){const{eventId:n,eventType:a}=t,{seedsCount:s,stageEntries:o}=We.getEntriesAndSeedsCount({stage:e===GM?GM:Eot,policyDefinitions:XEe,eventId:n}),[l,c]=r.split("."),u=c?!ree[c.toUpperCase()].ascending:!1,d=ree[c.toUpperCase()].accessor,p=D=>D.ratings?.[c]||{confidence:0,[d]:1/0},h=D=>p(D)?.[d]||0,f=(D,C)=>(l==="ratings"&&u?h(D)-h(C):h(C)-h(D))||D-C,m=i.getData(),g={high:[],medium:[],low:[]};let v=0;for(const D of m){const C=p(D);C[d]&&(v+=1);const E=C.confidence??100;rk(E)==="high"?g.high.push(D):rk(E)==="medium"?g.medium.push(D):g.low.push(D)}const b=(Pt(f)&&[].concat([...g.high].sort(f),[...g.medium].sort(f),[...g.low].sort(f))||[]).slice(0,Math.min(v,s)),I=e===GM?`${n}${GM}`:n,w={scaleType:Pot,scaleName:I,eventType:a},{scaleItemsWithParticipantIds:T}=We.generateSeedingScaleItems({scaleAttributes:w,scaledEntries:b,stageEntries:o,seedsCount:s,scaleName:I});tPe({scaleItemsWithParticipantIds:T,scaleBasis:Cot,eventId:n,callback:()=>{const D=Object.assign({},...b.map((E,P)=>({[E.participantId]:P+1}))),C=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const E of C){const P=E.getData(),R=D[P.participantId];P.seedNumber=R,E.update(P)}}})}const nee=(t,e)=>i=>{const r={ranking:"Seed by ranking","ratings.wtn":"Seed by WTN","ratings.utr":"Seed by UTR"},n=i.getColumns().map(s=>s.getDefinition()).filter(s=>["ratings.wtn","ratings.utr"].includes(s.field)),a=[{label:"Manual seeding",onClick:s=>Dot(s,i),close:!0},{label:"Clear seeding",onClick:()=>Tot({event:t,table:i}),close:!0}].concat(...n.map(s=>({onClick:()=>Rot({event:t,group:e,table:i,field:s.field}),label:r[s.field],value:s.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:Xt,align:Xt,options:a}},Mot=(t,e,i,r)=>{const a=t.getSelectedData().filter(u=>!u.events?.length).map(({participantId:u})=>u),[s,o]=e.split(".");qt({methods:[{method:FUe,params:{ignoreAssignment:!0,participantIds:a,entryStatus:o,entryStage:s,eventId:i,drawId:r}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const h=p.getData();a.includes(h.participantId)&&(h.status=che[o],p.update(h))}}else console.log(u.error)}})},Not=(t,e,i)=>r=>{const n=t.map(a=>({onClick:()=>Mot(r,a,e,i),label:a,value:a,close:!0}));return{location:ya,label:"Change status",options:n}},Aot=(t,e=0)=>{const i=`${t} <span class='${Xpe}'>${e}</span>`;return{location:YA,text:i}},xS=({target:t,table:e,close:i})=>{if(!t)return;const r=Fl(t,Sb);if(r){const n=r.getElementsByClassName("toggle")?.[0],a=r.getElementsByClassName(ahe)?.[0],s=r.getElementsByClassName(she)?.[0];if(n){const o=i||n.innerHTML.charCodeAt(0)===9660;a.style.display=o?Vt:LT,s.style.display=o?Vt:LT,n.parentNode.innerHTML=`<span class='toggle' style='color: white'>${o?tEe:m9}</span>`,o||e.redraw(!0)}}},_ot=t=>{const e=i=>xS({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${m9}</span>`,location:YA,onClick:e}},bE=({heading:t,count:e})=>[Aot(t,e),i=>_ot(i)],kot=(t,e,i)=>(r,n="Search participants")=>{let a,s;const o=l=>{const c=hU(r.element,"tableClass");if(c){const u=Eg(c,"controlBar")?.[0];if(u){const d=Eg(u,"search");Array.from(d).forEach(p=>p.value=l)}}a=r.getSelectedData().map(u=>u[e]),r.removeFilter(s),s=u=>u.searchText?.includes(l?.toLowerCase())||a?.length&&a.includes(u[e]),l&&r.addFilter(s)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&o(""),(l.key==="Enter"||l.keyCode===13)&&Pt(i)&&i&&i(r)&&o("")},onChange:l=>o(l.target.value),onKeyUp:l=>o(l.target.value),location:t||ui,class:"search",search:!0,placeholder:n}},aee=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:Xt,visible:!1,onClick:r=>{ePe(r,e);const n=e.getData();iPe({event:t,rows:n})}}),{UNGROUPED:see}=Ju,{DOUBLES:Oot}=ll,xot=(t,e)=>i=>{const r=n=>{const a=n.getSelectedData(),s=a.filter(c=>!c.events?.length).map(({participantId:c})=>c);qt({methods:[{method:kYe,params:{removeGroupParticipant:!0,participantIds:s,eventId:t,drawId:e}}],callback:c=>{if(c?.error)n.deselectRow(),$t({message:c.error[0]?.message??"Error destroying pair",intent:"is-danger"});else{n.deleteRow(s);const d=hU(n.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];d&&setTimeout(()=>o9({target:d})(),100);const p=a.flatMap(({participant:m})=>m?.individualParticipantIds),{participants:h}=We.getParticipants({participantFilters:{participantIds:p}}),f=h.map(m=>p2({entry:{participantId:m.participantId,entryStatus:see},eventType:Oot,participant:m}));ht.tables[see].updateOrAddData(f)}}})};return{onClick:()=>r(i),label:"Destroy pairs",intent:"is-danger",location:ya}},Lot=(t,e)=>{const r=t.getSelectedData().map(({participantId:o})=>o),n=e.entries.filter(({participantId:o})=>r.includes(o)),a=[{method:vYe,params:{eventId:e.eventId,drawName:"Flight",drawEntries:n}}];qt({methods:a,callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},Fot=(t,e)=>i=>({onClick:()=>Lot(i,t),label:"Add flight",location:ya,hide:e}),Bot=(t,e,i,r)=>{const a=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);JEe({participantIds:a,group:e,eventId:i,drawId:r,callback:o=>{if(o?.success){const c=t.getData().filter(({participantId:u})=>a.includes(u));ht.tables[e].updateOrAddData(c),t.deleteRow(a)}else t.deselectRow(),$t({message:o.error.message??"Error moving participants",intent:"is-danger"})}})},HM=(t,e,i)=>r=>{const n=t.map(a=>({onClick:()=>Bot(r,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:ya,options:n}},{ASSIGN_PARTICIPANT:$ot}=sw,c$=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:Xt,onClick:()=>{const{entries:n=[],eventId:a,eventType:s}=t,o=(n||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=We.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!o.includes(p.participantId));X0({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!p?.length)return;const h=p.map(({participantId:y})=>y),f=e===wR?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";qt({methods:[{params:{eventId:a,participantIds:h,entryStatus:m,entryStage:f},method:j8}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=We.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),w=h.map(T=>p2({entry:{participantId:T,entryStage:f,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:s,eventId:a}));i.addRow(w)}}})},action:{type:$ot,participantsAvailable:c}})}}),{ALTERNATE:u$,UNGROUPED:Vot}=Ju,{MAIN:jot}=Wn,{DOUBLES:oee}=ll,Got=(t,e=!0)=>{const{eventId:i,eventType:r,gender:n}=t,a=(l,c)=>{const u=c.getSelectedData().map(m=>m.participantId);if(u.length!==2)return;const p=[Ni.UUID()],h=[{method:TYe,params:{participantIdPairs:[u],allowDuplicateParticipantIdPairs:!0,entryStatus:u$,entryStage:jot,eventId:i,uuids:p}}];qt({methods:h,callback:m=>{if(m.success){c.deleteRow(u),c.clearFilter();const g=hU(c.element,"tableClass");if(g){const b=Eg(g,"controlBar")?.[0];if(b){const I=Eg(b,"search");Array.from(I).forEach(w=>w.value="")}}const v=m.results[0].newParticipantIds,{participants:[y]}=We.getParticipants({participantFilters:{participantIds:v},withIndividualParticipants:!0,withISO2:!0});if(y){const b=p2({entry:{participantId:y.participantId,entryStatus:u$},eventType:oee,participant:y});ht.tables[u$].updateOrAddData([b]);const w=hU(l.target,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0];w&&setTimeout(()=>o9({target:w})(),100)}else console.log("participant not found",{participantIds:v,methods:h,result:m})}else m.error?.code==="ERR_INVALID_PARTICIPANT_IDS"?($t({intent:"is-danger",message:n==="MIXED"?"Genders must be mixed":"Invalid pairing"}),c.deselectRow()):console.log({methods:h,result:m})}})};return{createPairButton:{hide:r!==oee,label:"Create pair",onClick:a,intent:"is-info",location:ya,id:"create-pair",visible:!1},createPairFromSelected:l=>{const c=l?.length===2;if(c&&e){const u=ht.tables[Vot];a({target:u.element},u)}else{const u=document.getElementById("create-pair");u&&(u.style.display=c?"":Vt)}}}},{DIRECT_ACCEPTANCE:Hot}=Ju,{MAIN:zot}=Wn,qot=(t,e,i)=>{const n=t.getSelectedData().filter(o=>!o.events?.length).map(({participantId:o})=>o);qt({methods:[{method:bYe,params:{entryStatus:Hot,ignoreStageSpace:!0,entryStage:zot,participantIds:n,eventId:e,drawId:i}}],callback:o=>{o.success?t.deselectRow():console.log(o.error)}})},Wot=(t,e)=>i=>{const r=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:n,drawId:a})=>({onClick:()=>qot(i,t.eventId,a),stateChange:!0,label:n,value:a,close:!0}));return{hide:!t.drawDefinitions?.length||e,label:"Add to draw",location:ya,options:r}},{DIRECT_ACCEPTANCE:Yot,ALTERNATE:yf,UNGROUPED:lee,WITHDRAWN:bf}=Ju,{MAIN:TS,QUALIFYING:pv}=Wn,{SINGLES:Kot,DOUBLES:cee}=ll;function Zot({drawDefinition:t,event:e,entryData:i,hasFlights:r}){const n=v=>i.filter(({entryStage:y=TS,entryStatus:b})=>v.includes(`${y}.${b}`)),a=!!t,s=t?.drawId,o=e?.eventId,l={[od]:[yf,bf],[pv]:[od,yf,bf],[yf]:[od,pv,bf],[bf]:[yf]},{createPairFromSelected:c}=Got(e),u=r?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);return y.length===1?(v.selectRow(b),!0):(y.length===2&&v.selectRow(b),!1)},p=n(ik(TS)),h=n([`${pv}.${Yot}`]),f=n([`${TS}.${yf}`]),m=n([`${TS}.${lee}`]),g=n([`${TS}.${bf}`]);return[{placeholder:"No accepted participants",items:[HM(l[od],o,s),Not(ik(TS),o,s),Wot(e,s),Fot(e,s),...bE({heading:"Accepted",count:p.length}),!a&&nee(e,od),iee(e),aee(e),!a&&c$(e,od)],actions:l[od],anchorId:L3,entries:p,group:od,excludeColumns:u,drawCreated:a,togglePanel:xS},{placeholder:"No qualifying participants",items:[...bE({heading:"Qualifying",count:h.length}),HM(l[pv],o,s),!a&&nee(e,pv),iee(e),aee(e),!a&&c$(e,pv)],actions:[od,yf,bf],anchorId:B3,entries:h,group:pv,excludeColumns:u,drawCreated:a,togglePanel:xS},{items:[...bE({heading:"Alternates",count:f.length}),HM(l[yf],o,s),e?.eventType===cee&&xot(o,s),!a&&c$(e,yf)],actions:[od,pv,bf],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:F3,entries:f,group:yf,drawCreated:a,togglePanel:xS},{hide:!!([Kot].includes(e?.eventType)||a),items:[...bE({heading:"Ungrouped",count:m.length}),kot(ui,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:e?.eventType===cee&&c,anchorId:$3,entries:m,actions:[bf],group:lee,drawCreated:a,togglePanel:xS},{items:[...bE({heading:"Withdrawn",count:g.length}),!a&&HM(l[bf],o,s)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:V3,entries:g,actions:[yf],hide:a,group:bf,collapsed:!0,drawCreated:a,togglePanel:xS}]}function uee({eventId:t,drawId:e,headerElement:i}){(!t||t==="undefined")&&ht.router.navigate("/");let r;const n=l=>{r&&Object.values(ht.tables).forEach(u=>u.removeFilter(r));const c=l?.toLowerCase();r=u=>u.searchText?.includes(c),l?Object.values(ht.tables).forEach(u=>u.addFilter(r)):r=void 0},a=()=>{const{event:l,drawDefinition:c}=We.getEvent({eventId:t,drawId:e});if(i&&(i.innerHTML=l?.eventName),!l)return{error:"EVENT_NOT_FOUND"};const{participants:u,derivedDrawInfo:d}=We.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},p=l?.drawDefinitions?.length>1,h=l.category?.categoryName??l.category?.ageCategoryCode,f=(c?.entries||l?.entries||[]).map(g=>p2({eventType:l.eventType,derivedDrawInfo:d,categoryName:h,participants:u,eventId:t,entry:g})),{events:m}=We.getEvents();return{tableData:Zot({event:l,drawDefinition:c,entryData:f,hasFlights:p}),events:m,event:l}},s=l=>{for(const c of l){const{entries:u,group:d,anchorId:p,placeholder:h,excludeColumns:f,actions:m,drawCreated:g}=c,v=document.getElementById(p);if(v){v.style.display=c.hide?Vt:LT,Xs(v);const y=document.createElement("div");y.className=`${d2e} flexcol flexcenter`,v.appendChild(y);const b=document.createElement("div");b.className=`${she} flexcol flexcenter`,v.appendChild(b);const I=new ks(b,{headerSortElement:af(["ratings.utr","ratings.wtn","seedNumber","ranking","cityState","status","flights"]),columns:bot({actions:m,exclude:f,entries:u,eventId:t,drawId:e,drawCreated:g}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:u,placeholder:h});ht.tables[d]=I;const w=Fl(v,Sb);I.on("tableBuilt",()=>{const T=c.items?.map(S=>Pt(S)?S(I):S);bo({target:y,table:I,items:T,onSelection:c.onSelection}),!u.length&&c.togglePanel&&c.togglePanel({target:w,table:I,close:!0})}),I.on("dataChanged",()=>{const D=hU(I.element,"tableClass")?.parent?.getElementsByClassName("controlBar")?.[0]?.getElementsByClassName(Xpe)?.[0],C=I.getData().length;c.togglePanel&&!C&&c.togglePanel({target:w,table:I,close:!0}),D&&(D.innerHTML=C||0)})}}},o=a();if(!o.error){const l="All entries",c=document.getElementById(SR)||void 0,u={label:l,onClick:()=>Fn({eventId:t}),close:!0},d=(o.event.drawDefinitions||[]).map(w=>({onClick:()=>Fn({eventId:t,drawId:w.drawId}),label:w?.drawName,close:!0})).concat([{divider:!0},u]),p={label:mg,onClick:QEe,close:!0},h=o.events.map(w=>({onClick:()=>Fn({eventId:w.eventId}),label:w.eventName,close:!0})).concat([{divider:!0},p]),f=w=>{w.success&&Fn({eventId:t,drawId:w.drawDefinition?.drawId,renderDraw:!0})},m={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>wU({eventId:t,callback:f})},g=o.event.drawDefinitions?.map(w=>({onClick:()=>Fn({eventId:t,drawId:w?.drawId,renderDraw:!0}),label:w?.drawName,close:!0})).concat([{divider:!0},m]),v=o.event?.drawDefinitions?.find(w=>w?.drawId===e)?.drawName,y=({eventId:w})=>{console.log("generateFlights",{eventId:w})},b=WEe({eventId:t})?.length?"is-success":Vt,I=[{onKeyDown:w=>w.keyCode===8&&w.target.value.length===1&&n(""),onChange:w=>n(w.target.value),onKeyUp:w=>n(w.target.value),clearSearch:()=>n(""),placeholder:"Search entries",location:ui,search:!0},{label:o.event.eventName,options:h.length>1&&h,location:ui},{label:v||l,options:d,location:ui},{onClick:()=>Fn({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:Xt,hide:!e},{onClick:()=>YEe({eventId:t}),intent:b,id:"editAvoidances",label:"Avoidances",location:Xt},{onClick:()=>y({eventId:t}),label:"Flights",location:Xt,hide:e,intent:Vt},{options:g?.length>2&&g,hide:(g?.length||0)<3||e,intent:"is-info",location:Xt,label:"Draws",align:Xt},{onClick:()=>wU({eventId:t,callback:f}),hide:g?.length>2||e,intent:"is-info",label:"Add draw",location:Xt}];bo({target:c,items:I}),o.tableData&&s(o.tableData)}}function Xot({drawId:t,callback:e}){const i=We.getEvent({drawId:t})?.drawDefinition?.structures;if(!i?.length)return;const r=i.map(({structureName:c,structureId:u},d)=>({text:`${c}:`,fieldPair:{error:"minimum 4 characters",validator:Bn(4),placeholder:c,focus:d===0,field:u,id:u}}));let n;const a=()=>{const c=i.map(({structureId:p})=>n[p]?.value&&{structureId:p,structureName:n[p].value.trim()}).filter(Boolean);qt({methods:[{params:{drawId:t,structureDetails:c},method:$Ue}],callback:p=>{p.success&&($t({message:"Structure renamed",intent:"is-success"}),Pt(e)&&e&&e())}})},s=()=>{const c=i.map(({structureId:h})=>n[h]?.value).filter(Boolean),u=c.every(Bn(4)),d=document.getElementById("renameStructures"),p=c.length&&u;d&&(d.disabled=!p)},o=i.map(({structureId:c})=>({control:c,onInput:s}));Kr({title:"Edit structure names",content:c=>n=pn(c,r,o),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}function Jot({drawId:t,structure:e,callback:i}){const n=Object.values(e.roundMatchUps).flat().reduce((d,p)=>{const{structureName:h,structureId:f}=p;return d[f]||(d[f]={structureName:h,structureId:f}),d},{}),a=Object.values(n).map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:Bn(4),placeholder:d,field:p,id:p}}));let s;const o=()=>{const d=Object.values(n).map(({structureId:f})=>s[f]?.value&&{structureId:f,structureName:s[f].value.trim()}).filter(Boolean);qt({methods:[{params:{drawId:t,structureDetails:d},method:$Ue}],callback:f=>{f.success&&($t({message:"Groups renamed",intent:"is-success"}),Pt(i)&&i&&i(f))}})},l=()=>{const d=Object.values(n).map(({structureId:m})=>s[m]?.value).filter(Boolean),p=d.every(Bn(4)),h=document.getElementById("renameGroups"),f=d.length&&p;h&&(h.disabled=!f)},c=Object.values(n).map(({structureId:d})=>({control:d,onInput:l}));Kr({title:"Edit group names",content:d=>s=pn(d,a,c),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Rename",id:"renameGroups",disabled:!0,intent:"is-info",close:!0,onClick:o}]})}const{ROUND_ROBIN:dee,SINGLE_ELIMINATION:Qot}=Wn;function elt({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:r}){const n=S=>`finishingPosition-${S}`,a=r.map(({finishingPosition:S,finishingPositionRange:D})=>({field:n(S),id:n(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${D}`,width:"400px"}}));if(!a||a.length<1){$t({message:"No playoff positions available",intent:"is-danger"});return}const s={value:KA,label:"Playoff name",field:"structureName",id:"structureName"},o=ZEe({isPlayoff:!0}),l={value:Qot,options:o,label:"Draw type",field:nh,id:nh},{validGroupSizes:c}=We.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(S=>({label:S,value:S})),label:"Group size",field:Ef,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[s,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const D=r.filter(({finishingPosition:A})=>g[n(A)]?.checked).map(({finishingPosition:A})=>A),C=g.structureName.value,E=g[nh].value,P={finishingPositions:D,structureName:C,drawType:E};if(E===dee){const A=parseInt(g[Ef].value);P.structureOptions={groupSize:A}}qt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[P],playoffStructureNameBase:KA},method:OUe}],callback:A=>{A.success?($t({message:"Structure added",intent:"is-success"}),Pt(t)&&t&&t()):(console.log({result:A}),$t({message:A.error?.message||"Error",intent:"is-danger"}))}})},y=S=>`${Math.min(...S)}-${Math.max(...S)}`,b=()=>{const S=r.filter(({finishingPosition:V})=>g[n(V)]?.checked).map(({finishingPositions:V})=>V).flat(),D=r.map(({finishingPosition:V})=>g[n(V)].checked),C=r.map(({finishingPosition:V})=>g[n(V)].checked&&V).filter(Boolean),E=C.map((V,F)=>(C[F+1]||V)-V).every(V=>V<2),P=D.filter(Boolean).length,R=document.getElementById("addStructure"),M=P&&E;R&&(R.disabled=!M);const A=document.getElementById("selectedPlayoffRange");if(A){const V=M?y(S):"None";A.innerHTML=`${p} ${V}`}const{validGroupSizes:N}=We.getValidGroupSizes({drawSize:S?.length||4,groupSizeLimit:8}),k=N.map(V=>({label:V,value:V})),x=g[Ef],O=N.includes(4)?4:N[0];Xs(x),c4(x,{options:k,value:O})},I=({e:S,fields:D})=>{const C=S.target.value,E=[dee].includes(C);D[Ef].style.display=E?"":Vt},w=r.map(({finishingPosition:S})=>({control:n(S),onChange:b})).concat([{onChange:I,control:nh}]);Kr({title:"Add playoff structure",content:S=>g=pn(S,m,w),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function tlt({drawId:t,structureId:e,callback:i}){const r=We.getAvailablePlayoffProfiles({drawId:t,structureId:e}),n=f=>f.finishingPositions.reduce((m,g)=>(m||0)+(g||0));if(!r.playoffRoundsRanges&&r.finishingPositionsAvailable?.length)return elt({...r,drawId:t,structureId:e,callback:i});const a=r.playoffRoundsRanges?.sort((f,m)=>n(f)-n(m)).map(({finishingPositionRange:f})=>({label:f,field:f,id:f,checkbox:!0,fieldPair:{field:`${f}-name`,placeholder:`${KA} ${f}`,id:`${f}-name`,width:"350px"}}));if(!a||a.length<1){$t({message:"No playoff positions available",intent:"is-danger"});return}const s=f=>{a.forEach(({label:m,fieldPair:g})=>{const v=document.getElementById(g.id);v&&(v.placeholder=`${f} ${m}`)})},l=[{onChange:f=>s(f.target.value),onKeyDown:f=>f.key==="Tab"&&s(f.target.value),value:KA,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let c;const u=()=>{const f=r.playoffRoundsRanges.filter(I=>c[I.finishingPositionRange]?.checked),m=c.nameBase.value,g={},v=f.map(({roundNumber:I,finishingPositionRange:w})=>{const T=c[`${w}-name`]?.value;return T&&(g[`0-${I}`]={name:T}),{[I]:1}});qt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:g,roundProfiles:v,playoffStructureNameBase:m},method:OUe}],callback:I=>{I.success?($t({message:"Structure(s) added",intent:"is-success"}),Pt(i)&&i&&i()):$t({message:I.error?.message||"Error",intent:"is-danger"})}})},d=()=>{const f=r.playoffRoundsRanges.filter(g=>c[g.finishingPositionRange]?.checked),m=document.getElementById("addStructure");m&&(m.disabled=!f.length)},p=r.playoffRoundsRanges.map(({finishingPositionRange:f})=>({control:f,onChange:d}));Kr({title:"Add playoff structures",content:f=>c=pn(f,l,p),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:ilt,CONTAINER:rlt}=Wn;function nlt({drawData:t,eventId:e,structureId:i,updateControlBar:r}){const n=t.drawId,a=We.getAvailablePlayoffProfiles({drawId:n,structureId:i})?.playoffRounds?.length,s=We.isValidForQualifying({drawId:n,structureId:i})?.valid,o=()=>{wU({callback:u=>{if(u.success){const d=u.structure.structureId;Fn({eventId:e,drawId:n,structureId:d,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:n})},l=t.structures.find(u=>u.structureId===i),c=l?.structureType===rlt;return t.structures.sort((u,d)=>Ni.structureSort(u,d,{mode:ilt})).map(u=>({onClick:()=>{Fn({eventId:e,drawId:n,structureId:u.structureId,renderDraw:!0})},label:u.structureName,close:!0})).concat([{divider:!0},{onClick:()=>Xot({drawId:n,callback:()=>r(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>Jot({drawId:n,structure:l,callback:u=>console.log(u)}),label:"Edit group names",hide:!c,modifyLabel:!1,close:!0},{onClick:()=>o(),hide:!s,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>tlt({drawId:n,structureId:i,callback:()=>r(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const SU=(t,e)=>i=>(i||"").trim().split(" ").length>=t&&!0;function h2(t){const{eventData:e,drawIds:i,callback:r}=t,n=t.eventId??e.eventInfo.eventId;if(ai.skipReason){const h={auditReason:"Reason skipped"},f=i.map(g=>({params:{eventId:n,drawId:g,auditData:h,force:!0},method:KX}));qt({methods:f,callback:g=>r?r(g):Fn({eventId:n})});return}const a=i.length===1&&e?.drawsData?.find(h=>i.includes(h.drawId)).drawName,s=a?`Delete ${a}`:"Delete flights";let o;const l=()=>{const h={auditReason:o.drawDeletionReason.value},f=i.map(g=>({params:{eventId:n,drawId:g,auditData:h,force:!0},method:KX}));qt({methods:f,callback:g=>r?r(g):Fn({eventId:n})})},c=[{text:"Please provide a reason for draw deletion.",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"},{placeholder:"Explanation",field:"drawDeletionReason",validator:SU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"}],d=[{control:"drawDeletionReason",onInput:({inputs:h})=>{const f=h.drawDeletionReason.value,m=SU(5)(f),g=document.getElementById("deleteDraw");g&&(g.disabled=!m)}}];Kr({title:s,content:h=>o=pn(h,c,d),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:l}]})}function alt({eventData:t,drawIds:e}){const i=t.eventInfo.eventId,r=e.length===1&&t?.drawsData?.find(d=>e.includes(d.drawId)).drawName,n=r?`Delete ${r}`:"Delete flights";let a;const s=()=>{const d={auditReason:a.drawDeletionReason.value},p=e.map(f=>({params:{eventId:i,drawId:f,auditData:d},method:VYe}));qt({methods:p,callback:f=>f.success&&Fn({eventId:i,drawId:e[0]})})},o=[{text:"Please provide a reason for resetting draws.",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"},{placeholder:"Explanation",field:"drawDeletionReason",validator:SU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!",style:"height: 2.5em; padding-right: 1em; font-size: 0.9em;"}],c=[{control:"drawDeletionReason",onInput:({inputs:d})=>{const p=d.drawDeletionReason.value,h=SU(5)(p),f=document.getElementById("deleteDraw");f&&(f.disabled=!h)}}];Kr({title:n,content:d=>a=pn(d,o,c),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:s}]})}function slt({structureId:t,drawId:e}){const i=We.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;console.log({existingMatchUpFormat:i}),KF({callback:n=>{console.log({matchUpFormat:n}),n&&(n===i?$t({message:"No changes",intent:"is-warning"}):qt({methods:[{params:{matchUpFormat:n,structureId:t,drawId:e},method:jYe}],callback:o=>o.success&&$t({message:"Scoring changed"})}))},existingMatchUpFormat:i,modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}function olt({drawId:t,eventId:e,structureId:i}){const r=[{params:{drawId:t,structureId:i,force:!0},method:$Ye}],n=l=>{l.success?Fn({eventId:e,drawId:t,renderDraw:!0}):$t({message:l.error?.message||"Error",intent:"is-danger "})};Kr({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>qt({methods:r,callback:n}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:pee}=ll;function llt({structureName:t,dualMatchUp:e,structureId:i,eventData:r,drawData:n,drawId:a}){const s=n.structures?.find(d=>d.stage===wR),o=n.structures?.find(d=>d.structureId===i),l=r.eventInfo.eventId,c=()=>{const d=e.matchUpId,p=We.findMatchUp({drawId:a,matchUpId:d})?.matchUp,h=d2({matchUp:p}),f=document.getElementById(Oh);Xs(f),f.appendChild(h)},u=[{hide:r.eventInfo.eventType!==pee,onClick:()=>OEe({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:c}),label:"Edit scorecard",close:!0},{hide:r.eventInfo.eventType===pee,onClick:()=>slt({structureId:i,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:o?.stage==="MAIN"&&o.stageSequence===1&&!s,onClick:()=>olt({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{onClick:()=>h2({eventData:r,drawIds:[a]}),label:"Delete draw"},{onClick:()=>alt({eventData:r,drawIds:[a]}),label:"Reset draw"}];if(e){const d=e.matchUpId;u.push({divider:!0});const p=v=>v.success&&c(),f={label:"Remove players",onClick:()=>{We.findMatchUp({matchUpId:d,drawId:a}).matchUp.tieMatchUps?.some(We.checkScoreHasValue)?$t({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):qt({methods:[{params:{drawId:a,matchUpId:d,inheritance:!1},method:VUe}],callback:p})},close:!0};u.push(f);const g={label:"Clear results",onClick:()=>{qt({methods:[{params:{drawId:a,matchUpId:d},method:jUe}],callback:p})},close:!0};u.push(g)}return u}function clt({eventData:t}){const e=t.drawsData.map(({drawId:o,drawName:l})=>({label:l,checkbox:!0,field:o,id:o}));let i;const r=()=>{const o=t.drawsData.filter(({drawId:l})=>i[l]?.checked).map(({drawId:l})=>l);setTimeout(()=>h2({eventData:t,drawIds:o}),200)},n=()=>{const o=t.drawsData.filter(({drawId:c})=>i[c]?.checked).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!o)},a=t.drawsData.map(({drawId:o})=>({onChange:n,control:o}));Kr({title:"Delete flights",content:o=>i=pn(o,e,a),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:r}]})}function ult({eventData:t,drawId:e}){const i=()=>{const s=o=>{if(o.drawDefinition){const l=o.drawDefinition.structures?.[0]?.structureId,c=t.eventInfo.eventId,u=o.drawDefinition.drawId;Fn({eventId:c,drawId:u,structureId:l,renderDraw:!0})}};wU({eventId:t.eventInfo.eventId,callback:s})},r=()=>clt({eventData:t}),n=t.drawsData.length>1&&{onClick:r,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>Fn({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(s=>({onClick:()=>{const o=s.structures?.[0]?.structureId,l=t.eventInfo.eventId,c=s.drawId;Fn({eventId:l,drawId:c,structureId:o,renderDraw:!0})},label:s.drawName,close:!0})).concat([{divider:!0},a,n,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function dlt(){return{eventOptions:(We.getEvents().events??[]).map(i=>({onClick:()=>{const r=We.getEventData({eventId:i.eventId});if(!r?.eventData?.drawsData?.length)Fn({eventId:i.eventId});else{const n=r.eventData.drawsData?.[0]?.drawId;Fn({eventId:r.eventData.eventInfo.eventId,drawId:n,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${mg}</div>`,onClick:QEe,close:!0}])}}const{TEAM:plt}=ll;function nPe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:r,matchUps:n,eventId:a,drawId:s}){const{eventOptions:o}=dlt(),l=ult({eventData:r,drawId:s}),c=r?.drawsData?.find(f=>f.drawId===s),u=c?.structures?.find(f=>f.structureId===i)?.structureName,d=n?.length===1&&r.eventInfo.eventType===plt,p=nlt({updateControlBar:e,structureId:i,drawData:c,eventId:a}),h=llt({dualMatchUp:d&&n[0],structureName:u,structureId:i,eventData:r,drawData:c,drawId:s});return[{onKeyDown:f=>f.key==="Backspace"&&f.target.value.length===1&&t(""),onChange:f=>t(f.target.value),onKeyUp:f=>t(f.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:ui,search:!0},{options:o.length>1?o:void 0,label:r.eventInfo.eventName,modifyLabel:!0,location:ui},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:ui},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:ui},{options:h,intent:"is-info",label:"Actions",location:Xt,align:Xt}]}function D9({eventId:t,drawId:e,structureId:i,updateDisplay:r}){const n=We.getEventData({eventId:t}).eventData,s=n?.drawsData?.find(m=>m.drawId===e)?.structures||[];i=i||s?.[0]?.structureId;const o=s.find(m=>m.structureId===i),{roundMatchUps:l}=Ni.makeDeepCopy(o||{}),c=Object.values(l||{}).flat();let u;const d=m=>m.searchText?.includes(u),h=nPe({updateControlBar:D9,updateParticipantFilter:m=>{m||Object.values(ht.tables).filter(Boolean).forEach(g=>g.clearFilter()),u=m?.toLowerCase(),m&&Object.values(ht.tables).filter(Boolean).forEach(g=>g.addFilter(d)),typeof r=="function"&&r({participantFilter:u})},structureId:i,eventData:n,matchUps:c,eventId:t,drawId:e}),f=document.getElementById(SR)||void 0;bo({target:f,items:h})}function hlt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function flt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function aPe({drawId:t,roundNumber:e,structure:i,structureId:r,callback:n}={}){r=r||i?.structureId;const a=We.allDrawMatchUps({matchUpFilters:{structureIds:[r]},drawId:t}).matchUps||[],s=a.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||s.length&&s[s.length-1],!e)return;let o;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&o.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&o.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&o.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:o.completed.checked,removeIncomplete:o.unscored.checked,removeUnassigned:o.empties.checked,structureId:r,matchUpIds:f,drawId:t},method:xUe}],g=v=>{v.success?Pt(n)&&n&&n({refresh:!0}):console.log({postMutationError:v.error})};f.length&&qt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:s.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];Kr({title:"Delete matches",content:f=>o=pn(f,p),buttons:c})}function sPe({drawId:t,structure:e,structureId:i,roundNumber:r,callback:n}={}){i=i||e?.structureId;const a=We.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),o=Math.max(...s,1);a.length?s.push(o+1):s.length||s.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=We.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!b.matchUps?.length)return;const I=[{method:_Ue,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];qt({methods:I,callback:T=>{T.success?Pt(n)&&n&&n({refresh:!0}):console.log(T.error)}})}}],p={text:"Round number:",fieldPair:{options:s.map(v=>({label:v,value:v})),field:"roundNumber",value:r,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];Kr({title:"Add matches",content:v=>l=pn(v,m),buttons:u})}const{ASSIGN_PARTICIPANT:mlt}=sw;function E9({drawId:t,structure:e,structureId:i,callback:r}={}){i=i||e?.structureId;let n,a;const s=We.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=s.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=o[o.length-1],c=Math.max(...o,1);s.length&&o.push(c+1);const u=({matchUps:v,roundResults:y})=>{const b=[{params:{structureId:i,matchUps:v,drawId:t},method:_Ue}];if(y?.length)for(const w of y){const T=w?.modifiedScaleValues;b.push({params:{modifiedScaleValues:T,replacePriorValues:!0},method:wYe})}qt({methods:b,callback:w=>{w.success?Pt(r)&&r&&r({refresh:!0}):console.log(w.error)}})},d=v=>{const y=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:I}=ai.scales[y]??{};tk(y);const w=We.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:v,scaleAccessor:b,scaleName:I,drawId:t});w.matchUps?.length&&u(w)},p=({participantIds:v})=>{const y=We.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?s.filter(({roundNumber:S,sides:D})=>S===l&&D?.some(({participantId:C})=>C)).map(({sides:S})=>S.map(({participantId:D})=>D)).flat():[],I=b.length?b:v;X0({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{const D=S.selected?.map(({participantId:C})=>C);d(D)},action:{type:mlt,participantsAvailable:y},update:n})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{if(a[Cc].value===Cc){const{drawDefinition:v}=We.getEvent({drawId:t}),y=v.entries.filter(({entryStatus:b,entryStage:I})=>!["WITHDRAWN","UNGROUPED"].includes(b)&&(!I||I===e.stage)).map(({participantId:b})=>b);p({participantIds:y})}else{pU();const v=We.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!v.matchUps?.length)return;u(v)}}}],m=[{field:Cc,value:Cc,options:[{label:Cc,value:Cc,selected:!0},{label:k3,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:ai.activeScale===sC},{text:"UTR",field:"utr",checked:ai.activeScale===mI},{text:"None",field:"none",checked:!ai.activeScale}],onClick:v=>console.log({x:v}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];n=Kr({title:"Add round",content:v=>a=pn(v,m),buttons:f}).update}const oPe="Delete matches",lPe="Add matches",cPe="Add round";function glt({structure:t,drawId:e,callback:i}){if(!We.isAdHoc({structure:t}))return{};const r=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>sPe({drawId:e,structure:t,callback:r}),label:lPe,color:"blue"},{onClick:()=>E9({drawId:e,structure:t,callback:r}),label:cPe,color:"blue"},{label:oPe,color:"red",onClick:()=>aPe({drawId:e,structure:t,callback:r})}],selection:!1,location:Xt,align:Xt}}const{CONTAINER:vlt}=Wn;function ylt({callback:t,structure:e,existingView:i}){const r=o=>i!==o&&t({refresh:!0,view:o}),n=e?.structureType===vlt,a=We.isAdHoc({structure:e}),s=[];return s.push({active:!i||i===LV,onClick:()=>r(LV),label:a?"Columns":"Draw",close:!0}),s.push({active:i===BT,onClick:()=>r(BT),label:"Table",close:!0}),(a||n)&&s.push({active:i===FT,onClick:()=>r(FT),label:"Stats",close:!0}),{tabs:s}}const{MAIN:blt,QUALIFYING:Ilt,VOLUNTARY_CONSOLATION:wlt}=Wn;function P9({updateDisplay:t,callback:e,structure:i,drawId:r,existingView:n}){const a=document.getElementById(x3),{sourceStructuresComplete:s,hasDrawFeedProfile:o}=i??{},l=!(i?.stage===blt&&i?.stageSequence===1)&&i?.stage!==Ilt&&o,c=We.isAdHoc({structure:i}),u=[];if(l){const h=()=>{const m={params:{structureId:i.sourceStructureIds[0],drawId:r},method:NYe};qt({methods:[m],callback:v=>{v.success&&typeof t=="function"&&t()}})},f=i.positionAssignments?.filter(({participantId:m})=>m).length;u.push({intent:s?"is-primary":Vt,disabled:s!==!0,visible:!f,onClick:h,label:"Auto position",location:Xt})}const d=({refresh:h,view:f})=>typeof e=="function"&&e&&e({refresh:h,view:f});if(c){const h=glt({structure:i,drawId:r,callback:e});u.push(h)}i?.stage===wlt&&console.log("voluntary controlBar with [View participants]");const p=ylt({structure:i,existingView:n,callback:d}).tabs;u.push({onClick:()=>d({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:ui,tabs:p}),u.length&&a&&bo({target:a,items:u})}function f2(){[x3,Qpe,ehe].forEach(t=>{const e=document.getElementById(t);e&&Xs(e)})}const Slt=t=>t.reduce((e,i)=>e+parseFloat(i.toString()),0),hee=t=>parseFloat((Slt(t)/t.length).toFixed(2));function fee({participantResult:t,drawPosition:e,participantId:i,participantMap:r}={}){const n=`${t?.pointsWon||0}/${t?.pointsLost||0}`,a=`${t?.gamesWon||0}/${t?.gamesLost||0}`,s=`${t?.setsWon||0}/${t?.setsLost||0}`,o=t?.groupOrder||t?.provisionalOrder,l=t?.pressureScores?.length?hee(t.pressureScores):0,c=t?.ratingVariation?.length?hee(t.ratingVariation):0,u=r?.[i||""];return{participantName:u?.participantName,groupName:u?.groupName,...t,averageVariation:c,averagePressure:l,participantId:i,pointsResult:n,drawPosition:e,participant:u,gamesResult:a,setsResult:s,order:o}}function mG(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function US(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function mee(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function Tlt(){return[{headerMenu:Mm({}),field:"drawPosition",headerSort:!1,hozAlign:ui,width:55},{formatter:"responsiveCollapse",hozAlign:li,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:Yw(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:yU,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:li,headerWordWrap:!0,title:"Match W/L",hozAlign:li,maxWidth:80,field:"result"},{formatter:US,headerHozAlign:li,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:li,maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:li,maxWidth:80},{formatter:US,headerHozAlign:li,headerWordWrap:!0,title:"Set Win%",hozAlign:li,field:"setsPct",maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:li,maxWidth:80},{formatter:US,headerHozAlign:li,headerWordWrap:!0,title:"Game Win%",hozAlign:li,field:"gamesPct",maxWidth:80},{headerHozAlign:li,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:li,maxWidth:80},{formatter:US,headerHozAlign:li,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:li,maxWidth:80},{formatter:US,field:"averageVariation",headerHozAlign:li,sorter:mee,hozAlign:li,maxWidth:70,title:"RV"},{formatter:US,field:"averagePressure",headerHozAlign:li,sorter:mee,hozAlign:li,maxWidth:70,title:"PS"},{headerHozAlign:li,field:"pressureOrder",sorter:mG,title:"PS#",hozAlign:li,maxWidth:80},{headerHozAlign:li,sorter:mG,hozAlign:li,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function uPe({eventId:t,drawId:e,structureId:i}){let r,n,a,s;const o=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},c=()=>{const{participants:y,eventData:b}=We.getEventData({participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:t});return n=b?.drawsData?.find(T=>T.drawId===e)?.structures?.find(T=>T.structureId===i),s||(s=o(y)),(n?.roundMatchUps?Object.values(n.roundMatchUps).flat():[]).forEach(({sides:T,structureName:S,structureId:D})=>{l[D]=S,T.forEach(C=>{C.participantId&&(s[C.participantId].groupName=S)})}),(n?.participantResults??[]).filter(T=>{const S=s[T.participantId];return!a||S?.participantName?.toLowerCase().includes(a?.toLowerCase())})},u=c(),d=()=>u?.map(y=>fee({...y,participantMap:s})).sort((y,b)=>mG(y.order,b.order)),p=()=>c()?.map(y=>fee({...y,participantMap:s})),h=y=>{y?.participantFilter!==void 0&&(a=y.participantFilter),r.replaceData(p())},f=d(),m=Tlt();return(y=>{Rm({anchorId:Oh});const b=document.getElementById(Oh),I=Object.values(l).length>1?["groupName"]:void 0;r=new ks(b,{headerSortElement:af(["averageVariation","averagePressure","participantName","pressureOrder","pointsResult","gamesResult","matchUpsPct","setsResult","pointsPct","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[w=>w],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(f),P9({structure:n,drawId:e,existingView:FT,callback:({refresh:y,view:b}={})=>{f2(),b?Fn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):WC({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})},updateDisplay:h}),D9({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:r,replaceTableData:h}}const gee=(function(){let t;const e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}},i={};let r={};const n=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(r={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(r[p]||(r[p]={},i[p]=[]),r[p][d]={fx:h,delay:f},i[p]=Object.keys(r[p])),e),e.deRegister=(d,p)=>(r[p]&&(delete r[p][d],i[p]=Object.keys(r[p])),e),e.call=(d,p,...h)=>r?.[p]?.[d]?.fx(...h),e.trigger=(d,p,h,f)=>r[p][d].fx(h,f,p),e.list=()=>console.log(r);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>o({evt:d,evnt:"tap"})),document.addEventListener("change",d=>o({evt:d,evnt:"change"})),document.addEventListener("click",d=>o({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>o({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>o({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>o({evt:d,evnt:"keyup",stopPropagation:!1}));let s=0;function o({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f=d,m={x:f.clientX,y:f.clientY,pageX:f.pageX,pageY:f.pageY},g=Array.from(d.target.classList),v=g.length&&i[p]?n(g,i[p]):[];if(v.length){const y=new Date().getTime();e.elapsed=y-s,s=y,v.forEach(b=>{l({cls:b,evt:d,evnt:p,mouse:m})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){const m=p.target;r[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{const p=d;e.touched=p.target,e.coords=[p.touches[0].clientX,p.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){const p=d;e.touched!==p.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return(function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)})(),e})();function Ult({structure:t,drawId:e,callback:i}){const r=document.createElement("div");r.className="flexcol flexcenter",r.style.width="100%",r.style.height="300px";const n=document.createElement("button");n.onclick=s=>{s.stopPropagation(),s.preventDefault(),E9({structure:t,callback:i,drawId:e})},n.className="button is-info",n.innerHTML="Generate round",r.appendChild(n);const a=document.getElementById(Oh);a&&a.appendChild(r)}function Dlt({drawData:t,eventId:e,drawId:i}){const r=document.createElement("div");r.className="flexcol flexcenter",r.style.width="100%",r.style.height="300px";const n=document.createElement("button");n.onclick=s=>{s.stopPropagation(),s.preventDefault();const o=t.drawName;wU({callback:l=>{const c=l.drawDefinition?.structures?.find(({stage:u})=>u===wR)?.structureId;Fn({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:o,eventId:e,drawId:i})},n.className="button is-info",n.innerHTML="Generate qualifying",r.appendChild(n);const a=document.getElementById(Oh);a&&a.appendChild(r)}const vee={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",LUCKY:"Assign Lucky Loser",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function Elt({pointerEvent:t,actions:e,callback:i}){const r=t.target,n=s=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(s.type)&&Plt({action:s,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER","LUCKY"].includes(s.type)&&Clt({action:s,callback:i}),["SEED_VALUE"].includes(s.type)&&Rlt({target:r,action:s,callback:i})},a=e?.filter(({type:s})=>vee[s]).map(s=>({option:vee[s.type]||s.type,onClick:()=>n(s)}));a?.length&&nu({options:a,target:r,config:{arrow:!1,offset:[0,0]}})}function Plt({action:t,callback:e}){const i=n=>n.success?e():console.log({result:n}),r=[{method:t.method,params:t.payload}];qt({methods:r,callback:i})}function Clt({action:t,callback:e}){X0({action:t,onSelection:r=>{const n=s=>s.success?e():console.log({result:s}),a=[{params:{...t.payload,...r},method:t.method}];qt({methods:a,callback:n})},selectOnEnter:!0})}function Rlt({target:t,action:e,callback:i}){let r;function n(s){if(s?.key==="Enter"){const o=s.target.value;if(Ni.isConvertableInteger(o)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:o},method:e.method}];qt({methods:c,callback:l})}r.destroy()}}r=nu({menuItems:[{label:"Assign seed number ",validator:Jp,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:n}],target:t,config:{arrow:!1,offset:[0,0]}})}function Mlt(t){const{structureId:e,drawId:i}=t?.context??t,r=t.eventData?.drawsData?.find(a=>a.drawId===i)?.structures?.find(a=>a.structureId===e),n=[];if(We.isAdHoc({structure:r})){const a=[{onClick:()=>sPe({...t}),text:lPe,color:"blue"},{onClick:()=>E9({...t,structure:r}),text:cPe,color:"blue"},{onClick:()=>aPe({...t}),text:oPe,color:"red"}];n.push(...a)}t?.pointerEvent&&n.length&&nu({items:n,target:t.pointerEvent.target,config:{placement:wp}})}const{TEAM:Nlt}=Vs;function Alt({callback:t,drawId:e,eventData:i}){const r=i?.drawsData?.flatMap(({structures:d})=>d.flatMap(p=>[p.structures?.flatMap(h=>Object.values(h.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]).filter(Boolean)),n=Ni.createMap(r,"matchUpId"),a=d=>{const p=hE(d.pointerEvent.target,"tmx-m","id");return n[p]},s=d=>parseInt(hE(d.pointerEvent.target,"tmx-sd","sideNumber")),o=d=>hE(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(hE(d.pointerEvent.target,"tmx-rd","roundNumber")),c=d=>{const p=a(d);if(!p)return;const h=s(d),f=d.side||p.sides?.find(g=>g.sideNumber===h),{validActions:m}=p.drawId&&We.positionActions({sideNumber:h||f?.sideNumber,structureId:p?.structureId,drawPosition:f?.drawPosition,matchUpId:p?.matchUpId,drawId:p?.drawId,policyDefinitions:{positionActions:{},...fg.policies.POLICY_POSITION_ACTIONS_UNRESTRICTED}})||{};Elt({...d,actions:m,callback:t})},u=d=>{const p=s(d),h=a(d);if(!h)return;const{validActions:f}=We.matchUpActions({matchUpId:h.matchUpId,drawId:h.drawId,sideNumber:p})||{},m=f?.find(({type:g})=>g==="SCORE");if(m)if(h.matchUpType===Nlt){const g=()=>t(),v=i?.eventInfo?.eventName,{matchUpId:y,drawId:b}=h;u2({title:v,drawId:b,matchUpId:y,onClose:g})}else Q0({matchUpId:m.payload.matchUpId,callback:t})};return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),h=o(d);return Mlt({pointerEvent:d.pointerEvent,roundNumber:p,structureId:h,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d?.pointerEvent){d.pointerEvent.stopPropagation();const p=hE(d.pointerEvent.target,"tmx-m","id"),h=n[p];w9({pointerEvent:d.pointerEvent,matchUp:h,callback:t})}},venueClick:d=>{const p=a(d);if(d?.pointerEvent&&p?.schedule?.venueId){const h=p.schedule.venueId,f=We.findVenue({venueId:h})?.venue?.addresses?.[0],{latitude:m,longitude:g}=f||{};if(!m||!g)return;const v=`https://www.google.com/maps/@?api=1&map_action=map&center=${m}%2C${g}&zoom=18&basemap=satellite`,y=`https://bing.com/maps/default.aspx?cp=${m}~${g}&lvl=17&style=h`,b=w=>{const T=w&&m&&g&&(w==="google"&&v||y);T&&window.open(T,"_blank")};nu({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>b("google"),hide:!m||!g,text:"Open in Google Maps"},{onClick:()=>b("bing"),hide:!m||!g,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:wp}})}},participantClick:c,matchUpClick:u,scoreClick:u}}var yee=11;function _lt(t,e){var i=e.attributes,r,n,a,s,o;if(!(e.nodeType===yee||t.nodeType===yee)){for(var l=i.length-1;l>=0;l--)r=i[l],n=r.name,a=r.namespaceURI,s=r.value,a?(n=r.localName||n,o=t.getAttributeNS(a,n),o!==s&&(r.prefix==="xmlns"&&(n=r.name),t.setAttributeNS(a,n,s))):(o=t.getAttribute(n),o!==s&&t.setAttribute(n,s));for(var c=t.attributes,u=c.length-1;u>=0;u--)r=c[u],n=r.name,a=r.namespaceURI,a?(n=r.localName||n,e.hasAttributeNS(a,n)||t.removeAttributeNS(a,n)):e.hasAttribute(n)||t.removeAttribute(n)}}var zM,klt="http://www.w3.org/1999/xhtml",Bu=typeof document>"u"?void 0:document,Olt=!!Bu&&"content"in Bu.createElement("template"),xlt=!!Bu&&Bu.createRange&&"createContextualFragment"in Bu.createRange();function Llt(t){var e=Bu.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Flt(t){zM||(zM=Bu.createRange(),zM.selectNode(Bu.body));var e=zM.createContextualFragment(t);return e.childNodes[0]}function Blt(t){var e=Bu.createElement("body");return e.innerHTML=t,e.childNodes[0]}function $lt(t){return t=t.trim(),Olt?Llt(t):xlt?Flt(t):Blt(t)}function qM(t,e){var i=t.nodeName,r=e.nodeName,n,a;return i===r?!0:(n=i.charCodeAt(0),a=r.charCodeAt(0),n<=90&&a>=97?i===r.toUpperCase():a<=90&&n>=97?r===i.toUpperCase():!1)}function Vlt(t,e){return!e||e===klt?Bu.createElement(t):Bu.createElementNS(e,t)}function jlt(t,e){for(var i=t.firstChild;i;){var r=i.nextSibling;e.appendChild(i),i=r}return e}function d$(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var bee={OPTION:function(t,e){var i=t.parentNode;if(i){var r=i.nodeName.toUpperCase();r==="OPTGROUP"&&(i=i.parentNode,r=i&&i.nodeName.toUpperCase()),r==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}d$(t,e,"selected")},INPUT:function(t,e){d$(t,e,"checked"),d$(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var r=t.firstChild;if(r){var n=r.nodeValue;if(n==i||!i&&n==t.placeholder)return;r.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,r=0,n=t.firstChild,a,s;n;)if(s=n.nodeName&&n.nodeName.toUpperCase(),s==="OPTGROUP")a=n,n=a.firstChild,n||(n=a.nextSibling,a=null);else{if(s==="OPTION"){if(n.hasAttribute("selected")){i=r;break}r++}n=n.nextSibling,!n&&a&&(n=a.nextSibling,a=null)}t.selectedIndex=i}}},IE=1,Iee=11,wee=3,See=8;function hv(){}function Glt(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function Hlt(t){return function(i,r,n){if(n||(n={}),typeof r=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=r;r=Bu.createElement("html"),r.innerHTML=a}else r=$lt(r);else r.nodeType===Iee&&(r=r.firstElementChild);var s=n.getNodeKey||Glt,o=n.onBeforeNodeAdded||hv,l=n.onNodeAdded||hv,c=n.onBeforeElUpdated||hv,u=n.onElUpdated||hv,d=n.onBeforeNodeDiscarded||hv,p=n.onNodeDiscarded||hv,h=n.onBeforeElChildrenUpdated||hv,f=n.skipFromChildren||hv,m=n.addChild||function(x,O){return x.appendChild(O)},g=n.childrenOnly===!0,v=Object.create(null),y=[];function b(x){y.push(x)}function I(x,O){if(x.nodeType===IE)for(var V=x.firstChild;V;){var F=void 0;O&&(F=s(V))?b(F):(p(V),V.firstChild&&I(V,O)),V=V.nextSibling}}function w(x,O,V){d(x)!==!1&&(O&&O.removeChild(x),p(x),I(x,V))}function T(x){if(x.nodeType===IE||x.nodeType===Iee)for(var O=x.firstChild;O;){var V=s(O);V&&(v[V]=O),T(O),O=O.nextSibling}}T(i);function S(x){l(x);for(var O=x.firstChild;O;){var V=O.nextSibling,F=s(O);if(F){var j=v[F];j&&qM(O,j)?(O.parentNode.replaceChild(j,O),C(j,O)):S(O)}else S(O);O=V}}function D(x,O,V){for(;O;){var F=O.nextSibling;(V=s(O))?b(V):w(O,x,!0),O=F}}function C(x,O,V){var F=s(O);if(F&&delete v[F],!V){var j=c(x,O);if(j===!1||(j instanceof HTMLElement&&(x=j,T(x)),t(x,O),u(x),h(x,O)===!1))return}x.nodeName!=="TEXTAREA"?E(x,O):bee.TEXTAREA(x,O)}function E(x,O){var V=f(x,O),F=O.firstChild,j=x.firstChild,q,W,z,H,Z;e:for(;F;){for(H=F.nextSibling,q=s(F);!V&&j;){if(z=j.nextSibling,F.isSameNode&&F.isSameNode(j)){F=H,j=z;continue e}W=s(j);var J=j.nodeType,ie=void 0;if(J===F.nodeType&&(J===IE?(q?q!==W&&((Z=v[q])?z===Z?ie=!1:(x.insertBefore(Z,j),W?b(W):w(j,x,!0),j=Z,W=s(j)):ie=!1):W&&(ie=!1),ie=ie!==!1&&qM(j,F),ie&&C(j,F)):(J===wee||J==See)&&(ie=!0,j.nodeValue!==F.nodeValue&&(j.nodeValue=F.nodeValue))),ie){F=H,j=z;continue e}W?b(W):w(j,x,!0),j=z}if(q&&(Z=v[q])&&qM(Z,F))V||m(x,Z),C(Z,F);else{var K=o(F);K!==!1&&(K&&(F=K),F.actualize&&(F=F.actualize(x.ownerDocument||Bu)),m(x,F),S(F))}F=H,j=z}D(x,j,W);var ne=bee[x.nodeName];ne&&ne(x,O)}var P=i,R=P.nodeType,M=r.nodeType;if(!g){if(R===IE)M===IE?qM(i,r)||(p(i),P=jlt(i,Vlt(r.nodeName,r.namespaceURI))):P=r;else if(R===wee||R===See){if(M===R)return P.nodeValue!==r.nodeValue&&(P.nodeValue=r.nodeValue),P;P=r}}if(P===r)p(i);else{if(r.isSameNode&&r.isSameNode(P))return;if(C(P,r,g),y)for(var A=0,N=y.length;A<N;A++){var k=v[y[A]];k&&w(k,k.parentNode,!1)}}return!g&&P!==i&&i.parentNode&&(P.actualize&&(P=P.actualize(i.ownerDocument||Bu)),i.parentNode.replaceChild(P,i)),P}}var zlt=Hlt(_lt);const{DOUBLES:qlt,TEAM:Tee}=ll;function WC({eventId:t,drawId:e,structureId:i,roundsView:r,redraw:n}){if(!We.getEvents().events?.length)return;let s;gee.register("tmx-tm","mouseover",hlt),gee.register("tmx-tm","mouseout",flt);let o,l,c=[],u,d="",p,h,f=[],m;const g=()=>{u=We.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t})?.eventData,d=u?.eventInfo?.eventType,h=u?.drawsData?.find(M=>M.drawId===e),c=h?.structures||[],i=i||c?.[0]?.structureId,p=c.find(M=>M.structureId===i),s=We.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=Ni.makeDeepCopy(p||{}),f=Object.values(l||{}).flat(),s&&f.sort(Ni.matchUpScheduleSort)};r2(),g();const v=M=>{const{refresh:A,view:N}=M??{},k=A||o;f2(),N?Fn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:N}):WC({eventId:t,drawId:e,structureId:i,redraw:k,roundsView:N})},y=f?.length===1&&u?.eventInfo?.eventType===Tee,b=Alt({eventData:u,callback:v,drawId:e}),I=p?.display||h?.display||u?.eventInfo?.display||{},w=I?.compositionName,T=I?.configuration,S=$C[w]||ai.composition||$C[d===qlt&&"National"||d===Tee&&"Basic"||"National"];S.configuration.flags=!1,Object.assign(S.configuration,T),S.configuration.scaleAttributes&&(S.configuration.scaleAttributes=ai.scales[ai.activeScale]),ai.composition||(S.configuration.genderColor=!0,S.configuration.showAddress=void 0,S.configuration.allDrawPositions=!0,S.configuration.drawPositions=!0),S.configuration.roundHeader=!0;const D=document.getElementById(Oh);n&&D&&Xs(D);const C=()=>{if(y)return;for(const A of Object.keys(p?.roundMatchUps??{}))p.roundMatchUps[A]=l?.[A]?.filter(({sides:N})=>N?.some(({participant:x})=>x?.participantName.toLowerCase().includes(o))||!o);const M=Object.values(p.roundMatchUps||{}).flat();if(f.length)if(r===BT)dPe({matchUps:M,eventData:u});else if(r===FT)uPe({eventId:t,drawId:e,structureId:i});else{const A=TUe({content:SUe({context:{drawId:e,structureId:i},searchActive:o,matchUps:M,eventHandlers:b,composition:S}),theme:S.theme}),N=x=>x?.classList?.contains("tmx-p")?x:Fl(x,"tmx-p"),k=D?.firstChild;k?zlt(k,A,{addChild:function(x,O){if(O.classList){const V=x.firstChild,F=O.getAttribute("id"),j=![null,"undefined",void 0].includes(F),q=x.firstChild?.getAttribute?.("id"),W=![null,"undefined",void 0].includes(q);try{if(!j&&!W){ai.renderLog&&console.log("condition 0");const z=N(V)?.nextSibling;z?.getAttribute("id")&&N(V)?.getAttribute("id")&&z.remove()}else j&&W&&F&&q&&F!==q?(ai.renderLog&&console.log("condition 1"),x.firstChild.remove()):O.classList?.contains("tmx-p")&&!W?(ai.renderLog&&console.log("condition 2"),x.firstChild.remove()):x.firstChild?.classList?.contains("tmx-p")&&x.firstChild.getAttribute("id")!=="undefined"&&O.getAttribute("id")==="undefined"?(ai.renderLog&&console.log("condition 3"),x.firstChild.remove()):!j&&W?ai.renderLog&&console.log("condition 4"):console.log({incomingId:j,existingId:W,incomingIdValue:F,existingIdValue:q})}catch(z){console.log({err:z})}}x.appendChild(O)}}):D&&D.appendChild(A)}else if(m===wR)Dlt({drawData:h,drawId:e,eventId:t});else if(s)Ult({structure:p,drawId:e,callback:v});else{const A=c?.[0]?.structureId;return WC({eventId:t,drawId:e,structureId:A,redraw:!0})}};P9({updateDisplay:()=>{g(),C()},drawId:e,structure:p,existingView:r,callback:v});const P=document.getElementById(SR)||void 0,R=M=>{M&&g();const A=x=>x.searchText?.includes(o),k=nPe({updateParticipantFilter:x=>{x||Object.values(ht.tables).filter(Boolean).forEach(O=>O.clearFilter()),o=x?.toLowerCase(),x&&Object.values(ht.tables).filter(Boolean).forEach(O=>O.addFilter(A)),D&&Xs(D),C()},updateControlBar:R,structureId:i,eventData:u,matchUps:f,eventId:t,drawId:e});bo({target:P,items:k})};if(!h){console.log("no draw data",{eventData:u,drawData:h});return}if(i||(i=h.structures?.[0]?.structureId),!i){console.log("structure not found");return}if(y){const M=d2({matchUp:f[0]});M&&D&&D.appendChild(M)}else C();R()}function Wlt(t,e){const i=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${i})</span>`}const{TEAM:Ylt}=Vs,Klt=t=>(e,i)=>{const n=i.getRow().getData(),{matchUpId:a,readyToScore:s,matchUpType:o,drawId:l,eventName:c}=n.matchUp;if(o===Ylt)u2({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(s||Fv.checkScoreHasValue(n.matchUp)){const u=()=>{t()};Q0({matchUp:n.matchUp,matchUpId:a,callback:u})}};function Zlt({data:t,replaceTableData:e}){const i=(o,l)=>{const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const h=We.getTournament()?.tournamentRecord?.tournamentId,f=`/${Es}/${h}/${oy}/${p}`;ht.router.navigate(f)}},r=()=>e(),n=t.some(o=>o.courtName),a=(o,l)=>HC(o,l,r),s=o=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{HC(d,o,r,p)};return o.getValue().participantName&&Yw(c)(o,l)};return[{cellClick:(o,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:li,minWidth:50,width:50},{headerMenu:Mm({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:ui,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!n,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:a,sorter:yU,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:a,sorter:yU,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Klt(e),formatter:I9,sorter:FEe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:EEe,formatter:PEe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:ui,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(o,l)=>w9({pointerEvent:o,...l.getData()}),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,widthGrow:0,width:50}]}const{TEAM:Xlt}=ll,Uee=t=>{const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:s,schedule:o,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=o||{},m=N=>N.person?.standardFamilyName||N.participantName,g=e?.map(N=>({participantName:N.map(m).filter(Boolean).join(" or ")}))||[],v=u?.[0]?.participant||g.shift(),y=u?.[1]?.participant||g.shift(),b={participantName:v?.participantName,sex:v?.person?.sex,participant:v},I={participantName:y?.participantName,sex:y?.person?.sex,participant:y},w=u.flatMap(({participant:N})=>N?.individualParticipantIds?.length?N.individualParticipantIds:N?.participantId).filter(Boolean),T=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,D=!!(d.winningSide||d.readyToScore),C=d.score?.scoreStringSide1,E=u.flatMap(N=>{const k=N.participant?.person;return k?[k.standardGivenName,k.standardFamilyName]:N.participant?.individualParticipants?.map(({person:x})=>[x.standardGivenName,x.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=aEe([E,v?.participantName,y?.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?Xlt:r,M=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:C,matchUpStatus:t.matchUpStatus,readyToScore:D,complete:S,winningSide:T};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:w,flight:t.drawName,competitiveProfile:M,structureName:i,scheduledDate:p,readyToScore:D,scheduleTime:h,matchUpType:r,scoreDetail:A,winningSide:T,roundNumber:n,searchText:P,courtName:f,eventType:R,matchUpId:a,roundName:s,complete:S,eventId:l,matchUp:t,drawId:c,side1:b,side2:I,score:C}},{CONTAINER:Jlt}=Wn;async function dPe({eventId:t,drawId:e,structureId:i,matchUps:r,eventData:n}){let a,s,o,l=!1;const c=()=>{const y={withISO2:!0,withScaleValues:!0},b={withCompetitiveness:!0};s=We.getEventData({eventId:t,contextProfile:b,participantsProfile:y}).eventData?.drawsData?.find(D=>D.drawId===e)?.structures?.find(D=>D.structureId===i),l=s?.structureType===Jlt;const T=s?.roundMatchUps?Object.values(s?.roundMatchUps||{}).flat():[],S=T.flatMap(D=>D.tieMatchUps||[]);return S.length&&T.push(...S),T.filter(({matchUpStatus:D})=>D!=="BYE").filter(({sides:D})=>!o||D.find(C=>C.participant?.participantName?.toLowerCase().includes(o?.toLowerCase())))};r||(r=c()),n&&r.forEach(y=>y.eventName=n.eventInfo.eventName);const u=()=>r?.map(Uee),d=()=>c().map(Uee),p=y=>{y?.participantFilter&&(o=y.participantFilter),a.replaceData(d())},h=u(),f=Zlt({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{Rm({anchorId:Oh});const b=document.getElementById(Oh);a=new ks(b,{groupHeader:[Wlt,I=>I],headerSortElement:af(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),P9({structure:s,drawId:e,existingView:BT,callback:({refresh:y,view:b}={})=>{f2(),b?Fn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):WC({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),D9({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function WM({eventId:t,renderDraw:e}={}){const i=document.getElementById(the),r=document.getElementById(Jpe),n=document.getElementById(Oh),a=document.getElementById(ihe);a&&(a.style.display=t||e?"":Vt),i&&(i.style.display=t&&!e?"":Vt),r&&(r.style.display=t||e?Vt:""),n&&(n.style.display=e?"":Vt)}function Qlt({eventId:t,drawId:e,headerElement:i}){const{event:r,drawDefinition:n}=We.getEvent({eventId:t,drawId:e});return r&&n?(i.innerHTML=r.eventName,{success:!0}):{}}const pPe=t=>({drawDefinition:e,scaleValues:i})=>{const{drawId:r,drawName:n,drawType:a,entries:s,matchUpFormat:o,tieFormat:l}=e,u=We.getPublishState({drawId:r}).publishState?.status?.published,d=s?.filter(({entryStatus:h})=>h!=="WITHDRAWN")?.length;return{entries:We.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds?.filter(Boolean)?.length??d??0,matchUpFormat:o,tieFormat:l,utrAvg:i?.ratingsStats?.UTR?.avg,wtnAvg:i?.ratingsStats?.WTN?.avg,published:u,drawName:n,drawType:a,eventId:t,drawId:r}},{MAIN:Dee}=Wn;function hPe({event:t,scaleValues:e,lightMode:i=!1}){const{drawDefinitions:r=[],eventName:n,entries:a,eventId:s}=t,o=Cx.getPublishState({event:t}).publishState,l=r.length,c=a.filter(({entryStage:m=Dee,entryStatus:g})=>ik(Dee).includes(`${m}.${g}`))?.length||0;let u=0,d=0,p=0,h=[];if(!i){const m=We.allEventMatchUps({inContext:!0,eventId:s}).matchUps;u=m?.length||0,d=m?.filter(({winningSide:g,schedule:v})=>!g&&v?.scheduledTime)?.length||0,p=m.filter(({winningSide:g})=>g)?.length||0,h=r.map(g=>pPe(s)({drawDefinition:g,scaleValues:e?.draws?.[g.drawId]}))}const f=[n].concat(r.map(({drawName:m})=>m||"")).join(" ").toLowerCase();return{published:o?.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:u,entriesCount:c,drawsCount:l,searchText:f,drawDefs:h,eventId:s,event:t}}function fPe({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const r=t?.getData();if(r){const n=We.allEventMatchUps({eventId:r.eventId,inContext:!1}).matchUps;r.drawDefs=r.drawDefs.filter(a=>!i.includes(a.drawId)),r.matchUpsCount=n?.length||0,r.drawsCount-=i.length}}const mPe=t=>(e,i)=>{const r=i.getRow().getData(),n=r.published?[r.drawId]:void 0,a=r.published?void 0:[r.drawId],o=[{method:BUe,params:{eventId:r.eventId,drawIdsToRemove:n,drawIdsToAdd:a,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];qt({methods:o,callback:c=>{if(c?.success){i.getRow().update({published:!r.published});const u=t.getData().eventId,p=We.getPublishState({eventId:u}).publishState?.status?.published;t.update({published:p})}else $t({message:c.error.message,intent:"is-danger"})}})},gPe=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function vPe(t){const{eventId:e,drawId:i,callback:r}=t,n=We.findExtension({name:xv.DISPLAY,discover:!0,eventId:e,drawId:i}).extension?.value,a=n?.admin??n,s=["Wimbledon","French","ITF"],o="saveDisplaySettings",l={compositionName:a?.compositionName??ai.composition?.compositionName??"Australian",configuration:a?.configuration??{},composition:void 0,inputs:void 0},c=Ni.dateTime.extractDate(new Date().toISOString()),u="drawId",p=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],h=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:u,generate:!0,drawSize:4}],f=[{scheduleDate:c,venues:[{rounds:[{drawId:u,winnerFinishingPositionRange:"1-2"}],venueId:p[0].venueId}]}],m={withScaleValues:!0},g=bR.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:m,autoSchedule:!0,schedulingProfile:f,venueProfiles:p,drawProfiles:h,startDate:c}).tournamentRecord,y=rR.allTournamentMatchUps({tournamentRecord:g}).matchUps.find(A=>A.matchUpType==="SINGLES"),b=document.createElement("div");b.style.maxWidth="500px";const I=document.createElement("div");b.appendChild(I);const w=({compositionName:A,configuration:N})=>{Xs(I),l.composition=$C[A],l.composition.configuration.flags=void 0,Object.assign(l.composition.configuration,N),l.composition.genderColor=!0,l.composition.compositionName=A;const k=Hw({isLucky:!0,composition:l.composition,matchUp:y});I.appendChild(k)};w(l);const T=Object.keys($C).filter(A=>A!=="Night").map(A=>({selected:A===l.compositionName,label:A,value:A})),S=l.configuration.participantDetail,D=[{label:"None",value:"NONE",selected:!S},{label:"Address",value:"ADDRESS",selected:S==="ADDRESS"},{label:"Team",value:"TEAM",selected:S==="TEAM"}],C=()=>{l.compositionName=l.inputs.composition.value,l.configuration.scheduleInfo=!s.includes(l.compositionName)&&l.inputs.showSchedule.checked,l.configuration.participantDetail=l.inputs.detail.value,w(l)},E=[{options:T,label:"Composition",field:"composition",onChange:C},{controlVisible:!s.includes(l.compositionName),checked:l.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:C},{options:D,label:"Detail",field:"detail",onChange:C}],P=document.createElement("div");b.appendChild(P);const R=[{onChange:({e:A})=>{const N=!s.includes(A.target.value),k=document.getElementById("scheduleToggle");k&&(k.style.display=N?"block":Vt)},control:"composition"}];l.inputs=pn(P,E,R),Kr({title:"Edit display settings",buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Save",id:o,intent:"is-info",close:!0,onClick:()=>{const A=()=>{console.log("Mutation completed")},k={value:{...We.findExtension({name:xv.DISPLAY,discover:!0,eventId:e,drawId:i})?.extension?.value,compositionName:l.composition.compositionName,configuration:l.configuration},name:xv.DISPLAY};qt({methods:[{method:i?IYe:UYe,params:{eventId:e,drawId:i,extension:k}}],callback:A}),Pt(r)&&r(l.composition),ai.composition=l.composition}}],content:b})}const ect=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(h=>h.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=i.getRow()?.getData(),{published:o,drawId:l,eventId:c}=s;nu({items:[{onClick:()=>vPe({drawId:s.drawId}),text:"Display settings"},{text:o?"Unpublish":"Publish",onClick:()=>{mPe(t)(e,i)}},{onClick:()=>{h2({eventId:c,drawIds:[l],callback:f=>{f.success||f.error?.message&&$t({message:f.error.message,intent:"is-danger"}),fPe({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:n||e.target,config:{placement:wp}})};function tct(t,e){const i=(a,s)=>{const{eventId:o,drawId:l}=s.getRow().getData();Fn({eventId:o,drawId:l,renderDraw:!0})},r=t.find(a=>a.utrAvg),n=t.find(a=>a.wtnAvg);return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:ui,width:5},{headerMenu:Mm({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:li,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:mPe(e),formatter:gPe,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:fI,cellClick:i},{title:"Draw Type",field:nh,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!n,field:"wtnAvg",title:sC,width:80},{visible:!!r,field:"utrAvg",title:mI,width:80},{cellClick:ect(e),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt}]}const ict=t=>e=>{const i=document.createElement("div"),r=document.createElement("div");r.className="tableControl",r.style.marginBottom="1em";const n=e.getData().drawDefs;i.appendChild(r);const a=document.createElement("div");a.style.backgroundColor="white";const s="1px solid #333";a.style.border=s,a.style.width="99%",i.style.borderBottom=s,i.style.boxSizing="border-box",i.style.borderTop=s,i.style.paddingLeft="10px",i.className=Ox,i.style.display=Vt,i.appendChild(a),e.getElement().appendChild(i);const o=tct(n,e),l=new ks(a,{headerSortElement:af(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:o,data:n});l.on("scrollVertical",gd);const c=e.getData().event,u=c.eventId;t(u,l);const d=()=>{const g=l.getSelectedData().map(({drawId:y})=>y);l.deselectRow(),h2({eventId:u,drawIds:g,callback:y=>{if(!y.success){y.error?.message&&$t({message:y.error.message,intent:"is-danger"});return}fPe({eventRow:e,drawsTable:l,drawIds:g})}})},p=m=>{if(m.success){l?.addRow(pPe(u)({drawDefinition:m.drawDefinition}));const g=e?.getData();if(a.style.display="",g)if(!g.matchUpsCount)Fn({eventId:u,drawId:m.drawDefinition?.drawId,renderDraw:!0});else{const v=We.allDrawMatchUps({drawId:m.drawDefinition.drawId,inContext:!1,eventId:u}).matchUps;g.matchUpsCount+=v?.length||0,g.drawsCount+=1}}},h=({success:m,eventUpdates:g})=>{if(m){const v=e?.getData();Object.assign(v.event,g),e.update(v)}};bo({table:l,target:r,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onClick:()=>Fn({eventId:u}),label:"View entries",intent:"is-info",location:ui},{onClick:()=>YEe({eventId:u}),id:"editAvoidances",label:"Avoidances",location:ui},{onClick:()=>o2({event:c,callback:h}),label:"Edit event",location:Xt},{onClick:()=>wU({eventId:u,callback:p}),intent:"is-primary",label:"Add draw",location:Xt}]})},yPe=t=>(e,i)=>{const r=i.getRow().getData(),n=r.eventId,a=!r.published,s=r.published?WYe:BUe;t.get(n).getRows().forEach(u=>u.update({published:a})),qt({methods:[{method:s,params:{eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0},eventId:n}}],callback:u=>{u?.success?i.getRow().update({published:!r.published}):$t({message:u.error.message,intent:"is-danger"})}})};function bPe(t){const{eventIds:e,callback:i}=t;if(ai.skipReason){qt({methods:[{method:ZX,params:{eventIds:e,auditData:{auditReason:"Reason skipped"}}}],callback:i});return}const r=e.length>1?"Delete Events":"Delete Event";let n;const a=()=>{const u={auditReason:n.eventDeletionReason.value};qt({methods:[{method:ZX,params:{eventIds:e,auditData:u}}],callback:i})},s=[{text:"Please provide a reason for event deletion."},{placeholder:"Explanation",field:"eventDeletionReason",validator:SU(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],l=[{control:"eventDeletionReason",onInput:({inputs:u})=>{const d=u.eventDeletionReason.value,p=SU(5)(d),h=document.getElementById("deleteEvent");h&&(h.disabled=!p)}}];Kr({title:r,content:u=>n=pn(u,s,l),buttons:[{label:"Cancel",intent:Vt,close:!0},{label:"Delete",id:"deleteEvent",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}const rct=t=>(e,i)=>{const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(h=>h.remove());return}const n=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),s=i.getRow(),o=s?.getData(),l=o?.published,c=({success:h,eventUpdates:f})=>{h&&(Object.assign(o.event,f),s.update(o))};nu({items:[{onClick:()=>vPe({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{yPe(t)(e,i)}},{onClick:()=>{const h=[a.eventId];return bPe({eventIds:h,callback:m=>{const g=i.getTable();m.success&&g?.deleteRow(h)}})},text:"Delete"},{onClick:()=>o2({event:a.event,callback:c}),text:"Edit"}],target:n||e.target,config:{placement:wp}})};function nct(t,e){const i=typeof e=="function"?e():!1,r=(a,s)=>{a.stopPropagation();const o=s.getRow().getData().eventId;Fn({eventId:o})},n=(a,s)=>{eI(a,s)};return[{cellClick:(a,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:ui,width:5},{headerMenu:Mm({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:li,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:yPe(t),formatter:gPe,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:n,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:eI,headerHozAlign:li,field:"drawsCount",hozAlign:li,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:li,field:"entriesCount",cellClick:r,hozAlign:li,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:li,field:"matchUpsCount",hozAlign:li,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:li,hozAlign:li,headerSort:!0,visible:!i,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:li,hozAlign:li,headerSort:!0,visible:!i,width:50},{cellClick:eI,formatter:g9,responsive:!1,headerSort:!1,hozAlign:Xt,field:"isOpen",width:20},{cellClick:rct(t),formatter:tv,responsive:!1,headerSort:!1,hozAlign:Xt,width:20}]}const act=15;function sct(){let t;const e=new Map,i=(u,d)=>{e.has(u)||e.set(u,d)},a=(We.getEvents({withScaleValues:!1})?.events?.length||0)>act,s=()=>{const u=We.getEvents({withScaleValues:!a});return u?.events?.map(d=>hPe({event:d,scaleValues:u.eventScaleValues?.[d.eventId],lightMode:a}))},o=()=>{t.replaceData(s())},l=nct(e,()=>a);return(u=>{Rm({anchorId:rC});const d=document.getElementById(rC),p=Fl(d,"section")?.querySelector(".tabHeader");p?.innerHTML&&(p.innerHTML=`Events (${u.length})`),t=new ks(d,{columnDefaults:{},headerSortElement:af(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),rowFormatter:ict(i),height:window.innerHeight*.8,placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:l,data:u}),t.on("scrollVertical",gd),t.on("dataChanged",h=>{p&&(p.innerHTML=`Events (${h.length})`)}),t.on("dataFiltered",(h,f)=>{p&&(p.innerHTML=`Events (${f.length})`)})})(s()),{table:t,replaceTableData:o}}function oct(){const t=We.getPublishState().publishState?.tournament,{table:e}=sct(),i=u=>{if(u?.event){const d=hPe({event:u.event});e?.updateOrAddData([d])}},r=qw(e),n=()=>{const u=e?.getSelectedData().map(({eventId:p})=>p);return bPe({eventIds:u,callback:p=>p.success&&e?.deleteRow(u)})},a=u=>u?"Unpublish":"Publish",s=u=>`${a(u)} OOP`,o=u=>{if(u?.success){const d=We.getPublishState().publishState?.tournament,p=document.getElementById("oopButton");p.innerText=s(d?.orderOfPlay?.published),p.classList.toggle("is-primary")}},l=[{onClick:n,label:"Delete selected",intent:"is-danger",stateChange:!0,location:ya},{onKeyDown:u=>u.key==="Backspace"&&u.target.value.length===1&&r(""),onChange:u=>r(u.target.value),onKeyUp:u=>r(u.target.value),clearSearch:()=>r(""),placeholder:"Search events",location:ui,search:!0},{onClick:()=>lct(o),label:s(t?.orderOfPlay?.published),intent:t?.orderOfPlay?.published?"is-primary":"",id:"oopButton",location:Xt},{onClick:()=>o2({callback:i}),label:"Add event",location:Xt}],c=document.getElementById(W3)||void 0;bo({table:e,target:c,items:l})}function lct(t){const n=[{method:We.getPublishState().publishState?.tournament?.orderOfPlay?.published?"unPublishOrderOfPlay":"publishOrderOfPlay"}];qt({methods:n,callback:t})}function cct(t){const{eventId:e,drawId:i,structureId:r,renderDraw:n,roundsView:a="roundsColumns"}=t;if(S9(Qp),r2(),f2(),e||i){const s=document.getElementById(rC),o=Fl(s,"section")?.querySelector(".tabHeader");i&&n?Qlt({eventId:e,drawId:i,headerElement:o}).success?(a===BT?dPe({eventId:e,drawId:i,structureId:r}):a===FT?uPe({eventId:e,drawId:i,structureId:r}):WC({eventId:e,drawId:i,structureId:r,redraw:!0,roundsView:a}),WM({renderDraw:n})):(uee({eventId:e,drawId:i}),WM({eventId:e})):(uee({eventId:e,drawId:i,headerElement:o}),WM({eventId:e}))}else oct(),WM({eventId:e})}function uct({callback:t}={}){let e,i=!1;const n=We.getTournament().tournamentRecord?.onlineResources?.find(({name:p,resourceType:h})=>p==="tournamentImage"&&h==="URL")?.identifier,a=()=>{const p=document.getElementById("tournamentImagePreview");p&&(p.style.display=Vt),s(!0)},s=p=>{const h=document.getElementById("createButton"),f=p?!1:!i&&e.tournamentImage.value;h.disabled=f},o=()=>{s(!1),i=!1;const p=document.getElementById("tournamentImagePreview");p&&(p.onload=()=>{i=!0,s()},p.src=e.tournamentImage.value,p.style.display="")},l=p=>e=pn(p,[{onKeyUp:h=>h.key==="Enter"&&o(),onChange:()=>e.tournamentImage.value?o():a(),label:"Web address of online image",value:n,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),c=document.createElement("div");l(c);const u=document.createElement("img");u.id="tournamentImagePreview",u.onload=()=>i=!0,n&&(u.src=n),u.style.width="100%",c.appendChild(u),Kr({title:"Tournament image",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const p=e.tournamentImage.value;qt({methods:[{method:DYe,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:p}}}],callback:m=>{m.success&&($t({message:"Tournament image updated",intent:"is-success"}),Pt(t)&&t(p))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var IPe=typeof global=="object"&&global&&global.Object===Object&&global,dct=typeof self=="object"&&self&&self.Object===Object&&self,Nm=IPe||dct||Function("return this")(),Sy=Nm.Symbol,wPe=Object.prototype,pct=wPe.hasOwnProperty,hct=wPe.toString,wE=Sy?Sy.toStringTag:void 0;function fct(t){var e=pct.call(t,wE),i=t[wE];try{t[wE]=void 0;var r=!0}catch{}var n=hct.call(t);return r&&(e?t[wE]=i:delete t[wE]),n}var mct=Object.prototype,gct=mct.toString;function vct(t){return gct.call(t)}var yct="[object Null]",bct="[object Undefined]",Eee=Sy?Sy.toStringTag:void 0;function QD(t){return t==null?t===void 0?bct:yct:Eee&&Eee in Object(t)?fct(t):vct(t)}function Rg(t){return t!=null&&typeof t=="object"}var MI=Array.isArray;function rb(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function SPe(t){return t}var Ict="[object AsyncFunction]",wct="[object Function]",Sct="[object GeneratorFunction]",Tct="[object Proxy]";function C9(t){if(!rb(t))return!1;var e=QD(t);return e==wct||e==Sct||e==Ict||e==Tct}var p$=Nm["__core-js_shared__"],Pee=(function(){var t=/[^.]+$/.exec(p$&&p$.keys&&p$.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Uct(t){return!!Pee&&Pee in t}var Dct=Function.prototype,Ect=Dct.toString;function Kw(t){if(t!=null){try{return Ect.call(t)}catch{}try{return t+""}catch{}}return""}var Pct=/[\\^$.*+?()[\]{}|]/g,Cct=/^\[object .+?Constructor\]$/,Rct=Function.prototype,Mct=Object.prototype,Nct=Rct.toString,Act=Mct.hasOwnProperty,_ct=RegExp("^"+Nct.call(Act).replace(Pct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kct(t){if(!rb(t)||Uct(t))return!1;var e=C9(t)?_ct:Cct;return e.test(Kw(t))}function Oct(t,e){return t?.[e]}function Zw(t,e){var i=Oct(t,e);return kct(i)?i:void 0}var gG=Zw(Nm,"WeakMap"),Cee=Object.create,xct=(function(){function t(){}return function(e){if(!rb(e))return{};if(Cee)return Cee(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}})();function Lct(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Fct(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var Bct=800,$ct=16,Vct=Date.now;function jct(t){var e=0,i=0;return function(){var r=Vct(),n=$ct-(r-i);if(i=r,n>0){if(++e>=Bct)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Gct(t){return function(){return t}}var nk=(function(){try{var t=Zw(Object,"defineProperty");return t({},"",{}),t}catch{}})(),Hct=nk?function(t,e){return nk(t,"toString",{configurable:!0,enumerable:!1,value:Gct(e),writable:!0})}:SPe,zct=jct(Hct);function qct(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var Wct=9007199254740991,Yct=/^(?:0|[1-9]\d*)$/;function TPe(t,e){var i=typeof t;return e=e??Wct,!!e&&(i=="number"||i!="symbol"&&Yct.test(t))&&t>-1&&t%1==0&&t<e}function R9(t,e,i){e=="__proto__"&&nk?nk(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function eM(t,e){return t===e||t!==t&&e!==e}var Kct=Object.prototype,Zct=Kct.hasOwnProperty;function UPe(t,e,i){var r=t[e];(!(Zct.call(t,e)&&eM(r,i))||i===void 0&&!(e in t))&&R9(t,e,i)}function Xct(t,e,i,r){var n=!i;i||(i={});for(var a=-1,s=e.length;++a<s;){var o=e[a],l=void 0;l===void 0&&(l=t[o]),n?R9(i,o,l):UPe(i,o,l)}return i}var Ree=Math.max;function Jct(t,e,i){return e=Ree(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,a=Ree(r.length-e,0),s=Array(a);++n<a;)s[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=i(s),Lct(t,this,o)}}function Qct(t,e){return zct(Jct(t,e,SPe),t+"")}var eut=9007199254740991;function DPe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=eut}function m2(t){return t!=null&&DPe(t.length)&&!C9(t)}function tut(t,e,i){if(!rb(i))return!1;var r=typeof e;return(r=="number"?m2(i)&&TPe(e,i.length):r=="string"&&e in i)?eM(i[e],t):!1}function iut(t){return Qct(function(e,i){var r=-1,n=i.length,a=n>1?i[n-1]:void 0,s=n>2?i[2]:void 0;for(a=t.length>3&&typeof a=="function"?(n--,a):void 0,s&&tut(i[0],i[1],s)&&(a=n<3?void 0:a,n=1),e=Object(e);++r<n;){var o=i[r];o&&t(e,o,r,a)}return e})}var rut=Object.prototype;function M9(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||rut;return t===i}function nut(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var aut="[object Arguments]";function Mee(t){return Rg(t)&&QD(t)==aut}var EPe=Object.prototype,sut=EPe.hasOwnProperty,out=EPe.propertyIsEnumerable,vG=Mee((function(){return arguments})())?Mee:function(t){return Rg(t)&&sut.call(t,"callee")&&!out.call(t,"callee")};function lut(){return!1}var PPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nee=PPe&&typeof module=="object"&&module&&!module.nodeType&&module,cut=Nee&&Nee.exports===PPe,Aee=cut?Nm.Buffer:void 0,uut=Aee?Aee.isBuffer:void 0,YC=uut||lut,dut="[object Arguments]",put="[object Array]",hut="[object Boolean]",fut="[object Date]",mut="[object Error]",gut="[object Function]",vut="[object Map]",yut="[object Number]",but="[object Object]",Iut="[object RegExp]",wut="[object Set]",Sut="[object String]",Tut="[object WeakMap]",Uut="[object ArrayBuffer]",Dut="[object DataView]",Eut="[object Float32Array]",Put="[object Float64Array]",Cut="[object Int8Array]",Rut="[object Int16Array]",Mut="[object Int32Array]",Nut="[object Uint8Array]",Aut="[object Uint8ClampedArray]",_ut="[object Uint16Array]",kut="[object Uint32Array]",_a={};_a[Eut]=_a[Put]=_a[Cut]=_a[Rut]=_a[Mut]=_a[Nut]=_a[Aut]=_a[_ut]=_a[kut]=!0;_a[dut]=_a[put]=_a[Uut]=_a[hut]=_a[Dut]=_a[fut]=_a[mut]=_a[gut]=_a[vut]=_a[yut]=_a[but]=_a[Iut]=_a[wut]=_a[Sut]=_a[Tut]=!1;function Out(t){return Rg(t)&&DPe(t.length)&&!!_a[QD(t)]}function N9(t){return function(e){return t(e)}}var CPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,yP=CPe&&typeof module=="object"&&module&&!module.nodeType&&module,xut=yP&&yP.exports===CPe,h$=xut&&IPe.process,TU=(function(){try{var t=yP&&yP.require&&yP.require("util").types;return t||h$&&h$.binding&&h$.binding("util")}catch{}})(),_ee=TU&&TU.isTypedArray,A9=_ee?N9(_ee):Out,Lut=Object.prototype,Fut=Lut.hasOwnProperty;function RPe(t,e){var i=MI(t),r=!i&&vG(t),n=!i&&!r&&YC(t),a=!i&&!r&&!n&&A9(t),s=i||r||n||a,o=s?nut(t.length,String):[],l=o.length;for(var c in t)(e||Fut.call(t,c))&&!(s&&(c=="length"||n&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||TPe(c,l)))&&o.push(c);return o}function MPe(t,e){return function(i){return t(e(i))}}var But=MPe(Object.keys,Object),$ut=Object.prototype,Vut=$ut.hasOwnProperty;function jut(t){if(!M9(t))return But(t);var e=[];for(var i in Object(t))Vut.call(t,i)&&i!="constructor"&&e.push(i);return e}function Gut(t){return m2(t)?RPe(t):jut(t)}function Hut(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var zut=Object.prototype,qut=zut.hasOwnProperty;function Wut(t){if(!rb(t))return Hut(t);var e=M9(t),i=[];for(var r in t)r=="constructor"&&(e||!qut.call(t,r))||i.push(r);return i}function NPe(t){return m2(t)?RPe(t,!0):Wut(t)}var KC=Zw(Object,"create");function Yut(){this.__data__=KC?KC(null):{},this.size=0}function Kut(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Zut="__lodash_hash_undefined__",Xut=Object.prototype,Jut=Xut.hasOwnProperty;function Qut(t){var e=this.__data__;if(KC){var i=e[t];return i===Zut?void 0:i}return Jut.call(e,t)?e[t]:void 0}var edt=Object.prototype,tdt=edt.hasOwnProperty;function idt(t){var e=this.__data__;return KC?e[t]!==void 0:tdt.call(e,t)}var rdt="__lodash_hash_undefined__";function ndt(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=KC&&e===void 0?rdt:e,this}function NI(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}NI.prototype.clear=Yut;NI.prototype.delete=Kut;NI.prototype.get=Qut;NI.prototype.has=idt;NI.prototype.set=ndt;function adt(){this.__data__=[],this.size=0}function g2(t,e){for(var i=t.length;i--;)if(eM(t[i][0],e))return i;return-1}var sdt=Array.prototype,odt=sdt.splice;function ldt(t){var e=this.__data__,i=g2(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():odt.call(e,i,1),--this.size,!0}function cdt(t){var e=this.__data__,i=g2(e,t);return i<0?void 0:e[i][1]}function udt(t){return g2(this.__data__,t)>-1}function ddt(t,e){var i=this.__data__,r=g2(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}function iv(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}iv.prototype.clear=adt;iv.prototype.delete=ldt;iv.prototype.get=cdt;iv.prototype.has=udt;iv.prototype.set=ddt;var ZC=Zw(Nm,"Map");function pdt(){this.size=0,this.__data__={hash:new NI,map:new(ZC||iv),string:new NI}}function hdt(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function v2(t,e){var i=t.__data__;return hdt(e)?i[typeof e=="string"?"string":"hash"]:i.map}function fdt(t){var e=v2(this,t).delete(t);return this.size-=e?1:0,e}function mdt(t){return v2(this,t).get(t)}function gdt(t){return v2(this,t).has(t)}function vdt(t,e){var i=v2(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}function Xw(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}Xw.prototype.clear=pdt;Xw.prototype.delete=fdt;Xw.prototype.get=mdt;Xw.prototype.has=gdt;Xw.prototype.set=vdt;function ydt(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}var APe=MPe(Object.getPrototypeOf,Object),bdt="[object Object]",Idt=Function.prototype,wdt=Object.prototype,_Pe=Idt.toString,Sdt=wdt.hasOwnProperty,Tdt=_Pe.call(Object);function Udt(t){if(!Rg(t)||QD(t)!=bdt)return!1;var e=APe(t);if(e===null)return!0;var i=Sdt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&_Pe.call(i)==Tdt}function Ddt(){this.__data__=new iv,this.size=0}function Edt(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}function Pdt(t){return this.__data__.get(t)}function Cdt(t){return this.__data__.has(t)}var Rdt=200;function Mdt(t,e){var i=this.__data__;if(i instanceof iv){var r=i.__data__;if(!ZC||r.length<Rdt-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new Xw(r)}return i.set(t,e),this.size=i.size,this}function Bf(t){var e=this.__data__=new iv(t);this.size=e.size}Bf.prototype.clear=Ddt;Bf.prototype.delete=Edt;Bf.prototype.get=Pdt;Bf.prototype.has=Cdt;Bf.prototype.set=Mdt;var kPe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kee=kPe&&typeof module=="object"&&module&&!module.nodeType&&module,Ndt=kee&&kee.exports===kPe,Oee=Ndt?Nm.Buffer:void 0,xee=Oee?Oee.allocUnsafe:void 0;function OPe(t,e){if(e)return t.slice();var i=t.length,r=xee?xee(i):new t.constructor(i);return t.copy(r),r}function Adt(t,e){for(var i=-1,r=t==null?0:t.length,n=0,a=[];++i<r;){var s=t[i];e(s,i,t)&&(a[n++]=s)}return a}function _dt(){return[]}var kdt=Object.prototype,Odt=kdt.propertyIsEnumerable,Lee=Object.getOwnPropertySymbols,xdt=Lee?function(t){return t==null?[]:(t=Object(t),Adt(Lee(t),function(e){return Odt.call(t,e)}))}:_dt;function Ldt(t,e,i){var r=e(t);return MI(t)?r:ydt(r,i(t))}function yG(t){return Ldt(t,Gut,xdt)}var bG=Zw(Nm,"DataView"),IG=Zw(Nm,"Promise"),wG=Zw(Nm,"Set"),Fee="[object Map]",Fdt="[object Object]",Bee="[object Promise]",$ee="[object Set]",Vee="[object WeakMap]",jee="[object DataView]",Bdt=Kw(bG),$dt=Kw(ZC),Vdt=Kw(IG),jdt=Kw(wG),Gdt=Kw(gG),eh=QD;(bG&&eh(new bG(new ArrayBuffer(1)))!=jee||ZC&&eh(new ZC)!=Fee||IG&&eh(IG.resolve())!=Bee||wG&&eh(new wG)!=$ee||gG&&eh(new gG)!=Vee)&&(eh=function(t){var e=QD(t),i=e==Fdt?t.constructor:void 0,r=i?Kw(i):"";if(r)switch(r){case Bdt:return jee;case $dt:return Fee;case Vdt:return Bee;case jdt:return $ee;case Gdt:return Vee}return e});var Hdt=Object.prototype,zdt=Hdt.hasOwnProperty;function qdt(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&zdt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var ak=Nm.Uint8Array;function _9(t){var e=new t.constructor(t.byteLength);return new ak(e).set(new ak(t)),e}function Wdt(t,e){var i=_9(t.buffer);return new t.constructor(i,t.byteOffset,t.byteLength)}var Ydt=/\w*$/;function Kdt(t){var e=new t.constructor(t.source,Ydt.exec(t));return e.lastIndex=t.lastIndex,e}var Gee=Sy?Sy.prototype:void 0,Hee=Gee?Gee.valueOf:void 0;function Zdt(t){return Hee?Object(Hee.call(t)):{}}function xPe(t,e){var i=e?_9(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var Xdt="[object Boolean]",Jdt="[object Date]",Qdt="[object Map]",ept="[object Number]",tpt="[object RegExp]",ipt="[object Set]",rpt="[object String]",npt="[object Symbol]",apt="[object ArrayBuffer]",spt="[object DataView]",opt="[object Float32Array]",lpt="[object Float64Array]",cpt="[object Int8Array]",upt="[object Int16Array]",dpt="[object Int32Array]",ppt="[object Uint8Array]",hpt="[object Uint8ClampedArray]",fpt="[object Uint16Array]",mpt="[object Uint32Array]";function gpt(t,e,i){var r=t.constructor;switch(e){case apt:return _9(t);case Xdt:case Jdt:return new r(+t);case spt:return Wdt(t);case opt:case lpt:case cpt:case upt:case dpt:case ppt:case hpt:case fpt:case mpt:return xPe(t,i);case Qdt:return new r;case ept:case rpt:return new r(t);case tpt:return Kdt(t);case ipt:return new r;case npt:return Zdt(t)}}function LPe(t){return typeof t.constructor=="function"&&!M9(t)?xct(APe(t)):{}}var vpt="[object Map]";function ypt(t){return Rg(t)&&eh(t)==vpt}var zee=TU&&TU.isMap,bpt=zee?N9(zee):ypt,Ipt="[object Set]";function wpt(t){return Rg(t)&&eh(t)==Ipt}var qee=TU&&TU.isSet,Spt=qee?N9(qee):wpt,Tpt=1,FPe="[object Arguments]",Upt="[object Array]",Dpt="[object Boolean]",Ept="[object Date]",Ppt="[object Error]",BPe="[object Function]",Cpt="[object GeneratorFunction]",Rpt="[object Map]",Mpt="[object Number]",$Pe="[object Object]",Npt="[object RegExp]",Apt="[object Set]",_pt="[object String]",kpt="[object Symbol]",Opt="[object WeakMap]",xpt="[object ArrayBuffer]",Lpt="[object DataView]",Fpt="[object Float32Array]",Bpt="[object Float64Array]",$pt="[object Int8Array]",Vpt="[object Int16Array]",jpt="[object Int32Array]",Gpt="[object Uint8Array]",Hpt="[object Uint8ClampedArray]",zpt="[object Uint16Array]",qpt="[object Uint32Array]",Ta={};Ta[FPe]=Ta[Upt]=Ta[xpt]=Ta[Lpt]=Ta[Dpt]=Ta[Ept]=Ta[Fpt]=Ta[Bpt]=Ta[$pt]=Ta[Vpt]=Ta[jpt]=Ta[Rpt]=Ta[Mpt]=Ta[$Pe]=Ta[Npt]=Ta[Apt]=Ta[_pt]=Ta[kpt]=Ta[Gpt]=Ta[Hpt]=Ta[zpt]=Ta[qpt]=!0;Ta[Ppt]=Ta[BPe]=Ta[Opt]=!1;function rA(t,e,i,r,n,a){var s,o=e&Tpt;if(s!==void 0)return s;if(!rb(t))return t;var l=MI(t);if(l)s=qdt(t);else{var c=eh(t),u=c==BPe||c==Cpt;if(YC(t))return OPe(t,o);if(c==$Pe||c==FPe||u&&!n)s=u?{}:LPe(t);else{if(!Ta[c])return n?t:{};s=gpt(t,c,o)}}a||(a=new Bf);var d=a.get(t);if(d)return d;a.set(t,s),Spt(t)?t.forEach(function(f){s.add(rA(f,e,i,f,t,a))}):bpt(t)&&t.forEach(function(f,m){s.set(m,rA(f,e,i,m,t,a))});var p=yG,h=l?void 0:p(t);return qct(h||t,function(f,m){h&&(m=f,f=t[m]),UPe(s,m,rA(f,e,i,m,t,a))}),s}var Wpt=1,Ypt=4;function uT(t){return rA(t,Wpt|Ypt)}var Kpt="__lodash_hash_undefined__";function Zpt(t){return this.__data__.set(t,Kpt),this}function Xpt(t){return this.__data__.has(t)}function sk(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new Xw;++e<i;)this.add(t[e])}sk.prototype.add=sk.prototype.push=Zpt;sk.prototype.has=Xpt;function Jpt(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}function Qpt(t,e){return t.has(e)}var eht=1,tht=2;function VPe(t,e,i,r,n,a){var s=i&eht,o=t.length,l=e.length;if(o!=l&&!(s&&l>o))return!1;var c=a.get(t),u=a.get(e);if(c&&u)return c==e&&u==t;var d=-1,p=!0,h=i&tht?new sk:void 0;for(a.set(t,e),a.set(e,t);++d<o;){var f=t[d],m=e[d];if(r)var g=s?r(m,f,d,e,t,a):r(f,m,d,t,e,a);if(g!==void 0){if(g)continue;p=!1;break}if(h){if(!Jpt(e,function(v,y){if(!Qpt(h,y)&&(f===v||n(f,v,i,r,a)))return h.push(y)})){p=!1;break}}else if(!(f===m||n(f,m,i,r,a))){p=!1;break}}return a.delete(t),a.delete(e),p}function iht(t){var e=-1,i=Array(t.size);return t.forEach(function(r,n){i[++e]=[n,r]}),i}function rht(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var nht=1,aht=2,sht="[object Boolean]",oht="[object Date]",lht="[object Error]",cht="[object Map]",uht="[object Number]",dht="[object RegExp]",pht="[object Set]",hht="[object String]",fht="[object Symbol]",mht="[object ArrayBuffer]",ght="[object DataView]",Wee=Sy?Sy.prototype:void 0,f$=Wee?Wee.valueOf:void 0;function vht(t,e,i,r,n,a,s){switch(i){case ght:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case mht:return!(t.byteLength!=e.byteLength||!a(new ak(t),new ak(e)));case sht:case oht:case uht:return eM(+t,+e);case lht:return t.name==e.name&&t.message==e.message;case dht:case hht:return t==e+"";case cht:var o=iht;case pht:var l=r&nht;if(o||(o=rht),t.size!=e.size&&!l)return!1;var c=s.get(t);if(c)return c==e;r|=aht,s.set(t,e);var u=VPe(o(t),o(e),r,n,a,s);return s.delete(t),u;case fht:if(f$)return f$.call(t)==f$.call(e)}return!1}var yht=1,bht=Object.prototype,Iht=bht.hasOwnProperty;function wht(t,e,i,r,n,a){var s=i&yht,o=yG(t),l=o.length,c=yG(e),u=c.length;if(l!=u&&!s)return!1;for(var d=l;d--;){var p=o[d];if(!(s?p in e:Iht.call(e,p)))return!1}var h=a.get(t),f=a.get(e);if(h&&f)return h==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=s;++d<l;){p=o[d];var v=t[p],y=e[p];if(r)var b=s?r(y,v,p,e,t,a):r(v,y,p,t,e,a);if(!(b===void 0?v===y||n(v,y,i,r,a):b)){m=!1;break}g||(g=p=="constructor")}if(m&&!g){var I=t.constructor,w=e.constructor;I!=w&&"constructor"in t&&"constructor"in e&&!(typeof I=="function"&&I instanceof I&&typeof w=="function"&&w instanceof w)&&(m=!1)}return a.delete(t),a.delete(e),m}var Sht=1,Yee="[object Arguments]",Kee="[object Array]",YM="[object Object]",Tht=Object.prototype,Zee=Tht.hasOwnProperty;function Uht(t,e,i,r,n,a){var s=MI(t),o=MI(e),l=s?Kee:eh(t),c=o?Kee:eh(e);l=l==Yee?YM:l,c=c==Yee?YM:c;var u=l==YM,d=c==YM,p=l==c;if(p&&YC(t)){if(!YC(e))return!1;s=!0,u=!1}if(p&&!u)return a||(a=new Bf),s||A9(t)?VPe(t,e,i,r,n,a):vht(t,e,l,i,r,n,a);if(!(i&Sht)){var h=u&&Zee.call(t,"__wrapped__"),f=d&&Zee.call(e,"__wrapped__");if(h||f){var m=h?t.value():t,g=f?e.value():e;return a||(a=new Bf),n(m,g,i,r,a)}}return p?(a||(a=new Bf),wht(t,e,i,r,n,a)):!1}function jPe(t,e,i,r,n){return t===e?!0:t==null||e==null||!Rg(t)&&!Rg(e)?t!==t&&e!==e:Uht(t,e,i,r,jPe,n)}function Dht(t){return function(e,i,r){for(var n=-1,a=Object(e),s=r(e),o=s.length;o--;){var l=s[++n];if(i(a[l],l,a)===!1)break}return e}}var Eht=Dht();function SG(t,e,i){(i!==void 0&&!eM(t[e],i)||i===void 0&&!(e in t))&&R9(t,e,i)}function Pht(t){return Rg(t)&&m2(t)}function TG(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function Cht(t){return Xct(t,NPe(t))}function Rht(t,e,i,r,n,a,s){var o=TG(t,i),l=TG(e,i),c=s.get(l);if(c){SG(t,i,c);return}var u=a?a(o,l,i+"",t,e,s):void 0,d=u===void 0;if(d){var p=MI(l),h=!p&&YC(l),f=!p&&!h&&A9(l);u=l,p||h||f?MI(o)?u=o:Pht(o)?u=Fct(o):h?(d=!1,u=OPe(l,!0)):f?(d=!1,u=xPe(l,!0)):u=[]:Udt(l)||vG(l)?(u=o,vG(o)?u=Cht(o):(!rb(o)||C9(o))&&(u=LPe(l))):d=!1}d&&(s.set(l,u),n(u,l,r,a,s),s.delete(l)),SG(t,i,u)}function GPe(t,e,i,r,n){t!==e&&Eht(e,function(a,s){if(n||(n=new Bf),rb(a))Rht(t,e,s,i,GPe,r,n);else{var o=r?r(TG(t,s),a,s+"",t,e,n):void 0;o===void 0&&(o=a),SG(t,s,o)}},NPe)}function k9(t,e){return jPe(t,e)}var Hv=iut(function(t,e,i){GPe(t,e,i)}),Si=(t=>(t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY",t))(Si||{});class um{constructor(e,i,r={}){this.attrName=e,this.keyName=i;const n=Si.TYPE&Si.ATTRIBUTE;this.scope=r.scope!=null?r.scope&Si.LEVEL|n:Si.ATTRIBUTE,r.whitelist!=null&&(this.whitelist=r.whitelist)}static keys(e){return Array.from(e.attributes).map(i=>i.name)}add(e,i){return this.canAdd(e,i)?(e.setAttribute(this.keyName,i),!0):!1}canAdd(e,i){return this.whitelist==null?!0:typeof i=="string"?this.whitelist.indexOf(i.replace(/["']/g,""))>-1:this.whitelist.indexOf(i)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const i=e.getAttribute(this.keyName);return this.canAdd(e,i)&&i?i:""}}class dT extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const HPe=class UG{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,i=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(i){let r=null;try{r=e.parentNode}catch{return null}return this.find(r,i)}return null}create(e,i,r){const n=this.query(i);if(n==null)throw new dT(`Unable to create ${i} blot`);const a=n,s=i instanceof Node||i.nodeType===Node.TEXT_NODE?i:a.create(r),o=new a(e,s,r);return UG.blots.set(o.domNode,o),o}find(e,i=!1){return UG.find(e,i)}query(e,i=Si.ANY){let r;return typeof e=="string"?r=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?r=this.types.text:typeof e=="number"?e&Si.LEVEL&Si.BLOCK?r=this.types.block:e&Si.LEVEL&Si.INLINE&&(r=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(n=>(r=this.classes[n],!!r)),r=r||this.tags[e.tagName]),r==null?null:"scope"in r&&i&Si.LEVEL&r.scope&&i&Si.TYPE&r.scope?r:null}register(...e){return e.map(i=>{const r="blotName"in i,n="attrName"in i;if(!r&&!n)throw new dT("Invalid definition");if(r&&i.blotName==="abstract")throw new dT("Cannot register abstract class");const a=r?i.blotName:n?i.attrName:void 0;return this.types[a]=i,n?typeof i.keyName=="string"&&(this.attributes[i.keyName]=i):r&&(i.className&&(this.classes[i.className]=i),i.tagName&&(Array.isArray(i.tagName)?i.tagName=i.tagName.map(s=>s.toUpperCase()):i.tagName=i.tagName.toUpperCase(),(Array.isArray(i.tagName)?i.tagName:[i.tagName]).forEach(s=>{(this.tags[s]==null||i.className==null)&&(this.tags[s]=i)}))),i})}};HPe.blots=new WeakMap;let UU=HPe;function Xee(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter(i=>i.indexOf(`${e}-`)===0)}class Mht extends um{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(i=>i.split("-").slice(0,-1).join("-"))}add(e,i){return this.canAdd(e,i)?(this.remove(e),e.classList.add(`${this.keyName}-${i}`),!0):!1}remove(e){Xee(e,this.keyName).forEach(i=>{e.classList.remove(i)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const i=(Xee(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,i)?i:""}}const sf=Mht;function m$(t){const e=t.split("-"),i=e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("");return e[0]+i}class Nht extends um{static keys(e){return(e.getAttribute("style")||"").split(";").map(i=>i.split(":")[0].trim())}add(e,i){return this.canAdd(e,i)?(e.style[m$(this.keyName)]=i,!0):!1}remove(e){e.style[m$(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const i=e.style[m$(this.keyName)];return this.canAdd(e,i)?i:""}}const nb=Nht;class Aht{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,i){i?e.add(this.domNode,i)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=UU.find(this.domNode);if(e==null)return;const i=um.keys(this.domNode),r=sf.keys(this.domNode),n=nb.keys(this.domNode);i.concat(r).concat(n).forEach(a=>{const s=e.scroll.query(a,Si.ATTRIBUTE);s instanceof um&&(this.attributes[s.attrName]=s)})}copy(e){Object.keys(this.attributes).forEach(i=>{const r=this.attributes[i].value(this.domNode);e.format(i,r)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(i=>{this.attributes[i].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,i)=>(e[i]=this.attributes[i].value(this.domNode),e),{})}}const y2=Aht,zPe=class{constructor(e,i){this.scroll=e,this.domNode=i,UU.blots.set(i,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new dT("Blot definition missing tagName");let i,r;return Array.isArray(this.tagName)?(typeof e=="string"?(r=e.toUpperCase(),parseInt(r,10).toString()===r&&(r=parseInt(r,10))):typeof e=="number"&&(r=e),typeof r=="number"?i=document.createElement(this.tagName[r-1]):r&&this.tagName.indexOf(r)>-1?i=document.createElement(r):i=document.createElement(this.tagName[0])):i=document.createElement(this.tagName),this.className&&i.classList.add(this.className),i}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),UU.blots.delete(this.domNode)}deleteAt(e,i){this.isolate(e,i).remove()}formatAt(e,i,r,n){const a=this.isolate(e,i);if(this.scroll.query(r,Si.BLOT)!=null&&n)a.wrap(r,n);else if(this.scroll.query(r,Si.ATTRIBUTE)!=null){const s=this.scroll.create(this.statics.scope);a.wrap(s),s.format(r,n)}}insertAt(e,i,r){const n=r==null?this.scroll.create("text",i):this.scroll.create(i,r),a=this.split(e);this.parent.insertBefore(n,a||void 0)}isolate(e,i){const r=this.split(e);if(r==null)throw new Error("Attempt to isolate at end");return r.split(i),r}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;return this.parent!=null&&(this.parent.insertBefore(r,this.next||void 0),this.remove()),r}split(e,i){return e===0?this:this.next}update(e,i){}wrap(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;if(this.parent!=null&&this.parent.insertBefore(r,this.next||void 0),typeof r.appendChild!="function")throw new dT(`Cannot wrap ${e}`);return r.appendChild(this),r}};zPe.blotName="abstract";let qPe=zPe;const WPe=class extends qPe{static value(e){return!0}index(e,i){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(i,1):-1}position(e,i){let r=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(r+=1),[this.parent.domNode,r]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};WPe.scope=Si.INLINE_BLOT;let _ht=WPe;const Jl=_ht;class kht{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const i=e.slice(1);this.append(...i)}}at(e){const i=this.iterator();let r=i();for(;r&&e>0;)e-=1,r=i();return r}contains(e){const i=this.iterator();let r=i();for(;r;){if(r===e)return!0;r=i()}return!1}indexOf(e){const i=this.iterator();let r=i(),n=0;for(;r;){if(r===e)return n;n+=1,r=i()}return-1}insertBefore(e,i){e!=null&&(this.remove(e),e.next=i,i!=null?(e.prev=i.prev,i.prev!=null&&(i.prev.next=e),i.prev=e,i===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let i=0,r=this.head;for(;r!=null;){if(r===e)return i;i+=r.length(),r=r.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const i=e;return e!=null&&(e=e.next),i}}find(e,i=!1){const r=this.iterator();let n=r();for(;n;){const a=n.length();if(e<a||i&&e===a&&(n.next==null||n.next.length()!==0))return[n,e];e-=a,n=r()}return[null,0]}forEach(e){const i=this.iterator();let r=i();for(;r;)e(r),r=i()}forEachAt(e,i,r){if(i<=0)return;const[n,a]=this.find(e);let s=e-a;const o=this.iterator(n);let l=o();for(;l&&s<e+i;){const c=l.length();e>s?r(l,e-s,Math.min(i,s+c-e)):r(l,0,Math.min(c,e+i-s)),s+=c,l=o()}}map(e){return this.reduce((i,r)=>(i.push(e(r)),i),[])}reduce(e,i){const r=this.iterator();let n=r();for(;n;)i=e(i,n),n=r();return i}}function Jee(t,e){const i=e.find(t);if(i)return i;try{return e.create(t)}catch{const r=e.create(Si.INLINE);return Array.from(t.childNodes).forEach(n=>{r.domNode.appendChild(n)}),t.parentNode&&t.parentNode.replaceChild(r.domNode,t),r.attach(),r}}const YPe=class wv extends qPe{constructor(e,i){super(e,i),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,wv.uiClass&&this.uiNode.classList.add(wv.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new kht,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const i=Jee(e,this.scroll);this.insertBefore(i,this.children.head||void 0)}catch(i){if(i instanceof dT)return;throw i}})}deleteAt(e,i){if(e===0&&i===this.length())return this.remove();this.children.forEachAt(e,i,(r,n,a)=>{r.deleteAt(n,a)})}descendant(e,i=0){const[r,n]=this.children.find(i);return e.blotName==null&&e(r)||e.blotName!=null&&r instanceof e?[r,n]:r instanceof wv?r.descendant(e,n):[null,-1]}descendants(e,i=0,r=Number.MAX_VALUE){let n=[],a=r;return this.children.forEachAt(i,r,(s,o,l)=>{(e.blotName==null&&e(s)||e.blotName!=null&&s instanceof e)&&n.push(s),s instanceof wv&&(n=n.concat(s.descendants(e,o,a))),a-=l}),n}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(i=>{e||this.statics.allowedChildren.some(r=>i instanceof r)||(i.statics.scope===Si.BLOCK_BLOT?(i.next!=null&&this.splitAfter(i),i.prev!=null&&this.splitAfter(i.prev),i.parent.unwrap(),e=!0):i instanceof wv?i.unwrap():i.remove())})}formatAt(e,i,r,n){this.children.forEachAt(e,i,(a,s,o)=>{a.formatAt(s,o,r,n)})}insertAt(e,i,r){const[n,a]=this.children.find(e);if(n)n.insertAt(a,i,r);else{const s=r==null?this.scroll.create("text",i):this.scroll.create(i,r);this.appendChild(s)}}insertBefore(e,i){e.parent!=null&&e.parent.children.remove(e);let r=null;this.children.insertBefore(e,i||null),e.parent=this,i!=null&&(r=i.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==r)&&this.domNode.insertBefore(e.domNode,r),e.attach()}length(){return this.children.reduce((e,i)=>e+i.length(),0)}moveChildren(e,i){this.children.forEach(r=>{e.insertBefore(r,i)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}else this.remove()}path(e,i=!1){const[r,n]=this.children.find(e,i),a=[[this,e]];return r instanceof wv?a.concat(r.path(n,i)):(r!=null&&a.push([r,n]),a)}removeChild(e){this.children.remove(e)}replaceWith(e,i){const r=typeof e=="string"?this.scroll.create(e,i):e;return r instanceof wv&&this.moveChildren(r),super.replaceWith(r)}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const r=this.clone();return this.parent&&this.parent.insertBefore(r,this.next||void 0),this.children.forEachAt(e,this.length(),(n,a,s)=>{const o=n.split(a,i);o!=null&&r.appendChild(o)}),r}splitAfter(e){const i=this.clone();for(;e.next!=null;)i.appendChild(e.next);return this.parent&&this.parent.insertBefore(i,this.next||void 0),i}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,i){const r=[],n=[];e.forEach(a=>{a.target===this.domNode&&a.type==="childList"&&(r.push(...a.addedNodes),n.push(...a.removedNodes))}),n.forEach(a=>{if(a.parentNode!=null&&a.tagName!=="IFRAME"&&document.body.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const s=this.scroll.find(a);s!=null&&(s.domNode.parentNode==null||s.domNode.parentNode===this.domNode)&&s.detach()}),r.filter(a=>a.parentNode===this.domNode&&a!==this.uiNode).sort((a,s)=>a===s?0:a.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(a=>{let s=null;a.nextSibling!=null&&(s=this.scroll.find(a.nextSibling));const o=Jee(a,this.scroll);(o.next!==s||o.next==null)&&(o.parent!=null&&o.parent.removeChild(this),this.insertBefore(o,s||void 0))}),this.enforceAllowedChildren()}};YPe.uiClass="";let Oht=YPe;const Sh=Oht;function xht(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(t[i]!==e[i])return!1;return!0}const LS=class FS extends Sh{static create(e){return super.create(e)}static formats(e,i){const r=i.query(FS.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new y2(this.domNode)}format(e,i){if(e===this.statics.blotName&&!i)this.children.forEach(r=>{r instanceof FS||(r=r.wrap(FS.blotName,!0)),this.attributes.copy(r)}),this.unwrap();else{const r=this.scroll.query(e,Si.INLINE);if(r==null)return;r instanceof um?this.attributes.attribute(r,i):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i)}}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,r,n){this.formats()[r]!=null||this.scroll.query(r,Si.ATTRIBUTE)?this.isolate(e,i).format(r,n):super.formatAt(e,i,r,n)}optimize(e){super.optimize(e);const i=this.formats();if(Object.keys(i).length===0)return this.unwrap();const r=this.next;r instanceof FS&&r.prev===this&&xht(i,r.formats())&&(r.moveChildren(this),r.remove())}replaceWith(e,i){const r=super.replaceWith(e,i);return this.attributes.copy(r),r}update(e,i){super.update(e,i),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}wrap(e,i){const r=super.wrap(e,i);return r instanceof FS&&this.attributes.move(r),r}};LS.allowedChildren=[LS,Jl],LS.blotName="inline",LS.scope=Si.INLINE_BLOT,LS.tagName="SPAN";let Lht=LS;const O9=Lht,BS=class DG extends Sh{static create(e){return super.create(e)}static formats(e,i){const r=i.query(DG.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,i){super(e,i),this.attributes=new y2(this.domNode)}format(e,i){const r=this.scroll.query(e,Si.BLOCK);r!=null&&(r instanceof um?this.attributes.attribute(r,i):e===this.statics.blotName&&!i?this.replaceWith(DG.blotName):i&&(e!==this.statics.blotName||this.formats()[e]!==i)&&this.replaceWith(e,i))}formats(){const e=this.attributes.values(),i=this.statics.formats(this.domNode,this.scroll);return i!=null&&(e[this.statics.blotName]=i),e}formatAt(e,i,r,n){this.scroll.query(r,Si.BLOCK)!=null?this.format(r,n):super.formatAt(e,i,r,n)}insertAt(e,i,r){if(r==null||this.scroll.query(i,Si.INLINE)!=null)super.insertAt(e,i,r);else{const n=this.split(e);if(n!=null){const a=this.scroll.create(i,r);n.parent.insertBefore(a,n)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,i){const r=super.replaceWith(e,i);return this.attributes.copy(r),r}update(e,i){super.update(e,i),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}};BS.blotName="block",BS.scope=Si.BLOCK_BLOT,BS.tagName="P",BS.allowedChildren=[O9,BS,Jl];let Fht=BS;const XC=Fht,EG=class extends Sh{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,i){super.deleteAt(e,i),this.enforceAllowedChildren()}formatAt(e,i,r,n){super.formatAt(e,i,r,n),this.enforceAllowedChildren()}insertAt(e,i,r){super.insertAt(e,i,r),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};EG.blotName="container",EG.scope=Si.BLOCK_BLOT;let Bht=EG;const b2=Bht;class $ht extends Jl{static formats(e,i){}format(e,i){super.formatAt(0,this.length(),e,i)}formatAt(e,i,r,n){e===0&&i===this.length()?this.format(r,n):super.formatAt(e,i,r,n)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const Ad=$ht,Vht={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},jht=100,$S=class extends Sh{constructor(e,i){super(null,i),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(r=>{this.update(r)}),this.observer.observe(this.domNode,Vht),this.attach()}create(e,i){return this.registry.create(this,e,i)}find(e,i=!1){const r=this.registry.find(e,i);return r?r.scroll===this?r:i?this.find(r.scroll.domNode.parentNode,!0):null:null}query(e,i=Si.ANY){return this.registry.query(e,i)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,i){this.update(),e===0&&i===this.length()?this.children.forEach(r=>{r.remove()}):super.deleteAt(e,i)}formatAt(e,i,r,n){this.update(),super.formatAt(e,i,r,n)}insertAt(e,i,r){this.update(),super.insertAt(e,i,r)}optimize(e=[],i={}){super.optimize(i);const r=i.mutationsMap||new WeakMap;let n=Array.from(this.observer.takeRecords());for(;n.length>0;)e.push(n.pop());const a=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(r.has(l.domNode)||r.set(l.domNode,[]),c&&a(l.parent))},s=l=>{r.has(l.domNode)&&(l instanceof Sh&&l.children.forEach(s),r.delete(l.domNode),l.optimize(i))};let o=e;for(let l=0;o.length>0;l+=1){if(l>=jht)throw new Error("[Parchment] Maximum optimize iterations reached");for(o.forEach(c=>{const u=this.find(c.target,!0);u!=null&&(u.domNode===c.target&&(c.type==="childList"?(a(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(d=>{const p=this.find(d,!1);a(p,!1),p instanceof Sh&&p.children.forEach(h=>{a(h,!1)})})):c.type==="attributes"&&a(u.prev)),a(u))}),this.children.forEach(s),o=Array.from(this.observer.takeRecords()),n=o.slice();n.length>0;)e.push(n.pop())}}update(e,i={}){e=e||this.observer.takeRecords();const r=new WeakMap;e.map(n=>{const a=this.find(n.target,!0);return a==null?null:r.has(a.domNode)?(r.get(a.domNode).push(n),null):(r.set(a.domNode,[n]),a)}).forEach(n=>{n!=null&&n!==this&&r.has(n.domNode)&&n.update(r.get(n.domNode)||[],i)}),i.mutationsMap=r,r.has(this.domNode)&&super.update(r.get(this.domNode),i),this.optimize(e,i)}};$S.blotName="scroll",$S.defaultChild=XC,$S.allowedChildren=[XC,b2],$S.scope=Si.BLOCK_BLOT,$S.tagName="DIV";let Ght=$S;const x9=Ght,PG=class KPe extends Jl{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,i){super(e,i),this.text=this.statics.value(this.domNode)}deleteAt(e,i){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+i)}index(e,i){return this.domNode===e?i:-1}insertAt(e,i,r){r==null?(this.text=this.text.slice(0,e)+i+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,i,r)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof KPe&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,i=!1){return[this.domNode,e]}split(e,i=!1){if(!i){if(e===0)return this;if(e===this.length())return this.next}const r=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(r,this.next||void 0),this.text=this.statics.value(this.domNode),r}update(e,i){e.some(r=>r.type==="characterData"&&r.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};PG.blotName="text",PG.scope=Si.INLINE_BLOT;let Hht=PG;const ok=Hht,zht=Object.freeze(Object.defineProperty({__proto__:null,Attributor:um,AttributorStore:y2,BlockBlot:XC,ClassAttributor:sf,ContainerBlot:b2,EmbedBlot:Ad,InlineBlot:O9,LeafBlot:Jl,ParentBlot:Sh,Registry:UU,Scope:Si,ScrollBlot:x9,StyleAttributor:nb,TextBlot:ok},Symbol.toStringTag,{value:"Module"}));var KM={exports:{}},g$,Qee;function qht(){if(Qee)return g$;Qee=1;var t=-1,e=1,i=0;function r(P,R,M,A,N){if(P===R)return P?[[i,P]]:[];if(M!=null){var k=C(P,R,M);if(k)return k}var x=o(P,R),O=P.substring(0,x);P=P.substring(x),R=R.substring(x),x=c(P,R);var V=P.substring(P.length-x);P=P.substring(0,P.length-x),R=R.substring(0,R.length-x);var F=n(P,R);return O&&F.unshift([i,O]),V&&F.push([i,V]),y(F,N),A&&d(F),F}function n(P,R){var M;if(!P)return[[e,R]];if(!R)return[[t,P]];var A=P.length>R.length?P:R,N=P.length>R.length?R:P,k=A.indexOf(N);if(k!==-1)return M=[[e,A.substring(0,k)],[i,N],[e,A.substring(k+N.length)]],P.length>R.length&&(M[0][0]=M[2][0]=t),M;if(N.length===1)return[[t,P],[e,R]];var x=u(P,R);if(x){var O=x[0],V=x[1],F=x[2],j=x[3],q=x[4],W=r(O,F),z=r(V,j);return W.concat([[i,q]],z)}return a(P,R)}function a(P,R){for(var M=P.length,A=R.length,N=Math.ceil((M+A)/2),k=N,x=2*N,O=new Array(x),V=new Array(x),F=0;F<x;F++)O[F]=-1,V[F]=-1;O[k+1]=0,V[k+1]=0;for(var j=M-A,q=j%2!==0,W=0,z=0,H=0,Z=0,J=0;J<N;J++){for(var ie=-J+W;ie<=J-z;ie+=2){var K=k+ie,ne;ie===-J||ie!==J&&O[K-1]<O[K+1]?ne=O[K+1]:ne=O[K-1]+1;for(var le=ne-ie;ne<M&&le<A&&P.charAt(ne)===R.charAt(le);)ne++,le++;if(O[K]=ne,ne>M)z+=2;else if(le>A)W+=2;else if(q){var re=k+j-ie;if(re>=0&&re<x&&V[re]!==-1){var me=M-V[re];if(ne>=me)return s(P,R,ne,le)}}}for(var he=-J+H;he<=J-Z;he+=2){var re=k+he,me;he===-J||he!==J&&V[re-1]<V[re+1]?me=V[re+1]:me=V[re-1]+1;for(var Ie=me-he;me<M&&Ie<A&&P.charAt(M-me-1)===R.charAt(A-Ie-1);)me++,Ie++;if(V[re]=me,me>M)Z+=2;else if(Ie>A)H+=2;else if(!q){var K=k+j-he;if(K>=0&&K<x&&O[K]!==-1){var ne=O[K],le=k+ne-K;if(me=M-me,ne>=me)return s(P,R,ne,le)}}}}return[[t,P],[e,R]]}function s(P,R,M,A){var N=P.substring(0,M),k=R.substring(0,A),x=P.substring(M),O=R.substring(A),V=r(N,k),F=r(x,O);return V.concat(F)}function o(P,R){if(!P||!R||P.charAt(0)!==R.charAt(0))return 0;for(var M=0,A=Math.min(P.length,R.length),N=A,k=0;M<N;)P.substring(k,N)==R.substring(k,N)?(M=N,k=M):A=N,N=Math.floor((A-M)/2+M);return b(P.charCodeAt(N-1))&&N--,N}function l(P,R){var M=P.length,A=R.length;if(M==0||A==0)return 0;M>A?P=P.substring(M-A):M<A&&(R=R.substring(0,M));var N=Math.min(M,A);if(P==R)return N;for(var k=0,x=1;;){var O=P.substring(N-x),V=R.indexOf(O);if(V==-1)return k;x+=V,(V==0||P.substring(N-x)==R.substring(0,x))&&(k=x,x++)}}function c(P,R){if(!P||!R||P.slice(-1)!==R.slice(-1))return 0;for(var M=0,A=Math.min(P.length,R.length),N=A,k=0;M<N;)P.substring(P.length-N,P.length-k)==R.substring(R.length-N,R.length-k)?(M=N,k=M):A=N,N=Math.floor((A-M)/2+M);return I(P.charCodeAt(P.length-N))&&N--,N}function u(P,R){var M=P.length>R.length?P:R,A=P.length>R.length?R:P;if(M.length<4||A.length*2<M.length)return null;function N(z,H,Z){for(var J=z.substring(Z,Z+Math.floor(z.length/4)),ie=-1,K="",ne,le,re,me;(ie=H.indexOf(J,ie+1))!==-1;){var he=o(z.substring(Z),H.substring(ie)),Ie=c(z.substring(0,Z),H.substring(0,ie));K.length<Ie+he&&(K=H.substring(ie-Ie,ie)+H.substring(ie,ie+he),ne=z.substring(0,Z-Ie),le=z.substring(Z+he),re=H.substring(0,ie-Ie),me=H.substring(ie+he))}return K.length*2>=z.length?[ne,le,re,me,K]:null}var k=N(M,A,Math.ceil(M.length/4)),x=N(M,A,Math.ceil(M.length/2)),O;if(!k&&!x)return null;x?k?O=k[4].length>x[4].length?k:x:O=x:O=k;var V,F,j,q;P.length>R.length?(V=O[0],F=O[1],j=O[2],q=O[3]):(j=O[0],q=O[1],V=O[2],F=O[3]);var W=O[4];return[V,F,j,q,W]}function d(P){for(var R=!1,M=[],A=0,N=null,k=0,x=0,O=0,V=0,F=0;k<P.length;)P[k][0]==i?(M[A++]=k,x=V,O=F,V=0,F=0,N=P[k][1]):(P[k][0]==e?V+=P[k][1].length:F+=P[k][1].length,N&&N.length<=Math.max(x,O)&&N.length<=Math.max(V,F)&&(P.splice(M[A-1],0,[t,N]),P[M[A-1]+1][0]=e,A--,A--,k=A>0?M[A-1]:-1,x=0,O=0,V=0,F=0,N=null,R=!0)),k++;for(R&&y(P),v(P),k=1;k<P.length;){if(P[k-1][0]==t&&P[k][0]==e){var j=P[k-1][1],q=P[k][1],W=l(j,q),z=l(q,j);W>=z?(W>=j.length/2||W>=q.length/2)&&(P.splice(k,0,[i,q.substring(0,W)]),P[k-1][1]=j.substring(0,j.length-W),P[k+1][1]=q.substring(W),k++):(z>=j.length/2||z>=q.length/2)&&(P.splice(k,0,[i,j.substring(0,z)]),P[k-1][0]=e,P[k-1][1]=q.substring(0,q.length-z),P[k+1][0]=t,P[k+1][1]=j.substring(z),k++),k++}k++}}var p=/[^a-zA-Z0-9]/,h=/\s/,f=/[\r\n]/,m=/\n\r?\n$/,g=/^\r?\n\r?\n/;function v(P){function R(z,H){if(!z||!H)return 6;var Z=z.charAt(z.length-1),J=H.charAt(0),ie=Z.match(p),K=J.match(p),ne=ie&&Z.match(h),le=K&&J.match(h),re=ne&&Z.match(f),me=le&&J.match(f),he=re&&z.match(m),Ie=me&&H.match(g);return he||Ie?5:re||me?4:ie&&!ne&&le?3:ne||le?2:ie||K?1:0}for(var M=1;M<P.length-1;){if(P[M-1][0]==i&&P[M+1][0]==i){var A=P[M-1][1],N=P[M][1],k=P[M+1][1],x=c(A,N);if(x){var O=N.substring(N.length-x);A=A.substring(0,A.length-x),N=O+N.substring(0,N.length-x),k=O+k}for(var V=A,F=N,j=k,q=R(A,N)+R(N,k);N.charAt(0)===k.charAt(0);){A+=N.charAt(0),N=N.substring(1)+k.charAt(0),k=k.substring(1);var W=R(A,N)+R(N,k);W>=q&&(q=W,V=A,F=N,j=k)}P[M-1][1]!=V&&(V?P[M-1][1]=V:(P.splice(M-1,1),M--),P[M][1]=F,j?P[M+1][1]=j:(P.splice(M+1,1),M--))}M++}}function y(P,R){P.push([i,""]);for(var M=0,A=0,N=0,k="",x="",O;M<P.length;){if(M<P.length-1&&!P[M][1]){P.splice(M,1);continue}switch(P[M][0]){case e:N++,x+=P[M][1],M++;break;case t:A++,k+=P[M][1],M++;break;case i:var V=M-N-A-1;if(R){if(V>=0&&T(P[V][1])){var F=P[V][1].slice(-1);if(P[V][1]=P[V][1].slice(0,-1),k=F+k,x=F+x,!P[V][1]){P.splice(V,1),M--;var j=V-1;P[j]&&P[j][0]===e&&(N++,x=P[j][1]+x,j--),P[j]&&P[j][0]===t&&(A++,k=P[j][1]+k,j--),V=j}}if(w(P[M][1])){var F=P[M][1].charAt(0);P[M][1]=P[M][1].slice(1),k+=F,x+=F}}if(M<P.length-1&&!P[M][1]){P.splice(M,1);break}if(k.length>0||x.length>0){k.length>0&&x.length>0&&(O=o(x,k),O!==0&&(V>=0?P[V][1]+=x.substring(0,O):(P.splice(0,0,[i,x.substring(0,O)]),M++),x=x.substring(O),k=k.substring(O)),O=c(x,k),O!==0&&(P[M][1]=x.substring(x.length-O)+P[M][1],x=x.substring(0,x.length-O),k=k.substring(0,k.length-O)));var q=N+A;k.length===0&&x.length===0?(P.splice(M-q,q),M=M-q):k.length===0?(P.splice(M-q,q,[e,x]),M=M-q+1):x.length===0?(P.splice(M-q,q,[t,k]),M=M-q+1):(P.splice(M-q,q,[t,k],[e,x]),M=M-q+2)}M!==0&&P[M-1][0]===i?(P[M-1][1]+=P[M][1],P.splice(M,1)):M++,N=0,A=0,k="",x="";break}}P[P.length-1][1]===""&&P.pop();var W=!1;for(M=1;M<P.length-1;)P[M-1][0]===i&&P[M+1][0]===i&&(P[M][1].substring(P[M][1].length-P[M-1][1].length)===P[M-1][1]?(P[M][1]=P[M-1][1]+P[M][1].substring(0,P[M][1].length-P[M-1][1].length),P[M+1][1]=P[M-1][1]+P[M+1][1],P.splice(M-1,1),W=!0):P[M][1].substring(0,P[M+1][1].length)==P[M+1][1]&&(P[M-1][1]+=P[M+1][1],P[M][1]=P[M][1].substring(P[M+1][1].length)+P[M+1][1],P.splice(M+1,1),W=!0)),M++;W&&y(P,R)}function b(P){return P>=55296&&P<=56319}function I(P){return P>=56320&&P<=57343}function w(P){return I(P.charCodeAt(0))}function T(P){return b(P.charCodeAt(P.length-1))}function S(P){for(var R=[],M=0;M<P.length;M++)P[M][1].length>0&&R.push(P[M]);return R}function D(P,R,M,A){return T(P)||w(A)?null:S([[i,P],[t,R],[e,M],[i,A]])}function C(P,R,M){var A=typeof M=="number"?{index:M,length:0}:M.oldRange,N=typeof M=="number"?null:M.newRange,k=P.length,x=R.length;if(A.length===0&&(N===null||N.length===0)){var O=A.index,V=P.slice(0,O),F=P.slice(O),j=N?N.index:null;e:{var q=O+x-k;if(j!==null&&j!==q||q<0||q>x)break e;var W=R.slice(0,q),z=R.slice(q);if(z!==F)break e;var H=Math.min(O,q),Z=V.slice(0,H),J=W.slice(0,H);if(Z!==J)break e;var ie=V.slice(H),K=W.slice(H);return D(Z,ie,K,F)}e:{if(j!==null&&j!==O)break e;var ne=O,W=R.slice(0,ne),z=R.slice(ne);if(W!==V)break e;var le=Math.min(k-ne,x-ne),re=F.slice(F.length-le),me=z.slice(z.length-le);if(re!==me)break e;var ie=F.slice(0,F.length-le),K=z.slice(0,z.length-le);return D(V,ie,K,re)}}if(A.length>0&&N&&N.length===0)e:{var Z=P.slice(0,A.index),re=P.slice(A.index+A.length),H=Z.length,le=re.length;if(x<H+le)break e;var J=R.slice(0,H),me=R.slice(x-le);if(Z!==J||re!==me)break e;var ie=P.slice(H,k-le),K=R.slice(H,x-le);return D(Z,ie,K,re)}return null}function E(P,R,M,A){return r(P,R,M,A,!0)}return E.INSERT=e,E.DELETE=t,E.EQUAL=i,g$=E,g$}var kE={exports:{}};kE.exports;var ete;function ZPe(){return ete||(ete=1,(function(t,e){var i=200,r="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",s="[object Array]",o="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object GeneratorFunction]",p="[object Map]",h="[object Number]",f="[object Object]",m="[object Promise]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object Symbol]",I="[object WeakMap]",w="[object ArrayBuffer]",T="[object DataView]",S="[object Float32Array]",D="[object Float64Array]",C="[object Int8Array]",E="[object Int16Array]",P="[object Int32Array]",R="[object Uint8Array]",M="[object Uint8ClampedArray]",A="[object Uint16Array]",N="[object Uint32Array]",k=/[\\^$.*+?()[\]{}|]/g,x=/\w*$/,O=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,F={};F[a]=F[s]=F[w]=F[T]=F[o]=F[l]=F[S]=F[D]=F[C]=F[E]=F[P]=F[p]=F[h]=F[f]=F[g]=F[v]=F[y]=F[b]=F[R]=F[M]=F[A]=F[N]=!0,F[c]=F[u]=F[I]=!1;var j=typeof Qm=="object"&&Qm&&Qm.Object===Object&&Qm,q=typeof self=="object"&&self&&self.Object===Object&&self,W=j||q||Function("return this")(),z=e&&!e.nodeType&&e,H=z&&!0&&t&&!t.nodeType&&t,Z=H&&H.exports===z;function J(Q,fe){return Q.set(fe[0],fe[1]),Q}function ie(Q,fe){return Q.add(fe),Q}function K(Q,fe){for(var Ue=-1,tt=Q?Q.length:0;++Ue<tt&&fe(Q[Ue],Ue,Q)!==!1;);return Q}function ne(Q,fe){for(var Ue=-1,tt=fe.length,Yi=Q.length;++Ue<tt;)Q[Yi+Ue]=fe[Ue];return Q}function le(Q,fe,Ue,tt){for(var Yi=-1,wi=Q?Q.length:0;++Yi<wi;)Ue=fe(Ue,Q[Yi],Yi,Q);return Ue}function re(Q,fe){for(var Ue=-1,tt=Array(Q);++Ue<Q;)tt[Ue]=fe(Ue);return tt}function me(Q,fe){return Q?.[fe]}function he(Q){var fe=!1;if(Q!=null&&typeof Q.toString!="function")try{fe=!!(Q+"")}catch{}return fe}function Ie(Q){var fe=-1,Ue=Array(Q.size);return Q.forEach(function(tt,Yi){Ue[++fe]=[Yi,tt]}),Ue}function Le(Q,fe){return function(Ue){return Q(fe(Ue))}}function ot(Q){var fe=-1,Ue=Array(Q.size);return Q.forEach(function(tt){Ue[++fe]=tt}),Ue}var at=Array.prototype,dt=Function.prototype,It=Object.prototype,ze=W["__core-js_shared__"],Ct=(function(){var Q=/[^.]+$/.exec(ze&&ze.keys&&ze.keys.IE_PROTO||"");return Q?"Symbol(src)_1."+Q:""})(),ke=dt.toString,mt=It.hasOwnProperty,Be=It.toString,ut=RegExp("^"+ke.call(mt).replace(k,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=Z?W.Buffer:void 0,xe=W.Symbol,Ze=W.Uint8Array,st=Le(Object.getPrototypeOf,Object),qe=Object.create,ft=It.propertyIsEnumerable,_t=at.splice,ve=Object.getOwnPropertySymbols,$e=it?it.isBuffer:void 0,De=Le(Object.keys,Object),je=mn(W,"DataView"),Oe=mn(W,"Map"),nt=mn(W,"Promise"),Fe=mn(W,"Set"),wt=mn(W,"WeakMap"),pt=mn(Object,"create"),Mt=ga(je),Wi=ga(Oe),Qt=ga(nt),tr=ga(Fe),Vi=ga(wt),$i=xe?xe.prototype:void 0,Wr=$i?$i.valueOf:void 0;function Yn(Q){var fe=-1,Ue=Q?Q.length:0;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function $l(){this.__data__=pt?pt(null):{}}function tn(Q){return this.has(Q)&&delete this.__data__[Q]}function rn(Q){var fe=this.__data__;if(pt){var Ue=fe[Q];return Ue===r?void 0:Ue}return mt.call(fe,Q)?fe[Q]:void 0}function ha(Q){var fe=this.__data__;return pt?fe[Q]!==void 0:mt.call(fe,Q)}function Jt(Q,fe){var Ue=this.__data__;return Ue[Q]=pt&&fe===void 0?r:fe,this}Yn.prototype.clear=$l,Yn.prototype.delete=tn,Yn.prototype.get=rn,Yn.prototype.has=ha,Yn.prototype.set=Jt;function sr(Q){var fe=-1,Ue=Q?Q.length:0;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function Vl(){this.__data__=[]}function nd(Q){var fe=this.__data__,Ue=zl(fe,Q);if(Ue<0)return!1;var tt=fe.length-1;return Ue==tt?fe.pop():_t.call(fe,Ue,1),!0}function Uo(Q){var fe=this.__data__,Ue=zl(fe,Q);return Ue<0?void 0:fe[Ue][1]}function Hs(Q){return zl(this.__data__,Q)>-1}function zs(Q,fe){var Ue=this.__data__,tt=zl(Ue,Q);return tt<0?Ue.push([Q,fe]):Ue[tt][1]=fe,this}sr.prototype.clear=Vl,sr.prototype.delete=nd,sr.prototype.get=Uo,sr.prototype.has=Hs,sr.prototype.set=zs;function yn(Q){var fe=-1,Ue=Q?Q.length:0;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function wc(){this.__data__={hash:new Yn,map:new(Oe||sr),string:new Yn}}function jl(Q){return Mi(this,Q).delete(Q)}function cf(Q){return Mi(this,Q).get(Q)}function Sc(Q){return Mi(this,Q).has(Q)}function jp(Q,fe){return Mi(this,Q).set(Q,fe),this}yn.prototype.clear=wc,yn.prototype.delete=jl,yn.prototype.get=cf,yn.prototype.has=Sc,yn.prototype.set=jp;function fa(Q){this.__data__=new sr(Q)}function $n(){this.__data__=new sr}function $o(Q){return this.__data__.delete(Q)}function cl(Q){return this.__data__.get(Q)}function uf(Q){return this.__data__.has(Q)}function Gl(Q,fe){var Ue=this.__data__;if(Ue instanceof sr){var tt=Ue.__data__;if(!Oe||tt.length<i-1)return tt.push([Q,fe]),this;Ue=this.__data__=new yn(tt)}return Ue.set(Q,fe),this}fa.prototype.clear=$n,fa.prototype.delete=$o,fa.prototype.get=cl,fa.prototype.has=uf,fa.prototype.set=Gl;function Hl(Q,fe){var Ue=va(Q)||ni(Q)?re(Q.length,String):[],tt=Ue.length,Yi=!!tt;for(var wi in Q)mt.call(Q,wi)&&!(Yi&&(wi=="length"||df(wi,tt)))&&Ue.push(wi);return Ue}function Od(Q,fe,Ue){var tt=Q[fe];(!(mt.call(Q,fe)&&km(tt,Ue))||Ue===void 0&&!(fe in Q))&&(Q[fe]=Ue)}function zl(Q,fe){for(var Ue=Q.length;Ue--;)if(km(Q[Ue][0],fe))return Ue;return-1}function ma(Q,fe){return Q&&Xe(fe,du(fe),Q)}function ou(Q,fe,Ue,tt,Yi,wi,Rr){var Zt;if(tt&&(Zt=wi?tt(Q,Yi,wi,Rr):tt(Q)),Zt!==void 0)return Zt;if(!Vn(Q))return Q;var Sa=va(Q);if(Sa){if(Zt=gr(Q),!fe)return ad(Q,Zt)}else{var ur=Uc(Q),Ka=ur==u||ur==d;if(Ld(Q))return ns(Q,fe);if(ur==f||ur==a||Ka&&!wi){if(he(Q))return wi?Q:{};if(Zt=dl(Ka?{}:Q),!fe)return di(Q,ma(Zt,Q))}else{if(!F[ur])return wi?Q:{};Zt=_m(Q,ur,ou,fe)}}Rr||(Rr=new fa);var Do=Rr.get(Q);if(Do)return Do;if(Rr.set(Q,Zt),!Sa)var Aa=Ue?Ri(Q):du(Q);return K(Aa||Q,function(Za,Us){Aa&&(Us=Za,Za=Q[Us]),Od(Zt,Us,ou(Za,fe,Ue,tt,Us,Q,Rr))}),Zt}function lu(Q){return Vn(Q)?qe(Q):{}}function Tc(Q,fe,Ue){var tt=fe(Q);return va(Q)?tt:ne(tt,Ue(Q))}function Kt(Q){return Be.call(Q)}function Mn(Q){if(!Vn(Q)||cu(Q))return!1;var fe=Vo(Q)||he(Q)?ut:O;return fe.test(ga(Q))}function ul(Q){if(!uu(Q))return De(Q);var fe=[];for(var Ue in Object(Q))mt.call(Q,Ue)&&Ue!="constructor"&&fe.push(Ue);return fe}function ns(Q,fe){if(fe)return Q.slice();var Ue=new Q.constructor(Q.length);return Q.copy(Ue),Ue}function to(Q){var fe=new Q.constructor(Q.byteLength);return new Ze(fe).set(new Ze(Q)),fe}function Ts(Q,fe){var Ue=fe?to(Q.buffer):Q.buffer;return new Q.constructor(Ue,Q.byteOffset,Q.byteLength)}function ki(Q,fe,Ue){var tt=fe?Ue(Ie(Q),!0):Ie(Q);return le(tt,J,new Q.constructor)}function fn(Q){var fe=new Q.constructor(Q.source,x.exec(Q));return fe.lastIndex=Q.lastIndex,fe}function Zr(Q,fe,Ue){var tt=fe?Ue(ot(Q),!0):ot(Q);return le(tt,ie,new Q.constructor)}function ql(Q){return Wr?Object(Wr.call(Q)):{}}function Ya(Q,fe){var Ue=fe?to(Q.buffer):Q.buffer;return new Q.constructor(Ue,Q.byteOffset,Q.length)}function ad(Q,fe){var Ue=-1,tt=Q.length;for(fe||(fe=Array(tt));++Ue<tt;)fe[Ue]=Q[Ue];return fe}function Xe(Q,fe,Ue,tt){Ue||(Ue={});for(var Yi=-1,wi=fe.length;++Yi<wi;){var Rr=fe[Yi],Zt=void 0;Od(Ue,Rr,Zt===void 0?Q[Rr]:Zt)}return Ue}function di(Q,fe){return Xe(Q,Ma(Q),fe)}function Ri(Q){return Tc(Q,du,Ma)}function Mi(Q,fe){var Ue=Q.__data__;return qs(fe)?Ue[typeof fe=="string"?"string":"hash"]:Ue.map}function mn(Q,fe){var Ue=me(Q,fe);return Mn(Ue)?Ue:void 0}var Ma=ve?Le(ve,Object):Na,Uc=Kt;(je&&Uc(new je(new ArrayBuffer(1)))!=T||Oe&&Uc(new Oe)!=p||nt&&Uc(nt.resolve())!=m||Fe&&Uc(new Fe)!=v||wt&&Uc(new wt)!=I)&&(Uc=function(Q){var fe=Be.call(Q),Ue=fe==f?Q.constructor:void 0,tt=Ue?ga(Ue):void 0;if(tt)switch(tt){case Mt:return T;case Wi:return p;case Qt:return m;case tr:return v;case Vi:return I}return fe});function gr(Q){var fe=Q.length,Ue=Q.constructor(fe);return fe&&typeof Q[0]=="string"&&mt.call(Q,"index")&&(Ue.index=Q.index,Ue.input=Q.input),Ue}function dl(Q){return typeof Q.constructor=="function"&&!uu(Q)?lu(st(Q)):{}}function _m(Q,fe,Ue,tt){var Yi=Q.constructor;switch(fe){case w:return to(Q);case o:case l:return new Yi(+Q);case T:return Ts(Q,tt);case S:case D:case C:case E:case P:case R:case M:case A:case N:return Ya(Q,tt);case p:return ki(Q,tt,Ue);case h:case y:return new Yi(Q);case g:return fn(Q);case v:return Zr(Q,tt,Ue);case b:return ql(Q)}}function df(Q,fe){return fe=fe??n,!!fe&&(typeof Q=="number"||V.test(Q))&&Q>-1&&Q%1==0&&Q<fe}function qs(Q){var fe=typeof Q;return fe=="string"||fe=="number"||fe=="symbol"||fe=="boolean"?Q!=="__proto__":Q===null}function cu(Q){return!!Ct&&Ct in Q}function uu(Q){var fe=Q&&Q.constructor,Ue=typeof fe=="function"&&fe.prototype||It;return Q===Ue}function ga(Q){if(Q!=null){try{return ke.call(Q)}catch{}try{return Q+""}catch{}}return""}function Gp(Q){return ou(Q,!0,!0)}function km(Q,fe){return Q===fe||Q!==Q&&fe!==fe}function ni(Q){return xd(Q)&&mt.call(Q,"callee")&&(!ft.call(Q,"callee")||Be.call(Q)==a)}var va=Array.isArray;function Ar(Q){return Q!=null&&pf(Q.length)&&!Vo(Q)}function xd(Q){return Fd(Q)&&Ar(Q)}var Ld=$e||pl;function Vo(Q){var fe=Vn(Q)?Be.call(Q):"";return fe==u||fe==d}function pf(Q){return typeof Q=="number"&&Q>-1&&Q%1==0&&Q<=n}function Vn(Q){var fe=typeof Q;return!!Q&&(fe=="object"||fe=="function")}function Fd(Q){return!!Q&&typeof Q=="object"}function du(Q){return Ar(Q)?Hl(Q):ul(Q)}function Na(){return[]}function pl(){return!1}t.exports=Gp})(kE,kE.exports)),kE.exports}var OE={exports:{}};OE.exports;var tte;function XPe(){return tte||(tte=1,(function(t,e){var i=200,r="__lodash_hash_undefined__",n=1,a=2,s=9007199254740991,o="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",f="[object GeneratorFunction]",m="[object Map]",g="[object Number]",v="[object Null]",y="[object Object]",b="[object Promise]",I="[object Proxy]",w="[object RegExp]",T="[object Set]",S="[object String]",D="[object Symbol]",C="[object Undefined]",E="[object WeakMap]",P="[object ArrayBuffer]",R="[object DataView]",M="[object Float32Array]",A="[object Float64Array]",N="[object Int8Array]",k="[object Int16Array]",x="[object Int32Array]",O="[object Uint8Array]",V="[object Uint8ClampedArray]",F="[object Uint16Array]",j="[object Uint32Array]",q=/[\\^$.*+?()[\]{}|]/g,W=/^\[object .+?Constructor\]$/,z=/^(?:0|[1-9]\d*)$/,H={};H[M]=H[A]=H[N]=H[k]=H[x]=H[O]=H[V]=H[F]=H[j]=!0,H[o]=H[l]=H[P]=H[u]=H[R]=H[d]=H[p]=H[h]=H[m]=H[g]=H[y]=H[w]=H[T]=H[S]=H[E]=!1;var Z=typeof Qm=="object"&&Qm&&Qm.Object===Object&&Qm,J=typeof self=="object"&&self&&self.Object===Object&&self,ie=Z||J||Function("return this")(),K=e&&!e.nodeType&&e,ne=K&&!0&&t&&!t.nodeType&&t,le=ne&&ne.exports===K,re=le&&Z.process,me=(function(){try{return re&&re.binding&&re.binding("util")}catch{}})(),he=me&&me.isTypedArray;function Ie(Q,fe){for(var Ue=-1,tt=Q==null?0:Q.length,Yi=0,wi=[];++Ue<tt;){var Rr=Q[Ue];fe(Rr,Ue,Q)&&(wi[Yi++]=Rr)}return wi}function Le(Q,fe){for(var Ue=-1,tt=fe.length,Yi=Q.length;++Ue<tt;)Q[Yi+Ue]=fe[Ue];return Q}function ot(Q,fe){for(var Ue=-1,tt=Q==null?0:Q.length;++Ue<tt;)if(fe(Q[Ue],Ue,Q))return!0;return!1}function at(Q,fe){for(var Ue=-1,tt=Array(Q);++Ue<Q;)tt[Ue]=fe(Ue);return tt}function dt(Q){return function(fe){return Q(fe)}}function It(Q,fe){return Q.has(fe)}function ze(Q,fe){return Q?.[fe]}function Ct(Q){var fe=-1,Ue=Array(Q.size);return Q.forEach(function(tt,Yi){Ue[++fe]=[Yi,tt]}),Ue}function ke(Q,fe){return function(Ue){return Q(fe(Ue))}}function mt(Q){var fe=-1,Ue=Array(Q.size);return Q.forEach(function(tt){Ue[++fe]=tt}),Ue}var Be=Array.prototype,ut=Function.prototype,it=Object.prototype,xe=ie["__core-js_shared__"],Ze=ut.toString,st=it.hasOwnProperty,qe=(function(){var Q=/[^.]+$/.exec(xe&&xe.keys&&xe.keys.IE_PROTO||"");return Q?"Symbol(src)_1."+Q:""})(),ft=it.toString,_t=RegExp("^"+Ze.call(st).replace(q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ve=le?ie.Buffer:void 0,$e=ie.Symbol,De=ie.Uint8Array,je=it.propertyIsEnumerable,Oe=Be.splice,nt=$e?$e.toStringTag:void 0,Fe=Object.getOwnPropertySymbols,wt=ve?ve.isBuffer:void 0,pt=ke(Object.keys,Object),Mt=Ma(ie,"DataView"),Wi=Ma(ie,"Map"),Qt=Ma(ie,"Promise"),tr=Ma(ie,"Set"),Vi=Ma(ie,"WeakMap"),$i=Ma(Object,"create"),Wr=ga(Mt),Yn=ga(Wi),$l=ga(Qt),tn=ga(tr),rn=ga(Vi),ha=$e?$e.prototype:void 0,Jt=ha?ha.valueOf:void 0;function sr(Q){var fe=-1,Ue=Q==null?0:Q.length;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function Vl(){this.__data__=$i?$i(null):{},this.size=0}function nd(Q){var fe=this.has(Q)&&delete this.__data__[Q];return this.size-=fe?1:0,fe}function Uo(Q){var fe=this.__data__;if($i){var Ue=fe[Q];return Ue===r?void 0:Ue}return st.call(fe,Q)?fe[Q]:void 0}function Hs(Q){var fe=this.__data__;return $i?fe[Q]!==void 0:st.call(fe,Q)}function zs(Q,fe){var Ue=this.__data__;return this.size+=this.has(Q)?0:1,Ue[Q]=$i&&fe===void 0?r:fe,this}sr.prototype.clear=Vl,sr.prototype.delete=nd,sr.prototype.get=Uo,sr.prototype.has=Hs,sr.prototype.set=zs;function yn(Q){var fe=-1,Ue=Q==null?0:Q.length;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function wc(){this.__data__=[],this.size=0}function jl(Q){var fe=this.__data__,Ue=ns(fe,Q);if(Ue<0)return!1;var tt=fe.length-1;return Ue==tt?fe.pop():Oe.call(fe,Ue,1),--this.size,!0}function cf(Q){var fe=this.__data__,Ue=ns(fe,Q);return Ue<0?void 0:fe[Ue][1]}function Sc(Q){return ns(this.__data__,Q)>-1}function jp(Q,fe){var Ue=this.__data__,tt=ns(Ue,Q);return tt<0?(++this.size,Ue.push([Q,fe])):Ue[tt][1]=fe,this}yn.prototype.clear=wc,yn.prototype.delete=jl,yn.prototype.get=cf,yn.prototype.has=Sc,yn.prototype.set=jp;function fa(Q){var fe=-1,Ue=Q==null?0:Q.length;for(this.clear();++fe<Ue;){var tt=Q[fe];this.set(tt[0],tt[1])}}function $n(){this.size=0,this.__data__={hash:new sr,map:new(Wi||yn),string:new sr}}function $o(Q){var fe=mn(this,Q).delete(Q);return this.size-=fe?1:0,fe}function cl(Q){return mn(this,Q).get(Q)}function uf(Q){return mn(this,Q).has(Q)}function Gl(Q,fe){var Ue=mn(this,Q),tt=Ue.size;return Ue.set(Q,fe),this.size+=Ue.size==tt?0:1,this}fa.prototype.clear=$n,fa.prototype.delete=$o,fa.prototype.get=cl,fa.prototype.has=uf,fa.prototype.set=Gl;function Hl(Q){var fe=-1,Ue=Q==null?0:Q.length;for(this.__data__=new fa;++fe<Ue;)this.add(Q[fe])}function Od(Q){return this.__data__.set(Q,r),this}function zl(Q){return this.__data__.has(Q)}Hl.prototype.add=Hl.prototype.push=Od,Hl.prototype.has=zl;function ma(Q){var fe=this.__data__=new yn(Q);this.size=fe.size}function ou(){this.__data__=new yn,this.size=0}function lu(Q){var fe=this.__data__,Ue=fe.delete(Q);return this.size=fe.size,Ue}function Tc(Q){return this.__data__.get(Q)}function Kt(Q){return this.__data__.has(Q)}function Mn(Q,fe){var Ue=this.__data__;if(Ue instanceof yn){var tt=Ue.__data__;if(!Wi||tt.length<i-1)return tt.push([Q,fe]),this.size=++Ue.size,this;Ue=this.__data__=new fa(tt)}return Ue.set(Q,fe),this.size=Ue.size,this}ma.prototype.clear=ou,ma.prototype.delete=lu,ma.prototype.get=Tc,ma.prototype.has=Kt,ma.prototype.set=Mn;function ul(Q,fe){var Ue=ni(Q),tt=!Ue&&km(Q),Yi=!Ue&&!tt&&Ar(Q),wi=!Ue&&!tt&&!Yi&&Fd(Q),Rr=Ue||tt||Yi||wi,Zt=Rr?at(Q.length,String):[],Sa=Zt.length;for(var ur in Q)st.call(Q,ur)&&!(Rr&&(ur=="length"||Yi&&(ur=="offset"||ur=="parent")||wi&&(ur=="buffer"||ur=="byteLength"||ur=="byteOffset")||_m(ur,Sa)))&&Zt.push(ur);return Zt}function ns(Q,fe){for(var Ue=Q.length;Ue--;)if(Gp(Q[Ue][0],fe))return Ue;return-1}function to(Q,fe,Ue){var tt=fe(Q);return ni(Q)?tt:Le(tt,Ue(Q))}function Ts(Q){return Q==null?Q===void 0?C:v:nt&&nt in Object(Q)?Uc(Q):uu(Q)}function ki(Q){return Vn(Q)&&Ts(Q)==o}function fn(Q,fe,Ue,tt,Yi){return Q===fe?!0:Q==null||fe==null||!Vn(Q)&&!Vn(fe)?Q!==Q&&fe!==fe:Zr(Q,fe,Ue,tt,fn,Yi)}function Zr(Q,fe,Ue,tt,Yi,wi){var Rr=ni(Q),Zt=ni(fe),Sa=Rr?l:dl(Q),ur=Zt?l:dl(fe);Sa=Sa==o?y:Sa,ur=ur==o?y:ur;var Ka=Sa==y,Do=ur==y,Aa=Sa==ur;if(Aa&&Ar(Q)){if(!Ar(fe))return!1;Rr=!0,Ka=!1}if(Aa&&!Ka)return wi||(wi=new ma),Rr||Fd(Q)?Xe(Q,fe,Ue,tt,Yi,wi):di(Q,fe,Sa,Ue,tt,Yi,wi);if(!(Ue&n)){var Za=Ka&&st.call(Q,"__wrapped__"),Us=Do&&st.call(fe,"__wrapped__");if(Za||Us){var Wl=Za?Q.value():Q,Yl=Us?fe.value():fe;return wi||(wi=new ma),Yi(Wl,Yl,Ue,tt,wi)}}return Aa?(wi||(wi=new ma),Ri(Q,fe,Ue,tt,Yi,wi)):!1}function ql(Q){if(!pf(Q)||qs(Q))return!1;var fe=Ld(Q)?_t:W;return fe.test(ga(Q))}function Ya(Q){return Vn(Q)&&Vo(Q.length)&&!!H[Ts(Q)]}function ad(Q){if(!cu(Q))return pt(Q);var fe=[];for(var Ue in Object(Q))st.call(Q,Ue)&&Ue!="constructor"&&fe.push(Ue);return fe}function Xe(Q,fe,Ue,tt,Yi,wi){var Rr=Ue&n,Zt=Q.length,Sa=fe.length;if(Zt!=Sa&&!(Rr&&Sa>Zt))return!1;var ur=wi.get(Q);if(ur&&wi.get(fe))return ur==fe;var Ka=-1,Do=!0,Aa=Ue&a?new Hl:void 0;for(wi.set(Q,fe),wi.set(fe,Q);++Ka<Zt;){var Za=Q[Ka],Us=fe[Ka];if(tt)var Wl=Rr?tt(Us,Za,Ka,fe,Q,wi):tt(Za,Us,Ka,Q,fe,wi);if(Wl!==void 0){if(Wl)continue;Do=!1;break}if(Aa){if(!ot(fe,function(Yl,pu){if(!It(Aa,pu)&&(Za===Yl||Yi(Za,Yl,Ue,tt,wi)))return Aa.push(pu)})){Do=!1;break}}else if(!(Za===Us||Yi(Za,Us,Ue,tt,wi))){Do=!1;break}}return wi.delete(Q),wi.delete(fe),Do}function di(Q,fe,Ue,tt,Yi,wi,Rr){switch(Ue){case R:if(Q.byteLength!=fe.byteLength||Q.byteOffset!=fe.byteOffset)return!1;Q=Q.buffer,fe=fe.buffer;case P:return!(Q.byteLength!=fe.byteLength||!wi(new De(Q),new De(fe)));case u:case d:case g:return Gp(+Q,+fe);case p:return Q.name==fe.name&&Q.message==fe.message;case w:case S:return Q==fe+"";case m:var Zt=Ct;case T:var Sa=tt&n;if(Zt||(Zt=mt),Q.size!=fe.size&&!Sa)return!1;var ur=Rr.get(Q);if(ur)return ur==fe;tt|=a,Rr.set(Q,fe);var Ka=Xe(Zt(Q),Zt(fe),tt,Yi,wi,Rr);return Rr.delete(Q),Ka;case D:if(Jt)return Jt.call(Q)==Jt.call(fe)}return!1}function Ri(Q,fe,Ue,tt,Yi,wi){var Rr=Ue&n,Zt=Mi(Q),Sa=Zt.length,ur=Mi(fe),Ka=ur.length;if(Sa!=Ka&&!Rr)return!1;for(var Do=Sa;Do--;){var Aa=Zt[Do];if(!(Rr?Aa in fe:st.call(fe,Aa)))return!1}var Za=wi.get(Q);if(Za&&wi.get(fe))return Za==fe;var Us=!0;wi.set(Q,fe),wi.set(fe,Q);for(var Wl=Rr;++Do<Sa;){Aa=Zt[Do];var Yl=Q[Aa],pu=fe[Aa];if(tt)var Om=Rr?tt(pu,Yl,Aa,fe,Q,wi):tt(Yl,pu,Aa,Q,fe,wi);if(!(Om===void 0?Yl===pu||Yi(Yl,pu,Ue,tt,wi):Om)){Us=!1;break}Wl||(Wl=Aa=="constructor")}if(Us&&!Wl){var nv=Q.constructor,Ds=fe.constructor;nv!=Ds&&"constructor"in Q&&"constructor"in fe&&!(typeof nv=="function"&&nv instanceof nv&&typeof Ds=="function"&&Ds instanceof Ds)&&(Us=!1)}return wi.delete(Q),wi.delete(fe),Us}function Mi(Q){return to(Q,du,gr)}function mn(Q,fe){var Ue=Q.__data__;return df(fe)?Ue[typeof fe=="string"?"string":"hash"]:Ue.map}function Ma(Q,fe){var Ue=ze(Q,fe);return ql(Ue)?Ue:void 0}function Uc(Q){var fe=st.call(Q,nt),Ue=Q[nt];try{Q[nt]=void 0;var tt=!0}catch{}var Yi=ft.call(Q);return tt&&(fe?Q[nt]=Ue:delete Q[nt]),Yi}var gr=Fe?function(Q){return Q==null?[]:(Q=Object(Q),Ie(Fe(Q),function(fe){return je.call(Q,fe)}))}:Na,dl=Ts;(Mt&&dl(new Mt(new ArrayBuffer(1)))!=R||Wi&&dl(new Wi)!=m||Qt&&dl(Qt.resolve())!=b||tr&&dl(new tr)!=T||Vi&&dl(new Vi)!=E)&&(dl=function(Q){var fe=Ts(Q),Ue=fe==y?Q.constructor:void 0,tt=Ue?ga(Ue):"";if(tt)switch(tt){case Wr:return R;case Yn:return m;case $l:return b;case tn:return T;case rn:return E}return fe});function _m(Q,fe){return fe=fe??s,!!fe&&(typeof Q=="number"||z.test(Q))&&Q>-1&&Q%1==0&&Q<fe}function df(Q){var fe=typeof Q;return fe=="string"||fe=="number"||fe=="symbol"||fe=="boolean"?Q!=="__proto__":Q===null}function qs(Q){return!!qe&&qe in Q}function cu(Q){var fe=Q&&Q.constructor,Ue=typeof fe=="function"&&fe.prototype||it;return Q===Ue}function uu(Q){return ft.call(Q)}function ga(Q){if(Q!=null){try{return Ze.call(Q)}catch{}try{return Q+""}catch{}}return""}function Gp(Q,fe){return Q===fe||Q!==Q&&fe!==fe}var km=ki((function(){return arguments})())?ki:function(Q){return Vn(Q)&&st.call(Q,"callee")&&!je.call(Q,"callee")},ni=Array.isArray;function va(Q){return Q!=null&&Vo(Q.length)&&!Ld(Q)}var Ar=wt||pl;function xd(Q,fe){return fn(Q,fe)}function Ld(Q){if(!pf(Q))return!1;var fe=Ts(Q);return fe==h||fe==f||fe==c||fe==I}function Vo(Q){return typeof Q=="number"&&Q>-1&&Q%1==0&&Q<=s}function pf(Q){var fe=typeof Q;return Q!=null&&(fe=="object"||fe=="function")}function Vn(Q){return Q!=null&&typeof Q=="object"}var Fd=he?dt(he):Ya;function du(Q){return va(Q)?ul(Q):ad(Q)}function Na(){return[]}function pl(){return!1}t.exports=xd})(OE,OE.exports)),OE.exports}var ZM={},ite;function Wht(){if(ite)return ZM;ite=1,Object.defineProperty(ZM,"__esModule",{value:!0});const t=ZPe(),e=XPe();var i;return(function(r){function n(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let d=t(c);u||(d=Object.keys(d).reduce((p,h)=>(d[h]!=null&&(p[h]=d[h]),p),{}));for(const p in l)l[p]!==void 0&&c[p]===void 0&&(d[p]=l[p]);return Object.keys(d).length>0?d:void 0}r.compose=n;function a(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((d,p)=>(e(l[p],c[p])||(d[p]=c[p]===void 0?null:c[p]),d),{});return Object.keys(u).length>0?u:void 0}r.diff=a;function s(l={},c={}){l=l||{};const u=Object.keys(c).reduce((d,p)=>(c[p]!==l[p]&&l[p]!==void 0&&(d[p]=c[p]),d),{});return Object.keys(l).reduce((d,p)=>(l[p]!==c[p]&&c[p]===void 0&&(d[p]=null),d),u)}r.invert=s;function o(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const d=Object.keys(c).reduce((p,h)=>(l[h]===void 0&&(p[h]=c[h]),p),{});return Object.keys(d).length>0?d:void 0}r.transform=o})(i||(i={})),ZM.default=i,ZM}var XM={},rte;function JPe(){if(rte)return XM;rte=1,Object.defineProperty(XM,"__esModule",{value:!0});var t;return(function(e){function i(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=i})(t||(t={})),XM.default=t,XM}var JM={},nte;function Yht(){if(nte)return JM;nte=1,Object.defineProperty(JM,"__esModule",{value:!0});const t=JPe();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const n=this.ops[this.index];if(n){const a=this.offset,s=t.default.length(n);if(r>=s-a?(r=s-a,this.index+=1,this.offset=0):this.offset+=r,typeof n.delete=="number")return{delete:r};{const o={};return n.attributes&&(o.attributes=n.attributes),typeof n.retain=="number"?o.retain=r:typeof n.retain=="object"&&n.retain!==null?o.retain=n.retain:typeof n.insert=="string"?o.insert=n.insert.substr(a,r):o.insert=n.insert,o}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,n=this.index,a=this.next(),s=this.ops.slice(this.index);return this.offset=r,this.index=n,[a].concat(s)}}else return[]}}return JM.default=e,JM}var ate;function Kht(){return ate||(ate=1,(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const i=qht(),r=ZPe(),n=XPe(),a=Wht();e.AttributeMap=a.default;const s=JPe();e.Op=s.default;const o=Yht();e.OpIterator=o.default;const l="\0",c=(d,p)=>{if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);if(typeof p!="object"||p===null)throw new Error(`cannot retain a ${typeof p}`);const h=Object.keys(d)[0];if(!h||h!==Object.keys(p)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(p)[0]}`);return[h,d[h],p[h]]};class u{constructor(p){Array.isArray(p)?this.ops=p:p!=null&&Array.isArray(p.ops)?this.ops=p.ops:this.ops=[]}static registerEmbed(p,h){this.handlers[p]=h}static unregisterEmbed(p){delete this.handlers[p]}static getHandler(p){const h=this.handlers[p];if(!h)throw new Error(`no handlers for embed type "${p}"`);return h}insert(p,h){const f={};return typeof p=="string"&&p.length===0?this:(f.insert=p,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f))}delete(p){return p<=0?this:this.push({delete:p})}retain(p,h){if(typeof p=="number"&&p<=0)return this;const f={retain:p};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(f.attributes=h),this.push(f)}push(p){let h=this.ops.length,f=this.ops[h-1];if(p=r(p),typeof f=="object"){if(typeof p.delete=="number"&&typeof f.delete=="number")return this.ops[h-1]={delete:f.delete+p.delete},this;if(typeof f.delete=="number"&&p.insert!=null&&(h-=1,f=this.ops[h-1],typeof f!="object"))return this.ops.unshift(p),this;if(n(p.attributes,f.attributes)){if(typeof p.insert=="string"&&typeof f.insert=="string")return this.ops[h-1]={insert:f.insert+p.insert},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this;if(typeof p.retain=="number"&&typeof f.retain=="number")return this.ops[h-1]={retain:f.retain+p.retain},typeof p.attributes=="object"&&(this.ops[h-1].attributes=p.attributes),this}}return h===this.ops.length?this.ops.push(p):this.ops.splice(h,0,p),this}chop(){const p=this.ops[this.ops.length-1];return p&&typeof p.retain=="number"&&!p.attributes&&this.ops.pop(),this}filter(p){return this.ops.filter(p)}forEach(p){this.ops.forEach(p)}map(p){return this.ops.map(p)}partition(p){const h=[],f=[];return this.forEach(m=>{(p(m)?h:f).push(m)}),[h,f]}reduce(p,h){return this.ops.reduce(p,h)}changeLength(){return this.reduce((p,h)=>h.insert?p+s.default.length(h):h.delete?p-h.delete:p,0)}length(){return this.reduce((p,h)=>p+s.default.length(h),0)}slice(p=0,h=1/0){const f=[],m=new o.default(this.ops);let g=0;for(;g<h&&m.hasNext();){let v;g<p?v=m.next(p-g):(v=m.next(h-g),f.push(v)),g+=s.default.length(v)}return new u(f)}compose(p){const h=new o.default(this.ops),f=new o.default(p.ops),m=[],g=f.peek();if(g!=null&&typeof g.retain=="number"&&g.attributes==null){let y=g.retain;for(;h.peekType()==="insert"&&h.peekLength()<=y;)y-=h.peekLength(),m.push(h.next());g.retain-y>0&&f.next(g.retain-y)}const v=new u(m);for(;h.hasNext()||f.hasNext();)if(f.peekType()==="insert")v.push(f.next());else if(h.peekType()==="delete")v.push(h.next());else{const y=Math.min(h.peekLength(),f.peekLength()),b=h.next(y),I=f.next(y);if(I.retain){const w={};if(typeof b.retain=="number")w.retain=typeof I.retain=="number"?y:I.retain;else if(typeof I.retain=="number")b.retain==null?w.insert=b.insert:w.retain=b.retain;else{const S=b.retain==null?"insert":"retain",[D,C,E]=c(b[S],I.retain),P=u.getHandler(D);w[S]={[D]:P.compose(C,E,S==="retain")}}const T=a.default.compose(b.attributes,I.attributes,typeof b.retain=="number");if(T&&(w.attributes=T),v.push(w),!f.hasNext()&&n(v.ops[v.ops.length-1],w)){const S=new u(h.rest());return v.concat(S).chop()}}else typeof I.delete=="number"&&(typeof b.retain=="number"||typeof b.retain=="object"&&b.retain!==null)&&v.push(I)}return v.chop()}concat(p){const h=new u(this.ops.slice());return p.ops.length>0&&(h.push(p.ops[0]),h.ops=h.ops.concat(p.ops.slice(1))),h}diff(p,h){if(this.ops===p.ops)return new u;const f=[this,p].map(b=>b.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const w=b===p?"on":"with";throw new Error("diff() called "+w+" non-document")}).join("")),m=new u,g=i(f[0],f[1],h,!0),v=new o.default(this.ops),y=new o.default(p.ops);return g.forEach(b=>{let I=b[1].length;for(;I>0;){let w=0;switch(b[0]){case i.INSERT:w=Math.min(y.peekLength(),I),m.push(y.next(w));break;case i.DELETE:w=Math.min(I,v.peekLength()),v.next(w),m.delete(w);break;case i.EQUAL:w=Math.min(v.peekLength(),y.peekLength(),I);const T=v.next(w),S=y.next(w);n(T.insert,S.insert)?m.retain(w,a.default.diff(T.attributes,S.attributes)):m.push(S).delete(w);break}I-=w}}),m.chop()}eachLine(p,h=`
`){const f=new o.default(this.ops);let m=new u,g=0;for(;f.hasNext();){if(f.peekType()!=="insert")return;const v=f.peek(),y=s.default.length(v)-f.peekLength(),b=typeof v.insert=="string"?v.insert.indexOf(h,y)-y:-1;if(b<0)m.push(f.next());else if(b>0)m.push(f.next(b));else{if(p(m,f.next(1).attributes||{},g)===!1)return;g+=1,m=new u}}m.length()>0&&p(m,{},g)}invert(p){const h=new u;return this.reduce((f,m)=>{if(m.insert)h.delete(s.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),f+m.retain;if(m.delete||typeof m.retain=="number"){const g=m.delete||m.retain;return p.slice(f,f+g).forEach(y=>{m.delete?h.push(y):m.retain&&m.attributes&&h.retain(s.default.length(y),a.default.invert(m.attributes,y.attributes))}),f+g}else if(typeof m.retain=="object"&&m.retain!==null){const g=p.slice(f,f+1),v=new o.default(g.ops).next(),[y,b,I]=c(m.retain,v.insert),w=u.getHandler(y);return h.retain({[y]:w.invert(b,I)},a.default.invert(m.attributes,v.attributes)),f+1}}return f},0),h.chop()}transform(p,h=!1){if(h=!!h,typeof p=="number")return this.transformPosition(p,h);const f=p,m=new o.default(this.ops),g=new o.default(f.ops),v=new u;for(;m.hasNext()||g.hasNext();)if(m.peekType()==="insert"&&(h||g.peekType()!=="insert"))v.retain(s.default.length(m.next()));else if(g.peekType()==="insert")v.push(g.next());else{const y=Math.min(m.peekLength(),g.peekLength()),b=m.next(y),I=g.next(y);if(b.delete)continue;if(I.delete)v.push(I);else{const w=b.retain,T=I.retain;let S=typeof T=="object"&&T!==null?T:y;if(typeof w=="object"&&w!==null&&typeof T=="object"&&T!==null){const D=Object.keys(w)[0];if(D===Object.keys(T)[0]){const C=u.getHandler(D);C&&(S={[D]:C.transform(w[D],T[D],h)})}}v.retain(S,a.default.transform(b.attributes,I.attributes,h))}}return v.chop()}transformPosition(p,h=!1){h=!!h;const f=new o.default(this.ops);let m=0;for(;f.hasNext()&&m<=p;){const g=f.peekLength(),v=f.peekType();if(f.next(),v==="delete"){p-=Math.min(g,p-m);continue}else v==="insert"&&(m<p||!h)&&(p+=g);m+=g}return p}}u.Op=s.default,u.OpIterator=o.default,u.AttributeMap=a.default,u.handlers={},e.default=u,t.exports=u,t.exports.default=u})(KM,KM.exports)),KM.exports}var ep=Kht();const gi=MR(ep);class of extends Ad{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}of.blotName="break";of.tagName="BR";let Wh=class extends ok{};const Zht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function I2(t){return t.replace(/[&<>"']/g,e=>Zht[e])}class Mc extends O9{static allowedChildren=[Mc,of,Ad,Wh];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(e,i){const r=Mc.order.indexOf(e),n=Mc.order.indexOf(i);return r>=0||n>=0?r-n:e===i?0:e<i?-1:1}formatAt(e,i,r,n){if(Mc.compare(this.statics.blotName,r)<0&&this.scroll.query(r,Si.BLOT)){const a=this.isolate(e,i);n&&a.wrap(r,n)}else super.formatAt(e,i,r,n)}optimize(e){if(super.optimize(e),this.parent instanceof Mc&&Mc.compare(this.statics.blotName,this.parent.statics.blotName)>0){const i=this.parent.isolate(this.offset(),this.length());this.moveChildren(i),i.wrap(this)}}}const ste=1;class Tl extends XC{cache={};delta(){return this.cache.delta==null&&(this.cache.delta=QPe(this)),this.cache.delta}deleteAt(e,i){super.deleteAt(e,i),this.cache={}}formatAt(e,i,r,n){i<=0||(this.scroll.query(r,Si.BLOCK)?e+i===this.length()&&this.format(r,n):super.formatAt(e,Math.min(i,this.length()-e-1),r,n),this.cache={})}insertAt(e,i,r){if(r!=null){super.insertAt(e,i,r),this.cache={};return}if(i.length===0)return;const n=i.split(`
`),a=n.shift();a.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),a):this.children.tail.insertAt(this.children.tail.length(),a),this.cache={});let s=this;n.reduce((o,l)=>(s=s.split(o,!0),s.insertAt(0,l),l.length),e+a.length)}insertBefore(e,i){const{head:r}=this.children;super.insertBefore(e,i),r instanceof of&&r.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+ste),this.cache.length}moveChildren(e,i){super.moveChildren(e,i),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i&&(e===0||e>=this.length()-ste)){const n=this.clone();return e===0?(this.parent.insertBefore(n,this),this):(this.parent.insertBefore(n,this.next),n)}const r=super.split(e,i);return this.cache={},r}}Tl.blotName="block";Tl.tagName="P";Tl.defaultChild=of;Tl.allowedChildren=[of,Mc,Ad,Wh];class Xd extends Ad{attach(){super.attach(),this.attributes=new y2(this.domNode)}delta(){return new gi().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,i){const r=this.scroll.query(e,Si.BLOCK_ATTRIBUTE);r!=null&&this.attributes.attribute(r,i)}formatAt(e,i,r,n){this.format(r,n)}insertAt(e,i,r){if(r!=null){super.insertAt(e,i,r);return}const n=i.split(`
`),a=n.pop(),s=n.map(l=>{const c=this.scroll.create(Tl.blotName);return c.insertAt(0,l),c}),o=this.split(e);s.forEach(l=>{this.parent.insertBefore(l,o)}),a&&this.parent.insertBefore(this.scroll.create("text",a),o)}}Xd.scope=Si.BLOCK_BLOT;function QPe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.descendants(Jl).reduce((i,r)=>r.length()===0?i:i.insert(r.value(),Yd(r,{},e)),new gi).insert(`
`,Yd(t))}function Yd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return t==null||("formats"in t&&typeof t.formats=="function"&&(e={...e,...t.formats()},i&&delete e["code-token"]),t.parent==null||t.parent.statics.blotName==="scroll"||t.parent.statics.scope!==t.statics.scope)?e:Yd(t.parent,e,i)}class th extends Ad{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\uFEFF";static value(){}constructor(e,i,r){super(e,i),this.selection=r,this.textNode=document.createTextNode(th.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,i){if(this.savedLength!==0){super.format(e,i);return}let r=this,n=0;for(;r!=null&&r.statics.scope!==Si.BLOCK_BLOT;)n+=r.offset(r.parent),r=r.parent;r!=null&&(this.savedLength=th.CONTENTS.length,r.optimize(),r.formatAt(n,th.CONTENTS.length,e,i),this.savedLength=0)}index(e,i){return e===this.textNode?0:super.index(e,i)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const i=this.prev instanceof Wh?this.prev:null,r=i?i.length():0,n=this.next instanceof Wh?this.next:null,a=n?n.text:"",{textNode:s}=this,o=s.data.split(th.CONTENTS).join("");s.data=th.CONTENTS;let l;if(i)l=i,(o||n)&&(i.insertAt(i.length(),o+a),n&&n.remove());else if(n)l=n,n.insertAt(0,o);else{const c=document.createTextNode(o);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(p,h)=>i&&p===i.domNode?h:p===s?r+h-1:n&&p===n.domNode?r+o.length+h:null,u=c(e.start.node,e.start.offset),d=c(e.end.node,e.end.offset);if(u!==null&&d!==null)return{startNode:l.domNode,startOffset:u,endNode:l.domNode,endOffset:d}}return null}update(e,i){if(e.some(r=>r.type==="characterData"&&r.target===this.textNode)){const r=this.restore();r&&(i.range=r)}}optimize(e){super.optimize(e);let{parent:i}=this;for(;i;){if(i.domNode.tagName==="A"){this.savedLength=th.CONTENTS.length,i.isolate(this.offset(i),this.length()).unwrap(),this.savedLength=0;break}i=i.parent}}value(){return""}}var v$={exports:{}},ote;function Xht(){return ote||(ote=1,(function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function a(l,c,u,d,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new n(u,d||l,p),f=i?i+c:c;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],h]:l._events[f].push(h):(l._events[f]=h,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(i?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=i?i+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,h=d.length,f=new Array(h);p<h;p++)f[p]=d[p].fn;return f},o.prototype.listenerCount=function(c){var u=i?i+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,p,h,f){var m=i?i+c:c;if(!this._events[m])return!1;var g=this._events[m],v=arguments.length,y,b;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),v){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,u),!0;case 3:return g.fn.call(g.context,u,d),!0;case 4:return g.fn.call(g.context,u,d,p),!0;case 5:return g.fn.call(g.context,u,d,p,h),!0;case 6:return g.fn.call(g.context,u,d,p,h,f),!0}for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];g.fn.apply(g.context,y)}else{var I=g.length,w;for(b=0;b<I;b++)switch(g[b].once&&this.removeListener(c,g[b].fn,void 0,!0),v){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,u);break;case 3:g[b].fn.call(g[b].context,u,d);break;case 4:g[b].fn.call(g[b].context,u,d,p);break;default:if(!y)for(w=1,y=new Array(v-1);w<v;w++)y[w-1]=arguments[w];g[b].fn.apply(g[b].context,y)}}return!0},o.prototype.on=function(c,u,d){return a(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return a(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,p){var h=i?i+c:c;if(!this._events[h])return this;if(!u)return s(this,h),this;var f=this._events[h];if(f.fn)f.fn===u&&(!p||f.once)&&(!d||f.context===d)&&s(this,h);else{for(var m=0,g=[],v=f.length;m<v;m++)(f[m].fn!==u||p&&!f[m].once||d&&f[m].context!==d)&&g.push(f[m]);g.length?this._events[h]=g.length===1?g[0]:g:s(this,h)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=i?i+c:c,this._events[u]&&s(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(v$)),v$.exports}var Jht=Xht();const Qht=MR(Jht),CG=new WeakMap,RG=["error","warn","log","info"];let MG="warn";function eCe(t){if(MG&&RG.indexOf(t)<=RG.indexOf(MG)){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];console[t](...i)}}function rv(t){return RG.reduce((e,i)=>(e[i]=eCe.bind(console,i,t),e),{})}rv.level=t=>{MG=t};eCe.level=rv.level;const y$=rv("quill:events"),eft=["selectionchange","mousedown","mouseup","click"];eft.forEach(t=>{document.addEventListener(t,function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];Array.from(document.querySelectorAll(".ql-container")).forEach(n=>{const a=CG.get(n);a&&a.emitter&&a.emitter.handleDOM(...i)})})});class hi extends Qht{static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",y$.error)}emit(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return y$.log.call(y$,...i),super.emit(...i)}handleDOM(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(this.domListeners[e.type]||[]).forEach(a=>{let{node:s,handler:o}=a;(e.target===s||s.contains(e.target))&&o(e,...r)})}listenDOM(e,i,r){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:i,handler:r})}}const b$=rv("quill:selection");class AI{constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=i}}class tft{constructor(e,i){this.emitter=i,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new AI(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,hi.sources.USER),1)}),this.emitter.on(hi.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const r=this.getNativeRange();r!=null&&r.start.node!==this.cursor.textNode&&this.emitter.once(hi.events.SCROLL_UPDATE,(n,a)=>{try{this.root.contains(r.start.node)&&this.root.contains(r.end.node)&&this.setNativeRange(r.start.node,r.start.offset,r.end.node,r.end.offset);const s=a.some(o=>o.type==="characterData"||o.type==="childList"||o.type==="attributes"&&o.target===this.root);this.update(s?hi.sources.SILENT:n)}catch{}})}),this.emitter.on(hi.events.SCROLL_OPTIMIZE,(r,n)=>{if(n.range){const{startNode:a,startOffset:s,endNode:o,endOffset:l}=n.range;this.setNativeRange(a,s,o,l),this.update(hi.sources.SILENT)}}),this.update(hi.sources.SILENT)}handleComposition(){this.emitter.on(hi.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(hi.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(hi.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,i){this.scroll.update();const r=this.getNativeRange();if(!(r==null||!r.native.collapsed||this.scroll.query(e,Si.BLOCK))){if(r.start.node!==this.cursor.textNode){const n=this.scroll.find(r.start.node,!1);if(n==null)return;if(n instanceof Jl){const a=n.split(r.start.offset);n.parent.insertBefore(this.cursor,a)}else n.insertBefore(this.cursor,r.start.node);this.cursor.attach()}this.cursor.format(e,i),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=this.scroll.length();e=Math.min(e,r-1),i=Math.min(e+i,r-1)-e;let n,[a,s]=this.scroll.leaf(e);if(a==null)return null;if(i>0&&s===a.length()){const[u]=this.scroll.leaf(e+1);if(u){const[d]=this.scroll.line(e),[p]=this.scroll.line(e+1);d===p&&(a=u,s=0)}}[n,s]=a.position(s,!0);const o=document.createRange();if(i>0)return o.setStart(n,s),[a,s]=this.scroll.leaf(e+i),a==null?null:([n,s]=a.position(s,!0),o.setEnd(n,s),o.getBoundingClientRect());let l="left",c;if(n instanceof Text){if(!n.data.length)return null;s<n.data.length?(o.setStart(n,s),o.setEnd(n,s+1)):(o.setStart(n,s-1),o.setEnd(n,s),l="right"),c=o.getBoundingClientRect()}else{if(!(a.domNode instanceof Element))return null;c=a.domNode.getBoundingClientRect(),s>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const i=e.getRangeAt(0);if(i==null)return null;const r=this.normalizeNative(i);return b$.info("getNativeRange",r),r}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const i=this.getNativeRange();return i==null?[null,null]:[this.normalizedToRange(i),i]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&I$(this.root,document.activeElement)}normalizedToRange(e){const i=[[e.start.node,e.start.offset]];e.native.collapsed||i.push([e.end.node,e.end.offset]);const r=i.map(s=>{const[o,l]=s,c=this.scroll.find(o,!0),u=c.offset(this.scroll);return l===0?u:c instanceof Jl?u+c.index(o,l):u+c.length()}),n=Math.min(Math.max(...r),this.scroll.length()-1),a=Math.min(n,...r);return new AI(a,n-a)}normalizeNative(e){if(!I$(this.root,e.startContainer)||!e.collapsed&&!I$(this.root,e.endContainer))return null;const i={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[i.start,i.end].forEach(r=>{let{node:n,offset:a}=r;for(;!(n instanceof Text)&&n.childNodes.length>0;)if(n.childNodes.length>a)n=n.childNodes[a],a=0;else if(n.childNodes.length===a)n=n.lastChild,n instanceof Text?a=n.data.length:n.childNodes.length>0?a=n.childNodes.length:a=n.childNodes.length+1;else break;r.node=n,r.offset=a}),i}rangeToNative(e){const i=this.scroll.length(),r=(n,a)=>{n=Math.min(i-1,n);const[s,o]=this.scroll.leaf(n);return s?s.position(o,a):[null,-1]};return[...r(e.index,!1),...r(e.index+e.length,!0)]}setNativeRange(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(b$.info("setNativeRange",e,i,r,n),e!=null&&(this.root.parentNode==null||e.parentNode==null||r.parentNode==null))return;const s=document.getSelection();if(s!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:o}=this.getNativeRange()||{};if(o==null||a||e!==o.startContainer||i!==o.startOffset||r!==o.endContainer||n!==o.endOffset){e instanceof Element&&e.tagName==="BR"&&(i=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),r instanceof Element&&r.tagName==="BR"&&(n=Array.from(r.parentNode.childNodes).indexOf(r),r=r.parentNode);const l=document.createRange();l.setStart(e,i),l.setEnd(r,n),s.removeAllRanges(),s.addRange(l)}}else s.removeAllRanges(),this.root.blur()}setRange(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hi.sources.API;if(typeof i=="string"&&(r=i,i=!1),b$.info("setRange",e),e!=null){const n=this.rangeToNative(e);this.setNativeRange(...n,i)}else this.setNativeRange(null);this.update(r)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hi.sources.USER;const i=this.lastRange,[r,n]=this.getRange();if(this.lastRange=r,this.lastNative=n,this.lastRange!=null&&(this.savedRange=this.lastRange),!k9(i,this.lastRange)){if(!this.composing&&n!=null&&n.native.collapsed&&n.start.node!==this.cursor.textNode){const s=this.cursor.restore();s&&this.setNativeRange(s.startNode,s.startOffset,s.endNode,s.endOffset)}const a=[hi.events.SELECTION_CHANGE,uT(this.lastRange),uT(i),e];this.emitter.emit(hi.events.EDITOR_CHANGE,...a),e!==hi.sources.SILENT&&this.emitter.emit(...a)}}}function I$(t,e){try{e.parentNode}catch{return!1}return t.contains(e)}const ift=/^[ -~]*$/;class rft{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let i=this.scroll.length();this.scroll.batchStart();const r=lte(e),n=new gi;return aft(r.ops.slice()).reduce((s,o)=>{const l=ep.Op.length(o);let c=o.attributes||{},u=!1,d=!1;if(o.insert!=null){if(n.retain(l),typeof o.insert=="string"){const f=o.insert;d=!f.endsWith(`
`)&&(i<=s||!!this.scroll.descendant(Xd,s)[0]),this.scroll.insertAt(s,f);const[m,g]=this.scroll.line(s);let v=Hv({},Yd(m));if(m instanceof Tl){const[y]=m.descendant(Jl,g);y&&(v=Hv(v,Yd(y)))}c=ep.AttributeMap.diff(v,c)||{}}else if(typeof o.insert=="object"){const f=Object.keys(o.insert)[0];if(f==null)return s;const m=this.scroll.query(f,Si.INLINE)!=null;if(m)(i<=s||this.scroll.descendant(Xd,s)[0])&&(d=!0);else if(s>0){const[g,v]=this.scroll.descendant(Jl,s-1);g instanceof Wh?g.value()[v]!==`
`&&(u=!0):g instanceof Ad&&g.statics.scope===Si.INLINE_BLOT&&(u=!0)}if(this.scroll.insertAt(s,f,o.insert[f]),m){const[g]=this.scroll.descendant(Jl,s);if(g){const v=Hv({},Yd(g));c=ep.AttributeMap.diff(v,c)||{}}}}i+=l}else if(n.push(o),o.retain!==null&&typeof o.retain=="object"){const f=Object.keys(o.retain)[0];if(f==null)return s;this.scroll.updateEmbedAt(s,f,o.retain[f])}Object.keys(c).forEach(f=>{this.scroll.formatAt(s,l,f,c[f])});const p=u?1:0,h=d?1:0;return i+=p+h,n.retain(p),n.delete(h),s+l+p+h},0),n.reduce((s,o)=>typeof o.delete=="number"?(this.scroll.deleteAt(s,o.delete),s):s+ep.Op.length(o),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(r)}deleteText(e,i){return this.scroll.deleteAt(e,i),this.update(new gi().retain(e).delete(i))}formatLine(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(r).forEach(a=>{this.scroll.lines(e,Math.max(i,1)).forEach(s=>{s.format(a,r[a])})}),this.scroll.optimize();const n=new gi().retain(e).retain(i,uT(r));return this.update(n)}formatText(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(r).forEach(a=>{this.scroll.formatAt(e,i,a,r[a])});const n=new gi().retain(e).retain(i,uT(r));return this.update(n)}getContents(e,i){return this.delta.slice(e,e+i)}getDelta(){return this.scroll.lines().reduce((e,i)=>e.concat(i.delta()),new gi)}getFormat(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=[],n=[];i===0?this.scroll.path(e).forEach(o=>{const[l]=o;l instanceof Tl?r.push(l):l instanceof Jl&&n.push(l)}):(r=this.scroll.lines(e,i),n=this.scroll.descendants(Jl,e,i));const[a,s]=[r,n].map(o=>{const l=o.shift();if(l==null)return{};let c=Yd(l);for(;Object.keys(c).length>0;){const u=o.shift();if(u==null)return c;c=nft(Yd(u),c)}return c});return{...a,...s}}getHTML(e,i){const[r,n]=this.scroll.line(e);if(r){const a=r.length();return r.length()>=n+i&&!(n===0&&i===a)?JC(r,n,i,!0):JC(this.scroll,e,i,!0)}return""}getText(e,i){return this.getContents(e,i).filter(r=>typeof r.insert=="string").map(r=>r.insert).join("")}insertContents(e,i){const r=lte(i),n=new gi().retain(e).concat(r);return this.scroll.insertContents(e,r),this.update(n)}insertEmbed(e,i,r){return this.scroll.insertAt(e,i,r),this.update(new gi().retain(e).insert({[i]:r}))}insertText(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i=i.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,i),Object.keys(r).forEach(n=>{this.scroll.formatAt(e,i.length,n,r[n])}),this.update(new gi().retain(e).insert(i,uT(r)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if(e?.statics.blotName!==Tl.blotName)return!1;const i=e;return i.children.length>1?!1:i.children.head instanceof of}removeFormat(e,i){const r=this.getText(e,i),[n,a]=this.scroll.line(e+i);let s=0,o=new gi;n!=null&&(s=n.length()-a,o=n.delta().slice(a,a+s-1).insert(`
`));const c=this.getContents(e,i+s).diff(new gi().insert(r).concat(o)),u=new gi().retain(e).concat(c);return this.applyDelta(u)}update(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const n=this.delta;if(i.length===1&&i[0].type==="characterData"&&i[0].target.data.match(ift)&&this.scroll.find(i[0].target)){const a=this.scroll.find(i[0].target),s=Yd(a),o=a.offset(this.scroll),l=i[0].oldValue.replace(th.CONTENTS,""),c=new gi().insert(l),u=new gi().insert(a.value()),d=r&&{oldRange:cte(r.oldRange,-o),newRange:cte(r.newRange,-o)};e=new gi().retain(o).concat(c.diff(u,d)).reduce((h,f)=>f.insert?h.insert(f.insert,s):h.push(f),new gi),this.delta=n.compose(e)}else this.delta=this.getDelta(),(!e||!k9(n.compose(e),this.delta))&&(e=n.diff(this.delta,r));return e}}function VS(t,e,i){if(t.length===0){const[h]=w$(i.pop());return e<=0?`</li></${h}>`:`</li></${h}>${VS([],e-1,i)}`}const[{child:r,offset:n,length:a,indent:s,type:o},...l]=t,[c,u]=w$(o);if(s>e)return i.push(o),s===e+1?`<${c}><li${u}>${JC(r,n,a)}${VS(l,s,i)}`:`<${c}><li>${VS(t,e+1,i)}`;const d=i[i.length-1];if(s===e&&o===d)return`</li><li${u}>${JC(r,n,a)}${VS(l,s,i)}`;const[p]=w$(i.pop());return`</li></${p}>${VS(t,e-1,i)}`}function JC(t,e,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in t&&typeof t.html=="function")return t.html(e,i);if(t instanceof Wh)return I2(t.value().slice(e,e+i)).replaceAll(" ","&nbsp;");if(t instanceof Sh){if(t.statics.blotName==="list-container"){const c=[];return t.children.forEachAt(e,i,(u,d,p)=>{const h="formats"in u&&typeof u.formats=="function"?u.formats():{};c.push({child:u,offset:d,length:p,indent:h.indent||0,type:h.list})}),VS(c,-1,[])}const n=[];if(t.children.forEachAt(e,i,(c,u,d)=>{n.push(JC(c,u,d))}),r||t.statics.blotName==="list")return n.join("");const{outerHTML:a,innerHTML:s}=t.domNode,[o,l]=a.split(`>${s}<`);return o==="<table"?`<table style="border: 1px solid #000;">${n.join("")}<${l}`:`${o}>${n.join("")}<${l}`}return t.domNode instanceof Element?t.domNode.outerHTML:""}function nft(t,e){return Object.keys(e).reduce((i,r)=>{if(t[r]==null)return i;const n=e[r];return n===t[r]?i[r]=n:Array.isArray(n)?n.indexOf(t[r])<0?i[r]=n.concat([t[r]]):i[r]=n:i[r]=[n,t[r]],i},{})}function w$(t){const e=t==="ordered"?"ol":"ul";switch(t){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function lte(t){return t.reduce((e,i)=>{if(typeof i.insert=="string"){const r=i.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(r,i.attributes)}return e.push(i)},new gi)}function cte(t,e){let{index:i,length:r}=t;return new AI(i+e,r)}function aft(t){const e=[];return t.forEach(i=>{typeof i.insert=="string"?i.insert.split(`
`).forEach((n,a)=>{a&&e.push({insert:`
`,attributes:i.attributes}),n&&e.push({insert:n,attributes:i.attributes})}):e.push(i)}),e}class Am{static DEFAULTS={};constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=i}}const QM="\uFEFF";class L9 extends Ad{constructor(e,i){super(e,i),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(r=>{this.contentNode.appendChild(r)}),this.leftGuard=document.createTextNode(QM),this.rightGuard=document.createTextNode(QM),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,i){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,i)}restore(e){let i=null,r;const n=e.data.split(QM).join("");if(e===this.leftGuard)if(this.prev instanceof Wh){const a=this.prev.length();this.prev.insertAt(a,n),i={startNode:this.prev.domNode,startOffset:a+n.length}}else r=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(r),this),i={startNode:r,startOffset:n.length};else e===this.rightGuard&&(this.next instanceof Wh?(this.next.insertAt(0,n),i={startNode:this.next.domNode,startOffset:n.length}):(r=document.createTextNode(n),this.parent.insertBefore(this.scroll.create(r),this.next),i={startNode:r,startOffset:n.length}));return e.data=QM,i}update(e,i){e.forEach(r=>{if(r.type==="characterData"&&(r.target===this.leftGuard||r.target===this.rightGuard)){const n=this.restore(r.target);n&&(i.range=n)}})}}class sft{isComposing=!1;constructor(e,i){this.scroll=e,this.emitter=i,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const i=e.target instanceof Node?this.scroll.find(e.target,!0):null;i&&!(i instanceof L9)&&(this.emitter.emit(hi.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(hi.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(hi.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(hi.events.COMPOSITION_END,e),this.isComposing=!1}}class eE{static DEFAULTS={modules:{}};static themes={default:eE};modules={};constructor(e,i){this.quill=e,this.options=i}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const i=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new i(this.quill,this.options.modules[e]||{}),this.modules[e]}}const oft=t=>t.parentElement||t.getRootNode().host||null,lft=t=>{const e=t.getBoundingClientRect(),i="offsetWidth"in t&&Math.abs(e.width)/t.offsetWidth||1,r="offsetHeight"in t&&Math.abs(e.height)/t.offsetHeight||1;return{top:e.top,right:e.left+t.clientWidth*i,bottom:e.top+t.clientHeight*r,left:e.left}},eN=t=>{const e=parseInt(t,10);return Number.isNaN(e)?0:e},ute=(t,e,i,r,n,a)=>t<i&&e>r?0:t<i?-(i-t+n):e>r?e-t>r-i?t+n-i:e-r+a:0,cft=(t,e)=>{const i=t.ownerDocument;let r=e,n=t;for(;n;){const a=n===i.body,s=a?{top:0,right:window.visualViewport?.width??i.documentElement.clientWidth,bottom:window.visualViewport?.height??i.documentElement.clientHeight,left:0}:lft(n),o=getComputedStyle(n),l=ute(r.left,r.right,s.left,s.right,eN(o.scrollPaddingLeft),eN(o.scrollPaddingRight)),c=ute(r.top,r.bottom,s.top,s.bottom,eN(o.scrollPaddingTop),eN(o.scrollPaddingBottom));if(l||c)if(a)i.defaultView?.scrollBy(l,c);else{const{scrollLeft:u,scrollTop:d}=n;c&&(n.scrollTop+=c),l&&(n.scrollLeft+=l);const p=n.scrollLeft-u,h=n.scrollTop-d;r={left:r.left-p,top:r.top-h,right:r.right-p,bottom:r.bottom-h}}n=a||o.position==="fixed"?null:oft(n)}},uft=100,dft=["block","break","cursor","inline","scroll","text"],pft=(t,e,i)=>{const r=new UU;return dft.forEach(n=>{const a=e.query(n);a&&r.register(a)}),t.forEach(n=>{let a=e.query(n);a||i.error(`Cannot register "${n}" specified in "formats" config. Are you sure it was registered?`);let s=0;for(;a;)if(r.register(a),a="blotName"in a?a.requiredContainer??null:null,s+=1,s>uft){i.error(`Cycle detected in registering blot requiredContainer: "${n}"`);break}}),r},pT=rv("quill"),tN=new UU;Sh.uiClass="ql-ui";class lt{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:tN,theme:"default"};static events=hi.events;static sources=hi.sources;static version="2.0.3";static imports={delta:gi,parchment:zht,"core/module":Am,"core/theme":eE};static debug(e){e===!0&&(e="log"),rv.level(e)}static find(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return CG.get(e)||tN.find(e,i)}static import(e){return this.imports[e]==null&&pT.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],i=!!(!(arguments.length<=1)&&arguments[1]),r="attrName"in e?e.attrName:e.blotName;typeof r=="string"?this.register(`formats/${r}`,e,i):Object.keys(e).forEach(n=>{this.register(n,e[n],i)})}else{const e=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],r=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!r&&pT.warn(`Overwriting ${e} with`,i),this.imports[e]=i,(e.startsWith("blots/")||e.startsWith("formats/"))&&i&&typeof i!="boolean"&&i.blotName!=="abstract"&&tN.register(i),typeof i.register=="function"&&i.register(tN)}}constructor(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=hft(e,i),this.container=this.options.container,this.container==null){pT.error("Invalid Quill container",e);return}this.options.debug&&lt.debug(this.options.debug);const r=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",CG.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new hi;const n=x9.blotName,a=this.options.registry.query(n);if(!a||!("blotName"in a))throw new Error(`Cannot initialize Quill without "${n}" blot`);if(this.scroll=new a(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new rft(this.scroll),this.selection=new tft(this.scroll,this.emitter),this.composition=new sft(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(hi.events.EDITOR_CHANGE,s=>{s===hi.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(hi.events.SCROLL_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;Yp.call(this,()=>this.editor.update(null,o,u),s)}),this.emitter.on(hi.events.SCROLL_EMBED_UPDATE,(s,o)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),u=l&&c?{oldRange:l,newRange:c}:void 0;Yp.call(this,()=>{const d=new gi().retain(s.offset(this)).retain({[s.statics.blotName]:o});return this.editor.update(d,[],u)},lt.sources.USER)}),r){const s=this.clipboard.convert({html:`${r}<p><br></p>`,text:`
`});this.setContents(s)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const r=e;e=document.createElement("div"),e.classList.add(r)}return this.container.insertBefore(e,i),e}blur(){this.selection.setRange(null)}deleteText(e,i,r){return[e,i,,r]=Hm(e,i,r),Yp.call(this,()=>this.editor.deleteText(e,i),r,e,-1*i)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const i=e();return this.allowReadOnlyEdits=!1,i}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hi.sources.API;return Yp.call(this,()=>{const n=this.getSelection(!0);let a=new gi;if(n==null)return a;if(this.scroll.query(e,Si.BLOCK))a=this.editor.formatLine(n.index,n.length,{[e]:i});else{if(n.length===0)return this.selection.format(e,i),a;a=this.editor.formatText(n.index,n.length,{[e]:i})}return this.setSelection(n,hi.sources.SILENT),a},r)}formatLine(e,i,r,n,a){let s;return[e,i,s,a]=Hm(e,i,r,n,a),Yp.call(this,()=>this.editor.formatLine(e,i,s),a,e,0)}formatText(e,i,r,n,a){let s;return[e,i,s,a]=Hm(e,i,r,n,a),Yp.call(this,()=>this.editor.formatText(e,i,s),a,e,0)}getBounds(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=null;if(typeof e=="number"?r=this.selection.getBounds(e,i):r=this.selection.getBounds(e.index,e.length),!r)return null;const n=this.container.getBoundingClientRect();return{bottom:r.bottom-n.top,height:r.height,left:r.left-n.left,right:r.right-n.left,top:r.top-n.top,width:r.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,i]=Hm(e,i),this.editor.getContents(e,i)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,i):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,i)}getModule(e){return this.theme.modules[e]}getSelection(){return arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Hm(e,i),this.editor.getHTML(e,i)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(i=i??this.getLength()-e),[e,i]=Hm(e,i),this.editor.getText(e,i)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,i,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:lt.sources.API;return Yp.call(this,()=>this.editor.insertEmbed(e,i,r),n,e)}insertText(e,i,r,n,a){let s;return[e,,s,a]=Hm(e,0,r,n,a),Yp.call(this,()=>this.editor.insertText(e,i,s),a,e,i.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,i,r){return[e,i,,r]=Hm(e,i,r),Yp.call(this,()=>this.editor.removeFormat(e,i),r,e)}scrollRectIntoView(e){cft(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,i=e&&this.selection.getBounds(e.index,e.length);i&&this.scrollRectIntoView(i)}setContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hi.sources.API;return Yp.call(this,()=>{e=new gi(e);const r=this.getLength(),n=this.editor.deleteText(0,r),a=this.editor.insertContents(0,e),s=this.editor.deleteText(this.getLength()-1,1);return n.compose(a).compose(s)},i)}setSelection(e,i,r){e==null?this.selection.setRange(null,i||lt.sources.API):([e,i,,r]=Hm(e,i,r),this.selection.setRange(new AI(Math.max(0,e),i),r),r!==hi.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hi.sources.API;const r=new gi().insert(e);return this.setContents(r,i)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hi.sources.USER;const i=this.scroll.update(e);return this.selection.update(e),i}updateContents(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hi.sources.API;return Yp.call(this,()=>(e=new gi(e),this.editor.applyDelta(e)),i,!0)}}function dte(t){return typeof t=="string"?document.querySelector(t):t}function S$(t){return Object.entries(t??{}).reduce((e,i)=>{let[r,n]=i;return{...e,[r]:n===!0?{}:n}},{})}function pte(t){return Object.fromEntries(Object.entries(t).filter(e=>e[1]!==void 0))}function hft(t,e){const i=dte(t);if(!i)throw new Error("Invalid Quill container");const n=!e.theme||e.theme===lt.DEFAULTS.theme?eE:lt.import(`themes/${e.theme}`);if(!n)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:a,...s}=lt.DEFAULTS,{modules:o,...l}=n.DEFAULTS;let c=S$(e.modules);c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c={...c,toolbar:{container:c.toolbar}});const u=Hv({},S$(a),S$(o),c),d={...s,...pte(l),...pte(e)};let p=e.registry;return p?e.formats&&pT.warn('Ignoring "formats" option because "registry" is specified'):p=e.formats?pft(e.formats,d.registry,pT):d.registry,{...d,registry:p,container:i,theme:n,modules:Object.entries(u).reduce((h,f)=>{let[m,g]=f;if(!g)return h;const v=lt.import(`modules/${m}`);return v==null?(pT.error(`Cannot load ${m} module. Are you sure you registered it?`),h):{...h,[m]:Hv({},v.DEFAULTS||{},g)}},{}),bounds:dte(d.bounds)}}function Yp(t,e,i,r){if(!this.isEnabled()&&e===hi.sources.USER&&!this.allowReadOnlyEdits)return new gi;let n=i==null?null:this.getSelection();const a=this.editor.delta,s=t();if(n!=null&&(i===!0&&(i=n.index),r==null?n=hte(n,s,e):r!==0&&(n=hte(n,i,r,e)),this.setSelection(n,hi.sources.SILENT)),s.length()>0){const o=[hi.events.TEXT_CHANGE,s,a,e];this.emitter.emit(hi.events.EDITOR_CHANGE,...o),e!==hi.sources.SILENT&&this.emitter.emit(...o)}return s}function Hm(t,e,i,r,n){let a={};return typeof t.index=="number"&&typeof t.length=="number"?typeof e!="number"?(n=r,r=i,i=e,e=t.length,t=t.index):(e=t.length,t=t.index):typeof e!="number"&&(n=r,r=i,i=e,e=0),typeof i=="object"?(a=i,n=r):typeof i=="string"&&(r!=null?a[i]=r:n=i),n=n||hi.sources.API,[t,e,a,n]}function hte(t,e,i,r){const n=typeof i=="number"?i:0;if(t==null)return null;let a,s;return e&&typeof e.transformPosition=="function"?[a,s]=[t.index,t.index+t.length].map(o=>e.transformPosition(o,r!==hi.sources.USER)):[a,s]=[t.index,t.index+t.length].map(o=>o<e||o===e&&r===hi.sources.USER?o:n>=0?o+n:Math.max(e,o+n)),new AI(a,s-a)}class Jw extends b2{}function fte(t){return t instanceof Tl||t instanceof Xd}function mte(t){return typeof t.updateContent=="function"}class fft extends x9{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Tl;static allowedChildren=[Tl,Xd,Jw];constructor(e,i,r){let{emitter:n}=r;super(e,i),this.emitter=n,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",a=>this.handleDragStart(a))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(hi.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(hi.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,i){this.emitter.emit(hi.events.SCROLL_EMBED_UPDATE,e,i)}deleteAt(e,i){const[r,n]=this.line(e),[a]=this.line(e+i);if(super.deleteAt(e,i),a!=null&&r!==a&&n>0){if(r instanceof Xd||a instanceof Xd){this.optimize();return}const s=a.children.head instanceof of?null:a.children.head;r.moveChildren(a,s),r.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,i,r,n){super.formatAt(e,i,r,n),this.optimize()}insertAt(e,i,r){if(e>=this.length())if(r==null||this.scroll.query(i,Si.BLOCK)==null){const n=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(n),r==null&&i.endsWith(`
`)?n.insertAt(0,i.slice(0,-1),r):n.insertAt(0,i,r)}else{const n=this.scroll.create(i,r);this.appendChild(n)}else super.insertAt(e,i,r);this.optimize()}insertBefore(e,i){if(e.statics.scope===Si.INLINE_BLOT){const r=this.scroll.create(this.statics.defaultChild.blotName);r.appendChild(e),super.insertBefore(r,i)}else super.insertBefore(e,i)}insertContents(e,i){const r=this.deltaToRenderBlocks(i.concat(new gi().insert(`
`))),n=r.pop();if(n==null)return;this.batchStart();const a=r.shift();if(a){const l=a.type==="block"&&(a.delta.length()===0||!this.descendant(Xd,e)[0]&&e<this.length()),c=a.type==="block"?a.delta:new gi().insert({[a.key]:a.value});T$(this,e,c);const u=a.type==="block"?1:0,d=e+c.length()+u;l&&this.insertAt(d-1,`
`);const p=Yd(this.line(e)[0]),h=ep.AttributeMap.diff(p,a.attributes)||{};Object.keys(h).forEach(f=>{this.formatAt(d-1,1,f,h[f])}),e=d}let[s,o]=this.children.find(e);if(r.length&&(s&&(s=s.split(o),o=0),r.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,s||void 0);T$(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,s||void 0),Object.keys(l.attributes).forEach(u=>{c.format(u,l.attributes[u])})}})),n.type==="block"&&n.delta.length()){const l=s?s.offset(s.scroll)+o:this.length();T$(this,l,n.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const i=this.path(e).pop();if(!i)return[null,-1];const[r,n]=i;return r instanceof Jl?[r,n]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(fte,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const r=(n,a,s)=>{let o=[],l=s;return n.children.forEachAt(a,s,(c,u,d)=>{fte(c)?o.push(c):c instanceof b2&&(o=o.concat(r(c,u,l))),l-=d}),o};return r(this,e,i)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,i),e.length>0&&this.emitter.emit(hi.events.SCROLL_OPTIMIZE,e,i))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let i=hi.sources.USER;typeof e=="string"&&(i=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(r=>{let{target:n}=r;const a=this.find(n,!0);return a&&!mte(a)}),e.length>0&&this.emitter.emit(hi.events.SCROLL_BEFORE_UPDATE,i,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(hi.events.SCROLL_UPDATE,i,e)}updateEmbedAt(e,i,r){const[n]=this.descendant(a=>a instanceof Xd,e);n&&n.statics.blotName===i&&mte(n)&&n.updateContent(r)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const i=[];let r=new gi;return e.forEach(n=>{const a=n?.insert;if(a)if(typeof a=="string"){const s=a.split(`
`);s.slice(0,-1).forEach(l=>{r.insert(l,n.attributes),i.push({type:"block",delta:r,attributes:n.attributes??{}}),r=new gi});const o=s[s.length-1];o&&r.insert(o,n.attributes)}else{const s=Object.keys(a)[0];if(!s)return;this.query(s,Si.INLINE)?r.push(n):(r.length()&&i.push({type:"block",delta:r,attributes:{}}),r=new gi,i.push({type:"blockEmbed",key:s,value:a[s],attributes:n.attributes??{}}))}}),r.length()&&i.push({type:"block",delta:r,attributes:{}}),i}createBlock(e,i){let r;const n={};Object.entries(e).forEach(o=>{let[l,c]=o;this.query(l,Si.BLOCK&Si.BLOT)!=null?r=l:n[l]=c});const a=this.create(r||this.statics.defaultChild.blotName,r?e[r]:void 0);this.insertBefore(a,i||void 0);const s=a.length();return Object.entries(n).forEach(o=>{let[l,c]=o;a.formatAt(0,s,l,c)}),a}}function T$(t,e,i){i.reduce((r,n)=>{const a=ep.Op.length(n);let s=n.attributes||{};if(n.insert!=null){if(typeof n.insert=="string"){const o=n.insert;t.insertAt(r,o);const[l]=t.descendant(Jl,r),c=Yd(l);s=ep.AttributeMap.diff(c,s)||{}}else if(typeof n.insert=="object"){const o=Object.keys(n.insert)[0];if(o==null)return r;if(t.insertAt(r,o,n.insert[o]),t.scroll.query(o,Si.INLINE)!=null){const[c]=t.descendant(Jl,r),u=Yd(c);s=ep.AttributeMap.diff(u,s)||{}}}}return Object.keys(s).forEach(o=>{t.formatAt(r,a,o,s[o])}),r+a},e)}const F9={scope:Si.BLOCK,whitelist:["right","center","justify"]},mft=new um("align","align",F9),tCe=new sf("align","ql-align",F9),iCe=new nb("align","text-align",F9);class rCe extends nb{value(e){let i=super.value(e);return i.startsWith("rgb(")?(i=i.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${i.split(",").map(n=>`00${parseInt(n,10).toString(16)}`.slice(-2)).join("")}`):i}}const gft=new sf("color","ql-color",{scope:Si.INLINE}),B9=new rCe("color","color",{scope:Si.INLINE}),vft=new sf("background","ql-bg",{scope:Si.INLINE}),$9=new rCe("background","background-color",{scope:Si.INLINE});class Qw extends Jw{static create(e){const i=super.create(e);return i.setAttribute("spellcheck","false"),i}code(e,i){return this.children.map(r=>r.length()<=1?"":r.domNode.innerText).join(`
`).slice(e,e+i)}html(e,i){return`<pre>
${I2(this.code(e,i))}
</pre>`}}class xc extends Tl{static TAB="  ";static register(){lt.register(Qw)}}class V9 extends Mc{}V9.blotName="code";V9.tagName="CODE";xc.blotName="code-block";xc.className="ql-code-block";xc.tagName="DIV";Qw.blotName="code-block-container";Qw.className="ql-code-block-container";Qw.tagName="DIV";Qw.allowedChildren=[xc];xc.allowedChildren=[Wh,of,th];xc.requiredContainer=Qw;const j9={scope:Si.BLOCK,whitelist:["rtl"]},nCe=new um("direction","dir",j9),aCe=new sf("direction","ql-direction",j9),sCe=new nb("direction","direction",j9),oCe={scope:Si.INLINE,whitelist:["serif","monospace"]},lCe=new sf("font","ql-font",oCe);class yft extends nb{value(e){return super.value(e).replace(/["']/g,"")}}const cCe=new yft("font","font-family",oCe),uCe=new sf("size","ql-size",{scope:Si.INLINE,whitelist:["small","large","huge"]}),dCe=new nb("size","font-size",{scope:Si.INLINE,whitelist:["10px","18px","32px"]}),bft=rv("quill:keyboard"),Ift=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class w2 extends Am{static match(e,i){return["altKey","ctrlKey","metaKey","shiftKey"].some(r=>!!i[r]!==e[r]&&i[r]!==null)?!1:i.key===e.key||i.key===e.which}constructor(e,i){super(e,i),this.bindings={},Object.keys(this.options.bindings).forEach(r=>{this.options.bindings[r]&&this.addBinding(this.options.bindings[r])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=Sft(e);if(n==null){bft.warn("Attempted to add invalid keyboard binding",n);return}typeof i=="function"&&(i={handler:i}),typeof r=="function"&&(r={handler:r}),(Array.isArray(n.key)?n.key:[n.key]).forEach(s=>{const o={...n,key:s,...i,...r};this.bindings[o.key]=this.bindings[o.key]||[],this.bindings[o.key].push(o)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const n=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(v=>w2.match(e,v));if(n.length===0)return;const a=lt.find(e.target,!0);if(a&&a.scroll!==this.quill.scroll)return;const s=this.quill.getSelection();if(s==null||!this.quill.hasFocus())return;const[o,l]=this.quill.getLine(s.index),[c,u]=this.quill.getLeaf(s.index),[d,p]=s.length===0?[c,u]:this.quill.getLeaf(s.index+s.length),h=c instanceof ok?c.value().slice(0,u):"",f=d instanceof ok?d.value().slice(p):"",m={collapsed:s.length===0,empty:s.length===0&&o.length()<=1,format:this.quill.getFormat(s),line:o,offset:l,prefix:h,suffix:f,event:e};n.some(v=>{if(v.collapsed!=null&&v.collapsed!==m.collapsed||v.empty!=null&&v.empty!==m.empty||v.offset!=null&&v.offset!==m.offset)return!1;if(Array.isArray(v.format)){if(v.format.every(y=>m.format[y]==null))return!1}else if(typeof v.format=="object"&&!Object.keys(v.format).every(y=>v.format[y]===!0?m.format[y]!=null:v.format[y]===!1?m.format[y]==null:k9(v.format[y],m.format[y])))return!1;return v.prefix!=null&&!v.prefix.test(m.prefix)||v.suffix!=null&&!v.suffix.test(m.suffix)?!1:v.handler.call(this,s,m,v)!==!0})&&e.preventDefault()})}handleBackspace(e,i){const r=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(i.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let n={};const[a]=this.quill.getLine(e.index);let s=new gi().retain(e.index-r).delete(r);if(i.offset===0){const[o]=this.quill.getLine(e.index-1);if(o&&!(o.statics.blotName==="block"&&o.length()<=1)){const c=a.formats(),u=this.quill.getFormat(e.index-1,1);if(n=ep.AttributeMap.diff(c,u)||{},Object.keys(n).length>0){const d=new gi().retain(e.index+a.length()-2).retain(1,n);s=s.compose(d)}}}this.quill.updateContents(s,lt.sources.USER),this.quill.focus()}handleDelete(e,i){const r=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(i.suffix)?2:1;if(e.index>=this.quill.getLength()-r)return;let n={};const[a]=this.quill.getLine(e.index);let s=new gi().retain(e.index).delete(r);if(i.offset>=a.length()-1){const[o]=this.quill.getLine(e.index+1);if(o){const l=a.formats(),c=this.quill.getFormat(e.index,1);n=ep.AttributeMap.diff(l,c)||{},Object.keys(n).length>0&&(s=s.retain(o.length()-1).retain(1,n))}}this.quill.updateContents(s,lt.sources.USER),this.quill.focus()}handleDeleteRange(e){G9({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,i){const r=Object.keys(i.format).reduce((a,s)=>(this.quill.scroll.query(s,Si.BLOCK)&&!Array.isArray(i.format[s])&&(a[s]=i.format[s]),a),{}),n=new gi().retain(e.index).delete(e.length).insert(`
`,r);this.quill.updateContents(n,lt.sources.USER),this.quill.setSelection(e.index+1,lt.sources.SILENT),this.quill.focus()}}const wft={bindings:{bold:U$("bold"),italic:U$("italic"),underline:U$("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",lt.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(t,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",lt.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(t,e){e.format.indent!=null?this.quill.format("indent","-1",lt.sources.USER):e.format.list!=null&&this.quill.format("list",!1,lt.sources.USER)}},"indent code-block":gte(!0),"outdent code-block":gte(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(t){this.quill.deleteText(t.index-1,1,lt.sources.USER)}},tab:{key:"Tab",handler(t,e){if(e.format.table)return!0;this.quill.history.cutoff();const i=new gi().retain(t.index).delete(t.length).insert("	");return this.quill.updateContents(i,lt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,lt.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,lt.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(t,e){const i={list:!1};e.format.indent&&(i.indent=!1),this.quill.formatLine(t.index,t.length,i,lt.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(t){const[e,i]=this.quill.getLine(t.index),r={...e.formats(),list:"checked"},n=new gi().retain(t.index).insert(`
`,r).retain(e.length()-i-1).retain(1,{list:"unchecked"});this.quill.updateContents(n,lt.sources.USER),this.quill.setSelection(t.index+1,lt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(t,e){const[i,r]=this.quill.getLine(t.index),n=new gi().retain(t.index).insert(`
`,e.format).retain(i.length()-r-1).retain(1,{header:null});this.quill.updateContents(n,lt.sources.USER),this.quill.setSelection(t.index+1,lt.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(t){const e=this.quill.getModule("table");if(e){const[i,r,n,a]=e.getTable(t),s=Tft(i,r,n,a);if(s==null)return;let o=i.offset();if(s<0){const l=new gi().retain(o).insert(`
`);this.quill.updateContents(l,lt.sources.USER),this.quill.setSelection(t.index+1,t.length,lt.sources.SILENT)}else if(s>0){o+=i.length();const l=new gi().retain(o).insert(`
`);this.quill.updateContents(l,lt.sources.USER),this.quill.setSelection(o,lt.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(t,e){const{event:i,line:r}=e,n=r.offset(this.quill.scroll);i.shiftKey?this.quill.setSelection(n-1,lt.sources.USER):this.quill.setSelection(n+r.length(),lt.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(t,e){if(this.quill.scroll.query("list")==null)return!0;const{length:i}=e.prefix,[r,n]=this.quill.getLine(t.index);if(n>i)return!0;let a;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",lt.sources.USER),this.quill.history.cutoff();const s=new gi().retain(t.index-n).delete(i+1).retain(r.length()-2-n).retain(1,{list:a});return this.quill.updateContents(s,lt.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-i,lt.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(t){const[e,i]=this.quill.getLine(t.index);let r=2,n=e;for(;n!=null&&n.length()<=1&&n.formats()["code-block"];)if(n=n.prev,r-=1,r<=0){const a=new gi().retain(t.index+e.length()-i-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(a,lt.sources.USER),this.quill.setSelection(t.index-1,lt.sources.SILENT),!1}return!0}},"embed left":iN("ArrowLeft",!1),"embed left shift":iN("ArrowLeft",!0),"embed right":iN("ArrowRight",!1),"embed right shift":iN("ArrowRight",!0),"table down":vte(!1),"table up":vte(!0)}};w2.DEFAULTS=wft;function gte(t){return{key:"Tab",shiftKey:!t,format:{"code-block":!0},handler(e,i){let{event:r}=i;const n=this.quill.scroll.query("code-block"),{TAB:a}=n;if(e.length===0&&!r.shiftKey){this.quill.insertText(e.index,a,lt.sources.USER),this.quill.setSelection(e.index+a.length,lt.sources.SILENT);return}const s=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:o,length:l}=e;s.forEach((c,u)=>{t?(c.insertAt(0,a),u===0?o+=a.length:l+=a.length):c.domNode.textContent.startsWith(a)&&(c.deleteAt(0,a.length),u===0?o-=a.length:l-=a.length)}),this.quill.update(lt.sources.USER),this.quill.setSelection(o,l,lt.sources.SILENT)}}}function iN(t,e){return{key:t,shiftKey:e,altKey:null,[t==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(r){let{index:n}=r;t==="ArrowRight"&&(n+=r.length+1);const[a]=this.quill.getLeaf(n);return a instanceof Ad?(t==="ArrowLeft"?e?this.quill.setSelection(r.index-1,r.length+1,lt.sources.USER):this.quill.setSelection(r.index-1,lt.sources.USER):e?this.quill.setSelection(r.index,r.length+1,lt.sources.USER):this.quill.setSelection(r.index+r.length+1,lt.sources.USER),!1):!0}}}function U$(t){return{key:t[0],shortKey:!0,handler(e,i){this.quill.format(t,!i.format[t],lt.sources.USER)}}}function vte(t){return{key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,i){const r=t?"prev":"next",n=i.line,a=n.parent[r];if(a!=null){if(a.statics.blotName==="table-row"){let s=a.children.head,o=n;for(;o.prev!=null;)o=o.prev,s=s.next;const l=s.offset(this.quill.scroll)+Math.min(i.offset,s.length()-1);this.quill.setSelection(l,0,lt.sources.USER)}}else{const s=n.table()[r];s!=null&&(t?this.quill.setSelection(s.offset(this.quill.scroll)+s.length()-1,0,lt.sources.USER):this.quill.setSelection(s.offset(this.quill.scroll),0,lt.sources.USER))}return!1}}}function Sft(t){if(typeof t=="string"||typeof t=="number")t={key:t};else if(typeof t=="object")t=uT(t);else return null;return t.shortKey&&(t[Ift]=t.shortKey,delete t.shortKey),t}function G9(t){let{quill:e,range:i}=t;const r=e.getLines(i);let n={};if(r.length>1){const a=r[0].formats(),s=r[r.length-1].formats();n=ep.AttributeMap.diff(s,a)||{}}e.deleteText(i,lt.sources.USER),Object.keys(n).length>0&&e.formatLine(i.index,1,n,lt.sources.USER),e.setSelection(i.index,lt.sources.SILENT)}function Tft(t,e,i,r){return e.prev==null&&e.next==null?i.prev==null&&i.next==null?r===0?-1:1:i.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const Uft=/font-weight:\s*normal/,Dft=["P","OL","UL"],yte=t=>t&&Dft.includes(t.tagName),Eft=t=>{Array.from(t.querySelectorAll("br")).filter(e=>yte(e.previousElementSibling)&&yte(e.nextElementSibling)).forEach(e=>{e.parentNode?.removeChild(e)})},Pft=t=>{Array.from(t.querySelectorAll('b[style*="font-weight"]')).filter(e=>e.getAttribute("style")?.match(Uft)).forEach(e=>{const i=t.createDocumentFragment();i.append(...e.childNodes),e.parentNode?.replaceChild(i,e)})};function Cft(t){t.querySelector('[id^="docs-internal-guid-"]')&&(Pft(t),Eft(t))}const Rft=/\bmso-list:[^;]*ignore/i,Mft=/\bmso-list:[^;]*\bl(\d+)/i,Nft=/\bmso-list:[^;]*\blevel(\d+)/i,Aft=(t,e)=>{const i=t.getAttribute("style"),r=i?.match(Mft);if(!r)return null;const n=Number(r[1]),a=i?.match(Nft),s=a?Number(a[1]):1,o=new RegExp(`@list l${n}:level${s}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(o),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:n,indent:s,type:c,element:t}},_ft=t=>{const e=Array.from(t.querySelectorAll("[style*=mso-list]")),i=[],r=[];e.forEach(s=>{(s.getAttribute("style")||"").match(Rft)?i.push(s):r.push(s)}),i.forEach(s=>s.parentNode?.removeChild(s));const n=t.documentElement.innerHTML,a=r.map(s=>Aft(s,n)).filter(s=>s);for(;a.length;){const s=[];let o=a.shift();for(;o;)s.push(o),o=a.length&&a[0]?.element===o.element.nextElementSibling&&a[0].id===o.id?a.shift():null;const l=document.createElement("ul");s.forEach(d=>{const p=document.createElement("li");p.setAttribute("data-list",d.type),d.indent>1&&p.setAttribute("class",`ql-indent-${d.indent-1}`),p.innerHTML=d.element.innerHTML,l.appendChild(p)});const c=s[0]?.element,{parentNode:u}=c??{};c&&u?.replaceChild(l,c),s.slice(1).forEach(d=>{let{element:p}=d;u?.removeChild(p)})}};function kft(t){t.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&_ft(t)}const Oft=[kft,Cft],xft=t=>{t.documentElement&&Oft.forEach(e=>{e(t)})},Lft=rv("quill:clipboard"),Fft=[[Node.TEXT_NODE,Xft],[Node.TEXT_NODE,Ite],["br",Hft],[Node.ELEMENT_NODE,Ite],[Node.ELEMENT_NODE,Gft],[Node.ELEMENT_NODE,jft],[Node.ELEMENT_NODE,Kft],["li",Wft],["ol, ul",Yft],["pre",zft],["tr",Zft],["b",D$("bold")],["i",D$("italic")],["strike",D$("strike")],["style",qft]],Bft=[mft,nCe].reduce((t,e)=>(t[e.keyName]=e,t),{}),bte=[iCe,$9,B9,sCe,cCe,dCe].reduce((t,e)=>(t[e.keyName]=e,t),{});class $ft extends Am{static DEFAULTS={matchers:[]};constructor(e,i){super(e,i),this.quill.root.addEventListener("copy",r=>this.onCaptureCopy(r,!1)),this.quill.root.addEventListener("cut",r=>this.onCaptureCopy(r,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],Fft.concat(this.options.matchers??[]).forEach(r=>{let[n,a]=r;this.addMatcher(n,a)})}addMatcher(e,i){this.matchers.push([e,i])}convert(e){let{html:i,text:r}=e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n[xc.blotName])return new gi().insert(r||"",{[xc.blotName]:n[xc.blotName]});if(!i)return new gi().insert(r||"",n);const a=this.convertHTML(i);return tM(a,`
`)&&(a.ops[a.ops.length-1].attributes==null||n.table)?a.compose(new gi().retain(a.length()-1).delete(1)):a}normalizeHTML(e){xft(e)}convertHTML(e){const i=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(i);const r=i.body,n=new WeakMap,[a,s]=this.prepareMatching(r,n);return H9(this.quill.scroll,r,a,s,n)}dangerouslyPasteHTML(e,i){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:lt.sources.API;if(typeof e=="string"){const n=this.convert({html:e,text:""});this.quill.setContents(n,i),this.quill.setSelection(0,lt.sources.SILENT)}else{const n=this.convert({html:i,text:""});this.quill.updateContents(new gi().retain(e).concat(n),r),this.quill.setSelection(e+n.length(),lt.sources.SILENT)}}onCaptureCopy(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[r]=this.quill.selection.getRange();if(r==null)return;const{html:n,text:a}=this.onCopy(r,i);e.clipboardData?.setData("text/plain",a),e.clipboardData?.setData("text/html",n),i&&G9({range:r,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(i=>i[0]!=="#").join(`
`)}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const i=this.quill.getSelection(!0);if(i==null)return;const r=e.clipboardData?.getData("text/html");let n=e.clipboardData?.getData("text/plain");if(!r&&!n){const s=e.clipboardData?.getData("text/uri-list");s&&(n=this.normalizeURIList(s))}const a=Array.from(e.clipboardData?.files||[]);if(!r&&a.length>0){this.quill.uploader.upload(i,a);return}if(r&&a.length>0){const s=new DOMParser().parseFromString(r,"text/html");if(s.body.childElementCount===1&&s.body.firstElementChild?.tagName==="IMG"){this.quill.uploader.upload(i,a);return}}this.onPaste(i,{html:r,text:n})}onCopy(e){const i=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:i}}onPaste(e,i){let{text:r,html:n}=i;const a=this.quill.getFormat(e.index),s=this.convert({text:r,html:n},a);Lft.log("onPaste",s,{text:r,html:n});const o=new gi().retain(e.index).delete(e.length).concat(s);this.quill.updateContents(o,lt.sources.USER),this.quill.setSelection(o.length()-e.length,lt.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,i){const r=[],n=[];return this.matchers.forEach(a=>{const[s,o]=a;switch(s){case Node.TEXT_NODE:n.push(o);break;case Node.ELEMENT_NODE:r.push(o);break;default:Array.from(e.querySelectorAll(s)).forEach(l=>{i.has(l)?i.get(l)?.push(o):i.set(l,[o])});break}}),[r,n]}}function eS(t,e,i,r){return r.query(e)?t.reduce((n,a)=>{if(!a.insert)return n;if(a.attributes&&a.attributes[e])return n.push(a);const s=i?{[e]:i}:{};return n.insert(a.insert,{...s,...a.attributes})},new gi):t}function tM(t,e){let i="";for(let r=t.ops.length-1;r>=0&&i.length<e.length;--r){const n=t.ops[r];if(typeof n.insert!="string")break;i=n.insert+i}return i.slice(-1*e.length)===e}function _v(t,e){if(!(t instanceof Element))return!1;const i=e.query(t);return i&&i.prototype instanceof Ad?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(t.tagName.toLowerCase())}function Vft(t,e){return t.previousElementSibling&&t.nextElementSibling&&!_v(t.previousElementSibling,e)&&!_v(t.nextElementSibling,e)}const rN=new WeakMap;function pCe(t){return t==null?!1:(rN.has(t)||(t.tagName==="PRE"?rN.set(t,!0):rN.set(t,pCe(t.parentNode))),rN.get(t))}function H9(t,e,i,r,n){return e.nodeType===e.TEXT_NODE?r.reduce((a,s)=>s(e,a,t),new gi):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((a,s)=>{let o=H9(t,s,i,r,n);return s.nodeType===e.ELEMENT_NODE&&(o=i.reduce((l,c)=>c(s,l,t),o),o=(n.get(s)||[]).reduce((l,c)=>c(s,l,t),o)),a.concat(o)},new gi):new gi}function D$(t){return(e,i,r)=>eS(i,t,!0,r)}function jft(t,e,i){const r=um.keys(t),n=sf.keys(t),a=nb.keys(t),s={};return r.concat(n).concat(a).forEach(o=>{let l=i.query(o,Si.ATTRIBUTE);l!=null&&(s[l.attrName]=l.value(t),s[l.attrName])||(l=Bft[o],l!=null&&(l.attrName===o||l.keyName===o)&&(s[l.attrName]=l.value(t)||void 0),l=bte[o],l!=null&&(l.attrName===o||l.keyName===o)&&(l=bte[o],s[l.attrName]=l.value(t)||void 0))}),Object.entries(s).reduce((o,l)=>{let[c,u]=l;return eS(o,c,u,i)},e)}function Gft(t,e,i){const r=i.query(t);if(r==null)return e;if(r.prototype instanceof Ad){const n={},a=r.value(t);if(a!=null)return n[r.blotName]=a,new gi().insert(n,r.formats(t,i))}else if(r.prototype instanceof XC&&!tM(e,`
`)&&e.insert(`
`),"blotName"in r&&"formats"in r&&typeof r.formats=="function")return eS(e,r.blotName,r.formats(t,i),i);return e}function Hft(t,e){return tM(e,`
`)||e.insert(`
`),e}function zft(t,e,i){const r=i.query("code-block"),n=r&&"formats"in r&&typeof r.formats=="function"?r.formats(t,i):!0;return eS(e,"code-block",n,i)}function qft(){return new gi}function Wft(t,e,i){const r=i.query(t);if(r==null||r.blotName!=="list"||!tM(e,`
`))return e;let n=-1,a=t.parentNode;for(;a!=null;)["OL","UL"].includes(a.tagName)&&(n+=1),a=a.parentNode;return n<=0?e:e.reduce((s,o)=>o.insert?o.attributes&&typeof o.attributes.indent=="number"?s.push(o):s.insert(o.insert,{indent:n,...o.attributes||{}}):s,new gi)}function Yft(t,e,i){const r=t;let n=r.tagName==="OL"?"ordered":"bullet";const a=r.getAttribute("data-checked");return a&&(n=a==="true"?"checked":"unchecked"),eS(e,"list",n,i)}function Ite(t,e,i){if(!tM(e,`
`)){if(_v(t,i)&&(t.childNodes.length>0||t instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&t.nextSibling){let r=t.nextSibling;for(;r!=null;){if(_v(r,i))return e.insert(`
`);const n=i.query(r);if(n&&n.prototype instanceof Xd)return e.insert(`
`);r=r.firstChild}}}return e}function Kft(t,e,i){const r={},n=t.style||{};return n.fontStyle==="italic"&&(r.italic=!0),n.textDecoration==="underline"&&(r.underline=!0),n.textDecoration==="line-through"&&(r.strike=!0),(n.fontWeight?.startsWith("bold")||parseInt(n.fontWeight,10)>=700)&&(r.bold=!0),e=Object.entries(r).reduce((a,s)=>{let[o,l]=s;return eS(a,o,l,i)},e),parseFloat(n.textIndent||0)>0?new gi().insert("	").concat(e):e}function Zft(t,e,i){const r=t.parentElement?.tagName==="TABLE"?t.parentElement:t.parentElement?.parentElement;if(r!=null){const a=Array.from(r.querySelectorAll("tr")).indexOf(t)+1;return eS(e,"table",a,i)}return e}function Xft(t,e,i){let r=t.data;if(t.parentElement?.tagName==="O:P")return e.insert(r.trim());if(!pCe(t)){if(r.trim().length===0&&r.includes(`
`)&&!Vft(t,i))return e;r=r.replace(/[^\S\u00a0]/g," "),r=r.replace(/ {2,}/g," "),(t.previousSibling==null&&t.parentElement!=null&&_v(t.parentElement,i)||t.previousSibling instanceof Element&&_v(t.previousSibling,i))&&(r=r.replace(/^ /,"")),(t.nextSibling==null&&t.parentElement!=null&&_v(t.parentElement,i)||t.nextSibling instanceof Element&&_v(t.nextSibling,i))&&(r=r.replace(/ $/,"")),r=r.replaceAll(""," ")}return e.insert(r)}class Jft extends Am{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(e,i){super(e,i),this.quill.on(lt.events.EDITOR_CHANGE,(r,n,a,s)=>{r===lt.events.SELECTION_CHANGE?n&&s!==lt.sources.SILENT&&(this.currentRange=n):r===lt.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||s===lt.sources.USER?this.record(n,a):this.transform(n)),this.currentRange=NG(this.currentRange,n))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",r=>{r.inputType==="historyUndo"?(this.undo(),r.preventDefault()):r.inputType==="historyRedo"&&(this.redo(),r.preventDefault())})}change(e,i){if(this.stack[e].length===0)return;const r=this.stack[e].pop();if(!r)return;const n=this.quill.getContents(),a=r.delta.invert(n);this.stack[i].push({delta:a,range:NG(r.range,a)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(r.delta,lt.sources.USER),this.ignoreChange=!1,this.restoreSelection(r)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(e,i){if(e.ops.length===0)return;this.stack.redo=[];let r=e.invert(i),n=this.currentRange;const a=Date.now();if(this.lastRecorded+this.options.delay>a&&this.stack.undo.length>0){const s=this.stack.undo.pop();s&&(r=r.compose(s.delta),n=s.range)}else this.lastRecorded=a;r.length()!==0&&(this.stack.undo.push({delta:r,range:n}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(e){wte(this.stack.undo,e),wte(this.stack.redo,e)}undo(){this.change("undo","redo")}restoreSelection(e){if(e.range)this.quill.setSelection(e.range,lt.sources.USER);else{const i=emt(this.quill.scroll,e.delta);this.quill.setSelection(i,lt.sources.USER)}}}function wte(t,e){let i=e;for(let r=t.length-1;r>=0;r-=1){const n=t[r];t[r]={delta:i.transform(n.delta,!0),range:n.range&&NG(n.range,i)},i=n.delta.transform(i),t[r].delta.length()===0&&t.splice(r,1)}}function Qft(t,e){const i=e.ops[e.ops.length-1];return i==null?!1:i.insert!=null?typeof i.insert=="string"&&i.insert.endsWith(`
`):i.attributes!=null?Object.keys(i.attributes).some(r=>t.query(r,Si.BLOCK)!=null):!1}function emt(t,e){const i=e.reduce((n,a)=>n+(a.delete||0),0);let r=e.length()-i;return Qft(t,e)&&(r-=1),r}function NG(t,e){if(!t)return t;const i=e.transformPosition(t.index),r=e.transformPosition(t.index+t.length);return{index:i,length:r-i}}class hCe extends Am{constructor(e,i){super(e,i),e.root.addEventListener("drop",r=>{r.preventDefault();let n=null;if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(r.clientX,r.clientY);else if(document.caretPositionFromPoint){const s=document.caretPositionFromPoint(r.clientX,r.clientY);n=document.createRange(),n.setStart(s.offsetNode,s.offset),n.setEnd(s.offsetNode,s.offset)}const a=n&&e.selection.normalizeNative(n);if(a){const s=e.selection.normalizedToRange(a);r.dataTransfer?.files&&this.upload(s,r.dataTransfer.files)}})}upload(e,i){const r=[];Array.from(i).forEach(n=>{n&&this.options.mimetypes?.includes(n.type)&&r.push(n)}),r.length>0&&this.options.handler.call(this,e,r)}}hCe.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(t,e){if(!this.quill.scroll.query("image"))return;const i=e.map(r=>new Promise(n=>{const a=new FileReader;a.onload=()=>{n(a.result)},a.readAsDataURL(r)}));Promise.all(i).then(r=>{const n=r.reduce((a,s)=>a.insert({image:s}),new gi().retain(t.index).delete(t.length));this.quill.updateContents(n,hi.sources.USER),this.quill.setSelection(t.index+r.length,hi.sources.SILENT)})}};const tmt=["insertText","insertReplacementText"];class imt extends Am{constructor(e,i){super(e,i),e.root.addEventListener("beforeinput",r=>{this.handleBeforeInput(r)}),/Android/i.test(navigator.userAgent)||e.on(lt.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){G9({range:e,quill:this.quill})}replaceText(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(i){const r=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new gi().retain(e.index).insert(i,r),lt.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+i.length,0,lt.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!tmt.includes(e.inputType))return;const i=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!i||i.collapsed===!0)return;const r=rmt(e);if(r==null)return;const n=this.quill.selection.normalizeNative(i),a=n?this.quill.selection.normalizedToRange(n):null;a&&this.replaceText(a,r)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function rmt(t){return typeof t.data=="string"?t.data:t.dataTransfer?.types.includes("text/plain")?t.dataTransfer.getData("text/plain"):null}const nmt=/Mac/i.test(navigator.platform),amt=100,smt=t=>!!(t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="Home"||nmt&&t.key==="a"&&t.ctrlKey===!0);class omt extends Am{isListening=!1;selectionChangeDeadline=0;constructor(e,i){super(e,i),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,i){let{line:r,event:n}=i;if(!(r instanceof Sh)||!r.uiNode)return!0;const a=getComputedStyle(r.domNode).direction==="rtl";return a&&n.key!=="ArrowRight"||!a&&n.key!=="ArrowLeft"?!0:(this.quill.setSelection(e.index-1,e.length+(n.shiftKey?1:0),lt.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",e=>{!e.defaultPrevented&&smt(e)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+amt,this.isListening)return;this.isListening=!0;const e=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",e,{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const i=e.getRangeAt(0);if(i.collapsed!==!0||i.startOffset!==0)return;const r=this.quill.scroll.find(i.startContainer);if(!(r instanceof Sh)||!r.uiNode)return;const n=document.createRange();n.setStartAfter(r.uiNode),n.setEndAfter(r.uiNode),e.removeAllRanges(),e.addRange(n)}}lt.register({"blots/block":Tl,"blots/block/embed":Xd,"blots/break":of,"blots/container":Jw,"blots/cursor":th,"blots/embed":L9,"blots/inline":Mc,"blots/scroll":fft,"blots/text":Wh,"modules/clipboard":$ft,"modules/history":Jft,"modules/keyboard":w2,"modules/uploader":hCe,"modules/input":imt,"modules/uiNode":omt});class lmt extends sf{add(e,i){let r=0;if(i==="+1"||i==="-1"){const n=this.value(e)||0;r=i==="+1"?n+1:n-1}else typeof i=="number"&&(r=i);return r===0?(this.remove(e),!0):super.add(e,r.toString())}canAdd(e,i){return super.canAdd(e,i)||super.canAdd(e,parseInt(i,10))}value(e){return parseInt(super.value(e),10)||void 0}}const cmt=new lmt("indent","ql-indent",{scope:Si.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class umt extends Tl{static blotName="blockquote";static tagName="blockquote"}let dmt=class extends Tl{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(e){return this.tagName.indexOf(e.tagName)+1}};class iM extends Jw{}iM.blotName="list-container";iM.tagName="OL";class rM extends Tl{static create(e){const i=super.create();return i.setAttribute("data-list",e),i}static formats(e){return e.getAttribute("data-list")||void 0}static register(){lt.register(iM)}constructor(e,i){super(e,i);const r=i.ownerDocument.createElement("span"),n=a=>{if(!e.isEnabled())return;const s=this.statics.formats(i,e);s==="checked"?(this.format("list","unchecked"),a.preventDefault()):s==="unchecked"&&(this.format("list","checked"),a.preventDefault())};r.addEventListener("mousedown",n),r.addEventListener("touchstart",n),this.attachUI(r)}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-list",i):super.format(e,i)}}rM.blotName="list";rM.tagName="LI";iM.allowedChildren=[rM];rM.requiredContainer=iM;class z9 extends Mc{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}class pmt extends z9{static blotName="italic";static tagName=["EM","I"]}class lk extends Mc{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(e){const i=super.create(e);return i.setAttribute("href",this.sanitize(e)),i.setAttribute("rel","noopener noreferrer"),i.setAttribute("target","_blank"),i}static formats(e){return e.getAttribute("href")}static sanitize(e){return fCe(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,i){e!==this.statics.blotName||!i?super.format(e,i):this.domNode.setAttribute("href",this.constructor.sanitize(i))}}function fCe(t,e){const i=document.createElement("a");i.href=t;const r=i.href.slice(0,i.href.indexOf(":"));return e.indexOf(r)>-1}class hmt extends Mc{static blotName="script";static tagName=["SUB","SUP"];static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}class fmt extends z9{static blotName="strike";static tagName=["S","STRIKE"]}class mmt extends Mc{static blotName="underline";static tagName="U"}class gmt extends L9{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const i=super.create(e);return typeof e=="string"&&(window.katex.render(e,i,{throwOnError:!1,errorColor:"#f00"}),i.setAttribute("data-value",e)),i}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}const Ste=["alt","height","width"];let vmt=class extends Ad{static blotName="image";static tagName="IMG";static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Ste.reduce((i,r)=>(e.hasAttribute(r)&&(i[r]=e.getAttribute(r)),i),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return fCe(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,i){Ste.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}};const Tte=["height","width"];class ymt extends Xd{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(e){const i=super.create(e);return i.setAttribute("frameborder","0"),i.setAttribute("allowfullscreen","true"),i.setAttribute("src",this.sanitize(e)),i}static formats(e){return Tte.reduce((i,r)=>(e.hasAttribute(r)&&(i[r]=e.getAttribute(r)),i),{})}static sanitize(e){return lk.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,i){Tte.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}const xE=new sf("code-token","hljs",{scope:Si.INLINE});class Mg extends Mc{static formats(e,i){for(;e!=null&&e!==i.domNode;){if(e.classList&&e.classList.contains(xc.className))return super.formats(e,i);e=e.parentNode}}constructor(e,i,r){super(e,i,r),xE.add(this.domNode,r)}format(e,i){e!==Mg.blotName?super.format(e,i):i?xE.add(this.domNode,i):(xE.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),xE.value(this.domNode)||this.unwrap()}}Mg.blotName="code-token";Mg.className="ql-token";class Kd extends xc{static create(e){const i=super.create(e);return typeof e=="string"&&i.setAttribute("data-language",e),i}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,i){e===this.statics.blotName&&i?this.domNode.setAttribute("data-language",i):super.format(e,i)}replaceWith(e,i){return this.formatAt(0,this.length(),Mg.blotName,!1),super.replaceWith(e,i)}}class bP extends Qw{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,i){e===Kd.blotName&&(this.forceNext=!0,this.children.forEach(r=>{r.format(e,i)}))}formatAt(e,i,r,n){r===Kd.blotName&&(this.forceNext=!0),super.formatAt(e,i,r,n)}highlight(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const n=`${Array.from(this.domNode.childNodes).filter(s=>s!==this.uiNode).map(s=>s.textContent).join(`
`)}
`,a=Kd.formats(this.children.head.domNode);if(i||this.forceNext||this.cachedText!==n){if(n.trim().length>0||this.cachedText==null){const s=this.children.reduce((l,c)=>l.concat(QPe(c,!1)),new gi),o=e(n,a);s.diff(o).reduce((l,c)=>{let{retain:u,attributes:d}=c;return u?(d&&Object.keys(d).forEach(p=>{[Kd.blotName,Mg.blotName].includes(p)&&this.formatAt(l,u,p,d[p])}),l+u):l},0)}this.cachedText=n,this.forceNext=!1}}html(e,i){const[r]=this.children.find(e);return`<pre data-language="${r?Kd.formats(r.domNode):"plain"}">
${I2(this.code(e,i))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const i=Kd.formats(this.children.head.domNode);i!==this.uiNode.value&&(this.uiNode.value=i)}}}bP.allowedChildren=[Kd];Kd.requiredContainer=bP;Kd.allowedChildren=[Mg,th,Wh,of];const bmt=(t,e,i)=>{if(typeof t.versionString=="string"){const r=t.versionString.split(".")[0];if(parseInt(r,10)>=11)return t.highlight(i,{language:e}).value}return t.highlight(e,i).value};class mCe extends Am{static register(){lt.register(Mg,!0),lt.register(Kd,!0),lt.register(bP,!0)}constructor(e,i){if(super(e,i),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((r,n)=>{let{key:a}=n;return r[a]=!0,r},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(lt.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof bP))return;const i=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(r=>{let{key:n,label:a}=r;const s=i.ownerDocument.createElement("option");s.textContent=a,s.setAttribute("value",n),i.appendChild(s)}),i.addEventListener("change",()=>{e.format(Kd.blotName,i.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(i),e.children.head&&(i.value=Kd.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(lt.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(lt.sources.USER);const r=this.quill.getSelection();(e==null?this.quill.scroll.descendants(bP):[e]).forEach(a=>{a.highlight(this.highlightBlot,i)}),this.quill.update(lt.sources.SILENT),r!=null&&this.quill.setSelection(r,lt.sources.SILENT)}highlightBlot(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(i=this.languages[i]?i:"plain",i==="plain")return I2(e).split(`
`).reduce((n,a,s)=>(s!==0&&n.insert(`
`,{[xc.blotName]:i}),n.insert(a)),new gi);const r=this.quill.root.ownerDocument.createElement("div");return r.classList.add(xc.className),r.innerHTML=bmt(this.options.hljs,i,e),H9(this.quill.scroll,r,[(n,a)=>{const s=xE.value(n);return s?a.compose(new gi().retain(a.length(),{[Mg.blotName]:s})):a}],[(n,a)=>n.data.split(`
`).reduce((s,o,l)=>(l!==0&&s.insert(`
`,{[xc.blotName]:i}),s.insert(o)),a)],new WeakMap)}}mCe.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class rh extends Tl{static blotName="table";static tagName="TD";static create(e){const i=super.create();return e?i.setAttribute("data-row",e):i.setAttribute("data-row",q9()),i}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,i){e===rh.blotName&&i?this.domNode.setAttribute("data-row",i):super.format(e,i)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class _I extends Jw{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),i=this.children.tail.formats(),r=this.next.children.head.formats(),n=this.next.children.tail.formats();return e.table===i.table&&e.table===r.table&&e.table===n.table}return!1}optimize(e){super.optimize(e),this.children.forEach(i=>{if(i.next==null)return;const r=i.formats(),n=i.next.formats();if(r.table!==n.table){const a=this.splitAfter(i);a&&a.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class zv extends Jw{static blotName="table-body";static tagName="TBODY"}class ck extends Jw{static blotName="table-container";static tagName="TABLE";balanceCells(){const e=this.descendants(_I),i=e.reduce((r,n)=>Math.max(n.children.length,r),0);e.forEach(r=>{new Array(i-r.children.length).fill(0).forEach(()=>{let n;r.children.head!=null&&(n=rh.formats(r.children.head.domNode));const a=this.scroll.create(rh.blotName,n);r.appendChild(a),a.optimize()})})}cells(e){return this.rows().map(i=>i.children.at(e))}deleteColumn(e){const[i]=this.descendant(zv);i==null||i.children.head==null||i.children.forEach(r=>{const n=r.children.at(e);n?.remove()})}insertColumn(e){const[i]=this.descendant(zv);i==null||i.children.head==null||i.children.forEach(r=>{const n=r.children.at(e),a=rh.formats(r.children.head.domNode),s=this.scroll.create(rh.blotName,a);r.insertBefore(s,n)})}insertRow(e){const[i]=this.descendant(zv);if(i==null||i.children.head==null)return;const r=q9(),n=this.scroll.create(_I.blotName);i.children.head.children.forEach(()=>{const s=this.scroll.create(rh.blotName,r);n.appendChild(s)});const a=i.children.at(e);i.insertBefore(n,a)}rows(){const e=this.children.head;return e==null?[]:e.children.map(i=>i)}}ck.allowedChildren=[zv];zv.requiredContainer=ck;zv.allowedChildren=[_I];_I.requiredContainer=zv;_I.allowedChildren=[rh];rh.requiredContainer=_I;function q9(){return`row-${Math.random().toString(36).slice(2,6)}`}class Imt extends Am{static register(){lt.register(rh),lt.register(_I),lt.register(zv),lt.register(ck)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(ck).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,i]=this.getTable();i!=null&&(e.deleteColumn(i.cellOffset()),this.quill.update(lt.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(lt.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const i=e.offset();e.remove(),this.quill.update(lt.sources.USER),this.quill.setSelection(i,lt.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[i,r]=this.quill.getLine(e.index);if(i==null||i.statics.blotName!==rh.blotName)return[null,null,null,-1];const n=i.parent;return[n.parent.parent,n,i,r]}insertColumn(e){const i=this.quill.getSelection();if(!i)return;const[r,n,a]=this.getTable(i);if(a==null)return;const s=a.cellOffset();r.insertColumn(s+e),this.quill.update(lt.sources.USER);let o=n.rowOffset();e===0&&(o+=1),this.quill.setSelection(i.index+o,i.length,lt.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const i=this.quill.getSelection();if(!i)return;const[r,n,a]=this.getTable(i);if(a==null)return;const s=n.rowOffset();r.insertRow(s+e),this.quill.update(lt.sources.USER),e>0?this.quill.setSelection(i,lt.sources.SILENT):this.quill.setSelection(i.index+n.children.length,i.length,lt.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,i){const r=this.quill.getSelection();if(r==null)return;const n=new Array(e).fill(0).reduce(a=>{const s=new Array(i).fill(`
`).join("");return a.insert(s,{table:q9()})},new gi().retain(r.index));this.quill.updateContents(n,lt.sources.USER),this.quill.setSelection(r.index,lt.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(lt.events.SCROLL_OPTIMIZE,e=>{e.some(i=>["TD","TR","TBODY","TABLE"].includes(i.target.tagName)?(this.quill.once(lt.events.TEXT_CHANGE,(r,n,a)=>{a===lt.sources.USER&&this.balanceTables()}),!0):!1)})}}const Ute=rv("quill:toolbar");let W9=class extends Am{constructor(e,i){if(super(e,i),Array.isArray(this.options.container)){const r=document.createElement("div");r.setAttribute("role","toolbar"),wmt(r,this.options.container),e.container?.parentNode?.insertBefore(r,e.container),this.container=r}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){Ute.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(r=>{const n=this.options.handlers?.[r];n&&this.addHandler(r,n)}),Array.from(this.container.querySelectorAll("button, select")).forEach(r=>{this.attach(r)}),this.quill.on(lt.events.EDITOR_CHANGE,()=>{const[r]=this.quill.selection.getRange();this.update(r)})}addHandler(e,i){this.handlers[e]=i}attach(e){let i=Array.from(e.classList).find(n=>n.indexOf("ql-")===0);if(!i)return;if(i=i.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[i]==null&&this.quill.scroll.query(i)==null){Ute.warn("ignoring attaching to nonexistent format",i,e);return}const r=e.tagName==="SELECT"?"change":"click";e.addEventListener(r,n=>{let a;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const o=e.options[e.selectedIndex];o.hasAttribute("selected")?a=!1:a=o.value||!1}else e.classList.contains("ql-active")?a=!1:a=e.value||!e.hasAttribute("value"),n.preventDefault();this.quill.focus();const[s]=this.quill.selection.getRange();if(this.handlers[i]!=null)this.handlers[i].call(this,a);else if(this.quill.scroll.query(i).prototype instanceof Ad){if(a=prompt(`Enter ${i}`),!a)return;this.quill.updateContents(new gi().retain(s.index).delete(s.length).insert({[i]:a}),lt.sources.USER)}else this.quill.format(i,a,lt.sources.USER);this.update(s)}),this.controls.push([i,e])}update(e){const i=e==null?{}:this.quill.getFormat(e);this.controls.forEach(r=>{const[n,a]=r;if(a.tagName==="SELECT"){let s=null;if(e==null)s=null;else if(i[n]==null)s=a.querySelector("option[selected]");else if(!Array.isArray(i[n])){let o=i[n];typeof o=="string"&&(o=o.replace(/"/g,'\\"')),s=a.querySelector(`option[value="${o}"]`)}s==null?(a.value="",a.selectedIndex=-1):s.selected=!0}else if(e==null)a.classList.remove("ql-active"),a.setAttribute("aria-pressed","false");else if(a.hasAttribute("value")){const s=i[n],o=s===a.getAttribute("value")||s!=null&&s.toString()===a.getAttribute("value")||s==null&&!a.getAttribute("value");a.classList.toggle("ql-active",o),a.setAttribute("aria-pressed",o.toString())}else{const s=i[n]!=null;a.classList.toggle("ql-active",s),a.setAttribute("aria-pressed",s.toString())}})}};W9.DEFAULTS={};function Dte(t,e,i){const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(`ql-${e}`),r.setAttribute("aria-pressed","false"),i!=null?(r.value=i,r.setAttribute("aria-label",`${e}: ${i}`)):r.setAttribute("aria-label",e),t.appendChild(r)}function wmt(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(i=>{const r=document.createElement("span");r.classList.add("ql-formats"),i.forEach(n=>{if(typeof n=="string")Dte(r,n);else{const a=Object.keys(n)[0],s=n[a];Array.isArray(s)?Smt(r,a,s):Dte(r,a,s)}}),t.appendChild(r)})}function Smt(t,e,i){const r=document.createElement("select");r.classList.add(`ql-${e}`),i.forEach(n=>{const a=document.createElement("option");n!==!1?a.setAttribute("value",String(n)):a.setAttribute("selected","selected"),r.appendChild(a)}),t.appendChild(r)}W9.DEFAULTS={container:null,handlers:{clean(){const t=this.quill.getSelection();if(t!=null)if(t.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(i=>{this.quill.scroll.query(i,Si.INLINE)!=null&&this.quill.format(i,!1,lt.sources.USER)})}else this.quill.removeFormat(t.index,t.length,lt.sources.USER)},direction(t){const{align:e}=this.quill.getFormat();t==="rtl"&&e==null?this.quill.format("align","right",lt.sources.USER):!t&&e==="right"&&this.quill.format("align",!1,lt.sources.USER),this.quill.format("direction",t,lt.sources.USER)},indent(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e),r=parseInt(i.indent||0,10);if(t==="+1"||t==="-1"){let n=t==="+1"?1:-1;i.direction==="rtl"&&(n*=-1),this.quill.format("indent",r+n,lt.sources.USER)}},link(t){t===!0&&(t=prompt("Enter link URL:")),this.quill.format("link",t,lt.sources.USER)},list(t){const e=this.quill.getSelection(),i=this.quill.getFormat(e);t==="check"?i.list==="checked"||i.list==="unchecked"?this.quill.format("list",!1,lt.sources.USER):this.quill.format("list","unchecked",lt.sources.USER):this.quill.format("list",t,lt.sources.USER)}}};const Tmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',Umt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',Dmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',Emt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',Pmt='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',Cmt='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',Rmt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',Mmt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',Ete='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',Nmt='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',Amt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',_mt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',kmt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',Omt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',xmt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Lmt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',Fmt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',Bmt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',$mt='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',Vmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',jmt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',Gmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',Hmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',zmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',qmt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',Wmt='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',Ymt='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',Kmt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',Zmt='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',Xmt='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',Jmt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',Qmt='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',egt='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',QC={align:{"":Tmt,center:Umt,right:Dmt,justify:Emt},background:Pmt,blockquote:Cmt,bold:Rmt,clean:Mmt,code:Ete,"code-block":Ete,color:Nmt,direction:{"":Amt,rtl:_mt},formula:kmt,header:{1:Omt,2:xmt,3:Lmt,4:Fmt,5:Bmt,6:$mt},italic:Vmt,image:jmt,indent:{"+1":Gmt,"-1":Hmt},link:zmt,list:{bullet:qmt,check:Wmt,ordered:Ymt},script:{sub:Kmt,super:Zmt},strike:Xmt,table:Jmt,underline:Qmt,video:egt},tgt='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let Pte=0;function Cte(t,e){t.setAttribute(e,`${t.getAttribute(e)!=="true"}`)}class S2{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",i=>{switch(i.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),i.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),Cte(this.label,"aria-expanded"),Cte(this.options,"aria-hidden")}buildItem(e){const i=document.createElement("span");i.tabIndex="0",i.setAttribute("role","button"),i.classList.add("ql-picker-item");const r=e.getAttribute("value");return r&&i.setAttribute("data-value",r),e.textContent&&i.setAttribute("data-label",e.textContent),i.addEventListener("click",()=>{this.selectItem(i,!0)}),i.addEventListener("keydown",n=>{switch(n.key){case"Enter":this.selectItem(i,!0),n.preventDefault();break;case"Escape":this.escape(),n.preventDefault();break}}),i}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=tgt,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${Pte}`,Pte+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(i=>{const r=this.buildItem(i);e.appendChild(r),i.selected===!0&&this.selectItem(r)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=this.container.querySelector(".ql-selected");e!==r&&(r?.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),i&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const r=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(r)}else this.selectItem(null);const i=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",i)}}class gCe extends S2{constructor(e,i){super(e),this.label.innerHTML=i,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(r=>{r.classList.add("ql-primary")})}buildItem(e){const i=super.buildItem(e);return i.style.backgroundColor=e.getAttribute("value")||"",i}selectItem(e,i){super.selectItem(e,i);const r=this.label.querySelector(".ql-color-label"),n=e&&e.getAttribute("data-value")||"";r&&(r.tagName==="line"?r.style.stroke=n:r.style.fill=n)}}class vCe extends S2{constructor(e,i){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(r=>{r.innerHTML=i[r.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,i){super.selectItem(e,i);const r=e||this.defaultItem;if(r!=null){if(this.label.innerHTML===r.innerHTML)return;this.label.innerHTML=r.innerHTML}}}const igt=t=>{const{overflowY:e}=getComputedStyle(t,null);return e!=="visible"&&e!=="clip"};class yCe{constructor(e,i){this.quill=e,this.boundsContainer=i||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,igt(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const i=e.left+e.width/2-this.root.offsetWidth/2,r=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${i}px`,this.root.style.top=`${r}px`,this.root.classList.remove("ql-flip");const n=this.boundsContainer.getBoundingClientRect(),a=this.root.getBoundingClientRect();let s=0;if(a.right>n.right&&(s=n.right-a.right,this.root.style.left=`${i+s}px`),a.left<n.left&&(s=n.left-a.left,this.root.style.left=`${i+s}px`),a.bottom>n.bottom){const o=a.bottom-a.top,l=e.bottom-e.top+o;this.root.style.top=`${r-l}px`,this.root.classList.add("ql-flip")}return s}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const rgt=[!1,"center","right","justify"],ngt=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],agt=[!1,"serif","monospace"],sgt=["1","2","3",!1],ogt=["small",!1,"large","huge"];class nM extends eE{constructor(e,i){super(e,i);const r=n=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",r);return}this.tooltip!=null&&!this.tooltip.root.contains(n.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(a=>{a.container.contains(n.target)||a.close()})};e.emitter.listenDOM("click",document.body,r)}addModule(e){const i=super.addModule(e);return e==="toolbar"&&this.extendToolbar(i),i}buildButtons(e,i){Array.from(e).forEach(r=>{(r.getAttribute("class")||"").split(/\s+/).forEach(a=>{if(a.startsWith("ql-")&&(a=a.slice(3),i[a]!=null))if(a==="direction")r.innerHTML=i[a][""]+i[a].rtl;else if(typeof i[a]=="string")r.innerHTML=i[a];else{const s=r.value||"";s!=null&&i[a][s]&&(r.innerHTML=i[a][s])}})})}buildPickers(e,i){this.pickers=Array.from(e).map(n=>{if(n.classList.contains("ql-align")&&(n.querySelector("option")==null&&SE(n,rgt),typeof i.align=="object"))return new vCe(n,i.align);if(n.classList.contains("ql-background")||n.classList.contains("ql-color")){const a=n.classList.contains("ql-background")?"background":"color";return n.querySelector("option")==null&&SE(n,ngt,a==="background"?"#ffffff":"#000000"),new gCe(n,i[a])}return n.querySelector("option")==null&&(n.classList.contains("ql-font")?SE(n,agt):n.classList.contains("ql-header")?SE(n,sgt):n.classList.contains("ql-size")&&SE(n,ogt)),new S2(n)});const r=()=>{this.pickers.forEach(n=>{n.update()})};this.quill.on(hi.events.EDITOR_CHANGE,r)}}nM.DEFAULTS=Hv({},eE.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let t=this.container.querySelector("input.ql-image[type=file]");t==null&&(t=document.createElement("input"),t.setAttribute("type","file"),t.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),t.classList.add("ql-image"),t.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,t.files),t.value=""}),this.container.appendChild(t)),t.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class bCe extends yCe{constructor(e,i){super(e,i),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;i!=null?this.textbox.value=i:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const r=this.quill.getBounds(this.quill.selection.savedRange);r!=null&&this.position(r),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:i}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,hi.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,hi.sources.USER)),this.quill.root.scrollTop=i;break}case"video":e=lgt(e);case"formula":{if(!e)break;const i=this.quill.getSelection(!0);if(i!=null){const r=i.index+i.length;this.quill.insertEmbed(r,this.root.getAttribute("data-mode"),e,hi.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(r+1," ",hi.sources.USER),this.quill.setSelection(r+2,hi.sources.USER)}break}}this.textbox.value="",this.hide()}}function lgt(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:t}function SE(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(r=>{const n=document.createElement("option");r===i?n.setAttribute("selected","selected"):n.setAttribute("value",String(r)),t.appendChild(n)})}const cgt=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class ugt extends bCe{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(e,i){super(e,i),this.quill.on(hi.events.EDITOR_CHANGE,(r,n,a,s)=>{if(r===hi.events.SELECTION_CHANGE)if(n!=null&&n.length>0&&s===hi.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const o=this.quill.getLines(n.index,n.length);if(o.length===1){const l=this.quill.getBounds(n);l!=null&&this.position(l)}else{const l=o[o.length-1],c=this.quill.getIndex(l),u=Math.min(l.length()-1,n.index+n.length-c),d=this.quill.getBounds(new AI(c,u));d!=null&&this.position(d)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(hi.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const i=this.quill.getBounds(e);i!=null&&this.position(i)}},1)})}cancel(){this.show()}position(e){const i=super.position(e),r=this.root.querySelector(".ql-tooltip-arrow");return r.style.marginLeft="",i!==0&&(r.style.marginLeft=`${-1*i-r.offsetWidth/2}px`),i}}class ICe extends nM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=cgt),super(e,i),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new ugt(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),QC),this.buildPickers(e.container.querySelectorAll("select"),QC))}}ICe.DEFAULTS=Hv({},nM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1,lt.sources.USER)}}}}});const dgt=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class pgt extends bCe{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{if(this.linkRange!=null){const i=this.linkRange;this.restoreFocus(),this.quill.formatText(i,"link",!1,hi.sources.USER),delete this.linkRange}e.preventDefault(),this.hide()}),this.quill.on(hi.events.SELECTION_CHANGE,(e,i,r)=>{if(e!=null){if(e.length===0&&r===hi.sources.USER){const[n,a]=this.quill.scroll.descendant(lk,e.index);if(n!=null){this.linkRange=new AI(e.index-a,n.length());const s=lk.formats(n.domNode);this.preview.textContent=s,this.preview.setAttribute("href",s),this.show();const o=this.quill.getBounds(this.linkRange);o!=null&&this.position(o);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class wCe extends nM{constructor(e,i){i.modules.toolbar!=null&&i.modules.toolbar.container==null&&(i.modules.toolbar.container=dgt),super(e,i),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),QC),this.buildPickers(e.container.querySelectorAll("select"),QC),this.tooltip=new pgt(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(i,r)=>{e.handlers.link.call(e,!r.format.link)}))}}wCe.DEFAULTS=Hv({},nM.DEFAULTS,{modules:{toolbar:{handlers:{link(t){if(t){const e=this.quill.getSelection();if(e==null||e.length===0)return;let i=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(i)&&i.indexOf("mailto:")!==0&&(i=`mailto:${i}`);const{tooltip:r}=this.quill.theme;r.edit("link",i)}else this.quill.format("link",!1,lt.sources.USER)}}}}});lt.register({"attributors/attribute/direction":nCe,"attributors/class/align":tCe,"attributors/class/background":vft,"attributors/class/color":gft,"attributors/class/direction":aCe,"attributors/class/font":lCe,"attributors/class/size":uCe,"attributors/style/align":iCe,"attributors/style/background":$9,"attributors/style/color":B9,"attributors/style/direction":sCe,"attributors/style/font":cCe,"attributors/style/size":dCe},!0);lt.register({"formats/align":tCe,"formats/direction":aCe,"formats/indent":cmt,"formats/background":$9,"formats/color":B9,"formats/font":lCe,"formats/size":uCe,"formats/blockquote":umt,"formats/code-block":xc,"formats/header":dmt,"formats/list":rM,"formats/bold":z9,"formats/code":V9,"formats/italic":pmt,"formats/link":lk,"formats/script":hmt,"formats/strike":fmt,"formats/underline":mmt,"formats/formula":gmt,"formats/image":vmt,"formats/video":ymt,"modules/syntax":mCe,"modules/table":Imt,"modules/toolbar":W9,"themes/bubble":ICe,"themes/snow":wCe,"ui/icons":QC,"ui/picker":S2,"ui/icon-picker":vCe,"ui/color-picker":gCe,"ui/tooltip":yCe},!0);function hgt({controlAnchor:t}){const e={editing:!1};return bo({target:t,items:[{label:"Tournament image",onClick:uct,id:"tournamentImage",location:Xt,intent:"none"},{label:"Edit overview",onClick:()=>{const n=document.getElementById("editOverview"),a=document.getElementById("notes");if(!(!n||!a)){if(n.innerHTML=e.editing?"Edit overview":"Save overview",e.editing){a.previousElementSibling&&a.previousElementSibling.remove(),a.style.border="none";const s=a.querySelector(".ql-editor"),l=s?.innerText?.replace(`
`,"")?s.innerHTML:"";Xs(a),a.innerHTML=l,qt({methods:[{method:qYe,params:{notes:l}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const s=new lt("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});ht.quill=s}e.editing=!e.editing}},id:"editOverview",location:Xt,intent:"none"}]})?.elements}function fgt({tournamentName:t}){const e=document.getElementById(uD);if(!e)return;e.style.minHeight=`${window.innerHeight*.9}px`,Xs(e);const i=document.createElement("div");i.style.fontWeight="bold",i.className="block",i.innerHTML=ai.device.isMobile?t??"Tournament overview":"Tournament overview",e.appendChild(i);const r=document.createElement("div");e.appendChild(r);const n=We.getTournament().tournamentRecord?.notes,a=document.createElement("div");a.className="ql-container ql-snow",a.style.border="none",a.innerHTML=n??"",a.id="notes",e.appendChild(a),hgt({controlAnchor:r})}let DU;function T2(t){nN(zE,t),nN(iC,t),nN(kh,t),nN(kx,t);const e=document.getElementById("trnynav"),i=document.getElementById("dnav");[zE,kh].includes(t)?(e&&(e.style.display=t===zE?"":Vt),i&&(i.style.display="")):i&&(i.style.display=Vt)}function nN(t,e){const i=t===e,r=document.getElementById(t);r&&(r.style.display=i?"flex":"none")}const E$=()=>{const t=document.getElementById("dnav");t&&(t.style.display=Vt),DU=iC,T2(iC)},mgt=t=>{DU=t,T2(zE)},ggt=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>"),DU=kh,T2(DU)},vgt=()=>{DU=kx,T2(DU)};function ygt({config:t}={}){const{tournamentRecord:e}=We.getTournament();e?.tournamentId===t.tournamentId?SCe(t):(ht.ee.emit(vDe,ht.tournamentId),Oc.findTournament(t.tournamentId).then(i=>AG({tournamentRecord:i,config:t})))}function P$({config:t}){mgt(Es),Zat(),S9(t.selectedTab),SCe(t)}function SCe(t){const{selectedTab:e=Jf}=t;dhe(e)&&(e===Jf&&qit({participantView:t.participantView}),e===oy&&UEe({scheduledDate:t.scheduledDate}),e===uD&&fgt({tournamentName:We.getTournamentInfo().tournamentInfo?.tournamentName}),e===Qp&&cct(t),e===A3&&Hat(),e===_3&&hst())}function AG({tournamentRecord:t,config:e}){const r=zc()?.provider||ht?.provider,n=()=>{$t({message:"Tournament not found",onClose:()=>{ht.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=s=>{const o=s?.data?.tournamentRecords?.[e.tournamentId];o?(We.setState(o),P$({config:e})):n()};if(r){const s=()=>{t?(We.setState(t),P$({config:e})):n()};if(e.tournamentId){if(t?.timeItems?.find(({itemType:l})=>l==="TMX")?.itemValue?.offline)return s();Vx({tournamentId:e.tournamentId}).then(a,s)}}else We.setState(t),P$({config:e})}const Rte={addDrawDefinition:t=>as("addDrawDefinition",t),addMatchUps:t=>as("addMatchUps",t),addParticipants:t=>as("addParticipants",t),addVenue:t=>as("addVenue",t),deletedDrawIds:t=>as("deletedDrawIds",t),deletedMatchUpIds:t=>as("deletedMatchUpIds",t),deleteVenue:t=>as("deleteVenue",t),modifyDrawDefinition:t=>as("modifyDrawDefinition",t),modifyDrawEntries:t=>as("modifyDrawEntries",t),modifyEventEntries:t=>as("modifyEventEntries",t),modifyMatchUp:t=>as("modifyMatchUp",t),modifyParticipants:t=>as("modifyParticipants",t),modifyPositionAssignments:t=>as("modifyPositionAssignments",t),modifySeedAssignments:t=>as("modifySeedAssignments",t),modifyVenue:t=>as("modifyVenue",t),publishEvent:t=>as("publishEvent",t),publishEventSeeding:t=>as("publishEventSeeding",t),publishOrderOfPlay:t=>as("publishOrderOfPlay",t),unPublishEvent:t=>as("unPublishEvent",t),unPublishEventSeeding:t=>as("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>as("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>as("updateInContextMatchUp",t),modifyTournamentDetail:t=>as("modifyTournamentDetail",t)};function as(t,e){return typeof window.dev?.subs?.[t]=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||window.dev.subs?.[t])&&console.log(t,e)}function TCe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=n=>{if(!Array.isArray(n)){$t({message:"missing methods array",intent:"is-danger"});return}We.getTournament().tournamentRecord?.tournamentId?qt({methods:n,callback:o=>{if(o?.success){$t({message:"success",intent:"is-success"});const l=We.getTournament().tournamentRecord;AG({tournamentRecord:l,config:{selectedTab:Es}})}else $t({message:o?.error?.message??"error",intent:"is-danger"}),console.log({result:o})}}):$t({message:"missing tournament",intent:"is-danger"})},i=n=>{Vx({tournamentId:n}).then(a=>{if(a?.error)console.log({error:a.error});else{const s=a?.data?.tournamentRecords?.[n];s&&AG({tournamentRecord:s,config:{selectedTab:Es}})}})},r=Object.assign({},...Object.keys(Rte).map(n=>({[n]:!1})));aN({getProviders:oC,getProvider:n=>oC().then(a=>console.log(a?.data?.providers.find(s=>s.value.organisationName.toLowerCase().includes(n.toLowerCase())))),getTournament:()=>We.getTournament()?.tournamentRecord,getContext:tT.getDevContext,tournamentEngine:We,context:tT.setDevContext,generateMockTournament:Igt,modifyTournament:e,fetchTournament:i,sendTournament:KE,getLoginState:zc,getUsers:Bhe,factory:_V,baseApi:Xc,dayjs:f9,help:t,subs:r}),aN({connectSocket:ADe,disconnectSocket:s2,emitTmx:h9}),aN({tmx2db:Oc,load:bgt,exportTournamentRecord:Wet}),aN({env:ai,tournamentContext:ht}),tT.setSubscriptions({subscriptions:Rte})}function aN(t){if(pp(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch(e){$t({message:"An error occurred while adding dev variables",intent:"is-danger"}),console.error("Error adding dev variables:",e)}}function bgt(t){if(typeof t=="object"){const e=t.tournamentRecord||t;e?.tournamentId&&UCe(e)}}function Igt(t){const{tournamentRecord:e,error:i}=bR.generateTournamentRecord(t);i?console.log({error:i}):UCe(e)}function UCe(t){const e=t?.tournamentId;NUe({tournamentRecord:t,callback:()=>ht.router.navigate(`/${Es}/${e}`)})}class LE extends Error{}LE.prototype.name="InvalidTokenError";function wgt(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function Sgt(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return wgt(e)}catch{return atob(e)}}function Tgt(t,e){if(typeof t!="string")throw new LE("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,r=t.split(".")[i];if(typeof r!="string")throw new LE(`Invalid token specified: missing part #${i+1}`);let n;try{n=Sgt(r)}catch(a){throw new LE(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(n)}catch(a){throw new LE(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function DCe(t){if(!t||t==="undefined"){FDe();return}let e;try{e=Tgt(t)}catch{RUe();return}const i=new Date;return e?.exp<i.getTime()/1e3?Y9():((e?.permissions?.includes("devMode")||e?.roles?.includes("develope"))&&TCe(),e)}function Mte(t){const{callback:e,provider:i}=t||{},r=i?.onlineResources?.find(m=>m.name==="providerImage"&&m.resourceType==="URL"&&m.resourceSubType==="IMAGE");let n,a;const s=i||{},o=()=>{const m=document.getElementById("providerImagePreview");m&&(m.style.display=Vt)},l=()=>{c({inputs:n}),a=!1;const m=document.getElementById("providerImagePreview");m&&(m.onload=()=>{a=!0,c({inputs:n})},m.src=n.tournamentImage.value,m.style.display="")},c=({inputs:m})=>{const g=(a||!m.tournamentImage.value||a===void 0)&&Bn(10)(m.providerName.value)&&Bn(3)(m.providerAbbr.value)&&(!m.providerId.value.length||Bn(36)(m.providerId.value)),v=document.getElementById("createButton");v&&(v.disabled=!g)},u=[{control:"providerAbbr",onInput:c},{control:"providerName",onInput:c},{control:"providerId",onInput:c}],d=m=>n=pn(m,[{value:s.organisationName,placeholder:"Provider name",validator:Bn(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{value:s.organisationAbbreviation,placeholder:"Abbreviation",validator:Bn(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",value:t?.provider?.organisationId??"",disabled:t?.provider?.organisationId,label:"Provider ID",autocomplete:"off",field:"providerId"},{onKeyUp:g=>g.key==="Enter"&&l(),onChange:()=>n.tournamentImage.value?l():o(),label:"Web address of online image",value:r?.identifier,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}],u),p=document.createElement("div");d(p);const h=document.createElement("img");h.id="providerImagePreview",h.style.width="100%",p.appendChild(h);const f=()=>{const m=n.providerAbbr.value,g=n.providerName.value,v=t?.provider?.organisationId||n.providerId.value||Ni.UUID(),y={organisationAbbreviation:m,organisationName:g,organisationId:v};if(a){const w={resourceSubType:"IMAGE",name:"providerImage",resourceType:"URL",identifier:n.tournamentImage.value};y.onlineResources=[w]}const b=I=>Pt(e)&&e(I);t?.provider?u$e({provider:y}).then(b,I=>console.log({err:I})):c$e({provider:y}).then(b,I=>console.log({err:I}))};Kr({title:"Create provider",content:p,buttons:[{label:"Cancel",intent:"none",close:!0},{label:t?.provider?"Update":"Create",onClick:f,id:"createButton",intent:"is-info",disabled:!0,close:!0}]}),r&&setTimeout(l,400)}function ECe(){let t;const e=b9();Kr({title:"Settings",content:n=>t=pn(n,[{options:[{text:"WTN",field:"wtn",checked:ai.activeScale===sC},{text:"UTR",field:"utr",checked:ai.activeScale===mI}],onClick:a=>console.log({x:a}),label:"Active rating",field:"activeRating",id:"activeRating",radio:!0},{options:[{text:"Dynamic Sets",field:"dynamicSets",checked:ai.scoringApproach==="dynamicSets"},{text:"Dial Pad",field:"dialPad",checked:ai.scoringApproach==="dialPad"},{text:"Free Score",field:"freeScore",checked:ai.scoringApproach==="freeScore"},{text:"Tidy Score",field:"tidyScore",checked:ai.scoringApproach==="tidyScore"}],onClick:a=>console.log({x:a}),label:"Scoring approach",field:"scoringApproach",id:"scoringApproach",radio:!0},{label:"Smart complements (Dynamic Sets only)",checked:e?.smartComplements||!1,field:"smartComplements",id:"smartComplements",checkbox:!0},{label:"Save local copies",checked:ai.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?sC:mI;ai.saveLocal=t.saveLocal.checked;let a;t.dynamicSets.checked?a="dynamicSets":t.dialPad.checked?a="dialPad":t.tidyScore.checked?a="tidyScore":t.freeScore.checked?a="freeScore":a="dynamicSets",ai.scoringApproach=a,tk(n),Grt({activeScale:n,scoringApproach:a,saveLocal:ai.saveLocal,smartComplements:t.smartComplements?.checked||!1})},close:!0}]})}function Ugt(t){const e=document.getElementById(t);e&&e.addEventListener("click",ECe)}const Dgt=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,uk=t=>Dgt.exec(t);async function Egt(t,e){return Xc.post("/auth/login",{password:e,email:t})}async function Pgt(t,e,i,r,n){return Xc.post("/auth/invite",{permissions:r,providerId:e,services:n,email:t,roles:i})}async function Cgt(t,e,i,r){return Xc.post("/auth/register",{firstName:t,lastName:e,password:i,code:r})}function Rgt(t,e=[]){const r=[{value:{organisationName:"None"},key:""},...e].map(({key:f,value:m})=>({label:m?.organisationName,value:f}));let n;const a={providerId:""},s=f=>a.providerId=f,l=[{onInput:({inputs:f})=>{const m=f.email.value,g=uk(m),v=document.getElementById("inviteUser");v&&(v.disabled=!g)},control:"email"}],c=f=>n=pn(f,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:uk,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{typeAhead:{list:r,callback:s},value:a.providerId||"",placeholder:"None",field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{field:"editTennisId",label:"Edit WTID",id:"editTennisId",checkbox:!0},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"},{text:"Services",header:!0},{label:"Tournament Profiles (fetch)",field:"tournamentProfile",id:"tournamentProfile",checkbox:!0}],l),u=["client","admin","score","developer","generate","director","official"],d=["devMode","editTennisId","deleteTournament"],p=["tournamentProfile"];Kr({title:"Invite user",content:c,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{const f=n.email.value,m=a.providerId||n.providerId?.value,g=d.map(I=>n[I].checked&&I).filter(Boolean),v=p.map(I=>n[I].checked&&I).filter(Boolean),y=u.map(I=>n[I].checked&&I).filter(Boolean),b=I=>Pt(t)&&t(I);Pgt(f,m,y,g,v).then(b,I=>console.log({err:I}))},close:!0}]})}function Mgt(t){let e;const r=[{onInput:({inputs:s})=>{const o=s.email.value,l=uk(o),c=document.getElementById("loginButton");c&&(c.disabled=!l)},control:"email"}];Kr({title:"Log in",content:s=>e=pn(s,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:uk,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const s=e.email.value,o=e.password.value,l=c=>{c||Y9(),c?.status===200&&Agt({data:c.data,callback:t})};Egt(s,o).then(l,c=>console.log({err:c}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}async function Ngt(t){try{await navigator.clipboard.writeText(t),$t({message:"Copied to clipboard",intent:"is-success"})}catch(e){$t({message:String(e),intent:"is-danger"})}}function U2(t){const e=document.getElementById("login"),i=ht?.provider,r=t?.roles?.includes(_x);e&&(t?e.style.color=i&&"red"||r&&"green"||"blue":e.style.color="")}function zc(){const t=MUe(),e=DCe(t);return e&&U2(e),e}function Y9(){RUe(),FDe(),s2(),ht.provider=void 0,ht.router.navigate(`/${kh}/logout`),U2(!1)}function Agt({data:t,callback:e}){const i=DCe(t.token),r=We.getTournament().tournamentRecord?.tournamentId;i&&(uYe(t.token),$t({intent:"is-success",message:"Log in successful"}),s2(),r||We.reset(),U2(i),Pt(e)?e():r||ht.router.navigate(`/${kh}/${i.provider?.organisationAbbreviation}`))}function _gt(){oC().then(({data:t})=>{const e=t?.providers?.map(({value:i})=>({onClick:()=>{ht.provider=i,ht.router.navigate(`/${kh}/${i.organisationAbbreviation}`)},participantName:i.organisationName}));e&&J8({title:"Select Provider",options:e,selectionLimit:1})})}function kgt(t){return()=>h$e(t).then(()=>$t({message:"User removed"}))}function Ogt(){Bhe().then(({data:t})=>{const e=t?.users?.map(({value:i})=>({participantName:`${i.firstName} ${i.lastName} (${i.email})`,onClick:kgt(i)}));e&&J8({title:"Select User",options:e,selectionLimit:1})})}function xgt(){ht.provider=void 0,ht.router.navigate(`/${kh}/superadmin`)}function Nte(t){const e=document.getElementById(t),i=r=>$t({intent:"is-danger",message:r?.data?.message||"Error"});if(e){const r=a=>{const s=a?.data.inviteCode;if(s){const o=`${window.location.origin}${window.location.pathname}/#/${Ype}/${s}`;Ngt(o),console.log({inviteCode:s,inviteURL:o})}else i(a)},n=a=>setTimeout(()=>Mte({provider:a}),200);e.addEventListener("click",()=>{const a=zc(),s=a?.roles?.includes(_x),o=a?.roles?.includes(qpe),l=ht?.provider;nu({target:e,title:"Authorization",items:[{onClick:()=>$t({message:"TBD: Registration Modal"}),text:"Register",hide:a},{onClick:()=>Mgt(),hide:a,text:"Log in"},{style:"text-decoration: line-through;",hide:!s||!l,onClick:xgt,text:"Impersonate"},{hide:!s||l,onClick:_gt,text:"Impersonate"},{onClick:Mte,text:"Create provider",hide:!s},{onClick:()=>sYe({callback:n}),text:"Edit provider",hide:!s},{onClick:Ogt,text:"Remove user",hide:!s},{onClick:()=>oC().then(({data:u})=>Rgt(r,u?.providers),i),hide:!s&&!l,text:"Invite User"},{text:"Log out",hide:!a,onClick:Y9},{hide:!o,divider:!0},{onClick:qet,heading:"Actions",hide:!o},{divider:!0},{onClick:ECe,heading:"Settings"}]})})}}const Lgt=(function(){function t(){}const e=t.prototype;function i(a,s){let o=a.length;for(;o--;)if(a[o].listener===s)return o;return-1}function r(a){return function(...o){return this[a](...o)}}e.getListeners=function(s){const o=this._getEvents();let l,c;if(s instanceof RegExp){l={};for(c in o)o.hasOwnProperty(c)&&s.test(c)&&(l[c]=o[c])}else l=o[s]||(o[s]=[]);return l},e.flattenListeners=function(s){const o=[];for(let l=0;l<s.length;l+=1)o.push(s[l].listener);return o},e.getListenersAsObject=function(s){const o=this.getListeners(s);let l;return o instanceof Array&&(l={},l[s]=o),l||o};function n(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?n(a.listener):!1}return e.addListener=function(s,o){if(!n(o))throw new TypeError("listener must be a function");const l=this.getListenersAsObject(s),c=typeof o=="object";let u;for(u in l)l.hasOwnProperty(u)&&i(l[u],c?o.listener:o)===-1&&l[u].push(c?o:{listener:o,once:!1});return this},e.on=r("addListener"),e.addOnceListener=function(s,o){return this.addListener(s,{listener:o,once:!0})},e.once=r("addOnceListener"),e.defineEvent=function(s){return this.getListeners(s),this},e.defineEvents=function(s){for(let o=0;o<s.length;o+=1)this.defineEvent(s[o]);return this},e.removeListener=function(s,o){const l=this.getListenersAsObject(s);let c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],o),c!==-1&&l[u].splice(c,1));return this},e.off=r("removeListener"),e.addListeners=function(s,o){return this.manipulateListeners(!1,s,o)},e.removeListeners=function(s,o){return this.manipulateListeners(!0,s,o)},e.manipulateListeners=function(s,o,l){let c,u;const d=s?this.removeListener:this.addListener,p=s?this.removeListeners:this.addListeners;if(typeof o=="object"&&!(o instanceof RegExp))for(c in o)o.hasOwnProperty(c)&&(u=o[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,o,l[c]);return this},e.removeEvent=function(s){const o=typeof s,l=this._getEvents();let c;if(o==="string")delete l[s];else if(s instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&s.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=r("removeEvent"),e.emitEvent=function(s,o){const l=this.getListenersAsObject(s);let c,u,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(s,u.listener),h=u.listener.apply(this,o||[]),h===this._getOnceReturnValue()&&this.removeListener(s,u.listener);return this},e.trigger=r("emitEvent"),e.emit=function(s,...o){return this.emitEvent(s,o)},e.setOnceReturnValue=function(s){return this._onceReturnValue=s,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t})();function Ate(){try{return window}catch{return}}const PCe=()=>Ate()?.dev&&typeof Ate()?.dev=="object";function Fgt(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:b2e},window.onunhandledrejection=t=>{if(PCe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(I2e(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}var CCe=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],dk=CCe.join(","),RCe=typeof Element>"u",kI=RCe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,pk=!RCe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},hk=function(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),a=n===""||n==="true",s=a||i&&e&&(typeof e.closest=="function"?e.closest("[inert]"):hk(e.parentNode));return s},Bgt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},MCe=function(e,i,r){if(hk(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(dk));return i&&kI.call(e,dk)&&n.unshift(e),n=n.filter(r),n},fk=function(e,i,r){for(var n=[],a=Array.from(e);a.length;){var s=a.shift();if(!hk(s,!1))if(s.tagName==="SLOT"){var o=s.assignedElements(),l=o.length?o:s.children,c=fk(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:s,candidates:c})}else{var u=kI.call(s,dk);u&&r.filter(s)&&(i||!e.includes(s))&&n.push(s);var d=s.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(s),p=!hk(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(d&&p){var h=fk(d===!0?s.children:d.children,!0,r);r.flatten?n.push.apply(n,h):n.push({scopeParent:s,candidates:h})}else a.unshift.apply(a,s.children)}}return n},NCe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Ub=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Bgt(e))&&!NCe(e)?0:e.tabIndex},$gt=function(e,i){var r=Ub(e);return r<0&&i&&!NCe(e)?0:r},Vgt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},ACe=function(e){return e.tagName==="INPUT"},jgt=function(e){return ACe(e)&&e.type==="hidden"},Ggt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},Hgt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},zgt=function(e){if(!e.name)return!0;var i=e.form||pk(e),r=function(o){return i.querySelectorAll('input[type="radio"][name="'+o+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var a=Hgt(n,e.form);return!a||a===e},qgt=function(e){return ACe(e)&&e.type==="radio"},Wgt=function(e){return qgt(e)&&!zgt(e)},Ygt=function(e){var i,r=e&&pk(e),n=(i=r)===null||i===void 0?void 0:i.host,a=!1;if(r&&r!==e){var s,o,l;for(a=!!((s=n)!==null&&s!==void 0&&(o=s.ownerDocument)!==null&&o!==void 0&&o.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&n;){var c,u,d;r=pk(n),n=(c=r)===null||c===void 0?void 0:c.host,a=!!((u=n)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return a},_te=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},Kgt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(r==="full-native"&&"checkVisibility"in e){var a=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!a}if(getComputedStyle(e).visibility==="hidden")return!0;var s=kI.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(kI.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="full-native"||r==="legacy-full"){if(typeof n=="function"){for(var l=e;e;){var c=e.parentElement,u=pk(e);if(c&&!c.shadowRoot&&n(c)===!0)return _te(e);e.assignedSlot?e=e.assignedSlot:!c&&u!==e.ownerDocument?e=u.host:e=c}e=l}if(Ygt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return _te(e);return!1},Zgt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return kI.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},mk=function(e,i){return!(i.disabled||jgt(i)||Kgt(i,e)||Ggt(i)||Zgt(i))},_G=function(e,i){return!(Wgt(i)||Ub(i)<0||!mk(e,i))},Xgt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},_Ce=function(e){var i=[],r=[];return e.forEach(function(n,a){var s=!!n.scopeParent,o=s?n.scopeParent:n,l=$gt(o,s),c=s?_Ce(n.candidates):o;l===0?s?i.push.apply(i,c):i.push(o):r.push({documentOrder:a,tabIndex:l,item:n,isScope:s,content:c})}),r.sort(Vgt).reduce(function(n,a){return a.isScope?n.push.apply(n,a.content):n.push(a.content),n},[]).concat(i)},Jgt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=fk([e],i.includeContainer,{filter:_G.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Xgt}):r=MCe(e,i.includeContainer,_G.bind(null,i)),_Ce(r)},Qgt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=fk([e],i.includeContainer,{filter:mk.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=MCe(e,i.includeContainer,mk.bind(null,i)),r},DS=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return kI.call(e,dk)===!1?!1:_G(i,e)},evt=CCe.concat("iframe:not([inert]):not([inert] *)").join(","),C$=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return kI.call(e,evt)===!1?!1:mk(i,e)};function kG(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function tvt(t){if(Array.isArray(t))return kG(t)}function kte(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=kCe(t))||e){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){i=i.call(t)},n:function(){var l=i.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||i.return==null||i.return()}finally{if(o)throw a}}}}function ivt(t,e,i){return(e=ovt(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function rvt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function nvt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ote(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function xte(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Ote(Object(i),!0).forEach(function(r){ivt(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ote(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function avt(t){return tvt(t)||rvt(t)||kCe(t)||nvt()}function svt(t,e){if(typeof t!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ovt(t){var e=svt(t,"string");return typeof e=="symbol"?e:e+""}function kCe(t,e){if(t){if(typeof t=="string")return kG(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?kG(t,e):void 0}}var Jm={getActiveTrap:function(e){return e?.length>0?e[e.length-1]:null},activateTrap:function(e,i){var r=Jm.getActiveTrap(e);i!==r&&Jm.pauseTrap(e);var n=e.indexOf(i);n===-1||e.splice(n,1),e.push(i)},deactivateTrap:function(e,i){var r=e.indexOf(i);r!==-1&&e.splice(r,1),Jm.unpauseTrap(e)},pauseTrap:function(e){var i=Jm.getActiveTrap(e);i?._setPausedState(!0)},unpauseTrap:function(e){var i=Jm.getActiveTrap(e);i&&!i._isManuallyPaused()&&i._setPausedState(!1)}},lvt=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},cvt=function(e){return e?.key==="Escape"||e?.key==="Esc"||e?.keyCode===27},IP=function(e){return e?.key==="Tab"||e?.keyCode===9},uvt=function(e){return IP(e)&&!e.shiftKey},dvt=function(e){return IP(e)&&e.shiftKey},Lte=function(e){return setTimeout(e,0)},TE=function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return typeof e=="function"?e.apply(void 0,r):e},sN=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},pvt=[],hvt=function(e,i){var r=document,n=pvt,a=xte({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isolateSubtrees:!1,isKeyForward:uvt,isKeyBackward:dvt},i),s={containers:[],containerGroups:[],tabbableGroups:[],adjacentElements:new Set,alreadyInert:new Set,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},o,l=function(A,N,k){return A&&A[N]!==void 0?A[N]:a[k||N]},c=function(A,N){var k=typeof N?.composedPath=="function"?N.composedPath():void 0;return s.containerGroups.findIndex(function(x){var O=x.container,V=x.tabbableNodes;return O.contains(A)||k?.includes(O)||V.find(function(F){return F===A})})},u=function(A){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=N.hasFallback,x=k===void 0?!1:k,O=N.params,V=O===void 0?[]:O,F=a[A];if(typeof F=="function"&&(F=F.apply(void 0,avt(V))),F===!0&&(F=void 0),!F){if(F===void 0||F===!1)return F;throw new Error("`".concat(A,"` was specified but was not a node, or did not return a node"))}var j=F;if(typeof F=="string"){try{j=r.querySelector(F)}catch(q){throw new Error("`".concat(A,'` appears to be an invalid selector; error="').concat(q.message,'"'))}if(!j&&!x)throw new Error("`".concat(A,"` as selector refers to no known node"))}return j},d=function(){var A=u("initialFocus",{hasFallback:!0});if(A===!1)return!1;if(A===void 0||A&&!C$(A,a.tabbableOptions))if(c(r.activeElement)>=0)A=r.activeElement;else{var N=s.tabbableGroups[0],k=N&&N.firstTabbableNode;A=k||u("fallbackFocus")}else A===null&&(A=u("fallbackFocus"));if(!A)throw new Error("Your focus-trap needs to have at least one focusable element");return A},p=function(){if(s.containerGroups=s.containers.map(function(A){var N=Jgt(A,a.tabbableOptions),k=Qgt(A,a.tabbableOptions),x=N.length>0?N[0]:void 0,O=N.length>0?N[N.length-1]:void 0,V=k.find(function(q){return DS(q)}),F=k.slice().reverse().find(function(q){return DS(q)}),j=!!N.find(function(q){return Ub(q)>0});return{container:A,tabbableNodes:N,focusableNodes:k,posTabIndexesFound:j,firstTabbableNode:x,lastTabbableNode:O,firstDomTabbableNode:V,lastDomTabbableNode:F,nextTabbableNode:function(W){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,H=N.indexOf(W);return H<0?z?k.slice(k.indexOf(W)+1).find(function(Z){return DS(Z)}):k.slice(0,k.indexOf(W)).reverse().find(function(Z){return DS(Z)}):N[H+(z?1:-1)]}}}),s.tabbableGroups=s.containerGroups.filter(function(A){return A.tabbableNodes.length>0}),s.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(s.containerGroups.find(function(A){return A.posTabIndexesFound})&&s.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function(A){var N=A.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?h(N.shadowRoot):N},f=function(A){if(A!==!1&&A!==h(document)){if(!A||!A.focus){f(d());return}A.focus({preventScroll:!!a.preventScroll}),s.mostRecentlyFocusedNode=A,lvt(A)&&A.select()}},m=function(A){var N=u("setReturnFocus",{params:[A]});return N||(N===!1?!1:A)},g=function(A){var N=A.target,k=A.event,x=A.isBackward,O=x===void 0?!1:x;N=N||sN(k),p();var V=null;if(s.tabbableGroups.length>0){var F=c(N,k),j=F>=0?s.containerGroups[F]:void 0;if(F<0)O?V=s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:V=s.tabbableGroups[0].firstTabbableNode;else if(O){var q=s.tabbableGroups.findIndex(function(ie){var K=ie.firstTabbableNode;return N===K});if(q<0&&(j.container===N||C$(N,a.tabbableOptions)&&!DS(N,a.tabbableOptions)&&!j.nextTabbableNode(N,!1))&&(q=F),q>=0){var W=q===0?s.tabbableGroups.length-1:q-1,z=s.tabbableGroups[W];V=Ub(N)>=0?z.lastTabbableNode:z.lastDomTabbableNode}else IP(k)||(V=j.nextTabbableNode(N,!1))}else{var H=s.tabbableGroups.findIndex(function(ie){var K=ie.lastTabbableNode;return N===K});if(H<0&&(j.container===N||C$(N,a.tabbableOptions)&&!DS(N,a.tabbableOptions)&&!j.nextTabbableNode(N))&&(H=F),H>=0){var Z=H===s.tabbableGroups.length-1?0:H+1,J=s.tabbableGroups[Z];V=Ub(N)>=0?J.firstTabbableNode:J.firstDomTabbableNode}else IP(k)||(V=j.nextTabbableNode(N))}}else V=u("fallbackFocus");return V},v=function(A){var N=sN(A);if(!(c(N,A)>=0)){if(TE(a.clickOutsideDeactivates,A)){o.deactivate({returnFocus:a.returnFocusOnDeactivate});return}TE(a.allowOutsideClick,A)||A.preventDefault()}},y=function(A){var N=sN(A),k=c(N,A)>=0;if(k||N instanceof Document)k&&(s.mostRecentlyFocusedNode=N);else{A.stopImmediatePropagation();var x,O=!0;if(s.mostRecentlyFocusedNode)if(Ub(s.mostRecentlyFocusedNode)>0){var V=c(s.mostRecentlyFocusedNode),F=s.containerGroups[V].tabbableNodes;if(F.length>0){var j=F.findIndex(function(q){return q===s.mostRecentlyFocusedNode});j>=0&&(a.isKeyForward(s.recentNavEvent)?j+1<F.length&&(x=F[j+1],O=!1):j-1>=0&&(x=F[j-1],O=!1))}}else s.containerGroups.some(function(q){return q.tabbableNodes.some(function(W){return Ub(W)>0})})||(O=!1);else O=!1;O&&(x=g({target:s.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(s.recentNavEvent)})),f(x||s.mostRecentlyFocusedNode||d())}s.recentNavEvent=void 0},b=function(A){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;s.recentNavEvent=A;var k=g({event:A,isBackward:N});k&&(IP(A)&&A.preventDefault(),f(k))},I=function(A){(a.isKeyForward(A)||a.isKeyBackward(A))&&b(A,a.isKeyBackward(A))},w=function(A){cvt(A)&&TE(a.escapeDeactivates,A)!==!1&&(A.preventDefault(),o.deactivate())},T=function(A){var N=sN(A);c(N,A)>=0||TE(a.clickOutsideDeactivates,A)||TE(a.allowOutsideClick,A)||(A.preventDefault(),A.stopImmediatePropagation())},S=function(){if(s.active)return Jm.activateTrap(n,o),s.delayInitialFocusTimer=a.delayInitialFocus?Lte(function(){f(d())}):f(d()),r.addEventListener("focusin",y,!0),r.addEventListener("mousedown",v,{capture:!0,passive:!1}),r.addEventListener("touchstart",v,{capture:!0,passive:!1}),r.addEventListener("click",T,{capture:!0,passive:!1}),r.addEventListener("keydown",I,{capture:!0,passive:!1}),r.addEventListener("keydown",w),o},D=function(A){s.active&&!s.paused&&o._setSubtreeIsolation(!1),s.adjacentElements.clear(),s.alreadyInert.clear();var N=new Set,k=new Set,x=kte(A),O;try{for(x.s();!(O=x.n()).done;){var V=O.value;N.add(V);for(var F=typeof ShadowRoot<"u"&&V.getRootNode()instanceof ShadowRoot,j=V;j;){N.add(j);var q=j.parentElement,W=[];q?W=q.children:!q&&F&&(W=j.getRootNode().children,q=j.getRootNode().host,F=typeof ShadowRoot<"u"&&q.getRootNode()instanceof ShadowRoot);var z=kte(W),H;try{for(z.s();!(H=z.n()).done;){var Z=H.value;k.add(Z)}}catch(J){z.e(J)}finally{z.f()}j=q}}}catch(J){x.e(J)}finally{x.f()}N.forEach(function(J){k.delete(J)}),s.adjacentElements=k},C=function(){if(s.active)return r.removeEventListener("focusin",y,!0),r.removeEventListener("mousedown",v,!0),r.removeEventListener("touchstart",v,!0),r.removeEventListener("click",T,!0),r.removeEventListener("keydown",I,!0),r.removeEventListener("keydown",w),o},E=function(A){var N=A.some(function(k){var x=Array.from(k.removedNodes);return x.some(function(O){return O===s.mostRecentlyFocusedNode})});N&&f(d())},P=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(E):void 0,R=function(){P&&(P.disconnect(),s.active&&!s.paused&&s.containers.map(function(A){P.observe(A,{subtree:!0,childList:!0})}))};return o={get active(){return s.active},get paused(){return s.paused},activate:function(A){if(s.active)return this;var N=l(A,"onActivate"),k=l(A,"onPostActivate"),x=l(A,"checkCanFocusTrap"),O=Jm.getActiveTrap(n),V=!1;O&&!O.paused&&(O._setSubtreeIsolation(!1),V=!0);try{x||p(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=h(r),N?.();var F=function(){x&&p(),S(),R(),a.isolateSubtrees&&o._setSubtreeIsolation(!0),k?.()};if(x)return x(s.containers.concat()).then(F,F),this;F()}catch(j){throw O===Jm.getActiveTrap(n)&&V&&O._setSubtreeIsolation(!0),j}return this},deactivate:function(A){if(!s.active)return this;var N=xte({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},A);clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,s.paused||o._setSubtreeIsolation(!1),s.alreadyInert.clear(),C(),s.active=!1,s.paused=!1,R(),Jm.deactivateTrap(n,o);var k=l(N,"onDeactivate"),x=l(N,"onPostDeactivate"),O=l(N,"checkCanReturnFocus"),V=l(N,"returnFocus","returnFocusOnDeactivate");k?.();var F=function(){Lte(function(){V&&f(m(s.nodeFocusedBeforeActivation)),x?.()})};return V&&O?(O(m(s.nodeFocusedBeforeActivation)).then(F,F),this):(F(),this)},pause:function(A){return s.active?(s.manuallyPaused=!0,this._setPausedState(!0,A)):this},unpause:function(A){return s.active?(s.manuallyPaused=!1,n[n.length-1]!==this?this:this._setPausedState(!1,A)):this},updateContainerElements:function(A){var N=[].concat(A).filter(Boolean);return s.containers=N.map(function(k){return typeof k=="string"?r.querySelector(k):k}),a.isolateSubtrees&&D(s.containers),s.active&&(p(),a.isolateSubtrees&&!s.paused&&o._setSubtreeIsolation(!0)),R(),this}},Object.defineProperties(o,{_isManuallyPaused:{value:function(){return s.manuallyPaused}},_setPausedState:{value:function(A,N){if(s.paused===A)return this;if(s.paused=A,A){var k=l(N,"onPause"),x=l(N,"onPostPause");k?.(),C(),R(),o._setSubtreeIsolation(!1),x?.()}else{var O=l(N,"onUnpause"),V=l(N,"onPostUnpause");O?.(),o._setSubtreeIsolation(!0),p(),S(),R(),V?.()}return this}},_setSubtreeIsolation:{value:function(A){a.isolateSubtrees&&s.adjacentElements.forEach(function(N){if(A){var k=N.inert||N.hasAttribute("inert");k&&s.alreadyInert.add(N),N.inert=!0}else s.alreadyInert.has(N)||(N.inert=!1)})}}}),o.updateContainerElements(e),o};const fvt=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,r,n;const a=zpe;let s;const o=I=>n=I,l=()=>{Pt(n)&&n&&n()&&(n=void 0);const I=document.getElementById(a);I&&(I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){r?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",Pt(r?.callback)&&r.callback()):(I.classList.remove(t.activeClass),i=!1),r=!1,s?.deactivate()},t.speedClose))},c=I=>{const w=document.getElementById(a);w&&(w.classList.contains(t.leftAlignment)||w.classList.add(t.leftAlignment),m(w,!1,I))},u=I=>{const w=document.getElementById(a);w&&(w.classList.remove(t.leftAlignment),m(w,!1,I))},d=I=>{const T=document.getElementById(a)?.querySelector(".drawer__title");T&&(T.innerHTML=I)},p=I=>{const T=document.getElementById(a)?.querySelector(".drawer__footer");T&&(Xs(T),Pt(I)?e.footer=I(T,l):T.innerHTML=I||"")},h=I=>{const T=document.getElementById(a)?.querySelector(".drawer__content");T&&(Xs(T),Pt(I)?e.content=I(T,l):T.innerHTML=I)},f=I=>{const T=document.getElementById(a)?.querySelector(".drawer__wrapper");T&&(T.style.width=I)},m=(I,w,T)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",w&&(s=hvt(I),s.activate()),Pt(T)&&T&&T(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:w,side:T,width:S,footer:D,callback:C,onClose:E}={})=>{if(w&&h(w),E&&o(E),I&&d(I),S&&f(S),p(D),i)r={callback:C};else if(T){if(T===Xt)return u(C);if(T===ui)return c(C)}else{const P=document.getElementById(a);P&&m(P,D,C)}},v=function(I,w){let T=w.parentNode;for(;T;){if(T===I)return!0;T=T.parentNode}return!1},y=function(I){const w=I.target,T=document.querySelector(".drawer__wrapper");(!v(T,w)||w.classList.contains("drawer__close"))&&l()},b=I=>{I.key==="Escape"&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}},Fte=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function mvt(t){let e;const i=o=>o===e.password.value,n=[{onInput:({inputs:o})=>{const l=document.getElementById("registerButton");l&&(i(o.passwordConfirm.value)&&Fte(o.password.value)&&Bn(2)(o.givenName.value)&&Bn(2)(o.lastName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];Kr({title:"Register",content:o=>e=pn(o,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:Bn(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",validator:Bn(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"lastName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",iconLeft:"fa-solid fa-lock",validator:Fte,autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const o=e.lastName.value,l=e.givenName.value,c=e.password.value,u=t?.data?.inviteKey,d=()=>{$t({message:"Success",intent:"is-success "})},p=f=>{$t({message:f?.message,intent:"is-danger"})},h=f=>{f?.status===200&&f?.data?.success?d():p(f?.data)};Cgt(l,o,c,u).then(h,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>ht.router.navigate("/")})}function gvt(){const{tournamentRecord:t}=We.getTournament();t&&(ht.ee.emit(vDe,t.tournamentId),We.reset())}function Bte(){r2(),ggt(),M2e(),gvt(),gDe()}function es(){}function OCe(t){return t()}function $te(){return Object.create(null)}function rd(t){t.forEach(OCe)}function Qa(t){return typeof t=="function"}function Ic(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function vvt(t){return Object.keys(t).length===0}function K9(t,...e){if(t==null){for(const r of e)r(void 0);return es}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function gk(t){let e;return K9(t,i=>e=i)(),e}function Je(t,e,i){t.$$.on_destroy.push(K9(e,i))}function an(t,e,i){return t.set(i),e}function Ng(t){return t&&Qa(t.destroy)?t.destroy:es}const yvt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function bn(t,e){t.appendChild(e)}function Br(t,e,i){t.insertBefore(e,i||null)}function Mr(t){t.parentNode&&t.parentNode.removeChild(t)}function tS(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function Vr(t){return document.createElement(t)}function aM(t){return document.createTextNode(t)}function Xo(){return aM(" ")}function _d(){return aM("")}function xn(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function vk(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function bt(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function bvt(t){return Array.from(t.childNodes)}function xCe(t,e){e=""+e,t.data!==e&&(t.data=e)}function Vte(t,e,i,r){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,"")}function kv(t,e){return new t(e)}let e1;function wP(t){e1=t}function sM(){if(!e1)throw new Error("Function called outside component initialization");return e1}function Ivt(t){sM().$$.before_update.push(t)}function wvt(t){sM().$$.on_mount.push(t)}function LCe(t){sM().$$.after_update.push(t)}function Svt(t,e){return sM().$$.context.set(t,e),e}function kd(t){return sM().$$.context.get(t)}function D2(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(r=>r.call(this,e))}const jS=[],dm=[];let hT=[];const jte=[],FCe=Promise.resolve();let OG=!1;function BCe(){OG||(OG=!0,FCe.then($Ce))}function oM(){return BCe(),FCe}function xG(t){hT.push(t)}const R$=new Set;let ES=0;function $Ce(){if(ES!==0)return;const t=e1;do{try{for(;ES<jS.length;){const e=jS[ES];ES++,wP(e),Tvt(e.$$)}}catch(e){throw jS.length=0,ES=0,e}for(wP(null),jS.length=0,ES=0;dm.length;)dm.pop()();for(let e=0;e<hT.length;e+=1){const i=hT[e];R$.has(i)||(R$.add(i),i())}hT.length=0}while(jS.length);for(;jte.length;)jte.pop()();OG=!1,R$.clear(),wP(t)}function Tvt(t){if(t.fragment!==null){t.update(),rd(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(xG)}}function Uvt(t){const e=[],i=[];hT.forEach(r=>t.indexOf(r)===-1?e.push(r):i.push(r)),i.forEach(r=>r()),hT=e}const nA=new Set;let Mb;function no(){Mb={r:0,c:[],p:Mb}}function ao(){Mb.r||rd(Mb.c),Mb=Mb.p}function ci(t,e){t&&t.i&&(nA.delete(t),t.i(e))}function Oi(t,e,i,r){if(t&&t.o){if(nA.has(t))return;nA.add(t),Mb.c.push(()=>{nA.delete(t),r&&(i&&t.d(1),r())}),t.o(e)}else r&&r()}function Io(t){return t?.length!==void 0?t:Array.from(t)}function Z9(t,e){Oi(t,1,1,()=>{e.delete(t.key)})}function X9(t,e,i,r,n,a,s,o,l,c,u,d){let p=t.length,h=a.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,b=[];for(f=h;f--;){const S=d(n,a,f),D=i(S);let C=s.get(D);C?b.push(()=>C.p(S,e)):(C=c(D,S),C.c()),v.set(D,g[f]=C),D in m&&y.set(D,Math.abs(f-m[D]))}const I=new Set,w=new Set;function T(S){ci(S,1),S.m(o,u),s.set(S.key,S),u=S.first,h--}for(;p&&h;){const S=g[h-1],D=t[p-1],C=S.key,E=D.key;S===D?(u=S.first,p--,h--):v.has(E)?!s.has(C)||I.has(C)?T(S):w.has(E)?p--:y.get(C)>y.get(E)?(w.add(C),T(S)):(I.add(E),p--):(l(D,s),p--)}for(;p--;){const S=t[p];v.has(S.key)||l(S,s)}for(;h;)T(g[h-1]);return rd(b),g}function ts(t){t&&t.c()}function ka(t,e,i){const{fragment:r,after_update:n}=t.$$;r&&r.m(e,i),xG(()=>{const a=t.$$.on_mount.map(OCe).filter(Qa);t.$$.on_destroy?t.$$.on_destroy.push(...a):rd(a),t.$$.on_mount=[]}),n.forEach(xG)}function Oa(t,e){const i=t.$$;i.fragment!==null&&(Uvt(i.after_update),rd(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function Dvt(t,e){t.$$.dirty[0]===-1&&(jS.push(t),BCe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function au(t,e,i,r,n,a,s=null,o=[-1]){const l=e1;wP(t);const c=t.$$={fragment:null,ctx:[],props:a,update:es,not_equal:n,bound:$te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:$te(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return c.ctx&&n(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),u&&Dvt(t,d)),p}):[],c.update(),u=!0,rd(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const d=bvt(e.target);c.fragment&&c.fragment.l(d),d.forEach(Mr)}else c.fragment&&c.fragment.c();e.intro&&ci(t.$$.fragment),ka(t,e.target,e.anchor),$Ce()}wP(l)}class su{$$=void 0;$$set=void 0;$destroy(){Oa(this,1),this.$destroy=es}$on(e,i){if(!Qa(i))return es;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!vvt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const PS=[];function VCe(t,e){return{subscribe:Yo(t,e).subscribe}}function Yo(t,e=es){let i;const r=new Set;function n(o){if(Ic(t,o)&&(t=o,i)){const l=!PS.length;for(const c of r)c[1](),PS.push(c,t);if(l){for(let c=0;c<PS.length;c+=2)PS[c][0](PS[c+1]);PS.length=0}}}function a(o){n(o(t))}function s(o,l=es){const c=[o,l];return r.add(c),r.size===1&&(i=e(n,a)||es),o(t),()=>{r.delete(c),r.size===0&&i&&(i(),i=null)}}return{set:n,update:a,subscribe:s}}function lf(t,e,i){const r=!Array.isArray(t),n=r?[t]:t;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return VCe(i,(s,o)=>{let l=!1;const c=[];let u=0,d=es;const p=()=>{if(u)return;d();const f=e(r?c[0]:c,s,o);a?s(f):d=Qa(f)?f:es},h=n.map((f,m)=>K9(f,g=>{c[m]=g,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){rd(h),d(),l=!1}})}function yk(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function ab(t,e){let i={update(r){typeof r=="string"?t.innerText=r:r?.domNodes?t.replaceChildren(...r.domNodes):r?.html&&(t.innerHTML=r.html)}};return i.update(e),i}function Evt(t,e){const i=r=>{t&&!t.contains(r.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:r}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const jCe=86400;function Ag(t=void 0){return t!==void 0?t instanceof Date?Hte(t):Rvt(t):Hte(new Date)}function Zd(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,r=2;for(let n of t.split(":",3))i+=parseInt(n,10)*Math.pow(60,r--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function sn(t){return new Date(t.getTime())}function qd(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let r=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(r),r%=12,r<0&&(r+=12);t.getUTCMonth()!==r;)OI(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function aA(t,e,i=1){return qd(t,e,-i)}function pm(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function OI(t,e=1){return pm(t,-e)}function Ap(t){return t.setUTCHours(0,0,0,0),t}function Ql(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function dp(t,e=19){return t.toISOString().substring(0,e)}function hd(t,...e){return e.every(i=>t.getTime()===i.getTime())}function Pvt(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function GCe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function Gte(t){return typeof t=="string"&&t.length<=10}function LG(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function FG(t,e){return qd(t,e),t}function BG(t,e,i){if(aA(t,e),i.length&&i.length<7)for(;i.includes(t.getUTCDay());)OI(t);return t}function Cvt(t,e){t=sn(t),e==0?t.setUTCDate(t.getUTCDate()+6-t.getUTCDay()):t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/1e3/jCe+1)/7)}function Hte(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function Rvt(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function Ty(...t){return Object.assign(...t)}function sh(t){return Object.keys(t)}function GS(...t){return Math.min(...t)}function Db(...t){return Math.max(...t)}function Mvt(){return Symbol("ec")}function J9(t){return Array.isArray(t)}function cs(t){return typeof t=="function"}function Nvt(t){return t()}function HCe(t){t.forEach(Nvt)}function Avt(){}const _vt=t=>t;function Q9(t,e,i){i.update(r=>r.set(e,t))}function zte(t){HCe(t),t.clear()}function zCe(t,e,i){e??=t,i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}let eY=Mvt();function qCe(t,e){t[eY]=e}function kvt(t){return!!t?.[eY]}function SP(t){return t[eY]}function WCe(t,e,i,r=[]){let n=document.createElement(t);n.className=e,typeof i=="string"?n.innerText=i:i.domNodes?n.replaceChildren(...i.domNodes):i.html&&(n.innerHTML=i.html);for(let a of r)n.setAttribute(...a);return n}function Ovt(t){return t.scrollHeight>t.clientHeight}function qv(t){return t.getBoundingClientRect()}function EU(t,e){for(;e--;)t=t.parentElement;return t}function oN(t){return qv(t).height}function fT(t,e,i=document){for(let r of i.elementsFromPoint(t,e)){if(kvt(r))return r;if(r.shadowRoot){let n=fT(t,e,r.shadowRoot);if(n)return n}}return null}function sA(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function xvt(t,e,i,r){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:r.start,activeEnd:r.end,calendar:void 0}}function cd(t){return t=Ty({},t),t.currentStart=Ql(t.currentStart),t.currentEnd=Ql(t.currentEnd),t.activeStart=Ql(t.activeStart),t.activeEnd=Ql(t.activeEnd),t}function $G(t){return t.startsWith("list")}function M$(t){return t.includes("Timeline")}let Lvt=1;function bk(t){return t.map(e=>{let i={id:"id"in e?String(e.id):`{generated-${Lvt++}}`,resourceIds:N$(e,"resourceId").map(String),allDay:e.allDay??(Gte(e.start)&&Gte(e.end)),start:Ag(e.start),end:Ag(e.end),title:e.title??"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display??"auto",extendedProps:e.extendedProps??{},backgroundColor:e.backgroundColor??e.color,textColor:e.textColor,classNames:N$(e,"className"),styles:N$(e,"style")};if(i.allDay){Ap(i.start);let r=sn(i.end);Ap(i.end),(!hd(i.end,r)||hd(i.end,i.start))&&pm(i.end)}return i})}function N$(t,e){let i=t[e+"s"]??t[e]??[];return J9(i)?i:[i]}function Fvt(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function VG(t,e,i){let r={start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t};return r.zeroDuration=hd(r.start,r.end),r}function Bvt(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function $vt(t,e,i,r,n,a){let s=n.formatRange(t.start,e&&t.event.display!=="pointer"&&!t.zeroDuration?LG(sn(t.start),t.end):t.start),o;if(i&&(o=cs(i)?i({event:fd(t.event),timeText:s,view:cd(a)}):i),o===void 0){let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[qte(s,t,r)];break;default:l=[...t.event.allDay?[]:[qte(s,t,r)],WCe("h4",r.eventTitle,t.event.title)]}o={domNodes:l}}return[s,o]}function qte(t,e,i){return WCe("time",i.eventTime,t,[["datetime",dp(e.start)]])}function Vvt(t,e,i){let r=e.classNames;return t&&(cs(t)&&(t=t({event:fd(e),view:cd(i)})),r=[...J9(t)?t:[t],...r]),r}function fd(t){return YCe(t,Ql)}function A$(t){return YCe(t,sn)}function YCe(t,e){return t=Ty({},t),t.start=e(t.start),t.end=e(t.end),t}function _$(t,e){let i={};if(t.length){Bvt(t);let r;for(let n of t){let a=[],s=Ap(sn(n.start));for(;n.end>s;){if(!e.includes(s.getUTCDay())&&(a.push(sn(s)),a.length>1)){let o=s.getTime();i[o]?i[o].chunks.push(n):i[o]={sorted:!1,chunks:[n]}}pm(s)}if(a.length){n.date=a[0],n.days=a.length,n.dates=a,n.start<a[0]&&(n.start=a[0]);let o=pm(sn(a.at(-1)));n.end>o&&(n.end=o)}else n.date=Ap(sn(n.start)),n.days=1,n.dates=[n.date];r&&hd(r.date,n.date)&&(n.prev=r),r=n}}return i}function jvt(t,e,i){t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let r=1,n=t.date.getTime();if(e[n]){e[n].sorted||(e[n].chunks.sort((a,s)=>a.top-s.top),e[n].sorted=!0);for(let a of e[n].chunks)if(t.top<a.bottom&&t.bottom>a.top){let s=a.bottom-t.top+1;r+=s,t.top+=s,t.bottom+=s}}return r}function KCe(t,e){t.length=e.length;let i=[];for(let r of t)i.push(r?.reposition?.());return i}function Wte(t,e,i,r){return t.start<i&&t.end>e?r?(J9(r)||(r=[r]),r.some(n=>t.resourceIds.includes(n.id))):!0:!1}function PU(t){return Gvt(t)||Hvt(t)||zvt(t)}function t1(t){return t==="background"}function Gvt(t){return t==="preview"}function Hvt(t){return t==="ghost"}function zvt(t){return t==="pointer"}function qvt(t){return Wvt(t,"month")}function Wvt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function Yvt(t){return e=>({...e,view:t})}function Kvt(t){let e,i;return t&&({start:e,end:i}=t,e&&(e=Ap(Ag(e))),i&&(i=Ap(Ag(i)))),{start:e,end:i}}function ZCe(t,e){return e.start&&t<e.start||e.end&&t>e.end}function Yte(t,e){return e.start&&t<e.start&&(t=e.start),e.end&&t>e.end&&(t=e.end),t}function Zvt(t){let e=[];return XCe(t,0,e),e}function XCe(t,e,i){let r=[];for(let n of t){let a=Xvt(n);r.push(a),i.push(a);let s={level:e,children:[],expanded:!0,hidden:!1};qCe(a,s),n.children&&(s.children=XCe(n.children,e+1,i))}return r}function Xvt(t){return{id:String(t.id),title:t.title||"",eventBackgroundColor:t.eventBackgroundColor,eventTextColor:t.eventTextColor,extendedProps:t.extendedProps??{}}}function Jvt(t,e){return JCe(t,e)?.eventBackgroundColor}function Qvt(t,e){return JCe(t,e)?.eventTextColor}function JCe(t,e){return e.find(i=>t.resourceIds.includes(i.id))}function TP(t,e){return lf([t,e],([i,r])=>{let n=cs(r)?{format:r}:new Intl.DateTimeFormat(i,r);return{format:a=>n.format(Ql(a))}})}function Kte(t,e){return lf([t,e],([i,r])=>{let n;if(cs(r))n=r;else{let a=new Intl.DateTimeFormat(i,r);n=(s,o)=>{if(s<=o)return a.formatRange(s,o);{let l=a.formatRangeToParts(o,s),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=u.indexOf(p.source);h>=0?d[h]||(c+=eyt(u[1-h],l),d[h]=!0):c+=p.value}return c}}}return{formatRange:(a,s)=>n(Ql(a),Ql(s))}})}function eyt(t,e){let i="";for(let r of e)r.source==t&&(i+=r.value);return i}function tyt(t){let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},customButtons:{},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"full"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},filterEventsWithResources:!1,filterResourcesWithEvents:!1,firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,resourceLabelContent:void 0,resourceLabelDidMount:void 0,resources:[],selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelInterval:void 0,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",slotWidth:72,theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",disabled:"ec-disabled",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",resource:"ec-resource",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},validRange:void 0,view:void 0,viewDidMount:void 0,views:{}};for(let i of t)i.createOptions?.(e);return e}function iyt(t){let e={date:i=>Ap(Ag(i)),duration:Zd,events:bk,eventSources:Fvt,hiddenDays:i=>[...new Set(i)],highlightedDates:i=>i.map(r=>Ap(Ag(r))),resources:Zvt,scrollTime:Zd,slotDuration:Zd,slotLabelInterval:i=>i!==void 0?Zd(i):void 0,slotMaxTime:Zd,slotMinTime:Zd,validRange:Kvt};for(let i of t)i.createParsers?.(e);return e}function ryt(t,e){let i=[];for(let r of sh(t))t[r]!==e[r]&&i.push([r,t[r]]);return Ty(e,t),i}function nyt(t){return lf(t.view,e=>e?.startsWith("dayGrid"))}function ayt(t){return lf([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,r,n])=>{let a=sn(e.start),s=sn(e.end);if(n)GCe(a,i),Pvt(s,i);else if(r.days||r.seconds>jCe){qd(OI(s),r);let o=OI(sn(s));o<a&&(a=o)}return{start:a,end:s}})}function syt(t){return lf([t.date,t.duration,t.firstDay],([e,i,r])=>{let n=sn(e),a;return i.months?n.setUTCDate(1):i.inWeeks&&GCe(n,r),a=qd(sn(n),i),{start:n,end:a}})}function oyt(t){return lf([t._activeRange,t.hiddenDays],([e,i])=>{let r=[],n=Ap(sn(e.start)),a=Ap(sn(e.end));for(;n<a;)i.includes(n.getUTCDay())||r.push(sn(n)),pm(n);return!r.length&&i.length&&i.length<7&&(t.date.update(s=>{for(;i.includes(s.getUTCDay());)pm(s);return s}),r=gk(t._viewDates)),r})}function lyt(t){return lf([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,r,n])=>n?r.formatRange(e,e):r.formatRange(i.start,OI(sn(i.end))))}function cyt(t){return lf([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>xvt(...e))}function uyt(t){let e=Yo([]),i,r=0,n={};return lf([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,s)=>Q9(()=>{let[o,l,c,u,d,p]=a;if(!l.length){s(o);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,cs(p)&&!r&&p(!0);let h=()=>{--r===0&&cs(p)&&p(!1)},f=[],m=b=>h(),g=b=>{f=f.concat(bk(b)),s(f),h()},v=dp(c.start),y=dp(c.end);for(let b of l){if(cs(b.events)){let I=b.events({start:Ql(c.start),end:Ql(c.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=cs(b.extraParams)?b.extraParams():Ty({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let w=b.url,T={},S;["GET","HEAD"].includes(b.method)?w+=(w.includes("?")?"&":"?")+I:(T["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(I)),fetch(w,{method:b.method,headers:T,body:S,signal:i.signal,credentials:"same-origin"}).then(D=>D.json()).then(g).catch(m)}++r}u.start=c.start,u.end=c.end}},n,t._queue),[]).subscribe(e.set),e}function dyt(){return VCe(Ag(),t=>{let e=setInterval(()=>{t(Ag())},1e3);return()=>clearInterval(e)})}function pyt(t){return lf(t._now,e=>Ap(sn(e)))}class hyt{constructor(e,i){e=e||[];let r=tyt(e),n=iyt(e);r=jG(r,n),i=jG(i,n);for(let[s,o]of Object.entries(r))this[s]=Yo(o);this._queue=Yo(new Map),this._queue2=Yo(new Map),this._tasks=new Map,this._auxiliary=Yo([]),this._dayGrid=nyt(this),this._currentRange=syt(this),this._activeRange=ayt(this),this._fetchedRange=Yo({start:void 0,end:void 0}),this._events=uyt(this),this._now=dyt(),this._today=pyt(this),this._intlEventTime=Kte(this.locale,this.eventTimeFormat),this._intlSlotLabel=TP(this.locale,this.slotLabelFormat),this._intlDayHeader=TP(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=TP(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=Kte(this.locale,this.titleFormat),this._bodyEl=Yo(void 0),this._scrollable=Yo(!1),this._viewTitle=lyt(this),this._viewDates=oyt(this),this._view=cyt(this),this._viewComponent=Yo(void 0),this._interaction=Yo({}),this._iEvents=Yo([null,null]),this._iClasses=Yo(_vt),this._iClass=Yo(void 0),this._set=(s,o)=>{GG(s,this)&&(n[s]&&(o=n[s](o)),this[s].set(o))},this._get=s=>GG(s,this)?gk(this[s]):void 0;for(let s of e)s.createStores?.(this);i.view&&this.view.set(i.view);let a=new Set([...sh(r.views),...sh(i.views??{})]);for(let s of a){let o=Zte(r,r.views[s]??{}),l=Zte(o,i,i.views?.[s]??{}),c=l.component;fyt(l,this);for(let u of sh(l)){let{set:d,_set:p=d,...h}=this[u];this[u]={set:["buttonText","theme"].includes(u)?f=>{if(cs(f)){let m=f(o[u]);l[u]=m,d(d===p?m:f)}else l[u]=f,d(f)}:f=>{l[u]=f,d(f)},_set:p,...h}}this.view.subscribe(u=>{if(u===s){this._viewComponent.set(c),cs(l.viewDidMount)&&oM().then(()=>l.viewDidMount(gk(this._view)));for(let d of sh(l))this[d]._set(l[d])}})}}}function jG(t,e){let i={...t};for(let r of sh(e))r in i&&(i[r]=e[r](i[r]));if(t.views){i.views={};for(let r of sh(t.views))i.views[r]=jG(t.views[r],e)}return i}function Zte(...t){let e={};for(let i of t){let r={};for(let n of["buttonText","theme"])cs(i[n])&&(r[n]=i[n](e[n]));e={...e,...i,...r}}return e}function fyt(t,e){sh(t).filter(i=>!GG(i,e)||i=="view").forEach(i=>delete t[i])}function GG(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function Xte(t,e,i){const r=t.slice();return r[34]=e[i],r}function myt(t){let e,i=t[7][t[34]]+"",r,n,a,s;function o(){return t[29](t[34])}return{c(){e=Vr("button"),r=aM(i),bt(e,"class",n=t[5].button+(t[9]===t[34]?" "+t[5].active:"")+" ec-"+t[34])},m(l,c){Br(l,e,c),bn(e,r),a||(s=xn(e,"click",o),a=!0)},p(l,c){t=l,c[0]&129&&i!==(i=t[7][t[34]]+"")&&xCe(r,i),c[0]&545&&n!==(n=t[5].button+(t[9]===t[34]?" "+t[5].active:"")+" ec-"+t[34])&&bt(e,"class",n)},d(l){l&&Mr(e),a=!1,s()}}}function gyt(t){let e,i,r,n,a;return{c(){e=Vr("button"),bt(e,"class",i=t[5].button+" ec-"+t[34]+(t[8][t[34]].active?" "+t[5].active:""))},m(s,o){Br(s,e,o),n||(a=[xn(e,"click",function(){Qa(t[8][t[34]].click)&&t[8][t[34]].click.apply(this,arguments)}),Ng(r=ab.call(null,e,t[8][t[34]].text))],n=!0)},p(s,o){t=s,o[0]&289&&i!==(i=t[5].button+" ec-"+t[34]+(t[8][t[34]].active?" "+t[5].active:""))&&bt(e,"class",i),r&&Qa(r.update)&&o[0]&257&&r.update.call(null,t[8][t[34]].text)},d(s){s&&Mr(e),n=!1,rd(a)}}}function vyt(t){let e,i=t[7][t[34]]+"",r,n,a,s;return{c(){e=Vr("button"),r=aM(i),bt(e,"class",n=t[5].button+" ec-"+t[34]),e.disabled=t[1]},m(o,l){Br(o,e,l),bn(e,r),a||(s=xn(e,"click",t[28]),a=!0)},p(o,l){l[0]&129&&i!==(i=o[7][o[34]]+"")&&xCe(r,i),l[0]&33&&n!==(n=o[5].button+" ec-"+o[34])&&bt(e,"class",n),l[0]&2&&(e.disabled=o[1])},d(o){o&&Mr(e),a=!1,s()}}}function yyt(t){let e,i,r,n,a,s,o,l;return{c(){e=Vr("button"),i=Vr("i"),bt(i,"class",r=t[5].icon+" ec-"+t[34]),bt(e,"class",n=t[5].button+" ec-"+t[34]),bt(e,"aria-label",a=t[7].next),bt(e,"title",s=t[7].next),e.disabled=t[4]},m(c,u){Br(c,e,u),bn(e,i),o||(l=xn(e,"click",t[23]),o=!0)},p(c,u){u[0]&33&&r!==(r=c[5].icon+" ec-"+c[34])&&bt(i,"class",r),u[0]&33&&n!==(n=c[5].button+" ec-"+c[34])&&bt(e,"class",n),u[0]&128&&a!==(a=c[7].next)&&bt(e,"aria-label",a),u[0]&128&&s!==(s=c[7].next)&&bt(e,"title",s),u[0]&16&&(e.disabled=c[4])},d(c){c&&Mr(e),o=!1,l()}}}function byt(t){let e,i,r,n,a,s,o,l;return{c(){e=Vr("button"),i=Vr("i"),bt(i,"class",r=t[5].icon+" ec-"+t[34]),bt(e,"class",n=t[5].button+" ec-"+t[34]),bt(e,"aria-label",a=t[7].prev),bt(e,"title",s=t[7].prev),e.disabled=t[3]},m(c,u){Br(c,e,u),bn(e,i),o||(l=xn(e,"click",t[22]),o=!0)},p(c,u){u[0]&33&&r!==(r=c[5].icon+" ec-"+c[34])&&bt(i,"class",r),u[0]&33&&n!==(n=c[5].button+" ec-"+c[34])&&bt(e,"class",n),u[0]&128&&a!==(a=c[7].prev)&&bt(e,"aria-label",a),u[0]&128&&s!==(s=c[7].prev)&&bt(e,"title",s),u[0]&8&&(e.disabled=c[3])},d(c){c&&Mr(e),o=!1,l()}}}function Iyt(t){let e,i,r,n,a;return{c(){e=Vr("h2"),bt(e,"class",i=t[5].title)},m(s,o){Br(s,e,o),n||(a=Ng(r=ab.call(null,e,t[6])),n=!0)},p(s,o){o[0]&32&&i!==(i=s[5].title)&&bt(e,"class",i),r&&Qa(r.update)&&o[0]&64&&r.update.call(null,s[6])},d(s){s&&Mr(e),n=!1,a()}}}function Jte(t){let e;function i(a,s){if(a[34]=="title")return Iyt;if(a[34]=="prev")return byt;if(a[34]=="next")return yyt;if(a[34]=="today")return vyt;if(a[8][a[34]])return gyt;if(a[34]!="")return myt}let r=i(t),n=r&&r(t);return{c(){n&&n.c(),e=_d()},m(a,s){n&&n.m(a,s),Br(a,e,s)},p(a,s){r===(r=i(a))&&n?n.p(a,s):(n&&n.d(1),n=r&&r(a),n&&(n.c(),n.m(e.parentNode,e)))},d(a){a&&Mr(e),n&&n.d(a)}}}function wyt(t){let e,i=Io(t[0]),r=[];for(let n=0;n<i.length;n+=1)r[n]=Jte(Xte(t,i,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=_d()},m(n,a){for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(n,a);Br(n,e,a)},p(n,a){if(a[0]&14681087){i=Io(n[0]);let s;for(s=0;s<i.length;s+=1){const o=Xte(n,i,s);r[s]?r[s].p(o,a):(r[s]=Jte(o),r[s].c(),r[s].m(e.parentNode,e))}for(;s<r.length;s+=1)r[s].d(1);r.length=i.length}},i:es,o:es,d(n){n&&Mr(e),tS(r,n)}}}function Syt(t,e,i){let r,n,a,s,o,l,c,u,d,p,h,{buttons:f}=e,{_currentRange:m,_viewTitle:g,_viewDates:v,buttonText:y,customButtons:b,date:I,duration:w,hiddenDays:T,theme:S,validRange:D,view:C}=kd("state");Je(t,m,j=>i(27,l=j)),Je(t,g,j=>i(6,u=j)),Je(t,v,j=>i(31,o=j)),Je(t,y,j=>i(7,d=j)),Je(t,b,j=>i(8,p=j)),Je(t,I,j=>i(2,n=j)),Je(t,w,j=>i(24,r=j)),Je(t,T,j=>i(25,a=j)),Je(t,S,j=>i(5,c=j)),Je(t,D,j=>i(26,s=j)),Je(t,C,j=>i(9,h=j));let E=Ap(Ag()),P,R,M,A=!1;function N(){return A}function k(){return o.every(j=>ZCe(j,s))}function x(){an(I,n=BG(n,r,a),n)}function O(){an(I,n=FG(n,r),n)}const V=()=>an(I,n=sn(E),n),F=j=>an(C,h=j,h);return t.$$set=j=>{"buttons"in j&&i(0,f=j.buttons)},t.$$.update=()=>{if(t.$$.dirty[0]&251658246&&!N()){if(A=!0,i(3,P=!1),i(4,R=!1),s.start){let j=sn(n);an(I,n=BG(n,r,a),n),i(3,P=k()),an(I,n=j,n)}if(s.end){let j=sn(n);an(I,n=FG(n,r),n),i(4,R=k()),an(I,n=j,n)}if(i(1,M=E>=l.start&&E<l.end),!M&&(s.start||s.end)){let j=sn(n);an(I,n=sn(E),n),i(1,M=k()),an(I,n=j,n)}oM().then(()=>A=!1)}},[f,M,n,P,R,c,u,d,p,h,m,g,v,y,b,I,w,T,S,D,C,E,x,O,r,a,s,l,V,F]}class QCe extends su{constructor(e){super(),au(this,e,Syt,wyt,Ic,{buttons:0},null,[-1,-1])}}function Qte(t,e,i){const r=t.slice();return r[5]=e[i],r}function eie(t,e,i){const r=t.slice();return r[8]=e[i],r}function Tyt(t){let e,i;return e=new QCe({props:{buttons:t[8]}}),{c(){ts(e.$$.fragment)},m(r,n){ka(e,r,n),i=!0},p(r,n){const a={};n&1&&(a.buttons=r[8]),e.$set(a)},i(r){i||(ci(e.$$.fragment,r),i=!0)},o(r){Oi(e.$$.fragment,r),i=!1},d(r){Oa(e,r)}}}function Uyt(t){let e,i,r,n;return i=new QCe({props:{buttons:t[8]}}),{c(){e=Vr("div"),ts(i.$$.fragment),bt(e,"class",r=t[1].buttonGroup)},m(a,s){Br(a,e,s),ka(i,e,null),n=!0},p(a,s){const o={};s&1&&(o.buttons=a[8]),i.$set(o),(!n||s&2&&r!==(r=a[1].buttonGroup))&&bt(e,"class",r)},i(a){n||(ci(i.$$.fragment,a),n=!0)},o(a){Oi(i.$$.fragment,a),n=!1},d(a){a&&Mr(e),Oa(i)}}}function tie(t){let e,i,r,n;const a=[Uyt,Tyt],s=[];function o(l,c){return l[8].length>1?0:1}return e=o(t),i=s[e]=a[e](t),{c(){i.c(),r=_d()},m(l,c){s[e].m(l,c),Br(l,r,c),n=!0},p(l,c){let u=e;e=o(l),e===u?s[e].p(l,c):(no(),Oi(s[u],1,1,()=>{s[u]=null}),ao(),i=s[e],i?i.p(l,c):(i=s[e]=a[e](l),i.c()),ci(i,1),i.m(r.parentNode,r))},i(l){n||(ci(i),n=!0)},o(l){Oi(i),n=!1},d(l){l&&Mr(r),s[e].d(l)}}}function iie(t){let e,i,r,n,a=Io(t[0][t[5]]),s=[];for(let l=0;l<a.length;l+=1)s[l]=tie(eie(t,a,l));const o=l=>Oi(s[l],1,1,()=>{s[l]=null});return{c(){e=Vr("div");for(let l=0;l<s.length;l+=1)s[l].c();i=Xo(),bt(e,"class",r="ec-"+t[5])},m(l,c){Br(l,e,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);bn(e,i),n=!0},p(l,c){if(c&3){a=Io(l[0][l[5]]);let u;for(u=0;u<a.length;u+=1){const d=eie(l,a,u);s[u]?(s[u].p(d,c),ci(s[u],1)):(s[u]=tie(d),s[u].c(),ci(s[u],1),s[u].m(e,i))}for(no(),u=a.length;u<s.length;u+=1)o(u);ao()}(!n||c&1&&r!==(r="ec-"+l[5]))&&bt(e,"class",r)},i(l){if(!n){for(let c=0;c<a.length;c+=1)ci(s[c]);n=!0}},o(l){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)Oi(s[c]);n=!1},d(l){l&&Mr(e),tS(s,l)}}}function Dyt(t){let e,i,r,n=Io(sh(t[0])),a=[];for(let o=0;o<n.length;o+=1)a[o]=iie(Qte(t,n,o));const s=o=>Oi(a[o],1,1,()=>{a[o]=null});return{c(){e=Vr("nav");for(let o=0;o<a.length;o+=1)a[o].c();bt(e,"class",i=t[1].toolbar)},m(o,l){Br(o,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);r=!0},p(o,[l]){if(l&3){n=Io(sh(o[0]));let c;for(c=0;c<n.length;c+=1){const u=Qte(o,n,c);a[c]?(a[c].p(u,l),ci(a[c],1)):(a[c]=iie(u),a[c].c(),ci(a[c],1),a[c].m(e,null))}for(no(),c=n.length;c<a.length;c+=1)s(c);ao()}(!r||l&2&&i!==(i=o[1].toolbar))&&bt(e,"class",i)},i(o){if(!r){for(let l=0;l<n.length;l+=1)ci(a[l]);r=!0}},o(o){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Oi(a[l]);r=!1},d(o){o&&Mr(e),tS(a,o)}}}function Eyt(t,e,i){let r,n,{headerToolbar:a,theme:s}=kd("state");Je(t,a,l=>i(4,r=l)),Je(t,s,l=>i(1,n=l));let o={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of sh(o))i(0,o[l]=r[l].split(" ").map(c=>c.split(",")),o)},[o,n,a,s,r]}class Pyt extends su{constructor(e){super(),au(this,e,Eyt,Dyt,Ic,{})}}function rie(t,e,i){const r=t.slice();return r[11]=e[i],r}function nie(t){let e,i,r;var n=t[11];function a(s,o){return{}}return n&&(e=kv(n,a())),{c(){e&&ts(e.$$.fragment),i=_d()},m(s,o){e&&ka(e,s,o),Br(s,i,o),r=!0},p(s,o){if(o&1&&n!==(n=s[11])){if(e){no();const l=e;Oi(l.$$.fragment,1,0,()=>{Oa(l,1)}),ao()}n?(e=kv(n,a()),ts(e.$$.fragment),ci(e.$$.fragment,1),ka(e,i.parentNode,i)):e=null}},i(s){r||(e&&ci(e.$$.fragment,s),r=!0)},o(s){e&&Oi(e.$$.fragment,s),r=!1},d(s){s&&Mr(i),e&&Oa(e,s)}}}function Cyt(t){let e,i,r=Io(t[0]),n=[];for(let s=0;s<r.length;s+=1)n[s]=nie(rie(t,r,s));const a=s=>Oi(n[s],1,1,()=>{n[s]=null});return{c(){for(let s=0;s<n.length;s+=1)n[s].c();e=_d()},m(s,o){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(s,o);Br(s,e,o),i=!0},p(s,[o]){if(o&1){r=Io(s[0]);let l;for(l=0;l<r.length;l+=1){const c=rie(s,r,l);n[l]?(n[l].p(c,o),ci(n[l],1)):(n[l]=nie(c),n[l].c(),ci(n[l],1),n[l].m(e.parentNode,e))}for(no(),l=r.length;l<n.length;l+=1)a(l);ao()}},i(s){if(!i){for(let o=0;o<r.length;o+=1)ci(n[o]);i=!0}},o(s){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)Oi(n[o]);i=!1},d(s){s&&Mr(e),tS(n,s)}}}function Ryt(t,e,i){let r,n,a,s,{datesSet:o,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=kd("state");Je(t,o,f=>i(7,n=f)),Je(t,l,f=>i(0,s=f)),Je(t,c,f=>i(5,a=f)),Je(t,d,f=>i(6,r=f));let p={};function h(f){cs(n)&&Q9(()=>n({start:Ql(f.start),end:Ql(f.end),startStr:dp(f.start),endStr:dp(f.end),view:cd(r)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&h(a)},[s,o,l,c,d,a]}let Myt=class extends su{constructor(e){super(),au(this,e,Ryt,Cyt,Ic,{})}};function Nyt(t){let e,i,r,n,a,s,o,l,c,u,d;i=new Pyt({});var p=t[5];function h(f,m){return{}}return p&&(n=kv(p,h())),l=new Myt({}),{c(){e=Vr("div"),ts(i.$$.fragment),r=Xo(),n&&ts(n.$$.fragment),o=Xo(),ts(l.$$.fragment),bt(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),bt(e,"role",s=$G(t[4])?"list":"table"),Vte(e,"height",t[3])},m(f,m){Br(f,e,m),ka(i,e,null),bn(e,r),n&&ka(n,e,null),Br(f,o,m),ka(l,f,m),c=!0,u||(d=xn(window,"resize",t[20]),u=!0)},p(f,m){if(m[0]&32&&p!==(p=f[5])){if(n){no();const g=n;Oi(g.$$.fragment,1,0,()=>{Oa(g,1)}),ao()}p?(n=kv(p,h()),ts(n.$$.fragment),ci(n.$$.fragment,1),ka(n,e,null)):n=null}(!c||m[0]&7&&a!==(a=f[1].calendar+" "+f[1].view+(f[0]?" "+f[1].withScroll:"")+(f[2]?" "+f[1][f[2]]:"")))&&bt(e,"class",a),(!c||m[0]&16&&s!==(s=$G(f[4])?"list":"table"))&&bt(e,"role",s),m[0]&8&&Vte(e,"height",f[3])},i(f){c||(ci(i.$$.fragment,f),n&&ci(n.$$.fragment,f),ci(l.$$.fragment,f),c=!0)},o(f){Oi(i.$$.fragment,f),n&&Oi(n.$$.fragment,f),Oi(l.$$.fragment,f),c=!1},d(f){f&&(Mr(e),Mr(o)),Oa(i),n&&Oa(n),Oa(l,f),u=!1,d()}}}function Ayt(t,e,i){let r,n,a,s,o,l,c,u,d,p,h,f,m,g,{plugins:v=[]}=e,{options:y={}}=e,b=new hyt(v,y);Svt("state",b);let{_viewComponent:I,_bodyEl:w,_interaction:T,_iClass:S,_events:D,_queue:C,_queue2:E,_tasks:P,_scrollable:R,date:M,duration:A,hiddenDays:N,height:k,theme:x,view:O}=b;Je(t,I,he=>i(5,g=he)),Je(t,w,he=>i(36,r=he)),Je(t,T,he=>i(42,u=he)),Je(t,S,he=>i(2,h=he)),Je(t,D,he=>i(43,d=he)),Je(t,C,he=>i(38,s=he)),Je(t,E,he=>i(37,a=he)),Je(t,R,he=>i(0,n=he)),Je(t,M,he=>i(41,c=he)),Je(t,A,he=>i(40,l=he)),Je(t,N,he=>i(39,o=he)),Je(t,k,he=>i(3,f=he)),Je(t,x,he=>i(1,p=he)),Je(t,O,he=>i(4,m=he));let V={...y};function F(he,Ie){return b._set(he,Ie),this}function j(he){let Ie=b._get(he);return Ie instanceof Date?Ql(Ie):Ie}function q(){return b._fetchedRange.set({start:void 0,end:void 0}),this}function W(){return d.map(fd)}function z(he){for(let Ie of d)if(Ie.id==he)return fd(Ie);return null}function H(he){return he=bk([he])[0],d.push(he),D.set(d),fd(he)}function Z(he){for(let Ie of d)if(Ie.id==he.id)return he=bk([he])[0],Ty(Ie,he),D.set(d),fd(he);return null}function J(he){let Ie=d.findIndex(Le=>Le.id==he);return Ie>=0&&(d.splice(Ie,1),D.set(d)),this}function ie(){return cd(gk(b._view))}function K(){return u.action?.unselect(),this}function ne(he,Ie){let Le=fT(he,Ie);if(Le){let ot=SP(Le)(he,Ie);return ot.date=Ql(ot.date),ot}return null}function le(){return an(M,c=FG(c,l),c),this}function re(){return an(M,c=BG(c,l,o),c),this}Ivt(()=>{zte(s)}),LCe(()=>{zte(a),zCe(me,null,P)});function me(){r&&an(R,n=Ovt(r),n)}return t.$$set=he=>{"plugins"in he&&i(21,v=he.plugins),"options"in he&&i(22,y=he.options)},t.$$.update=()=>{if(t.$$.dirty[0]&4194304)for(let[he,Ie]of ryt(y,V))F(he,Ie)},[n,p,h,f,m,g,I,w,T,S,D,C,E,R,M,A,N,k,x,O,me,v,y,F,j,q,W,z,H,Z,J,ie,K,ne,le,re]}class _yt extends su{constructor(e){super(),au(this,e,Ayt,Nyt,Ic,{plugins:21,options:22,setOption:23,getOption:24,refetchEvents:25,getEvents:26,getEventById:27,addEvent:28,updateEvent:29,removeEventById:30,getView:31,unselect:32,dateFromPoint:33,next:34,prev:35},null,[-1,-1])}get setOption(){return this.$$.ctx[23]}get getOption(){return this.$$.ctx[24]}get refetchEvents(){return this.$$.ctx[25]}get getEvents(){return this.$$.ctx[26]}get getEventById(){return this.$$.ctx[27]}get addEvent(){return this.$$.ctx[28]}get updateEvent(){return this.$$.ctx[29]}get removeEventById(){return this.$$.ctx[30]}get getView(){return this.$$.ctx[31]}get unselect(){return this.$$.ctx[32]}get dateFromPoint(){return this.$$.ctx[33]}get next(){return this.$$.ctx[34]}get prev(){return this.$$.ctx[35]}}let kyt=class extends _yt{destroy(){this.$destroy()}get view(){return this.getView()}};function Oyt(t){return lf([t.date,t.firstDay,t.hiddenDays],([e,i,r])=>{let n=[],a=sn(e),s=7;for(;a.getUTCDay()!==i&&s;)OI(a),--s;for(let o=0;o<7;++o)r.includes(a.getUTCDay())||n.push(sn(a)),pm(a);return n})}function aie(t,e,i){const r=t.slice();return r[8]=e[i],r}function sie(t){let e,i,r,n,a,s,o,l;return{c(){e=Vr("div"),i=Vr("span"),a=Xo(),bt(i,"aria-label",r=t[2].format(t[8])),bt(e,"class",s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()]),bt(e,"role","columnheader")},m(c,u){Br(c,e,u),bn(e,i),bn(e,a),o||(l=Ng(n=ab.call(null,i,t[3].format(t[8]))),o=!0)},p(c,u){t=c,u&6&&r!==(r=t[2].format(t[8]))&&bt(i,"aria-label",r),n&&Qa(n.update)&&u&10&&n.update.call(null,t[3].format(t[8])),u&3&&s!==(s=t[0].day+" "+t[0].weekdays?.[t[8].getUTCDay()])&&bt(e,"class",s)},d(c){c&&Mr(e),o=!1,l()}}}function xyt(t){let e,i,r,n,a,s,o,l=Io(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=sie(aie(t,l,u));return{c(){e=Vr("div"),i=Vr("div");for(let u=0;u<c.length;u+=1)c[u].c();n=Xo(),a=Vr("div"),bt(i,"class",r=t[0].days),bt(i,"role","row"),bt(a,"class",s=t[0].hiddenScroll),bt(e,"class",o=t[0].header)},m(u,d){Br(u,e,d),bn(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);bn(e,n),bn(e,a)},p(u,[d]){if(d&15){l=Io(u[1]);let p;for(p=0;p<l.length;p+=1){const h=aie(u,l,p);c[p]?c[p].p(h,d):(c[p]=sie(h),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&r!==(r=u[0].days)&&bt(i,"class",r),d&1&&s!==(s=u[0].hiddenScroll)&&bt(a,"class",s),d&1&&o!==(o=u[0].header)&&bt(e,"class",o)},i:es,o:es,d(u){u&&Mr(e),tS(c,u)}}}function Lyt(t,e,i){let r,n,a,s,{theme:o,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=kd("state");return Je(t,o,d=>i(0,r=d)),Je(t,l,d=>i(3,s=d)),Je(t,c,d=>i(2,a=d)),Je(t,u,d=>i(1,n=d)),[r,n,a,s,o,l,c,u]}class Fyt extends su{constructor(e){super(),au(this,e,Lyt,xyt,Ic,{})}}function Byt(t){let e,i,r,n,a,s,o,l,c,u,d,p,h;var f=t[8].resizer;function m(y,b){return{props:{start:!0,event:y[0]}}}f&&(i=kv(f,m(t)),i.$on("pointerdown",function(){Qa(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}));var g=t[8].resizer;function v(y,b){return{props:{event:y[0]}}}return g&&(l=kv(g,v(t)),l.$on("pointerdown",function(){Qa(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)})),{c(){e=Vr("article"),i&&ts(i.$$.fragment),r=Xo(),n=Vr("div"),o=Xo(),l&&ts(l.$$.fragment),bt(n,"class",a=t[2].eventBody),bt(e,"class",t[4]),bt(e,"style",t[5]),bt(e,"role",c=t[7]?"button":void 0),bt(e,"tabindex",u=t[7]?0:void 0)},m(y,b){Br(y,e,b),i&&ka(i,e,null),bn(e,r),bn(e,n),bn(e,o),l&&ka(l,e,null),t[51](e),d=!0,p||(h=[Ng(s=ab.call(null,n,t[6])),xn(e,"click",function(){Qa(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),xn(e,"keydown",function(){Qa(t[7]&&yk(t[7]))&&(t[7]&&yk(t[7])).apply(this,arguments)}),xn(e,"mouseenter",function(){Qa(t[31](t[9],t[1]))&&t[31](t[9],t[1]).apply(this,arguments)}),xn(e,"mouseleave",function(){Qa(t[31](t[10],t[1]))&&t[31](t[10],t[1]).apply(this,arguments)}),xn(e,"pointerdown",function(){Qa(!PU(t[1])&&t[32](t[8]))&&(!PU(t[1])&&t[32](t[8])).apply(this,arguments)})],p=!0)},p(y,b){if(t=y,b[0]&256&&f!==(f=t[8].resizer)){if(i){no();const I=i;Oi(I.$$.fragment,1,0,()=>{Oa(I,1)}),ao()}f?(i=kv(f,m(t)),i.$on("pointerdown",function(){Qa(t[32](t[8],["x","start"]))&&t[32](t[8],["x","start"]).apply(this,arguments)}),ts(i.$$.fragment),ci(i.$$.fragment,1),ka(i,e,r)):i=null}else if(f){const I={};b[0]&1&&(I.event=t[0]),i.$set(I)}if((!d||b[0]&4&&a!==(a=t[2].eventBody))&&bt(n,"class",a),s&&Qa(s.update)&&b[0]&64&&s.update.call(null,t[6]),b[0]&256&&g!==(g=t[8].resizer)){if(l){no();const I=l;Oi(I.$$.fragment,1,0,()=>{Oa(I,1)}),ao()}g?(l=kv(g,v(t)),l.$on("pointerdown",function(){Qa(t[32](t[8],["x","end"]))&&t[32](t[8],["x","end"]).apply(this,arguments)}),ts(l.$$.fragment),ci(l.$$.fragment,1),ka(l,e,null)):l=null}else if(g){const I={};b[0]&1&&(I.event=t[0]),l.$set(I)}(!d||b[0]&16)&&bt(e,"class",t[4]),(!d||b[0]&32)&&bt(e,"style",t[5]),(!d||b[0]&128&&c!==(c=t[7]?"button":void 0))&&bt(e,"role",c),(!d||b[0]&128&&u!==(u=t[7]?0:void 0))&&bt(e,"tabindex",u)},i(y){d||(i&&ci(i.$$.fragment,y),l&&ci(l.$$.fragment,y),d=!0)},o(y){i&&Oi(i.$$.fragment,y),l&&Oi(l.$$.fragment,y),d=!1},d(y){y&&Mr(e),i&&Oa(i),l&&Oa(l),t[51](null),p=!1,rd(h)}}}function $yt(t,e,i){let r,n,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,w,T,{chunk:S}=e,{longChunks:D={}}=e,{inPopup:C=!1}=e,{dates:E=[]}=e,{dayMaxEvents:P,displayEventEnd:R,eventAllUpdated:M,eventBackgroundColor:A,eventTextColor:N,eventClick:k,eventColor:x,eventContent:O,eventClassNames:V,eventDidMount:F,eventMouseEnter:j,eventMouseLeave:q,resources:W,theme:z,_view:H,_intlEventTime:Z,_interaction:J,_iClasses:ie,_hiddenEvents:K,_popupDate:ne,_tasks:le}=kd("state");Je(t,P,xe=>i(54,a=xe)),Je(t,R,xe=>i(44,f=xe)),Je(t,M,xe=>i(56,c=xe)),Je(t,A,xe=>i(50,I=xe)),Je(t,N,xe=>i(47,v=xe)),Je(t,k,xe=>i(40,r=xe)),Je(t,x,xe=>i(49,b=xe)),Je(t,O,xe=>i(43,h=xe)),Je(t,V,xe=>i(45,m=xe)),Je(t,F,xe=>i(57,u=xe)),Je(t,j,xe=>i(9,w=xe)),Je(t,q,xe=>i(10,T=xe)),Je(t,W,xe=>i(48,y=xe)),Je(t,z,xe=>i(2,p=xe)),Je(t,H,xe=>i(41,l=xe)),Je(t,Z,xe=>i(42,d=xe)),Je(t,J,xe=>i(8,o=xe)),Je(t,ie,xe=>i(46,g=xe)),Je(t,K,xe=>i(53,n=xe)),Je(t,ne,xe=>i(55,s=xe));let re,me,he,Ie,Le,ot,at=1,dt=!1,It,ze;wvt(()=>{cs(u)&&u({event:fd(me),timeText:ot,el:re,view:cd(l)})}),LCe(()=>{cs(c)&&!PU(It)&&zCe(()=>c({view:cd(l)}),"eau",le)});function Ct(xe,Ze){return!PU(Ze)&&cs(xe)?st=>xe({event:fd(me),el:re,jsEvent:st,view:cd(l)}):void 0}function ke(xe,Ze){return xe.action?st=>o.action.drag(me,st,Ze,C?s:null,[qv(re).top-qv(EU(re,1)).top,E],S.zeroDuration):void 0}function mt(){re&&(i(38,at=jvt(S,D,oN(re))),a===!0?Be():i(39,dt=!1))}function Be(){let xe=EU(re,2),Ze=oN(xe)-oN(xe.firstElementChild)-ut(xe);i(39,dt=S.bottom>Ze);let st=!1;for(let qe of S.dates){let ft=n[qe.getTime()];if(ft){let _t=ft.size;dt?ft.add(S.event):ft.delete(S.event),_t!==ft.size&&(st=!0)}}st&&K.set(n)}function ut(xe){let Ze=0;for(let st=0;st<S.days&&(Ze=Db(Ze,oN(xe.lastElementChild)),xe=xe.nextElementSibling,!!xe);++st);return Ze}function it(xe){dm[xe?"unshift":"push"](()=>{re=xe,i(3,re)})}return t.$$set=xe=>{"chunk"in xe&&i(33,S=xe.chunk),"longChunks"in xe&&i(34,D=xe.longChunks),"inPopup"in xe&&i(35,C=xe.inPopup),"dates"in xe&&i(36,E=xe.dates)},t.$$.update=()=>{if(t.$$.dirty[1]&4&&i(0,me=S.event),t.$$.dirty[0]&39|t.$$.dirty[1]&1033604){i(1,It=me.display);let xe=me.backgroundColor||Jvt(me,y)||I||b,Ze=me.textColor||Qvt(me,y)||v;if(t1(It))i(5,Ie=`width:calc(${S.days*100}% + ${S.days-1}px);`);else{let st=at;if(me._margin){let[qe,ft]=me._margin;S.date>=ft[0]&&S.date<=ft.at(-1)&&(st=qe)}i(5,Ie=`width:calc(${S.days*100}% + ${(S.days-1)*7}px);margin-top:${st}px;`)}xe&&i(5,Ie+=`background-color:${xe};`),Ze&&i(5,Ie+=`color:${Ze};`),dt&&i(5,Ie+="visibility:hidden;"),i(5,Ie+=me.styles.join(";")),i(4,he=[t1(It)?p.bgEvent:p.event,...g([],me),...Vvt(m,me,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15364&&i(6,[ot,Le]=$vt(S,f,h,p,d,l),Le),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,ze=Ct(r,It))},[me,It,p,re,he,Ie,Le,ze,o,w,T,P,R,M,A,N,k,x,O,V,F,j,q,W,z,H,Z,J,ie,K,ne,Ct,ke,S,D,C,E,mt,at,dt,r,l,d,h,f,m,g,v,y,b,I,it]}let lM=class extends su{constructor(e){super(),au(this,e,$yt,Byt,Ic,{chunk:33,longChunks:34,inPopup:35,dates:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function oie(t,e,i){const r=t.slice();return r[20]=e[i],r}function lie(t,e){let i,r,n;return r=new lM({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=_d(),ts(r.$$.fragment),this.first=i},m(a,s){Br(a,i,s),ka(r,a,s),n=!0},p(a,s){e=a;const o={};s&1&&(o.chunk=e[20]),r.$set(o)},i(a){n||(ci(r.$$.fragment,a),n=!0)},o(a){Oi(r.$$.fragment,a),n=!1},d(a){a&&Mr(i),Oa(r,a)}}}function Vyt(t){let e,i,r,n,a,s,o,l,c,u,d,p,h=[],f=new Map,m,g,v,y,b,I=Io(t[0]);const w=T=>T[20].event;for(let T=0;T<I.length;T+=1){let S=oie(t,I,T),D=w(S);f.set(D,h[T]=lie(D,S))}return{c(){e=Vr("div"),i=Vr("div"),r=Vr("time"),s=Xo(),o=Vr("a"),l=aM(""),d=Xo(),p=Vr("div");for(let T=0;T<h.length;T+=1)h[T].c();bt(r,"datetime",n=dp(t[3],10)),bt(o,"role","button"),bt(o,"tabindex","0"),bt(o,"aria-label",c=t[6].close),bt(i,"class",u=t[4].dayHead),bt(p,"class",m=t[4].events),bt(e,"class",g=t[4].popup),bt(e,"style",t[2])},m(T,S){Br(T,e,S),bn(e,i),bn(i,r),bn(i,s),bn(i,o),bn(o,l),bn(e,d),bn(e,p);for(let D=0;D<h.length;D+=1)h[D]&&h[D].m(p,null);t[16](e),v=!0,y||(b=[Ng(a=ab.call(null,r,t[5].format(t[3]))),xn(o,"click",vk(t[13])),xn(o,"keydown",yk(t[13])),Ng(Evt.call(null,e,"pointerdown")),xn(e,"pointerdown",vk(t[15])),xn(e,"pointerdownoutside",t[14])],y=!0)},p(T,[S]){(!v||S&8&&n!==(n=dp(T[3],10)))&&bt(r,"datetime",n),a&&Qa(a.update)&&S&40&&a.update.call(null,T[5].format(T[3])),(!v||S&64&&c!==(c=T[6].close))&&bt(o,"aria-label",c),(!v||S&16&&u!==(u=T[4].dayHead))&&bt(i,"class",u),S&1&&(I=Io(T[0]),no(),h=X9(h,S,w,1,T,I,f,p,Z9,lie,null,oie),ao()),(!v||S&16&&m!==(m=T[4].events))&&bt(p,"class",m),(!v||S&16&&g!==(g=T[4].popup))&&bt(e,"class",g),(!v||S&4)&&bt(e,"style",T[2])},i(T){if(!v){for(let S=0;S<I.length;S+=1)ci(h[S]);v=!0}},o(T){for(let S=0;S<h.length;S+=1)Oi(h[S]);v=!1},d(T){T&&Mr(e);for(let S=0;S<h.length;S+=1)h[S].d();t[16](null),y=!1,rd(b)}}}function jyt(t,e,i){let r,n,a,s,o,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=kd("state");Je(t,c,S=>i(6,l=S)),Je(t,u,S=>i(4,s=S)),Je(t,d,S=>i(17,r=S)),Je(t,p,S=>i(5,o=S)),Je(t,h,S=>i(3,n=S)),Je(t,f,S=>i(0,a=S));let m,g="";function v(){let S=EU(m,1),D=EU(S,3),C=qv(m),E=qv(S),P=qv(D);i(2,g="");let R;if(C.width>=P.width){R=P.left-E.left;let A=E.right-P.right;i(2,g+=`right:${A}px;`)}else R=(E.width-C.width)/2,E.left+R<P.left?R=P.left-E.left:E.left+R+C.width>P.right&&(R=P.right-E.left-C.width);i(2,g+=`left:${R}px;`);let M;if(C.height>=P.height){M=P.top-E.top;let A=E.bottom-P.bottom;i(2,g+=`bottom:${A}px;`)}else M=(E.height-C.height)/2,E.top+M<P.top?M=P.top-E.top:E.top+M+C.height>P.bottom&&(M=P.bottom-E.top-C.height);i(2,g+=`top:${M}px;`)}function y(){m&&(i(2,g=""),oM().then(()=>{a.length?v():b()}))}function b(S){an(h,n=null,n)}function I(S){b(),r.action?.noClick()}function w(S){D2.call(this,t,S)}function T(S){dm[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,n,s,o,l,c,u,d,p,h,f,b,I,w,T]}class Gyt extends su{constructor(e){super(),au(this,e,jyt,Vyt,Ic,{})}}function cie(t,e,i){const r=t.slice();return r[54]=e[i],r[55]=e,r[56]=i,r}function uie(t,e,i){const r=t.slice();return r[54]=e[i],r}function die(t){let e,i,r,n,a;return{c(){e=Vr("span"),bt(e,"class",i=t[17].weekNumber)},m(s,o){Br(s,e,o),n||(a=Ng(r=ab.call(null,e,t[15])),n=!0)},p(s,o){o[0]&131072&&i!==(i=s[17].weekNumber)&&bt(e,"class",i),r&&Qa(r.update)&&o[0]&32768&&r.update.call(null,s[15])},d(s){s&&Mr(e),n=!1,a()}}}function pie(t){let e=[],i=new Map,r,n,a=Io(t[10]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=uie(t,a,o),c=s(l);i.set(c,e[o]=hie(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();r=_d()},m(o,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(o,l);Br(o,r,l),n=!0},p(o,l){l[0]&1024&&(a=Io(o[10]),no(),e=X9(e,l,s,1,o,a,i,r.parentNode,Z9,hie,r,uie),ao())},i(o){if(!n){for(let l=0;l<a.length;l+=1)ci(e[l]);n=!0}},o(o){for(let l=0;l<e.length;l+=1)Oi(e[l]);n=!1},d(o){o&&Mr(r);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function hie(t,e){let i,r,n;return r=new lM({props:{chunk:e[54]}}),{key:t,first:null,c(){i=_d(),ts(r.$$.fragment),this.first=i},m(a,s){Br(a,i,s),ka(r,a,s),n=!0},p(a,s){e=a;const o={};s[0]&1024&&(o.chunk=e[54]),r.$set(o)},i(a){n||(ci(r.$$.fragment,a),n=!0)},o(a){Oi(r.$$.fragment,a),n=!1},d(a){a&&Mr(i),Oa(r,a)}}}function fie(t){let e=t[2][2]&&hd(t[2][2].date,t[0]),i,r=t[2][0]&&hd(t[2][0].date,t[0]),n,a,s=e&&mie(t),o=r&&gie(t);return{c(){s&&s.c(),i=Xo(),o&&o.c(),n=_d()},m(l,c){s&&s.m(l,c),Br(l,i,c),o&&o.m(l,c),Br(l,n,c),a=!0},p(l,c){c[0]&5&&(e=l[2][2]&&hd(l[2][2].date,l[0])),e?s?(s.p(l,c),c[0]&5&&ci(s,1)):(s=mie(l),s.c(),ci(s,1),s.m(i.parentNode,i)):s&&(no(),Oi(s,1,1,()=>{s=null}),ao()),c[0]&5&&(r=l[2][0]&&hd(l[2][0].date,l[0])),r?o?(o.p(l,c),c[0]&5&&ci(o,1)):(o=gie(l),o.c(),ci(o,1),o.m(n.parentNode,n)):o&&(no(),Oi(o,1,1,()=>{o=null}),ao())},i(l){a||(ci(s),ci(o),a=!0)},o(l){Oi(s),Oi(o),a=!1},d(l){l&&(Mr(i),Mr(n)),s&&s.d(l),o&&o.d(l)}}}function mie(t){let e,i,r,n;return i=new lM({props:{chunk:t[2][2]}}),{c(){e=Vr("div"),ts(i.$$.fragment),bt(e,"class",r=t[17].events)},m(a,s){Br(a,e,s),ka(i,e,null),n=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][2]),i.$set(o),(!n||s[0]&131072&&r!==(r=a[17].events))&&bt(e,"class",r)},i(a){n||(ci(i.$$.fragment,a),n=!0)},o(a){Oi(i.$$.fragment,a),n=!1},d(a){a&&Mr(e),Oa(i)}}}function gie(t){let e,i,r,n;return i=new lM({props:{chunk:t[2][0]}}),{c(){e=Vr("div"),ts(i.$$.fragment),bt(e,"class",r=t[17].events+" "+t[17].preview)},m(a,s){Br(a,e,s),ka(i,e,null),n=!0},p(a,s){const o={};s[0]&4&&(o.chunk=a[2][0]),i.$set(o),(!n||s[0]&131072&&r!==(r=a[17].events+" "+a[17].preview))&&bt(e,"class",r)},i(a){n||(ci(i.$$.fragment,a),n=!0)},o(a){Oi(i.$$.fragment,a),n=!1},d(a){a&&Mr(e),Oa(i)}}}function vie(t){let e=[],i=new Map,r,n,a=Io(t[5]);const s=o=>o[54].event;for(let o=0;o<a.length;o+=1){let l=cie(t,a,o),c=s(l);i.set(c,e[o]=yie(c,l))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();r=_d()},m(o,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(o,l);Br(o,r,l),n=!0},p(o,l){l[0]&65578&&(a=Io(o[5]),no(),e=X9(e,l,s,1,o,a,i,r.parentNode,Z9,yie,r,cie),ao())},i(o){if(!n){for(let l=0;l<a.length;l+=1)ci(e[l]);n=!0}},o(o){for(let l=0;l<e.length;l+=1)Oi(e[l]);n=!1},d(o){o&&Mr(r);for(let l=0;l<e.length;l+=1)e[l].d(o)}}}function yie(t,e){let i,r,n=e[56],a;const s=()=>e[49](r,n),o=()=>e[49](null,n);let l={chunk:e[54],longChunks:e[1],dates:e[3]};return r=new lM({props:l}),s(),{key:t,first:null,c(){i=_d(),ts(r.$$.fragment),this.first=i},m(c,u){Br(c,i,u),ka(r,c,u),a=!0},p(c,u){e=c,n!==e[56]&&(o(),n=e[56],s());const d={};u[0]&32&&(d.chunk=e[54]),u[0]&2&&(d.longChunks=e[1]),u[0]&8&&(d.dates=e[3]),r.$set(d)},i(c){a||(ci(r.$$.fragment,c),a=!0)},o(c){Oi(r.$$.fragment,c),a=!1},d(c){c&&Mr(i),o(),Oa(r,c)}}}function bie(t){let e,i;return e=new Gyt({}),{c(){ts(e.$$.fragment)},m(r,n){ka(e,r,n),i=!0},i(r){i||(ci(e.$$.fragment,r),i=!0)},o(r){Oi(e.$$.fragment,r),i=!1},d(r){Oa(e,r)}}}function Iie(t){let e,i,r,n;return{c(){e=Vr("a"),bt(e,"role","button"),bt(e,"tabindex","0"),bt(e,"aria-haspopup","true")},m(a,s){Br(a,e,s),r||(n=[xn(e,"click",vk(t[34])),xn(e,"keydown",yk(t[34])),xn(e,"pointerdown",vk(t[48])),Ng(i=ab.call(null,e,t[14]))],r=!0)},p(a,s){i&&Qa(i.update)&&s[0]&16384&&i.update.call(null,a[14])},d(a){a&&Mr(e),r=!1,rd(n)}}}function Hyt(t){let e,i,r,n,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,w,T,S=t[9]&&die(t),D=!t[6]&&pie(t),C=!t[6]&&fie(t),E=!t[6]&&vie(t),P=t[8]&&bie(),R=!t[6]&&t[7].size&&Iie(t);return{c(){e=Vr("div"),i=Vr("div"),r=Vr("time"),s=Xo(),S&&S.c(),l=Xo(),c=Vr("div"),D&&D.c(),d=Xo(),C&&C.c(),p=Xo(),h=Vr("div"),E&&E.c(),m=Xo(),P&&P.c(),g=Xo(),v=Vr("div"),R&&R.c(),bt(r,"datetime",n=dp(t[0],10)),bt(i,"class",o=t[17].dayHead),bt(c,"class",u=t[17].bgEvents),bt(h,"class",f=t[17].events),bt(v,"class",y=t[17].dayFoot),bt(e,"class",b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")),bt(e,"role","cell")},m(M,A){Br(M,e,A),bn(e,i),bn(i,r),bn(i,s),S&&S.m(i,null),bn(e,l),bn(e,c),D&&D.m(c,null),bn(e,d),C&&C.m(e,null),bn(e,p),bn(e,h),E&&E.m(h,null),bn(e,m),P&&P.m(e,null),bn(e,g),bn(e,v),R&&R.m(v,null),t[50](e),I=!0,w||(T=[Ng(a=ab.call(null,r,t[19].format(t[0]))),xn(e,"pointerdown",function(){Qa(t[18].action?.select)&&t[18].action?.select.apply(this,arguments)})],w=!0)},p(M,A){t=M,(!I||A[0]&1&&n!==(n=dp(t[0],10)))&&bt(r,"datetime",n),a&&Qa(a.update)&&A[0]&524289&&a.update.call(null,t[19].format(t[0])),t[9]?S?S.p(t,A):(S=die(t),S.c(),S.m(i,null)):S&&(S.d(1),S=null),(!I||A[0]&131072&&o!==(o=t[17].dayHead))&&bt(i,"class",o),t[6]?D&&(no(),Oi(D,1,1,()=>{D=null}),ao()):D?(D.p(t,A),A[0]&64&&ci(D,1)):(D=pie(t),D.c(),ci(D,1),D.m(c,null)),(!I||A[0]&131072&&u!==(u=t[17].bgEvents))&&bt(c,"class",u),t[6]?C&&(no(),Oi(C,1,1,()=>{C=null}),ao()):C?(C.p(t,A),A[0]&64&&ci(C,1)):(C=fie(t),C.c(),ci(C,1),C.m(e,p)),t[6]?E&&(no(),Oi(E,1,1,()=>{E=null}),ao()):E?(E.p(t,A),A[0]&64&&ci(E,1)):(E=vie(t),E.c(),ci(E,1),E.m(h,null)),(!I||A[0]&131072&&f!==(f=t[17].events))&&bt(h,"class",f),t[8]?P?A[0]&256&&ci(P,1):(P=bie(),P.c(),ci(P,1),P.m(e,g)):P&&(no(),Oi(P,1,1,()=>{P=null}),ao()),!t[6]&&t[7].size?R?R.p(t,A):(R=Iie(t),R.c(),R.m(v,null)):R&&(R.d(1),R=null),(!I||A[0]&131072&&y!==(y=t[17].dayFoot))&&bt(v,"class",y),(!I||A[0]&145473&&b!==(b=t[17].day+" "+t[17].weekdays?.[t[0].getUTCDay()]+(t[11]?" "+t[17].today:"")+(t[12]?" "+t[17].otherMonth:"")+(t[13]?" "+t[17].highlight:"")+(t[6]?" "+t[17].disabled:"")))&&bt(e,"class",b)},i(M){I||(ci(D),ci(C),ci(E),ci(P),I=!0)},o(M){Oi(D),Oi(C),Oi(E),Oi(P),I=!1},d(M){M&&Mr(e),S&&S.d(),D&&D.d(),C&&C.d(),E&&E.d(),P&&P.d(),R&&R.d(),t[50](null),w=!1,rd(T)}}}function zyt(t,e,i){let r,n,a,s,o,l,c,u,d,p,h,f,m,g,{date:v}=e,{chunks:y}=e,{bgChunks:b}=e,{longChunks:I}=e,{iChunks:w=[]}=e,{dates:T}=e,{date:S,dayMaxEvents:D,highlightedDates:C,firstDay:E,moreLinkContent:P,theme:R,validRange:M,weekNumbers:A,weekNumberContent:N,_hiddenEvents:k,_intlDayCell:x,_popupDate:O,_popupChunks:V,_today:F,_interaction:j}=kd("state");Je(t,S,ze=>i(46,p=ze)),Je(t,C,ze=>i(45,d=ze)),Je(t,E,ze=>i(39,n=ze)),Je(t,P,ze=>i(42,l=ze)),Je(t,R,ze=>i(17,f=ze)),Je(t,M,ze=>i(44,u=ze)),Je(t,A,ze=>i(40,a=ze)),Je(t,N,ze=>i(38,r=ze)),Je(t,k,ze=>i(43,c=ze)),Je(t,x,ze=>i(19,g=ze)),Je(t,O,ze=>i(41,o=ze)),Je(t,V,ze=>i(51,s=ze)),Je(t,F,ze=>i(47,h=ze)),Je(t,j,ze=>i(18,m=ze));let q,W,z,H,Z,J,ie,K=new Set,ne="",le,re,me,he=[];function Ie(){an(O,o=v,o)}function Le(){let ze=pm(sn(v)),Ct=W.concat(I[v.getTime()]?.chunks||[]);an(V,s=Ct.map(ke=>Ty({},ke,VG(ke.event,v,ze),{days:1,dates:[v]})).sort((ke,mt)=>ke.top-mt.top),s)}function ot(){ie||KCe(he,W)}function at(ze){D2.call(this,t,ze)}function dt(ze,Ct){dm[ze?"unshift":"push"](()=>{he[Ct]=ze,i(16,he)})}function It(ze){dm[ze?"unshift":"push"](()=>{q=ze,i(4,q)})}return t.$$set=ze=>{"date"in ze&&i(0,v=ze.date),"chunks"in ze&&i(35,y=ze.chunks),"bgChunks"in ze&&i(36,b=ze.bgChunks),"longChunks"in ze&&i(1,I=ze.longChunks),"iChunks"in ze&&i(2,w=ze.iChunks),"dates"in ze&&i(3,T=ze.dates)},t.$$.update=()=>{if(t.$$.dirty[0]&1|t.$$.dirty[1]&8192&&i(6,ie=ZCe(v,u)),t.$$.dirty[0]&225|t.$$.dirty[1]&48&&!ie){i(5,W=[]),i(10,z=b.filter(ze=>hd(ze.date,v))),K.clear(),i(7,K),i(6,ie),i(36,b),i(0,v),i(35,y),i(5,W),i(44,u);for(let ze of y)hd(ze.date,v)&&W.push(ze)}if(t.$$.dirty[0]&129&&an(k,c[v.getTime()]=K,c),t.$$.dirty[0]&1|t.$$.dirty[1]&65536&&i(11,H=hd(v,h)),t.$$.dirty[0]&1|t.$$.dirty[1]&32768&&i(12,Z=v.getUTCMonth()!==p.getUTCMonth()),t.$$.dirty[0]&1|t.$$.dirty[1]&16384&&i(13,J=d.some(ze=>hd(ze,v))),t.$$.dirty[0]&192|t.$$.dirty[1]&6144&&!ie&&c&&K.size){let ze="+"+K.size+" more";l?i(14,ne=cs(l)?l({num:K.size,text:ze}):l):i(14,ne=ze)}if(t.$$.dirty[0]&1|t.$$.dirty[1]&1024&&i(8,le=o&&hd(v,o)),t.$$.dirty[0]&290&&le&&I&&W&&oM().then(Le),t.$$.dirty[0]&81&&q&&qCe(q,()=>({allDay:!0,date:v,resource:void 0,dayEl:q,disabled:ie})),t.$$.dirty[0]&513|t.$$.dirty[1]&896&&(i(9,re=a&&v.getUTCDay()==(n?1:0)),re)){let ze=Cvt(v,n);r?i(15,me=cs(r)?r({date:Ql(v),week:ze}):r):i(15,me="W"+String(ze).padStart(2,"0"))}},[v,I,w,T,q,W,ie,K,le,re,z,H,Z,J,ne,me,he,f,m,g,S,C,E,P,R,M,A,N,k,x,O,V,F,j,Ie,y,b,ot,r,n,a,o,l,c,u,d,p,h,at,dt,It]}class qyt extends su{constructor(e){super(),au(this,e,zyt,Hyt,Ic,{date:0,chunks:35,bgChunks:36,longChunks:1,iChunks:2,dates:3,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}}function wie(t,e,i){const r=t.slice();return r[28]=e[i],r[29]=e,r[30]=i,r}function Sie(t){let e,i=t[30],r;const n=()=>t[25](e,i),a=()=>t[25](null,i);let s={date:t[28],chunks:t[1],bgChunks:t[2],longChunks:t[3],iChunks:t[4],dates:t[0]};return e=new qyt({props:s}),n(),{c(){ts(e.$$.fragment)},m(o,l){ka(e,o,l),r=!0},p(o,l){i!==o[30]&&(a(),i=o[30],n());const c={};l&1&&(c.date=o[28]),l&2&&(c.chunks=o[1]),l&4&&(c.bgChunks=o[2]),l&8&&(c.longChunks=o[3]),l&16&&(c.iChunks=o[4]),l&1&&(c.dates=o[0]),e.$set(c)},i(o){r||(ci(e.$$.fragment,o),r=!0)},o(o){Oi(e.$$.fragment,o),r=!1},d(o){a(),Oa(e,o)}}}function Wyt(t){let e,i,r,n,a,s=Io(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=Sie(wie(t,s,c));const l=c=>Oi(o[c],1,1,()=>{o[c]=null});return{c(){e=Vr("div");for(let c=0;c<o.length;c+=1)o[c].c();bt(e,"class",i=t[6].days),bt(e,"role","row")},m(c,u){Br(c,e,u);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(e,null);r=!0,n||(a=xn(window,"resize",t[15]),n=!0)},p(c,[u]){if(u&63){s=Io(c[0]);let d;for(d=0;d<s.length;d+=1){const p=wie(c,s,d);o[d]?(o[d].p(p,u),ci(o[d],1)):(o[d]=Sie(p),o[d].c(),ci(o[d],1),o[d].m(e,null))}for(no(),d=s.length;d<o.length;d+=1)l(d);ao()}(!r||u&64&&i!==(i=c[6].days))&&bt(e,"class",i)},i(c){if(!r){for(let u=0;u<s.length;u+=1)ci(o[u]);r=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Oi(o[u]);r=!1},d(c){c&&Mr(e),tS(o,c),n=!1,a()}}}function Yyt(t,e,i){let r,n,a,s,o,l,c,u,{dates:d}=e,{_events:p,_iEvents:h,_queue2:f,_hiddenEvents:m,resources:g,filterEventsWithResources:v,hiddenDays:y,theme:b,validRange:I}=kd("state");Je(t,p,N=>i(23,l=N)),Je(t,h,N=>i(20,a=N)),Je(t,m,N=>i(18,r=N)),Je(t,g,N=>i(21,s=N)),Je(t,v,N=>i(22,o=N)),Je(t,y,N=>i(19,n=N)),Je(t,b,N=>i(6,u=N)),Je(t,I,N=>i(24,c=N));let w,T,S,D=[],C,E,P=[],R={};function M(){Q9(()=>KCe(P,d),R,f)}function A(N,k){dm[N?"unshift":"push"](()=>{P[k]=N,i(5,P)})}return t.$$set=N=>{"dates"in N&&i(0,d=N.dates)},t.$$.update=()=>{if(t.$$.dirty&16777217&&(i(16,C=Yte(d[0],c)),i(17,E=pm(sn(Yte(d.at(-1),c))))),t.$$.dirty&15400966){i(1,w=[]),i(2,T=[]);for(let N of l)if(Wte(N,C,E,o?s:void 0)){let k=VG(N,C,E);t1(N.display)?N.allDay&&T.push(k):w.push(k)}_$(T,n),i(3,S=_$(w,n)),M()}t.$$.dirty&1769472&&i(4,D=a.map(N=>{let k;return N&&Wte(N,C,E)?(k=VG(N,C,E),_$([k],n)):k=null,k})),t.$$.dirty&262144&&r&&oM().then(M)},[d,w,T,S,D,P,u,p,h,m,g,v,y,b,I,M,C,E,r,n,a,s,o,l,c,A]}class Kyt extends su{constructor(e){super(),au(this,e,Yyt,Wyt,Ic,{dates:0})}}function Tie(t,e,i){const r=t.slice();return r[15]=e[i],r}function Uie(t){let e,i;return e=new Kyt({props:{dates:t[15]}}),{c(){ts(e.$$.fragment)},m(r,n){ka(e,r,n),i=!0},p(r,n){const a={};n&1&&(a.dates=r[15]),e.$set(a)},i(r){i||(ci(e.$$.fragment,r),i=!0)},o(r){Oi(e.$$.fragment,r),i=!1},d(r){Oa(e,r)}}}function Zyt(t){let e,i,r,n,a,s=Io(t[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=Uie(Tie(t,s,c));const l=c=>Oi(o[c],1,1,()=>{o[c]=null});return{c(){e=Vr("div"),i=Vr("div");for(let c=0;c<o.length;c+=1)o[c].c();bt(i,"class",r=t[2].content),bt(e,"class",n=t[2].body+(t[1]===!0?" "+t[2].uniform:""))},m(c,u){Br(c,e,u),bn(e,i);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(i,null);t[13](e),a=!0},p(c,[u]){if(u&1){s=Io(c[0]);let d;for(d=0;d<s.length;d+=1){const p=Tie(c,s,d);o[d]?(o[d].p(p,u),ci(o[d],1)):(o[d]=Uie(p),o[d].c(),ci(o[d],1),o[d].m(i,null))}for(no(),d=s.length;d<o.length;d+=1)l(d);ao()}(!a||u&4&&r!==(r=c[2].content))&&bt(i,"class",r),(!a||u&6&&n!==(n=c[2].body+(c[1]===!0?" "+c[2].uniform:"")))&&bt(e,"class",n)},i(c){if(!a){for(let u=0;u<s.length;u+=1)ci(o[u]);a=!0}},o(c){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)Oi(o[u]);a=!1},d(c){c&&Mr(e),tS(o,c),t[13](null)}}}function Xyt(t,e,i){let r,n,a,s,o,l,{_bodyEl:c,_viewDates:u,_hiddenEvents:d,dayMaxEvents:p,hiddenDays:h,theme:f}=kd("state");Je(t,c,y=>i(3,l=y)),Je(t,u,y=>i(11,r=y)),Je(t,d,y=>i(14,a=y)),Je(t,p,y=>i(1,n=y)),Je(t,h,y=>i(12,s=y)),Je(t,f,y=>i(2,o=y));let m,g;function v(y){dm[y?"unshift":"push"](()=>{l=y,c.set(l)})}return t.$$.update=()=>{if(t.$$.dirty&7171){i(0,m=[]),i(10,g=7-s.length),an(d,a={},a);for(let y=0;y<r.length/g;++y){let b=[];for(let I=0;I<g;++I)b.push(r[y*g+I]);m.push(b)}}},[m,n,o,l,c,u,d,p,h,f,g,r,s,v]}class Jyt extends su{constructor(e){super(),au(this,e,Xyt,Zyt,Ic,{})}}function Qyt(t){let e,i,r,n;return e=new Fyt({}),r=new Jyt({}),{c(){ts(e.$$.fragment),i=Xo(),ts(r.$$.fragment)},m(a,s){ka(e,a,s),Br(a,i,s),ka(r,a,s),n=!0},p:es,i(a){n||(ci(e.$$.fragment,a),ci(r.$$.fragment,a),n=!0)},o(a){Oi(e.$$.fragment,a),Oi(r.$$.fragment,a),n=!1},d(a){a&&Mr(i),Oa(e,a),Oa(r,a)}}}class ebt extends su{constructor(e){super(),au(this,e,null,Qyt,Ic,{})}}var tbt={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.theme.weekNumber="ec-week-number",t.view="dayGridMonth",t.weekNumbers=!1,t.weekNumberContent=void 0,t.views.dayGridMonth={buttonText:qvt,component:ebt,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:Yvt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=Oyt(t),t._intlDayCell=TP(t.locale,t.dayCellFormat),t._intlDayPopover=TP(t.locale,t.dayPopoverFormat),t._hiddenEvents=Yo({}),t._popupDate=Yo(null),t._popupChunks=Yo([])}};let k$=!1;function ibt(t){k$||(k$=!0,window.requestAnimationFrame(()=>{t(),k$=!1}))}function Die(t,e,i){return Db(e,GS(i,t))}const{window:fv}=yvt;function rbt(t){let e,i;return{c:es,m(r,n){e||(i=[xn(fv,"pointermove",t[37]),xn(fv,"pointerup",t[38]),xn(fv,"pointercancel",t[38]),xn(fv,"scroll",t[0]),xn(fv,"selectstart",oA(t[39])),xn(fv,"contextmenu",function(){Qa(oA(t[47]))&&oA(t[47]).apply(this,arguments)}),xn(fv,"touchstart",t[40]),xn(fv,"touchmove",t[46],{passive:!1})],e=!0)},p(r,n){t=r},i:es,o:es,d(r){e=!1,rd(i)}}}const Eie=1,Pie=2,Cie=3,Rie=4,O$=5,lN=6;function UE(t,e){return t.start=e.start,t.end=e.end,t.resourceIds=e.resourceIds,t}function Mie(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function oA(t){return e=>{t()&&e.preventDefault()}}function nbt(t,e,i){let r,n,a,s,o,l,c,u,d,p,h,f,m,g,v,y,b,I,w,T,S,D,C,E,P,R,M,A,N,k,x,O,V,F,j,{_iEvents:q,_iClass:W,_events:z,_view:H,_dayGrid:Z,_draggable:J,_bodyEl:ie,datesAboveResources:K,dateClick:ne,dragConstraint:le,dragScroll:re,eventDragMinDistance:me,eventDragStart:he,eventDragStop:Ie,eventDrop:Le,eventLongPressDelay:ot,eventResizeStart:at,eventResizeStop:dt,eventResize:It,longPressDelay:ze,resizeConstraint:Ct,selectable:ke,select:mt,selectBackgroundColor:Be,selectConstraint:ut,selectLongPressDelay:it,selectMinDistance:xe,slotDuration:Ze,slotHeight:st,slotWidth:qe,unselect:ft,unselectAuto:_t,unselectCancel:ve,validRange:$e,view:De}=kd("state");Je(t,q,Xe=>i(77,s=Xe)),Je(t,W,Xe=>i(82,d=Xe)),Je(t,z,Xe=>i(76,a=Xe)),Je(t,H,Xe=>i(74,r=Xe)),Je(t,Z,Xe=>i(79,l=Xe)),Je(t,J,Xe=>i(108,j=Xe)),Je(t,ie,Xe=>i(105,O=Xe)),Je(t,K,Xe=>i(104,x=Xe)),Je(t,ne,Xe=>i(83,p=Xe)),Je(t,le,Xe=>i(94,S=Xe)),Je(t,re,Xe=>i(93,T=Xe)),Je(t,me,Xe=>i(99,R=Xe)),Je(t,he,Xe=>i(97,E=Xe)),Je(t,Ie,Xe=>i(86,m=Xe)),Je(t,Le,Xe=>i(84,h=Xe)),Je(t,ot,Xe=>i(102,N=Xe)),Je(t,at,Xe=>i(98,P=Xe)),Je(t,dt,Xe=>i(87,g=Xe)),Je(t,It,Xe=>i(85,f=Xe)),Je(t,ze,Xe=>i(101,A=Xe)),Je(t,Ct,Xe=>i(96,C=Xe)),Je(t,ke,Xe=>i(107,F=Xe)),Je(t,mt,Xe=>i(88,v=Xe)),Je(t,Be,Xe=>i(78,o=Xe)),Je(t,ut,Xe=>i(95,D=Xe)),Je(t,it,Xe=>i(103,k=Xe)),Je(t,xe,Xe=>i(100,M=Xe)),Je(t,Ze,Xe=>i(106,V=Xe)),Je(t,st,Xe=>i(92,w=Xe)),Je(t,qe,Xe=>i(91,I=Xe)),Je(t,ft,Xe=>i(75,n=Xe)),Je(t,_t,Xe=>i(90,b=Xe)),Je(t,ve,Xe=>i(89,y=Xe)),Je(t,$e,Xe=>i(81,u=Xe)),Je(t,De,Xe=>i(80,c=Xe));let je,Oe,nt,Fe,wt,pt,Mt,Wi,Qt,tr,Vi,$i,Wr,Yn,$l,tn,rn,ha,Jt,sr,Vl,nd,Uo,Hs,zs,yn,wc;function jl(Xe,di,Ri,Mi,mn,Ma){je||(je=Mie(di)?Ri?Ri[1]=="start"?Cie:Pie:j(Xe)?Eie:lN:lN,ki()&&(nt=Xe,jp(di),Mi&&(wt=Mi),mn&&(yn=mn),Jt=Ri?Ri[0]=="x"?"resizingX":"resizingY":"dragging",Ri&&(ns()?(sr=sn(nt.end),ha?(LG(sr,nt.start),sr>=nt.end&&OI(sr)):(aA(sr,V),sr<nt.start&&(sr=nt.start),wt=nt.start)):(sr=sn(nt.start),ha?(LG(sr,nt.end),sr<=nt.start&&!Ma&&pm(sr)):(qd(sr,V),sr>nt.end&&(sr=nt.end),wt=nt.end,Ma||(wt=aA(sn(wt),V)))),Ma&&!ha&&(wc=V)),fa(di)))}function cf(Xe){je||(je=Mie(Xe)?F&&!$G(c)?Rie:O$:lN,ki()&&(jp(Xe),Jt="selecting",Vl=ha?Zd({day:1}):V,nt={allDay:ha,start:wt,end:qd(sn(wt),Vl),resourceIds:Mt?[Mt.id]:[]},fa(Xe)))}function Sc(){je||(je=lN)}function jp(Xe){window.getSelection().removeAllRanges(),Qt=Vi=Xe.clientX,tr=$i=Xe.clientY;let di=fT(Vi,$i);({allDay:ha,date:wt,resource:Mt}=SP(di)(Vi,$i)),M$(c)?Wr=$l=O:(Wr=EU(di,Mt?4:3),$l=EU(di,Mt&&(Mn()||x)?2:1)),Hl(),Xe.pointerType!=="mouse"&&i(1,Hs=setTimeout(()=>{je&&(Oe=!0,fa(Xe))},(Ts()?k:N)??A))}function fa(Xe){if(Oe||Xe&&Xe.pointerType==="mouse"&&Kt()>=(Ts()?M:R)){Oe=!0,fn(Xe),an(W,d=Jt,d),s[0]||(Ts()?zl():Od(Xe,ul()?P:E));let di=Gl(uf());if(di){let Ri;if({allDay:Ri,date:pt,resource:Wi}=di,Ri===ha){let Mi=UE({},s[0]),mn=C;rn=Zd((pt-wt)/1e3),ns()?(Mi.start=qd(sn(nt.start),rn),Mi.start>sr&&(Mi.start=sr,rn=Zd((sr-nt.start)/1e3))):(Mi.end=qd(sn(nt.end),rn),wc&&qd(Mi.end,wc),ul()?Mi.end<sr&&(Mi.end=sr,rn=Zd((sr-nt.end)/1e3)):Ts()?(Mi.end<nt.end?(Mi.start=aA(Mi.end,Vl),Mi.end=nt.end):Mi.start=nt.start,mn=D):(Mi.start=qd(sn(nt.start),rn),Mt&&(Mi.resourceIds=nt.resourceIds.filter(Ma=>Ma!==Mt.id),Mi.resourceIds.push(Wi.id)),mn=S));do{if(mn!==void 0&&(Mi=UE(A$(nt),Mi),mn(Ts()?lu(Mi,Xe):Tc(Mi,nt,Xe))===!1)){an(q,s[0]=UE(s[0],nt),s);break}an(q,s[0]=UE(s[0],Mi),s)}while(!1)}}}if(T){let di=w*2,Ri=I;ibt(()=>{Wr&&($i<di&&window.scrollBy(0,Db(-10,($i-di)/3)),$i<Yn.top+di&&(Wr.scrollTop+=Db(-10,($i-Yn.top-di)/3)),$i>window.innerHeight-di&&window.scrollBy(0,GS(10,($i-window.innerHeight+di)/3)),$i>Yn.bottom-di&&(Wr.scrollTop+=GS(10,($i-Yn.bottom+di)/3)),M$(c)&&(Vi<Yn.left+Ri&&(Wr.scrollLeft+=Db(-10,(Vi-Yn.left-Ri)/3)),Vi>Yn.right-Ri&&(Wr.scrollLeft+=GS(10,(Vi-Yn.right+Ri)/3))))})}}function $n(){ki()&&(Hl(),fa())}function $o(Xe){ki()&&Xe.isPrimary&&(Vi=Xe.clientX,$i=Xe.clientY,fa(Xe))}function cl(Xe){if(nd&&b&&!(y&&Xe.target.closest(y))&&fn(Xe),je&&Xe.isPrimary){if(Oe)if(Ts()){if(nd=!0,cs(v)){let di=lu(s[0],Xe);v(di)}}else{nt.display=Fe;let di=ul()?g:m;cs(di)&&di({event:fd(nt),jsEvent:Xe,view:cd(r)});let Ri=A$(nt);if(ou(nt,s[0]),ma(),di=ul()?f:h,cs(di)){let Mi=nt,mn=Tc(nt,Ri,Xe);di(Ty(mn,{revert(){ou(Mi,Ri)}}))}}else if((to()||Ts())&&cs(p)&&!Uo){Vi=Xe.clientX,$i=Xe.clientY;let di=fT(Vi,$i);if(di){let{allDay:Ri,date:Mi,resource:mn}=SP(di)(Vi,$i);p({allDay:Ri,date:Ql(Mi),dateStr:dp(Mi),dayEl:di,jsEvent:Xe,view:cd(r),resource:mn})}}Oe=!1,je=Qt=tr=Vi=$i=nt=Fe=wt=pt=Mt=Wi=rn=wc=ha=an(W,d=sr=Vl=yn=void 0,d),Wr=$l=Yn=tn=void 0,Hs&&(clearTimeout(Hs),i(1,Hs=void 0))}Uo=!1}function uf(){return fT(Die(Vi,zs[0],zs[1]),Die($i,zs[2],zs[3]))}function Gl(Xe){if(Xe){let di=SP(Xe)(Vi,$i);if(di.disabled){if(!u.end||di.date<u.end)return Gl(Xe.nextElementSibling);if(!u.start||di.date>u.start)return Gl(Xe.previousElementSibling)}else return di}return null}function Hl(){Yn=qv(Wr),tn=qv($l),zs=[Db(0,tn.left+(M$(c)?1:l?0:8)),GS(document.documentElement.clientWidth,tn.left+$l.clientWidth)-2,Db(0,Yn.top),GS(document.documentElement.clientHeight,Yn.top+Wr.clientHeight)-2]}function Od(Xe,di){cs(di)&&di({event:fd(nt),jsEvent:Xe,view:cd(r)}),Fe=nt.display,nt.display="preview",an(q,s[0]=A$(nt),s),yn!==void 0&&an(q,s[0]._margin=yn,s),wc&&qd(s[0].end,wc),nt.display="ghost",z.set(a)}function zl(){an(q,s[0]={id:"{select}",allDay:nt.allDay,start:nt.start,title:"",display:"preview",extendedProps:{},backgroundColor:o,resourceIds:nt.resourceIds,classNames:[],styles:[]},s)}function ma(){an(q,s[0]=null,s)}function ou(Xe,di){UE(Xe,di),z.set(a)}function lu(Xe,di){let{start:Ri,end:Mi}=fd(Xe);return{start:Ri,end:Mi,startStr:dp(Xe.start),endStr:dp(Xe.end),allDay:ha,view:cd(r),resource:Mt,jsEvent:di}}function Tc(Xe,di,Ri){let Mi;return ul()?Mi=ns()?{startDelta:rn,endDelta:Zd(0)}:{startDelta:Zd(0),endDelta:rn}:Mi={delta:rn,oldResource:Mt!==Wi?Mt:void 0,newResource:Mt!==Wi?Wi:void 0},Ty(Mi,{event:fd(Xe),oldEvent:fd(di),view:cd(r),jsEvent:Ri}),Mi}function Kt(){return Math.sqrt(Math.pow(Vi-Qt,2)+Math.pow($i-tr,2))}function Mn(){return je===Eie}function ul(){return je===Pie||ns()}function ns(){return je===Cie}function to(){return je===O$}function Ts(){return je===Rie}function ki(){return je&&je<O$}function fn(Xe){nd&&(nd=!1,ma(),cs(n)&&n({jsEvent:Xe,view:cd(r)}))}function Zr(){Uo=!0}H.subscribe(fn);function ql(Xe){if(ki()){let di=Xe.target,Ri=[],Mi=()=>HCe(Ri);Ri.push(sA(di,"touchmove",oA(()=>Oe))),Ri.push(sA(di,"touchend",Mi)),Ri.push(sA(di,"touchcancel",Mi))}}function Ya(Xe){D2.call(this,t,Xe)}return[$n,Hs,q,W,z,H,Z,J,ie,K,ne,le,re,me,he,Ie,Le,ot,at,dt,It,ze,Ct,ke,mt,Be,ut,it,xe,Ze,st,qe,ft,_t,ve,$e,De,$o,cl,ki,ql,jl,cf,Sc,fn,Zr,Ya,()=>Hs]}class abt extends su{constructor(e){super(),au(this,e,nbt,rbt,Ic,{drag:41,select:42,noAction:43,handleScroll:0,unselect:44,noClick:45},null,[-1,-1,-1,-1,-1])}get drag(){return this.$$.ctx[41]}get select(){return this.$$.ctx[42]}get noAction(){return this.$$.ctx[43]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[44]}get noClick(){return this.$$.ctx[45]}}function sbt(t){let e,i;return{c:es,m(r,n){e||(i=[xn(window,"pointermove",t[3]),xn(window,"scroll",t[0])],e=!0)},p:es,i:es,o:es,d(r){e=!1,rd(i)}}}function obt(t){return t.isPrimary&&t.pointerType==="mouse"}function lbt(t,e,i){let r,n,{_iEvents:a,slotDuration:s}=kd("state");Je(t,a,f=>i(4,r=f)),Je(t,s,f=>i(7,n=f));let o=0,l=0;function c(){let f=fT(o,l);if(f){let{allDay:m,date:g,resource:v,disabled:y}=SP(f)(o,l);if(!y){let b=m?2:1;r[b]||p(b),an(a,r[b].start=g,r),an(a,r[b].end=qd(sn(g),n),r),an(a,r[b].resourceIds=v?[v.id]:[],r);return}}h()}function u(){c()}function d(f){obt(f)&&(o=f.clientX,l=f.clientY,c())}function p(f){an(a,r[f]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent",classNames:[],styles:[]},r)}function h(){r[1]&&an(a,r[1]=null,r),r[2]&&an(a,r[2]=null,r)}return t.$$.update=()=>{t.$$.dirty&16&&r[0]&&h()},[u,a,s,d,r]}class cbt extends su{constructor(e){super(),au(this,e,lbt,sbt,Ic,{handleScroll:0})}get handleScroll(){return this.$$.ctx[0]}}function Nie(t){let e,i,r,n;return{c(){e=Vr("div"),bt(e,"class",i=t[2].resizer+(t[0]?" "+t[2].start:""))},m(a,s){Br(a,e,s),r||(n=xn(e,"pointerdown",t[11]),r=!0)},p(a,s){s&5&&i!==(i=a[2].resizer+(a[0]?" "+a[2].start:""))&&bt(e,"class",i)},d(a){a&&Mr(e),r=!1,n()}}}function ubt(t){let e,i=t[1]&&Nie(t);return{c(){i&&i.c(),e=_d()},m(r,n){i&&i.m(r,n),Br(r,e,n)},p(r,[n]){r[1]?i?i.p(r,n):(i=Nie(r),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:es,o:es,d(r){r&&Mr(e),i&&i.d(r)}}}function dbt(t,e,i){let r,n,a,s,{event:o}=e,{start:l=!1}=e,{theme:c,eventDurationEditable:u,eventResizableFromStart:d,editable:p}=kd("state");Je(t,c,m=>i(2,s=m)),Je(t,u,m=>i(9,n=m)),Je(t,d,m=>i(10,a=m)),Je(t,p,m=>i(8,r=m));let h;function f(m){D2.call(this,t,m)}return t.$$set=m=>{"event"in m&&i(7,o=m.event),"start"in m&&i(0,l=m.start)},t.$$.update=()=>{t.$$.dirty&1921&&i(1,h=!t1(o.display)&&!PU(o.display)&&(!l||a)&&((o.durationEditable??n)||(o.editable??r)))},[l,h,s,c,u,d,p,o,r,n,a,f]}class pbt extends su{constructor(e){super(),au(this,e,dbt,ubt,Ic,{event:7,start:0})}}function Aie(t){let e,i,r={};return e=new cbt({props:r}),t[16](e),{c(){ts(e.$$.fragment)},m(n,a){ka(e,n,a),i=!0},p(n,a){const s={};e.$set(s)},i(n){i||(ci(e.$$.fragment,n),i=!0)},o(n){Oi(e.$$.fragment,n),i=!1},d(n){t[16](null),Oa(e,n)}}}function hbt(t){let e,i,r,n,a={};e=new abt({props:a}),t[15](e);let s=t[1]&&Aie(t);return{c(){ts(e.$$.fragment),i=Xo(),s&&s.c(),r=_d()},m(o,l){ka(e,o,l),Br(o,i,l),s&&s.m(o,l),Br(o,r,l),n=!0},p(o,[l]){const c={};e.$set(c),o[1]?s?(s.p(o,l),l&2&&ci(s,1)):(s=Aie(o),s.c(),ci(s,1),s.m(r.parentNode,r)):s&&(no(),Oi(s,1,1,()=>{s=null}),ao())},i(o){n||(ci(e.$$.fragment,o),ci(s),n=!0)},o(o){Oi(e.$$.fragment,o),Oi(s),n=!1},d(o){o&&(Mr(i),Mr(r)),t[15](null),Oa(e,o),s&&s.d(o)}}}function fbt(t,e,i){let r,n,a,s,o,l,c,u,{theme:d,editable:p,eventStartEditable:h,pointer:f,_bodyEl:m,_interaction:g,_iClasses:v,_draggable:y}=kd("state");Je(t,d,T=>i(11,a=T)),Je(t,p,T=>i(13,l=T)),Je(t,h,T=>i(14,c=T)),Je(t,f,T=>i(1,u=T)),Je(t,m,T=>i(10,n=T)),Je(t,g,T=>i(0,r=T)),Je(t,v,T=>i(17,o=T)),Je(t,y,T=>i(12,s=T)),an(g,r.resizer=pbt,r);function b(){for(let T of Object.values(r))T?.handleScroll?.()}function I(T){dm[T?"unshift":"push"](()=>{r.action=T,g.set(r)})}function w(T){dm[T?"unshift":"push"](()=>{r.pointer=T,g.set(r)})}return t.$$.update=()=>{t.$$.dirty&24576&&an(y,s=T=>(T.startEditable??c)||(T.editable??l),s),t.$$.dirty&6144&&an(v,o=(T,S)=>{let{display:D}=S;return PU(D)?[a[D]]:!t1(D)&&s(S)?[a.draggable]:[]},o),t.$$.dirty&1024&&n&&sA(n,"scroll",b)},[r,u,d,p,h,f,m,g,v,y,n,a,s,l,c,I,w]}class mbt extends su{constructor(e){super(),au(this,e,fbt,hbt,Ic,{})}}var gbt={createOptions(t){t.dateClick=void 0,t.dragConstraint=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizableFromStart=!1,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.resizeConstraint=void 0,t.select=void 0,t.selectBackgroundColor=void 0,t.selectConstraint=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.start="ec-start",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=Yo(Avt),t._auxiliary.update(e=>[...e,mbt])}};let lA;function vbt(){const e=zc()?.provider?.organisationId;if(e){const i=r=>{r?.calendar?x$(r.calendar):Oc.findAllTournaments().then(x$)};Oc.findProvider(e).then(i)}else Oc.findAllTournaments().then(x$)}function x$(t){const e=document.getElementById(kx);if(lA&&e&&Xs(e),vgt(),!!e)return lA=new kyt({target:e,props:{plugins:[tbt,gbt],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:bbt(t),eventClick:ybt,eventMouseEnter:Ibt,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...IR,calendar:lA}}function ybt({event:t}){if(t.id){lA.$destroy();const e=t.id;We.reset();const i=`/${Es}/${e}`;ht.router.navigate(i)}}function bbt(t){const e=i=>i?.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function Ibt({event:t,jsEvent:e}){Cg(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var wbt=/([:*])(\w+)/g,Sbt="([^/]+)",Tbt=/\*/g,Ubt="?(?:.*)",Dbt=/\/\?/g,Ebt="/?([^/]+|)",Pbt="(?:/^|^)",Cbt="";function e1e(t){return t===void 0&&(t="/"),iY()?location.pathname+location.search+location.hash:t}function ss(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function Ik(t){return typeof t=="string"}function Rbt(t){return typeof t=="function"}function wk(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function Mbt(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function Sk(t){var e=ss(t).split(/\?(.*)?$/);return[ss(e[0]),e.slice(1).join("")]}function tY(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function t1e(t,e){var i=Sk(ss(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:tY(n),s=[],o;if(Ik(e.path)){if(o=Pbt+ss(e.path).replace(wbt,function(d,p,h){return s.push(h),Sbt}).replace(Tbt,Ubt).replace(Dbt,Ebt)+"$",ss(e.path)===""&&ss(r)==="")return{url:r,queryString:n,hashString:wk(t.to),route:e,data:null,params:a}}else o=e.path;var l=new RegExp(o,Cbt),c=r.match(l);if(c){var u=Ik(e.path)?Mbt(c,s):c.groups?c.groups:c.slice(1);return{url:ss(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:wk(t.to),route:e,data:u,params:a}}return!1}function i1e(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function iS(t,e){return typeof t[e]>"u"||t[e]===!0}function Nbt(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(s){return s.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function iY(){return typeof window<"u"}function Abt(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function Af(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(s){typeof s>"u"||s===!0?(n+=1,a()):i&&i(r)})})()}Af.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function _ie(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=e1e(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function L$(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=t1e(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function _bt(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function kbt(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var kie=iY(),Obt=i1e();function xbt(t,e){if(iS(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=kie&&t.resolveOptions&&t.resolveOptions.hash===!0;Obt?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):kie&&(window.location.href=t.to)}e()}function r1e(t,e){var i=t.instance;if(!i.lastResolved()){e();return}Af(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var s=!1,o=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")s=!o;else{var l=t.matches?t.matches.find(function(c){return r.route.path===c.route.path}):!1;s=!l}if(iS(t.navigateOptions,"callHooks")&&s){Af(r.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function Lbt(t,e){t.match.route.hooks&&t.match.route.hooks.before&&iS(t.navigateOptions,"callHooks")?Af(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(s){s===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function Fbt(t,e){iS(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function Bbt(t,e){t.match.route.hooks&&t.match.route.hooks.after&&iS(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function $bt(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&iS(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function Vbt(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=Sk(t.currentLocationPath),n=r[0],a=r[1],s=wk(t.to);i.path=ss(n);var o={url:i.path,queryString:a,hashString:s,data:null,route:i,params:a!==""?tY(a):null};t.matches=[o],t.match=o}e()}function jbt(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Gbt(t,e){t.instance._setCurrent(null),e()}function n1e(t,e){iS(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var a1e=[$bt,Lbt,Fbt,Bbt],Oie=[r1e,Vbt,Af.if(function(t){var e=t.notFoundHandled;return e},a1e.concat([n1e]),[jbt,Gbt])];function HG(){return HG=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},HG.apply(this,arguments)}function xie(t,e){var i=0;function r(){if(i===t.matches.length){n1e(t,e);return}Af(a1e,HG({},t,{match:t.matches[i]}),function(){i+=1,r()})}r1e(t,r)}function F$(t){t.instance.__markAsClean(t)}function zG(){return zG=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},zG.apply(this,arguments)}var Lie="[data-navigo]";function Hbt(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Lie},r=this,n="/",a=null,s=[],o=!1,l,c=i1e(),u=iY();t?n=ss(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return ss(n+"/"+ss(F))}function h(F,j,q,W){return F=Ik(F)?p(F):F,{name:W||ss(String(F)),path:F,handler:j,hooks:Abt(q)}}function f(F,j,q){var W=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(z){if(typeof F[z]=="function")W.on(z,F[z]);else{var H=F[z],Z=H.uses,J=H.as,ie=H.hooks;s.push(h(z,Z,[l,ie],J))}}),this):(typeof F=="function"&&(q=j,j=F,F=n),s.push(h(F,j,[l,q])),this)}function m(F,j){if(r.__dirty){r.__waiting.push(function(){return r.resolve(F,j)});return}else r.__dirty=!0;F=F?ss(n)+"/"+ss(F):void 0;var q={instance:r,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:zG({},i,j)};return Af([_ie,L$,Af.if(function(W){var z=W.matches;return z&&z.length>0},xie,Oie)],q,F$),q.matches?q.matches:!1}function g(F,j){if(r.__dirty){r.__waiting.push(function(){return r.navigate(F,j)});return}else r.__dirty=!0;F=ss(n)+"/"+ss(F);var q={instance:r,to:F,navigateOptions:j||{},resolveOptions:j&&j.resolveOptions?j.resolveOptions:i,currentLocationPath:d(F)};Af([_bt,kbt,L$,Af.if(function(W){var z=W.matches;return z&&z.length>0},xie,Oie),xbt,F$],q,F$)}function v(F,j,q){var W=P(F,j);return W!==null?(g(W.replace(new RegExp("^/?"+n),""),q),!0):!1}function y(F){return this.routes=s=s.filter(function(j){return Ik(F)?ss(j.path)!==ss(F):Rbt(F)?F!==j.handler:String(j.path)!==String(F)}),this}function b(){c&&(this.__popstateListener=function(){r.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=s=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=o=!0}function w(F,j){return r._notFoundRoute=h("*",F,[l,j],"__NOT_FOUND__"),this}function T(){if(u)return S().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function(j){if((j.ctrlKey||j.metaKey)&&j.target.tagName.toLowerCase()==="a")return!1;var q=F.getAttribute("href");if(typeof q>"u"||q===null)return!1;if(q.match(/^(http|https)/)&&typeof URL<"u")try{var W=new URL(q);q=W.pathname+W.search}catch{}var z=Nbt(F.getAttribute("data-navigo-options"));o||(j.preventDefault(),j.stopPropagation(),r.navigate(ss(q),z))},F.addEventListener("click",F.navigoHandler))}),r}function S(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||Lie)):[]}function D(F){return"/"+n+"/"+ss(F)}function C(F){return l=F,this}function E(){return a}function P(F,j,q){var W=s.find(function(Z){return Z.name===F}),z=null;if(W){if(z=W.path,j)for(var H in j)z=z.replace(":"+H,j[H]);z=z.match(/^\//)?z:"/"+z}return z&&q&&!q.includeRoot&&(z=z.replace(new RegExp("^/"+n),"")),z}function R(F){return F.getAttribute("href")}function M(F){var j=Sk(ss(F)),q=j[0],W=j[1],z=W===""?null:tY(W),H=wk(F),Z=h(q,function(){},[l],q);return{url:q,queryString:W,hashString:H,route:Z,data:null,params:z}}function A(){return M(ss(e1e(n)).replace(new RegExp("^"+n),""))}function N(F){var j={instance:r,currentLocationPath:F,to:F,resolveOptions:i};return L$(j,function(){}),j.matches?j.matches:!1}function k(F,j,q){typeof j<"u"&&(typeof q>"u"||q)&&(j=p(j));var W={instance:r,to:j,currentLocationPath:j};_ie(W,function(){}),typeof F=="string"&&(F=typeof q>"u"||q?p(F):F);var z=t1e(W,{name:String(F),path:F,handler:function(){},hooks:{}});return z||!1}function x(F,j,q){return typeof j=="string"&&(j=O(j)),j?(j.hooks[F]||(j.hooks[F]=[]),j.hooks[F].push(q),function(){j.hooks[F]=j.hooks[F].filter(function(W){return W!==q})}):(console.warn("Route doesn't exists: "+j),function(){})}function O(F){return typeof F=="string"?s.find(function(j){return j.name===p(F)}):s.find(function(j){return j.handler===F})}function V(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=n,this.routes=s,this.destroyed=o,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=V,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=w,this.updatePageLinks=T,this.link=D,this.hooks=C,this.extractGETParameters=function(F){return Sk(d(F))},this.lastResolved=E,this.generate=P,this.getLinkPath=R,this.match=N,this.matchLocation=k,this.getCurrentLocation=A,this.addBeforeHook=x.bind(this,"before"),this.addAfterHook=x.bind(this,"after"),this.addAlreadyHook=x.bind(this,"already"),this.addLeaveHook=x.bind(this,"leave"),this.getRoute=O,this._pathToMatchObject=M,this._clean=ss,this._checkForAHash=d,this._setCurrent=function(F){return a=r.current=F},b.call(this),T.call(this)}function zbt(){const e=new Hbt("/",{hash:!0});ht.router=e;const i=({selectedTab:r,renderDraw:n,data:a})=>{r2(),ygt({config:{selectedTab:r,renderDraw:n,...a}})};return e.on(`/${Es}/:tournamentId`,r=>{i({data:r?.data})}),e.on(`/${Es}/:tournamentId/overview`,r=>{i({data:r?.data,selectedTab:uD})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId`,r=>{i({selectedTab:Qp,data:r?.data})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId/${EE}/:drawId`,r=>{i({selectedTab:Qp,renderDraw:!0,data:r?.data})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId/${EE}/:drawId/${OV}/:roundsView`,r=>{i({selectedTab:Qp,renderDraw:!0,data:r?.data})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId/${EE}/:drawId/${kV}/:structureId`,r=>{i({selectedTab:Qp,renderDraw:!0,data:r?.data})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId/${EE}/:drawId/${kV}/:structureId/${OV}/:roundsView`,r=>{i({selectedTab:Qp,renderDraw:!0,data:r?.data})}),e.on(`/${Es}/:tournamentId/${bb}/:eventId/${Wpe}/:drawId`,r=>{i({selectedTab:Qp,data:r?.data})}),e.on(`/${Es}/:tournamentId/${Jf}/:participantView`,r=>{i({selectedTab:Jf,data:r?.data})}),e.on(`/${Es}/:tournamentId/${oy}/:scheduledDate`,r=>{i({selectedTab:oy,data:r?.data})}),e.on(`/${Es}/:tournamentId/:selectedTab`,r=>{i({data:r?.data})}),e.on(`/${kh}/:uuid`,Bte),e.on(`/${kh}`,Bte),e.on(`/${Ype}/:inviteKey`,mvt),e.on("/calendar",vbt),e.on("/actionKey/:key",r=>{r?.data?.key,e.navigate("/"),E$()}),e.on("/",()=>{E$()}),e.notFound(()=>{e.navigate("/"),E$()}),e.resolve(),{success:!0}}function qbt(){return new Promise((t,e)=>{Xbt();const i=()=>{t()};Ybt().then(i,e)})}const Wbt=t=>(...e)=>PCe()?t(...e):t(...e).catch(i=>console.log(i));function Ybt(){return new Promise((t,e)=>{new Promise((r,n)=>Wbt(Oc.initDB)().then(()=>t(),Kbt).then(r,n)).then(t,e)})}function Kbt(){ht.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function Zbt(t){const e=n=>Object.keys(n).map(a=>n[a]).join(""),i=e(t);ai.messages.reduce((n,a)=>e(a)===i?!0:n,!1)||ai.messages.push(t)}function Xbt(){ht.ee.addListener(kQe,yDe),ht.ee.addListener("addMessage",Zbt)}const Jbt=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href;function B$(){const t=b9();t&&(t.activeScale&&(ai.activeScale=t.activeScale),t.scoringApproach&&(ai.scoringApproach=t.scoringApproach),t.saveLocal!==void 0&&(ai.saveLocal=t.saveLocal)),rIt(),Fgt(),eIt(),R2e(),Nte("login"),Nte("burger"),Ugt("config"),Array.prototype.toSorted||(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),ht.drawer=fvt(),qbt().then(Qbt,e=>console.log({err:e}))}function Qbt(){console.log("%c TMX ready","color: lightgreen"),TCe(),nIt();const t=document.getElementById(iC);t&&(t.onclick=()=>ht.router.navigate(`/${kh}`)),zbt(),Dat()}function eIt(){ht.dragMatch=new Image,ht.dragMatch.src=Jbt,ht.ee=new Lgt}const tIt="ResizeObserver loop limit exceeded",iIt="ResizeObserver loop completed with undelivered notifications.";function rIt(){ai.device=sIt();const t=We.version(),e=CUe();console.log(`%cversion: ${B8}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),console.log(`%ccourthive-components: ${e}`,"color: lightblue"),aIt()}function nIt(){const t=So.topicConstants;tT.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{const i=e.matchUp?.matchUpId;ht.matchUpsToBroadcast.push(i),ai.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function aIt(){window.addEventListener("error",t=>{if([tIt,iIt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function sIt(){const t=oIt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function oIt(){try{return navigator||window.navigator}catch(t){console.log(t);return}}if(window.attachEvent)window.attachEvent("onload",B$);else if(window.onload){const t=window.onload,e=i=>{t(i),B$()};window.onload=e}else window.onload=B$;E2e();C2e();
//# sourceMappingURL=index-By8bcRel.js.map
