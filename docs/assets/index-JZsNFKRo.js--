var _1e=Object.defineProperty;var k1e=(t,e,i)=>e in t?_1e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var IL=(t,e,i)=>(k1e(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Lr=function(){let t={},e={},i="gbr";t.define=({ioc:r,idiom:a})=>{e[r]=a},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let a=e[i],o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let a=e.default,o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a},t.obj=r=>{var a;return r?(a=e==null?void 0:e[i])!=null&&a[r]?e[i][r]:e.default[r]?e.default[r]:{}:""},e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t}();function rt(t){return typeof t=="function"}function O1e(t){return typeof t=="string"}function fc(t){return typeof t=="object"&&!Array.isArray(t)}function x1e(t,e=0){let i=e,n,r;const a=()=>{i-=new Date-r,window.clearTimeout(n)},o=()=>i=e,s=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return s(),{pause:a,resume:s,reset:o}}var L1e=Object.defineProperty,Kt=(t,e)=>{for(var i in e)L1e(t,i,{get:e[i],enumerable:!0})};function s0(){return"2.0.54"}var EA={};Kt(EA,{competitionGovernor:()=>kV,drawsGovernor:()=>kj,entriesGovernor:()=>fz,eventGovernor:()=>gz,generationGovernor:()=>Dz,matchUpFormatGovernor:()=>Ep,matchUpGovernor:()=>Cz,mocksGovernor:()=>fk,participantGovernor:()=>e3,policyGovernor:()=>xH,publishingGovernor:()=>bk,queryGovernor:()=>_D,reportGovernor:()=>i3,scheduleGovernor:()=>n3,scoreGovernor:()=>Mm,tieFormatGovernor:()=>a3,tournamentGovernor:()=>u3,venueGovernor:()=>d3});var kV={};Kt(kV,{getLinkedTournamentIds:()=>G1,getTournamentIds:()=>V1,linkTournaments:()=>Tte,mutate:()=>kQ,query:()=>Pte,unlinkTournament:()=>Dte,unlinkTournaments:()=>Ute});var kQ={};Kt(kQ,{linkTournaments:()=>Tte,unlinkTournament:()=>Dte,unlinkTournaments:()=>Ute});var RI={};Kt(RI,{addNotice:()=>jt,callListener:()=>aU,createInstanceState:()=>Jee,cycleMutationStatus:()=>pj,deepCopyEnabled:()=>dj,deleteNotice:()=>mj,deleteNotices:()=>Ly,disableNotifications:()=>ete,enableNotifications:()=>iR,getDevContext:()=>gs,getMethods:()=>fj,getNotices:()=>hj,getProvider:()=>y2,getTopics:()=>sl,getTournamentId:()=>Fy,getTournamentRecord:()=>gj,getTournamentRecords:()=>Eh,globalLog:()=>ate,handleCaughtError:()=>jA,removeTournamentRecord:()=>rte,setDeepCopy:()=>rU,setDevContext:()=>nU,setGlobalLog:()=>Qee,setGlobalMethods:()=>tte,setGlobalSubscriptions:()=>NDe,setMethods:()=>ite,setStateMethods:()=>ote,setStateProvider:()=>RDe,setSubscriptions:()=>ADe,setTournamentId:()=>oU,setTournamentRecord:()=>nte,setTournamentRecords:()=>VA,timeKeeper:()=>MDe});function co(t){return typeof t=="function"}function zn(t){return typeof t=="string"}function Ii(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function F1e(t,e){if(!Ii(t)||!Ii(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function OQ(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ii).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var B1e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function s2(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>s2(a))}:{[r]:e?n(t[r]):s2(t[r])}))}function l2(t){return Array.isArray(t)?t.length+t.map(l2).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>l2(t[e])).reduce((e,i)=>e+i,0):0}function $1e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=l2(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var re={success:!0},V1e="error",xQ={SUCCESS:re,ERROR:V1e},u2={message:"Chronological error; time violation.",code:"ANACHRONISM"},iU={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},LQ={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},c2={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Cn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Fe={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},A1={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},jI={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},bv={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},ot={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},FQ={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ms={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Ny={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},OV={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},xV={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},GI={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},BQ={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},$Q={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},j1e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},LV={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},_1={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},CA={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},l0={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},u0={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},FV={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},RA={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},BV={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},k1={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},qu={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},VQ={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},jQ={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},GQ={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},HQ={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},zQ={message:"Invalid action",code:"ERR_INVALID_ACTION"},d2={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},qQ={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},WQ={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},KQ={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},$V={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},YQ={message:"Existing round",code:"ERR_EXISTING_ROUND"},G1e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Is={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Sn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},VV={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Uh={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},ZQ={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},vp={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ji={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},zo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},XQ={message:"Event exists",code:"ERR_EXISTING_EVENT"},JQ={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},QQ={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},jV={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},GV={message:"Missing stage",code:"ERR_MISSING_STAGE"},vg={message:"Invalid stage",code:"ERR_INVALID_STAGE"},eee={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},tee={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},iee={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},p2={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},O1={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},QC={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},c0={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Xd={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},HV={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},zV={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},nee={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},d0={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Ca={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Ay={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ta={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Hp={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Eo={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},Co={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},qV={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},MA={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},H1e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},ree={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},WV={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},aee={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},KV={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},z1e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Iv={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},q1e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},YV={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},W1e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},NA={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},K1e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Y1e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},_y={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},ht={message:"Missing value",code:"ERR_MISSING_VALUE"},oee={message:"Missing date",code:"ERR_MISSING_DATE"},see={message:"No valid dates",code:"ERR_NO_VALID_DATES"},iM={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},eR={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},lee={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ka={message:"Invalid Date",code:"ERR_INVALID_DATE"},Il={message:"Invalid time",code:"ERR_INVALID_TIME"},uee={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},f2={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},cee={message:"Invalid score",code:"ERR_INVALID_SCORE"},AA={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Z1e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},ZV={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},dee={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},_A={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},XV={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},ky={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},ku={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Hs={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},pee={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ou={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},fee={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Oy={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},x1={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},cr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},_n={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},hee={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},X1e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},mee={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Dh={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},gee={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},vee={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},yee={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},p0={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},kA={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},JV={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},h2={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},bee={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},J1e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Q1e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Iee={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},wee={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},m2={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},See={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},QV={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Tee={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},ej={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},HI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Uee={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},f0={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Dee={message:"Court exists",code:"ERR_EXISTING_COURT"},Pee={message:"Venue exists",code:"ERR_EXISTING_VENUE"},xy={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Ph={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Eee={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},tj={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},Cee={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Ree={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},eDe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},ij={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Mee={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},nj={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},rj={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},OA={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Nee={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},L1={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Aee={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},h0={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},_ee={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},xA={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},kee={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Oee={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},zp={message:"Invalid object",code:"ERR_INVALID_OBJECT"},tR={message:"Invalid gender",code:"ERR_INVALID_GENDER"},nM={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},we={message:"Invalid values",code:"ERR_INVALID_VALUES"},xee={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},aj={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Lee={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},LA={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},oj={message:"Value unchanged",code:"ABORT_UNCHANGED"},Hr={message:"Not found",code:"ERR_NOT_FOUND"},FA={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Fee={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},sj={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Bee={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},$ee={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},g2={message:"Existing stage",code:"ERR_EXISTING_STAGE"},lj={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},F1={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Vee={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},BA={message:"Scores present",code:"ERR_SCORES_PRESENT"},jee={ANACHRONISM:u2,CANNOT_CHANGE_WINNING_SIDE:XV,CANNOT_MODIFY_TIEFORMAT:ZV,CANNOT_MODIFY_PARTICIPANT_TYPE:dee,CANNOT_REMOVE_MAIN_STRUCTURE:LQ,CANNOT_REMOVE_PARTICIPANTS:_A,COURT_EXISTS:Dee,COURT_NOT_FOUND:f0,DRAW_DEFINITION_NOT_FOUND:ms,DRAW_ID_EXISTS:VQ,DRAW_POSITION_ACTIVE:CA,DRAW_POSITION_ASSIGNED:GI,DRAW_POSITION_NOT_CLEARED:$Q,DRAW_POSITION_NOT_FOUND:j1e,DRAW_SIZE_MISMATCH:BV,DUPLICATE_ENTRY:iU,DUPLICATE_VALUE:xee,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:wee,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Iee,EVENT_EXISTS:XQ,EVENT_NOT_FOUND:zo,EXISTING_DRAW_DEFINITIONS:FQ,EXISTING_END_TIME:tj,EXISTING_FLIGHT:Fee,EXISTING_MATCHUP_ID:$ee,EXISTING_OUTCOME:Bee,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:p0,EXISTING_PARTICIPANT:kA,EXISTING_POLICY_TYPE:KV,EXISTING_PROFILE:sj,EXISTING_ROUND:YQ,EXISTING_STAGE:g2,EXISTING_STRUCTURE:lj,INCOMPATIBLE_MATCHUP_STATUS:QC,INCOMPLETE_SOURCE_STRUCTURE:OV,INSUFFICIENT_DRAW_POSITIONS:QV,INVALID_ACTION:zQ,INVALID_ASSIGNMENT:d2,INVALID_BOOKINGS:iM,INVALID_CATEGORY:nM,INVALID_COLLECTION_DEFINITION:Oee,INVALID_CONFIGURATION:kee,INVALID_DATE_AVAILABILITY:eR,INVALID_DATE:Ka,INVALID_DRAW_DEFINITION:bv,INVALID_DRAW_POSITION_FOR_SEEDING:xV,INVALID_DRAW_POSITION:l0,INVALID_DRAW_SIZE:RA,INVALID_END_TIME:Eee,INVALID_ENTRIES:QQ,INVALID_EVENT_TYPE:vp,INVALID_GAME_SCORES:f2,INVALID_GENDER:tR,INVALID_MATCHUP_FORMAT:HV,INVALID_MATCHUP_STATUS:c0,INVALID_MATCHUP_STATUS_BYE:iee,INVALID_MATCHUP:Co,INVALID_OBJECT:zp,INVALID_PARTICIPANT_ID:ku,INVALID_PARTICIPANT_IDS:Hs,INVALID_PARTICIPANT_ROLE:pee,INVALID_PARTICIPANT_SEEDING:jQ,INVALID_PARTICIPANT_TYPE:Ou,INVALID_PARTICIPANT:ky,INVALID_POLICY_DEFINITION:aee,INVALID_RECORDS:c2,INVALID_SCALE_ITEM:L1,INVALID_SEED_NUMBER:WQ,INVALID_SEED_POSITION:KQ,INVALID_SET_NUMBER:W1e,INVALID_SIDE_NUMBER:YV,INVALID_SCORE:cee,INVALID_STAGE:vg,INVALID_START_TIME:Ree,INVALID_STRUCTURE:Ny,INVALID_STOP_TIME:Cee,INVALID_TIE_FORMAT:Xd,INVALID_TIME:Il,INVALID_TIME_ITEM:ij,INVALID_TOURNAMENT_DATES:uee,INVALID_TOURNAMENT_RECORD:A1,INVALID_VALUES:we,INVALID_WINNING_SIDE:AA,MATCHUP_NOT_FOUND:Ta,METHOD_NOT_FOUND:F1,MISSING_ASSIGNMENTS:jV,MISSING_ASYNC_STATE_PROVIDER:Mee,MISSING_AVOIDANCE_POLICY:ree,MISSING_COLLECTION_DEFINITION:nee,MISSING_COURT_ID:_y,MISSING_COURTS_INFO:Uee,MISSING_DATE_AVAILABILITY:lee,MISSING_DATE:oee,MISSING_DRAW_DEFINITION:ot,MISSING_DRAW_ID:qu,MISSING_DRAW_POSITION:u0,MISSING_DRAW_POSITIONS:_1,MISSING_DRAW_SIZE:k1,MISSING_ENTRIES:JQ,MISSING_EVENT:ji,MISSING_MATCHUP_FORMAT:zV,MISSING_MATCHUP_ID:Ca,MISSING_MATCHUP_IDS:Ay,MISSING_MATCHUP:Eo,MISSING_MATCHUPS:Hp,MISSING_PARTICIPANT_COUNT:gee,MISSING_PARTICIPANT_ID:cr,MISSING_PARTICIPANT_IDS:Dh,MISSING_PARTICIPANT_ROLE:fee,MISSING_PARTICIPANT:Oy,MISSING_PARTICIPANTS:x1,MISSING_PENALTY_ID:ej,MISSING_PENALTY_TYPE:Tee,MISSING_PERSON_DETAILS:yee,MISSING_POLICY_ATTRIBUTES:WV,MISSING_POLICY_DEFINITION:MA,MISSING_POLICY_TYPE:qV,MISSING_POSITION_ASSIGNMENTS:tee,MISSING_ROUND_NUMBER:G1e,MISSING_SCHEDULE:Nee,MISSING_SCORING_POLICY:q1e,MISSING_SEED_ASSIGNMENTS:qQ,MISSING_SEEDCOUNT_THRESHOLDS:HQ,MISSING_SEEDING_POLICY:H1e,MISSING_SET_NUMBER:K1e,MISSING_SET_OBJECT:NA,MISSING_SIDE_NUMBER:Y1e,MISSING_STAGE:GV,MISSING_STRUCTURE_ID:Is,MISSING_STRUCTURE:Uh,MISSING_STRUCTURES:VV,MISSING_TARGET_LINK:$V,MISSING_TIE_FORMAT:d0,MISSING_TIME_ITEM:nj,MISSING_TIME_ITEMS:rj,MISSING_TOURNAMENT_ID:jI,MISSING_TOURNAMENT_RECORD:Fe,MISSING_TOURNAMENT_RECORDS:Cn,MISSING_VALUE:ht,MISSING_VENUE_ID:Ph,MODIFICATIONS_FAILED:Aee,NO_CANDIDATES:xA,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:See,NO_MODIFICATIONS_APPLIED:h0,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:m2,NO_PARTICIPANT_REMOVED:mee,NO_VALID_ACTIONS:Lee,NO_VALID_ATTRIBUTES:LA,NO_VALID_DATES:see,NOT_FOUND:Hr,NOT_IMPLEMENTED:FA,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:JV,PARTICIPANT_ID_EXISTS:hee,PARTICIPANT_NOT_CHECKED_IN:vee,PARTICIPANT_NOT_FOUND:_n,PARTICIPANT_PAIR_EXISTS:X1e,PENALTY_NOT_FOUND:HI,POLICY_NOT_ATTACHED:z1e,POLICY_NOT_FOUND:Iv,SCHEDULE_NOT_CLEARED:BQ,SCHEDULED_MATCHUPS:Vee,SCORES_PRESENT:BA,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:GQ,STAGE_SEQUENCE_LIMIT:eee,STRUCTURE_NOT_FOUND:Sn,TEAM_NOT_FOUND:aj,UNABLE_TO_ASSIGN_COURT:_ee,UNLINKED_STRUCTURES:ZQ,UNRECOGNIZED_DRAW_TYPE:LV,UNRECOGNIZED_MATCHUP_FORMAT:O1,UNRECOGNIZED_MATCHUP_STATUS:p2,VALUE_UNCHANGED:oj,VENUE_EXISTS:Pee},mn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Gee={addNotice:pDe,callListener:vDe,cycleMutationStatus:dDe,deleteNotice:mDe,deleteNotices:hDe,disableNotifications:tDe,enableNotifications:iDe,getMethods:$A,getNotices:fDe,getTopics:gDe,getTournamentId:Hee,getTournamentRecord:nDe,getTournamentRecords:rDe,removeTournamentRecord:lDe,setMethods:cDe,setSubscriptions:uDe,setTournamentId:oDe,setTournamentRecord:aDe,setTournamentRecords:sDe,handleCaughtError:yDe};function tDe(){mn.disableNotifications=!0}function iDe(){mn.disableNotifications=!1}function Hee(){return mn.tournamentId}function nDe(t){return mn.tournamentRecords[t]}function rDe(){return mn.tournamentRecords}function aDe(t){let e=t==null?void 0:t.tournamentId;return e?(mn.tournamentRecords[e]=t,{success:!0}):{error:A1}}function oDe(t){return t?mn.tournamentRecords[t]?(mn.tournamentId=t,{success:!0}):{error:Fe}:(mn.tournamentId=void 0,{success:!0})}function sDe(t){mn.tournamentRecords=t;let e=Object.keys(t);e.length===1?mn.tournamentId=e[0]:e.length||(mn.tournamentId=void 0)}function lDe(t){if(typeof t!="string")return{error:we};if(!mn.tournamentRecords[t])return{error:Hr};delete mn.tournamentRecords[t];let e=Object.keys(mn.tournamentRecords);return e.length===1?mn.tournamentId=e[0]:e.length||(mn.tournamentId=void 0),{success:!0}}function uDe(t){return typeof t.subscriptions!="object"?{error:we}:(Object.keys(t.subscriptions).forEach(e=>{mn.subscriptions[e]=t.subscriptions[e]}),{...re})}function cDe(t){return typeof t!="object"?{error:we}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(mn.methods[e]=t[e])}),{...re})}function dDe(){let t=mn.modified;return mn.modified=!1,t}function pDe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(mn.disableNotifications||(mn.modified=!0),!(mn.disableNotifications||!mn.subscriptions[t]&&!n)))return i&&(mn.notices=mn.notices.filter(r=>!(r.topic===t&&r.key===i))),mn.notices.push({topic:t,payload:e,key:i}),{...re}}function $A(){return mn.methods??{}}function fDe({topic:t}){return mn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function hDe(){mn.notices=[]}function mDe({topic:t,key:e}){mn.notices=mn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function gDe(){return{topics:Object.keys(mn.subscriptions)}}function vDe({topic:t,notices:e},i){let n=mn.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function yDe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Hee(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function sr(t,e){return(t??0)-(e??0)}function St(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function xu(t){return isNaN(t)?!1:t&&(t&t-1)===0}function v7(t){if(!t.length)return;let e=[...t].sort(sr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function bDe(t){if(!xu(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function uj(t){return isNaN(t)?0:t%2&&t+1||t}function cj(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Dn(t){return!isNaN(parseFloat(t))}function zee(t){let e=St(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function m0(t){if(isNaN(t))return!1;for(;!xu(t);)t++;return t}function Ms(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function Nt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function IDe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function wDe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function qee(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=qee(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=wDe(s,n)),parseFloat(s.toFixed(r))}function rM(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function Vt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function SDe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Ga(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function zI(t){return Nt(t)?t:1/0}function qo(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function TDe(t){return Wee(qo(t))}function Wee(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function UDe(t,e,i){return i.indexOf(t)===e}function Kee(t){return t.filter(UDe)}function Vo(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Bo(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Xe(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function rc(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Ln(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function y7(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Ya(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function DDe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function PDe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function zr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function Yee(t,[e,...i]){return t.length?[t.slice(0,e),...Yee(t.slice(e),[...i,e])]:[]}function EDe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function Zee(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function Xee(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function v2(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function CDe(t,e=1){if(!Array.isArray(t)||!t.every(Nt))return[];let i=Math.min(...t,e),n=Math.max(...t);return Xe(i,n+1).filter(r=>!t.includes(r))}var $i={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},qr=Gee,b7=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function RDe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Ln(Object.keys(t),b7).length!==b7.length)throw new Error("Global state provider is missing required methods");return qr=t,{success:!0}}function Jee(){if(qr.createInstanceState){try{qr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Mee}}function gs(t){return!t||typeof t!="object"?$i.devContext??!1:typeof $i.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=$i.devContext)==null?void 0:i[e])===t[e]})&&$i.devContext}function MDe(t="reset",e="default"){var n,r;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys($i.timers).filter(a=>a!=="default"||$i.timers[a].startTime).map(a=>{let o=$i.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:$i.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=$i.timers[e].state==="stopped"?0:(i-(((n=$i.timers[e])==null?void 0:n.startTime)??0))/1e3,o=$i.timers[e].elapsedTime+a;return{state:$i.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!$i.timers[e]||t==="reset"){if(e==="allTimers")return $i.timers={default:{elapsedTime:0}},!0;$i.timers[e]={startTime:i,state:"active",elapsedTime:0}}return $i.timers[e].elapsedTime||($i.timers[e].elapsedTime=0),t==="stop"&&$i.timers[e].state!=="stopped"&&($i.timers[e].state="stopped")&&($i.timers[e].elapsedTime+=(i-(((r=$i.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&($i.timers[e].startTime=i)&&($i.timers[e].state="active"),$i.timers[e]}function Qee(t){co(t)?$i.globalLog=t:delete $i.globalLog}function nU(t){$i.devContext=t}function ete(){qr.disableNotifications()}function iR(){qr.enableNotifications()}function rU(t,e){typeof t=="boolean"&&($i.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&($i.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&($i.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&($i.deepCopyAttributes.stringify=e.stringify),e.threshold&&($i.deepCopyAttributes.threshold=e.threshold))}function dj(){return{enabled:$i.deepCopy,...$i.deepCopyAttributes}}function NDe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{$i.globalSubscriptions[e]=t.subscriptions[e]}),{...re}):{error:ht,info:"missing subscriptions"}}function ADe(t){return t!=null&&t.subscriptions?qr.setSubscriptions({subscriptions:t.subscriptions}):{error:ht,info:"missing subscriptions"}}function tte(t){return t?typeof t!="object"?{error:we}:(Object.keys(t).forEach(e=>{co(t[e])&&($i.globalMethods[e]=t[e])}),{...re}):{error:ht,info:"missing method declarations"}}function ite(t){return t?typeof t!="object"?{error:we}:qr.setMethods(t):{error:ht,info:"missing method declarations"}}function pj(){return qr.cycleMutationStatus()}function jt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=$i.globalSubscriptions[t.topic];return qr.addNotice(t,e)}function fj(){return{...$i.globalMethods,...qr.getMethods()}}function hj(t){return qr.getNotices(t)}function mj({key:t,topic:e}){return qr.deleteNotice({key:t,topic:e})}function Ly(){return qr.deleteNotices()}function sl(){return qr.getTopics()}async function aU(t){return qr.callListener(t,$i.globalSubscriptions)}function Fy(){return qr.getTournamentId()}function gj(t){return qr.getTournamentRecord(t)}function Eh(){return qr.getTournamentRecords()}function nte(t){return qr.setTournamentRecord(t)}function VA(t){return qr.setTournamentRecords(t)}function oU(t){return qr.setTournamentId(t)}function rte(t){return qr.removeTournamentRecord(t)}function y2(){return qr}function jA({engineName:t,methodName:e,params:i,err:n}){return(co(qr.handleCaughtError)&&qr.handleCaughtError||Gee.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function ate(t,e){if($i.globalLog)try{$i.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Qee()}else console.log(e,t)}function ote(t,e,i,n){if(!Ii(t))return{error:we};Dn||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{co(s[u])?a[u]=s[u]:Ii(s[u])&&(e===!0||r!=null&&r.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),n?tte(a):ite(a),{methods:a}}function _De(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function pt(t,e,i,n){var o;if(typeof t!="object"||t===null)return t;(o=dj())!=null&&o.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let a=_De(t,r,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>pt(l))}:{[s]:n?t[s]:pt(t[s])}))}function le({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,pt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...re}),e??{success:!0}}var qI="resourceSubType",WI="resourceType",KI="identifier",ste={RESOURCE_SUB_TYPE:qI,RESOURCE_TYPE:WI,IDENTIFIER:KI},hc="SINGLES",Wv="SINGLES",Zs="DOUBLES",Xf="DOUBLES",vr="TEAM",Xs="TEAM",kDe="AGE",ODe="RATING",xDe="BOTH",ko={AGE:kDe,BOTH:xDe,DOUBLES:Zs,DOUBLES_EVENT:Xf,RATING:ODe,SINGLES:hc,SINGLES_EVENT:Wv,TEAM_EVENT:Xs,TEAM:vr},Ua="tournamentRecords",vj="policyDefinitions",as="tournamentRecord",yj="onlineResource",ll="drawDefinition",bj="matchUpFormat",hd="participantId",lte="scheduleDates",LDe="tournamentId",FDe="scheduleDate",Ij="structureId",wj="participant",B1="matchUpIds",BDe="policyType",ute="structures",qp="matchUpId",Sj="eventType",GA="inContext",Tj="structure",HA="courtIds",$De="personId",zA="venueIds",cte="matchUps",dte="courtId",pte="eventId",xd="matchUp",fte="drawId",up="error",By="event",g0="param",VDe="uuids",jDe="averageMatchUpMinutes",GDe="recoveryMinutes",HDe="periodLength",zDe="number",us="object",uo="array",ks="_validate",hte="_message",md="_invalid",ul="_ofType",Uj="_anyOf",sU="_oneOf",I7={[Sj]:t=>[hc,Zs,vr].includes(t),[yj]:t=>Ln(Object.keys(t),[qI,WI,KI]).length===3},qDe={[Ua]:Cn,[as]:Fe,[vj]:MA,[ll]:ot,[hd]:cr,[bj]:zV,[LDe]:jI,[Ij]:Is,[B1]:Ay,[wj]:Oy,[yj]:zp,[Sj]:vp,[ute]:VV,[qp]:Ca,[Tj]:Uh,[dte]:_y,[cte]:Hp,[pte]:zo,[xd]:Eo,[HA]:ht,[zA]:ht,[fte]:qu,[By]:ji},WDe={[Ua]:us,[vj]:us,[as]:us,[ll]:us,[yj]:us,[lte]:uo,[wj]:us,[B1]:uo,[ute]:uo,[Tj]:us,[HA]:uo,[zA]:uo,[cte]:uo,[xd]:us,[By]:us,[VDe]:uo};function Lt(t,e,i){if(!t&&!Ii(t))return{error:we};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:we};let{paramError:n,errorParam:r}=ZDe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?qDe[r]||n[up]||we:n[ks]&&n[md]||we,o=r??(n[sU]&&Object.keys(n[sU]).join(", "));return le({info:{param:o,message:n[hte]},result:{error:a},stack:i})}function mte(t,e){let i=Object.keys(t),n=Object.keys(e);return Ln(i,n)}function KDe(t,e){if(!e)return;let i=mte(t,e);return i.length!==1?{error:we}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function YDe(t,e){if(!e)return;let i=mte(t,e).filter(n=>t[n]);return i.length<1?{error:we}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function ZDe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&KDe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&YDe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),f=p.find(h=>{let m=s&&!co(s),g=t[h]!==void 0&&!s&&XDe(t,h,r),v=u[h]&&[void 0,null].includes(t[h]),y=m||g||v||s&&t[h]!==void 0&&!JDe(t[h],s)||I7[h]&&!I7[h](t[h]);return y&&(i=h,n=l),y});return!p.length||f}),errorParam:i,paramInfo:n}}function XDe(t,e,i){return i=i||WDe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function JDe(t,e){return co(e)?e(t):!0}var Dj="DYNAMIC",Jf="RANKING",Gf="RATING",Lm="SCALE",td="SEEDING",v0={RANKING:Jf,RATING:Gf,SCALE:Lm,SEEDING:td};function y0(t){var r;let e=Lt(t,[{[wj]:!0}]);if(e.error)return e;let i=(r=t.participant.timeItems)==null?void 0:r.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Lm))&&[Jf,Gf,td].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=Vt(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),f=p?`${d}.${p}`:d,h=u===td&&"seedings"||u===Jf&&"rankings"||"ratings";n[h][c]||(n[h][c]=[]),n[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:f})}}}return{...re,...n}}function Kv(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=c[f]||f,m=o[h]||p,g=a[f];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);s[f]=v}else g&&(s[f]={},r(g,m,s[f]));else{let v=a[f];if(Array.isArray(m)&&!m.includes(v))return!1;(o[f]||p&&o[f]!==!1)&&(s[f]=v)}}}}var aM=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,gte=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,gd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Um=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function oM(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Ft(t.scheduledTime)),!e)return;let i=nn(t.scheduledTime),n=Ft(e);return n&&i&&(n+=`T${i}`),n}function QDe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function b0(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Um.test($y(t,!0,!0)))}function Go(t){return Fm(t)||aM.test(t)}function ePe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return tPe(i,{displaySeconds:!1})}function tPe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Ls).join(":")}var Pj=t=>{let e=lU(t)||Fm(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Ls(n)}-${Ls(e.getUTCDate())}`};function iPe(t){let e=lU(t)||Fm(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Cu(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function sM(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function nPe(t){return sM(t).getTime()}function lU(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function YI(t,e){if(!Go(t)||!Go(e))return[];let i=Ft(t)+"T00:00",n=Ft(e)+"T00:00",r=new Date(i),a=new Date(n),o=lU(a)&&lU(r)&&u(r,a),s=[],l=0;if(o){let c=r,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Cu(c));function u(c,d){return c<=d}}var rPe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Fm(t){return typeof t!="string"?!1:rPe.test(t)}function Ej(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function li(t){let e=nn(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function aPe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Ls(e),Ls(i)].join(":")}function lM(t){return Ej(t)?t.split(":").slice(0,2).map(Ls).join(":"):void 0}function nn(t){return Fm(t)&&t.indexOf("T")>0?lM(t.split("T").reverse()[0]):lM(t)}function Ft(t){return Fm(t)||gd.test(t)?t.split("T")[0]:void 0}function aT(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Ft(i.toISOString())}function uM(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function oPe(t){let e=uM(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Ls).join(":")}function sPe(t){var i;let e=uM(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function $y(t,e,i){let n=Ft(t),r=nn(t),a=n?r:t;return t?e&&(n&&i&&t||oPe(a))||sPe(a):void 0}function vte(t,e){let i=uM(t),n=uM(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function yte(t,e=7){let i=Ft(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Cu(r)}function lPe(t){return yte(t)}function uPe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Cu(r,i)}function cPe(t,e,i){let n=new Date(t,0);return Cu(new Date(n.setDate(e)),i)}function er(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Ls),r=sM(e).setHours(i,n,0,0);return sM(r)}function $1(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function Uo(t,e){let i=nn(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return nn(Cj(er(i),n).toISOString())}function Cj(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Ls(t){return t.toString()[1]?t:"0"+t}function vd(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var dPe={addDays:yte,addWeek:lPe,addMinutesToTimeString:Uo,convertTime:$y,getIsoDateString:oM,getUTCdateString:Pj,DateHHMM:ePe,extractDate:Ft,extractTime:nn,formatDate:Cu,getDateByWeek:uPe,isISODateString:Fm,isDate:lU,isTimeString:Ej,offsetDate:sM,offsetTime:nPe,sameDay:vd,timeStringMinutes:li,timeToDate:er,timeUTC:iPe,validTimeValue:b0,validDateString:aM,timeValidation:Um,dateValidation:gd};function st(t,e,i,n,r=0){if(y2().makeDeepCopy)return y2().makeDeepCopy(t,e,i,n);let a=dj(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||co(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||co(l)&&!l(f)),p=(f,h)=>{c[f]=co(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=co(u)?u(h):void 0;if(m!==void 0)c[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let g=Rj(h);Object.assign(c,...g)}else n&&f==="extensions"?c[f]=[]:Array.isArray(o)&&o.includes(f)?p(f,h):Array.isArray(s)&&s.includes(f)&&co(h==null?void 0:h.toJSON)?c[f]=h.toJSON():h===null?c[f]=void 0:QDe(h)?c[f]=new Date(h).toISOString():c[f]=st(h,e,i,n,r+1)}return c}function Rj(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var b2="voluntaryConsolation",tp="competitiveBands",Mj="roundRobinTally",yp="positionActions",Br="matchUpActions",nR="rankingPoints",ZI="roundNaming",I0="participant",uU="progression",Ch="scheduling",cU="avoidance",pPe="display",Js="scoring",Ul="seeding",XI="feedIn",fPe="audit",cM="draws",yg={POLICY_TYPE_VOLUNTARY_CONSOLATION:b2,POLICY_TYPE_COMPETITIVE_BANDS:tp,POLICY_TYPE_ROUND_ROBIN_TALLY:Mj,POLICY_TYPE_POSITION_ACTIONS:yp,POLICY_TYPE_MATCHUP_ACTIONS:Br,POLICY_TYPE_RANKING_POINTS:nR,POLICY_TYPE_ROUND_NAMING:ZI,POLICY_TYPE_PARTICIPANT:I0,POLICY_TYPE_PROGRESSION:uU,POLICY_TYPE_SCHEDULING:Ch,POLICY_TYPE_AVOIDANCE:cU,POLICY_TYPE_DISPLAY:pPe,POLICY_TYPE_FEED_IN:XI,POLICY_TYPE_SCORING:Js,POLICY_TYPE_SEEDING:Ul,POLICY_TYPE_AUDIT:fPe,POLICY_TYPE_DRAWS:cM};function Qf({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=st(o,!1,r);if(s){let l=e==null?void 0:e[I0];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=y0({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return Kv({template:l.participant,source:s})}return s}var hPe="element required",mPe="missing name";function Ha(t){if(!t||typeof t!="object")return{error:ht};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:we};if(!(t!=null&&t.name))return{error:ht,info:mPe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=Ha({element:i,name:t.name});if(n.error)return le({result:n,stack:"removeExtension"})}return{...re}}return{error:ht,info:hPe}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...re}):{...re,info:Hr}}function mc({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function fi(t){if(typeof t!="object")return{error:ht};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return le({result:{error:we},stack:e});if(!mc({extension:t.extension}))return le({result:{error:we,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=fi({extension:t.extension,element:n});if(r.error)return le({result:r,stack:e})}return{...re}}else return le({result:{error:ht},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...re}}function Nj(t){return!t||typeof t!="object"?{error:ht}:t.tournamentRecord?fi({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Fe}}function qA(t){return!t||typeof t!="object"?{error:ht}:t.drawDefinition?fi({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ms}}function Rh(t){return!t||typeof t!="object"?{error:ht}:t.event?fi({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:zo}}function bte(t){var n;if(!t||typeof t!="object")return{error:ht};if(!t.participantId)return{error:cr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=Qf({participantId:t.participantId,tournamentParticipants:e});return i?fi({creationTime:t.creationTime,extension:t.extension,element:i}):{error:_n}}function Aj(t){return!t||typeof t!="object"?{error:ht}:t.tournamentRecord?Ha({element:t.tournamentRecord,name:t.name}):{error:Fe}}function Ite(t){return!t||typeof t!="object"?{error:ht}:t.drawDefinition?Ha({element:t.drawDefinition,name:t.name}):{error:ms}}function WA(t){return!t||typeof t!="object"?{error:ht}:t!=null&&t.event?Ha({element:t.event,name:t.name}):{error:zo}}function wte(t){var n;if(!t||typeof t!="object")return{error:ht};if(!t.participantId)return{error:cr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=Qf({participantId:t.participantId,tournamentParticipants:e});return i?Ha({element:i,name:t.name}):{error:_n}}function V1({tournamentRecords:t}){return{tournamentIds:Ii(t)?Object.keys(t):[],...re}}var gPe="extensionQueries";function $t({discover:t,element:e,name:i,...n}){var a;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=n[u])==null?void 0:c.extensions)?n[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:Hr}}return le({result:{error:ht},stack:gPe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:r,info:r?void 0:Hr}}var vPe="activeSuspension",dU="appliedPolicies",Ste="context",KA="delegatedOutcome",Ru="disabled",Yv="disableAutoCalc",YA="disableLinks",dM="display",wT="drawDeletions",yPe="drawProfile",pM="entryProfile",bPe="eventProfile",IPe="eventWithdrawalRequests",wPe="factory",Vl="flightProfile",I2="groupingAttribute",bp="lineUps",Bm="linkedTournamentsIds",ZA="matchUpHistory",_j="participantRepresentatives",w0="personRequests",ST="positionActions",SPe="rankingPoints",TPe="registration",Mc="roundTarget",j1="scheduleLimits",Ip="scheduleTiming",Zv="schedulingProfile",UPe="statusDetail",JI="subOrder",eh="tally",TT="tieFormatModification",Xv={ACTIVE_SUSPENSION:vPe,APPLIED_POLICIES:dU,CONTEXT:Ste,DELEGATED_OUTCOME:KA,DISABLED:Ru,DISABLE_LINKS:YA,DISABLE_AUTO_CALC:Yv,DISPLAY:dM,DRAW_DELETIONS:wT,DRAW_PROFILE:yPe,ENTRY_PROFILE:pM,EVENT_PROFILE:bPe,EVENT_WITHDRAWAL_REQUESTS:IPe,FLIGHT_PROFILE:Vl,GROUPING_ATTRIBUTE:I2,LINEUPS:bp,LINKED_TOURNAMENTS:Bm,MATCHUP_HISTORY:ZA,PARTICIPANT_REPRESENTATIVES:_j,PERSON_REQUESTS:w0,POSITION_ACTIONS:ST,RANKING_POINTS:SPe,REGISTRATION:TPe,ROUND_TARGET:Mc,SCHEDULE_LIMITS:j1,SCHEDULE_TIMING:Ip,SCHEDULING_PROFILE:Zv,STATUS_DETAIL:UPe,SUB_ORDER:JI,TALLY:eh,TIE_FORMAT_MODIFICATIONS:TT,FACTORY:wPe},w7=[KA,Ru,Yv,YA,Vl,bp,Bm,ZA,_j,w0,Mc,j1,Ip,Zv,JI,eh,TT];function Tte({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=V1({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?fi({tournamentRecords:t,discover:!0,extension:{name:Bm,value:{tournamentIds:i}}}):{...re}}function Ute({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=Ha({name:Bm,tournamentRecords:t,discover:!0});return le({result:e,stack:"unlinkTournaments"})}function Dte({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:we};if(!e)return{error:jI};let i=V1({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:jI};let r;return n.every(a=>{var d;let o=t[a],{extension:s}=$t({element:o,name:Bm});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=Aj({name:Bm,tournamentRecord:o});return p.error&&(r=p.error),p.success}let u=l.filter(p=>p!==e);s.value={tournamentIds:u};let c=Nj({tournamentRecord:o,extension:s});return c.error&&(r=c.error),c.success}),r?{error:r}:{...re}}var Pte={};Kt(Pte,{getLinkedTournamentIds:()=>G1,getTournamentIds:()=>V1});function G1({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Cn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],n=i==null?void 0:i.tournamentId,{extension:r}=$t({element:i,name:Bm}),a=(((o=r==null?void 0:r.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==n);return{[e]:a}}))}}var kj={};Kt(kj,{addAdHocMatchUps:()=>R_,addDrawDefinitionTimeItem:()=>WG,addFinishingRounds:()=>uD,addGoesTo:()=>Wm,addPlayoffStructures:()=>C_,addQualifyingStructure:()=>Dne,addVoluntaryConsolationStage:()=>Tne,addVoluntaryConsolationStructure:()=>kG,allPlayoffPositionsFilled:()=>HG,alternateDrawPositionAssignment:()=>rne,assignDrawPosition:()=>ere,assignDrawPositionBye:()=>Ss,attachConsolationStructures:()=>Zne,attachPlayoffStructures:()=>aH,attachQualifyingStructure:()=>qG,attachStructures:()=>E_,autoSeeding:()=>xAe,automatedPlayoffPositioning:()=>bD,automatedPositioning:()=>yD,checkValidEntries:()=>__,deleteAdHocMatchUps:()=>ire,drawMatic:()=>kH,findDrawDefinition:()=>cH,generateAdHocMatchUps:()=>k_,generateAdHocRounds:()=>_H,generateAndPopulatePlayoffStructures:()=>rH,generateDrawDefinition:()=>BD,generateDrawMaticRound:()=>TH,generateDrawStructuresAndLinks:()=>IH,generateDrawTypeAndModifyDrawDefinition:()=>wH,generateQualifyingStructure:()=>YG,generateVoluntaryConsolation:()=>Cre,getAssignedParticipantIds:()=>Pg,getAvailableMatchUpsCount:()=>M_,getAvailablePlayoffProfiles:()=>wD,getDrawDefinitionTimeItem:()=>fG,getDrawParticipantRepresentativeIds:()=>lH,getDrawTypeCoercion:()=>MD,getEligibleVoluntaryConsolationParticipants:()=>sH,getMatchUpsMap:()=>ga,getParticipantIdFinishingPositions:()=>uH,getPositionAssignments:()=>UU,getPositionsPlayedOff:()=>k0,getSeedingThresholds:()=>FG,getSeedsCount:()=>ND,getStructureSeedAssignments:()=>tl,getTeamLineUp:()=>qm,getValidGroupSizes:()=>gD,isAdHoc:()=>Ko,isCompletedStructure:()=>rh,isValidForQualifying:()=>bH,luckyLoserDrawPositionAssignment:()=>nne,modifyDrawDefinition:()=>Xne,modifyDrawName:()=>oH,modifySeedAssignment:()=>fne,mutate:()=>Ete,positionActions:()=>yH,pruneDrawDefinition:()=>Qne,qualifierDrawPositionAssignment:()=>cne,query:()=>are,removeDrawPositionAssignment:()=>wU,removeRoundMatchUps:()=>nre,removeSeededParticipant:()=>Une,removeStructure:()=>wne,renameStructures:()=>Ine,resetDrawDefinition:()=>Jne,resetVoluntaryConsolationStructure:()=>Hte,setDrawParticipantRepresentativeIds:()=>Cte,setPositionAssignments:()=>lne,setStructureOrder:()=>yne,setSubOrder:()=>rre,shiftAdHocRounds:()=>sne,swapAdHocRounds:()=>une,swapDrawPositionAssignments:()=>pne,updateTeamLineUp:()=>Qy,withdrawParticipantAtDrawPosition:()=>Yie});var Ete={};Kt(Ete,{addAdHocMatchUps:()=>R_,addDrawDefinitionTimeItem:()=>WG,addPlayoffStructures:()=>C_,addQualifyingStructure:()=>Dne,addVoluntaryConsolationStage:()=>Tne,addVoluntaryConsolationStructure:()=>kG,alternateDrawPositionAssignment:()=>rne,assignDrawPosition:()=>ere,assignDrawPositionBye:()=>Ss,attachConsolationStructures:()=>Zne,attachPlayoffStructures:()=>aH,attachQualifyingStructure:()=>qG,attachStructures:()=>E_,automatedPlayoffPositioning:()=>bD,automatedPositioning:()=>yD,deleteAdHocMatchUps:()=>ire,luckyLoserDrawPositionAssignment:()=>nne,modifyDrawDefinition:()=>Xne,modifyDrawName:()=>oH,modifySeedAssignment:()=>fne,pruneDrawDefinition:()=>Qne,qualifierDrawPositionAssignment:()=>cne,removeDrawPositionAssignment:()=>wU,removeRoundMatchUps:()=>nre,removeSeededParticipant:()=>Une,removeStructure:()=>wne,renameStructures:()=>Ine,resetDrawDefinition:()=>Jne,resetVoluntaryConsolationStructure:()=>Hte,setDrawParticipantRepresentativeIds:()=>Cte,setPositionAssignments:()=>lne,setStructureOrder:()=>yne,setSubOrder:()=>rre,shiftAdHocRounds:()=>sne,swapAdHocRounds:()=>une,swapDrawPositionAssignments:()=>pne,updateTeamLineUp:()=>Qy,withdrawParticipantAtDrawPosition:()=>Yie});var Oj=t=>e=>t[e],xj=(t=[])=>t.map(Nr).filter(Boolean),w2=(t=[])=>t.map(Jt).filter(Boolean),Jt=(t={})=>Oj(t)("participantId"),Nr=(t={})=>Oj(t)("matchUpId"),pU=(t={})=>Oj(t)("drawId");function Cte({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ms};if(!Array.isArray(t))return{error:we};let i=w2((e==null?void 0:e.entries)||[]);return t.length&&Ln(t,i).length<t.length?{error:we}:qA({drawDefinition:e,extension:{name:_j,value:t}})}var Ro="ABANDONED",Vy="AWAITING_RESULT",Ui="BYE",Nc="CANCELLED",kn="COMPLETED",S0="DEAD_RUBBER",ai="DEFAULTED",br="DOUBLE_DEFAULT",ir="DOUBLE_WALKOVER",Zl="IN_PROGRESS",Qs="INCOMPLETE",Lj="NOT_PLAYED",ta="RETIRED",Mh="SUSPENDED",Fn="TO_BE_PLAYED",yi="WALKOVER",Rte=[Vy,kn,ai,Zl,Qs,ta,Mh],Fj=[Vy,kn,ai,ir,br,Zl,Qs,ta,Mh,yi],Bj=[Ro,Vy,Ui,Nc,kn,S0,ai,ir,br,Zl,Qs,Lj,ta,Mh,Fn,yi],$j=[Ui,ir,br,kn,ai,ta,yi],Vj=[Ro,Vy,Nc,S0,Zl,Qs,Lj,Mh,Fn,void 0],dr=[Nc,Ro,kn,S0,ai,ir,br,ta,yi],XA=[Ro,kn,ai,ir,br,Zl,ta,yi],jj=[Zl,Qs,Mh,Fn],Gj={ABANDONED:Ro,AWAITING_RESULT:Vy,BYE:Ui,CANCELLED:Nc,COMPLETED:kn,DEAD_RUBBER:S0,DEFAULTED:ai,DOUBLE_WALKOVER:ir,DOUBLE_DEFAULT:br,IN_PROGRESS:Zl,INCOMPLETE:Qs,NOT_PLAYED:Lj,RETIRED:ta,SUSPENDED:Mh,TO_BE_PLAYED:Fn,WALKOVER:yi},it="MAIN",gt="QUALIFYING",pa="CONSOLATION",$r="VOLUNTARY_CONSOLATION",Nn="PLAY_OFF",Hj=[it,gt,pa,Nn,$r],Jv={[gt]:1,[it]:2,[Nn]:3,[pa]:3,[$r]:4},Mte="finishingPositions",Nte="aggregateEventStructures",Ate={[it]:1,[Nn]:2,[pa]:3,[gt]:4,[$r]:5},DPe={[Nn]:1,[it]:2,[pa]:3,[gt]:4,[$r]:5},JA="CLUSTER",PPe="SEPARATE",$m="WATERFALL",QA="ITEM",ro="CONTAINER",Pl="DRAW",e_="RANDOM",Cl="TOP_DOWN",Vm="BOTTOM_UP",wp="POSITION",Sp="WINNER",yd="LOSER",bd="FIRST_MATCHUP",el="AD_HOC",EPe="AD_HOC",T0="FEED_IN",QI="COMPASS",ew="OLYMPIC",CPe="SINGLE_ELIMINATION",ac="SINGLE_ELIMINATION",H1="DOUBLE_ELIMINATION",tw="FIRST_MATCH_LOSER_CONSOLATION",z1="FIRST_ROUND_LOSER_CONSOLATION",bg="LUCKY_DRAW",t_="CURTIS_CONSOLATION",RPe="CURTIS_CONSOLATION",zj="FEED_IN_CHAMPIONSHIP_TO_SF",fU="FEED_IN_CHAMPIONSHIP_TO_SF",qj="FEED_IN_CHAMPIONSHIP_TO_QF",hU="FEED_IN_CHAMPIONSHIP_TO_QF",Wj="FEED_IN_CHAMPIONSHIP_TO_R16",mU="FEED_IN_CHAMPIONSHIP_TO_R16",_te="MODIFIED_FEED_IN_CHAMPIONSHIP",gU="MODIFIED_FEED_IN_CHAMPIONSHIP",q1="FEED_IN_CHAMPIONSHIP",MPe="DOUBLE_ROUND_ROBIN",jl="ROUND_ROBIN",Id="ROUND_ROBIN_WITH_PLAYOFF",kte="DECIDER",Ote="BACKDRAW",Kj={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Yj={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},U0="WIN_RATIO",jy="ROUND_OUTCOME",xte=[QI,t_,hU,mU,fU,q1,qj,Wj,zj,tw,z1,bg,gU,ew,Nn,Id],NPe=[el,QI,t_,H1,hU,mU,fU,q1,T0,tw,z1,bg,gU,ew,Nn,jl,Id,ac],rr={MAIN:it,QUALIFYING:gt,CONSOLATION:pa,ITEM:QA,CONTAINER:ro,FIRST_MATCHUP:bd,WINNER:Sp,LOSER:yd,AD_HOC:el,FEED_IN:T0,FLEX_ROUNDS:EPe,COMPASS:QI,PLAY_OFF:Nn,OLYMPIC:ew,KNOCKOUT:CPe,SINGLE_ELIMINATION:ac,DOUBLE_ELIMINATION:H1,CURTIS:t_,FICSF:zj,FICQF:qj,FICR16:Wj,MFIC:_te,VOLUNTARY_CONSOLATION:$r,FIRST_MATCH_LOSER_CONSOLATION:tw,FIRST_ROUND_LOSER_CONSOLATION:z1,MODIFIED_FEED_IN_CHAMPIONSHIP:gU,FEED_IN_CHAMPIONSHIP_TO_R16:mU,FEED_IN_CHAMPIONSHIP_TO_QF:hU,FEED_IN_CHAMPIONSHIP_TO_SF:fU,FEED_IN_CHAMPIONSHIP:q1,LUCKY_DRAW:bg,ROUND_ROBIN_WITH_PLAYOFF:Id,ROUND_ROBIN:jl,DECIDER:kte,BACKDRAW:Ote,COMPASS_ATTRIBUTES:Kj,OLYMPIC_ATTRIBUTES:Yj,DRAW:Pl,RANDOM:e_,TOP_DOWN:Cl,BOTTOM_UP:Vm,WATERFALL:$m,WIN_RATIO:U0,ROUND_OUTCOME:jy,MULTI_STRUCTURE_DRAWS:xte,generatedDrawTypes:NPe,stageOrder:Jv,finishOrder:Ate,AGGREGATE_EVENT_STRUCTURES:Nte,FINISHING_POSITIONS:Mte},APe=rr;function Gy(t,e,i){var d,p;let n=f=>{var h,m;return(m=(h=$t({element:f,name:Mc}))==null?void 0:h.extension)==null?void 0:m.value},r=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Nte&&DPe,o=(i==null?void 0:i.mode)===Mte&&Ate,s=o||a||Jv,l=f=>(f==null?void 0:f.stage)===it&&(f==null?void 0:f.stageSequence)===1,u=f=>l(f)?-1:s[f==null?void 0:f.stage],c=f=>f==null?void 0:f.matchUps.every(({matchUpStatus:h})=>dr.includes(h)?1:-1);return r&&c(t)-c(e)||a&&u(t)-u(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(n(t)||0)-(n(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(fM(t)||0)-(fM(e)||0)}function fM(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function Dt(t){let e=Lt(t,[{[ll]:!0,[Ij]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=wd({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:Sn};let s=o.structureType===QA?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function wd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var h;let l=!e&&ot||!(e!=null&&e.structures)&&VV||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let u=m=>{var v,y;let g=(y=(v=$t({element:m,name:Mc}))==null?void 0:v.extension)==null?void 0:y.value;return!r||r===g},c=((h=e==null?void 0:e.structures)==null?void 0:h.filter(p).filter(f).filter(u).sort((m,g)=>Gy(m,g,a)))??[],d=t?Object.assign({},...Hj.map(m=>{let g=c==null?void 0:c.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:c,stageStructures:d};function p(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function f(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function Lte({drawDefinition:t}){if(!t)return{error:ot};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Gi({structure:i}),a=(r==null?void 0:r.map(Jt).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Gi({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:ot};if({structure:i,error:n}=Dt({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Gi({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=tee,{positionAssignments:r,error:n}}function _r({drawDefinition:t,structureId:e,structure:i}){var u;let n=((u=Gi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:u.positionAssignments)||[],r=n==null?void 0:n.filter(c=>c.participantId??c.bye??c.qualifier),a=n&&(n==null?void 0:n.length)===(r==null?void 0:r.length),o=n==null?void 0:n.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),s=n==null?void 0:n.filter(c=>!c.participantId&&c.bye),l=n==null?void 0:n.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:a,positionAssignments:n,unassignedPositions:o,assignedPositions:r,qualifierPositions:l,byePositions:s}}var Zj="addDrawDefinition",i_="addMatchUps",th="addParticipants",Xj="addScaleItems",Jj="addVenue",iw="audit",Qj="dataIssue",eG="deleteParticipants",tG="deleteVenue",iG="deletedDrawIds",nG="deletedMatchUpIds",rG="modifyDrawDefinition",Fte="modifyDrawEntries",Bte="modifyEventEntries",aG="modifyMatchUp",fa="modifyParticipants",oG="modifyPositionAssignments",sG="modifySeedAssignments",Hy="modifyTournamentDetail",Ig="modifyVenue",vU="mutations",S2="publishEvent",$te="publishEventSeeding",Vte="publishOrderOfPlay",lG="unPublishEvent",uG="unPublishEventSeeding",cG="unPublishOrderOfPlay",n_="updateInContextMatchUp",jte={ADD_DRAW_DEFINITION:Zj,ADD_MATCHUPS:i_,ADD_PARTICIPANTS:th,ADD_SCALE_ITEMS:Xj,ADD_VENUE:Jj,AUDIT:iw,DATA_ISSUE:Qj,DELETE_PARTICIPANTS:eG,DELETE_VENUE:tG,DELETED_DRAW_IDS:iG,DELETED_MATCHUP_IDS:nG,MODIFY_DRAW_DEFINITION:rG,MODIFY_DRAW_ENTRIES:Fte,MODIFY_EVENT_ENTRIES:Bte,MODIFY_MATCHUP:aG,MODIFY_PARTICIPANTS:fa,MODIFY_POSITION_ASSIGNMENTS:oG,MODIFY_SEED_ASSIGNMENTS:sG,MODIFY_TOURNAMENT_DETAIL:Hy,MODIFY_VENUE:Ig,MUTATIONS:vU,PUBLISH_EVENT_SEEDING:$te,PUBLISH_EVENT:S2,PUBLISH_ORDER_OF_PLAY:Vte,UNPUBLISH_EVENT_SEEDING:uG,UNPUBLISH_EVENT:lG,UNPUBLISH_ORDER_OF_PLAY:cG,UPDATE_INCONTEXT_MATCHUP:n_};function r_(t,e){var a;if(!t)return{error:ot};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(r!=null&&r.length)||r!=null&&r.includes(o.structureId))&&(o.updatedAt=n)}),{...re}}function ih({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&r_(t),jt({payload:{matchUps:i,tournamentId:e,eventId:n},topic:i_}),{...re}}function Wp({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&r_(t),jt({topic:nG,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)mj({key:a});return{...re}}function ci({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Ji({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),jt({topic:aG,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...re}):(console.log(Eo),{error:Eo})}function _Pe({tournamentId:t,inContextMatchUp:e}){return e?(jt({payload:{inContextMatchUp:e,tournamentId:t},topic:n_,key:e.matchUpId}),{...re}):{error:Eo}}function W1({tournamentId:t,eventId:e,drawDefinition:i}){return i?(r_(i),jt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:Zj,key:i.drawId}),{...re}):(console.log(ot),{error:ot})}function kPe({tournamentId:t,eventId:e,drawId:i}){return jt({payload:{drawId:i,tournamentId:t,eventId:e},topic:iG,key:i}),mj({key:i}),{...re}}function Ji({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(r_(t,i),jt({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:rG,key:t.drawId}),{...re}):{error:ot}}function Gte({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:ot};if(!i)return{error:Uh};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return jt({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:sG,key:t.drawId}),Ji({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...re}}function nh({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:ot};if(!i)return{error:Uh};let r=Gi({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return jt({topic:oG,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),Ji({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...re}}function Hte({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var o,s;if(!e)return{error:ot};let r=(o=e.structures)==null?void 0:o.find(l=>l.stage===$r);if(!r)return{error:Sn};let a=((s=r.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],Wp({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==$r)),Ji({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...re}}function dG({drawPositions:t,structure:e}){var n;if([gt,it].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Gi({structure:e});(n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||n.forEach(r=>{fi({element:r,extension:{name:YA,value:!0}})})}function a_(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:n}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[ST])===!1)return;let{extension:r}=$t({name:ST,element:n}),a=Array.isArray(r==null?void 0:r.value)?(r==null?void 0:r.value)??[]:[];if(!(a!=null&&a.length)){let u=n.structures.find(c=>c.stage===it);if(u){let c=(l=Gi({structure:u}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:f,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:f}));a.push({name:"initialMainAssignments",initialAssignments:c})}}let o={value:a.concat(i),name:ST};fi({element:n,extension:o})}function D0({tournamentRecord:t,drawDefinition:e,event:i}){var s;let n=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],r={},a={},o=n.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of o){let{structures:u,structureId:c}=l??{};u&&c&&(r[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:r,containerStructures:a}}var wv="SINGLES",sn="SINGLES",jm="DOUBLES",Wi="DOUBLES",gc="TEAM",Zi="TEAM",zte={SINGLES_MATCHUP:wv,SINGLES:sn,DOUBLES_MATCHUP:jm,DOUBLES:Wi,TEAM_MATCHUP:gc,TEAM:Zi};function o_(t){var a;let{sides:e,matchUpType:i}=t||{},n=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===Wi?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],r=(e||[]).map(o=>{var s;return i===Wi&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function Ac(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var K1="SIGN_IN_STATUS",qte="SIGNED_OUT",yU="SIGNED_IN",zs="TEAM",Qt="INDIVIDUAL",ws="GROUP",Ot="PAIR",Fi="TEAM",MI={TEAM_PARTICIPANT:zs,INDIVIDUAL:Qt,GROUP:ws,TEAM:Fi,PAIR:Ot},Ra={INDIVIDUAL:Qt,GROUP:ws,PAIR:Ot,TEAM:Fi,SIGN_IN_STATUS:K1,SIGNED_OUT:qte,SIGNED_IN:yU};function pG({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?st(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===Fi),o=r.filter(l=>l.participantType===ws),s=r.filter(l=>l.participantType===Ot);return r.forEach(l=>{if(l.participantType===Qt){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),n.get(c.participantId)||n.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function Wte(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function OPe(t){let e=Object.assign({},...Hf.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return Wte(e[t])}var Hf=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Kte({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=Hf.find(({iso:c})=>c===l);i&&(u!=null&&u.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&(u!=null&&u.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function xPe({participantMap:t,template:e}){var n;let i=Object.values(t);for(let r of i){let a=r.participant;if((n=a.individualParticipantIds)!=null&&n.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Kv({template:e,source:s}):s)}}}}function Nh(t){var r;let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(n)){let o=(r=a.participants)==null?void 0:r.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:_n}}function Yte(t){let{tournamentRecord:e,participantId:i}=t;if(i){let r=Nh({tournamentRecord:e,participantId:i});return r.participant??r}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:ht}}function _c(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:n}=t,r=Yte(t);if(r.error)return r;if(i&&!Array.isArray(i))return{error:we,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:rj};let a=r.timeItems.filter(s=>(s==null?void 0:s.itemType)===n).filter(s=>!(i!=null&&i.length)||i.some(l=>{var u;return(u=s==null?void 0:s.itemSubTypes)==null?void 0:u.includes(l)})).sort((s,l)=>{let u=new Date(s.createdAt||void 0).getTime(),c=new Date(l.createdAt||void 0).getTime();return u-c}),o=a.pop();if(o){let s={timeItem:o,...re};return e&&Object.assign(s,{previousItems:a}),s}else return{info:Hr}}function fG({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:qu};if(!e.timeItems)return{info:Hr};let{timeItem:r,previousItems:a,info:o}=_c({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function Y1({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:ji};if(!n.timeItems)return{info:Hr};let{timeItem:r,previousItems:a,info:o}=_c({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function Z1({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Fe};if(!e.timeItems)return{info:Hr};let{timeItem:r,previousItems:a,info:o}=_c({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function hG({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:Fe};if(!i)return{error:cr};let a=Nh({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Hr};let{timeItem:s,previousItems:l,info:u}=_c({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:u}}var LPe={[ws]:"groupParticipantIds",[Ot]:"pairParticipantIds",[Fi]:"teamParticipantIds"},FPe={[ws]:"groups",[Fi]:"teams"};function Zte({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let u of i.participants??[]){let c=u==null?void 0:u.participantId;c&&VPe({participantMap:l,participantId:c})}for(let u of i.participants??[]){let c=st(u,e,a),{participantId:d,individualParticipantIds:p,participantType:f}=c;if(Object.assign(l[d].participant,c),p&&$Pe({individualParticipantIds:p,participantCopy:c,participantMap:l,participantType:f,participantId:d}),n&&(l[d].participant.signedIn=BPe(c)),r){let{ratings:h,rankings:m,seedings:g}=y0({participant:c});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=h}(s||o)&&Kte({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let u=Ii(t)?t:void 0;xPe({participantMap:l,template:u})}return{participantMap:l}}function BPe(t){let{timeItem:e}=_c({itemType:K1,element:t});return(e==null?void 0:e.itemValue)===yU}function $Pe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let a of t){let o=i[a].participant;if(o[LPe[n]].push(r),[Fi,ws].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:u,participantId:c,teamId:d}=e,p=FPe[n];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:u,participantId:c,teamId:d})}if(n===Ot){let s=t.find(l=>l!==a);i[a].pairIdMap[r]=s,i[a].pairIdMap[s]=r}}}function VPe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[sn]:{...i},[Wi]:{...i},[Fi]:{...i},...i}}}function zy({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var s;if(e)return{participantMap:(s=Zte({...t,...n,tournamentRecord:i}))==null?void 0:s.participantMap};let a=st(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(l=>Kte({participant:l,...t}));let o;if((r||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=pG({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let l of a){let{ratings:u,rankings:c}=y0({participant:l});l.rankings=c,l.ratings=u}return{participants:a,groupInfo:o}}function mi({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:qV};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...re};function s(l){var c,d;let u=(d=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===dU))==null?void 0:d.value;if(u)for(let p of Object.keys(u))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=st(u[p],!1,!0))}}function Kp({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:qV};let{appliedPolicies:a}=mi({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Iv.message}}var Xte="WALKOVER",S7="RETIRED",mG="COMPETITIVE",bU="ROUTINE",IU="DECISIVE",rR="winRatio",jPe={[tp]:{policyName:"Competitive Bands Default",profileBands:{[IU]:20,[bU]:50}}},gG=jPe;function Yp({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=Kp({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[tp])??(o==null?void 0:o[tp])??gG[tp];a.policies[tp]=s}return a}function wg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:Fe};let{appliedPolicies:a}=mi({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:Iv==null?void 0:Iv.message}}function X1({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var s,l,u,c,d,p;e=e??((s=n==null?void 0:n.category)==null?void 0:s.categoryName)??((l=n==null?void 0:n.category)==null?void 0:l.ageCategoryCode),i=i??((u=n==null?void 0:n.category)==null?void 0:u.categoryType)??((c=n==null?void 0:n.category)==null?void 0:c.subType);let{policy:r}=wg({policyType:Ch,tournamentRecord:t,event:n}),a=(d=t?$t({element:t,name:Ip}).extension:void 0)==null?void 0:d.value,o=(p=n&&$t({name:Ip,element:n}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:r}}}function vG({drawDefinition:t,attributes:e}){let{extension:i}=$t({element:t,name:pM}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:pM,value:n},qA({drawDefinition:t,extension:i}),{entryProfile:n}}function J1({drawDefinition:t}){let{extension:e}=$t({element:t,name:pM});return{entryProfile:(e==null?void 0:e.value)||{}}}var Al="ALTERNATE",Q1="CONFIRMED",Wo="DIRECT_ACCEPTANCE",eD="FEED_IN",tD="JUNIOR_EXEMPT",Tp="LUCKY_LOSER",iD="ORGANISER_ACCEPTANCE",nD="QUALIFIER",GPe="REGISTERED",rD="SPECIAL_EXEMPT",Xl="UNGROUPED",Sg="UNPAIRED",nw="WILDCARD",Sd="WITHDRAWN",aR=[Q1,Wo,tD,iD,rD],Jte=[eD,Tp,nD],Tg=[Q1,Wo,eD,tD,iD,rD,nw],Jl=[Q1,Wo,tD,Tp,nD,iD,rD,nw],Qte=[Al,Q1,Wo,eD,tD,Tp,iD,nD,GPe,rD,Xl,Sg,nw,Sd],Ql={ALTERNATE:Al,CONFIRMED:Q1,DIRECT_ACCEPTANCE:Wo,DIRECT_ENTRY_STATUSES:Tg,DRAW_SPECIFIC_STATUSES:Jte,EQUIVALENT_ACCEPTANCE_STATUSES:aR,FEED_IN:eD,JUNIOR_EXEMPT:tD,LUCKY_LOSER:Tp,ORGANISER_ACCEPTANCE:iD,QUALIFIER:nD,SPECIAL_EXEMPT:rD,STRUCTURE_SELECTED_STATUSES:Jl,UNGROUPED:Xl,UNPAIRED:Sg,VALID_ENTRY_STATUSES:Qte,WILDCARD:nw,WITHDRAWN:Sd};function yG({stage:t,drawDefinition:e}){let{entryProfile:i}=J1({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&Hj.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return vG({drawDefinition:e,attributes:r}),!0}return n}function HPe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=J1({drawDefinition:e});return((n=i[t])==null?void 0:n.alternates)||0}function zPe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=J1({drawDefinition:e});return((n=i[t])==null?void 0:n.wildcardsCount)||0}function T2({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function qy({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var v,y;let f=(y=(v=$t({name:Mc,element:p}))==null?void 0:v.extension)==null?void 0:y.value,h=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),m=!r||p.entryStatus&&r.includes(p.entryStatus),g=p.entryStageSequence??1;return h&&(!n||g===n)&&m&&(!o||!f||o===f)?d.concat(p):d},[]))??[];if(a&&l===Nn){let{playoffEntries:d,error:p}=qPe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(f=>!e||f.placementGroup===e)}return u}function qPe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===wp&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=Dt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===ro&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{var y;let{participantId:g}=m,v=(y=$t({element:m,name:eh}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||f)&&h.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(sr).indexOf(I)+1;n.push({entryStage:Nn,entryStatus:eD,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function WPe({stage:t,drawDefinition:e}){return Tg.reduce((i,n)=>(T2({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function tl({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var h;let a,o=[];r||({structure:r,error:a}=Dt({drawDefinition:i,structureId:n}));let s=Gi({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:Sn};n||(n=r.structureId);let{stage:l,stageSequence:u}=r,c=l===Nn&&i&&qy({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:l}),d=c?c.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:r.seedAssignments?o=r.seedAssignments:a=qQ;let f=r.seedLimit??((h=r==null?void 0:r.positionAssignments)==null?void 0:h.length);return{seedAssignments:o,stageSequence:u,seedLimit:f,stage:l,error:a}}var KPe=(t,e)=>(t||0)+(e||0);function eie(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Xte||i<=e[IU]&&IU||i<=e[bU]&&bU||mG}function tie({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(KPe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function YPe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function iie(t){return t.map(YPe).sort().map(e=>parseFloat(e.toFixed(2)))}function aD({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Eo};let{score:n,winningSide:r}=i;if(!r)return{error:we};let a=!e&&t&&wg({policyType:tp,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||gG[tp].profileBands,s=tie({score:n}),l=iie([s]),u=eie(l,o),c=Array.isArray(l)?l[0]:l;return{...re,competitiveness:u,pctSpread:c}}function nie({matchUp:t}){var o,s,l;if(!t)return{error:Eo};if(t&&!t.sides)return{error:Co};if(t&&!t.hasContext)return{error:OA};let e=(o=t.sides??[])==null?void 0:o.map(u=>u==null?void 0:u.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===Qt}).map(u=>u.participantId).filter(Boolean))??[],n=(((l=t.sides??[])==null?void 0:l.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],a=Vt(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:a,individualParticipantIds:r,sideParticipantIds:e,...re}}var hM="CHECK_IN",mM="CHECK_OUT",ZPe="SCHEDULE",P0="SCHEDULE.ASSIGNMENT.VENUE",Up="SCHEDULE.ALLOCATION.COURTS",Gm="SCHEDULE.ASSIGNMENT.COURT",bG="SCHEDULE.COURT.ORDER",E0="SCHEDULE.DATE",XPe="COMPLETED.DATE",rie="HOME_PARTICIPANT_ID",aie="SCHEDULE.ASSIGN.OFFICIAL",C0="SCHEDULE.TIME.SCHEDULED",Iu="SCHEDULE.TIME.START",cp="SCHEDULE.TIME.STOP",id="SCHEDULE.TIME.RESUME",Dp="SCHEDULE.TIME.END",IG="SCHEDULE.TIME.MODIFIERS",oie="TO_BE_ANNOUNCED",sie="NEXT_AVAILABLE",lie="FOLLOWED_BY",uie="AFTER_REST",cie="RAIN_DELAY",JPe="NOT_BEFORE",U2=[oie,sie,lie,uie,cie],QPe="ELIGIBILITY",eEe="REGISTRATION",tEe="SUSPENSION",iEe="MEDICAL",nEe="PENALTY",die="SCALE",pie="RATING",fie="RANKING",wG="SEEDING",Ug="PUBLISH",eu="PUBLIC",Dg="STATUS",rEe="MODIFICATION",aEe="RETRIEVAL",oEe="other",s_={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:U2,AFTER_REST:uie,ALLOCATE_COURTS:Up,ASSIGN_COURT:Gm,ASSIGN_OFFICIAL:aie,ASSIGN_VENUE:P0,CHECK_IN:hM,CHECK_OUT:mM,COMPLETED_DATE:XPe,COURT_ORDER:bG,ELIGIBILITY:QPe,END_TIME:Dp,FOLLOWED_BY:lie,MEDICAL:iEe,MODIFICATION:rEe,NEXT_AVAILABLE:sie,NOT_BEFORE:JPe,OTHER:oEe,PENALTY:nEe,PUBLIC:eu,PUBLISH:Ug,RANKING:fie,RATING:pie,RAIN_DELAY:cie,REGISTRATION:eEe,RESUME_TIME:id,RETRIEVAL:aEe,SCALE:die,SCHEDULE:ZPe,SCHEDULED_DATE:E0,SCHEDULED_TIME:C0,SEEDING:wG,START_TIME:Iu,STATUS:Dg,STOP_TIME:cp,SUSPENSION:tEe,TIME_MODIFIERS:IG,TO_BE_ANNOUNCED:oie};function Wy({matchUp:t}){if(!t)return{error:Eo};if(!t.hasContext)return{error:OA};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:Co};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=nie({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[hM,mM].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===hM);e==null||e.forEach((s,l)=>{let u=n==null?void 0:n[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...re}}var hie={[sn]:[sn,"S"],[Wi]:[Wi,"D"],[Zi]:[Zi,"T"],S:[sn,"S"],D:[Wi,"D"],T:[Zi,"T"]},On=t=>e=>{let i=Ii(e)&&(e==null?void 0:e.matchUpType)||zn(e)&&e;return i&&hie[t].includes(i)};function UT(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],r=n.includes(i)?i:n[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>r===l))&&s))==null?void 0:a.averageTimes}function DT(t){var r;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return(r=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:u=360}=o;if(i>l&&i<u)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:r.recoveryTimes}function mie({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function sEe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&DT({...e,averageMinutes:i,matchUpFormat:r}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&DT({...t,averageMinutes:i,matchUpFormat:r}),c=(s==null?void 0:s.matchUpRecoveryTimes)&&DT({...s,averageMinutes:i,matchUpFormat:r}),d=[l,u,c,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,n==null?void 0:n.recoveryTimes];return mie({categoryName:a,categoryType:o,timesBlockArray:d})}function lEe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&UT({...a,matchUpFormat:t}),l=(r==null?void 0:r.matchUpAverageTimes)&&UT({...r,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&UT({...o,matchUpFormat:t}),c=[s,l,u,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,n==null?void 0:n.averageTimes];return mie({categoryName:e,categoryType:i,timesBlockArray:c})}var gie="DOUBLES_SINGLES",vie="SINGLES_DOUBLES",_l="total",D2="participantConflict",Mf="matchUpConflict",yie="ISSUE_IDS",cm="CONFLICT",dm="WARNING",P2="ERROR",E2="ISSUE",oR="STATE",bie={SINGLES_DOUBLES:vie,DOUBLES_SINGLES:gie,TOTAL:_l,CONFLICT_MATCHUP_ORDER:Mf,CONFLICT_PARTICIPANTS:D2,SCHEDULE_ISSUE_IDS:yie,SCHEDULE_CONFLICT:cm,SCHEDULE_WARNING:dm,SCHEDULE_ERROR:P2,SCHEDULE_ISSUE:E2,SCHEDULE_STATE:oR};function oD({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:Fe};o=o??(s==null?void 0:s.eventType)??Wv;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=X1({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),c={...u,matchUpFormat:n,categoryType:a,defaultTiming:l};return l_({eventType:o,timingDetails:c})}function l_({timingDetails:t,eventType:e}){let i=lEe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=sEe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=On(Wv)(e)?vie:gie,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function iC(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Ah({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||iC(a)<new Date(t).getTime())).sort((a,o)=>iC(a)-iC(o)).pop(),r=n&&iC(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function C2({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:C0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function Hm({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:E0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function Iie({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Up,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:st(r,!1,!0)}:i}function wie({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Gm,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function Sie({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:P0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function SG({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:IG,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Jg(t){if(gte.test(t)){let e=Pj();return new Date(`${e}T${t}`)}else return new Date(t)}function uEe({matchUp:t}){if(!t)return{error:Eo};if(!t.timeItems)return{error:rj};let e=t.timeItems.filter(n=>[Iu,cp,id,Dp].includes(n==null?void 0:n.itemType)).sort((n,r)=>Jg(n.itemValue).getTime()-Jg(r.itemValue).getTime()),i=e.reduce((n,r)=>{var l,u;let a,o=(l=r==null?void 0:r.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((u=r==null?void 0:r.itemType)==null?void 0:u.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case Iu:a=0;break;case Dp:if(n.lastValue&&[Iu,id].includes(n.lastType)){let c=Jg(r.itemValue).getTime()-Jg(n.lastValue).getTime();a=n.milliseconds+c}else a=n.milliseconds;break;case cp:if([Iu,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let c=Jg(r.itemValue).getTime()-Jg(n.lastValue).getTime();a=n.milliseconds+c}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Iu,id].includes(i.lastType)){let n=new Date().getTime()-Jg(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:cEe(i.milliseconds),relevantTimeItems:e}}function cEe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function dEe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Ah({timeItems:(n==null?void 0:n.timeItems)||[],itemType:bG,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function pEe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(n=e.reduce((r,a)=>{let o=a.itemType===Iu&&a;return o&&(!r||i(o)<i(r))?o:r},void 0))==null?void 0:n.itemValue}}function fEe(t=1){return Xe(0,t).map(Mi)}function Mi(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function sD(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:we};let r=Ac(t);i.venueId||(i.venueId=Mi());let a;for(let o of Object.values(r)){let s=hEe({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||jt({topic:Jj,payload:{venue:i}}),pt({...re,venue:a})}function hEe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=Mi()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:Pee}:(i&&fi({element:n,extension:{value:i,name:Ste}}),t.venues.push(n),e||jt({payload:{venue:n,tournamentId:t.tournamentId},topic:Jj}),{...re,venue:st(n)})):{error:ht,info:"missing venue"}:{error:Fe}}function Zp({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Fe};if(!i)return{error:Ph};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(G1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=Zp({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return sD({tournamentRecord:e,venue:s.venue}),{...re,venue:n}}}return n?{...re,venue:n}:{error:xy}}function TG({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=Zp({tournamentRecords:i,tournamentRecord:n,venueId:r});return st(a,t,!0)}function Ky({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Fe};if(!i)return{error:_y};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...re,court:r,venue:a};if(t){let o=(G1({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=Ky({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&sD({tournamentRecord:e,venue:u.venue}),{...re,court:r,venue:a}}}return le({result:{error:f0},stack:n})}function Tie(t){return st(Ky(t),!1,!0)}function u_({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Fe};if(!i)return{error:_y};let n=Ky({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(n.court);return{...re,courtInfo:st(r,!1,e)}}function rw({tournamentRecord:t,venueId:e}){var o;if(!t)return{error:Fe};if(!e)return{error:Ph};let i=Zp({tournamentRecord:t,venueId:e});if(i.error)return i;let n=(((o=i.venue)==null?void 0:o.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(u_({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),r=i.venue&&(({venueId:s,venueName:l,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:l,venueId:s}))(i.venue),a=r&&{...r,courtsInfo:n};return{...re,venueData:st(a,!1,!0)}}function mEe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(n=e.reduce((r,a)=>{let o=a.itemType===Dp&&a;return o&&(!r||i(o)>i(r))?o:r},void 0))==null?void 0:n.itemValue}}function Gn({event:t,eventId:e}){var r,a;if(!t)return{error:ji};let i=(r=$t({name:Vl,element:t}))==null?void 0:r.extension,n=e?st(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=n==null?void 0:n.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:n}}function ho(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(n){let u,c=s.find(d=>{var f,h,m;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(p)u=p,l=a[d.eventId].tournamentId;else{let g=(m=(h=d&&((f=Gn({event:d}))==null?void 0:f.flightProfile))==null?void 0:h.flights)==null?void 0:m.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return p});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...le({result:{error:zo},stack:r})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...le({result:{error:ms},context:{drawId:n,eventId:i},stack:r})}}function c_(t){let{visibilityThreshold:e,timeStamp:i,schedule:n,matchUp:r}=t,a=Lt(t,[{[xd]:!0}]);if(a.error)return a;let{itemValue:o,timeStamp:s}=Ah({timeItems:(r==null?void 0:r.timeItems)||[],itemType:rie,visibilityThreshold:e});return!n||s&&i&&new Date(s).getTime()>new Date(i).getTime()?{homeParticipantId:o}:n}function d_(t){var w,S,U,P,E,D,R,N,M;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:u,matchUp:c}=t;if(!c)return{error:Eo};if(r&&!c.matchUpType&&!t.matchUpType&&(e||a)&&c.drawId){let A=(w=e==null?void 0:e.drawDefinitions)==null?void 0:w.find(k=>k.drawId===c.drawId);!A&&a&&({drawDefinition:A,event:e}=ho({tournamentRecord:a,drawId:c.drawId}));let _=c.structureId&&((S=A==null?void 0:A.structures)==null?void 0:S.find(({structureId:k})=>k===c.structureId));i=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(e==null?void 0:e.eventType)!==vr&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=uEe({matchUp:c}),{startTime:f}=pEe({matchUp:c}),{endTime:h}=mEe({matchUp:c}),m,{visibilityThreshold:g,eventIds:v,drawIds:y}=n??{};if((!v||v.includes(c.eventId))&&(!y||y.includes(c.drawId))){let A={matchUp:c,visibilityThreshold:g},{allocatedCourts:_}=Iie(A),{homeParticipantId:k}=c_(A),{scheduledTime:B}=C2(A),{timeModifiers:F}=SG(A),{scheduledDate:x}=Hm(A),{venueId:$}=Sie(A),{courtId:j}=wie(A),{courtOrder:V}=dEe(A),H,z,q,W,Y,Z=c.matchUpType??i;if(s&&B&&r&&Z){let oe={matchUpFormat:c.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:q=0,typeChangeRecoveryMinutes:W=0}=l_({timingDetails:oe,eventType:Z})),(z||q)&&(H=h?Uo(nn(h),q):Uo(B,z+q)),W&&(Y=h?Uo(nn(h),W):Uo(B,z+W))}!x&&B&&(x=Ft(B));let X=oM({scheduledDate:x,scheduledTime:B}),Q={},ce=((U=a&&$&&rw({tournamentRecord:a,venueId:$}))==null?void 0:U.venueData)||{};$&&(Q[$]=ce);let{venueName:J,venueAbbreviation:ee,courtsInfo:ne}=ce,ie=(P=j&&(ne==null?void 0:ne.find(oe=>oe.courtId===j)))==null?void 0:P.courtName;for(let oe of _||[]){if(!a)break;oe.venueId&&!Q[oe.venueid]&&(Q[oe.venueId]=(E=rw({venueId:oe.venueId,tournamentRecord:a}))==null?void 0:E.venueData);let se=Q[oe.venueId];oe.venueName=se==null?void 0:se.venueName;let pe=(D=se==null?void 0:se.courtsInfo)==null?void 0:D.find(fe=>fe.courtId===oe.courtId);oe.courtName=pe==null?void 0:pe.courtName}m=pt({typeChangeTimeAfterRecovery:Y,timeAfterRecovery:H,scheduledDate:x,scheduledTime:B,isoDateString:X,allocatedCourts:_,homeParticipantId:k,timeModifiers:F,venueAbbreviation:ee,venueName:J,venueId:$,courtOrder:V,courtName:ie,courtId:j,typeChangeRecoveryMinutes:W,recoveryMinutes:q,averageMinutes:z,milliseconds:d,startTime:f,endTime:h,time:p})}else m=pt({milliseconds:d,startTime:f,endTime:h,time:p});let{scheduledDate:b}=Hm({matchUp:c}),{scheduledTime:I}=C2({matchUp:c});if(o&&((R=u==null?void 0:u.displaySettings)!=null&&R.draws)){let A=u.displaySettings.draws,_=(N=(A==null?void 0:A[c.drawId])??(A==null?void 0:A.default))==null?void 0:N.scheduleDetails;if(_){let k=(M=_.find(B=>{var F;return b&&((F=B.dates)==null?void 0:F.includes(b))})??_.find(B=>{var F;return!((F=B.dates)!=null&&F.length)}))==null?void 0:M.attributes;if(k){let B=Object.assign({},...Object.keys(m).map(F=>({[F]:!0})),k);m=Kv({source:m,template:B})}}}let T=c.matchUpStatus&&dr.includes(c.matchUpStatus)&&(Ft(h)||Ft(b)||Ft(I))||void 0;return{schedule:m,endDate:T}}function kf(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function PT({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(l=>t.tieFormatId===l.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function Aa({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:PT({item:i,drawDefinition:t,structure:e,event:n})||PT({item:e,drawDefinition:t,structure:e,event:n})||kf(t)||kf(n)}}function gEe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function ga({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{n.push(c),c.tieMatchUps&&n.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function zm({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(u=>Object.assign(st(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}function Uie({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=zr(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(sr);return i.map(r=>n.indexOf(r)+1)}function p_(t){if(!Ii(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>Nt(a)||a===void 0||a===null);return n&&r}function cl(t){return Array.isArray(t)?t.every(p_):!1}function Za({matchUps:t=[],interpolate:e}){var d;if(!cl(t))return{roundMatchUps:[],error:we};let i=t.reduce((p,f)=>{let h=typeof f.roundNumber=="string"?St(f.roundNumber):f.roundNumber;return!f.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(sr).map(p=>{let f=t.filter(g=>g.roundNumber===p),h=f.find(({matchUpType:g})=>g===Zi)?f.filter(({matchUpType:g})=>g===Zi):f,m=g=>g.sort((v,y)=>sr(v.roundPosition,y.roundPosition));return{[p]:m(h)}}),n=t.reduce((p,f)=>{let h=typeof f.roundNumber=="string"?St(f.roundNumber):f.roundNumber;return p[h]||(p[h]=pt({abbreviatedRoundName:f.abbreviatedRoundName,finishingRound:f.finishingRound,roundName:f.roundName})),p},{}),r=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(r).map(h=>St(h)).filter(h=>!isNaN(h))),f=(d=r[p])==null?void 0:d.length;if(f>1&&xu(f)){let h=p+1,m=h+f/2;Xe(h,m).forEach((g,v)=>{r[g]=Xe(0,f/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(r).map(p=>{var g,v,y;let f=(g=r[p])==null?void 0:g.length,h=(y=(v=r[p])==null?void 0:v.filter(b=>{var I;return!dr.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:y.length,m=f&&f===h;return a=Math.max(a,f),{[p]:{matchUpsCount:f,inactiveCount:h,inactiveRound:m}}})),s=0,l=0,u=Object.keys(r).map(p=>St(p)).filter(p=>!isNaN(p));u.forEach(p=>{var m,g,v,y,b;let f=r[p].sort((I,T)=>I.roundPosition-T.roundPosition),h=f.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,o[p].roundName=(g=n[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=n[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(b=(y=r[p])==null?void 0:y[0])==null?void 0:b.finishingPositionRange,p===1||!o[p-1]){let I=h.sort(sr),T=zr(I,2);o[p].drawPositions=I,o[p].pairedDrawPositions=T}else{let I=o[p-1],T=I.drawPositions,w=I.matchUpsCount/o[p].matchUpsCount,S=zr(T,w),U=f.map(P=>{let{roundPosition:E}=P,D=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return D;let R=(D==null?void 0:D.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return D==null?void 0:D.slice().sort(sr);let N=Ln(T,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:D==null?void 0:D.slice().sort(sr);let M=(E-1)*2;return S.slice(M,M+2).map(A=>R==null?void 0:R.find(_=>A.includes(_)))});o[p].drawPositions=U==null?void 0:U.flat(),o[p].pairedDrawPositions=U}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let c=!!Object.values(o).find(({matchUpsCount:p})=>!xu(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:c,maxMatchUpsCount:a,roundMatchUps:r,roundNumbers:u,roundProfile:o,...re}}function sR(t){if(!Array.isArray(t))return"";let e=t.filter(Dn);return e.length?Vt([Math.min(...e),Math.max(...e)]).join("-"):""}function vEe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:ot};if(!e)return{error:Is};let{structure:n}=Dt({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==pa)return{error:vg,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[]))||[],s=Object.assign({},...o.map(d=>{let p=zm({structureId:d,matchUpsMap:i}),f=Za({matchUps:p}).roundProfile;return{[d]:f}})),l=zm({matchUpsMap:i,structureId:e}),{roundProfile:u}=Za({matchUps:l}),c={};return a==null||a.forEach(d=>{var R,N,M;let{structureId:p,roundNumber:f}=d.source,{feedProfile:h,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=s[p],b=(R=y[1])==null?void 0:R.drawPositions,I=(N=y[f])==null?void 0:N.matchUpsCount;if(!I)return;let T=I?b.length/I:0,w=b.length/T,S=b.slice(),U=Uie({roundPositionsCount:w,groupedOrder:m}),P=(U==null?void 0:U.length)||1;if(P<=w){let A=b.length/P,_=zr(S,A);h===Vm&&_.forEach(k=>k.reverse()),S=(U==null?void 0:U.length)&&(U==null?void 0:U.map(k=>_[k-1]).flat())||S}let E=zr(S,T);if(g){let A=Xe(0,g.interleave).map(()=>{}),_=Xe(0,g.offset).map(()=>{});E=E.map(B=>[B,...A]),E.unshift(_),E=E.flat(1);let k=E.length-g.offset;E=E.slice(0,k)}c[v]||(c[v]={});let D=(M=u==null?void 0:u[v])!=null&&M.feedRound?2:1;E.forEach((A,_)=>{let k=1+_*D;c[v][k]||(c[v][k]=sR(A))})}),{sourceDrawPositionRanges:c}}function yEe({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let n=[void 0,void 0];if(Xee(t))return{orderedDrawPositions:n,displayOrder:n};let r=e==null?void 0:e[i],a=((s=r==null?void 0:r.pairedDrawPositions)==null?void 0:s.find(l=>Ya(l||[],t.filter(Boolean))))??n,o=r==null?void 0:r.feedRound;if(Zee(t)){let l=[...t].sort(sr);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(u=>!isNaN(St(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function gM({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;n.includes(l)||(u&&r.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),n=n.filter(d=>d!==u),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Gl({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:Fe};if(!Array.isArray(i)||i.length>2)return{error:Hs};if(!i.length)return le({result:{error:Dh},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===Ot&&Ln(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return le({result:{error:_n},stack:n});let o=st(r.slice(1),!1,!0);return{participant:st(a),duplicatedPairParticipants:o,...re}}function qm({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:ot};if(typeof e!="string")return{error:cr};let{extension:i}=$t({element:t,name:bp});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function bEe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{var g,v,y,b;let{assignedParticipantIds:h,substitutions:m}=gM({collectionPosition:i,collectionId:o,lineUp:p});if(l===Wi){if((h==null?void 0:h.length)<=2){let I=(v=(g=r==null?void 0:r[h[0]])==null?void 0:g.pairIdMap)==null?void 0:v[h[1]],T=(b=I&&((y=r[I])==null?void 0:y.participant)||Gl({participantIds:h,tournamentParticipants:t}).participant)==null?void 0:b.participantId;return{[d]:{participantId:T,teamParticipant:f,substitutions:m}}}else if((h==null?void 0:h.length)>2)return{[d]:{teamParticipant:f,substitutions:m}}}else{let I=h==null?void 0:h[0];return I&&{[d]:{participantId:I,teamParticipant:f,substitutions:m}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:f,sideNumber:h}=p,m=p.lineUp||((g=qm({participantId:f.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return u({attribute:h,lineUp:m,teamParticipant:f})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(n==null?void 0:n.map(d=>{var g,v,y;let p=(g=e.find(b=>b.drawPosition===d))==null?void 0:g.participantId,f=s==null?void 0:s.find(b=>(b==null?void 0:b.drawPosition)===d),h=(f==null?void 0:f.teamParticipant)||p&&((v=r==null?void 0:r[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:b})=>b===p)),m=(f==null?void 0:f.lineUp)||((y=qm({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return u({attribute:d,lineUp:m,teamParticipant:h})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function Die({drawDefinition:t}){if(typeof t!="object")return{error:bv};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[pa,Nn].includes(d)||o[l].push(s);let p=n.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,g=f.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:c,stage:v})}}}function IEe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var o;if(!t)return{error:ot};if(!i)return{error:Is};if(!e){let s=zm({matchUpsMap:n,structureId:i});if({roundProfile:e}=Za({matchUps:s}),!e)return{error:ht}}let r=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,u=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],c=zr(u,u.length/l),d=c.map(sR),p=c.map(b=>b.map(I=>I-r)).map(sR),f=a.map(b=>{var T;if(b>s)return;let I=((T=e==null?void 0:e[b])==null?void 0:T.drawPositions)??[];return zr(I,I.length/l)}).filter(Boolean),h=Xe(0,l).map(b=>f.map(I=>I[b]).flat().filter(Boolean).sort(sr)).map(b=>Vt(b)),m=h.map(b=>EDe(b).map(sR).join(", ")),g=Object.assign({},...Xe(0,l).map(b=>({[b+1]:{firstRoundDrawPositionsRange:d[b],firstRoundOffsetDrawPositionsRange:p[b],possibleDrawPositions:h[b],drawPositionsRange:m[b]}})));return{[s]:g}}))}}function UG({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var a;if(!i)return!1;n=n??i.matchUps??[],t=t??Za({matchUps:n}).roundsNotPowerOf2;let r=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==bg)&&!(i!=null&&i.structures)&&t&&r}function Ko({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==$r&&(!e.length||!i&&!n)}var DG={[ZI]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[it]:"",[Nn]:"P",[gt]:"Q",[pa]:"C"}}},wEe=DG;function SEe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var R,N,M;let{roundProfile:r,roundMatchUps:a}=Za({matchUps:n}),{structureAbbreviation:o,stage:s}=i,l=Ko({structure:i}),u=UG({structure:i}),c=i.structures,d={},p=DG[ZI],f=i.stage===gt,h=f?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===gt).map(({stageSequence:A})=>A??1),0):0,m=(i.stageSequence??1)<h?i.stageSequence??1:"",g=m&&(((R=t==null?void 0:t.affixes)==null?void 0:R.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},b=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,I=((M=t==null?void 0:t.affixes)==null?void 0:M.roundNumber)||p.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==it?s[0]:"",S=(t==null?void 0:t.stageConstants)||p.stageConstants,U=s&&(S==null?void 0:S[s])||w,P=`${g}${U}${m}`,E=r?Object.keys(r):[],D=f&&(S!=null&&S[gt])?`${S==null?void 0:S[gt]}-`:"";if(c||l||u)Object.assign(d,...E.map(A=>{let _=`${D}${T} ${A}`,k=`${I}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:k}}}));else{let A=f&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...E.map(_=>{if(!(r!=null&&r[_]))return;let{matchUpsCount:k,preFeedRound:B}=r[_],F=k*2,x=(A==null?void 0:A[r==null?void 0:r[_].finishingRound])||A&&`${I}${F}`||v[k]||`${I}${F}`,$=B?`-${b}`:"",j=`${x}${$}`,V=[P,o,j].filter(Boolean).join("-"),H=`${y[k]||`${I}${F}`}${$}`,z=[P,o,H].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:z,roundName:V}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:a}}function f_(t){var r,a,o;let e=Lt(t,[{[xd]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,n=i==null?void 0:i.matchUpType;if(!n&&((r=i==null?void 0:i.sides)!=null&&r.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;n=s===Qt&&sn||s===Ot&&Wi||s===Fi&&Fi||void 0}return{matchUpType:n}}var TEe="normal",T7="timed",UEe="final",PG="NOAD",lR="SET",DEe={S:TEe,F:UEe};function yo(t){if(typeof t=="string"){let e=t.startsWith("T")&&T7||t.startsWith(lR)&&lR||"";if(e===T7){let i=Eie(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===lR)return PEe(t)}}function PEe(t){let e=t.split("-"),i=lD(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&U7(e[1]),o=e&&U7(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,u=!e[2]||o,c=a,d=pt({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function U7(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=DEe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let h=D7(n);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(n.startsWith("T"))return Eie(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&Cie(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?lD(r[1]):void 0,l=Pie(n),u=l!==!1,c=u&&l||s,d=D7(n.split("/")[1]),p=d!==!1,f={setTo:s};return a&&(f.NoAD=!0),d?(f.tiebreakFormat=d,f.tiebreakAt=c):f.noTiebreak=!0,s&&o&&p&&u&&f||!1}}}function Pie(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?lD(i[1]):i[1])||!1}function D7(t){if(t)if(t.startsWith("TB")){let e=Pie(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&Cie(i[2]),a=!(i!=null&&i[2])||r,o=lD(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!Nt(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function Eie(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=lD(i==null?void 0:i[1]);if(!n)return;let r={timed:!0,minutes:n},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(r.modifier=l,r):void 0}return a&&(r.based=i[2]),r}function Cie(t){return t&&t.indexOf(PG)>=0}function lD(t){return isNaN(Number(t))?0:Number(t)}function h_(t,e){return!Array.isArray(t)||!zn(e)?!1:Ln(t,hie[e]).length}function fv(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:u,isMatchUpTie:c,roundNumbers:d,matchUpIds:p,roundNames:f,stageSequences:h,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:b,matchUpTypes:I,structureIds:T,readyToScore:w,courtIds:S,eventIds:U,venueIds:P,drawIds:E,stages:D,filterMatchUpIds:R=!0,filterMatchUpTypes:N=!0}=t,M=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],k=Array.isArray(D)?D.filter(Boolean):[],B=Array.isArray(h)?h.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],x=Array.isArray(f)?f.filter(Boolean):[],$=Array.isArray(d)?d.filter(Boolean):[],j=Array.isArray(s)?s.filter(Boolean):[],V=Array.isArray(p)&&R?p.filter(Boolean):[],H=Array.isArray(I)&&N?I.filter(Boolean):[],z=Array.isArray(S)?S.filter(Boolean):[],q=Array.isArray(P)?P.filter(Boolean):[],W=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],Y=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Z=Array.isArray(b)?b.filter(Boolean):[],X=Array.isArray(U)?U.filter(Boolean):[],Q=Array.isArray(E)?E.filter(Boolean):[],ce=Array.isArray(T)?T.filter(Boolean):[];return e.filter(J=>{var ee;if(w&&!On(gc)(J)&&!J.readyToScore||J.winningSide&&a&&![1,2].includes(J.winningSide)||c!==void 0&&(c&&!J.tieMatchUps||!c&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||k.length&&!k.includes(J.stage)||B.length&&!B.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||x.length&&(!J.roundName||!x.includes(J.roundName))||$.length&&(!J.roundNumber||!$.includes(J.roundNumber))||j.length&&(!J.roundPosition||!j.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||V.length&&!V.includes(J.matchUpId)||H.length&&(!J.matchUpType||!h_(H,J.matchUpType))||W.length&&(!J.matchUpFormat||!W.includes(J.matchUpFormat)))return!1;if(Y!=null&&Y.length){let{scheduledTime:ne}=C2({matchUp:J}),{scheduledDate:ie}=Hm({matchUp:J}),oe=Ft(ne)||ie;if(!Y.find(se=>vd(se,oe)))return!1}if(z.length){let{courtId:ne}=wie({matchUp:J}),{allocatedCourts:ie}=Iie({matchUp:J}),oe=ie==null?void 0:ie.map(({courtId:se})=>se);if(!z.filter(Boolean).includes(ne)||oe!=null&&oe.includes(ne))return!1}if(q.length){let{venueId:ne}=Sie({matchUp:J});if(!q.filter(Boolean).includes(ne))return!1}if(y){if(Z.length&&!Z.includes(J.tournamentId)||X.length&&!X.includes(J.eventId)||Q.length&&!Q.includes(J.drawId)||ce.length&&!ce.includes(J.structureId))return!1;if(M.length){let ne=((ee=J.sides)==null?void 0:ee.map(({participantId:ie})=>ie).filter(Boolean))??[];if(!M.some(ie=>ne.includes(ie)))return!1}}return!0})}function EEe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var f,h,m,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),u=a&&t,c=s&&e,d=u?(f=u[a])==null?void 0:f.participantId:l==null?void 0:l.participantId,p=l?CEe({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:s}):{...c==null?void 0:c[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let v=(h=u[a])==null?void 0:h.teamParticipant,y=(m=u[a])==null?void 0:m.participant,b=(g=u[a])==null?void 0:g.substitutions;y&&(p.participant=y),b&&(p.substitutions=b),v&&(p.teamParticipant=v)}return p}function CEe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=REe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function REe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Lu="ANY",zi="MALE",Po="MIXED",Dm="OTHER",pn="FEMALE",kc={ANY:Lu,MALE:zi,FEMALE:pn,MIXED:Po,OTHER:Dm};function Ei({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,scheduleTiming:f,contextProfile:h,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:w}){var me,Ee,Be,Pe,et;let S={},U={};if(n=n??(o==null?void 0:o.participants),!I)return{collectionPositionMatchUps:S,error:Uh,roundMatchUps:U,matchUps:[]};let P=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],E=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],D=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],R=!(v!=null&&v.eventId)||!(P!=null&&P.length)&&!((me=u==null?void 0:u.eventIds)!=null&&me.filter(Boolean).length)||(P==null?void 0:P.includes(v.eventId))||((Ee=u==null?void 0:u.eventIds)==null?void 0:Ee.includes(v.eventId)),N=!(E!=null&&E.length)||E.includes(I.structureId),M=!m||!(D!=null&&D.length)||D.includes(m.drawId);if(!R||!N||!M)return{collectionPositionMatchUps:S,roundMatchUps:U,matchUps:[]};h&&!c&&(c=Yp({tournamentRecord:o,contextProfile:h,drawDefinition:m}));let{appliedPolicies:A}=mi({drawDefinition:m}),_={...e,...A,...a},k=(Be=_==null?void 0:_.scoring)==null?void 0:Be.structures,B=I.stage&&(k==null?void 0:k.stage)&&(k==null?void 0:k.stage[I.stage]),F=I.stageSequence&&(B==null?void 0:B.stageSequence)&&B.stageSequence[I.stageSequence],x=((Pe=_==null?void 0:_.scoring)==null?void 0:Pe.requireAllPositionsAssigned)||(B==null?void 0:B.requireAllPositionsAssigned)||(F==null?void 0:F.requireAllPositionsAssigned);b||(b=ga({drawDefinition:m,structure:I}));let{positionAssignments:$,allPositionsAssigned:j}=_r({structure:I}),V=!x||j,{seedAssignments:H}=tl({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??H;let{roundOffset:z,structureId:q,structureName:W,stage:Y,stageSequence:Z}=I,{drawId:X,drawName:Q,drawType:ce}=m??{};y=y||m&&Die({drawDefinition:m}).exitProfiles;let J=y==null?void 0:y[q],ee=(J==null?void 0:J.length)&&(J[0].split("-").map(Ie=>parseInt(Ie)).reduce((Ie,Ne)=>Ie+Ne)||0),ne=!!I.structures,ie=zm({matchUpsMap:b,structureId:q,inContext:T}),oe=_==null?void 0:_[ZI],se=SEe({roundNamingPolicy:oe,drawDefinition:m,structure:I,matchUps:ie}),{roundNamingProfile:pe,roundProfile:fe}=se;if(U=(se==null?void 0:se.roundMatchUps)??[],d&&(ie=fv({matchUps:ie,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){let{sourceDrawPositionRanges:Ie}=vEe({drawDefinition:m,matchUpsMap:b,structureId:q}),Ne=m?IEe({drawDefinition:m,roundProfile:fe,matchUpsMap:b,structureId:q}).drawPositionsRanges:void 0;ie=ie.map(be=>ge({scheduleVisibilityFilters:t,sourceDrawPositionRanges:Ie,drawPositionsRanges:Ne,roundNamingProfile:pe,initialRoundOfPlay:ee,appliedPolicies:_,usePublishState:l,publishStatus:g,isRoundRobin:ne,roundProfile:fe,matchUp:be,event:w})),(ie==null?void 0:ie.filter(be=>Array.isArray(be.tieMatchUps))).forEach(be=>{let Le=be.tieMatchUps;ie=ie.concat(...Le)}),u&&(ie=fv({processContext:!0,...u,matchUps:ie}))}else(ie==null?void 0:ie.filter(Ie=>Array.isArray(Ie.tieMatchUps))).forEach(Ie=>{let Ne=Ie.tieMatchUps;ie=ie.concat(...Ne)});return d&&(ie=fv({matchUps:ie,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ie=fv({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ie})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(U=Za({matchUps:ie}).roundMatchUps??[]),(et=Aa({drawDefinition:m,structure:I,event:w}))!=null&&et.tieFormat&&({collectionPositionMatchUps:S}=gEe({matchUps:ie})),{collectionPositionMatchUps:S,roundMatchUps:U,isRoundRobin:ne,roundProfile:fe,matchUpsMap:b,matchUps:ie};function ge({scheduleVisibilityFilters:Ie,sourceDrawPositionRanges:Ne,drawPositionsRanges:be,initialRoundOfPlay:Le,additionalContext:Me,roundNamingProfile:Ze,tieDrawPositions:qe,appliedPolicies:ye,isCollectionBye:_e,usePublishState:Ae,publishStatus:Ve,matchUpTieId:Ke,isRoundRobin:he,roundProfile:ve,sideLineUps:Ce,matchUp:De,event:Ue}){var Jh,We,ni,Jn,Ma,pu,$c,un,ar,If,Vc,yl,cn,Si,Ur;Me=Me??{};let Qe=(Jh=Aa({drawDefinition:m,structure:I,matchUp:De,event:Ue}))==null?void 0:Jh.tieFormat,je=Qe==null?void 0:Qe.collectionDefinitions,ke=De.collectionId&&(je==null?void 0:je.find(vi=>vi.collectionId===De.collectionId)),bt=De.collectionId?ke==null?void 0:ke.matchUpFormat:De.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Ue==null?void 0:Ue.matchUpFormat),Gt=De.matchUpType||(ke==null?void 0:ke.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||!On(vr)(Ue==null?void 0:Ue.eventType)&&(Ue==null?void 0:Ue.eventType),Zt=_e?Ui:De.matchUpStatus,{schedule:Sr,endDate:Oo}=d_({scheduleVisibilityFilters:Ie,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:Ae,scheduleTiming:f,matchUpFormat:bt,publishStatus:Ve,matchUpType:Gt,matchUp:De,event:Ue}),ri=qe??De.drawPositions??[],{collectionPosition:Tr,collectionId:Xn,roundPosition:It}=De,hr=De.roundNumber??Me.roundNumber,os=Xn?bEe({tournamentParticipants:n,positionAssignments:$,collectionPosition:Tr,drawDefinition:m,participantMap:p,drawPositions:ri,collectionId:Xn,sideLineUps:Ce,matchUpType:Gt}):void 0,ss=((We=Ze==null?void 0:Ze[hr])==null?void 0:We.roundName)||Me.roundName,Io=((ni=Ze==null?void 0:Ze[hr])==null?void 0:ni.abbreviatedRoundName)||Me.abbreviatedRoundName,Vd=(Jn=ve==null?void 0:ve[hr])==null?void 0:Jn.feedRound,La=(Ma=ve==null?void 0:ve[hr])==null?void 0:Ma.preFeedRound,ls=(pu=ve==null?void 0:ve[hr])==null?void 0:pu.roundFactor,uu=be==null?void 0:be[hr],Kg=It?uu==null?void 0:uu[It]:void 0,bf=Ne==null?void 0:Ne[hr],Fc=ke!=null&&ke.category?{...(v==null?void 0:v.category)||{},...ke.category}:(v==null?void 0:v.category)??(Ue==null?void 0:Ue.category),Bc=(($c=De.processCodes)==null?void 0:$c.length)&&De.processCodes||((un=ke==null?void 0:ke.processCodes)==null?void 0:un.length)&&(ke==null?void 0:ke.processCodes)||((ar=I==null?void 0:I.processCodes)==null?void 0:ar.length)&&(I==null?void 0:I.processCodes)||((If=m==null?void 0:m.processCodes)==null?void 0:If.length)&&(m==null?void 0:m.processCodes)||((Vc=Ue==null?void 0:Ue.processCodes)==null?void 0:Vc.length)&&(Ue==null?void 0:Ue.processCodes)||(o==null?void 0:o.processCodes),cu=(h==null?void 0:h.withCompetitiveness)&&aD({...c,matchUp:De}),du=De.finishingPositionRange??Me.finishingPositionRange,so=vi=>pt(vi,void 0,!0),gi={...so(v),...so({matchUpFormat:De.matchUpType===vr?void 0:bt,tieFormat:De.matchUpType!==vr?void 0:Qe,gender:(ke==null?void 0:ke.gender)??(Ue==null?void 0:Ue.gender),roundOfPlay:Y!==gt&&Nt(Le)&&Le+(hr||0),endDate:De.endDate??Oo,discipline:Ue==null?void 0:Ue.discipline,category:Fc,finishingPositionRange:du,abbreviatedRoundName:Io,drawPositionsRange:Kg,competitiveProfile:cu,structureName:W,stageSequence:Z,drawPositions:ri,matchUpStatus:Zt,processCodes:Bc,isRoundRobin:he,matchUpTieId:Ke,preFeedRound:La,matchUpType:Gt,roundFactor:ls,roundOffset:z,structureId:q,roundNumber:hr,feedRound:Vd,roundName:ss,drawName:Q,drawType:ce,schedule:Sr,drawId:X,stage:Y}),...st(so(De),!0,!0)};if(bt&&((yl=De.score)!=null&&yl.scoreStringSide1)){let vi=yo(bt),{bestOf:Dr,finalSetFormat:ct,setFormat:kt}=vi??{};(ct!=null&&ct.tiebreakSet||kt!=null&&kt.tiebreakSet||kt!=null&&kt.timed)&&(gi.score.sets=gi.score.sets.sort((Ti,fn)=>Ti.setNumber-fn.setNumber).map((Ti,fn)=>(fn+1===Dr?(ct!=null&&ct.tiebreakSet||ct!=null&&ct.timed)&&(Ti.tiebreakSet=!0):(kt!=null&&kt.tiebreakSet||kt!=null&&kt.timed)&&(Ti.tiebreakSet=!0),Ti)))}if(Array.isArray(ri)){let{orderedDrawPositions:vi,displayOrder:Dr}=yEe({drawPositions:ri,roundProfile:ve,roundNumber:hr}),ct=(cn=ve==null?void 0:ve[hr])==null?void 0:cn.feedRound,kt=Dr[0]!==vi[0],Ti=vi.concat(void 0,void 0).slice(0,2).map((fn,_t)=>{var em;let _i=_t+1,ba=kt?3-_i:_i,fu=EEe({...os,positionAssignments:$,displaySideNumber:ba,seedAssignments:s,drawPosition:fn,isFeedRound:ct,sideNumber:_i}),hu=(em=De.sides)==null?void 0:em.find(tm=>tm.sideNumber===_i),jd=It?(It-1)*2+_t+1:void 0,Qh=jd?bf==null?void 0:bf[jd]:void 0;return so({sourceDrawPositionRange:Qh,...hu,...fu})});Object.assign(gi,st({sides:Ti},!0,!0))}if(n&&gi.sides){let vi=ye==null?void 0:ye[I0],Dr=ct=>{var Ti;let kt=(Ti=p==null?void 0:p[ct])==null?void 0:Ti.participant;return kt&&Kv({template:vi==null?void 0:vi.participant,source:kt})};if(gi.sides.filter(Boolean).forEach(ct=>{var kt,Ti,fn;if(ct.participantId){let _t=st(Dr(ct.participantId)||n&&Qf({policyDefinitions:ye,participantId:ct.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:h}),void 0,!0);if(_t){if(m!=null&&m.entries){let _i=m.entries.find(ba=>ba.participantId===ct.participantId);_i!=null&&_i.entryStatus&&(_t.entryStatus=_i.entryStatus),_i!=null&&_i.entryStage&&(_t.entryStage=_i.entryStage)}Object.assign(ct,{participant:_t})}}if((Ti=(kt=ct==null?void 0:ct.participant)==null?void 0:kt.individualParticipantIds)!=null&&Ti.length&&!((fn=ct.participant.individualParticipants)!=null&&fn.length)){let _t=ct.participant.individualParticipantIds.map(_i=>Dr(_i)||n&&Qf({policyDefinitions:ye,tournamentParticipants:n,internalUse:!0,contextProfile:h,participantId:_i}));Object.assign(ct.participant,{individualParticipants:_t})}}),!gi.matchUpType){let{matchUpType:ct}=f_({matchUp:gi});ct&&Object.assign(gi,{matchUpType:ct})}if(h!=null&&h.inferGender&&(!gi.gender||gi.gender===Po)&&((Si=gi.sides)==null?void 0:Si.length)===2&&gi.matchUpType!==vr){let ct=gi.sides.map(kt=>{var Ti,fn,_t,_i;if(On(sn)(gi.matchUpType))return(fn=(Ti=kt.participant)==null?void 0:Ti.person)==null?void 0:fn.sex;if(((_i=(_t=kt.participant)==null?void 0:_t.individualParticipants)==null?void 0:_i.length)===2){let ba=Vt(kt.participant.individualParticipants.map(fu=>{var hu;return(hu=fu.person)==null?void 0:hu.sex})).filter(Boolean);if(ba.length===1)return ba[0]}});if(ct.filter(Boolean).length===2&&Vt(ct).length===1){let kt=ct[0];gi.inferredGender=kt}}}if(gi.tieMatchUps){let vi=gi.matchUpStatus===Ui,Dr=(Ur=gi.sides)==null?void 0:Ur.map(({participant:ct,drawPosition:kt,sideNumber:Ti,lineUp:fn})=>{let _t=(ct==null?void 0:ct.participantType)===vr&&ct;return{teamParticipant:_t&&pt({participantRoleResponsibilities:_t.participantRoleResponsibilities,participantOtherName:_t.participanOthertName,participantName:_t.participantName,participantId:_t.participantId,teamId:_t.teamId}),drawPosition:kt,sideNumber:Ti,lineUp:fn}});gi.tieMatchUps=gi.tieMatchUps.map(ct=>{let kt=gi.matchUpId,Ti={finishingPositionRange:gi.finishingPositionRange,abbreviatedRoundName:Io,roundNumber:hr,roundName:ss};return ge({tieDrawPositions:ri,scheduleVisibilityFilters:Ie,sourceDrawPositionRanges:Ne,sideLineUps:Dr,drawPositionsRanges:be,initialRoundOfPlay:Le,roundNamingProfile:Ze,additionalContext:Ti,appliedPolicies:ye,isCollectionBye:vi,usePublishState:Ae,publishStatus:Ve,matchUpTieId:kt,isRoundRobin:he,roundProfile:ve,matchUp:ct,event:Ue})})}let Zh=gi.sides&&gi.sides.filter(vi=>vi==null?void 0:vi.participantId).length===2,Xh=!gi.winningSide;if(Object.assign(gi,{readyToScore:V&&Zh&&Xh,hasContext:!0}),Zh){let{allParticipantsCheckedIn:vi,checkedInParticipantIds:Dr}=Wy({matchUp:gi});Object.assign(gi,{allParticipantsCheckedIn:vi,checkedInParticipantIds:Dr})}return Array.isArray(h==null?void 0:h.exclude)&&(h==null||h.exclude.forEach(vi=>delete gi[vi])),gi}}function Rm({matchUp:t}){return t?dr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function m_({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:c,participantMap:d,scheduleTiming:p,publishStatus:f,contextProfile:h,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:w}){!I&&y&&({structure:I}=Dt({drawDefinition:m,structureId:y}));let S=Ei({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:c,participantMap:d,scheduleTiming:p,publishStatus:f,contextProfile:h,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:w}),U=[],P=[],E=[],D=[],R=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:M}=_r({structure:I}),A=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),_;return N.filter(k=>{var F;let B=((F=l==null?void 0:l.matchUpTypes)==null?void 0:F.length)===1&&l.matchUpTypes[0]===Zi;return!(k.matchUpType!==Zi&&B)}).forEach(k=>{var z,q,W,Y;if(k.matchUpStatus===Ro){U.push(k);return}k.matchUpType===Zi&&(_=!0);let B=k.collectionId,F=B&&((z=k.sides)==null?void 0:z.every(Z=>Z.participantId)),x=!B&&((q=k.drawPositions)==null?void 0:q.filter(Boolean).length)===2,$=!B&&((W=k.drawPositions)==null?void 0:W.every(Z=>A==null?void 0:A.includes(Z))),j=M==null?void 0:M.filter(Z=>Z.bye).map(Z=>Z.drawPosition),V=!B&&((Y=k.drawPositions)==null?void 0:Y.find(Z=>j==null?void 0:j.includes(Z))),H=jj.includes(k.matchUpStatus)&&(F||x&&(!t||$));return V?R.push(k):Rm({matchUp:k})?P.push(k):H?E.push(k):D.push(k)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:D,byeMatchUps:R,structure:I}}function MEe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:ot};if(!i)return{error:Is};let{links:n}=R0({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function wL({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var a;let r=n.find(o=>{var l,u;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||Ya(t,(u=o.source)==null?void 0:u.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[Sp,yd].includes(r==null?void 0:r.linkType)&&!((a=r==null?void 0:r.source)!=null&&a.roundNumber)?le({result:{error:we},stack:"getTargetLink",context:r}):r}function R0({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:Is}:{error:ot}}function NEe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function SL({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var P;if(!r)return{error:$V};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:u}}=r,{structure:c}=Dt({drawDefinition:n,structureId:a}),{positionAssignments:d}=Gi({structure:c}),p=(e==null?void 0:e.filter(E=>E.structureId===(c==null?void 0:c.structureId))).filter(E=>E.roundNumber===l&&!E.matchUpTieId),f=p.length,h=Xe(1,f+1),m=f/t,g=Math.ceil(m*i),v=1-i%2;if(u!=null&&u.interleave&&m!==.5){let E=u.offset+(i-1)*u.interleave,D=i+E;g=Math.ceil(D/2),v=1-D%2}let y=h,b=h[g-1],I=Uie({roundPositionsCount:h.length,groupedOrder:s}),T=(I==null?void 0:I.length)||1;if(T<=h.length){let E=f/T,D=zr(h,E);o===Vm&&D.forEach(R=>R.reverse()),y=(I==null?void 0:I.length)&&(I==null?void 0:I.map(R=>D[R-1]).flat())||y}o===Cl?b=y[g-1]:o===Vm?((!(I!=null&&I.length)||T>h.length)&&(g=p.length+1-g),b=y[g-1]):o===e_&&gs()&&console.log(FA,{feedProfile:o});let w=b&&p.reduce((E,D)=>D.roundPosition===b?D:E,void 0),S;w!=null&&w.feedRound?(v=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=((P=w==null?void 0:w.drawPositions)==null?void 0:P.length)===2&&(w==null?void 0:w.drawPositions[v]);let U=d==null?void 0:d.find(({drawPosition:E})=>E===S);if(U){let{extension:E}=$t({element:U,name:YA});if(E!=null&&E.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function Xa({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=Dt({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===jy?AEe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):_Ee({matchUp:a})}function AEe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var R,N,M;let{winnerMatchUpId:a,loserMatchUpId:o}=r,{links:s}=MEe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=s==null?void 0:s.source,u=wL({source:l,linkType:Sp}),c=wL({linkCondition:bd,linkType:yd,source:l}),d=wL({source:l,linkType:yd}),p=c&&d;d||(d=c);let f=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,h=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,m=(M=c==null?void 0:c.target)==null?void 0:M.feedProfile,g,v,y,b,I,T,w,S,U,P;if(e&&(a||o)&&(w=a&&f!==Pl&&t.find(({matchUpId:A})=>A===a),b=o&&h!==Pl&&t.find(({matchUpId:A})=>A===o),w||b))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:b,winnerMatchUp:w}};let{roundPosition:E}=r;P=P||t.filter(A=>A.structureId===n.structureId);let D=P.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return d&&!b&&h!==Pl&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=SL({targetLink:d,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==Pl&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=SL({targetLink:c,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),u&&!w&&f!==Pl&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=SL({targetLink:u,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),w||(P=P||t.filter(A=>A.structureId===n.structureId),{matchUp:w}=NEe({structureMatchUps:P,matchUp:r})),pt({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:c},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function _Ee({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function kEe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var l,u,c,d,p,f;let{matchUpId:r,structureId:a,drawPositions:o=[]}=n,{structure:s}=Dt({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===U0){let{roundNumber:h}=n,m=h&&St(h)+1,g=s.matchUps??[],{roundMatchUps:v}=Za({matchUps:g});if(m&&(v!=null&&v[m])){let y=[...o].sort(sr).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:s.structureName}});Object.assign(n,{sidesTo:y})}}else{let h=Xa({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:m}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=TL({upcomingMatchUp:m}),y=TL({upcomingMatchUp:g});if(n.matchUpStatus!==Ui&&(g==null?void 0:g.matchUpStatus)===Ui){let{matchUp:I}=Rie({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&TL({upcomingMatchUp:I})||y}let b=(l=n.schedule)==null?void 0:l.timeAfterRecovery;if(b&&((u=v==null?void 0:v.schedule)!=null&&u.scheduledTime&&li(v.schedule.scheduledTime)<li(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(c=y==null?void 0:y.schedule)!=null&&c.scheduledTime&&li(y.schedule.scheduledTime)<li(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(d=n.drawPositions)==null?void 0:d.filter(Boolean).length){let I=((f=(p=h.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:f.linkCondition)===bd,T=OEe(n);if(T.length){let w=w2(m==null?void 0:m.sides),S=w2(g==null?void 0:g.sides),U=T.find(({participantId:E})=>w.includes(E))?[]:T,P=T.find(({participantId:E})=>S.includes(E))?[]:T;g&&I&&P.length<2&&P.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!h.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),P!=null&&P.length&&g&&(h.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function OEe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function Rie({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===Fn)return{matchUp:t};if(r===Ui){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=Xa({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:o.targetMatchUps)||{},Rie({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function TL(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function pr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=M0(t);if(i.error)return le({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function M0(t){if(!(t!=null&&t.drawDefinition))return{error:ot};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],U=[],P=[],E=[],D=[];v&&!i&&(i=Yp({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(I||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:R}=pG({participants:e,participantsProfile:s})));let{structures:N}=wd({drawDefinition:y});if(!N)return{error:Sn};n||(n=ga({drawDefinition:y}));let M=y&&Die({drawDefinition:y}).exitProfiles;N.forEach(k=>{let{byeMatchUps:B=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:$=[],abandonedMatchUps:j=[]}=m_({matchUpFilters:b?void 0:f,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:M,matchUpsMap:n,structure:k,context:T,event:w});S=S.concat(...j),U=U.concat(...$),P=P.concat(...x),E=E.concat(...F),D=D.concat(...B)});let A=k=>(!f&&!b&&!p||(f&&(k=fv({matchUps:k,...f})),p&&(k=fv({matchUps:k,...p,processContext:!0}))),k),_={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(P),pendingMatchUps:A(E),byeMatchUps:A(D),matchUpsMap:n,...re,groupInfo:R};if(b){let k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:B,completed:F,upcoming:x,pending:$,bye:j}=k,V=[].concat(...B&&S||[],...F&&U||[],...x&&P||[],...$&&E||[],...j&&D||[]);kEe({inContextDrawMatchUps:V,drawDefinition:y})}return _}function Xp(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:f,nextMatchUps:h,inContext:m,context:g,event:v}=t;if(!v)return{error:ji};let{eventId:y,eventName:b,endDate:I,eventType:T,category:w,gender:S,matchUpFormat:U}=v??{},P={...g,...pt({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:U,eventName:b,eventType:T,category:w,eventId:y,gender:S})};I&&(P.endDate=I),p&&!i&&(i=Yp({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let E;if(!(e!=null&&e.length)&&!n&&c){let N=zy({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],E=N.groupInfo}let D=v.drawDefinitions??[],R=X1({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:D.flatMap(N=>{let{matchUps:M}=pr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:P,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:f,participantMap:n,scheduleTiming:R,nextMatchUps:h,inContext:m,event:v});return M??[]}),groupInfo:E}}function Wr(t){let e=Lt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:Fe};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:f,nextMatchUps:h,context:m}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];n||({participants:n,participantMap:i}=zy({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=mi({tournamentRecord:u}),b={...m,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},I=Yp({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(T=>{var w;return b.eventDrawsCount=((w=T.drawDefinitions)==null?void 0:w.length)??0,Xp({context:b,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:I,contextFilters:f,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:n,inContext:c,event:T}).matchUps??[]}).concat(...u.matchUps??[])}}function Fu({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof n!="object"||!Object.keys(n).length)return{error:Cn};let u=Object.keys(n).map(c=>{let d=n[c];return Wr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...re,matchUps:u}}function Yy(t,e){return xEe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function xEe(t,e){return(Jv[t==null?void 0:t.stage]||0)-(Jv[e==null?void 0:e.stage]||0)}function za(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:U},D;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:D}=zy({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!n&&(n=Yp({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:y})),{...pr({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:n,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:D}}function Sv({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=st(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l!=null&&l[f]){let h=u.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>s({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),r.includes(l[f])||r.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?r.includes(h)||r.push(h):(a=h,r.push(h))}}}}var Mie=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Sv({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Sv({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Sv({element:e,accessor:t}))==null?void 0:i.value)},Yo=Mie;function uD({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var g;if(!cl(a))return[];let{roundProfile:l,roundNumbers:u=[]}=Za({interpolate:!0,matchUps:a});n=n??Math.max(...u,0);let c=r?n-r:0,d=c&&((g=l==null?void 0:l[n-c])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(Yo("matchUpsCount")),f=(v,y)=>{let b=Math.min(...v);d&&y&&b===1&&(b=d);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},h=l&&Object.assign({},...u.map(v=>{let y=(n??0)+1-v-c,b=l[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=p==null?void 0:p.slice(v-1).reduce((N,M)=>N+(M||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),U=1,P=Xe(S,o?S+b*2:T+S+U),E=T+U-b,D=f(P.slice(E)),R=f(P.slice(0,E),!0);return I.finishingPositionRange={loser:D,winner:R},{[v]:I}})),m=gs({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&h[v.roundNumber];m&&!y&&console.log({roundFinishingData:h,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function Wm({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:ot};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=pr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];uD({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Xa({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,f=zm({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(f&&(d&&(n.winnerMatchUpIds[f.matchUpId]=d,Object.assign(f,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[f.matchUpId]=p,a.loserMatchUpId=p,f.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],m=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=m,f.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:n}}function tu(t){var y;let e=Ac(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Hp};if(!Array.isArray(n))return{error:qu};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(b=>b.matchUpId);if(!Array.isArray(s))return{error:Ay};let l={},u={},c={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),f=p.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===wp),h=i;if(f.length){h=Fu({nextMatchUps:!0,tournamentRecords:e}).matchUps;let b=f.reduce((I,T)=>{var U,P;let w=(U=T.source)==null?void 0:U.structureId,S=(P=T.target)==null?void 0:P.structureId;return w&&S&&(c[S]=w),w&&!I.includes(w)&&I.push(w),I},[]);for(let I of b)l[I]=[];for(let I of h??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&l[T].push(I.matchUpId)}}let m=b=>{u[b]||(u[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[b]=[])},g=(b,I)=>{u[b].matchUpIds.forEach(T=>{u[I].matchUpIds.push(T)}),u[I].matchUpIds.push(b),u[b].dependentMatchUpIds.push(I),r&&u[b].participantIds.forEach(T=>u[I].participantIds.push(T))},v=b=>{let I=Object.keys(l).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=T;if(!s.length||s.includes(w)){if(m(w),r){let{individualParticipantIds:D}=o_(T);u[w].participantIds=D}S&&(m(S),g(w,S),d[S].push(w)),U&&(m(U),g(w,U),d[U].push(w)),u[w].sources.push(d[w]);let P=d[w].map(D=>u[D].sources[0]).flat(),E=d[w].map(D=>u[D].sources[1]).flat();if(u[w].sources.push(P,E),I){let D=T.containerStructureId||T.structureId,R=c[D];if(l[R])for(let N of l[R])m(N),g(N,w),d[N].push(w)}}}};if(o)Wm({drawDefinition:o}),h!=null&&h.length||(h=za({drawDefinition:o}).matchUps),v(h);else{if(h!=null&&h.length||(h=Fu({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let b=p!=null&&p.length?p.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(n=b)}for(let b of n){let I=h==null?void 0:h.filter(T=>T.drawId===b).sort(Yy);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=ho({tournamentRecord:e[T==null?void 0:T.tournamentId],drawId:b});w&&Wm({drawDefinition:w})}v(I)}}return{positionDependencies:l,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:h,...re}}function Kr(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),n=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:r,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:u}=n||{},c=r||a||o||s||l||u;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||c)}function cD({matchUpStatus:t}){return $j.includes(t)}function LEe({matchUpStatus:t}){return XA.includes(t)}function R2({matchUpStatus:t}){return Vj.includes(t)}function EG({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var s;let a=n==null?void 0:n.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(EG))==null?void 0:s.length;return Kr({score:r})||o||e&&a||t&&LEe({matchUpStatus:t})&&![ai,yi,Zl].includes(t)}function dD(t){var S;let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=D0({drawDefinition:e}),l=n?s[n]||[]:[];if(!a){let U=Dt({drawDefinition:e,structureId:n});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Ko({structure:a}))return{structure:a,isAdHoc:!0,error:l0};let{matchUps:u}=pr({inContext:!0,matchUpFilters:o,drawDefinition:e,event:r}),c=u==null?void 0:u.filter(U=>U.structureId===n||l.includes(U.structureId)),{matchUpDependencies:d}=tu({drawIds:[e.drawId],matchUps:u,drawDefinition:e}),p=[],f=[],h={},m=[];for(let U of u??[]){if(U.structureId===n||l.includes(U.structureId)){f.push(...U.drawPositions??[]);let P=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!h[E]||P&&h[E]>P)&&(h[E]=P)}EG(U)&&(m.push(U),p.push(U.matchUpId,...((S=d==null?void 0:d[U==null?void 0:U.matchUpId])==null?void 0:S.matchUpIds)||[]))}let g=Vt(f.filter(Boolean)).sort(sr),v=Vt(p),y=Vt(c==null?void 0:c.map(({matchUpId:U,drawPositions:P})=>v.includes(U)?P:[]).flat().filter(Boolean)).sort(sr),{positionAssignments:b}=Gi({drawDefinition:e,structure:a}),I=b==null?void 0:b.filter(U=>U.bye).map(U=>U.drawPosition),T=b==null?void 0:b.filter(U=>U.qualifier).map(U=>U.drawPosition),w=(g==null?void 0:g.filter(U=>!y.includes(U)))||[];return{allDrawPositions:g,inContextStructureMatchUps:c,drawPositionInitialRounds:h,activeDependentMatchUpIds:v,qualifyingDrawPositions:T,inactiveDrawPositions:w,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function Qv({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(sr)[0]}}var Df={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},vM=[];function qs(t,e){typeof t=="string"&&(t={method:t}),(e||gs())&&vM.push(t)}function FEe(t){let e=vM.slice();return t&&(vM.length=0),e}function BEe(t){let e=FEe(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(Df).includes(n)?Df[n]:Df.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=r&&Object.keys(r).includes(c)&&Df[r[c]]?Df[r[c]]:Df.brightwhite;return`${Df.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,Df.white,l,Df.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function $Ee(){vM.length=0}function Ss({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var P,E,D;if(!n)return{error:ot};if(s||({structure:s}=Dt({drawDefinition:n,structureId:o})),!s)return{error:Sn};o||({structureId:o}=s);let u="assignDrawPositionBye";qs({method:u,color:"cyan",drawPosition:r}),a||(a=ga({drawDefinition:n}));let{positionAssignments:c}=Gi({structure:s}),{activeDrawPositions:d}=dD({drawDefinition:n,structureId:o});if((P=c==null?void 0:c.find(R=>R.drawPosition===r))!=null&&P.bye)return{...re};if(d!=null&&d.includes(r))return{error:CA};let p=c==null?void 0:c.find(R=>R.drawPosition===r);if(!p)return{error:l0};let{filled:f,containsBye:h,assignedParticipantId:m}=VEe(p);if(h)return{...re};if(f&&!h)return le({result:{error:GI},stack:u});let g=mi({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},v=pr({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],y={isCollectionMatchUp:!1},{matchUps:b}=Ei({provisionalPositioning:t,drawDefinition:n,matchUpFilters:y,matchUpsMap:a,structure:s});if(c==null||c.forEach(R=>{R.drawPosition===r&&(R.bye=!0)}),s.structureType===ro)return jEe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:b}),nh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),P7({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:o,stack:u});let{roundProfile:I,roundMatchUps:T}=Za({matchUps:b}),w=(E=I&&Object.keys(I).map(R=>parseInt(R)).reverse())==null?void 0:E.find(R=>{var N;return(N=I==null?void 0:I[R].drawPositions)==null?void 0:N.includes(r)}),S=w?T==null?void 0:T[w].find(({drawPositions:R})=>R==null?void 0:R.includes(r)):void 0;S&&Nie({tournamentRecord:i,drawDefinition:n,matchUp:S,event:l});let U=(D=S==null?void 0:S.drawPositions)==null?void 0:D.find(R=>R!==r);if(S&&U){let R=CG({sourceDrawPositions:S.drawPositions,matchUpId:S.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:U,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(R.error)return R}return nh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),P7({assignedParticipantId:m,isPositionAction:e,appliedPolicies:g,drawDefinition:n,drawPosition:r,structureId:o,stack:u})}function P7({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:o}){return e&&a_({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:t,drawPosition:r,structureId:a,name:o}}),le({result:{...re},stack:o})}function VEe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Nie({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:Ui,score:void 0,winningSide:void 0}),ci({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function jEe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&Nie({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function CG({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var b,I;qs({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(T=>T.matchUpId===o),u=(b=e.find(T=>T.matchUpId===o))==null?void 0:b.structureId,{structure:c}=Dt({drawDefinition:r,structureId:u}),{positionAssignments:d}=Gi({structure:c}),p=d==null?void 0:d.filter(T=>T.bye).map(T=>T.drawPosition),f=(I=l==null?void 0:l.drawPositions)==null?void 0:I.find(T=>T!==t),h=f&&(p==null?void 0:p.includes(f)),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=Xa({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(v&&v.structureId===(c==null?void 0:c.structureId)&&GEe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&h&&g.structureId!==(c==null?void 0:c.structureId)){let{roundNumber:T}=g;if(T===1){let w=Ss({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else Aie({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:a,event:s})}return{...re}}function GEe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var M,A,_,k,B,F;let l="advanceWinner",u=o.drawMatchUps.find(x=>x.matchUpId===a.matchUpId),c=(M=e.find(x=>x.matchUpId===a.matchUpId))==null?void 0:M.structureId,{structure:d}=Dt({drawDefinition:r,structureId:c}),{positionAssignments:p}=Gi({structure:d}),f=(A=p==null?void 0:p.find(({drawPosition:x})=>x===t))==null?void 0:A.bye,h=(_=u.drawPositions)==null?void 0:_.filter(Boolean),m=p==null?void 0:p.filter(x=>h==null?void 0:h.includes(x.drawPosition)),g=p==null?void 0:p.find(({drawPosition:x})=>x===t),v=i==null?void 0:i.find(x=>x!==t),y=(k=v&&(m==null?void 0:m.find(({drawPosition:x})=>x===v)))==null?void 0:k.bye,b=f&&y;if(b&&console.log({isByeAdvancedBye:b}),(h==null?void 0:h.length)>1&&f&&!y)return le({result:{error:GI},stack:l});let I=h==null?void 0:h.find(x=>x!==t),T=b,w=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map(x=>!x&&!T||x===t?(T=!0,t):x).sort(sr);if(!T)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),le({result:{error:GI},stack:l});let U=(B=p==null?void 0:p.find(({drawPosition:x})=>x===I))==null?void 0:B.bye,P=(F=p==null?void 0:p.find(({drawPosition:x})=>x===t))==null?void 0:F.bye;Object.assign(u,{matchUpStatus:P||U?Ui:Fn,score:void 0,winningSide:void 0,drawPositions:S});let E=u.drawPositions.find(x=>!w.includes(x));qs({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:U,drawPositionIsBye:P}),ci({tournamentId:n==null?void 0:n.tournamentId,matchUp:u,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:D},targetMatchUps:{loserMatchUp:R,loserTargetDrawPosition:N}}=Xa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(U||P){let x=U?t:I;if(x)CG({drawPositionToAdvance:x,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(P&&D&&R)if(R.feedRound)Aie({loserTargetDrawPosition:N,tournamentRecord:n,loserTargetLink:D,drawDefinition:r,loserMatchUp:R,matchUpsMap:o});else{let $=1-a.roundPosition%2,j=R.drawPositions[$],V=Ss({structureId:D.target.structureId,drawPosition:j,tournamentRecord:n,drawDefinition:r,event:s});if(V.error)return V}}}function Aie({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;qs({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:u}=Qv({drawPosition:t,matchUps:l});if(u===s){let c=Ss({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(c.error)return c}}function _ie({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Ei({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Ui:Fn}),ci({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function pD(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=Dt({drawDefinition:a,structureId:o}),c=(_r({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(c&&i&&!n&&(n=c==null?void 0:c.drawPosition),!n)return{error:u0};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=dD({drawDefinition:a,structureId:o});return d.includes(n)?{error:CA}:(e||({matchUps:e}=pr({inContext:!0,drawDefinition:a,matchUpsMap:s})),M2({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(nh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:u,event:l}),{...re,participantId:i}):{error:$Q})}function M2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var v,y;let{structure:s}=Dt({drawDefinition:i,structureId:a});if(!s)return{error:Sn};let l=_r({drawDefinition:i,structure:s}).positionAssignments||[],u=l.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(s.structureType===ro)return _ie({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:s}),{drawPositionCleared:u,...re};let c={isCollectionMatchUp:!1},{matchUps:d}=Ei({drawDefinition:i,matchUpFilters:c,matchUpsMap:r,structure:s,event:o}),{roundProfile:p,roundMatchUps:f}=Za({matchUps:d}),h=(v=p&&Object.keys(p))==null?void 0:v.map(b=>St(b)),m=n,g=(y=h==null?void 0:h.map(b=>{var R,N,M,A;let I=(N=(R=p==null?void 0:p[b])==null?void 0:R.pairedDrawPositions)==null?void 0:N.find(_=>_.includes(m)),T=I==null?void 0:I.find(_=>_!==m),w=l.find(_=>_.drawPosition===T),S=p==null?void 0:p[b+1],U=w==null?void 0:w.bye,P=(M=S==null?void 0:S.pairedDrawPositions)==null?void 0:M.find(_=>_.includes(T)),E=U&&P&&S&&((A=S.drawPositions)==null?void 0:A.includes(T)),D=I&&{pairedDrawPositionByeAdvancedPair:!E&&P,pairedDrawPosition:T,targetDrawPosition:m,relevantPair:I,roundNumber:b};return E&&(m=T),D}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:y.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:P}=I,E={roundNumber:T,targetDrawPosition:S,relevantPair:w},D=P&&{roundNumber:T+1,targetDrawPosition:U,relevantPair:P,subsequentRoundRemoval:!0},R=[E,D].filter(Boolean);return b.concat(...R)},[]);return g==null||g.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=f==null?void 0:f[b].find(S=>{var U;return Ya((U=S.drawPositions)==null?void 0:U.filter(Boolean),T.filter(Boolean))});w&&(HEe({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),kie({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:s,event:o}))}),{tasks:g,drawPositionCleared:u,positionAssignments:l}}function HEe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=Dt({drawDefinition:n,structureId:o});if(!s)return{error:Sn};if(s.structureType===ro)return;r=r||ga({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Qv({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var f;return p.roundNumber>=a&&p.roundNumber!==u&&((f=p.drawPositions)==null?void 0:f.includes(e))}),d=Gi({drawDefinition:n,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>kie({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...re}}function kie({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var S,U,P,E,D,R;let u="removeDrawPosition",c=(S=r.drawPositions)==null?void 0:S.slice(),d=r.matchUpStatus,p=r.winningSide;o=o??ga({drawDefinition:n});let f=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:h}=Qv({drawPosition:a,matchUps:f});if(r.roundNumber&&h&&r.roundNumber>h){let N=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=N}if(r.matchUpType===Zi){let N=(((U=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:U.sides)??[]).reduce((M,A,_)=>A.drawPosition===a?_:M,void 0);N!==void 0&&((E=(P=r.sides)==null?void 0:P[N])!=null&&E.lineUp)&&((D=r.sides)==null||delete D[N].lineUp,ci({tournamentId:i==null?void 0:i.tournamentId,context:`${u}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let m=Xa({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:N})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(N)}).filter(N=>N.bye).length,T=I&&Ui||r.matchUpStatus&&[ai,yi].includes(r.matchUpStatus)&&r.matcHUpStatus||((R=r.drawPositions)==null?void 0:R.length)===2&&Fn||void 0;r.matchUpStatus=T,r.matchUpStatus&&[yi,ai].includes(r.matchUpStatus)&&(r.winningSide=void 0);let w=c==null?void 0:c.find(N=>{var M;return!((M=r.drawPositions)!=null&&M.includes(N))});if(c!=null&&c.includes(a)&&d===r.matchUpStatus&&p===r.winningSide||(w&&qs({method:u,color:"brightyellow",removedDrawPosition:w}),ci({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${u}-${a}`,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:N,roundNumber:M}=v;if(M===1){let A=N[b];M2({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=zEe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:o,event:l});if(_.error)return le({result:_,stack:u});let k=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:B}=Qv({drawPosition:A,matchUps:k});B===1&&(qs({method:u,color:"brightyellow",loserMatchUpDrawPosition:A}),M2({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...re}}function zEe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var u;let{structure:s}=Dt({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=Gi({structure:s});if((u=l==null?void 0:l.find(c=>c.drawPosition===t))!=null&&u.bye){let c=pD({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(c.error)return c}return{...re}}function Pg({drawDefinition:t,stages:e}){if(!t)return{error:ot};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Vt(i.map(r=>{let{positionAssignments:a}=Gi({structure:r});return a?a.map(Jt):[]}).flat().filter(Boolean));return{...re,assignedParticipantIds:n}}function Mu(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||it}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function mm(t){return[Sg,Xl].includes(t)}function yM({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var P,E,D,R,N,M,A,_,k,B,F,x;if(!r||!Array.isArray(r))return{error:ku,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:ji};if(a&&!Qte.includes(a))return{error:h2};if(o&&!Hj.includes(o))return{error:vg};let p="modifyEntriesStatus",f=[];if(!a&&!s)return le({result:{error:ht},info:"Missing entryStatus",stack:p});if(s&&!mc({extension:s,requiredAttributes:["name"]}))return le({result:{error:we},info:"Invalid extension",context:{extension:s},stack:p});let h=[];(P=d==null?void 0:d.drawDefinitions)==null||P.forEach($=>{let j=Pg({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];h.push(...j)});let m=(i==null?void 0:i.participants)??[];if(!r.every($=>{var V;let j=(V=Qf({tournamentParticipants:m,participantId:$}))==null?void 0:V.participantType;return!(j&&[Ot,zs].includes(j)&&mm(a))&&!(a&&(d!=null&&d.eventType)&&j===Qt&&[Zs,Xs].includes(d.eventType)&&[Al,...aR].includes(a))}))return{error:h2};let g=d&&Gn({event:d}).flightProfile,v=(E=g==null?void 0:g.flights)==null?void 0:E.find($=>$.drawId===u),y=$=>{let j=($||[]).filter(H=>!c||!H.entryStage||c===H.entryStage).filter(({participantId:H})=>r.includes(H)),V=H=>a&&h.includes(H.participantId)&&!(aR.includes(H.entryStatus)&&aR.includes(a));return j.every(H=>V(H)&&!e?!1:(a&&(H.entryStatus=a,delete H.entryPosition),o&&(H.entryStage=o,delete H.entryPosition),s&&(s.value?fi({element:H,extension:s}):Ha({element:H,name:s.name})),!0))?{...re}:{error:p0}},b=({flight:$,drawDefinition:j})=>{d&&(d.entries=Mu({entries:d.entries??[]})),$&&($.drawEntries=Mu({entries:$.drawEntries})),j&&(j.entries=Mu({entries:j.entries}))},I=$=>{let{flight:j,drawDefinition:V}=$,H="updateDrawEntries";if(j){let z=y(j.drawEntries);if(z.error)return le({result:z,stack:H})}if(V){let z=y(V.entries);if(z.error)return le({result:z,stack:H});f.includes(V.drawId)||f.push(V.drawId)}return{...re}},T=((D=d==null?void 0:d.entries)==null?void 0:D.find(({entryPosition:$})=>$))??(((R=v==null?void 0:v.drawEntries)==null?void 0:R.find(({entryPosition:$})=>$))||((N=n==null?void 0:n.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!T&&b({flight:v,drawDefinition:n}),v||n){let $=I({flight:v,drawDefinition:n});if($.error)return le({result:$,stack:p})}let w=((M=d==null?void 0:d.drawDefinitions)==null?void 0:M.map(({drawId:$})=>$))??[],S=((A=g==null?void 0:g.flights)==null?void 0:A.filter($=>!w.includes($.drawId)))||[];for(let $ of S){let j=$&&I({flight:$});if(j!=null&&j.error)return le({result:j,stack:p})}let U=((_=g==null?void 0:g.flights)==null?void 0:_.length)===1&&(((k=d==null?void 0:d.drawDefinitions)==null?void 0:k.length)??0)<=((B=g==null?void 0:g.flights)==null?void 0:B.length);if(!v&&!n&&a&&Jte.includes(a))return{error:wee};if(!v&&!n||a===Sd||l&&U){let $=y(d==null?void 0:d.entries);if($!=null&&$.error)return le({result:$,stack:p});let j;if(a===Sd&&((F=g==null?void 0:g.flights)==null||F.every(V=>{let H=y(V.drawEntries);return H.error?(j=H.error,!1):(V.drawEntries=V.drawEntries.filter(({participantId:z})=>!r.includes(z)),!0)}),(x=d==null?void 0:d.drawDefinitions)==null||x.every(V=>{var z;let H=y(V.entries);return H.error?(j=H.error,!1):(V.entries=(z=V.entries)==null?void 0:z.filter(({participantId:q})=>!r.includes(q)),!0)})),j)return le({result:{error:j},stack:p})}t&&b({flight:v,drawDefinition:n});for(let $ of(d==null?void 0:d.drawDefinitions)??[])f.length&&!f.includes($.drawId)||Ji({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...re}}function nd({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:Oy};if(!Ii(e))return{error:we};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[Lm,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,f,h]=((n=c.itemType)==null?void 0:n.split("."))??[];if(d!==Lm)return{error:L1};let m=((r=a&&Sv({element:c.itemValue,accessor:a}))==null?void 0:r.value)||c.itemValue,g={eventType:f,scaleDate:c.itemDate,scaleValue:m,scaleName:h,scaleType:p};return{...re,scaleItem:g}}}return{...re,scaleItem:void 0}}function qEe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var c,d,p;let a={},o=f=>[Lm,td,r.eventType,f].join("."),s=Object.assign({},...(n.timeItems||[]).filter(({itemType:f})=>f.split(".")[1]===td).map(({itemType:f,itemValue:h})=>({[f]:h}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),u=Ln(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((c=t==null?void 0:t.drawIds)!=null&&c.length)||u.length)&&u.length){if(t!=null&&t.stageSeedingScaleNames){let f=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=o(t.stageSeedingScaleNames[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),h=Object.assign({},...f);a.seedAssignments=h}else if(u){let f=u.map(h=>s[h]);a.seedValue=f.pop()}}else if(!e&&typeof i=="object"){let f=Object.keys(i).map(m=>{let g=o(i[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),h=Object.assign({},...f);a.seedAssignments=h}else{let{categoryName:f,ageCategoryCode:h}=r.category||{},m=[h,r.eventId,f].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:td,scaleName:v},b=nd({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function WEe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...Rj(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=pt(f,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function Oie(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||n===Ui||e[i].scheduleItems.push({...c,scheduledDate:Ft(c==null?void 0:c.scheduledDate),scheduledTime:nn(c==null?void 0:c.scheduledTime),checkScoreHasValue:Kr({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function KEe({tournamentRecord:t,status:e=eu}){var n,r,a;let i=`${Ug}.${Dg}`;return(a=(r=(n=Z1({tournamentRecord:t,itemType:i}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function YEe(t){let{tournamentId:e}=t??{};return!!e}function dl({event:t,status:e=eu}){var n,r,a;let i=`${Ug}.${Dg}`;return(a=(r=(n=Y1({itemType:i,event:t}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function RG({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function Zy(t){var d,p,f,h,m,g,v;let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:a,drawId:o,event:s}=t??{};if(e&&!YEe(e))return{error:we};if(r&&!s)return{error:zo};if(Array.isArray(n)&&(n!=null&&n.length)){let y={};for(let b of n){if(!zn(b))return{error:we};let I=(d=ho({tournamentRecord:e,eventId:b}))==null?void 0:d.event;if(!I)return{error:zo};let T=UL({event:I});y[b]=T}return{...re,publishState:y}}if(s){let y=UL({event:s}),b={};if(o)return i?{publishState:{status:{published:!!((p=y.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(f=y.status.drawDetails)==null?void 0:f[o]},...re}}:{error:ms};if(Array.isArray(a)&&(a!=null&&a.length)){let I=((h=s.drawDefinitions)==null?void 0:h.map(pU))??[];for(let T of a){if(!zn(T))return{error:we};if(!I.includes(T))return{error:ms};b[T]={status:{published:!!y.status.publishedDrawIds.includes(T),drawDetail:(m=y.status.drawDetails)==null?void 0:m[T]}}}}else b=y;return{...re,publishState:b}}let l=[],u=!1,c={};for(let y of(e==null?void 0:e.events)??[]){let b=UL({event:y});c[y.eventId]=b,b.status.published&&(l.push(y.eventId),u=!0);for(let{drawId:I}of y.drawDefinitions??[]){let T=(v=(g=b.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(I);T&&(c[I]={status:{published:T}})}}if(e){let y=KEe({tournamentRecord:e});c.tournament=y??{},c.tournament.status={published:u,publishedEventIds:l}}return{...re,publishState:c}}function UL({event:t}){var a;let e=dl({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let o of((a=t.drawDefinitions)==null?void 0:a.map(pU))||[])n[o]||(n[o]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(o=>RG({drawDetails:n,drawId:o}))||e.drawIds;return{status:{published:r&&r.length>0,publishedDrawIds:r,publishedSeeding:i,drawDetails:n}}}function g_(t,e){return(t||"").localeCompare(e||"")}function ZEe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],f=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(h.winCount+=1,r===yi&&(h.walkoverWinCount+=1),r===ai&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||f(v)<f(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=n))}function E7(t){var A,_,k,B,F,x,$,j,V,H;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:u,finishingRound:c,matchUpStatus:d,stageSequence:p,roundNumber:f,structureId:h,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:T,collectionId:w,matchUpType:S,winningSide:U,matchUpId:P,schedule:E,eventId:D,drawId:R,sides:N}=t,M=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:z},q)=>{let W=N[1-q].participantId;return z&&{[z]:W}}).filter(Boolean));for(let z of N){let{participantId:q,sideNumber:W,bye:Y}=z;if(Y)continue;let Z=U===W,X=J=>{var oe,se;let ee=(oe=r[J])==null?void 0:oe.participant,ne=ee==null?void 0:ee.participantType,ie=[{participantId:J,participantType:ne}];if(ne!==zs)for(let pe of(ee==null?void 0:ee.individualParticipantIds)||[]){let fe=(se=r[pe])==null?void 0:se.participant;ie.push({participantType:fe==null?void 0:fe.participantType,participantId:pe})}return ie},Q=(J,ee)=>{if(o){if(r[J].matchUps[P]={participantWon:Z,matchUpType:S,structureId:h,sideNumber:W,matchUpId:P,eventId:D,drawId:R,stage:g},a){let ne=X(ee);r[J].matchUps[P].opponentParticipantInfo=ne}w&&(r[J].matchUps[P].collectionId=w)}a&&ee&&(r[J].opponents[ee]={participantId:ee,matchUpId:P,eventId:D,drawId:R}),v&&ZEe({finishingPositionRange:u,participantMap:r,participantWon:Z,finishingRound:c,matchUpStatus:d,participantId:J,stageSequence:p,roundNumber:f,structureId:h,matchUpId:P,drawId:R,stage:g}),(i||e)&&Oie({participantMap:r,participantId:J,matchUpStatus:d,roundPosition:b,matchUpType:S,roundNumber:f,structureId:h,matchUpId:P,schedule:E,drawId:R,score:m})},ce=({participant:J,partnerParticipantId:ee})=>{var ie,oe,se;let ne=(pe,fe)=>{pe&&(pe.partnerParticipantIds||(pe.partnerParticipantIds=[]),pe.partnerParticipantIds.includes(fe)||pe.partnerParticipantIds.push(fe))};l&&ne((ie=J==null?void 0:J.draws)==null?void 0:ie[R],ee),s&&ne((oe=J==null?void 0:J.events)==null?void 0:oe[D],ee),o&&ne((se=J==null?void 0:J.matchUps)==null?void 0:se[P],ee)};if(q&&r[q]){let J=M==null?void 0:M[W];Q(q,J);let ee=((A=r[q])==null?void 0:A.participant.participantType)===Ot,ne=((_=r[q])==null?void 0:_.participant.individualParticipantIds)||[];if(I){if(n){let ie=oe=>r[oe].matchUps[I]={participantWon:y===W,matchUpId:I,matchUpType:Zi,sideNumber:W};ie(q),ne.forEach(ie)}if(l&&!r[q].draws[R]){let ie=(B=(k=T.find(pe=>pe.sideNumber===W))==null?void 0:k.participant)==null?void 0:B.participantId,oe=($=(x=(F=r[ie])==null?void 0:F.draws)==null?void 0:x[R])==null?void 0:$.entryStatus,se=pe=>r[pe].draws[R]={entryStatus:oe,eventId:D,drawId:R};se(q),ne.forEach(se)}}if(ee&&(ne.forEach(ie=>r[ie]&&Q(ie,J)),ne.forEach((ie,oe)=>{let se=ne[1-oe],pe=r[ie];pe&&ce({participant:pe,partnerParticipantId:se})}),s&&T)){let ie=(V=(j=T.find(oe=>oe.sideNumber===W))==null?void 0:j.participant)==null?void 0:V.participantId;if(ie){let oe=(H=r[ie])==null?void 0:H.events[D];oe?(r[q].events[D]={...oe},ne.forEach(se=>r[se].events[D]={...oe})):console.log("Missing teamEntry",{eventId:D,teamParticipantId:ie})}}if(U){let ie=oe=>{Z?(r[oe].counters[S].wins+=1,r[oe].counters.wins+=1,d===yi&&(r[oe].counters[S].walkoverWins+=1,r[oe].counters.walkoverWins+=1),d===ai&&(r[oe].counters[S].defaultWins+=1,r[oe].counters.defaultWins+=1)):(r[oe].counters[S].losses+=1,r[oe].counters.losses+=1,d===yi&&(r[oe].counters[S].walkovers+=1,r[oe].counters.walkovers+=1),d===ai&&(r[oe].counters[S].defaults+=1,r[oe].counters.defaults+=1))};ie(q),ne.forEach(ie)}}}}function XEe(t){var N,M,A,_,k,B,F;let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:f,withOpponents:h,withMatchUps:m,withSeeding:g,withEvents:v,withDraws:y}=t,b=e==null?void 0:e.participantIds,I=x=>{var j,V;let $=[x];return(V=(j=s[x])==null?void 0:j.participant.individualParticipantIds)==null||V.forEach(H=>$.push(H)),$.some(H=>!(b!=null&&b.length)||b.includes(H))?$:[]},T={withMatchUps:m||u,withEvents:v||u,withDraws:y||u,withPotentialMatchUps:l,withRankingProfile:u,withScheduleItems:c,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:f,participantMap:s,withOpponents:h,withSeeding:g},w=[],S={},U=[],P={},E={},D={},R=({eventType:x,scaleNames:$,participantId:j})=>{var V,H,z,q,W;return(W=(q=(z=(H=(V=s[j])==null?void 0:V.participant)==null?void 0:H.rankings)==null?void 0:z[x])==null?void 0:q.find(Y=>$.includes(Y.scaleName)))==null?void 0:W.scaleValue};for(let x of(r==null?void 0:r.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(x.eventId))continue;let{drawDefinitions:$=[],extensions:j=[],eventType:V,eventName:H,category:z,entries:q,eventId:W,gender:Y}=x,{flightProfile:Z}=Gn({event:x}),X=(Z==null?void 0:Z.flights)??[],Q=Zy({event:x}).publishState;Q&&(P[W]=Q);let ce=(N=Q==null?void 0:Q.status)==null?void 0:N.publishedSeeding;if(v||g||u){let ee=i?Object.assign({},...Rj(j??[])):{};E[W]={...ee,eventName:H,eventType:V,category:z,eventId:W,gender:Y};let ne=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean);for(let ie of q){let{participantId:oe}=ie;if(!oe||!s[oe])continue;let se=R({eventType:V,scaleNames:ne,participantId:oe}),pe,fe;if(g){let me=s[oe].participant;({seedAssignments:pe,seedValue:fe}=qEe({publishedSeeding:ce,usePublishState:a,withSeeding:g,participant:me,event:x}))}let ge=me=>{var Be,Pe;if((Pe=(Be=s[me])==null?void 0:Be.events)!=null&&Pe[W])return;let Ee=s[me];WEe({convertExtensions:i,seedAssignments:pe,participant:Ee,withSeeding:g,seedValue:fe,eventId:W,ranking:se,entry:ie})};ge(oe),(s[oe].participant.individualParticipantIds||[]).forEach(ge)}}let J=(M=P==null?void 0:P[W])==null?void 0:M.publishedSeeding;if(y||u||g){let ee=ie=>ie?Object.assign({},...ie.map(({participantId:oe,seedValue:se,seedNumber:pe})=>({[oe]:{seedValue:se,seedNumber:pe}}))):void 0,ne=Vt([...$.map(pU),...X.map(pU)]);for(let ie of ne){let oe=$.find(he=>he.drawId===ie),se=X==null?void 0:X.find(he=>he.drawId===ie),pe=(oe==null?void 0:oe.entries)||(se==null?void 0:se.drawEntries),{structures:fe=[],drawOrder:ge,drawName:me,drawType:Ee}=oe??{},Be=se==null?void 0:se.flightNumber,Pe=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean),et=((oe==null?void 0:oe.structures)||[]).sort((he,ve)=>Gy(he,ve)).map(({structureId:he,structures:ve})=>[he,...(ve||[]).map(({structureId:Ce})=>Ce)]).flat(1/0),Ie,Ne,be,Le,Me=0,Ze=fe.filter(({stage:he,stageSequence:ve})=>he===it&&ve===1||he===gt).flatMap(he=>{let{seedAssignments:ve,stageSequence:Ce,stage:De}=he,{positionAssignments:Ue}=Gi({structure:he});return De===it?(Me=(Ue==null?void 0:Ue.length)??0,be=Ue,Le=ve):Ce===1&&(Ie=Ue,Ne=ve),Ue}).map(({participantId:he})=>he).filter(Boolean),qe=ee(Le),ye=ee(Ne),_e=oe?pe.filter(({participantId:he})=>Ze.includes(he)):pe,Ae=!a||(J==null?void 0:J.published)&&(((A=J==null?void 0:J.drawIds)==null?void 0:A.length)===0||((_=J==null?void 0:J.drawIds)==null?void 0:_.includes(ie)));for(let he of _e){if(!s[he.participantId])continue;let{entryStatus:ve,entryStage:Ce,entryPosition:De,participantId:Ue}=he,Qe=R({participantId:Ue,scaleNames:Pe,eventType:V}),je=ke=>{var Xn,It,hr,os,ss;if(!s[ke]||(Xn=s[ke].draws)!=null&&Xn[ie])return;let bt=g&&Ae,Gt=bt?{}:void 0,Zt=bt?((It=qe==null?void 0:qe[Ue])==null?void 0:It.seedValue)||((hr=qe==null?void 0:qe[Ue])==null?void 0:hr.seedNumber):void 0,Sr=Zt?qe==null?void 0:qe[Ue]:void 0,Oo=bt?((os=ye==null?void 0:ye[Ue])==null?void 0:os.seedValue)||((ss=ye==null?void 0:ye[Ue])==null?void 0:ss.seedNumber):void 0,ri=Oo?ye==null?void 0:ye[Ue]:void 0;Gt&&Zt&&(Gt[it]=Sr),Gt&&Oo&&(Gt[gt]=ri);let Tr=Zt||Oo;Tr&&(s[ke].participant.seedings[V]||(s[ke].participant.seedings[V]=[]),Sr&&s[ke].participant.seedings[V].push({...Sr,scaleName:ie}),ri&&s[ke].participant.seedings[V].push({...ri,scaleName:ie}),Gt&&(s[ke].events[W].seedAssignments||(s[ke].events[W].seedAssignments={}),Object.keys(Gt).forEach(Io=>s[ke].events[W].seedAssignments[Io]=Gt[Io]))),(y||u)&&(s[ke].draws[ie]=pt({seedAssignments:Gt,entryPosition:De,entryStatus:ve,entryStage:Ce,seedValue:Tr,eventId:W,ranking:Qe,drawId:ie},!1,!1,!0))};[Xl,Sg].includes(ve)||(je(Ue),(k=s[Ue].participant.individualParticipantIds||[])==null||k.forEach(je))}let Ve=((oe==null?void 0:oe.structures)??[]).reduce((he,ve)=>(he.includes(ve.stage)||he.push(ve.stage),he),[]),Ke=((oe==null?void 0:oe.links)??[]).length;D[ie]={qualifyingPositionAssignments:Ie,qualifyingSeedAssignments:Ne,mainPositionAssignments:be,qualifyingSeedingMap:ye,mainSeedAssignments:Le,orderedStructureIds:et,mainSeedingMap:qe,flightNumber:Be,linksCount:Ke,drawOrder:ge,drawName:me,drawType:Ee,drawSize:Me,drawId:ie,stages:Ve}}}if(u||d||p||f||h||m||y){let ee=!!d||l,ne=((B=Xp({afterRecoveryTimes:!!d,policyDefinitions:n,tournamentRecord:r,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:ee,event:x}))==null?void 0:B.matchUps)??[];for(let ie of ne){let{finishingPositionRange:oe,potentialParticipants:se,tieMatchUps:pe=[],sides:fe=[],winningSide:ge,matchUpType:me,matchUpId:Ee,eventId:Be,drawId:Pe,collectionId:et,stageSequence:Ie,finishingRound:Ne,matchUpStatus:be,roundPosition:Le,roundNumber:Me,structureId:Ze,schedule:qe,score:ye,stage:_e}=ie;S[Ee]=ie;let Ae={finishingPositionRange:oe,finishingRound:Ne,stageSequence:Ie,roundPosition:Le,collectionId:et,roundNumber:Me,structureId:Ze,schedule:qe,eventId:Be,drawId:Pe,score:ye,stage:_e};E7({...Ae,...T,matchUpStatus:be,winningSide:ge,matchUpType:me,matchUpId:Ee,sides:fe});for(let Ve of pe){let{winningSide:Ke,sides:he=[],matchUpId:ve,matchUpStatus:Ce,matchUpType:De}=Ve;E7({...Ae,...T,winningSide:Ke,tieWinningSide:ge,matchUpTieId:Ee,matchUpId:ve,sides:he,matchUpSides:fe,matchUpStatus:Ce,matchUpType:De})}Array.isArray(se)&&(ee||d||c)&&((F=se.flat().map(Jt).filter(Boolean))==null||F.forEach(Ve=>{var Ke;(Ke=I(Ve))==null||Ke.forEach(he=>{s[he]&&(s[he].potentialMatchUps[Ee]=pt({tournamentId:r==null?void 0:r.tournamentId,matchUpId:Ee,eventId:Be,drawId:Pe}))}),(d||c)&&Oie({potential:!0,participantMap:s,participantId:Ve,matchUpStatus:be,roundPosition:Le,structureId:Ze,matchUpType:me,roundNumber:Me,matchUpId:Ee,schedule:qe,drawId:Pe,score:ye})}))}U.push(...ne)}}if(f||u||d){let x=Object.values(s);for(let $ of x){let{wins:j,losses:V,[sn]:{wins:H,losses:z},[Wi]:{wins:q,losses:W}}=$.counters,Y=(Z,X,Q)=>{let ce=X+Q,J=X,ee=ce&&J/ce;$.statistics[Z]={denominator:ce,numerator:J,statValue:ee,statCode:Z}};if(f&&(Y(rR,j,V),Y(`${rR}.${sn}`,H,z),Y(`${rR}.${Wi}`,q,W)),u){let Z=(X=[])=>Math.abs(X[0]-X[1]);for(let X of Object.keys($.draws)){let{orderedStructureIds:Q=[],flightNumber:ce}=D[X]||{};if($.structureParticipation&&Q.length){let J,ee=0,ne=Q.map(ie=>{let oe=$.structureParticipation[ie];if(!oe)return;J||(J=oe==null?void 0:oe.finishingPositionRange),Z(J)>Z(oe==null?void 0:oe.finishingPositionRange)&&(J=oe==null?void 0:oe.finishingPositionRange);let se=oe.stage!==gt;return se&&(ee+=1),pt({...oe,participationOrder:se?ee:void 0,flightNumber:ce})}).filter(Boolean);$.draws[X]&&($.draws[X].finishingPositionRange=J,$.draws[X].structureParticipation=ne)}}}if(d){let Z=Ii(d)?d.scheduledMinutesDifference:0,X=$.scheduleItems||[],Q=$.potentialMatchUps||{},ce=X.reduce((ee,ne)=>{let{scheduledDate:ie,scheduledTime:oe}=ne;return ee[ie]||(ee[ie]=[]),oe&&ee[ie].push(ne),ee},{});Object.values(ce).forEach(ee=>ee.sort(vte));for(let ee of X){let{typeChangeTimeAfterRecovery:ne,timeAfterRecovery:ie,scheduledDate:oe,scheduledTime:se}=ee,pe=ce[oe],fe=li(se);for(let ge of pe){if(ge.matchUpId===ee.matchUpId||[yi,ai].includes(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let me=ee.matchUpType!==ge.matchUpType&&ne||ie,Ee=ee.drawId===ge.drawId,Be=Q[ee.matchUpId]&&Q[ge.matchUpId],Pe=li(ge.scheduledTime),et=Math.abs(Pe-fe),Ie=Pe>=fe;if((Z&&!isNaN(Z)?et<=Z:Ie&&li(ge.scheduledTime)<li(me))&&!(Be&&Ee)&&Ie){let Ne=[ee.matchUpId,ge.matchUpId].sort(g_).join("|");$.scheduleConflicts[Ne]={priorScheduledMatchUpId:ee.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let J=$.participant.participantId;Object.keys($.scheduleConflicts).length&&w.push(J),s[J].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:P,derivedEventInfo:E,derivedDrawInfo:D,mappedMatchUps:S,participantMap:s,matchUps:U}}function fD({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var I;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:u,participantIds:c,signInStatus:d,enableOrFiltering:p,eventIds:f,genders:h}=t,m=Hc(f)&&((I=e==null?void 0:e.events)==null?void 0:I.filter(T=>f==null?void 0:f.includes(T.eventId)))||(e==null?void 0:e.events)||[],g=r&&JEe({drawEntryStatuses:r,tournamentEvents:m}),v=o&&QEe({eventEntryStatuses:o,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>Lte({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),b=T=>n==null?void 0:n.reduce((w,S)=>{let{accessor:U,value:P}=S,{values:E}=Sv({element:T,accessor:U});return w&&(E==null?void 0:E.includes(P))},!0);if(i=i==null?void 0:i.filter(T=>{var N,M;let w=(M=(N=_c({element:T,itemType:K1}))==null?void 0:N.timeItem)==null?void 0:M.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:P,participantId:E,person:D}=T,R=Array.isArray(h)&&(h==null?void 0:h.length)&&(D==null?void 0:D.sex)&&h.includes(D.sex);return p?h&&R||a&&y.includes(E)||a===!1&&!y.includes(E)||(g==null?void 0:g.includes(E))||(v==null?void 0:v.includes(E))||(c==null?void 0:c.includes(E))||d&&w===d||u&&U&&Hc(u)&&u.includes(U)||s&&P&&Hc(s)&&s.includes(P)||l&&Hc(S)&&Hc(l)&&l.find(A=>S==null?void 0:S.includes(A))||(n==null?void 0:n.length)&&Hc(n)&&b(T):(!h||R)&&(a===void 0||a&&y.includes(E)||a===!1&&!y.includes(E))&&(!g||g.includes(E))&&(!v||v.includes(E))&&(!c||c.includes(E))&&(!d||w===d)&&(!u||U&&Hc(u)&&u.includes(U))&&(!s||P&&Hc(s)&&s.includes(P))&&(!l||Hc(S)&&Hc(l)&&l.find(A=>S==null?void 0:S.includes(A)))&&(!(n!=null&&n.length)||Hc(n)&&b(T))}),m.length&&f){let T=m.filter(w=>f.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(P=>P.participantId);if(On(hc)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(P=>S.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function Hc(t){return t&&Array.isArray(t)&&t.length}function JEe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Vt(e.reduce((n,r)=>{var l,u;let{flightProfile:a}=Gn({event:r}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(Jt):[]).flat())||[],s=((u=r.drawDefinitions)==null?void 0:u.map(({entries:c})=>c?c.filter(i).map(Jt):[]))||[];return n.concat(...o,...s)},[]))}function QEe({eventEntryStatuses:t,tournamentEvents:e}){return Vt(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Jt);return i.concat(...r)},[]))}function Bn(t){var V;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:u,withSignInStatus:c,withTeamMatchUps:d,withScaleValues:p,usePublishState:f,contextProfile:h,withStatistics:m,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:b,withEvents:I,withDraws:T,withISO2:w,withIOC:S}=t;if(!l)return{error:Fe};(v||r)&&tu({tournamentRecord:l});let{participantMap:U}=Zte({convertExtensions:a,tournamentRecord:l,withSignInStatus:c,withScaleValues:p,internalUse:y,withISO2:w,withIOC:S}),P=XEe({withMatchUps:v??r,withEvents:I??r,withDraws:T??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:f,withStatistics:m,participantMap:U,withOpponents:g,contextProfile:h,withSeeding:b}),{participantIdsWithConflicts:E,eventsPublishStatuses:D,derivedEventInfo:R,derivedDrawInfo:N,mappedMatchUps:M}=P,A=P.matchUps;U=P.participantMap;let _=u??n,k=({potentialMatchUps:H,scheduleConflicts:z,scheduleItems:q,participant:W,statistics:Y,opponents:Z,matchUps:X,events:Q,draws:ce})=>{let J=Object.values(ce),ee=Object.values(Z);return g&&(J==null||J.forEach(ne=>{ne.opponents=ee.filter(ie=>ie.drawId===ne.drawId)})),pt({...W,scheduleConflicts:u?Object.values(z):void 0,draws:T||r?J:void 0,events:I||r?Object.values(Q):void 0,matchUps:v||r?Object.values(X):void 0,opponents:g?ee:void 0,potentialMatchUps:_?Object.values(H):void 0,statistics:m?Object.values(Y):void 0,scheduleItems:s?q:void 0},!1,!1,!0)},B=new Map;for(let H of Object.keys(U))B.set(H,k(U[H]));let F=[...B.values()],x=(V=o==null?void 0:o[I0])==null?void 0:V.participant,$=fD({participants:F,participantFilters:i,tournamentRecord:l});if(e){let H=Ii(e)?e:void 0;for(let z of $)for(let q of z.individualParticipantIds??[]){z.individualParticipants||(z.individualParticipants=[]);let W=B.get(q);z.individualParticipants.push(H?Kv({template:H,source:W}):W)}}let j=x?$.map(H=>Kv({source:H,template:x})):$;return{participantIdsWithConflicts:E,eventsPublishStatuses:D,derivedEventInfo:R,derivedDrawInfo:N,mappedMatchUps:M,participantMap:U,participants:j,...re,matchUps:A}}function Tv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var a;if(!e)return{error:ot};let r=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&r}function N0(t){var f,h,m,g,v,y,b,I,T;let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:a}=t;if(!i)return{error:ot};let{entryProfile:o}=J1({drawDefinition:i}),s=a&&n&&((m=(h=(f=o==null?void 0:o[a])==null?void 0:f.stageSequence)==null?void 0:h[n])==null?void 0:m.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!r)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:u}=Dt({drawDefinition:i,structureId:r}),c=(v=i.links)==null?void 0:v.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(u==null?void 0:u.structureId)}),d=0;if(c!=null&&c.length)for(let w of c){let S=(y=Dt({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((S==null?void 0:S.stage)===gt){let U=w.source.roundNumber,P=w.target.roundNumber,E=0;if(S.structureType===ro){let D=((b=S.structures)==null?void 0:b.length)??0,R=((I=w.source.finishingPositions)==null?void 0:I.length)??0;E=D*R}else E=((T=Ei({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:T.length)||0;l[P]||(l[P]=0),l[P]+=E,d+=E}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function bM({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=J1({drawDefinition:e});return((n=i==null?void 0:i[t])==null?void 0:n.drawSize)||0}function eCe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=bM({stage:r,drawDefinition:i}),{qualifiersCount:o}=N0({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function xie({stage:t,drawDefinition:e}){return!!(t===$r||yG({stage:t,drawDefinition:e})&&bM({stage:t,drawDefinition:e}))}function Lie({entryStatus:t=Wo,drawDefinition:e,stageSequence:i,stage:n}){if(t===Al)return HPe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...re}:{error:Iee};let r=eCe({drawDefinition:e,stageSequence:i,stage:n}),a=zPe({drawDefinition:e,stage:n}),o=T2({entryStatus:nw,drawDefinition:e,stage:n}),s=T2({entryStatus:Wo,drawDefinition:e,stage:n}),l=o+s,u=l>=r,c=r-l;return n!==$r&&u?{error:m2}:t===nw?o<a?{...re}:{error:m2}:{positionsAvailable:c,...re}}function Fie(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=Wo,entryStageSequence:n,entryStage:r=it,ignoreStageSpace:a,drawDefinition:o,entryPosition:s,participant:l,roundTarget:u,extensions:c,extension:d,drawType:p,event:f}=t,h="addDrawEntry";if(!o)return{error:ot};if(!r)return{error:GV};if(p!==el&&!xie({stage:r,drawDefinition:o}))return le({result:{error:vg},stack:h});let m=Lie({stageSequence:n,stage:r,drawDefinition:o,entryStatus:i});if(!a&&!m.success&&(!p||p!==el))return{error:m.error};if(d&&!mc({extension:d}))return le({result:{error:we},info:"Invalid extension",context:{extension:d},stack:h});let g=t.participantId||(l==null?void 0:l.participantId);if(!g)return le({result:{error:cr},stack:h});let v=i===Tp&&Tv({participantId:g,drawDefinition:o,entryStatus:i}),y=r===$r&&Tv({participantId:g,drawDefinition:o,entryStage:r}),b=Tv({participantId:g,drawDefinition:o}),I=i!==Tp&&r!==$r&&b;if(I)return e?(jt({payload:{drawId:o.drawId,eventId:f==null?void 0:f.eventId,error:iU,participantId:g},topic:Qj}),{...re}):le({result:{error:iU},context:{participantId:g},stack:h});if(v||y)return le({context:{invalidEntry:I,invalidLuckyLoser:v,invalidVoluntaryConsolation:y},result:{error:kA},stack:h});let T=pt({entryStageSequence:n,participantId:g,entryPosition:s,entryStatus:i,entryStage:r,extensions:c});return d&&fi({element:T,extension:d}),u&&fi({extension:{name:"roundEntry",value:u},element:T}),o.entries||(o.entries=[]),o.entries.push(T),Ji({drawDefinition:o}),{...re}}function tCe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=Wo,stage:r=it,autoEntryPositions:a=!0,ignoreStageSpace:o,participantIds:s,drawDefinition:l,stageSequence:u,roundTarget:c,extension:d,event:p}=t;if(!r)return{error:GV};if(!l)return{error:ot};if(!Array.isArray(s))return{error:Hs};if(!xie({stage:r,drawDefinition:l}))return{error:vg};if(d&&!mc({extension:d}))return le({result:{error:we},info:"Invalid extension",context:{extension:d},stack:e});let f=Lie({drawDefinition:l,stageSequence:u,entryStatus:n,stage:r});if(!o&&!f.success)return{error:f.error};let h=f.positionsAvailable??0;if(!o&&r!==$r&&h<s.length)return{error:JV};let m=[],g=l.drawId,v=p==null?void 0:p.eventId,y=s.reduce((b,I)=>{let T=n===Tp&&Tv({participantId:I,drawDefinition:l,entryStatus:n}),w=r===$r&&Tv({entryStage:r,drawDefinition:l,participantId:I}),S=Tv({participantId:I,drawDefinition:l});return n!==Tp&&r!==$r&&S&&(m.push(I),i&&jt({payload:{error:iU,participantId:I,eventId:v,drawId:g},topic:Qj})),T||w?b.concat(I):b},[]);return m.length&&i?le({context:{eventId:v,drawId:g,duplicateEntries:m},result:{error:iU},stack:e}):(s.filter(b=>b&&!y.includes(b)).forEach(b=>{let I={entryStageSequence:u,entryStage:r,participantId:b,entryStatus:n};d&&fi({element:I,extension:d}),c&&fi({extension:{name:Mc,value:c},element:I}),l.entries||(l.entries=[]),l.entries.push(I)}),a&&(l.entries=Mu({entries:l.entries})),Ji({drawDefinition:l}),y!=null&&y.length||m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:y,duplicateEntries:m,...re}:{...re})}function MG({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:n,drawDefinition:r,participantIds:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:c,event:d}){if(!(a!=null&&a.length))return{error:Dh};if(!d)return{error:zo};if(!c)return{error:qu};let p=(d.entries||[]).map(Jt);if(a.filter(m=>!p.includes(m)).length)return{error:JQ};if(r){let m=tCe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:n,drawDefinition:r,participantIds:a,entryStatus:o,roundTarget:s,extension:u});if(m.error)return m}let{flightProfile:f}=Gn({event:d}),h=f==null?void 0:f.flights.find(m=>m.drawId===c);return h!=null&&h.drawEntries&&(a.forEach(m=>{let g=o===Tp&&DL({participantId:m,entryStatus:o,flight:h}),v=l===$r&&DL({participantId:m,entryStage:l,flight:h});!(o!==Tp&&l!==$r&&DL({flight:h,participantId:m}))&&!g&&!v&&h.drawEntries.push({participantId:m,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=Mu({entries:h.drawEntries}))),{...re}}function DL({participantId:t,entryStatus:e,entryStage:i,flight:n}){var a;let r=(a=n.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&r}function hD({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var d,p,f,h;let a="removeEventEntries";if(!(r!=null&&r.eventId))return{error:ji};if(!Array.isArray(e)||e.some(m=>!zn(m)))return le({result:{error:ku},stack:a});let o=(r.drawDefinitions??[]).flatMap(m=>Pg({drawDefinition:m}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=r.entries)==null?void 0:d.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Jt).filter(m=>!o.includes(m)),l=(n&&((p=r.entries)==null?void 0:p.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Jt).filter(m=>!o.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||s.includes(m))&&(!n||l.includes(m))):s.length&&l.length?e=Ln(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(m=>e.includes(m)))return le({result:{error:p0},stack:a});if(!(e!=null&&e.length))return{...re,participantIdsRemoved:[]};let u=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||u.push(m.participantId),g}),t&&(r.entries=Mu({entries:r.entries}));let{flightProfile:c}=Gn({event:r});return(f=c==null?void 0:c.flights)==null||f.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(h=r.drawDefinitions)==null||h.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...re,participantIdsRemoved:u}}var Bie={[Br]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},A0=Bie;function rd(t){var M,A;let{suppressDuplicateEntries:e=!0,entryStatus:i=Wo,autoEntryPositions:n=!0,enforceGender:r=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=it,tournamentRecord:l,ignoreStageSpace:u,drawDefinition:c,roundTarget:d,extensions:p,extension:f,drawId:h,event:m}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return le({result:{error:Hs},stack:g});let v=Vt(t.participantIds??[]);if(!m)return{error:ji};if(!(v!=null&&v.length))return le({result:{error:Dh},stack:g});if(!(m!=null&&m.eventId))return{error:zo};let y=mi({tournamentRecord:l,event:m}).appliedPolicies??{},b=(o==null?void 0:o[Br])??(y==null?void 0:y[Br])??A0[Br],I=(r??((M=b==null?void 0:b.participants)==null?void 0:M.enforceGender))!==!1,T=[],w=[];if(p&&(!Array.isArray(p)||!p.every(_=>mc({extension:_})))||f&&!mc({extension:f}))return le({context:pt({extension:f,extensions:p}),result:{error:we},info:"Invalid extension(s)",stack:g});let S=!!l,U=[],P,E=((A=l==null?void 0:l.participants)==null?void 0:A.filter(_=>{var F,x,$;if(!v.includes(_.participantId))return!1;let k=On(sn)(m.eventType)&&_.participantType===Qt&&!mm(i),B=m.eventType===Wi&&_.participantType===Ot;return k&&(!m.gender||!I||[Po,Lu].includes(m.gender)||m.gender===((F=_.person)==null?void 0:F.sex))||B&&!mm(i)||m.eventType===Wi&&_.participantType===Qt&&mm(i)?!0:k&&m.gender&&I&&![Po,Lu].includes(m.gender)&&m.gender!==((x=_.person)==null?void 0:x.sex)?(U.push({participantId:_.participantId,sex:($=_.person)==null?void 0:$.sex}),!1):m.eventType===Fi&&(_.participantType===Fi||mm(i)&&_.participantType===Qt)}).map(_=>_.participantId))??[],D=v.filter(_=>!S||E.includes(_));m.entries||(m.entries=[]);let R=m.entries.map(_=>{var k;return _.participantId||((k=_.participant)==null?void 0:k.participantId)});if(D.forEach(_=>{var k;if(!R.includes(_)){let B=pt({participantId:_,entryStatus:i,entryStage:s,extensions:p});f&&fi({element:B,extension:f}),d&&fi({extension:{name:Mc,value:d},element:B}),a&&(B.entryStageSequence=a),T.push(B.participantId),(k=m.entries)==null||k.push(B)}}),h&&!mm(s)){let _=MG({participantIds:D,suppressDuplicateEntries:e,autoEntryPositions:n,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:c,entryStatus:i,roundTarget:d,entryStage:s,extension:f,drawId:h,event:m});_.error&&(P=_.error)}if(m.eventType&&[Xf,Xs].includes(m.eventType)){let _=(m.entries||[]).map(x=>x.participantId),k=(m.entries||[]).filter(x=>mm(x.entryStatus)).map(x=>x.participantId),B=((l==null?void 0:l.participants)??[]).filter(x=>_.includes(x.participantId)&&x.participantType&&[Ot,Fi].includes(x.participantType)).map(x=>x.individualParticipantIds).flat(1/0),F=k.filter(x=>B.includes(x));F.length&&(w.push(...F),hD({participantIds:F,autoEntryPositions:!1,event:m}))}if(D.length!==v.length)return le({context:{mismatchedGender:U,gender:m.gender},result:{error:Hs},stack:g});n&&(m.entries=Mu({entries:m.entries||[]}));let N=T.length-w.length;return le({result:{...re,addedEntriesCount:N},stack:g,info:P})}var $ie="ADMINISTRATION",iCe="CAPTAIN",nCe="COACH",la="COMPETITOR",Vie="MEDIA",jie="MEDICAL",NG="OFFICIAL",Gie="OTHER",Hie="SECURITY",_h={ADMINISTRATION:$ie,CAPTAIN:iCe,COACH:nCe,COMPETITOR:la,MEDIA:Vie,MEDICAL:jie,OFFICIAL:NG,OTHER:Gie,SECURITY:Hie};function AG({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return le({result:{error:Fe},stack:a});if(!i||!e)return le({result:{error:ht},stack:a});let o=(n.participants??[]).find(c=>c.participantId===i);if(!o)return le({result:{error:_n},stack:a});if(![Fi,ws].includes(o.participantType))return le({result:{participantType:o.participantType,error:Ou},stack:a});let s=zie({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=s;if(u)return le({result:s,stack:a});if(t)for(let c of n.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(f=>!d.includes(f));rd({participantIds:p,entryStatus:Xl,tournamentRecord:n,event:c})}}return l&&jt({topic:fa,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...re,...s}}function zie({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var p,f;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:r}=Bn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let u=(f=(p=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:p.events)==null?void 0:f.map(({eventId:h})=>h),c=(e.individualParticipantIds??[]).filter(h=>{var y;let m=t==null?void 0:t.includes(h),g=m&&((y=a==null?void 0:a.find(b=>b.participantId===h))==null?void 0:y.matchUps.filter(({eventId:b})=>u.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||Kr({score:I}))),v=m&&!(g!=null&&g.length);if(m&&!v&&l.push(h),v){o.push(h);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=$t({element:I,name:bp}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(U=>U.participantId!==h),fi({element:I,extension:T}),W1({drawDefinition:I}));let S=za({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of S){let P=U.sides??[];for(let E of P){let D=E.lineUp??[];D.find(R=>R.participantId===h)&&(E.lineUp=D.filter(R=>R.participantId!==h),ci({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else s.push(h);return!v});e.individualParticipantIds=c;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!n&&{...d,cannotRemove:l,error:_A}||d}function v_({participantRole:t=la,individualParticipantIds:e=[],groupingTypes:i=[zs,ws],tournamentRecord:n}){if(!n)return{error:Fe};let r=n.participants??[],{participants:a,mappedMatchUps:o}=Bn({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=zie({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});u&&s++}),s?re:{error:mee}}function Xy(t){var f,h,m;if(!(t!=null&&t.tournamentRecord))return{error:Fe};if(!((f=t==null?void 0:t.participantIds)!=null&&f.length))return{error:Dh};let{addIndividualParticipantsToEvents:e,tournamentRecord:i,participantIds:n}=t,r=((h=i.participants)==null?void 0:h.length)||0;if(!r)return{...re};let a=(m=i.events||[])==null?void 0:m.filter(({eventType:g})=>g===vr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),o=Bn({participantFilters:{participantIds:n},tournamentRecord:i,withDraws:!0}).participants??[],s=()=>{let g=(Wr({matchUpFilters:{drawIds:a,matchUpTypes:[Wi]},tournamentRecord:i}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return Ln(g,n)},l=(a==null?void 0:a.length)&&s(),u=o.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(a!=null&&a.length)||!(a!=null&&a.includes(y.drawId)))&&y.positionAssignments).length});if(l!=null&&l.length||u.length)return{error:p0};let c={},d={};for(let g of i.events||[]){let v=hD({participantIds:n,event:g});if(v.error)return v;c[g.eventId]=v.participantIdsRemoved}i.participants=i.participants.filter(g=>{let v=n.includes(g.participantId)||g.participantType===Ot&&g.individualParticipantIds.some(y=>n.includes(y));if(!v&&g.participantType===vr&&g.individualParticipantIds.some(y=>n.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!n.includes(y))),v&&e&&[Ot,Fi].includes(g.participantType))for(let y of g.individualParticipantIds||[])n.includes(y)||(d[g.participantId]||(d[g.participantId]=[]),d[g.participantId].push(y));return!v});let p=r-i.participants.length;if(v_({individualParticipantIds:n,tournamentRecord:i}),e)for(let g of i.events||[]){let v=c[g.eventId].map(y=>d[y]||[]).flat();rd({participantIds:v,entryStatus:Xl,tournamentRecord:i,event:g})}return p&&jt({payload:{participantIds:n,tournamentId:i.tournamentId},topic:eG}),p?{...re,participantsRemovedCount:p}:{error:_A}}function qie({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var l;let o=r.entries??[];if(n){let{flightProfile:u}=Gn({event:r}),c=(l=u==null?void 0:u.flights)==null?void 0:l.find(d=>d.drawId===n);c?o=c.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&Jl.includes(u.entryStatus)));return{entries:o,stageEntries:s}}function Wie({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:Fe};if(!n)return le({result:{error:cr},stack:s});if(!o)return{error:ji};if(!o.eventType||![Xf,Xs].includes(o.eventType))return le({result:{error:vp},stack:s});let l=e.participants??[],u=l.find(y=>y.participantId===n);if(!u)return le({result:{error:_n},stack:s});if(!u.participantType||![Ot,zs].includes(u.participantType)||u.participantType===zs&&o.eventType!==Xs||u.participantType===Ot&&o.eventType!==Xf)return{error:Ou};let c=(o.entries??[]).find(y=>y.participantId===n);if(!c)return{error:bee};let{stageEntries:d}=qie({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),p=d.map(Jt),f=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),h=(v=u.individualParticipantIds)==null?void 0:v.filter(y=>rc(y,f).length===1),m=hD({participantIds:[n],event:o});if(m.error||h!=null&&h.length&&(m=rd({participantIds:h,entryStatus:Xl,entryStage:c.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),m.error))return m;let g;return t&&Xy({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...re,participantRemoved:g}}function _G({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return Wie({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function Kie(t){if(!t.tournamentRecord)return{error:Fe};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=Wie({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...re}:{error:r}}function wU(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=pD(t);if(u.error)return le({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t,h=mi({tournamentRecord:e,drawDefinition:n,event:p}).appliedPolicies??{};if([Al,Sd].includes(a)&&c){let{tournamentRecord:g}=t,{participant:v}=Nh({tournamentRecord:g,participantId:c}),{participantType:y,individualParticipantIds:b}=v??{};if(r&&y===Ot){let I=_G({tournamentRecord:g,drawDefinition:n,participantId:c,event:p});if(I.error)return le({result:I,stack:l});b&&yM({participantIds:b,tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else yM({participantIds:[c],tournamentRecord:g,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let g=Ss({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:f,matchUpsMap:o,event:p});if(g.error)return le({result:g,stack:l})}let{structure:m}=Dt({drawDefinition:n,structureId:f});return dG({structure:m,drawPositions:[d]}),a_({appliedPolicies:h,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function Yie(t){return Object.assign(t,{entryStatus:Sd}),wU(t)}function N2(t){return zn(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ua(t){return zn(t)?N2(t.replace(/_/g," ")):""}var zf=({finishingPosition:t=jy,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:f,roundLimit:h,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??Mi(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),f&&(y.roundOffset=f),m&&(y.stageOrder=m),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Vt(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},Fs=zf;function kG({structureName:t=ua($r),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:ot};let a=Fs({stage:$r,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Ji({drawDefinition:i,structureIds:[a.structureId]}),{...re}}function OG({drawPositions:t}){if(!(t!=null&&t.length))return{error:_1};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Vt(i.map(y_)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function y_(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(sr).join("|")}function Zie({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let f=a.shift(),h=a.pop(),m=o.shift();a=[f,m,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...r].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return y_(f)}))}function rCe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:ht}}var aCe={getRoundRobinGroupMatchUps:OG,determineRoundNumber:rCe,drawPositionsHash:y_,groupRounds:Zie};function mD(t){var S;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:r,appliedPolicies:a,seedingProfile:o,stage:s=it,matchUpType:l,roundTarget:u,structureId:c,groupNames:d,drawSize:p,idPrefix:f,isMock:h,uuids:m}=t,g=t.structureName??((S=i==null?void 0:i["0"])==null?void 0:S.name)??ua(it),{groupCount:v,groupSize:y}=oCe({structureOptions:r,appliedPolicies:a,drawSize:p}),b=U0,I,T=Xe(1,v+1).map(U=>{let P=sCe({groupSize:y,structureOrder:U,matchUpType:l,drawSize:p,idPrefix:f,isMock:h});I=Array.isArray(P)?Math.max(...P.map(({roundNumber:D})=>D??0)):0;let E=(d==null?void 0:d[U-1])??`${e} ${U}`;return zf({structureId:m==null?void 0:m.pop(),structureType:QA,finishingPosition:b,structureOrder:U,structureName:E,matchUps:P})}),w=zf({structureId:c??(m==null?void 0:m.pop()),structureType:ro,finishingPosition:b,seedingProfile:o,structureName:g,stageSequence:n,structures:T,stage:s});return u&&fi({extension:{name:Mc,value:u},element:w}),{structures:[w],maxRoundNumber:I,groupCount:v,links:[],groupSize:y,...re}}function oCe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=gD({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&(a!=null&&a.includes(n))||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function gD({drawSize:t,groupSizeLimit:e=10}){let i=Xe(3,e+1).filter(n=>{let r=Math.ceil(t/n),a=r*n-t,o=Math.ceil(t/r),s=Math.ceil(a/r);return(!a||a<n)&&o===n&&o>=3&&s<2});return{...re,validGroupSizes:i}}function sCe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Xe(1+s,i+1+s),u=OG({drawPositions:l}).uniqueMatchUpGroupings??[],c=Zie({groupSize:i,drawPositionOffset:s});return u.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return c.reduce((h,m,g)=>m.includes(f)?g+1:h,void 0)}function p(f){let h=y_(f),m=d(h),g=[1,n],v=lCe({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?Fn:Ui,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function lCe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||Mi()}function xG(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!Nt(i))return{seedBlocks:void 0,...le({result:{error:we},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=m0(i);if(e){let f=Math.min(e,r),h=[],m=1;for(Xe(0,f).forEach(()=>{h.push([m]),m++});m<r;){let g=Xe(m,m+f);m+=f,h.push(g)}return{...re,seedBlocks:h}}let a=Xe(1,r+1),o=[],s=r/2;for(;s>1;){let f=zr(a,s),h=f.length;f.forEach((m,g)=>{let v,y=g<h/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&h>4?h===8?v=y?T:I:v=b?I:T:v=y?I:T,Ya(m,o)||o.push(v)}),s=s/2}let l=a.filter(f=>!o.includes(f));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Xe(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(r),d=0,p=[];return Xe(0,c).forEach(f=>{p.push(o.slice(d,d+u[f])),d+=u[f]}),{...re,seedBlocks:p}}function LG({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!Nt(e))return{seedGroups:void 0,...le({result:{error:we},context:{drawSize:e},stack:i})};if(t){if(!Nt(t))return{seedGroups:void 0,...le({context:{roundRobinGroupsCount:t},result:{error:we},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Xe(0,r).map(()=>{let a=Xe(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=xG({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function FG({roundRobinGroupsCount:t,participantsCount:e}){var r;if(t){let{validGroupSizes:a}=gD({drawSize:e});if(!((r=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&r.includes(t)))return le({context:{roundRobinGroupsCount:t},result:{error:we}})}let{seedGroups:i}=LG({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...re,seedingThresholds:n}}function aw(t){if(!t)return 1/0;if(Nt(t))return St(t);let e=t.split("-")[0];return Nt(e)?St(e):1/0}function uCe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(sr),e.reverse(),e}function cCe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function dCe({positioning:t,size:e}){let i=uCe({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,f)=>(t&&[JA,$m].includes(t)&&f%2?o(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!r.includes(h))){let h=s(p,f);return r.push(h),h}},u=p=>{let f=p.filter(h=>!r.includes(h));if(f.length)return r.push(...f),f},c=(p,f)=>{let h=s(p,f);if(!r.includes(h))return r.push(h),h},d=Xe(1,e+1);for(let p of i)if(p===1){let f=zr(d,2),h=f.map(l).filter(Boolean);h.length&&n.push(h);let m=f.flatMap(u).filter(Boolean);m.length&&n.push(m)}else{let f=zr(d,p).map(c).filter(Boolean);f.length&&n.push(f)}return{divisions:i,divisionGroupings:n}}function Jy({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var _;let s=[];if(!o)return{error:Uh};let{matchUps:l,roundMatchUps:u}=Ei({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:c}=tl({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:d}=_r({structure:o}),p=d==null?void 0:d.length,f=(c==null?void 0:c.length)??0,h=[],m=Object.keys(u).map(k=>parseInt(k)).sort((k,B)=>k-B).map(k=>{let B=u[k].map(x=>x.drawPositions).flat(1/0).filter(Boolean),F=B.filter(x=>!h.includes(x));return h=h.concat(...B),F}).filter(k=>k.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??((_=i==null?void 0:i.seeding)==null?void 0:_.seedingProfile);let y=(g==null?void 0:g.length)||0,b=m.filter(k=>k.filter(B=>B<=f).length),{stage:I,structureType:T,roundLimit:w}=o,S=T===ro,U=!S&&(m==null?void 0:m.length),P=!S&&I===gt&&w,E=b.flat(1/0),D=U?E==null?void 0:E.length:0,R=a?p:f,N=UG({drawDefinition:r,structure:o,matchUps:l}),M=N?0:!U&&R||R&&E.length<R&&R-E.length||0;if(P){let k=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:F})=>F===o.roundLimit).length:0,B=g.length/k;if(!U){let F=vD(n),x=zr(g,B),$=1,j=Xe(0,x[0].length).map(()=>{let V=Xe($,$+x.length);return $+=x.length,V});({validSeedBlocks:s}=Xie({drawPositionBlocks:x,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:j}))}}else S?{validSeedBlocks:s}=pCe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):U?s=b.map(k=>({seedNumbers:k,drawPositions:k})):N&&zr(g,2).map((k,B)=>({drawPositions:[k[0]],seedNumbers:[B+1]})).forEach(k=>s.push(k));if(!S&&!N&&!P){let{blocks:k}=fCe({drawPositionOffset:v,seedNumberOffset:D,seedCountGoal:M,seedingProfile:n,baseDrawSize:y});k.forEach(B=>s.push(B))}let A=s.flatMap(k=>k.drawPositions).reduce((k,B)=>(g==null?void 0:g.includes(B))&&k,!0);return!N&&!U&&!S&&!A?{error:KQ,validSeedBlocks:[],isContainer:S,isFeedIn:U}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:S,isFeedIn:U}}function pCe({seedingProfile:t,structure:e,nonRandom:i}){var c;let n=e.structures||[],r=n.length,a=(c=Gi({structure:e}))==null?void 0:c.positionAssignments,o=vD(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=LG({roundRobinGroupsCount:r,drawSize:s}),u=n.map(d=>{var p;return(p=Gi({structure:d}).positionAssignments)==null?void 0:p.map(f=>f.drawPosition)});return Xie({drawPositionBlocks:u,positioning:o,seedGroups:l,nonRandom:i})}function Xie({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=dCe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=cCe({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==$m?f=n?f:Ga(f):l%2&&f.reverse();let h=f.find(m=>!o.includes(m));h&&(o.push(h),r.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:r}}function fCe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=xG({cluster:vD(r)===JA,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),f=c(s+1,d.length).map(h=>+h+n);s+=d.length,l.push({drawPositions:p,seedNumbers:f})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(f,h)=>h+d)}}function IM({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var l,u,c,d,p,f;let{structure:o}=Dt({drawDefinition:e,structureId:r});t||(t=mi({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=Jy({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((f=s.find(h=>h.seedNumbers.includes(a)))==null?void 0:f.drawPositions)||[]).includes(n):[].concat(...s.map(h=>h.drawPositions)).includes(n)}function Jie(t){var R,N,M;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:a,randomize:o}=t,{structure:s}=Dt({drawDefinition:i,structureId:a}),{seedAssignments:l}=tl({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:u}=_r({structure:s}),c=(R=u==null?void 0:u.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:R.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:d}=mi({drawDefinition:i}),p=((r==null?void 0:r.validSeedBlocks)||s&&((N=Jy({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(c!=null&&c.includes(_))).length)[0],f=l==null?void 0:l.map(A=>A.participantId).filter(Boolean),h=u==null?void 0:u.map(A=>A.participantId).filter(Boolean),m=f==null?void 0:f.filter(A=>h==null?void 0:h.includes(A)),g=f==null?void 0:f.filter(A=>!(h!=null&&h.includes(A))),v=l==null?void 0:l.filter(A=>g==null?void 0:g.includes(A.participantId)),y=l==null?void 0:l.filter(A=>!A.participantId),b=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(A=>!(c!=null&&c.includes(A))))||[],I=o?Ga(b):b,T=[],w=I.map(()=>{var _;let A=(_=D(v,T))==null?void 0:_.participantId;return A&&T.push(A),A}).filter(Boolean),S=l==null?void 0:l.filter(A=>m==null?void 0:m.includes(A.participantId)).map(A=>A.seedNumber),U=((p==null?void 0:p.seedNumbers)||[]).filter(A=>!(S!=null&&S.includes(A))),P=l==null?void 0:l.filter(A=>U.includes(A.seedNumber)).map(A=>A.participantId),E=(M=d==null?void 0:d.seeding)==null?void 0:M.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?w:P,unplacedSeedNumbers:U,unfilledPositions:I,unplacedSeedAssignments:v};function D(A,_){let k=A.filter(x=>!_.includes(x.participantId)),B=Math.min(...k.map(x=>aw(x.seedValue))),F=k.filter(x=>aw(x.seedValue)===B);return Ga(F).pop()}}function vD(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function _0({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var T,w,S;let d="assignSeed",{structure:p}=Dt({drawDefinition:i,structureId:o}),{positionAssignments:f}=_r({structure:p}),h=tl({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=h.map(U=>U.seedNumber),g=Tv({drawDefinition:i,participantId:r});if(r&&!g)return le({result:{error:ku},context:{participantId:r},stack:d});let v=c?(w=(T=Gn({event:c}).flightProfile)==null?void 0:T.flights)==null?void 0:w.length:0,y=v&&v>1,b=(S=f==null?void 0:f.find(U=>U.participantId===r))==null?void 0:S.drawPosition;if(b&&!IM({drawPosition:b,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return le({result:{error:xV},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(s)||h.push({seedNumber:s,seedValue:l});let I;return h.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!y&&(U.seedValue=l??s),I=!0)}),I?(Gte({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:u}),{...re}):le({result:{error:WQ},stack:d})}function BG({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var p,f,h,m;let s=(f=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:f.sideNumber,l=s&&((h=a.sides)==null?void 0:h.find(g=>g.sideNumber===s)),{extension:u}=$t({element:r,name:bp}),c=(u==null?void 0:u.value)||{},d=st(c[i],!1,!0);if(l)(m=a==null?void 0:a.sides)==null||m.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}ci({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function Qie(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=zm({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:m})=>m===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:m})=>h===o&&m===c),p=d==null?void 0:d.matchUpStatus,f=[ir,br].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function hCe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(sr).filter(Boolean),positionAdded:i,positionAssigned:n}}function ene({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:zm({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function tne({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=ene({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(c=>{let d=zn(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function uR({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function ow({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var R,N,M,A;let c="assignMatchUpDrawPosition";s||(s=ga({drawDefinition:r})),t||(t=pr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let d=t.find(_=>_.matchUpId===l),p=d==null?void 0:d.structureId,f=(R=r==null?void 0:r.structures)==null?void 0:R.find(_=>_.structureId===p);if(!f)return{error:Sn};let h=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(_=>_.matchUpId===l),m=(h==null?void 0:h.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=hCe({drawPosition:o,drawPositions:m}),{positionAssignments:b}=Gi({drawDefinition:r,structure:f}),I=(M=b==null?void 0:b.filter(_=>y.includes(_.drawPosition)))==null?void 0:M.find(({bye:_})=>_),T=(h==null?void 0:h.matchUpStatus)&&[yi,ai].includes(h.matchUpStatus)&&y.filter(Boolean).length<2;if(a=I&&Ui||a||T&&h.matchUpStatus||(h==null?void 0:h.matchUpStatus)&&[ir,br].includes(h.matchUpStatus)&&h.matchUpStatus||Fn,h&&g){t=pr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=T&&uR({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;h!=null&&h.matchUpStatusCodes&&tne({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:y,winningSide:_,matchUpStatus:a}),ci({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:c,drawDefinition:r,matchUp:h})}let w=Xa({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:S,loserMatchUp:U,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:E}}=w,D=zm({structureId:f.structureId,matchUpsMap:s});if(v&&I){if(S)if([Ui,ir,br].includes(a)){let _=ow({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=S;_!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(S&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=Qie({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:f});if(_){let k=ow({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(k.error)return k}}if((h==null?void 0:h.matchUpType)===Zi){let _=t==null?void 0:t.find(({matchUpId:F})=>F===h.matchUpId),k=((_==null?void 0:_.sides)??[]).reduce((F,x,$)=>x.drawPosition===o?$:F,void 0),B=(A=b==null?void 0:b.find(F=>F.drawPosition===o))==null?void 0:A.participantId;B&&k!==void 0&&BG({inContextTargetMatchUp:_,drawPositionSideIndex:k,teamParticipantId:B,tournamentRecord:i,drawDefinition:r,matchUp:h})}if((E==null?void 0:E.linkCondition)===bd&&y.filter(Boolean).length===2&&!I&&D.filter(({drawPositions:_,roundNumber:k})=>k===1&&Ya(_,y)).every(({matchUpStatus:_})=>[kn,ta].includes(_))&&U){let{structureId:_}=U,k=Ss({drawPosition:P,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:u});if(k.error)return k}return v?{...re}:le({result:{error:GI},context:{drawPosition:o},stack:c})}function ine({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var c,d,p,f;let a=((p=(d=(c=D0({drawDefinition:e}))==null?void 0:c.containedStructures)==null?void 0:d[r.structureId])==null?void 0:p.map(({structureId:h})=>h))||[];a.push(r==null?void 0:r.structureId);let o=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],s=(t==null?void 0:t.filter(h=>a.includes(h.structureId)&&Ln(h.drawPositions??[],o).length))??[],l=s.map(({matchUpId:h})=>h),u=((f=n==null?void 0:n.drawMatchUps)==null?void 0:f.filter(h=>l.includes(h.matchUpId)))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function $G({lineUp:t}){if(!Array.isArray(t))return;let e={};return Vt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=gM({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Td(t){return`${t} must be an array`}function b_({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Td("lineUp")),{valid:!1,errors:i,error:we};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Td("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Vt(t.map(Jt)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?we:void 0}}function Qy({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:ot};if(typeof e!="string")return{error:cr};let r=b_({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=$t({element:t,name:bp}),o=(a==null?void 0:a.value)||{};return o[e]=$G({lineUp:n}),fi({element:t,extension:{name:bp,value:o}}),W1({drawDefinition:t}),{...re}}function VG({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:ot};let{drawPositions:l,matchUps:u,targetMatchUps:c}=ine({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of c)d.matchUpType===gc&&(d.sides??[]).forEach((p,f)=>{var h;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let m=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=m==null?void 0:m.sides)!=null&&h[f]){if(delete m.sides[f].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Qy({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}ci({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...re}}function vc({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var U,P,E;let f="assignDrawPosition";if(!s&&!i)return le({result:{error:cr},stack:f});c=c??ga({drawDefinition:a}),e||({matchUps:e}=pr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let h=Dt({drawDefinition:a,structureId:d});if(h.error)return le({result:h,stack:f});let{structure:m}=h;if(!m)return{error:Sn};if(Ko({structure:m}))return le({result:{error:Co},stack:f});let{seedAssignments:g}=tl({provisionalPositioning:t,drawDefinition:a,structure:m}),v=(U=g==null?void 0:g.find(D=>D.participantId===s))==null?void 0:U.seedNumber,{appliedPolicies:y}=mi({tournamentRecord:r,drawDefinition:a,structure:m,event:p});if(v&&!IM({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return le({result:{error:xV},context:{drawPosition:u},stack:f});let b=_r({structure:m}).positionAssignments||[],I=b==null?void 0:b.find(D=>D.drawPosition===u);if(!I)return le({result:{error:l0},context:{drawPosition:u},stack:f});if(b!=null&&b.map(Jt).includes(s))return le({result:{error:p0},context:{drawPosition:u},stack:f});let{containsParticipant:T,containsBye:w}=S(I);if(w){let D=pD({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(D.error)return le({result:D,stack:f})}if(T&&I.participantId!==s){let{activeDrawPositions:D}=dD({drawDefinition:a,structureId:d});if(D.includes(u))return le({result:{error:CA},stack:f});VG({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:m})}if(I.participantId=s,i&&(I.qualifier=!0),((m==null?void 0:m.stageSequence)||0)>1||m.stage&&[pa,Nn].includes(m.stage)){let D=m.stage===gt?gt:it,R=(((E=(P=a.structures)==null?void 0:P.find(N=>(N==null?void 0:N.stage)===D&&(N==null?void 0:N.stageSequence)===1))==null?void 0:E.seedAssignments)??[]).find(N=>N.participantId===s);if(R!=null&&R.participantId){let{participantId:N,seedNumber:M,seedValue:A}=R;_0({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(m.structureType!==ro)mCe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:m,event:p});else{_ie({positionAssignments:b,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:m});let{drawPositions:D,matchUps:R,targetMatchUps:N}=ine({assignments:[I],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:m});if(D&&(R==null?void 0:R.length)===1&&R[0].matchUpType===Zi){let M=((N==null?void 0:N[0].sides)??[]).reduce((A,_,k)=>D!=null&&D.includes(_.drawPosition)?k:A,void 0);BG({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:R[0],drawPositionSideIndex:M,tournamentRecord:r,drawDefinition:a})}}return nh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:b,...re};function S(D){let R=D.bye,N=D.qualifier,M=D.participantId;return{containsBye:R,containsQualifier:N,containsParticipant:M,filled:R||N||M}}}function mCe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Ei({provisionalPositioning:t,matchUpFilters:u,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Za({matchUps:c}),{initialRoundNumber:p}=Qv({drawPosition:a,matchUps:c}),f=p&&(d==null?void 0:d[p].find(h=>{var m;return(m=h.drawPositions)==null?void 0:m.includes(a)}));if(f){let h=ow({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(h.error)return le({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...re}}function jG(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:ot};let d=mi({tournamentRecord:r,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:f}=t;f||(f=ga({drawDefinition:a}),Object.assign(t,{matchUpsMap:f})),p||({matchUps:p}=pr({inContext:!0,drawDefinition:a,matchUpsMap:f}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=Gi({drawDefinition:a,structureId:l}),m=h==null?void 0:h.find(I=>I.drawPosition===s);if(m!=null&&m.participantId){let I=m.participantId,T=vc({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:f,event:u});return T.success?b({appliedPolicies:d,removedParticipantId:I}):le({result:T,stack:c})}let g=pD({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:f,event:u});if(g.error)return le({result:g,stack:c});let v=g.participantId,y=vc({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:f,event:u});if(!y.success)return le({result:y,stack:c});return b({appliedPolicies:d,removedParticipantId:v});function b({appliedPolicies:I,removedParticipantId:T}){let{structure:w}=Dt({drawDefinition:a,structureId:l});dG({drawPositions:[s],structure:w});let S={[e]:o,name:n,drawPosition:s,structureId:l};return a_({appliedPolicies:I,drawDefinition:a,positionAction:S}),le({context:{removedParticipantId:T},result:{...re},stack:c})}}function gCe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return jG({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function nne(t){return gCe(t)}function vCe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return jG({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function rne(t){return vCe(t)}function ane({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],ci({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function one(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=Lt(t,i);if(n.error)return n;let r=Dt(t);if(r.error)return r;let a=r.structure;if(!Ko({structure:a}))return le({result:{error:Ny,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Za({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Hp}}function sne(t){var c;let e=one(t,[{targetRoundNumber:!0,roundNumber:!0,[ul]:zDe}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(r!=null&&r.includes(o))||!(r!=null&&r.includes(a)))return le({result:{error:we},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Xe(o+1,a+1):Xe(a,o),u={};return l.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(s?1:-1)})),(c=n==null?void 0:n[o])==null||c.forEach(({matchUpId:d})=>u[d]=a),ane({params:t,modMap:u,structure:i}),{...re}}function lne({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var s;if(!n)return{error:ot};if(!Array.isArray(t))return{error:we};let a="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=Dt({drawDefinition:n,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Sn};let f=(s=Gi({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if(Ln(f,h).length!==(f==null?void 0:f.length))return le({result:{error:we},info:"drawPositions do not match",stack:a});let m=ga({drawDefinition:n}),{matchUps:g}=pr({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of c||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=Ss({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:u,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=vc({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:u,event:r});if(w!=null&&w.error)return w}}nh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let o=t.map(({structureId:l})=>l);return Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...re}}function une(t){let e=one(t,[{roundNumbers:!0,[ul]:uo,[ks]:o=>o.length===2&&o.every(Dn)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return le({result:{error:we,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),ane({params:t,modMap:a,structure:i}),{...re}}function yCe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return jG({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function cne(t){return yCe(t)}function bCe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:ot};if(!n)return{error:Is};if((i==null?void 0:i.length)!==2)return{error:we,drawPositions:i};let a=ga({drawDefinition:e}),{matchUps:o}=pr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=Dt({drawDefinition:e,structureId:n});if(!s)return{error:Sn};let l=mi({tournamentRecord:t,drawDefinition:e,event:r}).appliedPolicies??{},u;if(s.structureType===ro?u=SCe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):u=ICe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),u.error)return u;if(dG({structure:s,drawPositions:i}),a_({appliedPolicies:l,drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),nh({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===Xs){let c=Ei({matchUpFilters:{matchUpTypes:[gc]},inContext:!0,structure:s}).matchUps.filter(p=>{var f;return(f=p.drawPositions)==null?void 0:f.some(h=>i.includes(h))}),d=Ei({matchUpFilters:{matchUpTypes:[gc]},structure:s}).matchUps;c.forEach(p=>{(p.sides||[]).forEach(f=>{var m;let h=f==null?void 0:f.drawPosition;if(i.includes(h)){let g=f.participantId,v=d.find(({matchUpId:b})=>b===p.matchUpId),y=(m=p==null?void 0:p.sides)==null?void 0:m.reduce((b,I,T)=>I.drawPosition===h?T:b,void 0);BG({inContextTargetMatchUp:p,drawPositionSideIndex:y,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:r})}})})}return Ji({drawDefinition:e,structureIds:[n]}),{...re}}function ICe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>n==null?void 0:n.includes(u.drawPosition));if(!s)return{error:we,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...re};if(s.filter(({qualifier:u})=>u).length===2)return{...re};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?dne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):wCe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function dne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:h})=>h),l=n.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=wU({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return f.error||(f=wU({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),f.error)||(Ss({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),f=vc({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:r,event:o}),f.error)?f:{...re}}function wCe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,u)=>{let{drawPosition:c}=l,d={...n[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),VG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...re}}function SCe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var u;let s=(u=a.structures)==null?void 0:u.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(f=>n==null?void 0:n.includes(f.drawPosition));return p&&c.push(...p),c},[]);if(s.filter(({bye:c})=>c).length===2)return{...re};if(s.filter(({qualifier:c})=>c).length===2)return{...re};VG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:s,structure:a,event:o});let l=s.some(({qualifier:c})=>c);if(s.some(({bye:c})=>c)&&!l)dne({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o});else{let c=st(s,!1,!0);s.forEach((d,p)=>{let f=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=f})}return{...re}}function pne(t){return bCe(t)}function fne({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:ot};if(!r)return{error:Is};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:ku};let{structure:l}=Dt({drawDefinition:i,structureId:r});if(!l)return{error:Sn};if(!(!t||Dn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Dn(p)&&St(p)>0)))return{error:we};let{seedAssignments:u}=tl({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return Gte({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...re}}function hne({drawDefinition:t,structureId:e}){if(!t)return{error:ot};let{structure:i}=Dt({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function I_({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:ji};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=wd({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function GG({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:Fe};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=I_({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function rh(t){if(!(t!=null&&t.drawDefinition))return!1;let e=m_(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Zi),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Zi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Zi)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function HG(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:ot};let{playoffStructures:n}=hne({drawDefinition:e,structureId:i});if(!(n!=null&&n.length))return!1;let r=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&Jl.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(n||[]).reduce((l,u)=>{var c;return!!((c=Gi({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!n.length)||a===r}function A2({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=A2({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=A2({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function TCe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:WV};if(!Array.isArray(n))return{error:x1};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=mne({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function mne({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:WV};if(!n)return{error:Oy};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");r.push(...A2({significantCharacters:u,value:n,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var h;let f=i.find(m=>m.participantId===p);if((h=f==null?void 0:f.individualParticipantIds)!=null&&h.includes(n.participantId)){let m=f==null?void 0:f.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(n.participantId)&&r.push(c)})}),{values:Vt(r)}}function C7({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=mne({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function gne({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function UCe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=gne(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=r(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var d;let c=R7(u);return!((d=n[c])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=R7(s);return!a.includes(l)}}}function DCe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=gne(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var u;return(u=n[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function R7(t){return Number(t%2?t+1:t-1)}function PCe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function ECe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?DCe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):UCe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function vne({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function CCe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var u;let a=Object.assign({},...Object.keys(n).map(c=>[c,n[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),o=Object.keys(a).reduce((c,d)=>a[d].length>c?a[d].length:c,0),s=Object.keys(a).filter(c=>a[c].length===o),l=Bo(i?s:Object.keys(a));return r=t&&((u=a[r])!=null&&u.length)?r:l,{participantId:r&&a[r]?Bo(a[r]):Bo(e),groupKey:r}}function RCe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function MCe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((U,P)=>P.length>U?P.length:U,0)<=2,u=vne({positionAssignments:t,participantIds:e}),c=RCe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=CCe({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),f=PCe({participantId:d,allGroups:o}),h=ECe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let U=Vo(w);S=Vo(U)}else{let U=Vo(m[0]);S=Vo(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function wM({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=OG({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Ya(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;Ya(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function NCe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(m=>m.includes(u)).find(m=>m!==u),d=t.find(m=>m.drawPosition===c),p=wM({isRoundRobin:r,groupedParticipants:[[s,d]]}),f=[t.find(m=>m.drawPosition===u),d],h=wM({isRoundRobin:r,groupedParticipants:[f]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function M7(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,f=st(e,!1,!0).filter(b=>!b.qualifier),h=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Xe(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=MCe({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=b,f.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=C7({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=zr(m,d),v=wM({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=NCe({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=ACe({candidatePositionAssignments:f,swapOptions:b});I.error&&console.log({result:I}),m=C7({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=zr(m,d),v=wM({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return f.forEach(b=>{if(b.bye&&b.participantId){let I=d2;u.push(I)}if(b.qualifier&&b.participantId){let I=d2;u.push(I)}}),{positionAssignments:f,conflicts:v.length,groupedParticipants:g,errors:u}}function ACe({candidatePositionAssignments:t,swapOptions:e}){let i=Vo(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Vo(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===n),o=t.find(u=>u.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...re}}function _Ce({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var $;if(!c)return{error:ree};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:m}=c,{roundsToSeparate:g}=c,v="randomUnseededSeparation",{structure:y}=Dt({drawDefinition:a,structureId:u}),{matchUps:b}=Ei({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&xu(m)&&!g){let j=bDe(m)||0,V=b.reduce((H,z)=>z.roundNumber>H?z.roundNumber:H,0);g=V<j?1:V-j+1}let{positionAssignments:I}=_r({structure:y}),T=pG({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=I==null?void 0:I.filter(j=>!j.participantId),S=I==null?void 0:I.map(j=>j.drawPosition),U=(y==null?void 0:y.structureType)===ro,P=U?{structure:y,matchUps:b,allDrawPositions:S,roundsToSeparate:g}:{matchUps:b,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:D}=U?kCe(P):OCe(P),R={groupParticipants:s.filter(j=>j.participantType===ws).map(j=>j.participantId),teamParticipants:s.filter(j=>j.participantType===Fi).map(j=>j.participantId),pairParticipants:s.filter(j=>j.participantType===Ot).map(j=>j.participantId)},N=TCe({targetParticipantIds:e,policyAttributes:h,idCollections:R,participants:s});if(N.error)return le({result:N,stack:v});let M=Object.assign({},...e.map(j=>{let V=Object.keys(N).filter(H=>(N[H]??[]).includes(j));return{[j]:V}})),A=vne({participantIds:e,positionAssignments:I});if(A.length>((w==null?void 0:w.length)||0))return{error:QV};let _,k=A.length,B=Xe(0,f).map(()=>M7({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:n,participantIdGroups:M,drawPositionChunks:D,drawPositionGroups:E,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));if(_=B.reduce((j,V)=>!j||(V.conflicts||0)<(j.conflicts||0)?V:j,void 0),!_||_.conflicts){let j=Xe(0,f).map(()=>M7({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:n,participantIdGroups:M,drawPositionChunks:D,drawPositionGroups:E,policyAttributes:h,idCollections:R,allGroups:N,drawSize:d}));_=B.concat(...j).filter(V=>{var H;return!((H=V.errors)!=null&&H.length)}).reduce((V,H)=>!V||(H.conflicts||0)<(V.conflicts||0)?H:V,void 0)}if(!_)return{error:xA};let F=((($=Gi({structure:y}))==null?void 0:$.positionAssignments)??[]).filter(j=>j.participantId).map(j=>j.participantId),x=_.positionAssignments.filter(j=>!F.includes(j.participantId));for(let j of x)if(j.bye){let V=Ss({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...j});if(V.error)return le({result:V,stack:v})}else if(j.participantId){let V=vc({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...j});if(V.error)return le({result:V,stack:v,context:{assignment:j}})}return{...re}}function kCe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function OCe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),r=n.flat().sort(sr),a=Math.max(...r),o=t.filter(c=>c>a),s=r.length,l=Xe(s===2?1:2,s).filter(c=>c===cj(c)),u=l.slice(0,e||l.length).reverse().map(c=>zr(r,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:u}}function xCe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var P,E;let f="positionUnseededParticipants";c||({structure:c}=Dt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:h}=_r({structure:c}),{seedAssignments:m}=tl({provisionalPositioning:t,drawDefinition:a,structure:c}),g=m==null?void 0:m.map(D=>D.participantId).filter(Boolean),{stage:v,stageSequence:y}=c,b=v===gt?(E=(P=$t({element:c,name:Mc}))==null?void 0:P.extension)==null?void 0:E.value:void 0,I=qy({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:Tg,structureId:u,roundTarget:b,stage:v}),T=I.filter(D=>!(g!=null&&g.includes(D.participantId))).map(D=>D.participantId),w=h==null?void 0:h.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!n&&T.length>((w==null?void 0:w.length)||0))return le({result:{error:QV},context:{unseededParticipantsCount:T.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:f});let{appliedPolicies:S}=mi({tournamentRecord:r,drawDefinition:a,event:p}),U=S==null?void 0:S[cU];if(c.stage===Nn){let D=I.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(D).length&&(U||(U={policyName:"Playoff Avoidance"}),U.policyAttributes||(U.policyAttributes=[]),U.policyAttributes.push({groupings:D}))}return U&&s?_Ce({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:U,drawSize:d,entries:I}):LCe({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function LCe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Ga(n):n.reverse();for(let f of e){let h=p.pop();if(!r||h){let m=vc({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:f,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return le({result:m,stack:"randomUnseededDistribution"})}}return{...re}}function FCe(t){let e=t.structure??Dt(t).structure,i="positionQualifiers",n=[];if(e.stage===pa)return le({result:{error:vg},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=BCe(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(r[s]>(l||0))return le({result:{error:See},context:{unfilledDrawPositions:l},stack:i});Xe(0,r[s]).forEach(()=>{let u=Vo(l);n.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...re,qualifierDrawPositions:n}}function BCe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Dt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=_r({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=N0({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>St(m)),{matchUps:u}=Ei({structure:e}),{roundProfile:c}=Za({matchUps:u}),d=Object.assign({},...l.filter(m=>c==null?void 0:c[m]).map(m=>{var g,v;return{[m]:((v=(g=c==null?void 0:c[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),f=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function N7({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],g=0;if(p||({structure:p}=Dt({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),n||(n=mi({drawDefinition:a}).appliedPolicies),!r){let v=p&&Jy({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return u=u??(r==null?void 0:r.length)??0,Xe(0,u).forEach(()=>{if(g<(u||0)){let v=$Ce({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:f});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...re,seedPositions:h}}function $Ce({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=Jie({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=mi({drawDefinition:n}),{avoidance:f}=p??{};f&&o&&(c==null?void 0:c.length)>2;let h=[];for(let m of c){let g=d.pop();if(!g)return{error:u0};h.push(g);let v=vc({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...re,seedPositions:h}}function VCe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=_r({structure:i}),{seedAssignments:r}=tl({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function jCe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=_2(zr(a.drawPositions,2)),s,l=t[n.length];for(;s=cR(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?Ga(a):a).flat(1/0);return zee(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function cR(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return cR(e?r:t[Math.round(Math.random())],e)}return i<n?cR(t[1],e):cR(t[0],e)}function _2(t){let e=Math.floor(t.length/2);return t.length>2?[_2(t.slice(0,e)),_2(t.slice(e))]:t}function GCe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var I;a||(a=Jy({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:l,isLuckyStructure:u,isContainer:c}=a,{validSeedBlocks:d}=a;(I=i==null?void 0:i.seeding)!=null&&I.containerByesIgnoreSeeding&&(d=[]);let p=VCe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],f=Vt([].concat(...e.map(T=>T.drawPositions))),h=p.filter(T=>f.includes(T.drawPosition)),m=(T,w)=>aw(T.seedValue)-aw(w.seedValue),g=d.reduce((T,w)=>{let S=h.filter(U=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(U.drawPosition)}).sort(m);return T.concat(...S)},[]).map(T=>T.drawPosition),v=jCe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=A7({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),b=A7({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:u,positionedSeeds:p,isContainer:c,isFeedIn:l}}function A7({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function HCe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var A,_;let l=(A=n==null?void 0:n.seeding)==null?void 0:A.seedingProfile,u=o.stage===gt,{positionAssignments:c}=_r({structure:o}),d=c==null?void 0:c.filter(k=>k.participantId).map(k=>k.drawPosition),p={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:h}=Ei({provisionalPositioning:t,matchUpFilters:p,structure:o}),m=(h==null?void 0:h[1])||[],g=o.structureType===ro?f:m,v=Vt([].concat(...g.map(k=>k.drawPositions))),y=Math.min(...v)-1,b=d==null?void 0:d.filter(k=>v.includes(k)),I=k=>{let B=Math.ceil(k.length/2),F=[k.slice(0,B),k.slice(B)],x=F.map(Y=>[].concat(...Y.flat(1/0)).length),$=Math.min(...x.flat(1/0)),j=Math.max(...x.flat(1/0)),V=x.indexOf(j),H=$!==j,z=Ga(F),[q,W]=!$||H?[F[V],F[1-V]]:[z[0],z[1]];return{greaterHalf:q,lesserHalf:W}},T=k=>{let{greaterHalf:B,lesserHalf:F}=I(k),{greaterHalf:x,lesserHalf:$}=I(B),j=Ga(x.flat(1/0)).pop(),V=x.flat().filter(H=>H!==j);return{newlyFilteredChunks:[...F,...$,V],drawPosition:j}},w=k=>!e.includes(k),S=k=>!(b!=null&&b.includes(k)),U=k=>{let B=zr(k.sort(sr),Math.ceil(k.length/4)).map($=>$.filter(S)),F=[].concat(...B.flat(1/0)).length,x=[];for(let $=0;$<F;$++){let{newlyFilteredChunks:j,drawPosition:V}=T(B);x.push(V),B=j}return x},{validSeedBlocks:P}=Jy({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),E=P==null?void 0:P.map(k=>{var B;return(B=k.drawPositions)==null?void 0:B.map(F=>F+y)}),D;if(s){let k=v.length,{seedBlocks:B}=xG({cluster:vD(l)===JA,participantsCount:k});D=B.map(F=>F.map(x=>x+y)).map(U).filter(F=>F.length)}else u?D=E==null?void 0:E.map(k=>k.filter(S)):D=E==null?void 0:E.map(U).filter(k=>k.length);let R=g.map(k=>k.drawPositions).map(k=>k==null?void 0:k.sort((B,F)=>B-F)).filter(k=>(k==null?void 0:k[0])+1===(k==null?void 0:k[1])),N=k=>R.reduce((B,F)=>F.includes(k)?F.reduce((x,$)=>$!==k?$:x,void 0):B,void 0),M=D.map(k=>k.map(N)).flat(1/0).filter(S).filter(w).filter(Boolean);if(u&&!o.structures){let k=a%4,B=M.slice(0,k),F=(_=h[o.roundLimit])==null?void 0:_.length,x=zr(M.slice(k),F).map(Ga).flat();M=B.concat(x)}return{unseededByePositions:M}}function zCe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var E;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=Ei({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:n,event:r}),l=(s==null?void 0:s[1])||[],u=(n==null?void 0:n.structureType)===ro,c=u?o:l,d=u?((E=n==null?void 0:n.structures)==null?void 0:E.length)||0:o.length,{structureId:p,stage:f,stageSequence:h}=n,m=qy({entryStatuses:Jl,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),{qualifiersCount:g}=N0({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:f}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=_r({structure:n}),I=b==null?void 0:b.map(D=>D.drawPosition),T=y==null?void 0:y.filter(D=>D.bye).length,w=y==null?void 0:y.filter(D=>D.bye).map(D=>D.drawPosition),S=c.map(D=>D.drawPositions).filter(D=>D==null?void 0:D.reduce((R,N)=>!(w!=null&&w.includes(N))&&R,!0)).flat(1/0).filter(D=>I==null?void 0:I.includes(D)),U=y==null?void 0:y.length,P=U?U-v:0;return P>d&&n.stageSequence===1&&n.stage!==pa&&(P=d),{placedByes:T,byesCount:P,relevantMatchUps:c,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:S}}function _7({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var R;l||({structure:l}=Dt({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===gt),{byesCount:f,placedByes:h,relevantMatchUps:m}=zCe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),g=f-(h||0);if(g<=0)return{...re};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=GCe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),T=(l==null?void 0:l.structureType)&&[ro,QA].includes(l.structureType)&&((R=i==null?void 0:i.seeding)==null?void 0:R.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:S}=HCe({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:I}),U=N=>N%2,P=(N,M)=>(N||[]).every(A=>U(A)?M!==A+1:M!==A-1),E=[].concat(...w);if(!c)for(;S.length;){let N=S.find(M=>P(E,M));N?(E.push(N),S=S.filter(M=>M!==N)):(E.push(...S),S=[])}T&&(E=Ga(E),gs({ignoreSeededByes:T})&&console.log({byePositions:E}));let D=E.slice(0,g);for(let N of D){let M=Ss({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(M!=null&&M.error)return M}return{...re,unseededByePositions:S,byeDrawPositions:D}}function yD(t){var A,_,k,B;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:u,seedLimit:c,seedsOnly:d,drawType:p,drawSize:f,event:h}=t,m=[];i||(ete(),e=st(e,!1,!0));let g=F=>(i||iR(),le({result:F,stack:"automatedPositioning"})),v=F=>(i||iR(),F),y=Dt({drawDefinition:e,structureId:u});if(y.error)return g(y);let b=y.structure;if(!b)return{error:Sn};let I=t.appliedPolicies||((A=mi({drawDefinition:e,structure:b,event:h}))==null?void 0:A.appliedPolicies),{qualifiersCount:T}=N0({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,drawDefinition:e,structureId:u}),w=Tg;if(!((_=qy({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:u}))!=null&&_.length)&&!T)return v({...re});let S=t.matchUpsMap??ga({drawDefinition:e}),U=t.inContextDrawMatchUps??((k=pr({inContext:!0,drawDefinition:e,matchUpsMap:S}))==null?void 0:k.matchUps),P=[],E=Jy({provisionalPositioning:n,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:D}=E;m.push({validSeedBlocks:D});let R=t.participants||(o?(B=Bn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:B.participants:[]);if(vD(b.seedingProfile||l)===$m){let F=a?_7({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:c,seedsOnly:d,event:h}):void 0;if(F!=null&&F.error)return g(F);P=F.unseededByePositions,m.push({action:"positionByes",unseededByePositions:P});let x=b.seedingProfile?{positioning:b.seedingProfile}:l;if(F=N7({seedingProfile:x,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:h}),F.error)return g(F);m.push({seedPositions:F.seedPositions,action:"positionSeedBlocks"})}else{if(p!==bg){let x=b.seedingProfile?{positioning:b.seedingProfile}:l,$=N7({seedingProfile:x,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b,event:h});if($.error)return g($);m.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let F=a?_7({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:b,seedLimit:c,seedsOnly:d,event:h}):void 0;if(F!=null&&F.error)return g(F);P=F==null?void 0:F.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:F==null?void 0:F.byeDrawPositions,unseededByePositions:P})}let N={};if(!d){let F=FCe({inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:I,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structure:b});if(F.error||(F.conflicts&&(N.qualifierConflicts=F.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:F.qualifierDrawPositions}),F=xCe({provisionalPositioning:n,inContextDrawMatchUps:U,unseededByePositions:P,multipleStructures:r,tournamentRecord:o,drawDefinition:e,seedBlockInfo:E,participants:R,matchUpsMap:S,structureId:u,structure:b,drawSize:f,event:h}),F.error))return g(F);F.conflicts&&(N.unseededConflicts=F.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:M}=Gi({drawDefinition:e,structure:b});return Ji({drawDefinition:e,structureIds:[u]}),i||iR(),{positionAssignments:M,conflicts:N,...re,positioningReport:m}}function bD(t){var f;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l,event:u}=t;if(!u)return{error:zo};if(!r)return{error:ms};if(!rh({drawDefinition:r,structureId:o})&&!i)return{error:OV};let c=(f=hne({drawDefinition:r,structureId:o}).playoffStructures)==null?void 0:f.sort((h,m)=>fM(h)-fM(m)),d=[],p=[];if(c)for(let h of c){let{structureId:m}=h,g=yD({structureId:m,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,placeByes:s,seedsOnly:l});if(g.error)return g;g.positionAssignments&&d.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&p.push(g.positioningReport)}return{...re,structurePositionAssignments:d,positioningReports:p}}function yne({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>Nt(i)))&&le({result:{error:we},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>zI(i.structureOrder)-zI(n.structureOrder)),{...re}):{error:ot}}function w_({drawDefinition:t}){var g,v,y,b,I,T,w;let e=t.structures??[],i=t.links??[],n=new Map,r=S=>{let U=n.get(S)||n.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(S);if(U&&!(U!=null&&U.stage)){let P=e.find(E=>E.structureId===S);U.stage=P==null?void 0:P.stage}return U},a={},o={},s=i.map(S=>{let U=S.source.structureId,P=S.target.structureId,E=r(U),D=r(P);return[Vm,Cl,e_,$m].includes(S.target.feedProfile)?(E==null||E.targets.push(P),D==null||D.sources.push(U)):S.target.feedProfile===Pl&&(D==null||D.drawSources.push(U),E==null||E.drawTargets.push(P)),o[P]=o[P]||S.target.feedProfile===Pl,a[P]=Vt([...a[P]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of n.keys()){let U=n.get(S);if(U){let P=U.targets??[];for(;P.length;){let E=P.pop(),D=E&&n[E];(g=D==null?void 0:D.targets)!=null&&g.length?P.push(...D.targets):D&&(U.rootStage=D.stage)}if(U.rootStage||(U.rootStage=U.stage),!((v=U.targets)!=null&&v.length)){let E=U.sources??[];for(;E.length;){let D=E.pop(),R=D&&n[D];if((y=R==null?void 0:R.sources)!=null&&y.length){for(let N of R.sources)(b=U.progeny)!=null&&b.includes(N)||((I=U.progeny)==null||I.push(N));E.push(...R.sources)}}}}}let l=0;for(let S of n.keys()){let U=n.get(S);if(U&&U.rootStage===gt){let P=[(T=U.drawTargets)==null?void 0:T[0]],E=0;for(;P.length;){E+=1;let D=P.pop(),R=D?n.get(D):void 0;(w=R==null?void 0:R.drawTargets)!=null&&w.length&&P.push(R.drawTargets[0])}U.distanceFromMain=E,E>l&&(l=E)}}let u=s.length;Xe(0,Math.ceil(u/2)).forEach(()=>{s=Xe(0,u).map(S=>{let U=s[S],P=s.reduce((E,D)=>Ya(U,D)?E.concat(...D):E,[])||[];return Vt(U.concat(...P))})});let c=s[0],d=(S,U)=>Ln(S,U).length===S.length,p=s.slice(1).reduce((S,U)=>S&&d(U,c),!0),f=[c].filter(Boolean),h=[c].filter(Boolean);e.forEach(S=>{let{structureId:U,stage:P}=S;f.find(E=>E.includes(U))||(f.push([U]),P!==$r&&h.push([U]))});let m=p&&h.length===1;return!(i!=null&&i.length)&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:f}}function bne({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=w_({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...re}}function kh(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=t;if(!r)return{error:nj};let a=Yte(t);if(a.error)return a;if(!(Ii(r)&&zn(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:ij};if(!a.timeItems)a.timeItems=[];else if(qCe({element:a,duplicateValues:e,timeItem:r}))return{...re};if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let o=new Date().toISOString();Object.assign(r,{createdAt:o})}return n&&(a.timeItems=a.timeItems.filter(({itemType:o})=>r.itemType!==o)),n&&!r.itemValue||a.timeItems.push(r),{...re}}function qCe({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:n,itemSubTypes:r,itemValue:a}=i,o=n&&((s=_c({itemSubTypes:r,itemType:n,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function zG({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:Fe};if(!r)return{error:cr};let o=Nh({tournamentRecord:i,participantId:r});return o.error?o:kh({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function eb(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;return i?kh({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a}):{error:Fe}}function tb(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?kh({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:zo}}function qG({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:Fe};if(!e)return{error:ot};let r=WCe({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return eb({tournamentRecord:t,timeItem:a}),r}function WCe({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var l;if(!t)return{error:ot};if(!i)return{error:Uh};if(!r)return{error:$V};let a=r.target.structureId,o=Dt({drawDefinition:t,structureId:a});if(o.error)return le({stack:"attachQualifyingStructure",context:{targetStructureId:a},result:o});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),bne({drawDefinition:t});let s=((l=Ei({structure:i}))==null?void 0:l.matchUps)||[];return ih({drawDefinition:t,tournamentId:e,matchUps:s,eventId:n}),Ji({drawDefinition:t,structureIds:[i.structureId]}),{...re}}function Ine({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:we};if(!t)return{error:ot};let i=Object.assign({},...e.map(n=>{if(!Ii(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:ht};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...re}}function WG({drawDefinition:t,timeItem:e}){if(!t)return{error:ms};if(!e)return{error:nj};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:ij};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),W1({drawDefinition:t}),{...re}}function wne(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,a=Lt(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===n);if(!s)return{error:Sn};let l=o.find(({stage:y,stageSequence:b})=>y===it&&b===1),u=n===(l==null?void 0:l.structureId),c=o.filter(({stage:y})=>y===gt).map(Yo("structureId"));if(u&&!c.length)return{error:LQ};let d=c.includes(n),p=KCe({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=ZCe({qualifyingStructureIds:c,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=XCe({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:u,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:f,structureId:n});if(YCe({removedMatchUpIds:m,drawDefinition:i}),u){let y=(v=l.matchUps??[])==null?void 0:v.map(Yo("matchUpId"));m.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&bne({drawDefinition:i}),Wp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r==null?void 0:r.eventId,drawDefinition:i}),Ji({drawDefinition:i,eventId:r==null?void 0:r.eventId}),{...re,removedMatchUpIds:m,removedStructureIds:g}}function KCe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var l,u,c,d,p,f;let s=[n];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(l=h(n))==null?void 0:l.source.structureId;for(;m;)s.push(m),m=(u=h(m))==null?void 0:u.source.structureId}if((c=pr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&c.some(({score:h})=>Kr({score:h}))){let h=(d=mi({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((f=(p=h==null?void 0:h[Js])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:f.structures)))return{error:BA}}return{...re}}function YCe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=pr({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function ZCe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(Yo("structureId")),s=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function XCe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...eRe({idBeingRemoved:u,drawDefinition:r}));let c=QCe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:o});s.push(...c.removedStructureIds);let d=JCe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function JCe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function QCe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var o;let a=[];return n.links=((o=n.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function eRe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=Dt({structureId:t,drawDefinition:e}),n=Ei({structure:i}).matchUps;return xj(n)}function SM({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:ot};if(!yG({drawDefinition:e,stage:n}))return{error:vg};let r=WPe({drawDefinition:e,stage:n}),{qualifiersCount:a}=N0({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:BV};let{entryProfile:s}=vG({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Ji({drawDefinition:e}),{...re,entryProfile:s}}function Sne({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?yG({drawDefinition:e,stage:i})?i!==it?{error:BV,info:"qualifiersCount can only be set for main stage"}:(vG({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Ji({drawDefinition:e}),{...re}):{error:vg}:{error:ot}}function tRe({drawDefinition:t,drawSize:e}){if(!t)return{error:ot};let i=SM({stage:$r,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Ji({drawDefinition:t}),{...re})}function Tne(t){return tRe(t)}function Une({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var o;let r="removeSeededParticipant";if(!t)return{error:Fe};if(!e)return{error:ot};let a=(e.structures??[]).find(s=>s.structureId===n);return a?!a.stage||![it,gt].includes(a.stage)||a.stage===it&&a.stageSequence!==1?le({result:{error:Ny},stack:r}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...re}:le({info:"participant not seeded",result:{error:Hr},context:{participantId:i}}):le({result:{error:Sn},stack:r})}function ID({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Sp}){return!n||!r?{error:Is}:{link:pt({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Pl,roundNumber:t,structureId:r}})}}function KG({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||Mi()}function TM({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let f=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=KG({roundPosition:c,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:c,children:[f,h],matchUpId:m};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Fn,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),c++,l+=2}return{roundNodes:u,matchUps:n}}function yc({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!xu(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let c=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!xu(s)&&!c)return{matchUps:[],roundsCount:0};let d=Xe(1,s+1).map(g=>({drawPosition:g})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=TM({matchUpType:r,roundNumber:h,idPrefix:o,matchUps:f,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)n&&p.length===n&&(a=h-1),{roundNodes:p,matchUps:f}=TM({nodes:p,matchUpType:r,roundNumber:h,idPrefix:o,matchUps:f,isMock:l,uuids:u}),h++;let m=h-1;return f=uD({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:f,roundsCount:m,roundLimit:a}}function YG(t){var B,F,x,$,j,V;let e="generateQualifyingStructure";if(!t.drawDefinition)return le({result:{error:ot},stack:e});if(t.drawSize&&!Nt(t.drawSize)||t.participantsCount&&!Nt(t.participantsCount)||t.qualifyingPositions&&!Nt(t.qualifyingPositions))return le({result:{error:we},stack:e});let i=t.drawSize??uj(t.participantsCount),{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:u,structureName:c,structureId:d,roundTarget:p,drawType:f,idPrefix:h,isMock:m,uuids:g}=t;if(!t.drawSize)return le({result:{error:k1},context:{drawSize:i},stack:e});if(r&&r>=t.drawSize)return le({result:{error:we},context:{drawSize:i,qualifyingPositions:r},stack:e});let v,y,b,I,T=0,w,S=1,{structureProfiles:U}=w_({drawDefinition:l}),P=U[a];if(!P)return le({result:{error:Sn},context:{targetStructureId:a},stack:e});let E=l.matchUpType,D=p?`${p}-`:"",R=P.stage===gt,N=((F=(B=s==null?void 0:s[ZI])==null?void 0:B.namingConventions)==null?void 0:F.pre)??(($=(x=wEe[ZI])==null?void 0:x.namingConventions)==null?void 0:$.pre),M=R&&N?`${N}-`:"",A=c??(D?`${M}${ua(gt)} ${D}`:`${M}${ua(gt)}`);if(f===jl){let{maxRoundNumber:H,structures:z,groupCount:q}=mD({structureName:c??A,structureId:d??(g==null?void 0:g.pop()),stage:gt,structureOptions:o,appliedPolicies:s,stageSequence:S,matchUpType:E,roundTarget:p,idPrefix:h,drawSize:i,isMock:m,uuids:g});T=q,v=H,b=z[0],w=[1]}else({drawSize:i,matchUps:I,roundLimit:v,roundsCount:y}=yc({qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:E,idPrefix:h,drawSize:i,isMock:m,uuids:g})),v||(v=y),b=Fs({structureName:c??A,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:gt,matchUpFormat:u,stageSequence:S,matchUpType:E,roundLimit:v,matchUps:I}),p&&fi({extension:{name:Mc,value:p},element:b}),T=(j=I==null?void 0:I.filter(H=>H.roundNumber===v))==null?void 0:j.length;let _=f===jl?wp:Sp,k=b&&v&&((V=ID({sourceStructureId:b.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:_}))==null?void 0:V.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:T,...re,structure:b,link:k}}function Dne(t){let e=t.tournamentRecord;if(!e)return{error:Fe};let i=iRe(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:u,drawType:c}=t,d={itemType:"addQualifyingStructures",itemValue:pt({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:u,drawType:c})};return eb({tournamentRecord:e,timeItem:d}),i}function iRe(t){if(!t.drawDefinition)return{error:ot};if(!t.targetStructureId)return{error:Is};let e=YG(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:we}:qG({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function nRe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Xe(0,c).map(m=>d?d+m:void 0),f=[];for(let m=0;m<c;m++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=KG({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Fn,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),o&&(I.isMock=!0),a.push(I);let T={children:[y,v]};f.push(T)}let h=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function ah(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let g=rRe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,k)=>_+k,0),n=i.length}else r>=v?n=0:u&&(n=v-u,r=0),i=g.filter((A,_)=>u&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-T;let w=0,S=[],U,P=1,E=Xe(0,a).map((A,_)=>({drawPosition:_+1+y})),D=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=TM({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:f,nodes:E,uuids:h}),P++,i.includes(A)){let _=qo(i)[A],k=Xe(0,_),B=I+1-P,F=(o==null?void 0:o.includes(B))??(l==null?void 0:l.includes(P));k.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:D}=nRe({drawPosition:!F&&D||void 0,nodes:U,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:f,uuids:h,fed:w})),P++,w+=1})}E=U}I!==P-1&&console.log("ERROR");let R=a-y;S=uD({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let N=U!=null&&U.length?U[0]:U;return N&&(N.roundNumber=P-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:I};function M(A){let _=cj(A);return _>A?_/2:_}}function rRe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Xe(0,e).reverse().map(i=>Math.pow(2,i))}function NI(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,stage:m=it,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,P=e+g,E=`${U}-${P}`,D=o==null?void 0:o[l],R=n&&`${n} `||"",N=(o==null?void 0:o[E])??(r==null?void 0:r[E]),M=t.structureName||(N==null?void 0:N.name)||(D==null?void 0:D.name)&&(i?`${R}${D==null?void 0:D.name}`:D.name)||`${R}${E}`,A=(N==null?void 0:N.abbreviation)??(D==null?void 0:D.abbreviation),_=t.structureId??(D==null?void 0:D.structureId)??(b==null?void 0:b.pop()),k={idPrefix:v&&`${v}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:B}=f?ah(k):yc(k),F=Fs({structureAbbreviation:A,stageSequence:s,structureName:M,matchUpType:S,roundOffset:d,structureId:_,matchUps:B,stage:m});I.push(...B),T.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,x):!a||U<a?x:0;return g>2&&Xe(1,$+1).forEach(V=>j(V)),{structureId:F.structureId,matchUps:I,structureName:M,structures:T,links:w,...re};function j(V){let H=g/Math.pow(2,V);if(H<2)return;let z=g/Math.pow(2,V)+e;if(a&&z+1>a)return;let{structures:q,structureId:W,matchUps:Y,links:Z}=NI({finishingPositionOffset:z,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:s+1,drawSize:H,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(F.structureId&&W){let X={linkType:yd,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:Cl,structureId:W}};Z&&F&&Z.push(X),Z!=null&&Z.length&&w.push(...Z)}return q!=null&&q.length&&T.push(...q),Y!=null&&Y.length&&I.push(...Y),{structureId:W,childLinks:Z,structures:T}}}function ZG({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=Dt({drawDefinition:t,structureId:i});if(n.error)return le({result:n});let{matchUps:r}=Ei({structure:n.structure,matchUpsMap:e});return{...Za({matchUps:r}),matchUps:r,matchUpsMap:e}}function k7({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=ZG({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(Pne(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{aRe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function aRe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Xe(i,(n||i)+1).includes(t)}function Pne(t){var e,i;return[Vt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Vt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function oRe(t){return Pne(t).map(e=>Xe(e[0],e[1]&&e[1]+1||e[0]+1))}function k0({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:we,context:{structureIds:e}};if(!t)return{error:ot};e=e??(t.structures??[]).filter(a=>a.stage!==gt).map(({structureId:a})=>a);let n=e.map(a=>{var s;let{roundProfile:o}=ZG({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(oRe).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(sr).flat();return{positionsNotPlayedOff:Vt(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function Ene({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:ot};if(!n)return{error:Is};if(!e)return{error:ht,info:"missing playoffPositions"};let r=k0({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=k7({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>St(v)).filter(v=>!t.includes(v)),u=k7({finishingPositions:a,drawDefinition:i,structureId:n}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>St(v)):[],p=l.filter(v=>!d.includes(v)).sort(sr),{roundProfile:f}=ZG({drawDefinition:i,structureId:n}),h=p.map(v=>{let y=f==null?void 0:f[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Xe(b,(I||b)+1)}).flat().sort(sr),{playoffRoundsRanges:m}=sRe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function sRe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Xe(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function wD({drawDefinition:t,structureId:e}){if(!t)return{error:ot};let{matchUps:i,matchUpsMap:n}=za({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=k0({drawDefinition:t,matchUpsMap:n}),{structures:o}=wd({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==$r||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=lRe({playoffPositions:r,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function lRe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var f,h,m,g,v,y,b,I,T;let r=i==null?void 0:i.structureId,{links:a}=R0({drawDefinition:e,structureId:r});if(i.structureType===ro||i.structures){let w=(h=(f=Gi({structure:i}))==null?void 0:f.positionAssignments)==null?void 0:h.length,S=i.structures.length,U=(w??0)/S,P=((m=a.source)==null?void 0:m.flatMap(({source:F})=>(F==null?void 0:F.finishingPositions)||[]))||[],E=Xe(1,U+1).filter(F=>!P.includes(F)),D=((v=(g=n.find(F=>F.containerStructureId===r&&F.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],R=a==null?void 0:a.source.map(({target:F})=>F.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:M=[]}=k0({structureIds:R,drawDefinition:e}),A=[...N,...M],_=Xe(D[0],D[1]+1).filter(F=>!A.includes(F)),k=zr(_,_.length/E.length),B=E.map((F,x)=>{let $=k[x],j=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:F,finishingPositions:$,finishingPositionRange:j}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:B,finishingPositionsAvailable:E,finishingPositionsPlayedOff:P,positionsPlayedOff:N,groupCount:S,groupSize:U}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==bd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],s=((b=a==null?void 0:a.source)==null?void 0:b.filter(w=>w.linkCondition===bd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],l=Ene({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:r}),u=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,c=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let S=a==null?void 0:a.source.find(R=>R.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,P=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:R,structureId:N})=>N===P&&R===U),D=E.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(u&&D===E.length){u.push(w);let R=(T=(I=d==null?void 0:d[w])==null?void 0:I.finishingPositionRange)==null?void 0:T.loser;if(R){let N=Math.min(...R),M=N+D,A=Xe(N,M),_={finishingPositionRange:[N,M-1].join("-"),finishingPositions:A,roundNumber:w};c.push(_)}}}return u&&u.sort(sr),c.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:u,playoffRoundsRanges:c,error:p}}function uRe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,a;if(!e)return{error:ot};if(typeof i!="string"||!Array.isArray(t))return{error:we};let n=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(r=wD({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>n.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function Cne(t){var y,b;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:a,stage:o=it,matchUpType:s,structureId:l,idPrefix:u,drawSize:c,isMock:d,uuids:p}=t,f={finishingPositionOffset:e,matchUpType:s,drawSize:c,idPrefix:u,isMock:d,uuids:p},{matchUps:h}=r?ah(f):yc(f),m=Fs({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||ua(it),structureId:l||(p==null?void 0:p.pop()),stageSequence:n,matchUpType:s,matchUps:h,stage:o}),g=[m],v=[];if(c>2){let I=c/2,{matchUps:T}=yc({finishingPositionOffset:e+I,idPrefix:u&&`${u}-c`,drawSize:I,matchUpType:s,isMock:d}),w=ua(pa),S=((b=i==null?void 0:i["0-1"])==null?void 0:b.name)??t.consolationStructureName??(a?`${a} ${w}`:w),U=Fs({structureName:S,matchUps:T,structureId:p==null?void 0:p.pop(),stage:pa,stageSequence:1,matchUpType:s});g.push(U);let P={linkType:yd,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Cl,structureId:U.structureId}};v.push(P)}return{...re,structures:g,links:v}}function Rne({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Xe(1+e,n+1+e).map(u=>{let c=l&&l[u-1]?l[u-1]:u%2?Cl:Vm,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:yd,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=s[u-1];return f&&(p.target.groupedOrder=f),gs()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=bd,p.target.feedProfile=Cl),o.includes(d)?p:void 0}).filter(Boolean)}function Mne(t){var T,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:a,staggeredEntry:o,stage:s=it,matchUpType:l,structureId:u,drawSize:c,idPrefix:d,isMock:p,uuids:f}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:c,idPrefix:d,isMock:p,uuids:f},{matchUps:m,roundsCount:g}=o?ah(h):yc(h),v=t.structureName??((T=r==null?void 0:r["0"])==null?void 0:T.name)??ua(it),y=zf({structureId:u||(f==null?void 0:f.pop()),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:s}),b=[y],I=[];if(c>2){let S=[0,2].slice(0,c/16).map((U,P)=>{let E=P+1,{consolationStructure:D}=cRe({idPrefix:d&&`${d}-c${P}`,structureId:f==null?void 0:f.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:a,stageSequence:E,roundOffset:U,matchUpType:l,drawSize:c,isMock:p,index:P,uuids:f});b.push(D);let R=Rne({consolationStructure:D,roundsCount:2,mainStructure:y,roundOffset:U});return{consolationStructure:D,links:R}}).map(U=>U.links).flat();if(I.push(...S),c>=4&&c<=16||c>32){let{matchUps:U}=yc({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),P=((w=r==null?void 0:r["3-4"])==null?void 0:w.name)??ua(Nn),E=(a==null?void 0:a[P])||P,D=e?`${e} ${E}`:E,R=zf({structureId:f==null?void 0:f.pop(),matchUps:U,stageSequence:2,stage:Nn,structureName:D,matchUpType:l}),N={linkType:yd,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:R.structureId,feedProfile:Cl,roundNumber:1}};b.push(R),I.push(N)}}return{structures:b,links:I,...re}}function cRe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var y,b;let p=l/(2*Math.pow(2,r)),{matchUps:f,roundsCount:h}=ah({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),m=c===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||c===1&&((b=i==null?void 0:i["0-3"])==null?void 0:b.name)||`${ua(pa)} ${c+1}`,g=(n==null?void 0:n[m])||m,v=t?`${t} ${g}`:g;return{consolationStructure:zf({matchUps:f,stage:pa,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:h}}function ov(t){var E,D,R,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:a,structureName:o,stage:s=it,structureId:l,matchUpType:u,skipRounds:c,feedRounds:d,idPrefix:p,drawSize:f,isMock:h,uuids:m,fmlc:g}=t,v=t.feedPolicy||((E=t.policyDefinitions)==null?void 0:E[XI])||((D=t.appliedPolicies)==null?void 0:D[XI]),y={finishingPositionOffset:e,matchUpType:u,skipRounds:c,drawSize:f,idPrefix:p,isMock:h,uuids:m},{matchUps:b}=a?ah(y):yc(y),I=Fs({structureName:o||((R=n==null?void 0:n["0"])==null?void 0:R.name)||ua(it),structureId:l||(m==null?void 0:m.pop()),stageSequence:i,matchUpType:u,matchUps:b,stage:s}),T=[I],w=[],S=f/2,{matchUps:U,roundsCount:P}=ah({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:S,matchUpType:u,feedRounds:d,skipRounds:c,isMock:h,uuids:m,fmlc:g});if(f>2){let M=((N=n==null?void 0:n["0-1"])==null?void 0:N.name)??ua(pa),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${M}`:M,_=Fs({matchUps:U,structureId:m==null?void 0:m.pop(),stage:pa,stageSequence:1,structureName:A,matchUpType:u});T.push(_);let k=Rne({consolationStructure:_,mainStructure:I,roundsCount:P,feedPolicy:v,fmlc:g});w.push(...k)}return{...re,structures:T,links:w}}function Nne({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){var T,w,S,U,P,E;u=u||(r==null?void 0:r[XI]);let h="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=uRe({structureId:n,drawDefinition:o,playoffGroups:s});if(b)return le({result:{error:b},stack:h});if(!(!I||s!=null&&s.every(D=>{let{finishingPositions:R=[]}=D;if(!R.length)return!1;let N=[...R].sort(sr).map((M,A)=>(R[A+1]||M)-M).every(M=>M<2);return(!t||N)&&R.every(M=>I[M])})))return le({context:{validFinishingPositions:Object.values(I)},result:{error:we},stack:h});for(let D of s){let R=D.finishingPositions,N=I&&R.map($=>{var j;return(j=I[$])==null?void 0:j.finishingPositions}).flat(),M=c*R.length,A=m0(M),_=A===2&&ac||D.drawType||ac;N&&(m=Math.min(...N)-1);let k=N&&`${Math.min(...N)}-${Math.max(...N)}`,B=D.structureName||k&&((w=(T=D.playoffAttributes)==null?void 0:T[k])==null?void 0:w.name)||((U=(S=D.playoffAttributes)==null?void 0:S["0"])==null?void 0:U.name),F={addNameBaseToAttributeName:D.addNameBaseToAttributeName,playoffStructureNameBase:D.playoffStructureNameBase,finishingPositionNaming:D.finishingPositionNaming,finishingPositionLimit:D.finishingPositionLimit,structureId:D.structureId??(f==null?void 0:f.pop()),playoffAttributes:D.playoffAttributes,structureNameMap:D.structureNameMap,sequenceLimit:D.sequenceLimit,structureName:B,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:Nn,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:f},x=({playoffStructures:$,playoffLinks:j})=>{let[V]=$,H=nC({playoffStructureId:V.structureId,finishingPositions:R,sourceStructureId:n});y.push(H),y.push(...j),v.push(...$),g.push({structureId:V.structureId,finishingPositions:R}),m+=M};if(_===ac){let{matchUps:$}=yc({finishingPositionLimit:m+M,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:A,isMock:p,uuids:f}),j=Fs({structureId:D.structureId??(f==null?void 0:f.pop()),matchUpFormat:e,stage:Nn,structureName:B,stageSequence:a,matchUps:$});v.push(j);let V=nC({playoffStructureId:j.structureId,finishingPositions:R,sourceStructureId:n});y.push(V),m+=M,g.push({structureId:j.structureId,finishingPositions:R})}else if([QI,ew,Nn].includes(_)){let $={playoffAttributes:D.playoffAttributes??i,playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(f==null?void 0:f.pop()),structureName:D.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Nn,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:f};_===QI?Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??Kj,roundOffsetLimit:3}):_===ew&&Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??Yj,roundOffsetLimit:2});let j=NI($);if(j.error)return j;if((P=j.links)!=null&&P.length&&y.push(...j.links),(E=j.structures)!=null&&E.length&&v.push(...j.structures),v.sort(Gy),j.structureId){let V=nC({playoffStructureId:j.structureId,finishingPositions:R,sourceStructureId:n});y.push(V),g.push({structureId:j.structureId,finishingPositions:R})}m+=M}else if([tw,q1,mU,hU,fU,gU].includes(_)){let $=[f==null?void 0:f.pop(),f==null?void 0:f.pop()],j={playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(f==null?void 0:f.pop()),playoffAttributes:D.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:$,stage:Nn,structureName:B,matchUpType:l,feedPolicy:u,drawSize:A,isMock:p},V={[tw]:{fmlc:!0,feedRounds:1},[gU]:{feedRounds:1},[mU]:{feedsFromFinal:3},[hU]:{feedsFromFinal:2},[fU]:{feedsFromFinal:1}};Object.assign(j,V[_]||{});let{structures:H,links:z}=ov(j),[q]=H,W=nC({playoffStructureId:q.structureId,finishingPositions:R,sourceStructureId:n});y.push(W),y.push(...z),v.push(...H),g.push({structureId:q.structureId,finishingPositions:R}),m+=M}else if([jl].includes(_)){let{structures:$,links:j}=mD({...F,structureOptions:D.structureOptions||{groupSize:4}});x({playoffStructures:$,playoffLinks:j})}else if([z1].includes(_)){let{structures:$,links:j}=Cne(F);x({playoffStructures:$,playoffLinks:j})}else if([RPe].includes(_)){let{structures:$,links:j}=Mne(F);x({playoffStructures:$,playoffLinks:j})}else if([el].includes(_)){let $=Fs({structureId:D.structureId??(f==null?void 0:f.pop()),structureName:D.structureName,finishingPosition:rR,stage:Nn,stageSequence:a,matchUps:[]});x({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function nC({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:wp,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Pl,roundNumber:1}}}function SD({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>TD({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function TD({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??Mi();let f=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${f}-TMU-${p+1}`};return Xe(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Fn,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:s,isMock:r}})}function dRe(t){var U,P,E;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return le({result:{error:ht},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:u}=t,{structures:c=[],links:d=[],finishingPositionTargets:p,positionRangeMap:f,error:h}=Nne({requireSequential:n,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(h)return{error:h};let m=p==null?void 0:p.map(({finishingPositions:D})=>D).flat().map(D=>f[D].finishingPositions).flat();a.structures.push(...c),a.links.push(...d);let{matchUps:g,matchUpsMap:v}=pr({inContext:!0,drawDefinition:a}),y=c.map(({structureId:D})=>D),b=g==null?void 0:g.filter(({structureId:D})=>y.includes(D)).map(Nr),I=(U=v==null?void 0:v.drawMatchUps)==null?void 0:U.filter(({matchUpId:D})=>b==null?void 0:b.includes(D));if(I!=null&&I.length){let D=(P=Aa({drawDefinition:a,event:u}))==null?void 0:P.tieFormat;D&&I.forEach(R=>{let{tieMatchUps:N}=SD({isMock:t.isMock,tieFormat:D,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:gc})})}let{positionAssignments:T}=Gi({structureId:i,drawDefinition:a}),w={};T==null||T.forEach(D=>{var N,M,A;let R=(A=(M=(N=$t({element:D,name:eh}))==null?void 0:N.extension)==null?void 0:M.value)==null?void 0:A.groupOrder;R&&(w[R]||(w[R]=[]),w[R].push(D.participantId))});let S=bD({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:a});return S.error&&((E=S.error)==null?void 0:E.code)!==OV.code?le({result:S,stack:e}):{structures:c,links:d,positionsPlayedOff:m,drawDefinition:a,...re}}function SI({value:t,sourceRange:e,targetRange:i}){let n=Math.min(...e),r=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-n)*(o-a)/(r-n)+a}var El="ELO",Ane="NTRP",pRe="TRN",_ne="UTR",XG="WTN",kne={ELO:El,NTRP:Ane,TRN:pRe,UTR:_ne,WTN:XG},fRe={[El]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Ane]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[_ne]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[XG]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Cr=fRe;function hRe({sourceRatingType:t,sourceRating:e}){let i=Cr[t].range,n=i[0]>i[1],r=Cr[El].range;return SI({value:n?i[0]-e:e,sourceRange:i,targetRange:r})}function mRe({targetRatingType:t,sourceRating:e}){let i=Cr[t].decimalsCount||0,n=Cr[t].range,r=n[0]>n[1],a=Math.max(...n),o=Cr[El].range,s=SI({targetRange:n,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return r?a-l:l}function O7(t){var d;let e=Lt(t,[{ratings:!0,[ul]:us}]);if(e.error)return e;let i=t.matchUpType&&[sn,Wi].includes(t.matchUpType)?t.matchUpType:sn,n=Object.keys(Cr),r=t.targetRatingType&&n.includes(t.targetRatingType)?t.targetRatingType:El,a=t.ratings[i]?t.ratings[i].reduce((p,f)=>p.includes(f.scaleName)?p:p.concat(f.scaleName),[]):[];if(!a)return{error:Hr};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===r))??t.ratings[i][0];if(a[0]===r)return o;let s=o.scaleName,l=Cr[o.scaleName].accessor,u=l?o.scaleValue[l]:o.scaleValue,c=hRe({sourceRatingType:s,sourceRating:u});return{convertedRating:mRe({targetRatingType:r,sourceRating:c}),sourceRating:u}}function gRe({participantResults:t,sides:e,score:i}){var s,l;let n=e.find(({sideNumber:u})=>u===1),r=e.find(({sideNumber:u})=>u===2),a=(s=n==null?void 0:n.participant)==null?void 0:s.ratings,o=(l=r==null?void 0:r.participant)==null?void 0:l.ratings;if(a!=null&&a[sn]&&(o!=null&&o[sn])){let u=El,{convertedRating:c}=O7({ratings:a,targetRatingType:u}),{convertedRating:d}=O7({ratings:o,targetRatingType:u}),{side1pressure:p,side2pressure:f}=vRe({side1ConvertedRating:c,side2ConvertedRating:d,score:i});p&&t[n==null?void 0:n.participantId].pressureScores.push(p),f&&t[r==null?void 0:r.participantId].pressureScores.push(f);let h=Math.max(...Cr[El].range),m=rM((d-c)/h),g=rM((c-d)/h);t[n==null?void 0:n.participantId].ratingVariation.push(m),t[r==null?void 0:r.participantId].ratingVariation.push(g)}}function vRe({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var y,b;let n=t>e?t:e,r=t>e?e:t,a=Math.abs(t-e),o=Cr[El].range,s=Math.max(...o),l=(s-n)*0,u=(n+l)/s*a,c=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((I,T)=>I+((T==null?void 0:T.side1Score)??0),0),d=(b=i==null?void 0:i.sets)==null?void 0:b.reduce((I,T)=>I+(T.side2Score??0),0),p=t>e?2:1,f=(c||0)*(r+(p===1?u:0)),h=(d||0)*(r+(p===2?u:0)),m=f+h,g=m?rM(f/m):0,v=m?rM(h/m):0;return{side1pressure:g,side2pressure:v}}var kl="SET3-S:6/TB7",yRe="SET3-S:6NOAD",One="SET3-S:6/TB7-F:TB10",bRe="SET3-S:4/TB7",IRe="SET3-S:4/TB5@3",wRe="SET1-S:T20",SRe="SET1-S:8/TB7",TRe="SET1-S:8/TB7@7",URe={FORMAT_STANDARD:kl,FORMAT_STANDARD_NOAD:yRe,FORMAT_ATP_DOUBLES:One,FORMAT_SHORT_SETS:bRe,FORMAT_FAST4:IRe,FORMAT_PRO_SET:SRe,FORMAT_COLLEGE_PRO_SET:TRe,TIMED20:wRe};function JG({winningSide:t,matchUpFormat:e=kl,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=yo(e),u=QG((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===ai&&(n!=null&&n.setsCreditForDefaults)||i===yi&&(n!=null&&n.setsCreditForWalkovers)))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===ta&&(+a[1-s]===u&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=u)),a}function xne({matchUpFormat:t=kl,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var p,f;let{sets:a}=r||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=yo(t),l=(s==null?void 0:s.bestOf)??1,u=QG(l),c=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===ai&&(n!=null&&n.gamesCreditForDefaults)||i===yi&&(n!=null&&n.gamesCreditForWalkovers))){let h=((f=s==null?void 0:s.setFormat)==null?void 0:f.setTo)||0,m=u*h;d[o].push(m)}else a.forEach((h,m)=>{var T;let g=(h.setNumber||m+1)>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(T=s==null?void 0:s[g])==null?void 0:T.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:b,side2Score:I}=h;x7(v)&&(d[0].push(St(b||0)),d[1].push(St(I||0))),y&&h.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&d[h.winningSide-1].push(1)});if(i===ta&&typeof o=="number"){let h=a.length>u&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",m=s==null?void 0:s[h];if(x7(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!s||b===""))return+b===c-1||+b===c?St(c||0)+1:+b<c?g:c},y=JG({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(b=>b[o]<=b[1-o]).reduce((b,I)=>b+(I?1:0),0)>y[1-o]){let b=d[o].length,I=v(d[1-o][b-1]);I&&(d[o][b-1]=I)}u>d[o].length&&(n!=null&&n.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((h,m)=>h+m,0),d[1].reduce((h,m)=>h+m,0)]}function Lne({matchUpFormat:t,score:e}){var s;let i=t?yo(t):void 0,n=(i==null?void 0:i.bestOf)??1,r=QG(n),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,u)=>{var p;let c=(l.setNumber||u+1)>r&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[c])==null?void 0:p.based;if(Fne(d)){let{side1Score:f,side2Score:h}=l;f&&(o[0]+=St(f||0)),h&&(o[1]+=St(h||0))}else l.side1TiebreakScore&&(o[0]+=St(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=St(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function QG(t){return t&&Math.ceil(t/2)||1}function Fne(t){return t==="P"}function x7(t){return!Fne(t)}function DRe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var u;let a=e&&yo(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(u=a.setFormat)==null?void 0:u.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,f=i!=null&&i.groupTotalSetsPlayed?r:n*(s||0)||d+p,h=Math.round(d/f*1e3)/1e3;(h===1/0||isNaN(h))&&(h=f);let m=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[c].matchUpsWon,I=t[c].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[c].gamesWon||0,U=t[c].gamesLost||0,P=(n||0)*(s||0)*(l||0),E=Math.max(P,S+U),D=Math.round(S/E*1e3)/1e3;(D===1/0||isNaN(D))&&(D=0);let R=Math.round(t[c].pointsWon/t[c].pointsLost*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=m,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=S,t[c].gamesLost=U,t[c].gamesPct=D,t[c].pointsPct=R,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function UD({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var c,d,p,f,h,m,g;let o={},s=(n==null?void 0:n.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Ln(t,[TI(v,0),TI(v,1)]).length===2)),u=(c=l==null?void 0:l.flatMap(({score:v,tieMatchUps:y})=>{var b;return y?y.filter(({matchUpStatus:I})=>!s.includes(I)).flatMap(({score:I})=>{var T;return((T=I==null?void 0:I.sets)==null?void 0:T.length)??0}):((b=v==null?void 0:v.sets)==null?void 0:b.length)??0}))==null?void 0:c.reduce((v,y)=>v+y,0);for(let v of l??[]){let{matchUpStatus:y,tieMatchUps:b,tieFormat:I,score:T,winningSide:w,sides:S}=v,U=I&&v._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:N})=>N),P=w&&PRe(v),E=w&&ERe(v);if(!P&&!E)if(y&&dr.includes(y)){let N=TI(v,0),M=TI(v,1);N&&(Nf(o,N),o[N].matchUpsCancelled+=1),M&&(Nf(o,M),o[M].matchUpsCancelled+=1)}else if(b!=null&&b.length){r=0;for(let N of b){if(N.winningSide){let M=(d=S==null?void 0:S.find(({sideNumber:_})=>_===N.winningSide))==null?void 0:d.participantId,A=(p=S==null?void 0:S.find(({sideNumber:_})=>_===N.winningSide))==null?void 0:p.participantId;M&&A&&(Nf(o,M),Nf(o,A),o[M].tieMatchUpsWon+=1,o[A].tieMatchUpsLost+=1,On(sn)(N.matchUpType)?(o[M].tieSinglesWon+=1,o[A].tieSinglesLost+=1):On(Wi)(N.matchUpType)&&(o[M].tieDoublesWon+=1,o[A].tieDoublesLost+=1))}L7({score:N.score,manualGamesOverride:U,participantResults:o,sides:S})}}else L7({manualGamesOverride:U,participantResults:o,score:T,sides:S});else if(Nf(o,P),Nf(o,E),b==null?void 0:b.length){r=0;for(let N of b){let{matchUpType:M}=N,A=On(Wi)(M),_=On(sn)(M);N.winningSide&&(N.winningSide===w?(P&&(o[P].tieMatchUpsWon+=1,_&&(o[P].tieSinglesWon+=1),A&&(o[P].tieDoublesWon+=1)),E&&(o[E].tieMatchUpsLost+=1,_&&(o[E].tieSinglesLost+=1),A&&(o[E].tieDoublesLost+=1))):N.winningSide!==w&&(E&&(o[E].tieMatchUpsWon+=1,_&&(o[E].tieSinglesWon+=1),A&&(o[E].tieDoublesWon+=1)),P&&(o[P].tieMatchUpsLost+=1,_&&(o[P].tieSinglesLost+=1),A&&(o[P].tieDoublesLost+=1)))),F7({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:P,losingParticipantId:E,manualGamesOverride:U,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:n,winningSide:w})}Bne({winningParticipantId:P,losingParticipantId:E,participantResults:o,matchUpStatus:y})}else F7({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:P,manualGamesOverride:U,losingParticipantId:E,participantResults:o,pressureRating:e,matchUpStatus:y,tallyPolicy:n,winningSide:w,score:T,sides:S});let D=(f=T==null?void 0:T.sets)==null?void 0:f.reduce((N,M)=>N+((M==null?void 0:M.side1Score)??0),0),R=(h=T==null?void 0:T.sets)==null?void 0:h.reduce((N,M)=>N+(M.side2Score??0),0);if(U){let N=(m=S==null?void 0:S.find(({sideNumber:A})=>A===1))==null?void 0:m.participantId,M=(g=S==null?void 0:S.find(({sideNumber:A})=>A===2))==null?void 0:g.participantId;Nf(o,N),Nf(o,M),N&&(o[N].gamesWon+=D,o[N].gamesLost+=R),M&&(o[M].gamesWon+=R,o[M].gamesLost+=D)}}return DRe({participantResults:o,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:u}),{participantResults:o}}function PRe(t){let e=t.winningSide-1;return TI(t,e)}function ERe(t){let e=1-(t.winningSide-1);return TI(t,e)}function TI(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Nf(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function L7({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(St(c||0)),a[1].push(St(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];n.forEach((l,u)=>{let{participantId:c}=l;c&&(Nf(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function F7({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:c,score:d,sides:p}){let f=c&&c-1,h=1-f;r&&l===sn&&gRe({participantResults:n,sides:p,score:d}),s||Bne({winningParticipantId:t,losingParticipantId:i,participantResults:n,matchUpStatus:o});let m=JG({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),g=xne({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:c,score:d}),{pointsTally:v}=Lne({score:d,matchUpFormat:a});t&&(n[t].setsWon+=m[f],n[t].setsLost+=m[h],e||(n[t].gamesWon+=g[f],n[t].gamesLost+=g[h]),n[t].pointsWon+=v[f],n[t].pointsLost+=v[h]),i&&(n[i].setsWon+=m[h],n[i].setsLost+=m[f],e||(n[i].gamesWon+=g[h],n[i].gamesLost+=g[f]),n[i].pointsWon+=v[h],n[i].pointsLost+=v[f])}function Bne({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===yi&&(i[e].walkovers+=1),n===ai&&(i[e].defaults+=1),n===ta&&(i[e].retirements+=1),[ai,ta,yi].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function CRe({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;r.push(c);let d=`Excluded: ${u}`;r.push(d)}else{let u=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(u).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",f=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${f}${p} by ${a.attribute}`;if(r.push(h),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function $ne({participantResults:t,participantIds:e,attribute:i}){return Vne({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function Vne(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var RRe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],PL={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function B7(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!MRe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=$ne({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(h=>parseFloat(h)).sort((h,m)=>m-h).map(h=>s[h]).map(h=>{let m=jne({participantIds:h,...t});return a.push(...m.report??[]),m.order}).flat(1/0),u=1,c;l.forEach((h,m)=>{m&&(h.resolved||c&&!h.resolved)&&(u+=1),c=h.resolved,h.resolved?(h.position=m+1,u=h.position):h.position=u});let d=l.map(({position:h})=>h),p=qo(d);return l.forEach(h=>{let{participantId:m,position:g}=h||{},v=i[m];h.GEMscore=f(v);let y=p[g];(h==null?void 0:h.position)!==void 0&&(y>1&&(h.ties=y,n&&(h.subOrder=n[m])),h.rankOrder=g,h.groupOrder=g+(h.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(h){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(PL).filter(m=>r.GEMscore.includes(m)):Object.keys(PL)).map(m=>(h[m]||0)*Math.pow(10,PL[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function MRe({participantResults:t,participantsCount:e}){let i=Vne({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function NRe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=UD({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=$ne({participantResults:l,participantIds:e,attribute:r}),c=[{attribute:r,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,f)=>s?p-f:f-p).map(p=>u[p]).map(p=>{let f=jne({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return c.push(...f.report??[]),f.order}).flat(1/0)),{order:d,report:c}}function jne({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let c=ARe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[c],headToHeadWinner:d,report:s}}}let u=((r==null?void 0:r.tallyDirectives)||RRe).filter(c=>{let d=!(Dn(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:f})=>(l=NRe({disableHeadToHead:f,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function ARe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function O0({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:o}){if(!(r!=null&&r.length)||!cl(r))return{error:Hp};let s=Vt(r.map(({structureId:I})=>I));if(s.length!==1)return le({result:{error:we,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=r.filter(I=>I&&I.matchUpStatus!==Ui),u=l.length&&Vt(l.map(({drawPositions:I})=>I).flat()).length,c=l.filter(I=>Rm({matchUp:I})).length===l.length;c||(o=0);let d=r.every(({matchUpType:I,tieMatchUps:T})=>I===Zi&&(T==null?void 0:T.every(w=>Rm({matchUp:w})))),p=t==null?void 0:t[Mj],f=r.filter(I=>Rm({matchUp:I})||I.matchUpType===Zi),{participantResults:h}=UD({matchUps:f,pressureRating:i,matchUpFormat:n,tallyPolicy:p,perPlayer:o}),m,g,{groupOrder:v,report:y}=B7({matchUps:f,participantResults:h,participantsCount:u,matchUpFormat:n,tallyPolicy:p,subOrderMap:a});if(i&&_Re({participantResults:h}),c&&v)m=y,g=v,v.forEach(I=>{let{participantId:T,groupOrder:w,rankOrder:S,subOrder:U,ties:P,GEMscore:E}=I,D=h[T];Object.assign(D,{groupOrder:w,rankOrder:S,GEMscore:E,subOrder:U,ties:P})});else{let{groupOrder:I,report:T}=B7({requireCompletion:!1,participantResults:h,participantsCount:u,matchUpFormat:n,tallyPolicy:p,subOrderMap:a,matchUps:r});m=T,g=I,I&&I.forEach(w=>{let{participantId:S,groupOrder:U,GEMscore:P}=w,E=h[S];Object.assign(E,{provisionalOrder:U,GEMscore:P})})}let b={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:m};if((c||d)&&(b.order=g),e||gs({tally:!0})){let I=CRe({matchUps:r,report:m,order:g});gs({tally:!0})&&console.log(I),b.readableReport=I}return b}function _Re({participantResults:t}){let e=r=>r.reduce((a,o)=>a+parseFloat(o),0),i=r=>parseFloat((e(r)/r.length).toFixed(2)),n=Object.keys(t).map(r=>{let a=t[r],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:r,averagePressure:s}}).sort((r,a)=>(a.averagePressure||0)-(r.averagePressure||0)).map((r,a)=>({...r,order:a+1}));for(let r of n)t[r.participantId].pressureOrder=r.order}function Gne({positionAssignments:t}){let e=(t||[]).filter(Yo(hd)).map(r=>{let{extension:a}=$t({element:r,name:JI}),o=St(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=qo(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function eH({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!cl(r))return{error:we};if(!t)return{error:we};let{policyDefinitions:o}=Kp({policyTypes:[Mj],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=Gne({positionAssignments:t}),l=r.length?O0({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:u[h],name:eh};fi({element:f,extension:m}),u[h].ties||Ha({element:f,name:JI})}else Ha({element:f,name:eh}),Ha({element:f,name:JI})}),Ji({drawDefinition:i}),{...re,participantResults:u,bracketComplete:c,report:d}}function Hne({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function rn({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:u}){if(!r)return{error:ot};if(!o)return{error:Ca};if(typeof o!="string")return{error:we};let{structures:c=[]}=wd({drawDefinition:r});n&&!i&&(i=Yp({contextProfile:n,drawDefinition:r}));for(let d of c){let{matchUps:p}=Ei({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:d,context:l,event:u}),{matchUp:f}=Hne({matchUps:p,matchUpId:o});if(f)return{matchUp:f,structure:d}}return{error:Ta}}function S_(t){var e;return!Ii(t)||!t.notes?{error:ht}:Ii(t.element)?!zn(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:we}:(Object.assign(t.element,{notes:t.notes}),{...re}):{error:we}}function tH(t){return Ii(t)?Ii(t.element)?(t.element.notes&&delete t.element.notes,{...re}):{error:we}:{error:ht}}var T_={matchUpStatus:Fn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function oc(t){var U,P,E,D,R,N,M,A;let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:a,removeWinningSide:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,removeScore:c,winningSide:d,matchUpId:p,event:f,notes:h,score:m}=t,g=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=mi({policyTypes:[Js],tournamentRecord:s,drawDefinition:l,structure:r,event:f}))==null?void 0:U.appliedPolicies,v=n.matchUpType===Zi;if(v&&l){if(p&&n.matchUpId!==p){let _=rn({drawDefinition:l,matchUpId:p,event:f});if(!_.matchUp)return{error:Ta};({matchUp:n,structure:r}=_)}}else n.matchUpId!==p&&console.log("!!!!!");u&&[yi,ir].includes(u)||c?Object.assign(n,{...T_}):m&&(n.score=m);let y=u&&(n==null?void 0:n.matchUpStatus)===ai&&u!==ai;u&&(n.matchUpStatus=u),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),d&&(n.winningSide=d),o&&(n.winningSide=void 0),!r&&l&&({structure:r}=rn({drawDefinition:l,matchUpId:p,event:f})),u&&!n.winningSide&&Kr(n)&&!dr.includes(u)&&![Vy,Mh].includes(u)&&(n.matchUpStatus=Zl);let b;if((y&&((P=n==null?void 0:n.processCodes)!=null&&P.length)||u===ai)&&(b=(D=(E=g==null?void 0:g[Js])==null?void 0:E.processCodes)==null?void 0:D.incompleteAssignmentsOnDefault),!n.collectionId){let _=(r==null?void 0:r.structureType)===ro,k=Ko({structure:r});if(UG({drawDefinition:l,structure:r})||k||_){let B=$=>{i=v?"SET1-S:T100":i??n.matchUpFormat??($==null?void 0:$.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(f==null?void 0:f.matchUpFormat);let j=v?{matchUpTypes:[Zi]}:void 0,{matchUps:V}=Ei({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:j,drawDefinition:l,structure:$,event:f});return k&&($.positionAssignments=Vt(V.flatMap(H=>(H.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(H=>({participantId:H}))),eH({positionAssignments:$.positionAssignments,tournamentRecord:s,drawDefinition:l,matchUpFormat:i,matchUps:V,event:f})},F=_&&r.structures.find($=>$==null?void 0:$.matchUps.find(j=>j.matchUpId===p)),x=B(F||r);if(x.error)return le({result:x,stack:e})}}if(h){let _=S_({element:n,notes:h});if(_.error)return le({result:_,stack:e})}let I=s==null?void 0:s.tournamentId,T=sl().topics.includes(n_),w=(T||b)&&ga({drawDefinition:l}),S=w&&((R=pr({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:l,matchUpsMap:w}).matchUps)==null?void 0:R[0]);if(T&&S&&_Pe({tournamentId:I,inContextMatchUp:S}),Array.isArray(b)&&S&&!((N=S.sides)!=null&&N.every(({participantId:_})=>_)))if(u===ai)n.processCodes=Vt([...n.processCodes??[],...b]);else for(let _ of b||[]){let k=_&&((M=n==null?void 0:n.processCodes)==null?void 0:M.lastIndexOf(_));(A=n==null?void 0:n.processCodes)==null||A.splice(k,1)}return ci({eventId:f==null?void 0:f.eventId,context:e,drawDefinition:l,tournamentId:I,matchUp:n}),{...re}}function iH(t){var p,f,h;let{matchUpStatusCodes:e,matchUpStatus:i,structure:n,matchUp:r,dualMatchUp:a,inContextMatchUp:o}=t,s=cD({matchUpStatus:i})||[Nc,Ro].includes(i)&&a,l="attemptToModifyScore";if(!(Ko({structure:n})&&((p=r==null?void 0:r.sides)!=null&&p.every(m=>m.participantId))||kRe({structure:n,matchUp:r,inContextMatchUp:o})||((h=(f=t.appliedPolicies)==null?void 0:f[Js])==null?void 0:h.requireParticipantsForScoring)===!1))return le({result:{error:jV},stack:l});let u=[yi].includes(i),c=s?i:t.winningSide&&kn||Qs,d=oc({...t,matchUpStatusCodes:s&&e||[],matchUpStatus:c,context:l,removeScore:u});return le({result:d,stack:l})}function kRe({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:n}=e,{positionAssignments:r}=_r({structure:t}),a=r==null?void 0:r.filter(l=>(n==null?void 0:n.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function zne({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>Nt(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>St(n));return{groupValueGroups:e,groupValueNumbers:i}}function ORe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>dr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),Nt(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):Nt(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(o[T.winningSide-1]+=m)})}):Nt(h)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:P=0}=T;(y.matchUpStatus===kn||y.winningSide||T.winningSide)&&(U||P?(o[0]+=U,o[1]+=P):(w||S)&&T.winningSide&&(o[T.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=xRe({collectionDefinition:t,collectionPosition:b});Nt(I)&&(o[y.winningSide-1]+=I)}}),Nt(d)){let y;if(f!=null&&f.aggregateValue)l&&(Nt(p||m||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(f!=null&&f.valueGoal)y=o.reduce((b,I,T)=>I>=f.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,b)=>n[b]+=y||0)}function xRe({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function qne({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Vt(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...re}}var LRe="MIXED events can not contain mixed singles or { gender: ANY } collections",FRe="events with { gender: ANY } can not contain MIXED singles collections";function U_(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[zi,pn].includes(i)&&i!==r?le({result:{valid:!1,error:tR},context:{gender:r},stack:e}):i===Po&&(r===Lu||r===Po&&n!==Wi)?le({result:{error:tR,valid:!1},info:LRe,stack:e}):i===Lu&&r===Po&&n!==Wi?le({result:{error:tR,valid:!1},info:FRe,stack:e}):{valid:!0}}function D_(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return BRe(t,e)}function SU(t){return!isNaN(Number(t))&&Number(t)}function Wne(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function BRe(t,e){var c;let i=SU(t.bestOf)||void 0,n=SU(t.exactly)||void 0,r=i||n;if((c=t.setFormat)!=null&&c.timed&&t.simplified&&r===1)return Wne(t.setFormat);let a=r&&`${lR}${r}`||"",o=$7(t.setFormat,e),s=o&&`S:${o}`||"",l=$7(t.finalSetFormat,e),u=r&&r>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,u].filter(d=>d).join("-")}function $7(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Wne(t);if(t.tiebreakSet)return V7(t.tiebreakSet);let i=SU(t.setTo);if(i){let n=t.NoAD&&PG||"",r=V7(t.tiebreakFormat),a=r&&`/${r}`||"",o=SU(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function V7(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&SU(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?PG:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Zo({matchUpFormat:t}){if(!zn(t)||t==="")return!1;let e=yo(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return D_(e,!!(i&&r&&n===a||o&&l&&s===u))===t}var $Re=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),VRe=t=>t.filter(Boolean).every(Dn);function DD(t){let e=t.category;if(typeof e!="object")return{error:nM};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!$Re([i,n,r,s],"string")||!VRe([a,o]))return{error:nM};let u=t.consideredDate??Ft(new Date().toLocaleDateString("sv"));if(!Go(u))return{error:Ka};let[c]=u.split("-").slice(0,3).map(F=>parseInt(F)),d=aT(u,-1),[p,f]=d.split("-").slice(1,3).map(F=>parseInt(F)),h=`${Ls(p)}-${Ls(f)}`,m=aT(u,1),[g,v]=m.split("-").slice(1,3).map(F=>parseInt(F)),y=`${Ls(g)}-${Ls(v)}`,b=o&&aT(u,-1*365*o),I=a&&aT(u,-1*365*a),T=[],w=F=>!T.includes(F)&&T.push(F);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),E=P&&(i==null?void 0:i.match(U)),D=i==null?void 0:i.match(S),R=(F,x)=>`${F}-${x}`,N=F=>{let x=c-F,$=R(x,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=F-1)},M=F=>{let x=c-F-1,$=R(x,y);e.ageMin&&e.ageMin>F&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>F&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=F)},A=F=>{let x=c-F,$=R(x,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F+1&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=F+1)},_=F=>{let x=c-F-1,$=R(x,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=F)},k=F=>{let[x,$,j]=(F.match(S)||[]).slice(1),V=parseInt($);x==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(V)):x==="O"&&A(V),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(V)):j==="O"&&_(V),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;n=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;r=R($,y)}let[F,x]=((i==null?void 0:i.match(U))??[]).slice(1).map($=>parseInt($));F<=x?(o=F,a=x,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(k):D?k(i):(o&&A(o),a&&M(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let B=pt({consideredDate:u,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return T.length&&(B.errors=T),B}function UM({category:t}){if(!Ii(t))return{error:we};let e=DD({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Dn(i)?le({result:{error:we},context:{ratingMax:i}}):n&&!Dn(n)?le({result:{error:we},context:{ratingMin:n}}):{...e}}function P_({childCategory:t,withDetails:e,category:i}){let n=UM({category:i}),r=UM({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=pt({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function PD({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),le({result:{errors:l,error:zp},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!h_([sn,Wi],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([m,d,v,y].map(Nt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let T=qne({collectionValueProfiles:u,matchUpCount:f});T.errors&&l.push(...T.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Zo({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),n){let T=U_({referenceGender:a,matchUpType:g,gender:I});if(T.error)return le({context:{referenceGender:a,gender:I},result:T,stack:s})}if(t&&r&&b){let T=P_({category:r,childCategory:b});if(!T.valid)return le({result:{error:nM},context:T,stack:s})}return l.length?le({result:{errors:l,error:Oee},stack:s}):{valid:!0}}function Mo(t){var m,g,v,y;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),n=t==null?void 0:t.checkCollectionIds,r=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[];if(!t||!r||typeof r!="object")return s.push("tieFormat must be an object"),le({result:{error:Xd},context:{tieFormat:r,errors:s},stack:o});if(typeof r.winCriteria!="object")return s.push("tieFormat.winCriteria must be an object"),le({result:{error:Xd},context:{tieFormat:r,errors:s},stack:o});if(!Array.isArray(r.collectionDefinitions))return s.push(Td("tieFormat.collectionDefinitions")),le({result:{error:Xd},context:{tieFormat:r,errors:s},stack:o});let l,u=r.collectionDefinitions.every(b=>{let{setValue:I,scoreValue:T,collectionValue:w}=b;(I||T)&&!w&&(l=!0);let{valid:S,errors:U}=PD({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:n,checkCategory:e,checkGender:i,event:a});return S?!0:(Array.isArray(U)&&s.push(...U),!1)}),c=typeof((m=r.winCriteria)==null?void 0:m.valueGoal)=="number"&&((g=r.winCriteria)==null?void 0:g.valueGoal)>0&&!l||((v=r.winCriteria)==null?void 0:v.aggregateValue);if(!(c||(y=r.winCriteria)!=null&&y.aggregateValue))return l?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),le({context:{tieFormat:r,errors:s,aggregateValueImperative:l},result:{error:Xd},stack:o});let d=r.collectionDefinitions.map(({collectionId:b})=>b),p=!n||d.length===Vt(d).length,f=u&&c&&p;return f?{valid:f,errors:s}:le({result:{error:Xd},context:{tieFormat:r,errors:s},stack:o})}function ED(t){var I,T,w,S,U;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((P,E)=>P+E)))return{error:we};if(!o)return{error:Eo};let l=((I=Aa({matchUp:o,drawDefinition:n,structure:a,event:s}))==null?void 0:I.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:d0};let u=Mo({tieFormat:l});if(u.error)return u;let c=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:f,groupValueNumbers:h}=zne(l);for(let P of c)ORe({collectionDefinition:P,groupValueNumbers:h,groupValueGroups:f,sideTieValues:p,tieMatchUps:d});for(let P of h){let E=f[P],{allGroupMatchUpsCompleted:D,matchUpCount:R,winCriteria:N,groupValue:M,sideWins:A,values:_}=E,k;if(N!=null&&N.aggregateValue)D&&_[0]!==_[1]&&(k=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)k=_.reduce((B,F,x)=>F>=N.valueGoal?x+1:B,void 0);else{let B=Math.floor(R/2)+1;k=A.reduce((F,x,$)=>x>=B?$+1:F,void 0)}k&&(p[k-1]+=M||0)}let m=p.map((P,E)=>(P||0)+e[E]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l!=null&&l.winCriteria){let{valueGoal:P,aggregateValue:E,tallyDirectives:D}=l.winCriteria;if(P?b=(T=m.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=P))==null?void 0:T.sideNumber:E&&d.every(R=>R.matchUpStatus&&dr.includes(R.matchUpStatus)||R.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&D){let R=o.matchUpId,N=o.hasContext?o:((w=r==null?void 0:r.drawMatchUps)==null?void 0:w[R])||n&&((S=rn({inContext:!0,drawDefinition:n,matchUpId:R}))==null?void 0:S.matchUp);if(N){let{completedTieMatchUps:M,order:A}=O0({matchUps:[N]});if(M&&(A!=null&&A.length)){let _=A[0].participantId;b=(U=N.sides.find(({participantId:k})=>k===_))==null?void 0:U.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function CD({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=rn({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=$t({element:e,name:bp}),l=st((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var g;let d=c.participantId,p=d&&l[d]||void 0,{lineUp:f,...h}=((g=n.sides)==null?void 0:g.find(({sideNumber:v})=>v===c.sideNumber))??{},m=f!=null&&f.length?f:p;return{...u(c),...h,lineUp:m}}),ci({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function ra(t){if(t)return st(t,!1,!0)}function nH(t){let e=Lt(t,[{[Ua]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Kne({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=nH({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function Jp(t){var R,N,M,A;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(R=t.tournamentRecord)==null?void 0:R.tournamentId]:t.tournamentRecord}||{},u=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&Kne({tournamentRecords:l,...t});let c=u&&l[u];if(!c)return{error:Fe};let d=rn({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:Ta};let{matchUp:p,structure:f}=d;if(!p.tieMatchUps)return{error:Co};CD({tournamentId:c==null?void 0:c.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=$t({name:Yv,element:p});if(h!=null&&h.value)if(r)Ha({element:p,name:Yv});else return{...re,score:p.score};let m=(M=Aa({drawDefinition:i,structure:f,matchUp:p,event:s}))==null?void 0:M.tieFormat;p.tieFormat=ra(m);let g=ED({drawDefinition:i,matchUpsMap:a,structure:f,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,T=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!T)return{...re};let w={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},S=v&&[1,2].includes(v),U=S&&kn||EG({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Zl||Fn,P=!!(p.winningSide&&!S),E=p.tieMatchUps.find(({score:_,winningSide:k,matchUpStatus:B})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||B&&dr.includes(B)||k}),D;if(p.tieFormat&&!S&&!E){let _=(A=Aa({drawDefinition:i,structure:f,event:s}))==null?void 0:A.tieFormat;_&&JSON.stringify(m)===JSON.stringify(_)&&(p.tieFormatId=void 0,p.tieFormat=void 0,D=!0)}return oc({appliedPolicies:t.appliedPolicies,matchUpStatus:U,score:w,removeWinningSide:P,tournamentRecord:c,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...re,score:w,removeWinningSide:P,tieFormatRemoved:D,winningSide:v}}function jRe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var h,m,g,v,y;let f="directWinner";if(o){let b=u.drawPositions||[],I=b[t],T=o.source.structureId,w=Dt({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=_r({structureId:T,drawDefinition:l}),P=(h=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:h.participantId,E=o.target.structureId,{positionAssignments:D}=_r({structureId:E,drawDefinition:l}),R=(m=D==null?void 0:D.find(A=>A.participantId===P))==null?void 0:m.drawPosition,N=D==null?void 0:D.filter(A=>{let _=b.includes(A.drawPosition),k=!A.participantId&&!A.bye&&!A.qualifier;return _&&k}).map(A=>A.drawPosition),M=N==null?void 0:N.includes(I);if(P&&o.target.roundNumber===1&&M)vc({drawPosition:I,participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&(N!=null&&N.length)){let A=N.pop();A&&vc({participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(R){let A=ow({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return le({result:A,stack:f})}else if((S==null?void 0:S.stage)!==gt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:k})=>k===P),_=A==null?void 0:A.participantId;A&&_&&_0({eventId:u==null?void 0:u.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let b=ow({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(c&&i){let b=(g=c.sides)==null?void 0:g.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=c.roundPosition,T=u.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:E})=>E===u.matchUpId),U=[1,2].map(E=>{var D;return{...((D=S.sides)==null?void 0:D.find(R=>R.sideNumber===E))||{},sideNumber:E}});S.sides=U;let P=S.sides.find(E=>E.sideNumber===w);if(P){let E=(y=b.lineUp)==null?void 0:y.filter(D=>D==null?void 0:D.participantId);P.lineUp=$G({lineUp:E}),ci({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:S,context:f,drawDefinition:l})}}}return{...re}}function GRe(t){var x,$,j;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,sourceMatchUpStatus:r,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}=t,f="directLoser",h=s.linkCondition,m=u.drawPositions||[],g=h===bd&&u.roundNumber===2&&Math.min(...m.filter(Boolean)),v=g||m[e],y=g||m[1-e],b=s.source.structureId,{structure:I}=Dt({structureId:b,drawDefinition:l}),{matchUps:T}=Ei({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:I,event:p}),w=T.filter(V=>{var H;return(H=V.drawPositions)==null?void 0:H.includes(a)}).filter(V=>{let H=V.sides.find(q=>q.drawPosition===a),z=V.matchUpStatus===yi||V.matchUpStatus===ai&&!Kr(V);return(H==null?void 0:H.sideNumber)===V.winningSide&&!z}),S=h===bd&&w.length===0,{positionAssignments:U}=_r({structureId:b,drawDefinition:l}),P=(x=U==null?void 0:U.find(V=>V.drawPosition===a))==null?void 0:x.participantId,E=s.target.structureId,{positionAssignments:D}=_r({structureId:E,drawDefinition:l}),R=D==null?void 0:D.filter(({drawPosition:V})=>m.includes(V));if(R!=null&&R.some(V=>V.participantId===P))return{...re};let N=R==null?void 0:R.filter(V=>{let H=m.includes(V.drawPosition),z=!V.participantId&&!V.bye&&!V.qualifier;return H&&z}).map(V=>V.drawPosition),M=N==null?void 0:N.includes(v),A=s.target.roundNumber>1&&(N==null?void 0:N.length),_=s.target.roundNumber===1&&M;if(g){let V=k();if(V.error)return le({result:V,stack:f})}else if(_){let V=F();if(V.error)return le({result:V,stack:f})}else if(P&&A){N.sort(sr);let V=N[0],H=vc({participantId:P,structureId:E,drawPosition:V,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(H.error)return le({result:H,stack:f})}else return le({result:{error:l0},context:{loserDrawPosition:a,loserTargetLink:s},stack:f});if(I!=null&&I.seedAssignments&&I.structureId!==E){let V=I.seedAssignments.find(({participantId:z})=>z===P),H=V==null?void 0:V.participantId;V&&H&&_0({eventId:u==null?void 0:u.eventId,structureId:E,...V,tournamentRecord:o,drawDefinition:l,participantId:H})}if(c&&n){let V=($=c.sides)==null?void 0:$.find(H=>H.sideNumber===3-n);if(V!=null&&V.lineUp){let{roundNumber:H,eventId:z}=u,{roundPosition:q}=c,W=H===1?2-q%2:1,Y=(j=d==null?void 0:d.drawMatchUps)==null?void 0:j.find(({matchUpId:Q})=>Q===u.matchUpId),Z=[1,2].map(Q=>{var ce;return{...((ce=Y.sides)==null?void 0:ce.find(J=>J.sideNumber===Q))||{},sideNumber:Q}});Y.sides=Z;let X=Y.sides.find(Q=>Q.sideNumber===W);X&&(X.lineUp=$G({lineUp:V.lineUp}),ci({tournamentId:o==null?void 0:o.tournamentId,matchUp:Y,context:f,drawDefinition:l,eventId:z}))}}return{...re};function k(){let V="loserLinkFedFMLC";return le(S?{result:F(),stack:V}:{result:B(),stack:V})}function B(){let V=Ss({drawPosition:y,structureId:E,tournamentRecord:o,drawDefinition:l,event:p});return le({result:V,stack:"assignLoserPositionBye"})}function F(){let V=P?vc({drawPosition:v,participantId:P,structureId:E,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:cr};return le({result:V,stack:"assignLoserDrawPosition"})}}function Yne(t){var w;let e="directParticipants",i=iH(t);if(i.error)return le({result:i,stack:e});let n=cD({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,dualMatchUp:c,matchUpsMap:d,winningSide:p,targetData:f,matchUpId:h,structure:m,matchUp:g,event:v}=t,y=!!g.collectionId,b=Ko({structure:m}),I=g.drawPositions,T;if(y){let{matchUpTieId:S,matchUpsMap:U}=t,P=Jp({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:s,drawDefinition:l,matchUpsMap:U,event:v});if(T=P&&{tieMatchUpResult:P},I=(w=o.find(({matchUpId:E})=>E===S))==null?void 0:w.drawPositions,!r)return le({result:{...re,...T},stack:e})}if(b)return le({result:{...re,...T},stack:e});if(I){let S=a?a-1:p-1,U=1-S,P=I[S],E=I[U],{targetLinks:{loserTargetLink:D,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:M,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:k,byeMatchUp:B}}=f;if(_){let F=jRe({sourceMatchUpStatus:n&&u||kn,winnerMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:P,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:_,dualMatchUp:c,matchUpsMap:d,event:v});if(F.error)return le({result:F,stack:e})}if(k){let F=GRe({sourceMatchUpStatus:n&&u||kn,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:E,tournamentRecord:s,loserTargetLink:D,drawDefinition:l,loserMatchUp:k,winningSide:p,matchUpsMap:d,dualMatchUp:c,event:v});if(F.error)return le({result:F,stack:e})}if(B){let F=B.drawPositions||[],x=Math.min(...F.filter(Boolean)),$=N.target.structureId,j=Ss({drawPosition:x,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(j.error)return le({result:j,stack:e})}}else return le({result:{error:_1},stack:e});return le({result:{...re,...T},stack:e})}function rH(t){var W,Y,Z,X;let e="genPlayoffStructure";if(!t.drawDefinition)return le({result:{error:ot},stack:e});let i=wD(t);if(i.error)return le({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:u,roundOffsetLimit:c,tournamentRecord:d,exitProfileLimit:p,roundProfiles:f,roundNumbers:h,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=st(t.drawDefinition,!1,!0),{structure:I}=Dt({structureId:n,drawDefinition:b});if(!I)return le({result:{error:Sn},stack:e});if(I.structureType===ro||I.structures)return dRe({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:T,playoffRounds:w}=i,{playoffPositionsReturned:S,error:U,playoffSourceRounds:P,playoffRoundsRanges:E}=Ene(t);if(U)return le({result:{error:U},stack:e});let D=(f==null?void 0:f.length)&&Object.assign({},...f),R=h||typeof f=="object"&&f.map(Q=>Object.keys(Q)).flat(),N=Array.isArray(R)&&R.map(Q=>!isNaN(Q)&&St(Q)).filter(Boolean);if(N){if(!Array.isArray(N))return le({result:{error:we},context:{validRoundNumbers:N},stack:e});N.forEach(Q=>{if(!(w!=null&&w.includes(Q)))return le({result:{error:we},context:{roundNumber:Q},stack:e})})}u&&u.forEach(Q=>{if(!(S!=null&&S.includes(Q)))return le({result:{error:we},context:{playoffPosition:Q},stack:e})});let M=N||P,A=N?T:E,_=[],k=[];for(let Q of M??[]){let ce=A==null?void 0:A.find(fe=>fe.roundNumber===Q);if(!ce)return le({result:{error:we},context:{roundNumber:Q},stack:e});let J=ce.finishingPositions.length,ee=Math.min(...ce.finishingPositions)-1,ne=2,ie=Q&&(D==null?void 0:D[Q])&&ne+D[Q]-1,oe=NI({exitProfile:`0-${Q}`,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionOffset:ee,playoffAttributes:l,exitProfileLimit:p,stage:Nn,roundOffset:0,drawDefinition:b,sequenceLimit:ie,stageSequence:ne,drawSize:J,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:c});if(oe.error)return le({result:oe,stack:e});let{structures:se,links:pe}=oe;if(se!=null&&se.length&&_.push(...se),pe!=null&&pe.length&&k.push(...pe),oe.structureId&&Q){let fe={linkType:yd,source:{structureId:n,roundNumber:Q},target:{structureId:oe.structureId,feedProfile:Cl,roundNumber:1}};k.push(fe)}}if(!_.length)return le({result:{error:we},info:"No structures generated",stack:e});b.structures.push(..._),b.links.push(...k);let{matchUps:B,matchUpsMap:F}=pr({inContext:!0,drawDefinition:b}),x=_.map(({structureId:Q})=>Q),$=B==null?void 0:B.filter(({structureId:Q})=>x.includes(Q)).map(Nr),j=(W=F==null?void 0:F.drawMatchUps)==null?void 0:W.filter(({matchUpId:Q})=>$==null?void 0:$.includes(Q));if(j!=null&&j.length){let Q=(Y=Aa({drawDefinition:b,event:v}))==null?void 0:Y.tieFormat;Q&&j.forEach(ce=>{let{tieMatchUps:J}=SD({matchUp:ce,tieFormat:Q,isMock:g});Object.assign(ce,{tieMatchUps:J,matchUpType:Zi})})}(Z=B==null?void 0:B.filter(Q=>Rm({matchUp:Q})&&Q.structureId===n))==null||Z.forEach(Q=>{let{matchUpId:ce,score:J,winningSide:ee}=Q,ne=Xa({inContextDrawMatchUps:B,drawDefinition:b,matchUpId:ce}),ie=Yne({inContextDrawMatchUps:B,tournamentRecord:d,drawDefinition:b,matchUpsMap:F,winningSide:ee,targetData:ne,matchUpId:ce,structure:I,matchUp:Q,score:J,event:v});ie.error&&console.log(ie.error)}),(X=B==null?void 0:B.filter(Q=>Q.matchUpStatus===Ui&&Q.structureId===n))==null||X.forEach(Q=>{let{matchUpId:ce}=Q,J=Xa({inContextDrawMatchUps:B,drawDefinition:b,matchUpId:ce}),{targetLinks:{loserTargetLink:ee},targetMatchUps:{loserMatchUpDrawPositionIndex:ne,loserMatchUp:ie}}=J;if(ee&&ie){let oe=ee.target.structureId,se=ie.drawPositions[ne],pe=Ss({drawPosition:se,structureId:oe,tournamentRecord:d,drawDefinition:b,event:v});pe.error&&console.log(pe.error)}});let V=[],H=Wm({inContextDrawMatchUps:B,drawDefinition:b,matchUpsMap:F}).goesToMap,{structure:z}=Dt({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:q}=Ei({structure:z});return q.forEach(Q=>{var ee,ne;let ce=H==null?void 0:H.loserMatchUpIds[Q.matchUpId];if(ce&&Q.loserMatchUpId!==ce){Q.loserMatchUpId=ce;let ie={tournamentId:d==null?void 0:d.tournamentId,eventId:(ee=t.event)==null?void 0:ee.eventId,context:e,matchUp:Q};V.push(ie)}let J=H==null?void 0:H.winnerMatchUpIds[Q.matchUpId];if(J&&Q.winnerMatchUpId!==J){Q.winnerMatchUpId=J;let ie={tournamentId:d==null?void 0:d.tournamentId,eventId:(ne=t.event)==null?void 0:ne.eventId,context:e,matchUp:Q};V.push(ie)}}),{structures:_,matchUpModifications:V,links:k,drawDefinition:b,...re}}function Zne(t){return E_({...t,itemType:"attachConsolationStructures"})}function aH(t){return E_({...t,itemType:"attachPlayoffStructures"})}function E_({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!n)return{error:ot};if(!Array.isArray(r)||!Array.isArray(a))return le({result:{error:we},stack:s});let l=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},u=(g=n.links)==null?void 0:g.map(l);if(a.some(b=>{let I=l(b);return u==null?void 0:u.includes(I)}))return le({result:{error:lj},info:"playoff structure exists",stack:s});a.length&&((v=n.links)==null||v.push(...a));let c=r.map(({structureId:b})=>b),d=(y=n.structures)==null?void 0:y.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>c.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let p=r==null?void 0:r.filter(({structureId:b})=>!(d!=null&&d.includes(b)));p.length&&n.structures.push(...p),Wm({drawDefinition:n});let f=r.map(b=>{var I;return((I=Ei({structure:b}))==null?void 0:I.matchUps)||[]}).flat();ih({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:f});let h=r.map(({structureId:b})=>b);if(Ji({drawDefinition:n,structureIds:h}),e==null?void 0:e.length){let b={};e.forEach(T=>{var S;let w=(S=T.matchUp)==null?void 0:S.matchUpId;w&&(b[w]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...U}=b[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let P={};S.forEach(E=>b[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,P[E.matchUpId]))}b[w.matchUpId].matchUp=w,ci(b[w.matchUpId])}})};n.structures.forEach(T=>{if(d!=null&&d.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let m=p.map(Yo("structureId"));if(i){let b={itemValue:{structureIds:h,drawId:n.drawId},itemType:t};kh({element:i,timeItem:b})}return{...re,addedStructureIds:m}}function C_(t){var o,s;let{structures:e,links:i,matchUpModifications:n,error:r}=rH(t);if(r)return{error:r};let a=t.drawDefinition;return aH({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:n,drawDefinition:a,structures:e,links:i})}function Km(t){let e=Lt(t,[{_anyOf:{[Ua]:!1,[as]:!1,[ll]:!1,[By]:!1},[vj]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=j7(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&Ji({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Fe};for(let a of r){let o=t.tournamentRecords[a],s=j7(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:Fe};return i.length?{...re,applied:i}:{error:KV}}function j7(t,e){let i=mi(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:MA};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Ii(o))return{error:we};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!zn(s))return{error:we};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...fi({element:e,extension:{name:dU,value:i}}),applied:n}:{applied:n,error:KV}}function oH({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var s;if(!n||typeof n!="string")return le({result:{error:we},context:{drawName:n}});i||(i=Gn({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===r);if(o){o.drawName=n;let l={name:Vl,value:{...i,flights:i.flights}};Rh({event:a,extension:l})}return e&&(e.drawName=n,Ji({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:ot}:{...re,flight:o}}function Xne({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var l;if(!Ii(i))return{error:we};let a=Gn({event:r}).flightProfile,o=i.drawName&&oH({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(u=>u.drawId===n));if(!s&&!e)return{error:ot};if(s){let u={name:Vl,value:{...a,flights:a.flights}};Rh({event:r,extension:u})}return e&&(i.policyDefinitions&&Km({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Ji({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...re}}function Jne({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:ot};let n=ga({drawDefinition:i}),r=l=>{var u;return(u=n==null?void 0:n.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![gt,it].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:f}=Ei({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:l});for(let h of p){let{matchUpId:m,roundNumber:g}=h,v=h.sides||[],y=r(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Ui&&Object.assign(y,T_),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!f){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![Up,Gm,P0,aie,E0,C0].includes(b.itemType))),ci({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let a=(i.structures||[]).map(({structureId:l})=>l);return Ji({drawDefinition:i,structureIds:a}),{...re}}function RD({tournamentRecord:t}){var n;if(!t)return{error:Fe};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((n=t.events)==null?void 0:n.map(r=>{let a=r.eventId;return i[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=w_({drawDefinition:r}),c=i[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,U=Jv[T],{inContextStructureMatchUps:P}=dD({drawDefinition:r,structure:I,event:c}),E=P==null?void 0:P.filter(({winningSide:V})=>V),D=E.filter(Boolean).length||0;s+=D,l+=P.length-s;let R=Math.max(E.filter(({roundNumber:V})=>V===1).map(({roundPosition:V})=>V)),{positionAssignments:N}=Gi({structure:I}),M=N==null?void 0:N.filter(({participantId:V})=>V);o+=(M==null?void 0:M.length)??0;let A=((N==null?void 0:N.length)??0)-((M==null?void 0:M.length)??0),{roundMatchUps:_,roundProfile:k,roundNumbers:B,maxMatchUpsCount:F}=Za({matchUps:P}),x=k&&Object.keys(k).filter(V=>!k[V].inactiveRound).map(V=>parseInt(V)),$=k&&Object.keys(k).filter(V=>k[V].inactiveRound).map(V=>parseInt(V)),j=k&&Object.values(k).every(V=>V.inactiveRound);return{positionsAssignedCount:(M==null?void 0:M.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:F,inactiveRounds:$,roundMatchUps:_,activeRounds:x,roundNumbers:B,roundProfile:k,structureId:S,stageSequence:w,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),f=d.filter(({inactiveStructure:I})=>!I).length,{links:h}=R0({structureId:p.structureId,drawDefinition:r}),m=St(p.activeRounds[0])===1&&p.activeRounds.length===1&&f===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),m&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};e.drawAnalysis[y]=b}),{...re,drawsAnalysis:e}}function Qne({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var o;if(!e)return{error:Fe};if(!i)return{error:ot};let r=[],{drawsAnalysis:a}=RD({tournamentRecord:e});if(a.canBePruned.includes(n)){let s=a.matchPlay.includes(n),l=a.drawAnalysis[n],{structures:[u]}=wd({stageSequence:1,drawDefinition:i,stage:it}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,m)=>h.roundPosition-m.roundPosition);r=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=r.map(Nr),f=d.map(Nr).filter(h=>!p.includes(h));if(s){let h=r.filter(({roundNumber:b})=>!c.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=h.map(Nr),g=p.filter(b=>!m.includes(b));f.push(...g);let v=h.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(h.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(o=u==null?void 0:u.positionAssignments)==null?void 0:o.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));u.positionAssignments=b}else u.positionAssignments=[];u.matchUps=h,r=h}Wp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,drawDefinition:i}),Ji({drawDefinition:i})}return{...re,matchUps:r}}function ere({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:ot};if(!n)return{error:u0};if(!r)return{error:Is};if(s){let l=Ss({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:FA};{let l=vc({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...re}}function tre(t){var l,u,c,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??((u=(l=i==null?void 0:i.structures)==null?void 0:l.find(f=>{var h;return(h=f.matchUps)==null?void 0:h.some(({matchUpId:m})=>e.includes(m))}))==null?void 0:u.structureId)??((d=(c=i==null?void 0:i.structures)==null?void 0:c[0])==null?void 0:d.structureId);if(!n)return{error:Sn};let r=(p=i.structures)==null?void 0:p.find(f=>f.structureId===n);if(!r)return{error:Sn};let a=r==null?void 0:r.matchUps,o=a==null?void 0:a.find(f=>!!f.roundPosition);if(r.structures||o||r.finishingPosition===jy)return{error:Ny};let s=a.filter(({roundNumber:f})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(f)}).map(Nr);return e=e.filter(f=>!s.includes(f)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:n,structure:r}}function ire(t){let e=Lt(t,[{[ll]:!0},{[sU]:{[B1]:!1,roundNumbers:!1},[md]:we,[ul]:uo}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=tre(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(b||Kr({score:y})){if(!b&&!i)return!1;f.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=h.map(Nr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Nr)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Wp({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=Vt(u.matchUps.map(Yo("roundNumber"))),y=CDe(v);if(y.length){y.reverse();for(let b of y)u.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,ci({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:I}))})}if(f.length){u.positionAssignments=Vt(u.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let b=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:I}=Ei({afterRecoveryTimes:!1,inContext:!0,structure:u,event:s}),T=eH({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:b,matchUps:I,event:s});T.error&&console.log(T)}Ji({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:BA}:{...re,deletedMatchUpsCount:[...m,...g].length}}function nre({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:Fe};if(!i)return{error:ot};if(!r)return le({result:{error:ht},info:"roundNumber required"});let o=Dt({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:Ny}:Ko({structure:s})?HRe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...re})}function HRe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(sr).includes(n)){let c=o.filter(d=>{let p=d.roundNumber===n&&(!dr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Nr))),!p});l.length&&(Wp({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===n)||(c.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,ci({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),r.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...re}}function R_(t){var p,f,h,m,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:a}=t;if(typeof n!="object")return{error:ot};let o=t==null?void 0:t.structureId;if(!o&&((p=n.structures)==null?void 0:p.length)===1&&(o=(h=(f=n.structures)==null?void 0:f[0])==null?void 0:h.structureId),typeof o!="string")return{error:Is};if(!cl(r))return{error:we,info:Td("matchUps")};let s=(m=n.structures)==null?void 0:m.find(y=>y.structureId===o);if(!s)return{error:Sn};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===jy)return{error:Ny};let u=((v=(g=Wr({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Nr))??[],c=r.map(Nr);if(Ya(u,c))return{error:$ee,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...r);let d=r.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(ih({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...r],eventId:a==null?void 0:a.eventId,drawDefinition:n}),Ji({drawDefinition:n,structureIds:[o]})),{...re}}function rre({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var f;if(!e)return{error:ot};if(!n)return{error:Is};if(!i)return{error:u0};let{structure:o}=Dt({drawDefinition:e,structureId:n});if(!o)return{error:Sn};let s=o;o.structures&&o.structureType===ro&&(s=(f=o.structures)==null?void 0:f.find(h=>{var m;return(m=h.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,u=l==null?void 0:l.find(h=>h.drawPosition===i);u&&fi({element:u,extension:{name:JI,value:r}});let c=((a==null?void 0:a.eventType)===Zi||e.matchUpType===Zi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[Zi]},{matchUps:d}=Ei({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return eH({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Ji({drawDefinition:e,structureIds:[n]}),{...re}}var are={};Kt(are,{addGoesTo:()=>Wm,allPlayoffPositionsFilled:()=>HG,checkValidEntries:()=>__,findDrawDefinition:()=>cH,getAssignedParticipantIds:()=>Pg,getAvailableMatchUpsCount:()=>M_,getAvailablePlayoffProfiles:()=>wD,getDrawDefinitionTimeItem:()=>fG,getDrawParticipantRepresentativeIds:()=>lH,getDrawTypeCoercion:()=>MD,getEligibleVoluntaryConsolationParticipants:()=>sH,getMatchUpsMap:()=>ga,getParticipantIdFinishingPositions:()=>uH,getPositionAssignments:()=>UU,getPositionsPlayedOff:()=>k0,getSeedingThresholds:()=>FG,getSeedsCount:()=>ND,getStructureSeedAssignments:()=>tl,getTeamLineUp:()=>qm,getValidGroupSizes:()=>gD,isAdHoc:()=>Ko,isCompletedStructure:()=>rh,isValidForQualifying:()=>bH,positionActions:()=>yH});function sH({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){var k,B,F,x,$;if(!s)return{error:ot};let h=[it,Nn];i&&h.push(gt);let m=f!=null&&f.eventType?{matchUpTypes:[f.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&f?((k=Xp({contextFilters:{stages:h},matchUpFilters:m,tournamentRecord:o,inContext:!0,event:f}))==null?void 0:k.matchUps)??[]:((B=za({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:B.matchUps)??[],y=qy({stage:$r,drawDefinition:s}).map(({participantId:j})=>j),b={},I={},T={},w={};r||(r=Kp({policyTypes:[b2],tournamentRecord:o,drawDefinition:s,event:f}).policyDefinitions);let S=r==null?void 0:r[b2];t=t.length&&t||(S==null?void 0:S.excludedMatchUpStatuses)||[],e=e??(S==null?void 0:S.includeEventParticipants),d=d??(S==null?void 0:S.allEntries),n=n??(S==null?void 0:S.finishingRoundLimit),a=a??(S==null?void 0:S.roundNumberLimit),l=l??(S==null?void 0:S.matchUpsLimit),u===void 0&&(u=(S==null?void 0:S.requirePlay)!==void 0?S.requirePlay:!0),c===void 0&&(c=(S==null?void 0:S.requireLoss)!==void 0?S.requireLoss:!0),p=p??(S==null?void 0:S.winsLimit);for(let j of v){if(u&&j.winningSide&&![1,2].includes(j.winningSide)&&j.matchUpStatus!==ir||j.finishingRound&&n&&j.finishingRound>=n||j.finishingRound&&a&&j.finishingRound<=a)continue;let V=(F=j.sides)==null?void 0:F.find(({sideNumber:z})=>j.winningSide&&z===3-j.winningSide),H=(x=j.sides)==null?void 0:x.find(({sideNumber:z})=>j.winningSide&&z===j.winningSide);if(($=j.sides)==null||$.forEach(z=>{var W;let q=(W=z==null?void 0:z.participant)==null?void 0:W.participantId;q&&(T[q]=z.participant,j.matchUpStatus===ir&&!u&&(I[q]=z.participant,b[q]||(b[q]=0),(!j.matchUpStatus||!t.includes(j.matchUpStatus))&&(b[q]+=1)))}),V==null?void 0:V.participant){let z=V.participant.participantId;I[z]=V.participant,b[z]||(b[z]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(b[z]+=1)}if(H!=null&&H.participant){let z=H.participant.participantId;w[z]||(w[z]=0),w[z]+=1,b[z]||(b[z]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(b[z]+=1)}}let U=(o==null?void 0:o.participants)&&!u&&!c&&d,P=U?((e&&f?f.entries:s.entries)??[]).filter(j=>![Sd,Xl].includes(j.entryStatus)).map(({participantId:j})=>j):[],E=Object.keys(I),D=U?((o==null?void 0:o.participants)??[]).filter(({participantId:j})=>P.includes(j)):c&&Object.values(I)||Object.values(T),R=j=>!c||E.includes(j),N=j=>!u||(b[j]||0)>=0,M=j=>!p||(w[j]||0)<=p,A=j=>!l||b[j]<=l,_=j=>!y.includes(j);return{eligibleParticipants:D.filter(j=>R(j.participantId)&&N(j.participantId)&&M(j.participantId)&&A(j.participantId)&&_(j.participantId)).map(j=>{var V;return{...j,individualParticipants:(V=j.individualParticipantIds)==null?void 0:V.map(H=>{var z;return(z=o==null?void 0:o.participants)==null?void 0:z.find(q=>q.participantId===H)})}}),losingParticipantIds:E,...re}}function M_(t){var h,m,g,v,y,b,I,T;let e=Lt(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(((h=i.structures)==null?void 0:h.length)===1&&((g=(m=i.structures)==null?void 0:m[0])==null?void 0:g.structureId));if(typeof r!="string")return{error:Is};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===r);if(!a)return{error:Sn};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,S)=>(S.roundPosition&&(o=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(a.structures||o||a.finishingPosition===jy)return{error:Ny};let l=((b=i==null?void 0:i.entries)==null?void 0:b.filter(w=>{let S=w.entryStatus;return Jl.includes(S)}))??[],u=Math.floor((l==null?void 0:l.length)/2)||1,c=n??s??1,d=((T=(I=a.matchUps)==null?void 0:I.filter(w=>w.roundNumber===c))==null?void 0:T.length)??0,p=u-d,f=p>0?p:0;return{...re,availableMatchUpsCount:f,lastRoundNumber:s,roundMatchUpsCount:u}}function lH({drawDefinition:t}){var i;let e=$t({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function zRe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:ot};let n=pr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=st(n.matchUps,!1,!0),a=Vt(r.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function uH({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:ot};let{participantIds:n,participantIdMatchUps:r}=zRe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[kn,Ui].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),f=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&f)===f?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function Oh({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:Fe};if(!n)return{error:qu};if(!e&&t){if(typeof i!="string"&&(i=Kne({tournamentRecords:t,drawId:n}),!i))return{error:jI};if(e=t[i],!e)return{error:Fe}}let r=e&&ho({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...re}:le({result:{error:ms},stack:"findDrawDefinition"})}function cH(t){let{drawDefinition:e,error:i}=Oh(t);return i?{error:i}:{drawDefinition:st(e)}}function k2({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=R0({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=Dt({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var qRe="qualifierDrawPositionAssignment",WRe="withdrawParticipantAtDrawPosition",KRe="alternateDrawPositionAssignment",YRe="luckyLoserDrawPositionAssignment",G7="removeDrawPositionAssignment",ZRe="swapDrawPositionAssignments",XRe="modifyPairAssignment",JRe="modifyParticipantOtherName",H7="assignDrawPosition",QRe="removeSeededParticipant",eMe="assignDrawPositionBye",tMe="modifySeedAssignment",ore="addPenalty",dH="MODIFY_PAIR",N_="QUALIFIER",pH="ALTERNATE",fH="WITHDRAW",ey="ASSIGN",O2="REMOVE",hH="LUCKY",ET="REMOVE_SEED",mH="SWAP",TU="NICKNAME",Uv="SEED_VALUE",ty="PENALTY",DM="BYE",ib={MODIFY_PAIR_ASSIGNMENT:dH,QUALIFYING_PARTICIPANT:N_,ALTERNATE_PARTICIPANT:pH,WITHDRAW_PARTICIPANT:fH,ASSIGN_PARTICIPANT:ey,LUCKY_PARTICIPANT:hH,REMOVE_ASSIGNMENT:O2,SWAP_PARTICIPANTS:mH,ADD_NICKNAME:TU,REMOVE_SEED:ET,ADD_PENALTY:ty,ASSIGN_BYE:DM,SEED_VALUE:Uv};function iMe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[Xl,Sg].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=n.individualParticipantIds,u=e?t.filter(({participantId:d})=>o.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:pt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:XRe,availableIndividualParticipantIds:o,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:dH},!1,!1,!0)}}return{}}function Ym(t){var f,h;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if((r==null?void 0:r.linkCondition)===bd&&((f=i==null?void 0:i.matchUp)==null?void 0:f.matchUpStatus)===Ui)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=[ai,yi].includes(a==null?void 0:a.matchUpStatus),u=((h=o==null?void 0:o.drawPositions)==null?void 0:h.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!l||o!=null&&o.winningSide&&u===2&&(!o.feedRound||![yi,ai].includes(o==null?void 0:o.matchUpStatus)))return!0;let c=a&&Xa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),d=o&&Xa({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),p=c&&Ym({relevantLink:s==null?void 0:s.loserTargetLink,targetData:c,inContextDrawMatchUps:e,drawDefinition:n});return!!(d&&Ym({targetData:d,inContextDrawMatchUps:e,drawDefinition:n})||p)}var sre={[yp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[gt,it],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[TU,ty,N_,Uv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},dR="positionAction",x2="matchUpAction";function lre({actionType:t=dR,appliedPolicies:e,drawDefinition:i,structure:n}){var d,p;let r=t===dR&&yp||t===x2&&Br,a=t===dR&&sre||t===x2&&Bie,o=r&&((e==null?void 0:e[r])||(a==null?void 0:a[r])),s=((p=(d=i.links)==null?void 0:d.filter(f=>{var h;return((h=f==null?void 0:f.target)==null?void 0:h.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:p.map(({target:f})=>f.feedProfile))??[],{enabledStructures:l,disabledStructures:u}=o||{},c=u==null?void 0:u.find(f=>{let{stages:h,stageSequences:m,structureTypes:g,feedProfiles:v}=f;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:l,actionsDisabled:c,actionsPolicy:o}}function z7({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function ure({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:f}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(n),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(r),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(f!=null&&f.length)||Array.isArray(f)&&f.some(y=>o.includes(y));return m&&g&&v&&u&&h})}}function So({action:t,policyActions:e}){var n;let i=!(e!=null&&e.enabledActions)||((n=e==null?void 0:e.disabledActions)==null?void 0:n.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var cre="replaceTieMatchUpParticipantId",dre="assignTieMatchUpParticipantId",L2="removeTieMatchUpParticipantId",q7="assignMatchUpSideParticipant",nMe="removeMatchUpSideParticipant",pre="substituteParticipant",F2="REMOVE_SUBSTITUTION",fre="REPLACE_PARTICIPANT",gH="REMOVE_PARTICIPANT",B2="setMatchUpStatus",$2="SUBSTITUTION",hre="SCHEDULE",rMe="PENALTY",V2="REFEREE",mre="STATUS",j2="START",gre="SCORE",G2="END",vH={REPLACE_TEAM_POSITION_METHOD:cre,ASSIGN_TEAM_POSITION_METHOD:dre,REMOVE_TEAM_POSITION_METHOD:L2,REPLACE_PARTICIPANT:fre,SUBSTITUTION_METHOD:pre,REMOVE_SUBSTITUTION:F2,REMOVE_PARTICIPANT:gH,SCHEDULE_METHOD:B2,SUBSTITUTION:$2,SCHEDULE:hre,PENALTY:rMe,REFEREE:V2,STATUS:mre,SCORE:gre,START:j2,END:G2};function aMe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var M,A,_,k,B,F,x,$,j,V,H,z,q,W,Y;let f=[],h=(M=r.sides)==null?void 0:M.find(Z=>Z.participant),m=r.gender===Po&&r.sideNumber&&((A=r.sides)==null?void 0:A.filter(Z=>Z.particiapntId).length)===1&&((k=(_=h==null?void 0:h.participant)==null?void 0:_.person)==null?void 0:k.sex),g=r.matchUpType,v=(o??((B=n==null?void 0:n.participants)==null?void 0:B.enforceGender))!==!1?r.gender:void 0,y=(x=(F=r.sides)==null?void 0:F.flatMap(Z=>{var X;return((X=Z.participant)==null?void 0:X.individualParticipants)||Z.participant}).filter(Boolean))==null?void 0:x.map(Jt),b=($=r.sides)==null?void 0:$.filter(Z=>!l||Z.sideNumber===l).flatMap(Z=>{var X;return((X=Z.participant)==null?void 0:X.individualParticipants)||Z.participant}).filter(Boolean),I=b==null?void 0:b.map(Jt),T=(V=(j=e==null?void 0:e.find(Z=>Z.matchUpId===r.matchUpTieId))==null?void 0:j.sides)==null?void 0:V.map(Z=>{var X,Q;return(Q=(X=Z==null?void 0:Z.participant)==null?void 0:X.individualParticipants)==null?void 0:Q.filter(({participantId:ce,person:J})=>!(I!=null&&I.includes(ce))&&(!v||v===Lu||J.sex===v||v===Po&&!m||m&&J.sex!==m))}),w=l?T==null?void 0:T[l-1]:T==null?void 0:T.map((Z,X)=>({participants:Z,sideNumber:X+1})),S=l?(H=T==null?void 0:T[l-1])==null?void 0:H.map(Jt):T==null?void 0:T.map((Z,X)=>({participants:Z==null?void 0:Z.map(Jt),sideNumber:X+1})),U=l&&(On(wv)(g)&&!(I!=null&&I.length)||On(jm)(g)&&((I==null?void 0:I.length)??0)<2)||!l&&(On(wv)(g)&&((I==null?void 0:I.length)??0)<2||On(jm)(g)&&((I==null?void 0:I.length)??0)<4),P=S==null?void 0:S.filter(Z=>!(y!=null&&y.includes(Z))),E=w==null?void 0:w.filter(({participantId:Z})=>P.includes(Z));if(U&&(P!=null&&P.length)&&f.push({availableParticipantIds:P,method:dre,availableParticipants:E,type:ey,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),I!=null&&I.length&&(!Kr(c)||(z=p==null?void 0:p.substitutions)!=null&&z.length)&&f.push({method:L2,type:gH,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),E!=null&&E.length&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&f.push({availableParticipantIds:P,method:cre,availableParticipants:E,type:fre,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),So({policyActions:a,action:F2})&&((q=p==null?void 0:p.substitutions)==null?void 0:q.length)){let Z=((W=p.participant)==null?void 0:W.participantType)===Qt&&[p.participantId]||((Y=p.participant)==null?void 0:Y.participantType)===Ot&&p.participant.individualParticipantIds||[],X=p.substitutions.map(Q=>Q.participantId).filter(Q=>Z.includes(Q));(!s||X.includes(s))&&f.push({method:L2,type:F2,substitutedParticipantIds:X,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let D=t==null?void 0:t[Br],R=D==null?void 0:D.substituteWithoutScore,N=D==null?void 0:D.substituteAfterCompleted;if(So({policyActions:a,action:$2})&&i.length===2&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&(R||Kr(c))&&(N||c.matchUpStatus&&!dr.includes(c.matchUpStatus))&&(b!=null&&b.length)&&w.length){let Z=b.map(Jt);f.push({info:"list of team players available for substitution",method:pre,availableParticipantIds:S,existingParticipantIds:Z,availableParticipants:w,existingParticipants:b,type:$2,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return f}function oMe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var S,U,P,E,D;if(i.includes(s))return{};let f=(S=l.find(R=>R.type===ey))==null?void 0:S.availableParticipantIds,h=(U=a==null?void 0:a[yp])==null?void 0:U.otherFlightEntries,m=(P=a==null?void 0:a[yp])==null?void 0:P.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:R})=>!m||(c.stage===gt?R===gt:R!==gt)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:v}=Lte({drawDefinition:o}),y=n.map(R=>R.participantId).filter(Boolean),b=g.filter(R=>c.stage&&[gt,it,Nn].includes(c.stage)?!(v!=null&&v.includes(R)):!y.includes(R)),I=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===Al&&vre({restrictQualifyingAlternates:m,structure:c,entry:R})&&(c.stage&&[gt,it,Nn].includes(c.stage)?!(v!=null&&v.includes(R.participantId)):!y.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),T=Vt(b.concat(I));if(h){let R=(D=(E=p?Gn({event:p}).flightProfile:void 0)==null?void 0:E.flights)==null?void 0:D.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(M=>M.participantId&&![Sd,Xl,Sg].includes(M.entryStatus)&&!g.includes(M.participantId)).map(({participantId:M})=>M)).flat().filter(Boolean);R!=null&&R.length&&T.push(...R)}f!=null&&f.length&&(T=T.filter(R=>!f.includes(R)));let w=r?t==null?void 0:t.filter(R=>T.includes(R.participantId)):void 0;return w==null||w.forEach(R=>{let N=(o.entries??[]).find(M=>M.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),T.length?{validAlternatesAction:pt({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:KRe,availableAlternatesParticipantIds:T,type:pH,availableAlternates:w})}:{}}function vre({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===gt&&!t||i.entryStage===it&&n===pa)return!0}function sMe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Al&&vre({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Jt)}function lMe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var w,S,U,P,E;let p=[],f=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:D})=>D===u.roundNumber),h=((w=r==null?void 0:r.entries)==null?void 0:w.filter(({entryStatus:D})=>D&&Tg.includes(D)).map(Jt))??[],m=f.map(D=>(D.sides??[]).flatMap(Jt)).flat().filter(Boolean),g=h.filter(D=>!i.includes(D)&&(!t||!m.includes(D))),v=e==null?void 0:e.filter(D=>g==null?void 0:g.includes(D.participantId)).map(D=>st(D,void 0,!0));v==null||v.forEach(D=>{let R=(r.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=R==null?void 0:R.entryPosition}),g.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:q7,type:ey,availableParticipantIds:g,participantsAvailable:v});let y=(d==null?void 0:d.entries)??[],b=sMe({eventEntries:y,structure:l}),I=Vt(h.concat(b));if(n){let D=(U=(S=d?Gn({event:d}):void 0)==null?void 0:S.flights)==null?void 0:U.filter(R=>R.drawId!==c).flatMap(R=>R.drawEntries.filter(N=>N.participantId&&![Sd,Xl,Sg].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);D!=null&&D.length&&I.push(...D)}I=I.filter(D=>!i.includes(D)&&!g.includes(D)&&(!t||!m.includes(D)));let T=e==null?void 0:e.filter(D=>I.includes(D.participantId)).map(D=>st(D,void 0,!0));return T==null||T.forEach(D=>{let R=(r.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=R==null?void 0:R.entryPosition}),T==null||T.sort((D,R)=>(D.entryPosition||1/0)-(R.entryPosition||1/0)),I.length&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:I,participantsAvailable:T,method:q7,type:Al}),!Kr(u)&&o&&((E=(P=u.sides)==null?void 0:P.find(D=>D.sideNumber===o))!=null&&E.participantId)&&p.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:nMe,type:gH}),p}function A_(t){var Z,X,Q,ce,J,ee,ne,ie,oe;if(!t)return{error:we};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,u=t.tournamentRecord??(t.tournamentId&&zn(t.tournamentId)&&((Z=t.tournamentRecords)==null?void 0:Z[t.tournamentId]));if(!u)return{error:Fe};if(!l||!zn(l))return{error:Ca};if(s&&![1,2].includes(s))return le({result:{error:we},context:{sideNumber:s}});if(!e){let se=(Wr({tournamentRecord:u}).matchUps??[]).find(fe=>fe.matchUpId===l);i=((u==null?void 0:u.events)??[]).find(fe=>fe.eventId===(se==null?void 0:se.eventId));let pe=((i==null?void 0:i.drawDefinitions)??[]).find(fe=>fe.drawId===(se==null?void 0:se.drawId));pe&&(e=pe)}if(!e)return{error:ot};let c=Bn({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=e,{matchUp:p,structure:f}=rn({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Ta};let h=mi({tournamentRecord:u,drawDefinition:e,structure:f,event:i}).appliedPolicies??{};Object.assign(h,r??{});let m=(X=h==null?void 0:h[yp])==null?void 0:X.otherFlightEntries,g=(h==null?void 0:h[Br])??A0[Br],{enabledStructures:v}=lre({actionType:x2,appliedPolicies:h,drawDefinition:e,structure:f}),{policyActions:y}=ure({enabledStructures:v,drawDefinition:e,structure:f}),b=t.matchUpsMap??ga({drawDefinition:e}),I=t.inContextDrawMatchUps??pr({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,T=I==null?void 0:I.find(se=>se.matchUpId===l),w=s&&((Q=T==null?void 0:T.sides)==null?void 0:Q.find(se=>se.sideNumber===s)),S=((ce=T==null?void 0:T.sides)==null?void 0:ce.map(se=>{var pe;return se.participantId||((pe=se.participant)==null?void 0:pe.participantid)}).filter(Boolean))??[],{assignedPositions:U,allPositionsAssigned:P}=_r({structure:f}),{structureId:E}=f??{},D=[];if(!E)return{validActions:D};let R=Ko({structure:f}),N=p.collectionId;if(R&&!N){let se=lMe({restrictAdHocRoundParticipants:n,tournamentParticipants:c,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:s,matchUpId:l,structure:f,matchUp:p,drawId:d,event:i});D.push(...se)}let M=rh({drawDefinition:e,structure:f}),A=U==null?void 0:U.filter(se=>se.participantId).map(se=>se.drawPosition),_=U==null?void 0:U.filter(se=>se.bye).map(se=>se.drawPosition),k=p.matchUpStatus===Ui||!N&&((J=p.drawPositions)==null?void 0:J.reduce((se,pe)=>(_==null?void 0:_.includes(pe))||se,!1));if(k)return{validActions:D,isByeMatchUp:k};So({policyActions:y,action:V2})&&D.push({type:V2,payload:{matchUpId:l}});let B=!cD({matchUpStatus:p.matchUpStatus}),F=(ee=h==null?void 0:h.scoring)==null?void 0:ee.structures,x=(f==null?void 0:f.stage)&&(F==null?void 0:F.stage)&&(F==null?void 0:F.stage[f.stage]),$=(f==null?void 0:f.stageSequence)&&(x==null?void 0:x.stageSequence)&&x.stageSequence[f.stageSequence],j=!((ne=h==null?void 0:h.scoring)!=null&&ne.requireAllPositionsAssigned||x!=null&&x.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||P,V=p.sides&&p.sides.filter(se=>se==null?void 0:se.participantId).length===2,H=p.matchUpStatus&&[ir,br].includes(p.matchUpStatus),z=Xa({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),q=Ym({inContextDrawMatchUps:I,drawDefinition:e,targetData:z}),W=(((ie=T==null?void 0:T.drawPositions)==null?void 0:ie.length)===2&&T.drawPositions.every(se=>A==null?void 0:A.includes(se))&&((oe=T==null?void 0:T.sides)==null?void 0:oe.length)===2&&T.sides.every(({participantId:se})=>se)||V)&&!(H&&q),Y={method:ore,type:ty,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(B&&D.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:B2,type:hre}),So({policyActions:y,action:ty})&&(w!=null&&w.participant||!s&&(S!=null&&S.length))&&D.push(Y),B&&W&&D.push({type:mre}),j&&W){let{matchUpId:se,matchUpFormat:pe}=p,fe={drawId:d,matchUpId:se,matchUpFormat:pe,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};D.push({info:"set outcome and winningSide",method:B2,type:gre,payload:fe}),So({policyActions:y,action:j2})&&D.push({type:j2}),So({policyActions:y,action:G2})&&D.push({type:G2})}if(N&&T){let se=aMe({specifiedPolicyDefinitions:r,inContextDrawMatchUps:I,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:T,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});D.push(...se)}return{structureIsComplete:M,validActions:D,isDoubleExit:H,...re}}function uMe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var v,y,b,I,T,w,S;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:f}=((v=o.links)==null?void 0:v.reduce((U,P)=>{var R,N;let E=(R=P.source)==null?void 0:R.structureId,D=(N=P.target)==null?void 0:N.structureId;return U.sourceStructureIds.includes(E)||U.sourceStructureIds.push(E),U.targetStructureIds.includes(D)||U.targetStructureIds.push(D),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},h=[],m=((y=o.links)==null?void 0:y.filter(U=>{var P;return((P=U.target)==null?void 0:P.structureId)===u.structureId}))??[];for(let U of m){let P=(b=U==null?void 0:U.source)==null?void 0:b.structureId,{structure:E}=Dt({structureId:P,drawDefinition:o}),D=(E==null?void 0:E.finishingPosition)===jy&&((p==null?void 0:p.length)!==1||(f==null?void 0:f.length)!==1),R={};if(D){let{matchUps:A}=Ei({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:_}=Qv({drawPosition:s,matchUps:A}),k=(w=(T=(I=o.links)==null?void 0:I.find(B=>{var F;return((F=B.target)==null?void 0:F.structureId)===(u==null?void 0:u.structureId)&&B.target.roundNumber===_}))==null?void 0:T.source)==null?void 0:w.roundNumber;R.roundNumbers=[k]}let{completedMatchUps:N}=m_({structureId:P,inContext:!0,matchUpFilters:R,drawDefinition:o}),M=a.map(A=>A.participantId).filter(Boolean);(S=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==vr||A===vr)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(Jt).filter(A=>A&&!M.includes(A)))==null||S.forEach(A=>{h.includes(A)||h.push(A)})}let g=t==null?void 0:t.filter(U=>h==null?void 0:h.includes(U.participantId));return g==null||g.forEach(U=>{let P=(o.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=P==null?void 0:P.entryPosition}),h!=null&&h.length?{validLuckyLosersAction:{type:hH,method:YRe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function cMe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:h}){var T,w,S;let{drawId:m}=u,g=[],v,y,b=[],I=(w=(T=l==null?void 0:l[Ul])==null?void 0:T.validSeedPositions)==null?void 0:w.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=Jie({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f,event:h})),b!=null&&b.length||(b=o.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||g.push({payload:{drawId:m,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:eMe,type:DM}),a&&I){let U=o.map(N=>N.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:E}=M0({inContext:!0,matchUpFilters:P,drawDefinition:u}),D=Vt((S=(E??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==vr||N===vr))==null?void 0:S.map(({sides:N})=>N==null?void 0:N.map(Jt)).flat().filter(N=>N&&!U.includes(N))),R=s?r==null?void 0:r.filter(N=>D==null?void 0:D.includes(N.participantId)).map(N=>st(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let M=(u.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=M==null?void 0:M.entryPosition}),R!=null&&R.length&&g.push(pt({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:H7,type:ey,availableParticipantIds:D,participantsAvailable:R})),{validAssignmentActions:g}}if(b.includes(p)||d){let U;if(y!=null&&y.length){let E=y.filter(D=>v==null?void 0:v.includes(D.participantId));E.sort(dMe),U=E.map(D=>D.participantId)}else U=e;let P=s?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>st(E,void 0,!0)):void 0;P!=null&&P.length&&g.push(pt({payload:{drawId:m,structureId:f,drawPosition:p},willDisableLinks:i,method:H7,type:ey,availableParticipantIds:U,participantsAvailable:P}))}return{validAssignmentActions:g}}function dMe(t,e){return t.bye||aw(t.seedValue)<aw(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function pMe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var T,w,S;let u=[],c=[],d=[],p=[],f=i.map(U=>U.participantId).filter(Boolean),h=r==null?void 0:r[yp],m=!(h!=null&&h.disableRoundRestrictions)&&t[o],g=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=k2({targetRoundNumber:m,linkType:Sp,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=k2({targetRoundNumber:m,linkType:wp,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&p.push(...b);for(let U of y){let P=(T=a.structures)==null?void 0:T.find(D=>D.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==gt)continue;let E=rh({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let D=P.qualifyingRoundNumber,{matchUps:R}=Ei({matchUpFilters:{roundNumbers:[D],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let N of R){let M=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===Ui&&((w=N.sides)==null?void 0:w.find(({participantId:_})=>_));if(M||A){let{participantId:_,participant:k}=M||A||{};_&&!f.includes(_)&&(k&&n&&u.push(k),c.push(_))}}}}for(let U of I){let P=(S=a.structures)==null?void 0:S.find(D=>D.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==gt)continue;let E=rh({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let{positionAssignments:D}=Gi({structure:P}),R=(D==null?void 0:D.map(N=>{var _;let M=N.participantId,A=(_=$t({element:N,name:eh}).extension)==null?void 0:_.value;return A?{participantId:M,groupOrder:A==null?void 0:A.groupOrder}:{}}).filter(({groupOrder:N,participantId:M})=>N===1&&!f.includes(M)).map(({participantId:N})=>N))??[];if(R&&c.push(...R),n){let N=e.filter(({participantId:M})=>R.includes(M));u.push(...N)}}}return c.length&&d.push(pt({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:qRe,type:N_,qualifyingParticipantIds:c,qualifyingParticipants:n?u:void 0})),{validAssignmentActions:d,sourceStructureIds:p}}function fMe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h}){if(r.includes(c))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==c&&!(u&&s.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=Ei({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),I=b.filter(({drawPositions:E})=>Ya(E,y)),T=Object.assign({},...I.map(E=>{var D;return(D=E.sides)==null?void 0:D.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),P=v.map(E=>{let D=U==null?void 0:U[E.participantId],R=T[E.drawPosition];return pt({...E,participant:o?st(D,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:ZRe,type:mH,availableAssignments:P}}:{}}function yH(t){var W;let e=Lt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,u=t.tournamentParticipants??(a&&Bn({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],c=Dt({structureId:t.structureId,drawDefinition:o});if(c.error)return c;let d=c.containingStructure||c.structure;if(!d)return{error:Sn};let p=d.structureId;if(c=dD({drawDefinition:o,structureId:p}),s===void 0&&!c.isAdHoc)return{error:u0};if(c.isAdHoc)return A_(t);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:m,byeDrawPositions:g}=c,v=mi({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=lre({actionType:dR,appliedPolicies:v,drawDefinition:o,structure:d}),T=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=k2({finishingPosition:U0,targetRoundNumber:1,linkType:wp,drawDefinition:o,structureId:p})||{},S;w!=null&&w.length&&(S=w.reduce((Y,Z)=>rh({structureId:Z,drawDefinition:o})&&Y,!0));let U=w.length,P=w.length&&!S,{policyActions:E}=ure({enabledStructures:b,drawDefinition:o,structure:d}),D=![gt,it].includes(d.stage)||d.stageSequence!==1,{drawId:R}=o,N=[],{assignedPositions:M,positionAssignments:A}=_r({structure:d}),_=M==null?void 0:M.find(Y=>Y.drawPosition===s);if(!((W=A==null?void 0:A.map(Y=>Y.drawPosition))!=null&&W.includes(s)))return{error:l0};let{stage:k,stageSequence:B}=d,F=[k];k===pa&&F.push(it),k===it&&F.push(pa);let x=qy({entryStatuses:Tg,provisionalPositioning:r,drawDefinition:o,stageSequence:B,structureId:p,stages:F}),$=Pg({drawDefinition:o,stages:F}).assignedParticipantIds??[],j=x.filter(Y=>!$.includes(Y.participantId)).map(Y=>Y.participantId),V=g.includes(s),H=m.includes(s);if(I)return{hasPositionAssigned:!!_,info:"Actions Disabled for structure",isActiveDrawPosition:H,isDrawPosition:!0,validActions:[],isByePosition:V};if(So({policyActions:E,action:ey})&&!H&&A&&!P&&(!_||V)){let{validAssignmentActions:Y}=cMe({positionSourceStructureIds:w,unassignedParticipantIds:j,possiblyDisablingAction:D,isWinRatioFedStructure:U,tournamentParticipants:u,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,event:l});Y==null||Y.forEach(Z=>N.push(Z))}if(So({policyActions:E,action:N_})){let{validAssignmentActions:Y}=pMe({drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:R});Y==null||Y.forEach(Z=>N.push(Z))}let{participantId:z}=_||{},q=z&&u.find(Y=>Y.participantId===z);if(_){So({policyActions:E,action:O2})&&!H&&(N.push({type:O2,method:G7,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:D}),V||N.push({type:fH,method:WRe,payload:{drawId:R,structureId:p,drawPosition:s},willDisableLinks:D}),So({policyActions:E,action:DM})&&!V&&N.push({type:DM,method:G7,payload:{drawId:R,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:D}));let Y=d.stage===gt||d.stage===it&&d.stageSequence===1;if(!V&&z7({activePositionOverrides:T,activeDrawPositions:m,action:Uv})&&So({policyActions:E,action:Uv})&&IM({drawDefinition:o,structureId:p,drawPosition:s})&&Y){let{seedAssignments:Z}=tl({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:X,seedValue:Q}=(Z==null?void 0:Z.find(ce=>ce.participantId===z))??{};N.push({type:Uv,method:tMe,participant:q,seedNumber:X,payload:{drawId:R,structureId:p,participantId:z,seedValue:Q}})}if(!V&&z7({activePositionOverrides:T,activeDrawPositions:m,action:ET})&&So({policyActions:E,action:ET})&&IM({drawDefinition:o,structureId:p,drawPosition:s})&&Y){let{seedAssignments:Z}=tl({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:X}=(Z==null?void 0:Z.find(Q=>Q.participantId===z))??{};N.push({method:QRe,type:ET,participant:q,seedNumber:X,payload:{participantId:z,structureId:p,drawId:R}})}if(!V&&z){if(So({policyActions:E,action:ty})){let Z={type:ty,method:ore,participant:q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};N.push(Z)}if(So({policyActions:E,action:TU})){let Z={type:TU,method:JRe,participant:q,payload:{participantId:z,otherName:void 0}};N.push(Z)}}if(So({policyActions:E,action:mH})){let{validSwapAction:Z}=fMe({possiblyDisablingAction:D,tournamentParticipants:u,inactiveDrawPositions:h,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,structure:d,drawId:R});Z&&N.push(Z)}}if(So({policyActions:E,action:pH})&&!P){let{validAlternatesAction:Y}=oMe({possiblyDisablingAction:D,tournamentParticipants:u,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:R,event:l});Y&&N.push(Y)}if(So({policyActions:E,action:hH})&&!P&&A){let{validLuckyLosersAction:Y}=uMe({sourceStructuresComplete:S,possiblyDisablingAction:D,isWinRatioFedStructure:U,tournamentParticipants:u,activeDrawPositions:m,positionAssignments:A,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:R});Y&&N.push(Y)}if((q==null?void 0:q.participantType)===Ot&&So({policyActions:E,action:dH})){let{validModifyAssignedPairAction:Y}=iMe({tournamentParticipants:u,returnParticipants:n,drawPosition:s,participant:q,drawId:R,event:l});Y&&N.push(Y)}return{hasPositionAssigned:!!_,isActiveDrawPosition:H,isDrawPosition:!0,isByePosition:V,validActions:N,...re}}function MD({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let n=(a=t==null?void 0:t[cM])==null?void 0:a.drawTypeCoercion,r=(o=e==null?void 0:e[cM])==null?void 0:o.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??!0}function UU({tournamentRecord:t,drawDefinition:e,stage:i=it,structureId:n,structure:r}){var s;if(!t)return{error:Fe};if(!r&&!e)return{error:ot};if(!r&&!n&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:Is};let{error:a,positionAssignments:o}=Gi({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:o??[],structureId:r==null?void 0:r.structureId,error:a}}function bH({structureId:t,drawDefinition:e}){if(!e)return{error:ot};if(!zn(t))return{error:we};let i=R0({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Ln([Vm,Cl,e_,$m],n).length;return{...re,valid:r}}function yre({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:we};let i=m0(t);return i?{drawSize:i}:le({result:{error:we},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function ND(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Kp({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return le({result:h,stack:l});i=h.policyDefinitions}let c=Nt(u);if(u&&!c)return le({result:{error:we},context:{participantsCount:u},stack:l});if(r&&!c)return le({result:{error:gee},stack:l});if(isNaN(n))if(u)({drawSize:n}=yre({participantsCount:u}));else return le({result:{error:k1},stack:l});let d=r&&u||n;if(d&&d>n)return{error:JV};let p=i==null?void 0:i[Ul];if(!p)return{error:aee};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=n:n===h.drawSize).reduce((h,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:HQ}}function __({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var v;if((!o||!r)&&i&&({participants:o,participantMap:r}=Bn({tournamentRecord:i})),!o)return{error:x1};if(!Array.isArray(o))return{error:we};if(!s)return{error:ji};let l=(e==null?void 0:e[Br])??(n==null?void 0:n[Br])??A0[Br],u=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:c,gender:d}=s,p=c===Xf,f=c===Xs&&Fi||p&&Ot||Qt,h=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),m=Object.keys(h),g=o.filter(y=>m.includes(y.participantId)).filter(y=>{let b=hMe({participant:y,participantType:f,eventType:c,entryStatusMap:h}),I=mMe({genderEnforced:u,participantMap:r,eventGender:d,participant:y,isDoubles:p,mismatch:b});return b||!I});if(g.length){let y=g.map(b=>b.participantId);return{error:QQ,invalidParticipantIds:y}}return{...re,valid:!0}}function hMe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[Xf,Xs].includes(i)&&t.participantType===Qt&&(mm(r)||r===Sd);return t.participantType!==e&&!a}function mMe(t){var d,p,f;let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:a,genderEnforced:o}=t,s=!r&&a&&Vt(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(h=>{var m,g,v;return(v=(g=(m=i==null?void 0:i[h])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!n||!(s!=null&&s.length)||Lu===n||[zi,pn].includes(n)&&s[0]===n||Po===n&&(s.length==1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),u=(f=e==null?void 0:e.person)==null?void 0:f.sex,c=!(e!=null&&e.person)||!n||[Lu,Po].includes(n)||[zi,pn].includes(n)&&u===n;return!o||l&&c}function bre({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var m;let a="generateQualifyingSTructures",o=[],s=[],l=[],u=(g,v)=>g.stageSequence-v.stageSequence,c=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,f,h=1;for(let g of t.sort(c)){let v=g.structureProfiles||[];h=g.roundTarget||h;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(u)){let U=uj(S.drawSize||S.participantsCount),{qualifyingRoundNumber:P,structureOptions:E,matchUpFormat:D,structureName:R,structureId:N,drawType:M}=S,A=S.matchUpType,_=S.qualifyingPositions||gMe({drawSize:U,qualifyingRoundNumber:P}),k,B,F;if(!Nt(U))return le({result:{error:k1},stack:a});let x=t.length>1?`${h}-`:"",$=v.length>1||x?y:"",j=R||(x||$?`${ua(gt)} ${x}${$}`:ua(gt));if(M===jl){let{structures:V,groupCount:H,maxRoundNumber:z}=mD({structureName:S.structureName||j,structureId:N||(r==null?void 0:r.pop()),stage:gt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:h,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=H,k=z,B=V[0],f=[1]}else({drawSize:U,matchUps:F,roundLimit:k}=yc({qualifyingRoundNumber:P,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),B=Fs({structureName:S.structureName||j,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:k,stage:gt,matchUpFormat:D,stageSequence:y,matchUpType:A,roundLimit:k,matchUps:F}),h&&fi({extension:{name:Mc,value:h},element:B}),b=((m=F==null?void 0:F.filter(V=>V.roundNumber===k))==null?void 0:m.length)||0;if(y>1){let{link:V}=ID({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:B.structureId,finishingPositions:w===wp?[1]:void 0,linkType:w});l.push(V),d+=(U||0)-b}else d+=U||0;w=M===jl?wp:Sp,T=B.structureId,I=k,s.push(B),y+=1}p+=b,o.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:f,roundTarget:h,linkType:w}),h+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...re,links:l}}function gMe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function Ire(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=St(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&ac||t.drawType||ac,a=xte.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=ac;else if(n<4&&i)return{...le({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:RA},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function vMe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:ua(it),...t,stage:it},{structures:a,groupCount:o,groupSize:s}=mD(r);if(o<1)return{error:kee};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:ua(Nn)}],[u]=a,{structures:c,links:d}=Nne({sourceStructureId:u.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...re,structures:a,links:d}}function yMe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),r=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=n.map((u,c)=>{let d=n.indexOf(u)%2?Cl:Vm,p=1+c;return{linkType:yd,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:Sp,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Cl,roundNumber:r,structureId:t.structureId}},l=[{linkType:Sp,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Cl,roundNumber:1,structureId:i.structureId}},{linkType:yd,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Cl,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function bMe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=ah({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=zf({structureName:t||ua(it),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:it,matchUpType:e,matchUps:s});o.push(l);let u=n/2,{matchUps:c}=ah({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=zf({structureName:ua(Ote),matchUps:c,structureId:a==null?void 0:a.pop(),stage:pa,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=yc({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),f=zf({structureName:ua(kte),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Nn,matchUpType:e});o.push(f);let h=yMe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:o,links:h,...re}}function IMe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!Nt(o)||o<2)return{matchUps:[],roundsCount:0};if(xu(o))return yc(t);let u=wMe(o),c=u.shift(),d=Xe(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=TM({roundNumber:f,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Xe(1,v+1);n&&v===n&&(h=f-1);let b=y.map(I=>{let T=KG({roundPosition:I,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:f,matchUpId:T}});p.push(...b),f++}let m=f-1;return p=uD({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function wMe(t){let e=St(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function wre(t){var f,h;let{playoffAttributes:e,stageSequence:i=1,stage:n=it,matchUpType:r,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),u=t.appliedPolicies??mi(t),c=((f=t.policyDefinitions)==null?void 0:f[XI])||(u==null?void 0:u[XI]);t.skipRounds=t.skipRounds||a<=4&&(c!=null&&c.feedFromMainFinal?0:1)||0;let d=t.structureName??((h=e==null?void 0:e["0"])==null?void 0:h.name)??ua(it),p=()=>{let{matchUps:m}=yc(t);return{structures:[Fs({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...re}};return{generators:{[el]:()=>({structures:[Fs({finishingPosition:U0,stageSequence:i,structureName:d,matchUps:[],matchUpType:r,structureId:l,stage:n})],links:[],...re}),[bg]:()=>{let{matchUps:m}=IMe(t);return{structures:[Fs({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...re}},[ac]:()=>p(),[H1]:()=>bMe(t),[QI]:()=>NI({...t,roundOffsetLimit:3,playoffAttributes:e??Kj}),[ew]:()=>NI({...t,roundOffsetLimit:2,playoffAttributes:e??Yj}),[Nn]:()=>NI(t),[T0]:()=>{let{matchUps:m}=ah({drawSize:a,uuids:o,matchUpType:r});return{structures:[Fs({stageSequence:i,structureName:d,matchUpType:r,structureId:l,stage:it,matchUps:m})],links:[],...re}},[z1]:()=>Cne(t),[tw]:()=>ov({...t,feedRounds:1,fmlc:!0}),[_te]:()=>ov({...t,feedRounds:1}),[zj]:()=>ov({...t,feedsFromFinal:1}),[qj]:()=>ov({...t,feedsFromFinal:2}),[Wj]:()=>ov({...t,feedsFromFinal:3}),[q1]:()=>ov(t),[t_]:()=>Mne(t),[jl]:()=>mD(t),[Id]:()=>vMe(t)}}}function IH(t){var j,V,H,z,q;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,staggeredEntry:r,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},u=St(t.drawSize),c=t.drawTypeCoercion??MD({appliedPolicies:n,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=Ire({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:c,drawSize:u});if(p.error)return p;let f=p.drawType,h=[],m=[],g=(t==null?void 0:t.matchUpType)??sn,v=(j=a==null?void 0:a.structures)==null?void 0:j.filter(({stage:W})=>W===gt);v&&h.push(...v);let y=v==null?void 0:v.map(({structureId:W})=>W),b=(V=a==null?void 0:a.structures)==null?void 0:V.find(({stage:W,stageSequence:Y})=>W===it&&Y===1),I=(H=a==null?void 0:a.links)==null?void 0:H.filter(W=>W.target.structureId===(b==null?void 0:b.structureId)&&(y==null?void 0:y.includes(W.source.structureId))),T=(W,Y)=>{var Z;if(W.linkType===wp&&(Y!=null&&Y.structures)){let X=W.source.finishingPositions||[];return Y.structures.length*X.length}else if(W.linkType===Sp&&((Z=Y==null?void 0:Y.matchUps)!=null&&Z.length)){let X=W.source.roundNumber;return Y.matchUps.filter(({roundNumber:Q})=>Q===X).length}},w=v==null?void 0:v.map(W=>{var J,ee,ne;let Y=I==null?void 0:I.find(ie=>ie.target.structureId===W.structureId),Z=((ee=(J=Gi({structure:W}))==null?void 0:J.positionAssignments)==null?void 0:ee.length)??0;if(!Y)return Z;let X=Y==null?void 0:Y.source.structureId,Q=(ne=a.structures)==null?void 0:ne.find(ie=>ie.structureId===X),ce=T(Y,Q)||0;return Z-ce}).filter(Boolean).reduce((W,Y)=>W+Y,0),S=I==null?void 0:I.map(W=>{let Y=W.source.structureId,Z=v==null?void 0:v.find(X=>X.structureId===Y);return T(W,Z)}).filter(Boolean).reduce((W,Y)=>W+Y,0),U=!!(b&&!((z=b==null?void 0:b.matchUps)!=null&&z.length));if(v!=null&&v.length&&!U)return{error:g2};let P=!(v!=null&&v.length)&&t.qualifyingProfiles,E=(P==null?void 0:P.length)&&bre({idPrefix:t.idPrefix,qualifyingProfiles:P,appliedPolicies:n,isMock:s,uuids:l});if(E!=null&&E.error)return E;let{qualifyingDrawPositionsCount:D,qualifyingDetails:R,qualifiersCount:N}=E||{qualifyingDrawPositionsCount:w,qualifiersCount:S};D&&(E!=null&&E.structures&&h.push(...E.structures),E!=null&&E.links&&m.push(...E.links)),Object.assign(t,pt({drawSize:u,matchUpType:g,tieFormat:o}));let M=f!==el&&(!u||u<2||!r&&![T0,bg].includes(f)&&([Id,jl].includes(f)&&u<3||![jl,Id].includes(f)&&!xu(u)));if(M&&!D)return le({context:{drawSize:u,invalidDrawSize:M},result:{error:RA},stack:d});let{generators:A,error:_}=wre(t);if(_)return{error:_};let k=A[f];if(!k)return{error:LV};let B=k==null?void 0:k();if(B.error)return B;let{structures:F,links:x}=B;if(F!=null&&F.length){let W=F.find(({stage:Y,stageSequence:Z})=>Y===it&&Z===1);if(b&&W){if(U){let Y=W.structureId;if(W.structureId=b.structureId,x==null?void 0:x.length)for(let Z of x)Z.source.structureId===Y&&(Z.source.structureId=b.structureId),Z.target.structureId===Y&&(Z.target.structureId=b.structureId)}else if(!i)return{error:g2}}h.push(...F)}h.sort(Gy),x!=null&&x.length&&m.push(...x);let $=B.structures.find(({stage:W,stageSequence:Y})=>W===it&&Y===1);for(let W of R||[]){let{finalQualifyingRoundNumber:Y,finalQualifyingStructureId:Z,roundTarget:X,finishingPositions:Q,linkType:ce}=W,J=$&&((q=ID({targetStructureId:$.structureId,sourceStructureId:Z,sourceRoundNumber:Y,finishingPositions:Q,targetEntryRound:X,linkType:ce}))==null?void 0:q.link);if(J!=null&&J.error)return J;J&&m.push(J)}return I&&m.push(...I),{...re,qualifyingResult:{qualifyingDrawPositionsCount:D,qualifiersCount:N},structures:h,links:m}}function wH(t){var b,I;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return le({result:{error:ot},stack:r});let a=e?t.drawDefinition:st(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let T=Mo({tieFormat:o});if(T.error)return T}o=ra(o??((b=Aa({drawDefinition:a}))==null?void 0:b.tieFormat)),s=s??(a.matchUpType||sn),t.tieFormat=o,t.matchUpType=s;let l=bM({drawDefinition:a,stage:it});t.drawSize=t.drawSize??l,!l&&t.drawSize&&SM({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:it});let u=ga({drawDefinition:a}).drawMatchUps.map(Nr),c=IH(t);if(c.error)return le({result:c,stack:r});let{structures:d,links:p,qualifyingResult:f}=c;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!bM({stage:gt,drawDefinition:a})){let T=SM({drawSize:f.qualifyingDrawPositionsCount,stage:gt,drawDefinition:a});if(T.error)return T}if(h){let T=Sne({qualifiersCount:h,drawDefinition:a,stage:it});if(T.error)return T}let m=t.drawSize??l;Object.assign(t,pt({drawSize:m,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=pr({drawDefinition:a});o&&(g==null||g.forEach(T=>{if(!u.includes(T.matchUpId)){let{tieMatchUps:w}=SD({tieFormat:o,matchUp:T,isMock:n});Object.assign(T,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=Wm({drawDefinition:a,matchUpsMap:v});return Ji({tournamentId:(I=t.tournamentRecord)==null?void 0:I.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...re,structures:d,matchUps:g,links:p}}function AD(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!Tre({scaleItem:r}))return{error:L1};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=Ure({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=sl();l.includes(fa)&&jt({topic:fa,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...re,info:oj,existingValue:r==null?void 0:r.scaleValue}||o&&{...re,newValue:r==null?void 0:r.scaleValue}||{error:_n}}function Sre(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:a}=t;if(!n)return{error:Fe};if(!n.participants)return{error:x1};let o=0,s={},l=[];for(let p of e){let f=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(Tre({scaleItem:h}))Array.isArray(s[f])||(s[f]=[]),s[f].push(h);else return{error:L1}}n.participants.forEach(p=>{let{participantId:f}=p||{};Array.isArray(s[f])&&s[f].forEach(h=>{Ure({participant:p,scaleItem:h,removePriorValues:i}),l.push(p),o++})});let u=o?void 0:h0,{topics:c}=sl();if(c.includes(fa)&&o&&jt({topic:fa,payload:{tournamentId:n.tournamentId,participants:l}}),a){let{eventId:p,drawId:f,...h}=a,m=((d=h.scaleAttributes)==null?void 0:d.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:Xj,itemValue:h};if(m&&(g.itemSubTypes=m),f||p){let{drawDefinition:v,event:y}=ho({tournamentRecord:n,eventId:p,drawId:f});f&&WG({drawDefinition:v,timeItem:g}),p&&tb({event:y,timeItem:g})}else eb({tournamentRecord:n,timeItem:g})}}return r&&c.includes(iw)&&jt({topic:iw,payload:r}),pt({...re,modificationsApplied:o,info:u})}function Tre({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function Ure({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Oy};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(u=>n.includes(u)&&i[u]).length!==r.length)return{error:L1};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=nd({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[Lm,u,c,d].join("."),f=pt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...re,valueChanged:l,newValue:i.scaleValue}}function SH(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:n}=t,r=Lt(t,[{[as]:!0},{modifiedScaleValues:!0,[ul]:us}]);if(r.error)return r;for(let a in i){let o=AD({scaleItem:i[a],removePriorValues:n,tournamentRecord:e,participantId:a});if(o.error)return o}return{...re}}function sw(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:cr};let{participant:a,tournamentId:o}=Nh({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...nd({participant:a,scaleAttributes:i}),tournamentId:o}:{error:_n}}var SMe=(t=0)=>250/Math.pow(t+5,.4),TMe=()=>1;function UMe(t=3,e=2){let i=t/e;return isNaN(i)?pI.kDefault():i}var pI={nSpread:400,diffThreshold:.125,kCalc:SMe,kMultiplier:UMe,kDefault:TMe};function Dre(t){let{winnerRating:e,loserRating:i}=t,{ratings:n=Cr,winnerCountables:r=1,loserCountables:a=0,ratingType:o=El,maxCountables:s,countables:l}=t||{},u=n==null?void 0:n[o];if(!u)return{error:ht};let c=u.range||t.ratingRange;e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=c[0]>c[1],p=u.decimalsCount||0,f=d?c.slice().reverse():c,h=(_,k)=>parseFloat(k)>=Math.min(..._)&&parseFloat(k)<=Math.max(..._);(!h(c,e)||!h(c,i))&&(h(c,e)||(e=u.defaultInitialization),h(c,i)||(i=u.defaultInitialization));let m=SI({targetRange:Cr[El].range,sourceRange:f,value:d?c[0]-e:e}),g=SI({targetRange:Cr[El].range,sourceRange:f,value:d?c[0]-i:i}),v=(_,k)=>1/(1+Math.pow(10,(k-_)/pI.nSpread)),y=v(m,g),b=v(g,m),I=pI.kCalc(r),T=pI.kCalc(a),w=pI.kMultiplier(s,l),S=m+w*I*(1-y),U=g+w*T*(0-b),P=SI({sourceRange:Cr[El].range,value:S,targetRange:f}),E=SI({sourceRange:Cr[El].range,value:U,targetRange:f}),D=d?c[0]-P:P,R=parseFloat(D.toFixed(p)),N=d?c[0]-E:E,M=parseFloat(N.toFixed(p)),A=Math.max(...c)?Math.abs(e-i)/Math.max(...c):0;return(P>E&&A>pI.diffThreshold||R<0||M<0)&&(R=e,M=i),{newWinnerRating:R,newLoserRating:M}}var DMe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function Pre(t){var y,b;let e=Lt(t,[{[as]:!0},{matchUpIds:!0,[ul]:uo,[up]:Ay},{ratingType:!1,[ks]:I=>Cr[I]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:n=!0,tournamentRecord:r,ratingType:a=El,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:u,asDynamic:c}=t,d=Cr[a],{accessor:p}=d,f={},h=(t.matchUps||o&&za({drawDefinition:l,tournamentRecord:r,inContext:!0,matchUpFilters:{matchUpStatuses:dr}}).matchUps||Wr({matchUpFilters:{matchUpIds:u,matchUpStatuses:dr},tournamentRecord:r,inContext:!0}).matchUps)??[],m=`${a}.${Dj}`,g=c?m:a;h.sort(Yy);for(let I of h){let{endDate:T,matchUpFormat:w,score:S,sides:U,winningSide:P}=I,E=I.matchUpType,D={eventType:E,scaleName:a,scaleType:Gf},R={scaleName:m,eventType:E,scaleType:Gf},N=Object.assign({},...(U??[]).map(j=>{let{sideNumber:V,participant:H}=j;return V&&{[V]:[H==null?void 0:H.participantId,...(H==null?void 0:H.individualParticipantIds)??[]].filter(Boolean).flat()}})),M=Object.assign({},...Object.values(N).flat().map(j=>{let V=f[j],H=!o||V?sw({scaleAttributes:R,tournamentRecord:r,participantId:j}).scaleItem:void 0,z=sw({tournamentRecord:r,scaleAttributes:D,participantId:j}).scaleItem,q=p?{[p]:void 0}:void 0;return j&&{[j]:H??z??{scaleName:g,eventType:E,scaleDate:T,scaleType:Gf,scaleValue:q}}})),A=w?yo(w):{},_=(A==null?void 0:A.bestOf)||1,k=(A==null?void 0:A.setsTo)||1,B=s?_&k:_,F=(S==null?void 0:S.sets)&&DMe(S.sets)||P===1&&[1,0]||[0,1],x=P?N[P]:[],$=P?N[3-P]:[];for(let j of x){let V=(y=M[j])==null?void 0:y.scaleValue,H=typeof V=="object"?V[p]:V;for(let z of $){let q=(b=M[z])==null?void 0:b.scaleValue,W=typeof q=="object"?q[p]:q,Y=P?F[P]:[0,0],Z=P?F[3-P]:[0,0],{newWinnerRating:X,newLoserRating:Q}=Dre({winnerCountables:Y,loserCountables:Z,maxCountables:B,winnerRating:H,loserRating:W,ratingType:a}),ce=p?{...V,[p]:X}:X,J=p?{...q,[p]:Q}:Q;M[j].scaleValue=ce,M[z].scaleValue=J,M[j].scaleName=g,M[z].scaleName=g}}Object.assign(f,M),i&&SH({tournamentRecord:r,modifiedScaleValues:f,removePriorValues:n})}let v=h.map(({matchUpId:I})=>I);return{...re,modifiedScaleValues:f,outputScaleName:g,processedMatchUpIds:v}}function k_(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:a,event:o}=t;if(typeof i!="object")return{error:ot};let{participantIdPairings:s,matchUpsCount:l}=t,u=M_(t);if(u.error)return le({result:u});let{lastRoundNumber:c,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return le({result:{error:we,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!Nt(l)||e&&!Array.isArray(e)||!s&&!l)return{error:we,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:we,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(c||0))return{error:we,info:"roundNumber error"};let f=n??(r&&(c??0)+1||c||1);s=s??Xe(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=v=>{if(!t.idPrefix)return;let y=i.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${f}-${v}`},m=s==null?void 0:s.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>pt({sideNumber:S+1,participantId:w})),T=e[y]??h(y)??Mi();return{roundNumber:f,matchUpStatus:Fn,matchUpId:T,sides:I}});if(m!=null&&m.length){let v=(g=Aa({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&m.forEach(y=>{let{tieMatchUps:b}=SD({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:b,matchUpType:Zi})})}return{roundNumber:f,matchUpsCount:(m==null?void 0:m.length)??0,matchUps:m,...re}}function PMe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=W7({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[EL(l)];s.push(l);let c=l.value,d=l,p=0,f=0,h=o.length,m;do h-=1,m=o.length*i[o[0]].length;while(m>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(b=>{f+=1;let I=Dv(y,b.opponent);if(!g.includes(I)){let T=W7({stipulated:[[y,b.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(EL(T))){u.push(EL(T)),s.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<c||S===c&&Math.round(Math.random()))&&(c=S),g.push(I),p+=1}}}),s=s.filter(b=>Math.abs(b.value-c)<5)}),s.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Vo(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:v}}function EL(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function W7({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=Dv(p,f),m=i[h];s.push({participantIds:d,value:m}),l+=i[h]}),zr(t,a).map(d=>Ga(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>o.includes(h)||f,!1)){o.push(...p);let f=d.value;l+=f,s.push({participantIds:p,value:f})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[f,h]=p.participantIds,m=Dv(f,h),g=n[m];return g>d?g:d},0),c=s.reduce((d,p)=>{let[f,h]=p.participantIds,m=Dv(f,h),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function Dv(t,e){return[t,e].sort(g_).join("|")}function Ere({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=Dv(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function EMe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Jt);if(n.length===2){let[r,a]=n,o=Dv(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function CMe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=Dv(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var RMe=0;function MMe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var o;let a=((o=Cr[n])==null?void 0:o.defaultInitialization)??RMe;return r.split("|").map(s=>{var l;if(i===Zs){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||a):a*2}else return e[s]||a})}function NMe(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:c,salted:d}=t;r.forEach(b=>{let I=MMe({tournamentParticipants:e,adHocRatings:i,scaleName:c,eventType:u,pairing:b}),T=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?T:T*-1)||0,S=Math.abs(I[0]-I[1])+w,U=Math.abs(I[0]-I[1]);s[b]=U,l[b]||(l[b]=0),l[b]+=S?Math.pow(S,2):0});let p=r.map(b=>({pairing:b,value:l[b]})).sort((b,I)=>b.value-I.value),{pairingValues:f}=CMe({possiblePairings:n,valueObjects:l}),{candidate:h,candidatesCount:m,deltaCandidate:g,iterations:v}=PMe({valueSortedPairings:p,maxIterations:a,pairingValues:f,deltaObjects:s,valueObjects:l}),{participantIdPairings:y}=o?g:h;return{participantIdPairings:y,candidatesCount:m,deltaCandidate:g,iterations:v,candidate:h}}var AMe=100,_Me=100,kMe=4e3;function TH(t){var q,W;let{encounterValue:e=AMe,sameTeamValue:i=_Me,maxIterations:n=kMe,updateParticipantRatings:r,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:u,refreshDynamic:c,participantIds:d,drawDefinition:p,roundNumber:f,structureId:h,matchUpIds:m,eventType:g,scaleName:v,idPrefix:y,isMock:b,salted:I,event:T}=t;if(!p)return{error:ot};if(!t.structure&&!h)return{error:Sn};let w=t.structure||Dt({drawDefinition:p,structureId:h}).structure;if(!Ii(w))return{error:Uh};if(!(d!=null&&d.length))return{error:Dh};let S=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:U}=EMe({matchUps:S}),P=(l==null?void 0:l.participants)??[],E={};if(u){let Y=Vt(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:X})=>X):[]),Z=Math.max(...Y,0);if(Z){let X=(q=w==null?void 0:w.matchUps)==null?void 0:q.filter(({roundNumber:ce})=>ce===Z).map(({matchUpId:ce})=>ce),Q=Pre({ratingType:v??((W=T==null?void 0:T.category)==null?void 0:W.ratingType),updateParticipantRatings:r,tournamentRecord:l,asDynamic:!0,refreshDynamic:c,drawDefinition:p,matchUpIds:X});if(Q.error)return Q;Q.modifiedScaleValues&&(E=Q.modifiedScaleValues)}}let{valueObjects:D}=OMe({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:U}),{uniquePairings:R,possiblePairings:N,deltaObjects:M}=Ere({participantIds:d}),A=Object.values(E).length?E:t.adHocRatings,_={tournamentParticipants:P,possiblePairings:N,participantIds:d,uniquePairings:R,drawDefinition:p,maxIterations:n,adHocRatings:A,deltaObjects:M,valueObjects:D,eventType:g,scaleName:v,structure:w,salted:I},{candidatesCount:k,participantIdPairings:B,deltaCandidate:F,iterations:x,candidate:$}=NMe(_);if(!k)return{error:xA};let j,V;if(a){let Y=k_({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:B,newRound:!0,drawDefinition:p,roundNumber:f,matchUpIds:m,idPrefix:y,isMock:b,event:T});if(Y.error)return Y;j=Y.roundNumber,V=Y.matchUps}let{maxDelta:H,maxDiff:z}=$;return{roundNumber:j,participantIdPairings:B,modifiedScaleValues:E,candidatesCount:k,deltaCandidate:F,...re,iterations:x,matchUps:V,maxDelta:H,maxDiff:z}}function OMe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Fi);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=Ere({participantIds:s});for(let u of l)r[u]||(r[u]=0),r[u]+=n}return{valueObjects:r}}function Cre(t){var D,R,N,M;let{drawType:e=ac,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:u}=t,c=t==null?void 0:t.drawDefinition;if(!c)return{error:ot};let d=$r,p=qy({stageSequence:1,drawDefinition:c,stage:d}),f=[jl,H1,Id].includes(e)?p.length:m0(p.length);if(!a&&e===T0&&p.length<2||e===jl&&p.length<3)return{error:RA};let{tieFormat:h,matchUpType:m}=t;if(h){let A=Mo({tieFormat:h});if(A.error)return A}h=ra(h??((D=Aa({drawDefinition:c}))==null?void 0:D.tieFormat)),m=m??c.matchUpType??sn;let{structures:g}=wd({stageSequence:1,drawDefinition:c,stage:d});if(g.length>1)return{error:eee};if((N=(R=g==null?void 0:g[0])==null?void 0:R.matchUps)!=null&&N.length)return{error:lj};let v=(M=g==null?void 0:g[0])==null?void 0:M.structureId;Object.assign(t,pt({structureName:t.structureName??ua($r),structureId:v,matchUpType:m,tieFormat:h,drawSize:f,stage:d}));let y=wre(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:LV};let I=b==null?void 0:b();if(I.error)return I;let{structures:T,links:w}=I,S=T.map(A=>Ei({structure:A}).matchUps).flat();h&&S.forEach(A=>{let{tieMatchUps:_}=SD({matchUp:A,tieFormat:h,isMock:l});Object.assign(A,{tieMatchUps:_,matchUpType:m})}),(!n||!i)&&(c=st(c,!1,!0)),c.links||(c.links=[]),w.length&&c.links.push(...w);let U=T.map(({structureId:A})=>A);c.structures||(c.structures=[]);let P=c.structures.map(({structureId:A})=>A);c.structures=c.structures.map(A=>U.includes(A.structureId)?T.find(({structureId:_})=>_===A.structureId):A);let E=T.filter(({structureId:A})=>!P.includes(A));return E.length&&c.structures.push(...E),o&&yD({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:c,structureId:v,placeByes:s,drawSize:f,event:u}),i&&Ji({drawDefinition:c}),{links:w,structures:T,...re}}var Mm={};Kt(Mm,{addGame:()=>xre,addPoint:()=>Ore,addSet:()=>Fre,addShot:()=>Lre,analyzeScore:()=>MH,analyzeSet:()=>PU,calculateHistoryScore:()=>Are,checkScoreHasValue:()=>Kr,checkSetIsComplete:()=>L_,clearHistory:()=>kre,generate:()=>Rre,generateScoreString:()=>ad,generateTieMatchUpScore:()=>ED,getSetComplement:()=>AH,getTiebreakComplement:()=>V_,helpers:()=>jre,isValidMatchUpFormat:()=>Zo,keyValueScore:()=>fae,mutate:()=>Nre,parseMatchUpFormat:()=>yo,parseScoreString:()=>RM,query:()=>yae,redo:()=>Bre,reverseScore:()=>Mre,setServingSide:()=>_re,stringifyMatchUpFormat:()=>D_,tidyScore:()=>vae,umo:()=>Vre,undo:()=>$re,validateScore:()=>NH,validateTieFormat:()=>Mo});var Rre={};Kt(Rre,{generateScoreString:()=>ad,generateTieMatchUpScore:()=>ED,reverseScore:()=>Mre});function ad(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:ht,info:"missing sets"};let u=a&&yo(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},f=n||!(!e||!s||s===1),h=i?xMe({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(LMe).map(g).filter(Boolean).join(" "))||"";if(!h)return m;if(s===2)return`${h} ${m}`;return`${m} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,b=k=>Dn(k==null?void 0:k.side1Score)||Dn(k==null?void 0:k.side2Score),I=k=>Dn(k==null?void 0:k.side1TiebreakScore)||Dn(k==null?void 0:k.side2TiebreakScore),T=(y==null?void 0:y.tiebreakSet)||!b(v)&&I(v),{side1Score:w,side2Score:S,side1TiebreakScore:U,side2TiebreakScore:P}=v,E=U||(Dn(U)||o?0:""),D=P||(Dn(P)||o?0:"");if(T)return`[${(f?[D,E]:[E,D]).join("-")}]`;let R=Math.min(E,D),N=R?`(${R})`:"",M=w||(Dn(w)||o?0:""),A=S||(Dn(S)||o?0:""),_=f?`${[A,M].join("-")}${N}`:`${[M,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function xMe({matchUpStatus:t}){let e={[ta]:"RET",[yi]:"WO",[br]:"DF/DF",[ir]:"WO/WO",[Mh]:"SUS",[Ro]:"ABN",[ai]:"DEF",[S0]:"DR"};return t&&e[t]||""}function LMe(t,e){return t.setNumber-e.setNumber}function Mre(t){if(!(t!=null&&t.score))return{error:ht};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return pt({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),n=ad({sets:i}),r=ad({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...re}}var Nre={};Kt(Nre,{addGame:()=>xre,addPoint:()=>Ore,addSet:()=>Fre,addShot:()=>Lre,calculateHistoryScore:()=>Are,clearHistory:()=>kre,redo:()=>Bre,setServingSide:()=>_re,umo:()=>Vre,undo:()=>$re});function Eg({matchUp:t}){let{extension:e}=$t({name:ZA,element:t});if(!e)return{error:Hr};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...re}}function Are(t){var E,D;if(!t)return{error:ht};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Eo};let n=((E=Eg({matchUp:e}))==null?void 0:E.history)||[];if(!Array.isArray(n))return{error:we,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:zV};if(!Zo({matchUpFormat:r}))return{error:HV};let a=yo(r),{bestOf:o,finalSetFormat:s,setFormat:l}=a,u=["0","15","30","40","A","G"],c={sets:[]},d=[],p,f=[0,0],h=1,m=0,g,v=0,y=R=>[1,2].includes(R),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),T=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=T(),S=I(),U=b(),P=0;for(let R of n){P+=1,g=c.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:M,setTo:A,NoAD:_,tiebbreakFormat:k}=N,B=U.side1Score===M&&U.side1Score===U.side2Score,F=!!N.tiebreakSet,x=F?N.tiebreakSet:k,{tiebreakTo:$,NoAD:j}=x||{},V=()=>{p=void 0,f=[0,0],h=3-h,U.side1TiebreakScore=0,U.side2TiebreakScore=0,U.side1PointScore="",U.side2PointScore="",v=0},H=W=>{U.winningSide=W;let{s:Y,...Z}=U;c.sets.push(Z),w=T(),S=I(),U=b(),V()},z=W=>{S.winningSide=W;let{g:Y,...Z}=S;U.games.push(Z),w=T(),S=I(),V();let X=`side${W}Score`;U[X]+=1},q=W=>{w.winningSide=W;let{p:Y,...Z}=w;S.points.push(Z),w=T(),v=0;let X=()=>f.reduce((ce,J)=>ce+J)%4/4>.5?h:3-h,Q=W-1;if(B||F){f[Q]+=1,p=X(),U[`side${W}TiebreakScore`]=f[Q],U[`side${3-W}TiebreakScore`]=f[1-Q];let ce=j?1:2;if(f[Q]>=$&&f[Q]>=f[1-Q]+ce)return z(W),{gameCompleted:!0}}else if(f[1-Q]===4&&f[Q]===3?f[1-Q]-=1:f[Q]+=1,U.side1PointScore=u[f[0]],U.side2PointScore=u[f[1]],f[Q]===5||f[Q]===4&&f[1-Q]<3||_&&f[Q]===4)return z(W),{gameCompleted:!0}};if(y(R.srv)&&(h=R.srv),["p","s","g","o"].includes(R.u)&&d.push(R.u),R.shotOutcome&&(w.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(v+=1),v===2)){let W=3-h;q(W)}if(y(R.p)||Nt(R.pointNumber)){let W=R.winningSide||R.p;if((D=q(W))!=null&&D.gameCompleted)continue}if(y(R.g)||Nt(R.gameNumber)){let W=R.winningSide||R.g;S.winningSide=W;let Y=`side${W}Score`,Z=`side${3-W}Score`;if(d.length&&(d.includes("p"),d=[]),z(W),U[Y]===A&&U[Y]-U[Z]>=(_?1:2)&&(H(W),g))break}if(y(R.s)||Nt(R.setNumber)){let W=R.winningSide||R.s;if(H(W),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return P!==n.length&&console.log({error:"Match completed with excess history"}),(U.side1Score||U.side2Score||U.games.length||U.side1TiebreakScore||U.side2TiebreakScore)&&c.sets.push(U),c.scoreStringSide1=ad({...c,matchUpFormat:r}),c.scoreStringSide2=ad({...c,matchUpFormat:r,reversed:!0}),h=p||h,i&&(e.score=c),{...re,servingSide:h,score:c}}function Cg({undoHistory:t,history:e,matchUp:i}){return fi({element:i,extension:{value:{history:e,undoHistory:t},name:ZA}})}function _re({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:YV};let{history:i=[]}=Eg({matchUp:t});return i.push({srv:e}),Cg({matchUp:t,history:i})}function kre({matchUp:t}){return Cg({matchUp:t})}function Ore({matchUp:t,point:e}){if(!e||!t)return{error:ht};if(typeof e!="object")return{error:we,context:{point:e}};let{history:i=[]}=Eg({matchUp:t});return i.push(e),Cg({matchUp:t,history:i})}function xre({matchUp:t,game:e}){if(typeof e!="object")return{error:we,context:{game:e}};let{history:i=[]}=Eg({matchUp:t});return i.push(e),Cg({matchUp:t,history:i})}function Lre({matchUp:t,shot:e}){if(typeof e!="object")return{error:ht};let{history:i=[]}=Eg({matchUp:t});return i.push(e),Cg({matchUp:t,history:i})}function Fre({matchUp:t,set:e}){if(typeof e!="object")return{error:ht};let{history:i=[]}=Eg({matchUp:t});return i.push(e),Cg({matchUp:t,history:i})}function Bre({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Eg({matchUp:t});return i.length&&e.push(i.pop()),Cg({matchUp:t,history:e,undoHistory:i})}function $re({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Eg({matchUp:t});return i.push(e.pop()),Cg({matchUp:t,history:e,undoHistory:i})}var Vre={},jre={};Kt(jre,{keyValueScore:()=>fae,parseMatchUpFormat:()=>yo,stringifyMatchUpFormat:()=>D_,tidyScore:()=>vae});var Pv=" ",H2="DEF",FMe="COMPLETED",Gre="WO",BMe="WO/WO",Hre="ABN",zre="SUS",qre="RET",Wre="INT",Kre=[qre,H2,Gre,BMe,Hre,zre,Wre],z2="DEFAULTED",Yre="WALKOVER",Zre="ABANDONED",Xre="SUSPENDED",Jre="RETIRED",Qre="INTERRUPTED",$Me=[Jre,z2,Yre],VMe="Enter Score",iy="()",Zm="[]",UH=["up","left","shift+tab"],DH=["enter","down","tab","right"],PM="backspace",eae="r",tae="s",iae="a",nae="d",rae="w",aae="i",O_=[eae,nae,rae,iae,tae,aae],x_="space",CL=["[","("],EM=[...UH,...DH,x_,"]"],oae="-",jMe="/",Ev=oae,od=oae,sae=[jMe],GMe=0,HMe=["=","+","num_1","num_2","shift+=","shift+-"],qc=["0","1","2","3","4","5","6","7","8","9"].concat(O_),lae=qc.map(t=>`shift+${t}`),PH=[Ev,PM].concat(EM,sae),uae=[qc,lae,PH].join(","),zMe=[uae,UH,DH,HMe].join(",");[].concat(...qc,...qc,...PH,...qc,...qc,...qc,...qc,...qc,...qc);var EH={OUTCOMEKEYS:O_,SIDE1KEYS:qc,SIDE2KEYS:lae,MODIFIERS:PH,PROMPT:VMe,MOVEUP:UH,MOVEDOWN:DH,HOTKEYS:zMe};function qb({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=cae({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Pv?Pv:"";return t+n+i}else return i+Pv+t}function cae({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Kre){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Pv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function q2({analysis:t,scoreString:e,sets:i,lowSide:n}){var m,g,v;let r,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=cae({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},u=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&u===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:c}=t.setFormat,{tiebreakTo:d,NoAD:p}=c||{},{isTiebreakEntry:f}=AI({brackets:Zm,scoreString:e}),h=WMe(e);if(h>=0){r=e.slice(0,h);let{isTiebreakEntry:y}=AI({brackets:iy,scoreString:r}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=AI({brackets:Zm,scoreString:r}),T=r&&r[r.length-1].trim(),w=r&&!isNaN(T),S=t.isIncompleteSetScore;if(f&&I){let U=r.slice(b+1).split(od),P=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,D=[P,E];if(E){let R=n===1?1:0;D[R]=((D==null?void 0:D[1-R])||0)+(p?1:2),(D[R]||0)<d&&(D[R]=d),r=e.slice(0,b+1),r+=D.join(od)}else P!==void 0?(r=e.slice(0,b+1),r+=P):(r=e.slice(0,b),S=!0);l.side1TiebreakScore=D[0]||0,l.side2TiebreakScore=D[1]||0}if(r.length||(r=void 0),S){let U=(m=l.side1Score)==null?void 0:m.toString();if(U){let P=U==null?void 0:U.slice(0,U.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(g=l.side2Score)==null?void 0:g.toString(),P=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);l.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=P==null?void 0:P.slice(0,P.length-1);l.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(f&&!I?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function AI({brackets:t=iy,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...rc(i,r)),o=Math.max(...rc(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function qMe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=Zm.split(""),a=t.split(""),o=Math.max(...rc(n,a)),s=Math.max(...rc(r,a)),l=Math.max(...rc(od,a));return i&&o>s&&l>o}function WMe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function dae(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function K7({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var l;let r=yo(t),{bestOf:a}=r,o=Math.ceil(a/2),s=((l=n==null?void 0:n.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return $Me.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function L_({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var y;if(!a)return{error:ht,info:"missing set"};e=e||i&&yo(i);let o=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:s,side2Score:l}=a,{setTo:u,tiebreakAt:c}=o,d=F_({set:a}),p=Math.abs(s-l),f=s>=u||l>=u,h=n||s>=u&&l>=u||c&&c<u&&(s===c||l===c),m=t||h&&(d===1&&a.side1TiebreakScore>a.side2TiebreakScore||d===2&&a.side2TiebreakScore>a.side1TiebreakScore),g=!h&&o.NoAD||h||n&&((y=o.tiebreakFormat)!=null&&y.NoAD)?1:2,v=p>=g;return!!((f&&(v||h)||n)&&(!h||m))}function F_({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function CH({analysis:t,set:e}){let i=F_({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return L_({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function KMe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=St(n);let{validSide2Score:o,requiresTiebreak:s}=YMe({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=CH({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=iy.split("")[0];e+=u}else t.isDecidingSet||(e+=Pv)}return{sets:i,scoreString:e,updated:r}}function YMe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,u;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?u=s===a&&i===r||s===r&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function pae({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===eae?n?(o=!0,n=qb({scoreString:n,lowSide:t,outcome:qre}),r=t===2?1:2,a=Jre):(o=!0,n=qb({scoreString:n,lowSide:t,outcome:H2}),r=t===2?1:2,a=z2):e===nae?(o=!0,n=qb({scoreString:n,lowSide:t,outcome:H2}),r=t===2?1:2,a=z2):e===rae?(o=!0,i=[],n=Gre,r=t===2?1:2,a=Yre):e===tae&&n?(o=!0,n=qb({scoreString:n,lowSide:t,outcome:zre}),a=Xre,r=void 0):e===iae?(o=!0,n=qb({scoreString:n,lowSide:t,outcome:Hre}),a=Zre,r=void 0):e===aae&&n&&(o=!0,n=qb({scoreString:n,lowSide:t,outcome:Wre}),a=Qre,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function ZMe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==PM&&(e=[{setNumber:1}]);let d=e.length-1;if(O_.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=pae({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===PM){if({scoreString:n,sets:e,outcomeRemoved:c}=q2({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===x_){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",u=!0)}else if(l===Ev&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=St((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=St(f),p=e[d].side1Score.toString(),u=!0}else{let f=St((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=St(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:g}=h;return[m,g].join("-")}).join(" ");f?n=f+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:u}}function XMe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:u}}=t.setFormat,[c]=Zm.split("");if(t.isMatchTiebreakEntry||(n+=c),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=AI({brackets:Zm,scoreString:n}),f=(n.slice((p??0)+1)+(e?"":a)).split(od);if((((d=f[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(f[0]=(f[0]||"")+a),i===2&&(f[1]=(f[1]||"")+a);let h=[f[0]||0,f[1]||0].map(v=>St(v)),m=i===1?1:0;h[m]=h[1-m]+(u?1:2),h[m]<l&&(h[m]=l);let g=r[r.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],n=n.slice(0,(p??0)+1),n+=h.join(od),o=!0}else{let h=[f[0]||0,f[1]||0].map(g=>St(g)),m=r[r.length-1];m.side1TiebreakScore=h[0],m.side2TiebreakScore=h[1],n+=a,o=!0}}else{let p=dae({lowValue:St(a||0),tiebreakTo:l,NoAD:u}),f=[St(a),p];i===2&&f.reverse();let h={side1TiebreakScore:f[0],side2TiebreakScore:f[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(h),n+=f.join(od),o=!0}return{info:s,scoreString:n,sets:r,updated:o}}function JMe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=h(),u=[n,l];e===2&&u.reverse();let c=iy.split("")[0],d=u.join(Ev)+(s?c:Pv);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=CH({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return s?n+1:n+1===r?n+(o?1:2):r}}function QMe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var F,x,$;let a=(((F=r==null?void 0:r.filter(j=>j==null?void 0:j.winningSide))==null?void 0:F.length)||0)+(i?0:1),o=yo(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},u=l==null?void 0:l.timed,c=s&&r[(o==null?void 0:o.bestOf)-1],d=c==null?void 0:c.winningSide,{isTiebreakEntry:p}=AI({brackets:iy,scoreString:e}),{isTiebreakEntry:f}=AI({brackets:Zm,scoreString:e}),h=p||f,m=!!l.tiebreakSet,g=(x=e==null?void 0:e[e.length-1])==null?void 0:x.trim(),v=e&&!isNaN(g),y=!h&&g===Ev,b=p&&CL.includes(g),I=f&&CL.includes(g),T=f&&g===od,w=e==null?void 0:e.split(""),[S]=Zm.split(""),U=w&&Math.max(...rc(S,w)),P=w&&Math.max(...rc(od,w)),E=w&&P>U,D=($=r[r.length-1])==null?void 0:$.winningSide,R=(r==null?void 0:r.length)&&!D,N=Kre.find(j=>(e==null?void 0:e.indexOf(j))>=0),M=!isNaN(n),A=n===x_,_=EM.includes(n),k=e==null?void 0:e.split("").find(j=>CL.includes(j)),B=_&&f&&!I&&(T||!qMe({scoreString:e}));return{isTiebreakSetValue:m&&M,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:R,isSpace:A,isCloser:_,isTiebreakCloser:_&&k&&h&&v,isDecidingSet:s,isTiebreakSet:m,isTimedSet:u,isNumericEnding:v,isNumericValue:M,hasOpener:k,hasOutcome:N,finalSet:c,finalSetIsComplete:d,lastSetIsComplete:D,isInvalidSetTiebreakValue:A&&h&&b,isInvalidMatchTiebreakValue:B,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:f,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:T}}function fae(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!uae.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=K7({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=f;let h=QMe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(sae.includes(i)&&(i=Ev),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&St(i)===0&&(h.isTiebreakCloser=!0),EM.includes(i)&&h.hasOpener&&(i=""),EM.includes(i)&&(i=x_),h.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(h.isTimedSet)({info:d,sets:r,scoreString:n,updated:c,matchUpStatus:o,winningSide:a}=ZMe({analysis:h,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(O_.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:c}=pae({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===PM)c=!0,{scoreString:n,sets:r}=q2({analysis:h,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===Ev&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:n,sets:r}=q2({analysis:h,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===od&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,n+=od);else if([Ev,od].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:r,scoreString:n,updated:c}=KMe({analysis:h,scoreString:n,sets:r,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?iy:Zm,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=h.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=F_({set:y});if(!h.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),P=dae({lowValue:U,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=P,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=P)}n=(n||"")+g,h.isDecidingSet||(n+=Pv);let S=CH({analysis:h,set:y});y.winningSide=S||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:c}=XMe({analysis:h,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(h.isSetTiebreakEntry){let[m]=iy.split(""),g=Math.max(...rc(m,n.split(""))),v=n.slice(g+1),y=v&&St(v)===GMe,b=St(v?v+i:i),{tiebreakFormat:I}=h.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(c=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!r.length){c=!0;let{scoreString:m,set:g}=JMe({analysis:h,lowSide:e,scoreString:n,value:St(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(c){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=K7({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[Fn,Qs].includes(o))?(o=FMe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![Xre,Zre,Qre].includes(o)&&(o=void 0),{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var B_="\\d+-\\d+",DU="\\d+-\\d+\\(\\d+\\)",RH="\\[\\d+-\\d+\\]",eNe="\\d+-\\d+\\(\\d+-\\d+\\)",tNe=new RegExp(`(${B_}),`,"g"),iNe=new RegExp(`(${DU}),`,"g"),nNe=[B_,DU,RH,eNe],rNe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],aNe=rNe.map(t=>{let e=t.split("").map(i=>nNe[i]).join(" ");return new RegExp(`^${e}$`)});function Y7(t){return!t||aNe.some(e=>e.test(t))}function oNe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=n.includes(l)&&l,c=r.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(f=>f!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function pR(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function sNe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function lw(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function CM(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function Z7(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function lNe(t){return t.startsWith("(")&&t.endsWith(")")}function uNe({score:t,applied:e}){t=oNe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,f,h,m,g,v=()=>{g=qo(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,m=f&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(lNe)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function $_(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=rc("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function cNe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[tNe,iNe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map($_).join(" "),{score:t,applied:e}}function dNe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(pR),a=0,o="";for(let p of r){let f=rc(p,n).filter(v=>!a||v>a)[0],h=n.slice(a,f-1),m=n[f-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[h.join(" "),[m,p].join("")].join(" ");o+=b,a=f+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[h.join(" "),[T,p].join("")].join(" ");o+=w,a=f+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>sNe(p)&&"bracket"||lw(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,f="";return n.forEach((h,m)=>{s[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=s[m]}),{score:f.trim()}}n=t.split(" ");let l,u=n.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),g=Math.abs([h,m].reduce((y,b)=>+y-+b)),v=Math.max(h,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=rc("tiebreak",u);if(c.length){let p="";n.forEach((f,h)=>{c.includes(h)?p+=`(${f}) `:c.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!lw(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(RH).test(p)&&"super"||new RegExp(DU).test(p)&&"tiebreak"||new RegExp(B_).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function pNe({score:t,applied:e}){for(let U of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(P.test(t)){let E=t.match(P).slice(1).map(R=>parseInt(R)),D=Math.abs(E[0]-E[1]);D<=10&&D>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,P,E,D,R,N]=t.match(i).slice(1);t=t.replace(i,`${U}${P}-${E} ${D}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let o=$_(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[U,P,E]=t.match(s).slice(1),[D,R]=P.split("");t=`${U}-${D} ${R}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[U,P]=t.match(u).slice(1),E=U.trim(),D=P.trim();if(l.test(E)&&l.test(D)){let R=E.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[U,P]=t.match(c).slice(1),E=U.trim(),D=P.trim();if(l.test(E)&&l.test(D)){let R=E.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[U,P,E]=t.match(f).slice(1),D=P.split(""),R=`${U}-${D[0]} ${D[1]}-${E}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(P=>{let E=P.match(U).slice(2)[0];t=t.replace(P,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let P=" "+U.slice(1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],P=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,P),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(D=>{let[R,N]=D.match(P).slice(1),M=`${R}-${N}`;E=E.replace(D,M)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,P,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${P}${E}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(T)||[]){let[P,E,D,R]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,M]=E.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(U,`${P}${E}(${D})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,D,R]=U.match(P).slice(1),[N,M]=E.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(U,`${E}(${D})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let P=/(^|\s)(\d \d)\(/,[E,D]=U.match(P).slice(1);t=t.replace(U,`${E}${D.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function fNe({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let u=l.split("[");if(lw(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let u=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Dn(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=CM(u.split(""),c)}}t=t.replace(l,`(${u})`)}i=t==null?void 0:t.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==a;if(r.test(l)&&c){let[d,p,f]=Array.from(l.match(r)).slice(1),h=Math.min(p,f);return`${d}(${h})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[u,c]=Array.from(l.match(r)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(r.test(l)){let[u,c]=Array.from(l.match(r)).slice(1);return lw(u)?`${u}(${c})`:u}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[u]=l.match(r).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function hNe({score:t,attributes:e,identifier:i}){var c,d,p;if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let f of r||[]){let h=(d=(c=f.match(/^\((.*)\)$/))==null?void 0:c.slice(1))==null?void 0:d[0],m=t.split(f)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=Z7(h),v=$_(g);t=t.replace(f,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(f=>{let h=Z7(f.match(/^\[(.*)\]$/)[1]);t=t.replace(f,`(${h}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(f=>t.endsWith(f))&&s.some(f=>t.includes(f))){let f="",h=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=h.every(b=>b.includes(",")||pR(b)),g=h.every(b=>b.includes("/")||pR(b)),v=h.every(b=>b.includes("-")||pR(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;h.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(f+=" "),I.includes(y))f+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);f+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?f+=`(${w}) `:f+=`[${T.join("-")}] `,b="tiebreak"}}),t=f.trim()}}let l=qo(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&lw(t)&&Dn(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}}function hae({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Dn(s)&&parseInt(s),u=n[0]!==void 0&&n[1]!==void 0;if(Dn(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(u&&e.length===1&&Dn(e[0])){let c=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=c,i.push(a()),n=[void 0,void 0]}u&&o()}}return{sets:i}}function W2(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=CM(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=CM(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function mae(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>Dn(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(hae({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d} [${p}${f}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${f}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${f}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${f}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=W2(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=zr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=qo(u),p=u.map(g=>Math.abs(g)),f=qo(p),h=u[0]<0,m=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(f).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=s,w=u.reduce((S,U,P)=>U<0?P:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,b,I,T,w,S]=s;h||m?s[5]===1&&(h?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:n}}function gae(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let u=l.match(r).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function mNe({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(DU).test(c)){let f=c.slice(3),h=c.slice(0,3),m=h.split("-");if(!lw(h)&&!e){let g=Math.max(...m),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+f}}else if(c.length===2&&Dn(c))return c.split("").join("-");c=$_(c);let p=new RegExp(`^${RH}$`).test(c)&&"super"||new RegExp(`^${DU}$`).test(c)&&"tiebreak"||new RegExp(`^${B_}$`).test(c)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[f,h]=c.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),g=Math.max(f,h),v=Math.min(f,h),y=[parseInt(f),parseInt(h)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(c=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[f,h]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=gae(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function gNe({score:t}){let{setsTied:e,winningSide:i}=gae(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Dn(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function vNe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function yNe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function bNe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=CM(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=mae({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function INe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&W2(t)?{score:W2(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function wNe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function SNe({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let r=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function TNe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function UNe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function DNe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function PNe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function ENe({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Dn(i))&&e.length===4&&(t=e)}return{score:t}}function CNe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var RNe={handleTiebreakSlashSeparation:PNe,handleSetSlashSeparation:UNe,punctuationAdjustments:uNe,handleGameSeparation:DNe,joinFloatingTiebreak:dNe,handleBracketSpacing:cNe,handleSpaceSeparator:ENe,separateScoreBlocks:bNe,matchKnownPatterns:pNe,removeDanglingBits:TNe,removeErroneous:INe,handleWalkover:wNe,properTiebreak:fNe,handleNumeric:mae,handleRetired:SNe,containedSets:hNe,sensibleSets:mNe,stringScore:vNe,superSquare:gNe,setBuilder:hae,excisions:CNe,replaceOh:yNe},RL={},MNe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],NNe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function vae(t){if(!t.score)return{error:we};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,f=e,h=g=>{g.forEach(v=>{p=RNe[v]({profile:s,identifier:n,matchUpStatus:u,attributes:d,applied:c,score:f});let y=p.score!==f;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};h(MNe);let m=Y7(f);return m||(f=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(NNe),m=Y7(f),m||(f="")),c.forEach(g=>{RL[g]||(RL[g]=0),RL[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var yae={};Kt(yae,{analyzeScore:()=>MH,analyzeSet:()=>PU,checkScoreHasValue:()=>Kr,checkSetIsComplete:()=>L_,getSetComplement:()=>AH,getTiebreakComplement:()=>V_,isValidMatchUpFormat:()=>Zo,parseScoreString:()=>RM,validateScore:()=>NH,validateTieFormat:()=>Mo});function MH({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){var T,w;let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(S=>S==null?void 0:S.winningSide))||[]).reduce((S,U)=>{let{winningSide:P}=U;if(!P)return S;let E=P-1;return S[E]++,S},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,u=s!==void 0&&o[s],c=l!==void 0&&o[l],d=e?yo(e):void 0,p=Math.max(...o),f=qo(o)[p],h=((T=d==null?void 0:d.setFormat)==null?void 0:T.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),m=d==null?void 0:d.bestOf,g=m&&Math.ceil(m/2)||1,v=i??t,y=v&&[ai,ta,yi].includes(v),b=!d||!a.length||a.every((S,U)=>{let P=U+1,E=P===m,D=P===a.length,{side1Score:R,side2Score:N,side1TiebreakScore:M,side2TiebreakScore:A,winningSide:_}=S,k=Math.max(R??0,N??0),B=M??A,{finalSetFormat:F,setFormat:x}=d,$=E&&F||x;if(B){let{tiebreakTo:j,NoAD:V}=($==null?void 0:$.tiebreakFormat)||{},H=Math.max(M??0,A??0);if(V&&H>j||H<j&&_&&(D&&!y||!D))return!1}return $.setTo?!(!$.noTiebreak&&k>$.setTo+1):!0}),I=(!e||p===g)&&f===1&&o.indexOf(p)+1||void 0;return{valid:!!(b&&(n&&u>c&&n===I||n&&y||!n&&!I&&(![kn,ai,ta,yi].includes(v)||h&&v===kn)))}}function NH({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:we};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:we,info:l};if(s!==void 0&&typeof s!="string")return{error:we,info:l};if(a!==void 0&&!Array.isArray(a))return{error:we,info:Td("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==Vt(u).length)return{error:we,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,f],[h,m],[g,v]].filter(I=>I.some(T=>T!==void 0)).every(I=>I.every(T=>Nt(T))))return{error:we,info:"non-numeric values"};if(![b,y].filter(I=>I!==void 0).every(I=>Nt(I)))return{error:we,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:we,info:"winningSide must be 1 or 2"}}let{valid:c}=MH({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!c)return{error:cee,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var AH=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=St(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},V_=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=ANe({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function ANe(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function RM({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,u=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,c=(u&&V_({lowValue:u,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[f,h]=a||c||[];return{side1Score:d,side2Score:p,side1TiebreakScore:f,side2TiebreakScore:h,winningSide:l,setNumber:r}}}function _Ne({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=F_({set:n});return L_({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function PU(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:NA};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),u=!s&&!l,c=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],h=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=f.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=f==null?void 0:f.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=o||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:U,result:P}=kNe({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:f}),{error:E,result:D}=ONe({setObject:e,setFormat:o,sideTiebreakScores:f}),R=u&&!w&&P||s&&w&&D,N=c&&!(s&&!w)&&!(u&&w)&&(!S||R),M=_Ne({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:c,isValidSetOutcome:R,leadingSide:T,setFormat:o,sideGameScores:d,sideGameScoresCount:h,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:f,sideTiebreakScoresCount:g,winningSide:M};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=D,D||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=P,P||(A.standardSetError=U))),A}function kNe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:NA};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:we};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:f2};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&(i!=null&&i.find(S=>S>=o))))return{result:!1,error:f2};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:AA};let d=(t==null?void 0:t.winningSide)-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&(n!=null&&n.find(N=>N>=U))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=s<o?o:o+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,D=y-b,R=b>=U-1;if(D&&R&&D<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>o&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=u?1:2,w=h>=o-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&f>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function ONe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:NA};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:AA};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=s?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var bae={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Iae={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},wae={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Sae={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Tae={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Uae={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Dae={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Pae={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Eae={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Cae={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Rae={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Mae={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Nae={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Aae={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},_ae={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},kae={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Oae={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},MM="COLLEGE_DEFAULT",K2="COLLEGE_JUCO",Y2="COLLEGE_D3",xae="DOMINANT_DUO",Lae="DOMINANT_DUO_MIXED",Fae="LAVER_CUP",Bae="TEAM_DOUBLES_3_AGGREGATION",$ae="TIME_TENNIS_DUAL",Vae="TIME_TENNIS_PRO_CIRCUIT",jae="USTA_BREWER_CUP",Gae="USTA_OZAKI_CUP",Hae="USTA_COLLEGE",zae="USTA_GOLD_TEAM_CHALLENGE",qae="USTA_LEVEL_1",Wae="USTA_INTERSECTIONAL",Kae="USTA_SECTION_BATTLE",Yae="USTA_SOUTHERN_LEVEL_5",Zae="USTA_TOC",Xae="USTA_WTT_ITT",Jae="USTA_ZONAL",Qae={COLLEGE_D3:Y2,COLLEGE_DEFAULT:MM,COLLEGE_JUCO:K2,DOMINANT_DUO:xae,DOMINANT_DUO_MIXED:Lae,LAVER_CUP:Fae,TEAM_DOUBLES_3_AGGREGATION:Bae,TIME_TENNIS_DUAL:$ae,TIME_TENNIS_PRO_CIRCUIT:Vae,USTA_BREWER_CUP:jae,USTA_OZAKI_CUP:Gae,USTA_COLLEGE:Hae,USTA_GOLD_TEAM_CHALLENGE:zae,USTA_INTERSECTIONAL:Wae,USTA_LEVEL_1:qae,USTA_SECTION_BATTLE:Kae,USTA_SOUTHERN_LEVEL_5:Yae,USTA_TOC:Zae,USTA_WTT_ITT:Xae,USTA_ZONAL:Jae},eoe="STANDARD",X7={[eoe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Y2]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:kl,matchUpCount:6,matchUpValue:1},tieFormatName:Y2,valueGoal:5},[MM]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:kl,matchUpCount:6,matchUpValue:1},tieFormatName:MM,valueGoal:4},[K2]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:kl,matchUpCount:6,matchUpValue:1},tieFormatName:K2,valueGoal:5},[Fae]:kae,[xae]:Rae,[Lae]:Dae,[Bae]:Iae,[$ae]:Pae,[Vae]:Uae,[jae]:Eae,[Gae]:Cae,[Hae]:Mae,[zae]:bae,[Wae]:Tae,[qae]:Nae,[Kae]:Sae,[Yae]:wae,[Xae]:Aae,[Zae]:Oae,[Jae]:_ae},xNe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(X7).includes(t.namedFormat)?t.namedFormat:eoe,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=st(X7[e],!1,!0),s=l=>{var c,d;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Mi();let u=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${u}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:One,collectionName:"Doubles",matchUpType:Wi,...o.doubles},{collectionId:s(1),matchUpFormat:kl,collectionName:"Singles",matchUpType:sn,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},Xm=xNe;function LNe(t){var d,p,f;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:u,matchUpFormat:c}=t;if(a===vr&&o===vr){let h=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:m})=>m===it))==null?void 0:p.tieFormat;u=u||h||r&&((f=l==null?void 0:l.tieFormat)==null?void 0:f.tieFormatName)===r&&l.tieFormat||r&&Xm({namedFormat:r,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||Xm({event:l,isMock:s,hydrateCollections:i}),c=void 0}else c||(u=void 0,l!=null&&l.matchUpFormat||(c=kl));if(u){let h=Mo({gender:l==null?void 0:l.gender,enforceGender:n,tieFormat:u});if(h.error)return h}return{tieFormat:u,matchUpFormat:c}}function FNe(t){var b,I,T,w,S;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:n,drawEntries:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=t.qualifyingProfiles,c=u!=null&&u.length?bre({uuids:t.uuids,qualifyingProfiles:u,appliedPolicies:n,idPrefix:o,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(b=e.structures)==null?void 0:b.filter(({structureId:U})=>U!==i),e.links=(I=e.links)==null?void 0:I.filter(({source:U})=>U.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:f}=c??{};p&&(c!=null&&c.structures&&((T=e.structures)==null||T.push(...c.structures)),c!=null&&c.links&&((w=e.links)==null||w.push(...c.links)));let h=(S=e.structures)==null?void 0:S.find(({stage:U,stageSequence:P})=>U===it&&P===1),{qualifiersCount:m}=N0({stageSequence:1,drawDefinition:e,structureId:a,stage:it}),g=Math.max(d??0,m??0),v=Sne({qualifiersCount:g,drawDefinition:e,stage:it});if(v.error||(v=SM({drawSize:p,stage:gt,drawDefinition:e}),v.error))return v;BNe({drawDefinition:e,drawEntries:r,event:l});let y=$Ne({mainStructure:h,qualifyingDetails:f,drawDefinition:e});return y.error?y:{drawDefinition:e,structureId:a}}function BNe({drawDefinition:t,drawEntries:e,event:i}){for(let n of(e??[]).filter(({entryStage:r})=>r===gt)){let r={...n,entryStage:n.entryStage??it,drawDefinition:t,event:i};Fie(r)}}function $Ne({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=r,c=t&&((n=ID({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:n.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function toe(t){var n,r;let{participantIds:e}=t,i=((r=(n=t.drawDefinition)==null?void 0:n.entries)==null?void 0:r.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||Jl.includes(o)}).map(Jt))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return le({result:{error:ku},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:we,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:we,info:"roundsCount must be less than 32"}:{participantIds:e}}function _H(t){var d;let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,u,c=toe(t);if(c.error)return c;for(let p of Xe(1,i+1)){let f=k_({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:n,matchUpsCount:r,structureId:a,roundNumber:u,idPrefix:o,isMock:s,event:l});if(f.error)return le({result:f,info:{iteration:p}});(d=f.matchUps)!=null&&d.length&&e.push(...f.matchUps),u=((f==null?void 0:f.roundNumber)??1)+1}return{matchUps:e}}function VNe(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=Cr[n])==null?void 0:l.accessor),s=e.participants??[];for(let u of i??[]){let c=s==null?void 0:s.find(p=>p.participantId===u),d=J7({scaleName:`${n}.${Dj}`,participant:c,eventType:r});!d&&n&&(d=J7({scaleAccessor:o,participant:c,scaleName:n,eventType:r})),d&&!a[u]&&(a[u]=d)}return a}function J7({scaleType:t=Gf,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var o,s;let a=(s=(o=i&&nd({scaleAttributes:{eventType:r??Wv,scaleType:t,scaleName:n},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Ii(a)?a[e]:a}function kH(t){var c,d;let e=GNe(t);if(e!=null&&e.error)return e;let i=toe(t);if(i.error)return i;let n=jNe(t);if(n.error)return n;let r=VNe(t),a=((c=t.tournamentRecord)==null?void 0:c.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],u;for(let p of Xe(1,(t.roundsCount??1)+1)){let f=TH({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:r,roundNumber:u,eventType:o,isMock:a});if(f.error)return f;let{matchUps:h,...m}=f;m.modifiedScaleValues&&(r=m.modifiedScaleValues),l.push({...m,iteration:p,matchUpsCount:h==null?void 0:h.length}),u=((m==null?void 0:m.roundNumber)??1)+1,h!=null&&h.length&&s.push(...h)}return{...re,matchUps:s,roundResults:l}}function jNe(t){var r,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(r=e==null?void 0:e.structures)==null?void 0:r.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let u=l.stage&&Jv[l.stage];return Ko({structure:l})&&u>(Jv[s==null?void 0:s.stage]||1)?l:s},void 0),n=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return n?Ko({structure:n})?{structure:n}:{error:bv}:{error:Sn}}function GNe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:we,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==el?{error:bv}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:we,info:"Missing Entries"}:{error:void 0}}function HNe(t){var c,d;let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:a,event:o}=t,s=(c=o==null?void 0:o.entries)==null?void 0:c.filter(({entryStage:p,entryStatus:f})=>(!p||p===it)&&f&&Jl.includes(f)),l=s==null?void 0:s.map(Jt),u=s?Math.floor(s.length/2):0;if(t.automated)return zNe({...t,participantIds:l});{let p=_H({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:u,idPrefix:r,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&R_({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:o})}return{...re}}function zNe(t){var l,u;let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=kH({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return s.error?s:((u=s==null?void 0:s.matchUps)!=null&&u.length&&R_({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:n}),{...re})}function qNe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var y,b;n=n??r;let c=Dt({drawDefinition:o,structureId:l});if(c.error)return c;let d=c.structure;if(!d)return{error:Sn};let{positionAssignments:p}=_r({structure:d}),f=(p==null?void 0:p.length)||0;if(u>f)return{error:GQ};let h=(y=d.structures)==null?void 0:y.length,m=Nt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(b=LG({roundRobinGroupsCount:h,drawSize:f}))==null?void 0:b.seedGroups,{seedsCount:v}=ND({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:f});return v&&(a!=null&&a[Ul])&&u>v&&e&&(u=v),d.seedLimit=u,d.seedAssignments=Xe(1,u+1).map(I=>{let T=g==null?void 0:g.find(U=>U.includes(I)),w=T&&Math.min(...T),S=m&&I>=m?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),Ji({drawDefinition:o,structureIds:[l]}),{...re,seedLimit:u}}function nb({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:Fe};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||!c.entryStageSequence||c.entryStageSequence===r)&&Jl.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=sw({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function ioe(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=wd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:f})=>!r.includes(f));if(!a)return le({result:{error:Sn},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=eAe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&YNe({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==el&&!(t.qualifyingOnly&&t.stage!==gt),d=((n==null?void 0:n.length)||0)>1,p=c?KNe({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?le({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function WNe({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var o,s;let a=(s=(o=$t({name:Mc,element:r}))==null?void 0:o.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!a||a===n)&&Tg.includes(r.entryStatus)})}function KNe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=yD({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function YNe(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Jt);e?ZNe({...t,enteredParticipantIds:a}):(r||i)&&XNe({...t,enteredParticipantIds:a})}function ZNe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?Jy({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;_0({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:c})})}function XNe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,m=JNe({...t,ageCategoryCode:f,categoryName:p,eventType:h})||l&&QNe({...t,ageCategoryCode:f,categoryName:p,eventType:h}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;_0({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:I,structureId:c,seedNumber:b,seedValue:w,event:d})})}function JNe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:td,eventType:u};return nb({scaleAttributes:c,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function QNe(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return nb({scaleAttributes:{scaleName:o||s,scaleType:Jf,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function eAe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=WNe(t);e>i.length&&(e=i.length);let{seedLimit:n}=qNe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function tAe(t){var I;let e=wH({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:n=!0,ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],g=iAe({suppressDuplicateEntries:n,ignoreStageSpace:r,drawDefinition:i,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let v=p===bg?0:St(t.seedsCount??0),y=ioe({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:it,seedsCount:v,placeByes:c,drawSize:d,entries:f});if(y.error&&!y.conflicts)return y;(I=y.positioningReport)!=null&&I.length&&h.push({[it]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===el&&t.roundsCount&&HNe({...t,drawDefinition:i,structureId:b}),{drawDefinition:i,positioningReports:h,conflicts:m,structureId:b}}function iAe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==it)continue;let s={...o,ignoreStageSpace:e??r===el,entryStage:o.entryStage??it,event:t.event,drawDefinition:i,drawType:r},l=Fie(s);if(n&&l.error)return l}return{error:void 0}}var nAe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),rAe=nAe;function aAe(t){let{drawId:e=Mi(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=rAe();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function OH(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=Lt(t,[{[ll]:!0,[bj]:!0}]);if(l.error)return l;if(!Zo({matchUpFormat:r}))return{error:O1};let u="setMatchUpFormat";if(o){let c=rn({drawDefinition:n,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===vr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:Co};d&&(d.matchUpFormat=r,ci({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===vr)return{error:vp};for(let c of e){let d=Dt({drawDefinition:n,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===vr)return{error:vp};let c=Dt({drawDefinition:n,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Ji({drawDefinition:n,structureIds:e}),{...re}}function oAe({tieFormat:t}){let e=Mo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Mi());return{tieFormat:t}}function sAe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=oAe({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=OH({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var xH={};Kt(xH,{attachPolicies:()=>Km,findPolicy:()=>wg,getAppliedPolicies:()=>mi,getPolicyDefinitions:()=>Kp,mutate:()=>noe,query:()=>aoe,removePolicy:()=>roe});var noe={};Kt(noe,{attachPolicies:()=>Km,removePolicy:()=>roe});function roe(t){let e=Lt(t,[{[BDe]:!0,_anyOf:{[Ua]:!1,[as]:!1,[ll]:!1,[By]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return Q7(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Fe};for(let a of r){let o=t.tournamentRecords[a],s=Q7(t,o);if(s.error)return s;i=!0}}else return{error:Fe};return i?{...re}:{error:Iv}}function Q7(t,e){let i=mi(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?fi({element:e,extension:{name:dU,value:i}}):Ha({element:e,name:dU}),{...re}):{error:Iv}}var aoe={};Kt(aoe,{findPolicy:()=>wg,getAppliedPolicies:()=>mi,getPolicyDefinitions:()=>Kp});var ooe={[Ul]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Id]:{positioning:$m},[jl]:{positioning:$m}},positioning:PPe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},Z2=ooe;function lAe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return le({info:"policyDefinitions must be an object",result:{error:we},stack:n});let r={[cU]:t==null?void 0:t[cU]};return e?uAe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Km({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Ul])&&!(e!=null&&e[Ul])&&(Km({policyDefinitions:Z2,drawDefinition:i}),t&&Object.assign(t,Z2)),{error:void 0}}function uAe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Km({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function cAe(t){var v,y,b,I,T;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:n,policyDefinitions:r,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:u}=t,c=t.drawId?(v=u==null?void 0:u.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;c&&s!==c.drawType&&(c.drawType=s);let d=c??aAe({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=sAe({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:u});if(p.error)return le({result:p,stack:l});let f=lAe({appliedPolicies:n,policyDefinitions:r,drawDefinition:d,stack:l});if(f.error)return f;let h=(b=(y=c==null?void 0:c.structures)==null?void 0:y.find(w=>w.stage===it&&w.stageSequence===1))==null?void 0:b.structureId,m=c?(I=c.structures)==null?void 0:I.filter(w=>w.stage===gt):[],g=(m==null?void 0:m.length)===1&&!((T=m[0].matchUps)!=null&&T.length)&&m[0].structureId;return{drawDefinition:d,structureId:h,existingDrawDefinition:c,existingQualifyingPlaceholderStructureId:g}}function dAe(t){var c,d;let e="generateOrGetExisting",i=[],n=[],r=cAe(t);if(r.error)return le({result:r,stack:e});let a=r.existingDrawDefinition,o=r.drawDefinition??{},s=r.structureId,l=t.drawEntries??t.eventEntries??[],u=r.existingQualifyingPlaceholderStructureId&&FNe({...t,...r})||tAe({...t,...r,entries:l});return u.error?le({result:u,stack:e}):((c=u.positioningReports)!=null&&c.length&&i.push(...u.positioningReports??[]),(d=u.conflicts)!=null&&d.length&&n.push(...u.conflicts??[]),o=u.drawDefinition,s=u.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:n,entries:l})}function pAe(t){var m,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:n,positioningReports:r,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:u,structureId:c,entries:d,stack:p}=t,f=e&&!(i!=null&&i.length)&&!n,h=[];if(i){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;i.sort(b);for(let w of i){if(!Array.isArray(w.structureProfiles))return le({info:Td("structureProfiles"),result:{error:ht},stack:p});T=w.roundTarget||T;let S=((m=w.structureProfiles)==null?void 0:m.sort(y))||[],U=1;for(let P of S){let{qualifyingRoundNumber:E,qualifyingPositions:D,seededParticipants:R,seedingScaleName:N,seedsCount:M=0,seedByRanking:A,placeByes:_,drawSize:k}=P,B=ioe({...t,seedingProfile:P.seedingProfile??l,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:D,seededParticipants:R,stage:gt,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:A,participants:u,roundTarget:T,seedsCount:M,placeByes:_,drawSize:k,entries:d});if(B.error)return B;B.structureId&&I.push(B.structureId),U+=1,(g=B.conflicts)!=null&&g.length&&h.push(...B.conflicts),(v=B.positioningReport)!=null&&v.length&&r.push({[gt]:B.positioningReport})}T+=1}}else if(c&&f){let y=Fs({structureName:ua(gt),stage:gt}),{link:b}=ID({sourceStructureId:y.structureId,targetStructureId:c,sourceRoundNumber:0,linkType:wp});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(b)}return{qualifyingConflicts:h,error:void 0}}var _D={};Kt(_D,{addGoesTo:()=>Wm,allCompetitionMatchUps:()=>Fu,allDrawMatchUps:()=>za,allEventMatchUps:()=>Xp,allPlayoffPositionsFilled:()=>HG,allTournamentMatchUps:()=>Wr,analyzeDraws:()=>RD,analyzeMatchUp:()=>CU,analyzeTournament:()=>zH,bulkUpdatePublishedEventIds:()=>KH,calculateWinCriteria:()=>ab,categoryCanContain:()=>P_,checkMatchUpIsComplete:()=>Rm,checkValidEntries:()=>__,compareTieFormats:()=>Pp,competitionScheduleMatchUps:()=>FD,credits:()=>fAe,drawMatchUps:()=>lz,eventMatchUps:()=>J_,filterParticipants:()=>fD,findDrawDefinition:()=>cH,findExtension:()=>$t,getAllDrawMatchUps:()=>pr,getAllEventData:()=>YH,getAllStructureMatchUps:()=>Ei,getAllowedDrawTypes:()=>j_,getAllowedMatchUpFormats:()=>jH,getAppliedPolicies:()=>mi,getAssignedParticipantIds:()=>Pg,getAvailableMatchUpsCount:()=>M_,getAvailablePlayoffProfiles:()=>wD,getCategoryAgeDetails:()=>DD,getCheckedInParticipantIds:()=>Wy,getCompetitionDateRange:()=>H_,getCompetitionMatchUps:()=>EU,getCompetitionParticipants:()=>LH,getCompetitionPenalties:()=>GH,getCompetitionVenues:()=>kD,getCourtInfo:()=>u_,getCourts:()=>uz,getDrawData:()=>z_,getDrawDefinitionTimeItem:()=>fG,getDrawParticipantRepresentativeIds:()=>lH,getDrawTypeCoercion:()=>MD,getEligibleVoluntaryConsolationParticipants:()=>sH,getEntriesAndSeedsCount:()=>Z_,getEvent:()=>pz,getEventData:()=>q_,getEventMatchUpFormatTiming:()=>QH,getEventProperties:()=>cz,getEventPublishStatus:()=>dl,getEventStructures:()=>I_,getEventTimeItem:()=>Y1,getEvents:()=>dz,getFlightProfile:()=>Gn,getHomeParticipantId:()=>c_,getLinkedTournamentIds:()=>G1,getMatchUpCompetitiveProfile:()=>aD,getMatchUpContextIds:()=>rz,getMatchUpDailyLimits:()=>ek,getMatchUpDailyLimitsUpdate:()=>ez,getMatchUpDependencies:()=>tu,getMatchUpFormat:()=>az,getMatchUpFormatTiming:()=>oD,getMatchUpFormatTimingUpdate:()=>JH,getMatchUpScheduleDetails:()=>d_,getMatchUpType:()=>f_,getMatchUpsMap:()=>ga,getMatchUpsStats:()=>oz,getMaxEntryPosition:()=>XH,getModifiedMatchUpFormatTiming:()=>X_,getPairedParticipant:()=>Gl,getParticipantEventDetails:()=>FH,getParticipantIdFinishingPositions:()=>uH,getParticipantMembership:()=>BH,getParticipantResults:()=>UD,getParticipantScaleItem:()=>sw,getParticipantSchedules:()=>$H,getParticipantSignInStatus:()=>VH,getParticipantTimeItem:()=>hG,getParticipants:()=>Bn,getPersonRequests:()=>Rg,getPolicyDefinitions:()=>Kp,getPositionAssignments:()=>UU,getPositionsPlayedOff:()=>k0,getPredictiveAccuracy:()=>nz,getProfileRounds:()=>Y_,getPublishState:()=>Zy,getRoundMatchUps:()=>Za,getRounds:()=>sz,getScaleValues:()=>y0,getScaledEntries:()=>nb,getScheduledRoundsDetails:()=>OD,getSchedulingProfile:()=>ef,getSchedulingProfileIssues:()=>ZH,getSeedingThresholds:()=>FG,getSeedsCount:()=>ND,getStructureSeedAssignments:()=>tl,getTeamLineUp:()=>qm,getTieFormat:()=>WH,getTimeItem:()=>_c,getTournamentIds:()=>V1,getTournamentInfo:()=>rb,getTournamentPenalties:()=>G_,getTournamentPersons:()=>HH,getTournamentStructures:()=>GG,getTournamentTimeItem:()=>Z1,getValidGroupSizes:()=>gD,getVenueData:()=>rw,getVenuesAndCourts:()=>Qp,isAdHoc:()=>Ko,isCompletedStructure:()=>rh,isValidForQualifying:()=>bH,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>A_,participantScaleItem:()=>nd,participantScheduledMatchUps:()=>tz,positionActions:()=>yH,publicFindVenue:()=>TG,tallyParticipantResults:()=>O0,tieFormatGenderValidityCheck:()=>U_,tournamentMatchUps:()=>Q_,validMatchUp:()=>p_,validMatchUps:()=>cl,validateCollectionDefinition:()=>PD,validateLineUp:()=>b_});function fAe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var soe={};Kt(soe,{filterParticipants:()=>fD,getCompetitionParticipants:()=>LH,getPairedParticipant:()=>Gl,getParticipantEventDetails:()=>FH,getParticipantMembership:()=>BH,getParticipantScaleItem:()=>sw,getParticipantSchedules:()=>$H,getParticipantSignInStatus:()=>VH,getParticipantTimeItem:()=>hG,getParticipants:()=>Bn,getScaleValues:()=>y0,participantScaleItem:()=>nd,validateLineUp:()=>b_});function LH(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};let i=[],n={},r={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:g}=Bn({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...f??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...re,matchUps:o}}function FH({tournamentRecord:t,participantId:e}){if(!t)return{error:Fe};if(!e)return{error:cr};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[Fi,Ot].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return Ya(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function BH({tournamentRecord:t,participantId:e}){if(!t)return{error:Fe};if(!e)return{error:cr};let{participants:i}=Bn({participantFilters:{participantTypes:[Fi,Ot,ws]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function $H({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Fe};if(typeof t!="object")return{error:zp,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Wr({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=tu({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>r[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat())??[];for(let f of d){let{participantId:h}=f;s[h]||(s[h]={potentialMatchUps:[],participant:f,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat())||[];for(let f of p){let{participantId:h}=f;s[h]||(s[h]={potentialMatchUps:[],participant:f,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...re}}function VH({tournamentRecord:t,participantId:e}){if(!t)return{error:Fe};if(!e)return{error:cr};let{participant:i}=Nh({tournamentRecord:t,participantId:e});if(!i)return{error:_n};let{timeItem:n}=_c({itemType:K1,element:i});return n&&n.itemValue===yU&&yU}var loe={};Kt(loe,{analyzeDraws:()=>RD,analyzeTournament:()=>zH,getAllowedDrawTypes:()=>j_,getAllowedMatchUpFormats:()=>jH,getAppliedPolicies:()=>mi,getCompetitionDateRange:()=>H_,getCompetitionPenalties:()=>GH,getPolicyDefinitions:()=>Kp,getTournamentInfo:()=>rb,getTournamentPenalties:()=>G_,getTournamentPersons:()=>HH,getTournamentStructures:()=>GG,getTournamentTimeItem:()=>Z1});function jH({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Fe};let{appliedPolicies:n}=mi({tournamentRecord:t});return(((r=n==null?void 0:n[Js])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function j_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Fe};let{appliedPolicies:n}=mi({tournamentRecord:t});return(((r=n==null?void 0:n[cM])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function G_({tournamentRecord:t}){if(!t)return{error:Fe};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function GH({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=[];for(let i of Object.values(t)){let{penalties:n}=G_({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function uoe({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:f,notes:h})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:f,notes:h}))(t)}}var hAe={[I0]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},mAe=hAe;function rb(t){var o,s,l,u;let{tournamentRecord:e}=t??{};if(!e)return{error:Fe};let i=(({tournamentId:c,tournamentRank:d,tournamentStatus:p,formalName:f,tournamentName:h,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S})=>({tournamentId:c,tournamentRank:d,tournamentStatus:p,formalName:f,tournamentName:h,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S}))(e),n=Bn({participantFilters:{participantRoles:[$ie,NG,Vie,jie,Hie]},policyDefinitions:mAe,tournamentRecord:e}).participants;n&&(i.tournamentContacts=n);let r=((u=(l=(s=(o=Zy({tournamentRecord:e}))==null?void 0:o.publishState)==null?void 0:s.tournament)==null?void 0:l.status)==null?void 0:u.publishedEventIds)||[],a=[];for(let c of e.events??[])if(!(t!=null&&t.usePublishState)||r.includes(c.eventId)){let d=uoe({event:c}).eventInfo;d&&a.push(d)}return i.eventInfo=a,{tournamentInfo:st(i,!1,!0),...re}}function H_({tournamentRecords:t}){if(!Ii(t))return{error:Cn};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=rb({tournamentRecord:o}),u=s&&new Date(Ft(s));(!r.startDate||u&&u<r.startDate)&&(r.startDate=u);let c=l&&new Date(Ft(l));return(!r.endDate||c&&c>r.endDate)&&(r.endDate=c),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Ft(e.startDate.toISOString()),n=e.endDate&&Ft(e.endDate.toISOString());return!i||!n?{error:oee}:{startDate:i,endDate:n}}function HH({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Fe};let i=t.participants||[];e&&(i=fD({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function gAe(t){var a,o,s,l,u,c,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===Fi))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],n=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],r=((d=(c=((u=n==null?void 0:n.structures)==null?void 0:u.length)===1&&n.structures[0])==null?void 0:c.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&r)}function zH({tournamentRecord:t}){if(!t)return{error:Fe};let{drawsAnalysis:e}=RD({tournamentRecord:t}),i={isDual:gAe(t),drawsAnalysis:e};return{...re,analysis:i}}var coe={};Kt(coe,{compareTieFormats:()=>Pp,getTieFormat:()=>WH,tieFormatGenderValidityCheck:()=>U_,validateCollectionDefinition:()=>PD});function NM(t){var r;if(!t)return{};let e=[],i=t.tieFormatName,n=(r=t.collectionDefinitions)==null?void 0:r.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;e.includes(s)||e.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===jm?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function Pp({considerations:t={},descendant:e,ancestor:i}){var T,w;let n={},r={},{matchUpFormats:a,tieFormatDesc:o}=NM(e),{matchUpFormats:s,tieFormatDesc:l}=NM(i),u=Vt((a??[]).filter(S=>!(s??[]).includes(S)).concat((s??[]).filter(S=>!(a??[]).includes(S)))),c=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),f=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));n.collectionIds=y7(Object.keys(p),Object.keys(f)),r.collectionIds=y7(Object.keys(f),Object.keys(p)),n.collectionsValue=e9(p),r.collectionsValue=e9(f),n.groupsCount=((T=i==null?void 0:i.collectionGroups)==null?void 0:T.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let h=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((S,U)=>{let P=n.collectionsValue.assignmentValues[U];return!P||S.valueKey!==P.valueKey||S.value!==P.value?!0:Array.isArray(S.value)?S.value.every((E,D)=>P.value[D]===E):!1}),y=c||d||l!==o||g||v||h!==0,b=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:u,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:h,nameDifference:c,descendantDesc:o,ancestorDesc:l,...re,different:y,invalid:I}}function e9(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(g_).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,f={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(f).filter(g=>![void 0,null].includes(f[g])&&(!Array.isArray(f[g])||f[g].length>0));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):f[m];i.push({valueKey:m,value:g})}return n+=u,s!=null&&s.length?r+s.reduce((g,v)=>g+v.value,0):u?Nt(c)?r+c*u:Nt(d)?r+d*u:Nt(p)?r+p*u:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function qH(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=doe(t);return{matchUp:st(e,!0,!0),error:i}}function doe({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var h;if(!i)return{error:Fe};if(typeof s!="string")return{error:Ca};if(!a||!d){let m=(Wr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:Ta};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=ho({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:ms};r&&!n&&(n=Yp({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:f=[]}=zy({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(za({context:l?p:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:Ta};let g=(h=a==null?void 0:a.structures)==null?void 0:h.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=rn({context:l?p:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function WH({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var f,h,m,g,v;if(!t)return{error:Fe};if(!o&&!s&&!i&&!n)return le({result:{error:ht},stack:"getTieFormat"});a&&!s&&(s=(f=t.events)==null?void 0:f.find(y=>y.eventId===a));let l=qH({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),r=r??(l==null?void 0:l.structure),!r&&i&&!n){if(!e)return{error:qu};let y=Dt({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let u=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((h=Aa({structure:r,drawDefinition:e,event:s}))==null?void 0:h.tieFormat),c=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((m=Aa({drawDefinition:e,event:s}))==null?void 0:m.tieFormat),d=(g=Aa({event:s}))==null?void 0:g.tieFormat,p=(v=Aa({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:v.tieFormat;return{...re,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:ra(u),eventDefaultTieFormat:ra(d),drawDefaultTieFormat:ra(c),tieFormat:ra(p),structure:r}}var poe={};Kt(poe,{bulkUpdatePublishedEventIds:()=>KH,getAllEventData:()=>YH,getCourtInfo:()=>u_,getDrawData:()=>z_,getEventData:()=>q_,getEventPublishStatus:()=>dl,getPublishState:()=>Zy,getVenueData:()=>rw});function KH({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:Fe};if(!(e!=null&&e.length))return{error:ht,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(i);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(a=>n.includes(a.eventId))).filter(a=>{let o=dl({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return i[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>RG({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function foe({dates:t=[],extension:e}){var n;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Ii(e.value)?(n=e.value)==null?void 0:n.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function hoe({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var o;let r={...st(n,t,!0),venueId:i.venueId},{extension:a}=$t({name:Ru,element:n});if(e&&a){let s=Ii(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:r.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);r.dateAvailability=l}return{inContextCourt:r}}function Qp(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:f}=$t({name:Ru,element:p});if(f!=null&&f.value)continue}o.includes(p.venueId)||(u.push(st(p,e,!0)),o.push(p.venueId));for(let f of p.courts??[])if(!s.includes(f.courtId)){if(i){let{extension:m}=$t({name:Ru,element:f});if(foe({extension:m,dates:r}))continue}let{inContextCourt:h}=hoe({convertExtensions:e,ignoreDisabled:i,venue:p,court:f});l.push(h),s.push(f.courtId)}}}),{courts:l,venues:u,...re}}function vAe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Cn};let r=st(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=$t({name:Ru,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(n!=null&&n.length))return u;let{extension:c}=$t({name:Ru,element:u});return foe({extension:c,dates:n})}).filter(Boolean).map(u=>{let{inContextCourt:c}=hoe({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function kD({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Cn}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=vAe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function YH({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Fe};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=rb({tournamentRecord:t}),{venues:a}=Qp({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=uoe({event:s}).eventInfo,c=X1({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(f=>{let h=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(f),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=M0({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=dl({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function moe({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function z_(t){var D,R,N;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:a=!0,usePublishState:o,status:s=eu,pressureRating:l,refreshResults:u,drawDefinition:c,noDeepCopy:d,sortConfig:p,context:f,event:h}=t;if(!c)return{error:ot};let m=(({matchUpFormat:M,updatedAt:A,drawType:_,drawName:k,drawId:B})=>({matchUpFormat:M,updatedAt:A,drawName:k,drawType:_,drawId:B}))(c);m.display=(D=$t({element:c,name:dM}).extension)==null?void 0:D.value;let g,v,{allStructuresLinked:y,sourceStructureIds:b,hasDrawFeedProfile:I,structureGroups:T}=w_({drawDefinition:c});if(!y)return{error:ZQ};let w=(t==null?void 0:t.publishStatus)??dl({event:h,status:s}),S=t.eventPublished??!!((N=(R=Zy({event:h}).publishState)==null?void 0:R.status)!=null&&N.published),U=!1,P=!1,E=T.map(M=>{let A={},_=M.map(k=>{let{structure:B}=Dt({drawDefinition:c,structureId:k}),{seedAssignments:F}=tl({drawDefinition:c,structure:B});return(B==null?void 0:B.stage)===it&&B.stageSequence===1&&(g=F),(B==null?void 0:B.stage)===gt&&B.stageSequence===1&&(v=F),B}).sort((k,B)=>Gy(k,B,p)).map(k=>{var W,Y;if(!k)return;let B=k==null?void 0:k.structureId,F=[];k.stage&&[it,pa,Nn].includes(k.stage)&&(F=g),(k==null?void 0:k.stage)===gt&&(F=v);let{matchUps:x,roundMatchUps:$,roundProfile:j}=Ei({seedAssignments:(W=k==null?void 0:k.seedAssignments)!=null&&W.length?void 0:F,context:{drawId:m.drawId,...f},tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:o,publishStatus:w,drawDefinition:c,inContext:a,structure:k,event:h}),{positionAssignments:V}=Gi({structure:k}),H=V==null?void 0:V.filter(Yo(hd)).map(Z=>{var J,ee;let X=(ee=(J=$t({element:Z,name:eh}))==null?void 0:J.extension)==null?void 0:ee.value,{drawPosition:Q,participantId:ce}=Z;return P=!0,{participantResult:X,participantId:ce,drawPosition:Q}});if(x.length&&(!(H!=null&&H.length)&&t.allParticipantResults||u&&!k.structures)){let{subOrderMap:Z}=Gne({positionAssignments:V}),X=O0({matchUpFormat:k.matchUpFormat,policyDefinitions:n,pressureRating:l,subOrderMap:Z,matchUps:x});H=V==null?void 0:V.filter(Yo(hd)).map(Q=>{var ee;let{drawPosition:ce,participantId:J}=Q;return P=!0,{participantResult:J&&((ee=X==null?void 0:X.participantResults)==null?void 0:ee[J]),participantId:J,drawPosition:ce}})}let z=k?(({stageSequence:Z,structureName:X,structureType:Q,matchUpFormat:ce,stage:J})=>({stageSequence:Z,structureName:X,structureType:Q,matchUpFormat:ce,stage:J}))(k):{};z.display=(Y=$t({element:k,name:dM}).extension)==null?void 0:Y.value,z.sourceStructureIds=b[B],z.hasDrawFeedProfile=I[B],z.positionAssignments=V,z.structureActive=x.reduce((Z,X)=>{var ce;let Q=[ir,br,Zl,kn,Nc,ai,ta,yi].includes(X.matchUpStatus);return Z||Q||!!X.winningSide||!!((ce=X.score)!=null&&ce.scoreStringSide1)},!1);let q=x.reduce((Z,X)=>Z&&[Ui,kn,ta,yi,ai,Ro].includes(X.matchUpStatus),!!x.length);return z.structureCompleted=q,A[B]=q,z.structureActive&&(U=!0),{...z,participantResults:H,seedAssignments:F,roundMatchUps:$,roundProfile:j,structureId:B}});return _.forEach(k=>{var B;i||delete k.positionAssignments,k.sourceStructuresComplete=(B=k.sourceStructureIds)==null?void 0:B.every(F=>A[F])}),_}).flat();return m.drawActive=U,m.participantPlacements=P,m.drawGenerated=E==null?void 0:E.reduce((M,A)=>M||!!(A!=null&&A.roundMatchUps),!1),m.drawCompleted=E==null?void 0:E.reduce((M,A)=>M&&A.structureCompleted,!0),m.drawPublished=o?S&&moe({publishStatus:w,drawId:m.drawId}):void 0,{structures:!o||m.drawPublished?d?E:st(E,!1,!0):void 0,drawInfo:d?m:st(m,!1,!0),...re}}function q_(t){var R,N,M;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:a=eu,sortConfig:o}=t,s=Lt(t,[{tournamentRecord:!0},{[Uj]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=st(t.tournamentRecord,!1,!0),u=t.event?void 0:ho({tournamentRecord:l,eventId:t.eventId}).event,c=t.event?st(t.event,!1,!0):u&&st(u,!1,!0)||void 0;if(!c)return{error:zo};let{eventId:d}=c,{tournamentId:p,endDate:f}=l,h=dl({event:c,status:a}),m=Zy({event:c}).publishState??{},g=!!((R=m==null?void 0:m.status)!=null&&R.published),{participants:v}=Bn({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:l}),y=({stage:A,drawId:_})=>{var B,F,x;if(!r)return!0;let k=(F=(B=h==null?void 0:h.drawDetails)==null?void 0:B[_])==null?void 0:F.stageDetails;return!k||!Object.keys(k).length?!0:(x=k[A])==null?void 0:x.published},b=({structureId:A,drawId:_})=>{var B,F,x;if(!r)return!0;let k=(F=(B=h==null?void 0:h.drawDetails)==null?void 0:B[_])==null?void 0:F.structureDetails;return!k||!Object.keys(k).length?!0:(x=k[A])==null?void 0:x.published},I=({drawId:A})=>r?moe({publishStatus:h,drawId:A}):!0,T=({drawId:A,structure:_})=>{var B,F,x,$;if(!r)return _;let k=($=(x=(F=(B=h==null?void 0:h.drawDetails)==null?void 0:B[A])==null?void 0:F.structureDetails)==null?void 0:x[_.structureId])==null?void 0:$.roundLimit;if(Nt(k)){let j=Xe(1,k+1),V={},H={};for(let z of j)_.roundMatchUps[z]&&(V[z]=_.roundMatchUps[z],H[z]=_.roundProfile[z]);_.roundMatchUps=V,_.roundProfile=H}return _},w=c.drawDefinitions||[],S=!r||g?w.filter(I).map(A=>(({drawInfo:_,structures:k})=>({..._,structures:k}))(z_({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:f},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:l,usePublishState:r,drawDefinition:A,publishStatus:h,sortConfig:o,event:c}))).map(({structures:A,..._})=>{let k=A==null?void 0:A.filter(({stage:B,structureId:F})=>b({structureId:F,drawId:_.drawId})&&y({stage:B,drawId:_.drawId})).map(B=>T({drawId:_.drawId,structure:B}));return{..._,structures:k}}).filter(A=>{var _;return(_=A.structures)==null?void 0:_.length}):void 0,{tournamentInfo:U}=rb({tournamentRecord:l}),P=(l.venues||[]).map(A=>(({venueData:_})=>({..._}))(rw({tournamentRecord:l,venueId:A.venueId}))),E=(({eventId:A,eventName:_,eventType:k,eventLevel:B,surfaceCategory:F,matchUpFormat:x,category:$,gender:j,startDate:V,endDate:H,ballType:z,discipline:q})=>({eventId:A,eventName:_,eventType:k,eventLevel:B,surfaceCategory:F,matchUpFormat:x,category:$,gender:j,startDate:V,endDate:H,ballType:z,discipline:q}))(c);E.display=(N=$t({element:c,name:dM}).extension)==null?void 0:N.value;let D={tournamentInfo:U,venuesData:P,eventInfo:E,drawsData:S};return D.eventInfo.publishState=m,D.eventInfo.published=(M=m==null?void 0:m.status)==null?void 0:M.published,{...re,eventData:D,participants:v}}var goe={};Kt(goe,{getPersonRequests:()=>Rg,getProfileRounds:()=>Y_,getScheduledRoundsDetails:()=>OD,getSchedulingProfile:()=>ef,getSchedulingProfileIssues:()=>ZH});function W_({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Zo({matchUpFormat:n}))return{error:O1};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var h;if(c)return;let p=i[d],f=l?(h=ho({tournamentRecord:p,eventId:l}))==null?void 0:h.event:void 0;return c=oD({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:f}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function OD({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:Cn};if(!Array.isArray(a))return{error:ht,info:Td("rounds")};let o={},s=[];a.sort((p,f)=>(p.sortOrder??0)-(f.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>D0({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Fu({nextMatchUps:!0,tournamentRecords:i}));let l=0,u={},c={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var T;let f=p.periodLength||n,h=[];e!=null&&e[p.structureId]?h.push(...e[p.structureId]):h.push(p.structureId);let m=r?fv({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:h,matchUps:r}).sort(Yy):[],{segmentNumber:g,segmentsCount:v}=p.roundSegment||{};if(Nt(g)&&xu(m==null?void 0:m.length)&&xu(v)&&g>0&&g<=v&&v<(m==null?void 0:m.length)&&!((T=p.matchUpIds)!=null&&T.length)){let w=m.length/v,S=w*(g-1);m=m.slice(S,S+w)}let y=i[p.tournamentId],b=ho({drawId:p.drawId,tournamentRecord:y}).event,I=[];for(let w of m){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),I.push(S))}for(let w of I){let{eventType:S,category:U}=b??{},{categoryName:P,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:D,recoveryMinutes:R,averageMinutes:N,error:M}=W_({categoryName:P??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(M)return{error:M,round:p};let A=m.filter(k=>(t||!dr.includes(k.matchUpStatus))&&k.matchUpStatus!==Ui).map(Nr);A.forEach(k=>{d[k]={typeChangeRecoveryMinutes:D,recoveryMinutes:R,averageMinutes:N},u[k]=R,c[k]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${f}`;return{roundPeriodLength:f,recoveryMinutes:R,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:u,averageMinutesMap:c,orderedMatchUpIds:s,minutesMap:d,...re}}function voe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=Ft(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&n.includes(h.drawId);return m||r.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function K_({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:we};let{venueIds:i,tournamentsMap:n}=bAe({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return Go(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{var U,P,E,D;if(!f)return a="empty round",!1;let{roundSegment:h,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=f,I=(D=(E=(P=(U=n==null?void 0:n[m])==null?void 0:U[y])==null?void 0:P[b])==null?void 0:E[g])==null?void 0:D.includes(v);I||(a="Invalid rounds");let{segmentNumber:T,segmentsCount:w}=h||{},S=!h||Nt(T)&&xu(w)&&T<=w;return S||(a="Invalid segment"),I&&S}):(r=xy,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=we),{valid:!!o,error:r,info:a}}function yAe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!n||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(r.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let f=p.drawId;s.push(f),i[u][d][f]={};let{structures:h}=wd({drawDefinition:p});(h||[]).forEach(m=>{var I;let g=m.structureId,{matchUps:v}=Ei({structure:m}),{roundMatchUps:y}=Za({matchUps:v}),b=y&&Object.keys(y).map(T=>parseInt(T));i[u][d][f][g]=b,a.push(g),(I=m.structures)!=null&&I.length&&m.structures.forEach(T=>{a.push(T.structureId),i[u][d][f][T.structureId]=b})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function bAe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=yAe({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function ef({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let{extension:i}=$t({element:e,name:Zv,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=kD({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=nH({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=voe({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let c=x0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return c.error?c:{schedulingProfile:n,modifications:l,issues:u}}}return{schedulingProfile:n,modifications:0}}function x0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=K_({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?fi({tournamentRecords:t,discover:!0,extension:{name:Zv,value:i}}):Ha({element:e,name:Zv,tournamentRecords:t,discover:!0})}function xD(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=ef({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:n}=kD({tournamentRecords:i}),{eventIds:r,drawIds:a}=nH({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=voe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...x0({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...re,modifications:s,issues:l}}function ZH(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:A1};if(!Array.isArray(e))return{error:we};if(!e.every(Go))return{error:Ka};let r=[],a=0,o={},{schedulingProfile:s}=ef({tournamentRecords:i});if(!s)return{issues:r,...re};let{matchUps:l}=Fu({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=OD({tournamentRecords:i,periodLength:n,matchUps:l,rounds:h}),{matchUpDependencies:y}=tu({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(I);return U&&(T=S),U}),T};if(g==null||g.forEach((I,T)=>{var U;let w=g.slice(T+1),S=Ln(w,((U=y==null?void 0:y[I])==null?void 0:U.matchUpIds)||[]);S.length&&m.push({matchUpId:I,shouldBeAfter:S})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),U=Vt(w.map(b));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),U.forEach(P=>{o[d][S].includes(P)||o[d][S].push(P)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...r.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...re}}function Rg(t){let{tournamentRecords:e,requestType:i}=t,n=Lt(t,[{[Ua]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=$t({element:a,name:w0}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};r[u]||(r[u]=[]);for(let d of c)i&&d.requestType!==i||r[u].push(d)}}return{personRequests:r,...re}}function X2(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=n?e:o,c=[r,s,l,u,a].join("|");return pt({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:c})}function t9({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:u}=o||{},c=qo(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],h=W_({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function IAe(t){return(t||[]).reduce((e,i)=>{var a,o;let n=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),r=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function i9(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,n=t.filter(({winningSide:u,matchUpStatus:c})=>u||dr.includes(c)).length||0,r=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==Ui).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function Y_({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:A1};t={[i.tournamentId]:i}}if(e){let a=K_({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=ef({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Hr};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=X2(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),pt({id:n?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:r}}var yoe={};Kt(yoe,{getEntriesAndSeedsCount:()=>Z_,getMaxEntryPosition:()=>XH});function Z_({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:ji};let{entries:o,stageEntries:s}=qie({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:u}=yre({participantsCount:l}),c=ND({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return le({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function XH(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>St(r||0)),0)}var boe={};Kt(boe,{allCompetitionMatchUps:()=>Fu,allDrawMatchUps:()=>za,allEventMatchUps:()=>Xp,allTournamentMatchUps:()=>Wr,analyzeMatchUp:()=>CU,calculateWinCriteria:()=>ab,checkMatchUpIsComplete:()=>Rm,competitionScheduleMatchUps:()=>FD,drawMatchUps:()=>lz,eventMatchUps:()=>J_,getAllDrawMatchUps:()=>pr,getAllStructureMatchUps:()=>Ei,getCheckedInParticipantIds:()=>Wy,getCompetitionMatchUps:()=>EU,getEventMatchUpFormatTiming:()=>QH,getHomeParticipantId:()=>c_,getMatchUpCompetitiveProfile:()=>aD,getMatchUpContextIds:()=>rz,getMatchUpDailyLimits:()=>ek,getMatchUpDailyLimitsUpdate:()=>ez,getMatchUpDependencies:()=>tu,getMatchUpFormat:()=>az,getMatchUpFormatTiming:()=>oD,getMatchUpFormatTimingUpdate:()=>JH,getMatchUpScheduleDetails:()=>d_,getMatchUpType:()=>f_,getMatchUpsStats:()=>oz,getModifiedMatchUpFormatTiming:()=>X_,getParticipantResults:()=>UD,getPredictiveAccuracy:()=>nz,getRoundMatchUps:()=>Za,getRounds:()=>sz,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>A_,participantScheduledMatchUps:()=>tz,tallyParticipantResults:()=>O0,tournamentMatchUps:()=>Q_,validMatchUp:()=>p_,validMatchUps:()=>cl});function Ioe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let i=[],n;for(let r of Object.values(t)){let{extension:a}=$t({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=$t({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function JH({tournamentRecords:t}){return Ioe({extensionName:Ip,tournamentRecords:t})}var ML="ADULT",NL="JUNIOR",rC="WHEELCHAIR",woe={[Ch]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Wi]:30,default:60}}]},defaultDailyLimits:{[sn]:2,[Wi]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[kl],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[rC],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[ML,rC],minutes:{default:60,[Wi]:30}},{categoryTypes:[NL],minutes:{default:60,[Wi]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[ML,rC],minutes:{default:30}},{categoryTypes:[NL],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[ML,NL],minutes:{default:30}},{categoryTypes:[rC],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},wAe=woe;function QH({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:ji};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f==null?void 0:f.matchUpFormat)&&Zo({matchUpFormat:f==null?void 0:f.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=wg({policyType:Js,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=$t({name:Ip,element:n}),f,h;p!=null&&p.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=wAe[Ch],r=Vt([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:ji};let c=r.map(({matchUpFormat:d,description:p})=>{let f=oD({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...f}});return pt({eventMatchUpFormatTiming:c,info:a})}function X_(t){let e=Lt(t,[{[as]:!0},{[ks]:m=>Zo({matchUpFormat:m}),[md]:O1,[bj]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=$t({name:Ip,element:r}),o=a==null?void 0:a.value,{extension:s}=$t({element:i,name:Ip}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&UT({...o,matchUpFormat:n}),c=(l==null?void 0:l.matchUpAverageTimes)&&UT({...l,matchUpFormat:n}),d=[u,c].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&DT({...o,matchUpFormat:n}),f=(l==null?void 0:l.matchUpRecoveryTimes)&&DT({...l,matchUpFormat:n}),h=[p,f].find(m=>m);return{matchUpFormat:n,recoveryTimes:h,averageTimes:d}}function ez({tournamentRecords:t}){return Ioe({extensionName:j1,tournamentRecords:t})}var LD=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function tz({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!cl(e))return{error:Hp};if(!Array.isArray(t))return{error:we};let i=e.filter(Boolean).filter(({schedule:n})=>LD({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=Ft(a==null?void 0:a.scheduledDate),s=nn(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return vte(nn((o=r.schedule)==null?void 0:o.scheduledTime),nn((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...re,scheduledMatchUps:i}}function SAe({tournamentRecords:t}){var n;let e=[],i={};for(let r of Object.values(t))for(let a of r.events??[]){let o=dl({event:a}),s=o==null?void 0:o.drawDetails;Ii(s)?(Object.assign(i,s),e.push(...Object.keys(s).filter(l=>RG({drawId:l,drawDetails:s})))):(n=o==null?void 0:o.drawIds)!=null&&n.length&&e.push(...o.drawIds)}return{drawIds:e,detailsMap:i}}function AM({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=n({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&Ft(l.scheduledDate)||l.scheduledTime&&Ft(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&nn(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((f,h)=>{let m=i[n(f)]||0,g=i[n(h)]||0;return m-g}),r.push(...p)}}return r}function iz({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:we};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),r=e?Math.max(e,n):n,a=Xe(0,r).map(o=>({matchUps:Xe(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}function J_(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:ji};let{eventId:I,eventName:T,endDate:w,eventType:S,category:U,gender:P}=b??{},E={...y,...pt({surfaceCategory:b.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:T,eventType:S,category:U,eventId:I,gender:P})},D;!e&&c&&({participants:e,participantMap:n,groupInfo:D}=zy({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=Yp({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:b}));let R=dl({event:b});return{...(b.drawDefinitions??[]).reduce((N,M)=>{var _;let A=M0({context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:n,publishStatus:R,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:v,event:b});return(_=Object.keys(A))==null||_.forEach(k=>{Array.isArray(A[k])&&(N[k]||(N[k]=[]),N[k]=N[k].concat(A[k]))}),N},{}),...re,groupInfo:D}}function Q_(t){if(!(t!=null&&t.tournamentRecord))return{error:Fe};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:c,matchUpFilters:d,contextProfile:p,nextMatchUps:f,context:h}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=zy({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Yp({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:I}=mi({tournamentRecord:s}),T=(c==null?void 0:c.eventIds)??[];return{...g.filter(w=>!T.includes(w.eventId)).map(w=>{var U,P,E;let S={eventDrawsCount:((P=(U=Gn({event:w}).flightProfile)==null?void 0:U.flights)==null?void 0:P.length)||((E=w.drawDefinitions)==null?void 0:E.length)||0,...h};return J_({context:S,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:c,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:f,inContext:l,event:w})}).reduce((w,S)=>{var U;return(U=S&&Object.keys(S).filter(P=>!["success","matchUpsMap"].includes(P)))==null||U.forEach(P=>{Array.isArray(S[P])&&(w[P]||(w[P]=[]),w[P]=w[P].concat(S[P]),w.matchUpsCount+=S[P].length)}),w},{matchUpsCount:0}),groupInfo:b}}function EU({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Cn};let u=Object.keys(i).map(d=>{let p=i[d];return Q_({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),c={};return{...u.reduce((d,p)=>(Object.keys(p).forEach(f=>{Array.isArray(p[f])&&(d[f]||(d[f]=[]),d[f]=d[f].concat(p[f])),f==="groupInfo"&&Object.assign(c,p[f])}),d),{}),groupInfo:c}}function FD(t){var D,R,N,M,A,_,k,B;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Cn};let{courts:e,venues:i}=Qp(t),n=ef(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:u,minCourtGridRows:c,usePublishState:d,status:p=eu,sortCourtsData:f}=t,h=d?(R=(D=Z1({tournamentRecord:l[s??Fy()??Object.keys(l)[0]],itemType:`${Ug}.${Dg}`}).timeItem)==null?void 0:D.itemValue)==null?void 0:R[p]:void 0,m=o?EU({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[kn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&(!h||!Object.keys(h).length))return{completedMatchUps:m,dateMatchUps:[],courtsData:[],venues:i};let g,v;d&&({drawIds:g,detailsMap:v}=SAe({tournamentRecords:l})),g!=null&&g.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>g.includes(F)):t.contextFilters.drawIds=g),(M=h==null?void 0:h.eventIds)!=null&&M.length&&(t.matchUpFilters||(t.matchUpFilters={}),(A=t.matchUpFilters)!=null&&A.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>h.eventIds.includes(F)):t.matchUpFilters.eventIds=h.eventIds),(_=h==null?void 0:h.scheduledDates)!=null&&_.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>h.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=h.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(B=(k=t.matchUpFilters)==null?void 0:k.excludeMatchUpStatuses)!=null&&B.length?t.matchUpFilters.excludeMatchUpStatuses.includes(kn)||t.matchUpFilters.excludeMatchUpStatuses.push(kn):t.matchUpFilters.excludeMatchUpStatuses=[kn]);let{completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:I,groupInfo:T}=EU({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),w=[...b??[],...I??[]];v&&Object.keys(v).length&&(w=w.filter(F=>{let{drawId:x,structureId:$,stage:j}=F;if(!v[x])return!1;if(v[x].stageDetails){let V=Object.keys(v[x].stageDetails),H=V.filter(q=>!v[x].stageDetails[q].published),z=V.filter(q=>v[x].stageDetails[q].published);return H.length&&H.includes(j)?!1:z.length&&z.includes(j)?!0:H.length&&!H.includes(j)&&!z.length}if(v[x].structureDetails){let V=Object.keys(v[x].structureDetails),H=V.filter(q=>!v[x].structureDetails[q].published),z=V.filter(q=>v[x].structureDetails[q].published);return H.length&&H.includes($)?!1:z.length&&z.includes($)?!0:H.length&&!H.includes($)&&!z.length}return!0}));let S=r?AM({matchUps:w,schedulingProfile:n}):w,U=e==null?void 0:e.map(F=>{let x=E(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:x,...F}}),P={completedMatchUps:o?m:y,dateMatchUps:S,courtsData:U,groupInfo:T,venues:i};if(u){let{rows:F,courtPrefix:x}=iz({minRowsCount:c,courtsData:U});P.courtPrefix=x,P.rows=F}return{...P,...re};function E({courtId:F}){let x=(a?S.concat(y??[]):S).filter($=>{var j,V,H;return((j=$.schedule)==null?void 0:j.courtId)===F||((H=(V=$.schedule)==null?void 0:V.allocatedCourts)==null?void 0:H.map(({courtId:z})=>z).includes(F))});return f?AM({matchUps:x,schedulingProfile:n}):x}}function ek({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=TAe({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function TAe(t){var s;let e=Lt(t,[{[as]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=wg({policyType:Ch,tournamentRecord:i}),{extension:r}=$t({element:i,name:j1}),a=(s=r==null?void 0:r.value)==null?void 0:s.dailyLimits,o=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function nz(t){var M,A,_,k;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:u,eventId:c,zonePct:d,drawId:p,event:f}=t;if(!n&&!e)return{error:Fe};if(l&&![sn,Wi].includes(l))return{error:we,info:{matchUpType:l}};if(e&&!cl(e))return{error:we,context:{matchUps:e}};let h=Cr[u],m=(h==null?void 0:h.ascending)??t.ascending??!1,g=(h==null?void 0:h.accessor)??t.valueAccessor,v=Array.isArray(h==null?void 0:h.range)?Math.abs(h.range[0]-h.range[1]):0,y=Nt(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[sn,Wi]},T=n==null?void 0:n.participants;(M=e==null?void 0:e[0])!=null&&M.hasContext?p?e=e.filter(B=>B.drawId===p):c&&(e=e.filter(B=>B.eventId===c)):e===void 0&&(e=p&&!r&&[]||!p&&c&&!f&&[]||p&&((A=za({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:b,participants:T}))==null?void 0:A.matchUps)||!p&&c&&((_=Xp({inContext:!0,contextFilters:I,contextProfile:b,participants:T,event:f}))==null?void 0:_.matchUps)||((k=Wr({tournamentRecord:n,contextFilters:I,contextProfile:b}))==null?void 0:k.matchUps)||[]),l&&(e=e.filter(B=>B.matchUpType===l));let w=e.filter(({winningSide:B,score:F,sides:x,matchUpStatus:$})=>![ta,ai,yi,S0,Ro].includes($??"")&&Kr({score:F})&&(x==null?void 0:x.length)===2&&B),S=DAe({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:m,scaleName:u}),U=!s||On(sn)(l)?y:(y||0)*2,P=y?w.map(({competitiveProfile:B,matchUpType:F,score:x,sides:$})=>{let j=Soe({singlesForDoubles:i,valueAccessor:g,matchUpType:F,scaleName:u,sides:$}),V=Math.abs(j[0].value-j[1].value);return{competitiveness:B==null?void 0:B.competitiveness,valuesGap:V,score:x}}).filter(({valuesGap:B})=>B<=U):[],E=UAe({zoneData:P}),D=E&&[].concat(Object.values(E)).flat().length,R=D&&Object.assign({},...Object.keys(E).map(B=>({[B]:Math.round(1e4*E[B].length/D)/100}))),N=w.length-((P==null?void 0:P.length)||0);return{...re,relevantMatchUps:w,zoneDistribution:R,zoneData:P,accuracy:S,nonZone:N}}function UAe({zoneData:t}){let e={[mG]:[],[bU]:[],[IU]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function Soe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let f of c){let{scaleValue:h,value:m}=n9({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=n9({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:f,exclusionValue:h}=s(d);return f&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function n9({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var u,c,d,p,f;let a=t?sn:i,o=(c=(u=n==null?void 0:n.rankings)==null?void 0:u[a])==null?void 0:c.find(h=>h.scaleName===r),s=(f=((p=(d=n==null?void 0:n.ratings)==null?void 0:d[a])==null?void 0:p.find(h=>h.scaleName===r))||o)==null?void 0:f.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function DAe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:f}=u;if(!f)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:ht};let h=f-1,m=Soe({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:f,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:f,sideValues:m});continue}let g=m[h].value-m[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:f,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=f===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?o.affirmative.push({winningScoreString:I,winningSide:f,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:I,winningSide:f,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function ab({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=zne({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=s&&n.includes(s);if(Nt(p||d))r=!0;else{if(f)continue;if(typeof l=="number"&&Nt(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&Nt(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...re}:{valueGoal:Math.floor(i/2)+1,...re}}function rz({matchUps:t,matchUpId:e}){if(!cl(t))return{error:we};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function L0(t,e){if(!Ii(t))return{error:we};if(!Array.isArray(e))return{error:we};let i={};for(let{param:n,error:r,attr:a}of e){let o=PAe({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function PAe({params:t,param:e,attr:i,error:n}){if(e===Tj&&Ii(t.drawDefinition)&&zn(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===xd){let r=doe({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Hr,info:{param:e}}}function az(t){var p,f;let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,a=Lt(t,[{[as]:!0},{[Uj]:{[Ij]:!1,[qp]:!1,[fte]:!1,[By]:!1}}]);if(a[up])return a;let o=(p=L0(t,[{[g0]:xd,[up]:ht}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!r&&(o!=null&&o.drawDefinition)&&(r=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!r)return{error:qu};let h=Dt({drawDefinition:r,structureId:e});if(h.error)return h;s=h.structure}let l=s==null?void 0:s.matchUpFormat,u=r==null?void 0:r.matchUpFormat,c=n==null?void 0:n.matchUpFormat,d=((f=o==null?void 0:o.matchUp)==null?void 0:f.matchUpFormat)||l||u||c;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:c,drawDefaultMatchUpFormat:u,matchUpFormat:d}}function oz({profileBands:t,tournamentRecord:e,matchUps:i}){if(!cl(i))return{error:Hp};let n=!t&&wg({policyType:tp,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||gG[tp].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(tie),s=(p,f)=>{let h=eie(f,r);return p[h]+=1,p},l=iie(o).reduce((p,f)=>s(p,f),{[mG]:0,[bU]:0,[IU]:0,[Xte]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===S7).length;return c.push({[S7]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...re}}var{stageOrder:r9}=APe;function EAe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(r9[t==null?void 0:t.stage]||0)-(r9[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function sz({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var w;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:we,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:A1};r={[o.tournamentId]:o}}let f=typeof r!="object"||!Object.keys(r).length;if((d||u||!n||!a&&(t||i||a||s))&&f)return{error:Cn};let h=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:P})=>P)}))),m=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:P,endDate:E})=>S.map(D=>({...D,validVenueIds:h[U],startDate:D.startDate??P,endDate:D.endDate??E}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||a||s)&&Y_({tournamentRecords:r,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(S=>({[S.id]:S}))),b=n||r&&((w=Fu({tournamentRecords:r,matchUpFilters:l}))==null?void 0:w.matchUps)||[],I=[],T=b&&Object.values(b.reduce((S,U)=>{var W;let P=X2(U).id,E=g==null?void 0:g[P],D=[...((W=S[P])==null?void 0:W.matchUps)??[],U],{containerStructureId:R,stageSequence:N,structureName:M,tournamentId:A,isRoundRobin:_,matchUpType:k,roundNumber:B,roundOffset:F,structureId:x,eventName:$,roundName:j,drawName:V,eventId:H,drawId:z}=U,q=_?R:x;return{...S,[P]:{id:c?P:void 0,structureId:q,stageSequence:N,segmentsCount:E,structureName:M,tournamentId:A,matchUpType:k,roundNumber:B,roundOffset:F,eventName:$,roundName:j,drawName:V,matchUps:D,eventId:H,drawId:z}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:P}=IAe(S.matchUps),E=S.segmentsCount;if(E){let B=S.matchUps.length/E;return zr(S.matchUps.sort((F,x)=>F.roundPosition-x.roundPosition),B).map((F,x)=>{let{unscheduledCount:$,incompleteCount:j,matchUpsCount:V,isScheduled:H,isComplete:z,byeCount:q}=i9(F),W=t9({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return pt({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:x+1},winnerFinishingPositionRange:P,unscheduledCount:$,incompleteCount:j,minFinishingSum:U,matchUpsCount:V,isScheduled:H,roundTiming:W,isComplete:z,byeCount:q,matchUps:F})})}let{unscheduledCount:D,incompleteCount:R,matchUpsCount:N,isScheduled:M,isComplete:A,byeCount:_}=i9(S.matchUps),k=t9({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return pt({...S,...p,winnerFinishingPositionRange:P,unscheduledCount:D,incompleteCount:R,minFinishingSum:U,matchUpsCount:N,isScheduled:M,roundTiming:k,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let x=Ft(t),$=c?S.id:X2(S).id;if(x&&y[$]&&Ft(y[$].scheduleDate)===x)return!1}let{isComplete:U,isScheduled:P}=S,E=!i||!U,D=!e||!P,R=d||u?m==null?void 0:m.find(({eventId:x})=>x===S.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),M=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),A=!u||!N||new Date(u)>=new Date(N),_=!u||!M||new Date(u)<=new Date(M),k=A&&_,B=!d||(R==null?void 0:R.validVenueIds.includes(d)),F=E&&D&&B&&k;return F||I.push(S),F}).sort(EAe)||[];return{...re,rounds:T,excludedRounds:I}}function CU(t){var H;let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:Eo};o=o||(e==null?void 0:e.matchUpFormat);let s=yo(o),l=!!(e!=null&&e.winningSide),u=(H=e.score)==null?void 0:H.sets,c=u==null?void 0:u.length,d=n&&n-1,p=!!(u!=null&&u.find((z,q)=>z.setNumber===n&&q===d)),f=(u==null?void 0:u.filter(z=>z==null?void 0:z.winningSide))||[],h=(f==null?void 0:f.length)||0,m=n&&(u==null?void 0:u.slice(n))||[],g=!!(c&&n&&(m!=null&&m.reduce((z,q)=>(!q||!q.side1Score&&!q.side2Score&&!q.side1TiebreakScore&&!q.side2TiebreakScore&&!q.side1PointScore&&!q.side2PointScore)&&z,!0))),v=n<=c&&u.find(z=>z.setNumber===n),y=v&&PU({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:T}=y||{},w=!!(v&&!b&&g||n&&n===c+1&&!l),S=[1,2].includes(i),U=S?i-1:0,P=v&&S&&(!r&&!a&&I[U]!==void 0&&I[U]||r&&T[U]!==void 0&&T[U]),E=!!P,D=f==null?void 0:f.map(z=>PU({setObject:z,matchUpScoringFormat:s}).isValidSetOutcome).reduce((z,q)=>z&&q,!0),R=f.reduce((z,q)=>{let{winningSide:W}=q,Y=W-1;return z[Y]++,z},[0,0]),N=e==null?void 0:e.winningSide,M=N&&N-1,A=1-M,_=R[M],k=R[A],B=Math.max(...R),F=qo(R)[B],{bestOf:x}=s??{},$=x&&Math.ceil(x/2)||1,j=B===$&&F===1&&R.indexOf(B)+1||void 0,V=_>k&&N===j;return{completedSetsHaveValidOutcomes:D,validMatchUpWinningSide:V,calculatedWinningSide:j,matchUpScoringFormat:s,validMatchUpOutcome:j&&D&&V,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:E,existingValue:P,isExistingSet:p,isActiveSet:w,...y}}function lz({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:U,category:P,gender:E}=I??{},D={...b,...pt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:U,category:P,eventId:T,gender:E})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=zy({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),I&&h&&!c&&(c=Yp({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:m,event:I})),{...M0({context:D,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var Toe={};Kt(Toe,{getCompetitionVenues:()=>kD,getCourts:()=>uz,getVenuesAndCourts:()=>Qp,publicFindVenue:()=>TG});function uz({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=st(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:Fe}}var Uoe={};Kt(Uoe,{categoryCanContain:()=>P_,getCategoryAgeDetails:()=>DD,getEvent:()=>pz,getEventProperties:()=>cz,getEventStructures:()=>I_,getEventTimeItem:()=>Y1,getEvents:()=>dz,getFlightProfile:()=>Gn,getScaledEntries:()=>nb});function cz({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:Fe};if(!e)return{error:ji};let i=e.entries||[],n=t.participants||[],r=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(f=>f.participantId),s=n.filter(f=>o.includes(f.participantId)),l,u,c;return{entryScaleAttributes:s.map(f=>{var T,w,S,U,P,E;let{participantId:h,participantName:m,name:g}=f,v={scaleType:wG,eventType:a,scaleName:r},y=(w=(T=nd({participant:f,scaleAttributes:v}))==null?void 0:T.scaleItem)==null?void 0:w.scaleValue;v={scaleType:fie,eventType:a,scaleName:r};let b=(U=(S=nd({participant:f,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:U.scaleValue;v={scaleType:pie,eventType:a,scaleName:r};let I=(E=(P=nd({participant:f,scaleAttributes:v}))==null?void 0:P.scaleItem)==null?void 0:E.scaleValue;return l=!!(l||y),u=!!(u||b),c=!!(c||I),{participantId:h,participantName:m||g,seed:y,ranking:b,rating:I}}),hasSeededParticipants:l,hasRankedParticipants:u,hasRatedParticipants:c}}function dz({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var c,d,p,f;if(!t)return{error:Fe};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:h})=>!r||Array.isArray(r)&&r.includes(h)).map(h=>{var v;let m=(v=h.drawDefinitions)==null?void 0:v.map(pU);if(a!=null&&a.length&&!Ln(a,m).length)return;let g=st(h);return n&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),u={};if(e){let h=Bn({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;u[y]||(u[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>Jl.includes(E)).map(Jt),I=E=>{var D,R,N,M,A,_;if((D=E==null?void 0:E.ratings)!=null&&D[v])for(let k of((R=E==null?void 0:E.ratings)==null?void 0:R[v])??[]){let B=k.scaleName;u[y].ratings[B]||(u[y].ratings[B]=[]);let F=(N=Cr[B])==null?void 0:N.accessor;if(F){let x=parseFloat((M=k.scaleValue)==null?void 0:M[F]);x&&u[y].ratings[B].push(x)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let k of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){let B=k.scaleName;u[y].ranking[B]||(u[y].ranking[B]=[]),k.scaleValue&&u[y].ranking[B].push(k.scaleValue)}};for(let E of b){let D=(c=h==null?void 0:h[E])==null?void 0:c.participant;if((D==null?void 0:D.participantType)!==Qt)for(let R of(D==null?void 0:D.individualParticipantIds)??[]){let N=(d=h==null?void 0:h[R])==null?void 0:d.participant;I(N)}else I(D)}let T=u[y].ratings;for(let E of Object.keys(T)){let D=T[E];if(!D.length)continue;let R=(p=v7(D))==null?void 0:p.toFixed(2);u[y].ratingsStats[E]={avg:parseFloat((m(D)/D.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...D),min:Math.min(...D)}}let w=(E,D)=>{var N,M;let R=A=>{var _,k,B,F,x,$,j,V,H,z;if((_=u[y].draws)!=null&&_[E]&&((k=A==null?void 0:A.ratings)!=null&&k[v]))for(let q of((B=A==null?void 0:A.ratings)==null?void 0:B[v])??[]){let W=q.scaleName;(F=u[y].draws[E])!=null&&F.ratings[W]||(u[y].draws[E].ratings[W]=[]);let Y=(x=Cr[W])==null?void 0:x.accessor;if(Y){let Z=parseFloat(($=q.scaleValue)==null?void 0:$[Y]);Z&&u[y].draws[E].ratings[W].push(Z)}}if((j=u[y].draws)!=null&&j[E]&&((V=A==null?void 0:A.rankings)!=null&&V[v]))for(let q of((H=A==null?void 0:A.rankings)==null?void 0:H[v])??[]){let W=q.scaleName;(z=u[y].draws[E])!=null&&z.ranking[W]||(u[y].draws[E].ranking[W]=[]);let Y=q.scaleValue;Y&&u[y].draws[E].ranking[W].push(Y)}};for(let A of D.filter(Boolean)){let _=(N=h==null?void 0:h[A])==null?void 0:N.participant;if((_==null?void 0:_.participantType)!==Qt)for(let k of(_==null?void 0:_.individualParticipantIds)??[]){let B=(M=h==null?void 0:h[k])==null?void 0:M.participant;R(B)}else R(_)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let D=E.drawId;if(U(D))continue;let R=Pg({drawDefinition:E}).assignedParticipantIds??[];u[y].draws[D]||(u[y].draws[D]={ratingsStats:{},ratings:{},ranking:{}}),S.push(D),w(D,R)}let P=Gn({event:g}).flightProfile;for(let E of(P==null?void 0:P.flights)??[]){let D=E.drawId;if(U(D))continue;let R=E.drawEntries.map(Jt);w(D,R)}for(let E of S){let D=u[y].draws[E].ratings;for(let R of Object.keys(D)){let N=D[R];if(!N.length)continue;let M=(f=v7(N))==null?void 0:f.toFixed(2);u[y].draws[E].ratingsStats[R]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return pt({eventScaleValues:u,events:l,...re})}function pz({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var o;if(!t)return{error:Fe};if(!n)return{error:ji};let r=st(n);i&&Object.assign(r,i);let a=e&&((o=r.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return pt({drawDefinition:a,event:r})}function CAe(t){var f,h;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=NAe(t),r=AAe({...t,policyDefinitions:n,appliedPolicies:i}),a=MAe(t),o=_Ae({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return le({result:o,stack:e});let s=kAe({...t,consideredEntries:a}),l=RAe({...t,appliedPolicies:i,policyDefinitions:n,drawSize:s});if(l.error)return le({result:l,stack:e});let u=l.drawType;if(isNaN(s)&&u!==el)return le({result:{error:k1},stack:e});let c=(n==null?void 0:n[Ul])??(i==null?void 0:i[Ul]),d=t.seedingProfile??((h=(f=c==null?void 0:c.seedingProfile)==null?void 0:f.drawTypes)==null?void 0:h[u??""])??(c==null?void 0:c.seedingProfile);t.seedingProfile&&(n[Ul]||(n[Ul]={...Z2[Ul]}),n[Ul].seedingProfile=d);let p=OAe({...t,drawType:u});return p!=null&&p.error?le({result:p,stack:e}):{drawSize:s,drawType:u,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function RAe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??MD({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=Ire({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function Doe(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...Jl,nD].includes(e.entryStatus))}function MAe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||Doe(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===it)}function NAe(t){let{tournamentRecord:e,event:i}=t,n=mi({tournamentRecord:e,event:i}).appliedPolicies??{},r=st(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function AAe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[Br])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[Br])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function _Ae(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&__({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function kAe(t){return!t.drawSize&&t.consideredEntries.length&&![el,H1,T0,jl,Id].includes(t.drawType??"")&&m0(t.consideredEntries.length)||t.drawSize&&St(t.drawSize)||!1}function OAe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,a=!n&&e&&j_({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(r)?{error:FV}:{...re}}function BD(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=Bn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Doe(n==null?void 0:n.entries)??[],l=CAe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return le({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=LNe({...t,enforceGender:f,eventType:m,matchUpType:g});if(v.error)return le({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return le({result:{error:we},stack:r});let I=dAe({...t,isMock:t.isMock??!0,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return le({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:U,conflicts:P,entries:E}=I;if(!S)return le({result:{error:we},stack:r});let D=pAe({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:u,drawDefinition:S,seedingProfile:h,participants:a,structureId:U,entries:E,params:t,stack:r});if(D.error)return D;let{qualifyingConflicts:R}=D;return S.drawName=t.drawName??(p&&ua(p)),d&&typeof e=="object"&&d>=4&&kG({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:R,positioningReports:w,drawDefinition:S,structureId:U,...re,conflicts:P}}function Poe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:ht,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:td,scaleName:r,scaleDate:o}],participantId:s}))}}function xAe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=Z_({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:we};let m=nb({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Poe({scaleAttributes:n,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:r});return{scaleItemsWithParticipantIds:g}}var fz={};Kt(fz,{addDrawEntries:()=>MG,addEventEntries:()=>rd,addEventEntryPairs:()=>Noe,destroyPairEntries:()=>Kie,destroyPairEntry:()=>_G,getEntriesAndSeedsCount:()=>Z_,getMaxEntryPosition:()=>XH,modifyEntriesStatus:()=>yM,modifyEventEntries:()=>Aoe,mutate:()=>Eoe,promoteAlternate:()=>Roe,promoteAlternates:()=>mz,query:()=>yoe,removeDrawEntries:()=>Moe,removeEventEntries:()=>hD,setEntryPosition:()=>hz,setEntryPositions:()=>Coe});var Eoe={};Kt(Eoe,{addDrawEntries:()=>MG,addEventEntries:()=>rd,addEventEntryPairs:()=>Noe,destroyPairEntries:()=>Kie,destroyPairEntry:()=>_G,modifyEntriesStatus:()=>yM,modifyEventEntries:()=>Aoe,promoteAlternate:()=>Roe,promoteAlternates:()=>mz,removeDrawEntries:()=>Moe,removeEventEntries:()=>hD,setEntryPosition:()=>hz,setEntryPositions:()=>Coe});function hz({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:Fe};if(!i)return le({result:{error:cr},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:we,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===n&&u.participantId!==i&&(u.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=Mu({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=Mu({entries:e.entries}))),{...re}}function Coe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:we};for(let r of e){let{participantId:a,entryPosition:o}=r,s=hz({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=Mu({entries:n.entries})),i!=null&&i.entries&&(i.entries=Mu({entries:i.entries})),{...re}}function Roe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:we,participantId:e}:mz({...t,participantIds:[e].filter(Boolean)})}function mz({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=it,eventId:a,event:o}){if(!t)return{error:Fe};if(!Array.isArray(i))return{error:we,participantIds:i};if(!o)return{error:ji};let s="promoteAlternates";if(o){let l=a9({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=a9({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?le({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...re},stack:s}):l}return{...re}}function a9({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Al),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:bee};let l=s.filter(({entryStatus:d})=>d!==Al);if(l.length)return{error:h2,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==n);if(u.length)return{error:J1e,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:Q1e,invalidStageSequence:c};for(let d of s){d.entryStatus=Wo;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Al&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===Wo&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>St(h||0)),0);d.entryPosition=f||0}return{...re}}function Moe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var c;if(!a)return{error:ji};if(!n)return{error:qu};if(!(e!=null&&e.length))return{error:Dh};let o=Pg({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(Ya(o,e))return{error:p0};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Gn({event:a}),u=(c=l==null?void 0:l.flights)==null?void 0:c.find(d=>d.drawId===n);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),t&&(u.drawEntries=Mu({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=Mu({entries:i.entries}))),{...re}}function bc(t){var m,g,v,y,b;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:a,participant:o}=t,s=t.tournamentId?(m=t.tournamentRecords)==null?void 0:m[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:Fe};if(!o)return le({result:{error:Oy},stack:e});o.participantId||(o.participantId=Mi()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:u}=o;if(s.participants.reduce((I,T)=>T.participantId===l||I,!1))return{error:hee};let{participantType:c,participantRole:d}=o;if(!c||!Object.keys(MI).includes(c))return{error:Ou,participantType:c};if(!d)return{error:fee};let p=s.participants||[],f=p.filter(I=>I.participantType===Qt).map(I=>I.participantId);if(c!==Qt&&o.person)return{error:we,person:o.person};if(u&&!Array.isArray(u))return{error:we,individualParticipantIds:u};if(c===Ot){if(o.person)return{error:we,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return le({info:"PAIR must be 2 individualParticipantIds",result:{error:Hs},stack:e});{let w=p.filter(S=>S.participantType===Qt).map(S=>S.participantId);if(!Array.isArray(o.individualParticipantIds))return le({result:{error:Hs},stack:e});if(!o.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return le({result:{error:Hs},stack:e})}}else return le({result:{error:Dh},stack:e});let I=p.filter(w=>w.participantType===Ot).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=o.participantType===Ot&&I.find(w=>Ln(w.individualParticipantIds,o.individualParticipantIds).length===2);if(T&&!i)return{...re,existingParticipant:!0,participant:n&&st(T.participant)};if(!o.participantName){let w=p.filter(U=>{var P;return(P=o.individualParticipantIds)==null?void 0:P.includes(U.participantId)}),S=w.map(U=>{var P;return(P=U.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),o.participantName=S}}else if(c===Qt){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:yee};if(!o.participantName){let I=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=I}}else if(c&&[Fi,ws].includes(c)){if(u||(o.individualParticipantIds=[]),(b=o.individualParticipantIds)==null?void 0:b.length)for(let I of o.individualParticipantIds){if(typeof I!="string")return le({result:{participantId:I,error:we},stack:e});if(!f.includes(I))return le({result:{participantId:I,error:_n},stack:e})}}else return{error:Ou};s.participants.push(o),r||jt({payload:{tournamentId:s.tournamentId,participants:[o]},topic:th});let h={participant:n&&st(o),...re};return pt(h)}function Hl({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Fe};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=Mi())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===Qt),l=a.filter(d=>d.participantType!==Qt),u=s.concat(...l),c=[];if(u.length){for(let p of u){let f=bc({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&jt({topic:th,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&st(c),addedCount:c.length,...re};return o.length&&Object.assign(d,{notAdded:o,info:kA}),pt(d)}else return{info:"No new participants to add",addedCount:0,...re}}function Noe({allowDuplicateParticipantIdPairs:t,entryStage:e=it,entryStatus:i=Al,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:Fe};if(!o)return{error:ji};if(o.eventType!==Wi)return{error:vp};let l=[],u=new Map;for(let y of r.participants??[]){let{participantType:b,participantId:I,person:T,individualParticipantIds:w}=y;b===Qt&&(T!=null&&T.sex)?u.set(I,T.sex):b===Ot&&w&&l.push(w)}let c=n.filter(y=>{if(y.length!==2||!u.has(y[0])||!u.has(y[1]))return!0;if(!o.gender||o.gender===Lu)return!1;let b=y.map(T=>u.get(T)),I=o.gender===zi&&(b[0]!==zi||b[1]!==zi)||o.gender===pn&&(b[0]!==pn||b[1]!==pn);return o.gender===Po&&(b.sort(g_),(b[0]!==pn||b[1]!==zi)&&(I=!0)),I});if(c.length)return{error:Hs,invalidParticipantIdPairs:c};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??Mi(),participantRole:la,individualParticipantIds:y,participantType:Ot})),p=t?d:d.filter(y=>!l.find(b=>Ln(b,y.individualParticipantIds).length===2)),f,h=[];if(p){let y=Hl({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;h=y.participants||[],f=y.info}let m=n.map(y=>{let b=h.find(T=>Ln(T.individualParticipantIds,y).length===2);if(b)return b;let{participant:I}=Gl({tournamentRecord:r,participantIds:y});return I}).map(y=>y.participantId),g=rd({participantIds:m,tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&jt({payload:{participants:p},topic:th});let v=p.map(Jt);return{...g,info:f,newParticipantIds:v}}function Aoe({entryStatus:t=Wo,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=it,tournamentRecord:r,event:a}){if(!r)return{error:Fe};if(!a)return{error:ji};let o=r.participants??[],s=o.filter(m=>m.participantType===Qt).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:Hs,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:Hs,invalidParticipantIdPairs:u};let c=o.filter(m=>m.participantType===Ot).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>Ln(g,m).length===2)).map(m=>({participantType:Ot,participantRole:la,individualParticipantIds:m})),p=Hl({participants:d,tournamentRecord:r});if(p.error)return p;let f=i.map(m=>{let{participant:g}=Gl({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),h=e.map(m=>({entryStatus:Xl,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...f,...h),{...re}}var gz={};Kt(gz,{addDrawDefinition:()=>$D,addEvent:()=>VD,addFlight:()=>rk,assignSeedPositions:()=>joe,attachFlightProfile:()=>Tz,categoryCanContain:()=>P_,deleteDrawDefinitions:()=>tk,deleteEvents:()=>Hoe,deleteFlightAndFlightDraw:()=>$oe,deleteFlightProfileAndFlightDraws:()=>Loe,getCategoryAgeDetails:()=>DD,getEvent:()=>pz,getEventProperties:()=>cz,getEventStructures:()=>I_,getEventTimeItem:()=>Y1,getEvents:()=>dz,getFlightProfile:()=>Gn,getScaledEntries:()=>nb,modifyEvent:()=>zoe,modifyEventMatchUpFormatTiming:()=>Foe,modifyPairAssignment:()=>Voe,mutate:()=>_oe,query:()=>Uoe,refreshEventDrawOrder:()=>Sz,removeEventMatchUpFormatTiming:()=>ik,removeScaleValues:()=>Uz,removeSeeding:()=>Goe,setEventDates:()=>Iz,setEventDisplay:()=>nk,setEventEndDate:()=>bz,setEventStartDate:()=>yz,updateDrawIdsOrder:()=>wz,validateCategory:()=>UM});var _oe={};Kt(_oe,{addDrawDefinition:()=>$D,addEvent:()=>VD,addFlight:()=>rk,assignSeedPositions:()=>joe,attachFlightProfile:()=>Tz,deleteDrawDefinitions:()=>tk,deleteEvents:()=>Hoe,deleteFlightAndFlightDraw:()=>$oe,deleteFlightProfileAndFlightDraws:()=>Loe,modifyEvent:()=>zoe,modifyEventMatchUpFormatTiming:()=>Foe,modifyPairAssignment:()=>Voe,refreshEventDrawOrder:()=>Sz,removeEventMatchUpFormatTiming:()=>ik,removeScaleValues:()=>Uz,removeSeeding:()=>Goe,setEventDates:()=>Iz,setEventDisplay:()=>nk,setEventEndDate:()=>bz,setEventStartDate:()=>yz,updateDrawIdsOrder:()=>wz,validateCategory:()=>UM});function F0({removePriorValues:t=!0,status:e=eu,statusObject:i,event:n}){if(!Ii(i))return{error:we};let r=dl({event:n,status:e}),a=`${Ug}.${Dg}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return tb({timeItem:o,removePriorValues:t,event:n})}function B0(t){var T,w,S,U,P,E,D;let e=Lt(t,[{[as]:!0,[By]:!0},{eventDataParams:!1,[ul]:us}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:n,tournamentRecord:r,status:a=eu,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:u}=mi({tournamentRecord:r,event:o}),c={...u,...t.policyDefinitions},d=((T=o==null?void 0:o.drawDefinitions)==null?void 0:T.map(({drawId:R})=>R))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],f=p.length?[]:t.drawIds,h=(l??[]).concat(...s??[],...f??[],...p),m=h.filter(R=>!d.includes(R));if(m.length)return le({result:{error:ms},context:{invalidDrawIds:m}});let g=dl({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(R=>d.includes(R)).reduce((R,N)=>(R[N]=g.drawDetails[N],R),{});for(let R of d)if((!h.length||h.includes(R))&&(s!=null&&s.includes(R)||f!=null&&f.length&&!f.includes(R)?v[R]={...v[R],publishingDetail:{published:!1}}:(l!=null&&l.includes(R)||f!=null&&f.includes(R)||!(f!=null&&f.length))&&(v[R]={...v[R],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[R]){let N=t.drawDetails[R],M=N.structureDetails??v[R].structureDetails,A=N.stageDetails??v[R].stageDetails??{},{structureIdsToRemove:_=[],structureIdsToAdd:k=[],publishingDetail:B={},stagesToRemove:F=[],stagesToAdd:x=[]}=N;if((k||x)&&(B.published=!0),v[R]={publishingDetail:B,structureDetails:M,stageDetails:A},k.length||_.length){let j=(((U=(S=o==null?void 0:o.drawDefinitions)==null?void 0:S.find(H=>H.drawId===R))==null?void 0:U.structures)??[]).map(({structureId:H})=>H),V=(k??[]).concat(_??[]).filter(H=>!j.includes(H));if(V.length)return le({result:{error:Sn},context:{invalidStructureIds:V}});M=M??{};for(let H of j)_.includes(H)?M[H]={published:!1}:M[H]={published:!0};v[R].structureDetails=M}let $=(((E=(P=o==null?void 0:o.drawDefinitions)==null?void 0:P.find(j=>j.drawId===R))==null?void 0:E.structures)??[]).map(({stage:j})=>j);if(x.length){for(let j of x)A[j]={published:!0};for(let j of $)A[j]||(A[j]={published:!1})}if(x.length||F.length){for(let j of F)A[j]={published:!1};for(let j of $)A[j]||(A[j]={published:!0})}(x.length||F.length)&&(v[R].stageDetails=A)}F0({statusObject:{drawDetails:v},removePriorValues:n,status:a,event:o});let{topics:y}=sl(),b=y.includes(S2),I=b||t.returnEventData?(D=q_({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:r,policyDefinitions:c,event:o}))==null?void 0:D.eventData:void 0;return b&&jt({payload:{eventData:I,tournamentId:r.tournamentId},topic:S2}),{...re,eventData:I}}var koe="deleteDrawDefinitions",Ooe="autoSchedulingAudit",J2="deleteEvents",xoe={AUTO_SCHEDULING_AUDIT:Ooe,DELETE_EVENTS:J2,DELETE_DRAW_DEFINITIONS:koe};function tk(t){var U,P,E;if(!t.tournamentRecord)return{error:Fe};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:u}=mi({tournamentRecord:a,event:n}),c={...u,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let D=ho({tournamentRecord:a,eventId:s,drawId:d});if(D.error)return D;n=D.event}let p=[],f=[],h=[];if(!(n!=null&&n.drawDefinitions))return le({info:"event has no drawDefinition",result:{...re},stack:e});let m=n.drawDefinitions.map(({drawId:D})=>D);if(i.length||(i=m),i=i.filter(D=>m.includes(D)),!i.length)return le({info:"nothing to do; no matching drawIds in event.",result:{...re},stack:e});let g=st(Gn({event:n}).flightProfile,!1,!0),v=({participantId:D,drawPosition:R,qualifier:N,bye:M})=>({bye:M,qualifier:N,drawPosition:R,participantId:D}),y=l??((P=(U=u==null?void 0:u[Js])==null?void 0:U.allowDeletionWithScoresPresent)==null?void 0:P.drawDefinitions),b=dl({event:n})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],T,w=[],S=n.drawDefinitions.filter(D=>{var R,N,M,A,_,k,B,F;if(i.includes(D.drawId)){let x=((R=za({event:n,drawDefinition:D}))==null?void 0:R.matchUps)??[];if(x.some(({score:X})=>Kr({score:X}))&&!y)return w.push(D.drawId),!0;let{drawId:$,drawType:j,drawName:V}=D,H=(N=g==null?void 0:g.flights)==null?void 0:N.find(X=>X.drawId===D.drawId);H&&(H.drawEntries=(M=H.drawEntries)==null?void 0:M.filter(X=>Jl.includes(X.entryStatus))),I.includes($)&&(I=I.filter(X=>X!==$),T=!0);let z=(_=(A=wd({stageSequence:1,drawDefinition:D,stage:it}))==null?void 0:A.structures)==null?void 0:_[0],q=(B=(k=z?UU({structureId:z.structureId,tournamentRecord:a,drawDefinition:D}):void 0)==null?void 0:k.positionAssignments)==null?void 0:B.map(v),W=(F=wd({stage:gt,drawDefinition:D}))==null?void 0:F.structures,Y=W!=null&&W.length?W.map(X=>{var ce;let Q=X.stageSequence;return{positionAssignments:(ce=UU({structureId:X.structureId,tournamentRecord:a,drawDefinition:D}))==null?void 0:ce.positionAssignments.map(v),stageSequence:Q}}):void 0,Z={action:koe,payload:{drawDefinitions:[D],eventId:s??(n==null?void 0:n.eventId),auditData:o}};h.push(Z),p.push(pt({tournamentId:a.tournamentId,eventId:s??(n==null?void 0:n.eventId),qualifyingPositionAssignments:Y,positionAssignments:q,auditData:o,drawType:j,drawName:V,drawId:$})),x==null||x.forEach(({matchUpId:X})=>f.push(X))}return!i.includes(D.drawId)});if(w.length&&!l)return le({context:{drawIdsWithScoresPresent:w},result:{error:BA},stack:e});if(n.drawDefinitions=S,g&&Rh({event:n,extension:{name:Vl,value:g}}),xD({tournamentRecord:a}),T){let D={};for(let N of I)D[N]=((E=b.drawDetails)==null?void 0:E[N])??{published:!0};let R=F0({statusObject:{drawDetails:D},event:n});if(R.error)return{error:R.error}}if(h.length&&jt({topic:iw,payload:h}),f.length&&Wp({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:f}),i.forEach(D=>kPe({drawId:D})),LAe({appliedPolicies:u,event:n,deletedDrawsDetail:p,auditData:o}),r&&T){let D=B0({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:c,tournamentRecord:a,event:n});if(D.error)return{...re,info:D.error}}return{...re}}function LAe({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:n}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[wT])===!1)return;let{extension:r}=$t({name:wT,element:e}),a={...n,deletedDrawsDetail:i},o={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(a):[a],name:wT};fi({element:e,extension:o})}function Loe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var o;if(!e)return{error:Fe};if(!n)return{error:ji};let{flightProfile:a}=Gn({event:n});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:u})=>u).filter(Boolean),l=tk({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:WA({event:n,name:Vl})}return{...re}}function vz(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Cn};let s=Object.keys(o).filter(u=>!r||r===u);if(r&&!s.includes(r))return{error:we};let l;for(let u of s){let c=o[u],{event:d}=ho({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=FAe({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...re}:{error:zo}}function FAe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:Fe};if(n&&!Array.isArray(n))return{error:we};if(e&&!Array.isArray(e))return{error:we};let a=Ip;if(r){let{extension:o}=$t({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=o9({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});fi({element:r,extension:{name:a,value:l}})}else{let{extension:o}=$t({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=o9({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});fi({extension:{name:a,value:l},element:t})}return{...re}}function o9(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Foe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:Fe};if(!Zo({matchUpFormat:r}))return{error:we};if(!s)return{error:ji};let{averageTimes:l=[],recoveryTimes:u=[]}=X_({tournamentRecord:e,matchUpFormat:r,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(St(n)),g=i&&!isNaN(St(i)),v=l.map(h).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=u.map(h).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||sn]:n}),v.push(p)),g&&(Object.assign(f.minutes,{[(s==null?void 0:s.eventType)||sn]:i}),y.push(f)),!m&&!g?{error:we}:vz({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function ik(t){if(t.event)return s9({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Lt(t,[{[Ua]:!0,[pte]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=ho({tournamentRecord:r,eventId:n});if(a)return s9({event:a})}}return{error:zo}}function s9({event:t}){return WA({event:t,name:Ip})}function yz({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Fe};if(!e)return{error:ji};if(!gd.test(i))return{error:Ka};let n=Boe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Ft(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ka};let s=e.endDate&&new Date(Ft(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...re}}function bz({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:Fe};if(!e)return{error:ji};if(!gd.test(i))return{error:Ka};let n=Boe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Ft(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ka};let s=e.startDate&&new Date(Ft(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...re}}function Iz({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:Fe};if(!e)return{error:ji};if(!i&&!n)return{error:ht,info:"missing date"};if(i&&!gd.test(i))return{error:Ka};if(n&&!gd.test(n))return{error:Ka};if(i&&n){let r=new Date(Ft(i)).getTime(),a=new Date(Ft(n)).getTime();if(r>a)return{error:we}}if(i){let r=yz({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=bz({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...re}}function Boe(t){let{startDate:e,endDate:i}=t;return!gd.test(e)||!gd.test(i)?le({result:{error:uee},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Ft(e)).getTime(),tournamentEndDate:new Date(Ft(i)).getTime()}}function wz({event:t,orderedDrawIdsMap:e}){var r,a;if(typeof t!="object")return{error:ji};if(!e)return{error:ht,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:we,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:we,info:"drawOrder must be numeric"};if(Vt(i).length!==i.length)return{error:we,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Ln(o,s).length!==o.length)return{error:we,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:n}=Gn({event:t});return(a=n==null?void 0:n.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...re}}function Sz({tournamentRecord:t,event:e}){var r;if(!t)return{error:Fe};if(!e)return{error:ji};let{flightProfile:i}=Gn({event:e}),n=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?wz({event:e,orderedDrawIdsMap:n}):{...re}}function $oe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var s,l;if(!e)return{error:Fe};if(!n)return{error:qu};if(!r)return{error:ji};let{flightProfile:o}=Gn({event:r});if(o&&((s=o.flights)!=null&&s.find(u=>u.drawId===n))){let u=o.flights.filter(d=>d.drawId!==n),c={name:Vl,value:{...o,flights:u}};Rh({event:r,extension:c})}if((l=r.drawDefinitions)!=null&&l.find(u=>u.drawId===n)){let u=tk({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(u.error)return u}return Sz({tournamentRecord:e,event:r})}function Voe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var h,m;if(!a)return{error:ji};if((a==null?void 0:a.eventType)!==Zs)return{error:vp};if(o&&!Array.isArray(o))return{error:we};if(!i)return{error:Fe};if(![t,e,r].every(g=>typeof g=="string"))return{error:cr};if(!(((h=a==null?void 0:a.entries)==null?void 0:h.filter(({entryStatus:g})=>[Xl,Sg].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:ku};let s=(i.participants||[]).find(g=>g.participantId===r);if((s==null?void 0:s.participantType)!==Ot)return{error:ky,participant:s};let l=s.individualParticipantIds,u=[t,...l.filter(g=>g!==e)],{participant:c}=Gl({participantIds:u,tournamentRecord:i}),d;if(c)d=c.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:la,individualParticipantIds:u,participantType:Ot},v=bc({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;d=v.participant.participantId}let{flightProfile:p}=Gn({event:a});if(n){let g=(m=p==null?void 0:p.flights)==null?void 0:m.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:d}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:d}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:d}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:d}:b)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:d}||g.participantId===t&&{...g,participantId:e}||g);let f=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:b,entries:I})=>b===(n==null?void 0:n.drawId)?!1:I==null?void 0:I.find(T=>T.participantId===r)):g==null?void 0:g.find(b=>b.participantId===r));if(!f){let g=Xy({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...re,participantOtherEntries:f,newPairParticipantId:d}}function $D(t){var R,N,M,A,_,k,B,F,x,$,j,V;let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:u}=t;if(!l)return{error:ot};if(!u)return{error:ji};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:c,drawName:d,entries:p}=l,{entries:f}=u,h=0;if(r!==void 0&&r!==u.drawDefinitions.length)return{error:we,info:"drawDefintions count mismatch"};let{flightProfile:m}=Gn({event:u}),g=e&&((R=m==null?void 0:m.flights)==null?void 0:R.find(H=>H.flightNumber===e.flightNumber)),v=(A=(M=(N=m==null?void 0:m.links)==null?void 0:N.find(H=>{var z;return((z=H==null?void 0:H.target)==null?void 0:z.drawId)===c}))==null?void 0:M.source)==null?void 0:A.drawId;if(v&&!u.drawDefinitions.find(H=>H.drawId===v))return le({result:{error:ot},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return le({result:{error:bv},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:H,entryStatus:z})=>{let q=g==null?void 0:g.drawEntries.find(W=>W.participantId===H);return!z||(q==null?void 0:q.entryStatus)===z}),b=!o||f&&(p==null?void 0:p.every(({participantId:H,entryStatus:z,entryStage:q})=>{var W;return((W=f.find(Y=>Y.participantId===H&&(!Y.entryStage||Y.entryStage===q)))==null?void 0:W.entryStatus)===z}));if(g&&!y)return le({result:{error:bv},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&(p==null||p.filter(Boolean).forEach(H=>{if(H!=null&&H.entryStatus&&Jl.includes(H==null?void 0:H.entryStatus)){let z=f==null?void 0:f.filter(Boolean).find(q=>q.participantId===H.participantId);z&&H.entryStatus&&(z==null?void 0:z.entryStatus)!==H.entryStatus&&(z.entryStatus=H.entryStatus,h+=1)}})),f&&!b)return le({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:f},error:bv}});let I=((k=(_=m==null?void 0:m.flights)==null?void 0:_.map(({flightNumber:H})=>!isNaN(H)&&St(H)))==null?void 0:k.filter(Boolean))||[],T=((B=u.drawDefinitions.map(({drawOrder:H})=>H&&St(H)))==null?void 0:B.filter(Boolean))||[],w=Math.max(0,...T,...I)+1,S=(F=m==null?void 0:m.flights)==null?void 0:F.find(H=>H.drawId===c),U;if(S){S.drawName=l.drawName,U={name:Vl,value:{...m,flights:m.flights}};let H=S.flightNumber;H&&!T.includes(H)?w=H:S.flightNumber=w}else{let H=(m==null?void 0:m.flights)||[];H.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:c}),U={name:Vl,value:{...m||{},flights:H}}}Rh({event:u,extension:U}),Object.assign(l,{drawOrder:w});let P=u.drawDefinitions.find(H=>H.drawId===c),E=s==null?void 0:s.tournamentId,D=u.eventId;if(P){if(!a)return{error:VQ};let H=(($=(x=za({drawDefinition:P}))==null?void 0:x.matchUps)==null?void 0:$.map(Nr))??[],z=(j=za({drawDefinition:l}))==null?void 0:j.matchUps;if(!i){H!=null&&H.length&&Wp({matchUpIds:H,action:"modifyDrawDefinition",tournamentId:E,eventId:D}),z!=null&&z.length&&ih({matchUps:z,tournamentId:E,eventId:D}),u.drawDefinitions=u.drawDefinitions.map(W=>W.drawId===c?l:W);let q=(V=l.structures)==null?void 0:V.map(({structureId:W})=>W);Ji({drawDefinition:l,tournamentId:E,structureIds:q,eventId:D})}}else if(u.drawDefinitions.push(l),!i){let{matchUps:H}=za({drawDefinition:l,event:u});H&&ih({tournamentId:s==null?void 0:s.tournamentId,matchUps:H}),W1({drawDefinition:l,tournamentId:E,eventId:D})}return{...re,modifiedEventEntryStatusCount:h}}function joe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:jV};if(!n)return{error:Fe};if(!l)return{error:qu};let d=tl({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;f&&y<=f&&(!i||h[y])&&(h[y]=v)});let m=Object.values(h),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==Kee(g).length)return{error:jQ};for(let v of m){let y=_0({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...re,modifications:c}:{error:h0}}function Tz({deleteExisting:t,event:e,flightProfile:i}){var a;let n="attachFlightProfile";if(!i)return le({result:{error:ht},stack:n});if(!e)return le({result:{error:ji},stack:n});let{flightProfile:r}=Gn({event:e});return r&&!t?le({result:{error:sj},stack:n}):(a=e.drawDefinitions)!=null&&a.length?le({result:{error:FQ},stack:n}):(Rh({event:e,extension:{name:Vl,value:i}}),{flightProfile:st(i,!1,!0),...re})}function BAe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:Fe};if(!i)return{error:Dh};if(!e)return{error:ht,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:a}=e,o=[die,n,r,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==o))}),{...re}}function Uz({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var u;if(!a)return{error:ji};if(n&&!Array.isArray(n))return le({result:{error:we},info:Td("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(r){let{flightProfile:c}=Gn({event:a}),d=(u=c==null?void 0:c.flights)==null?void 0:u.find(p=>p.drawId===r);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!n||n.includes(c.entryStatus))).map(Jt);return BAe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function nk({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=eu,event:r}){if(!e)return le({result:{error:Fe}});if(!r)return le({result:{error:ji}});if(!Ii(i))return le({result:{error:ht}});if(Ii(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>F1e(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=F0({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...re}}function Goe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var l,u;if(!t)return{error:Fe};if(!a)return{error:ji};n=n||((l=a.category)==null?void 0:l.categoryName)||((u=a.category)==null?void 0:u.ageCategoryCode);let s={eventType:a.eventType,scaleType:td,scaleName:n};return Uz({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function Hoe({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:Fe};if(!e.events)return{error:zo};if(!Array.isArray(i))return{error:ht,info:Td("drawIds")};let n=[],r=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let c={action:J2,payload:{events:[s]}};n.push(c),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===Zs?(s.entries||[]).map(({entryStatus:c,participantId:d})=>c!==Xl&&d).filter(Boolean):[],u=i.includes(s.eventId);return u?o.push(...l):a.push(...l),!u}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return xD({tournamentRecord:e}),n.length&&(jt({topic:iw,payload:n}),eb({tournamentRecord:e,timeItem:{itemType:J2,itemValue:r}})),{...re}}function zoe(t){var f;let e=Lt(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:us}]);if(e.error)return e;let{tournamentRecord:i,eventUpdates:n,event:r}=t,a="modifyEvent";if(n.startDate||n.endDate){let h=Iz({startDate:n.startDate,endDate:n.endDate,tournamentRecord:i,event:r});if(h.error)return le({result:h,stack:a})}let o=((f=r==null?void 0:r.entries)==null?void 0:f.filter(({entryStatus:h})=>{let m=h;return[...Jl,Al].includes(m)}).map(({participantId:h})=>h))??[],s=o?Bn({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[],l=[],u=s.reduce((h,m)=>{var v,y;let g=(v=m.person)!=null&&v.sex?[m.person.sex]:((y=m.individualParticpants)==null?void 0:y.map(b=>{var I;return(I=b.person)==null?void 0:I.sex}))||[];return l.push(...g),h.includes(m.participantType)?h:h.concat(m.participantType)},[]),c=Vt(l),d=!c.length||[Po,Lu].includes(n.gender??"")||c.length===1&&c[0]===n.gender;if(n.gender&&!d)return le({context:{gender:n.gender,validGender:d},result:{error:we},stack:a});let p=(u.includes(vr)&&[vr]||u.includes(Qt)&&[hc]||u.includes(Ot)&&[Zs]||[Zs,hc,vr]).includes(n.eventType??"");return n.eventType&&!p?le({context:{participantType:n.eventType,validEventType:p},result:{error:we},stack:a}):(n.eventType&&(r.eventType=n.eventType),n.eventName&&(r.eventName=n.eventName),n.gender&&(r.gender=n.gender),{...re})}function rk({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var f,h,m;let o="addFlight";if(!r)return le({result:{error:ji},stack:o});if(!i)return le({result:{error:ht},stack:o});if(e!=null&&e.length){let g=(r.entries??[]).map(Jt),v=e.map(Jt);if(Ln(v,g).length!==v.length)return le({result:{error:we},stack:o})}let s=(f=Gn({event:r}))==null?void 0:f.flightProfile,l=((m=(h=s==null?void 0:s.flights)==null?void 0:h.map(({flightNumber:g})=>!isNaN(g)&&St(g)))==null?void 0:m.filter(Boolean))||[],u=Math.max(0,...l)+1,c={drawId:n||Mi(),flightNumber:u,drawEntries:e,drawName:i};if(a&&(c.stage=a),t&&(c.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===c.drawId))return le({result:{error:Fee},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(c),p={name:Vl,value:{...s||{},flights:d}};return Rh({event:r,extension:p})}var $Ae={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},VAe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},jAe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},qoe={COLLEGE_D3:$Ae,COLLEGE_DEFAULT:VAe,COLLEGE_JUCO:jAe,DOMINANT_DUO:Rae,DOMINANT_DUO_MIXED:Dae,LAVER_CUP:kae,TEAM_DOUBLES_3_AGGREGATION:Iae,TIME_TENNIS_DUAL:Pae,TIME_TENNIS_PRO_CIRCUIT:Uae,USTA_BREWER_CUP:Eae,USTA_OZAKI_CUP:Cae,USTA_COLLEGE:Mae,USTA_GOLD_TEAM_CHALLENGE:bae,USTA_INTERSECTIONAL:Tae,USTA_LEVEL_1:Nae,USTA_SECTION_BATTLE:Sae,USTA_SOUTHERN_LEVEL_5:wae,USTA_TOC:Oae,USTA_WTT_ITT:Aae,USTA_ZONAL:_ae};function VD({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var s,l,u,c;if(!e)return{error:Fe};if(e.events||(e.events=[]),!n)return{error:ji};let{startDate:r,endDate:a}=e;if(!i&&((s=n.entries)!=null&&s.length||(l=n.drawDefinitions)!=null&&l.length)){let d=pt({drawDefinitions:!!((u=n.drawDefinitions)!=null&&u.length),entries:!!((c=n.entries)!=null&&c.length)});return{info:"entries/drawDefinitions cannot exist",error:we,context:d}}let o={eventType:Wv,drawDefinitions:[],entries:[],startDate:r,endDate:a,...n};if(n.eventType===Xs){if(n.tieFormat){let d=Mo({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!qoe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:we};let d=Xm({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});o.tieFormat=d}}if(o.eventId||(o.eventId=Mi()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:XQ};{let d=o;if(e.events.push(d),!t){let{topics:p}=sl();if(p.includes(i_)){let f=Xp({event:n}).matchUps??[];ih({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:f})}for(let f of n.drawDefinitions||[])W1({drawDefinition:f})}return{...re,event:o}}}var Dz={};Kt(Dz,{drawMatic:()=>kH,garman:()=>Qoe,generateAdHocMatchUps:()=>k_,generateAdHocRounds:()=>_H,generateAndPopulatePlayoffStructures:()=>rH,generateCourts:()=>Pz,generateDrawDefinition:()=>BD,generateDrawMaticRound:()=>TH,generateDrawStructuresAndLinks:()=>IH,generateDrawTypeAndModifyDrawDefinition:()=>wH,generateFlightProfile:()=>HAe,generateLineUps:()=>Joe,generateQualifyingStructure:()=>YG,generateSeedingScaleItems:()=>Poe,generateVoluntaryConsolation:()=>Cre,roundRobinGroups:()=>aCe});var GAe="splitLevelBased",Woe="splitWaterfall",Koe="splitShuttle",Yoe={SPLIT_LEVEL_BASED:GAe,SPLIT_WATERFALL:Woe,SPLIT_SHUTTLE:Koe};function HAe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:ji};let h=p.entries??[],{flightProfile:m}=Gn({event:p});if(m&&i&&!o)return{error:sj};let g=t.scaledEntries??nb({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:f}).scaledEntries,v=g.map(Jt),y=Ga(h.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!f||!E.entryStage||E.entryStage===f)&&(!E.entryStatus||Tg.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/u),w=zr(b,T);c===Woe?w=v2(b,u):c===Koe&&(w=v2(b,u,!0));function S(E){return(E||[]).map(({participantId:D,scaleValue:R})=>{let N=h.find(M=>M.participantId===D);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((D,R)=>D.scaleValue-R.scaleValue).map((D,R)=>(D.scaleValue&&(D.seedNumber=R+1),D))}let U=Xe(0,u).map(E=>{let D=E+1;return{flightNumber:D,drawId:(d==null?void 0:d.pop())??Mi(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${D}`}}),P={scaleAttributes:r,splitMethod:c,flights:U};if(i){let E=Tz({flightProfile:P,deleteExisting:o,event:p});return{splitEntries:gs()&&w||void 0,...E}}else return{flightProfile:P,...re}}var zAe="ASC",Zoe="ASC",qAe="DESC",Q2="DESC",Xoe={ASC:zAe,ASCENDING:Zoe,DESC:qAe,DESCENDING:Q2};function Joe(t){var D,R,N,M,A;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Xs)return{error:vp};if(!n)return{error:Fe};if(!e&&!r)return{error:ms};if(e=e??((D=Aa({drawDefinition:r,event:l}))==null?void 0:D.tieFormat),Mo({tieFormat:e}).error)return{error:Xd};if(typeof a!="object"&&!i)return{error:we,context:{scaleAccessor:a}};let u={},c=((r==null?void 0:r.entries)??(l==null?void 0:l.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===Wo).map(Jt),{participants:d=[]}=Bn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:_})=>c.includes(_)),f=_=>_===Jf?"rankings":"ratings",h=((R=l==null?void 0:l.category)==null?void 0:R.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:m=h,scaleType:g=Jf,sortOrder:v,accessor:y}=a||{},b=f(g),I=(_,k)=>{var F,x,$;let B=(F=_[b])==null?void 0:F[k];if(!B&&i&&(B=(x=_[b])==null?void 0:x[wv]),Array.isArray(B)){let j=($=B.find(V=>V.scaleName===m))==null?void 0:$.scaleValue;if(Dn(j))return j;if(y&&typeof j=="object")return j[y]}return 0},T=(_,k,B)=>{let F=v===Q2?k:_,x=v===Q2?_:k;return I(F,B)-I(x,B)},w=(_,k)=>T(_,k,wv),S=(_,k)=>T(_,k,jm),U=[],P=(e==null?void 0:e.collectionDefinitions)??[];for(let _ of p){let k=((M=_.individualParticipants)==null?void 0:M.sort(w))??[],B=o?k:((A=_.individualParticipants)==null?void 0:A.sort(S))??[],F={};for(let $ of P){let j=[],{collectionId:V,matchUpCount:H,matchUpType:z,gender:q}=$,W=On(wv)(z);Xe(0,H).forEach(Y=>{let Z=W?k:B??[],X=Y+1,Q=[];Xe(0,W?1:2).forEach(ce=>{var ee;let J=(ee=Z==null?void 0:Z.find(ne=>{var oe;let ie=q&&([zi,pn].includes(q)&&q||q===Po&&[zi,pn][ce]);return(!ie||ie===((oe=ne.person)==null?void 0:oe.sex))&&!j.includes(ne.participantId)}))==null?void 0:ee.participantId;J&&(Q.push(J),j.push(J),F[J]||(F[J]=[]),F[J].push({collectionPosition:X,collectionId:V}))}),W||U.push(Q)})}let x=Object.keys(F).map($=>({collectionAssignments:F[$],participantId:$}));u[_.participantId]=x}let E=[];for(let _ of U){let{participant:k}=Gl({tournamentParticipants:d,participantIds:_});if(!k){let B={individualParticipantIds:_,participantRole:la,participantType:Ot};E.push(B)}}if(s){for(;E.length;)bc({participant:E.pop(),tournamentRecord:n});fi({element:r,extension:{name:bp,value:u}})}return{...re,lineUps:u,participantsToAdd:E}}function Pz(t){if(!t)return{error:ht};let e=Lt(t,[{dates:!1,[ks]:o=>Array.isArray(o)&&o.every(Go)},{uuids:!1,[ks]:o=>Array.isArray(o)&&o.every(zn)},{startTime:!1,endTime:!1,[ks]:Ej},{idPrefix:!1,namePrefix:!1,[ks]:zn},{count:!0,[ks]:Dn}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&YI(i,n)||[],a=Xe(1,t.count+1).map(o=>{var s,l;return pt({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Mi(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...re,courts:a}}var Qoe={};Kt(Qoe,{default:()=>YAe,garman:()=>ise});function jD({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>vd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function $0(t){let e=Lt(t,[{courtDate:!0,_ofType:us}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=er(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>lM(s.startTime).localeCompare(lM(l.startTime))).forEach(s=>{let l={startTime:nn(a.toISOString()),endTime:s.startTime};er(s.startTime)>a&&r.push(l),er(s.endTime)>a&&(a=er(s.endTime))});let o={startTime:nn(a.toISOString()),endTime:n.endTime};return er(n.endTime)>a&&r.push(o),{timeSlots:r}}function WAe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var l;let{timeSlots:s}=$0({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=er(o.startTime),l=er(o.endTime);return s>i||l<n?!1:$1(i,l)>=t}return{enoughTime:r}}function ese(t){let e=Lt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:uo}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=er(r),l=Cj(s,i),{enoughTime:u}=WAe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=jD({date:a,court:c});return!!(d&&u(d))}))||[]).length,...re}}function ak(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:we,courts:a};if(!Array.isArray(o))return{error:iM};if(!Go(r))return{error:Ka};i&&(Array.isArray(i)?i.includes(r)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((f,h)=>{let{courtId:m}=h;return m?f.courtBookings[m]?f.courtBookings[m].push(h):f.courtBookings[m]=[h]:f.unassignedBookings.push(h),f},{courtBookings:{},unassignedBookings:[]}),u=a.map((f,h)=>{let{courtId:m,courtName:g}=f,v=s[m]||[],y=jD({date:r,court:f})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[e[h]&&{startTime:I,endTime:e[h]},...st(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});l.sort((f,h)=>li(f.startTime)-li(h.startTime));let c=()=>u.map(f=>{let h=f.dateAvailability,{timeSlots:m=[]}=$0({courtDate:h});return{courtName:f.courtName,courtId:f.courtId,timeSlots:m}}).flat(),d=[];for(let f of l){let{startTime:h,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=f,b=li(h),I=li(m),T=c().reduce((w,{courtId:S,courtName:U,timeSlots:P})=>{let E;return P.find(({startTime:D,endTime:R})=>{E=li(D)-b;let N=b>=li(D);return I<=li(R)&&w.startDifference!==0&&((E===0||E+n>=0)&&(w.startDifference===void 0||E<w.startDifference)||N)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:m};d.push(w),(p=u.find(({courtId:S})=>S===T.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:f})}return{virtualCourts:u.map(({courtId:f,courtName:h,dateAvailability:m})=>({dateAvailability:[m],courtName:h,courtId:f})),assignedBookings:d}}function ok({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function tse(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Xe(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function uw({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=jD({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&li(l)<li(a)||i&&li(l)>li(a))?l:a},void 0)}function KAe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||uw({courts:n,scheduleDate:r,startTime:!0}),i=i||uw({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=er(e),s=er(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let u=jD({court:l,date:r}),{timeSlots:c}=$0({courtDate:u});c==null||c.forEach(d=>{let p=er(d.startTime),f=er(d.endTime);if(p>s||p<o||f<o)return!1;if($1(p,f)>=t){let h=nn(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function Ez(t){let e=Lt(t,[{courts:!0,_ofType:uo}]);if(e.error)return e;let{date:i=Pj(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||ok({averageMatchUpMinutes:u}),i=Ft(i),n=nn(n),r=nn(r);let f=0,h=0,m=0,g=0,v=0;!o&&d&&(o=tse({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=ak({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:b}=KAe({averageMinutes:u,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);let I=li(n),T=li(r)-I,w=Math.floor(T/a),S=Xe(0,w+1).map(U=>{let P=I+U*a,E=aPe(P),D=ese({courts:y??[],averageMatchUpMinutes:u,periodStart:E,date:i});if(D.error)return{error:D.error};let{availableToScheduleCount:R=0}=D,N=R>h?R-h:0;v+=U?R:0;let M=U?v/U:R,A=a*M/u,_=U?A*(U-1)+M:M,k=R?h&&_-f||N:0;f=_,h=R,m+=k;let B=St(m)-g;return g+=B,{periodStart:E,add:B,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,P)=>{let E=Xe(0,P.add).map(()=>({scheduleTime:P.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var ise={getCourtsAvailableAtPeriodStart:ese,generateTimeSlots:$0,getScheduleTimes:Ez,courtGenerator:tse},YAe=ise,Ep={};Kt(Ep,{isValid:()=>Zo,isValidMatchUpFormat:()=>Zo,parse:()=>yo,stringify:()=>D_});var Cz={};Kt(Cz,{allCompetitionMatchUps:()=>Fu,allDrawMatchUps:()=>za,allEventMatchUps:()=>Xp,allTournamentMatchUps:()=>Wr,analyzeMatchUp:()=>CU,applyLineUps:()=>Use,assignMatchUpSideParticipant:()=>rse,assignTieMatchUpParticipantId:()=>_M,bulkMatchUpStatusUpdate:()=>Ise,calculateWinCriteria:()=>ab,checkInParticipant:()=>Mz,checkMatchUpIsComplete:()=>Rm,checkOutParticipant:()=>Rz,competitionScheduleMatchUps:()=>FD,disableTieAutoCalc:()=>vse,drawMatchUps:()=>lz,enableTieAutoCalc:()=>hse,eventMatchUps:()=>J_,findMatchUp:()=>qH,getAllDrawMatchUps:()=>pr,getAllStructureMatchUps:()=>Ei,getCheckedInParticipantIds:()=>Wy,getCompetitionMatchUps:()=>EU,getEventMatchUpFormatTiming:()=>QH,getHomeParticipantId:()=>c_,getMatchUpCompetitiveProfile:()=>aD,getMatchUpContextIds:()=>rz,getMatchUpDailyLimits:()=>ek,getMatchUpDailyLimitsUpdate:()=>ez,getMatchUpDependencies:()=>tu,getMatchUpFormat:()=>az,getMatchUpFormatTiming:()=>oD,getMatchUpFormatTimingUpdate:()=>JH,getMatchUpScheduleDetails:()=>d_,getMatchUpType:()=>f_,getMatchUpsStats:()=>oz,getModifiedMatchUpFormatTiming:()=>X_,getParticipantResults:()=>UD,getPredictiveAccuracy:()=>nz,getRoundMatchUps:()=>Za,getRounds:()=>sz,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>A_,mutate:()=>nse,participantScheduledMatchUps:()=>tz,query:()=>boe,removeDelegatedOutcome:()=>mse,removeMatchUpSideParticipant:()=>_z,removeTieMatchUpParticipantId:()=>ose,replaceTieMatchUpParticipantId:()=>Az,resetAdHocMatchUps:()=>Sse,resetMatchUpLineUps:()=>$z,resetScorecard:()=>jz,resetTieFormat:()=>Vz,setDelegatedOutcome:()=>wse,setMatchUpFormat:()=>yse,setMatchUpStatus:()=>HD,setOrderOfFinish:()=>Tse,substituteParticipant:()=>gse,tallyParticipantResults:()=>O0,toggleParticipantCheckInState:()=>sk,tournamentMatchUps:()=>Q_,updateTieMatchUpScore:()=>Jp,validMatchUp:()=>p_,validMatchUps:()=>cl});var nse={};Kt(nse,{applyLineUps:()=>Use,assignMatchUpSideParticipant:()=>rse,assignTieMatchUpParticipantId:()=>_M,bulkMatchUpStatusUpdate:()=>Ise,checkInParticipant:()=>Mz,checkOutParticipant:()=>Rz,disableTieAutoCalc:()=>vse,enableTieAutoCalc:()=>hse,findMatchUp:()=>qH,removeDelegatedOutcome:()=>mse,removeMatchUpSideParticipant:()=>_z,removeTieMatchUpParticipantId:()=>ose,replaceTieMatchUpParticipantId:()=>Az,resetAdHocMatchUps:()=>Sse,resetMatchUpLineUps:()=>$z,resetScorecard:()=>jz,resetTieFormat:()=>Vz,setDelegatedOutcome:()=>wse,setMatchUpFormat:()=>yse,setMatchUpStatus:()=>HD,setOrderOfFinish:()=>Tse,substituteParticipant:()=>gse,toggleParticipantCheckInState:()=>sk,updateTieMatchUpScore:()=>Jp});function rse({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var u,c;if(i&&typeof i!="string")return{error:ku};if(!e)return{error:ot};if(!r)return{error:Ca};let o=n===void 0;if(o&&(n=1),![1,2].includes(n))return le({result:{error:we,context:{sideNumber:n}}});let{matchUp:s,structure:l}=rn({drawDefinition:e,matchUpId:r,event:a});if(!s)return{error:Ta};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==el)&&!((u=l==null?void 0:l.matchUps)!=null&&u.find(({roundPosition:d})=>!!d))))return{error:FV};if(!i&&((c=s==null?void 0:s.score)!=null&&c.scoreStringSide1||dr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[ir,br].includes(s.matchUpStatus)))return{error:_A,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var f;let p=((f=s.sides)==null?void 0:f.find(h=>h.sideNumber===d))??{sideNumber:d};return n===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);ci({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...re,sidesSwapped:o}}function Xo({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=rn({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:Ta};let u=kh({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||ci({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function Rz(t){var y;let e=[{[as]:!0},{[ll]:!0},{[hd]:!0},{[qp]:!0}],i=Lt(t,e);if(i.error)return i;let n=L0(t,[{[g0]:xd,attr:{[GA]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=n==null?void 0:n.matchUp)==null?void 0:y.matchUp,{matchUpStatus:u,score:c}=l??{};if(u&&XA.includes(u)||u&&dr.includes(u)||Kr({score:c}))return{error:zQ};let d=Wy({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:f}=d??{};if(!(f!=null&&f.includes(o)))return{error:ku};if(!(p!=null&&p.includes(o)))return{error:vee};let h=nie({matchUp:l});if(h!=null&&h.error)return h;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=h??{},v=m==null?void 0:m.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(b=>{Xo({drawDefinition:a,matchUpId:s,timeItem:{itemType:mM,itemValue:b}})}),Xo({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:mM}}),{...re,checkedOut:!0}}function Mz(t){var p;let e=[{[as]:!0},{[ll]:!0},{[hd]:!0},{[qp]:!0}],i=Lt(t,e);if(i[up])return i;let n=L0(t,[{[g0]:xd,attr:{[GA]:!0}}]);if(n[up])return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=Wy({matchUp:(p=n==null?void 0:n.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:c}=l??{};if(!(c!=null&&c.includes(o)))return{[up]:ku};let d={...re,checkedIn:!0};return u!=null&&u.includes(o)||Xo({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:hM}}),d}function sk(t){var u,c;let e=Lt(t,[{[hd]:!0,[ll]:!0,[qp]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&((u=t.tournamentRecords)==null?void 0:u[i]));if(!n)return{error:Fe};let r=(c=L0(t,[{[g0]:xd,attr:{[GA]:!0},[up]:Ta}]).matchUp)==null?void 0:c.matchUp;if(!r)return{error:Ta};let{checkedInParticipantIds:a=[]}=Wy({matchUp:r}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?Rz({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r}):Mz({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r})}function Nz({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var w,S;if(!t)return{error:Fe};if(!e)return{error:qu};if(!n)return{error:zo};let r=ga({drawDefinition:e}),{matchUp:a}=rn({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!a)return{error:Ta};let{matchUp:o,structure:s}=rn({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!o)return{error:Ta};let{collectionPosition:l,drawPositions:u,collectionId:c,matchUpTieId:d,matchUpType:p}=o;if(p&&!h_([sn,Wi],p))return{error:Co};let{positionAssignments:f}=Gi({structure:s}),h=f==null?void 0:f.filter(U=>u==null?void 0:u.includes(U.drawPosition)),{matchUp:m}=rn({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=((w=m==null?void 0:m.sides)==null?void 0:w.map(Jt))??[],v=(h==null?void 0:h.map(Jt))??[],y=[...g,...v],{participants:b}=Bn({tournamentRecord:t,participantFilters:{participantTypes:[Fi],participantIds:y}}),{matchUp:I}=rn({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),T=(S=Aa({matchUp:m,drawDefinition:e,structure:s,event:n}))==null?void 0:S.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:o,relevantAssignments:h,collectionPosition:l,teamParticipants:b,collectionId:c,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:T,structure:s,...re}}function Az(t){var B,F,x,$,j,V,H,z,q,W,Y,Z,X,Q,ce,J;let e=Nz(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!n||!a)return le({result:{error:cr},stack:i});if(n===a)return{...re};let{inContextDualMatchUp:u,inContextTieMatchUp:c,collectionPosition:d,collectionId:p,dualMatchUp:f,tieMatchUp:h,tieFormat:m}=e,g=c==null?void 0:c.matchUpType,v=(B=c==null?void 0:c.sides)==null?void 0:B.find(ee=>{var ne,ie,oe;return((ne=ee.participant)==null?void 0:ne.participantId)===n||((oe=(ie=ee.participant)==null?void 0:ie.individualParticipantIds)==null?void 0:oe.includes(n))});if(!v)return{error:_n};let y=((F=Bn({tournamentRecord:r,participantFilters:{participantIds:[n,a]}}))==null?void 0:F.participants)??[];if(y.length!==2)return le({result:{error:cr},stack:i});if(y[0].participantType!==y[1].participantType)return le({result:{error:Ou},stack:i});let{appliedPolicies:b}=mi({tournamentRecord:r,drawDefinition:o,event:l}),I=((x=t.policyDefinitions)==null?void 0:x[Br])??(b==null?void 0:b[Br])??A0[Br],T=y.find(({participantId:ee})=>ee===a);if((t.enforceGender??(($=I==null?void 0:I.participants)==null?void 0:$.enforceGender))!==!1&&[zi,pn].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((j=T==null?void 0:T.person)==null?void 0:j.sex))return{error:ky,info:"Gender mismatch"};let w=(V=I==null?void 0:I.processCodes)==null?void 0:V.substitution;CD({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:f});let S=(H=f==null?void 0:f.sides)==null?void 0:H.find(({sideNumber:ee})=>ee===v.sideNumber);if(!S)return le({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:Hr},stack:i});if((q=(z=c==null?void 0:c.sides)==null?void 0:z.flatMap(ee=>{var ne,ie;return((ne=ee.participant)==null?void 0:ne.individualParticipantIds)||((ie=ee.participant)==null?void 0:ie.participantId)||[]}))!=null&&q.includes(a))return le({result:{error:kA},stack:i});let U=(Y=(W=u==null?void 0:u.sides)==null?void 0:W.find(({sideNumber:ee})=>ee===v.sideNumber))==null?void 0:Y.participantId,P=S.lineUp,E=P==null?void 0:P.find(({participantId:ee})=>a===ee),D=P==null?void 0:P.reduce((ee,ne)=>ne.substitutionOrder>ee?ne.substitutionOrder:ee,0),R=(P==null?void 0:P.map(ee=>{var ie;let ne=st(ee,!1,!0);if(![n,a].includes(ne.participantId))return ne;if(!s&&[n,a].includes(ne.participantId)&&(ne.collectionAssignments=(ie=ne.collectionAssignments)==null?void 0:ie.filter(oe=>!(oe.collectionPosition===d&&oe.collectionId===p))),s&&n===ne.participantId&&(ne.collectionAssignments=ne.collectionAssignments.map(oe=>oe.collectionPosition===d&&oe.collectionId===p&&oe.substitutionOrder===void 0?{...oe,substitutionOrder:D}:oe)),ne.participantId===a){ne.collectionAssignments||(ne.collectionAssignments=[]);let oe={collectionId:p,collectionPosition:d};s&&(oe.previousParticipantId=n,oe.substitutionOrder=(D??0)+1),ne.collectionAssignments.push(oe)}return ne}))??[];if(!E){let ee={collectionId:p,collectionPosition:d};s&&(ee.substitutionOrder=(D??0)+1,ee.previousParticipantId=n);let ne={collectionAssignments:[ee],participantId:a};R.push(ne)}let N=g===Wi,{assignedParticipantIds:M}=gM({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=gM({lineUp:R,collectionPosition:d,collectionId:p});if(S.lineUp=R,U&&m){let ee=Qy({participantId:U,lineUp:R,drawDefinition:o,tieFormat:m});if(ee.error)return le({result:ee,stack:i})}else console.log("team participantId not found");let _,k;if(N){let{tournamentRecord:ee}=t,ne=Gl({participantIds:A,tournamentRecord:ee});if(!ne.participant){let oe=bc({returnParticipant:!0,pairOverride:!0,tournamentRecord:ee,participant:{participantRole:la,individualParticipantIds:A,participantType:Ot}});if(oe.error)return le({result:oe,stack:i});_=(Z=oe.participant)==null?void 0:Z.participantId}ne=Gl({participantIds:M,tournamentRecord:ee});let ie=(X=ne.participant)==null?void 0:X.participantId;ie&&Xy({participantIds:[ie],tournamentRecord:ee}).success&&(k=ie)}if(s||((Q=v.substitutions)==null?void 0:Q.length)===1){if(s)w&&h&&(h.processCodes=Vt([...(h==null?void 0:h.processCodes)??[],...w]));else for(let ee of w||[]){let ne=(ce=h==null?void 0:h.processCodes)==null?void 0:ce.lastIndexOf(ee);ne!==void 0&&((J=h==null?void 0:h.processCodes)==null||J.splice(ne,1))}h&&ci({tournamentId:r==null?void 0:r.tournamentId,matchUp:h,context:i,drawDefinition:o})}return f&&ci({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,context:i,drawDefinition:o}),{...re,modifiedLineUp:R,participantRemoved:k,participantAdded:_}}function ase({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var u;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:we};let o=(i==null?void 0:i.lineUp)||((u=qm({participantId:e,drawDefinition:n}))==null?void 0:u.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(c=>{var p;if(!r.includes(c.participantId))return c;let d=(p=c.collectionAssignments)==null?void 0:p.filter(f=>{let h=f.collectionId===a&&f.collectionPosition===t;return h&&(f.previousParticipantId&&s.push(f.previousParticipantId),l.push({participantId:c.participantId,...f})),!h});return{participantId:c.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function ZAe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let n=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===vr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),r=s=>!t.includes(s.participantId);for(let s of n){s.entries=(s.entries||[]).filter(r);let{flightProfile:l}=Gn({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(r)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(u=>{u.entries=(u.entries||[]).filter(r)})}return{...re}}function lk({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return le({result:{error:Fe},stack:r});if(!e||!t)return le({result:{error:ht},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return le({result:{error:_n},stack:r});if(o!=null&&o.participantType&&![Fi,ws].includes(o.participantType))return le({context:{participantType:o.participantType},result:{error:Ou},stack:r});let s=t.filter(d=>{var p;return((p=a.find(f=>f.participantId===d))==null?void 0:p.participantType)!==Qt});if(s.length)return le({result:{error:Hs,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&v_({individualParticipantIds:u,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=sl();if(c.includes(fa)){let d=a.find(({participantId:p})=>p===e);jt({topic:fa,payload:{participants:[d]}})}return ZAe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:st(o,!1,!0),added:u.length,...re}}function uk(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:Fe};if(!o)return{error:Oy};if(!o.participantId)return bc({tournamentRecord:r,participant:o});let{participant:s}=Nh({participantId:o.participantId,tournamentRecord:r});if(!s)return bc({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:g}=o;if(f&&s.participantType!==f)return{error:dee};let v={};if(m&&(v.contacts=m),h&&(v.onlineResources=h),c&&zn(c)&&(v.participantOtherName=c),d&&zn(d)&&(v.participantName=d),Array.isArray(u)){let{participants:y}=Bn({participantFilters:{participantTypes:[Qt]},tournamentRecord:r}),b=y==null?void 0:y.map(Jt);if(b){let I=u.filter(T=>zn(T)&&b.includes(T));([ws,Zi].includes(f||s.participantType)||f===Ot&&(I.length===2||a))&&(v.individualParticipantIds=I),s.participantType===MI.PAIR&&e&&(v.participantName=XAe({individualParticipants:y,newValues:v}))}}return Object.keys(_h).includes(p)&&(v.participantRole=p),Object.keys(MI).includes(f)&&(v.participantType=f),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===MI.INDIVIDUAL&&g&&JAe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,pt(v)),i&&lk({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),jt({topic:fa,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:st(s),...re}}function XAe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function JAe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:u,tennisId:c,sex:d}=n;d&&Object.keys(kc).includes(d)&&(r.sex=d);let p;if(zn(l)&&(r.personId=l),s&&zn(s)&&(QAe(s)||s==="")&&(r.nationalityCode=s),a&&typeof zn(a)&&a.length>1&&(r.standardFamilyName=a,p=!0),o&&typeof zn(o)&&o.length>1&&(r.standardGivenName=o,p=!0),p&&t){let f=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=f}u&&Go(u)&&(r.birthdate=u),c&&zn(c)&&(r.tennisId=c),Object.assign(e.person,r)}function QAe(t){return Hf.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function _M(t){var x,$,j,V,H,z,q,W,Y,Z,X,Q,ce,J,ee,ne,ie,oe,se,pe;let e=Nz(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:a,participantId:o,event:s}=t;if(!o)return le({result:{error:cr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return le({result:{error:YV},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:u,relevantAssignments:c,collectionPosition:d,teamParticipants:p,collectionId:f,matchUpType:h,dualMatchUp:m,tieFormat:g}=e;if(($=(x=u==null?void 0:u.sides)==null?void 0:x.flatMap(fe=>{var ge,me;return((ge=fe.participant)==null?void 0:ge.individualParticipantIds)||((me=fe.participant)==null?void 0:me.participantId)||[]}))!=null&&$.includes(o))return le({result:{...re},stack:i});n=n??(t.sideNumber?(V=(j=l==null?void 0:l.sides)==null?void 0:j.find(fe=>fe.sideNumber===t.sideNumber))==null?void 0:V.participantId:void 0);let v=(z=(H=Bn({participantFilters:{participantIds:[o]},tournamentRecord:r}))==null?void 0:H.participants)==null?void 0:z[0];if(!v)return le({result:{error:_n},stack:i});let{appliedPolicies:y}=mi({tournamentRecord:r,drawDefinition:a,event:s}),b=((q=t.policyDefinitions)==null?void 0:q[Br])??(y==null?void 0:y[Br])??A0[Br];if((t.enforceGender??((W=b==null?void 0:b.participants)==null?void 0:W.enforceGender))!==!1&&[zi,pn].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((Y=v.person)==null?void 0:Y.sex))return{error:ky,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:T}=v;if(On(sn)(h)&&T!==Qt)return{error:Ou};let w=T===Qt?[o]:I,S=n&&(p==null?void 0:p.find(({participantId:fe})=>fe===n))||(p==null?void 0:p.find(({individualParticipantIds:fe})=>Ya(w,fe)));if(!S)return{error:aj};if(n||(n=S.participantId),!n)return{error:_n};let U=(Z=c==null?void 0:c.find(fe=>fe.participantId===(S==null?void 0:S.participantId)))==null?void 0:Z.drawPosition,P=(Q=(X=m==null?void 0:m.sides)==null?void 0:X.find(fe=>fe.participantId===n))==null?void 0:Q.sideNumber,E=(J=(ce=u==null?void 0:u.sides)==null?void 0:ce.find(fe=>U&&fe.drawPosition===U))==null?void 0:J.sideNumber,D=P??E??t.sideNumber;if(!g)return{error:d0};if(!((ee=g.collectionDefinitions)!=null&&ee.find(fe=>fe.collectionId===f)))return{error:nee};CD({tournamentId:r.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let R=(ne=m==null?void 0:m.sides)==null?void 0:ne.find(fe=>fe.sideNumber===D),N=(ie=u==null?void 0:u.sides)==null?void 0:ie.find(fe=>fe.sideNumber===D),M=(pe=(se=(R==null?void 0:R.lineUp)??((oe=qm({participantId:n,drawDefinition:a}))==null?void 0:oe.lineUp))==null?void 0:se.filter(fe=>{var ge;return(ge=fe.collectionAssignments)==null?void 0:ge.find(me=>me.collectionPosition===d&&me.collectionId===f&&!me.previousParticipantId)}))==null?void 0:pe.map(fe=>fe==null?void 0:fe.participantId),A=(M==null?void 0:M.length)>1&&M||(T===Ot?v.individualParticipantIds:[o]),_=ase({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:R,drawDefinition:a,participantIds:A,collectionId:f});if(_.error)return le({result:_,stack:i});let{modifiedLineUp:k}=_,B;if(h===Wi){if(T!==Ot){let fe=AL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:o,collectionId:f,tieFormat:g});if(fe!=null&&fe.error)return le({result:fe,stack:i});if(fe=F({side:N}),fe.error)return fe;B=fe.deletedParticipantId,R&&(R.lineUp=k),m&&ci({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(T===Ot)for(let fe of A)AL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:fe,collectionId:f,tieFormat:g})}else{let fe=AL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:k,participantId:o,collectionId:f,tieFormat:g});if(fe!=null&&fe.error)return fe}if(R&&(R.lineUp=k),m&&ci({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a}),B){let{error:fe}=Xy({participantIds:[B],tournamentRecord:r});fe&&console.log("cleanup")}return{...re,modifiedLineUp:k};function F({side:fe}){let ge;if(fe.participant){let me=fe.participant.individualParticipantIds||[];if(me.filter(Boolean).length===1){let{participant:Ee}=Gl({participantIds:me,tournamentRecord:r});me.push(o);let{participant:Be}=Gl({participantIds:me,tournamentRecord:r});if(!Be&&Ee){Ee.individualParticipantIds=me;let Pe=uk({pairOverride:!0,tournamentRecord:r,participant:Ee});if(Pe.error)return Pe}else ge=Ee==null?void 0:Ee.participantId}}else{let me=bc({participant:{individualParticipantIds:[o],participantRole:la,participantType:Ot},pairOverride:!0,tournamentRecord:r});if(me.error)return me}return{...re,deletedParticipantId:ge}}}function AL({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var c,d;let s=(c=qm({participantId:e,drawDefinition:i}))==null?void 0:c.lineUp,l=(d=n||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===r),u={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(u);else{let p={collectionAssignments:[u],participantId:r};n.push(p)}return Qy({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function ose(t){var D,R,N,M,A,_,k,B,F,x,$,j,V,H,z,q,W,Y,Z,X,Q,ce,J;let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,a="removeTieMatchUpParticiapantId";if(!n)return le({result:{error:cr},stack:a});let o=Nz(t);if(o.error)return o;let{appliedPolicies:s}=mi({tournamentRecord:e,drawDefinition:i,event:r}),l=(N=(R=((D=t.policyDefinitions)==null?void 0:D[Br])??(s==null?void 0:s[Br])??A0[Br])==null?void 0:R.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:c,relevantAssignments:d,collectionPosition:p,teamParticipants:f,collectionId:h,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return le({result:{error:Eo},stack:a});let b=(M=c==null?void 0:c.sides)==null?void 0:M.find(ee=>{var ne,ie,oe;return((ne=ee.participant)==null?void 0:ne.participantId)===n||((oe=(ie=ee.participant)==null?void 0:ie.individualParticipantIds)==null?void 0:oe.includes(n))});if(!b)return le({result:{error:_n},stack:a});let I=((A=t.policyDefinitions)==null?void 0:A[Js])??(s==null?void 0:s[Js]);if(!((_=b.substitutions)!=null&&_.length)&&(Kr({score:c==null?void 0:c.score})||c!=null&&c.winningSide)&&(I==null?void 0:I.requireParticipantsForScoring)!==!1)return le({result:{error:Bee},stack:a});let T=(B=(k=u==null?void 0:u.sides)==null?void 0:k.find(({sideNumber:ee})=>ee===b.sideNumber))==null?void 0:B.participantId;if(!T)return le({result:{error:_n},stack:a});let w=(x=(F=Bn({participantFilters:{participantIds:[n]},tournamentRecord:e}))==null?void 0:F.participants)==null?void 0:x[0];if(!w)return le({result:{error:_n},stack:a});if(m===sn&&w.participantType===Ot)return le({result:{error:ky},stack:a});let S=w.participantType===Qt?[n]:w.individualParticipantIds;CD({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:u,drawDefinition:i,dualMatchUp:g});let U=($=g.sides)==null?void 0:$.find(({sideNumber:ee})=>ee===b.sideNumber);if(!U&&(((j=g.sides)==null?void 0:j.filter(({lineUp:ee})=>!ee).length)||0)<2){let ee=f==null?void 0:f.map(({participantId:ne})=>{var ie;return{drawPosition:(ie=d==null?void 0:d.find(oe=>oe.participantId===ne))==null?void 0:ie.drawPosition,teamParticipantId:ne}});U=(V=g.sides)==null?void 0:V.find(ne=>{var ie;return((ie=ee==null?void 0:ee.find(({drawPosition:oe})=>oe===ne.drawPosition))==null?void 0:ie.teamParticipantId)===T})}if(!U)return le({result:{error:_n,context:{participantId:n}}});let{modifiedLineUp:P,previousParticipantIds:E}=ase({collectionPosition:p,teamParticipantId:T,dualMatchUpSide:U,participantIds:S,drawDefinition:i,collectionId:h});if(U.lineUp=P,T&&y&&Qy({participantId:T,lineUp:P,drawDefinition:i,tieFormat:y}),m===Wi&&w.participantType===Qt){let ee=(H=c==null?void 0:c.sides)==null?void 0:H.find(oe=>oe.sideNumber===(U==null?void 0:U.sideNumber)),{participantId:ne}=ee??{},ie=ne&&((q=(z=Bn({participantFilters:{participantIds:[ne]},tournamentRecord:e,withDraws:!0}))==null?void 0:z.participants)==null?void 0:q[0]);if(ie){let oe=((W=ie==null?void 0:ie.individualParticipantIds)==null?void 0:W.filter(se=>se!==n))??[];if(E&&oe.push(...E),oe.length>2)return le({result:{error:Hs},stack:a});if((Y=ie.draws)!=null&&Y.length){if(oe.length===1){let{participant:se}=Gl({participantIds:oe,tournamentRecord:e});if(!se){let pe=bc({participant:{participantRole:la,individualParticipantIds:oe,participantType:Ot},pairOverride:!0,tournamentRecord:e});if(pe.error)return le({result:pe,stack:a})}}}else if(oe.length){ie.individualParticipantIds=oe;let se=uk({participant:ie,pairOverride:!0,tournamentRecord:e});if(se.error)return le({result:se,stack:a})}else{let se=Xy({participantIds:[ne],tournamentRecord:e});se.error&&console.log("cleanup",{result:se})}}else return le({result:{error:_n},stack:a})}if(((Z=b.substitutions)==null?void 0:Z.length)===1&&!((ce=(Q=(X=c==null?void 0:c.sides)==null?void 0:X.find(ee=>ee.sideNumber!==b.sideNumber))==null?void 0:Q.substitutions)!=null&&ce.length)&&((J=v==null?void 0:v.processCodes)!=null&&J.length)){for(let ee of l||[]){let ne=v.processCodes.lastIndexOf(ee);v.processCodes.splice(ne,1)}ci({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return ci({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...re,modifiedLineUp:P}}function _z(t){var l,u;let e=Lt(t,[{[as]:!0,[ll]:!0,[qp]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:a}=t;if(n&&![1,2].includes(n))return{error:we,sideNumber:n};let{matchUp:o,structure:s}=rn({drawDefinition:i,matchUpId:r,event:a});return o?Ko({structure:s})?((l=o.sides)==null||l.forEach(c=>{(!n||c.sideNumber===n)&&delete c.participantId}),ci({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...re}):{error:FV}:{error:Ta}}function e_e({matchUpStatuses:t=[Ui,yi,ai],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var c;let r=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(c=r==null?void 0:r.drawPositions)==null?void 0:c.find(d=>d!==i),o=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=Ya(o||[],t),u=Ya(s||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:u,loserMatchUpStatuses:s}}function t_e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=Dt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===ro)return{...re};u=u??ga({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:f}=Qv({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==f&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Gi({drawDefinition:a,structureId:o});for(let g of h??[])i_e({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...re}}function i_e({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var f,h,m;let d="removeSubsequentDrawPosition";if(s){let g=(h=(f=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:f.find(y=>y.drawPosition===n))==null?void 0:h.sideNumber,v=(m=u.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=p&&Ui||[ai,yi].includes(u.matchUpStatus)&&u.matchUpStatus||Fn,[yi,ai].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&tne({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),ci({tournamentId:r==null?void 0:r.tournamentId,eventId:c==null?void 0:c.eventId,context:`${d}-${n}`,drawDefinition:o,matchUp:u}),{...re}}function V0(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=Ko({structure:c}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:_1};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=oc({...t,matchUpStatus:a||Fn,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:k,matchUpsMap:B}=t;if(S=Jp({appliedPolicies:t.appliedPolicies,matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:B,event:d}),!e&&!S.removeWinningSide)return{...re}}if(f)return{...re};let{matchUps:U}=Ei({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:c}),{positionAssignments:P}=_r({structure:c}),E=m-1,D=1-E,R=h[E],N=h[D],{winnerParticipantId:M,loserParticipantId:A}=(P==null?void 0:P.reduce((k,B)=>(B.drawPosition===N&&(k.loserParticipantId=B.participantId),B.drawPosition===R&&(k.winnerParticipantId=B.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(k=>{var B;return(B=k.drawPositions)==null?void 0:B.includes(N)});if(I&&sse({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:o}),b){let{winnerHadMatchUpStatus:k}=e_e({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),B=g.linkCondition===bd;if(k&&B){let x=Math.min(...b.drawPositions);eB({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:o,event:d})}let F=n_e({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:o,event:d});if(F.error)return F}if(T){let k=Math.min(...T.drawPositions);eB({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:k,matchUpsMap:o,event:d})}return{...re,...S&&{tieMatchUpResult:S}}}function sse({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var m,g;let{structureId:p,roundNumber:f}=l,h="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=Dt({drawDefinition:s,structureId:v});if(!y)return{error:Sn};let{positionAssignments:b}=_r({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(P=>P.participantId!==n);let I=(m=b==null?void 0:b.find(P=>P.participantId===n))==null?void 0:m.drawPosition,{matchUps:T}=Ei({drawDefinition:s,structure:y,event:d}),w=T.map(P=>P.drawPositions).flat(1/0).filter(Boolean),S=qo(w);if((I?S[I]:void 0)===1)b==null||b.forEach(P=>{P.participantId===n&&delete P.participantId});else{let P=T.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let U=(g=u==null?void 0:u.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===l.matchUpId);U&&ci({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:h,drawDefinition:s})}return f&&t_e({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:f,structureId:p}),{...re}}function n_e({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var m,g,v;let c="removeDirectedLoser",d=n.target.structureId,{structure:p}=Dt({drawDefinition:a,structureId:d});if(!p)return{error:Sn};let{positionAssignments:f}=_r({structure:p}),h=(m=f==null?void 0:f.find(y=>y.participantId===e))==null?void 0:m.drawPosition;if(f==null||f.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((T,w,S)=>w.drawPosition===h?S:T,void 0),b=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:T})=>T===o.matchUpId),I=(v=b==null?void 0:b.sides)==null?void 0:v[y];I&&(delete I.lineUp,ci({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:b,context:c,drawDefinition:a}))}return{...re}}function eB({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return pD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...re}}function r_e(t){var l,u;let{matchUpFormat:e,score:i}=t,n=(l=i==null?void 0:i.sets)==null?void 0:l.length,r=e&&yo(e),{setFormat:a,finalSetFormat:o,bestOf:s}=r??{};return((u=s&&n===s&&o||a)==null?void 0:u.timed)||!1}function a_e({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var s;let r="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return le({result:{error:c0},context:{matchUpStatus:Ui},stack:r});let{positionAssignments:a}=_r({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=n.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(n.matchUpStatus=Ui,n.matchUpStatusCodes=[],ci({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...re}):le({result:{error:iee},info:"matchUp does not include BYE",stack:r})}function CT(t){var m;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===ro)return le({result:{...re},stack:l});let{matchUp:u,targetMatchUps:c,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:f,loserTargetDrawPosition:h}=c;if(p&&p.matchUpStatus!==Ui){let{loserTargetLink:g}=d;if((m=i==null?void 0:i.progression)!=null&&m.doubleExitPropagateBye){let v=lse({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:g,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:s});if(v.error)return le({result:v,stack:l})}else{let{feedRound:v,drawPositions:y,matchUpId:b}=p,I=v?2:2-y.indexOf(h),T=l9({...t,targetMatchUp:p,walkoverWinningSide:I,tournamentRecord:e,sourceMatchUp:u,matchUpId:b});if(T.error)return le({result:T,stack:l})}}if(f){let g=l9({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:e,sourceMatchUp:u});if(g.error)return le({result:g,stack:l})}return le({result:{...re},stack:l})}function l9(t){var z,q,W;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o}=t,s=n.structures.find(({structureId:Y})=>Y===a.structureId),l=t.matchUpStatus===br?br:ir,u=t.matchUpStatus===br?ai:yi,c="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(Y=>Y.matchUpId===a.matchUpId);if(!d)return{error:Eo};let p=(r==null?void 0:r.drawPositions)||[],f=(z=d.drawPositions)==null?void 0:z.filter(Boolean),h=(r==null?void 0:r.structureId)===a.structureId;if(h&&Ya(p,f)&&(f=f.filter(Y=>!p.includes(Y))),h&&f.length>1)return le({result:{error:GI},stack:c});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=Qie(t),v=Xa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:T,loserMatchUp:w}=y;if(w){let{loserTargetLink:Y}=b,Z=lse({loserTargetDrawPosition:I,loserMatchUp:w,tournamentRecord:i,loserTargetLink:Y,drawDefinition:n,matchUpsMap:o});if(Z.error)return le({result:Z,stack:c})}let S=((q=d.drawPositions)==null?void 0:q.filter(Boolean))||[],U=S.length===1,P=t.walkoverWinningSide||U&&uR({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=[yi,ai].includes(d.matchUpStatus)&&!S.length,D=d.finishingRound===1,R=E&&!D?l:u,N=e.find(Y=>Y.matchUpId===g.matchUpId),M=[],A;r&&((r==null?void 0:r.structureId)===(N==null?void 0:N.structureId)?r.roundPosition<(g==null?void 0:g.roundPosition)?A=1:A=2:a.feedRound?r.structureId===a.structureId?A=2:A=1:P&&(A=3-P));let _=t.matchUpStatus,k=g==null?void 0:g.matchUpStatus;A===1?M=[{matchUpStatus:aC(_),previousMatchUpStatus:_,sideNumber:1},{matchUpStatus:aC(k),previousMatchUpStatus:k,sideNumber:2}]:A===2&&(M=[{matchUpStatus:aC(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:aC(_),previousMatchUpStatus:_,sideNumber:2}]),M.length&&(M=M.map(Y=>pt(Y)));let B=oc({...t,winningSide:P,matchUp:d,matchUpStatusCodes:M,context:c,matchUpStatus:R});if(B.error)return le({result:B,stack:c});if(E)return CT({...t,matchUpStatus:R,targetData:v});if(!T)return le({result:{...re},stack:c});let F=f.length===2?f[P-1]:f[0],{positionAssignments:x}=Gi({structure:s}),$=x==null?void 0:x.find(Y=>Y.drawPosition===F),j=o.drawMatchUps.find(Y=>Y.matchUpId===T.matchUpId),V=(W=j==null?void 0:j.drawPositions)==null?void 0:W.filter(Boolean),H=V.length===1;if(F){if($!=null&&$.bye){let Y=Xa({matchUpId:j.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(H){let Z=V.filter(Boolean)[0],X=uR({drawPosition:Z,matchUpId:j.matchUpId,inContextDrawMatchUps:e}),Q=oc({appliedPolicies:t.appliedPolicies,matchUpId:j.matchUpId,matchUp:j,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:n,winningSide:X});return Q.error?le({result:Q,stack:c}):CG({drawPositionToAdvance:Z,matchUpId:j.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}else if([yi,ai].includes(T.matchUpStatus)){let Z=CT({...t,matchUpId:j.matchUpId,matchUpStatus:R,targetData:Y});if(Z.error)return le({result:Z,stack:c})}return le({result:{...re},stack:c})}return ow({matchUpId:T.matchUpId,drawPosition:F,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!j)return{error:Eo};if(H){let X=V[0],Q=uR({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:X});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Q})}let Y=[yi,ai].includes(j.matchUpStatus)?u:l,Z=oc({matchUpId:j.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:j,matchUpStatusCodes:[],removeScore:!0,context:c,drawDefinition:n,matchUpStatus:Y});if(Z.error)return le({result:Z,stack:c});if(Y===l){let X=CT({...t,matchUpId:a.matchUpId,matchUpStatus:Y,targetData:v});if(X.error)return X}}return le({result:{...re},stack:c})}function lse(t){var u;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a,event:o}=t,s=(u=n==null?void 0:n.target)==null?void 0:u.structureId,{structure:l}=Dt({drawDefinition:r,structureId:s});return l?Ss({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:s,matchUpsMap:a,event:o}):{error:Uh}}function aC(t){return t===ir?yi:t===br?ai:t}function o_e(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===Ui,u=a.winningSide,c=[ir,br].includes(n),d=cD({matchUpStatus:n}),p=R2({matchUpStatus:n}),f=!d&&!p,h=t.matchUpTieId||u&&d&&!c,m=u&&c,g=()=>oc({...t,removeScore:[Nc,yi].includes(n),matchUpStatus:n||Fn});return f&&{error:p2}||h&&tB(t)||m&&s_e(t)||u&&V0(t)||p&&g()||l&&a_e({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:p2}||c&&l_e(t)||o&&tB(t)||le({result:{error:c0},stack:s})}function s_e(t){let e=V0(t);return e.error?e:CT(t)}function l_e(t){let e=tB({...t,removeScore:!0});return e.error?e:CT(t)}function tB(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let a=V0(t);if(a.error)return le({result:a,stack:e})}let i=!!t.matchUp.collectionId,n=oc({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=Jp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return le({result:l,stack:e});Object.assign(n,{tieMatchUpResult:l})}return le({result:n,stack:e})}function u_e({drawDefinition:t,structure:e,matchUp:i}){var l,u,c,d;let{drawPositions:n}=i,{positionAssignments:r}=Gi({drawDefinition:t,structure:e}),a=(l=r==null?void 0:r.filter(({drawPosition:p})=>n==null?void 0:n.includes(p)))==null?void 0:l.map(p=>{var h;let{extension:f}=$t({element:p,name:eh});return(h=f==null?void 0:f.value)==null?void 0:h.groupOrder}),{containerStructures:o}=D0({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(c=(u=R0({drawDefinition:t,structureId:s}))==null?void 0:u.links)==null?void 0:c.source)==null?void 0:d.filter(p=>{var f;return Ya(a,((f=p.source)==null?void 0:f.finishingPositions)||[])}).map(p=>p.source.structureId)}}function use({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===U0&&rh({drawDefinition:t,structure:e})){let{structureIds:r}=u_e({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function c_e(t){var s,l,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===Pl){let c=n.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:f})=>f===c));if((d==null?void 0:d.matchUpStatus)===Fn){let p=Xa({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Ym({inContextDrawMatchUps:i,drawDefinition:r,targetData:p})){let{structure:f}=Dt({structureId:d.structureId,drawDefinition:r}),h=Gi({structure:f}).positionAssignments;for(let m of h||[])if(m.participantId===c){let g=n.sides.find(({sideNumber:v})=>v===a).participantId;if(m.participantId=g,f==null?void 0:f.positionAssignments)f.positionAssignments=h;else if(f!=null&&f.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of f.structures)(l=y.positionAssignments)==null||l.forEach(b=>b.participantId=v[b.drawPosition])}nh({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:r,structure:f}),e=!0}}}}return{...re,qualifierReplaced:e}}function d_e(t){var s,l,u,c,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===Pl){let p=(l=n.sides.find(({sideNumber:m})=>m===a))==null?void 0:l.participantId,f=i.filter(m=>m.structureId===o.target.structureId&&m.roundNumber===o.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=Bo(f);if((h==null?void 0:h.matchUpStatus)===Fn){let m=Xa({matchUpId:h.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Ym({inContextDrawMatchUps:i,drawDefinition:r,targetData:m})){let g=(u=h.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:u.drawPosition,{structure:v}=Dt({structureId:h.structureId,drawDefinition:r});if(!v)return{error:Sn};let y=Gi({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(c=T.positionAssignments)==null||c.forEach(w=>w.participantId=I[w.drawPosition])}nh({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:r,structure:v}),e=!0}}}}return{...re,qualifierPlaced:e}}function p_e(t){var f,h;let e="attemptToSetWinningSide",i,{appliedPolicies:n,disableAutoCalc:r,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:u}=t;if(o!=null&&o._disableAutoCalc&&r!==!1)return iH(t);if(u.winningSide&&u.winningSide!==s){let{connectedStructureIds:m}=use({drawDefinition:a,structure:l,matchUp:u});m.length&&(console.log({connectedStructureIds:m}),i=!0);let g=V0(t);if(g.error)return g}let c=Yne(t);if(c.error)return le({result:c,stack:e});let d,p;return t.qualifierChanging&&((f=n==null?void 0:n[uU])!=null&&f.autoReplaceQualifiers)&&(d=c_e(t).qualifierReplaced),t.qualifierAdvancing&&((h=n==null?void 0:n[uU])!=null&&h.autoPlaceQualifiers)&&(p=d_e(t).qualifierPlaced),le({result:pt({...re,...c,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var fR={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function cse(t){var f;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,matchUp:o}=t,{iteration:s=0}=t;s+=1;let l="removeDoubleExit";qs({method:l,color:"brightyellow",iteration:s,keyColors:fR});let{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:c,winnerMatchUp:d,loserTargetDrawPosition:p}}=a;if(d&&d.matchUpStatus!==Ui){let{stage:h,roundNumber:m,roundPosition:g}=d;qs({winner:"winner",stage:h,roundNumber:m,roundPosition:g,keyColors:fR}),u9({...t,targetMatchUp:d,sourceMatchUp:o,iteration:s})}if(c&&c.matchUpStatus!==Ui){let h=e.find(({matchUpId:I})=>I===c.matchUpId),{structure:m}=Dt({drawDefinition:n,structureId:h.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=c;if(qs({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:fR,feedRound:b}),(f=i==null?void 0:i.progression)==null?void 0:f.doubleExitPropagateBye)eB({drawPosition:p,targetLink:u,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let I=u9({...t,structure:m,targetMatchUp:c,iteration:s});if(I.error)return le({result:I,stack:l})}}return le({result:{...re},stack:l})}function u9(t){var I,T,w,S,U,P;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,u="conditionallyRemoveDrawPosition";qs({method:u});let c=Xa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=c,p=o==null?void 0:o.drawMatchUps.find(E=>E.matchUpId===a.matchUpId),f=[],h,m,g;if(a.feedRound)g=(T=(I=d==null?void 0:d.drawPositions)==null?void 0:I.filter(Boolean))==null?void 0:T.find(E=>a.drawPositions.includes(E));else if(!r)g=(w=Ln((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(m=(S=ene({structureId:s.structureId,matchUp:r,matchUpsMap:o}))==null?void 0:S.pairedPreviousMatchUp,h=[ir,br].includes(m==null?void 0:m.matchUpStatus),f=((U=m==null?void 0:m.drawPositions)==null?void 0:U.filter(Boolean))||[],[...dr,Ui].includes(m==null?void 0:m.matchUpStatus)||(m==null?void 0:m.winningSide)){let E=r.drawPositions||[],D=(P=a.drawPositions)==null?void 0:P.filter(Boolean);Ya(E,D)&&(D=D==null?void 0:D.filter(R=>!E.includes(R))),g=E.concat(f).find(R=>D==null?void 0:D.includes(R))}if(d&&g){let{stage:E,roundNumber:D,roundPosition:R}=d;qs({method:"removeDirectedWinner",drawPositionToRemove:g,keyColors:fR,color:"brightgreen",stage:E,roundNumber:D,roundPosition:R}),sse({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}let v=cse({targetData:c,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:o,structure:s,iteration:l});if(v.error)return le({result:v,stack:u});let y=f_e({pairedPreviousDoubleExit:h,noContextTargetMatchUp:p}),b=!h;return v=oc({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:u,matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?le({result:v,stack:u}):{...re}}function f_e({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Ui?Ui:t?[br,ai].includes(e==null?void 0:e.matchUpStatus)?ai:yi:Fn}function h_e(t){var o,s,l,u,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===Pl){let d=(l=(s=n.sides)==null?void 0:s.find(({sideNumber:f})=>f===n.winningSide))==null?void 0:l.participantId,p=i.find(f=>{var h;return f.structureId===a.target.structureId&&f.roundNumber===a.target.roundNumber&&((h=f.sides)==null?void 0:h.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Fn){let f=Xa({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!Ym({inContextDrawMatchUps:i,drawDefinition:r,targetData:f})){let{structure:h}=Dt({structureId:p.structureId,drawDefinition:r}),m=Gi({structure:h}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=m;else if(h!=null&&h.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(u=y.positionAssignments)==null||u.forEach(b=>b.participantId=v[b.drawPosition])}nh({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:r,structure:h}),e=!0}}}}return{qualifierRemoved:e}}function m_e(t){var m;let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,a="noDownStreamDependencies";if([ir,br].includes(e==null?void 0:e.matchUpStatus)&&![ir,br].includes(i)){let g=cse(t);if(g.error)return le({result:g,stack:a})}let o=i===ir,s=Kr({score:n})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=((m=t==null?void 0:t.inContextMatchUp)==null?void 0:m.collectionId)&&r_e(t.inContextMatchUp),u=t.removeScore||!l&&![Qs,Ro].includes(i||Qs),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Kr({score:n}),d=i&&i!==Fn,p=g=>{var U,P;let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:T}=t;if(I!=null&&I._disableAutoCalc&&T!==!1)return iH(t);let{connectedStructureIds:w}=use({drawDefinition:b,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let S=V0(t);if(S.error)return S;if(t.removingQualifier&&((P=(U=t.appliedPolicies)==null?void 0:U[uU])!=null&&P.autoRemoveQualifiers)){let E=h_e(t);return{...re,connectedStructures:v,...E}}return{...re,connectedStructures:v}};if(c&&r&&t.isCollectionMatchUp)return c9(t);let f=[Nc,Ro].includes(i)&&t.dualWinningSideChange,h=(r||f)&&p_e(t)||s&&p(u)||d&&o_e(t)||c&&p(u)||e&&c9({...t,removeScore:!0})||{...re};return le({result:h,stack:a})}function c9(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let r=V0(t);if(r.error)return r}let i=oc({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=Jp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return le({result:i,stack:e})}function kz(t){var c,d,p;let e=Lt(t,[{[as]:!0,[ll]:!0,[qp]:!0},{homeParticipantId:!0,[up]:cr}]);if(e.error)return e;let i=L0(t,[{[g0]:xd,attr:{[GA]:!0}}]);if(i.error)return i;let n=(p=(d=(c=i==null?void 0:i.matchUp)==null?void 0:c.matchUp)==null?void 0:d.sides)==null?void 0:p.map(f=>f==null?void 0:f.participantId);if(t.homeParticipantId&&!(n!=null&&n.includes(t.homeParticipantId)))return{error:ku};let{disableNotice:r=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:u}=t;return Xo({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:r,matchUpId:u,timeItem:{itemType:rie,itemValue:a}})}function xh(t){var f;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return le({result:{error:Ca},stack:e});if(!b0(s))return le({result:{error:Il},stack:e});if(!i){let h=rn({drawDefinition:a,matchUpId:l});if(h.error)return le({result:h,stack:e});i=h.matchUp}let u=Ft(s),c=Hm({matchUp:i}).scheduledDate,d=u&&!c;if((f=SG({matchUp:i}).timeModifiers||[])!=null&&f.length){let h=dse({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h!=null&&h.error)return le({result:h,stack:e})}let p=$y(s,!0,d);return Xo({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:C0,itemValue:p}})}function dse({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return le({result:{error:Ca},stack:s});if(r!==void 0&&!Array.isArray(r))return le({info:Td("timeModifiers"),result:{error:we},stack:s});if(!o){let d=rn({drawDefinition:i,matchUpId:a});if(d.error)return le({result:d,stack:s});o=d.matchUp}let l=SG({matchUp:o}).timeModifiers||[],u=r.filter(d=>!l.includes(d));if(r.length&&!u.length)return{...re};if(u.some(d=>U2.includes(d))){l=l.filter(p=>!U2.includes(p));let d=xh({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return le({result:d,stack:s})}let c=r!=null&&r.length?[...u,...l]:void 0;return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:IG,itemValue:c}})}function ck({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:Ca};let o=t&&gd.test(t);if(t&&!o)return{error:Ka};let s={itemValue:Ft(t),itemType:E0};return Xo({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function dk({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var c,d;if(!i&&!e)return{error:Fe};if(!o)return{error:Ca};let l=rn({drawDefinition:n,matchUpId:o});if(l.error)return l;if(((c=l==null?void 0:l.matchUp)==null?void 0:c.matchUpType)!==gc)return{error:Co};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:we,context:{courtIds:s}};let u;if(s){let p=e||i&&{[i.tournamentId]:i},f=Qp({tournamentRecords:p});if(f.error)return f;let h=(d=f.courts)==null?void 0:d.filter(m=>s.includes(m.courtId));if((h==null?void 0:h.length)!==s.length)return{error:we,context:{courtIds:s}};u=h==null?void 0:h.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Up,itemDate:a,itemValue:u}})}function j0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:Fe};if(!a)return{error:Ca};if(o){let s=Zp({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:P0,itemValue:o}})}function ob({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:Fe};if(!o)return{error:Ca};if(s){let u=Ky({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;j0({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:c})}return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Gm,itemDate:a,itemValue:s}})}function ic(t,e){let i=gte.test(t)?t:nn(t),n=Ft(t)||Ft(e)||Cu(new Date);return new Date(`${n}T${i}`).getTime()}function pk(t){var A;let e="addMatchUpScheduleItems",i=Lt(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[ul]:us}],e);if(i.error)return i;let{matchUpDependencies:n,inContextMatchUps:r}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,disableNotice:d,drawMatchUps:p,matchUpId:f,schedule:h,event:m}=t,g,v;if(p)g=p.find(_=>_.matchUpId===f);else{let _=rn({drawDefinition:c,event:m,matchUpId:f});if(_.error)return _;g=_.matchUp}let{endTime:y,courtId:b,courtIds:I,courtOrder:T,resumeTime:w,homeParticipantId:S,scheduledDate:U,scheduledTime:P,startTime:E,stopTime:D,timeModifiers:R,venueId:N}=h;o&&(!n||!r)&&({matchUpDependencies:n,matchUps:r}=tu({drawDefinition:c}));let M=(A=n==null?void 0:n[f])==null?void 0:A.matchUpIds;if(h.scheduledDate&&o&&M){let _=r==null?void 0:r.filter(k=>{var B,F;return(((B=k.schedule)==null?void 0:B.scheduledDate)||Ft((F=k.schedule)==null?void 0:F.scheduledTime))&&M.includes(k.matchUpId)}).map(({schedule:k})=>{let B=oM(k);return new Date(B).getTime()});if(_!=null&&_.length){let k=oM(h),B=new Date(k).getTime();if(Math.max(..._)>=B){if(a)return le({result:{error:u2},stack:e});v=u2}}}if(U!==void 0){let _=ck({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledDate:U,matchUpId:f});if(_!=null&&_.error)return le({result:_,stack:e,context:{scheduledDate:U}})}if(P!==void 0){let _=xh({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,scheduledTime:P,matchUpId:f,matchUp:g});if(_!=null&&_.error)return le({result:_,stack:e,context:{scheduledTime:P}})}if(E!==void 0){let _=xz({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:f,startTime:E,event:m});if(_!=null&&_.error)return le({result:_,stack:e,context:{startTime:E}})}if(D!==void 0){let _=Fz({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:f,stopTime:D,event:m});if(_!=null&&_.error)return le({result:_,stack:e,context:{stopTime:D}})}if(w!==void 0){let _=Bz({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,resumeTime:w,matchUpId:f,event:m});if(_!=null&&_.error)return le({result:_,stack:e,context:{resumeTime:w}})}if(y!==void 0){let _=Lz({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:f,endTime:y,event:m});if(_!=null&&_.error)return le({result:_,stack:e,context:{endTime:y}})}if(I!==void 0){let _=dk({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:f,courtIds:I});if(_!=null&&_.error)return le({result:_,stack:e,context:{courtIds:I}})}if(b!==void 0&&U!==void 0){let _=ob({courtDayDate:U,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:f,courtId:b});if(_!=null&&_.error)return le({result:_,stack:e,context:{courtId:b}})}if(N!==void 0){let _=j0({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:u,drawDefinition:c,matchUpId:f,venueId:N});if(_!=null&&_.error)return le({result:_,stack:e,context:{venueId:N}})}if(T!==void 0&&Nt(T)){let _=Oz({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,courtOrder:T,matchUpId:f});if(_!=null&&_.error)return le({result:_,stack:e,context:{courtOrder:T}})}if(R!==void 0){let _=dse({disableNotice:!0,removePriorValues:s,tournamentRecord:u,drawDefinition:c,timeModifiers:R,matchUpId:f,matchUp:g});if(_!=null&&_.error)return le({result:_,stack:e,context:{timeModifiers:R}})}return zn(S)&&kz({disableNotice:!0,homeParticipantId:S,removePriorValues:s,tournamentRecord:u,drawDefinition:c,matchUpId:f}),d||ci({tournamentId:u==null?void 0:u.tournamentId,eventId:m==null?void 0:m.eventId,context:e,drawDefinition:c,matchUp:g}),v?{...re,warnings:[v]}:{...re}}function Oz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:Ca};if(r&&!Nt(r))return{error:we,info:"courtOrder must be numeric"};let o=r&&St(r);return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:bG,itemValue:o}})}function pse({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:Ca};if(!r)return{error:cr};if(e){let l=Bn({tournamentRecord:e,participantFilters:{participantTypes:[Qt],participantRoles:[NG]}}).participants??[];if(!Qf({tournamentParticipants:l,participantId:r}))return{error:_n}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function xz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:Ca};if(!b0(a))return{error:Il};let{matchUp:s}=rn({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Hm({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[cp,id,Dp].includes(c==null?void 0:c.itemType)).map(c=>ic(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||ic(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==Iu));let c=$y(a,!0,!0);return Xo({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:Iu,itemValue:c}})}else return{error:Ree}}function Lz({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Ca};if(!b0(o))return{error:Il};let{matchUp:l}=rn({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:u}=Hm({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[Iu,id,cp].includes(d==null?void 0:d.itemType)).map(d=>ic(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||ic(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Dp));let d=$y(o,!0,!0);return Xo({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Dp,itemValue:d}})}else return{error:Eee}}function Fz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:Ca};if(!b0(a))return{error:Il};let{matchUp:s}=rn({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Hm({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,m)=>m.itemType===Dp||h,void 0))return{error:tj};let c=u.filter(h=>[Iu,id,cp].includes(h==null?void 0:h.itemType)).sort((h,m)=>ic(h.itemValue,l)-ic(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===cp,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>ic(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(ic(a,l)>f){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:$y(a,!0,!0),itemType:cp};return Xo({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:h})}else return{error:Cee}}function Bz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:Ca};if(!b0(r))return{error:Il};let{matchUp:s}=rn({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Hm({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,m)=>m.itemType===Dp||h,void 0))return{error:tj};let c=u.filter(h=>[Iu,id,cp].includes(h==null?void 0:h.itemType)).sort((h,m)=>ic(h.itemValue,l)-ic(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===id,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>ic(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(ic(r,l)>f){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:$y(r,!0,!0),itemType:id};return Xo({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:h})}else return{error:eDe}}function g_e({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var p;let c=st(r,void 0,!0);for(let f of(c==null?void 0:c.tieMatchUps)||[])f.matchUpId===s.matchUpId&&(f.winningSide=n,f.score=u,!Kr({score:u})&&!e?Object.assign(f,{...T_}):e&&(f.matchUpStatus=e));a=a??((p=Aa({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=ED({matchUp:c,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function v_e(t){var T;let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:u}=o,{drawPosition:c,participantId:d}=s,p="swapWinnerLoser",{matchUps:f}=Ei(t),h=f.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(l))&&S>a);gs({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(P=>P===l?c:P))||[],ci({tournamentId:e==null?void 0:e.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:p,drawDefinition:r,matchUp:w})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:w,stageSequence:S})=>w===m&&S>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y==null?void 0:y.target.structureId,(T=b==null?void 0:b.target)==null?void 0:T.structureId].filter(Boolean);return r.structures.filter(({stage:w,structureId:S})=>w!==m&&I.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{v.includes(U)||v.push(U),r.structures.filter(({stage:P,stageSequence:E})=>P===w&&E>S).forEach(({structureId:P})=>{v.includes(P)||v.push(P)})}),r.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:S}=Gi({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===u),P=S==null?void 0:S.find(({participantId:E})=>E===d);U&&(U.participantId=d),P&&(P.participantId=u)}),oc({...t,context:p})}function GD(t){var $,j,V;let e="setMatchUpStatus";t.matchUpStatus&&[yi,ir].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,tournamentRecords:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:u,winningSide:c,matchUpId:d,event:p,score:f}=t;if(!l)return{error:ot};if(u&&[Nc,Qs,Ro,Fn].includes(u)&&c)return{error:we,winningSide:c,matchUpStatus:u};if(![void 0,...Bj].includes(u))return le({result:{error:c0},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=ga({drawDefinition:l}),{matchUps:m}=pr({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p}),g=h.drawMatchUps.find(H=>H.matchUpId===d),v=m==null?void 0:m.find(H=>H.matchUpId===d);if(!g||!m)return{error:Ta};if((g.winningSide||c)&&u===Ui)return{context:"Cannot have Bye with winningSide",error:QC,matchUpStatus:u};let y=v==null?void 0:v.structureId,{structure:b}=Dt({drawDefinition:l,structureId:y}),I=On(Zi)(g.matchUpType),T=($=v==null?void 0:v.drawPositions)==null?void 0:$.filter(Boolean),w;if(I){if(o)fi({extension:{name:Yv,value:!0},element:g});else if(s){let H=g.winningSide;Ha({name:Yv,element:g});let{winningSide:z,scoreStringSide1:q,scoreStringSide2:W,set:Y}=ED({drawDefinition:l,matchUpsMap:h,structure:b,matchUp:g,event:p}),Z={scoreStringSide1:q,scoreStringSide2:W,sets:Y?[Y]:[]};w=z!==H,Object.assign(t,{winningSide:z,dualWinningSideChange:w,projectedWinningSide:z,score:Z})}CD({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(I&&u&&[Vy].includes(u))return{error:we,info:"Not supported for matchUpType: TEAM"};let S=v==null?void 0:v.matchUpTieId,U=Xa({matchUpId:S||d,inContextDrawMatchUps:m,drawDefinition:l});if(f&&!I&&!n){let H=g.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),z=NH({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:H,matchUpStatus:u,winningSide:c,score:f});if(z.error)return z}let P=((j=mi({policyTypes:[uU,Js],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:j.appliedPolicies)??{};Ii(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let E=b_e({assignedDrawPositions:T,inContextMatchUp:v,appliedPolicies:P,drawDefinition:l,matchUpStatus:u,structure:b,matchUp:g});if(E!=null&&E.error)return E;let D=(v==null?void 0:v.stage)===gt&&v.finishingRound===1,R=D&&c,N=D&&g.winningSide&&!c&&(!t.matchUpStatus||t.matchUpStatus&&R2({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Kr({outcome:t.outcome})),M=R&&c!==g.winningSide&&g.winningSide;if(Object.assign(t,{inContextDrawMatchUps:m,qualifierAdvancing:R,qualifierChanging:M,removingQualifier:N,inContextMatchUp:v,appliedPolicies:P,matchUpTieId:S,matchUpsMap:h,targetData:U,structure:b,matchUp:g}),S){let{matchUp:H}=rn({matchUpId:S,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p});if(H){let z=(V=Aa({matchUp:H,drawDefinition:l,structure:b,event:p}))==null?void 0:V.tieFormat,{projectedWinningSide:q}=g_e({drawDefinition:l,matchUpStatus:u,dualMatchUp:H,matchUpsMap:h,winningSide:c,tieFormat:z,structure:b,matchUp:g,event:p,score:f}),W=H.winningSide;w=q!==W,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:w,projectedWinningSide:q,matchUpTieId:S,dualMatchUp:H,tieFormat:z})}}let A=Ym(t),_=cD({matchUpStatus:u});if(!S){if(A&&!c&&(u&&R2({matchUpStatus:u})||u&&[ir,br].includes(u)))return{error:QC,activeDownstream:A,winningSide:c};if(c&&c===g.winningSide&&u&&!_)return{context:"winningSide must include directing matchUpStatus",error:QC,directingMatchUpStatus:_,matchUpStatus:u}}let{schedule:k}=t;if(k){let H=pk({disableNotice:!0,tournamentRecords:r,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:k});if(H.error)return H}let B=!I&&!w&&c&&g.winningSide&&g.winningSide!==c;if(i&&B&&g.roundPosition)return v_e(t);let F=c&&!S||t.projectedWinningSide;qs({activeDownstream:A,matchUpWinner:F,method:e,winningSide:c});let x=!A&&m_e(t)||F&&y_e(t)||_&&fse(t)||{error:Lee};return le({result:x,stack:e})}function y_e(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?fse(t):le({stack:"winningSideWithDownstreamDependencies",result:{error:XV},context:{winningSide:i,matchUp:e}})}function fse(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Kr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Fn||kn:t.matchUpStatus||kn,o=t.removeScore||[Nc,yi].includes(a)&&![Qs,Ro].includes(a),s=oc({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=Jp({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function b_e({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:o}){var c,d;if(((c=i==null?void 0:i[Js])==null?void 0:c.requireParticipantsForScoring)===!1)return{...re};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:Gi({structureId:a==null?void 0:a.structureId,drawDefinition:n}).positionAssignments,u=s&&s===2||o.collectionId&&Ko({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return r&&Fj.includes(r)&&!u?le({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:u},result:{error:c0}}):{...re}}function hse({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:ot};let{matchUp:r}=rn({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==gc?{error:Co}:GD({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function mse({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:ot};if(!i)return{error:Ca};let{matchUp:n}=rn({drawDefinition:t,event:e,matchUpId:i});return n?Ha({name:KA,element:n}):{error:Ta}}function I_e({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var f,h,m,g,v;let s="substituteParticipant";if(!n)return{error:ot};if(!a)return{error:Ca};if(!e||!t)return le({result:{error:cr},stack:s});let{matchUp:l}=rn({drawDefinition:n,matchUpId:a,event:o});if(!l)return{error:Ta};if(!l.collectionId)return le({result:{error:Co},stack:s});let u=ga({drawDefinition:n}),{matchUps:c}=pr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:u}),d=c==null?void 0:c.find(y=>y.matchUpId===a),p=(h=(f=c==null?void 0:c.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:f.sides)==null?void 0:h.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!p||r&&p.sideNumber!==r?{error:ku}:(v=(g=(m=p.participant)==null?void 0:m.individualParticipants)==null?void 0:g.map(Jt).filter(y=>y!==e))!=null&&v.includes(t)?Az({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):le({result:{error:ku},stack:s})}function gse(t){return I_e(t)}function vse({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:ot};let{matchUp:n}=rn({drawDefinition:t,matchUpId:e,event:i});return fi({extension:{name:Yv,value:!0},element:n})}function yse(t){let e="setMatchUpFormat",i=Lt(t,[{tournamentRecord:!0},{[ks]:T=>Zo({matchUpFormat:T}),[md]:O1,matchUpFormat:!0}]);if(i.error)return le({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return le({result:{error:we,scheduledDates:a},stack:e});if(u&&!h_([hc,Zs],u))return le({result:{error:vp},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||f&&[f].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return le({result:{error:ot},stack:e});if(f&&c&&r){let T=OH({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let U=((m||a)&&Ei({matchUpFilters:{matchUpStatuses:[Fn]},structure:S}).matchUps)??[],P=(a&&Ei({matchUpFilters:{matchUpStatuses:[Fn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=P?P.map(Nr):U.map(Nr);for(let D of U)E.includes(D.matchUpId)&&(D.matchUpFormat=a!=null&&a.length?s:void 0,ci({tournamentId:n==null?void 0:n.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:T,matchUp:D}))}}return!w.length&&T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||u&&u!==T.eventType||u===vr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);Ji({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1);return g?{...re,modificationsCount:g}:{...re,info:h0}}function $z({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var l,u;if(!i)return{error:ot};let a=(l=rn({drawDefinition:i,matchUpId:n}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:Co};let o=(u=rn({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:u.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((o==null?void 0:o.sides)||[]).forEach(c=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=c.participantId;d&&p&&Qy({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}ci({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:a})}),{...re,modificationsCount:s}}function bse(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=ad({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=ad({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=ad({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),u=o===l?s:o;return n&&(o=n===1?l:u,s=n===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function HD(t){var v,y;let e=Lt(t,[{[qp]:!0,[ll]:!0}]);if(e.error)return e;let i=Ac(t);if(!t.drawDefinition){let b=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=b);let I=ho({eventId:t.eventId,drawId:t.drawId,tournamentRecord:b});if(I.error)return I;I.drawDefinition&&(t.drawDefinition=I.drawDefinition),t.event=I.event}let{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:u,schedule:c,event:d,notes:p}=t,f=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:h}=wg({policyType:Js,tournamentRecord:a,event:d}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(h==null?void 0:h.allowChangePropagation)!==void 0&&h.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:AA};if(f){let b=OH({tournamentRecord:a,drawDefinition:l,matchUpFormat:f,matchUpId:u,event:d});if(b.error)return b}if((y=g==null?void 0:g.score)!=null&&y.sets&&!g.score.scoreStringSide1){let{score:b}=bse(g);g.score=b,g.score.sets=g.score.sets.filter(I=>I.side1Score||I.side2Score||I.side1TiebreakScore||I.side2TiebreakScore)}return GD({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:f,matchUpId:u,schedule:c,event:d,notes:p})}function Ise(t){if(!(t!=null&&t.outcomes))return{error:ht};if(!Array.isArray(t.outcomes))return{error:ht,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:Fe};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=w_e({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...re}}function w_e(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,a={};n.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=ho({tournamentRecord:i,eventId:s});for(let u of a[s]){let{drawId:c}=u,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:f}=u,h=HD({schedule:u==null?void 0:u.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:f,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...re}}function S_e({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:ot};if(!i)return{error:ht,info:"missing outcome"};if(!n&&!e)return{error:Eo};if(!n){let o=rn({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:we}:fi({element:n,extension:{name:KA,value:i}})}function wse(t){return S_e(t)}function Vz(t){var m,g;let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,a=Lt(t,[{[as]:!0,[qp]:!0}],e);if(a.error)return a;let o=L0(t,[{[g0]:xd}]);if(o[up])return o;let s=(m=t.tournamentRecord)==null?void 0:m.tournamentId,{matchUp:l,structure:u}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return le({result:{error:Co},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...re};let c=(g=Aa({structure:u,drawDefinition:i,event:n}))==null?void 0:g.tieFormat;if(!c)return le({result:{error:Hr},info:"No inherited tieFormat",stack:e});let d=[],p=[],f=[],h=[];for(let v of c.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;p.push(b);let I=(l.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===Fn?1:0)-(w.matchUpStatus===Fn?1:0)),f.push(...I.slice(0,y)),d.push(...I.slice(3).map(Nr));else if(f.push(...I),I.length<y){let T=y-I.length,w=TD({collectionDefinition:v,matchUpsLimit:T,matchUp:l,uuids:r});h.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return h.length&&(f.push(...h),ih({eventId:n==null?void 0:n.eventId,matchUps:h,drawDefinition:i,tournamentId:s})),d.length&&Wp({matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=f,l.tieFormatId=void 0,l.tieFormat=void 0,ci({structureId:u==null?void 0:u.structureId,eventId:n==null?void 0:n.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...re,newMatchUps:h,deletedMatchUpIds:d}}function jz(t){var m,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,a="resetScorecard";if(!i)return le({result:{error:ot},stack:a});if(!n)return le({result:{error:Ca},stack:a});if(!zn(n))return le({result:{error:we,matchUpId:n},stack:a});let o=ga({drawDefinition:i}),{matchUps:s}=pr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===n),u=s==null?void 0:s.find(y=>y.matchUpId===n);if(!l||!s)return{error:Ta};if(l.matchUpType!==Xs)return{error:Co};let c=Xa({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:n}),d=u==null?void 0:u.structureId,{structure:p}=Dt({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:c,structure:p,matchUp:l}),Ym(t))return{error:XV};if((m=l.tieMatchUps)!=null&&m.length)for(let y of l.tieMatchUps){let b=GD({matchUpId:y.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(b.error)return le({result:b,stack:a})}let f=(g=mi({tournamentRecord:e,drawDefinition:i,event:r}))==null?void 0:g.appliedPolicies,h=Jp({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:f,drawDefinition:i,matchUpsMap:o,matchUpId:n});if(h.error)return le({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let y=(v=Aa({drawDefinition:i,structure:p,event:r}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=Pp({descendant:l.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=Vz({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(S.error)return S}}}return{...re}}function Sse(t){let e=Lt(t,[{[ll]:!0,[By]:!0},{[sU]:{[B1]:!1,roundNumbers:!1},[hte]:"At least one must be provided",[ul]:uo}]);if(e.error)return e;let i=tre(t);if(i.error)return i;let{matchUpIds:n}=i,r=On(Xs)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let c=jz({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&$z({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=GD({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=_z({...t,matchUpId:l});if(c.error)return c}}return{...re}}function T_e({drawDefinition:t,finishingOrder:e}){var v;if(!t)return{error:ot};let i="setOrderOfFinish";if(!Array.isArray(e))return le({info:Td("finishingOrder"),result:{error:we},stack:i});let{completedMatchUps:n,matchUpsMap:r}=M0({inContext:!0,drawDefinition:t}),a=(n==null?void 0:n.map(Nr))??[],o=e.map(Nr),{matchUpTypes:s,roundNumbers:l,structureIds:u,matchUpTieIds:c}=(n??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:T,roundNumber:w,structureId:S}=b;return y.matchUpTypes.includes(T)||y.matchUpTypes.push(T),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||c.length>1||l.length>1||u.length>1)return le({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:we},stack:i});let d,p,f={},h=[],m=[];if(!e.every(({orderOfFinish:y,matchUpId:b})=>(h.push(b),y&&m.push(y),f[b]=y,d=a.includes(b),p=y===void 0||Nt(y)&&Math.floor(y)>0,d&&p)))return le({result:{error:d?we:c0},info:!d&&"matchUps must be completed"||!p&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:i});let g=n==null?void 0:n.filter(y=>y.structureId===u[0]&&y.roundNumber===l[0]&&y.matchUpType===s[0]&&y.matchUpTieId===c[0]&&!h.includes(y.matchUpId));for(let y of g??[]){let{orderOfFinish:b}=y||{};if(b){if(!Nt(b))return le({context:{orderOfFinish:b,matchUp:y},result:{error:we},stack:i});m.push(b)}}if(Kee(m).length!==m.length||Math.max(...m)>m.length)return le({info:"Values not unique or greater than expected number of values",result:{error:we},stack:i});if(u.length){let y=m_({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:t,matchUpsMap:r});if(y.error)return le({result:y,stack:i});(v=y.completedMatchUps)==null||v.forEach(b=>b.orderOfFinish=f[b.matchUpId])}return{...re}}function Tse(t){return T_e(t)}function Use(t){var v,y,b,I;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,lineUps:r,event:a}=t,o="applyLineUps",s=Lt(t,[{[as]:!0,[ll]:!0,[qp]:!0},{lineUps:!0,[ul]:uo}],o);if(s.error)return s;let l=e.participants||[],u=rn({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:n});if(u.error)return u;if(!u.matchUp)return{error:Ta};let{matchUp:c,structure:d}=u,{drawPositions:p,matchUpType:f}=c;if(f!==Zi)return{error:Co};if(!(p!=null&&p.length))return{error:_1};let h=(v=Aa({matchUp:c,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,m={};for(let T of r){if(!Array.isArray(T))return{error:we,lineUp:T};let w={},S=[];for(let R of T){if(typeof R!="object")return{error:we,lineUpAssignment:R};let{participantId:N,collectionAssignments:M=[]}=R;if(!Array.isArray(M))return{error:we,collectionAssignments:M};let A=l.find(k=>k.participantId===N);if(!A)return{error:_n};if(A.participantType!==Qt)return{error:Ou};let _=(b=(y=c.sides)==null?void 0:y.find(k=>{var B,F;return(F=(B=k.participant)==null?void 0:B.individualParticipantIds)==null?void 0:F.includes(N)}))==null?void 0:b.sideNumber;_&&S.push(_);for(let k of M){if(typeof k!="object")return{error:we,collectionAssignment:k};let{collectionId:B,collectionPosition:F}=k,x=(I=h==null?void 0:h.collectionDefinitions)==null?void 0:I.find(V=>V.collectionId===B);if(!x)return{error:we,collectionId:B};let $=`${B}-${F}`;w[$]||(w[$]=[]);let j=w[$].length;if(On(sn)(x.matchUpType)&&j||x.matchUpType===Wi&&j>1)return{info:"Excessive collectionPosition assignments",error:we};w[$].push(N)}}let U=Object.values(w);for(let R of U)if(R.length===2){let{participant:N}=Gl({tournamentParticipants:l,participantIds:R});if(!N){let M=bc({participant:{participantType:Ot,participantRole:la,individualParticipantIds:R},pairOverride:!0,tournamentRecord:e});if(M.error)return M}}let P=qo(S),E=(P[1]||0)>(P[2]||0)&&1||(P[2]||0)>(P[1]||0)&&2||void 0,D=Object.keys(m).map(R=>parseInt(R));E&&!D.includes(E)&&(m[E]=T)}if(!Object.keys(m).length)return{error:oj};if(u=rn({drawDefinition:i,matchUpId:n}),u.error)return u;if(!u.matchUp)return{error:Ta};let{matchUp:g}=u;g.sides||(g.sides=[]);for(let T of[1,2]){let w=g.sides.find(U=>U.sideNumber===T),S=m[T];if(S)w?w.lineUp=S:g.sides.push({lineUp:S,sideNumber:T});else continue}return ci({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...re}}var fk={};Kt(fk,{anonymizeTournamentRecord:()=>Kse,generate:()=>Dse,generateEventWithDraw:()=>vk,generateOutcome:()=>Zz,generateOutcomeFromScoreString:()=>Gz,generateParticipants:()=>G0,generateTournamentRecord:()=>qse,modifyTournamentRecord:()=>Yse,mutate:()=>Wse});var Dse={};Kt(Dse,{generateEventWithDraw:()=>vk,generateOutcome:()=>Zz,generateOutcomeFromScoreString:()=>Gz,generateParticipants:()=>G0,generateTournamentRecord:()=>qse});function Gz(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...T_,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:we,winningSide:n};let a=r&&RM({scoreString:r}),o={},s=ad({sets:a,matchUpFormat:e}),l=ad({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=RM({scoreString:o.scoreStringSide1}),pt({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function Hz({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var a;let r=(((a=e==null?void 0:e[n.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(r!=null&&r.length),remainingDependencies:r}}function cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var u,c,d,p;let{individualParticipantIds:r}=o_(n);i=i??((u=n.schedule)==null?void 0:u.timeAfterRecovery);let a=f=>{t[f]||(t[f]=[]),t[f]=Vt(t[f].concat(...r))},o=f=>{i&&(!e[f]||i>e[f])&&(e[f]=i)},s=((c=n.winnerTo)==null?void 0:c.matchUpId)||n.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=n.loserTo)==null?void 0:d.matchUpId)||n.loserMatchUpId;l&&(i&&o(l),a(l)),(p=n.sidesTo)!=null&&p.length&&n.sidesTo.forEach(({matchUpId:f})=>{f&&(i&&o(f),a(f))})}function zD({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function U_e({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function RU({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var h,m;let u=nn((h=l==null?void 0:l.schedule)==null?void 0:h.endTime),c=u?Uo(u,St(o)):Uo(s,St(n)+St(o)),d=i&&(u?Uo(nn(u),i):Uo(s,St(n)+St(i))),p=((m=a==null?void 0:a[l.matchUpId])==null?void 0:m.participantIds)||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{zD({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||c;f.includes(g)?U_e({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:c,matchUp:l})}function Pse({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var c,d,p,f,h;let a,o=(d=(c=r.minutesMap)==null?void 0:c[n])==null?void 0:d.recoveryMinutes,s=(((f=(p=r.minutesMap)==null?void 0:p[n])==null?void 0:f.averageMinutes)||0)+(o||0),l=Uo(i,s),u=((h=e==null?void 0:e[n])==null?void 0:h.dependentMatchUpIds)||[];if(u.length){let m=u.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||li(y)<li(g.scheduleTime)?b:g},{});m.scheduleTime&&li(l)>li(m.scheduleTime)&&(a=m)}return{scheduledDependent:a}}function D_e(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Wi&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var qD="DO_NOT_SCHEDULE",Ese={DO_NOT_SCHEDULE:qD};function zz({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=D_e(o).map(({person:f})=>f==null?void 0:f.personId);if(i){let f=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...f)}let l=s.map(f=>{var h;return(h=n[f])==null?void 0:h.map(m=>({...m,personId:f}))}).filter(Boolean).flat().filter(f=>f.requestType===qD&&vd(a,f.date)),u=[],c=o==null?void 0:o.matchUpId,d=er(nn(r),Ft(a)),p=nn(Cj(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:g}=f;(r>m&&r<g||p>m&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:r}),e[h]?(e[h].scheduleTimes.includes(r)||e[h].scheduleTimes.push(r),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:f,scheduleTimes:[r],matchUpIds:[c]})}return{conflicts:u}}function iB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=o_(i),o=(t[i.matchUpId]||[]).filter(s=>!Ya(s,a)).flat();[...a,...o].forEach(s=>{if(zD({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[_l]?l[_l]+=n:n>0&&(l[_l]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function P_e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var m,g;let p=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===Ui;return b&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&LD({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=r.map(Nr));let f=Array.isArray(l)?l.includes(u):l,h=f?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of h){iB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(m=v.schedule)==null?void 0:m.scheduledTime;if(y){o[v.matchUpId]=y;let b=(g=c==null?void 0:c[v.matchUpId])==null?void 0:g.recoveryMinutes;RU({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:f}}function E_e({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),u=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),f=[Ui,ai,kn,Ro,ta,yi,ir,br].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!f}),{matchUpMap:c}=u.reduce((d,p)=>{let{drawId:f,tournamentId:h}=p;return d.matchUpMap[h]||(d.matchUpMap[h]={}),d.matchUpMap[h][f]?d.matchUpMap[h][f].push(p):d.matchUpMap[h][f]=[p],cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:u,matchUpMap:c}}function hk({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:Cn};if(!cl(s)&&!Array.isArray(i))return{error:Hp};a=a??ok({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=X1({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return LD({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==Ui);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],g=h==null?void 0:h.eventType,v={...m,defaultTiming:u,matchUpFormat:f},{averageMinutes:y,recoveryMinutes:b}=l_({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=nn(p.scheduledTime),S=Uo(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function C_e({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Cn};s=s??ok({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:f,venues:h}=Qp({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(f==null?void 0:f.filter(T=>!c||c.includes(T.venueId)))??[];u=u??uw({courts:m,scheduleDate:l,startTime:!0}),p=p??uw({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=hk({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=Ez(y),I=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Yo("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function R_e({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(r=r.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function Cse({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:h}){var b;let m={},g=[],v=[],y=[];for(let I of h){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:P,minutesMap:E}=OD({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:T});y.push(...P??[]);let{groupedRounds:D}=R_e({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),R,N,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=C_e({averageMatchUpMinutes:(b=D[0])==null?void 0:b.averageMinutes,scheduleDate:Ft(c),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=P_e({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:k}=A;_!=null&&_.length&&v.push(..._);let{matchUpsToSchedule:B,matchUpMap:F}=E_e({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:k,matchUps:p}),x=f.filter($=>$.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:x.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:B,scheduleTimes:M,groupedRounds:D,venueCourts:x,minutesMap:E,matchUpMap:F},s||g.push(...R)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function M_e(t,e){let i=li(t.scheduleTime),n=li(t.timeAfterRecovery),r=li(e.scheduleTime),a=li(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,u=n>r&&n<a,c=a>i&&a<n;return pt({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function qz({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var p,f,h,m,g;let o=(((p=i==null?void 0:i[r.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((h=(f=a==null?void 0:a.minutesMap)==null?void 0:f[r.matchUpId])==null?void 0:h.averageMinutes)||0,l=((g=(m=a==null?void 0:a.minutesMap)==null?void 0:m[r.matchUpId])==null?void 0:g.recoveryMinutes)||0,u=o.every(v=>{var T;zD({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let b=nn((T=r==null?void 0:r.schedule)==null?void 0:T.endTime),I=b?Uo(b,St(l)):Uo(n,St(s)+St(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==r.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>M_e({scheduleTime:n,timeAfterRecovery:I},w).hasOverlap)}),c=e[r.matchUpId],d=(c?$1(er(c),er(n),!1):0)>=0;return{enoughTime:u&&d}}function Wz({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=o_(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=Vt(r.concat(...s));return l.forEach(u=>{zD({individualParticipantProfiles:t,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=t[u];if(c)return[o,_l].find(d=>{var h;let p=((h=c.counters)==null?void 0:h[d])||0,f=i[d]||0;return p&&f&&p>=f})}),relevantParticipantIds:l}}function MU({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var g,v,y;if(!s)return{error:Fe};if(!l&&(!u||!Array.isArray(u)))return{error:Ay};if(!l&&(!c||typeof c!="object"))return{error:Nee};let d,p=[],f=0;if(n&&!r){let b=tu({tournamentRecords:o,tournamentRecord:s});r=b.matchUpDependencies,d=b.matchUps}d||(d=((g=Wr({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let h=d.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==Ui)&&(t||!dr.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),m=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(h)){let{drawDefinition:I}=Oh({tournamentRecord:s,drawId:b});if(!I)continue;let T=h[b].filter(S=>(u==null?void 0:u.includes(S))??(m==null?void 0:m.includes(S))),w=za({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let U=((v=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:v.schedule)||c,P=pk({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((y=P==null?void 0:P.warnings)!=null&&y.length&&p.push(...P.warnings),P!=null&&P.success&&(f+=1),P.error)return P}}return p.length?{...re,scheduled:f,warnings:p}:{...re,scheduled:f}}function WD(t){var h;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:u}=t;if(t.matchUpIds&&!r)return MU(t);let c=Lt(t,[{[Ua]:!0},{[sU]:{matchUpContextIds:!1,matchUpDetails:!1},[md]:we,[ul]:uo}]);if(c.error)return c;if((!l||r)&&!u)return{error:ht,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:f}=tu({tournamentRecords:o});for(let m of Object.values(o)){let{tournamentId:g}=m,v=r==null?void 0:r.filter(b=>b.tournamentId===g).map(Nr),y=l==null?void 0:l.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=MU({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:f,errorOnAnachronism:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:m,checkChronology:s,matchUpIds:v,schedule:u});if((h=b.warnings)!=null&&h.length&&d.push(...b.warnings),b.scheduled&&(p+=b.scheduled),b.error)return b}}return d.length?{...re,scheduled:p,warnings:d}:{...re,scheduled:p}}function Rse({autoSchedulingAudit:t,tournamentRecords:e}){var o;jt({topic:iw,payload:t});let i=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),r={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:n},a={itemType:Ooe,itemValue:r};for(let s of Object.values(e))eb({tournamentRecord:s,timeItem:a})}function N_e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){var R,N,M,A,_,k,B;let g={},v={},y={},b={},I={},T={},w={},S={},U={},P={};for(let F of r){let x=Ft(F==null?void 0:F.scheduleDate),$=(F==null?void 0:F.venues)||[],j={},V={},H=(J,ee)=>{J.forEach(ne=>{let ie=V[ne].counters;ie[ee]?ie[ee]+=1:ie[ee]=1,ie[_l]?ie[_l]+=1:ie[_l]=1})};y[x]={},b[x]={},g[x]={},v[x]={},w[x]=[],S[x]=[],U[x]=[],P[x]=[];let z={};f.forEach(J=>{var ee;(ee=J.schedule)!=null&&ee.scheduledDate&&vd(x,Ft(J.schedule.scheduledDate))&&cw({matchUpPotentialParticipantIds:j,matchUpNotBeforeTimes:z,matchUp:J})});let{allDateScheduledByeMatchUpDetails:q,venueScheduledRoundDetails:W,allDateMatchUpIds:Y}=Cse({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:z,matchUpScheduleTimes:T,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:x,matchUps:f,courts:h,venues:$}),Z=10,X=0,Q,ce=10;for(;!Q;){for(let{venueId:J}of $){let ee=0,ne=W[J];for(;ne.courtsCount&&((R=ne.scheduleTimes)!=null&&R.length)&&((N=ne.matchUpsToSchedule)!=null&&N.length)&&ee<=ne.courtsCount;){let{scheduleTime:ie,attempts:oe=0}=ne.scheduleTimes.shift(),se=ne.matchUpsToSchedule.find(pe=>{var Me,Ze;let{matchUpId:fe,matchUpType:ge}=pe,{participantIdsAtLimit:me,relevantParticipantIds:Ee}=Wz({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,matchUpDailyLimits:s,matchUp:pe});if(me.length)return S[x].includes(fe)||S[x].push(fe),!1;let{scheduledDependent:Be}=Pse({matchUpScheduleTimes:T,matchUpDependencies:o,scheduleTime:ie,matchUpId:fe,details:ne});if(Be)return!1;let{dependenciesScheduled:Pe,remainingDependencies:et}=Hz({matchUpScheduleTimes:T,matchUpDependencies:o,allDateMatchUpIds:Y,matchUp:pe});if(!Pe)return b[x][fe]||(b[x][fe]=[]),b[x][fe].push({scheduleTime:ie,remainingDependencies:et}),!1;let{enoughTime:Ie}=qz({individualParticipantProfiles:V,matchUpNotBeforeTimes:z,matchUpDependencies:o,scheduleTime:ie,details:ne,matchUp:pe});if(!Ie)return y[x][fe]||(y[x][fe]=[]),y[x][fe].push({scheduleTime:ie}),!1;let Ne=ne.greatestAverageMinutes,{conflicts:be}=zz({potentials:e,averageMatchUpMinutes:Ne,requestConflicts:P,personRequests:d,scheduleTime:ie,scheduleDate:x,matchUp:pe});if(be!=null&&be.length)return I[x]||(I[x]=[]),I[x].push(...be),!1;H(Ee,ge);let Le=(Ze=(Me=ne.minutesMap)==null?void 0:Me[fe])==null?void 0:Ze.recoveryMinutes;return RU({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,matchUpNotBeforeTimes:z,averageMatchUpMinutes:Ne,matchUpDependencies:o,recoveryMinutes:Le,scheduleTime:ie,matchUp:pe}),T[fe]=ie,!0});ne.matchUpsToSchedule=ne.matchUpsToSchedule.filter(({matchUpId:pe})=>pe!==(se==null?void 0:se.matchUpId)),se?ee+=1:(v[x][J]||(v[x][J]=[]),v[x][J].push({scheduleTime:ie,attempts:oe+1}))}(M=ne.matchUpsToSchedule)!=null&&M.length&&(v[x][J]=(A=v[x][J])==null?void 0:A.filter(ie=>{let oe=ie.attempts<Z;return oe&&ne.scheduleTimes.push(ie),!oe})),(!((_=ne.scheduleTimes)!=null&&_.length)||!((k=ne.matchUpsToSchedule)!=null&&k.length))&&(ne.complete=!0)}X+=1,Q=$.every(({venueId:J})=>W[J].complete)||X===ce}for(let{venueId:J}of $){let ee=W[J].matchUpMap;Object.keys(ee).forEach(ne=>{let ie=u[ne];ie&&Object.keys(ee[ne]).forEach(oe=>{let{drawDefinition:se}=Oh({tournamentRecord:ie,drawId:oe});se&&ee[ne][oe].forEach(({matchUpId:pe})=>{let fe=T[pe];if(fe){let ge=fe.split(":").map(Ls).join(":"),me=`${Ft(x)}T${ge}`;m?w[x].push(pe):(xh({drawDefinition:se,scheduledTime:me,matchUpId:pe}).success&&w[x].push(pe),J&&j0({tournamentRecord:ie,drawDefinition:se,matchUpId:pe,venueId:J}))}})})}),U[x]=W[J].matchUpsToSchedule.map(Nr),g[x][J]=W[J].scheduleTimes.sort((ne,ie)=>li(ne.scheduleTime)-li(ie.scheduleTime))}!m&&(q!=null&&q.length)&&WD({matchUpDetails:q,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of F.venues)for(let ee of J.rounds){let ne=(((B=ee.matchUps)==null?void 0:B.map(({matchUpId:oe})=>oe))||[]).filter(oe=>w[x].includes(oe));ee.canScheduledMatchUpIds=ne;let ie=Math.round(ne.length/ee.matchUpsCount*1e4)/100;(ie===1/0||isNaN(ie))&&(ie=0),ee.possibleToSchedulePct=ie,ee.matchUpsCount===ne.length&&(ee.possibleToSchedule=!0)}}let E=r.map(({scheduleDate:F})=>F),D={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:c,noTimeMatchUpIds:U,requestConflicts:P,scheduledDates:E};return Rse({tournamentRecords:u,autoSchedulingAudit:D}),{...re,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:T,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:U,requestConflicts:P,scheduledDates:E}}function d9({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:ht,stack:"getEarliestCourtTime"};let a=uw({scheduleDate:r,courts:[n],startTime:!0}),o=uw({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=jD({court:n,date:r}),{timeSlots:l}=$0({courtDate:s}),u=er(e),c=er(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let f=er(p.startTime),h=er(p.endTime);if(f>c||h<u)return d;let m=u>f?u:f;if($1(m,h)>=t){let g=nn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function A_e({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){var D,R;let g={},v={},y={},b={},I={},T={},w={},S={},U={};for(let N of r??[]){let M=Ft(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},k={},B=(J,ee)=>{J.forEach(ne=>{let ie=k[ne].counters;ie[ee]?ie[ee]+=1:ie[ee]=1,ie[_l]?ie[_l]+=1:ie[_l]=1})};g[M]={},v[M]={},T[M]=[],w[M]=[],S[M]=[],U[M]=[];let F={};f==null||f.forEach(J=>{var ee;(ee=J.schedule)!=null&&ee.scheduledDate&&vd(M,Ft(J.schedule.scheduledDate))&&cw({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:F,matchUp:J})});let{allDateScheduledByeMatchUpDetails:x,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:j,allDateMatchUpIds:V}=Cse({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:F,matchUpScheduleTimes:I,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:M,matchUps:f,courts:h,venues:A}),H=f==null?void 0:f.filter(({matchUpId:J})=>$.includes(J)),{bookings:z}=hk({dateScheduledMatchUps:H,tournamentRecords:u,scheduleDate:M,periodLength:c}),{virtualCourts:q}=ak({scheduleDate:M,periodLength:c,bookings:z,courts:h}),W=q==null?void 0:q.reduce((J,ee)=>{let{earliestCourtTime:ne,courtEndTime:ie}=d9({date:M,averageMinutes:0,court:ee});return(!J.startTime||er(ne)<er(J.startTime))&&(J.startTime=ne),(!J.endTime||er(ie)>er(J.endTime))&&(J.endTime=ie),J},{}),Y=W.startTime,Z=({courtId:J,booking:ee})=>{var ne;return(ne=q==null?void 0:q.find(ie=>ie.courtId===J))==null?void 0:ne.dateAvailability[0].bookings.push(ee)},X=10,Q=0,ce;for(;!ce;){for(let{venueId:J}of A){let ee=j[J],ne=ee.matchUpsToSchedule.length,ie=[],oe=[],se,pe=0;for(;!se;){for(let fe of ee.matchUpsToSchedule){if(oe.length===ee.courtsCount||ie.length===ee.courtsCount){se=!0;break}let{matchUpId:ge,matchUpType:me}=fe,{participantIdsAtLimit:Ee,relevantParticipantIds:Be}=Wz({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpDailyLimits:s,matchUp:fe});if(Ee.length){w[M].includes(ge)||w[M].push(ge);continue}let{dependenciesScheduled:Pe,remainingDependencies:et}=Hz({matchUpScheduleTimes:I,matchUpDependencies:o,allDateMatchUpIds:V,matchUp:fe});if(!Pe){v[M][ge]||(v[M][ge]=[]),v[M][ge].push({remainingDependencies:et});continue}let Ie=[],Ne=q==null?void 0:q.reduce((be,Le)=>{var Ve,Ke,he,ve;if(oe.includes(Le.courtId))return be;let{earliestCourtTime:Me}=d9({averageMinutes:ee.greatestAverageMinutes,startTime:Y,date:M,court:Le});if(be.scheduleTime&&li(Me)>=li(be.scheduleTime))return be;let{scheduledDependent:Ze}=Pse({matchUpScheduleTimes:I,matchUpDependencies:o,scheduleTime:Me,matchUpId:ge,details:ee});if(Ze)return be;let{enoughTime:qe}=qz({individualParticipantProfiles:k,matchUpNotBeforeTimes:F,matchUpDependencies:o,scheduleTime:Me,details:ee,matchUp:fe});if(!qe)return g[M][ge]||(g[M][ge]=[]),g[M][ge].includes(Me)||g[M][ge].push(Me),be;let ye=((Ke=(Ve=ee.minutesMap)==null?void 0:Ve[ge])==null?void 0:Ke.averageMinutes)||ee.greatestAverageMinutes,{conflicts:_e}=zz({potentials:e,averageMatchUpMinutes:ye,requestConflicts:U,personRequests:p,scheduleTime:Me,scheduleDate:M,matchUp:fe});if(_e!=null&&_e.length)return Ie.push(..._e),!1;B(Be,me);let Ae=(ve=(he=ee.minutesMap)==null?void 0:he[ge])==null?void 0:ve.recoveryMinutes;return RU({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpNotBeforeTimes:F,averageMatchUpMinutes:ye,matchUpDependencies:o,recoveryMinutes:Ae,scheduleTime:Me,matchUp:fe}),(!be.scheduleTime||li(Me)<li(be.scheduleTime))&&(be.averageMatchUpMinutes=ye,be.recoveryMinutes=Ae,be.scheduleTime=Me,be.courtName=Le.courtName,be.courtId=Le.courtId),be},{});if(Ne.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Le,scheduleTime:Me,courtId:Ze}=Ne;I[ge]=Me,b[ge]=Ze,ie.push(ge),oe.push(Ze);let qe=Me,ye=Uo(qe,be);Z({courtId:Ze,booking:{averageMatchUpMinutes:be,recoveryMinutes:Le,periodLength:c,matchUpId:ge,startTime:qe,courtId:Ze,endTime:ye,venueId:J}}),ee.matchUpsToSchedule=ee.matchUpsToSchedule.filter(_e=>_e.matchUpId!==ge)}else Ie!=null&&Ie.length&&(y[M]||(y[M]=[]),y[M].push(...Ie))}(oe.length===ee.courtsCount||ie.length===ee.courtsCount||!ee.matchUpsToSchedule.length)&&(se=!0),ee.matchUpsToSchedule.length&&ie<ee.courtsCount&&(er(Y)<er(W.endTime)?Y=Uo(Y,c):(se=!0,ee.complete=!0)),pe+=1,!se&&pe>=ne&&(se=!0)}(D=ee.matchUpsToSchedule)!=null&&D.length||(ee.complete=!0)}Q+=1,ce=A.every(({venueId:J})=>j[J].complete)||Q===X}for(let{venueId:J}of A){let ee=j[J].matchUpMap;Object.keys(ee).forEach(ne=>{let ie=u[ne];ie&&Object.keys(ee[ne]).forEach(oe=>{let{drawDefinition:se}=Oh({tournamentRecord:ie,drawId:oe});se&&ee[ne][oe].forEach(({matchUpId:pe})=>{let fe=I[pe],ge=b[pe];if(fe){let me=fe.split(":").map(Ls).join(":"),Ee=`${Ft(M)}T${me}`;m||(xh({drawDefinition:se,scheduledTime:Ee,matchUpId:pe}),ob({courtDayDate:M,tournamentRecords:u,tournamentRecord:ie,drawDefinition:se,matchUpId:pe,courtId:ge})),T[M].push(pe)}})})}),S[M]=j[J].matchUpsToSchedule.map(Nr)}!m&&(x!=null&&x.length)&&WD({matchUpDetails:x,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let ee of J.rounds){let ne=(R=(ee.matchUps??[]).map(({matchUpId:oe})=>oe))==null?void 0:R.filter(oe=>T[M].includes(oe));ee.canScheduledMatchUpIds=ne;let ie=Math.round(((ne==null?void 0:ne.length)||0)/ee.matchUpsCount*1e4)/100;(ie===1/0||isNaN(ie))&&(ie=void 0),ee.possibleToSchedulePct=ie,ee.matchUpsCount===(ne==null?void 0:ne.length)&&(ee.possibleToSchedule=!0)}}let P=(r??[]).map(({scheduleDate:N})=>N),E={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:T,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:P};return Rse({tournamentRecords:u,autoSchedulingAudit:E}),{...re,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:w,scheduledMatchUpIds:T,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:P}}function mk(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=dr,scheduledDates:n,venueIds:r}=t,a=Ac(t),o=Ii(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Cn};let s=0;for(let l of o){let u=a[l],c=__e({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:n,venueIds:r});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...re,clearedScheduleCount:s}}function __e({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=dr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:Fe};if(!Array.isArray(e)||!Array.isArray(r))return{error:we};r.length&&t.push("venueId");let a=Wr({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&LD({schedule:c,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=ho({tournamentRecord:i,drawId:u}),p=za({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Up,Gm,P0,E0,C0].includes(m==null?void 0:m.itemType);return g||(h=!0),g}),h&&(ci({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:f}),l+=1)}}return{...re,clearedScheduleCount:l}}function gk(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=Lt(t,[{[Ua]:!0},{[ks]:P=>!P||Array.isArray(P)&&P.every(Go),[lte]:!1,[ul]:uo}]);if(c.error)return c;let d=ef({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...re};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(P=>D0({tournamentRecord:P}).containedStructures)),g=r.map(P=>{if(Go(P))return Ft(P)}).filter(Boolean),v=h.map(P=>P.scheduleDate).map(P=>Go(P)&&Ft(P)).filter(P=>P&&(!r.length||g.includes(P)));if(!v.length)return{error:see};if(n&&!l){let P=Array.isArray(n)?n:[];mk({tournamentRecords:a,scheduledDates:P})}let y=Qp({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Fu({matchUpFilters:{matchUpTypes:[sn,Wi]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=tu({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=ek({tournamentRecords:a}),{personRequests:w}=Rg({requestType:qD,tournamentRecords:a}),S=h.filter(P=>{let E=Ft(P==null?void 0:P.scheduleDate);return v.includes(E)}).sort((P,E)=>new Date(P.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:b,dryRun:l,courts:y};return u?A_e(U):N_e(U)}function Mse(t){let e=t||{};return e.tournamentId||(e.tournamentId=Mi()),e.startDate&&!Fm(e.startDate)&&!aM.test(e.startDate)?{error:Ka}:e.endDate&&!Fm(e.endDate)&&!aM.test(e.endDate)?{error:Ka}:(e.extensions&&(e.extensions=e.extensions.filter(mc)),{...e})}function Kz({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var h,m;if(!i)return{error:Fe};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Qt&&v===la),u=0;for(let g of l){let v=a&&((h=Sv({element:g,accessor:a}))==null?void 0:h.value)||n&&((m=g.person)==null?void 0:m[n])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(r==null?void 0:r[u])??v,participantId:(o==null?void 0:o.pop())??Mi(),individualParticipantIds:[],participantRole:la,participantType:Fi};let y={value:n??e,name:I2};fi({element:s[v],extension:y}),u+=1}s[v].individualParticipantIds.push(g.participantId)}}let c=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==Fi||g.participantRole!==la)return;let{extension:v}=$t({name:I2,element:g}),y=v==null?void 0:v.value;if(c.includes(y))return g.participantId}).filter(Boolean),p=0,f=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),f.push(v),p++)}),t&&p?(jt({payload:{tournamentId:i.tournamentId,participants:f},topic:th}),{...re,participantsAdded:p}):f.length?{...re,newParticipants:f}:{error:Z1e}}var k_e=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],O_e=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Nse({count:t=1,participantsCount:e=32}={}){let i=Ga(O_e),n=i.slice(0,t);return{cities:Xe(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Bo(n))}}function Ase({count:t=1,participantsCount:e=32}={}){let i=Ga(k_e),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Xe(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Bo(n))}}function _se({count:t=1,participantsCount:e=32}={}){let i=Xe(0,t).map(()=>Xe(0,5).map(()=>Ms(0,9)).join(""));return{postalCodes:Xe(0,e).map(n=>n<t?i[n]:Bo(i))}}function kM({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Qt?"I":"P"}-${i}`:(n==null?void 0:n.pop())||Mi()}function kse(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var x_e={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function _L(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![zi,pn].includes(i))return{personData:[],error:we};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=x_e,s=Hf.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),c=Math.ceil(n/o.length),d=Xe(0,l).flatMap(()=>{let m=st(r,!1,!0);return Xe(0,r.length).map(()=>Vo(m))}),p=Xe(0,u).flatMap(()=>{let m=st(a,!1,!0);return Xe(0,a.length).map(()=>Vo(m))}),f=Xe(0,c).flatMap(()=>{let m=st(o,!1,!0);return Xe(0,o.length).map(()=>Vo(m))}),h={};for(let m=0;m<n;m++){let g=d.pop(),v=i||Bo([zi,pn]),y=v===zi?f.pop():p.pop(),b=Bo(s);h[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function Ose(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:we};let u=(a==null?void 0:a[zi])||l===zi&&e||0,c=(a==null?void 0:a[pn])||l===pn&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&_L({count:u,sex:zi}).personData||[],f=c&&_L({count:c,sex:pn}).personData||[],h=[...p,...f,...d&&_L({count:d}).personData||[]],m=h.filter(U=>!l||u&&c||U.sex===l),g=[];if(Array.isArray(o)){let U=o.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![zi,pn].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!Hf.find(({iso:E,ioc:D})=>[E,D].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(U.length)m=U;else return{error:we}}let v=o?m:Ga(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:P,femaleFirstNames:E,femaleLastNames:D,nationalityCodes:R}=h.reduce((N,M)=>{let{firstName:A,lastName:_,nationalityCode:k}=M;return M.sex===zi?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(k)||N.nationalityCodes.push(k),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Xe(0,e-v.length).forEach(()=>{let N=l||Bo([zi,pn]),M=Bo(R),A=Bo(N===zi?U:E),_=Bo(N===zi?P:D),k={firstName:A,lastName:_,sex:N,nationalityCode:M};v.push(k)})}let{ageMinDate:y,ageMaxDate:b}=DD({consideredDate:n,category:s}),I=St((y==null?void 0:y.slice(0,4))||0)||St((b==null?void 0:b.slice(0,4))||0)-3,T=St((b==null?void 0:b.slice(0,4))||0)||St((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((U,P)=>{let[E,D]=w||[],R=w&&Vo(Xe(E,D)),N=Vo(Xe(0,365)),M=R&&cPe(R,N);return Object.assign(pt({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var L_e=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function nB({nameRoot:t="TEAM",count:e=1}={}){let i=Ga(L_e).slice(0,e);return i.length<e&&Xe(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function G0(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:n=Cr,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:c,nationalityCodes:d,participantsCount:p=32,participantType:f,personIds:h,idPrefix:m,uuids:g,personExtensions:v,addressProps:y,gendersCount:b,matchUpType:I,personData:T,sex:w,inContext:S,withISO2:U,withIOC:P,scaleAllParticipants:E}=t,D=f===Ot||I===jm,R=f===Fi||I===Fi;i&&(!Array.isArray(i)||!i.every(me=>Dn(me))||i.length!==2)&&(i=void 0),e=E?p:e;let N=1e3,M=e&&e>N?e:N;i=i||[1,M],i[1]+=1;let A=p*(D?2:R?8:1),_=Ose({count:A,personExtensions:v,consideredDate:o,gendersCount:b,personData:T,category:l,sex:w});if(_.error)return _;let{nationalityCodes:k,persons:B}=_,F={},x={},$={},j={},V=me=>{Object.assign(F,me.doublesRankings),Object.assign(x,me.singlesRankings),Object.assign(j,me.doublesRatings),Object.assign($,me.singlesRatings)};if(Ii(l)){let me=p9({scaledParticipantsCount:e,ratingsParameters:n,participantType:f,ratingsValues:a,rankingRange:i,category:l});V(me)}Array.isArray(s)&&s.forEach(me=>{let Ee=p9({scaledParticipantsCount:e,ratingsParameters:n,participantType:f,ratingsValues:a,rankingRange:i,category:me});V(Ee)});let H=Hf.filter(me=>c==="IOC"&&me.ioc||me.iso);function z(me){let Ee=Math.ceil(A/me);return r&&Ee>r?Math.ceil(A/r):me}let{postalCodesProfile:q,postalCodesCount:W,statesProfile:Y,citiesProfile:Z,citiesCount:X,statesCount:Q}=y||{},ce=me=>Object.keys(me).map(Ee=>Xe(0,Y[Ee]).map(()=>Ee)).flat(),J=Z&&ce(Z)||(y==null?void 0:y.cities)||Nse({count:X||A,participantsCount:A}).cities,ee=Y&&ce(Y)||(y==null?void 0:y.states)||Ase({count:Q||A,participantsCount:A}).states,ne=q&&ce(q)||(y==null?void 0:y.postalCodes)||_se({count:W||A,participantsCount:A}).postalCodes,ie={cities:J,states:ee,postalCodes:ne},oe=z(u),se=oe?Ga(H).slice(0,u):d?H.filter(me=>d.includes(me.iso)):H,pe=Ga(Xe(0,Math.ceil(A/(oe||1))).map(()=>se).flat(1/0)),fe=nB({count:p}).names;return{participants:Xe(0,p).map(me=>{let Ee=D?2:R?8:1,Be=Xe(0,Ee).map(be=>{let Le=me*Ee+be;return ge(Le)}),Pe=Be.map(be=>be.participantId),et=Be.map(be=>be.person.standardFamilyName).join("/"),Ie=D?Ot:Fi,Ne={participantId:kM({participantType:Ie,idPrefix:m,index:me,uuids:g}),participantRole:la,participantName:D?et:fe[me],individualParticipantIds:Pe,participantType:Ie};return S&&(Ne.individualParticipants=Be),D||R?[Ne,...Be]:Be}).flat(),...re};function ge(me){let Ee=B[me],{nationalityCode:Be,participantExtensions:Pe,participantTimeItems:et,extensions:Ie,firstName:Ne,birthDate:be,lastName:Le,personId:Me,sex:Ze}=Ee||{},qe=Ne||"GivenName",ye=Le||"FamilyName",_e=`${qe} ${ye}`,Ae=pe[me],Ve=(k==null?void 0:k.length)&&Be||Ae&&(c==="IOC"?Ae.ioc||Ae.iso:Ae.iso||Ae.ioc)||Be;pe!=null&&pe.length&&!Ve&&!Be&&console.log("%c Invalid Nationality Code",{participantIndex:me,country:Ae});let Ke=kse({...ie,participantIndex:me,nationalityCode:Ve}),he=pt({participantId:kM({participantType:Qt,index:me,idPrefix:m,uuids:g}),extensions:Pe,timeItems:et,participantRole:la,participantType:Qt,participantName:_e,person:{personId:Me||(h==null?void 0:h.length)&&h[me]||Mi(),birthDate:Go(be)?be:void 0,addresses:[Ke],standardFamilyName:ye,standardGivenName:qe,nationalityCode:Ve,extensions:Ie,sex:Ze}});if(P&&Ve){let Ce=Hf.find(({iso:De})=>De===Ve);Ce!=null&&Ce.ioc&&(he.person.iocNationalityCode=Ce.ioc),Ce!=null&&Ce.label&&(he.person.countryName=Ce.label)}if(U&&Ve){let Ce=Hf.find(({iso:De})=>De===Ve);Ce!=null&&Ce.iso2&&(he.person.iso2NationalityCode=Ce.iso2),Ce!=null&&Ce.label&&(he.person.countryName=Ce.label)}let ve=Ce=>{var bt,Gt,Zt,Sr;let De=Ce.categoryName||Ce.ratingType||Ce.ageCategoryCode,Ue=(bt=x[De])==null?void 0:bt[me],Qe=(Gt=F[De])==null?void 0:Gt[me];oC({scaleValue:Ue,eventType:Wv,scaleType:Jf,participant:he,category:Ce}),oC({scaleValue:Qe,eventType:Xf,scaleType:Jf,participant:he,category:Ce});let je=(Zt=$[De])==null?void 0:Zt[me],ke=(Sr=j[De])==null?void 0:Sr[me];oC({scaleValue:je,eventType:Wv,scaleType:Gf,participant:he,category:Ce}),oC({scaleValue:ke,eventType:Xf,scaleType:Gf,participant:he,category:Ce})};return Array.isArray(s)?s.forEach(Ce=>ve(Ce)):l&&ve(l),he}}function oC({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[Lm,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function p9(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},u={},c={},{categoryName:d,ageCategoryCode:p,ratingType:f}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!f){let[m,g]=o||[];if(l[h]=Ga(Xe(m,g)).slice(0,i||Ms(20,30)),[Ot,Fi].includes(r)){let[v,y]=o||[];s[h]=Ga(Xe(v,y)).slice(0,i||Ms(20,30))}}if(f&&n[f]){let{ratingMax:m,ratingMin:g,ratingAttributes:v}=e,y={...n[f],...v||{}},{attributes:b={},decimalsCount:I,accessors:T,range:w,step:S}=y,U=N=>{let M={},A=Object.keys(N||{});for(let _ of A){let k=N[_];if(typeof k=="object"&&k.generator){let{range:B}=k,[F,x]=B.slice().sort();M[_]=Ms(F,x)}else M[_]=k}return M},P=w[0]>w[1]?2:.7,[E,D]=w.slice().sort(),R=Xe(0,2e3).map(()=>qee(E,D,P,S,I)).filter(N=>(!m||N<=m)&&(!g||N>=g)).slice(0,i||Ms(20,30)).map(N=>T?Object.assign({},...T.map(M=>({[M]:N})),U(b)):N);u[h]=[...a,...R],[Ot,Fi].includes(r)&&(c[h]=[...a,...R])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:c}}function Yz(t){var f,h;let{alternatesCount:e=0,tieFormatName:i,drawSize:n}=t,r=0,a=0,o=0,s=0,l={},u={[zi]:0,[pn]:0,[Po]:0,[Dm]:0,[Lu]:0};(h=(f=Ii(t.tieFormat)?t.tieFormat:Xm({namedFormat:i}))==null?void 0:f.collectionDefinitions)==null||h.filter(Boolean).forEach(m=>{let{category:g,collectionId:v,matchUpType:y,matchUpCount:b,gender:I}=m;if([zi,pn].includes(I)){let T=b*(y===Wi?2:1);u[I]<T&&(u[I]=T)}else I===Po&&(u[zi]<b&&(u[zi]=b),u[pn]<b&&(u[pn]=b));if(g){let T=JSON.stringify(g);l[T]=g}if(v||(m.collectionId=Mi()),On(Wi)(y)){let T=b;s+=b,r=Math.max(r,T)}if(On(sn)(y)){let T=b;o+=b,a=Math.max(a,T)}});let c=Object.keys(l).length?Math.max(o,s*2):Math.max(a,r*2),d=r*(n+e),p=a*(n+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:c,genders:u}}function F_e({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Qt}=t||{},a=n||0,o={[pn]:0,[Po]:0,[Dm]:0,[zi]:0,[Lu]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===Zs,U=y===vr,P=!!(m||w===gt||I||T);if(U){c=Math.max(c,v+h),b=typeof b=="object"?b:Xm({namedFormat:g});let{teamSize:E,maxDoublesDraw:D,maxSinglesDraw:R,genders:N}=Yz({alternatesCount:h,tieFormatName:g,tieFormat:b,drawSize:v});u=Math.max(u,E),l=Math.max(l,R),P||(s=Math.max(s,D)),Object.keys(N).forEach(M=>o[M]+=N[M])}else if(S)if(P){let E=(v+h)*2;d+=E,T&&(o[T]+=E)}else v+h&&v+h>s&&(s=v+h);else if(P){let E=v+h;T&&(o[T]+=E),d+=E}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=h;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(c*u,s*2,l);return s&&(r=Ot),(n||a)<f&&(n=f),n&&s&&[Ot,vr].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:c,largestTeamSize:u,participantType:r,gendersCount:o}}function xse({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=F_e({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=G0({consideredDate:r,...t,participantsCount:o,participantType:s,gendersCount:c,uuids:a}).participants,f=0,h=Hl({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let y=Kz({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Qt).map(Jt),g=t!=null&&t.idPrefix?`${Fi}-${t.idPrefix}`:void 0,v=Xe(0,l).map(y=>{let b=m.slice(y*u,(y+1)*u),I=kM({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:la,individualParticipantIds:b,participantType:Fi,participantId:I}});return h=Hl({participants:v,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...re})}function Lse({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=it,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let f=(u||p)-l;return c||i||e||d===gt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=f):o[d]=Math.max(o[d],f),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function Fse({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[it]||0,a=e[gt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var B_e={[yi]:2,[ir]:1,[br]:1,[ta]:1,[ai]:4};function Zz(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=B_e,matchUpFormat:r=kl,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Zo({matchUpFormat:r}))return{error:HV};if(typeof n!="object")return{error:we};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:we};let s=Object.keys(n).filter(U=>Object.keys(Gj).includes(U)&&U!==kn);if(Object.keys(s).reduce((U,P)=>U+n[P],0)>100)return{error:we,matchUpStatusProfile:n};let l=s.reduce((U,P)=>(U.pointer=U.pointer+n[P],U.valueMap.push([U.pointer,P]),U),{pointer:0,valueMap:[]}),u=Ms(1,100),c=(l.valueMap.find(U=>u<=U[0])??[100,kn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([yi,ai].includes(c)){i=i||Ms(1,2);let U={score:d,winningSide:i,matchUpStatus:c};if(!(c===ai&&Ms(1,100)>100-e))return{outcome:U}}else if([ir,br].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=yo(r),{bestOf:f,setFormat:h,finalSetFormat:m}=p??{},g=[],v=Ms(0,1),y=i?[i-1]:[...Xe(0,o).map(()=>v),1-v],b=[ta,ai,Qs,Mh].includes(c)&&(Vo(Xe(1,f))||1),I;for(let U of Xe(1,(f??0)+1)){let P=U===f,{set:E,incomplete:D,winningSideNumber:R}=$_e({incomplete:b===U,matchUpStatus:c,pointsPerMinute:a,setFormat:P&&m||h,setNumber:U,weightedRange:y});if(g.push(E),D){I=R;break}if(CU({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let T=CU({matchUp:{score:{sets:g},matchUpFormat:r}}),w=I?i||I:T.calculatedWinningSide,{score:S}=bse({score:{sets:g},winningSide:w,matchUpStatus:c});return{outcome:{score:S,winningSide:w,matchUpStatus:c}}}function $_e({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=r,f=Ms(0,t.length-1),h=t[f],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Vo([1,-1])*v,b=IDe(y,2),I=[b,y-b];h&&I.reverse(),m=t[f]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,P]=I;return Object.assign(o,{side1Score:U,side2Score:P}),dr.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}T||(I[Ms(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=Ms(0,u),o.side2Score=Ms(0,u),dr.includes(i)&&(m=t[f]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Xe(1,s+1).map(S=>Xe(0,s+2-S).map(()=>S)).flat(),v=g[Ms(0,g.length-1)],y=s&&AH({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[f]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():h&&y.reverse();let[S,U]=y;Object.assign(o,{side1Score:S,side2Score:U})}let T=PU({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:U}=l||c||{},P=Xe(1,U+1).map(R=>Xe(0,U+2-R).map(()=>R)).flat(),E=P[Ms(0,P.length-1)],D=V_({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(D)if(b){let R=D[0]>D[1]?1:2;I?R!==I&&D.reverse():h&&D.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=D,w=D[0]>D[1]&&1||D[1]>D[0]&&2||void 0}else T.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=D:[o.side2TiebreakScore,o.side1TiebreakScore]=D}o.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:o}}function OM(t){var m,g,v;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:ot};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),u=o.structures.slice().sort(Gy),c=0,{matchUps:d,matchUpsMap:p}=pr({contextFilters:{stages:[it,gt]},matchUpFilters:{matchUpTypes:[Zi],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let y=((m=s==null?void 0:s.category)==null?void 0:m.ageCategoryCode)||((g=s==null?void 0:s.category)==null?void 0:g.categoryName);if(y){let b=Joe({singlesOnly:!0,tournamentRecord:r,drawDefinition:o,scaleAccessor:{scaleName:y,sortOrder:Zoe,scaleType:Jf},event:s});if(b.error)return b;let{lineUps:I,participantsToAdd:T}=b;Hl({tournamentRecord:r,participants:T}),fi({element:o,extension:{name:bp,value:I}})}else{let b=(v=d[0])==null?void 0:v.structureId,{positionAssignments:I}=Gi({drawDefinition:o,structureId:b});if(I!=null&&I.length){let{participants:T}=Bn({participantFilters:{participantTypes:[Zi]},tournamentRecord:r}),w=S=>{let U=S.tieMatchUps.filter(On(sn)),P=S.tieMatchUps.filter(On(Wi));U.forEach((E,D)=>{let R=E.matchUpId;E.sides.forEach(N=>{var _;let{drawPosition:M}=N,A=T==null?void 0:T.find(k=>{var F;let{participantId:B}=k;return((F=I.find(x=>x.participantId===B))==null?void 0:F.drawPosition)===M});if(A){let k=(_=A.individualParticipantIds)==null?void 0:_[D];k&&_M({teamParticipantId:A.participantId,participantId:k,tournamentRecord:r,drawDefinition:o,tieMatchUpId:R,event:s})}})}),P.forEach((E,D)=>{let R=E.matchUpId;E.sides.forEach(N=>{var _,k;let{drawPosition:M}=N,A=T==null?void 0:T.find(B=>{var x;let{participantId:F}=B;return((x=I.find($=>$.participantId===F))==null?void 0:x.drawPosition)===M});A&&((k=(_=A.individualParticipantIds)==null?void 0:_.slice(D*2,D*2+2))==null||k.forEach(B=>{_M({teamParticipantId:A.participantId,participantId:B,tournamentRecord:r,drawDefinition:o,tieMatchUpId:R,event:s})}))})})};d.forEach(w)}}}let f=typeof i=="string"&&i,h=f&&kn;for(let y of u){if(c>=a)break;let{matchUps:b}=Ei({matchUpFilters:{matchUpTypes:[Wi,sn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),I=b.filter(({winningSide:T})=>!T).sort(Yy).map(Nr);for(let T of I){if(!isNaN(a)&&c>=a)break;let{matchUps:w}=Ei({matchUpFilters:{matchUpTypes:[Wi,sn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),S=w.find(P=>P.matchUpId===T),U=[ir,br].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!U){let P=V_e({winningSide:!n&&1,matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:o,targetMatchUp:S,matchUpFormat:l,matchUpStatus:h,scoreString:f,event:s});if(P!=null&&P.error)return P;c+=1}}}return{...re,completedCount:c}}function Bse(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===Ui)return;let{matchUpId:d}=a||{},{outcome:p}=Gz({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),HD({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function V_e(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return Bse(t);let{matchUpId:d}=s||{},{outcome:p}=Zz({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return HD({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function $se({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var h,m,g,v;let o=Gn({event:a}).flightProfile,{eventName:s,eventType:l,category:u}=a,{startDate:c}=n,d=[],p=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(u==null?void 0:u.ratingType),f=(h=a.drawDefinitions)==null?void 0:h.map(({drawId:y})=>y);if(Array.isArray(o==null?void 0:o.flights))for(let[y,b]of o.flights.entries()){let{drawId:I,stage:T,drawName:w,drawEntries:S}=b;d.push(b.drawId);let U=r[y],{seedsCount:P,generate:E=!0}=U||{};if(E){let D=S.filter(Yo(hd)).map(Yo(hd)),R=p||s;if(n&&P&&P<=D.length&&Xe(1,P+1).forEach((k,B)=>{let F={scaleValue:k,scaleName:R,scaleType:td,eventType:l,scaleDate:c},x=D[B];AD({tournamentRecord:n,participantId:x,scaleItem:F})}),f==null?void 0:f.includes(I))break;let N=BD({...U,matchUpType:l,seedingScaleName:R,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:w,drawId:I,event:a,stage:T});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:M}=N;if(!M)return{error:ms};let A=(m=r[y])==null?void 0:m.drawExtensions;if(Array.isArray(A)&&A.filter(mc).forEach(k=>fi({element:M,extension:k})),N=$D({suppressNotifications:!0,tournamentRecord:n,drawDefinition:M,event:a}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){let k=(g=M.structures)==null?void 0:g[0].structureId,B=C_({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:M,isMock:!0,structureId:k,event:a});if(B!=null&&B.error)return B}let _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){let k=U==null?void 0:U.matchUpFormat,B=OM({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:M,matchUpFormat:k,event:a});if(B.error)return{error:B.error,drawIds:[]};let F=B.completedCount;if((U==null?void 0:U.drawType)===Id){let x=(v=M.structures)==null?void 0:v.find(V=>V.stage===it);if(!x)return{error:Sn};let $=bD({structureId:x.structureId,tournamentRecord:n,drawDefinition:M,event:a});if($.error)return{error:$.error,drawIds:[]};let j=_?_-(F??0):void 0;if($=OM({completeAllMatchUps:!_&&e,completionGoal:_?j:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:M,matchUpFormat:k,event:a}),$.error)return{error:$.error,drawIds:[]}}}}}return{...re,drawIds:d}}function Vse(t){var w,S;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:u,gender:c,eventType:d}=s,p=On(hc)(d)&&Qt||On(Zs)(d)&&Ot||d,f=i[it]||0,h=i[gt]||0,m=(w=a.drawProfiles)!=null&&w.length?f+h:((S=a.participantsProfile)==null?void 0:S.participantsCount)??0,g=[zi,pn].includes(c)?c:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=G0({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:r==null?void 0:r.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:u,idPrefix:v,sex:g}),b=Hl({tournamentRecord:r,participants:y});if(b.error)return b;let I=y==null?void 0:y.filter(({participantType:U})=>U===p),T=y==null?void 0:y.map(Jt);return{uniqueDrawParticipants:I,uniqueParticipantIds:T}}function j_e({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=ac,qualifyingPositions:o=0,stage:s=it,drawSize:l=0,drawName:u,drawId:c}=n,d=l-o,p=i.slice(0,d).map(Jt);if(p.length){let m=rd({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let f=p.map(m=>({entryStatus:Wo,entryStage:s,participantId:m})),h=rk({drawName:u||a,qualifyingPositions:o,drawEntries:f,drawId:c,event:r,stage:s});return h.error?h:{...re}}function jse({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let u of r){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=it,drawSize:f=0}=u,h=f-c,m=d||o||a||p===gt,g=m?t.slice(l,l+h):i[p||it]||[];m&&(l+=h);let v=j_e({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:u,event:s});if(v.error)return v}return{...re}}function Gse(t){var Z;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,publish:p,isMock:f,uuids:h}=t,m=c.gender,g=c.eventName,{eventType:v=hc,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:T,tieFormatName:w,processCodes:S,discipline:U,eventLevel:P,timeItems:E,ballType:D,category:R}=c,N=c.eventId||Mi(),M=c.tieFormat||(v===vr?Xm({namedFormat:w,event:{eventId:N,category:R,gender:m},hydrateCollections:o,isMock:f}):void 0),A=u.participants;for(let X of b)!m&&X.gender&&(m=X==null?void 0:X.gender);let{stageParticipantsCount:_,uniqueParticipantsCount:k,uniqueParticipantStages:B}=Lse({drawProfiles:b,category:R,gender:m}),F=On(hc)(v)&&Qt||On(Zs)(v)&&Ot||v,{uniqueDrawParticipants:x=[],uniqueParticipantIds:$=[]}=B?Vse({event:{eventType:v,category:R,gender:m},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:l,tournamentRecord:u,eventProfile:c,eventIndex:d,uuids:h}):{},{eventAttributes:j}=c;typeof j!="object"&&(j={});let V=(R==null?void 0:R.categoryName)||(R==null?void 0:R.ageCategoryCode)||(R==null?void 0:R.ratingType);g=g||V||"Generated Event";let H={...j,surfaceCategory:T,processCodes:S,discipline:U,eventLevel:P,eventName:g,eventType:v,tieFormat:M,ballType:D,category:R,eventId:N,gender:m};if(I!=null&&I.length&&Array.isArray(I)){let X=I.filter(mc);X!=null&&X.length&&Object.assign(H,{extensions:X})}if(Array.isArray(E)&&E.forEach(X=>tb({event:W,timeItem:X})),typeof y=="object")for(let X of Object.keys(y))Km({policyDefinitions:{[X]:y[X]},event:H});H.category&&(H.category.categoryName=V);let z,q=VD({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:H});if(q.error)return q;let W=q==null?void 0:q.event,{stageParticipants:Y}=Fse({allUniqueParticipantIds:e,stageParticipantsCount:_,eventParticipantType:F,targetParticipants:A});if(b!=null&&b.length){let X=jse({uniqueDrawParticipants:x,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:u,drawProfiles:b,category:R,gender:m,event:W});if(X.error)return X;let Q=$se({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:u,drawProfiles:b,event:W});if(Q.error)return Q;z=Q.drawIds}else if((Z=c==null?void 0:c.participantsProfile)!=null&&Z.participantsCount){let X=x.map(Jt);if(X.length){let Q=rd({participantIds:X,autoEntryPositions:a,tournamentRecord:u,entryStage:it,event:W});if(Q.error)return Q}}return p&&B0({tournamentRecord:u,event:W}),{drawIds:z,eventId:N,uniqueParticipantIds:$}}function Xz({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Go(e))return{error:Ka};let r="addSchedulingProfileRound",{extension:a}=$t({name:Zv,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>vd(e,p.scheduleDate));if(!s){let{startDate:p,endDate:f}=H_({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:Ka};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>Ii(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(n)))return le({result:{error:YQ},stack:r});l.rounds.push(n);let d=x0({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...re}}function G_e({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:we};let i=D0({tournamentRecord:e}).containedStructures,n=Wr({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,g=n.filter(v=>{var I;let y=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(T=>+T),b=(I=v.finishingPositionRange)==null?void 0:I.winner;return v.drawId===f&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Ln(b,y).length===2||Vt(b).length===Vt(y).length&&Ln(b,y).length===Vt(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:f},U=Xz({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function vk(t){var Be,Pe,et;let e=Lt(t,[{drawProfile:!0,_ofType:us}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,isMock:d=!0,drawProfile:p,startDate:f,drawIndex:h,uuids:m}=t,g=st(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=kl,drawType:b=ac,tournamentAlternates:I=0,alternatesCount:T=0,qualifyingPositions:w,qualifyingProfiles:S,generate:U=!0,eventExtensions:P,drawExtensions:E,completionGoal:D,tieFormatName:R,seedsCount:N,timeItems:M,drawName:A,category:_,idPrefix:k,publish:B,gender:F,stage:x}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),j=g.eventId||Mi(),V=p.eventType||p.matchUpType||hc,H=V===Zs?Ot:Qt,z=Ii(p.tieFormat)&&p.tieFormat||V===Fi&&Xm({event:{eventId:j,category:_,gender:F},namedFormat:R,hydrateCollections:s,isMock:d})||void 0,q=(_==null?void 0:_.categoryName)||(_==null?void 0:_.ageCategoryCode)||(_==null?void 0:_.ratingType),W=p.eventName||q||`Generated ${V}`,Y=(c==null?void 0:c.participants)||[],Z=((S==null?void 0:S.map(Ie=>Ie.structureProfiles||[]).flat().reduce((Ie,Ne)=>{let be=!Ne.participantsCount||Ne.participantsCount>Ne.drawSize?Ne.drawSize:Ne.participantsCount||0;return Ie+be},0))||0)*(H===Ot?2:1),X=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,Q={eventName:W,eventType:V,tieFormat:z,category:_,eventId:j,gender:F};Array.isArray(M)&&M.forEach(Ie=>tb({event:Q,timeItem:Ie}));let{eventAttributes:ce}=p;if(typeof ce!="object"&&(ce={}),Object.assign(Q,ce),(P==null?void 0:P.length)&&Array.isArray(P)){let Ie=P.filter(mc);Ie!=null&&Ie.length&&Object.assign(Q,{extensions:Ie})}let J=[];if(Z||p.uniqueParticipants||!c||F||_){let Ie=(X||0)+T+Z,Ne=Ie,be={[zi]:0,[pn]:0},Le,Me;V===Fi&&({teamSize:Le,genders:Me}=Yz({alternatesCount:T,tieFormatName:R,tieFormat:z,drawSize:$}),Object.keys(Me).forEach(ye=>{[zi,pn].includes(ye)&&Me[ye]&&(be[ye]=$*Me[ye])}),Ne=Le*(($||0)+Z));let Ze=n!=null&&n.idPrefix?`D-${h}-${n==null?void 0:n.idPrefix}`:void 0,qe=G0({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:Ne,consideredDate:c==null?void 0:c.startDate,sex:F||(n==null?void 0:n.sex),rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:u,participantType:H,gendersCount:be,idPrefix:Ze,category:_}).participants;if(Q.category&&(Q.category.categoryName=q),c){let ye=Hl({participants:qe,tournamentRecord:c});if(ye.error)return ye}if(qe.forEach(({participantId:ye})=>J.push(ye)),Y=qe,V===Fi){let ye=Me[zi]?qe.filter(({participantType:Ue,person:Qe})=>Ue===Qt&&(Qe==null?void 0:Qe.sex)===zi).map(Jt):[],_e=Me[pn]?qe.filter(({participantType:Ue,person:Qe})=>Ue===Qt&&(Qe==null?void 0:Qe.sex)===pn).map(Jt):[],Ae=qe.filter(({participantType:Ue})=>Ue===Qt).map(Jt).filter(Ue=>!ye.includes(Ue)&&!_e.includes(Ue)),Ve=Le-(Me[zi]+Me[pn]),Ke=0,he=0,ve=0,Ce=Xe(0,Ie).map(Ue=>{let Qe=_e.slice(Ke,Ke+Me[pn]),je=ye.slice(he,he+Me[zi]),ke=Ae.slice(ve,ve+Ve);return Ke+=Me[pn],he+=Me[zi],ve+=Ve,{individualParticipantIds:[...Qe,...je,...ke],participantOtherName:`TM${Ue+1}`,participantName:`Team ${Ue+1}`,participantRole:la,participantType:Fi,participantId:Mi()}}),De=Hl({participants:Ce,tournamentRecord:c});if(!De.success)return De;Y=Ce}}let ee=Ie=>{let{participantType:Ne}=Ie;return On(hc)(V)&&Ne===Qt||On(Zs)(V)&&Ne===Ot?!0:V===Fi&&Ne===Fi},ne=Ie=>{var Ne,be;return!p.gender||((Ne=Ie.person)==null?void 0:Ne.sex)===p.gender?!0:(be=Ie.individualParticipantIds)==null?void 0:be.some(Le=>{let Me=Y.find(Ze=>Ze.participantId===Le);return Me&&ne(Me)})},ie=Y.filter(ee).filter(ne).filter(({participantId:Ie})=>!i.includes(Ie)),oe=ie.slice(0,X).map(Ie=>Ie.participantId);if(d&&(oe!=null&&oe.length)){let Ie=rd({autoEntryPositions:o,entryStage:x,tournamentRecord:c,participantIds:oe,event:Q});if(Ie.error)return Ie}let se=Z?ie.slice(X,X+Z).map(Ie=>Ie.participantId):0;if(d&&(se!=null&&se.length)){let Ie=0,Ne=1,be=(Me,Ze)=>Me.stageSequence-Ze.stageSequence,Le=(Me,Ze)=>Me.roundTarget-Ze.roundTarget;for(let Me of S.sort(Le)){Ne=Me.roundTarget||Ne;let Ze=1,qe;for(let ye of Me.structureProfiles.sort(be)){let _e=(ye.drawSize||uj(ye.participantsCount))-(qe||0),Ae=se.slice(Ie,Ie+_e),Ve=rd({entryStage:gt,entryStageSequence:Ze,autoEntryPositions:o,tournamentRecord:c,participantIds:Ae,roundTarget:Ne,event:Q});if(Ve.error)return Ve;qe=ye.qualifyingPositions,Ie+=_e,Ze+=1}Ne+=1}}let pe=v&&((Be=c==null?void 0:c.participants)==null?void 0:Be.filter(({participantId:Ie})=>!oe.includes(Ie)).filter(ee).filter(ne).slice(0,T||$-X||I).map(Ie=>Ie.participantId));if(d&&(pe!=null&&pe.length)){let Ie=rd({participantIds:pe,autoEntryPositions:!1,entryStatus:Al,tournamentRecord:c,event:Q});if(Ie.error)return Ie.error}let fe=q||W;c&&N&&N<=oe.length&&Xe(1,N+1).forEach((Ie,Ne)=>{let be={scaleName:fe,scaleDate:f,scaleType:wG,scaleValue:Ie,eventType:V},Le=oe[Ne];AD({tournamentRecord:c,participantId:Le,scaleItem:be})});let ge=BD({...st(p,!1,!0),tournamentRecord:c,seedingScaleName:fe,matchUpFormat:y,eventId:j,isMock:d,event:Q});if(ge.error)return ge;if(!ge.drawDefinition)return{error:ms};let{drawDefinition:me}=ge,Ee=me.drawId;if(Array.isArray(E)&&E.filter(mc).forEach(Ie=>fi({element:me,extension:Ie})),U){if($D({drawDefinition:me,event:Q,suppressNotifications:!0}),p.withPlayoffs){let Ne=(Pe=me.structures)==null?void 0:Pe[0].structureId,be=C_({...p.withPlayoffs,tournamentRecord:c,drawDefinition:me,structureId:Ne,idPrefix:k,isMock:d,event:Q});if(be!=null&&be.error)return be}let Ie=p.automated===!1;if(d&&!Ie){let Ne=be=>{var Ze;let Le=OM({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:c,drawDefinition:me,matchUpFormat:y,event:Q});if(Le.error)return Le;let Me=Le.completedCount;if(b===Id){let qe=(Ze=me.structures)==null?void 0:Ze.find(Ae=>Ae.stage===it);if(!qe)return{error:Sn};bD({structureId:qe.structureId,tournamentRecord:c,drawDefinition:me,event:Q});let ye=D?D-(Me??0):void 0,_e=OM({completionGoal:D?ye:void 0,matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawDefinition:me,matchUpFormat:y,event:Q});if(_e.error)return _e}};if(D&&Ne({completionGoal:D}),p.outcomes){let{matchUps:be}=za({inContext:!0,drawDefinition:me,event:Q});for(let Le of p.outcomes){let{matchUpStatus:Me=kn,matchUpStatusCodes:Ze,stageSequence:qe=1,matchUpIndex:ye=0,structureOrder:_e,matchUpFormat:Ae,drawPositions:Ve,roundPosition:Ke,stage:he=it,roundNumber:ve,winningSide:Ce,scoreString:De}=Le,Ue=(be==null?void 0:be.reduce((bt,Gt)=>{let{structureId:Zt,matchUpId:Sr}=Gt;return bt[Zt]?bt[Zt].push(Sr):bt[Zt]=[Sr],bt},{}))??[],Qe=Object.assign({},...Object.keys(Ue).map((bt,Gt)=>({[bt]:Gt+1}))),je=(et=be==null?void 0:be.filter(bt=>(!he||bt.stage===he)&&(!qe||bt.stageSequence===qe)&&(!ve||bt.roundNumber===ve)&&(!Ke||bt.roundPosition===Ke)&&(!_e||Qe[bt.structureId]===_e)&&(!Ve||Ln(Ve,bt.drawPositions).length===2)))==null?void 0:et[ye],ke=Bse({matchUpStatusCodes:Ze,tournamentRecord:c,drawDefinition:me,targetMatchUp:je,matchUpFormat:Ae,matchUpStatus:Me,scoreString:De,winningSide:Ce});if(ke!=null&&ke.error)return ke}}a&&Ne({completeAllMatchUps:a})}B&&B0({tournamentRecord:c,event:Q})}else{let Ie=rk({drawEntries:me.entries,drawName:A||b,qualifyingPositions:w,drawId:Ee,event:Q,stage:x});if(Ie.error)return Ie}return{...re,event:pt(Q),uniqueParticipantIds:J,targetParticipants:Y,drawDefinition:me,eventId:j,drawId:Ee}}var Hse=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),H_e=Hse;function xM(t){return parseInt(t)}function f9({startTime:t="",endTime:e=""}={}){if(!t||!e||!Um.test(t)||!Um.test(e))return!1;let[i,n]=t.split(":").map(xM),[r,a]=e.split(":").map(xM);return r<i?!1:!(i===r&&a<n)}function z_e(t,e){let[i,n]=t.startTime.split(":").map(xM),[r,a]=e.startTime.split(":").map(xM);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function zse({dateAvailability:t}){if(!t)return{error:lee};if(!Array.isArray(t))return{error:eR};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:eR};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:eR};if(r&&!gd.test(r))return{error:Ka,dateAvailability:{date:r},info:e};if(!Um.test(a))return{error:Il,dateAvailability:{startTime:a},info:i};if(!Um.test(o))return{error:Il,dateAvailability:{endTime:o},info:i};if(a===o)return{error:Il,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!f9({startTime:a,endTime:o}))return{error:Il,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:iM};for(let l of s){if(typeof l!="object")return{error:iM};let{startTime:u,endTime:c}=l;if(!Um.test(u))return{error:Il,booking:{startTime:u},info:i};if(!Um.test(c))return{error:Il,booking:{endTime:c},info:i};if(u===c)return{error:Il,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!f9({startTime:u,endTime:c}))return{error:Il,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function yk({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=Zp({tournamentRecord:t,venueId:i});if(!a)return{error:xy};a.courts||(a.courts=[]);let o={...Hse(),venueId:i,courtId:n};if(o.courtId||(o.courtId=Mi()),a.courts.some(s=>s.courtId===o.courtId))return{error:Dee};{let s=((r==null?void 0:r.dateAvailability)||[]).map(c=>{var d;return{...c,date:Ft(c.date),startTime:nn(c.startTime),endTime:nn(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:f,bookingType:h})=>({startTime:nn(p),endTime:nn(f),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(r!=null&&r[c])if(c==="dateAvailability"){let d=zse({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=r[c];let u=o;return a.courts.push(u),e||jt({payload:{venue:a,tournamentId:t.tournamentId},topic:Ig,key:a.venueId}),{...re,court:st(o),venueId:i}}}function Jz(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Ph};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=Zp({tournamentRecord:o,venueId:i});if(s){let l=q_e({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])r.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...re,courtIds:r}:{error:xy}}function q_e({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Ph};let f=Zp({tournamentRecord:n,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Dn(o)||!r)return{error:Uee};o=o??r.length;let m=Xe(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:Cu(b),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:r[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return yk({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?le({info:"not all courts could be generated",result:{error:we}}):(h&&jt({payload:{venue:h,tournamentId:n.tournamentId},topic:Ig,key:h.venueId}),{...re,courts:st(m)})}function Qz({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:u,venueId:c=(n==null?void 0:n.pop())??Mi(),dateAvailability:d,startTime:p="07:00",endTime:f="19:00",courtTimings:h,courtsCount:m,courtNames:g,venueName:v,idPrefix:y,courtIds:b}=l,I={venueName:v||`Venue ${s+1}`,venueAbbreviation:u,venueId:c},T=sD({tournamentRecord:t,venue:I});if(T.error){if(e)continue;return T}o.push(c);let w=YI(r,a),S=!Array.isArray(d)&&[{startTime:p,endTime:f}].concat(w.map(U=>({date:Cu(U),startTime:p,endTime:f})));if(m||g){let U=Jz({dateAvailability:d||S,tournamentRecord:t,courtTimings:h,courtsCount:m,courtNames:g,startTime:p,idPrefix:y,courtIds:b,endTime:f,venueId:c,dates:w});if(U.error)return U}}return o}function W_e(t){var c,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:n,venueIds:r,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let f of i){let h=[],{tieFormatName:m=MM,teamProfiles:g=[],teamsCount:v=0,category:y,idPrefix:b,gender:I}=f,T=f.leagueName??f.eventName??`League ${l+1}`,w=f.leagueId??f.eventId??(s==null?void 0:s.pop())??Mi();n.push(w);let S=Ii(f.tieFormat)&&f.tieFormat||Xm({event:{eventId:w,category:y,gender:I},namedFormat:m,isMock:t.isMock})||void 0;if(!S)return{error:d0};let U=Math.max(v,g.length),P=Xe(0,U),{genders:E,teamSize:D}=Yz({tieFormat:S,drawSize:U}),R={[pn]:0,[Po]:0,[Dm]:0,[zi]:0,[Lu]:0};Object.keys(E).forEach(M=>R[M]+=E[M]);for(let M of P){let A=((c=g==null?void 0:g[M])==null?void 0:c.teamName)??`Team ${M+1}`,_=((d=g==null?void 0:g[M])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Mi(),k=f.startDate??t.startDate,B=G0({...f==null?void 0:f.participantsProfile,participantsCount:D,consideredDate:k,gendersCount:R,category:y,gender:I,uuids:s}).participants,F=B.map(z=>z.participantId),x=Fi,$=_??kM({participantType:x,idPrefix:b,index:M,uuids:s});h.push({participantId:$,entryStatus:Wo,entryStage:it});let j=((p=g==null?void 0:g[M])==null?void 0:p.venueIds)??[],V={participantId:$,participantRole:la,participantName:A,individualParticipantIds:F,participantType:x,homeVenueIds:j};j.forEach(z=>!r.includes(z)&&r.push(z)),o.push(...F),o.push($);let H=Hl({participants:[V,...B],tournamentRecord:e});if(H.error)return H}let N={eventName:T,entries:h,eventType:Fi,tieFormat:S,category:y,eventId:w,gender:I};if(e.events||(e.events=[]),e.events.push(N),h.length){let M=Dn(f.roundsCount)?f.roundsCount:f.roundsCount===MPe?(U-1)*2:U-1,A=BD({automated:f.automated,tournamentRecord:e,drawType:el,roundsCount:M,drawSize:U,event:N});if(A.error)return A;let{drawDefinition:_}=A;if(_){let k=_==null?void 0:_.drawId;$D({drawDefinition:_,event:N,suppressNotifications:!0}),a.push(k)}}l++}let u=r.map(f=>({venueId:f}));Qz({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:u,uuids:s})}var K_e=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function qse(t){var v,y,b;let{startDate:e,endDate:i}=t??{},{tournamentName:n=Vo(K_e),ratingsParameters:r=Cr,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:u}=t??{};if(e&&!Go(e)||i&&!Go(i))return{error:Ka};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:we};if(!e){let I=new Date;e=Cu(i??I),i=Cu(I.setDate(I.getDate()+7))}if(!i){let I=new Date(e);i=Cu(I.setDate(I.getDate()+7))}let c=Mse({...t.tournamentAttributes??{},tournamentName:n,isMock:!0,startDate:e,endDate:i}),d=l!=null&&l.length?Qz({tournamentRecord:c,venueProfiles:l,uuids:u}):[];if(a!=null&&a.length&&Array.isArray(a)){let I=a.filter(T=>mc({extension:T}));I!=null&&I.length&&Object.assign(c,{extensions:I,isMock:!0})}if(typeof o=="object")for(let I of Object.keys(o))Km({policyDefinitions:{[I]:o[I]},tournamentRecord:c});if(!((v=t==null?void 0:t.leagueProfiles)!=null&&v.length)||(y=t.eventProfiles)!=null&&y.length||(b=t.drawProfiles)!=null&&b.length||t.participantsProfile){let I=xse({tournamentRecord:c,...t});if(!I.success)return I}let p=[],f=[],h=[];if(t.leagueProfiles){let I=W_e({allUniqueParticipantIds:p,tournamentRecord:c,...t,eventIds:f,venueIds:d,drawIds:h});if(I!=null&&I.error)return I}if(t.drawProfiles){let I=Y_e({allUniqueParticipantIds:p,ratingsParameters:r,tournamentRecord:c,...t,eventIds:f,drawIds:h});if(I!=null&&I.error)return I}if(t.eventProfiles){let I=Z_e({allUniqueParticipantIds:p,ratingsParameters:r,tournamentRecord:c,...t,eventIds:f,drawIds:h});if(I!=null&&I.error)return I}let{scheduledRounds:m=void 0,schedulerResult:g={}}=s?X_e({...t,tournamentRecord:c}):{};return pj(),pt({...re,tournamentRecord:c,scheduledRounds:m,schedulerResult:g,eventIds:f,venueIds:d,drawIds:h})}function Y_e(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=t,o=0;for(let s of i){let l=vk({allUniqueParticipantIds:n,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:u,eventId:c,event:d,uniqueParticipantIds:p}=l;if(l=VD({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;u&&a.push(u),r.push(c),p!=null&&p.length&&n.push(...p),o+=1}}function Z_e(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=t,a=0;for(let o of e){let s=Gse({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:u,uniqueParticipantIds:c}=s;u&&r.push(...u),n.push(l),c!=null&&c.length&&i.push(...c),a+=1}}function X_e(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=t,o=G_e({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(n){let{tournamentId:l}=i,u={[l]:i};return{schedulerResult:gk({scheduleCompletedMatchUps:a,tournamentRecords:u,periodLength:r}),scheduledRounds:s}}return{scheduledRounds:s}}var Wse={};Kt(Wse,{anonymizeTournamentRecord:()=>Kse,modifyTournamentRecord:()=>Yse});function Kse({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var B,F,x,$,j;if(!i)return{error:Fe};let o=Array.isArray(t)?w7.concat(...t):w7,s=V=>{var H;return Array.isArray(t)?(H=V==null?void 0:V.extensions)==null?void 0:H.filter(z=>o.includes(z.name)):V==null?void 0:V.extensions},l={};i.extensions=s(i);let u=a||Mi();l[i.tournamentId]=u,i.tournamentId=u,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Cu(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let V of i.participants||[]){let H=Mi();l[V.participantId]=H,V.participantId=H}for(let V of i.participants||[])Array.isArray(V.individualParticipantIds)&&(V.individualParticipantIds=V.individualParticipantIds.map(H=>l[H]));let c=0;for(let V of i.venues||[]){V.extensions=s(V),V.venueName=`Venue #${c}`,V.venueAbbreviation=`V${c}`;let H=Mi();l[V.venueId]=H,V.isMock=!0,c+=1}let d=1;for(let V of i.events||[]){V.extensions=s(V),V.isMock=!0;let H=Mi();l[V.eventId]=H,V.eventId=H;let z=((B=V.category)==null?void 0:B.categoryName)||((F=V.category)==null?void 0:F.ageCategoryCode)||((x=V.category)==null?void 0:x.ratingType)||V.gender;if(V.eventName=`Event ${d} ${z}`,Array.isArray(V.entries))for(let W of V.entries)W.participantId=l[W.participantId];for(let W of V.drawDefinitions||[]){W.extensions=s(W);let Y=Mi();if(l[W.drawId]=Y,W.drawId=Y,W.isMock=!0,Array.isArray(W.entries))for(let X of W.entries)X.participantId=l[X.participantId];let Z=X=>{X.extensions=s(X);let Q=Mi();l[X.structureId]=Q,X.structureId=Q;for(let ce of X.positionAssignments||[])ce.participantId&&(ce.participantId=l[ce.participantId]);for(let ce of X.seedAssignments||[])ce.participantId&&(ce.participantId=l[ce.participantId]);for(let ce of X.matchUps||[]){ce.isMock=!0;for(let J of ce.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:ee,collectionAssignments:ne})=>({participantId:l[ee],collectionAssignments:ne})))}};for(let X of W.structures||[])if(Z(X),Array.isArray(X.structures))for(let Q of X.structures)Z(Q);for(let X of W.links||[])X.source.structureId=l[X.source.structureId],X.target.structureId=l[X.target.structureId]}let{extension:q}=$t({name:Vl,element:V});Array.isArray(($=q==null?void 0:q.value)==null?void 0:$.flights)&&((j=q==null?void 0:q.value.flights)==null||j.forEach(W=>{if(W.drawId=l[W.drawId],Array.isArray(W.drawEntries))for(let Y of W.drawEntries)Y.participantId=l[Y.participantId]})),d+=1}let p=i.startDate||Cu(new Date),f=(i.participants||[]).filter(({participantType:V})=>V===Qt),h=f.reduce((V,H)=>{var q;let z=(q=H.person)==null?void 0:q.sex;return[zi,pn].includes(z)?V[z]+=1:V[Dm]+=1,V},{[zi]:0,[pn]:0,[Dm]:0}),m=Object.assign({},...Object.keys(h).map(V=>{var H;return{[V]:((H=Ose({category:{ageCategoryCode:"O18"},count:h[V],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:V}))==null?void 0:H.persons)||[]}})),g={[zi]:0,[pn]:0,[Dm]:0},v=f.length,y=f.reduce((V,H)=>{var Z,X;let z=((X=(Z=H.person)==null?void 0:Z.addresses)==null?void 0:X[0])||{},{city:q,state:W,postalCode:Y}=z;return V.cities.includes(q)||V.cities.push(q),V.states.includes(W)||V.states.push(W),V.postalCodes.includes(Y)||V.postalCodes.push(Y),V},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,T=y.states.length,{cities:w}=Nse({count:I||v,participantsCount:v}),{states:S}=Ase({count:T||v,participantsCount:v}),{postalCodes:U}=_se({count:b||v,participantsCount:v}),P={cities:w,states:S,postalCodes:U};f.forEach((V,H)=>{var X,Q;let z=V==null?void 0:V.person,q=(z==null?void 0:z.sex)||Dm,W=(X=Ft(z==null?void 0:z.birthDate))==null?void 0:X.split("-")[0],Y=g[q],Z=m[q][Y];if(g[q]+=1,W){let[,ce,J]=((Q=Z==null?void 0:Z.birthDate)==null?void 0:Q.split("-"))||[],ee=[W,ce,J].join("-");Z.birthDate=ee}if(z!=null&&z.addresses){let ce=kse({...P,participantIndex:H,nationalityCode:Z.nationalityCode});Z.addresses=[ce]}Z.personId=(r==null?void 0:r[H])||Mi(),e?(Z.standardFamilyName=Z.lastName,Z.standardGivenName=Z.firstName,V.participantName=`${Z.standardGivenName} ${Z.standardFamilyName}`):(Z.standardFamilyName=z==null?void 0:z.standardFamilyName,Z.standardGivenName=z==null?void 0:z.standardGivenName),delete Z.firstName,delete Z.lastName,Z.extensions=s(z),V.person=Z,l[z==null?void 0:z.personId]=Z.personId}),(i.participants||[]).filter(({participantType:V})=>V===Ot).forEach(V=>{let{individualParticipantIds:H}=V;V.participantName=J_e({individualParticipantIds:H,individualParticipants:f})});let E=(i.participants||[]).filter(({participantType:V})=>V===Fi),D=E.length,R=nB({count:D}).names;E.forEach((V,H)=>{V.participantName=R[H]});let N=(i.participants||[]).filter(({participantType:V})=>V===ws),M=N.length,A=nB({count:M,nameRoot:"Group"}).names;N.forEach((V,H)=>{V.participantName=A[H]});let{extension:_}=$t({element:i,name:Zv});Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(V=>{V.tournamentId=l[V.tournamentId],V.structureId=l[V.structureId],V.eventId=l[V.eventId],V.drawId=l[V.drawId]}));let{extension:k}=$t({element:i,name:w0});return Array.isArray(k==null?void 0:k.value)&&(k==null||k.value.forEach(V=>{V.personId=l[V.personId]})),{...re}}function J_e({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Yse(t){var U,P,E;let{ratingsParameters:e=Cr,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:u,eventProfiles:c,periodLength:d,venueProfiles:p,autoSchedule:f,drawProfiles:h,uuids:m}=t;if(!u)return{error:Fe};let g=[],v=[],y=[];c==null||c.forEach(D=>{var N;let R=(N=u.events)==null?void 0:N.find((M,A)=>D.eventIndex!==void 0&&A===D.eventIndex||D.eventName&&M.eventName===D.eventName||D.eventId&&M.eventId===D.eventId);R!=null&&R.gender&&(D.gender=R.gender)});let b=((U=u.participants)==null?void 0:U.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let I=xse({startDate:u.startDate,participantsProfile:i,tournamentRecord:u,eventProfiles:c,drawProfiles:h,uuids:m});if(!I.success)return I;if(c){let D=((P=u.events)==null?void 0:P.length)||0;for(let R of c){let{ratingsParameters:N}=R,M=(E=u.events)==null?void 0:E.find((A,_)=>R.eventIndex!==void 0&&_===R.eventIndex||R.eventName&&A.eventName===R.eventName||R.eventId&&A.eventId===R.eventId);if(M){let{gender:A,category:_,eventType:k}=M,{drawProfiles:B,publish:F}=R,x=On(hc)(k)&&Qt||On(Zs)(k)&&Ot||k;if(B){let{stageParticipantsCount:$,uniqueParticipantsCount:j,uniqueParticipantStages:V}=Lse({drawProfiles:B,category:_,gender:A}),{uniqueDrawParticipants:H=[],uniqueParticipantIds:z=[]}=V?Vse({event:{eventType:k,category:_,gender:A},uniqueParticipantsCount:j,participantsProfile:i,ratingsParameters:N,tournamentRecord:u,eventProfile:R,uuids:m}):{};g.push(...z);let{stageParticipants:q}=Fse({targetParticipants:u.participants||[],allUniqueParticipantIds:g,stageParticipantsCount:$,eventParticipantType:x}),W=jse({uniqueDrawParticipants:H,autoEntryPositions:a,stageParticipants:q,tournamentRecord:u,drawProfiles:B,category:_,gender:A,event:M});if(W.error||(W=$se({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:u,drawProfiles:B,event:M}),W.error))return W;y.push(...W.drawIds)}F&&B0({tournamentRecord:u,event:M})}else{let A=Gse({startDate:u.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:N,tournamentRecord:u,eventProfile:R,eventIndex:D,uuids:m});if(A.error)return A;let{eventId:_,drawIds:k,uniqueParticipantIds:B}=A;k&&y.push(...k),v.push(_),B!=null&&B.length&&g.push(...B),D+=1}}}if(h){let D=(u.events||[]).map(R=>{var N;return((N=R.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((R,N)=>R+N,0);for(let R of h){let N=vk({startDate:u.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:u,drawProfile:R,drawIndex:D,uuids:m});if(N.error)return N;let{drawId:M,eventId:A,event:_,uniqueParticipantIds:k}=N;if(N=VD({tournamentRecord:u,event:_,internalUse:!0}),N.error)return N;M&&y.push(M),v.push(A),k!=null&&k.length&&g.push(...k),D+=1}}let T=p!=null&&p.length?Qz({tournamentRecord:u,venueProfiles:p}):[],w,S={};if(l!=null&&l.length){let D={[u.tournamentId]:u},R=x0({tournamentRecords:D,schedulingProfile:l});if(R.error)return R;if(f){let{tournamentId:N}=u,M={[N]:u};S=gk({tournamentRecords:M,periodLength:d})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:w,schedulerResult:S,...re,eventIds:v,venueIds:T,drawIds:y}}var e3={};Kt(e3,{addDynamicRatings:()=>SH,addIndividualParticipantIds:()=>lk,addParticipant:()=>bc,addParticipants:()=>Hl,addPenalty:()=>gle,addPersonRequests:()=>tle,addPersons:()=>vle,createGroupParticipant:()=>sle,createTeamsFromParticipantAttributes:()=>Kz,deleteParticipants:()=>Xy,filterParticipants:()=>fD,findParticipant:()=>ole,getCompetitionParticipants:()=>LH,getPairedParticipant:()=>Gl,getParticipantEventDetails:()=>FH,getParticipantMembership:()=>BH,getParticipantScaleItem:()=>sw,getParticipantSchedules:()=>$H,getParticipantSignInStatus:()=>VH,getParticipantTimeItem:()=>hG,getParticipants:()=>Bn,getScaleValues:()=>y0,mergeParticipants:()=>mle,modifyIndividualParticipantIds:()=>ile,modifyParticipant:()=>uk,modifyParticipantName:()=>lle,modifyParticipantOtherName:()=>rle,modifyParticipantsSignInStatus:()=>nle,modifyPenalty:()=>fle,modifyPersonRequests:()=>Qse,mutate:()=>Zse,participantScaleItem:()=>nd,query:()=>soe,regenerateParticipantNames:()=>ale,removeIndividualParticipantIds:()=>AG,removeParticipantIdsFromAllTeams:()=>v_,removePenalty:()=>dle,removePersonRequests:()=>ele,removeRatings:()=>cle,scaledTeamAssignment:()=>ule,setParticipantScaleItem:()=>AD,setParticipantScaleItems:()=>Sre,validateLineUp:()=>b_});var Zse={};Kt(Zse,{addDynamicRatings:()=>SH,addIndividualParticipantIds:()=>lk,addParticipant:()=>bc,addParticipants:()=>Hl,addPenalty:()=>gle,addPersonRequests:()=>tle,addPersons:()=>vle,createGroupParticipant:()=>sle,createTeamsFromParticipantAttributes:()=>Kz,deleteParticipants:()=>Xy,findParticipant:()=>ole,mergeParticipants:()=>mle,modifyIndividualParticipantIds:()=>ile,modifyParticipant:()=>uk,modifyParticipantName:()=>lle,modifyParticipantOtherName:()=>rle,modifyParticipantsSignInStatus:()=>nle,modifyPenalty:()=>fle,modifyPersonRequests:()=>Qse,regenerateParticipantNames:()=>ale,removeIndividualParticipantIds:()=>AG,removeParticipantIdsFromAllTeams:()=>v_,removePenalty:()=>dle,removePersonRequests:()=>ele,removeRatings:()=>cle,scaledTeamAssignment:()=>ule,setParticipantScaleItem:()=>AD,setParticipantScaleItems:()=>Sre});function Xse(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Jse({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===qD&&(a=Ft(a),o=nn(o),s=nn(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=Xse(),t[e].push(r);return{mergeCount:n.length}}function t3(t){let{tournamentRecords:e,personRequests:i}=t,n=Lt(t,[{[Ua]:!0}]);if(n.error)return n;if(!i)return{...re};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Qf({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&fi({element:a,extension:{value:s,name:w0}})}return{...re}}function Qse(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=Lt(t,[{[Ua]:!0},{requests:!0,[ul]:uo,[md]:we}]);if(r.error)return r;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=Rg({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(n&&(o!=null&&o[n]))s(n);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&Jse({personRequests:o,personId:n,requests:l}),t3({tournamentRecords:e,personRequests:o})}function ele(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=Lt(t,[{[Ua]:!0}]);if(o.error)return o;let{personRequests:s}=Rg({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!n&&!r&&!a;if(!u){if(r&&(s!=null&&s[r]))l(r);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?Ha({name:w0,tournamentRecords:e,discover:!0}):t3({tournamentRecords:e,personRequests:s})}function tle(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=Lt(t,[{[Ua]:!0,[$De]:!0},{requests:!0,[ul]:uo,[md]:we}]);if(r.error)return r;let{personRequests:a}=Rg({tournamentRecords:e}),{mergeCount:o}=Jse({personRequests:a,personId:i,requests:n});return o&&a?t3({tournamentRecords:e,personRequests:a}):{error:we}}function ile({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return le({result:{error:Fe},stack:n});if(!e||!t)return le({result:{error:ht},stack:n});let r=i.participants||[],a=r.find(f=>f.participantId===e);if(!a)return le({result:{error:_n},stack:n});if(![Fi,ws].includes(a.participantType))return le({result:{error:Ou},context:{participantType:a.participantType},stack:n});let o=t.filter(f=>{var h;return((h=r.find(m=>m.participantId===f))==null?void 0:h.participantType)!==Qt});if(o.length)return le({result:{error:Hs,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(f=>!s.includes(f)),u=s.filter(f=>!t.includes(f)),c=lk({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return le({result:c,stack:n});let d=AG({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return le({result:d,stack:n});let{topics:p}=sl();if(p.includes(fa)){let f=r.find(({participantId:h})=>h===e);jt({topic:fa,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function nle({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:ht};if(![yU,qte].includes(i))return{error:we,signInState:i};let n=t.participants||[];if(!n.length)return{error:x1};let r=n.map(Jt),a=e.filter(u=>!r.includes(u));if(a.length)return{error:we,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of n){let{participantId:c}=u;if(e.includes(c)){let d=zG({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:K1,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=sl();return o.length&&l.includes(fa)&&jt({topic:fa,payload:{tournamentId:t.tournamentId,participants:o}}),{...re}}function rle({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Fe};if(!e)return{error:cr};let{participant:n}=Nh({tournamentRecord:t,participantId:e});if(!n)return{error:_n};n.participantOtherName=i;let{topics:r}=sl();return r.includes(fa)&&jt({topic:fa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...re}}function h9({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=N2((e==null?void 0:e.standardGivenName)??""),f=N2((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${f}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),f=f.toLowerCase()):r(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return u(t)?h=f:o(t)&&(s(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function Q_e({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==zs&&o){let{personFormat:s,doublesJoiner:l}=o;n===Qt&&(e.participantName=h9({person:a,personFormat:s})),n===Ot&&(e.participantName=r==null?void 0:r.map(u=>{var d;let c=(d=t[u])==null?void 0:d.person;return h9({person:c,personFormat:s})}).filter(Boolean).join(l??"/"))}}function ale({tournamentRecord:t,formats:e}){if(!t)return{error:Fe};if(!Ii(e))return{error:ht};let i=t.participants??[],n=OQ(i,"participantId");for(let r of i)Q_e({participant:r,participantMap:n,formats:e});return{...re}}function ole(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:ht,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=Qf({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...re}}function sle({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Gie,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:Fe};if(!a)return{error:ht,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:we};let o=(Bn({participantFilters:{participantTypes:[Qt]},tournamentRecord:n}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Ou,participantId:c};let s=pt({participantId:r||Mi(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:ws,participantRole:i}),l=bc({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:u}=sl();return u.includes(th)&&jt({topic:th,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...re,participant:st(s)}}function lle({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Fe};if(!i)return{error:cr};if(!e)return{error:ht,info:"Missing participantName"};let{participant:n}=Nh({tournamentRecord:t,participantId:i});if(!n)return{error:_n};n.participantName=e;let{topics:r}=sl();return r.includes(fa)&&jt({topic:fa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...re}}function ule({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var v,y,b,I,T;if(!o)return{error:Fe};if(!Array.isArray(a)&&!Nt(u)&&!c||!Nt(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:we};if(!s&&!r.length||!r&&!(e&&s))return{error:ht,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==Xs)return{error:vp};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===Wo).map(Jt)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:ht};let p=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let f=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],h=[];for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(f.includes(S)){if(U!==zs)return{error:Ou,participant:w};h.push(w)}}if(u&&h.length<u){let w=u-((h==null?void 0:h.length)||0),S=l??"Team",U=Xe(0,w).map(R=>({participantName:`${S} ${R+1}`,participantType:zs,participantRole:la})),{participants:P=[]}=Hl({participants:U,returnParticipants:!0,tournamentRecord:o}),E=P.map(Jt),D=((y=o.participants)==null?void 0:y.filter(({participantId:R})=>E.includes(R)))??[];h.push(...D)}if(!h.length)return{error:aj};if(t)for(let w of h)w.individualParticipantIds=[];else{let w=h.map(S=>S).flat();e!=null&&e.length?p=p.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:xA,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(!p.includes(S))continue;if(U!==Qt)return{error:Ou,participant:w};let P=(b=nd({scaleAttributes:s,participant:w}))==null?void 0:b.scaleItem,E=s!=null&&s.accessor?(I=P==null?void 0:P.scaleValue)==null?void 0:I[s==null?void 0:s.accessor]:P==null?void 0:P.scaleValue,D={participantId:S,scaleValue:E};r.push(D)}if(!r.length)return{error:_n}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:we,scaledParticipant:w};let m=0;for(;m<r.length;){for(let w of h){if(m+1>r.length)break;let S=r[m];w.individualParticipantIds.push(S.participantId),m++}h.reverse()}let g=h.map(Jt);for(let w of o.events??[]){if(w.eventType!==Xs)continue;let S=(w.entries??[]).filter(U=>g.includes(U.participantId));for(let U of S){let P=U.participantId,E=(T=h.find(R=>R.participantId===P))==null?void 0:T.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!E.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!E.includes(N.participantId))});let{flightProfile:D}=Gn({event:w});((D==null?void 0:D.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...re,scaledParticipants:r}}function cle(t){let e=Lt(t,[{[as]:!0,[Sj]:!0},{ratingType:!1,[ks]:o=>Cr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${Dj}`,n=t.asDynamic?i:t.ratingType,r=[Lm,Gf,t.eventType,n].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==r));return{...re}}function dle(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=eke({...t,tournamentRecord:i});if(n.error&&n.error!==HI)return n}return{...re}}function eke({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Fe};if(!e)return{error:ej};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&jt({topic:fa,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...re,penalty:a}:{error:HI}}var tke=({penaltyId:t=Mi()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),ple=tke;function fle(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=ike({...t,tournamentRecord:i});if(n.error&&n.error!==HI||n.success)return n}return{error:HI}}function ike({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Fe};if(!e)return{error:we,modifications:e};if(!i)return{error:ej};let n=(t==null?void 0:t.participants)??[],r=Object.keys(ple()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:LA};let o,s=[];return n.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&jt({topic:fa,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...re,penalty:o}:{error:HI}}function hle(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Vt(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Vt(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=hle(t[r],e[r],i):n[r]=e[r];return n},{})}function mle({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Fe};e.participants||(e.participants=[]);let n=t.filter(Yo(hd)).map(u=>({[u.participantId]:u})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(u=>{if(r[u.participantId]){let c=hle(u,r[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(Yo(hd))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=sl();return s.length&&(e.participants=e.participants.concat(...s),l.includes(th)&&jt({topic:th,payload:{participants:s}})),a.length&&l.includes(fa)&&jt({topic:fa,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...re}}function gle(t){var a;let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let o of Object.values(n)){let s=(a=Bn({tournamentRecord:o}).participants??[])==null?void 0:a.map(Jt).filter(l=>i.includes(l));s.length&&(r=nke({...t,penaltyId:t.penaltyId??r,tournamentRecord:o,participantIds:s}).penaltyId)}return r?{...re,penaltyId:r}:{error:_n}}function nke({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:Fe};if(!i)return{error:cr};if(!r)return{error:Tee};let c=((e==null?void 0:e.participants)??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:_n};let d=new Date().toISOString(),p=Object.assign(ple({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>fi({element:p,extension:f})),c.forEach(f=>{f.penalties||(f.penalties=[]),f.penalties.push(p)}),jt({topic:fa,payload:{tournamentId:e.tournamentId,participants:c}}),{...re,penaltyId:p.penaltyId}}function vle({participantRole:t=la,tournamentRecord:e,persons:i}){var h;if(!e)return{error:Fe};if(!Array.isArray(i))return{error:we};if(!Object.keys(_h).includes(t))return{error:pee};let n=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),r=[],a=i.filter(m=>m&&(!m.personId||!n.includes(m.personId))).map(m=>(m.personId||(m.personId=Mi()),r.push(m.personId),m)),o=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),s=a.map(m=>pt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Qt,participantRole:t,person:o(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,u=0,c=Hl({participants:s,tournamentRecord:e});if(c.error)return c;u=c.addedCount||0;let d=[],p=((h=Bn({participantFilters:{participantTypes:[Qt]},tournamentRecord:e}))==null?void 0:h.participants)??[];if(t===la&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>Qf({tournamentParticipants:p,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(Jt);d.push(pt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:la,individualParticipantIds:b,participantType:Ot}))}})}),d.length){if(c=Hl({participants:d,tournamentRecord:e}),c.error)return c;l=c.addedCount||0}let f=u+l;return{...re,addedCount:f,newPersonIds:r}}var bk={};Kt(bk,{bulkUpdatePublishedEventIds:()=>KH,getAllEventData:()=>YH,getCourtInfo:()=>u_,getDrawData:()=>z_,getEventData:()=>q_,getEventPublishStatus:()=>dl,getPublishState:()=>Zy,getVenueData:()=>rw,mutate:()=>yle,publishEvent:()=>B0,publishEventSeeding:()=>ble,publishOrderOfPlay:()=>Sle,query:()=>poe,setEventDisplay:()=>nk,unPublishEvent:()=>Tle,unPublishEventSeeding:()=>Ile,unPublishOrderOfPlay:()=>wle});var yle={};Kt(yle,{publishEvent:()=>B0,publishEventSeeding:()=>ble,publishOrderOfPlay:()=>Sle,setEventDisplay:()=>nk,unPublishEvent:()=>Tle,unPublishEventSeeding:()=>Ile,unPublishOrderOfPlay:()=>wle});function ble({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=eu,drawIds:a=[],event:o}){var d,p,f,h;if(!n)return{error:Fe};if(!o)return{error:ji};let s=dl({event:o,status:r}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},u=(((f=s==null?void 0:s.seeding)==null?void 0:f.stageSeedingScaleNames)||e)&&{...(h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames,...e},c=pt({stageSeedingScaleNames:u,seedingScaleNames:l,published:!0,drawIds:a});return F0({statusObject:{seeding:c},removePriorValues:t,status:r,event:o}),jt({topic:$te,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...re}}function Ile({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=eu,drawIds:r,stages:a,event:o}){var l,u;if(!i)return{error:Fe};if(!o)return{error:ji};let s=dl({event:o});if(s){let c=s.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&(c!=null&&c.seedingScaleNames)&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&(c!=null&&c.drawIds)&&(c.drawIds=c.drawIds.filter(d=>!r.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((l=c.seedingScaleNames)!=null&&l.length)&&!((u=c.drawIds)!=null&&u.length)||!a&&!e&&!(r!=null&&r.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),F0({statusObject:{seeding:c},removePriorValues:t,status:n,event:o})}return jt({topic:uG,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...re}}function wle(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=rke({tournamentRecord:i,...t});if(n.error)return n}return{...re}}function rke({removePriorValues:t=!0,tournamentRecord:e,status:i=eu}){if(!e)return{error:Fe};let n=`${Ug}.${Dg}`,{timeItem:r}=_c({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,kh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),jt({topic:cG,payload:{tournamentId:e.tournamentId}}),{...re}}function Sle(t){let e=Ac(t);if(!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=ake({tournamentRecord:i,...t});if(n.error)return n}return{...re}}function ake({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=eu,eventIds:r=[]}){if(!i)return{error:Fe};let a=`${Ug}.${Dg}`,{timeItem:o}=_c({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},kh({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),jt({topic:Vte,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...re}}function Tle({removePriorValues:t=!0,tournamentRecord:e,status:i=eu,event:n}){if(!e)return{error:Fe};if(!n)return{error:ji};let r=`${Ug}.${Dg}`,{timeItem:a}=Y1({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,tb({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),F0({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),jt({topic:lG,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...re}}var i3={};Kt(i3,{getEntryStatusReports:()=>ske,getParticipantStats:()=>oke,getStructureReports:()=>uke,getVenuesReport:()=>dke});function oke({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var S,U,P,E,D;if(!r)return{error:Fe};if(s&&!Array.isArray(s))return{error:Co};if(s=s??Wr({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Hp};let l=[];e&&l.push(e),n&&l.push(n);let u=l.length?{participantIds:l}:{participantTypes:[zs]},c=Bn({participantFilters:u,tournamentRecord:r}).participants??[];if(!c.every(({participantType:R})=>R===zs))return{error:Hs};l.length||l.push(...c.map(Jt));let d=new Map,p=new Map,f=new Map,h=new Map,m=(R,N="")=>p.get(R)||p.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(R);for(let R of c){let{participantId:N,individualParticipantIds:M}=R;h.set(N,M??[]),m(N,R.participantName)}if(n&&!h.get(n))return le({result:{error:_n},context:{teamParticipantId:n}});if(e&&!h.get(e))return le({result:{error:_n},context:{opponentParticipantId:e}});let g=[],v=R=>{let N=[[],[]];for(let A of R){let _=A.participant;if(_!=null&&_.participantName){d.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let k=p.get(_.participantId);k&&(k.participantName=_.participantName)}}let M=({side:A,individualParticipantIds:_})=>{var k,B,F,x,$;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((B=(k=A.participant)==null?void 0:k.individualParticipantIds)==null?void 0:B.length)&&(!(_!=null&&_.length)||Ln(_,(F=A.participant)==null?void 0:F.individualParticipantIds).length===(($=(x=A.participant)==null?void 0:x.individualParticipantIds)==null?void 0:$.length))&&A.participant.individualParticipantIds};if(h.size){let A=(_,k)=>{for(let B of R){if(!B.participant)continue;let F=M({individualParticipantIds:k,side:B});if(F!=null&&F.length){let x=B.sideNumber;if(!x)continue;let $=[_];i&&$.push(...F),N[x-1]=$;let j=p.get(_);for(let V of F.filter(Boolean))j&&!j.competitorIds.includes(V)&&j.competitorIds.push(V)}}};if(n)(!e||R.every(_=>_.participant&&(M({individualParticipantIds:h.get(n),side:_})||M({individualParticipantIds:h.get(e),side:_}))))&&A(n,h.get(n));else for(let[_,k]of h)A(_,k)}else if(i)for(let A of R){if(!A.participant)continue;let _=M({individualParticipantIds:[],side:A}),k=A.sideNumber;k&&(N[k-1]=_)}return N};for(let R of s){if(!Ii(R))return{error:Co};let{matchUpStatus:N,matchUpFormat:M,matchUpType:A,winningSide:_,score:k,sides:B}=R;if(!B||!k||A===gc||N===Ui)continue;let F=v(B);if(!F.filter(Boolean).length)continue;let x=t&&_&&((S=aD({matchUp:R}))==null?void 0:S.competitiveness);g.push(R);let $=JG({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:k}),j=xne({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:k}),{pointsTally:V,tiebreaksTally:H}=Lne({matchUpFormat:M,score:k});F.forEach((z,q)=>{var W;for(let Y of z){let Z=(W=d.get(Y))==null?void 0:W.participantName,X=m(Y,Z);if(X){let Q=(ie,oe)=>oe.forEach((se,pe)=>X[ie][pe]+=se),ce=q?[...H].reverse():H,J=q?[...V].reverse():V,ee=q?[...j].reverse():j,ne=q?[...$].reverse():$;if(Q("tiebreaks",ce),Q("points",J),Q("games",ee),Q("sets",ne),_){let ie=_-1===q?0:1;X.matchUps[ie]+=1}if(x){let ie=x.toLowerCase();X.competitiveness[ie]||(X.competitiveness[ie]=[0,0]),X.competitiveness[ie][q]+=1}if(N){let ie=N.toLowerCase();X.matchUpStatuses[ie]||(X.matchUpStatuses[ie]=0),X.matchUpStatuses[ie]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,T=(R,N)=>(R??0)+(N??0);for(let[R,N]of p.entries()){for(let M of y){let A=N[M].reduce(T);if(A){let _=N[M][0]/A,k=`${M}Ratio`,B=parseFloat(_.toFixed(2));N[k]=B,f.set(R,!0),I.has(k)||I.set(k,[]),(U=I.get(k))==null||U.push(B)}}for(let M of b){let A=(E=(P=N.competitiveness)==null?void 0:P[M])==null?void 0:E.reduce(T);if(A){let _=N.competitiveness[M][0]/A,k=`${M}Ratio`,B=parseFloat(_.toFixed(2));N[k]=B}}}if(!n){let R=(N,M)=>M-N;for(let N of p.values())for(let M of y){let A=`${M}Ratio`;if(typeof N[A]=="number"){let _=(D=I.get(A))==null?void 0:D.sort(R).indexOf(N[A]);if(typeof _=="number"&&_>=0){let k=`${M}Rank`;N[k]=_+1}}}}let w={relevantMatchUps:g,...re};return n?(w.teamStats=p.get(n),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=f.size,w.allParticipantStats=[...p.values()],w}function LM({participant:t,eventType:e}){var u,c,d,p,f,h;let i=(u=t==null?void 0:t.person)==null?void 0:u.personId,n=(d=(c=t==null?void 0:t.person)==null?void 0:c.personOtherIds)==null?void 0:d[0],r=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(h=(f=t==null?void 0:t.ratings)==null?void 0:f[e])==null?void 0:h.find(({scaleName:m})=>m===XG),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:n,confidence:l,wtnRating:s,personId:i,tennisId:r}}function ske({tournamentRecord:t}){if(!t)return{error:Fe};let e=t.tournamentId,{participantMap:i}=Bn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Wr({matchUpFilters:{matchUpTypes:[wv,jm]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f==null?void 0:f.flatMap(m=>{var g,v;return h===jm?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,u=({id:f,entry:h,eventId:m,eventType:g})=>{var E;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:T}=h;a[f]||(a[f]=[]);let{participant:w,events:S}=(i==null?void 0:i[f])??{},U=LM({participant:w,eventType:g}),P=(E=S==null?void 0:S[m])==null?void 0:E.ranking;b===fH&&r.push(f),a[f].push({participantType:w==null?void 0:w.participantType,participantId:f,tournamentId:e,eventType:g,eventId:m,drawId:T,entryStatus:b,entryStage:I,...U,ranking:P,mainSeeding:y,qualifyingSeeding:v})};for(let f of t.events??[]){let h={},m=S=>{h[S]||(h[S]={count:0}),h[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=f,b=g.flatMap(S=>{let{drawId:U,entries:P}=S;l+=1;let E=({stage:M,stageSequence:A})=>M===it&&A===1||M===gt,D=(S.structures??[]).filter(E).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>D.includes(M),N=M=>{var F,x,$,j,V,H,z,q;let{participantId:A,entryStatus:_,entryStage:k}=M;m(_);let B=(j=($=(x=(F=i==null?void 0:i[A])==null?void 0:F.draws)==null?void 0:x[U])==null?void 0:$.seedAssignments)==null?void 0:j[it];return{qualifyingSeeding:(q=(z=(H=(V=i==null?void 0:i[A])==null?void 0:V.draws)==null?void 0:H[U])==null?void 0:z.seedAssignments)==null?void 0:q[gt],participantId:A,mainSeeding:B,entryStatus:_,entryStage:k,drawId:U}};return P==null?void 0:P.filter(R).map(N)}),I=S=>{var E;let U=S.participantId,P=(E=i==null?void 0:i[U].participant.individualParticipantIds)==null?void 0:E.filter(D=>n.includes(D));return U&&{[U]:{individualParticipantIds:P}}};v===Xf?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),U=P=>{S[P.participantId].individualParticipantIds.forEach(E=>{u({id:E,eventType:v,eventId:y,entry:P})})};b.forEach(U)})():b.forEach(S=>{u({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(h).reduce((S,U)=>S+U.count,0);Object.keys(h).forEach(S=>{h[S].pct=h[S].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:h};let w=Object.assign({},...Jl.flatMap(S=>{var U,P;return[{[S+"_count"]:(U=h[S])==null?void 0:U.count},{[S+"_pct"]:(P=h[S])==null?void 0:P.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===Qt&&h===la),d=c.filter(({participant:f})=>!n.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function lke({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=h=>{let m=h==null?void 0:h.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===n).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>LM({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,m)=>{let{wtnRating:g,confidence:v}=m;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,f=Object.values(r).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function uke({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var f;if(!i)return{error:jI};let n=[],r={},a={},o=[],s=Object.assign({},...(e??[]).map(({name:h,label:m,accessor:g})=>{var b,I,T;let v=(I=(b=$t({element:i,name:h}))==null?void 0:b.extension)==null?void 0:I.value,y=g?(T=Sv({element:v,accessor:g}))==null?void 0:T.value:v;return{[m||h]:y}})),l=i==null?void 0:i.tournamentId,u=Wr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],c=h=>{var m,g,v;return(v=(g=(m=_c({itemType:Xj,itemSubTypes:[td],element:{timeItems:h}}))==null?void 0:m.timeItem)==null?void 0:g.itemValue)==null?void 0:v.scaleBasis},d=({positionManipulations:h})=>{h==null||h.forEach(m=>{let{structureId:g,name:v}=m,y=m.drawPositions||[m.drawPosition];r[g]||(r[g]=[]),r[g].push(`${v}: ${y.join("/")}`)})},p=(f=i==null?void 0:i.events)==null?void 0:f.flatMap(({timeItems:h,drawDefinitions:m=[],extensions:g,eventType:v,eventName:y,eventId:b,category:I})=>{var D,R,N,M,A;let T=(N=(R=(D=g==null?void 0:g.find(_=>_.name===Vl))==null?void 0:D.value)==null?void 0:R.flights)==null?void 0:N.map(_=>({[_.drawId]:_.flightNumber})),w=T&&Object.assign({},...T),S=((A=(M=g==null?void 0:g.find(_=>_.name===wT))==null?void 0:M.value)==null?void 0:A.length)||0,U=Object.values(w),P=w&&Math.min(...U),E=c(h);return a[b]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,seedingBasis:E?JSON.stringify(E):void 0,tournamentId:l,eventId:b},m.filter(_=>!t||!T||w[_.drawId]===P).flatMap(_=>{let{matchUpFormat:k,tieFormat:B,timeItems:F,extensions:x,structures:$,drawName:j,drawType:V,drawId:H}=_,{matchUpFormatCounts:z,matchUpsCount:q,avgConfidence:W,pctNoRating:Y,avgWTN:Z}=lke({eventType:v,matchUps:u,drawId:H}),X=c(F)||E,Q=cke({extensions:x}),ce=(Q==null?void 0:Q.length)||0;return d({positionManipulations:Q}),a[b].totalPositionManipulations+=ce,a[b].generatedDrawsCount+=1,ce>a[b].maxPositionManipulations&&(a[b].maxPositionManipulations=ce),$==null?void 0:$.filter(J=>J.stageSequence===1&&[gt,it,pa,Nn].includes(J.stage)).map(J=>{var Ue,Qe,je;let ee=[it,Nn].includes(J.stage)?u.find(ke=>ke.structureId===J.structureId&&ke.finishingRound===1&&ke.winningSide):void 0;J.stage===it&&n.push({eventName:y,drawName:j,structureId:J.structureId});let ne=(Qe=(Ue=ee==null?void 0:ee.sides)==null?void 0:Ue.find(ke=>ke.sideNumber===ee.winningSide))==null?void 0:Qe.participant,ie=(ne==null?void 0:ne.participantType)===zs&&ne.participantId,oe=(ne==null?void 0:ne.participantType)===Ot?ne.individualParticipants:[],se=LM({participant:(oe==null?void 0:oe[0])||ne,eventType:v}),{personId:pe,personOtherId:fe,tennisId:ge,confidence:me,wtnRating:Ee}=se||{},Be=LM({participant:oe==null?void 0:oe[1],eventType:v}),{personId:Pe,personOtherId:et,tennisId:Ie,confidence:Ne,wtnRating:be}=Be||{},{ageCategoryCode:Le,categoryName:Me,subType:Ze}=I??{},qe=J.matchUpFormat||k,ye=(z[qe]||0)/q*100,{tieFormatName:_e,tieFormatDesc:Ae}=NM(B),{tieFormatName:Ve,tieFormatDesc:Ke}=NM(J.tieFormat),he=Ae===Ke,ve=!he&&Ve,Ce=J.tieFormat&&!he&&Ke,De=((je=Q==null?void 0:Q.filter(ke=>ke.structureId===J.structureId))==null?void 0:je.length)||0;return{...s,tournamentId:l,eventId:b,structureId:J.structureId,drawId:H,eventType:v,category:Ze,categoryName:Me,ageCategoryCode:Le,flightNumber:w[H],drawType:V,stage:J.stage,seedingBasis:X?JSON.stringify(X):void 0,winningPersonId:pe,winningPersonOtherId:fe,winningPersonTennisId:ge,winningPersonWTNrating:Ee,winningPersonWTNconfidence:me,winningPerson2Id:Pe,winningPerson2OtherId:et,winningPerson2TennisId:Ie,winningPerson2WTNrating:be,winningPerson2WTNconfidence:Ne,winningTeamId:ie,positionManipulations:De,pctNoRating:Y,matchUpFormat:qe,pctInitialMatchUpFormat:ye,matchUpsCount:q,drawTieFormatName:_e,drawTieFormatDesc:Ae,tieFormatName:ve,tieFormatDesc:Ce,avgConfidence:W,avgWTN:Z}})})});return n.forEach(({eventName:h,drawName:m,structureId:g})=>{var v;(v=r[g])!=null&&v.length&&o.push({eventName:h,drawName:m,actions:r[g]})}),{eventStructureReports:Object.values(a),structureReports:p,flightReports:o}}function cke({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===ST))==null?void 0:e.value)==null?void 0:i.slice(1)}function dke({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var c,d;if(!Array.isArray(r))return{error:we,dates:r};if(!Array.isArray(n))return{error:we,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Cn};if(!r.every(Go))return{error:Ka};let a=Qp({tournamentRecords:e,ignoreDisabled:t,dates:r});if(a.error)return a;let o=(c=a==null?void 0:a.venues)==null?void 0:c.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,f)=>{var h;return(h=f.dateAvailability)==null||h.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:u}=Fu({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>pke(s,p,u))}}function pke(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var f;let l=0,u=0,c=0;for(let h of r){let m=h.dateAvailability.find(v=>v.date===s),g=(f=m&&$0({courtDate:m}).timeSlots)==null?void 0:f.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=li(I)-li(b);return v+T},0);g&&(c+=1),l+=g}let d=i.filter(({schedule:h})=>h.venueId===n&&vd(s,h.scheduledDate));d.forEach(({schedule:h})=>{let m=nn(h.scheduledTime),g=Uo(m,h.averageMinutes),v=li(g)-li(m);u+=v});let p=l?(u/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:c,availableMinutes:l,scheduledMinutes:u,percentUtilization:p}}),{venueId:n,venueName:a,venueReport:o}}var n3={};Kt(n3,{addMatchUpCourtOrder:()=>Oz,addMatchUpEndTime:()=>Lz,addMatchUpOfficial:()=>pse,addMatchUpResumeTime:()=>Bz,addMatchUpScheduleItems:()=>pk,addMatchUpScheduledDate:()=>ck,addMatchUpScheduledTime:()=>xh,addMatchUpStartTime:()=>xz,addMatchUpStopTime:()=>Fz,addSchedulingProfileRound:()=>Xz,allocateTeamMatchUpCourts:()=>dk,assignMatchUpCourt:()=>ob,assignMatchUpVenue:()=>j0,bulkRescheduleMatchUps:()=>Nle,bulkScheduleMatchUps:()=>WD,bulkScheduleTournamentMatchUps:()=>MU,bulkUpdateCourtAssignments:()=>Ele,calculateScheduleTimes:()=>r3,clearMatchUpSchedule:()=>_le,clearScheduledMatchUps:()=>mk,courtGridRows:()=>iz,findMatchUpFormatTiming:()=>W_,findVenue:()=>Zp,generateBookings:()=>hk,generateVirtualCourts:()=>ak,getPersonRequests:()=>Rg,getProfileRounds:()=>Y_,getScheduledRoundsDetails:()=>OD,getSchedulingProfile:()=>ef,getSchedulingProfileIssues:()=>ZH,matchUpScheduleChange:()=>Ale,modifyMatchUpFormatTiming:()=>vz,mutate:()=>Ule,proAutoSchedule:()=>Ple,proConflicts:()=>Rle,publicFindCourt:()=>Tie,query:()=>goe,removeEventMatchUpFormatTiming:()=>ik,removeMatchUpCourtAssignment:()=>Dle,reorderUpcomingMatchUps:()=>Mle,scheduleMatchUps:()=>Cle,scheduleProfileRounds:()=>gk,setMatchUpDailyLimits:()=>kle,setMatchUpHomeParticipantId:()=>kz,setSchedulingProfile:()=>x0,toggleParticipantCheckInState:()=>sk,validateSchedulingProfile:()=>K_});var Ule={};Kt(Ule,{addMatchUpCourtOrder:()=>Oz,addMatchUpEndTime:()=>Lz,addMatchUpOfficial:()=>pse,addMatchUpResumeTime:()=>Bz,addMatchUpScheduleItems:()=>pk,addMatchUpScheduledDate:()=>ck,addMatchUpScheduledTime:()=>xh,addMatchUpStartTime:()=>xz,addMatchUpStopTime:()=>Fz,addSchedulingProfileRound:()=>Xz,allocateTeamMatchUpCourts:()=>dk,assignMatchUpCourt:()=>ob,assignMatchUpVenue:()=>j0,bulkRescheduleMatchUps:()=>Nle,bulkScheduleMatchUps:()=>WD,bulkScheduleTournamentMatchUps:()=>MU,bulkUpdateCourtAssignments:()=>Ele,calculateScheduleTimes:()=>r3,clearMatchUpSchedule:()=>_le,clearScheduledMatchUps:()=>mk,courtGridRows:()=>iz,findMatchUpFormatTiming:()=>W_,findVenue:()=>Zp,generateBookings:()=>hk,generateVirtualCourts:()=>ak,matchUpScheduleChange:()=>Ale,modifyMatchUpFormatTiming:()=>vz,proAutoSchedule:()=>Ple,proConflicts:()=>Rle,publicFindCourt:()=>Tie,removeEventMatchUpFormatTiming:()=>ik,removeMatchUpCourtAssignment:()=>Dle,reorderUpcomingMatchUps:()=>Mle,scheduleMatchUps:()=>Cle,scheduleProfileRounds:()=>gk,setMatchUpDailyLimits:()=>kle,setMatchUpHomeParticipantId:()=>kz,setSchedulingProfile:()=>x0,toggleParticipantCheckInState:()=>sk,validateSchedulingProfile:()=>K_});function r3({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Cn};o=o??ok({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Qp({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),f=d==null?void 0:d.filter(E=>!u||u.includes(E.venueId));l||(l=f==null?void 0:f.reduce((E,D)=>{var N,M;let R=((M=(N=D.dateAvailability)==null?void 0:N.find(A=>!A.date||vd(s,A.date)))==null?void 0:M.startTime)??D.startTime;return R&&(!E||li(R)<li(E))?R:E},void 0)),c||(c=f==null?void 0:f.reduce((E,D)=>{var N,M;let R=((M=(N=D.dateAvailability)==null?void 0:N.find(A=>!A.date||vd(s,A.date)))==null?void 0:M.endTime)??D.endTime;return R&&(!E||li(R)>li(E))?R:E},void 0));let h=Object.values(a),m=Object.assign({},...h.map(E=>(E.events??[]).map(D=>{let{scheduleTiming:R}=X1({tournamentRecord:E,event:D});return{[D.eventId]:{event:D,scheduleTiming:R}}})).flat()),g=FD({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:E,schedule:D,matchUpFormat:R})=>{let{event:N,scheduleTiming:M}=m[E],A=N==null?void 0:N.eventType,_={...M,defaultTiming:I,matchUpFormat:R},{averageMinutes:k,recoveryMinutes:B}=l_({eventType:A,timingDetails:_}),{courtId:F,venueId:x}=D,$=nn(D.scheduledTime),j=Uo($,k);return{recoveryMinutes:B,averageMinutes:k,periodLength:o,startTime:$,endTime:j,courtId:F,venueId:x}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:c,bookings:T,courts:f},{scheduleTimes:S}=Ez(w),U=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=b.map(Nr);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:P}}function Dle(t){var f;let e=Lt(t,[{[Ua]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,u=n[r];if(!u)return{error:Fe};let{drawDefinition:c,event:d}=Oh({tournamentRecord:u,drawId:l});if(!c)return{error:ot};let p=rn({drawDefinition:c,event:d,matchUpId:o});if(p.error)return p;if(((f=p==null?void 0:p.matchUp)==null?void 0:f.matchUpType)===gc){let{itemValue:h}=Ah({timeItems:p.matchUp.timeItems??[],itemType:Up}),m=s&&h.filter(g=>g.courtId!==s);return Xo({duplicateValues:!1,removePriorValues:i,tournamentRecord:u,drawDefinition:c,matchUpId:o,timeItem:{itemType:Up,itemValue:m}})}else return ob({tournamentRecord:u,drawDefinition:c,courtDayDate:a,courtId:"",matchUpId:o})}function Ple({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!cl(n))return{error:we};if(n.some(({hasContext:f})=>!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:OA};let r=FD({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=f=>[(f.sides||[]).map(h=>{var m;return[h.participantId,(m=h.participant)==null?void 0:m.individualParticipantIds]}),(f.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((f,h)=>{let m=[],g=[];Object.values(h).forEach(y=>{if(Ii(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let b=s(y);g.push(...b)}});let v=Object.values(h).filter(y=>Ii(y)&&!y.matchUpId);return f.concat({matchUpIds:m,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:f})=>f&&f!==Ui&&(t||!dr.includes(f))).sort(Yy);let u=tu({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;n.length&&l.length;){let f=l.shift(),h=[];for(;n.length&&f.availableCourts.length;){let m=n.concat(h).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),b=v&&m.some(U=>u[v].matchUpIds.includes(U)),I=v&&d.some(U=>u[v].dependentMatchUpIds.includes(U)),T=f.matchUpIds.some(U=>y.includes(U)),w=s(g),S=f.participantIds.some(U=>w.includes(U));if(g&&!T&&!b&&!S&&!I){let U=f.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),c.push(g),f.participantIds.push(...w),f.matchUpIds.push(v)}else g&&h.push(g)}n.push(...h),d.push(...f.matchUpIds)}let p=c.map(({matchUpId:f,tournamentId:h,schedule:m,drawId:g})=>({tournamentId:h,matchUpId:f,drawId:g,schedule:{...m,scheduledDate:i}}));return r=WD({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:c,notScheduled:n}}function Ele(t){let{courtDayDate:e}=t,i=Lt(t,[{courtAssignments:!0,[ul]:uo,[md]:ht},{[Ua]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[Ua][a];if(!o)return r={error:Fe},!1;let s=n[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=ho({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=ob({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f==null?void 0:f.success;r={error:_ee}}),!0):(r={error:ot},!1)})}),r||re}function Cle(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Lt(t,[{[Ua]:!0,[B1]:!0},{[ks]:Go,[md]:Ka,[FDe]:!0},{[ks]:z=>!z||!isNaN(z),[jDe]:!1,[md]:we,[GDe]:!1,[HDe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??Fu({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??tu({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(z=>{var q;(q=z.schedule)!=null&&q.scheduledDate&&vd(h,Ft(z.schedule.scheduledDate))&&cw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:z})});let S=m.map(z=>T.find(q=>q.matchUpId===z)).filter(Boolean),{venueId:U,scheduleTimes:P,dateScheduledMatchUpIds:E}=r3({tournamentRecords:e,remainingScheduleTimes:d,startTime:nn(v),endTime:nn(y),scheduleDate:Ft(h),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:f,venueIds:g}),D={},R=[],N={},M={},A={};T.filter(({matchUpId:z})=>E==null?void 0:E.includes(z)).forEach(z=>{var W;iB({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:z,value:1});let q=(W=z.schedule)==null?void 0:W.scheduledTime;if(q){N[z.matchUpId]=q;let Y=a==null?void 0:a[z.matchUpId];RU({recoveryMinutes:Y||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:q,matchUp:z})}});let _=S.filter(z=>{let q=E==null?void 0:E.includes(z.matchUpId),W=[Ui,ai,kn,Ro,ta,yi].includes(z==null?void 0:z.matchUpStatus);return!q&&!z.winningSide&&!W}),{matchUpMap:k,overLimitMatchUpIds:B,participantIdsAtLimit:F}=_.reduce((z,q)=>{let{drawId:W,tournamentId:Y,matchUpType:Z}=q,{participantIdsAtLimit:X,relevantParticipantIds:Q}=Wz({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:q});return X!=null&&X.length?(z.overLimitMatchUpIds.push(q.matchUpId),z.participantIdsAtLimit.push(...X),z):(Q.forEach(ce=>{zD({individualParticipantProfiles:s,participantId:ce});let J=s[ce].counters;J[Z]?J[Z]+=1:J[Z]=1,J[_l]?J[_l]+=1:J[_l]=1}),z.matchUpMap[Y]||(z.matchUpMap[Y]={}),z.matchUpMap[Y][W]?z.matchUpMap[Y][W].push(q):z.matchUpMap[Y][W]=[q],cw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:q}),z)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:z})=>!B.includes(z));let x=0,$=(P==null?void 0:P.length)??0,{personRequests:j}=Rg({tournamentRecords:e,requestType:qD});for(;P!=null&&P.length&&_.length&&x<=$;){x++;let{scheduleTime:z}=P.shift(),q=_.find(W=>{let{matchUpId:Y}=W,{dependenciesScheduled:Z,remainingDependencies:X}=Hz({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:W});if(!Z)return A[Y]||(A[Y]=[]),A[Y].push({scheduleTime:z,remainingDependencies:X}),!1;let{enoughTime:Q}=qz({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:z,matchUp:W});if(!Q)return M[Y]||(M[Y]=[]),M[Y].push({scheduleTime:z}),!1;let{conflicts:ce}=zz({potentials:c,averageMatchUpMinutes:n,requestConflicts:D,personRequests:j,scheduleTime:z,scheduleDate:h,matchUp:W});if(ce!=null&&ce.length)return!1;let J=a==null?void 0:a[W.matchUpId];return RU({recoveryMinutes:J||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:z,matchUp:W}),N[W.matchUpId]=z,!0});_=_.filter(({matchUpId:W})=>W!==(q==null?void 0:q.matchUpId)),q||R.push(z)}_.forEach(z=>{iB({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:z})});let V=[];Object.keys(k).forEach(z=>{let q=e[z];q&&Object.keys(k[z]).forEach(W=>{let{drawDefinition:Y}=Oh({tournamentRecord:q,drawId:W});Y&&k[z][W].forEach(({matchUpId:Z})=>{let X=N[Z];if(X){let Q=X.split(":").map(Ls).join(":"),ce=`${Ft(h)}T${Q}`;b?V.push(Z):(xh({drawDefinition:Y,matchUpId:Z,scheduledTime:ce}).success&&V.push(Z),U&&j0({tournamentRecords:e,tournamentRecord:q,drawDefinition:Y,matchUpId:Z,venueId:U}))}})})});let H=xj(_);return{...re,requestConflicts:Object.values(D),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:z})=>z),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:B,scheduledMatchUpIds:V,noTimeMatchUpIds:H,recoveryTimeDeferred:M,dependencyDeferred:A}}function Rle({tournamentRecords:t,matchUps:e}){if(!cl(e))return{error:Hp};if(e.some(({matchUpId:f,hasContext:h})=>f&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:OA};let i=Math.max(...e.map(({schedule:f})=>(f==null?void 0:f.courtOrder)||1).map(f=>St(f))),n=Xe(1,i+1).map(f=>e.filter(h=>{var m;return St((m=h.schedule)==null?void 0:m.courtOrder)===f})),r={},a={},o={};n.flat().filter(Boolean).sort(Yy).forEach(({schedule:f})=>delete f[oR]);let s=Vt(e.map(({drawId:f})=>f)),l=tu({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=n.map((f,h)=>f.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=h,a[S]=[],m.matchUpIds.push(v),o[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let P=(T==null?void 0:T.map(D=>{var R;return[(R=D.participant)==null?void 0:R.individualParticipantIds,D.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:D,participantId:R})=>[D,R]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...P),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(f,h)=>l[f].sources.reduce((m,g,v)=>g.includes(h)&&v+1||m,0),d=u.map(()=>[]),p=(f,h,m,g)=>{if(!o[f].schedule[oR]){o[f].schedule[oR]=h,o[f].schedule[yie]=g,d[r[f]].push({matchUpId:f,issueType:m,issueIds:g,issue:h});let v=o[f].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:f,issue:h,issueType:m,issueIds:g})}};return u.forEach((f,h)=>{let m=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=qo(f.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=f.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][cm]||(v[w][cm]=I.filter(S=>S!==w))});let T=m&&f.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=f.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][dm]||(v[U][dm]=S.filter(P=>P!==U))})}),f.matchUpIds.forEach(w=>{var P,E,D,R;let S=l[w].matchUpIds;for(let N of g){let M=N.matchUpIds.filter(A=>S.includes(A));M!=null&&M.length&&(M.forEach(A=>p(A,P2,Mf,[w])),p(w,P2,Mf,M))}if((P=v[w])!=null&&P[cm]&&p(w,cm,D2,v[w][cm]),f.sourceMatchUpIds.includes(w)){let N=f.matchUpIds.filter(M=>l[M].matchUpIds.includes(w));p(w,cm,Mf,N),f.matchUpIds.filter(M=>l[M].matchUpIds.includes(w)).forEach(M=>p(M,cm,Mf,[w]))}let U=(E=m==null?void 0:m.matchUpIds)==null?void 0:E.filter(N=>c(w,N)>1);if(U!=null&&U.length&&(p(w,E2,Mf,U),U.forEach(N=>p(N,E2,Mf,[w]))),(D=v[w])!=null&&D[dm]&&p(w,dm,D2,v[w][dm]),(R=m==null?void 0:m.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,M=S.filter(A=>m.matchUpIds.includes(A));M.some(A=>o[A].schedule.courtId===N)||(M.forEach(A=>p(A,dm,Mf,[w])),p(w,dm,Mf,M))}})}),{courtIssues:a,rowIssues:d}}function Mle(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return le({result:{error:Cn},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return le({result:{error:ht},stack:e});let a=n==null?void 0:n.length;if(!a)return{...re};let o=0;return n.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(r?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=n[f].schedule.scheduledTime,m=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?re:le({result:{error:Aee},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=Oh({tournamentRecord:p,drawId:d});return f?xh({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:ms}}}function Nle(t){var l,u;let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:Ay};if(typeof e!="object")return{error:we};let r=Ac(t),a=[],o=[];for(let c of Object.values(r)){let d=fke({tournamentRecord:c,scheduleChange:e,matchUpIds:i,dryRun:n});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=xj(d.notRescheduled),f=[];(l=d.rescheduled)==null||l.forEach(h=>{let{matchUpId:m}=h;p.includes(m)&&f.push(m),a.push(h)}),f.length&&(o=((u=d==null?void 0:d.notRescheduled)==null?void 0:u.filter(({matchUpId:h})=>!f.includes(h)))||[])}let s=!!(a.length&&!o.length);return{...re,rescheduled:a,notRescheduled:o,allRescheduled:s}}function fke({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var I;if(!t)return{error:Fe};if(!i||!Array.isArray(i))return{error:Ay};if(typeof e!="object")return{error:we};let r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...re};if(o&&isNaN(o))return{error:we};if(s&&isNaN(s))return{error:we};let{matchUps:l}=Wr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:T})=>!dr.includes(T),c=l==null?void 0:l.filter(T=>LD({schedule:T.schedule})).filter(T=>u({matchUpStatus:T.matchUpStatus}));if(!(c!=null&&c.length))return{...re};let{tournamentInfo:d}=rb({tournamentRecord:t}),{startDate:p,endDate:f}=d,h=c==null?void 0:c.reduce((T,w)=>{let{matchUpId:S,drawId:U}=w;return T[U]?T[U].push(S):T[U]=[S],T},{}),m=1440;for(let T of Object.keys(h)){let w=Oh({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,U=h[T].filter(P=>i.includes(P));for(let P of U)if(P&&S){let E=(I=c.find(_=>_.matchUpId===P))==null?void 0:I.schedule,{scheduledTime:D,scheduledDate:R}=E,N,M,A;if(!N&&s&&R){let _=Ft(R);A=aT(_,s),N=new Date(A)<new Date(p)||new Date(A)>new Date(f)}if(o&&D){let _=Ft(D),k=li(nn(D))+o;if(N=k<0||k>m,!N){let B=Uo(D,o),F=_&&A||R===_&&_;M=F?`${F}T${B}`:B}}if(N)a.push(P);else{if(!n){if(M){let _=xh({scheduledTime:M,drawDefinition:S,matchUpId:P});if(_.error)return _}if(A){let _=ck({scheduledDate:A,drawDefinition:S,matchUpId:P});if(_.error)return _}}(M||A)&&r.push(P)}}}let g=Wr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:T})=>r.includes(T)),y=g.filter(({matchUpId:T})=>a.includes(T)),b=v.length&&!y.length;return{...re,rescheduled:v,notRescheduled:y,allRescheduled:b}}function Ale(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Cn};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=n||{},{drawId:d,matchUpId:p,tournamentId:f}=r||{};if(!u&&!p)return le({result:{error:ht},stack:e});let{matchUps:h}=Fu({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h==null?void 0:h.find(({matchUpId:I})=>I===u),g=h==null?void 0:h.find(({matchUpId:I})=>I===p),v=0;if(o&&u&&!p){let I=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I!=null&&I.success&&v++,I.error)return le({result:I,stack:e})}else if(a&&o&&u&&p){let I=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I.success&&v++,I.error)return le({result:I,stack:e,info:"source"});let T=y({tournamentId:f,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(T.success&&v++,T.error)return le({result:T,stack:e,info:"target"})}else return{error:ht};return v?re:le({result:{error:h0},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:U}=I,P=T[w],{drawDefinition:E}=Oh({tournamentRecord:P,drawId:U});return S.matchUpType===Zi?b({...I,tournamentRecord:P,drawDefinition:E}):ob({...I,tournamentRecord:P,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:P,matchUpId:E,matchUp:D,courtId:R}){let N=[R].concat(D.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==U));return dk({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:P,matchUpId:E,courtIds:N})}}function _le({scheduleAttributes:t=[Up,Gm,P0,E0,C0,Iu,Dp,id,cp],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var s,l;let r="clearMatchUpSchedule",a=i?(s=za({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=Wr({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:Ta};let o=(a.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return a.timeItems=o,ci({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:a}),{...re}}function kle(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Cn};if(typeof n!="object")return{error:zp};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:we};for(let o of a){let s=r[o],l=fi({extension:{name:j1,value:{dailyLimits:n}},element:s});if(l.error)return l}return{...re}}var a3={};Kt(a3,{addCollectionDefinition:()=>l3,addCollectionGroup:()=>$le,aggregateTieFormats:()=>jle,compareTieFormats:()=>Pp,getTieFormat:()=>WH,modifyCollectionDefinition:()=>o3,modifyTieFormat:()=>Vle,mutate:()=>Ole,orderCollectionDefinitions:()=>Fle,query:()=>coe,removeCollectionDefinition:()=>s3,removeCollectionGroup:()=>Lle,tieFormatGenderValidityCheck:()=>U_,validateCollectionDefinition:()=>PD});var Ole={};Kt(Ole,{addCollectionDefinition:()=>l3,addCollectionGroup:()=>$le,aggregateTieFormats:()=>jle,modifyCollectionDefinition:()=>o3,modifyTieFormat:()=>Vle,orderCollectionDefinitions:()=>Fle,removeCollectionDefinition:()=>s3,removeCollectionGroup:()=>Lle});function Jm({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var u;let s="getTieFormat",l;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:ot};if(a&&o)l=kf(o);else if(i){if(t&&(!r||!n)){let c=rn({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((u=c.matchUp)==null?void 0:u.matchUpType)!==gc)return le({result:{error:Co},stack:s});n||(n=c.structure),r||(r=c.matchUp)}l=PT({item:r,drawDefinition:t,structure:n,event:o})||PT({item:n,drawDefinition:t,structure:n,event:o})||kf(t)||kf(o)}else if(t&&e){if(!n){let c=Dt({drawDefinition:t,structureId:e});if(c.error)return c;n=c==null?void 0:c.structure}l=PT({item:n,drawDefinition:t,structure:n,event:o})||kf(t)||kf(o)}else l=kf(t)||kf(o);return l?{...re,structure:n,tieFormat:l,matchUp:r}:le({result:{error:d0},stack:s})}function FM({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![dr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Zl&&!Kr(t))}function kL({from:t,to:e}){let i=Object.keys(t),n=Ln(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function hke({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var w,S,U,P;let u="updateTieFormat",c=e==null?void 0:e.tournamentId,d=0,p=0,f=0,h=0,m=r==null?void 0:r.collectionDefinitions.reduce((E,D)=>(E[D.collectionId]=(E[D.collectionId]||0)+D.matchUpCount,E),{}),g=({tieFormat:E})=>{let D=E==null?void 0:E.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return kL({from:D,to:m}).equivalent},v=(w=Jm({drawDefinition:i}))==null?void 0:w.tieFormat,y=(S=Jm({event:s}))==null?void 0:S.tieFormat;if(s&&a){for(let E of s.drawDefinitions??[])b({drawDefinition:E});s.tieFormat=ra(r),h+=1}else if(o){if(!o.tieMatchUps)return le({result:{error:Co},stack:u});let E=qo((U=o.tieMatchUps)==null?void 0:U.map(({collectionId:A})=>A)),D=kL({to:m,from:E}),{changes:R,changesArePossible:N,cannotChangeReaon:M}=m9({matchUp:o,check:D});if(D.equivalent)if(FM({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=ra(r),h+=1;else return le({result:{error:ZV},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});else if(N)T({tieFormat:r,matchUp:o,changes:R,uuids:l});else return le({context:{collectionMap:m,matchUpMap:E},result:{error:Xd},info:M||"specified changes not possible",stack:u});p+=1,ci({eventId:s==null?void 0:s.eventId,context:u,drawDefinition:i,tournamentId:c,matchUp:o})}else if(n){let E=(P=I({inheritedTieFormat:v??y,structure:n}))==null?void 0:P.modifiedMatchUpsCount;E&&(p+=E,d+=1,h+=1);let D=!n.tieFormat||Pp({ancestor:n.tieFormat,descendant:r}).different;D&&(n.tieFormat=ra(r),d+=1,h+=1),(E||D)&&i&&Ji({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=ra(r),h+=1;else return{error:ot};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:f,modifiedCount:h,...re,tieFormat:r};function b({drawDefinition:E}){var N;let D=E.structures||[],R=[];for(let M of D){if(M.tieFormat)continue;let A=(N=I({inheritedTieFormat:y,structure:M}))==null?void 0:N.modifiedMatchUpsCount;if(A){d+=1,p+=A;let _=M.structureId;R.push(_)}}return Ji({structureIds:R,eventId:s==null?void 0:s.eventId,drawDefinition:E}),R.length}function I({inheritedTieFormat:E,structure:D}){var M,A;let R=0,N=((M=Ei({matchUpFilters:{matchUpTypes:[Zi]},structure:D}))==null?void 0:M.matchUps)||[];for(let _ of N){let k=FM({matchUp:_,updateInProgressMatchUps:t}),B=!1,F=qo((A=_.tieMatchUps)==null?void 0:A.map(({collectionId:$})=>$)),x=kL({from:F,to:m});if(x.equivalent)_.tieFormat&&g(_)&&k&&(_.tieFormat=ra(r),B=!0);else{let{changes:$,changesArePossible:j}=m9({matchUp:_,check:x});if(j&&!_.tieFormat)T({changes:$,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||Pp({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,B=!0);else return le({result:{error:d0},stack:u})}B&&(R+=1,ci({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:u,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:R}}function T({uuids:E,matchUp:D,tieFormat:R,changes:N}){D.tieFormat=ra(R);let M=[],A=[];return N.forEach(_=>{if(_.countChange>0){let k=Math.max(0,...D.tieMatchUps.filter(x=>x.collectionId===_.collectionId).map(Yo("collectionPosition"))),B=R.collectionDefinitions.find(x=>x.collectionId===_.collectionId),F=TD({matchUpsLimit:_.countChange,collectionPositionOffset:k,collectionDefinition:B,matchUp:D,uuids:E});A.push(...st(F,!1,!0)),f+=A.length,D.tieMatchUps.push(...F)}else{let k=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",k.length),M.push(...k),D.tieMatchUps=D.tieMatchUps.filter(({matchUpId:B})=>!k.includes(B))}}),A.length&&ih({matchUps:A,drawDefinition:i,tournamentId:c,eventId:a}),M.length&&Wp({matchUpIds:M,action:"updateTieFormat",drawDefinition:i,tournamentId:c,eventId:a}),{matchUpIdsRemoved:M,matchUpsAdded:A}}}function m9({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Fn).map(Yo("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function Ik({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[TT]))return;let{extension:n}=$t({name:TT,element:e}),r={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(i):[i],name:TT};fi({element:e,extension:r})}function o3({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){let T="modifyCollectionDefinition";if(o&&!Zo({matchUpFormat:o}))return le({result:{error:we},context:{matchUpFormat:o},stack:T});if(n&&typeof n!="string")return le({result:{error:we},context:{collectionName:n},stack:T});if(h&&!Object.values(kc).includes(h))return le({result:{error:we},context:{gender:h},stack:T});if(p&&typeof p!="object")return le({result:{error:we},context:{category:p},stack:T});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!o&&!s&&!u)return le({result:{error:ht},stack:T});if(Object.values(w).filter(Boolean).length>1)return le({info:"Only one value assignment allowed per collectionDefinition",result:{error:we},stack:T});let S=Jm({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:m});if(S.error)return le({result:S,stack:T});let{matchUp:U,structure:P,tieFormat:E}=S,D=ra(E),R=E==null?void 0:E.collectionDefinitions.find(V=>V.collectionId===l),N=D==null?void 0:D.collectionDefinitions.find(V=>V.collectionId===l);if(!R)return le({info:"source collectionDefinition",result:{error:Hr},context:{collectionId:l},stack:T});let M=v??y??b??I;if(g!=null&&g.length){let V=qne({matchUpCount:s??(R==null?void 0:R.matchUpCount)??0,collectionValueProfiles:g});if(V.errors)return le({result:{error:we},info:V.errors,stack:T})}else if(M&&!Nt(M))return le({result:{error:we},info:"value is not an integer",context:{value:M},stack:T});let A=(V,H)=>Ln(Object.keys(V),Object.keys(H)).length===Object.keys(V).length&&Ln(Object.values(V),Object.values(H)).length===Object.values(V).length,_=g&&(!R.collectionValueProfiles||!A(R.collectionValueProfiles,g)),k=Nt(v)&&R.collectionValue!==v||Nt(y)&&R.matchUpValue!==y||Nt(b)&&R.scoreValue!==b||Nt(I)&&R.setValue!==I||_,B=[];if(k&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),B.push({collectionId:l,...pt(w)})),(Nt(b)||Nt(I))&&N.collectionGroupNumber){let V=N.collectionGroupNumber;D.collectionDefinitions=D.collectionDefinitions.map(H=>{let{collectionGroupNumber:z,...q}=H;return z===V?q:H}),D.collectionGroups=D.collectionGroups.filter(({groupNumber:H})=>H!==V),B.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=ab(D),$=pt({aggregateValue:F,valueGoal:x});if(($.aggregateValue!==(E==null?void 0:E.winCriteria.aggregateValue)||$.valueGoal!==(E==null?void 0:E.winCriteria.valueGoal))&&(D.winCriteria=$,B.push({collectionId:l,winCriteria:$})),Nt(i)&&R.collectionOrder!==i&&(N.collectionOrder=i,B.push({collectionId:l,collectionOrder:i})),n&&R.collectionName!==n&&(N.collectionName=n,B.push({collectionId:l,collectionName:n})),o&&R.matchUpFormat!==o&&(N.matchUpFormat=o,B.push({collectionId:l,matchUpFormat:o})),Nt(s)&&R.matchUpCount!==s&&(N.matchUpCount=s,B.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return le({result:{error:FA},context:{matchUpType:u},stack:T});p&&R.category!==p&&(N.category=p,B.push({collectionId:l,category:p})),h&&R.gender!==h&&(N.gender=h,B.push({collectionId:l,gender:h}));let j=pt(D);if(S=Mo({tieFormat:j}),S.error)return le({result:S,stack:T});if(!B.length)return le({result:{...re,modifications:B}});if((E==null?void 0:E.tieFormatName)!==r?(j.tieFormatName=r,B.push({tieFormatName:r})):B.length&&(delete j.tieFormatName,B.push("tieFormatName removed: modifications without new tieFormatName")),S=hke({tieFormat:j,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:f,matchUp:U,event:m}),!S.error){let{appliedPolicies:V}=mi({tournamentRecord:e}),H=pt({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:T,structureId:c,matchUpId:d,eventId:f});Ik({appliedPolicies:V,drawDefinition:a,auditData:H})}return le({result:{...S,modifications:B},stack:T})}function mke({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var s,l;let o=[];return r&&a?o=[a]:i&&n?o=((s=Ei({matchUpFilters:{matchUpTypes:[Zi]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(o=((l=za({matchUpFilters:{matchUpTypes:[Zi]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(u=>!u.winningSide&&u.matchUpStatus!==kn&&(t||u.matchUpStatus!==Zl&&!Kr(u)))}}function gke({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=ra(r));let l;if(t){let u=mi({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=Jp({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&ci({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...re}}function xle({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=ab(l);l.winCriteria=pt({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=mke({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});gke({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=pt(l),v=Mo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:ot};return Ji({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...re}}function Lle({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!e)return{error:ht};if(isNaN(e))return{error:we};let c="removeCollectionGroup",d=s?void 0:Jm({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:u});if(d!=null&&d.error)return le({result:d,stack:c});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let f=d==null?void 0:d.tieFormat,h=f==null?void 0:f.winCriteria.valueGoal,m=f==null?void 0:f.winCriteria.aggregateValue,g=ra(f);if(d=Mo({tieFormat:g}),d.error)return le({result:d,stack:c});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...I}=y;return b!==e?y:(v.push(y.collectionId),I)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:y})=>y!==e),d=xle({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!d.error){let{appliedPolicies:y}=mi({tournamentRecord:i}),b=pt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:c,structureId:a,matchUpId:o,eventId:l});Ik({appliedPolicies:y,drawDefinition:n,auditData:b})}return le({result:{...d,modifiedCollectionIds:v},stack:c})}function dw({tieFormat:t,orderMap:e}){var n;let i=ra(t);return i.collectionDefinitions.forEach(r=>{let a=e[r.collectionId];a&&(r.collectionOrder=a)}),(n=i.collectionDefinitions)==null||n.sort((r,a)=>zI(r.collectionOrder)-zI(a.collectionOrder)),i}function Fle({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>Nt(l)))return le({result:{error:we},context:{orderMap:r}});if(a&&(s!=null&&s.tieFormat))g9({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&rn({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:Eo};o!=null&&o.tieFormat&&(o.tieFormat=dw({tieFormat:o.tieFormat,orderMap:r}),ci({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=Dt({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=dw({tieFormat:u.tieFormat,orderMap:r}),Ble({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:r}),Ji({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)rB({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)g9({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:Hr}}else if(e!=null&&e.tieFormat)rB({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:Hr};return{...re}}function g9({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=dw({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])rB({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function rB({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=dw({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=dw({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),Ble({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));Ji({drawDefinition:e,structureIds:s})}function Ble({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var o;let a=(o=Ei({matchUpFilters:{matchUpTypes:[Zi]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=dw({tieFormat:s.tieFormat,orderMap:n}),ci({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function s3({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var D,R,N,M,A;let d="removeCollectionDefinition",p=u?void 0:Jm({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:c});if(p!=null&&p.error)return le({result:p,stack:d});let f=p==null?void 0:p.structure;u=u??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,m=ra(h);if(p=Mo({tieFormat:m}),p.error)return le({result:p,stack:d});let g=(D=m==null?void 0:m.collectionDefinitions)==null?void 0:D.find(_=>_.collectionId===a);if(!g)return le({result:{error:Hr,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(_=>_.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(_=>{let{collectionGroupNumber:k,...B}=_;return B}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:_})=>_!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=ab(m);m.winCriteria=pt({aggregateValue:v,valueGoal:y});let b=h==null?void 0:h.winCriteria.valueGoal,I=h==null?void 0:h.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(r?m.tieFormatName=r:delete m.tieFormatName);let T=[];s&&u?T=[u]:o&&f?T=((R=Ei({matchUpFilters:{matchUpTypes:[Zi]},structure:f}))==null?void 0:R.matchUps)??[]:n?T=((N=za({matchUpFilters:{matchUpTypes:[Zi]},drawDefinition:n}))==null?void 0:N.matchUps)??[]:c&&(T=((M=Xp({matchUpFilters:{matchUpTypes:[Zi]},drawDefinition:n}))==null?void 0:M.matchUps)??[]);let w=(T||[]).filter(_=>{var F,x,$;let k=(x=(F=_.tieMatchUps)==null?void 0:F.filter(j=>j.collectionId===a))==null?void 0:x.some(Kr),B=e&&_.tieFormat?($=Pp({descendant:_.tieFormat,ancestor:m}))==null?void 0:$.different:!1;return t&&!k||!_.winningSide&&_.matchUpStatus!==kn&&(t||_.matchUpStatus!==Zl&&!Kr(_)&&!B)});if(!w.length)return{error:h0};let{appliedPolicies:S}=mi({tournamentRecord:i});if(s&&u&&t){let _=(A=u.tieMatchUps)==null?void 0:A.filter(k=>k.collectionId===a);for(let k of _??[]){let B=GD({matchUpId:k.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:c});if(B.error||(B=rn({drawDefinition:n,matchUpId:s}),B.error))return B;u=B==null?void 0:B.matchUp}}let U=[];for(let _ of w){for(let k of(_==null?void 0:_.sides)??[])k.lineUp=(k.lineUp??[]).map(B=>({participantId:B.participantId,collectionAssignments:((B==null?void 0:B.collectionAssignments)??[]).filter(F=>F.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(k=>{let B=k.collectionId===a;return B&&U.push(k.matchUpId),!B}),_.tieFormat&&(_.tieFormat=ra(m)),t){let k=Jp({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:c});if(k.error)return k}ci({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:n,context:d,matchUp:_})}U.length&&Wp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:U,eventId:c==null?void 0:c.eventId,drawDefinition:n});let P=pt(m);if(p=Mo({tieFormat:P}),p.error)return le({result:p,stack:d});if(l&&c)c.tieFormat=P;else if(s&&u)u.tieFormat=P;else if(f)f.tieFormat=P;else if(n)n.tieFormat=P;else if(!u||!n)return{error:ot};Ji({drawDefinition:n,eventId:c==null?void 0:c.eventId});let E=pt({drawId:n==null?void 0:n.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return Ik({appliedPolicies:S,drawDefinition:n,auditData:E}),{tieFormat:P,deletedMatchUpIds:U,targetMatchUps:w,...re}}function $le({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(r))return le({result:{error:ht},stack:d});let p=l?void 0:Jm({drawDefinition:n,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return le({result:p,stack:d});let f=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,m=h==null?void 0:h.winCriteria.valueGoal,g=ra(h);if(p=Mo({tieFormat:g}),p.error)return le({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return le({info:"collectionIds cannot be part of other collectionGroups",result:{error:we},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],xle({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:f,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function l3({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){var x,$;let g="addCollectionDefinition",v=mi({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},y=(r==null?void 0:r[Br])??(v==null?void 0:v[Br]);a=a??((x=y==null?void 0:y.participants)==null?void 0:x.enforceCategory);let b=(u??(($=y==null?void 0:y.participants)==null?void 0:$.enforceGender))!==!1,I=!!((i??(m==null?void 0:m.category))&&a!==!1),T=!!((o??(m==null?void 0:m.gender))&&b),w=PD({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:I,checkGender:T,event:m});if(w.error)return le({result:w,stack:g});let S=p!=null&&p.tieFormat?void 0:Jm({drawDefinition:s,structureId:c,matchUpId:d,eventId:f,event:m});if(S!=null&&S.error)return le({result:{error:S.error},stack:g});let U=S==null?void 0:S.structure;p=p??(S==null?void 0:S.matchUp);let P=(p==null?void 0:p.tieFormat)??(S==null?void 0:S.tieFormat),E=ra(P);if(S=Mo({tieFormat:E}),S==null?void 0:S.error)return le({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=Mi();else if(E.collectionDefinitions.map(({collectionId:j})=>j).includes(e.collectionId))return le({context:{collectionId:e.collectionId},result:{error:xee}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((j,V)=>(j.collectionOrder||0)-(V.collectionOrder||0)).forEach((j,V)=>j.collectionOrder=V+1);let{aggregateValue:D,valueGoal:R}=ab(E);E.winCriteria=pt({aggregateValue:D,valueGoal:R});let N=P==null?void 0:P.winCriteria.valueGoal,M=P==null?void 0:P.winCriteria.aggregateValue;(N&&N!==R||D&&!M)&&(l?E.tieFormatName=l:delete E.tieFormatName);let A=[],_=[],k=[],B=pt(E);if(S=Mo({tieFormat:B}),S==null?void 0:S.error)return le({result:{error:S.error},stack:g});if(f&&m){m.tieFormat=B;for(let j of m.drawDefinitions??[])if(!j.tieFormat)for(let V of j.structures??[]){if(V.tieFormat)continue;let H=OL({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:h});_.push(...H.newMatchUps),k.push(...H.targetMatchUps),A.push(V.structureId)}sC({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(c&&U){U.tieFormat=B;let j=OL({updateInProgressMatchUps:t,collectionDefinition:e,structure:U,uuids:h});_.push(...j.newMatchUps),k=j.targetMatchUps,sC({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(d&&p){if(!FM({matchUp:p,updateInProgressMatchUps:t}))return le({result:{error:ZV},stack:g});p.tieFormat=B;let j=TD({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...j),_.push(...j),sC({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(s){s.tieFormat=B;for(let j of s.structures??[]){let V=OL({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:h});A.push(j.structureId),_.push(...V.newMatchUps),k.push(...V.targetMatchUps)}sC({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else return{error:ot};let F=pt({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:c,matchUpId:d,eventId:f});return Ik({appliedPolicies:v,drawDefinition:s,auditData:F}),{tieFormat:B,targetMatchUps:k,addedMatchUps:_,...re}}function OL({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var o;let r=[],a=((o=Ei({matchUpFilters:{matchUpTypes:[Zi]},structure:i}))==null?void 0:o.matchUps).filter(s=>FM({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=TD({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),r.push(...l)}return{newMatchUps:r,targetMatchUps:a}}function sC({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){ih({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{ci({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),Ji({structureIds:t,drawDefinition:n,eventId:a})}function Vle({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:c}){let d="modifyTieFormat";if(!Mo({tieFormat:i}).valid)return le({result:{error:Xd},info:"falied validation",stack:d});let p=Jm({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(p.error)return le({result:p,stack:d});let{matchUp:f,tieFormat:h}=p,m=ra(h),g=Pp({descendant:i,ancestor:m,considerations:r});if(g.invalid)return le({context:{invalid:g.invalid},result:{error:Xd},stack:d});if(!(g!=null&&g.different))return le({result:{...re},info:"Nothing to do",stack:d});let v=m.collectionDefinitions.map(({collectionId:P})=>P),y=i.collectionDefinitions.map(({collectionId:P})=>P),b=v.filter(P=>!y.includes(P)),I=i.collectionDefinitions.filter(({collectionId:P})=>!v.includes(P)),T=I.map(Yo("collectionId")),w=[],S,U=i.tieFormatName;for(let P of i.collectionDefinitions){if(T.includes(P.collectionId))continue;let E=o3({updateInProgressMatchUps:t,...P,tournamentRecord:n,tieFormatName:U,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:c});if(E.modifications&&w.push(...E.modifications),E.error)return le({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of I){let E=l3({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:n,drawDefinition:a,tieFormatName:U,structureId:o,matchUpId:s,matchUp:f,eventId:l,uuids:u,event:c});if(E.error)return le({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}for(let P of b){let E=s3({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:a,tieFormatName:U,collectionId:P,structureId:o,matchUpId:s,eventId:l,matchUp:f,event:c});if(E.error)return le({result:E,stack:d});E.tieFormat&&(S=E.tieFormat)}return(h==null?void 0:h.tieFormatName)!==U?(S.tieFormatName=U,w.push({tieFormatName:U})):(w.length||T.length||b.length)&&(delete S.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((P,E)=>zI(P.collectionOrder)-zI(E.collectionOrder)).map((P,E)=>({...P,collectionOrder:E+1})),{processedTieFormat:ra(S),modifications:w,...re}}function jle({tournamentRecord:t}){if(!t)return{error:Fe};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=c=>{if(!c.tieFormat)return;let d;for(let p of n)Pp({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=st(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Mi()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){r({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var f;let p=(f=l.matchUps)==null?void 0:f.find(h=>h.matchUpId===c);p&&(p.tieFormatId=d,delete p.tieFormat,ci({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=c=>{let d=st(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Mi()),n.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=Xp({matchUpFilters:{matchUpTypes:[gc]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of n)c.tieFormat&&Pp({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}n.length&&(i.tieFormats=n)}return{...re,addedCount:e}}var u3={};Kt(u3,{addDrawDefinitionExtension:()=>qA,addEventExtension:()=>Rh,addEventTimeItem:()=>tb,addExtension:()=>fi,addNotes:()=>S_,addOnlineResource:()=>qle,addParticipantExtension:()=>bte,addParticipantTimeItem:()=>zG,addTimeItem:()=>kh,addTournamentExtension:()=>Nj,addTournamentTimeItem:()=>eb,analyzeDraws:()=>RD,analyzeTournament:()=>zH,getAllowedDrawTypes:()=>j_,getAllowedMatchUpFormats:()=>jH,getAppliedPolicies:()=>mi,getCompetitionDateRange:()=>H_,getCompetitionPenalties:()=>GH,getPolicyDefinitions:()=>Kp,getTournamentInfo:()=>rb,getTournamentPenalties:()=>G_,getTournamentPersons:()=>HH,getTournamentStructures:()=>GG,getTournamentTimeItem:()=>Z1,mutate:()=>Gle,query:()=>loe,removeDrawDefinitionExtension:()=>Ite,removeEventExtension:()=>WA,removeExtension:()=>Ha,removeNotes:()=>tH,removeOnlineResource:()=>zle,removeParticipantExtension:()=>wte,removeTournamentExtension:()=>Aj,setTournamentCategories:()=>Yle,setTournamentDates:()=>wk,setTournamentEndDate:()=>Xle,setTournamentName:()=>Wle,setTournamentNotes:()=>Kle,setTournamentStartDate:()=>Zle,setTournamentStatus:()=>Hle});var Gle={};Kt(Gle,{addDrawDefinitionExtension:()=>qA,addEventExtension:()=>Rh,addEventTimeItem:()=>tb,addExtension:()=>fi,addNotes:()=>S_,addOnlineResource:()=>qle,addParticipantExtension:()=>bte,addParticipantTimeItem:()=>zG,addTimeItem:()=>kh,addTournamentExtension:()=>Nj,addTournamentTimeItem:()=>eb,removeDrawDefinitionExtension:()=>Ite,removeEventExtension:()=>WA,removeExtension:()=>Ha,removeNotes:()=>tH,removeOnlineResource:()=>zle,removeParticipantExtension:()=>wte,removeTournamentExtension:()=>Aj,setTournamentCategories:()=>Yle,setTournamentDates:()=>wk,setTournamentEndDate:()=>Xle,setTournamentName:()=>Wle,setTournamentNotes:()=>Kle,setTournamentStartDate:()=>Zle,setTournamentStatus:()=>Hle});var vke="ABANDONED",yke="ACTIVE",bke="CANCELLED",Ike="COMPLETED",wke="IN_PROGRESS",c3={ABANDONED:vke,ACTIVE:yke,CANCELLED:bke,COMPLETED:Ike,IN_PROGRESS:wke};function Hle({tournamentRecord:t,status:e}){return t?e&&!Object.keys(c3).includes(e)?{error:we,info:"Unknown status"}:(t.tournamentStatus=e,{...re}):{error:Fe}}function zle(t){var u,c,d;let e=Lt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:o,courtId:s,venueId:l}=t;if(r){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==r)return le({result:{error:Hr}});Wb({element:i.parentOrganisation,onlineResource:n})}else if(a||o){let p=(i.participants??[]).find(f=>{var h;return o&&((h=f.person)==null?void 0:h.personId)===o||f.participantId===a});if(!p)return le(o?{result:{error:Hr}}:{result:{error:_n}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return le({result:{error:ky}});Wb({element:p.person,onlineResource:n})}else Wb({element:p,onlineResource:n})}else if(s){let p=(d=(i.venues??[]).filter(f=>!l||f.venueId===l).flatMap(f=>(f.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return le({result:{error:f0}});Wb({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(f=>f.venueId===l);if(!p)return le({result:{error:xy}});Wb({element:p,onlineResource:n})}else Wb({element:i,onlineResource:n}),jt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Hy});return{...re}}function Wb({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>!((n==null?void 0:n[qI])===e[qI]&&(n==null?void 0:n[WI])===e[WI]&&(n==null?void 0:n[KI])===e[KI]));t.onlineResources=i}function qle(t){var u,c,d;let e=Lt(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:n,organisationId:r,participantId:a,personId:o,courtId:s,venueId:l}=t;if(r){if(((u=i.parentOrganisation)==null?void 0:u.parentOrganisationId)!==r)return le({result:{error:Hr}});Kb({element:i.parentOrganisation,onlineResource:n})}else if(a||o){let p=(i.participants??[]).find(f=>{var h;return o&&((h=f.person)==null?void 0:h.personId)===o||f.participantId===a});if(!p)return le(o?{result:{error:Hr}}:{result:{error:_n}});if(o){if(((c=p.person)==null?void 0:c.personId)!==o)return le({result:{error:ky}});Kb({element:p.person,onlineResource:n})}else Kb({element:p,onlineResource:n})}else if(s){let p=(d=(i.venues??[]).filter(f=>!l||f.venueId===l).flatMap(f=>(f.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return le({result:{error:f0}});Kb({element:p,onlineResource:n})}else if(l){let p=(i.venues??[]).find(f=>f.venueId===l);if(!p)return le({result:{error:xy}});Kb({element:p,onlineResource:n})}else Kb({element:i,onlineResource:n}),jt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:Hy});return{...re}}function Kb({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(n=>(n==null?void 0:n[qI])!==e[qI]&&(n==null?void 0:n[WI])!==e[WI]&&(n==null?void 0:n[KI])!==e[KI]);return i.push(e),t.onlineResources=i,{...re}}function Wle({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){if(!t)return{error:Fe};let r=t.tournamentId,a={tournamentId:r};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),n&&n!==t.formalName&&(t.formalName=n,a.formalName=n),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&jt({topic:Hy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:r,...a}}),{...re}}function Kle({tournamentRecord:t,notes:e}){if(!t)return{error:Fe};let i=e?S_({element:t,notes:e}):tH({element:t});return i.error?i:(jt({topic:Hy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...re})}function Yle({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,jt({topic:Hy,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...re}):{error:Fe}}function Ske({tournamentRecord:t}){var a,o;if(!t)return{error:Fe};let{startDate:e,endDate:i}=t,n=YI(e,i),r=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&r.push(...s.courts);for(let s of r){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,f)=>{let h=li(p.startTime),m=li(p.endTime);return f.startTime&&li(f.startTime)<h&&(p.startTime=f.startTime),f.endTime&&li(f.endTime)>m&&(p.endTime=f.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=n.map(p=>{var f;return((f=s.dateAvailability)==null?void 0:f.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...re}}function wk(t){var d;let{tournamentRecord:e,startDate:i,endDate:n}=t,r=Lt(t,[{tournamentRecord:!0},{[ks]:p=>gd.test(p),[Uj]:{startDate:!1,endDate:!1},[md]:Ka}]);if(r.error)return r;if(n&&i&&new Date(n)<new Date(i))return{error:we};let a;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(a=!0);let o=YI(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let s=YI(e.startDate,e.endDate),l=o.filter(p=>!s.includes(p)),u=s.filter(p=>!o.includes(p));for(let p of e.events??[])i&&p.startDate&&new Date(p.startDate)<new Date(i)&&(p.startDate=i),n&&p.startDate&&new Date(p.startDate)>new Date(n)&&(p.startDate=i??n),n&&p.endDate&&new Date(p.endDate)>new Date(n)&&(p.endDate=n),i&&p.endDate&&new Date(p.endDate)<new Date(i)&&(p.endDate=n??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n);let c=a&&((d=Tke({tournamentRecord:e}))==null?void 0:d.unscheduledMatchUpIds);return Ske({tournamentRecord:e}),jt({payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,startDate:i,endDate:n},topic:Hy}),{...re,unscheduledMatchUpIds:c,datesAdded:u,datesRemoved:l}}function Zle({tournamentRecord:t,startDate:e}){return wk({tournamentRecord:t,startDate:e})}function Xle({tournamentRecord:t,endDate:e}){return wk({tournamentRecord:t,endDate:e})}function Tke({tournamentRecord:t}){let e=Wr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||n&&u>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!mk({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:BQ}:{unscheduledMatchUpIds:a}}var d3={};Kt(d3,{addCourt:()=>yk,addCourts:()=>Jz,addVenue:()=>sD,deleteCourt:()=>oue,deleteVenue:()=>m3,deleteVenues:()=>tue,disableCourts:()=>iue,disableVenues:()=>nue,enableCourts:()=>rue,enableVenues:()=>aue,generate:()=>Jle,generateCourts:()=>Pz,getCompetitionVenues:()=>kD,getCourts:()=>uz,getVenuesAndCourts:()=>Qp,modifyCourt:()=>g3,modifyCourtAvailability:()=>f3,modifyVenue:()=>sue,mutate:()=>Qle,publicFindVenue:()=>TG,query:()=>Toe});var Jle={};Kt(Jle,{generateCourts:()=>Pz});var Qle={};Kt(Qle,{addCourt:()=>yk,addCourts:()=>Jz,addVenue:()=>sD,deleteCourt:()=>oue,deleteVenue:()=>m3,deleteVenues:()=>tue,disableCourts:()=>iue,disableVenues:()=>nue,enableCourts:()=>rue,enableVenues:()=>aue,modifyCourt:()=>g3,modifyCourtAvailability:()=>f3,modifyVenue:()=>sue});function p3(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:Fe};if(!(t!=null&&t.courtId))return{error:_y};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=ef({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=Wr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var h,m,g;let f=(m=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:m.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===c||(f==null?void 0:f.includes(c))});return AM({matchUps:d,schedulingProfile:o})}}function Uke({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:Fe};if(!n)return{error:Ph};let{schedulingProfile:r}=ef({tournamentRecord:e}),{matchUps:a}=Wr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var p,f,h;let d=(f=(p=c.schedule)==null?void 0:p.allocatedCourts)==null?void 0:f.map(({venueId:m})=>m);return((h=c.schedule)==null?void 0:h.venueId)===l||(d==null?void 0:d.includes(l))});return AM({matchUps:u,schedulingProfile:r})}}function f3({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var f,h,m;if(!t)return{error:Fe};if(!r)return{error:_y};let o=zse({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=Dke(e);e=s;let u=Ky({tournamentRecord:t,courtId:r});if(u.error)return u;let{court:c,venue:d}=u,{matchUps:p}=p3({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p!=null&&p.length){let g=(f=mi({tournamentRecord:t}))==null?void 0:f.appliedPolicies,v=a??((m=(h=g==null?void 0:g[Ch])==null?void 0:h.allowDeletionWithScoresPresent)==null?void 0:m.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return c&&(c.dateAvailability=e,!i&&d&&jt({payload:{venue:d,tournamentId:t.tournamentId},topic:Ig,key:d.venueId})),{...re,totalMergeCount:l}}function Dke(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:u}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(z_e);let{mergedAvailability:a,mergeCount:o}=Pke(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function Pke(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(r-=1,!e)e=u,n=d,i=c;else if($1(er(i),er(u),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=u,n=d,i=c}else d&&(n?n.push(d):n=d),i=c,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function h3({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Vee,info:e}}function eue({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:Ca};if(!e&&!n)return{error:qu};let a;if(!e){if(!t)return{error:Fe};({drawDefinition:e}=ho({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=rn({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Fe};let o=Wr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Hne({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Gm,Up].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Gm,Up].includes(o)),ci({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...re}):{error:Ta}}function m3(t){var l,u,c;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Ph};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:Fe};let a=Fu({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=mi({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=n??((c=(u=o==null?void 0:o[Ch])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:c.venues);if(!a.length||s)for(let d of Object.values(r)){for(let f of a){let h=eue({matchUpId:f.matchUpId,drawId:f.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(f=>(f==null?void 0:f.venueId)!==i?!0:(p=!0,!1)),p&&jt({payload:{venueId:i,tournamentId:d.tournamentId},topic:tG,key:i})}else return h3({matchUpsCount:a.length});return xD({tournamentRecords:r}),{...re}}function tue({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Fe};if(!Array.isArray(e))return{error:we};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=m3({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...re}}function iue(t){let{courtIds:e,dates:i}=t,n=Ac(t),r=[{[Ua]:!0,[HA]:!0}],a=Lt(t,r);if(a.error)return a;for(let o of Object.values(n))Eke({tournamentRecord:o,courtIds:e,dates:i});return{...re}}function Eke({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>fi({extension:{value:n,name:Ru},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...re}}function nue(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Ua]:!0,[zA]:!0}],a=Lt(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Cke({tournamentRecord:l,venueIds:n})}return{...re}}function Cke({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=fi({creationTime:!1,element:i,extension:{name:Ru,value:!0}});if(n.error)return n}return{...re}}function rue(t){let e=Ac(t),i=[{[Ua]:!0}];!t.enableAll&&i.push({[HA]:!0});let n=Lt(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))Rke({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...re}}function Rke({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=$t({element:a,name:Ru});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),fi({extension:{name:Ru,value:s},creationTime:!1,element:a})}}else Ha({element:a,name:Ru});return{...re}}function aue(t){let e=Ac(t),i=[{[Ua]:!0}];!t.enableAll&&i.push({[zA]:!0});let n=Lt(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&Ha({element:s,name:Ru});return{...re}}function oue(t){let{courtId:e,disableNotice:i,force:n}=t,r=Ac(t),a=Lt(t,[{[Ua]:!0,[dte]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=Mke({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==f0)return s;s.success&&(o=!0)}return o?{...re}:s}function Mke({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var u,c,d;let r=Ky({tournamentRecord:t,courtId:i});if(r.error)return r;let a=r.venue,{matchUps:o}=p3({tournamentRecord:t,courtId:i}),s=(u=mi({tournamentRecord:t}))==null?void 0:u.appliedPolicies,l=n??((d=(c=s==null?void 0:s[Ch])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let f=eue({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(f.error)return f}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||jt({payload:{venue:a,tournamentId:t.tournamentId},topic:Ig,key:a.venueId}))}else return h3({matchUpsCount:o.length});return{...re}}function g3(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=Ac(t);if(!Object.keys(o).length)return{error:Cn};let s,l;for(let u of Object.values(o)){let c=Nke({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(c!=null&&c.error)return c;s=!0}return s?{...re}:l}function Nke({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:Fe};if(!r)return{error:_y};if(!n||typeof n!="object")return{error:zp};let o=Ky({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(H_e()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>u.includes(p)).length)return{error:LA};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=f3({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||jt({payload:{venue:s,tournamentId:t.tournamentId},topic:Ig,key:s==null?void 0:s.venueId}),{...re,court:st(l)}}var Ake=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),_ke=Ake;function sue(t){let{modifications:e,venueId:i,force:n}=t,r=Ac(t);if(!Object.keys(r).length)return{error:Cn};if(typeof i!="string")return{error:Ph};let a,o;for(let s of Object.values(r)){let l=kke({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==xy)return l}return xD({tournamentRecords:r}),o?{...re}:{error:a}}function kke({tournamentRecord:t,modifications:e,venueId:i,force:n}){var g,v,y,b,I,T,w,S;if(!t)return{error:Fe};if(!e||typeof e!="object")return{error:zp};if(!i)return{error:Ph};let r=(g=mi({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=n??((y=(v=r==null?void 0:r[Ch])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=Uke({tournamentRecord:t,venueId:i}),s=Zp({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,u=Object.keys(_ke()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>u.includes(U)).length)return{error:LA};let c=u.filter(U=>!["courts","onlineResources"].includes(U)),d=Object.keys(e).filter(U=>c.includes(U));l&&d.forEach(U=>Object.assign(l,{[U]:e[U]}));let p=((b=l==null?void 0:l.courts)==null?void 0:b.map(U=>U.courtId))??[],f=((I=e.courts)==null?void 0:I.map(U=>U.courtId))||[],h=f.length?p.filter(U=>!f.includes(U)):(e==null?void 0:e.courts)&&p,m=[];if(h!=null&&h.length){let U=(w=(T=l==null?void 0:l.courts)==null?void 0:T.filter(P=>h.includes(P.courtId)))==null?void 0:w.map(P=>{var D;let E=p3({courtId:P.courtId,tournamentRecord:t,venueMatchUps:o});for(let R of E.matchUps??[])m.push({matchUpId:R.matchUpId,drawId:R.drawId});return((D=E.matchUps)==null?void 0:D.length)??0}).reduce((P,E)=>P+E);if(l&&(!U||a))l.courts=(S=l.courts)==null?void 0:S.filter(P=>f.includes(P.courtId)),MU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return h3({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:P}=U||{},E=g3({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:P,force:n});if(E.error===f0&&(E=yk({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return xD({tournamentRecord:t}),l&&jt({payload:{venue:l,tournamentId:t.tournamentId},topic:Ig,key:l==null?void 0:l.venueId}),{...re,venue:st(l)}}var Wt={};Kt(Wt,{JSON2CSV:()=>$ke,UUID:()=>Mi,UUIDS:()=>fEe,allNumeric:()=>Zee,attributeFilter:()=>Kv,chunkArray:()=>zr,chunkByNth:()=>v2,chunkSizeProfile:()=>Yee,constantToString:()=>ua,countValues:()=>TDe,createMap:()=>OQ,dateTime:()=>dPe,definedAttributes:()=>pt,dehydrateMatchUps:()=>xke,extractAttributes:()=>Mie,flattenJSON:()=>v3,generateDateRange:()=>YI,generateHashCode:()=>$1e,generateRange:()=>Xe,generateTimeCode:()=>Xse,groupValues:()=>Wee,hasAttributeValues:()=>B1e,instanceCount:()=>qo,intersection:()=>Ln,isConvertableInteger:()=>Nt,isNumeric:()=>Dn,isOdd:()=>zee,isPowerOf2:()=>xu,makeDeepCopy:()=>st,matchUpSort:()=>Yy,nearestPowerOf2:()=>cj,nextPowerOf2:()=>m0,noNulls:()=>SDe,noNumeric:()=>Xee,numericSort:()=>sr,occurrences:()=>DDe,overlap:()=>Ya,randomMember:()=>Bo,randomPop:()=>Vo,shuffleArray:()=>Ga,structureSort:()=>Gy,subSort:()=>PDe,undefinedToNull:()=>s2,unique:()=>Vt,visualizeScheduledMatchUps:()=>Oke});function Oke({scheduledMatchUps:t,showGlobalLog:e}){$Ee();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var s;qs({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===r),o=((s=Za({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{qs({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:u,schedule:c})=>{let d=nn(c.scheduledTime);qs({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&BEe()}function xke({tournamentRecord:t}){if(!t)return{error:Fe};if(typeof t!="object"||!t.tournamentId)return{error:we};let{matchUps:e}=Wr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=Lke({tournamentRecord:t});Bke(e,i)}return{...re}}function Lke({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Fke=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Bke(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))Fke.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function $ke(t,e){if(e&&typeof e!="object")return{error:we};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof g!="string"||typeof f!="string")return{error:we};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let v=t.filter(Boolean).map(M=>v3(M,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((M,A)=>Object.keys(A).every(_=>!M.includes(_)&&M.push(_)||!0)&&M,[]).filter(M=>!(l!=null&&l.length)||l.includes(M)),I=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(A=>({[A]:M})).flat()).flat()),T=(M,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((M,A)=>{let _=I[A];return _?M.includes(_)||M.push(_):M.push(A),M},[]).sort(T);Object.keys(c).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>c[M]||M);if(s)return[S];let U=M=>`${f}${M}${f}`,P=[],E=M=>Object.values(w.reduce((A,_,k)=>{var j;let B=i[_],F=(B!=null&&B.length?M[B.find(V=>M[V])]:M[_])||(p==null?void 0:p[_])||"",x=((j=d[_])==null?void 0:j[F])||F,$=co(u[_])?u[_](x):x;return A[_]=U($),$&&(P[k]=(P[k]||0)+1),A},{})),D=v.map(E),R=o&&[...P].map((M,A)=>!M&&A).filter(Dn).reverse();if(R){let M=A=>A.filter((_,k)=>!R.includes(k));D=D.map(M),S=M(S)}let N=D.map(M=>M.join(h));return a?N.map(M=>{let A=M.split(h);return Object.assign({},...A.map((_,k)=>({[S[k]]:_})))}):r?[S.map(U).join(h),...N].join(m):N.join(m)}function v3(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,v3(t[r],e,i.concat(r))),{})}var Vke={},{FACTORY:v9}=Xv;function jke({tournamentRecord:t,value:e}){let{extension:i}=$t({element:t,name:v9}),n={name:v9,value:{...i==null?void 0:i.value,...e}};fi({element:t,extension:n})}function Sk({timeStamp:t}){let e=Eh(),i=pj();return i&&Object.values(e).forEach(n=>{jke({tournamentRecord:n,value:{version:s0(),timeStamp:t}})}),i}function lue({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var d,p;let a=gs();if(typeof a!="object")return;let o={method:e},s=(r==null?void 0:r.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),u=a.params&&!Array.isArray(a.params)||l,c=Array.isArray(a.exclude)&&a.exclude.includes(e);!c&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!c&&(s||u)&&(o.params=n),!c&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=r),Object.keys(o).length>1&&ate(o,t)}function KD({methodName:t,params:e,start:i}){let n={error:F1,methodName:t},r=i?Date.now()-i:0;return lue({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function Gke(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Fe};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=ho({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=ho({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:zo};e.tournamentId=s,e.event=o}let n=e.tournamentId??Fy();if(!n&&e)return e;let r=t[n];return n&&!r?{error:Fe}:(r&&(e.tournamentRecord=r),e)}function YD(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=Fy();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||gj(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Eh(),u=i?st(i,void 0,!0):void 0,c=i?Gke(l,i):void 0;if(c!=null&&c.error)return c;let d=Hke({params:c,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return lue({result:d,methodName:n,elapsed:p,params:u,engineType:r}),d}function Hke({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(gs())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return jA({engineName:"engine",methodName:n,params:i,err:a})}}function Tk(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=sl();for(let o of[...a].sort(cue)){let s=hj({topic:o});s!=null&&s.length&&aU({topic:o,notices:s})}e&&r&&a.includes(vU)&&aU({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:vU})}async function uue(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=sl();for(let o of[...a].sort(cue)){let s=hj({topic:o});s&&await aU({topic:o,notices:s})}e&&r&&a.includes(vU)&&aU({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:vU})}var y9={[uG]:5,[lG]:5,[cG]:5,[sG]:5,[oG]:5,[rG]:5,[Fte]:5,[Bte]:5,[aG]:1,[n_]:1,[fa]:5,[Ig]:5,[nG]:4,[eG]:4,[tG]:4,[iG]:4,[i_]:3,[Zj]:2};function cue(t,e){return(y9[e]||0)-(y9[t]||0)}function zke({convertExtensions:t,removeExtensions:e}){let i=Eh();return{tournamentId:Fy(),tournamentRecords:st(i,t,!1,e)}}function qke(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??Fy();if(typeof n!="string")return{};let r=gj(n);return{tournamentRecord:st(r,e,!1,i)}}function Wke(){var n;let t=Eh(),{extension:e}=$t({name:Bm,tournamentRecords:t,discover:!0}),i=((n=e==null?void 0:e.value)==null?void 0:n.tournamentIds)||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),VA(t)}function b9(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:zp}:t!=null&&t.tournamentId?nte(e?st(t):t):{error:we}}function ny(t,e=!0){if(typeof t!="object")return{error:zp};if(oU(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:c2};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},oU(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:c2};return VA(e?st(t):t)}async function Kke(t,e,i){if(!Array.isArray(e))return{error:we,message:"directives must be an array"};let n=fj(),r=Date.now(),a=i&&st(Eh(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:we,message:"directive must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return KD({methodName:c,start:r,params:p});if(d){let h=o[o.length-1],m=Object.keys(d);for(let g of m)h[g]&&(p[g]=h[g])}let f=YD(t,n[c],p,c,"async");if(f!=null&&f.error)return a&&ny(a),{...f,rolledBack:!!a};o.push({...f,methodName:c})}let s=Date.now(),l=Sk({timeStamp:s});return await uue({directives:e,mutationStatus:l,timeStamp:s}),Ly(),{success:o.every(u=>u.success),results:o}}async function I9(t,e){if(!Ii(e))return{error:we,message:"args must be an object"};let i=Object.values(e).filter(co).length;if(i>1)return{message:"there must be only one arg with typeof function",error:we};let n=i?Object.keys(e).find(f=>co(e[f])):zn(e.method)&&e.method;if(!n)return{error:F1};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&st(Eh(),!1,!0),l=r||t[n]||$A()[n];if(!l)return KD({methodName:n,params:o});let u=await YD(t,l,o,n,"async")??{};u!=null&&u.error&&s&&ny(s);let c=Date.now(),d=Sk({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&await uue({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Ly(),u}function Yke(t,e,i,n,r,a){let o=ote(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>co(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(gs())return c();try{return c()}catch(d){jA({engineName:"engine",methodName:l,params:u,err:d})}}}),{...re,...t}}function Yb(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function y3(t,e){t.importMethods=(i,n,r,a)=>Yke(t,e,i,n,r,a),t.getTournament=i=>qke(i),t.getState=i=>zke({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>s0(),t.reset=()=>(VA({}),Yb(t)),t.devContext=i=>(nU(i),Yb(t)),t.getDevContext=i=>gs(i),t.newTournamentRecord=(i={})=>{let n=Mse(i),r=n.tournamentId;return n.error?n:(b9(n),oU(r),{...re,tournamentId:r})},t.setState=(i,n,r)=>{rU(n,r);let a=ny(i,n);return Yb(t,a)},t.setTournamentId=i=>oU(i),t.getTournamentId=()=>Fy(),t.setTournamentRecord=(i,n,r)=>{rU(n,r);let a=b9(i,n);return Yb(t,a)},t.removeTournamentRecord=i=>{let n=rte(i);return Yb(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=Wke();return Yb(t,i)}}function Zke(t){let e=Jee();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>Kke(i,n,r),execute:n=>I9(i,n)};return y3(i,I9),i}function Xke(t,e,i){if(!Array.isArray(e))return{error:we,message:"directives must be an array"};let n=fj(),r=Date.now(),a=i&&st(Eh(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:we,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:we,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return KD({methodName:c,start:r,params:p});if(d){let h=o[o.length-1],m=Object.keys(d);for(let g of m)h[g]&&(p[g]=h[g])}let f=YD(t,n[c],p,c,"sync");if(f!=null&&f.error)return a&&ny(a),{...f,rolledBack:!!a};o.push({...f,methodName:c})}let s=Date.now(),l=Sk({timeStamp:s});return Tk({directives:e,mutationStatus:l,timeStamp:s}),Ly(),{success:o.every(u=>u.success),results:o}}function w9(t,e){if(!Ii(e))return{error:we,message:"args must be an object"};let i=Object.values(e).filter(co).length;if(i>1)return{message:"there must be only one arg with typeof function",error:we};let n=i?Object.keys(e).find(f=>co(e[f])):zn(e.method)&&e.method;if(!n)return{error:F1};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&st(Eh(),!1,!0),l=r||t[n]||$A()[n];if(!l)return KD({methodName:n,params:o});let u=YD(t,l,o,n,"sync")??{};u!=null&&u.error&&s&&ny(s);let c=Date.now(),d=Sk({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&Tk({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&Ly(),u}var due=(()=>{let t={executionQueue:(e,i)=>Xke(t,e,i),execute:e=>w9(t,e)};return y3(t,w9),t})(),ZD=due;function S9(t,e){if(!Ii(e))return{error:we,message:"args must be an object"};let i=Object.values(e).filter(co).length;if(i>1)return{message:"there must be only one arg with typeof function",error:we};let n=i?Object.keys(e).find(l=>co(e[l])):zn(e.method)&&e.method;if(!n)return{error:F1};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||$A()[n];return s?YD(t,s,o,n,"ask"):KD({methodName:n,params:o})}var Jke=(()=>{let t={execute:e=>S9(t,e)};return y3(t,S9),t})(),Cv={},Lf;function T9(t,e=!0){if(!t)return{error:ht};if(typeof t!="object")return{error:zp};if(t.matchUpId)Lf=t.matchUpId,Cv[Lf]=e?st(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Cv[i.matchUpId]=e?st(i):i,Lf||(Lf=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Cv[i.matchUpId]=e?st(i):i,Lf||(Lf=i.matchUpId));return e?st(t):t}function Qke(){return Cv[Lf]}function eOe(){return Object.values(Cv)}function tOe(){Lf=void 0,Cv={}}function iOe(t){return st(Cv[Lf],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}var nOe=(()=>{let t={getState:r=>iOe(r),version:()=>s0(),reset:()=>(tOe(),{...re}),drawId:void 0,error:void 0,success:!1,devContext:r=>(nU(r),t),setState:(r,a,o)=>{rU(a,o);let s=T9(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([Mm]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(gs())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){jA({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||Qke(),l=(r==null?void 0:r.matchUps)||eOe(),u=(r==null?void 0:r.rollbackOnError)&&st(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](r);if(c!=null&&c.error)return u&&T9(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&Tk(),(d||!(c!=null&&c.success)||r!=null&&r.doNotNotify)&&Ly(),c}})(),xL=!1,XD=(()=>{let t={version:()=>s0(),setDeepCopy:(n,r)=>(rU(n,r),t),devContext:n=>(nU(n),xL=!0,t)};return i([fk]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||Tk(),Ly(),xL&&(nU(!1),xL=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{if(gs()){let s=e(r[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&ny(s.tournamentRecord),s}else try{let s=e(r[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&ny(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();ZD.importMethods(EA,!0,1);var Mg=ZD,$e=ZD;function pue(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function rOe(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,f=h=>!n&&!l||!h.dateRanges?!0:h.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(h=>{var m,g,v,y,b,I,T,w,S,U;return f(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((m=h.drawTypes)!=null&&m.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((b=h.levels)!=null&&b.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((T=(I=h.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=h.eventTypes)!=null&&S.length)||((U=h.eventTypes)==null?void 0:U.includes(r)))})}}function U9({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var h,m;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(Nt(g)?g:0),b=pue(a,g==null?void 0:g.level);return{value:o(v,b)||Nt(b)&&b||y}},l=0,u,c,d,p,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f],y=y==null?void 0:y[f]),c=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=c||d||p,u=c&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(h=i==null?void 0:i.drawSizes)==null?void 0:h[n],v=i;f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f]),c=s(g,e).value,p=s(v,e).value,l=c||p,u=c?g.requireWin:v==null?void 0:v.requireWin}else Nt(i)&&f===void 0&&(l=i);return e&&((m=r==null?void 0:r.pct)!=null&&m[e])&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:u}}function aOe({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var v;if(!i)return{error:Fe};let{policyDefinitions:r}=Kp({policyTypes:[nR],tournamentRecord:i}),a=(e==null?void 0:e[nR])??(r==null?void 0:r[nR]);if(!a)return{error:MA};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:u,derivedEventInfo:c,derivedDrawInfo:d,mappedMatchUps:p}=Bn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=u==null?void 0:u.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),h={},m={},g={};for(let y of f??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:P,eventId:E}=S,D=c[E],R=d[U],N=R==null?void 0:R.drawType,{category:M,eventType:A}=D||{},_=S.startDate||D.startDate||i.startDate,k=S.endDate||D.endDate||i.endDate;if(A===Xs&&I!==zs)continue;let B;if(o){let F=l,x=0,$=0,j=0,V;for(let H of P){let{finishingPositionRange:z,participationOrder:q,participantWon:W,flightNumber:Y,rankingStage:Z,winCount:X}=H;x+=X||0;let Q=R==null?void 0:R.drawSize,{awardProfile:ce}=rOe({awardProfiles:o,participation:H,eventType:A,startDate:_,category:M,drawSize:Q,drawType:N,endDate:k,level:n});if(ce){if(!Q)continue;let J=Array.isArray(z)&&Math.max(...z),ee=Vt(z||[]).join("-"),ne=J&&Z!==gt&&(z==null?void 0:z.includes(Q));ce.requireWinForPoints!==void 0&&(F=ce.requireWinForPoints),ce.requireWinFirstRound!==void 0&&(s=ce.requireWinFirstRound);let{finishingPositionPoints:ie={},finishingPositionRanges:oe,finishingRound:se,pointsPerWin:pe,flights:fe}=ce,ge=Array.isArray(ce.perWinPoints)?(v=ce.perWinPoints)==null?void 0:v.find(Pe=>{var et;return(et=Pe.participationOrders)==null?void 0:et.includes(q)}):ce.perWinPoints,me=ie.participationOrders,Ee=0,Be;if((!me||me.includes(q))&&oe&&J){let Pe=oe[J];Pe&&({awardPoints:Ee,requireWin:Be}=U9({flightNumber:Y,valueObj:Pe,drawSize:Q,flights:fe,level:n}))}if(!Ee&&se&&q===1&&J){let Pe=se[J];Pe&&({awardPoints:Ee,requireWin:Be}=U9({participantWon:W,flightNumber:Y,valueObj:Pe,drawSize:Q,flights:fe,level:n}))}if(ne&&s!==void 0&&(F=s),Be!==void 0&&(F=Be),Ee>$&&(!F||X)&&($=Ee,V=J),!Ee&&pe&&X&&(j+=X*pe,V=ee),!Ee&&X&&ge){let Pe=pue(n,ge==null?void 0:ge.level);Pe?j+=X*Pe:ge.value&&(j+=X*ge.value)}}if(B=$+j,b===zs){let J=(y.matchUps||[]).filter(({structureId:ee})=>ee===H.structureId);for(let{matchUpId:ee}of J){let ne=p[ee],ie=ne.sides.find(oe=>oe.participantId===I).sideNumber;if(ne.winningSice===ie)for(let oe of ne.tieMatchUps)oe.winningSide}}}if(j||$){let H={winCount:x,positionPoints:$,rangeAccessor:V,perWinPoints:j,eventType:A,drawId:U,points:B},z=T==null?void 0:T.personId;z?(h[z]||(h[z]=[]),h[z].push(H)):b===Ot?(g[I]||(g[I]=[]),g[I].push(H)):b===zs&&(m[I]||(m[I]=[]),m[I].push(H))}}}}return{participantsWithOutcomes:f,personPoints:h,pairPoints:g,teamPoints:m,...re}}var oOe={getTournamentPoints:aOe},sOe=oOe,lOe={calculateNewRatings:Dre,generateDynamicRatings:Pre},uOe=lOe,cOe={...sOe,...uOe};ZD.importMethods(cOe);var dOe=ZD,pOe={[cU]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},fOe={[yp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Uv,ET]}},hOe={[yp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Uv,TU,ty],disabledActions:[]}]}},mOe={[yp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},gOe={[I0]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},vOe={[Js]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:kl,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[it]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Ro]:[],[Nc]:[],[ai]:[],[Qs]:[],[ta]:[],[yi]:[]}}},LL="Personal circumstance",yOe={[Js]:{requireAllPositionsAssigned:!1,stage:{[it]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:kl,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:kl,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Ro]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Nc]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Qs]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[ai]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[yi]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:LL,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[ta]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:LL,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[Sd]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:LL,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},bOe={[Ul]:{seedingProfile:{positioning:JA},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},IOe={POLICY_AVOIDANCE_COUNTRY:pOe,POLICY_POSITION_ACTIONS_DEFAULT:sre,POLICY_POSITION_ACTIONS_DISABLED:mOe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:hOe,POLICY_POSITION_ACTIONS_UNRESTRICTED:fOe,POLICY_PRIVACY_DEFAULT:gOe,POLICY_ROUND_NAMING_DEFAULT:DG,POLICY_SCHEDULING_DEFAULT:woe,POLICY_SCORING_DEFAULT:vOe,POLICY_SCORING_USTA:yOe,POLICY_SEEDING_ITF:bOe,POLICY_SEEDING_DEFAULT:ooe},pw={ratingsParameters:Cr,matchUpFormats:URe,countryToFlag:Wte,tieFormats:qoe,countries:Hf,policies:IOe,flagIOC:OPe},ao={};Kt(ao,{activeMatchUpStatuses:()=>XA,auditConstants:()=>xoe,completedMatchUpStatuses:()=>dr,directingMatchUpStatuses:()=>$j,drawDefinitionConstants:()=>rr,entryStatusConstants:()=>Ql,errorConditionConstants:()=>jee,eventConstants:()=>ko,extensionConstants:()=>Xv,flightConstants:()=>Yoe,genderConstants:()=>kc,keyValueConstants:()=>EH,matchUpActionConstants:()=>vH,matchUpStatusConstants:()=>Gj,matchUpTypes:()=>zte,nonDirectingMatchUpStatuses:()=>Vj,particicipantsRequiredMatchUpStatuses:()=>Fj,participantConstants:()=>Ra,participantRoles:()=>_h,participantTypes:()=>MI,penaltyConstants:()=>fue,policyConstants:()=>yg,positionActionConstants:()=>ib,ratingConstants:()=>kne,recoveryTimeRequiredMatchUpStatuses:()=>Rte,requestConstants:()=>Ese,resourceContants:()=>ste,resultConstants:()=>xQ,scaleConstants:()=>v0,scheduleConstants:()=>bie,sortingConstants:()=>Xoe,surfaceConstants:()=>hue,tieFormatConstants:()=>Qae,timeItemConstants:()=>s_,topicConstants:()=>jte,tournamentConstants:()=>c3,upcomingMatchUpStatuses:()=>jj,validMatchUpStatuses:()=>Bj,venueConstants:()=>mue});var wOe="Coaching",SOe="Ball Abuse",TOe="Racket Abuse",UOe="Verbal Abuse",DOe="INELIGIBILITY",POe="Physical Abuse",EOe="Unsportmanlike Conduct",COe="Dress Code Violation",ROe="Equipment Violation",MOe="Leaving the court",NOe="Failure to complete",AOe="No Show",_Oe="Other",kOe="REFUSAL_TO_PLAY",OOe="PROHIBITED_SUBSTANCE",xOe="Puncuality",LOe="Failure to sign in",fue={COACHING:wOe,BALL_ABUSE:SOe,RACKET_ABUSE:TOe,VERBAL_ABUSE:UOe,PHYSICAL_ABUSE:POe,INELIGIBILITY:DOe,UNSPORTSMANLIKE_CONDUCT:EOe,PROHIBITED_SUBSTANCE:OOe,DRESS_CODE_VIOLATION:COe,EQUIMENT_VIOLATION:ROe,LEAVING_THE_COURT:MOe,REFUSAL_TO_PLAY:kOe,FAILURE_TO_COMPLETE:NOe,NO_SHOW:AOe,OTHER:_Oe,PUNCTUALITY:xOe,FAILUIRE_TO_SIGN_IN:LOe},FOe="CLAY",BOe="HARD",$Oe="GRASS",VOe="CARPET",jOe="ARTIFICIAL",hue={CLAY:FOe,HARD:BOe,GRASS:$Oe,CARPET:VOe,ARTIFICIAL:jOe},GOe="INDOOR",HOe="OUTDOOR",mue={INDOOR:GOe,OUTDOOR:HOe};const aB=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:XA,askEngine:Jke,asyncEngine:Zke,auditConstants:xoe,competitionEngine:Mg,competitionGovernor:kV,completedMatchUpStatuses:dr,directingMatchUpStatuses:$j,drawDefinitionConstants:rr,drawsGovernor:kj,entriesGovernor:fz,entryStatusConstants:Ql,errorConditionConstants:jee,eventConstants:ko,eventGovernor:gz,extensionConstants:Xv,factoryConstants:ao,fixtures:pw,flightConstants:Yoe,forge:Vke,genderConstants:kc,generationGovernor:Dz,globalState:RI,governors:EA,keyValueConstants:EH,matchUpActionConstants:vH,matchUpEngine:nOe,matchUpFormatCode:Ep,matchUpFormatGovernor:Ep,matchUpGovernor:Cz,matchUpStatusConstants:Gj,matchUpTypes:zte,mocksEngine:XD,mocksGovernor:fk,nonDirectingMatchUpStatuses:Vj,particicipantsRequiredMatchUpStatuses:Fj,participantConstants:Ra,participantGovernor:e3,participantRoles:_h,participantTypes:MI,penaltyConstants:fue,policyConstants:yg,policyGovernor:xH,positionActionConstants:ib,publishingGovernor:bk,queryGovernor:_D,ratingConstants:kne,recoveryTimeRequiredMatchUpStatuses:Rte,reportGovernor:i3,requestConstants:Ese,resourceContants:ste,resultConstants:xQ,scaleConstants:v0,scaleEngine:dOe,scheduleConstants:bie,scheduleGovernor:n3,scoreGovernor:Mm,sortingConstants:Xoe,surfaceConstants:hue,syncEngine:due,tieFormatConstants:Qae,tieFormatGovernor:a3,timeItemConstants:s_,tools:Wt,topicConstants:jte,tournamentConstants:c3,tournamentEngine:$e,tournamentGovernor:u3,upcomingMatchUpStatuses:jj,utilities:Wt,validMatchUpStatuses:Bj,venueConstants:mue,venueGovernor:d3,version:s0},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:gue,FOLLOWED_BY:vue,NEXT_AVAILABLE:yue,NOT_BEFORE:bue,TO_BE_ANNOUNCED:Iue}=ao.timeItemConstants,{SCHEDULE_ERROR:zOe,SCHEDULE_CONFLICT:qOe,SCHEDULE_WARNING:WOe}=ao.scheduleConstants,{ORGANISER_ACCEPTANCE:KOe,DIRECT_ACCEPTANCE:YOe,SPECIAL_EXEMPT:ZOe,JUNIOR_EXEMPT:XOe,ALTERNATE:JOe,WILDCARD:QOe}=Ql,wue="All statuses",exe="All genders",b3="All flights",D9="All rounds",oh="All events",Sue="All teams",Tue="All Types",Uue="registration",txe="timepicker",ixe="timevalue",BM="tmxContent",Due="tmxDrawer",Uk="navbar",NU="splash",Dk="superadmin",nxe="admin",$M="competitionEngine",FL="tournamentEngine",Cp="tournaments",Pue="drawEntries",Ia="tournament",oB="structure",Eue="invite",sv="event",oT="draw",sB="view",AU="tournamentEvents",H0="overview",Rp="participants",ry="schedule",I3="matchUps",Yc="events",w3="venues",rxe="unscheduled",JD={success:!0},axe=10,Cue="ISSUE",Ns="Automated",S3="Manual",Rue={[zOe]:"matchup-error",[qOe]:"matchup-conflict",[Cue]:"matchup-issue",[WOe]:"matchup-warning"},VM="tournamentParticipants",Mue="scheduledDateFilter",Rv="unscheduledMatchUps",Pk="tournamentsCalendar",jM="tournamentMatchUps",GM="tournamentSchedule",lB="tournamentsTable",HM="tournamentTeams",zM="venuesTable",Nue="entriesCount",Aue="eventsTable",_U="tmxOverlay",T3="teamStats",U3="drawControl",oxe="drawFrame",_ue="drawRight",kue="drawLeft",Oue="entriesView",Ud="drawsView",QD="QUALIFYING",vu="ACCEPTED",xue="eventInfo",D3="acceptedPanel",P3="alternatesPanel",E3="qualifyingPanel",C3="ungroupedPanel",R3="withdrawaPanel",Lue="unscheduledVisibility",Fue="tournamentsControl",M3="participantControl",N3="unscheduledControl",A3="scheduleControl",_3="matchUpsControl",k3="venuesControl",O3="eventsControl",eP="eventControl",x3="teamsControl",sxe="controlBar",Bue="buttonBar",cv="tmxPanel",$ue="tmxTable",Vue="tcContainer",gr="overlay",Et="center",qM="header",mt="right",Ct="left",tf="bottom",P9="top",Ek="subTable",fw="",lC="flex",lt="none",jue="isOpen",L3="Collection value",F3="Match value",B3="Score value",$3="Set value",BS={[gue]:"After rest",[vue]:"Followed by",[Iue]:"To be announced",[yue]:"Next available",[bue]:"Not before"},lxe={[gue]:"After rest",[vue]:"Followed by",[Iue]:"TBA",[yue]:"Next available",[bue]:"NB"},Gue={[KOe]:"OA",[YOe]:"DA",[ZOe]:"SE",[XOe]:"JE",[QD]:"QUAL",[JOe]:"ALT",[QOe]:"WC"},WM="Playoff",gm="drawSize",KM="CUSTOM",fI="advancePerGroup",YM="qualifiersCount",ZM="groupRemaining",V3="matchUpFormat",kU="structureName",RT="playoffType",ip="groupSize",Hue="positions",ay="drawName",Xc="drawType",MT="top",uxe="winners",uB="roundsColumns",hw="roundsStats",mw="roundsTable",oy="utr",OU="wtn",NT={},cxe={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},dxe=(t,e,i,n,r)=>{const a=t.split("-"),o=a.includes(Ct)&&`left:${n}`,s=a.includes(mt)&&`right:${r}`,l=a.includes("top")&&`top:${e}`,u=a.includes("bottom")&&`bottom:${i}`,c="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||Et),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||Et);return[o,s,l,u,c,d].filter(Boolean).join(";")};function pxe(t){if(NT.position)return NT.position;const e=document.createElement("div");return e.style="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+dxe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),NT.position=e,e}function fxe(t){if(!t.message)return{error:"Missing message"};const e={...cxe,...t},i=pxe(e),n=hxe(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function hxe(t){var l,u;const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&x1e(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),(l=t==null?void 0:t.animate)!=null&&l.in){const c=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",d=`animate__${t.animate.in}`;n.push(`animate__animated ${d} ${c}`),s(()=>e.classList.remove(d))}if(e.className=n.join(" "),t.dismissible){const c=document.createElement("button");c.className="delete",c.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",c)}const r=document.createElement("div");if(r.style="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&(console.log(" MESSAGE ",t.message,typeof t.messsage),r.appendChild(t.message)),rt((u=t.action)==null?void 0:u.onClick)){const c=document.createElement("button");c.style="margin-left: 1em;",c.className="button",c.innerHTML=t.action.text||"OK",c.addEventListener("click",t.action.onClick),r.appendChild(c)}return e.appendChild(r),{element:e};function a(c){var d;rt(c)&&c(),(d=t==null?void 0:t.animate)!=null&&d.out?(e.classList.add(`animate__${t.animate.out}`),s(()=>{o(e.parentNode),delete NT.position,e.remove()})):(o(e.parentNode),delete NT.position,e.remove())}function o(c){c&&c.children.length<=1&&c.remove()}function s(c=()=>{}){const d={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const p in d)if(e.style[p]!==void 0){e.addEventListener(d[p],()=>c());break}}}function Mt(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:a=!0,duration:o=2500,single:s=!0,onClose:l,offsetBottom:u=0,offsetRight:c=0,offsetLeft:d=0,offsetTop:p=0,opacity:f=1,message:h,action:m}=t??{};fxe({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:u,type:i,offsetRight:c,dismissible:r,offsetLeft:d,clickClose:a,offsetTop:p,duration:o,position:e,message:h,onClose:l,opacity:f,action:m,single:s})}function mxe(){Mt({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function gxe(){let t=`${Lr.tr("phrases.blocked")}. ${Lr.tr("phrases.enablepopups")}`;return Mt({intent:"is-danger",message:t})}function vxe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${H0} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function yxe(){const t=document.createElement("nav");return t.className="navbar is-transparent",t.ariaLabel="main navigation",t.style.display=lt,t.style.width="100%",t.role="navigation",t.id=Uk,t.innerHTML=`
    <div class="navbar-brand">
      <div class="navbar-item" id="provider">TMX</div>
      <div class="navbar-item" id="pageTitle">
      </div>
      <a
        data-target="navbar-basic"
        class="navbar-burger"
        aria-expanded="false"
        aria-label="menu"
        role="button"
        id="burger"
      >
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" style="font-size: 2em">
          <i id="config" class="fa-solid fa-sliders"></i>
        </div>
        <div class="navbar-item" style="font-size: 2.5em">
          <i id="login" class="fa-solid fa-circle-user"></i>
        </div>
      </div>
    </div>
  `,t}function bxe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${xue} class="block" style='display: none; width: 100%;'}>
        <div id=${eP} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${Aue}>
        <div id=${O3} class="controlBar"></div>
        <div id=${AU} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${Oue} style='display: none;'}>
        <div id=${D3} class='tableClass block ${cv}'>
          {' '}
        </div>
        <div id=${E3} class='tableClass block ${cv}'>
          {' '}
        </div>
        <div id=${P3} class='tableClass block ${cv}'>
          {' '}
        </div>
        <div id=${C3} class='tableClass block ${cv}'>
          {' '}
        </div>
        <div id=${R3} class='tableClass block ${cv}'>
          {' '}
        </div>
      </div>
      <div style="background-color: white; width: 100%; margin: 0">
        <div id=${U3}></div>
        <div id=${oxe} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${kue} ></div>
          <div
            id=${Ud}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${_ue} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const Ixe=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function wxe(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=Ixe,t}function Sxe(){const t=document.getElementById("root"),e=document.createElement("div");e.className="flexrow flexcenter",e.id=NU,e.style="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(wxe()),t.appendChild(e);const i=document.createElement("div");i.style.display=lt,i.id=txe;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=ixe,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=Due,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const a=document.createElement("div");a.className="main noselect",a.appendChild(yxe());const o=document.createElement("div");o.id=BM,o.className="springboard flexrow flexcenter",o.style.display=lt;const s=document.createElement("div");s.id="sideNav",s.className="sideNav",o.appendChild(s);const l=document.createElement("div");l.id=Vue,l.className="flexcol flexcenter tournament_container",l.appendChild(vxe()),l.appendChild(bxe()),o.appendChild(l),a.appendChild(o);const u=document.createElement("div");u.className="flexcol flexgrow",u.style.paddingTop="3em",u.style.display=lt,u.id=Cp;const c=document.createElement("div");c.className="controlBar flexcol flexgrow flexcenter",c.id=Fue,u.appendChild(c);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=lB,u.appendChild(d),a.appendChild(u);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=lt,p.style.height="90%",p.style.width="100%",p.id=Pk,a.appendChild(p),t.appendChild(a),t}window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);function Txe(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function Oa(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const hR={[H0]:"o-tab",[Rp]:"p-tab",[Yc]:"e-tab",[I3]:"m-tab",[ry]:"s-tab",[w3]:"v-tab"};function Uxe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${M3}' class='controlBar'></div>
            <div id='${VM}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${x3}' class='controlBar'></div>
              <div id='${HM}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${Lue}' style='width: 100%; display: none;'>
                  <div id='${N3}' class='controlBar flexcol flexcenter'></div>
                  <div id='${Rv}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${A3}' class='controlBar flexcol flexcenter'></div>
                  <div id='${GM}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${k3}' class='controlBar'></div>
              <div id='${zM}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${_3}' class='controlBar'></div>
              <div id='${T3}' class='controlBar'></div>
              <div id='${jM}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},a=document.getElementById(Vue);Object.keys(r).forEach(o=>{const s=document.createElement("div");s.class="is-marginless",s.style="width: inherit",s.id=o,s.innerHTML=r[o],a.appendChild(s)}),zue(Rp)}function zue(t){return Object.keys(hR).includes(t)?(Object.keys(hR).forEach(e=>{const i=hR[e],n=document.getElementById(i);n?n.style.display=t===e?"":lt:console.log({key:e,id:i,element:n})}),{...JD}):!1}function Dxe(){[Ud,O3,_3,M3,N3,eP,x3,A3,k3,T3,D3,P3,E3,C3,R3,AU,jM,VM,GM,HM,Rv,zM].forEach(e=>{const i=hR[e],n=document.getElementById(i);n&&Oa(n)})}function que(){return"tmxToken"}function Wue(t,e){return function(){return t.apply(e,arguments)}}const{toString:Pxe}=Object.prototype,{getPrototypeOf:j3}=Object,Ck=(t=>e=>{const i=Pxe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),nf=t=>(t=t.toLowerCase(),e=>Ck(e)===t),Rk=t=>e=>typeof e===t,{isArray:z0}=Array,xU=Rk("undefined");function Exe(t){return t!==null&&!xU(t)&&t.constructor!==null&&!xU(t.constructor)&&sc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Kue=nf("ArrayBuffer");function Cxe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Kue(t.buffer),e}const Rxe=Rk("string"),sc=Rk("function"),Yue=Rk("number"),Mk=t=>t!==null&&typeof t=="object",Mxe=t=>t===!0||t===!1,mR=t=>{if(Ck(t)!=="object")return!1;const e=j3(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Nxe=nf("Date"),Axe=nf("File"),_xe=nf("Blob"),kxe=nf("FileList"),Oxe=t=>Mk(t)&&sc(t.pipe),xxe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||sc(t.append)&&((e=Ck(t))==="formdata"||e==="object"&&sc(t.toString)&&t.toString()==="[object FormData]"))},Lxe=nf("URLSearchParams"),Fxe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function tP(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),z0(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(n=0;n<o;n++)s=a[n],e.call(null,t[s],s,t)}}function Zue(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const Xue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Jue=t=>!xU(t)&&t!==Xue;function cB(){const{caseless:t}=Jue(this)&&this||{},e={},i=(n,r)=>{const a=t&&Zue(e,r)||r;mR(e[a])&&mR(n)?e[a]=cB(e[a],n):mR(n)?e[a]=cB({},n):z0(n)?e[a]=n.slice():e[a]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&tP(arguments[n],i);return e}const Bxe=(t,e,i,{allOwnKeys:n}={})=>(tP(e,(r,a)=>{i&&sc(r)?t[a]=Wue(r,i):t[a]=r},{allOwnKeys:n}),t),$xe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Vxe=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},jxe=(t,e,i,n)=>{let r,a,o;const s={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)o=r[a],(!n||n(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&j3(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Gxe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},Hxe=t=>{if(!t)return null;if(z0(t))return t;let e=t.length;if(!Yue(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},zxe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&j3(Uint8Array)),qxe=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(t,a[0],a[1])}},Wxe=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},Kxe=nf("HTMLFormElement"),Yxe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),E9=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),Zxe=nf("RegExp"),Que=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};tP(i,(r,a)=>{let o;(o=e(r,a,t))!==!1&&(n[a]=o||r)}),Object.defineProperties(t,n)},Xxe=t=>{Que(t,(e,i)=>{if(sc(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(sc(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},Jxe=(t,e)=>{const i={},n=r=>{r.forEach(a=>{i[a]=!0})};return z0(t)?n(t):n(String(t).split(e)),i},Qxe=()=>{},eLe=(t,e)=>(t=+t,Number.isFinite(t)?t:e),BL="abcdefghijklmnopqrstuvwxyz",C9="0123456789",ece={DIGIT:C9,ALPHA:BL,ALPHA_DIGIT:BL+BL.toUpperCase()+C9},tLe=(t=16,e=ece.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i};function iLe(t){return!!(t&&sc(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const nLe=t=>{const e=new Array(10),i=(n,r)=>{if(Mk(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const a=z0(n)?[]:{};return tP(n,(o,s)=>{const l=i(o,r+1);!xU(l)&&(a[s]=l)}),e[r]=void 0,a}}return n};return i(t,0)},rLe=nf("AsyncFunction"),aLe=t=>t&&(Mk(t)||sc(t))&&sc(t.then)&&sc(t.catch),He={isArray:z0,isArrayBuffer:Kue,isBuffer:Exe,isFormData:xxe,isArrayBufferView:Cxe,isString:Rxe,isNumber:Yue,isBoolean:Mxe,isObject:Mk,isPlainObject:mR,isUndefined:xU,isDate:Nxe,isFile:Axe,isBlob:_xe,isRegExp:Zxe,isFunction:sc,isStream:Oxe,isURLSearchParams:Lxe,isTypedArray:zxe,isFileList:kxe,forEach:tP,merge:cB,extend:Bxe,trim:Fxe,stripBOM:$xe,inherits:Vxe,toFlatObject:jxe,kindOf:Ck,kindOfTest:nf,endsWith:Gxe,toArray:Hxe,forEachEntry:qxe,matchAll:Wxe,isHTMLForm:Kxe,hasOwnProperty:E9,hasOwnProp:E9,reduceDescriptors:Que,freezeMethods:Xxe,toObjectSet:Jxe,toCamelCase:Yxe,noop:Qxe,toFiniteNumber:eLe,findKey:Zue,global:Xue,isContextDefined:Jue,ALPHABET:ece,generateString:tLe,isSpecCompliantForm:iLe,toJSONObject:nLe,isAsyncFn:rLe,isThenable:aLe};function In(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}He.inherits(In,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:He.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const tce=In.prototype,ice={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ice[t]={value:t}});Object.defineProperties(In,ice);Object.defineProperty(tce,"isAxiosError",{value:!0});In.from=(t,e,i,n,r,a)=>{const o=Object.create(tce);return He.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),In.call(o,t.message,e,i,n,r),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const oLe=null;function dB(t){return He.isPlainObject(t)||He.isArray(t)}function nce(t){return He.endsWith(t,"[]")?t.slice(0,-2):t}function R9(t,e,i){return t?t.concat(e).map(function(r,a){return r=nce(r),!i&&a?"["+r+"]":r}).join(i?".":""):e}function sLe(t){return He.isArray(t)&&!t.some(dB)}const lLe=He.toFlatObject(He,{},null,function(e){return/^is[A-Z]/.test(e)});function Nk(t,e,i){if(!He.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=He.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!He.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||c,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&He.isSpecCompliantForm(e);if(!He.isFunction(r))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(He.isDate(h))return h.toISOString();if(!l&&He.isBlob(h))throw new In("Blob is not supported. Use a Buffer instead.");return He.isArrayBuffer(h)||He.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,m,g){let v=h;if(h&&!g&&typeof h=="object"){if(He.endsWith(m,"{}"))m=n?m:m.slice(0,-2),h=JSON.stringify(h);else if(He.isArray(h)&&sLe(h)||(He.isFileList(h)||He.endsWith(m,"[]"))&&(v=He.toArray(h)))return m=nce(m),v.forEach(function(b,I){!(He.isUndefined(b)||b===null)&&e.append(o===!0?R9([m],I,a):o===null?m:m+"[]",u(b))}),!1}return dB(h)?!0:(e.append(R9(g,m,a),u(h)),!1)}const d=[],p=Object.assign(lLe,{defaultVisitor:c,convertValue:u,isVisitable:dB});function f(h,m){if(!He.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(h),He.forEach(h,function(v,y){(!(He.isUndefined(v)||v===null)&&r.call(e,v,He.isString(y)?y.trim():y,m,p))===!0&&f(v,m?m.concat(y):[y])}),d.pop()}}if(!He.isObject(t))throw new TypeError("data must be an object");return f(t),e}function M9(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function G3(t,e){this._pairs=[],t&&Nk(t,this,e)}const rce=G3.prototype;rce.append=function(e,i){this._pairs.push([e,i])};rce.toString=function(e){const i=e?function(n){return e.call(this,n,M9)}:M9;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function uLe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ace(t,e,i){if(!e)return t;const n=i&&i.encode||uLe,r=i&&i.serialize;let a;if(r?a=r(e,i):a=He.isURLSearchParams(e)?e.toString():new G3(e,i).toString(n),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class N9{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){He.forEach(this.handlers,function(n){n!==null&&e(n)})}}const oce={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cLe=typeof URLSearchParams<"u"?URLSearchParams:G3,dLe=typeof FormData<"u"?FormData:null,pLe=typeof Blob<"u"?Blob:null,fLe={isBrowser:!0,classes:{URLSearchParams:cLe,FormData:dLe,Blob:pLe},protocols:["http","https","file","blob","url","data"]},sce=typeof window<"u"&&typeof document<"u",hLe=(t=>sce&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),mLe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",gLe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:sce,hasStandardBrowserEnv:hLe,hasStandardBrowserWebWorkerEnv:mLe},Symbol.toStringTag,{value:"Module"})),np={...gLe,...fLe};function vLe(t,e){return Nk(t,new np.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,a){return np.isNode&&He.isBuffer(i)?(this.append(n,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function yLe(t){return He.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function bLe(t){const e={},i=Object.keys(t);let n;const r=i.length;let a;for(n=0;n<r;n++)a=i[n],e[a]=t[a];return e}function lce(t){function e(i,n,r,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&He.isArray(r)?r.length:o,l?(He.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):((!r[o]||!He.isObject(r[o]))&&(r[o]=[]),e(i,n,r[o],a)&&He.isArray(r[o])&&(r[o]=bLe(r[o])),!s)}if(He.isFormData(t)&&He.isFunction(t.entries)){const i={};return He.forEachEntry(t,(n,r)=>{e(yLe(n),r,i,0)}),i}return null}function ILe(t,e,i){if(He.isString(t))try{return(e||JSON.parse)(t),He.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const H3={transitional:oce,adapter:["xhr","http"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,a=He.isObject(e);if(a&&He.isHTMLForm(e)&&(e=new FormData(e)),He.isFormData(e))return r?JSON.stringify(lce(e)):e;if(He.isArrayBuffer(e)||He.isBuffer(e)||He.isStream(e)||He.isFile(e)||He.isBlob(e))return e;if(He.isArrayBufferView(e))return e.buffer;if(He.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return vLe(e,this.formSerializer).toString();if((s=He.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Nk(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||r?(i.setContentType("application/json",!1),ILe(e)):e}],transformResponse:[function(e){const i=this.transitional||H3.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(e&&He.isString(e)&&(n&&!this.responseType||r)){const o=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?In.from(s,In.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:np.classes.FormData,Blob:np.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};He.forEach(["delete","get","head","post","put","patch"],t=>{H3.headers[t]={}});const z3=H3,wLe=He.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SLe=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),i=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!i||e[i]&&wLe[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},A9=Symbol("internals");function $S(t){return t&&String(t).trim().toLowerCase()}function gR(t){return t===!1||t==null?t:He.isArray(t)?t.map(gR):String(t)}function TLe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const ULe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function $L(t,e,i,n,r){if(He.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!He.isString(e)){if(He.isString(n))return e.indexOf(n)!==-1;if(He.isRegExp(n))return n.test(e)}}function DLe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function PLe(t,e){const i=He.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,a,o){return this[n].call(this,e,r,a,o)},configurable:!0})})}class Ak{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function a(s,l,u){const c=$S(l);if(!c)throw new Error("header name must be a non-empty string");const d=He.findKey(r,c);(!d||r[d]===void 0||u===!0||u===void 0&&r[d]!==!1)&&(r[d||l]=gR(s))}const o=(s,l)=>He.forEach(s,(u,c)=>a(u,c,l));return He.isPlainObject(e)||e instanceof this.constructor?o(e,i):He.isString(e)&&(e=e.trim())&&!ULe(e)?o(SLe(e),i):e!=null&&a(i,e,n),this}get(e,i){if(e=$S(e),e){const n=He.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return TLe(r);if(He.isFunction(i))return i.call(this,r,n);if(He.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=$S(e),e){const n=He.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||$L(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function a(o){if(o=$S(o),o){const s=He.findKey(n,o);s&&(!i||$L(n,n[s],s,i))&&(delete n[s],r=!0)}}return He.isArray(e)?e.forEach(a):a(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const a=i[n];(!e||$L(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const i=this,n={};return He.forEach(this,(r,a)=>{const o=He.findKey(n,a);if(o){i[o]=gR(r),delete i[a];return}const s=e?DLe(a):String(a).trim();s!==a&&delete i[a],i[s]=gR(r),n[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return He.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&He.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[A9]=this[A9]={accessors:{}}).accessors,r=this.prototype;function a(o){const s=$S(o);n[s]||(PLe(r,o),n[s]=!0)}return He.isArray(e)?e.forEach(a):a(e),this}}Ak.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);He.reduceDescriptors(Ak.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});He.freezeMethods(Ak);const qf=Ak;function VL(t,e){const i=this||z3,n=e||i,r=qf.from(n.headers);let a=n.data;return He.forEach(t,function(s){a=s.call(i,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function uce(t){return!!(t&&t.__CANCEL__)}function iP(t,e,i){In.call(this,t??"canceled",In.ERR_CANCELED,e,i),this.name="CanceledError"}He.inherits(iP,In,{__CANCEL__:!0});function ELe(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new In("Request failed with status code "+i.status,[In.ERR_BAD_REQUEST,In.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const CLe=np.hasStandardBrowserEnv?{write(t,e,i,n,r,a){const o=[t+"="+encodeURIComponent(e)];He.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),He.isString(n)&&o.push("path="+n),He.isString(r)&&o.push("domain="+r),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function RLe(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function MLe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function cce(t,e){return t&&!RLe(e)?MLe(t,e):e}const NLe=np.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let n;function r(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=r(window.location.href),function(o){const s=He.isString(o)?r(o):o;return s.protocol===n.protocol&&s.host===n.host}}():function(){return function(){return!0}}();function ALe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function _Le(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=n[a];o||(o=u),i[r]=l,n[r]=u;let d=a,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===a&&(a=(a+1)%t),u-o<e)return;const f=c&&u-c;return f?Math.round(p*1e3/f):void 0}}function _9(t,e){let i=0;const n=_Le(50,250);return r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,s=a-i,l=n(s),u=a<=o;i=a;const c={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:l||void 0,estimated:l&&o&&u?(o-a)/l:void 0,event:r};c[e?"download":"upload"]=!0,t(c)}}const kLe=typeof XMLHttpRequest<"u",OLe=kLe&&function(t){return new Promise(function(i,n){let r=t.data;const a=qf.from(t.headers).normalize();let{responseType:o,withXSRFToken:s}=t,l;function u(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let c;if(He.isFormData(r)){if(np.hasStandardBrowserEnv||np.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((c=a.getContentType())!==!1){const[m,...g]=c?c.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([m||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(m+":"+g))}const p=cce(t.baseURL,t.url);d.open(t.method.toUpperCase(),ace(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function f(){if(!d)return;const m=qf.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:m,config:t,request:d};ELe(function(b){i(b),u()},function(b){n(b),u()},v),d=null}if("onloadend"in d?d.onloadend=f:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(f)},d.onabort=function(){d&&(n(new In("Request aborted",In.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new In("Network Error",In.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||oce;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),n(new In(g,v.clarifyTimeoutError?In.ETIMEDOUT:In.ECONNABORTED,t,d)),d=null},np.hasStandardBrowserEnv&&(s&&He.isFunction(s)&&(s=s(t)),s||s!==!1&&NLe(p))){const m=t.xsrfHeaderName&&t.xsrfCookieName&&CLe.read(t.xsrfCookieName);m&&a.set(t.xsrfHeaderName,m)}r===void 0&&a.setContentType(null),"setRequestHeader"in d&&He.forEach(a.toJSON(),function(g,v){d.setRequestHeader(v,g)}),He.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),o&&o!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",_9(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",_9(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=m=>{d&&(n(!m||m.type?new iP(null,t,d):m),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const h=ALe(p);if(h&&np.protocols.indexOf(h)===-1){n(new In("Unsupported protocol "+h+":",In.ERR_BAD_REQUEST,t));return}d.send(r||null)})},pB={http:oLe,xhr:OLe};He.forEach(pB,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const k9=t=>`- ${t}`,xLe=t=>He.isFunction(t)||t===null||t===!1,dce={getAdapter:t=>{t=He.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let a=0;a<e;a++){i=t[a];let o;if(n=i,!xLe(i)&&(n=pB[(o=String(i)).toLowerCase()],n===void 0))throw new In(`Unknown adapter '${o}'`);if(n)break;r[o||"#"+a]=n}if(!n){const a=Object.entries(r).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(k9).join(`
`):" "+k9(a[0]):"as no adapter specified";throw new In("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:pB};function jL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new iP(null,t)}function O9(t){return jL(t),t.headers=qf.from(t.headers),t.data=VL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),dce.getAdapter(t.adapter||z3.adapter)(t).then(function(n){return jL(t),n.data=VL.call(t,t.transformResponse,n),n.headers=qf.from(n.headers),n},function(n){return uce(n)||(jL(t),n&&n.response&&(n.response.data=VL.call(t,t.transformResponse,n.response),n.response.headers=qf.from(n.response.headers))),Promise.reject(n)})}const x9=t=>t instanceof qf?{...t}:t;function gw(t,e){e=e||{};const i={};function n(u,c,d){return He.isPlainObject(u)&&He.isPlainObject(c)?He.merge.call({caseless:d},u,c):He.isPlainObject(c)?He.merge({},c):He.isArray(c)?c.slice():c}function r(u,c,d){if(He.isUndefined(c)){if(!He.isUndefined(u))return n(void 0,u,d)}else return n(u,c,d)}function a(u,c){if(!He.isUndefined(c))return n(void 0,c)}function o(u,c){if(He.isUndefined(c)){if(!He.isUndefined(u))return n(void 0,u)}else return n(void 0,c)}function s(u,c,d){if(d in e)return n(u,c);if(d in t)return n(void 0,u)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(u,c)=>r(x9(u),x9(c),!0)};return He.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||r,p=d(t[c],e[c],c);He.isUndefined(p)&&d!==s||(i[c]=p)}),i}const pce="1.6.8",q3={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{q3[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const L9={};q3.transitional=function(e,i,n){function r(a,o){return"[Axios v"+pce+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return(a,o,s)=>{if(e===!1)throw new In(r(o," has been removed"+(i?" in "+i:"")),In.ERR_DEPRECATED);return i&&!L9[o]&&(L9[o]=!0,console.warn(r(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function LLe(t,e,i){if(typeof t!="object")throw new In("options must be an object",In.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const a=n[r],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new In("option "+a+" must be "+l,In.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new In("Unknown option "+a,In.ERR_BAD_OPTION)}}const fB={assertOptions:LLe,validators:q3},rm=fB.validators;class XM{constructor(e){this.defaults=e,this.interceptors={request:new N9,response:new N9}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=gw(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:a}=i;n!==void 0&&fB.assertOptions(n,{silentJSONParsing:rm.transitional(rm.boolean),forcedJSONParsing:rm.transitional(rm.boolean),clarifyTimeoutError:rm.transitional(rm.boolean)},!1),r!=null&&(He.isFunction(r)?i.paramsSerializer={serialize:r}:fB.assertOptions(r,{encode:rm.function,serialize:rm.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&He.merge(a.common,a[i.method]);a&&He.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=qf.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,s.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,d=0,p;if(!l){const h=[O9.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,u),p=h.length,c=Promise.resolve(i);d<p;)c=c.then(h[d++],h[d++]);return c}p=s.length;let f=i;for(d=0;d<p;){const h=s[d++],m=s[d++];try{f=h(f)}catch(g){m.call(this,g);break}}try{c=O9.call(this,f)}catch(h){return Promise.reject(h)}for(d=0,p=u.length;d<p;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=gw(this.defaults,e);const i=cce(e.baseURL,e.url);return ace(i,e.params,e.paramsSerializer)}}He.forEach(["delete","get","head","options"],function(e){XM.prototype[e]=function(i,n){return this.request(gw(n||{},{method:e,url:i,data:(n||{}).data}))}});He.forEach(["post","put","patch"],function(e){function i(n){return function(a,o,s){return this.request(gw(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}XM.prototype[e]=i(),XM.prototype[e+"Form"]=i(!0)});const vR=XM;class W3{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const o=new Promise(s=>{n.subscribe(s),a=s}).then(r);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a,o,s){n.reason||(n.reason=new iP(a,o,s),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new W3(function(r){e=r}),cancel:e}}}const FLe=W3;function BLe(t){return function(i){return t.apply(null,i)}}function $Le(t){return He.isObject(t)&&t.isAxiosError===!0}const hB={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hB).forEach(([t,e])=>{hB[e]=t});const VLe=hB;function fce(t){const e=new vR(t),i=Wue(vR.prototype.request,e);return He.extend(i,vR.prototype,e,{allOwnKeys:!0}),He.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return fce(gw(t,r))},i}const Ja=fce(z3);Ja.Axios=vR;Ja.CanceledError=iP;Ja.CancelToken=FLe;Ja.isCancel=uce;Ja.VERSION=pce;Ja.toFormData=Nk;Ja.AxiosError=In;Ja.Cancel=Ja.CanceledError;Ja.all=function(e){return Promise.all(e)};Ja.spread=BLe;Ja.isAxiosError=$Le;Ja.mergeConfig=gw;Ja.AxiosHeaders=qf;Ja.formToJSON=t=>lce(He.isHTMLForm(t)?new FormData(t):t);Ja.getAdapter=dce.getAdapter;Ja.HttpStatusCode=VLe;Ja.default=Ja;const hce=que(),jLe="https://courthive.net",nP=Ja.create({baseURL:jLe});nP.interceptors.request.use(t=>{const e=localStorage.getItem(hce);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));nP.interceptors.response.use(t=>{var e;return(e=t.data)!=null&&e.error&&Mt({message:t.data.error,intent:"is-danger"}),t},t=>{var e;if(t.message==="Network Error"&&Mt({message:t.message,intent:"is-danger"}),t.response){((e=t.response)==null?void 0:e.status)===401&&mce();const i=t.response.data.message||t.response.data.error||t.response.data;Mt({message:i,intent:"is-danger"})}});const GLe=()=>{const t=localStorage.getItem(hce);nP.defaults.headers.common.Authorization=`Bearer ${t}`},mce=()=>{nP.defaults.headers.common.Authorization=void 0},Wu={...nP,addAuthorization:GLe,removeAuthorization:mce};async function _k({tournamentId:t}){return await Wu.post("/factory/fetch",{tournamentId:t})}async function HLe({provider:t}){return await Wu.post("/provider/add",t)}async function zLe({providerId:t}){return await Wu.post("/provider/detail",{providerId:t})}async function qLe({providerAbbr:t}){return await Wu.post("/provider/calendar",{providerAbbr:t})}async function JM(){return await Wu.post("/provider/allProviders",{})}async function WLe(){return await Wu.post("/auth/allusers",{})}async function KLe({email:t}){return await Wu.post("/auth/remove",{email:t})}async function K3({tournamentRecord:t}){return await Wu.post("/factory/save",{tournamentRecord:t})}async function YLe({providerId:t,tournamentId:e}){return await Wu.post("/factory/remove",{providerId:t,tournamentId:e})}function Y3(t){return t[t.length-1]}function rP(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function F9(t,e){return t?t.split(e):[]}function Z3(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function gce(t,e,i){return t<e?e:t>i?i:t}function vw(t,e,i={},n=0,r=""){const a=Object.keys(i).reduce((s,l)=>{let u=i[l];return typeof u=="function"&&(u=u(n)),`${s} ${l}="${u}"`},t);r+=`<${a}></${t}>`;const o=n+1;return o<e?vw(t,e,i,o,r):r}function X3(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function mB(t){return new Date(t).setHours(0,0,0,0)}function sb(){return new Date().setHours(0,0,0,0)}function yw(...t){switch(t.length){case 0:return sb();case 1:return mB(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function LU(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function ZLe(t,e){return LU(t,e*7)}function QM(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const a=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):a}function FU(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function B9(t,e){return(t-e+7)%7}function Mv(t,e,i=0){const n=new Date(t).getDay();return LU(t,B9(e,i)-B9(n,i))}function vce(t,e){return Math.round((t-e)/6048e5)+1}function XLe(t){const e=Mv(t,4,1),i=Mv(new Date(e).setMonth(0,4),4,1);return vce(e,i)}function yce(t,e){const i=Mv(new Date(t).setMonth(0,1),e,e),n=Mv(t,e,e),r=vce(n,i);if(r<53)return r;const a=Mv(new Date(t).setDate(32),e,e);return n===a?1:r}function JLe(t){return yce(t,0)}function QLe(t){return yce(t,6)}function Zb(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Nm(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const gB=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,eFe=/[\s!-/:-@[-`{-~]+/;let GL={};const $9={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const a=e.toLowerCase(),o=s=>s.toLowerCase().startsWith(a);if(r=i.monthsShort.findIndex(o),r<0&&(r=i.months.findIndex(o)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==bce(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},tFe={d(t){return t.getDate()},dd(t){return uC(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return uC(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return uC(t.getFullYear(),2).slice(-2)},yyyy(t){return uC(t.getFullYear(),4)}};function bce(t){return t>-1?t%12:bce(t+12)}function uC(t,e){return t.toString().padStart(e,"0")}function Ice(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in GL)return GL[t];const e=t.split(gB),i=t.match(new RegExp(gB,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(a=>tFe[a]),r=Object.keys($9).reduce((a,o)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===o)&&a.push(o),a),[]);return GL[t]={parser(a,o){const s=a.split(eFe).reduce((l,u,c)=>{if(u.length>0&&i[c]){const d=i[c][0];d==="M"?l.m=u:d!=="D"&&(l[d]=u)}return l},{});return r.reduce((l,u)=>{const c=$9[u](l,s[u],o);return isNaN(c)?l:c},sb())},formatter(a,o){let s=n.reduce((l,u,c)=>l+=`${e[c]}${u(a,o)}`,"");return s+=Y3(e)}}}function sy(t,e,i){if(t instanceof Date||typeof t=="number"){const n=mB(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return sb();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:mB(n)}return Ice(e).parser(t,i)}}function aP(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):Ice(e).formatter(n,i)}const iFe=document.createRange();function sh(t){return iFe.createContextualFragment(t)}function wce(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function kk(t){return t.getRootNode().activeElement===t}function AT(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function _T(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function eN(t){t.firstChild&&(t.removeChild(t.firstChild),eN(t))}function nFe(t,e){eN(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(sh(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const tN=new WeakMap,{addEventListener:rFe,removeEventListener:aFe}=EventTarget.prototype;function iN(t,e){let i=tN.get(t);i||(i=[],tN.set(t,i)),e.forEach(n=>{rFe.call(...n),i.push(n)})}function Sce(t){let e=tN.get(t);e&&(e.forEach(i=>{aFe.call(...i)}),tN.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function Tce(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return Tce(r,e,i)}function Uce(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return Tce(t.composedPath(),i,t.currentTarget)}const VS={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},J3={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"",orientation:"auto",pickLevel:0,prevArrow:"",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:HL,format:oFe,weekStart:sFe}=J3;function V9(t,e){return t.length<6&&e>=0&&e<7?rP(t,e):t}function Dce(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return XLe;case 2:return JLe;case 3:return QLe}}function j9(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Dce(4,t)),t}function G9(t,e,i,n){const r=sy(t,e,i);return r!==void 0?r:n}function zL(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function cC(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function qL(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:o,format:s,language:l,locale:u,maxDate:c,maxView:d,minDate:p,pickLevel:f,startView:h,weekNumbers:m,weekStart:g}=e.config||{};if(cC(i,"calendarWeeks","weekNumbers",w=>w?1:0),cC(i,"clearBtn","clearButton"),cC(i,"todayBtn","todayButton"),cC(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(r[i.language]?w=i.language:(w=i.language.split("-")[0],r[w]||(w=!1))),delete i.language,w){l=n.language=w;const S=u||r[HL];u=Object.assign({format:oFe,weekStart:sFe},r[HL]),l!==HL&&Object.assign(u,r[l]),n.locale=u,s===S.format&&(s=n.format=u.format),g===S.weekStart&&(g=j9(u.weekStart,n,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",U=gB.test(i.format);(w&&S||U)&&(s=n.format=i.format),delete i.format}let v=f;"pickLevel"in i&&(v=zL(i.pickLevel,f,2),delete i.pickLevel),v!==f&&(v>f&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=c)),o&&!i.datesDisabled&&(i.datesDisabled=[]),f=n.pickLevel=v);let y=p,b=c;if("minDate"in i){const w=yw(0,0,1);y=i.minDate===null?w:G9(i.minDate,s,u,y),y!==w&&(y=Nm(y,f,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:G9(i.maxDate,s,u,b),b!==void 0&&(b=Nm(b,f,!0)),delete i.maxDate),b<y?(p=n.minDate=b,c=n.maxDate=y):(p!==y&&(p=n.minDate=y),c!==b&&(c=n.maxDate=b)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")n.datesDisabled=null,n.checkDisabled=(S,U)=>w(new Date(S),U,a);else{const S=n.datesDisabled=w.reduce((U,P)=>{const E=sy(P,s,u);return E!==void 0?rP(U,Nm(E,f,a)):U},[]);n.checkDisabled=U=>S.includes(U)}delete i.datesDisabled}if("defaultViewDate"in i){const w=sy(i.defaultViewDate,s,u);w!==void 0&&(n.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(g=j9(w,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(V9,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(V9,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const S=typeof w=="function"?(U,P)=>w(new Date(U),P):Dce(w=parseInt(w,10),g);S&&(m=n.weekNumbers=w,n.getWeekNumber=S)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(n.maxNumberOfDates=w,n.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=zL(i.maxView,d),delete i.maxView),I=f>I?f:I,I!==d&&(d=n.maxView=I);let T=h;if("startView"in i&&(T=zL(i.startView,T),delete i.startView),T<f?T=f:T>d&&(T=d),T!==h&&(n.startView=T),i.prevArrow){const w=sh(i.prevArrow);w.childNodes.length>0&&(n.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=sh(i.nextArrow);w.childNodes.length>0&&(n.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:w.find(S=>S==="left"||S==="right")||"auto",y:w.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,S])=>{S!==void 0&&w in J3&&(n[w]=S)}),n}const H9={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function lFe(t){return Object.keys(H9).reduce((e,i)=>{const n=t[i]===void 0?H9[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const a={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(a.altKey=!!n.altKey,a.shiftKey=!!n.shiftKey),e[i]=a,e},{})}const z9=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),uFe=X3(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${z9(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${z9(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),cFe=X3(`<div class="days">
  <div class="days-of-week">${vw("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${vw("span",42)}</div>
</div>`),dFe=X3(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${vw("span",6,{class:"week"})}</div>
</div>`);let Q3=class{constructor(e,i){Object.assign(this,i,{picker:e,element:sh('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),rP(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const a=n.classes.split(/\s+/);r.add(...a),a.includes("disabled")&&this.setDisabled(i,r)}n.content&&nFe(e,n.content)}}renderCell(e,i,n,r,{selected:a,range:o},s,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const u=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?u.add("prev"):n>this.last&&u.add("next"),u.add(...l),(s||this.checkDisabled(r,this.id))&&this.setDisabled(r,u),o){const[c,d]=o;n>c&&n<d&&u.add("range"),n===c&&u.add("range-start"),n===d&&u.add("range-end")}a.includes(n)&&u.add("selected"),n===this.focused&&u.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,a]){const o=e.classList;o.remove("range","range-start","range-end","selected","focused"),i>r&&i<a&&o.add("range"),i===r&&o.add("range-start"),i===a&&o.add("range-end"),n.includes(i)&&o.add("selected"),i===this.focused&&o.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class pFe extends Q3{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=sh(cFe).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=sh(dFe).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(_T(this.dow),this.weekNumbers&&_T(this.weekNumbers.dow)):(AT(this.dow),this.weekNumbers&&AT(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const a=(this.weekStart+r)%7;n.textContent=this.dayNames[a],n.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=yw(i,n,1),a=Mv(r,this.weekStart,this.weekStart);this.first=r,this.last=yw(i,n+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?sb():void 0,this.prepareForRender(aP(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=Mv(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const a=ZLe(i,r);n.textContent=this.getWeekNumber(a,e),r>3&&n.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=LU(this.start,i),r=new Date(n),a=r.getDay(),o=[];this.today===n&&o.push("today"),this.daysOfWeekHighlighted.includes(a)&&o.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(a),o)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function q9(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,a]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?a:12]}class fFe extends Q3{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(sh(vw("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=yw(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const a=new Date(r),o=a.getFullYear(),s=a.getMonth();return n[o]===void 0?n[o]=[s]:rP(n[o],s),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,a=q9(this.range,this.year);Array.from(this.grid.children).forEach((o,s)=>{const l=Nm(new Date(this.year,s,1),1,this.isRangeEnd);this.renderCell(o,this.monthNames[s],s,l,{selected:e,range:a},i||n&&s<this.minMonth||r&&s>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=q9(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function hFe(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class W9 extends Q3{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${hFe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(sh(vw("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=Zb(e.minDate,this.step),this.minDate=yw(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=Zb(e.maxDate,this.step),this.maxDate=yw(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=Zb(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=Zb(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>rP(n,Zb(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return Zb(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=Nm(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function hI(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function nN(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:a}=n;let o;switch(r.id){case 0:o=QM(a,e);break;case 1:o=FU(a,e);break;default:o=FU(a,e*r.navStep)}o=gce(o,i.minDate,i.maxDate),n.changeFocus(o).render()}function Pce(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function Ece(t){t.setDate({clear:!0})}function Cce(t){const e=sb();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function Rce(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;kk(i)?i.addEventListener("blur",e,{once:!0}):e()}function K9(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,a=r===1?QM(n,e-n.getMonth()):FU(n,e-n.getFullYear());i.changeFocus(a).changeView(r-1).render()}function mFe(t){Pce(t)}function gFe(t){nN(t,-1)}function vFe(t){nN(t,1)}function yFe(t,e){const i=Uce(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,a=i.dataset;r?t.setDate(Number(a.date)):n===1?K9(t,Number(a.month)):K9(t,Number(a.year))}function bFe(t){t.preventDefault()}const WL=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),Y9=t=>t&&`${t}px`;function Z9(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,_T(t.controls.title)):(t.controls.title.textContent="",AT(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;eN(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;eN(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?_T(t.controls.todayButton):AT(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!Z3(sb(),i,n)}"clearButton"in e&&(e.clearButton?_T(t.controls.clearButton):AT(t.controls.clearButton))}function X9(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?Y3(e):Nm(i.defaultViewDate,i.pickLevel,n);return gce(r,i.minDate,i.maxDate)}function J9(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:a}=t.currentView,o=new Date(e).getFullYear();switch(i){case 0:return e<r||e>a;case 1:return o!==n;default:return o<r||o>a}}function KL(t){return window.getComputedStyle(t).direction}function Mce(t){const e=wce(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:Mce(e)}class IFe{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=uFe.replace(/%buttonClass%/g,i.buttonClass),a=this.element=sh(r).firstChild,[o,s,l]=a.firstChild.children,u=o.firstElementChild,[c,d,p]=o.lastElementChild.children,[f,h]=l.firstChild.children,m={title:u,prevButton:c,viewSwitch:d,nextButton:p,todayButton:f,clearButton:h};this.main=s,this.controls=m;const g=n?"dropdown":"inline";a.classList.add(`datepicker-${g}`),Z9(this,i),this.viewDate=X9(e),iN(e,[[a,"mousedown",bFe],[s,"click",yFe.bind(null,e)],[m.viewSwitch,"click",mFe.bind(null,e)],[m.prevButton,"click",gFe.bind(null,e)],[m.nextButton,"click",vFe.bind(null,e)],[m.todayButton,"click",Cce.bind(null,e)],[m.clearButton,"click",Ece.bind(null,e)]]),this.views=[new pFe(this),new fFe(this),new W9(this,{id:2,name:"years",cellClass:"year",step:1}),new W9(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){Z9(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=KL(n);r!==KL(wce(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,hI(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,hI(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:o,inputField:s}=this.datepicker,{left:l,top:u,right:c,bottom:d,width:p,height:f}=s.getBoundingClientRect();let{x:h,y:m}=o.orientation,g=l,v=u;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const U=a.getBoundingClientRect();g-=U.left-a.scrollLeft,v-=U.top-a.scrollTop}const y=Mce(s);let b=0,I=0,{clientWidth:T,clientHeight:w}=document.documentElement;if(y){const U=y.getBoundingClientRect();U.top>0&&(I=U.top),U.left>0&&(b=U.left),U.right<T&&(T=U.right),U.bottom<w&&(w=U.bottom)}let S=0;h==="auto"&&(l<b?(h="left",S=b-l):l+n>T?(h="right",T<c&&(S=T-c)):KL(s)==="rtl"?h=c-n<b?"left":"right":h="left"),h==="right"&&(g+=p-n),g+=S,m==="auto"&&(u-r>I?m=d+r>w?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=f,e.remove(...Object.values(WL)),e.add(WL[h],WL[m]),i.left=Y9(g),i.top=Y9(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=J9(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?X9(this.datepicker):e;return this._renderMethod=J9(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,a=new Date(this._oldViewDate),o=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[o](),r&&(this.main.replaceChild(i.element,r.element),hI(n,"changeView")),!isNaN(a)){const s=new Date(this.viewDate);s.getFullYear()!==a.getFullYear()&&hI(n,"changeYear"),s.getMonth()!==a.getMonth()&&hI(n,"changeMonth")}}}function Nce(t,e,i,n,r,a){if(Z3(t,r,a)){if(n(t)){const o=e(t,i);return Nce(o,e,i,n,r,a)}return t}}function wFe(t,e,i){const n=t.picker,r=n.currentView,a=r.step||1;let o=n.viewDate,s;switch(r.id){case 0:o=LU(o,i?e*7:e),s=LU;break;case 1:o=QM(o,i?e*4:e),s=QM;break;default:o=FU(o,e*(i?4:1)*a),s=FU}o=Nce(o,s,e<0?-a:a,l=>r.disabled.includes(l),r.minDate,r.maxDate),o!==void 0&&n.changeFocus(o).render()}function SFe(t,e){const{config:i,picker:n,editMode:r}=t,a=n.active,{key:o,altKey:s,shiftKey:l}=e,u=e.ctrlKey||e.metaKey,c=()=>{e.preventDefault(),e.stopPropagation()};if(o==="Tab"){Rce(t);return}if(o==="Enter"){if(!a)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),c())}return}const d=i.shortcutKeys,p={key:o,ctrlOrMetaKey:u,altKey:s,shiftKey:l},f=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(f){let m;if(f==="toggle"?m=f:r?f==="exitEditMode"&&(m=f):a?f==="hide"?m=f:f==="prevButton"?m=[nN,[t,-1]]:f==="nextButton"?m=[nN,[t,1]]:f==="viewSwitch"?m=[Pce,[t]]:i.clearButton&&f==="clearButton"?m=[Ece,[t]]:i.todayButton&&f==="todayButton"&&(m=[Cce,[t]]):f==="show"&&(m=f),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),c();return}}if(!a||r)return;const h=(m,g)=>{l||u||s?t.enterEditMode():(wFe(t,m,g),e.preventDefault())};o==="ArrowLeft"?h(-1,!1):o==="ArrowRight"?h(1,!1):o==="ArrowUp"?h(-1,!0):o==="ArrowDown"?h(1,!0):(o==="Backspace"||o==="Delete"||o&&o.length===1&&!u)&&t.enterEditMode()}function TFe(t){t.config.showOnFocus&&!t._showing&&t.show()}function UFe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=kk(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function DFe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function PFe(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function EFe(t,e){const{element:i,picker:n}=t;if(!n.active&&!kk(i))return;const r=n.element;Uce(e,a=>a===i||a===r)||Rce(t)}function Ace(t,e){return t.map(i=>aP(i,e.format,e.locale)).join(e.dateDelimiter)}function _ce(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:a}=t,{pickLevel:o,maxNumberOfDates:s}=n;let l=e.reduce((u,c)=>{let d=sy(c,n.format,n.locale);return d===void 0||(d=Nm(d,o,a),Z3(d,n.minDate,n.maxDate)&&!u.includes(d)&&!n.checkDisabled(d,o)&&(o>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&u.push(d)),u},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((u,c)=>(r.includes(c)||u.push(c),u),r.filter(u=>!l.includes(u)))),s&&l.length>s?l.slice(s*-1):l}function rN(t,e=3,i=!0,n=void 0){const{config:r,picker:a,inputField:o}=t;if(e&2){const s=a.active?r.pickLevel:r.startView;a.update(n).changeView(s).render(i)}e&1&&o&&(o.value=Ace(t.dates,r))}function Q9(t,e,i){const n=t.config;let{clear:r,render:a,autohide:o,revert:s,forceRefresh:l,viewDate:u}=i;a===void 0&&(a=!0),a?o===void 0&&(o=n.autohide):o=l=!1,u=sy(u,n.format,n.locale);const c=_ce(t,e,r);!c&&!s||(c&&c.toString()!==t.dates.toString()?(t.dates=c,rN(t,a?3:1,!0,u),hI(t,"changeDate")):rN(t,l?3:1,!0,u),o&&t.hide())}function eK(t,e){return e?i=>aP(i,e,t.config.locale):i=>new Date(i)}class kce{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:sb(),maxDate:void 0,minDate:void 0},qL(J3,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const c=n.inputs.indexOf(a),d=n.datepickers;if(c<0||c>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[c]=this,this.rangepicker=n,this.rangeSideIndex=c}this._options=i,Object.assign(r,qL(i,this)),r.shortcutKeys=lFe(i.shortcutKeys||{});const o=F9(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const s=_ce(this,o);s&&s.length>0&&(this.dates=s),a&&(a.value=Ace(this.dates,r));const l=this.picker=new IFe(this),u=[e,"keydown",SFe.bind(null,this)];a?iN(this,[u,[a,"focus",TFe.bind(null,this)],[a,"mousedown",UFe.bind(null,this)],[a,"click",DFe.bind(null,this)],[a,"paste",PFe.bind(null,this)],[document,"mousedown",EFe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(iN(this,[u]),this.show())}static formatDate(e,i,n){return aP(e,i,n&&VS[n]||VS.en)}static parseDate(e,i,n){return sy(e,i,n&&VS[n]||VS.en)}static get locales(){return VS}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=qL(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),rN(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!kk(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),Sce(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=eK(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=Y3(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const a=Array.isArray(i[0])?i[0]:i;Q9(this,a,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=F9(this.inputField.value,this.config.dateDelimiter);Q9(this,n,i)}getFocusedDate(e=void 0){return eK(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:a,rangeSideIndex:o}=this,s=n.pickLevel,l=sy(e,n.format,n.locale);l!==void 0&&(r.changeFocus(Nm(l,s,o)),a&&i&&r.changeView(s),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,rN(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function tK(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function CFe(t,e,i,n){iN(t,[[i,"changeDate",e]]),new kce(i,n,t)}function jS(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,a]=n,o={render:!1},s=t.inputs.indexOf(i),l=s===0?1:0,u=n[s].dates[0],c=n[l].dates[0];u!==void 0&&c!==void 0?s===0&&u>c?(r.setDate(c,o),a.setDate(u,o)):s===1&&u<c&&(r.setDate(u,o),a.setDate(c,o)):t.allowOneSidedRange||(u!==void 0||c!==void 0)&&(o.clear=!0,n[l].setDate(n[s].dates,o)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class RFe{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=jS.bind(null,this),a=tK(i),o=this.datepickers=[];n.forEach(s=>{CFe(this,r,s,a)}),Object.freeze(o),Object.defineProperty(this,"dates",{get(){return o.map(s=>s.dates[0])}}),o[0].dates.length>0?jS(this,{target:n[0]}):o[1].dates.length>0&&jS(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=tK(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),Sce(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>aP(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[a,o],dates:[s,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?jS(this,{target:o}):n.dates[0]!==s&&jS(this,{target:a})}}var eq=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tq(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Oce={exports:{}};(function(t){(function(){var e=function(l,u){var c=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=u=u||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:u.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1},u),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:this.minChars!=0?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;c.opened&&(p===13&&c.selected?(d.preventDefault(),c.select(void 0,void 0,d)):p===9&&c.selected&&c.tabSelect?c.select(void 0,void 0,d):p===27?c.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),c[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),c.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||u.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var u=[];r.apply(l.children).forEach(function(c){if(!c.disabled){var d=c.textContent.trim(),p=c.value||d,f=c.label||d;p!==""&&u.push({label:f,value:p})}}),this._list=u}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var u=e.all.indexOf(this);u!==-1&&e.all.splice(u,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,u=this.index-1;this.goto(this.selected&&u!==-1?u:l-1)},goto:function(l){var u=this.ul.children;this.selected&&u[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&u.length>0&&(u[l].setAttribute("aria-selected","true"),this.status.textContent=u[l].textContent+", list item "+(l+1)+" of "+u.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=u[l].offsetTop-this.ul.clientHeight+u[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,u,c){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:u||l,originalEvent:c});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:c}))}},evaluate:function(){var l=this,u=this.input.value;u.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(c){return new i(l.data(c,u))}).filter(function(c){return l.filter(c,u)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(c,d){l.ul.appendChild(l.item(c,u,d))}),this.ul.children.length===0?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},e.all=[],e.FILTER_CONTAINS=function(l,u){return RegExp(a.regExpEscape(u.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,u){return RegExp("^"+a.regExpEscape(u.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,u){return l.length!==u.length?l.length-u.length:l<u?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,u,c){var d=u.trim()===""?l:l.replace(RegExp(a.regExpEscape(u.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+c})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var u=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=u.label||u.value,this.value=u.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,u,c){for(var d in u){var p=u[d],f=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(f):p===!1?l[d]=f!==null:p instanceof Function?l[d]=null:l[d]=f,!l[d]&&l[d]!==0&&(l[d]=d in c?c[d]:p)}}var r=Array.prototype.slice;function a(l,u){return typeof l=="string"?(u||document).querySelector(l):l||null}function o(l,u){return r.call((u||document).querySelectorAll(l))}a.create=function(l,u){var c=document.createElement(l);for(var d in u){var p=u[d];if(d==="inside")a(p).appendChild(c);else if(d==="around"){var f=a(p);f.parentNode.insertBefore(c,f),c.appendChild(f),f.getAttribute("autofocus")!=null&&f.focus()}else d in c?c[d]=p:c.setAttribute(d,p)}return c},a.bind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,u){if(l)for(var c in u){var d=u[c];c.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,u,c){var d=document.createEvent("HTMLEvents");d.initEvent(u,!0,!0);for(var p in c)d[p]=c[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var u=0;l=l.previousElementSibling;u++);return u};function s(){o("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?s():document.addEventListener("DOMContentLoaded",s)),e.$=a,e.$$=o,t.exports&&(t.exports=e),e})()})(Oce);var MFe=Oce.exports;const NFe=tq(MFe);function AFe({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:a}){var u;const o=new NFe(e,{list:t});let s=!1;const l=c=>{s=!0,rt(i)&&i(c.text.value),e.value=c.text.label,o.suggestions=[]};if(r){const c=d=>d.which===9&&d.preventDefault();e.addEventListener("keydown",c,!1),e.addEventListener("keyup",c,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","off"),e.addEventListener("awesomplete-selectcomplete",c=>l(c),!1),e.addEventListener("keyup",function(c){var d;(c.which===13||c.which===9)&&!s&&((d=o.suggestions)!=null&&d.length)&&(o.next(),o.select(0)),s=!1}),n){const c=(u=t.find(d=>d.value===n))==null?void 0:u.label;c&&(e.value=c)}return{typeAhead:o}}function xce(t,e,i,n,r){if(r){const a=e.target.value;r(a)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function iq(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function kT(t){var o,s;const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style=`width: ${t.width}`:e.style="flex-grow: 1",t.label&&!t.checkbox){const l=document.createElement("label");l.style=t.labelStyle||"font-weight: bold; font-size: larger;",l.innerHTML=t.label,e.appendChild(l)}let i,n,r=[];const a=document.createElement("div");if(a.className="control font-medium",t.controlVisible===!1&&(a.style.display=lt),t.controlId&&(a.id=t.controlId),t.text){const l=document.createElement("div");t.id&&(l.id=t.id),l.className="content",l.innerHTML=t.text,a.appendChild(l)}else if(t.radio){const l=document.createElement("div");l.id=t.id,l.className="control";for(const u of t.options??[]){const c=document.createElement("label");c.className="radio";const d=document.createElement("input");u.field&&r.push({input:d,field:u.field}),u.id&&(d.id=u.id),d.name=t.id,d.type="radio",d.value=u.text,u.checked&&(d.checked=!0),c.appendChild(d),l.appendChild(c);const p=document.createElement("span");p.style.marginLeft=".25em",p.style.marginRight="1em",p.innerHTML=u.text,l.appendChild(p)}a.appendChild(l),i=l}else if(t.options){const l=document.createElement("div");l.className="select font-medium",l.style="width: 100%",t.zIndex&&(l.style.zIndex=t.zIndex);const u=document.createElement("select");if(t.dataPlaceholder&&u.setAttribute("data-placeholder",t.dataPlaceholder),t.dataType&&u.setAttribute("data-type",t.dataType),t.multiple&&u.setAttribute("multiple",!0),t.disabled&&(u.disabled=!0),t.id&&(l.id=t.id),u.style="width: 100%",iq(u,t),l.appendChild(u),a.appendChild(l),t.help){const c=document.createElement("p");c.className="help font-medium is-info",c.innerHTML=(o=t.help)==null?void 0:o.text,c.style.display=(s=t.help)!=null&&s.visible?"":lt,a.appendChild(c)}i=u,rt(t.onChange)&&u.addEventListener("change",c=>t.onChange(c,t))}else if(t.checkbox){const l=document.createElement("div");l.className="flexrow nowrap",l.style.display="inline-block";const u=document.createElement("input");rt(t.onChange)&&u.addEventListener("change",p=>t.onChange(p,t)),i=u;const c=t.intent??"is-success";u.className=`is-checkradio ${c}`,u.type="checkbox",u.id=t.id,t.checked&&(u.checked=!0),l.appendChild(u);const d=document.createElement("label");d.setAttribute("for",t.id),t.color&&(d.style.color=t.color),d.innerHTML=t.label,l.appendChild(d),a.appendChild(l)}else{const l=document.createElement("input");if(l.className="input font-medium",t.class&&l.classList.add(t.class),l.setAttribute("type",t.type||"text"),l.setAttribute("autocomplete",t.autocomplete||"off"),l.setAttribute("placeholder",t.placeholder||""),t.disabled&&l.setAttribute("disabled",!0),t.id&&l.setAttribute("id",t.id),a.appendChild(l),t.iconLeft){a.classList.add("has-icons-left");const c=document.createElement("span");c.className="icon is-small is-left font-medium";const d=document.createElement("i");d.className=t.iconLeft,c.appendChild(d),a.appendChild(c)}if(t.type==="password"){a.classList.add("has-icons-right");const c=document.createElement("span");c.className="icon is-small is-right font-medium";const d=document.createElement("i");d.className=t.iconRight,c.appendChild(d),a.appendChild(c)}i=l;const u=document.createElement("p");u.className="help font-medium",a.appendChild(u),t.validator&&l.addEventListener("input",c=>xce(t,c,l,u,t.validator)),t.date?n=new kce(i,{format:"yyyy-mm-dd",autohide:!0}):t.typeAhead?AFe({...t.typeAhead,element:l}):(rt(t.onKeyDown)&&l.addEventListener("keydown",c=>t.onKeyDown(c,t)),rt(t.onChange)&&l.addEventListener("change",c=>t.onChange(c,t)),rt(t.onInput)&&l.addEventListener("input",c=>t.onInput(c,t)),rt(t.onKeyUp)&&l.addEventListener("keyup",c=>t.onKeyUp(c,t)),t.value!==void 0&&(l.value=t.value)),t.selectOnFocus&&l.addEventListener("focus",()=>l.select())}return e.appendChild(a),t.visible===!1&&(e.style.display=lt),{field:e,inputElement:i,datepicker:n,subFields:r}}function Wn(t,e,i){const n=document.createElement("div");n.style="display: flex; width: 100%;",n.classList.add("flexcol");const r={},a={};let o;for(const s of e){if((s.text||s.html)&&!s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const u=document.createElement("div");u.className="flexaligncenter",u.style=s.style||s.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const c=document.createElement("div");if(s.id&&(c.id=s.id),c.className="content",c.innerHTML=s.text,u.appendChild(c),l){l.appendChild(u);const{field:d,inputElement:p,datepicker:f}=kT(s.fieldPair);f&&(r[`${s.field}.date`]=f),p&&(r[s.fieldPair.field]=p),a[s.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(u);continue}if(s.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(s.spacer){const l=document.createElement("div"),u=typeof s.spacer=="number"&&`${s.spacer}em`||typeof s.spacer=="string"&&s.spacer||"1em";l.style.marginBlockEnd=u,n.appendChild(l);continue}if(!(!s.label&&!s.field||s.hide)&&s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:u,inputElement:c,datepicker:d,subFields:p}=kT(s);if(p&&p.forEach(f=>r[f.field]=f.input),d&&(r[`${s.field}.date`]=d),s.focus&&(o=c),r[s.field]=c,a[s.field]=u,l){l.appendChild(u);const{field:f,inputElement:h,datepicker:m}=kT(s.fieldPair);m&&(r[`${s.field}.date`]=m),h&&(r[s.fieldPair.field]=h),a[s.fieldPair.field]=f,l.appendChild(f),n.appendChild(l)}else n.appendChild(u)}}if(o&&setTimeout(()=>o.focus(),200),t.appendChild(n),i!=null&&i.length)for(const s of i){if(s.dateRange&&Array.isArray(s.fields)){const[l,u]=s.fields;if(r[l]&&r[u]){const c=new RFe(r[l],{inputs:[r[l],r[u]],minDate:s.minDate,maxDate:s.maxDate,format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=c}}s.control&&(rt(s.onChange)&&r[s.control].addEventListener("change",l=>s.onChange({e:l,inputs:r,fields:a})),rt(s.onInput)&&r[s.control]&&r[s.control].addEventListener("input",l=>s.onInput({e:l,inputs:r,fields:a})),rt(s.onFocusOut)&&r[s.control]&&r[s.control].addEventListener("focusout",l=>s.onFocusOut({e:l,inputs:r,fields:a})))}return r}function ly(t,e){return Array.from(t.classList).indexOf(e)>=0?t:Jo(t,e)}function Jo(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function GS(t,e,i){const n=Jo(t,e);return n==null?void 0:n.getAttribute(i)}function lh(t,e){const i=[];function n(r){r.childNodes.forEach(a=>{a.childNodes.length>0&&n(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return n(t),i}function _Fe(){Mt({intent:"is-success",message:"Success"})}function kFe(t){Mt({intent:"is-danger",message:(t==null?void 0:t.message)??"Failure"})}var iK,or="colors",Rs="sizes",Rt="space",OFe={gap:Rt,gridGap:Rt,columnGap:Rt,gridColumnGap:Rt,rowGap:Rt,gridRowGap:Rt,inset:Rt,insetBlock:Rt,insetBlockEnd:Rt,insetBlockStart:Rt,insetInline:Rt,insetInlineEnd:Rt,insetInlineStart:Rt,margin:Rt,marginTop:Rt,marginRight:Rt,marginBottom:Rt,marginLeft:Rt,marginBlock:Rt,marginBlockEnd:Rt,marginBlockStart:Rt,marginInline:Rt,marginInlineEnd:Rt,marginInlineStart:Rt,padding:Rt,paddingTop:Rt,paddingRight:Rt,paddingBottom:Rt,paddingLeft:Rt,paddingBlock:Rt,paddingBlockEnd:Rt,paddingBlockStart:Rt,paddingInline:Rt,paddingInlineEnd:Rt,paddingInlineStart:Rt,top:Rt,right:Rt,bottom:Rt,left:Rt,scrollMargin:Rt,scrollMarginTop:Rt,scrollMarginRight:Rt,scrollMarginBottom:Rt,scrollMarginLeft:Rt,scrollMarginX:Rt,scrollMarginY:Rt,scrollMarginBlock:Rt,scrollMarginBlockEnd:Rt,scrollMarginBlockStart:Rt,scrollMarginInline:Rt,scrollMarginInlineEnd:Rt,scrollMarginInlineStart:Rt,scrollPadding:Rt,scrollPaddingTop:Rt,scrollPaddingRight:Rt,scrollPaddingBottom:Rt,scrollPaddingLeft:Rt,scrollPaddingX:Rt,scrollPaddingY:Rt,scrollPaddingBlock:Rt,scrollPaddingBlockEnd:Rt,scrollPaddingBlockStart:Rt,scrollPaddingInline:Rt,scrollPaddingInlineEnd:Rt,scrollPaddingInlineStart:Rt,fontSize:"fontSizes",background:or,backgroundColor:or,backgroundImage:or,borderImage:or,border:or,borderBlock:or,borderBlockEnd:or,borderBlockStart:or,borderBottom:or,borderBottomColor:or,borderColor:or,borderInline:or,borderInlineEnd:or,borderInlineStart:or,borderLeft:or,borderLeftColor:or,borderRight:or,borderRightColor:or,borderTop:or,borderTopColor:or,caretColor:or,color:or,columnRuleColor:or,fill:or,outline:or,outlineColor:or,stroke:or,textDecorationColor:or,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Rs,minBlockSize:Rs,maxBlockSize:Rs,inlineSize:Rs,minInlineSize:Rs,maxInlineSize:Rs,width:Rs,minWidth:Rs,maxWidth:Rs,height:Rs,minHeight:Rs,maxHeight:Rs,flexBasis:Rs,gridTemplateColumns:Rs,gridTemplateRows:Rs,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},xFe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,oP=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(a=>JSON.stringify(a,xFe))(e);return r in t?t[r]:t[r]=i(e,...n)}},yR=Symbol.for("sxs.internal"),nq=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),nK=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:LFe}=Object.prototype,vB=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),FFe=/\s+(?![^()]*\))/,Xb=t=>e=>t(...typeof e=="string"?String(e).split(FFe):[e]),rK={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Xb((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Xb((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Xb((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Xb((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Xb((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Xb((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},YL=/([\d.]+)([^]*)/,BFe=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,$Fe=(t,e)=>t in VFe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,a)=>n+(r==="stretch"?`-moz-available${a};${vB(t)}:${n}-webkit-fill-available`:`-moz-fit-content${a};${vB(t)}:${n}fit-content`)+a):String(e),VFe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},uh=t=>t?t+"-":"",Lce=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,a,o,s)=>o=="$"==!!a?n:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?uh(e)+(s.includes("$")?"":uh(i))+s.replace(/\$/g,"-"):s)+")"+(r||o=="--"?"*"+(r||"")+(a||"1")+")":"")),jFe=/\s*,\s*(?![^()]*\))/,GFe=Object.prototype.toString,UI=(t,e,i,n,r)=>{let a,o,s;const l=(u,c,d)=>{let p,f;const h=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(f of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),T=typeof f=="object"&&f&&f.toString===GFe&&(!n.utils[I]||!c.length);if(I in n.utils&&!T){const w=n.utils[I];if(w!==o){o=w,h(w(f)),o=null;continue}}else if(I in rK){const w=rK[I];if(w!==s){s=w,h(w(f)),s=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,S,U,P,E,D)=>{const R=YL.test(S),N=.0625*(R?-1:1),[M,A]=R?[P,S]:[S,P];return"("+(U[0]==="="?"":U[0]===">"===R?"max-":"min-")+M+":"+(U[0]!=="="&&U.length===1?A.replace(YL,(_,k,B)=>Number(k)+N*(U===">"?1:-1)+B):A)+(E?") and ("+(E[0]===">"?"min-":"max-")+M+":"+(E.length===1?D.replace(YL,(_,k,B)=>Number(k)+N*(E===">"?-1:1)+B):D):"")+")"})),T){const w=y?d.concat(p):[...d],S=y?[...c]:BFe(c,p.split(jFe));a!==void 0&&r(aK(...a)),a=void 0,l(f,S,w)}else a===void 0&&(a=[[],c,d]),p=y||p.charCodeAt(0)!==36?p:`--${uh(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,f=T?f:typeof f=="number"?f&&I in HFe?String(f)+"px":String(f):Lce($Fe(I,f??""),n.prefix,n.themeMap[I]),a[0].push(`${y?`${p} `:`${vB(p)}:`}${f}`)}}var g,v};h(u),a!==void 0&&r(aK(...a)),a=void 0};l(t,e,i)},aK=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,HFe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},oK=t=>String.fromCharCode(t+(t>25?39:97)),Nv=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=oK(i%52)+n;return oK(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),sT=["themed","global","styled","onevar","resonevar","allvar","inline"],zFe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},qFe=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const u in e.rules)if(e.rules[u].group===a)return`--sxs{--sxs:${[...e.rules[u].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},n=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const u in s)delete s[u]}const r=Object(t).styleSheets||[];for(const s of r)if(zFe(s)){for(let l=0,u=s.cssRules;u[l];++l){const c=Object(u[l]);if(c.type!==1)continue;const d=Object(u[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=c;if(!p.startsWith("--sxs"))continue;const f=p.slice(14,-3).trim().split(/\s+/),h=sT[f[0]];h&&(e||(e={sheet:s,reset:n,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(f)})}if(e)break}if(!e){const s=(l,u)=>({type:u,cssRules:[],insertRule(c,d){this.cssRules.splice(d,0,s(c,{import:3,undefined:1}[(c.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,c=>c.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:o}=e;for(let s=sT.length-1;s>=0;--s){const l=sT[s];if(!o[l]){const u=sT[s+1],c=o[u]?o[u].index:a.cssRules.length;a.insertRule("@media{}",c),a.insertRule(`--sxs{--sxs:${s}}`,c),o[l]={group:a.cssRules[c+1],index:c,cache:new Set([s])}}WFe(o[l])}};return n(),e},WFe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},HS=Symbol(),KFe=oP(),YFe=(t,e)=>KFe(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[yR]){n.type==null&&(n.type=r[yR].type);for(const a of r[yR].composers)n.composers.add(a)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add(ZFe(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),XFe(t,n,e)}),ZFe=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const a=`${uh(r.prefix)}c-${Nv(n)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){c=l,d=p,LFe.call(c,d)||(l[p]="undefined");const f=t[p];for(const h in f){const m={[p]:String(h)};String(h)==="undefined"&&u.push(p);const g=f[h],v=[m,g,!nK(g)];o.push(v)}}var c,d;if(typeof e=="object"&&e)for(const p of e){let{css:f,...h}=p;f=typeof f=="object"&&f||{};for(const g in h)h[g]=String(h[g]);const m=[h,f,!nK(f)];s.push(m)}return[a,n,o,s,l,u]},XFe=(t,e,i)=>{const[n,r,a,o]=JFe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let f=0;f<p[HS].length;f++){const[h,m]=p[HS][f];d.rules[h].apply(m)}return p[HS]=[],null}return p[HS]=[],p.rules={},sT.forEach(f=>p.rules[f]={apply:h=>p[HS].push([f,h])}),p})(i):null,l=(s||i).rules,u=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=d=>{d=typeof d=="object"&&d||QFe;const{css:p,...f}=d,h={};for(const v in a)if(delete f[v],v in d){let y=d[v];typeof y=="object"&&y?h[v]={"@initial":a[v],...y}:(y=String(y),h[v]=y!=="undefined"||o.has(v)?y:a[v])}else h[v]=a[v];const m=new Set([...r]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),UI(y,[`.${v}`],[],t,S=>{l.styled.apply(S)}));const T=sK(b,h,t.media),w=sK(I,h,t.media,!0);for(const S of T)if(S!==void 0)for(const[U,P,E]of S){const D=`${v}-${Nv(P)}-${U}`;m.add(D);const R=(E?i.rules.resonevar:i.rules.onevar).cache,N=E?l.resonevar:l.onevar;R.has(D)||(R.add(D),UI(P,[`.${D}`],[],t,M=>{N.apply(M)}))}for(const S of w)if(S!==void 0)for(const[U,P]of S){const E=`${v}-${Nv(P)}-${U}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),UI(P,[`.${E}`],[],t,D=>{l.allvar.apply(D)}))}}if(typeof p=="object"&&p){const v=`${n}-i${Nv(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),UI(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=f.className=[...m].join(" ");return{type:e.type,className:g,selector:u,props:f,toString:()=>g,deferredInjector:s}};return nq(c,{className:n,selector:u,[yR]:e,toString:()=>(i.rules.styled.cache.has(n)||c(),n)})},JFe=t=>{let e="";const i=[],n={},r=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),r.push(...s);for(const l in o){const u=o[l];(n[l]===void 0||u!=="undefined"||s.includes(u))&&(n[l]=u)}}return[e,i,n,new Set(r)]},sK=(t,e,i,n)=>{const r=[];e:for(let[a,o,s]of t){if(s)continue;let l,u=0,c=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let f,h,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(h=h||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),c=!0}u+=m,f=!0}++m}if(h&&h.length&&(o={["@media "+h.join(", ")]:o}),!f)continue e}}}(r[u]=r[u]||[]).push([n?"cv":`${l}-${a[l]}`,o,c])}return r},QFe={},e2e=oP(),t2e=(t,e)=>e2e(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let a=Nv(r);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(r["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete r["@import"]}UI(r,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return nq(n,{toString:n})}),i2e=oP(),n2e=(t,e)=>i2e(t,()=>i=>{const n=`${uh(t.prefix)}k-${Nv(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const a=[];UI(i,[],[],t,s=>a.push(s));const o=`@keyframes ${n}{${a.join("")}}`;e.rules.global.apply(o)}return n};return nq(r,{get name(){return r()},toString:r})}),r2e=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+uh(this.prefix)+uh(this.scale)+this.token}toString(){return this.computedValue}},a2e=oP(),o2e=(t,e)=>a2e(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${uh(t.prefix)}t-${Nv(n)}`}`,a={},o=[];for(const l in n){a[l]={};for(const u in n[l]){const c=`--${uh(t.prefix)}${l}-${u}`,d=Lce(String(n[l][u]),t.prefix,l);a[l][u]=new r2e(u,d,l,t.prefix),o.push(`${c}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:r,toString:s}}),s2e=oP(),Fce=t=>{let e=!1;const i=s2e(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",a=typeof n.media=="object"&&n.media||{},o=typeof n.root=="object"?n.root||null:globalThis.document||null,s=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:a,theme:s,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...OFe},utils:typeof n.utils=="object"&&n.utils||{}},u=qFe(o),c={css:YFe(l,u),globalCss:t2e(l,u),keyframes:n2e(l,u),createTheme:o2e(l,u),reset(){u.reset(),c.theme.toString()},theme:{},sheet:u,config:l,prefix:r,getCssText:u.toString,toString:u.toString};return String(c.theme=c.createTheme(s)),c});return e||i.reset(),i},l2e=()=>iK||(iK=Fce()),Ri=(...t)=>l2e().css(...t);function u2e({variant:t}){return Ri({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const c2e=Ri({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),d2e=Ri({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),p2e=Ri({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function f2e({drawPosition:t,sideNumber:e}){return Ri({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function h2e({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Ri({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const rq=Ri({fontSize:"smaller",color:"gray"});var m2e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bce(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $ce={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=r(a,n(s)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=r(o,s));return o}function r(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})($ce);var g2e=$ce.exports;const Ng=Bce(g2e);function v2e({individualParticipant:t,className:e}){var i,n;const{city:r,state:a,countryCode:o}=((n=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},s=[r,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Ng(rq(),e),l.innerHTML=s,l}const y2e=Ri({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),b2e=Ri({display:"block"}),I2e=Ri({position:"fixed",right:0,left:0}),w2e=Ri({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),S2e=Ri({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),T2e=Ri({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),U2e=Ri({fontWeight:"600",fontSize:"20px"}),lK=Ri({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),uK="Nothing to see here";function Du(t){return typeof t=="function"}function bR(t){return typeof t=="string"}function cK(t){return Array.isArray(t)}function ZL(t){return typeof t=="object"&&!Array.isArray(t)}function D2e(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const aN=(()=>{const t=I2e(),e={},i=".5";let n=[],r,a=[],o=[],s;const l=m=>{if(m){let g;o=o.filter(v=>(v.id===m&&(g=v),v.id!==m)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},u=()=>{s&&(s.style.opacity=0,s.style.display="none")},c=m=>{const g=o.length;if(m&&e[g]===!1)return;const v=a.pop(),y=n.pop();Du(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),u(),l()},d=()=>{s=document.createElement("div"),s.className=y2e(),s.id="cmdl-backdrop",s.onclick=()=>c(!0),document.body.appendChild(s)},p=({config:m})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,s||d(),s.style.display="",(m==null?void 0:m.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},f=({config:m,attr:g,attrs:v,unit:y="em",value:b})=>{var I;let T;return bR(g)?T=yB({element:m,attr:g}):cK(v)&&(T=(I=v.map(w=>yB({element:m,attr:w})).filter(Boolean))==null?void 0:I[0]),T!==void 0&&(b=T),isNaN(b)?b:`${b}${y}`},h=({buttons:m,config:g,modalNumber:v})=>{var y,b;const I=document.createElement("div");I.className=lK(),I.style.padding=f({config:g,attrs:["footer.padding","padding"],value:i});const T={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:aN.close,intent:"is-info"};for(const w of m){if(w.hide)continue;const S={...T};ZL(w)&&Object.assign(S,w);const U=document.createElement("button");S.disabled!==void 0&&(U.disabled=S.disabled),S.id&&(U.id=S.id),U.className=((b=S==null?void 0:S.footer)==null?void 0:b.className)||"button font-medium",U.classList.add(S.intent),U.style="margin-right: .5em;",U.innerHTML=S.label||S.text,U.onclick=P=>{P.stopPropagation(),Du(S.onClick)&&(U.classList.add("is-loading"),S.onClick({e:P,content:n[v]})),S.close!==!1&&(Du(S.close)&&S.close(),aN.close())},I.appendChild(U)}return I};return{close:c,open:({title:m="",content:g,buttons:v,footer:y,config:b,onClose:I}={})=>{p({config:b}),a.push(I);const T=o.length+1;e[T]=b==null?void 0:b.clickAway;const w=document.createElement("section"),S=`cmdl-${T}`;w.className=b2e(),w.role="dialog",w.tabIndex=-1,w.id=S;const U=document.createElement("div");U.className=w2e(),U.style.maxWidth=`${(b==null?void 0:b.maxWidth)||450}px`,U.onclick=()=>c(!0);const P=document.createElement("div");P.className=S2e(),P.onclick=B=>B.stopPropagation();const E=document.createElement("div"),D=document.createElement("div");E.appendChild(D),P.appendChild(E);const R=({title:B,config:F})=>{E.className=B?T2e():"",E.style.padding=f({config:F,attrs:["title.padding","padding"],value:i}),D.className=B?U2e():"",D.innerHTML=B};m&&R({title:m});const N=document.createElement("div");P.appendChild(N);const M=({content:B,config:F})=>{N.style.fontSize=f({config:F,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=f({config:F,attrs:["content.padding","padding"],value:i}),Du(B)?n[T]=B(N):ZL(B)?N.appendChild(B):bR(B)?N.innerHTML=B:N.innerHTML=uK};if(M({content:g,config:b}),cK(v))y=h({buttons:v,config:b,modalNumber:T}),P.appendChild(y);else if(y){const B=document.createElement("div");B.className=lK(),B.style.padding=f({config:b,attrs:["footer.padding","padding"]}),ZL(y)?B.appendChild(y):bR(y)?B.innerHTML=y:B.innerHTML=uK,P.appendChild(B)}U.appendChild(P),w.appendChild(U),document.body.appendChild(w),o.push(w);const A=({content:B,config:F})=>{n[T]=void 0,D2e(N),M({content:B,config:F})},_=({buttons:B,config:F})=>{P.removeChild(y),y=h({buttons:B,config:F,modalNumber:T}),P.appendChild(y)},k=({onClose:B})=>{a.length=0,a.push(B)};return{setContent:A,setButtons:_,update:({content:B,buttons:F,title:x,config:$,onClose:j})=>{b=$||b,B&&A({content:B,config:b}),F&&_({buttons:F,config:b}),j&&k({onClose:j}),x&&R({title:x,config:b})}}}}})();function yB({element:t,attr:e}){if(!bR(e))return;const i=e.split(".");for(const n of i)if(t=t==null?void 0:t[n],!t)return;return t}function P2e({individualParticipant:t,attribute:e,className:i}){const n=t==null?void 0:t.person,r=yB({element:n,attr:e});if(!r)return;const a=document.createElement("div");return a.className=Ng(rq(),i),a.innerHTML=r,a}function E2e({individualParticipant:t,className:e}){var i;const n=(i=t==null?void 0:t.teams)==null?void 0:i[0],r=(n==null?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=Ng(rq(),e),a.classList.add("tmx-tm"),a.setAttribute("id",n==null?void 0:n.participantId),a.innerHTML=r,a}function C2e(t){var e,i,n,r;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(((r=(n=t==null?void 0:t.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??a==="ADDRESS")return v2e(t);if(a==="TEAM")return E2e(t);if(a){const o=P2e({...t,attribute:a});if(o)return o}return document.createElement("div")}const R2e=Ri({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function M2e({className:t,composition:e,side:i}){const n=(i==null?void 0:i.seedValue)||(i==null?void 0:i.seedNumber);if(!n)return"";const r=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=r,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${n}${o[1]}`,l=r.seedingElement==="sup"?"sup":"span",u=document.createElement(l);return u.className=t,u.innerHTML=s,u}const N2e=Ri({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function A2e({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var a,o,s,l,u,c,d;const p=e==null?void 0:e.configuration,f=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(n==null?void 0:n.matchUpType)||"SINGLES",h=t==null?void 0:t.rankings,m=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,b=g==null?void 0:g.accessor,I=v==="RATING"?m:h,T=(s=(o=I==null?void 0:I.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(u=(l=I==null?void 0:I.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:u.scaleValue,S=T&&b?T[b]:T||"",U=w&&b?w[b]:w||"",P=f==="SINGLES"?S:U,E=(c=p==null?void 0:p.scaleAttributes)==null?void 0:c.fallback,D=!r&&(P||E&&(S||U)),R=document.createElement("span");return D&&(R.className=Ng(i,N2e({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),R.innerHTML=D||"",R}var _2e=Object.defineProperty,Yt=(t,e)=>{for(var i in e)_2e(t,i,{get:e[i],enumerable:!0})};function Ok(){return"2.0.28"}var Vce={};Yt(Vce,{competitionGovernor:()=>jce,drawsGovernor:()=>xpe,entriesGovernor:()=>Vve,eventGovernor:()=>Kve,generationGovernor:()=>uye,matchUpFormatGovernor:()=>yye,matchUpGovernor:()=>bye,mocksGovernor:()=>Y5,participantGovernor:()=>hbe,policyGovernor:()=>mve,publishingGovernor:()=>xbe,queryGovernor:()=>Ive,reportGovernor:()=>Gbe,scheduleGovernor:()=>Hbe,scoreGovernor:()=>F4,tieFormatGovernor:()=>iIe,tournamentGovernor:()=>dIe,venueGovernor:()=>wIe});var jce={};Yt(jce,{getLinkedTournamentIds:()=>wP,getTournamentIds:()=>bP,linkTournaments:()=>Ape,mutate:()=>Gce,query:()=>Ope,unlinkTournament:()=>kpe,unlinkTournaments:()=>_pe});var Gce={};Yt(Gce,{linkTournaments:()=>Ape,unlinkTournament:()=>kpe,unlinkTournaments:()=>_pe});var k2e={};Yt(k2e,{addNotice:()=>oi,callListener:()=>MB,createInstanceState:()=>RBe,cycleMutationStatus:()=>Lq,deepCopyEnabled:()=>xq,deleteNotice:()=>Fq,deleteNotices:()=>mP,disableNotifications:()=>ope,enableNotifications:()=>TR,getDevContext:()=>il,getMethods:()=>upe,getNotices:()=>cpe,getProvider:()=>NB,getTopics:()=>iu,getTournamentId:()=>db,getTournamentRecord:()=>Bq,getTournamentRecords:()=>pb,globalLog:()=>fpe,handleCaughtError:()=>Zk,removeTournamentRecord:()=>ppe,setDeepCopy:()=>$U,setDevContext:()=>BU,setGlobalLog:()=>ape,setGlobalMethods:()=>spe,setGlobalSubscriptions:()=>NBe,setMethods:()=>lpe,setStateMethods:()=>hpe,setStateProvider:()=>CBe,setSubscriptions:()=>ABe,setTournamentId:()=>VU,setTournamentRecord:()=>dpe,setTournamentRecords:()=>Yk,timeKeeper:()=>MBe});function $o(t){return typeof t=="function"}function mo(t){return typeof t=="string"}function ln(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function O2e(t,e){if(!ln(t)||!ln(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function Hce(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(ln).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var x2e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function bB(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>bB(a))}:{[r]:e?n(t[r]):bB(t[r])}))}function IB(t){return Array.isArray(t)?t.length+t.map(IB).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>IB(t[e])).reduce((e,i)=>e+i,0):0}function L2e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=IB(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var ae={success:!0},F2e="error",B2e={SUCCESS:ae,ERROR:F2e},wB={message:"Chronological error; time violation.",code:"ANACHRONISM"},zce={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},SB={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Rn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Oe={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},sP={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},bw={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Av={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},nt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},qce={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Qo={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},lb={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},aq={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},oq={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Iw={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Wce={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Kce={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},$2e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},sq={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},lP={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},xk={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},q0={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},W0={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},lq={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},Lk={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},uq={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},uP={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Ku={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Yce={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Zce={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Xce={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Jce={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Qce={message:"Invalid action",code:"ERR_INVALID_ACTION"},TB={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},ede={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},tde={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},ide={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},cq={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},nde={message:"Existing round",code:"ERR_EXISTING_ROUND"},V2e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Ts={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Tn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},dq={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Lh={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},rde={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},ch={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Oi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},es={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},ade={message:"Event exists",code:"ERR_EXISTING_EVENT"},ode={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},sde={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},pq={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},fq={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ag={message:"Invalid stage",code:"ERR_INVALID_STAGE"},lde={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},ude={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},cde={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},UB={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},cP={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},IR={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},ww={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Jd={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},hq={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},mq={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},dde={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},dP={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},va={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},K0={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Da={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Ld={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},No={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},go={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},gq={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Fk={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},j2e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},pde={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},vq={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},fde={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},yq={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},G2e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Sw={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},H2e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},bq={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},z2e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},Bk={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},q2e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},W2e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},ub={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},dt={message:"Missing value",code:"ERR_MISSING_VALUE"},hde={message:"Missing date",code:"ERR_MISSING_DATE"},mde={message:"No valid dates",code:"ERR_NO_VALID_DATES"},oN={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},wR={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},gde={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Qa={message:"Invalid Date",code:"ERR_INVALID_DATE"},wl={message:"Invalid time",code:"ERR_INVALID_TIME"},vde={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},DB={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},yde={message:"Invalid score",code:"ERR_INVALID_SCORE"},$k={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},K2e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Iq={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},bde={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Vk={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},wq={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Y0={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ic={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ol={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Ide={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Bu={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},wde={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},cb={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},pP={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},wr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},qn={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Sde={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Y2e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},Tde={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Fh={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Ude={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Dde={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Pde={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Z0={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},jk={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Sq={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},PB={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Ede={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Z2e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},X2e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Cde={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Rde={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},EB={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},Mde={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},Tq={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},Nde={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},Uq={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},Tw={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Ade={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},fP={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},_de={message:"Court exists",code:"ERR_EXISTING_COURT"},kde={message:"Venue exists",code:"ERR_EXISTING_VENUE"},X0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Bh={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Ode={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},Dq={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},xde={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Lde={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},J2e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Pq={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Fde={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Eq={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Cq={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Gk={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Bde={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},hP={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},$de={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},J0={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Vde={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Hk={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},jde={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Gde={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},rf={message:"Invalid object",code:"ERR_INVALID_OBJECT"},SR={message:"Invalid gender",code:"ERR_INVALID_GENDER"},sN={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Se={message:"Invalid values",code:"ERR_INVALID_VALUES"},Hde={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Rq={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},zde={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},zk={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Mq={message:"Value unchanged",code:"ABORT_UNCHANGED"},Pa={message:"Not found",code:"ERR_NOT_FOUND"},qk={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},qde={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},Nq={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Wde={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Kde={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},CB={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Aq={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Wk={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Yde={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Kk={message:"Scores present",code:"ERR_SCORES_PRESENT"},Q2e={ANACHRONISM:wB,CANNOT_CHANGE_WINNING_SIDE:wq,CANNOT_MODIFY_TIEFORMAT:Iq,CANNOT_MODIFY_PARTICIPANT_TYPE:bde,CANNOT_REMOVE_MAIN_STRUCTURE:zce,CANNOT_REMOVE_PARTICIPANTS:Vk,COURT_EXISTS:_de,COURT_NOT_FOUND:fP,DRAW_DEFINITION_NOT_FOUND:Qo,DRAW_ID_EXISTS:Yce,DRAW_POSITION_ACTIVE:xk,DRAW_POSITION_ASSIGNED:Iw,DRAW_POSITION_NOT_CLEARED:Kce,DRAW_POSITION_NOT_FOUND:$2e,DRAW_SIZE_MISMATCH:uq,DUPLICATE_VALUE:Hde,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Rde,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Cde,EVENT_EXISTS:ade,EVENT_NOT_FOUND:es,EXISTING_DRAW_DEFINITIONS:qce,EXISTING_END_TIME:Dq,EXISTING_FLIGHT:qde,EXISTING_MATCHUP_ID:Kde,EXISTING_OUTCOME:Wde,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Z0,EXISTING_PARTICIPANT:jk,EXISTING_POLICY_TYPE:yq,EXISTING_PROFILE:Nq,EXISTING_ROUND:nde,EXISTING_STAGE:CB,EXISTING_STRUCTURE:Aq,INCOMPATIBLE_MATCHUP_STATUS:IR,INCOMPLETE_SOURCE_STRUCTURE:aq,INSUFFICIENT_DRAW_POSITIONS:Tq,INVALID_ACTION:Qce,INVALID_ASSIGNMENT:TB,INVALID_BOOKINGS:oN,INVALID_CATEGORY:sN,INVALID_COLLECTION_DEFINITION:Gde,INVALID_CONFIGURATION:jde,INVALID_DATE_AVAILABILITY:wR,INVALID_DATE:Qa,INVALID_DRAW_DEFINITION:Av,INVALID_DRAW_POSITION_FOR_SEEDING:oq,INVALID_DRAW_POSITION:q0,INVALID_DRAW_SIZE:Lk,INVALID_END_TIME:Ode,INVALID_ENTRIES:sde,INVALID_EVENT_TYPE:ch,INVALID_GAME_SCORES:DB,INVALID_GENDER:SR,INVALID_MATCHUP_FORMAT:hq,INVALID_MATCHUP_STATUS:ww,INVALID_MATCHUP_STATUS_BYE:cde,INVALID_MATCHUP:go,INVALID_OBJECT:rf,INVALID_PARTICIPANT_ID:Ic,INVALID_PARTICIPANT_IDS:Ol,INVALID_PARTICIPANT_ROLE:Ide,INVALID_PARTICIPANT_SEEDING:Zce,INVALID_PARTICIPANT_TYPE:Bu,INVALID_PARTICIPANT:Y0,INVALID_POLICY_DEFINITION:fde,INVALID_RECORDS:SB,INVALID_SCALE_ITEM:hP,INVALID_SEED_NUMBER:tde,INVALID_SEED_POSITION:ide,INVALID_SET_NUMBER:z2e,INVALID_SIDE_NUMBER:bq,INVALID_SCORE:yde,INVALID_STAGE:Ag,INVALID_START_TIME:Lde,INVALID_STRUCTURE:lb,INVALID_STOP_TIME:xde,INVALID_TIE_FORMAT:Jd,INVALID_TIME:wl,INVALID_TIME_ITEM:Pq,INVALID_TOURNAMENT_DATES:vde,INVALID_TOURNAMENT_RECORD:sP,INVALID_VALUES:Se,INVALID_WINNING_SIDE:$k,MATCHUP_NOT_FOUND:Da,METHOD_NOT_FOUND:Wk,MISSING_ASSIGNMENTS:pq,MISSING_ASYNC_STATE_PROVIDER:Fde,MISSING_AVOIDANCE_POLICY:pde,MISSING_COLLECTION_DEFINITION:dde,MISSING_COURT_ID:ub,MISSING_COURTS_INFO:Ade,MISSING_DATE_AVAILABILITY:gde,MISSING_DATE:hde,MISSING_DRAW_DEFINITION:nt,MISSING_DRAW_ID:Ku,MISSING_DRAW_POSITION:W0,MISSING_DRAW_POSITIONS:lP,MISSING_DRAW_SIZE:uP,MISSING_ENTRIES:ode,MISSING_EVENT:Oi,MISSING_MATCHUP_FORMAT:mq,MISSING_MATCHUP_ID:va,MISSING_MATCHUP_IDS:K0,MISSING_MATCHUP:No,MISSING_MATCHUPS:Ld,MISSING_PARTICIPANT_COUNT:Ude,MISSING_PARTICIPANT_ID:wr,MISSING_PARTICIPANT_IDS:Fh,MISSING_PARTICIPANT_ROLE:wde,MISSING_PARTICIPANT:cb,MISSING_PARTICIPANTS:pP,MISSING_PENALTY_ID:Uq,MISSING_PENALTY_TYPE:Nde,MISSING_PERSON_DETAILS:Pde,MISSING_POLICY_ATTRIBUTES:vq,MISSING_POLICY_DEFINITION:Fk,MISSING_POLICY_TYPE:gq,MISSING_POSITION_ASSIGNMENTS:ude,MISSING_ROUND_NUMBER:V2e,MISSING_SCHEDULE:Bde,MISSING_SCORING_POLICY:H2e,MISSING_SEED_ASSIGNMENTS:ede,MISSING_SEEDCOUNT_THRESHOLDS:Jce,MISSING_SEEDING_POLICY:j2e,MISSING_SET_NUMBER:q2e,MISSING_SET_OBJECT:Bk,MISSING_SIDE_NUMBER:W2e,MISSING_STAGE:fq,MISSING_STRUCTURE_ID:Ts,MISSING_STRUCTURE:Lh,MISSING_STRUCTURES:dq,MISSING_TARGET_LINK:cq,MISSING_TIE_FORMAT:dP,MISSING_TIME_ITEM:Eq,MISSING_TIME_ITEMS:Cq,MISSING_TOURNAMENT_ID:bw,MISSING_TOURNAMENT_RECORD:Oe,MISSING_TOURNAMENT_RECORDS:Rn,MISSING_VALUE:dt,MISSING_VENUE_ID:Bh,MODIFICATIONS_FAILED:$de,NO_CANDIDATES:Hk,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:Mde,NO_MODIFICATIONS_APPLIED:J0,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:EB,NO_PARTICIPANT_REMOVED:Tde,NO_VALID_ACTIONS:zde,NO_VALID_ATTRIBUTES:zk,NO_VALID_DATES:mde,NOT_FOUND:Pa,NOT_IMPLEMENTED:qk,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Sq,PARTICIPANT_ID_EXISTS:Sde,PARTICIPANT_NOT_CHECKED_IN:Dde,PARTICIPANT_NOT_FOUND:qn,PARTICIPANT_PAIR_EXISTS:Y2e,PENALTY_NOT_FOUND:Tw,POLICY_NOT_ATTACHED:G2e,POLICY_NOT_FOUND:Sw,SCHEDULE_NOT_CLEARED:Wce,SCHEDULED_MATCHUPS:Yde,SCORES_PRESENT:Kk,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Xce,STAGE_SEQUENCE_LIMIT:lde,STRUCTURE_NOT_FOUND:Tn,TEAM_NOT_FOUND:Rq,UNABLE_TO_ASSIGN_COURT:Vde,UNLINKED_STRUCTURES:rde,UNRECOGNIZED_DRAW_TYPE:sq,UNRECOGNIZED_MATCHUP_FORMAT:cP,UNRECOGNIZED_MATCHUP_STATUS:UB,VALUE_UNCHANGED:Mq,VENUE_EXISTS:kde},gn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Zde={addNotice:dBe,callListener:gBe,cycleMutationStatus:cBe,deleteNotice:hBe,deleteNotices:fBe,disableNotifications:eBe,enableNotifications:tBe,getMethods:_q,getNotices:pBe,getTopics:mBe,getTournamentId:Xde,getTournamentRecord:iBe,getTournamentRecords:nBe,removeTournamentRecord:sBe,setMethods:uBe,setSubscriptions:lBe,setTournamentId:aBe,setTournamentRecord:rBe,setTournamentRecords:oBe,handleCaughtError:vBe};function eBe(){gn.disableNotifications=!0}function tBe(){gn.disableNotifications=!1}function Xde(){return gn.tournamentId}function iBe(t){return gn.tournamentRecords[t]}function nBe(){return gn.tournamentRecords}function rBe(t){let e=t==null?void 0:t.tournamentId;return e?(gn.tournamentRecords[e]=t,{success:!0}):{error:sP}}function aBe(t){return t?gn.tournamentRecords[t]?(gn.tournamentId=t,{success:!0}):{error:Oe}:(gn.tournamentId=void 0,{success:!0})}function oBe(t){gn.tournamentRecords=t;let e=Object.keys(t);e.length===1?gn.tournamentId=e[0]:e.length||(gn.tournamentId=void 0)}function sBe(t){if(typeof t!="string")return{error:Se};if(!gn.tournamentRecords[t])return{error:Pa};delete gn.tournamentRecords[t];let e=Object.keys(gn.tournamentRecords);return e.length===1?gn.tournamentId=e[0]:e.length||(gn.tournamentId=void 0),{success:!0}}function lBe(t){return typeof t.subscriptions!="object"?{error:Se}:(Object.keys(t.subscriptions).forEach(e=>{gn.subscriptions[e]=t.subscriptions[e]}),{...ae})}function uBe(t){return typeof t!="object"?{error:Se}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(gn.methods[e]=t[e])}),{...ae})}function cBe(){let t=gn.modified;return gn.modified=!1,t}function dBe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(gn.disableNotifications||(gn.modified=!0),!(gn.disableNotifications||!gn.subscriptions[t]&&!n)))return i&&(gn.notices=gn.notices.filter(r=>!(r.topic===t&&r.key===i))),gn.notices.push({topic:t,payload:e,key:i}),{...ae}}function _q(){return gn.methods??{}}function pBe({topic:t}){return gn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function fBe(){gn.notices=[]}function hBe({topic:t,key:e}){gn.notices=gn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function mBe(){return{topics:Object.keys(gn.subscriptions)}}function gBe({topic:t,notices:e},i){let n=gn.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function vBe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Xde(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function lr(t,e){return(t??0)-(e??0)}function Tt(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function $u(t){return isNaN(t)?!1:t&&(t&t-1)===0}function dK(t){if(!t.length)return;let e=[...t].sort(lr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function yBe(t){if(!$u(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function kq(t){return isNaN(t)?0:t%2&&t+1||t}function Oq(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Mn(t){return!isNaN(parseFloat(t))}function Jde(t){let e=Tt(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function Q0(t){if(isNaN(t))return!1;for(;!$u(t);)t++;return t}function As(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function At(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function bBe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function IBe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Qde(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Qde(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=IBe(s,n)),parseFloat(s.toFixed(r))}function Ht(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function wBe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Va(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Uw(t){return At(t)?t:1/0}function ts(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function SBe(t){return epe(ts(t))}function epe(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function TBe(t,e,i){return i.indexOf(t)===e}function tpe(t){return t.filter(TBe)}function jo(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Rl(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Je(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function lc(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function $n(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function pK(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function eo(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function UBe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function DBe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Yr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function ipe(t,[e,...i]){return t.length?[t.slice(0,e),...ipe(t.slice(e),[...i,e])]:[]}function PBe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function npe(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function rpe(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function RB(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function EBe(t,e=1){if(!Array.isArray(t)||!t.every(At))return[];let i=Math.min(...t,e),n=Math.max(...t);return Je(i,n+1).filter(r=>!t.includes(r))}var Vi={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Zr=Zde,fK=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function CBe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if($n(Object.keys(t),fK).length!==fK.length)throw new Error("Global state provider is missing required methods");return Zr=t,{success:!0}}function RBe(){if(Zr.createInstanceState){try{Zr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:Fde}}function il(t){return!t||typeof t!="object"?Vi.devContext??!1:typeof Vi.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Vi.devContext)==null?void 0:i[e])===t[e]})&&Vi.devContext}function MBe(t="reset",e="default"){var i,n;let r=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Vi.timers).filter(a=>a!=="default"||Vi.timers[a].startTime).map(a=>{let o=Vi.timers[a],s=o.state==="stopped"?0:(r-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:Vi.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Vi.timers[e].state==="stopped"?0:(r-(((i=Vi.timers[e])==null?void 0:i.startTime)??0))/1e3,o=Vi.timers[e].elapsedTime+a;return{state:Vi.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!Vi.timers[e]||t==="reset"){if(e==="allTimers")return Vi.timers={default:{elapsedTime:0}},!0;Vi.timers[e]={startTime:r,state:"active",elapsedTime:0}}return Vi.timers[e].elapsedTime||(Vi.timers[e].elapsedTime=0),t==="stop"&&Vi.timers[e].state!=="stopped"&&(Vi.timers[e].state="stopped")&&(Vi.timers[e].elapsedTime+=(r-(((n=Vi.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(Vi.timers[e].startTime=r)&&(Vi.timers[e].state="active"),Vi.timers[e]}function ape(t){$o(t)?Vi.globalLog=t:delete Vi.globalLog}function BU(t){Vi.devContext=t}function ope(){Zr.disableNotifications()}function TR(){Zr.enableNotifications()}function $U(t,e){typeof t=="boolean"&&(Vi.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Vi.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Vi.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Vi.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Vi.deepCopyAttributes.threshold=e.threshold))}function xq(){return{enabled:Vi.deepCopy,...Vi.deepCopyAttributes}}function NBe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Vi.globalSubscriptions[e]=t.subscriptions[e]}),{...ae}):{error:dt,info:"missing subscriptions"}}function ABe(t){return t!=null&&t.subscriptions?Zr.setSubscriptions({subscriptions:t.subscriptions}):{error:dt,info:"missing subscriptions"}}function spe(t){return t?typeof t!="object"?{error:Se}:(Object.keys(t).forEach(e=>{$o(t[e])&&(Vi.globalMethods[e]=t[e])}),{...ae}):{error:dt,info:"missing method declarations"}}function lpe(t){return t?typeof t!="object"?{error:Se}:Zr.setMethods(t):{error:dt,info:"missing method declarations"}}function Lq(){return Zr.cycleMutationStatus()}function oi(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Vi.globalSubscriptions[t.topic];return Zr.addNotice(t,e)}function upe(){return{...Vi.globalMethods,...Zr.getMethods()}}function cpe(t){return Zr.getNotices(t)}function Fq({key:t,topic:e}){return Zr.deleteNotice({key:t,topic:e})}function mP(){return Zr.deleteNotices()}function iu(){return Zr.getTopics()}async function MB(t){return Zr.callListener(t,Vi.globalSubscriptions)}function db(){return Zr.getTournamentId()}function Bq(t){return Zr.getTournamentRecord(t)}function pb(){return Zr.getTournamentRecords()}function dpe(t){return Zr.setTournamentRecord(t)}function Yk(t){return Zr.setTournamentRecords(t)}function VU(t){return Zr.setTournamentId(t)}function ppe(t){return Zr.removeTournamentRecord(t)}function NB(){return Zr}function Zk({engineName:t,methodName:e,params:i,err:n}){return($o(Zr.handleCaughtError)&&Zr.handleCaughtError||Zde.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function fpe(t,e){if(Vi.globalLog)try{Vi.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),ape()}else console.log(e,t)}function hpe(t,e,i,n){if(!ln(t))return{error:Se};Mn||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(u=>{$o(s[u])?a[u]=s[u]:ln(s[u])&&(e===!0||r!=null&&r.includes(u))&&(i===void 0||l<i)&&o(s[u],l+1)})};return o(t),n?spe(a):lpe(a),{methods:a}}function _Be(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function ft(t,e,i,n){var r;if(typeof t!="object"||t===null)return t;(r=xq())!=null&&r.enabled||(n=!0);let a=["",void 0,null];e&&a.push(!1);let o=_Be(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>ft(l))}:{[s]:n?t[s]:ft(t[s])}))}function ue({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,ft(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ae}),e??{success:!0}}var Ea="tournamentRecords",$q="policyDefinitions",Fd="tournamentRecord",Yu="drawDefinition",Vq="matchUpFormat",Dd="participantId",mpe="scheduleDates",kBe="tournamentId",OBe="scheduleDate",jq="structureId",Gq="participant",gP="matchUpIds",xBe="policyType",gpe="structures",_g="matchUpId",Hq="inContext",zq="structure",Xk="courtIds",LBe="personId",Jk="venueIds",vpe="matchUps",ype="courtId",bpe="eventId",$h="matchUp",Ipe="drawId",_v="error",eS="event",vP="param",FBe="uuids",BBe="averageMatchUpMinutes",$Be="recoveryMinutes",VBe="periodLength",jBe="number",Kd="object",Fo="array",wu="_validate",wpe="_message",Pd="_invalid",Vh="_ofType",qq="_anyOf",jU="_oneOf",GBe={[Ea]:Rn,[Fd]:Oe,[$q]:Fk,[Yu]:nt,[Dd]:wr,[Vq]:mq,[kBe]:bw,[jq]:Ts,[gP]:K0,[Gq]:cb,[gpe]:dq,[_g]:va,[zq]:Lh,[ype]:ub,[vpe]:Ld,[bpe]:es,[$h]:No,[Xk]:dt,[Jk]:dt,[Ipe]:Ku,[eS]:Oi},HBe={[Ea]:Kd,[$q]:Kd,[Fd]:Kd,[Yu]:Kd,[mpe]:Fo,[Gq]:Kd,[gP]:Fo,[gpe]:Fo,[zq]:Kd,[Xk]:Fo,[Jk]:Fo,[vpe]:Fo,[$h]:Kd,[eS]:Kd,[FBe]:Fo};function wi(t,e,i){if(!t&&!ln(t))return{error:Se};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Se};let{paramError:n,errorParam:r}=WBe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?GBe[r]||Se:n[wu]&&n[Pd]||Se,o=r??(n[jU]&&Object.keys(n[jU]).join(", "));return ue({info:{param:o,message:n[wpe]},result:{error:a},stack:i})}function Spe(t,e){let i=Object.keys(t),n=Object.keys(e);return $n(i,n)}function zBe(t,e){if(!e)return;let i=Spe(t,e);return i.length!==1?{error:Se}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function qBe(t,e){if(!e)return;let i=Spe(t,e).filter(n=>t[n]);return i.length<1?{error:Se}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function WBe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...u})=>{let c=a&&zBe(t,a);if(c!=null&&c.error)return c.error;c&&Object.assign(u,c);let d=o&&qBe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(u,d);let p=Object.keys(u).filter(h=>typeof u[h]=="boolean"),f=p.find(h=>{let m=s&&!$o(s),g=t[h]&&!s&&KBe(t,h,r),v=u[h]&&!t[h],y=m||g||v||s&&t[h]&&!YBe(t[h],s);return y&&(i=h,n=l),y});return!p.length||f}),errorParam:i,paramInfo:n}}function KBe(t,e,i){return i=i||HBe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function YBe(t,e){return $o(e)?e(t):!0}var Tpe="DYNAMIC",dh="RANKING",Am="RATING",uy="SCALE",sd="SEEDING",ZBe={RANKING:dh,RATING:Am,SCALE:uy,SEEDING:sd};function tS(t){var e;let i=wi(t,[{[Gq]:!0}]);if(i.error)return i;let n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(uy))&&[dh,Am,sd].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){let a=s=>n.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,u)=>new Date(l.createdAt||void 0).getTime()-new Date(u.createdAt||void 0).getTime()).pop(),o=Ht(n.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,u,c,d,p]=l.itemType.split("."),f=p?`${d}.${p}`:d,h=u===sd&&"seedings"||u===dh&&"rankings"||"ratings";r[h][c]||(r[h][c]=[]),r[h][c].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:f})}}}return{...ae,...r}}function cy(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),u=Object.keys(o),c=Object.assign({},...u.filter(f=>f.indexOf("||")).map(f=>f.split("||").map(h=>({[h]:f}))).flat()),d=u.concat(...Object.keys(c)),p=d.includes("*");for(let f of l)if(d.indexOf(f)>=0||p){let h=c[f]||f,m=o[h]||p,g=a[f];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);s[f]=v}else g&&(s[f]={},r(g,m,s[f]));else{let v=a[f];if(Array.isArray(m)&&!m.includes(v))return!1;(o[f]||p&&o[f]!==!1)&&(s[f]=v)}}}}var lN=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Upe=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Ed=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Pm=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function uN(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Bt(t.scheduledTime)),!e)return;let i=an(t.scheduledTime),n=Bt(e);return n&&i&&(n+=`T${i}`),n}function XBe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function iS(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Pm.test(fb(t,!0,!0)))}function hs(t){return Qm(t)||lN.test(t)}function JBe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return QBe(i,{displaySeconds:!1})}function QBe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Bs).join(":")}var Wq=t=>{let e=GU(t)||Qm(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Bs(n)}-${Bs(e.getUTCDate())}`};function e$e(t){let e=GU(t)||Qm(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Nu(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function cN(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function t$e(t){return cN(t).getTime()}function GU(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Dw(t,e){if(!hs(t)||!hs(e))return[];let i=Bt(t)+"T00:00",n=Bt(e)+"T00:00",r=new Date(i),a=new Date(n),o=GU(a)&&GU(r)&&u(r,a),s=[],l=0;if(o){let c=r,d=c.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(c)),d=c.setDate(c.getDate()+1)}return s.map(c=>Nu(c));function u(c,d){return c<=d}}var i$e=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Qm(t){return typeof t!="string"?!1:i$e.test(t)}function Kq(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function ui(t){let e=an(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function n$e(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Bs(e),Bs(i)].join(":")}function dN(t){return Kq(t)?t.split(":").slice(0,2).map(Bs).join(":"):void 0}function an(t){return Qm(t)&&t.indexOf("T")>0?dN(t.split("T").reverse()[0]):dN(t)}function Bt(t){return Qm(t)||Ed.test(t)?t.split("T")[0]:void 0}function lT(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Bt(i.toISOString())}function pN(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function r$e(t){let e=pN(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Bs).join(":")}function a$e(t){var e;let i=pN(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function fb(t,e,i){let n=Bt(t),r=an(t),a=n?r:t;return t?e&&(n&&i&&t||r$e(a))||a$e(a):void 0}function Dpe(t,e){let i=pN(t),n=pN(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function Ppe(t,e=7){let i=Bt(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Nu(r)}function o$e(t){return Ppe(t)}function s$e(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Nu(r,i)}function l$e(t,e,i){let n=new Date(t,0);return Nu(new Date(n.setDate(e)),i)}function tr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Bs),r=cN(e).setHours(i,n,0,0);return cN(r)}function yP(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function Do(t,e){let i=an(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return an(Yq(tr(i),n).toISOString())}function Yq(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Bs(t){return t.toString()[1]?t:"0"+t}function Cd(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var u$e={addDays:Ppe,addWeek:o$e,addMinutesToTimeString:Do,convertTime:fb,getIsoDateString:uN,getUTCdateString:Wq,DateHHMM:JBe,extractDate:Bt,extractTime:an,formatDate:Nu,getDateByWeek:s$e,isISODateString:Qm,isDate:GU,isTimeString:Kq,offsetDate:cN,offsetTime:t$e,sameDay:Cd,timeStringMinutes:ui,timeToDate:tr,timeUTC:e$e,validTimeValue:iS,validDateString:lN,timeValidation:Pm,dateValidation:Ed};function ut(t,e,i,n,r=0){if(NB().makeDeepCopy)return NB().makeDeepCopy(t,e,i,n);let a=xq(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||$o(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let c=Array.isArray(t)?[]:{},d=Object.keys(t).filter(f=>!i||!l||Array.isArray(l)&&!l.includes(f)||$o(l)&&!l(f)),p=(f,h)=>{c[f]=$o(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let f of d){let h=t[f],m=$o(u)?u(h):void 0;if(m!==void 0)c[f]=m;else if(e&&f==="extensions"&&Array.isArray(h)){let g=Zq(h);Object.assign(c,...g)}else n&&f==="extensions"?c[f]=[]:Array.isArray(o)&&o.includes(f)?p(f,h):Array.isArray(s)&&s.includes(f)&&$o(h==null?void 0:h.toJSON)?c[f]=h.toJSON():h===null?c[f]=void 0:XBe(h)?c[f]=new Date(h).toISOString():c[f]=ut(h,e,i,n,r+1)}return c}function Zq(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var AB="voluntaryConsolation",rp="competitiveBands",Xq="roundRobinTally",Mp="positionActions",Vr="matchUpActions",UR="rankingPoints",Pw="roundNaming",nS="participant",HU="progression",jh="scheduling",zU="avoidance",c$e="display",Rd="scoring",Dl="seeding",Ew="feedIn",d$e="audit",fN="draws",p$e={POLICY_TYPE_VOLUNTARY_CONSOLATION:AB,POLICY_TYPE_COMPETITIVE_BANDS:rp,POLICY_TYPE_ROUND_ROBIN_TALLY:Xq,POLICY_TYPE_POSITION_ACTIONS:Mp,POLICY_TYPE_MATCHUP_ACTIONS:Vr,POLICY_TYPE_RANKING_POINTS:UR,POLICY_TYPE_ROUND_NAMING:Pw,POLICY_TYPE_PARTICIPANT:nS,POLICY_TYPE_PROGRESSION:HU,POLICY_TYPE_SCHEDULING:jh,POLICY_TYPE_AVOIDANCE:zU,POLICY_TYPE_DISPLAY:c$e,POLICY_TYPE_FEED_IN:Ew,POLICY_TYPE_SCORING:Rd,POLICY_TYPE_SEEDING:Dl,POLICY_TYPE_AUDIT:d$e,POLICY_TYPE_DRAWS:fN};function ph({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=ut(o,!1,r);if(s){let l=e==null?void 0:e[nS];if(i!=null&&i.withScaleValues){let{ratings:u,rankings:c}=tS({participant:s});s.rankings=c,s.ratings=u}if(l!=null&&l.participant)return cy({template:l.participant,source:s})}return s}var Jq="element required",f$e="missing name";function qa(t){if(!t||typeof t!="object")return{error:dt};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Se};if(!(t!=null&&t.name))return{error:dt,info:f$e};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=qa({element:i,name:t.name});if(n.error)return ue({result:n,stack:"removeExtension"})}return{...ae}}return{error:dt,info:Jq}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...ae}):{...ae,info:Pa}}function wc({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function hi(t){if(typeof t!="object")return{error:dt};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ue({result:{error:Se},stack:e});if(!wc({extension:t.extension}))return ue({result:{error:Se,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=hi({extension:t.extension,element:n});if(r.error)return ue({result:r,stack:e})}return{...ae}}else return ue({result:{error:dt},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ae}}function Qq(t){return!t||typeof t!="object"?{error:dt}:t.tournamentRecord?hi({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Oe}}function Qk(t){return!t||typeof t!="object"?{error:dt}:t.drawDefinition?hi({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Qo}}function Gh(t){return!t||typeof t!="object"?{error:dt}:t.event?hi({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:es}}function Epe(t){var e;if(!t||typeof t!="object")return{error:dt};if(!t.participantId)return{error:wr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ph({participantId:t.participantId,tournamentParticipants:i});return n?hi({creationTime:t.creationTime,extension:t.extension,element:n}):{error:qn}}function eW(t){return!t||typeof t!="object"?{error:dt}:t.tournamentRecord?qa({element:t.tournamentRecord,name:t.name}):{error:Oe}}function Cpe(t){return!t||typeof t!="object"?{error:dt}:t.drawDefinition?qa({element:t.drawDefinition,name:t.name}):{error:Qo}}function eO(t){return!t||typeof t!="object"?{error:dt}:t!=null&&t.event?qa({element:t.event,name:t.name}):{error:es}}function Rpe(t){var e;if(!t||typeof t!="object")return{error:dt};if(!t.participantId)return{error:wr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ph({participantId:t.participantId,tournamentParticipants:i});return n?qa({element:n,name:t.name}):{error:qn}}function bP({tournamentRecords:t}){return{tournamentIds:ln(t)?Object.keys(t):[],...ae}}var h$e="extensionQueries";function qt({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(u=>typeof t=="boolean"||Array.isArray(t)&&t.includes(u)).find(u=>{var c;return Array.isArray((c=n[u])==null?void 0:c.extensions)?n[u].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(u=>{var c;return(c=u.extensions)==null?void 0:c.length}));let l=(r=s==null?void 0:s.extensions)==null?void 0:r.find(u=>(u==null?void 0:u.name)===i);return{extension:l,info:l?void 0:Pa}}return ue({result:{error:dt},stack:h$e})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:Pa}}var m$e="activeSuspension",qU="appliedPolicies",hN="positionActions",Mpe="context",tO="delegatedOutcome",Au="disabled",iO="disableLinks",Cw="disableAutoCalc",mN="drawDeletions",g$e="drawProfile",gN="entryProfile",v$e="eventProfile",y$e="eventWithdrawalRequests",b$e="factory",zl="flightProfile",_B="groupingAttribute",Np="lineUps",dy="linkedTournamentsIds",nO="matchUpHistory",tW="participantRepresentatives",rS="personRequests",I$e="rankingPoints",Oc="roundTarget",IP="scheduleLimits",Ap="scheduleTiming",py="schedulingProfile",w$e="statusDetail",Rw="subOrder",fh="tally",fy="tieFormatModification",Npe={ACTIVE_SUSPENSION:m$e,APPLIED_POLICIES:qU,AUDIT_POSITION_ACTIONS:hN,CONTEXT:Mpe,DELEGATED_OUTCOME:tO,DISABLED:Au,DISABLE_LINKS:iO,DISABLE_AUTO_CALC:Cw,DRAW_DELETIONS:mN,DRAW_PROFILE:g$e,ENTRY_PROFILE:gN,EVENT_PROFILE:v$e,EVENT_WITHDRAWAL_REQUESTS:y$e,FLIGHT_PROFILE:zl,GROUPING_ATTRIBUTE:_B,LINEUPS:Np,LINKED_TOURNAMENTS:dy,MATCHUP_HISTORY:nO,PARTICIPANT_REPRESENTATIVES:tW,PERSON_REQUESTS:rS,RANKING_POINTS:I$e,ROUND_TARGET:Oc,SCHEDULE_LIMITS:IP,SCHEDULE_TIMING:Ap,SCHEDULING_PROFILE:py,STATUS_DETAIL:w$e,SUB_ORDER:Rw,TALLY:fh,TIE_FORMAT_MODIFICATIONS:fy,FACTORY:b$e},hK=[tO,Au,iO,zl,Np,nO,tW,rS,Oc,IP,Ap,py,Rw,fh];function Ape({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let e=bP({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?hi({tournamentRecords:t,discover:!0,extension:{name:dy,value:{tournamentIds:i}}}):{...ae}}function _pe({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let e=qa({name:dy,tournamentRecords:t,discover:!0});return ue({result:e,stack:"unlinkTournaments"})}function kpe({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Se};if(!e)return{error:bw};let i=bP({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:bw};let r;return n.every(a=>{var o;let s=t[a],{extension:l}=qt({element:s,name:dy});if(!l)return!0;let u=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(u!=null&&u.length)||u.length===1&&u.includes(e)||a===e){let p=eW({name:dy,tournamentRecord:s});return p.error&&(r=p.error),p.success}let c=u.filter(p=>p!==e);l.value={tournamentIds:c};let d=Qq({tournamentRecord:s,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...ae}}var Ope={};Yt(Ope,{getLinkedTournamentIds:()=>wP,getTournamentIds:()=>bP});function wP({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Rn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let n=t[e],r=n==null?void 0:n.tournamentId,{extension:a}=qt({element:n,name:dy}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==r);return{[e]:o}}))}}var xpe={};Yt(xpe,{addAdHocMatchUps:()=>_O,addDrawDefinitionTimeItem:()=>c4,addFinishingRounds:()=>PP,addGoesTo:()=>sg,addPlayoffStructures:()=>AO,addQualifyingStructure:()=>Lhe,addVoluntaryConsolationStage:()=>Ohe,addVoluntaryConsolationStructure:()=>XW,allPlayoffPositionsFilled:()=>s4,alternateDrawPositionAssignment:()=>ghe,assignDrawPosition:()=>cme,assignDrawPositionBye:()=>Ds,attachConsolationStructures:()=>ome,attachPlayoffStructures:()=>I4,attachQualifyingStructure:()=>u4,attachStructures:()=>NO,autoSeeding:()=>G3e,automatedPlayoffPositioning:()=>XP,automatedPositioning:()=>ZP,checkValidEntries:()=>LO,deleteAdHocMatchUps:()=>pme,drawMatic:()=>W4,findDrawDefinition:()=>D4,generateAdHocMatchUps:()=>FO,generateAdHocRounds:()=>q4,generateAndPopulatePlayoffStructures:()=>b4,generateDrawDefinition:()=>ax,generateDrawMaticRound:()=>L4,generateDrawStructuresAndLinks:()=>k4,generateDrawTypeAndModifyDrawDefinition:()=>O4,generateQualifyingStructure:()=>p4,generateVoluntaryConsolation:()=>$me,getAssignedParticipantIds:()=>Gg,getAvailableMatchUpsCount:()=>kO,getAvailablePlayoffProfiles:()=>QP,getDrawDefinitionTimeItem:()=>VW,getDrawParticipantRepresentativeIds:()=>T4,getDrawTypeCoercion:()=>lE,getEligibleVoluntaryConsolationParticipants:()=>S4,getMatchUpsMap:()=>ya,getParticipantIdFinishingPositions:()=>U4,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>vS,getSeedingThresholds:()=>t4,getSeedsCount:()=>uE,getStructureSeedAssignments:()=>nl,getTeamLineUp:()=>og,getValidGroupSizes:()=>KP,isAdHoc:()=>ns,isCompletedStructure:()=>yh,isValidForQualifying:()=>_4,luckyLoserDrawPositionAssignment:()=>mhe,modifyDrawDefinition:()=>sme,modifyDrawName:()=>w4,modifySeedAssignment:()=>Dhe,mutate:()=>Lpe,positionActions:()=>A4,pruneDrawDefinition:()=>ume,qualifierDrawPositionAssignment:()=>She,query:()=>mme,removeDrawPositionAssignment:()=>t1,removeRoundMatchUps:()=>fme,removeSeededParticipant:()=>xhe,removeStructure:()=>_he,renameStructures:()=>Ahe,resetDrawDefinition:()=>lme,resetVoluntaryConsolationStructure:()=>ofe,setDrawParticipantRepresentativeIds:()=>Fpe,setPositionAssignments:()=>Ihe,setStructureOrder:()=>Mhe,setSubOrder:()=>hme,shiftAdHocRounds:()=>bhe,swapAdHocRounds:()=>whe,swapDrawPositionAssignments:()=>Uhe,updateTeamLineUp:()=>Db,withdrawParticipantAtDrawPosition:()=>she});var Lpe={};Yt(Lpe,{addAdHocMatchUps:()=>_O,addDrawDefinitionTimeItem:()=>c4,addPlayoffStructures:()=>AO,addQualifyingStructure:()=>Lhe,addVoluntaryConsolationStage:()=>Ohe,addVoluntaryConsolationStructure:()=>XW,alternateDrawPositionAssignment:()=>ghe,assignDrawPosition:()=>cme,assignDrawPositionBye:()=>Ds,attachConsolationStructures:()=>ome,attachPlayoffStructures:()=>I4,attachQualifyingStructure:()=>u4,attachStructures:()=>NO,automatedPlayoffPositioning:()=>XP,automatedPositioning:()=>ZP,deleteAdHocMatchUps:()=>pme,luckyLoserDrawPositionAssignment:()=>mhe,modifyDrawDefinition:()=>sme,modifyDrawName:()=>w4,modifySeedAssignment:()=>Dhe,pruneDrawDefinition:()=>ume,qualifierDrawPositionAssignment:()=>She,removeDrawPositionAssignment:()=>t1,removeRoundMatchUps:()=>fme,removeSeededParticipant:()=>xhe,removeStructure:()=>_he,renameStructures:()=>Ahe,resetDrawDefinition:()=>lme,resetVoluntaryConsolationStructure:()=>ofe,setDrawParticipantRepresentativeIds:()=>Fpe,setPositionAssignments:()=>Ihe,setStructureOrder:()=>Mhe,setSubOrder:()=>hme,shiftAdHocRounds:()=>bhe,swapAdHocRounds:()=>whe,swapDrawPositionAssignments:()=>Uhe,updateTeamLineUp:()=>Db,withdrawParticipantAtDrawPosition:()=>she});var iW=t=>e=>t[e],nW=(t=[])=>t.map(Ar).filter(Boolean),kB=(t=[])=>t.map(ei).filter(Boolean),ei=(t={})=>iW(t)("participantId"),Ar=(t={})=>iW(t)("matchUpId"),WU=(t={})=>iW(t)("drawId");function Fpe({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Qo};if(!Array.isArray(t))return{error:Se};let i=kB((e==null?void 0:e.entries)||[]);return t.length&&$n(t,i).length<t.length?{error:Se}:Qk({drawDefinition:e,extension:{name:tW,value:t}})}var vs="ABANDONED",hb="AWAITING_RESULT",Di="BYE",af="CANCELLED",Zn="COMPLETED",aS="DEAD_RUBBER",bi="DEFAULTED",Ir="DOUBLE_DEFAULT",nr="DOUBLE_WALKOVER",nu="IN_PROGRESS",Sc="INCOMPLETE",rW="NOT_PLAYED",xa="RETIRED",Hh="SUSPENDED",Vn="TO_BE_PLAYED",Ni="WALKOVER",S$e=[hb,Zn,bi,nu,Sc,xa,Hh],Bpe=[hb,Zn,bi,nr,Ir,nu,Sc,xa,Hh,Ni],$pe=[vs,hb,Di,af,Zn,aS,bi,nr,Ir,nu,Sc,rW,xa,Hh,Vn,Ni],Vpe=[Di,nr,Ir,Zn,bi,xa,Ni],jpe=[vs,hb,af,aS,nu,Sc,rW,Hh,Vn,void 0],kr=[af,vs,Zn,aS,bi,nr,Ir,xa,Ni],aW=[vs,Zn,bi,nr,Ir,nu,xa,Ni],Gpe=[nu,Sc,Hh,Vn],Hpe={ABANDONED:vs,AWAITING_RESULT:hb,BYE:Di,CANCELLED:af,COMPLETED:Zn,DEAD_RUBBER:aS,DEFAULTED:bi,DOUBLE_WALKOVER:nr,DOUBLE_DEFAULT:Ir,IN_PROGRESS:nu,INCOMPLETE:Sc,NOT_PLAYED:rW,RETIRED:xa,SUSPENDED:Hh,TO_BE_PLAYED:Vn,WALKOVER:Ni},at="MAIN",vt="QUALIFYING",ha="CONSOLATION",jr="VOLUNTARY_CONSOLATION",An="PLAY_OFF",oW=[at,vt,ha,An,jr],hy={[vt]:1,[at]:2,[An]:3,[ha]:3,[jr]:4},zpe="finishingPositions",qpe="aggregateEventStructures",Wpe={[at]:1,[An]:2,[ha]:3,[vt]:4,[jr]:5},T$e={[An]:1,[at]:2,[ha]:3,[vt]:4,[jr]:5},rO="CLUSTER",U$e="SEPARATE",eg="WATERFALL",aO="ITEM",oo="CONTAINER",Su="DRAW",oO="RANDOM",Ml="TOP_DOWN",tg="BOTTOM_UP",_p="POSITION",kp="WINNER",Md="LOSER",Nd="FIRST_MATCHUP",ql="AD_HOC",D$e="AD_HOC",oS="FEED_IN",Mw="COMPASS",Nw="OLYMPIC",P$e="SINGLE_ELIMINATION",uc="SINGLE_ELIMINATION",SP="DOUBLE_ELIMINATION",Aw="FIRST_MATCH_LOSER_CONSOLATION",TP="FIRST_ROUND_LOSER_CONSOLATION",kg="LUCKY_DRAW",sO="CURTIS_CONSOLATION",E$e="CURTIS_CONSOLATION",sW="FEED_IN_CHAMPIONSHIP_TO_SF",KU="FEED_IN_CHAMPIONSHIP_TO_SF",lW="FEED_IN_CHAMPIONSHIP_TO_QF",YU="FEED_IN_CHAMPIONSHIP_TO_QF",uW="FEED_IN_CHAMPIONSHIP_TO_R16",ZU="FEED_IN_CHAMPIONSHIP_TO_R16",Kpe="MODIFIED_FEED_IN_CHAMPIONSHIP",XU="MODIFIED_FEED_IN_CHAMPIONSHIP",UP="FEED_IN_CHAMPIONSHIP",Wl="ROUND_ROBIN",Ad="ROUND_ROBIN_WITH_PLAYOFF",Ype="DECIDER",Zpe="BACKDRAW",cW={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},dW={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},sS="WIN_RATIO",mb="ROUND_OUTCOME",Xpe=[Mw,sO,YU,ZU,KU,UP,lW,uW,sW,Aw,TP,kg,XU,Nw,An,Ad],C$e=[ql,Mw,sO,SP,YU,ZU,KU,UP,oS,Aw,TP,kg,XU,Nw,An,Wl,Ad,uc],Jpe={MAIN:at,QUALIFYING:vt,CONSOLATION:ha,ITEM:aO,CONTAINER:oo,FIRST_MATCHUP:Nd,WINNER:kp,LOSER:Md,AD_HOC:ql,FEED_IN:oS,FLEX_ROUNDS:D$e,COMPASS:Mw,PLAY_OFF:An,OLYMPIC:Nw,KNOCKOUT:P$e,SINGLE_ELIMINATION:uc,DOUBLE_ELIMINATION:SP,CURTIS:sO,FICSF:sW,FICQF:lW,FICR16:uW,MFIC:Kpe,VOLUNTARY_CONSOLATION:jr,FIRST_MATCH_LOSER_CONSOLATION:Aw,FIRST_ROUND_LOSER_CONSOLATION:TP,MODIFIED_FEED_IN_CHAMPIONSHIP:XU,FEED_IN_CHAMPIONSHIP_TO_R16:ZU,FEED_IN_CHAMPIONSHIP_TO_QF:YU,FEED_IN_CHAMPIONSHIP_TO_SF:KU,FEED_IN_CHAMPIONSHIP:UP,LUCKY_DRAW:kg,ROUND_ROBIN_WITH_PLAYOFF:Ad,ROUND_ROBIN:Wl,DECIDER:Ype,BACKDRAW:Zpe,COMPASS_ATTRIBUTES:cW,OLYMPIC_ATTRIBUTES:dW,DRAW:Su,RANDOM:oO,TOP_DOWN:Ml,BOTTOM_UP:tg,WATERFALL:eg,WIN_RATIO:sS,ROUND_OUTCOME:mb,MULTI_STRUCTURE_DRAWS:Xpe,generatedDrawTypes:C$e,stageOrder:hy,finishOrder:Wpe,AGGREGATE_EVENT_STRUCTURES:qpe,FINISHING_POSITIONS:zpe},R$e=Jpe;function gb(t,e,i){var n,r;let a=f=>{var h,m;return(m=(h=qt({element:f,name:Oc}))==null?void 0:h.extension)==null?void 0:m.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===qpe&&T$e,l=(i==null?void 0:i.mode)===zpe&&Wpe,u=l||s||hy,c=f=>(f==null?void 0:f.stage)===at&&(f==null?void 0:f.stageSequence)===1,d=f=>c(f)?-1:u[f==null?void 0:f.stage],p=f=>f==null?void 0:f.matchUps.every(({matchUpStatus:h})=>kr.includes(h)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&u[t.stage]||0)-((e==null?void 0:e.stage)&&u[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t==null?void 0:t.positionAssignments)==null?void 0:r.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(vN(t)||0)-(vN(e)||0)}function vN(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function Pt(t){let e=wi(t,[{[Yu]:!0,[jq]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=_d({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:Tn};let s=o.structureType===aO?a==null?void 0:a.find(l=>{var u;return(u=l.structures)==null?void 0:u.some(c=>c.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function _d({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var l;let u=!e&&nt||!(e!=null&&e.structures)&&dq||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let c=m=>{var g,v;let y=(v=(g=qt({element:m,name:Oc}))==null?void 0:g.extension)==null?void 0:v.value;return!r||r===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(f).filter(h).filter(c).sort((m,g)=>gb(m,g,a)))??[],p=t?Object.assign({},...oW.map(m=>{let g=d==null?void 0:d.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function f(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function h(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function Qpe({drawDefinition:t}){if(!t)return{error:nt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Hi({structure:i}),a=(r==null?void 0:r.map(ei).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Hi({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:nt};if({structure:i,error:n}=Pt({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Hi({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=ude,{positionAssignments:r,error:n}}function Or({drawDefinition:t,structureId:e,structure:i}){var n;let r=((n=Hi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],a=r==null?void 0:r.filter(c=>c.participantId??c.bye??c.qualifier),o=r&&(r==null?void 0:r.length)===(a==null?void 0:a.length),s=r==null?void 0:r.filter(c=>!c.participantId&&!c.bye&&!c.qualifier),l=r==null?void 0:r.filter(c=>!c.participantId&&c.bye),u=r==null?void 0:r.filter(c=>!c.participantId&&c.qualifier);return{allPositionsAssigned:o,positionAssignments:r,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var pW="addDrawDefinition",lO="addMatchUps",hh="addParticipants",fW="addScaleItems",hW="addVenue",_w="audit",mW="deleteParticipants",gW="deleteVenue",vW="deletedDrawIds",yW="deletedMatchUpIds",bW="modifyDrawDefinition",efe="modifyDrawEntries",tfe="modifyEventEntries",IW="modifyMatchUp",ma="modifyParticipants",wW="modifyPositionAssignments",SW="modifySeedAssignments",ife="modifyTournamentDetail",Og="modifyVenue",OB="mutations",xB="publishEvent",nfe="publishEventSeeding",rfe="publishOrderOfPlay",TW="unPublishEvent",UW="unPublishEventSeeding",DW="unPublishOrderOfPlay",uO="updateInContextMatchUp",M$e={ADD_DRAW_DEFINITION:pW,ADD_MATCHUPS:lO,ADD_PARTICIPANTS:hh,ADD_SCALE_ITEMS:fW,ADD_VENUE:hW,AUDIT:_w,DELETE_PARTICIPANTS:mW,DELETE_VENUE:gW,DELETED_DRAW_IDS:vW,DELETED_MATCHUP_IDS:yW,MODIFY_DRAW_DEFINITION:bW,MODIFY_DRAW_ENTRIES:efe,MODIFY_EVENT_ENTRIES:tfe,MODIFY_MATCHUP:IW,MODIFY_PARTICIPANTS:ma,MODIFY_POSITION_ASSIGNMENTS:wW,MODIFY_SEED_ASSIGNMENTS:SW,MODIFY_TOURNAMENT_DETAIL:ife,MODIFY_VENUE:Og,MUTATIONS:OB,PUBLISH_EVENT_SEEDING:nfe,PUBLISH_EVENT:xB,PUBLISH_ORDER_OF_PLAY:rfe,UNPUBLISH_EVENT_SEEDING:UW,UNPUBLISH_EVENT:TW,UNPUBLISH_ORDER_OF_PLAY:DW,UPDATE_INCONTEXT_MATCHUP:uO};function cO(t,e){var i;if(!t)return{error:nt};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=r)}),{...ae}}function mh({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&cO(t),oi({payload:{matchUps:i,tournamentId:e,eventId:n},topic:lO}),{...ae}}function of({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&cO(t),oi({topic:yW,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)Fq({key:a});return{...ae}}function di({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Qi({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),oi({topic:IW,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...ae}):(console.log(No),{error:No})}function N$e({tournamentId:t,inContextMatchUp:e}){return e?(oi({payload:{inContextMatchUp:e,tournamentId:t},topic:uO,key:e.matchUpId}),{...ae}):{error:No}}function DP({tournamentId:t,eventId:e,drawDefinition:i}){return i?(cO(i),oi({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:pW,key:i.drawId}),{...ae}):(console.log(nt),{error:nt})}function A$e({tournamentId:t,eventId:e,drawId:i}){return oi({payload:{drawId:i,tournamentId:t,eventId:e},topic:vW,key:i}),Fq({key:i}),{...ae}}function Qi({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(cO(t,i),oi({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:bW,key:t.drawId}),{...ae}):{error:nt}}function afe({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:nt};if(!i)return{error:Lh};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return oi({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:SW,key:t.drawId}),Qi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...ae}}function gh({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:nt};if(!i)return{error:Lh};let r=Hi({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return oi({topic:wW,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),Qi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...ae}}function ofe({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,a;if(!e)return{error:nt};let o=(r=e.structures)==null?void 0:r.find(l=>l.stage===jr);if(!o)return{error:Tn};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],of({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==jr)),Qi({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...ae}}function PW({drawPositions:t,structure:e}){var i;if([vt,at].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:n}=Hi({structure:e});(i=n==null?void 0:n.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||i.forEach(r=>{hi({element:r,extension:{name:iO,value:!0}})})}function dO({drawDefinition:t,positionAction:e}){var i;let{extension:n}=qt({name:hN,element:t}),r=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(r!=null&&r.length)){let o=t.structures.find(s=>s.stage===at);if(o){let s=(i=Hi({structure:o}).positionAssignments)==null?void 0:i.map(({drawPosition:l,participantId:u,bye:c,qualifier:d})=>({drawPosition:l,participantId:u,qualifier:d,bye:c}));r.push({name:"initialMainAssignments",initialAssignments:s})}}let a={name:hN,value:r.concat(e)};hi({element:t,extension:a})}function lS({tournamentRecord:t,drawDefinition:e,event:i}){var n;let r=((n=(t==null?void 0:t.events)||i&&[i])==null?void 0:n.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map(l=>{var u;return(u=l==null?void 0:l.structures)==null?void 0:u.filter(c=>c==null?void 0:c.structures)}).flat().filter(Boolean);for(let l of s){let{structures:u,structureId:c}=l??{};u&&c&&(a[c]=u==null?void 0:u.map(d=>d.structureId))&&u.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}var kv="SINGLES",Pn="SINGLES",ig="DOUBLES",Yi="DOUBLES",Tc="TEAM",Xi="TEAM",_$e={SINGLES_MATCHUP:kv,SINGLES:Pn,DOUBLES_MATCHUP:ig,DOUBLES:Yi,TEAM_MATCHUP:Tc,TEAM:Xi};function pO(t){var e;let{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>n===Yi?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return n===Yi&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function xc(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function fO(t){if(!ln(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>At(a)||a===void 0||a===null);return n&&r}function pl(t){return Array.isArray(t)?t.every(fO):!1}function to({matchUps:t=[],interpolate:e}){var i;if(!pl(t))return{roundMatchUps:[],error:Se};let n=t.reduce((p,f)=>{let h=typeof f.roundNumber=="string"?Tt(f.roundNumber):f.roundNumber;return!f.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(lr).map(p=>{let f=t.filter(g=>g.roundNumber===p),h=f.find(({matchUpType:g})=>g===Xi)?f.filter(({matchUpType:g})=>g===Xi):f,m=g=>g.sort((v,y)=>lr(v.roundPosition,y.roundPosition));return{[p]:m(h)}}),r=t.reduce((p,f)=>{let h=typeof f.roundNumber=="string"?Tt(f.roundNumber):f.roundNumber;return p[h]||(p[h]=ft({abbreviatedRoundName:f.abbreviatedRoundName,finishingRound:f.finishingRound,roundName:f.roundName})),p},{}),a=Object.assign({},...n);if(e){let p=Math.max(...Object.keys(a).map(h=>Tt(h)).filter(h=>!isNaN(h))),f=(i=a[p])==null?void 0:i.length;if(f>1&&$u(f)){let h=p+1,m=h+f/2;Je(h,m).forEach((g,v)=>{a[g]=Je(0,f/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var f,h,m;let g=(f=a[p])==null?void 0:f.length,v=(m=(h=a[p])==null?void 0:h.filter(b=>{var I;return!kr.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,u=0,c=Object.keys(a).map(p=>Tt(p)).filter(p=>!isNaN(p));c.forEach(p=>{var f,h,m,g,v;let y=a[p].sort((I,T)=>I.roundPosition-T.roundPosition),b=y.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(f=r[p])==null?void 0:f.finishingRound,s[p].roundName=(h=r[p])==null?void 0:h.roundName,s[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let I=b.sort(lr),T=Yr(I,2);s[p].drawPositions=I,s[p].pairedDrawPositions=T}else{let I=s[p-1],T=I.drawPositions,w=I.matchUpsCount/s[p].matchUpsCount,S=Yr(T,w),U=y.map(P=>{let{roundPosition:E}=P,D=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return D;let R=(D==null?void 0:D.filter(Boolean))||[];if(!(R!=null&&R.length))return[void 0,void 0];if(p<3&&(R==null?void 0:R.length)===2)return D==null?void 0:D.slice().sort(lr);let N=$n(T,R).length!==(R==null?void 0:R.length);if(R!=null&&R.length&&N)return(R==null?void 0:R.length)===1?[R[0],void 0]:D==null?void 0:D.slice().sort(lr);let M=(E-1)*2;return S.slice(M,M+2).map(A=>R==null?void 0:R.find(_=>A.includes(_)))});s[p].drawPositions=U==null?void 0:U.flat(),s[p].pairedDrawPositions=U}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=u,s[p].preFeedRound=!0,u+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!$u(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:c,roundProfile:s,...ae}}function Ov({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=ut(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:u=[],significantCharacters:c}){for(let[p,f]of u.entries())if(l!=null&&l[f]){let h=u.slice(p+1);h.length?Array.isArray(l[f])?l[f].forEach(m=>s({targetElement:m,attributes:h})):(l=l[f],d({targetElement:l,index:p})):(a||(a=l[f]),r.includes(l[f])||r.push(l[f]))}function d({targetElement:p,index:f}){if(p&&f===u.length-1&&["string","number"].includes(typeof p)){let h=c?p.slice(0,c):p;a?r.includes(h)||r.push(h):(a=h,r.push(h))}}}}var sfe=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Ov({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Ov({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Ov({element:e,accessor:t}))==null?void 0:i.value)},is=sfe;function PP({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var l;if(!pl(a))return[];let{roundProfile:u,roundNumbers:c=[]}=to({interpolate:!0,matchUps:a});n=n??Math.max(...c,0);let d=r?n-r:0,p=d&&((l=u==null?void 0:u[n-d])==null?void 0:l.matchUpsCount),f=u&&Object.values(u).map(is("matchUpsCount")),h=(v,y)=>{let b=Math.min(...v);p&&y&&b===1&&(b=p);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},m=u&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-d,b=u[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=f==null?void 0:f.slice(v-1).reduce((N,M)=>N+(M||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),U=1,P=Je(S,o?S+b*2:T+S+U),E=T+U-b,D=h(P.slice(E)),R=h(P.slice(0,E),!0);return I.finishingPositionRange={loser:D,winner:R},{[v]:I}})),g=il({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function ya({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(u=>{let{structureName:c}=u,d=u.matchUps;i[u.structureId]={matchUps:d,itemStructureIds:[],structureName:c},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(u.structureId)});else{let u=o;i[a]={matchUps:u,itemStructureIds:[]},u==null||u.forEach(c=>{n.push(c),c.tieMatchUps&&n.push(...c.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function ng({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(u=>Object.assign(ut(u,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}var EP="SIGN_IN_STATUS",lfe="SIGNED_OUT",JU="SIGNED_IN",Ws="TEAM",ti="INDIVIDUAL",Us="GROUP",xt="PAIR",qi="TEAM",OT={TEAM_PARTICIPANT:Ws,INDIVIDUAL:ti,GROUP:Us,TEAM:qi,PAIR:xt},k$e={INDIVIDUAL:ti,GROUP:Us,PAIR:xt,TEAM:qi,SIGN_IN_STATUS:EP,SIGNED_OUT:lfe,SIGNED_IN:JU};function EW({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?ut(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===qi),o=r.filter(l=>l.participantType===Us),s=r.filter(l=>l.participantType===xt);return r.forEach(l=>{if(l.participantType===ti){let{participantId:u}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{var p;d===u&&!((p=l.teamParticipantIds)!=null&&p.includes(c.participantId))&&(l.teamParticipantIds.push(c.participantId),n.get(c.participantId)||n.set(c.participantId,{participantName:c.participantName,participantId:c.participantId}),l.teams.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId,teamId:c.teamId}))})}),s.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.pairParticipantIds.includes(c.participantId)&&l.pairParticipantIds.push(c.participantId)})}),o.forEach(c=>{((c==null?void 0:c.individualParticipantIds)||[]).forEach(d=>{d===u&&!l.groupParticipantIds.includes(c.participantId)&&(l.groupParticipantIds.push(c.participantId),l.groups.push({participantRoleResponsibilities:c.participantRoleResponsibilities,participantOtherName:c.participantOtherName,participantName:c.participantName,participantId:c.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function CW({drawDefinition:t,attributes:e}){let{extension:i}=qt({element:t,name:gN}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:gN,value:n},Qk({drawDefinition:t,extension:i}),{entryProfile:n}}function CP({drawDefinition:t}){let{extension:e}=qt({element:t,name:gN});return{entryProfile:(e==null?void 0:e.value)||{}}}var xl="ALTERNATE",RP="CONFIRMED",ys="DIRECT_ACCEPTANCE",MP="FEED_IN",NP="JUNIOR_EXEMPT",Op="LUCKY_LOSER",AP="ORGANISER_ACCEPTANCE",_P="QUALIFIER",O$e="REGISTERED",kP="SPECIAL_EXEMPT",ru="UNGROUPED",xg="UNPAIRED",kw="WILDCARD",xp="WITHDRAWN",DR=[RP,ys,NP,AP,kP],ufe=[MP,Op,_P],Lg=[RP,ys,MP,NP,AP,kP,kw],au=[RP,ys,NP,Op,_P,AP,kP,kw],cfe=[xl,RP,ys,MP,NP,Op,AP,_P,O$e,kP,ru,xg,kw,xp],x$e={ALTERNATE:xl,CONFIRMED:RP,DIRECT_ACCEPTANCE:ys,DIRECT_ENTRY_STATUSES:Lg,DRAW_SPECIFIC_STATUSES:ufe,EQUIVALENT_ACCEPTANCE_STATUSES:DR,FEED_IN:MP,JUNIOR_EXEMPT:NP,LUCKY_LOSER:Op,ORGANISER_ACCEPTANCE:AP,QUALIFIER:_P,SPECIAL_EXEMPT:kP,STRUCTURE_SELECTED_STATUSES:au,UNGROUPED:ru,UNPAIRED:xg,VALID_ENTRY_STATUSES:cfe,WILDCARD:kw,WITHDRAWN:xp};function RW({stage:t,drawDefinition:e}){let{entryProfile:i}=CP({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&oW.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return CW({drawDefinition:e,attributes:r}),!0}return n}function L$e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=CP({drawDefinition:e});return((i=n[t])==null?void 0:i.alternates)||0}function F$e({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=CP({drawDefinition:e});return((i=n[t])==null?void 0:i.wildcardsCount)||0}function LB({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function vb({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var f,h;let m=(h=(f=qt({name:Oc,element:p}))==null?void 0:f.extension)==null?void 0:h.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===An){let{playoffEntries:d,error:p}=B$e({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(f=>!e||f.placementGroup===e)}return c}function B$e({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===_p&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=Pt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===oo&&(s.structures??[]).forEach(l=>{let u=l.positionAssignments??[],{structureId:c}=l,d=c,p=Object.assign({},...u.map(m=>{var g;let{participantId:v}=m,y=(g=qt({element:m,name:fh}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),f=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,h=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||f)&&h.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...a??[]].sort(lr).indexOf(I)+1;n.push({entryStage:An,entryStatus:MP,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function $$e({stage:t,drawDefinition:e}){return Lg.reduce((i,n)=>(LB({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function nl({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var a;let o,s=[];r||({structure:r,error:o}=Pt({drawDefinition:i,structureId:n}));let l=Hi({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:Tn};n||(n=r.structureId);let{stage:u,stageSequence:c}=r,d=u===An&&i&&vb({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:u}),p=d?d.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],f=p==null?void 0:p.slice(0,e?p.length:l.length/2);f.length?s=f:r.seedAssignments?s=r.seedAssignments:o=ede;let h=r.seedLimit??((a=r==null?void 0:r.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:c,seedLimit:h,stage:u,error:o}}var dfe="WALKOVER",mK="RETIRED",MW="COMPETITIVE",QU="ROUTINE",e1="DECISIVE",PR="winRatio",V$e=(t,e)=>(t||0)+(e||0);function pfe(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&dfe||i<=e[e1]&&e1||i<=e[QU]&&QU||MW}function ffe({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(V$e)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function j$e(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function hfe(t){return t.map(j$e).sort().map(e=>parseFloat(e.toFixed(2)))}function Ai({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:gq};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...ae};function s(l){var u,c;let d=(c=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===qU))==null?void 0:c.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=ut(d[p],!1,!0))}}function sf({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:gq};let{appliedPolicies:a}=Ai({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Sw.message}}function Fg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:Oe};let{appliedPolicies:a}=Ai({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:Sw==null?void 0:Sw.message}}var G$e={[rp]:{policyName:"Competitive Bands Default",profileBands:{[e1]:20,[QU]:50}}},NW=G$e;function OP({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:No};let{score:n,winningSide:r}=i;if(!r)return{error:Se};let a=!e&&t&&Fg({policyType:rp,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||NW[rp].profileBands,s=ffe({score:n}),l=hfe([s]),u=pfe(l,o),c=Array.isArray(l)?l[0]:l;return{...ae,competitiveness:u,pctSpread:c}}function mfe({matchUp:t}){var e,i,n;if(!t)return{error:No};if(t&&!t.sides)return{error:go};if(t&&!t.hasContext)return{error:Gk};let r=(e=t.sides??[])==null?void 0:e.map(u=>u==null?void 0:u.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(u=>{var c;return((c=u.participant)==null?void 0:c.participantType)===ti}).map(u=>u.participantId).filter(Boolean))??[],o=(((n=t.sides??[])==null?void 0:n.map(u=>{var c;return(c=u.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(u=>(u??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=Ht(s.concat(r)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:r,...ae}}var yN="CHECK_IN",bN="CHECK_OUT",H$e="SCHEDULE",uS="SCHEDULE.ASSIGNMENT.VENUE",Lp="SCHEDULE.ALLOCATION.COURTS",rg="SCHEDULE.ASSIGNMENT.COURT",AW="SCHEDULE.COURT.ORDER",cS="SCHEDULE.DATE",z$e="COMPLETED.DATE",gfe="SCHEDULE.ASSIGN.OFFICIAL",dS="SCHEDULE.TIME.SCHEDULED",Tu="SCHEDULE.TIME.START",dp="SCHEDULE.TIME.STOP",ld="SCHEDULE.TIME.RESUME",Fp="SCHEDULE.TIME.END",_W="SCHEDULE.TIME.MODIFIERS",vfe="TO_BE_ANNOUNCED",yfe="NEXT_AVAILABLE",bfe="FOLLOWED_BY",Ife="AFTER_REST",wfe="RAIN_DELAY",q$e="NOT_BEFORE",FB=[vfe,yfe,bfe,Ife,wfe],W$e="ELIGIBILITY",K$e="REGISTRATION",Y$e="SUSPENSION",Z$e="MEDICAL",X$e="PENALTY",Sfe="SCALE",Tfe="RATING",Ufe="RANKING",kW="SEEDING",Bg="PUBLISH",ou="PUBLIC",$g="STATUS",J$e="MODIFICATION",Q$e="RETRIEVAL",eVe="other",tVe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:FB,AFTER_REST:Ife,ALLOCATE_COURTS:Lp,ASSIGN_COURT:rg,ASSIGN_OFFICIAL:gfe,ASSIGN_VENUE:uS,CHECK_IN:yN,CHECK_OUT:bN,COMPLETED_DATE:z$e,COURT_ORDER:AW,ELIGIBILITY:W$e,END_TIME:Fp,FOLLOWED_BY:bfe,MEDICAL:Z$e,MODIFICATION:J$e,NEXT_AVAILABLE:yfe,NOT_BEFORE:q$e,OTHER:eVe,PENALTY:X$e,PUBLIC:ou,PUBLISH:Bg,RANKING:Ufe,RATING:Tfe,RAIN_DELAY:wfe,REGISTRATION:K$e,RESUME_TIME:ld,RETRIEVAL:Q$e,SCALE:Sfe,SCHEDULE:H$e,SCHEDULED_DATE:cS,SCHEDULED_TIME:dS,SEEDING:kW,START_TIME:Tu,STATUS:$g,STOP_TIME:dp,SUSPENSION:Y$e,TIME_MODIFIERS:_W,TO_BE_ANNOUNCED:vfe};function yb({matchUp:t}){if(!t)return{error:No};if(!t.hasContext)return{error:Gk};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:go};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=mfe({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[yN,bN].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===yN);e==null||e.forEach((s,l)=>{let u=n==null?void 0:n[l],c=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));u&&c&&!a.includes(u)&&a.push(u)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(u=>{u&&!a.includes(u)&&a.push(u)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...ae}}var Dfe={[Pn]:[Pn,"S"],[Yi]:[Yi,"D"],[Xi]:[Xi,"T"],S:[Pn,"S"],D:[Yi,"D"],T:[Xi,"T"]},xn=t=>e=>{let i=ln(e)&&(e==null?void 0:e.matchUpType)||mo(e)&&e;return i&&Dfe[t].includes(i)};function xT(t){var e;let{matchUpAverageTimes:i,matchUpFormat:n}=t||{},r=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===n)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=r.includes(n)?n:r[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function LT(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&n){let{greaterThan:l=0,lessThan:u=360}=o;if(n>l&&n<u)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:e.recoveryTimes}function Pfe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function iVe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var l;let u=(e==null?void 0:e.matchUpRecoveryTimes)&&LT({...e,averageMinutes:i,matchUpFormat:r}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&LT({...t,averageMinutes:i,matchUpFormat:r}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&LT({...s,averageMinutes:i,matchUpFormat:r}),p=[u,c,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,n==null?void 0:n.recoveryTimes];return Pfe({categoryName:a,categoryType:o,timesBlockArray:p})}function nVe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&xT({...a,matchUpFormat:t}),u=(r==null?void 0:r.matchUpAverageTimes)&&xT({...r,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&xT({...o,matchUpFormat:t}),d=[l,u,c,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,n==null?void 0:n.averageTimes];return Pfe({categoryName:e,categoryType:i,timesBlockArray:d})}function xP({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,o,s,l,u;e=e??((r=n==null?void 0:n.category)==null?void 0:r.categoryName)??((a=n==null?void 0:n.category)==null?void 0:a.ageCategoryCode),i=i??((o=n==null?void 0:n.category)==null?void 0:o.categoryType)??((s=n==null?void 0:n.category)==null?void 0:s.subType);let{policy:c}=Fg({policyType:jh,tournamentRecord:t,event:n}),d=(l=t?qt({element:t,name:Ap}).extension:void 0)==null?void 0:l.value,p=(u=n&&qt({name:Ap,element:n}).extension)==null?void 0:u.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:c}}}var Efe="DOUBLES_SINGLES",Cfe="SINGLES_DOUBLES",Ll="total",BB="participantConflict",Af="matchUpConflict",Rfe="ISSUE_IDS",pm="CONFLICT",fm="WARNING",$B="ERROR",VB="ISSUE",ER="STATE",rVe={SINGLES_DOUBLES:Cfe,DOUBLES_SINGLES:Efe,TOTAL:Ll,CONFLICT_MATCHUP_ORDER:Af,CONFLICT_PARTICIPANTS:BB,SCHEDULE_ISSUE_IDS:Rfe,SCHEDULE_CONFLICT:pm,SCHEDULE_WARNING:fm,SCHEDULE_ERROR:$B,SCHEDULE_ISSUE:VB,SCHEDULE_STATE:ER},kd="SINGLES",my="SINGLES",Kl="DOUBLES",vh="DOUBLES",Rr="TEAM",rl="TEAM",aVe="AGE",oVe="RATING",sVe="BOTH",lVe={AGE:aVe,BOTH:sVe,DOUBLES:Kl,DOUBLES_EVENT:vh,RATING:oVe,SINGLES:kd,SINGLES_EVENT:my,TEAM_EVENT:rl,TEAM:Rr};function LP({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:Oe};o=o??(s==null?void 0:s.eventType)??my;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=xP({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),c={...u,matchUpFormat:n,categoryType:a,defaultTiming:l};return hO({eventType:o,timingDetails:c})}function hO({timingDetails:t,eventType:e}){let i=nVe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=iVe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=xn(my)(e)?Cfe:Efe,u=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:u}}function dC(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Vg({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||dC(a)<new Date(t).getTime())).sort((a,o)=>dC(a)-dC(o)).pop(),r=n&&dC(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function jB({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:dS,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function ag({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:cS,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function Mfe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Lp,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:ut(r,!1,!0)}:i}function Nfe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:rg,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function Afe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:uS,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function OW({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:_W,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Qg(t){if(Upe.test(t)){let e=Wq();return new Date(`${e}T${t}`)}else return new Date(t)}function uVe({matchUp:t}){if(!t)return{error:No};if(!t.timeItems)return{error:Cq};let e=t.timeItems.filter(n=>[Tu,dp,ld,Fp].includes(n==null?void 0:n.itemType)).sort((n,r)=>Qg(n.itemValue).getTime()-Qg(r.itemValue).getTime()),i=e.reduce((n,r)=>{var a,o;let s,l=(a=r==null?void 0:r.itemType)==null?void 0:a.split("."),u=`SCHEDULE.TIME.${((o=r==null?void 0:r.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(u){case Tu:s=0;break;case Fp:if(n.lastValue&&[Tu,ld].includes(n.lastType)){let c=Qg(r.itemValue).getTime()-Qg(n.lastValue).getTime();s=n.milliseconds+c}else s=n.milliseconds;break;case dp:if([Tu,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let c=Qg(r.itemValue).getTime()-Qg(n.lastValue).getTime();s=n.milliseconds+c}else s=n.milliseconds;break;default:s=n.milliseconds;break}return{milliseconds:s,lastType:u,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([Tu,ld].includes(i.lastType)){let n=new Date().getTime()-Qg(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:cVe(i.milliseconds),relevantTimeItems:e}}function cVe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function dVe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Vg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:AW,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function pVe({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(e=i.reduce((r,a)=>{let o=a.itemType===Tu&&a;return o&&(!r||n(o)<n(r))?o:r},void 0))==null?void 0:e.itemValue}}function fVe(t=1){return Je(0,t).map(Li)}function Li(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function FP(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Se};let r=xc(t);i.venueId||(i.venueId=Li());let a;for(let o of Object.values(r)){let s=hVe({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||oi({topic:hW,payload:{venue:i}}),ft({...ae,venue:a})}function hVe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=Li()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:kde}:(i&&hi({element:n,extension:{value:i,name:Mpe}}),t.venues.push(n),e||oi({payload:{venue:n,tournamentId:t.tournamentId},topic:hW}),{...ae,venue:ut(n)})):{error:dt,info:"missing venue"}:{error:Oe}}function lf({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Oe};if(!i)return{error:Bh};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(wP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=lf({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return FP({tournamentRecord:e,venue:s.venue}),{...ae,venue:n}}}return n?{...ae,venue:n}:{error:X0}}function xW({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=lf({tournamentRecords:i,tournamentRecord:n,venueId:r});return ut(a,t,!0)}function bb({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Oe};if(!i)return{error:ub};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...ae,court:r,venue:a};if(t){let o=(wP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],u=bb({tournamentRecord:l,courtId:i});if(u.success)return u.venue&&FP({tournamentRecord:e,venue:u.venue}),{...ae,court:r,venue:a}}}return ue({result:{error:fP},stack:n})}function _fe(t){return ut(bb(t),!1,!0)}function mO({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Oe};if(!i)return{error:ub};let n=bb({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:u,longitude:c,surfaceCategory:d,surfaceType:p,surfacedDate:f,pace:h,notes:m}))(n.court);return{...ae,courtInfo:ut(r,!1,e)}}function Ow({tournamentRecord:t,venueId:e}){var i;if(!t)return{error:Oe};if(!e)return{error:Bh};let n=lf({tournamentRecord:t,venueId:e});if(n.error)return n;let r=(((i=n.venue)==null?void 0:i.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(mO({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),a=n.venue&&(({venueId:s,venueName:l,venueAbbreviation:u})=>({venueAbbreviation:u,venueName:l,venueId:s}))(n.venue),o=a&&{...a,courtsInfo:r};return{...ae,venueData:ut(o,!1,!0)}}function mVe({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(e=i.reduce((r,a)=>{let o=a.itemType===Fp&&a;return o&&(!r||n(o)>n(r))?o:r},void 0))==null?void 0:e.itemValue}}function Hn({event:t,eventId:e}){var i,n;if(!t)return{error:Oi};let r=(i=qt({name:zl,element:t}))==null?void 0:i.extension,a=e?ut(r==null?void 0:r.value,!1,!0):r==null?void 0:r.value;return e&&((n=t.drawDefinitions)==null||n.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function vo(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:u,tournamentId:c})=>(u&&u.forEach(d=>{a[d.eventId]={tournamentId:c}}),u??[])).flat(),l;if(n){let u,c=s.find(d=>{var p,f,h;let m=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(m)u=m,l=a[d.eventId].tournamentId;else{let g=(h=(f=d&&((p=Hn({event:d}))==null?void 0:p.flightProfile))==null?void 0:f.flights)==null?void 0:h.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return m});if(c)return{event:c,drawDefinition:u,tournamentId:l}}if(i){let u=s.find(c=>(c==null?void 0:c.eventId)===i);if(u)l=a[u.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ue({result:{error:es},stack:r})};return{event:u,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ue({result:{error:Qo},context:{drawId:n,eventId:i},stack:r})}}function gO(t){var e,i,n,r,a,o,s,l,u;let c=t.event,d=t.matchUpType,{scheduleVisibilityFilters:p,afterRecoveryTimes:f,tournamentRecord:h,usePublishState:m,scheduleTiming:g,matchUpFormat:v,publishStatus:y,matchUp:b}=t;if(!b)return{error:No};if(f&&!b.matchUpType&&!t.matchUpType&&(c||h)&&b.drawId){let A=(e=c==null?void 0:c.drawDefinitions)==null?void 0:e.find(k=>k.drawId===b.drawId);!A&&h&&({drawDefinition:A,event:c}=vo({tournamentRecord:h,drawId:b.drawId}));let _=b.structureId&&((i=A==null?void 0:A.structures)==null?void 0:i.find(({structureId:k})=>k===b.structureId));d=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(c==null?void 0:c.eventType)!==Rr&&(c==null?void 0:c.eventType)}let{milliseconds:I,time:T}=uVe({matchUp:b}),{startTime:w}=pVe({matchUp:b}),{endTime:S}=mVe({matchUp:b}),U,{visibilityThreshold:P,eventIds:E,drawIds:D}=p??{};if((!E||E.includes(b.eventId))&&(!D||D.includes(b.drawId))){let A={matchUp:b,visibilityThreshold:P},{allocatedCourts:_}=Mfe(A),{scheduledTime:k}=jB(A),{scheduledDate:B}=ag(A),{venueId:F}=Afe(A),{courtId:x}=Nfe(A),{courtOrder:$}=dVe(A),{timeModifiers:j}=OW(A),V,H,z,q,W,Y=b.matchUpType??d;if(g&&k&&f&&Y){let ie={matchUpFormat:b.matchUpFormat??v,...g};({averageMinutes:H=0,recoveryMinutes:z=0,typeChangeRecoveryMinutes:q=0}=hO({timingDetails:ie,eventType:Y})),(H||z)&&(V=S?Do(an(S),z):Do(k,H+z)),q&&(W=S?Do(an(S),q):Do(k,H+q))}!B&&k&&(B=Bt(k));let Z=uN({scheduledDate:B,scheduledTime:k}),X={},Q=((n=h&&F&&Ow({tournamentRecord:h,venueId:F}))==null?void 0:n.venueData)||{};F&&(X[F]=Q);let{venueName:ce,venueAbbreviation:J,courtsInfo:ee}=Q,ne=(r=x&&(ee==null?void 0:ee.find(ie=>ie.courtId===x)))==null?void 0:r.courtName;for(let ie of _||[]){if(!h)break;ie.venueId&&!X[ie.venueid]&&(X[ie.venueId]=(a=Ow({venueId:ie.venueId,tournamentRecord:h}))==null?void 0:a.venueData);let oe=X[ie.venueId];ie.venueName=oe==null?void 0:oe.venueName;let se=(o=oe==null?void 0:oe.courtsInfo)==null?void 0:o.find(pe=>pe.courtId===ie.courtId);ie.courtName=se==null?void 0:se.courtName}U=ft({typeChangeTimeAfterRecovery:W,timeAfterRecovery:V,scheduledDate:B,scheduledTime:k,isoDateString:Z,allocatedCourts:_,timeModifiers:j,venueAbbreviation:J,venueName:ce,venueId:F,courtOrder:$,courtName:ne,courtId:x,typeChangeRecoveryMinutes:q,recoveryMinutes:z,averageMinutes:H,milliseconds:I,startTime:w,endTime:S,time:T})}else U=ft({milliseconds:I,startTime:w,endTime:S,time:T});let{scheduledDate:R}=ag({matchUp:b}),{scheduledTime:N}=jB({matchUp:b});if(m&&(s=y==null?void 0:y.displaySettings)!=null&&s.draws){let A=y.displaySettings.draws,_=(l=(A==null?void 0:A[b.drawId])??(A==null?void 0:A.default))==null?void 0:l.scheduleDetails;if(_){let k=(u=_.find(B=>{var F;return R&&((F=B.dates)==null?void 0:F.includes(R))})??_.find(B=>{var F;return!((F=B.dates)!=null&&F.length)}))==null?void 0:u.attributes;if(k){let B=Object.assign({},...Object.keys(U).map(F=>({[F]:!0})),k);U=cy({source:U,template:B})}}}let M=b.matchUpStatus&&kr.includes(b.matchUpStatus)&&(Bt(S)||Bt(R)||Bt(N))||void 0;return{schedule:U,endDate:M}}function Of(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function FT({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(s=>t.tieFormatId===s.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function _a({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:FT({item:i,drawDefinition:t,structure:e,event:n})||FT({item:e,drawDefinition:t,structure:e,event:n})||Of(t)||Of(n)}}function gVe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function kfe({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Yr(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(lr);return i.map(r=>n.indexOf(r)+1)}function CR(t){if(!Array.isArray(t))return"";let e=t.filter(Mn);return e.length?Ht([Math.min(...e),Math.max(...e)]).join("-"):""}function vVe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:nt};if(!e)return{error:Ts};let{structure:n}=Pt({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==ha)return{error:Ag,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:f}=p.source;return d.includes(f)?d:d.concat(f)},[]))||[],s=Object.assign({},...o.map(d=>{let p=ng({structureId:d,matchUpsMap:i}),f=to({matchUps:p}).roundProfile;return{[d]:f}})),l=ng({matchUpsMap:i,structureId:e}),{roundProfile:u}=to({matchUps:l}),c={};return a==null||a.forEach(d=>{var p,f,h;let{structureId:m,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:b,roundNumber:I}=d.target,T=s[m],w=(p=T[1])==null?void 0:p.drawPositions,S=(f=T[g])==null?void 0:f.matchUpsCount;if(!S)return;let U=S?w.length/S:0,P=w.length/U,E=w.slice(),D=kfe({roundPositionsCount:P,groupedOrder:y}),R=(D==null?void 0:D.length)||1;if(R<=P){let A=w.length/R,_=Yr(E,A);v===tg&&_.forEach(k=>k.reverse()),E=(D==null?void 0:D.length)&&(D==null?void 0:D.map(k=>_[k-1]).flat())||E}let N=Yr(E,U);if(b){let A=Je(0,b.interleave).map(()=>{}),_=Je(0,b.offset).map(()=>{});N=N.map(B=>[B,...A]),N.unshift(_),N=N.flat(1);let k=N.length-b.offset;N=N.slice(0,k)}c[I]||(c[I]={});let M=(h=u==null?void 0:u[I])!=null&&h.feedRound?2:1;N.forEach((A,_)=>{let k=1+_*M;c[I][k]||(c[I][k]=CR(A))})}),{sourceDrawPositionRanges:c}}function uf({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=sf({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[rp])??(o==null?void 0:o[rp])??NW[rp];a.policies[rp]=s}return a}function yVe({drawPositions:t,roundProfile:e,roundNumber:i}){var n;let r=[void 0,void 0];if(rpe(t))return{orderedDrawPositions:r,displayOrder:r};let a=e==null?void 0:e[i],o=((n=a==null?void 0:a.pairedDrawPositions)==null?void 0:n.find(l=>eo(l||[],t.filter(Boolean))))??r,s=a==null?void 0:a.feedRound;if(npe(t)){let l=[...t].sort(lr);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(u=>!isNaN(Tt(u))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function IN({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:u}=s,c=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return c&&{participantId:u,...c}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:u,substitutionOrder:c}=s;n.includes(l)||(u&&r.push({previousParticipantId:u,substitutionOrder:c,participantId:l}),n=n.filter(d=>d!==u),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Yl({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:Oe};if(!Array.isArray(i)||i.length>2)return{error:Ol};if(!i.length)return ue({result:{error:Fh},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===xt&&$n(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return ue({result:{error:qn},stack:n});let o=ut(r.slice(1),!1,!0);return{participant:ut(a),duplicatedPairParticipants:o,...ae}}function og({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:nt};if(typeof e!="string")return{error:wr};let{extension:i}=qt({element:t,name:Np});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function bVe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:d,lineUp:p,teamParticipant:f})=>{var h,m,g,v;let{assignedParticipantIds:y,substitutions:b}=IN({collectionPosition:i,collectionId:o,lineUp:p});if(l===Yi){if((y==null?void 0:y.length)<=2){let I=(m=(h=r==null?void 0:r[y[0]])==null?void 0:h.pairIdMap)==null?void 0:m[y[1]],T=(v=I&&((g=r[I])==null?void 0:g.participant)||Yl({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:T,teamParticipant:f,substitutions:b}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:f,substitutions:b}}}else{let I=y==null?void 0:y[0];return I&&{[d]:{participantId:I,teamParticipant:f,substitutions:b}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var f;let{teamParticipant:h,sideNumber:m}=p,g=p.lineUp||((f=og({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:f.lineUp);return u({attribute:m,lineUp:g,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let c=(n==null?void 0:n.map(d=>{var p,f,h;let m=(p=e.find(b=>b.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(b=>(b==null?void 0:b.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||m&&((f=r==null?void 0:r[m])==null?void 0:f.participant)||(t==null?void 0:t.find(({participantId:b})=>b===m)),y=(g==null?void 0:g.lineUp)||((h=og({participantId:m,drawDefinition:a}))==null?void 0:h.lineUp);return u({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...c)}}function Ofe({drawDefinition:t}){if(typeof t!="object")return{error:Av};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:u})=>u===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:u,aggregator:c,stage:d}){o[l]||(o[l]=[]),s==="0"&&[ha,An].includes(d)||o[l].push(s);let p=n.filter(f=>f.source.structureId===l&&f.source.roundNumber>=u);for(let f of p){let h=f.source.roundNumber,m=f.target.roundNumber,g=f.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,h].join("|");if(c[y])return;c[y]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:c,stage:v})}}}function IVe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var r;if(!t)return{error:nt};if(!i)return{error:Ts};if(!e){let s=ng({matchUpsMap:n,structureId:i});if({roundProfile:e}=to({matchUps:s}),!e)return{error:dt}}let a=(Math.min(...((r=e==null?void 0:e[1])==null?void 0:r.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,u;let c=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((u=e==null?void 0:e[1])==null?void 0:u.drawPositions)??[],p=Yr(d,d.length/c),f=p.map(CR),h=p.map(b=>b.map(I=>I-a)).map(CR),m=o.map(b=>{var I;if(b>s)return;let T=((I=e==null?void 0:e[b])==null?void 0:I.drawPositions)??[];return Yr(T,T.length/c)}).filter(Boolean),g=Je(0,c).map(b=>m.map(I=>I[b]).flat().filter(Boolean).sort(lr)).map(b=>Ht(b)),v=g.map(b=>PBe(b).map(CR).join(", ")),y=Object.assign({},...Je(0,c).map(b=>({[b+1]:{firstRoundDrawPositionsRange:f[b],firstRoundOffsetDrawPositionsRange:h[b],possibleDrawPositions:g[b],drawPositionsRange:v[b]}})));return{[s]:y}}))}}function LW({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??to({matchUps:n}).roundsNotPowerOf2;let a=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==kg)&&!(i!=null&&i.structures)&&t&&a}function ns({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==jr&&(!e.length||!i&&!n)}var FW={[Pw]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[at]:"",[An]:"P",[vt]:"Q",[ha]:"C"}}},wVe=FW;function SVe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o;let{roundProfile:s,roundMatchUps:l}=to({matchUps:n}),{structureAbbreviation:u,stage:c}=i,d=ns({structure:i}),p=LW({structure:i}),f=i.structures,h={},m=FW[Pw],g=i.stage===vt,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===vt).map(({stageSequence:A})=>A??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",b=y&&(((r=t==null?void 0:t.affixes)==null?void 0:r.preQualifying)||m.affixes.preQualifying)||"",I=(t==null?void 0:t.roundNamingMap)||m.roundNamingMap||{},T=(t==null?void 0:t.abbreviatedRoundNamingMap)||m.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||m.affixes.preFeedRound,S=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||m.affixes.roundNumber,U=((t==null?void 0:t.namingConventions)||m.namingConventions).round,P=c&&c!==at?c[0]:"",E=(t==null?void 0:t.stageConstants)||m.stageConstants,D=c&&(E==null?void 0:E[c])||P,R=`${b}${D}${y}`,N=s?Object.keys(s):[],M=g&&E!=null&&E[vt]?`${E==null?void 0:E[vt]}-`:"";if(f||d||p)Object.assign(h,...N.map(A=>{let _=`${M}${U} ${A}`,k=`${S}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:k}}}));else{let A=g&&((t==null?void 0:t.qualifyingFinishMap)||(m==null?void 0:m.qualifyingFinishMap)||{});Object.assign(h,...N.map(_=>{if(!(s!=null&&s[_]))return;let{matchUpsCount:k,preFeedRound:B}=s[_],F=k*2,x=(A==null?void 0:A[s==null?void 0:s[_].finishingRound])||A&&`${S}${F}`||I[k]||`${S}${F}`,$=B?`-${w}`:"",j=`${x}${$}`,V=[R,u,j].filter(Boolean).join("-"),H=`${T[k]||`${S}${F}`}${$}`,z=[R,u,H].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:z,roundName:V}}}))}return{roundNamingProfile:h,roundProfile:s,roundMatchUps:l}}function vO(t){var e,i,n;let r=wi(t,[{[$h]:!0}]);if(r.error)return r;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(n=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:n.participantType;o=s===ti&&Pn||s===xt&&Yi||s===qi&&qi||void 0}return{matchUpType:o}}var TVe="normal",gK="timed",UVe="final",BW="NOAD",RR="SET",DVe={S:TVe,F:UVe};function bo(t){if(typeof t=="string"){let e=t.startsWith("T")&&gK||t.startsWith(RR)&&RR||"";if(e===gK){let i=Lfe(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===RR)return PVe(t)}}function PVe(t){let e=t.split("-"),i=BP(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&vK(e[1]),o=e&&vK(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,u=!e[2]||o,c=a,d=ft({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&c&&u)return d}function vK(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=DVe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let h=yK(n);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(n.startsWith("T"))return Lfe(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&Ffe(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?BP(r[1]):void 0,l=xfe(n),u=l!==!1,c=u&&l||s,d=yK(n.split("/")[1]),p=d!==!1,f={setTo:s};return a&&(f.NoAD=!0),d?(f.tiebreakFormat=d,f.tiebreakAt=c):f.noTiebreak=!0,s&&o&&p&&u&&f||!1}}}function xfe(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?BP(i[1]):i[1])||!1}function yK(t){if(t)if(t.startsWith("TB")){let e=xfe(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&Ffe(i[2]),a=!(i!=null&&i[2])||r,o=BP(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!At(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function Lfe(t){var e;let i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=BP(n==null?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},o=n==null?void 0:n[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=n[2]),a}function Ffe(t){return t&&t.indexOf(BW)>=0}function BP(t){return isNaN(Number(t))?0:Number(t)}function yO(t,e){return!Array.isArray(t)||!mo(e)?!1:$n(t,Dfe[e]).length}function hv(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:u,isMatchUpTie:c,roundNumbers:d,matchUpIds:p,roundNames:f,stageSequences:h,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:b,matchUpTypes:I,structureIds:T,readyToScore:w,courtIds:S,eventIds:U,venueIds:P,drawIds:E,stages:D,filterMatchUpIds:R=!0,filterMatchUpTypes:N=!0}=t,M=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],k=Array.isArray(D)?D.filter(Boolean):[],B=Array.isArray(h)?h.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],x=Array.isArray(f)?f.filter(Boolean):[],$=Array.isArray(d)?d.filter(Boolean):[],j=Array.isArray(s)?s.filter(Boolean):[],V=Array.isArray(p)&&R?p.filter(Boolean):[],H=Array.isArray(I)&&N?I.filter(Boolean):[],z=Array.isArray(S)?S.filter(Boolean):[],q=Array.isArray(P)?P.filter(Boolean):[],W=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],Y=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Z=Array.isArray(b)?b.filter(Boolean):[],X=Array.isArray(U)?U.filter(Boolean):[],Q=Array.isArray(E)?E.filter(Boolean):[],ce=Array.isArray(T)?T.filter(Boolean):[];return e.filter(J=>{var ee;if(w&&!xn(Tc)(J)&&!J.readyToScore||J.winningSide&&a&&![1,2].includes(J.winningSide)||c!==void 0&&(c&&!J.tieMatchUps||!c&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||k.length&&!k.includes(J.stage)||B.length&&!B.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||x.length&&(!J.roundName||!x.includes(J.roundName))||$.length&&(!J.roundNumber||!$.includes(J.roundNumber))||j.length&&(!J.roundPosition||!j.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||V.length&&!V.includes(J.matchUpId)||H.length&&(!J.matchUpType||!yO(H,J.matchUpType))||W.length&&(!J.matchUpFormat||!W.includes(J.matchUpFormat)))return!1;if(Y!=null&&Y.length){let{scheduledTime:ne}=jB({matchUp:J}),{scheduledDate:ie}=ag({matchUp:J}),oe=Bt(ne)||ie;if(!Y.find(se=>Cd(se,oe)))return!1}if(z.length){let{courtId:ne}=Nfe({matchUp:J}),{allocatedCourts:ie}=Mfe({matchUp:J}),oe=ie==null?void 0:ie.map(({courtId:se})=>se);if(!z.filter(Boolean).includes(ne)||oe!=null&&oe.includes(ne))return!1}if(q.length){let{venueId:ne}=Afe({matchUp:J});if(!q.filter(Boolean).includes(ne))return!1}if(y){if(Z.length&&!Z.includes(J.tournamentId)||X.length&&!X.includes(J.eventId)||Q.length&&!Q.includes(J.drawId)||ce.length&&!ce.includes(J.structureId))return!1;if(M.length){let ne=((ee=J.sides)==null?void 0:ee.map(({participantId:ie})=>ie).filter(Boolean))??[];if(!M.some(ie=>ne.includes(ie)))return!1}}return!0})}function EVe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,c,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),f=a&&t,h=s&&e,m=f?(l=f[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?CVe({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:s}):{...h==null?void 0:h[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&f){let v=(u=f[a])==null?void 0:u.teamParticipant,y=(c=f[a])==null?void 0:c.participant,b=(d=f[a])==null?void 0:d.substitutions;y&&(g.participant=y),b&&(g.substitutions=b),v&&(g.teamParticipant=v)}return g}function CVe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=RVe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function RVe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Uc="ANY",Ki="MALE",Ho="MIXED",mv="OTHER",vn="FEMALE",$W={ANY:Uc,MALE:Ki,FEMALE:vn,MIXED:Ho,OTHER:mv};function Ci({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,scheduleTiming:f,contextProfile:h,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:w}){var S,U,P,E,D;let R={},N={};if(n=n??(o==null?void 0:o.participants),!I)return{collectionPositionMatchUps:R,error:Lh,roundMatchUps:N,matchUps:[]};let M=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],A=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],_=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],k=!(v!=null&&v.eventId)||!(M!=null&&M.length)&&!((S=u==null?void 0:u.eventIds)!=null&&S.filter(Boolean).length)||(M==null?void 0:M.includes(v.eventId))||((U=u==null?void 0:u.eventIds)==null?void 0:U.includes(v.eventId)),B=!(A!=null&&A.length)||A.includes(I.structureId),F=!m||!(_!=null&&_.length)||_.includes(m.drawId);if(!k||!B||!F)return{collectionPositionMatchUps:R,roundMatchUps:N,matchUps:[]};h&&!c&&(c=uf({tournamentRecord:o,contextProfile:h,drawDefinition:m}));let{appliedPolicies:x}=Ai({drawDefinition:m}),$={...e,...x,...a},j=(P=$==null?void 0:$.scoring)==null?void 0:P.structures,V=I.stage&&(j==null?void 0:j.stage)&&(j==null?void 0:j.stage[I.stage]),H=I.stageSequence&&(V==null?void 0:V.stageSequence)&&V.stageSequence[I.stageSequence],z=((E=$==null?void 0:$.scoring)==null?void 0:E.requireAllPositionsAssigned)||(V==null?void 0:V.requireAllPositionsAssigned)||(H==null?void 0:H.requireAllPositionsAssigned);b||(b=ya({drawDefinition:m,structure:I}));let{positionAssignments:q,allPositionsAssigned:W}=Or({structure:I}),Y=!z||W,{seedAssignments:Z}=nl({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??Z;let{roundOffset:X,structureId:Q,structureName:ce,stage:J,stageSequence:ee}=I,{drawId:ne,drawName:ie,drawType:oe}=m??{};y=y||m&&Ofe({drawDefinition:m}).exitProfiles;let se=y==null?void 0:y[Q],pe=(se==null?void 0:se.length)&&(se[0].split("-").map(Ie=>parseInt(Ie)).reduce((Ie,Ne)=>Ie+Ne)||0),fe=!!I.structures,ge=ng({matchUpsMap:b,structureId:Q,inContext:T}),me=$==null?void 0:$[Pw],Ee=SVe({roundNamingPolicy:me,drawDefinition:m,structure:I,matchUps:ge}),{roundNamingProfile:Be,roundProfile:Pe}=Ee;if(N=(Ee==null?void 0:Ee.roundMatchUps)??[],d&&(ge=hv({matchUps:ge,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){let{sourceDrawPositionRanges:Ie}=vVe({drawDefinition:m,matchUpsMap:b,structureId:Q}),Ne=m?IVe({drawDefinition:m,roundProfile:Pe,matchUpsMap:b,structureId:Q}).drawPositionsRanges:void 0;ge=ge.map(be=>et({scheduleVisibilityFilters:t,sourceDrawPositionRanges:Ie,drawPositionsRanges:Ne,roundNamingProfile:Be,initialRoundOfPlay:pe,appliedPolicies:$,usePublishState:l,publishStatus:g,isRoundRobin:fe,roundProfile:Pe,matchUp:be,event:w})),(ge==null?void 0:ge.filter(be=>Array.isArray(be.tieMatchUps))).forEach(be=>{let Le=be.tieMatchUps;ge=ge.concat(...Le)}),u&&(ge=hv({processContext:!0,...u,matchUps:ge}))}else(ge==null?void 0:ge.filter(Ie=>Array.isArray(Ie.tieMatchUps))).forEach(Ie=>{let Ne=Ie.tieMatchUps;ge=ge.concat(...Ne)});return d&&(ge=hv({matchUps:ge,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ge=hv({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ge})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(N=to({matchUps:ge}).roundMatchUps??[]),(D=_a({drawDefinition:m,structure:I,event:w}))!=null&&D.tieFormat&&({collectionPositionMatchUps:R}=gVe({matchUps:ge})),{collectionPositionMatchUps:R,roundMatchUps:N,isRoundRobin:fe,roundProfile:Pe,matchUpsMap:b,matchUps:ge};function et({scheduleVisibilityFilters:Ie,sourceDrawPositionRanges:Ne,drawPositionsRanges:be,initialRoundOfPlay:Le,additionalContext:Me,roundNamingProfile:Ze,tieDrawPositions:qe,appliedPolicies:ye,isCollectionBye:_e,usePublishState:Ae,publishStatus:Ve,matchUpTieId:Ke,isRoundRobin:he,roundProfile:ve,sideLineUps:Ce,matchUp:De,event:Ue}){var Qe,je,ke,bt,Gt,Zt,Sr,Oo,ri,Tr,Xn,It,hr,os,ss;Me=Me??{};let Io=(Qe=_a({drawDefinition:m,structure:I,matchUp:De,event:Ue}))==null?void 0:Qe.tieFormat,Vd=Io==null?void 0:Io.collectionDefinitions,La=De.collectionId&&(Vd==null?void 0:Vd.find(vi=>vi.collectionId===De.collectionId)),ls=De.collectionId?La==null?void 0:La.matchUpFormat:De.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Ue==null?void 0:Ue.matchUpFormat),uu=De.matchUpType||(La==null?void 0:La.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||!xn(Rr)(Ue==null?void 0:Ue.eventType)&&(Ue==null?void 0:Ue.eventType),Kg=_e?Di:De.matchUpStatus,{schedule:bf,endDate:Fc}=gO({scheduleVisibilityFilters:Ie,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:Ae,scheduleTiming:f,matchUpFormat:ls,publishStatus:Ve,matchUpType:uu,matchUp:De,event:Ue}),Bc=qe??De.drawPositions??[],{collectionPosition:cu,collectionId:du,roundPosition:so}=De,gi=De.roundNumber??Me.roundNumber,Zh=du?bVe({tournamentParticipants:n,positionAssignments:q,collectionPosition:cu,drawDefinition:m,participantMap:p,drawPositions:Bc,collectionId:du,sideLineUps:Ce,matchUpType:uu}):void 0,Xh=((je=Ze==null?void 0:Ze[gi])==null?void 0:je.roundName)||Me.roundName,Jh=((ke=Ze==null?void 0:Ze[gi])==null?void 0:ke.abbreviatedRoundName)||Me.abbreviatedRoundName,We=(bt=ve==null?void 0:ve[gi])==null?void 0:bt.feedRound,ni=(Gt=ve==null?void 0:ve[gi])==null?void 0:Gt.preFeedRound,Jn=(Zt=ve==null?void 0:ve[gi])==null?void 0:Zt.roundFactor,Ma=be==null?void 0:be[gi],pu=so?Ma==null?void 0:Ma[so]:void 0,$c=Ne==null?void 0:Ne[gi],un=La!=null&&La.category?{...(v==null?void 0:v.category)||{},...La.category}:(v==null?void 0:v.category)??(Ue==null?void 0:Ue.category),ar=((Sr=De.processCodes)==null?void 0:Sr.length)&&De.processCodes||((Oo=La==null?void 0:La.processCodes)==null?void 0:Oo.length)&&(La==null?void 0:La.processCodes)||((ri=I==null?void 0:I.processCodes)==null?void 0:ri.length)&&(I==null?void 0:I.processCodes)||((Tr=m==null?void 0:m.processCodes)==null?void 0:Tr.length)&&(m==null?void 0:m.processCodes)||((Xn=Ue==null?void 0:Ue.processCodes)==null?void 0:Xn.length)&&(Ue==null?void 0:Ue.processCodes)||(o==null?void 0:o.processCodes),If=(h==null?void 0:h.withCompetitiveness)&&OP({...c,matchUp:De}),Vc=De.finishingPositionRange??Me.finishingPositionRange,yl=vi=>ft(vi,void 0,!0),cn={...yl(v),...yl({matchUpFormat:De.matchUpType===Rr?void 0:ls,tieFormat:De.matchUpType!==Rr?void 0:Io,gender:(La==null?void 0:La.gender)??(Ue==null?void 0:Ue.gender),roundOfPlay:J!==vt&&At(Le)&&Le+(gi||0),endDate:De.endDate??Fc,discipline:Ue==null?void 0:Ue.discipline,category:un,finishingPositionRange:Vc,abbreviatedRoundName:Jh,drawPositionsRange:pu,competitiveProfile:If,structureName:ce,stageSequence:ee,drawPositions:Bc,matchUpStatus:Kg,processCodes:ar,isRoundRobin:he,matchUpTieId:Ke,preFeedRound:ni,matchUpType:uu,roundFactor:Jn,roundOffset:X,structureId:Q,roundNumber:gi,feedRound:We,roundName:Xh,drawName:ie,drawType:oe,schedule:bf,drawId:ne,stage:J}),...ut(yl(De),!0,!0)};if(ls&&(It=De.score)!=null&&It.scoreStringSide1){let vi=bo(ls),{bestOf:Dr,finalSetFormat:ct,setFormat:kt}=vi??{};(ct!=null&&ct.tiebreakSet||kt!=null&&kt.tiebreakSet||kt!=null&&kt.timed)&&(cn.score.sets=cn.score.sets.sort((Ti,fn)=>Ti.setNumber-fn.setNumber).map((Ti,fn)=>(fn+1===Dr?(ct!=null&&ct.tiebreakSet||ct!=null&&ct.timed)&&(Ti.tiebreakSet=!0):(kt!=null&&kt.tiebreakSet||kt!=null&&kt.timed)&&(Ti.tiebreakSet=!0),Ti)))}if(Array.isArray(Bc)){let{orderedDrawPositions:vi,displayOrder:Dr}=yVe({drawPositions:Bc,roundProfile:ve,roundNumber:gi}),ct=(hr=ve==null?void 0:ve[gi])==null?void 0:hr.feedRound,kt=Dr[0]!==vi[0],Ti=vi.concat(void 0,void 0).slice(0,2).map((fn,_t)=>{var _i;let ba=_t+1,fu=kt?3-ba:ba,hu=EVe({...Zh,positionAssignments:q,displaySideNumber:fu,seedAssignments:s,drawPosition:fn,isFeedRound:ct,sideNumber:ba}),jd=(_i=De.sides)==null?void 0:_i.find(tm=>tm.sideNumber===ba),Qh=so?(so-1)*2+_t+1:void 0,em=Qh?$c==null?void 0:$c[Qh]:void 0;return yl({sourceDrawPositionRange:em,...jd,...hu})});Object.assign(cn,ut({sides:Ti},!0,!0))}if(n&&cn.sides){let vi=ye==null?void 0:ye[nS],Dr=ct=>{var kt;let Ti=(kt=p==null?void 0:p[ct])==null?void 0:kt.participant;return Ti&&cy({template:vi==null?void 0:vi.participant,source:Ti})};if(cn.sides.filter(Boolean).forEach(ct=>{var kt,Ti,fn;if(ct.participantId){let _t=ut(Dr(ct.participantId)||n&&ph({policyDefinitions:ye,participantId:ct.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:h}),void 0,!0);if(_t){if(m!=null&&m.entries){let _i=m.entries.find(ba=>ba.participantId===ct.participantId);_i!=null&&_i.entryStatus&&(_t.entryStatus=_i.entryStatus),_i!=null&&_i.entryStage&&(_t.entryStage=_i.entryStage)}Object.assign(ct,{participant:_t})}}if((Ti=(kt=ct==null?void 0:ct.participant)==null?void 0:kt.individualParticipantIds)!=null&&Ti.length&&!((fn=ct.participant.individualParticipants)!=null&&fn.length)){let _t=ct.participant.individualParticipantIds.map(_i=>Dr(_i)||n&&ph({policyDefinitions:ye,tournamentParticipants:n,internalUse:!0,contextProfile:h,participantId:_i}));Object.assign(ct.participant,{individualParticipants:_t})}}),!cn.matchUpType){let{matchUpType:ct}=vO({matchUp:cn});ct&&Object.assign(cn,{matchUpType:ct})}if(h!=null&&h.inferGender&&(!cn.gender||cn.gender===Ho)&&((os=cn.sides)==null?void 0:os.length)===2&&cn.matchUpType!==Rr){let ct=cn.sides.map(kt=>{var Ti,fn,_t,_i;if(xn(Pn)(cn.matchUpType))return(fn=(Ti=kt.participant)==null?void 0:Ti.person)==null?void 0:fn.sex;if(((_i=(_t=kt.participant)==null?void 0:_t.individualParticipants)==null?void 0:_i.length)===2){let ba=Ht(kt.participant.individualParticipants.map(fu=>{var hu;return(hu=fu.person)==null?void 0:hu.sex})).filter(Boolean);if(ba.length===1)return ba[0]}});if(ct.filter(Boolean).length===2&&Ht(ct).length===1){let kt=ct[0];cn.inferredGender=kt}}}if(cn.tieMatchUps){let vi=cn.matchUpStatus===Di,Dr=(ss=cn.sides)==null?void 0:ss.map(({participant:ct,drawPosition:kt,sideNumber:Ti,lineUp:fn})=>{let _t=(ct==null?void 0:ct.participantType)===Rr&&ct;return{teamParticipant:_t&&ft({participantRoleResponsibilities:_t.participantRoleResponsibilities,participantOtherName:_t.participanOthertName,participantName:_t.participantName,participantId:_t.participantId,teamId:_t.teamId}),drawPosition:kt,sideNumber:Ti,lineUp:fn}});cn.tieMatchUps=cn.tieMatchUps.map(ct=>{let kt=cn.matchUpId,Ti={finishingPositionRange:cn.finishingPositionRange,abbreviatedRoundName:Jh,roundNumber:gi,roundName:Xh};return et({tieDrawPositions:Bc,scheduleVisibilityFilters:Ie,sourceDrawPositionRanges:Ne,sideLineUps:Dr,drawPositionsRanges:be,initialRoundOfPlay:Le,roundNamingProfile:Ze,additionalContext:Ti,appliedPolicies:ye,isCollectionBye:vi,usePublishState:Ae,publishStatus:Ve,matchUpTieId:kt,isRoundRobin:he,roundProfile:ve,matchUp:ct,event:Ue})})}let Si=cn.sides&&cn.sides.filter(vi=>vi==null?void 0:vi.participantId).length===2,Ur=!cn.winningSide;if(Object.assign(cn,{readyToScore:Y&&Si&&Ur,hasContext:!0}),Si){let{allParticipantsCheckedIn:vi,checkedInParticipantIds:Dr}=yb({matchUp:cn});Object.assign(cn,{allParticipantsCheckedIn:vi,checkedInParticipantIds:Dr})}return Array.isArray(h==null?void 0:h.exclude)&&(h==null||h.exclude.forEach(vi=>delete cn[vi])),cn}}function _m({matchUp:t}){return t?kr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function bO({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:c,participantMap:d,scheduleTiming:p,publishStatus:f,contextProfile:h,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:w}){!I&&y&&({structure:I}=Pt({drawDefinition:m,structureId:y}));let S=Ci({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:c,participantMap:d,scheduleTiming:p,publishStatus:f,contextProfile:h,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:w}),U=[],P=[],E=[],D=[],R=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:M}=Or({structure:I}),A=M==null?void 0:M.filter(k=>k.participantId).map(k=>k.drawPosition),_;return N.filter(k=>{var B;let F=((B=l==null?void 0:l.matchUpTypes)==null?void 0:B.length)===1&&l.matchUpTypes[0]===Xi;return!(k.matchUpType!==Xi&&F)}).forEach(k=>{var B,F,x,$;if(k.matchUpStatus===vs){U.push(k);return}k.matchUpType===Xi&&(_=!0);let j=k.collectionId,V=j&&((B=k.sides)==null?void 0:B.every(Z=>Z.participantId)),H=!j&&((F=k.drawPositions)==null?void 0:F.filter(Boolean).length)===2,z=!j&&((x=k.drawPositions)==null?void 0:x.every(Z=>A==null?void 0:A.includes(Z))),q=M==null?void 0:M.filter(Z=>Z.bye).map(Z=>Z.drawPosition),W=!j&&(($=k.drawPositions)==null?void 0:$.find(Z=>q==null?void 0:q.includes(Z))),Y=Gpe.includes(k.matchUpStatus)&&(V||H&&(!t||z));return W?R.push(k):_m({matchUp:k})?P.push(k):Y?E.push(k):D.push(k)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:P,upcomingMatchUps:E,pendingMatchUps:D,byeMatchUps:R,structure:I}}function MVe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:nt};if(!i)return{error:Ts};let{links:n}=pS({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function XL({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;let a=n.find(o=>{var s,l;let u=!((s=o.source)!=null&&s.finishingPositions)||!t||eo(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&u&&o.linkType===i});return[kp,Md].includes(a==null?void 0:a.linkType)&&!((r=a==null?void 0:a.source)!=null&&r.roundNumber)?ue({result:{error:Se},stack:"getTargetLink",context:a}):a}function pS({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:Ts}:{error:nt}}function NVe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function JL({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:cq};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:c}}=r,{structure:d}=Pt({drawDefinition:n,structureId:o}),{positionAssignments:p}=Hi({structure:d}),f=(e==null?void 0:e.filter(E=>E.structureId===(d==null?void 0:d.structureId))).filter(E=>E.roundNumber===u&&!E.matchUpTieId),h=f.length,m=Je(1,h+1),g=h/t,v=Math.ceil(g*i),y=1-i%2;if(c!=null&&c.interleave&&g!==.5){let E=c.offset+(i-1)*c.interleave,D=i+E;v=Math.ceil(D/2),y=1-D%2}let b=m,I=m[v-1],T=kfe({roundPositionsCount:m.length,groupedOrder:l}),w=(T==null?void 0:T.length)||1;if(w<=m.length){let E=h/w,D=Yr(m,E);s===tg&&D.forEach(R=>R.reverse()),b=(T==null?void 0:T.length)&&(T==null?void 0:T.map(R=>D[R-1]).flat())||b}s===Ml?I=b[v-1]:s===tg?((!(T!=null&&T.length)||w>m.length)&&(v=f.length+1-v),I=b[v-1]):s===oO&&il()&&console.log(qk,{feedProfile:s});let S=I&&f.reduce((E,D)=>D.roundPosition===I?D:E,void 0),U;S!=null&&S.feedRound?(y=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=((a=S==null?void 0:S.drawPositions)==null?void 0:a.length)===2&&(S==null?void 0:S.drawPositions[y]);let P=p==null?void 0:p.find(({drawPosition:E})=>E===U);if(P){let{extension:E}=qt({element:P,name:iO});if(E!=null&&E.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:y}}function io({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=Pt({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===mb?AVe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):_Ve({matchUp:a})}function AVe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=r,{links:c}=MVe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),d=c==null?void 0:c.source,p=XL({source:d,linkType:kp}),f=XL({linkCondition:Nd,linkType:Md,source:d}),h=XL({source:d,linkType:Md}),m=f&&h;h||(h=f);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,y=(s=f==null?void 0:f.target)==null?void 0:s.feedProfile,b,I,T,w,S,U,P,E,D,R;if(e&&(l||u)&&(P=l&&g!==Su&&t.find(({matchUpId:A})=>A===l),w=u&&v!==Su&&t.find(({matchUpId:A})=>A===u),P||w))return{matchUp:r,targetLinks:{loserTargetLink:h,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:P}};let{roundPosition:N}=r;R=R||t.filter(A=>A.structureId===n.structureId);let M=R.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return h&&!w&&v!==Su&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=JL({targetLink:h,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),m&&y!==Su&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=JL({targetLink:f,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!P&&g!==Su&&({matchUpDrawPositionIndex:D,targetDrawPosition:E,matchUp:P}=JL({targetLink:p,sourceRoundMatchUpCount:M,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),P||(R=R||t.filter(A=>A.structureId===n.structureId),{matchUp:P}=NVe({structureMatchUps:R,matchUp:r})),ft({matchUp:r,targetLinks:{loserTargetLink:h,winnerTargetLink:p,byeTargetLink:f},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:U,byeMatchUpDrawPositionIndex:T,winnerTargetDrawPosition:E,loserTargetDrawPosition:S,byeTargetDrawPosition:I,winnerMatchUp:P,loserMatchUp:w,byeMatchUp:b},targetMatchUpIds:!!(l||u)})}function _Ve({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function kVe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var r,a,o,s,l,u;let{matchUpId:c,structureId:d,drawPositions:p=[]}=n,{structure:f}=Pt({drawDefinition:t,structureId:d});if((f==null?void 0:f.finishingPosition)===sS){let{roundNumber:h}=n,m=h&&Tt(h)+1,g=f.matchUps??[],{roundMatchUps:v}=to({matchUps:g});if(m&&v!=null&&v[m]){let y=[...p].sort(lr).map((b,I)=>{let T=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:f.structureName}});Object.assign(n,{sidesTo:y})}}else{let h=io({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:c}),{winnerMatchUp:m}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=QL({upcomingMatchUp:m}),y=QL({upcomingMatchUp:g});if(n.matchUpStatus!==Di&&(g==null?void 0:g.matchUpStatus)===Di){let{matchUp:I}=Bfe({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&QL({upcomingMatchUp:I})||y}let b=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(b&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&ui(v.schedule.scheduledTime)<ui(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&ui(y.schedule.scheduledTime)<ui(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(s=n.drawPositions)==null?void 0:s.filter(Boolean).length){let I=((u=(l=h.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:u.linkCondition)===Nd,T=OVe(n);if(T.length){let w=kB(m==null?void 0:m.sides),S=kB(g==null?void 0:g.sides),U=T.find(({participantId:E})=>w.includes(E))?[]:T,P=T.find(({participantId:E})=>S.includes(E))?[]:T;g&&I&&P.length<2&&P.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!h.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),P!=null&&P.length&&g&&(h.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function OVe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function Bfe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Vn)return{matchUp:t};if(a===Di){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((n=io({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:n.targetMatchUps)||{},Bfe({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function QL(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function fr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=fS(t);if(i.error)return ue({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function fS(t){if(!(t!=null&&t.drawDefinition))return{error:nt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,scheduleTiming:h,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:w}=t,S=[],U=[],P=[],E=[],D=[];v&&!i&&(i=uf({policyDefinitions:u,tournamentRecord:c,contextProfile:v,event:w}));let R;!(e!=null&&e.length)&&c&&(e=c==null?void 0:c.participants,(I||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:R}=EW({participants:e,participantsProfile:s})));let{structures:N}=_d({drawDefinition:y});if(!N)return{error:Tn};n||(n=ya({drawDefinition:y}));let M=y&&Ofe({drawDefinition:y}).exitProfiles;N.forEach(k=>{let{byeMatchUps:B=[],pendingMatchUps:F=[],upcomingMatchUps:x=[],completedMatchUps:$=[],abandonedMatchUps:j=[]}=bO({matchUpFilters:b?void 0:f,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:M,matchUpsMap:n,structure:k,context:T,event:w});S=S.concat(...j),U=U.concat(...$),P=P.concat(...x),E=E.concat(...F),D=D.concat(...B)});let A=k=>(!f&&!b&&!p||(f&&(k=hv({matchUps:k,...f})),p&&(k=hv({matchUps:k,...p,processContext:!0}))),k),_={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(P),pendingMatchUps:A(E),byeMatchUps:A(D),matchUpsMap:n,...ae,groupInfo:R};if(b){let k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:B,completed:F,upcoming:x,pending:$,bye:j}=k,V=[].concat(...B&&S||[],...F&&U||[],...x&&P||[],...$&&E||[],...j&&D||[]);kVe({inContextDrawMatchUps:V,drawDefinition:y})}return _}function sg({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:nt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=fr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];PP({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=io({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:u,loserMatchUp:c}=l.targetMatchUps,d=u==null?void 0:u.matchUpId,p=c==null?void 0:c.matchUpId,f=ng({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(f&&(d&&(r.winnerMatchUpIds[f.matchUpId]=d,Object.assign(f,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[f.matchUpId]=p,a.loserMatchUpId=p,f.loserMatchUpId=p,a.finishingPositionRange))){let h=c.finishingPositionRange&&[...a.finishingPositionRange.loser,...c.finishingPositionRange.loser],m=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=m,f.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function $fe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function xVe(t){let e=Object.assign({},...Wf.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return $fe(e[t])}var Wf=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Vfe({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let u=Wf.find(({iso:c})=>c===l);i&&u!=null&&u.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=u.ioc),e&&u!=null&&u.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=u.iso2),u!=null&&u.label&&!s.countryName&&(s.countryName=u.label)}}a.forEach(o)}function LVe({participantMap:t,template:e}){var i;let n=Object.values(t);for(let r of n){let a=r.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?cy({template:e,source:s}):s)}}}}function jg(t){var e;let{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===n);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:qn}}function Lc({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:dt,info:Jq};if(e&&!Array.isArray(e))return{error:Se,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:Cq};let r=n.timeItems.filter(o=>(o==null?void 0:o.itemType)===i).filter(o=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=o==null?void 0:o.itemSubTypes)==null?void 0:l.includes(s)})).sort((o,s)=>{let l=new Date(o.createdAt||void 0).getTime(),u=new Date(s.createdAt||void 0).getTime();return l-u}),a=r.pop();if(a){let o={timeItem:a,...ae};return t&&Object.assign(o,{previousItems:r}),o}else return{info:Pa}}function VW({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Ku};if(!e.timeItems)return{info:Pa};let{timeItem:r,previousItems:a,info:o}=Lc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function $P({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Oi};if(!n.timeItems)return{info:Pa};let{timeItem:r,previousItems:a,info:o}=Lc({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function VP({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Oe};if(!e.timeItems)return{info:Pa};let{timeItem:r,previousItems:a,info:o}=Lc({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function jW({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:Oe};if(!i)return{error:wr};let a=jg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Pa};let{timeItem:s,previousItems:l,info:u}=Lc({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:u}}var FVe={[Us]:"groupParticipantIds",[xt]:"pairParticipantIds",[qi]:"teamParticipantIds"},BVe={[Us]:"groups",[qi]:"teams"};function jfe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let u of i.participants??[]){let c=u==null?void 0:u.participantId;c&&jVe({participantMap:l,participantId:c})}for(let u of i.participants??[]){let c=ut(u,e,a),{participantId:d,individualParticipantIds:p,participantType:f}=c;if(Object.assign(l[d].participant,c),p&&VVe({individualParticipantIds:p,participantCopy:c,participantMap:l,participantType:f,participantId:d}),n&&(l[d].participant.signedIn=$Ve(c)),r){let{ratings:h,rankings:m,seedings:g}=tS({participant:c});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=h}(s||o)&&Vfe({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let u=ln(t)?t:void 0;LVe({participantMap:l,template:u})}return{participantMap:l}}function $Ve(t){let{timeItem:e}=Lc({itemType:EP,element:t});return(e==null?void 0:e.itemValue)===JU}function VVe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let a of t){let o=i[a].participant;if(o[FVe[n]].push(r),[qi,Us].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:u,participantId:c,teamId:d}=e,p=BVe[n];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:u,participantId:c,teamId:d})}if(n===xt){let s=t.find(l=>l!==a);i[a].pairIdMap[r]=s,i[a].pairIdMap[s]=r}}}function jVe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Pn]:{...i},[Yi]:{...i},[qi]:{...i},...i}}}function Ib({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var a;if(e)return{participantMap:(a=jfe({...t,...n,tournamentRecord:i}))==null?void 0:a.participantMap};let o=ut(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>Vfe({participant:l,...t}));let s;if((r||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=EW({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:u,rankings:c}=tS({participant:l});l.rankings=c,l.ratings=u}return{participants:o,groupInfo:s}}function cf(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextFilters:d,contextProfile:p,matchUpFilters:f,nextMatchUps:h,inContext:m,context:g,event:v}=t;if(!v)return{error:Oi};let{eventId:y,eventName:b,endDate:I,eventType:T,category:w,gender:S,matchUpFormat:U}=v??{},P={...g,...ft({indoorOutDoor:v.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),surfaceCategory:v.surfaceCategory??(c==null?void 0:c.surfaceCategory),endDate:v.endDate??(c==null?void 0:c.endDate),tournamentId:c==null?void 0:c.tournamentId,matchUpFormat:U,eventName:b,eventType:T,category:w,eventId:y,gender:S})};I&&(P.endDate=I),p&&!i&&(i=uf({policyDefinitions:l,tournamentRecord:c,contextProfile:p,event:v}));let E;if(!(e!=null&&e.length)&&!n&&c){let N=Ib({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],E=N.groupInfo}let D=v.drawDefinitions??[],R=xP({tournamentRecord:c,event:v}).scheduleTiming;return{matchUps:D.flatMap(N=>{let{matchUps:M}=fr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:P,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:f,participantMap:n,scheduleTiming:R,nextMatchUps:h,inContext:m,event:v});return M??[]}),groupInfo:E}}function Xr(t){let e=wi(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:Oe};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:c=!0,contextProfile:d,matchUpFilters:p,contextFilters:f,nextMatchUps:h,context:m}=t,g=t.tournamentId??u.tournamentId,v=(u==null?void 0:u.events)??[];n||({participants:n,participantMap:i}=Ib({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:d,inContext:c}));let{appliedPolicies:y}=Ai({tournamentRecord:u}),b={...m,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},I=uf({policyDefinitions:l,tournamentRecord:u,contextProfile:d});return{matchUps:v.flatMap(T=>{var w;return b.eventDrawsCount=((w=T.drawDefinitions)==null?void 0:w.length)??0,cf({context:b,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:I,contextFilters:f,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:n,inContext:c,event:T}).matchUps??[]}).concat(...u.matchUps??[])}}function Vu({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:Rn}:{matchUps:Object.keys(n).map(u=>{let c=n[u];return Xr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:c,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function wb(t,e){return GVe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function GVe(t,e){return(hy[t==null?void 0:t.stage]||0)-(hy[e==null?void 0:e.stage]||0)}function po(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,matchUpFilters:d,contextFilters:p,contextProfile:f,drawDefinition:h,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:w,category:S,gender:U,matchUpFormat:P}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(c==null?void 0:c.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(c==null?void 0:c.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:I,category:S,eventId:b,endDate:T,gender:U},D;return!(e!=null&&e.length)&&!i&&c&&({participants:e=[],participantMap:i,groupInfo:D}=Ib({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!n&&(n=uf({policyDefinitions:l,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:y})),{...fr({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,drawDefinition:h,contextContent:n,contextFilters:p,contextProfile:f,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:D}}function su(t){var e;let i=xc(t),n=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(n))return{error:Ld};if(!Array.isArray(r))return{error:Ku};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(b=>b.matchUpId);if(!Array.isArray(l))return{error:K0};let u={},c={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let f=Object.values(i),h=f.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===_p),m=n;if(h.length){m=Vu({nextMatchUps:!0,tournamentRecords:i}).matchUps;let b=h.reduce((I,T)=>{var w,S;let U=(w=T.source)==null?void 0:w.structureId,P=(S=T.target)==null?void 0:S.structureId;return U&&P&&(d[P]=U),U&&!I.includes(U)&&I.push(U),I},[]);for(let I of b)u[I]=[];for(let I of m??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&u[T].push(I.matchUpId)}}let g=b=>{c[b]||(c[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[b]=[])},v=(b,I)=>{c[b].matchUpIds.forEach(T=>{c[I].matchUpIds.push(T)}),c[I].matchUpIds.push(b),c[b].dependentMatchUpIds.push(I),a&&c[b].participantIds.forEach(T=>c[I].participantIds.push(T))},y=b=>{let I=Object.keys(u).length;for(let T of b||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=T;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:D}=pO(T);c[w].participantIds=D}S&&(g(S),v(w,S),p[S].push(w)),U&&(g(U),v(w,U),p[U].push(w)),c[w].sources.push(p[w]);let P=p[w].map(D=>c[D].sources[0]).flat(),E=p[w].map(D=>c[D].sources[1]).flat();if(c[w].sources.push(P,E),I){let D=T.containerStructureId||T.structureId,R=d[D];if(u[R])for(let N of u[R])g(N),v(N,w),p[N].push(w)}}}};if(s)sg({drawDefinition:s}),m!=null&&m.length||(m=po({drawDefinition:s}).matchUps),y(m);else{if(m!=null&&m.length||(m=Vu({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let b=f!=null&&f.length?f.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:w})=>w))).flat(1/0):[];b&&(r=b)}for(let b of r){let I=m==null?void 0:m.filter(T=>T.drawId===b).sort(wb);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:S})=>S),{drawDefinition:w}=vo({tournamentRecord:i[T==null?void 0:T.tournamentId],drawId:b});w&&sg({drawDefinition:w})}y(I)}}return{positionDependencies:u,matchUpDependencies:c,sourceMatchUpIds:p,matchUps:m,...ae}}function Jr(t){var e,i;let n=t==null?void 0:t.matchUp,r=(t==null?void 0:t.score)||(n==null?void 0:n.score),a=(e=r==null?void 0:r.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:c,side2PointScore:d}=a||{},p=o||s||l||u||c||d;return!!(((i=r==null?void 0:r.sets)==null?void 0:i.length)>1||p)}function jP({matchUpStatus:t}){return Vpe.includes(t)}function HVe({matchUpStatus:t}){return aW.includes(t)}function GB({matchUpStatus:t}){return jpe.includes(t)}function GW({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var a;let o=n==null?void 0:n.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(GW))==null?void 0:a.length;return Jr({score:r})||s||e&&o||t&&HVe({matchUpStatus:t})&&![bi,Ni,nu].includes(t)}function GP(t){var e;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=lS({drawDefinition:i}),u=r?l[r]||[]:[];if(!o){let U=Pt({drawDefinition:i,structureId:r});if(U.error)return U;o=n?U.containingStructure??U.structure:U.structure}if(ns({structure:o}))return{structure:o,isAdHoc:!0,error:q0};let{matchUps:c}=fr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=c==null?void 0:c.filter(U=>U.structureId===r||u.includes(U.structureId)),{matchUpDependencies:p}=su({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),f=[],h=[],m={},g=[];for(let U of c??[]){if(U.structureId===r||u.includes(U.structureId)){h.push(...U.drawPositions??[]);let P=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!m[E]||P&&m[E]>P)&&(m[E]=P)}GW(U)&&(g.push(U),f.push(U.matchUpId,...((e=p==null?void 0:p[U==null?void 0:U.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=Ht(h.filter(Boolean)).sort(lr),y=Ht(f),b=Ht(d==null?void 0:d.map(({matchUpId:U,drawPositions:P})=>y.includes(U)?P:[]).flat().filter(Boolean)).sort(lr),{positionAssignments:I}=Hi({drawDefinition:i,structure:o}),T=I==null?void 0:I.filter(U=>U.bye).map(U=>U.drawPosition),w=I==null?void 0:I.filter(U=>U.qualifier).map(U=>U.drawPosition),S=(v==null?void 0:v.filter(U=>!b.includes(U)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:S,positionAssignments:I,activeDrawPositions:b,byeDrawPositions:T,activeMatchUps:g,structure:o}}function gy({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(lr)[0]}}var Pf={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},wN=[];function Ks(t,e){typeof t=="string"&&(t={method:t}),(e||il())&&wN.push(t)}function zVe(t){let e=wN.slice();return t&&(wN.length=0),e}function qVe(t){let e=zVe(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(Pf).includes(n)?Pf[n]:Pf.cyan,l=Object.keys(i).filter(c=>!["color","keyColors","method","newline"].includes(c)).map(c=>{let d=r&&Object.keys(r).includes(c)&&Pf[r[c]]?Pf[r[c]]:Pf.brightwhite;return`${Pf.white}${c}: ${d}${i[c]}`}).join(", "),u=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,u,Pf.white,l,Pf.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function WVe(){wN.length=0}function Ds({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,c,d;if(!n)return{error:nt};if(s||({structure:s}=Pt({drawDefinition:n,structureId:o})),!s)return{error:Tn};o||({structureId:o}=s);let p="assignDrawPositionBye";Ks({method:p,color:"cyan",drawPosition:r}),a||(a=ya({drawDefinition:n}));let{positionAssignments:f}=Hi({structure:s}),{activeDrawPositions:h}=GP({drawDefinition:n,structureId:o});if((u=f==null?void 0:f.find(D=>D.drawPosition===r))!=null&&u.bye)return{...ae};if(h!=null&&h.includes(r))return{error:xk};let m=f==null?void 0:f.find(D=>D.drawPosition===r);if(!m)return{error:q0};let{filled:g,containsBye:v,assignedParticipantId:y}=KVe(m);if(v)return{...ae};if(g&&!v)return ue({result:{error:Iw},stack:p});let b=fr({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:T}=Ci({provisionalPositioning:t,drawDefinition:n,matchUpFilters:I,matchUpsMap:a,structure:s});if(f==null||f.forEach(D=>{D.drawPosition===r&&(D.bye=!0)}),s.structureType===oo)return YVe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:T}),gh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),bK({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p});let{roundProfile:w,roundMatchUps:S}=to({matchUps:T}),U=(c=w&&Object.keys(w).map(D=>parseInt(D)).reverse())==null?void 0:c.find(D=>{var R;return(R=w==null?void 0:w[D].drawPositions)==null?void 0:R.includes(r)}),P=U?S==null?void 0:S[U].find(({drawPositions:D})=>D==null?void 0:D.includes(r)):void 0;P&&Gfe({tournamentRecord:i,drawDefinition:n,matchUp:P,event:l});let E=(d=P==null?void 0:P.drawPositions)==null?void 0:d.find(D=>D!==r);if(P&&E){let D=HW({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:b,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(D.error)return D}return gh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),bK({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p})}function bK({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:a}){return e&&dO({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:a}}),ue({result:{...ae},stack:a})}function KVe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Gfe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:Di,score:void 0,winningSide:void 0}),di({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function YVe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&Gfe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function HW({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var l,u;Ks({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let c=a.drawMatchUps.find(T=>T.matchUpId===o),d=(l=e.find(T=>T.matchUpId===o))==null?void 0:l.structureId,{structure:p}=Pt({drawDefinition:r,structureId:d}),{positionAssignments:f}=Hi({structure:p}),h=f==null?void 0:f.filter(T=>T.bye).map(T=>T.drawPosition),m=(u=c==null?void 0:c.drawPositions)==null?void 0:u.find(T=>T!==t),g=m&&(h==null?void 0:h.includes(m)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,loserTargetDrawPosition:I}}=io({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(b&&b.structureId===(p==null?void 0:p.structureId)&&ZVe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:b,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:T}=y;if(T===1){let w=Ds({structureId:v.target.structureId,drawPosition:I,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else Hfe({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:a,event:s})}return{...ae}}function ZVe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,c,d,p,f;let h="advanceWinner",m=o.drawMatchUps.find(x=>x.matchUpId===a.matchUpId),g=(l=e.find(x=>x.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=Pt({drawDefinition:r,structureId:g}),{positionAssignments:y}=Hi({structure:v}),b=(u=y==null?void 0:y.find(({drawPosition:x})=>x===t))==null?void 0:u.bye,I=(c=m.drawPositions)==null?void 0:c.filter(Boolean),T=y==null?void 0:y.filter(x=>I==null?void 0:I.includes(x.drawPosition)),w=y==null?void 0:y.find(({drawPosition:x})=>x===t),S=i==null?void 0:i.find(x=>x!==t),U=(d=S&&(T==null?void 0:T.find(({drawPosition:x})=>x===S)))==null?void 0:d.bye,P=b&&U;if(P&&console.log({isByeAdvancedBye:P}),(I==null?void 0:I.length)>1&&b&&!U)return ue({result:{error:Iw},stack:h});let E=I==null?void 0:I.find(x=>x!==t),D=P,R=[...(m.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=R.map(x=>!x&&!D||x===t?(D=!0,t):x).sort(lr);if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:T}),ue({result:{error:Iw},stack:h});let M=(p=y==null?void 0:y.find(({drawPosition:x})=>x===E))==null?void 0:p.bye,A=(f=y==null?void 0:y.find(({drawPosition:x})=>x===t))==null?void 0:f.bye;Object.assign(m,{matchUpStatus:A||M?Di:Vn,score:void 0,winningSide:void 0,drawPositions:N});let _=m.drawPositions.find(x=>!R.includes(x));Ks({method:h,color:"brightyellow",changedDrawPosition:_,pairedDrawPositionIsBye:M,drawPositionIsBye:A}),di({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,eventId:s==null?void 0:s.eventId,context:h,drawDefinition:r});let{targetLinks:{loserTargetLink:k},targetMatchUps:{loserMatchUp:B,loserTargetDrawPosition:F}}=io({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(M||A){let x=M?t:E;if(x)HW({drawPositionToAdvance:x,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(A&&k&&B)if(B.feedRound)Hfe({loserTargetDrawPosition:F,tournamentRecord:n,loserTargetLink:k,drawDefinition:r,loserMatchUp:B,matchUpsMap:o});else{let $=1-a.roundPosition%2,j=B.drawPositions[$],V=Ds({structureId:k.target.structureId,drawPosition:j,tournamentRecord:n,drawDefinition:r,event:s});if(V.error)return V}}}function Hfe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;Ks({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:u}=gy({drawPosition:t,matchUps:l});if(u===s){let c=Ds({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(c.error)return c}}function zfe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Ci({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:u})=>{var c;return(c=s.drawPositions)==null?void 0:c.includes(u)}).filter(u=>u.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Di:Vn}),di({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function HP(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:u}=Pt({drawDefinition:a,structureId:o}),c=(Or({drawDefinition:a,structure:u}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(c&&i&&!n&&(n=c==null?void 0:c.drawPosition),!n)return{error:W0};i||(i=c==null?void 0:c.participantId);let{activeDrawPositions:d}=GP({drawDefinition:a,structureId:o});return d.includes(n)?{error:xk}:(e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:s})),HB({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(gh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:u,event:l}),{...ae,participantId:i}):{error:Kce})}function HB({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var s,l;let{structure:u}=Pt({drawDefinition:i,structureId:a});if(!u)return{error:Tn};let c=Or({drawDefinition:i,structure:u}).positionAssignments||[],d=c.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(u.structureType===oo)return zfe({positionAssignments:c,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:u}),{drawPositionCleared:d,...ae};let p={isCollectionMatchUp:!1},{matchUps:f}=Ci({drawDefinition:i,matchUpFilters:p,matchUpsMap:r,structure:u,event:o}),{roundProfile:h,roundMatchUps:m}=to({matchUps:f}),g=(s=h&&Object.keys(h))==null?void 0:s.map(b=>Tt(b)),v=n,y=(l=g==null?void 0:g.map(b=>{var I,T,w,S;let U=(T=(I=h==null?void 0:h[b])==null?void 0:I.pairedDrawPositions)==null?void 0:T.find(_=>_.includes(v)),P=U==null?void 0:U.find(_=>_!==v),E=c.find(_=>_.drawPosition===P),D=h==null?void 0:h[b+1],R=E==null?void 0:E.bye,N=(w=D==null?void 0:D.pairedDrawPositions)==null?void 0:w.find(_=>_.includes(P)),M=R&&N&&D&&((S=D.drawPositions)==null?void 0:S.includes(P)),A=U&&{pairedDrawPositionByeAdvancedPair:!M&&N,pairedDrawPosition:P,targetDrawPosition:v,relevantPair:U,roundNumber:b};return M&&(v=P),A}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:l.reduce((b,I)=>{let{roundNumber:T,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:P}=I,E={roundNumber:T,targetDrawPosition:S,relevantPair:w},D=P&&{roundNumber:T+1,targetDrawPosition:U,relevantPair:P,subsequentRoundRemoval:!0},R=[E,D].filter(Boolean);return b.concat(...R)},[]);return y==null||y.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let w=m==null?void 0:m[b].find(S=>{var U;return eo((U=S.drawPositions)==null?void 0:U.filter(Boolean),T.filter(Boolean))});w&&(XVe({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:b,matchUpsMap:r}),qfe({inContextDrawMatchUps:t,positionAssignments:c,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:u,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:c}}function XVe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=Pt({drawDefinition:n,structureId:o});if(!s)return{error:Tn};if(s.structureType===oo)return;r=r||ya({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=gy({drawPosition:e,matchUps:l}),c=l==null?void 0:l.filter(p=>{var f;return p.roundNumber>=a&&p.roundNumber!==u&&((f=p.drawPositions)==null?void 0:f.includes(e))}),d=Hi({drawDefinition:n,structureId:o}).positionAssignments??[];return c==null||c.forEach(p=>qfe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...ae}}function qfe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,c,d,p,f,h;let m="removeDrawPosition",g=(u=r.drawPositions)==null?void 0:u.slice(),v=r.matchUpStatus,y=r.winningSide;o=o??ya({drawDefinition:n});let b=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:I}=gy({drawPosition:a,matchUps:b});if(r.roundNumber&&I&&r.roundNumber>I){let N=(r.drawPositions??[]).map(M=>M===a?void 0:M);r.drawPositions=N}if(r.matchUpType===Xi){let N=(((c=t==null?void 0:t.find(M=>M.matchUpId===r.matchUpId))==null?void 0:c.sides)??[]).reduce((M,A,_)=>A.drawPosition===a?_:M,void 0);N!==void 0&&(p=(d=r.sides)==null?void 0:d[N])!=null&&p.lineUp&&((f=r.sides)==null||delete f[N].lineUp,di({tournamentId:i==null?void 0:i.tournamentId,context:`${m}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let T=io({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:w},targetMatchUps:{loserMatchUp:S,winnerMatchUp:U,loserMatchUpDrawPositionIndex:P}}=T,E=e.filter(({drawPosition:N})=>{var M;return(M=r.drawPositions)==null?void 0:M.includes(N)}).filter(N=>N.bye).length,D=E&&Di||r.matchUpStatus&&[bi,Ni].includes(r.matchUpStatus)&&r.matcHUpStatus||((h=r.drawPositions)==null?void 0:h.length)===2&&Vn||void 0;r.matchUpStatus=D,r.matchUpStatus&&[Ni,bi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let R=g==null?void 0:g.find(N=>{var M;return!((M=r.drawPositions)!=null&&M.includes(N))});if(g!=null&&g.includes(a)&&v===r.matchUpStatus&&y===r.winningSide||(R&&Ks({method:m,color:"brightyellow",removedDrawPosition:R}),di({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${m}-${a}`,drawDefinition:n})),S&&S.structureId!==T.matchUp.structureId&&!E){let{drawPositions:N,roundNumber:M}=S;if(M===1){let A=N[P];HB({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=JVe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:S,matchUpsMap:o,event:l});if(_.error)return ue({result:_,stack:m});let k=((o==null?void 0:o.mappedMatchUps)||{})[S.structureId].matchUps,{initialRoundNumber:B}=gy({drawPosition:A,matchUps:k});B===1&&(Ks({method:m,color:"brightyellow",loserMatchUpDrawPosition:A}),HB({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return U&&U.structureId!==T.matchUp.structureId&&w.target.feedProfile,{...ae}}function JVe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var s;let{structure:l}=Pt({structureId:r.structureId,drawDefinition:n}),{positionAssignments:u}=Hi({structure:l});if((s=u==null?void 0:u.find(c=>c.drawPosition===t))!=null&&s.bye){let c=HP({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(c.error)return c}return{...ae}}function Gg({drawDefinition:t,stages:e}){if(!t)return{error:nt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Ht(i.map(r=>{let{positionAssignments:a}=Hi({structure:r});return a?a.map(ei):[]}).flat().filter(Boolean));return{...ae,assignedParticipantIds:n}}function _u(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||at}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function vm(t){return[xg,ru].includes(t)}function SN({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:c,event:d}){var p,f,h,m,g,v,y,b,I,T,w,S;if(!r||!Array.isArray(r))return{error:Ic,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Oi};if(a&&!cfe.includes(a))return{error:PB};if(o&&!oW.includes(o))return{error:Ag};let U="modifyEntriesStatus",P=[];if(!a&&!s)return ue({result:{error:dt},info:"Missing entryStatus",stack:U});if(s&&!wc({extension:s,requiredAttributes:["name"]}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:s},stack:U});let E=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{let j=Gg({stages:c&&[c],drawDefinition:$}).assignedParticipantIds??[];E.push(...j)});let D=(i==null?void 0:i.participants)??[];if(!r.every($=>{var j;let V=(j=ph({tournamentParticipants:D,participantId:$}))==null?void 0:j.participantType;return!(V&&[xt,Ws].includes(V)&&vm(a))&&!(a&&d!=null&&d.eventType&&V===ti&&[Kl,rl].includes(d.eventType)&&[xl,...DR].includes(a))}))return{error:PB};let R=d&&Hn({event:d}).flightProfile,N=(f=R==null?void 0:R.flights)==null?void 0:f.find($=>$.drawId===u),M=$=>{let j=($||[]).filter(H=>!c||!H.entryStage||c===H.entryStage).filter(({participantId:H})=>r.includes(H)),V=H=>a&&E.includes(H.participantId)&&!(DR.includes(H.entryStatus)&&DR.includes(a));return j.every(H=>V(H)&&!e?!1:(a&&(H.entryStatus=a,delete H.entryPosition),o&&(H.entryStage=o,delete H.entryPosition),s&&(s.value?hi({element:H,extension:s}):qa({element:H,name:s.name})),!0))?{...ae}:{error:Z0}},A=({flight:$,drawDefinition:j})=>{d&&(d.entries=_u({entries:d.entries??[]})),$&&($.drawEntries=_u({entries:$.drawEntries})),j&&(j.entries=_u({entries:j.entries}))},_=$=>{let{flight:j,drawDefinition:V}=$,H="updateDrawEntries";if(j){let z=M(j.drawEntries);if(z.error)return ue({result:z,stack:H})}if(V){let z=M(V.entries);if(z.error)return ue({result:z,stack:H});P.includes(V.drawId)||P.push(V.drawId)}return{...ae}},k=((h=d==null?void 0:d.entries)==null?void 0:h.find(({entryPosition:$})=>$))??(((m=N==null?void 0:N.drawEntries)==null?void 0:m.find(({entryPosition:$})=>$))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!k&&A({flight:N,drawDefinition:n}),N||n){let $=_({flight:N,drawDefinition:n});if($.error)return ue({result:$,stack:U})}let B=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],F=((y=R==null?void 0:R.flights)==null?void 0:y.filter($=>!B.includes($.drawId)))||[];for(let $ of F){let j=$&&_({flight:$});if(j!=null&&j.error)return ue({result:j,stack:U})}let x=((b=R==null?void 0:R.flights)==null?void 0:b.length)===1&&(((I=d==null?void 0:d.drawDefinitions)==null?void 0:I.length)??0)<=((T=R==null?void 0:R.flights)==null?void 0:T.length);if(!N&&!n&&a&&ufe.includes(a))return{error:Rde};if(!N&&!n||a===xp||l&&x){let $=M(d==null?void 0:d.entries);if($!=null&&$.error)return ue({result:$,stack:U});let j;if(a===xp&&((w=R==null?void 0:R.flights)==null||w.every(V=>{let H=M(V.drawEntries);return H.error?(j=H.error,!1):(V.drawEntries=V.drawEntries.filter(({participantId:z})=>!r.includes(z)),!0)}),(S=d==null?void 0:d.drawDefinitions)==null||S.every(V=>{var H;let z=M(V.entries);return z.error?(j=z.error,!1):(V.entries=(H=V.entries)==null?void 0:H.filter(({participantId:q})=>!r.includes(q)),!0)})),j)return ue({result:{error:j},stack:U})}t&&A({flight:N,drawDefinition:n});for(let $ of(d==null?void 0:d.drawDefinitions)??[])P.length&&!P.includes($.drawId)||Qi({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...ae}}function Wfe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:c,drawId:d,score:p}=t;!c||!Object.keys(c).length||n===Di||e[i].scheduleItems.push({...c,scheduledDate:Bt(c==null?void 0:c.scheduledDate),scheduledTime:an(c==null?void 0:c.scheduledTime),checkScoreHasValue:Jr({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:d})}function ud({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:cb};if(!ln(e))return{error:Se};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,u=[uy,o,s,l].join("."),c=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===u).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(c){let[d,p,f,h]=((n=c.itemType)==null?void 0:n.split("."))??[];if(d!==uy)return{error:hP};let m=((r=a&&Ov({element:c.itemValue,accessor:a}))==null?void 0:r.value)||c.itemValue,g={eventType:f,scaleDate:c.itemDate,scaleValue:m,scaleName:h,scaleType:p};return{...ae,scaleItem:g}}}return{...ae,scaleItem:void 0}}function QVe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var a,o,s;let l={},u=f=>[uy,sd,r.eventType,f].join("."),c=Object.assign({},...(n.timeItems||[]).filter(({itemType:f})=>f.split(".")[1]===sd).map(({itemType:f,itemValue:h})=>({[f]:h}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(u),p=$n(Object.keys(c),d);if((!e||!Object.keys(c).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let f=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=u(t.stageSeedingScaleNames[m]),v=c[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),h=Object.assign({},...f);l.seedAssignments=h}else if(p){let f=p.map(h=>c[h]);l.seedValue=f.pop()}}else if(!e&&typeof i=="object"){let f=Object.keys(i).map(m=>{let g=u(i[m]),v=c[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),h=Object.assign({},...f);l.seedAssignments=h}else{let{categoryName:f,ageCategoryCode:h}=r.category||{},m=[h,r.eventId,f].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:sd,scaleName:v},b=ud({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function eje({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:c,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...Zq(d??[])):{},f=Object.assign(p,{entryPosition:c,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=ft(f,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function IO(t,e){return(t||"").localeCompare(e||"")}function tje({tournamentRecord:t,status:e=ou}){var i,n,r;let a=`${Bg}.${$g}`;return(r=(n=(i=VP({tournamentRecord:t,itemType:a}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function ije(t){let{tournamentId:e}=t??{};return!!e}function fl({event:t,status:e=ou}){var i,n,r;let a=`${Bg}.${$g}`;return(r=(n=(i=$P({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function zW({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function Sb(t){var e,i,n,r,a,o,s;let{tournamentRecord:l,drawDefinition:u,eventIds:c,eventId:d,drawIds:p,drawId:f,event:h}=t??{};if(l&&!ije(l))return{error:Se};if(d&&!h)return{error:es};if(Array.isArray(c)&&c!=null&&c.length){let b={};for(let I of c){if(!mo(I))return{error:Se};let T=(e=vo({tournamentRecord:l,eventId:I}))==null?void 0:e.event;if(!T)return{error:es};let w=eF({event:T});b[I]=w}return{...ae,publishState:b}}if(h){let b=eF({event:h}),I={};if(f)return u?{publishState:{status:{published:!!((i=b.status.publishedDrawIds)!=null&&i.includes(f)),drawDetail:(n=b.status.drawDetails)==null?void 0:n[f]},...ae}}:{error:Qo};if(Array.isArray(p)&&p!=null&&p.length){let T=((r=h.drawDefinitions)==null?void 0:r.map(WU))??[];for(let w of p){if(!mo(w))return{error:Se};if(!T.includes(w))return{error:Qo};I[w]={status:{published:!!b.status.publishedDrawIds.includes(w),drawDetail:(a=b.status.drawDetails)==null?void 0:a[w]}}}}else I=b;return{...ae,publishState:I}}let m=[],g=!1,v={},y=tje({tournamentRecord:l});v.tournament=y??{};for(let b of(l==null?void 0:l.events)??[]){let I=eF({event:b});v[b.eventId]=I,I.status.published&&(m.push(b.eventId),g=!0);for(let{drawId:T}of b.drawDefinitions??[]){let w=(s=(o=I.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(T);w&&(v[T]={status:{published:w}})}}return l&&(v.tournament.status={published:g,publishedEventIds:m}),{...ae,publishState:v}}function eF({event:t}){var e;let i=fl({event:t});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let o of((e=t.drawDefinitions)==null?void 0:e.map(WU))||[])r[o]||(r[o]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter(o=>zW({drawDetails:r,drawId:o}))||i.drawIds;return{status:{published:a&&a.length>0,publishedDrawIds:a,publishedSeeding:n,drawDetails:r}}}function nje({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:c,stage:d}){let p=e[a],f=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:c});let h=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(h.winCount+=1,r===Ni&&(h.walkoverWinCount+=1),r===bi&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||f(v)<f(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=u,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=n))}function IK(t){var e,i,n,r,a,o,s,l,u,c;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:f,participantMap:h,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:b,finishingRound:I,matchUpStatus:T,stageSequence:w,roundNumber:S,structureId:U,score:P,stage:E,withRankingProfile:D,tieWinningSide:R,roundPosition:N,matchUpTieId:M,matchUpSides:A,collectionId:_,matchUpType:k,winningSide:B,matchUpId:F,schedule:x,eventId:$,drawId:j,sides:V}=t,H=m&&(V==null?void 0:V.length)===2&&Object.assign({},...V.map(({sideNumber:z},q)=>{let W=V[1-q].participantId;return z&&{[z]:W}}).filter(Boolean));for(let z of V){let{participantId:q,sideNumber:W,bye:Y}=z;if(Y)continue;let Z=B===W,X=J=>{var ee,ne;let ie=(ee=h[J])==null?void 0:ee.participant,oe=ie==null?void 0:ie.participantType,se=[{participantId:J,participantType:oe}];if(oe!==Ws)for(let pe of(ie==null?void 0:ie.individualParticipantIds)||[]){let fe=(ne=h[pe])==null?void 0:ne.participant;se.push({participantType:fe==null?void 0:fe.participantType,participantId:pe})}return se},Q=(J,ee)=>{if(g){if(h[J].matchUps[F]={participantWon:Z,matchUpType:k,structureId:U,sideNumber:W,matchUpId:F,eventId:$,drawId:j,stage:E},m){let ne=X(ee);h[J].matchUps[F].opponentParticipantInfo=ne}_&&(h[J].matchUps[F].collectionId=_)}m&&ee&&(h[J].opponents[ee]={participantId:ee,matchUpId:F,eventId:$,drawId:j}),D&&nje({finishingPositionRange:b,participantMap:h,participantWon:Z,finishingRound:I,matchUpStatus:T,participantId:J,stageSequence:w,roundNumber:S,structureId:U,matchUpId:F,drawId:j,stage:E}),(p||d)&&Wfe({participantMap:h,participantId:J,matchUpStatus:T,roundPosition:N,matchUpType:k,roundNumber:S,structureId:U,matchUpId:F,schedule:x,drawId:j,score:P})},ce=({participant:J,partnerParticipantId:ee})=>{var ne,ie,oe;let se=(pe,fe)=>{pe&&(pe.partnerParticipantIds||(pe.partnerParticipantIds=[]),pe.partnerParticipantIds.includes(fe)||pe.partnerParticipantIds.push(fe))};y&&se((ne=J==null?void 0:J.draws)==null?void 0:ne[j],ee),v&&se((ie=J==null?void 0:J.events)==null?void 0:ie[$],ee),g&&se((oe=J==null?void 0:J.matchUps)==null?void 0:oe[F],ee)};if(q&&h[q]){let J=H==null?void 0:H[W];Q(q,J);let ee=((e=h[q])==null?void 0:e.participant.participantType)===xt,ne=((i=h[q])==null?void 0:i.participant.individualParticipantIds)||[];if(M){if(f){let ie=oe=>h[oe].matchUps[M]={participantWon:R===W,matchUpId:M,matchUpType:Xi,sideNumber:W};ie(q),ne.forEach(ie)}if(y&&!h[q].draws[j]){let ie=(r=(n=A.find(pe=>pe.sideNumber===W))==null?void 0:n.participant)==null?void 0:r.participantId,oe=(s=(o=(a=h[ie])==null?void 0:a.draws)==null?void 0:o[j])==null?void 0:s.entryStatus,se=pe=>h[pe].draws[j]={entryStatus:oe,eventId:$,drawId:j};se(q),ne.forEach(se)}}if(ee&&(ne.forEach(ie=>h[ie]&&Q(ie,J)),ne.forEach((ie,oe)=>{let se=ne[1-oe],pe=h[ie];pe&&ce({participant:pe,partnerParticipantId:se})}),v&&A)){let ie=(u=(l=A.find(oe=>oe.sideNumber===W))==null?void 0:l.participant)==null?void 0:u.participantId;if(ie){let oe=(c=h[ie])==null?void 0:c.events[$];oe?(h[q].events[$]={...oe},ne.forEach(se=>h[se].events[$]={...oe})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:ie})}}if(B){let ie=oe=>{Z?(h[oe].counters[k].wins+=1,h[oe].counters.wins+=1,T===Ni&&(h[oe].counters[k].walkoverWins+=1,h[oe].counters.walkoverWins+=1),T===bi&&(h[oe].counters[k].defaultWins+=1,h[oe].counters.defaultWins+=1)):(h[oe].counters[k].losses+=1,h[oe].counters.losses+=1,T===Ni&&(h[oe].counters[k].walkovers+=1,h[oe].counters.walkovers+=1),T===bi&&(h[oe].counters[k].defaults+=1,h[oe].counters.defaults+=1))};ie(q),ne.forEach(ie)}}}}function rje(t){var e,i,n,r,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:c,tournamentRecord:d,usePublishState:p,contextProfile:f,participantMap:h,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:b,withStatistics:I,withOpponents:T,withMatchUps:w,withSeeding:S,withEvents:U,withDraws:P}=t,E=l==null?void 0:l.participantIds,D=x=>{var $,j;let V=[x];return(j=($=h[x])==null?void 0:$.participant.individualParticipantIds)==null||j.forEach(H=>V.push(H)),V.some(H=>!(E!=null&&E.length)||E.includes(H))?V:[]},R={withMatchUps:w||g,withEvents:U||g,withDraws:P||g,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:b,withStatistics:I,participantMap:h,withOpponents:T,withSeeding:S},N=[],M={},A=[],_={},k={},B={},F=({eventType:x,scaleNames:$,participantId:j})=>{var V,H,z,q;return(q=(z=(H=(V=h[j].participant)==null?void 0:V.rankings)==null?void 0:H[x])==null?void 0:z.find(W=>$.includes(W.scaleName)))==null?void 0:q.scaleValue};for(let x of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(x.eventId))continue;let{drawDefinitions:$=[],extensions:j=[],eventType:V,eventName:H,category:z,entries:q,eventId:W,gender:Y}=x,{flightProfile:Z}=Hn({event:x}),X=(Z==null?void 0:Z.flights)??[],Q=Sb({event:x}).publishState;Q&&(_[W]=Q);let ce=(e=Q==null?void 0:Q.status)==null?void 0:e.publishedSeeding;if(U||S||g){let ee=u?Object.assign({},...Zq(j??[])):{};k[W]={...ee,eventName:H,eventType:V,category:z,eventId:W,gender:Y};let ne=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean);for(let ie of q){let{participantId:oe}=ie;if(!oe||!h[oe])continue;let se=F({eventType:V,scaleNames:ne,participantId:oe}),pe,fe;if(S){let me=h[oe].participant;({seedAssignments:pe,seedValue:fe}=QVe({publishedSeeding:ce,usePublishState:p,withSeeding:S,participant:me,event:x}))}let ge=me=>{var Ee,Be;if((Be=(Ee=h[me])==null?void 0:Ee.events)!=null&&Be[W])return;let Pe=h[me];eje({convertExtensions:u,seedAssignments:pe,participant:Pe,withSeeding:S,seedValue:fe,eventId:W,ranking:se,entry:ie})};ge(oe),(h[oe].participant.individualParticipantIds||[]).forEach(ge)}}let J=(i=_==null?void 0:_[W])==null?void 0:i.publishedSeeding;if(P||g||S){let ee=ie=>ie?Object.assign({},...ie.map(({participantId:oe,seedValue:se,seedNumber:pe})=>({[oe]:{seedValue:se,seedNumber:pe}}))):void 0,ne=Ht([...$.map(WU),...X.map(WU)]);for(let ie of ne){let oe=$.find(he=>he.drawId===ie),se=X==null?void 0:X.find(he=>he.drawId===ie),pe=(oe==null?void 0:oe.entries)||(se==null?void 0:se.drawEntries),{structures:fe=[],drawOrder:ge,drawName:me,drawType:Ee}=oe??{},Be=se==null?void 0:se.flightNumber,Pe=[z==null?void 0:z.categoryName,z==null?void 0:z.ageCategoryCode].filter(Boolean),et=((oe==null?void 0:oe.structures)||[]).sort((he,ve)=>gb(he,ve)).map(({structureId:he,structures:ve})=>[he,...(ve||[]).map(({structureId:Ce})=>Ce)]).flat(1/0),Ie,Ne,be,Le,Me=0,Ze=fe.filter(({stage:he,stageSequence:ve})=>he===at&&ve===1||he===vt).flatMap(he=>{let{seedAssignments:ve,stageSequence:Ce,stage:De}=he,{positionAssignments:Ue}=Hi({structure:he});return De===at?(Me=(Ue==null?void 0:Ue.length)??0,be=Ue,Le=ve):Ce===1&&(Ie=Ue,Ne=ve),Ue}).map(({participantId:he})=>he).filter(Boolean),qe=ee(Le),ye=ee(Ne),_e=oe?pe.filter(({participantId:he})=>Ze.includes(he)):pe,Ae=!p||(J==null?void 0:J.published)&&(((n=J==null?void 0:J.drawIds)==null?void 0:n.length)===0||((r=J==null?void 0:J.drawIds)==null?void 0:r.includes(ie)));for(let he of _e){let{entryStatus:ve,entryStage:Ce,entryPosition:De,participantId:Ue}=he,Qe=F({participantId:Ue,scaleNames:Pe,eventType:V}),je=ke=>{var bt,Gt,Zt,Sr,Oo;if((bt=h[ke].draws)!=null&&bt[ie])return;let ri=S&&Ae,Tr=ri?{}:void 0,Xn=ri?((Gt=qe==null?void 0:qe[Ue])==null?void 0:Gt.seedValue)||((Zt=qe==null?void 0:qe[Ue])==null?void 0:Zt.seedNumber):void 0,It=Xn?qe==null?void 0:qe[Ue]:void 0,hr=ri?((Sr=ye==null?void 0:ye[Ue])==null?void 0:Sr.seedValue)||((Oo=ye==null?void 0:ye[Ue])==null?void 0:Oo.seedNumber):void 0,os=hr?ye==null?void 0:ye[Ue]:void 0;Tr&&Xn&&(Tr[at]=It),Tr&&hr&&(Tr[vt]=os);let ss=Xn||hr;ss&&(h[ke].participant.seedings[V]||(h[ke].participant.seedings[V]=[]),It&&h[ke].participant.seedings[V].push({...It,scaleName:ie}),os&&h[ke].participant.seedings[V].push({...os,scaleName:ie}),Tr&&(h[ke].events[W].seedAssignments||(h[ke].events[W].seedAssignments={}),Object.keys(Tr).forEach(Io=>h[ke].events[W].seedAssignments[Io]=Tr[Io]))),(P||g)&&(h[ke].draws[ie]=ft({seedAssignments:Tr,entryPosition:De,entryStatus:ve,entryStage:Ce,seedValue:ss,eventId:W,ranking:Qe,drawId:ie},!1,!1,!0))};[ru,xg].includes(ve)||(je(Ue),(a=h[Ue].participant.individualParticipantIds||[])==null||a.forEach(je))}let Ve=((oe==null?void 0:oe.structures)??[]).reduce((he,ve)=>(he.includes(ve.stage)||he.push(ve.stage),he),[]),Ke=((oe==null?void 0:oe.links)??[]).length;B[ie]={qualifyingPositionAssignments:Ie,qualifyingSeedAssignments:Ne,mainPositionAssignments:be,qualifyingSeedingMap:ye,mainSeedAssignments:Le,orderedStructureIds:et,mainSeedingMap:qe,flightNumber:Be,linksCount:Ke,drawOrder:ge,drawName:me,drawType:Ee,drawSize:Me,drawId:ie,stages:Ve}}}if(g||y||b||I||T||w||P){let ee=!!y||m,ne=((o=cf({afterRecoveryTimes:!!y,policyDefinitions:c,tournamentRecord:d,inContext:!0,contextProfile:f,participantMap:h,nextMatchUps:ee,event:x}))==null?void 0:o.matchUps)??[];for(let ie of ne){let{finishingPositionRange:oe,potentialParticipants:se,tieMatchUps:pe=[],sides:fe=[],winningSide:ge,matchUpType:me,matchUpId:Ee,eventId:Be,drawId:Pe,collectionId:et,stageSequence:Ie,finishingRound:Ne,matchUpStatus:be,roundPosition:Le,roundNumber:Me,structureId:Ze,schedule:qe,score:ye,stage:_e}=ie;M[Ee]=ie;let Ae={finishingPositionRange:oe,finishingRound:Ne,stageSequence:Ie,roundPosition:Le,collectionId:et,roundNumber:Me,structureId:Ze,schedule:qe,eventId:Be,drawId:Pe,score:ye,stage:_e};IK({...Ae,...R,matchUpStatus:be,winningSide:ge,matchUpType:me,matchUpId:Ee,sides:fe});for(let Ve of pe){let{winningSide:Ke,sides:he=[],matchUpId:ve,matchUpStatus:Ce,matchUpType:De}=Ve;IK({...Ae,...R,winningSide:Ke,tieWinningSide:ge,matchUpTieId:Ee,matchUpId:ve,sides:he,matchUpSides:fe,matchUpStatus:Ce,matchUpType:De})}Array.isArray(se)&&(ee||y||v)&&((s=se.flat().map(ei).filter(Boolean))==null||s.forEach(Ve=>{var Ke;(Ke=D(Ve))==null||Ke.forEach(he=>{h[he]&&(h[he].potentialMatchUps[Ee]=ft({tournamentId:d==null?void 0:d.tournamentId,matchUpId:Ee,eventId:Be,drawId:Pe}))}),(y||v)&&Wfe({potential:!0,participantMap:h,participantId:Ve,matchUpStatus:be,roundPosition:Le,structureId:Ze,matchUpType:me,roundNumber:Me,matchUpId:Ee,schedule:qe,drawId:Pe,score:ye})}))}A.push(...ne)}}if(I||g||y){let x=Object.values(h);for(let $ of x){let{wins:j,losses:V,[Pn]:{wins:H,losses:z},[Yi]:{wins:q,losses:W}}=$.counters,Y=(Z,X,Q)=>{let ce=X+Q,J=X,ee=ce&&J/ce;$.statistics[Z]={denominator:ce,numerator:J,statValue:ee,statCode:Z}};if(I&&(Y(PR,j,V),Y(`${PR}.${Pn}`,H,z),Y(`${PR}.${Yi}`,q,W)),g){let Z=(X=[])=>Math.abs(X[0]-X[1]);for(let X of Object.keys($.draws)){let{orderedStructureIds:Q=[],flightNumber:ce}=B[X]||{};if($.structureParticipation&&Q.length){let J,ee=0,ne=Q.map(ie=>{let oe=$.structureParticipation[ie];if(!oe)return;J||(J=oe==null?void 0:oe.finishingPositionRange),Z(J)>Z(oe==null?void 0:oe.finishingPositionRange)&&(J=oe==null?void 0:oe.finishingPositionRange);let se=oe.stage!==vt;return se&&(ee+=1),ft({...oe,participationOrder:se?ee:void 0,flightNumber:ce})}).filter(Boolean);$.draws[X]&&($.draws[X].finishingPositionRange=J,$.draws[X].structureParticipation=ne)}}}if(y){let Z=ln(y)?y.scheduledMinutesDifference:0,X=$.scheduleItems||[],Q=$.potentialMatchUps||{},ce=X.reduce((ee,ne)=>{let{scheduledDate:ie,scheduledTime:oe}=ne;return ee[ie]||(ee[ie]=[]),oe&&ee[ie].push(ne),ee},{});Object.values(ce).forEach(ee=>ee.sort(Dpe));for(let ee of X){let{typeChangeTimeAfterRecovery:ne,timeAfterRecovery:ie,scheduledDate:oe,scheduledTime:se}=ee,pe=ce[oe],fe=ui(se);for(let ge of pe){if(ge.matchUpId===ee.matchUpId||[Ni,bi].includes(ge.matchUpStatus)&&!ge.checkScoreHasValue)continue;let me=ee.matchUpType!==ge.matchUpType&&ne||ie,Ee=ee.drawId===ge.drawId,Be=Q[ee.matchUpId]&&Q[ge.matchUpId],Pe=ui(ge.scheduledTime),et=Math.abs(Pe-fe),Ie=Pe>=fe;if((Z&&!isNaN(Z)?et<=Z:Ie&&ui(ge.scheduledTime)<ui(me))&&!(Be&&Ee)&&Ie){let Ne=[ee.matchUpId,ge.matchUpId].sort(IO).join("|");$.scheduleConflicts[Ne]={priorScheduledMatchUpId:ee.matchUpId,matchUpIdWithConflict:ge.matchUpId}}}}let J=$.participant.participantId;Object.keys($.scheduleConflicts).length&&N.push(J),h[J].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:_,derivedEventInfo:k,derivedDrawInfo:B,mappedMatchUps:M,participantMap:h,matchUps:A}}function zP({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:c,participantIds:d,signInStatus:p,enableOrFiltering:f,eventIds:h,genders:m}=t,g=zc(h)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(T=>h==null?void 0:h.includes(T.eventId)))||(e==null?void 0:e.events)||[],v=a&&aje({drawEntryStatuses:a,tournamentEvents:g}),y=s&&oje({eventEntryStatuses:s,tournamentEvents:g}),b=o!==void 0&&[!0,!1].includes(o)&&g.reduce((T,w)=>T.concat(...(w.drawDefinitions||[]).map(S=>Qpe({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),I=T=>r==null?void 0:r.reduce((w,S)=>{let{accessor:U,value:P}=S,{values:E}=Ov({element:T,accessor:U});return w&&(E==null?void 0:E.includes(P))},!0);if(i=i==null?void 0:i.filter(T=>{var w,S;let U=(S=(w=Lc({element:T,itemType:EP}))==null?void 0:w.timeItem)==null?void 0:S.itemValue,{participantRoleResponsibilities:P,participantType:E,participantRole:D,participantId:R,person:N}=T,M=Array.isArray(m)&&(m==null?void 0:m.length)&&(N==null?void 0:N.sex)&&m.includes(N.sex);return f?m&&M||o&&b.includes(R)||o===!1&&!b.includes(R)||(v==null?void 0:v.includes(R))||(y==null?void 0:y.includes(R))||(d==null?void 0:d.includes(R))||p&&U===p||c&&E&&zc(c)&&c.includes(E)||l&&D&&zc(l)&&l.includes(D)||u&&zc(P)&&zc(u)&&u.find(A=>P==null?void 0:P.includes(A))||(r==null?void 0:r.length)&&zc(r)&&I(T):(!m||M)&&(o===void 0||o&&b.includes(R)||o===!1&&!b.includes(R))&&(!v||v.includes(R))&&(!y||y.includes(R))&&(!d||d.includes(R))&&(!p||U===p)&&(!c||E&&zc(c)&&c.includes(E))&&(!l||D&&zc(l)&&l.includes(D))&&(!u||zc(P)&&zc(u)&&u.find(A=>P==null?void 0:P.includes(A)))&&(!(r!=null&&r.length)||zc(r)&&I(T))}),g.length&&h){let T=g.filter(w=>h.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(P=>P.participantId);if(xn(kd)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(P=>S.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>T.includes(w.participantId))}return i}function zc(t){return t&&Array.isArray(t)&&t.length}function aje({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Ht(e.reduce((n,r)=>{var a,o;let{flightProfile:s}=Hn({event:r}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:c})=>Array.isArray(c)?c.filter(i).map(ei):[]).flat())||[],u=((o=r.drawDefinitions)==null?void 0:o.map(({entries:c})=>c?c.filter(i).map(ei):[]))||[];return n.concat(...l,...u)},[]))}function oje({eventEntryStatuses:t,tournamentEvents:e}){return Ht(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(ei);return i.concat(...r)},[]))}function jn(t){var e;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:c,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:f,usePublishState:h,contextProfile:m,withStatistics:g,withOpponents:v,withMatchUps:y,internalUse:b,withSeeding:I,withEvents:T,withDraws:w,withISO2:S,withIOC:U}=t;if(!u)return{error:Oe};(y||a)&&su({tournamentRecord:u});let{participantMap:P}=jfe({convertExtensions:o,tournamentRecord:u,withSignInStatus:d,withScaleValues:f,internalUse:b,withISO2:S,withIOC:U}),E=rje({withMatchUps:y??a,withEvents:T??a,withDraws:w??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:c,withTeamMatchUps:p,usePublishState:h,withStatistics:g,participantMap:P,withOpponents:v,contextProfile:m,withSeeding:I}),{participantIdsWithConflicts:D,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,mappedMatchUps:A}=E,_=E.matchUps;P=E.participantMap;let k=c??r,B=({potentialMatchUps:H,scheduleConflicts:z,scheduleItems:q,participant:W,statistics:Y,opponents:Z,matchUps:X,events:Q,draws:ce})=>{let J=Object.values(ce),ee=Object.values(Z);return v&&(J==null||J.forEach(ne=>{ne.opponents=ee.filter(ie=>ie.drawId===ne.drawId)})),ft({...W,scheduleConflicts:c?Object.values(z):void 0,draws:w||a?J:void 0,events:T||a?Object.values(Q):void 0,matchUps:y||a?Object.values(X):void 0,opponents:v?ee:void 0,potentialMatchUps:k?Object.values(H):void 0,statistics:g?Object.values(Y):void 0,scheduleItems:l?q:void 0},!1,!1,!0)},F=new Map;for(let H of Object.keys(P))F.set(H,B(P[H]));let x=[...F.values()],$=(e=s==null?void 0:s[nS])==null?void 0:e.participant,j=zP({participants:x,participantFilters:n,tournamentRecord:u});if(i){let H=ln(i)?i:void 0;for(let z of j)for(let q of z.individualParticipantIds??[]){z.individualParticipants||(z.individualParticipants=[]);let W=F.get(q);z.individualParticipants.push(H?cy({template:H,source:W}):W)}}let V=$?j.map(H=>cy({source:H,template:$})):j;return{participantIdsWithConflicts:D,eventsPublishStatuses:R,derivedEventInfo:N,derivedDrawInfo:M,mappedMatchUps:A,participantMap:P,participants:V,...ae,matchUps:_}}function xv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:nt};let a=(r=e.entries)==null?void 0:r.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&a}function hS(t){var e,i,n,r,a,o,s,l,u;let{provisionalPositioning:c,drawDefinition:d,stageSequence:p,structureId:f,stage:h}=t;if(!d)return{error:nt};let{entryProfile:m}=CP({drawDefinition:d}),g=h&&p&&((n=(i=(e=m==null?void 0:m[h])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:n.qualifiersCount)||h&&((r=m==null?void 0:m[h])==null?void 0:r.qualifiersCount)||0,v={};if(!f)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=Pt({drawDefinition:d,structureId:f}),b=(a=d.links)==null?void 0:a.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(y==null?void 0:y.structureId)}),I=0;if(b!=null&&b.length)for(let w of b){let S=(o=Pt({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((S==null?void 0:S.stage)===vt){let U=w.source.roundNumber,P=w.target.roundNumber,E=0;if(S.structureType===oo){let D=((s=S.structures)==null?void 0:s.length)??0,R=((l=w.source.finishingPositions)==null?void 0:l.length)??0;E=D*R}else E=((u=Ci({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps)==null?void 0:u.length)||0;v[P]||(v[P]=0),v[P]+=E,I+=E}}let T=Object.keys(v);if(T.length<=1){let w=T[0]||1;v[w]=Math.max(v[w]||0,g)}return I=Math.max(I,g),{qualifiersCount:I,roundQualifiersCounts:v}}function TN({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=CP({drawDefinition:e});return((i=n==null?void 0:n[t])==null?void 0:i.drawSize)||0}function sje(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=TN({stage:r,drawDefinition:i}),{qualifiersCount:o}=hS({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function Kfe({stage:t,drawDefinition:e}){return!!(t===jr||RW({stage:t,drawDefinition:e})&&TN({stage:t,drawDefinition:e}))}function Yfe({entryStatus:t=ys,drawDefinition:e,stageSequence:i,stage:n}){if(t===xl)return L$e({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ae}:{error:Cde};let r=sje({drawDefinition:e,stageSequence:i,stage:n}),a=F$e({drawDefinition:e,stage:n}),o=LB({entryStatus:kw,drawDefinition:e,stage:n}),s=LB({entryStatus:ys,drawDefinition:e,stage:n}),l=o+s,u=l>=r,c=r-l;return n!==jr&&u?{error:EB}:t===kw?o<a?{...ae}:{error:EB}:{positionsAvailable:c,...ae}}function Zfe(t){let{entryStatus:e=ys,entryStageSequence:i,entryStage:n=at,ignoreStageSpace:r,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:u,extension:c,drawType:d}=t,p="addDrawEntry";if(!a)return{error:nt};if(!n)return{error:fq};if(d!==ql&&!Kfe({stage:n,drawDefinition:a}))return ue({result:{error:Ag},stack:p});let f=Yfe({stageSequence:i,stage:n,drawDefinition:a,entryStatus:e});if(!r&&!f.success&&(!d||d!==ql))return{error:f.error};if(c&&!wc({extension:c}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:c},stack:p});let h=t.participantId||(s==null?void 0:s.participantId);if(!h)return ue({result:{error:wr},stack:p});let m=e===Op&&xv({participantId:h,drawDefinition:a,entryStatus:e}),g=n===jr&&xv({participantId:h,drawDefinition:a,entryStage:n}),v=e!==Op&&n!==jr&&xv({drawDefinition:a,participantId:h});if(v||m||g)return ue({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:jk},stack:p});let y=ft({entryStageSequence:i,participantId:h,entryPosition:o,entryStatus:e,entryStage:n,extensions:u});return c&&hi({element:y,extension:c}),l&&hi({extension:{name:"roundEntry",value:l},element:y}),a.entries||(a.entries=[]),a.entries.push(y),Qi({drawDefinition:a}),{...ae}}function lje(t){let e="addDrawEntries",{entryStatus:i=ys,stage:n=at,autoEntryPositions:r=!0,ignoreStageSpace:a,drawDefinition:o,participantIds:s,stageSequence:l,roundTarget:u,extension:c}=t;if(!n)return{error:fq};if(!o)return{error:nt};if(!Array.isArray(s))return{error:Ol};if(!Kfe({stage:n,drawDefinition:o}))return{error:Ag};if(c&&!wc({extension:c}))return ue({result:{error:Se},info:"Invalid extension",context:{extension:c},stack:e});let d=Yfe({drawDefinition:o,stageSequence:l,entryStatus:i,stage:n});if(!a&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!a&&n!==jr&&p<s.length)return{error:Sq};let f=s.reduce((h,m)=>{let g=i===Op&&xv({participantId:m,drawDefinition:o,entryStatus:i}),v=n===jr&&xv({entryStage:n,drawDefinition:o,participantId:m});return i!==Op&&n!==jr&&xv({drawDefinition:o,participantId:m})||g||v?h.concat(m):h},[]);return s.filter(h=>h&&!f.includes(h)).forEach(h=>{let m={entryStageSequence:l,entryStage:n,participantId:h,entryStatus:i};c&&hi({element:m,extension:c}),u&&hi({extension:{name:Oc,value:u},element:m}),o.entries||(o.entries=[]),o.entries.push(m)}),r&&(o.entries=_u({entries:o.entries})),Qi({drawDefinition:o}),f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:f,...ae}:{...ae}}function qW({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:u,event:c}){if(!(r!=null&&r.length))return{error:Fh};if(!c)return{error:es};if(!u)return{error:Ku};let d=(c.entries||[]).map(ei);if(r.filter(h=>!d.includes(h)).length)return{error:ode};if(n){let h=lje({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,extension:l});if(h.error)return h}let{flightProfile:p}=Hn({event:c}),f=p==null?void 0:p.flights.find(h=>h.drawId===u);return f!=null&&f.drawEntries&&(r.forEach(h=>{let m=a===Op&&tF({participantId:h,entryStatus:a,flight:f}),g=s===jr&&tF({participantId:h,entryStage:s,flight:f});!(a!==Op&&s!==jr&&tF({flight:f,participantId:h}))&&!m&&!g&&f.drawEntries.push({participantId:h,entryStatus:a,entryStage:s})}),t&&(f.drawEntries=_u({entries:f.drawEntries}))),{...ae}}function tF({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;let a=(r=n.drawEntries)==null?void 0:r.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function qP({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var a,o,s,l;let u="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Oi};if(!Array.isArray(e)||e.some(m=>!mo(m)))return ue({result:{error:Ic},stack:u});let c=(r.drawDefinitions??[]).flatMap(m=>Gg({drawDefinition:m}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(ei).filter(m=>!c.includes(m)),p=(n&&((o=r.entries)==null?void 0:o.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(ei).filter(m=>!c.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=$n(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&c.some(m=>e.includes(m)))return ue({result:{error:Z0},stack:u});if(!(e!=null&&e.length))return{...ae,participantIdsRemoved:[]};let f=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||f.push(m.participantId),g}),t&&(r.entries=_u({entries:r.entries}));let{flightProfile:h}=Hn({event:r});return(s=h==null?void 0:h.flights)==null||s.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ae,participantIdsRemoved:f}}var Xfe={[Vr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},mS=Xfe;function cd(t){var e,i;let{entryStatus:n=ys,autoEntryPositions:r=!0,enforceGender:a=!0,participantIds:o=[],entryStageSequence:s,policyDefinitions:l,entryStage:u=at,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:p,roundTarget:f,extensions:h,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!v)return{error:Oi};if(!(o!=null&&o.length))return ue({result:{error:Fh},stack:y});if(!(v!=null&&v.eventId))return{error:es};let b=Ai({tournamentRecord:c,event:v}).appliedPolicies??{},I=(l==null?void 0:l[Vr])??(b==null?void 0:b[Vr])??mS[Vr],T=(a??((e=I==null?void 0:I.participants)==null?void 0:e.enforceGender))!==!1,w=[],S=[];if(h&&(!Array.isArray(h)||!h.every(A=>wc({extension:A})))||m&&!wc({extension:m}))return ue({context:ft({extension:m,extensions:h}),result:{error:Se},info:"Invalid extension(s)",stack:y});let U=!!c,P=[],E,D=((i=c==null?void 0:c.participants)==null?void 0:i.filter(A=>{var _,k,B;if(!o.includes(A.participantId))return!1;let F=xn(Pn)(v.eventType)&&A.participantType===ti&&!vm(n),x=v.eventType===Yi&&A.participantType===xt;return F&&(!v.gender||!T||[Ho,Uc].includes(v.gender)||v.gender===((_=A.person)==null?void 0:_.sex))||x&&!vm(n)||v.eventType===Yi&&A.participantType===ti&&vm(n)?!0:F&&v.gender&&T&&![Ho,Uc].includes(v.gender)&&v.gender!==((k=A.person)==null?void 0:k.sex)?(P.push({participantId:A.participantId,sex:(B=A.person)==null?void 0:B.sex}),!1):v.eventType===qi&&(A.participantType===qi||vm(n)&&A.participantType===ti)}).map(A=>A.participantId))??[],R=o.filter(A=>!U||D.includes(A));v.entries||(v.entries=[]);let N=v.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(R.forEach(A=>{var _;if(!N.includes(A)){let k=ft({participantId:A,entryStatus:n,entryStage:u,extensions:h});m&&hi({element:k,extension:m}),f&&hi({extension:{name:Oc,value:f},element:k}),s&&(k.entryStageSequence=s),w.push(k.participantId),(_=v.entries)==null||_.push(k)}}),g&&!vm(u)){let A=qW({participantIds:R,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:f,entryStage:u,extension:m,drawId:g,event:v});A.error&&(E=A.error)}if(v.eventType&&[vh,rl].includes(v.eventType)){let A=(v.entries||[]).map(F=>F.participantId),_=(v.entries||[]).filter(F=>vm(F.entryStatus)).map(F=>F.participantId),k=((c==null?void 0:c.participants)??[]).filter(F=>A.includes(F.participantId)&&F.participantType&&[xt,qi].includes(F.participantType)).map(F=>F.individualParticipantIds).flat(1/0),B=_.filter(F=>k.includes(F));B.length&&(S.push(...B),qP({participantIds:B,autoEntryPositions:!1,event:v}))}if(R.length!==o.length)return ue({context:{mismatchedGender:P,gender:v.gender},result:{error:Ol},stack:y});r&&(v.entries=_u({entries:v.entries||[]}));let M=w.length-S.length;return ue({result:{...ae,addedEntriesCount:M},stack:y,info:E})}var Jfe="ADMINISTRATION",uje="CAPTAIN",cje="COACH",Sa="COMPETITOR",Qfe="MEDIA",ehe="MEDICAL",WW="OFFICIAL",the="OTHER",ihe="SECURITY",KW={ADMINISTRATION:Jfe,CAPTAIN:uje,COACH:cje,COMPETITOR:Sa,MEDIA:Qfe,MEDICAL:ehe,OFFICIAL:WW,OTHER:the,SECURITY:ihe};function YW({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return ue({result:{error:Oe},stack:a});if(!i||!e)return ue({result:{error:dt},stack:a});let o=(n.participants??[]).find(c=>c.participantId===i);if(!o)return ue({result:{error:qn},stack:a});if(![qi,Us].includes(o.participantType))return ue({result:{participantType:o.participantType,error:Bu},stack:a});let s=nhe({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=s;if(u)return ue({result:s,stack:a});if(t)for(let c of n.events??[]){let d=(c.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(f=>!d.includes(f));cd({participantIds:p,entryStatus:ru,tournamentRecord:n,event:c})}}return l&&oi({topic:ma,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...ae,...s}}function nhe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let u=[],c=[];a||({participants:a,mappedMatchUps:r}=jn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:h})=>h),p=(e.individualParticipantIds??[]).filter(h=>{var m;let g=t==null?void 0:t.includes(h),v=g&&((m=a==null?void 0:a.find(b=>b.participantId===h))==null?void 0:m.matchUps.filter(({eventId:b})=>d.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||Jr({score:I}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(h),y){l.push(h);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=qt({element:I,name:Np}),w=T==null?void 0:T.value[e.participantId];T&&w&&(T.value[e.participantId]=w.filter(U=>U.participantId!==h),hi({element:I,extension:T}),DP({drawDefinition:I}));let S=po({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of S){let P=U.sides??[];for(let E of P){let D=E.lineUp??[];D.find(R=>R.participantId===h)&&(E.lineUp=D.filter(R=>R.participantId!==h),di({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else u.push(h);return!y});e.individualParticipantIds=p;let f={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:u,removed:l};return c.length&&!n&&{...f,cannotRemove:c,error:Vk}||f}function wO({participantRole:t=Sa,individualParticipantIds:e=[],groupingTypes:i=[Ws,Us],tournamentRecord:n}){if(!n)return{error:Oe};let r=n.participants??[],{participants:a,mappedMatchUps:o}=jn({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:u}=nhe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});u&&s++}),s?ae:{error:Tde}}function Tb(t){var e,i,n;if(!(t!=null&&t.tournamentRecord))return{error:Oe};if(!((e=t==null?void 0:t.participantIds)!=null&&e.length))return{error:Fh};let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:o}=t,s=((i=a.participants)==null?void 0:i.length)||0;if(!s)return{...ae};let l=(n=a.events||[])==null?void 0:n.filter(({eventType:g})=>g===Rr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),u=jn({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],c=()=>{let g=(Xr({matchUpFilters:{drawIds:l,matchUpTypes:[Yi]},tournamentRecord:a}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return $n(g,o)},d=(l==null?void 0:l.length)&&c(),p=u.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:Z0};let f={},h={};for(let g of a.events||[]){let v=qP({participantIds:o,event:g});if(v.error)return v;f[g.eventId]=v.participantIdsRemoved}a.participants=a.participants.filter(g=>{let v=o.includes(g.participantId)||g.participantType===xt&&g.individualParticipantIds.some(y=>o.includes(y));if(!v&&g.participantType===Rr&&g.individualParticipantIds.some(y=>o.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!o.includes(y))),v&&r&&[xt,qi].includes(g.participantType))for(let y of g.individualParticipantIds||[])o.includes(y)||(h[g.participantId]||(h[g.participantId]=[]),h[g.participantId].push(y));return!v});let m=s-a.participants.length;if(wO({individualParticipantIds:o,tournamentRecord:a}),r)for(let g of a.events||[]){let v=f[g.eventId].map(y=>h[y]||[]).flat();cd({participantIds:v,entryStatus:ru,tournamentRecord:a,event:g})}return m&&oi({payload:{participantIds:o,tournamentId:a.tournamentId},topic:mW}),m?{...ae,participantsRemovedCount:m}:{error:Vk}}function rhe({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var o;let s=r.entries??[];if(n){let{flightProfile:u}=Hn({event:r}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===n);c?s=c.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(u=>(!(i!=null&&i.length)||!u.entryStatus||i.includes(u.entryStatus))&&(!a||!u.entryStage||u.entryStage===a)&&(!t||u.entryStatus&&au.includes(u.entryStatus)));return{entries:s,stageEntries:l}}function ahe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:Oe};if(!n)return ue({result:{error:wr},stack:l});if(!o)return{error:Oi};if(!o.eventType||![vh,rl].includes(o.eventType))return ue({result:{error:ch},stack:l});let u=e.participants??[],c=u.find(y=>y.participantId===n);if(!c)return ue({result:{error:qn},stack:l});if(!c.participantType||![xt,Ws].includes(c.participantType)||c.participantType===Ws&&o.eventType!==rl||c.participantType===xt&&o.eventType!==vh)return{error:Bu};let d=(o.entries??[]).find(y=>y.participantId===n);if(!d)return{error:Ede};let{stageEntries:p}=rhe({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),f=p.map(ei),h=u.filter(({participantId:y})=>f.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(s=c.individualParticipantIds)==null?void 0:s.filter(y=>lc(y,h).length===1),g=qP({participantIds:[n],event:o});if(g.error||m!=null&&m.length&&(g=cd({participantIds:m,entryStatus:ru,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),g.error))return g;let v;return t&&Tb({participantIds:[n],tournamentRecord:e}).success&&(v=!0),{...ae,participantRemoved:v}}function ZW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return ahe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function ohe(t){if(!t.tournamentRecord)return{error:Oe};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=ahe({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...ae}:{error:r}}function t1(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",u=HP(t);if(u.error)return ue({result:u,stack:l});let{participantId:c}=u,{drawPosition:d,event:p,structureId:f}=t;if([xl,xp].includes(a)&&c){let{tournamentRecord:m}=t,{participant:g}=jg({tournamentRecord:m,participantId:c}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===xt){let b=ZW({tournamentRecord:m,drawDefinition:n,participantId:c,event:p});if(b.error)return ue({result:b,stack:l});y&&SN({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else SN({participantIds:[c],tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let m=Ds({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:f,matchUpsMap:o,event:p});if(m.error)return ue({result:m,stack:l})}let{structure:h}=Pt({drawDefinition:n,structureId:f});return PW({structure:h,drawPositions:[d]}),dO({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:f}}),u}function she(t){return Object.assign(t,{entryStatus:xp}),t1(t)}function zB(t){return mo(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ca(t){return mo(t)?zB(t.replace(/_/g," ")):""}var Kf=({finishingPosition:t=mb,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:c,matchUps:d=[],structureId:p,roundOffset:f,roundLimit:h,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??Li(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:u};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),c&&(y.matchUpType=c),f&&(y.roundOffset=f),m&&(y.stageOrder=m),h&&(y.roundLimit=h),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Ht(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},$s=Kf;function XW({structureName:t=ca(jr),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:nt};let a=$s({stage:jr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Qi({drawDefinition:i,structureIds:[a.structureId]}),{...ae}}function JW({drawPositions:t}){if(!(t!=null&&t.length))return{error:lP};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Ht(i.map(SO)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function SO(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(lr).join("|")}function lhe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,f)=>f),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let f=a.shift(),h=a.pop(),m=o.shift();a=[f,m,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let c=d=>d[0].reduce((p,f)=>p+f);return[...r].reverse().sort((d,p)=>c(d)-c(p)).map(d=>d.filter(p=>p.every(f=>f<=t)).map(p=>{let f=p.map(h=>h+e);return SO(f)}))}function dje({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:dt}}var pje={getRoundRobinGroupMatchUps:JW,determineRoundNumber:dje,drawPositionsHash:SO,groupRounds:lhe};function WP(t){var e;let{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=at,matchUpType:u,roundTarget:c,structureId:d,groupNames:p,drawSize:f,idPrefix:h,isMock:m,uuids:g}=t,v=t.structureName??((e=n==null?void 0:n[0])==null?void 0:e.name)??ca(at),{groupCount:y,groupSize:b}=fje({structureOptions:a,appliedPolicies:o,drawSize:f}),I=sS,T,w=Je(1,y+1).map(U=>{let P=hje({groupSize:b,structureOrder:U,matchUpType:u,drawSize:f,idPrefix:h,isMock:m});T=Array.isArray(P)?Math.max(...P.map(({roundNumber:D})=>D??0)):0;let E=(p==null?void 0:p[U-1])??`${i} ${U}`;return Kf({structureId:g==null?void 0:g.pop(),structureType:aO,finishingPosition:I,structureOrder:U,structureName:E,matchUps:P})}),S=Kf({structureId:d??(g==null?void 0:g.pop()),structureType:oo,finishingPosition:I,seedingProfile:s,structureName:v,stageSequence:r,structures:w,stage:l});return c&&hi({extension:{name:Oc,value:c},element:S}),{structures:[S],maxRoundNumber:T,groupCount:y,links:[],groupSize:b,...ae}}function fje({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=KP({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&a!=null&&a.includes(n)||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function KP({drawSize:t,groupSizeLimit:e=10}){let i=Je(3,e+1).filter(n=>{let r=Math.ceil(t/n),a=r*n-t,o=Math.ceil(t/r),s=Math.ceil(a/r);return(!a||a<n)&&o===n&&o>=3&&s<2});return{...ae,validGroupSizes:i}}function hje({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Je(1+s,i+1+s),u=JW({drawPositions:l}).uniqueMatchUpGroupings??[],c=lhe({groupSize:i,drawPositionOffset:s});return u.map(p).sort((f,h)=>(f.roundNumber??1/0)-(h.roundNumber??1/0));function d(f){return c.reduce((h,m,g)=>m.includes(f)?g+1:h,void 0)}function p(f){let h=SO(f),m=d(h),g=[1,n],v=mje({structureOrder:t,drawPositions:f,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?Vn:Di,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:f,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function mje({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||Li()}function QW(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!At(i))return{seedBlocks:void 0,...ue({result:{error:Se},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=Q0(i);if(e){let f=Math.min(e,r),h=[],m=1;for(Je(0,f).forEach(()=>{h.push([m]),m++});m<r;){let g=Je(m,m+f);m+=f,h.push(g)}return{...ae,seedBlocks:h}}let a=Je(1,r+1),o=[],s=r/2;for(;s>1;){let f=Yr(a,s),h=f.length;f.forEach((m,g)=>{let v,y=g<h/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&h>4?h===8?v=y?T:I:v=b?I:T:v=y?I:T,eo(m,o)||o.push(v)}),s=s/2}let l=a.filter(f=>!o.includes(f));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let u=Je(0,20).map(f=>Math.pow(2,f));u.unshift(1);let c=u.indexOf(r),d=0,p=[];return Je(0,c).forEach(f=>{p.push(o.slice(d,d+u[f])),d+=u[f]}),{...ae,seedBlocks:p}}function e4({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!At(e))return{seedGroups:void 0,...ue({result:{error:Se},context:{drawSize:e},stack:i})};if(t){if(!At(t))return{seedGroups:void 0,...ue({context:{roundRobinGroupsCount:t},result:{error:Se},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Je(0,r).map(()=>{let a=Je(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=QW({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function t4({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=KP({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return ue({context:{roundRobinGroupsCount:t},result:{error:Se}})}let{seedGroups:n}=e4({drawSize:e,roundRobinGroupsCount:t}),r=(n==null?void 0:n.map(a=>Math.min(...a)))||[];return{...ae,seedingThresholds:r}}function xw(t){if(!t)return 1/0;if(At(t))return Tt(t);let e=t.split("-")[0];return At(e)?Tt(e):1/0}function gje({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(lr),e.reverse(),e}function vje({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function yje({positioning:t,size:e}){let i=gje({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,f)=>(t&&[rO,eg].includes(t)&&f%2?o(p):a(p))||a(p),l=(p,f)=>{if(p.every(h=>!r.includes(h))){let h=s(p,f);return r.push(h),h}},u=p=>{let f=p.filter(h=>!r.includes(h));if(f.length)return r.push(...f),f},c=(p,f)=>{let h=s(p,f);if(!r.includes(h))return r.push(h),h},d=Je(1,e+1);for(let p of i)if(p===1){let f=Yr(d,2),h=f.map(l).filter(Boolean);h.length&&n.push(h);let m=f.flatMap(u).filter(Boolean);m.length&&n.push(m)}else{let f=Yr(d,p).map(c).filter(Boolean);f.length&&n.push(f)}return{divisions:i,divisionGroupings:n}}function Ub({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Lh};let{matchUps:u,roundMatchUps:c}=Ci({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=nl({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:p}=Or({structure:o}),f=p==null?void 0:p.length,h=(d==null?void 0:d.length)??0,m=[],g=Object.keys(c).map(k=>parseInt(k)).sort((k,B)=>k-B).map(k=>{let B=c[k].map(x=>x.drawPositions).flat(1/0).filter(Boolean),F=B.filter(x=>!m.includes(x));return m=m.concat(...B),F}).filter(k=>k.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;n=n??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let b=(v==null?void 0:v.length)||0,I=g.filter(k=>k.filter(B=>B<=h).length),{stage:T,structureType:w,roundLimit:S}=o,U=w===oo,P=!U&&(g==null?void 0:g.length),E=!U&&T===vt&&S,D=I.flat(1/0),R=P?D==null?void 0:D.length:0,N=a?f:h,M=LW({drawDefinition:r,structure:o,matchUps:u}),A=M?0:!P&&N||N&&D.length<N&&N-D.length||0;if(E){let k=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:F})=>F===o.roundLimit).length:0,B=v.length/k;if(!P){let F=YP(n),x=Yr(v,B),$=1,j=Je(0,x[0].length).map(()=>{let V=Je($,$+x.length);return $+=x.length,V});({validSeedBlocks:l}=uhe({drawPositionBlocks:x,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:j}))}}else U?{validSeedBlocks:l}=bje({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):P?l=I.map(k=>({seedNumbers:k,drawPositions:k})):M&&Yr(v,2).map((k,B)=>({drawPositions:[k[0]],seedNumbers:[B+1]})).forEach(k=>l.push(k));if(!U&&!M&&!E){let{blocks:k}=Ije({drawPositionOffset:y,seedNumberOffset:R,seedCountGoal:A,seedingProfile:n,baseDrawSize:b});k.forEach(B=>l.push(B))}let _=l.flatMap(k=>k.drawPositions).reduce((k,B)=>(v==null?void 0:v.includes(B))&&k,!0);return!M&&!P&&!U&&!_?{error:ide,validSeedBlocks:[],isContainer:U,isFeedIn:P}:{isLuckyStructure:M,validSeedBlocks:l,isContainer:U,isFeedIn:P}}function bje({seedingProfile:t,structure:e,nonRandom:i}){var n;let r=e.structures||[],a=r.length,o=(n=Hi({structure:e}))==null?void 0:n.positionAssignments,s=YP(t),l=(o==null?void 0:o.length)??0,{seedGroups:u}=e4({roundRobinGroupsCount:a,drawSize:l}),c=r.map(d=>{var p;return(p=Hi({structure:d}).positionAssignments)==null?void 0:p.map(f=>f.drawPosition)});return uhe({drawPositionBlocks:c,positioning:s,seedGroups:u,nonRandom:i})}function uhe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=yje({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let u=vje({blockPattern:a,index:l});s.forEach((c,d)=>{let p=l%2?t.length-d-1:d,f=t[p].slice().filter((m,g)=>u.includes(g+1)&&m);e!==eg?f=n?f:Va(f):l%2&&f.reverse();let h=f.find(m=>!o.includes(m));h&&(o.push(h),r.push({drawPositions:[h],seedNumbers:[c]}))})}),{validSeedBlocks:r}}function Ije(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:u}=QW({cluster:YP(r)===rO,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of u){if(s+1>a)break;let p=d.map(h=>h+e),f=c(s+1,d.length).map(h=>+h+n);s+=d.length,l.push({drawPositions:p,seedNumbers:f})}return{blocks:l};function c(d,p){return Array.from(new Array(p),(f,h)=>h+d)}}function UN({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var o,s,l,u,c,d;let{structure:p}=Pt({drawDefinition:e,structureId:r});t||(t=Ai({drawDefinition:e}).appliedPolicies);let f=i==null?void 0:i.validSeedBlocks;return!f&&p&&(f=(o=Ub({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(c=(u=t==null?void 0:t.seeding)==null?void 0:u.validSeedPositions)!=null&&c.strict?(((d=f.find(h=>h.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(n):[].concat(...f.map(h=>h.drawPositions)).includes(n)}function che(t){var e,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=t,{structure:c}=Pt({drawDefinition:a,structureId:l}),{seedAssignments:d}=nl({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:c}),{positionAssignments:p}=Or({structure:c}),f=(e=p==null?void 0:p.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:e.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:h}=Ai({drawDefinition:a}),m=((s==null?void 0:s.validSeedBlocks)||c&&((i=Ub({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,appliedPolicies:h,drawDefinition:a,seedingProfile:o,structure:c}))==null?void 0:i.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(f!=null&&f.includes(_))).length)[0],g=d==null?void 0:d.map(A=>A.participantId).filter(Boolean),v=p==null?void 0:p.map(A=>A.participantId).filter(Boolean),y=g==null?void 0:g.filter(A=>v==null?void 0:v.includes(A)),b=g==null?void 0:g.filter(A=>!(v!=null&&v.includes(A))),I=d==null?void 0:d.filter(A=>b==null?void 0:b.includes(A.participantId)),T=d==null?void 0:d.filter(A=>!A.participantId),w=(I!=null&&I.length&&I.length>0?I.length:(T==null?void 0:T.length)??0)&&(m==null?void 0:m.drawPositions.filter(A=>!(f!=null&&f.includes(A))))||[],S=u?Va(w):w,U=[],P=S.map(()=>{var A;let _=(A=M(I,U))==null?void 0:A.participantId;return _&&U.push(_),_}).filter(Boolean),E=d==null?void 0:d.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>A.seedNumber),D=((m==null?void 0:m.seedNumbers)||[]).filter(A=>!(E!=null&&E.includes(A))),R=d==null?void 0:d.filter(A=>D.includes(A.seedNumber)).map(A=>A.participantId),N=(n=h==null?void 0:h.seeding)==null?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:N===void 0||N?P:R,unplacedSeedNumbers:D,unfilledPositions:S,unplacedSeedAssignments:I};function M(A,_){let k=A.filter(x=>!_.includes(x.participantId)),B=Math.min(...k.map(x=>xw(x.seedValue))),F=k.filter(x=>xw(x.seedValue)===B);return Va(F).pop()}}function YP(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function gS({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:c}){var d,p,f;let h="assignSeed",{structure:m}=Pt({drawDefinition:i,structureId:o}),{positionAssignments:g}=Or({structure:m}),v=nl({provisionalPositioning:t,drawDefinition:i,structure:m}).seedAssignments,y=v.map(U=>U.seedNumber),b=xv({drawDefinition:i,participantId:r});if(r&&!b)return ue({result:{error:Ic},context:{participantId:r},stack:h});let I=c?(p=(d=Hn({event:c}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,T=I&&I>1,w=(f=g==null?void 0:g.find(U=>U.participantId===r))==null?void 0:f.drawPosition;if(w&&!UN({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ue({result:{error:oq},context:{assignedDrawPosition:w},info:"invalid seed position",stack:h});y.includes(s)||v.push({seedNumber:s,seedValue:l});let S;return v.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!T&&(U.seedValue=l??s),S=!0)}),S?(afe({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:m,eventId:u}),{...ae}):ue({result:{error:tde},stack:h})}function i4({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var s,l,u,c;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((u=a.sides)==null?void 0:u.find(g=>g.sideNumber===d)),{extension:f}=qt({element:r,name:Np}),h=(f==null?void 0:f.value)||{},m=ut(h[i],!1,!0);if(p)(c=a==null?void 0:a.sides)==null||c.forEach(g=>{g.sideNumber===d&&(g.lineUp=m)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=m)}di({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function dhe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=ng({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:m})=>m===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,u=l%2?1:-1,c=l+u,d=o&&s.find(({roundNumber:h,roundPosition:m})=>h===o&&m===c),p=d==null?void 0:d.matchUpStatus,f=[nr,Ir].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:f}}function wje({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(lr).filter(Boolean),positionAdded:i,positionAssigned:n}}function phe({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:ng({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function fhe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=phe({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(c=>c.matchUpId===s),u=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(c=>{let d=mo(c)||!isNaN(c)?{code:c}:c;return d.sideNumber===u?{...d,previousMatchUpStatus:e}:d})}}function MR({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function Lw({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var c,d,p,f;let h="assignMatchUpDrawPosition";s||(s=ya({drawDefinition:r})),t||(t=fr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let m=t.find(_=>_.matchUpId===l),g=m==null?void 0:m.structureId,v=(c=r==null?void 0:r.structures)==null?void 0:c.find(_=>_.structureId===g);if(!v)return{error:Tn};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(_=>_.matchUpId===l),b=(y==null?void 0:y.drawPositions)??[],{positionAdded:I,positionAssigned:T,updatedDrawPositions:w}=wje({drawPosition:o,drawPositions:b}),{positionAssignments:S}=Hi({drawDefinition:r,structure:v}),U=(p=S==null?void 0:S.filter(_=>w.includes(_.drawPosition)))==null?void 0:p.find(({bye:_})=>_),P=(y==null?void 0:y.matchUpStatus)&&[Ni,bi].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=U&&Di||a||P&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[nr,Ir].includes(y.matchUpStatus)&&y.matchUpStatus||Vn,y&&I){t=fr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=P&&MR({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&fhe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:_,matchUpStatus:a}),di({tournamentId:i==null?void 0:i.tournamentId,eventId:m==null?void 0:m.eventId,context:h,drawDefinition:r,matchUp:y})}let E=io({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:R,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:M}}=E,A=ng({structureId:v.structureId,matchUpsMap:s});if(T&&U){if(D)if([Di,nr,Ir].includes(a)){let _=Lw({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=D;_!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(D&&m&&!m.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=dhe({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(_){let k=Lw({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(k.error)return k}}if((y==null?void 0:y.matchUpType)===Xi){let _=t==null?void 0:t.find(({matchUpId:F})=>F===y.matchUpId),k=((_==null?void 0:_.sides)??[]).reduce((F,x,$)=>x.drawPosition===o?$:F,void 0),B=(f=S==null?void 0:S.find(F=>F.drawPosition===o))==null?void 0:f.participantId;B&&k!==void 0&&i4({inContextTargetMatchUp:_,drawPositionSideIndex:k,teamParticipantId:B,tournamentRecord:i,drawDefinition:r,matchUp:y})}if((M==null?void 0:M.linkCondition)===Nd&&w.filter(Boolean).length===2&&!U&&A.filter(({drawPositions:_,roundNumber:k})=>k===1&&eo(_,w)).every(({matchUpStatus:_})=>[Zn,xa].includes(_))&&R){let{structureId:_}=R,k=Ds({drawPosition:N,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:u});if(k.error)return k}return T?{...ae}:ue({result:{error:Iw},context:{drawPosition:o},stack:h})}function hhe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var a,o,s,l;let u=((s=(o=(a=lS({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[r.structureId])==null?void 0:s.map(({structureId:h})=>h))||[];u.push(r==null?void 0:r.structureId);let c=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],d=(t==null?void 0:t.filter(h=>u.includes(h.structureId)&&$n(h.drawPositions??[],c).length))??[],p=d.map(({matchUpId:h})=>h),f=((l=n==null?void 0:n.drawMatchUps)==null?void 0:l.filter(h=>p.includes(h.matchUpId)))??[];return{drawPositions:c,matchUps:f,targetMatchUps:d}}function n4({lineUp:t}){if(!Array.isArray(t))return;let e={};return Ht(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=IN({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Od(t){return`${t} must be an array`}function TO({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Od("lineUp")),{valid:!1,errors:i,error:Se};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:u}=l;return typeof u!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Od("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Ht(t.map(ei)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Se:void 0}}function Db({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:nt};if(typeof e!="string")return{error:wr};let r=TO({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=qt({element:t,name:Np}),o=(a==null?void 0:a.value)||{};return o[e]=n4({lineUp:n}),hi({element:t,extension:{name:Np,value:o}}),DP({drawDefinition:t}),{...ae}}function r4({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:nt};let{drawPositions:l,matchUps:u,targetMatchUps:c}=hhe({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of c)d.matchUpType===Tc&&(d.sides??[]).forEach((p,f)=>{var h;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let m=u.find(({matchUpId:g})=>g===d.matchUpId);if((h=m==null?void 0:m.sides)!=null&&h[f]){if(delete m.sides[f].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Db({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}di({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...ae}}function Dc({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:c,structureId:d,event:p}){var f,h,m;let g="assignDrawPosition";if(!s&&!i)return ue({result:{error:wr},stack:g});c=c??ya({drawDefinition:a}),e||({matchUps:e}=fr({inContext:!0,drawDefinition:a,matchUpsMap:c}));let v=Pt({drawDefinition:a,structureId:d});if(v.error)return ue({result:v,stack:g});let{structure:y}=v;if(!y)return{error:Tn};if(ns({structure:y}))return ue({result:{error:go},stack:g});let{seedAssignments:b}=nl({provisionalPositioning:t,drawDefinition:a,structure:y}),I=(f=b==null?void 0:b.find(D=>D.participantId===s))==null?void 0:f.seedNumber,{appliedPolicies:T}=Ai({tournamentRecord:r,drawDefinition:a,structure:y,event:p});if(I&&!UN({seedNumber:I,appliedPolicies:T,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:d}))return ue({result:{error:oq},context:{drawPosition:u},stack:g});let w=Or({structure:y}).positionAssignments||[],S=w==null?void 0:w.find(D=>D.drawPosition===u);if(!S)return ue({result:{error:q0},context:{drawPosition:u},stack:g});if(w!=null&&w.map(ei).includes(s))return ue({result:{error:Z0},context:{drawPosition:u},stack:g});let{containsParticipant:U,containsBye:P}=E(S);if(P){let D=HP({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:c,event:p});if(D.error)return ue({result:D,stack:g})}if(U&&S.participantId!==s){let{activeDrawPositions:D}=GP({drawDefinition:a,structureId:d});if(D.includes(u))return ue({result:{error:xk},stack:g});r4({assignments:[S],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:y})}if(S.participantId=s,i&&(S.qualifier=!0),((y==null?void 0:y.stageSequence)||0)>1||y.stage&&[ha,An].includes(y.stage)){let D=y.stage===vt?vt:at,R=(((m=(h=a.structures)==null?void 0:h.find(N=>(N==null?void 0:N.stage)===D&&(N==null?void 0:N.stageSequence)===1))==null?void 0:m.seedAssignments)??[]).find(N=>N.participantId===s);if(R!=null&&R.participantId){let{participantId:N,seedNumber:M,seedValue:A}=R;gS({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:M,seedValue:A,structureId:d,event:p})}}if(y.structureType!==oo)Sje({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:c,structure:y,event:p});else{zfe({positionAssignments:w,tournamentRecord:r,drawDefinition:a,matchUpsMap:c,structure:y});let{drawPositions:D,matchUps:R,targetMatchUps:N}=hhe({assignments:[S],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c,structure:y});if(D&&(R==null?void 0:R.length)===1&&R[0].matchUpType===Xi){let M=((N==null?void 0:N[0].sides)??[]).reduce((A,_,k)=>D!=null&&D.includes(_.drawPosition)?k:A,void 0);i4({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:R[0],drawPositionSideIndex:M,tournamentRecord:r,drawDefinition:a})}}return gh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:y,event:p}),{positionAssignments:w,...ae};function E(D){let R=D.bye,N=D.qualifier,M=D.participantId;return{containsBye:R,containsQualifier:N,containsParticipant:M,filled:R||N||M}}}function Sje({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:c}=Ci({provisionalPositioning:t,matchUpFilters:u,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=to({matchUps:c}),{initialRoundNumber:p}=gy({drawPosition:a,matchUps:c}),f=p&&(d==null?void 0:d[p].find(h=>{var m;return(m=h.drawPositions)==null?void 0:m.includes(a)}));if(f){let h=Lw({matchUpId:f.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(h.error)return ue({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...ae}}function a4(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=t,c="positionParticipantAction";if(!a)return{error:nt};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=ya({drawDefinition:a}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=fr({inContext:!0,drawDefinition:a,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:f}=Hi({drawDefinition:a,structureId:l}),h=f==null?void 0:f.find(b=>b.drawPosition===s);if(h!=null&&h.participantId){let b=h.participantId,I=Dc({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:u});return I.success?y({removedParticipantId:b}):ue({result:I,stack:c})}let m=HP({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:u});if(m.error)return ue({result:m,stack:c});let g=m.participantId,v=Dc({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:u});if(!v.success)return ue({result:v,stack:c});return y({removedParticipantId:g});function y({removedParticipantId:b}){let{structure:I}=Pt({drawDefinition:a,structureId:l});PW({drawPositions:[s],structure:I});let T={[e]:o,name:n,drawPosition:s,structureId:l};return dO({drawDefinition:a,positionAction:T}),ue({context:{removedParticipantId:b},result:{...ae},stack:c})}}function Tje({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return a4({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function mhe(t){return Tje(t)}function Uje({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return a4({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function ghe(t){return Uje(t)}function vhe({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],di({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function yhe(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=wi(t,i);if(n.error)return n;let r=Pt(t);if(r.error)return r;let a=r.structure;if(!ns({structure:a}))return ue({result:{error:lb,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=to({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Ld}}function bhe(t){var e;let i=yhe(t,[{targetRoundNumber:!0,roundNumber:!0,[Vh]:jBe}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return ue({result:{error:Se},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?Je(s+1,o+1):Je(o,s),c={};return u.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(l?1:-1)})),(e=r==null?void 0:r[s])==null||e.forEach(({matchUpId:d})=>c[d]=o),vhe({params:t,modMap:c,structure:n}),{...ae}}function Ihe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:nt};if(!Array.isArray(t))return{error:Se};let o="setPositionAssignments";for(let l of t){let{structureId:u,positionAssignments:c}=l;if(!c)continue;let d=Pt({drawDefinition:n,structureId:u});if(d.error)return d;let p=d.structure;if(!p)return{error:Tn};let f=(a=Hi({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),h=c==null?void 0:c.map(({drawPosition:v})=>v);if($n(f,h).length!==(f==null?void 0:f.length))return ue({result:{error:Se},info:"drawPositions do not match",stack:o});let m=ya({drawDefinition:n}),{matchUps:g}=fr({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of c||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let w=Ds({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:u,structure:p,event:r});if(w!=null&&w.error)return w}else if(T)c.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(b){let w=Dc({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:u,event:r});if(w!=null&&w.error)return w}}gh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let s=t.map(({structureId:l})=>l);return Qi({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:s}),{...ae}}function whe(t){let e=yhe(t,[{roundNumbers:!0,[Vh]:Fo,[wu]:o=>o.length===2&&o.every(Mn)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return ue({result:{error:Se,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),vhe({params:t,modMap:a,structure:i}),{...ae}}function Dje({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return a4({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function She(t){return Dje(t)}function Pje({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:nt};if(!n)return{error:Ts};if((i==null?void 0:i.length)!==2)return{error:Se,drawPositions:i};let a=ya({drawDefinition:e}),{matchUps:o}=fr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=Pt({drawDefinition:e,structureId:n});if(!s)return{error:Tn};let l;if(s.structureType===oo?l=Rje({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):l=Eje({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),l.error)return l;if(PW({structure:s,drawPositions:i}),dO({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),gh({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===rl){let u=Ci({matchUpFilters:{matchUpTypes:[Tc]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(f=>i.includes(f))}),c=Ci({matchUpFilters:{matchUpTypes:[Tc]},structure:s}).matchUps;u.forEach(d=>{(d.sides||[]).forEach(p=>{var f;let h=p==null?void 0:p.drawPosition;if(i.includes(h)){let m=p.participantId,g=c.find(({matchUpId:y})=>y===d.matchUpId),v=(f=d==null?void 0:d.sides)==null?void 0:f.reduce((y,b,I)=>b.drawPosition===h?I:y,void 0);i4({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return Qi({drawDefinition:e,structureIds:[n]}),{...ae}}function Eje({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(u=>n==null?void 0:n.includes(u.drawPosition));if(!s)return{error:Se,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:u})=>u).length===2)return{...ae};if(s.filter(({qualifier:u})=>u).length===2)return{...ae};let l=s.some(({qualifier:u})=>u);return s.some(({bye:u})=>u)&&!l?The({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):Cje({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function The({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:h})=>h),l=n.find(({participantId:h})=>h),u=s.drawPosition,{participantId:c,drawPosition:d}=l,{structureId:p}=a,f=t1({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return f.error||(f=t1({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),f.error)||(Ds({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),f=Dc({drawPosition:u,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:c,matchUpsMap:r,event:o}),f.error)?f:{...ae}}function Cje({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,u)=>{let{drawPosition:c}=l,d={...n[1-u],drawPosition:c};return{[c]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),r4({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...ae}}function Rje({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((c,d)=>{let p=d==null?void 0:d.positionAssignments.filter(f=>n==null?void 0:n.includes(f.drawPosition));return p&&c.push(...p),c},[]);if(l.filter(({bye:c})=>c).length===2)return{...ae};if(l.filter(({qualifier:c})=>c).length===2)return{...ae};r4({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:o});let u=l.some(({qualifier:c})=>c);if(l.some(({bye:c})=>c)&&!u)The({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:o});else{let c=ut(l,!1,!0);l.forEach((d,p)=>{let f=c[1-p].participantId;d.qualifier=c[1-p].qualifier,d.participantId=f})}return{...ae}}function Uhe(t){return Pje(t)}function Dhe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:nt};if(!r)return{error:Ts};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:Ic};let{structure:l}=Pt({drawDefinition:i,structureId:r});if(!l)return{error:Tn};if(!(!t||Mn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Mn(p)&&Tt(p)>0)))return{error:Se};let{seedAssignments:u}=nl({drawDefinition:i,structure:l}),c=u==null?void 0:u.map(p=>p.seedNumber),d=u==null?void 0:u.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(f=>parseInt(f)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...c||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return afe({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...ae}}function Phe({drawDefinition:t,structureId:e}){if(!t)return{error:nt};let{structure:i}=Pt({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function UO({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:Oi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:c,stageStructures:d}=_d({withStageGrouping:t,stageSequences:e,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function o4({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:Oe};let s={},l=[];for(let u of e.events||[]){let{structures:c,stageStructures:d}=UO({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:o});if(c&&l.push(...c),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function yh(t){if(!(t!=null&&t.drawDefinition))return!1;let e=bO(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Xi),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Xi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Xi)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function s4(t){var e,i;let{drawDefinition:n,structureId:r}=t;if(!n)return{error:nt};let{playoffStructures:a}=Phe({drawDefinition:n,structureId:r});if(!(a!=null&&a.length))return!1;let o=((i=(e=n==null?void 0:n.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&au.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,u)=>{var c;return!!((c=Hi({structure:u}).positionAssignments??[])!=null&&c.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function qB({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=qB({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=qB({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function Mje({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:vq};if(!Array.isArray(n))return{error:pP};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=Ehe({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function Ehe({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:vq};if(!n)return{error:cb};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:u}=a||{};if(l){let c=l.split(".");r.push(...qB({significantCharacters:u,value:n,accessors:c}))}else if(o){let c=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!c||c.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var f;let h=i.find(m=>m.participantId===p);if((f=h==null?void 0:h.individualParticipantIds)!=null&&f.includes(n.participantId)){let m=h==null?void 0:h.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(c=>{s[c].includes(n.participantId)&&r.push(c)})}),{values:Ht(r)}}function wK({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=Ehe({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function Che({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function Nje(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Che(t);return i.map(a=>{let o=e.filter(u=>a.includes(u)),s=r(o),l=o.filter(u=>!s.includes(u)).filter(u=>{var c;let d=SK(u);return!((c=n[d])!=null&&c.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=SK(s);return!a.includes(l)}}}function Aje(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=Che(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var u;return(u=n[l])==null?void 0:u.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function SK(t){return Number(t%2?t+1:t-1)}function _je({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function kje({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?Aje({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):Nje({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0)),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length).sort((c,d)=>(d.length||0)-(c.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:u}}else{let s=o.map(c=>c.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),l=o.map(c=>c.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length),u=o.map(c=>c.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(c=>c==null?void 0:c.length);return{unassigned:s,unpaired:l,pairedNoConflict:u}}}function Rhe({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function Oje({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let o=Object.assign({},...Object.keys(n).map(c=>[c,n[c].filter(d=>e.includes(d))]).filter(c=>c[1].length).map(([c,d])=>({[c]:d}))),s=Object.keys(o).reduce((c,d)=>o[d].length>c?o[d].length:c,0),l=Object.keys(o).filter(c=>o[c].length===s),u=Rl(i?l:Object.keys(o));return r=t&&(a=o[r])!=null&&a.length?r:u,{participantId:r&&o[r]?Rl(o[r]):Rl(e),groupKey:r}}function xje({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function Lje({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((U,P)=>P.length>U?P.length:U,0)<=2,u=Rhe({positionAssignments:t,participantIds:e}),c=xje({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=Oje({targetParticipantIds:u,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),f=_je({participantId:d,allGroups:o}),h=kje({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:m,unpaired:g,pairedNoConflict:v}=h,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=a&&y?y:b,T=a?b:y,w=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,S;if(w!=null&&w.length){let U=jo(w);S=jo(U)}else{let U=jo(m[0]);S=jo(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function DN({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=JW({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{eo(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;eo(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function Fje({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(u=>!(o!=null&&o.includes(u))).filter(u=>{let c=i.find(m=>m.includes(u)).find(m=>m!==u),d=t.find(m=>m.drawPosition===c),p=DN({isRoundRobin:r,groupedParticipants:[[s,d]]}),f=[t.find(m=>m.drawPosition===u),d],h=DN({isRoundRobin:r,groupedParticipants:[f]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function TK(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,u=[],c,d=Math.min(...(a||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,f=ut(e,!1,!0).filter(b=>!b.qualifier),h=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);Je(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=Lje({...t,candidatePositionAssignments:f,allGroups:l,groupKey:c});c=b,f.forEach(w=>{w.drawPosition===T&&(w.participantId=I)})});let m=wK({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Yr(m,d),v=DN({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=Fje({positionedParticipants:m,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(b.length){let I=Bje({candidatePositionAssignments:f,swapOptions:b});I.error&&console.log({result:I}),m=wK({candidatePositionAssignments:f,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Yr(m,d),v=DN({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return f.forEach(b=>{if(b.bye&&b.participantId){let I=TB;u.push(I)}if(b.qualifier&&b.participantId){let I=TB;u.push(I)}}),{positionAssignments:f,conflicts:v.length,groupedParticipants:g,errors:u}}function Bje({candidatePositionAssignments:t,swapOptions:e}){let i=jo(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=jo(i.possibleDrawPositions),a=t.find(u=>u.drawPosition===n),o=t.find(u=>u.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...ae}}function $je({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:c,drawSize:d,event:p}){var f;if(!c)return{error:pde};let{candidatesCount:h=1,policyAttributes:m,targetDivisions:g}=c,{roundsToSeparate:v}=c,y="randomUnseededSeparation",{structure:b}=Pt({drawDefinition:a,structureId:u}),{matchUps:I}=Ci({provisionalPositioning:t,matchUpsMap:l,structure:b,event:p});if(g&&$u(g)&&!v){let j=yBe(g)||0,V=I.reduce((H,z)=>z.roundNumber>H?z.roundNumber:H,0);v=V<j?1:V-j+1}let{positionAssignments:T}=Or({structure:b}),w=EW({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,S=T==null?void 0:T.filter(j=>!j.participantId),U=T==null?void 0:T.map(j=>j.drawPosition),P=(b==null?void 0:b.structureType)===oo,E=P?{structure:b,matchUps:I,allDrawPositions:U,roundsToSeparate:v}:{matchUps:I,allDrawPositions:U,roundsToSeparate:v},{drawPositionGroups:D,drawPositionChunks:R}=P?Vje(E):jje(E),N={groupParticipants:s.filter(j=>j.participantType===Us).map(j=>j.participantId),teamParticipants:s.filter(j=>j.participantType===qi).map(j=>j.participantId),pairParticipants:s.filter(j=>j.participantType===xt).map(j=>j.participantId)},M=Mje({targetParticipantIds:e,policyAttributes:m,idCollections:N,participants:s});if(M.error)return ue({result:M,stack:y});let A=Object.assign({},...e.map(j=>{let V=Object.keys(M).filter(H=>(M[H]??[]).includes(j));return{[j]:V}})),_=Rhe({participantIds:e,positionAssignments:T});if(_.length>((S==null?void 0:S.length)||0))return{error:Tq};let k,B=_.length,F=Je(0,h).map(()=>TK({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:B,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:R,drawPositionGroups:D,policyAttributes:m,idCollections:N,allGroups:M,drawSize:d}));if(k=F.reduce((j,V)=>!j||(V.conflicts||0)<(j.conflicts||0)?V:j,void 0),!k||k.conflicts){let j=Je(0,h).map(()=>TK({initialPositionAssignments:T,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:B,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:R,drawPositionGroups:D,policyAttributes:m,idCollections:N,allGroups:M,drawSize:d}));k=F.concat(...j).filter(V=>{var H;return!((H=V.errors)!=null&&H.length)}).reduce((V,H)=>!V||(H.conflicts||0)<(V.conflicts||0)?H:V,void 0)}if(!k)return{error:Hk};let x=(((f=Hi({structure:b}))==null?void 0:f.positionAssignments)??[]).filter(j=>j.participantId).map(j=>j.participantId),$=k.positionAssignments.filter(j=>!x.includes(j.participantId));for(let j of $)if(j.bye){let V=Ds({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...j});if(V.error)return ue({result:V,stack:y})}else if(j.participantId){let V=Dc({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...j});if(V.error)return ue({result:V,stack:y,context:{assignment:j}})}return{...ae}}function Vje(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function jje({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(c=>c.roundNumber===1).map(c=>c.drawPositions),r=n.flat().sort(lr),a=Math.max(...r),o=t.filter(c=>c>a),s=r.length,l=Je(s===2?1:2,s).filter(c=>c===Oq(c)),u=l.slice(0,e||l.length).reverse().map(c=>Yr(r,c));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:u}}function Gje({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:c,drawSize:d,event:p}){var f,h;let m="positionUnseededParticipants";c||({structure:c}=Pt({drawDefinition:a,structureId:u})),u||({structureId:u}=c);let{positionAssignments:g}=Or({structure:c}),{seedAssignments:v}=nl({provisionalPositioning:t,drawDefinition:a,structure:c}),y=v==null?void 0:v.map(D=>D.participantId).filter(Boolean),{stage:b,stageSequence:I}=c,T=b===vt?(h=(f=qt({element:c,name:Oc}))==null?void 0:f.extension)==null?void 0:h.value:void 0,w=vb({provisionalPositioning:t,drawDefinition:a,stageSequence:I,entryStatuses:Lg,structureId:u,roundTarget:T,stage:b}),S=w.filter(D=>!(y!=null&&y.includes(D.participantId))).map(D=>D.participantId),U=g==null?void 0:g.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!n&&S.length>((U==null?void 0:U.length)||0))return ue({result:{error:Tq},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:U==null?void 0:U.length},stack:m});let{appliedPolicies:P}=Ai({tournamentRecord:r,drawDefinition:a,event:p}),E=P==null?void 0:P[zU];if(c.stage===An){let D=w.reduce((R,N)=>(R[N.groupingValue]||(R[N.groupingValue]=[]),R[N.groupingValue].push(N.participantId),R),{});Object.keys(D).length&&(E||(E={policyName:"Playoff Avoidance"}),E.policyAttributes||(E.policyAttributes=[]),E.policyAttributes.push({groupings:D}))}return E&&s?$je({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:E,drawSize:d,entries:w}):Hje({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:U,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:d,event:p})}function Hje({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:c,event:d}){let p=c>2?Va(n):n.reverse();for(let f of e){let h=p.pop();if(!r||h){let m=Dc({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:f,drawPosition:h,matchUpsMap:l,structureId:u,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return ue({result:m,stack:"randomUnseededDistribution"})}}return{...ae}}function zje(t){let e=t.structure??Pt(t).structure,i="positionQualifiers",n=[];if(e.stage===ha)return ue({result:{error:Ag},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=qje(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(u=>o[s].includes(u.drawPosition)&&!u.participantId&&!u.qualifier&&!u.bye).map(u=>u.drawPosition);if(r[s]>(l||0))return ue({result:{error:Mde},context:{unfilledDrawPositions:l},stack:i});Je(0,r[s]).forEach(()=>{let u=jo(l);n.push(u),a==null||a.forEach(c=>{c.drawPosition===u&&(c.qualifier=!0,delete c.participantId,delete c.bye)})})}return{...ae,qualifierDrawPositions:n}}function qje({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Pt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Or({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=hS({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>Tt(m)),{matchUps:u}=Ci({structure:e}),{roundProfile:c}=to({matchUps:u}),d=Object.assign({},...l.filter(m=>c==null?void 0:c[m]).map(m=>{var g,v;return{[m]:((v=(g=c==null?void 0:c[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),f=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function UK({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:c,matchUpsMap:d,structure:p,event:f}){let h=[],m=[],g=0;if(p||({structure:p}=Pt({drawDefinition:a,structureId:c})),c||(c=p==null?void 0:p.structureId),n||(n=Ai({drawDefinition:a}).appliedPolicies),!r){let v=p&&Ub({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return u=u??(r==null?void 0:r.length)??0,Je(0,u).forEach(()=>{if(g<(u||0)){let v=Wje({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:c,matchUpsMap:d,event:f});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ae,seedPositions:h}}function Wje({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:c,unfilledPositions:d}=che({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=Ai({drawDefinition:n}),{avoidance:f}=p??{};f&&o&&(c==null?void 0:c.length)>2;let h=[];for(let m of c){let g=d.pop();if(!g)return{error:W0};h.push(g);let v=Dc({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:u});if(!v.success)return v}return{...ae,seedPositions:h}}function Kje({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Or({structure:i}),{seedAssignments:r}=nl({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function Yje({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=WB(Yr(a.drawPositions,2)),s,l=t[n.length];for(;s=NR(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?Va(a):a).flat(1/0);return Jde(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function NR(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return NR(e?r:t[Math.round(Math.random())],e)}return i<n?NR(t[1],e):NR(t[0],e)}function WB(t){let e=Math.floor(t.length/2);return t.length>2?[WB(t.slice(0,e)),WB(t.slice(e))]:t}function Zje({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=Ub({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:u,isLuckyStructure:c,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let f=Kje({provisionalPositioning:t,drawDefinition:n,structure:s})??[],h=Ht([].concat(...e.map(T=>T.drawPositions))),m=f.filter(T=>h.includes(T.drawPosition)),g=(T,w)=>xw(T.seedValue)-xw(w.seedValue),v=p.reduce((T,w)=>{let S=m.filter(U=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(U.drawPosition)}).sort(g);return T.concat(...S)},[]).map(T=>T.drawPosition),y=Yje({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),b=DK({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),I=DK({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:b,blockSeedOrderByePositions:I,isLuckyStructure:c,positionedSeeds:f,isContainer:d,isFeedIn:u}}function DK({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function Xje({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let c=(l=n==null?void 0:n.seeding)==null?void 0:l.seedingProfile,d=o.stage===vt,{positionAssignments:p}=Or({structure:o}),f=p==null?void 0:p.filter(k=>k.participantId).map(k=>k.drawPosition),h={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:g}=Ci({provisionalPositioning:t,matchUpFilters:h,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===oo?m:v,b=Ht([].concat(...y.map(k=>k.drawPositions))),I=Math.min(...b)-1,T=f==null?void 0:f.filter(k=>b.includes(k)),w=k=>{let B=Math.ceil(k.length/2),F=[k.slice(0,B),k.slice(B)],x=F.map(Y=>[].concat(...Y.flat(1/0)).length),$=Math.min(...x.flat(1/0)),j=Math.max(...x.flat(1/0)),V=x.indexOf(j),H=$!==j,z=Va(F),[q,W]=!$||H?[F[V],F[1-V]]:[z[0],z[1]];return{greaterHalf:q,lesserHalf:W}},S=k=>{let{greaterHalf:B,lesserHalf:F}=w(k),{greaterHalf:x,lesserHalf:$}=w(B),j=Va(x.flat(1/0)).pop(),V=x.flat().filter(H=>H!==j);return{newlyFilteredChunks:[...F,...$,V],drawPosition:j}},U=k=>!e.includes(k),P=k=>!(T!=null&&T.includes(k)),E=k=>{let B=Yr(k.sort(lr),Math.ceil(k.length/4)).map($=>$.filter(P)),F=[].concat(...B.flat(1/0)).length,x=[];for(let $=0;$<F;$++){let{newlyFilteredChunks:j,drawPosition:V}=S(B);x.push(V),B=j}return x},{validSeedBlocks:D}=Ub({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),R=D==null?void 0:D.map(k=>{var B;return(B=k.drawPositions)==null?void 0:B.map(F=>F+I)}),N;if(s){let k=b.length,{seedBlocks:B}=QW({cluster:YP(c)===rO,participantsCount:k});N=B.map(F=>F.map(x=>x+I)).map(E).filter(F=>F.length)}else d?N=R==null?void 0:R.map(k=>k.filter(P)):N=R==null?void 0:R.map(E).filter(k=>k.length);let M=y.map(k=>k.drawPositions).map(k=>k==null?void 0:k.sort((B,F)=>B-F)).filter(k=>(k==null?void 0:k[0])+1===(k==null?void 0:k[1])),A=k=>M.reduce((B,F)=>F.includes(k)?F.reduce((x,$)=>$!==k?$:x,void 0):B,void 0),_=N.map(k=>k.map(A)).flat(1/0).filter(P).filter(U).filter(Boolean);if(d&&!o.structures){let k=a%4,B=_.slice(0,k),F=(u=g[o.roundLimit])==null?void 0:u.length,x=Yr(_.slice(k),F).map(Va).flat();_=B.concat(x)}return{unseededByePositions:_}}function Jje({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=Ci({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:n,event:r}),u=(l==null?void 0:l[1])||[],c=(n==null?void 0:n.structureType)===oo,d=c?s:u,p=c?((a=n==null?void 0:n.structures)==null?void 0:a.length)||0:s.length,{structureId:f,stage:h,stageSequence:m}=n,g=vb({entryStatuses:au,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:f,stage:h}),{qualifiersCount:v}=hS({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:f,stage:h}),y=g.length+v,{positionAssignments:b,unassignedPositions:I}=Or({structure:n}),T=I==null?void 0:I.map(D=>D.drawPosition),w=b==null?void 0:b.filter(D=>D.bye).length,S=b==null?void 0:b.filter(D=>D.bye).map(D=>D.drawPosition),U=d.map(D=>D.drawPositions).filter(D=>D==null?void 0:D.reduce((R,N)=>!(S!=null&&S.includes(N))&&R,!0)).flat(1/0).filter(D=>T==null?void 0:T.includes(D)),P=b==null?void 0:b.length,E=P?P-y:0;return E>p&&n.stageSequence===1&&n.stage!==ha&&(E=p),{placedByes:w,byesCount:E,relevantMatchUps:d,placedByePositions:S,roundMatchUps:l,positionsToAvoidDoubleBye:U}}function PK({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:c,event:d}){var p;l||({structure:l}=Pt({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let f=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===vt),{byesCount:h,placedByes:m,relevantMatchUps:g}=Jje({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),v=h-(m||0);if(v<=0)return{...ae};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:I,isFeedIn:T}=Zje({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[oo,aO].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),S=f&&b!=null&&b.length?b:y,{unseededByePositions:U}=Xje({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:T}),P=N=>N%2,E=(N,M)=>(N||[]).every(A=>P(A)?M!==A+1:M!==A-1),D=[].concat(...S);if(!c)for(;U.length;){let N=U.find(M=>E(D,M));N?(D.push(N),U=U.filter(M=>M!==N)):(D.push(...U),U=[])}w&&(D=Va(D),il({ignoreSeededByes:w})&&console.log({byePositions:D}));let R=D.slice(0,v);for(let N of R){let M=Ds({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(M!=null&&M.error)return M}return{...ae,unseededByePositions:U,byeDrawPositions:R}}function ZP(t){var e,i,n,r;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:c,placementGroup:d,seedingProfile:p,structureId:f,seedLimit:h,seedsOnly:m,drawType:g,drawSize:v,event:y}=t,b=[];o||(ope(),a=ut(a,!1,!0));let I=F=>(o||TR(),ue({result:F,stack:"automatedPositioning"})),T=F=>(o||TR(),F),w=Pt({drawDefinition:a,structureId:f});if(w.error)return I(w);let S=w.structure;if(!S)return{error:Tn};let U=t.appliedPolicies||((e=Ai({drawDefinition:a,structure:S,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:P}=hS({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,drawDefinition:a,structureId:f}),E=Lg;if(!((i=vb({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,placementGroup:d,drawDefinition:a,entryStatuses:E,structureId:f}))!=null&&i.length)&&!P)return T({...ae});let D=t.matchUpsMap??ya({drawDefinition:a}),R=t.inContextDrawMatchUps??((n=fr({inContext:!0,drawDefinition:a,matchUpsMap:D}))==null?void 0:n.matchUps),N=[],M=Ub({provisionalPositioning:s,appliedPolicies:U,drawDefinition:a,seedingProfile:p,structure:S});if(M.error)return M;let{validSeedBlocks:A}=M;b.push({validSeedBlocks:A});let _=t.participants||(c?(r=jn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:c}))==null?void 0:r.participants:[]);if(YP(S.seedingProfile||p)===eg){let F=u?PK({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:U,drawDefinition:a,seedBlockInfo:M,matchUpsMap:D,structure:S,seedLimit:h,seedsOnly:m,event:y}):void 0;if(F!=null&&F.error)return I(F);N=F.unseededByePositions,b.push({action:"positionByes",unseededByePositions:N});let x=S.seedingProfile?{positioning:S.seedingProfile}:p;if(F=UK({seedingProfile:x,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:D,structure:S,event:y}),F.error)return I(F);b.push({seedPositions:F.seedPositions,action:"positionSeedBlocks"})}else{if(g!==kg){let x=S.seedingProfile?{positioning:S.seedingProfile}:p,$=UK({seedingProfile:x,provisionalPositioning:s,inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:D,structure:S,event:y});if($.error)return I($);b.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let F=u?PK({provisionalPositioning:s,tournamentRecord:c,appliedPolicies:U,drawDefinition:a,seedBlockInfo:M,matchUpsMap:D,structure:S,seedLimit:h,seedsOnly:m,event:y}):void 0;if(F!=null&&F.error)return I(F);N=F==null?void 0:F.unseededByePositions,b.push({action:"positionByes",byeDrawPositions:F==null?void 0:F.byeDrawPositions,unseededByePositions:N})}let k={};if(!m){let F=zje({inContextDrawMatchUps:R,tournamentRecord:c,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:D,structure:S});if(F.error||(F.conflicts&&(k.qualifierConflicts=F.conflicts),b.push({action:"positionQualifiers",qualifierDrawPositions:F.qualifierDrawPositions}),F=Gje({provisionalPositioning:s,inContextDrawMatchUps:R,unseededByePositions:N,multipleStructures:l,tournamentRecord:c,drawDefinition:a,seedBlockInfo:M,participants:_,matchUpsMap:D,structureId:f,structure:S,drawSize:v,event:y}),F.error))return I(F);F.conflicts&&(k.unseededConflicts=F.conflicts),b.push({action:"positionUnseededParticipants"})}let{positionAssignments:B}=Hi({drawDefinition:a,structure:S});return Qi({drawDefinition:a,structureIds:[f]}),o||TR(),{positionAssignments:B,conflicts:k,...ae,positioningReport:b}}function XP(t){var e;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u,event:c}=t;if(!c)return{error:es};if(!a)return{error:Qo};if(!yh({drawDefinition:a,structureId:s})&&!n)return{error:aq};let d=(e=Phe({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((h,m)=>vN(h)-vN(m)),p=[],f=[];if(d)for(let h of d){let{structureId:m}=h,g=ZP({structureId:m,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&f.push(g.positioningReport)}return{...ae,structurePositionAssignments:p,positioningReports:f}}function Mhe({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>At(i)))&&ue({result:{error:Se},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>Uw(i.structureOrder)-Uw(n.structureOrder)),{...ae}):{error:nt}}function DO({drawDefinition:t}){var e,i,n,r,a,o,s;let l=t.structures??[],u=t.links??[],c=new Map,d=S=>{let U=c.get(S)||c.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&c.get(S);if(U&&!(U!=null&&U.stage)){let P=l.find(E=>E.structureId===S);U.stage=P==null?void 0:P.stage}return U},p={},f={},h=u.map(S=>{let U=S.source.structureId,P=S.target.structureId,E=d(U),D=d(P);return[tg,Ml,oO,eg].includes(S.target.feedProfile)?(E==null||E.targets.push(P),D==null||D.sources.push(U)):S.target.feedProfile===Su&&(D==null||D.drawSources.push(U),E==null||E.drawTargets.push(P)),f[P]=f[P]||S.target.feedProfile===Su,p[P]=Ht([...p[P]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of c.keys()){let U=c.get(S);if(U){let P=U.targets??[];for(;P.length;){let E=P.pop(),D=E&&c[E];(e=D==null?void 0:D.targets)!=null&&e.length?P.push(...D.targets):D&&(U.rootStage=D.stage)}if(U.rootStage||(U.rootStage=U.stage),!((i=U.targets)!=null&&i.length)){let E=U.sources??[];for(;E.length;){let D=E.pop(),R=D&&c[D];if((n=R==null?void 0:R.sources)!=null&&n.length){for(let N of R.sources)(r=U.progeny)!=null&&r.includes(N)||(a=U.progeny)==null||a.push(N);E.push(...R.sources)}}}}}let m=0;for(let S of c.keys()){let U=c.get(S);if(U&&U.rootStage===vt){let P=[(o=U.drawTargets)==null?void 0:o[0]],E=0;for(;P.length;){E+=1;let D=P.pop(),R=D?c.get(D):void 0;(s=R==null?void 0:R.drawTargets)!=null&&s.length&&P.push(R.drawTargets[0])}U.distanceFromMain=E,E>m&&(m=E)}}let g=h.length;Je(0,Math.ceil(g/2)).forEach(()=>{h=Je(0,g).map(S=>{let U=h[S],P=h.reduce((E,D)=>eo(U,D)?E.concat(...D):E,[])||[];return Ht(U.concat(...P))})});let v=h[0],y=(S,U)=>$n(S,U).length===S.length,b=h.slice(1).reduce((S,U)=>S&&y(U,v),!0),I=[v].filter(Boolean),T=[v].filter(Boolean);l.forEach(S=>{let{structureId:U,stage:P}=S;I.find(E=>E.includes(U))||(I.push([U]),P!==jr&&T.push([U]))});let w=b&&T.length===1;return!(u!=null&&u.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(c),allStructuresLinked:w,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:f,structureGroups:I}}function Nhe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=DO({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ae}}function zh(t){var e;let{duplicateValues:i=!0,creationTime:n=!0,removePriorValues:r,timeItem:a,element:o}=t;if(!a)return{error:Eq};if(!o)return{error:dt,info:Jq};let s=a&&Object.keys(a),l=["itemType","itemValue"];if(l.filter(u=>s.includes(u)).length!==l.length)return{error:Pq};if(!o.timeItems)o.timeItems=[];else{let{itemType:u,itemSubTypes:c,itemValue:d}=a,p=u&&((e=Lc({itemSubTypes:c,itemType:u,element:o}))==null?void 0:e.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!i)return{...ae}}if(a.itemSubTypes&&!a.itemSubTypes.length&&delete a.itemSubTypes,n){let u=new Date().toISOString();Object.assign(a,{createdAt:u})}return r&&(o.timeItems=o.timeItems.filter(({itemType:u})=>a.itemType!==u)),r&&!a.itemValue||o.timeItems.push(a),{...ae}}function l4({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:Oe};if(!r)return{error:wr};let o=jg({tournamentRecord:i,participantId:r});return o.error?o:zh({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function Pb(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;return i?zh({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a}):{error:Oe}}function Eb(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?zh({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:es}}function u4({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:Oe};if(!e)return{error:nt};let r=Qje({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return Pb({tournamentRecord:t,timeItem:a}),r}function Qje({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var a;if(!t)return{error:nt};if(!i)return{error:Lh};if(!r)return{error:cq};let o=r.target.structureId,s=Pt({drawDefinition:t,structureId:o});if(s.error)return ue({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:s});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),Nhe({drawDefinition:t});let l=((a=Ci({structure:i}))==null?void 0:a.matchUps)||[];return mh({drawDefinition:t,tournamentId:e,matchUps:l,eventId:n}),Qi({drawDefinition:t,structureIds:[i.structureId]}),{...ae}}function Ahe({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Se};if(!t)return{error:nt};let i=Object.assign({},...e.map(n=>{if(!ln(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:dt};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...ae}}function c4({drawDefinition:t,timeItem:e}){if(!t)return{error:Qo};if(!e)return{error:Eq};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:Pq};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),DP({drawDefinition:t}),{...ae}}function _he(t){var e;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=t,o=wi(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=n.structures??[],l=s.find(y=>y.structureId===r);if(!l)return{error:Tn};let u=s.find(({stage:y,stageSequence:b})=>y===at&&b===1),c=r===(u==null?void 0:u.structureId),d=s.filter(({stage:y})=>y===vt).map(is("structureId"));if(c&&!d.length)return{error:zce};let p=d.includes(r),f=eGe({isQualifyingStructure:p,structure:l,...t});if(f!=null&&f.error)return f;let{structureIdsToRemove:h,relatedStructureIdsMap:m}=iGe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:n,structureId:r}),{removedMatchUpIds:g,removedStructureIds:v}=nGe({relatedStructureIdsMap:m,qualifyingStructureIds:d,isMainStageSequence1:c,mainStageSequence1:u,drawDefinition:n,structureIdsToRemove:h,structureId:r});if(tGe({removedMatchUpIds:g,drawDefinition:n}),c){let y=(e=u.matchUps??[])==null?void 0:e.map(is("matchUpId"));g.push(...y),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&Nhe({drawDefinition:n}),of({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:n}),Qi({drawDefinition:n,eventId:a==null?void 0:a.eventId}),{...ae,removedMatchUpIds:g,removedStructureIds:v}}function eGe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var s,l,u,c,d,p;let f=[n];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(s=h(n))==null?void 0:s.source.structureId;for(;m;)f.push(m),m=(l=h(m))==null?void 0:l.source.structureId}if((u=fr({matchUpFilters:{structureIds:f},drawDefinition:i}).matchUps)!=null&&u.some(({score:h})=>Jr({score:h}))){let h=(c=Ai({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:c.appliedPolicies;if(!(o??((p=(d=h==null?void 0:h[Rd])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:Kk}}return{...ae}}function tGe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=fr({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function iGe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(is("structureId")),s=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===c&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=c=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===c&&p.source.structureId).filter(Boolean))??[]},u=new Map;return o.forEach(c=>u.set(c,e?l(c):s(c))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}function nGe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let u=a.pop();l.push(...oGe({idBeingRemoved:u,drawDefinition:r}));let c=aGe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:o});s.push(...c.removedStructureIds);let d=rGe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:u,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function rGe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function aGe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=((a=n.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function oGe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=Pt({structureId:t,drawDefinition:e}),n=Ci({structure:i}).matchUps;return nW(n)}function PN({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:nt};if(!RW({drawDefinition:e,stage:n}))return{error:Ag};let r=$$e({drawDefinition:e,stage:n}),{qualifiersCount:a}=hS({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:uq};let{entryProfile:s}=CW({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Qi({drawDefinition:e}),{...ae,entryProfile:s}}function khe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?RW({drawDefinition:e,stage:i})?i!==at?{error:uq,info:"qualifiersCount can only be set for main stage"}:(CW({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Qi({drawDefinition:e}),{...ae}):{error:Ag}:{error:nt}}function sGe({drawDefinition:t,drawSize:e}){if(!t)return{error:nt};let i=PN({stage:jr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Qi({drawDefinition:t}),{...ae})}function Ohe(t){return sGe(t)}function xhe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!t)return{error:Oe};if(!e)return{error:nt};let o=(e.structures??[]).find(s=>s.structureId===n);return o?!o.stage||![at,vt].includes(o.stage)||o.stage===at&&o.stageSequence!==1?ue({result:{error:lb},stack:a}):(r=o.seedAssignments)!=null&&r.find(s=>s.participantId===i)?{...ae}:ue({info:"participant not seeded",result:{error:Pa},context:{participantId:i}}):ue({result:{error:Tn},stack:a})}function JP({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=kp}){return!n||!r?{error:Ts}:{link:ft({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Su,roundNumber:t,structureId:r}})}}function d4({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||Li()}function EN({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,u=[],c=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let f=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(f.roundNumber=d),h&&d&&(h.roundNumber=d);let m=d4({roundPosition:c,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:c,children:[f,h],matchUpId:m};u.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Vn,matchUpId:g.matchUpId,roundPosition:c,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),c++,l+=2}return{roundNodes:u,matchUps:n}}function Pc({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!$u(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let c=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!$u(s)&&!c)return{matchUps:[],roundsCount:0};let d=Je(1,s+1).map(g=>({drawPosition:g})),p,f=[],h=1;for({roundNodes:p,matchUps:f}=EN({matchUpType:r,roundNumber:h,idPrefix:o,matchUps:f,isMock:l,nodes:d,uuids:u}),h++,a=a??i;p.length>1;)n&&p.length===n&&(a=h-1),{roundNodes:p,matchUps:f}=EN({nodes:p,matchUpType:r,roundNumber:h,idPrefix:o,matchUps:f,isMock:l,uuids:u}),h++;let m=h-1;return f=PP({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:f}),a?f=f.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:f,roundsCount:m,roundLimit:a}}function p4(t){var e,i,n,r,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return ue({result:{error:nt},stack:s});if(t.drawSize&&!At(t.drawSize)||t.participantsCount&&!At(t.participantsCount)||t.qualifyingPositions&&!At(t.qualifyingPositions))return ue({result:{error:Se},stack:s});let l=t.drawSize??kq(t.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:c,targetStructureId:d,structureOptions:p,appliedPolicies:f,drawDefinition:h,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:b,idPrefix:I,isMock:T,uuids:w}=t;if(!t.drawSize)return ue({result:{error:uP},context:{drawSize:l},stack:s});if(c&&c>=t.drawSize)return ue({result:{error:Se},context:{drawSize:l,qualifyingPositions:c},stack:s});let S,U,P,E,D=0,R,N=1,{structureProfiles:M}=DO({drawDefinition:h}),A=M[d];if(!A)return ue({result:{error:Tn},context:{targetStructureId:d},stack:s});let _=h.matchUpType,k=y?`${y}-`:"",B=A.stage===vt,F=((i=(e=f==null?void 0:f[Pw])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=wVe[Pw])==null?void 0:n.namingConventions)==null?void 0:r.pre),x=B&&F?`${F}-`:"",$=g??(k?`${x}${ca(vt)} ${k}`:`${x}${ca(vt)}`);if(b===Wl){let{maxRoundNumber:H,structures:z,groupCount:q}=WP({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),stage:vt,structureOptions:p,appliedPolicies:f,stageSequence:N,matchUpType:_,roundTarget:y,idPrefix:I,drawSize:l,isMock:T,uuids:w});D=q,S=H,P=z[0],R=[1]}else({drawSize:l,matchUps:E,roundLimit:S,roundsCount:U}=Pc({qualifyingRoundNumber:u,qualifyingPositions:c,matchUpType:_,idPrefix:I,drawSize:l,isMock:T,uuids:w})),S||(S=U),P=$s({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:S,stage:vt,matchUpFormat:m,stageSequence:N,matchUpType:_,roundLimit:S,matchUps:E}),y&&hi({extension:{name:Oc,value:y},element:P}),D=(a=E==null?void 0:E.filter(H=>H.roundNumber===S))==null?void 0:a.length;let j=b===Wl?_p:kp,V=P&&S&&((o=JP({sourceStructureId:P.structureId,sourceRoundNumber:S,targetStructureId:d,finishingPositions:R,linkType:j}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:D,...ae,structure:P,link:V}}function Lhe(t){let e=t.tournamentRecord;if(!e)return{error:Oe};let i=lGe(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:u,drawType:c}=t,d={itemType:"addQualifyingStructures",itemValue:ft({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:u,drawType:c})};return Pb({tournamentRecord:e,timeItem:d}),i}function lGe(t){if(!t.drawDefinition)return{error:nt};if(!t.targetStructureId)return{error:Ts};let e=p4(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Se}:u4({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function uGe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let c=l.length,d=e?e-c:void 0,p=Je(0,c).map(m=>d?d+m:void 0),f=[];for(let m=0;m<c;m++){let g=p.shift(),v={drawPosition:g,fed:u+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=d4({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Vn,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),o&&(I.isMock=!0),a.push(I);let T={children:[y,v]};f.push(T)}let h=e?e-c:void 0;return{roundNodes:f,matchUps:a,drawPosition:h}}function bh(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:c,matchUpType:d,idPrefix:p,isMock:f,uuids:h,fmlc:m}=t;a=a??M(e);let g=cGe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,k)=>_+k,0),n=i.length}else r>=v?n=0:u&&(n=v-u,r=0),i=g.filter((A,_)=>u&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-T;let w=0,S=[],U,P=1,E=Je(0,a).map((A,_)=>({drawPosition:_+1+y})),D=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=EN({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:f,nodes:E,uuids:h}),P++,i.includes(A)){let _=ts(i)[A],k=Je(0,_),B=I+1-P,F=(o==null?void 0:o.includes(B))??(l==null?void 0:l.includes(P));k.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:D}=uGe({drawPosition:!F&&D||void 0,nodes:U,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:S,isMock:f,uuids:h,fed:w})),P++,w+=1})}E=U}I!==P-1&&console.log("ERROR");let R=a-y;S=PP({finishingPositionOffset:c?R:s,positionsFed:y,roundsCount:I,matchUps:S,fmlc:m});let N=U!=null&&U.length?U[0]:U;return N&&(N.roundNumber=P-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:I};function M(A){let _=Oq(A);return _>A?_/2:_}}function cGe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Je(0,e).reverse().map(i=>Math.pow(2,i))}function _I(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:c,roundOffset:d=0,drawDefinition:p,staggeredEntry:f,sequenceLimit:h,stage:m=at,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!o||!u||o!=null&&o[l])||g<2||h&&s>h)return{};let I=[],T=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,P=e+g,E=`${U}-${P}`,D=o==null?void 0:o[l],R=n&&`${n} `||"",N=(o==null?void 0:o[E])??(r==null?void 0:r[E]),M=t.structureName||(N==null?void 0:N.name)||(D==null?void 0:D.name)&&(i?`${R}${D==null?void 0:D.name}`:D.name)||`${R}${E}`,A=(N==null?void 0:N.abbreviation)??(D==null?void 0:D.abbreviation),_=t.structureId??(D==null?void 0:D.structureId)??(b==null?void 0:b.pop()),k={idPrefix:v&&`${v}-${M}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:b},{matchUps:B}=f?bh(k):Pc(k),F=$s({structureAbbreviation:A,stageSequence:s,structureName:M,matchUpType:S,roundOffset:d,structureId:_,matchUps:B,stage:m});I.push(...B),T.push(F);let x=Math.ceil(Math.log(g)/Math.log(2)),$=c?Math.min(c-d,x):!a||U<a?x:0;return g>2&&Je(1,$+1).forEach(V=>j(V)),{structureId:F.structureId,matchUps:I,structureName:M,structures:T,links:w,...ae};function j(V){let H=g/Math.pow(2,V);if(H<2)return;let z=g/Math.pow(2,V)+e;if(a&&z+1>a)return;let{structures:q,structureId:W,matchUps:Y,links:Z}=_I({finishingPositionOffset:z,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:s+1,drawSize:H,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:c,drawDefinition:p,sequenceLimit:h,matchUpType:S,idPrefix:v,uuids:b,stage:m});if(F.structureId&&W){let X={linkType:Md,source:{roundNumber:V,structureId:F.structureId},target:{roundNumber:1,feedProfile:Ml,structureId:W}};Z&&F&&Z.push(X),Z!=null&&Z.length&&w.push(...Z)}return q!=null&&q.length&&T.push(...q),Y!=null&&Y.length&&I.push(...Y),{structureId:W,childLinks:Z,structures:T}}}function f4({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=Pt({drawDefinition:t,structureId:i});if(n.error)return ue({result:n});let{matchUps:r}=Ci({structure:n.structure,matchUpsMap:e});return{...to({matchUps:r}),matchUps:r,matchUpsMap:e}}function EK({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=f4({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(Fhe(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{dGe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function dGe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Je(i,(n||i)+1).includes(t)}function Fhe(t){var e,i;return[Ht(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Ht(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function pGe(t){return Fhe(t).map(e=>Je(e[0],e[1]&&e[1]+1||e[0]+1))}function vS({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Se,context:{structureIds:e}};if(!t)return{error:nt};e=e??(t.structures??[]).filter(a=>a.stage!==vt).map(({structureId:a})=>a);let n=e.map(a=>{var o;let{roundProfile:s}=f4({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(pGe).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(lr).flat();return{positionsNotPlayedOff:Ht(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function Bhe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:nt};if(!n)return{error:Ts};if(!e)return{error:dt,info:"missing playoffPositions"};let r=vS({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=EK({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Tt(v)).filter(v=>!t.includes(v)),u=EK({finishingPositions:a,drawDefinition:i,structureId:n}),c=u?Object.values(u):[],d=u?c.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Tt(v)):[],p=l.filter(v=>!d.includes(v)).sort(lr),{roundProfile:f}=f4({drawDefinition:i,structureId:n}),h=p.map(v=>{let y=f==null?void 0:f[v].finishingPositionRange.loser,[b,I]=y??[0,0];return Je(b,(I||b)+1)}).flat().sort(lr),{playoffRoundsRanges:m}=fGe({playoffSourceRounds:p,roundProfile:f}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:f}}function fGe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Je(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function QP({drawDefinition:t,structureId:e}){if(!t)return{error:nt};let{matchUps:i,matchUpsMap:n}=po({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=vS({drawDefinition:t,matchUpsMap:n}),{structures:o}=_d({drawDefinition:t}),s=o.filter(u=>!e&&u.stage!==jr||u.structureId===e),l={};for(let u of s){let c=u==null?void 0:u.structureId,d=hGe({playoffPositions:r,drawDefinition:t,structure:u,matchUps:i}),{error:p,...f}=d;if(p)return d;l[c]={structureId:c,...f}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function hGe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o,s,l,u,c,d,p;let f=i==null?void 0:i.structureId,{links:h}=pS({drawDefinition:e,structureId:f});if(i.structureType===oo||i.structures){let w=(a=(r=Hi({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:a.length,S=i.structures.length,U=(w??0)/S,P=((o=h.source)==null?void 0:o.flatMap(({source:F})=>(F==null?void 0:F.finishingPositions)||[]))||[],E=Je(1,U+1).filter(F=>!P.includes(F)),D=((l=(s=n.find(F=>F.containerStructureId===f&&F.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],R=h==null?void 0:h.source.map(({target:F})=>F.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:M=[]}=vS({structureIds:R,drawDefinition:e}),A=[...N,...M],_=Je(D[0],D[1]+1).filter(F=>!A.includes(F)),k=Yr(_,_.length/E.length),B=E.map((F,x)=>{let $=k[x],j=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:F,finishingPositions:$,finishingPositionRange:j}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:B,finishingPositionsAvailable:E,finishingPositionsPlayedOff:P,positionsPlayedOff:N,groupCount:S,groupSize:U}}let m=((u=h==null?void 0:h.source)==null?void 0:u.filter(w=>w.linkCondition!==Nd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],g=((c=h==null?void 0:h.source)==null?void 0:c.filter(w=>w.linkCondition===Nd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],v=Bhe({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:f}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,b=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:I,error:T}=v;for(let w of g){let S=h==null?void 0:h.source.find(R=>R.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,P=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:R,structureId:N})=>N===P&&R===U),D=E.filter(({sides:R})=>R.find(N=>N.participantFed&&!N.participantId)).length;if(y&&D===E.length){y.push(w);let R=(p=(d=I==null?void 0:I[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(R){let N=Math.min(...R),M=N+D,A=Je(N,M),_={finishingPositionRange:[N,M-1].join("-"),finishingPositions:A,roundNumber:w};b.push(_)}}}return y&&y.sort(lr),b.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:y,playoffRoundsRanges:b,error:T}}function mGe({playoffGroups:t,drawDefinition:e,structureId:i}){var n,r;if(!e)return{error:nt};if(typeof i!="string"||!Array.isArray(t))return{error:Se};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(r=(n=QP({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>a.includes(o.finishingPosition)))==null?void 0:r.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function $he(t){var e,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=at,matchUpType:u,structureId:c,idPrefix:d,drawSize:p,isMock:f,uuids:h}=t,m={finishingPositionOffset:n,matchUpType:u,drawSize:p,idPrefix:d,isMock:f,uuids:h},{matchUps:g}=o?bh(m):Pc(m),v=$s({structureName:s||((e=r==null?void 0:r[0])==null?void 0:e.name)||ca(at),structureId:c||(h==null?void 0:h.pop()),stageSequence:a,matchUpType:u,matchUps:g,stage:l}),y=[v],b=[];if(p>2){let I=p/2,{matchUps:T}=Pc({finishingPositionOffset:n+I,idPrefix:d&&`${d}-c`,drawSize:I,matchUpType:u,isMock:f}),w=ca(ha),S=((i=r==null?void 0:r["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),U=$s({structureName:S,matchUps:T,structureId:h==null?void 0:h.pop(),stage:ha,stageSequence:1,matchUpType:u});y.push(U);let P={linkType:Md,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:Ml,structureId:U.structureId}};b.push(P)}return{...ae,structures:y,links:b}}function Vhe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Je(1+e,n+1+e).map(u=>{let c=l&&l[u-1]?l[u-1]:u%2?Ml:tg,d=u-e<=2?u-e:(u-e-2)*2+2,p={linkType:Md,source:{roundNumber:u,structureId:i.structureId},target:{feedProfile:c,roundNumber:d,structureId:t.structureId}},f=s[u-1];return f&&(p.target.groupedOrder=f),il()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),u===2&&a&&(p.linkCondition=Nd,p.target.feedProfile=Ml),o.includes(d)?p:void 0}).filter(Boolean)}function jhe(t){var e,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=at,matchUpType:c,structureId:d,drawSize:p,idPrefix:f,isMock:h,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:c,drawSize:p,idPrefix:f,isMock:h,uuids:m},{matchUps:v,roundsCount:y}=l?bh(g):Pc(g),b=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??ca(at),I=Kf({structureId:d||(m==null?void 0:m.pop()),structureName:b,stageSequence:a,matchUpType:c,matchUps:v,stage:u}),T=[I],w=[];if(p>2){let S=[0,2].slice(0,p/16).map((U,P)=>{let E=P+1,{consolationStructure:D}=gGe({idPrefix:f&&`${f}-c${P}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:n,playoffAttributes:o,structureNameMap:s,stageSequence:E,roundOffset:U,matchUpType:c,drawSize:p,isMock:h,index:P,uuids:m});T.push(D);let R=Vhe({consolationStructure:D,roundsCount:2,mainStructure:I,roundOffset:U});return{consolationStructure:D,links:R}}).map(U=>U.links).flat();if(w.push(...S),p>=4&&p<=16||p>32){let{matchUps:U}=Pc({idPrefix:f&&`${f}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:h}),P=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??ca(An),E=(s==null?void 0:s[P])||P,D=n?`${n} ${E}`:E,R=Kf({structureId:m==null?void 0:m.pop(),matchUps:U,stageSequence:2,stage:An,structureName:D,matchUpType:c}),N={linkType:Md,source:{roundNumber:y-1,structureId:I.structureId},target:{structureId:R.structureId,feedProfile:Ml,roundNumber:1}};T.push(R),w.push(N)}}return{structures:T,links:w,...ae}}function gGe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:c,uuids:d}){var p,f;let h=l/(2*Math.pow(2,r)),{matchUps:m,roundsCount:g}=bh({finishingPositionOffset:h,baseDrawSize:h,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),v=c===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||c===1&&((f=i==null?void 0:i["0-3"])==null?void 0:f.name)||`${ca(ha)} ${c+1}`,y=(n==null?void 0:n[v])||v,b=t?`${t} ${y}`:y;return{consolationStructure:Kf({matchUps:m,stage:ha,structureName:b,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function lv(t){var e,i,n,r;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:c,stage:d=at,structureId:p,matchUpType:f,skipRounds:h,feedRounds:m,idPrefix:g,drawSize:v,isMock:y,uuids:b,fmlc:I}=t,T=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[Ew])||((i=t.appliedPolicies)==null?void 0:i[Ew]),w={finishingPositionOffset:a,matchUpType:f,skipRounds:h,drawSize:v,idPrefix:g,isMock:y,uuids:b},{matchUps:S}=u?bh(w):Pc(w),U=$s({structureName:c||((n=s==null?void 0:s[0])==null?void 0:n.name)||ca(at),structureId:p||(b==null?void 0:b.pop()),stageSequence:o,matchUpType:f,matchUps:S,stage:d}),P=[U],E=[],D=v/2,{matchUps:R,roundsCount:N}=bh({finishingPositionOffset:D,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:D,matchUpType:f,feedRounds:m,skipRounds:h,isMock:y,uuids:b,fmlc:I});if(v>2){let M=((r=s==null?void 0:s["0-1"])==null?void 0:r.name)??ca(ha),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${M}`:M,_=$s({matchUps:R,structureId:b==null?void 0:b.pop(),stage:ha,stageSequence:1,structureName:A,matchUpType:f});P.push(_);let k=Vhe({consolationStructure:_,mainStructure:U,roundsCount:N,feedPolicy:T,fmlc:I});E.push(...k)}return{...ae,structures:P,links:E}}function Ghe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:c,idPrefix:d,isMock:p,uuids:f}){var h,m,g,v,y,b;u=u||(r==null?void 0:r[Ew]);let I="processPlayoffGroups",T=0,w=[],S=[],U=[],{error:P,positionRangeMap:E}=mGe({structureId:n,drawDefinition:o,playoffGroups:s});if(P)return ue({result:{error:P},stack:I});if(!(!E||s!=null&&s.every(D=>{let{finishingPositions:R=[]}=D;if(!R.length)return!1;let N=[...R].sort(lr).map((M,A)=>(R[A+1]||M)-M).every(M=>M<2);return(!t||N)&&R.every(M=>E[M])})))return ue({context:{validFinishingPositions:Object.values(E)},result:{error:Se},stack:I});for(let D of s){let R=D.finishingPositions,N=E&&R.map($=>{var j;return(j=E[$])==null?void 0:j.finishingPositions}).flat(),M=c*R.length,A=Q0(M),_=A===2&&uc||D.drawType||uc;N&&(T=Math.min(...N)-1);let k=N&&`${Math.min(...N)}-${Math.max(...N)}`,B=D.structureName||k&&((m=(h=D.playoffAttributes)==null?void 0:h[k])==null?void 0:m.name)||((v=(g=D.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),F={addNameBaseToAttributeName:D.addNameBaseToAttributeName,playoffStructureNameBase:D.playoffStructureNameBase,finishingPositionNaming:D.finishingPositionNaming,finishingPositionLimit:D.finishingPositionLimit,structureId:D.structureId??(f==null?void 0:f.pop()),playoffAttributes:D.playoffAttributes,structureNameMap:D.structureNameMap,sequenceLimit:D.sequenceLimit,structureName:B,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:T,stage:An,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:f},x=({playoffStructures:$,playoffLinks:j})=>{let[V]=$,H=pC({playoffStructureId:V.structureId,finishingPositions:R,sourceStructureId:n});U.push(H),U.push(...j),S.push(...$),w.push({structureId:V.structureId,finishingPositions:R}),T+=M};if(_===uc){let{matchUps:$}=Pc({finishingPositionLimit:T+M,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,matchUpType:l,drawSize:A,isMock:p,uuids:f}),j=$s({structureId:D.structureId??(f==null?void 0:f.pop()),matchUpFormat:e,stage:An,structureName:B,stageSequence:a,matchUps:$});S.push(j);let V=pC({playoffStructureId:j.structureId,finishingPositions:R,sourceStructureId:n});U.push(V),T+=M,w.push({structureId:j.structureId,finishingPositions:R})}else if([Mw,Nw,An].includes(_)){let $={playoffAttributes:D.playoffAttributes??i,playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(f==null?void 0:f.pop()),structureName:D.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:T,stage:An,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:f};_===Mw?Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??cW,roundOffsetLimit:3}):_===Nw&&Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??dW,roundOffsetLimit:2});let j=_I($);if(j.error)return j;if((y=j.links)!=null&&y.length&&U.push(...j.links),(b=j.structures)!=null&&b.length&&S.push(...j.structures),S.sort(gb),j.structureId){let V=pC({playoffStructureId:j.structureId,finishingPositions:R,sourceStructureId:n});U.push(V),w.push({structureId:j.structureId,finishingPositions:R})}T+=M}else if([Aw,UP,ZU,YU,KU,XU].includes(_)){let $=[f==null?void 0:f.pop(),f==null?void 0:f.pop()],j={playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(f==null?void 0:f.pop()),playoffAttributes:D.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,uuids:$,stage:An,structureName:B,matchUpType:l,feedPolicy:u,drawSize:A,isMock:p},V={[Aw]:{fmlc:!0,feedRounds:1},[XU]:{feedRounds:1},[ZU]:{feedsFromFinal:3},[YU]:{feedsFromFinal:2},[KU]:{feedsFromFinal:1}};Object.assign(j,V[_]||{});let{structures:H,links:z}=lv(j),[q]=H,W=pC({playoffStructureId:q.structureId,finishingPositions:R,sourceStructureId:n});U.push(W),U.push(...z),S.push(...H),w.push({structureId:q.structureId,finishingPositions:R}),T+=M}else if([Wl].includes(_)){let{structures:$,links:j}=WP({...F,structureOptions:D.structureOptions||{groupSize:4}});x({playoffStructures:$,playoffLinks:j})}else if([TP].includes(_)){let{structures:$,links:j}=$he(F);x({playoffStructures:$,playoffLinks:j})}else if([E$e].includes(_)){let{structures:$,links:j}=jhe(F);x({playoffStructures:$,playoffLinks:j})}else if([ql].includes(_)){let $=$s({structureId:D.structureId??(f==null?void 0:f.pop()),structureName:D.structureName,finishingPosition:PR,stage:An,stageSequence:a,matchUps:[]});x({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:E,structures:S,links:U}}function pC({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:_p,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Su,roundNumber:1}}}function eE({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>tE({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function tE({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=e||{},c=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??Li();let f=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${f}-TMU-${p+1}`};return Je(0,c).map(p=>{let f=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Vn,collectionPosition:f,collectionId:l,processCodes:u,matchUpType:s,isMock:r}})}function vGe(t){var e,i,n;let r="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ue({result:{error:dt},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:c,groupSize:d,event:p}=t,{structures:f=[],links:h=[],finishingPositionTargets:m,positionRangeMap:g,error:v}=Ghe({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:c,groupSize:d,...t});if(v)return{error:v};let y=m==null?void 0:m.map(({finishingPositions:D})=>D).flat().map(D=>g[D].finishingPositions).flat();l.structures.push(...f),l.links.push(...h);let{matchUps:b,matchUpsMap:I}=fr({inContext:!0,drawDefinition:l}),T=f.map(({structureId:D})=>D),w=b==null?void 0:b.filter(({structureId:D})=>T.includes(D)).map(Ar),S=(e=I==null?void 0:I.drawMatchUps)==null?void 0:e.filter(({matchUpId:D})=>w==null?void 0:w.includes(D));if(S!=null&&S.length){let D=(i=_a({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;D&&S.forEach(R=>{let{tieMatchUps:N}=eE({isMock:t.isMock,tieFormat:D,matchUp:R});Object.assign(R,{tieMatchUps:N,matchUpType:Tc})})}let{positionAssignments:U}=Hi({structureId:a,drawDefinition:l}),P={};U==null||U.forEach(D=>{var R,N,M;let A=(M=(N=(R=qt({element:D,name:fh}))==null?void 0:R.extension)==null?void 0:N.value)==null?void 0:M.groupOrder;A&&(P[A]||(P[A]=[]),P[A].push(D.participantId))});let E=XP({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return E.error&&((n=E.error)==null?void 0:n.code)!==aq.code?ue({result:E,stack:r}):{structures:f,links:h,positionsPlayedOff:y,drawDefinition:l,...ae}}var Vs="SET3-S:6/TB7",yGe="SET3-S:6NOAD",Hhe="SET3-S:6/TB7-F:TB10",bGe="SET3-S:4/TB7",IGe="SET3-S:4/TB5@3",wGe="SET1-S:T20",SGe="SET1-S:8/TB7",TGe="SET1-S:8/TB7@7",UGe={FORMAT_STANDARD:Vs,FORMAT_STANDARD_NOAD:yGe,FORMAT_ATP_DOUBLES:Hhe,FORMAT_SHORT_SETS:bGe,FORMAT_FAST4:IGe,FORMAT_PRO_SET:SGe,FORMAT_COLLEGE_PRO_SET:TGe,TIMED20:wGe};function h4({winningSide:t,matchUpFormat:e=Vs,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=bo(e),u=m4((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===bi&&n!=null&&n.setsCreditForDefaults||i===Ni&&n!=null&&n.setsCreditForWalkovers))a[s]=u;else for(let c of o||[]){let{winningSide:d}=c;d&&(a[d-1]+=1)}return typeof s=="number"&&i===xa&&(+a[1-s]===u&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=u)),a}function zhe({matchUpFormat:t=Vs,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;let{sets:s}=r||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,u=bo(t),c=(u==null?void 0:u.bestOf)??1,d=m4(c),p=((a=u==null?void 0:u.setFormat)==null?void 0:a.tiebreakAt)||0,f=[[],[]];if(typeof l=="number"&&(i===bi&&n!=null&&n.gamesCreditForDefaults||i===Ni&&n!=null&&n.gamesCreditForWalkovers)){let h=((o=u==null?void 0:u.setFormat)==null?void 0:o.setTo)||0,m=d*h;f[l].push(m)}else s.forEach((h,m)=>{var g;let v=(h.setNumber||m+1)>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",y=(g=u==null?void 0:u[v])==null?void 0:g.based,b=u==null?void 0:u[v].tiebreakSet,{side1Score:I,side2Score:T}=h;CK(y)&&(f[0].push(Tt(I||0)),f[1].push(Tt(T||0))),b&&h.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&f[h.winningSide-1].push(1)});if(i===xa&&typeof l=="number"){let h=s.length>d&&u!=null&&u.finalSetFormat?"finalSetFormat":"setFormat",m=u==null?void 0:u[h];if(CK(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!u||b===""))return+b===p-1||+b===p?Tt(p||0)+1:+b<p?g:p},y=h4({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(f.map(b=>b[l]<=b[1-l]).reduce((b,I)=>b+(I?1:0),0)>y[1-l]){let b=f[l].length,I=v(f[1-l][b-1]);I&&(f[l][b-1]=I)}d>f[l].length&&n!=null&&n.gamesCreditForRetirements&&f[l].push(g)}}return[f[0].reduce((h,m)=>h+m,0),f[1].reduce((h,m)=>h+m,0)]}function qhe({matchUpFormat:t,score:e}){var i;let n=t?bo(t):void 0,r=(n==null?void 0:n.bestOf)??1,a=m4(r),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,u)=>{var c;let d=(l.setNumber||u+1)>a&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",p=(c=n==null?void 0:n[d])==null?void 0:c.based;if(Whe(p)){let{side1Score:f,side2Score:h}=l;f&&(s[0]+=Tt(f||0)),h&&(s[1]+=Tt(h||0))}else l.side1TiebreakScore&&(s[0]+=Tt(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=Tt(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function m4(t){return t&&Math.ceil(t/2)||1}function Whe(t){return t==="P"}function CK(t){return!Whe(t)}function DGe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let o=e&&bo(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(c=>{let d=t[c].setsWon,p=t[c].setsLost,f=i!=null&&i.groupTotalSetsPlayed?r:n*(l||0)||d+p,h=Math.round(d/f*1e3)/1e3;(h===1/0||isNaN(h))&&(h=f);let m=t[c].tieMatchUpsWon,g=t[c].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[c].matchUpsWon,I=t[c].matchUpsLost,T=b+I,w=Math.round(b/T*1e3)/1e3;(w===1/0||isNaN(w))&&(w=b);let S=t[c].gamesWon||0,U=t[c].gamesLost||0,P=(n||0)*(l||0)*(u||0),E=Math.max(P,S+U),D=Math.round(S/E*1e3)/1e3;(D===1/0||isNaN(D))&&(D=0);let R=Math.round(t[c].pointsWon/t[c].pointsLost*1e3)/1e3;(R===1/0||isNaN(R))&&(R=0),t[c].setsWon=d,t[c].setsLost=p,t[c].setsPct=h,t[c].tieMatchUpsWon=m,t[c].tieMatchUpsPct=y,t[c].matchUpsPct=w,t[c].gamesWon=S,t[c].gamesLost=U,t[c].gamesPct=D,t[c].pointsPct=R,t[c].result=`${t[c].matchUpsWon}/${t[c].matchUpsLost}`})}function iE({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var a,o,s,l,u,c,d;let p={},f=(i==null?void 0:i.excludeMatchUpStatuses)||[],h=r==null?void 0:r.filter(g=>(g.tieMatchUps||!f.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||$n(t,[DI(g,0),DI(g,1)]).length===2)),m=(a=h==null?void 0:h.flatMap(({score:g,tieMatchUps:v})=>{var y;return v?v.filter(({matchUpStatus:b})=>!f.includes(b)).flatMap(({score:b})=>{var I;return((I=b==null?void 0:b.sets)==null?void 0:I.length)??0}):((y=g==null?void 0:g.sets)==null?void 0:y.length)??0}))==null?void 0:a.reduce((g,v)=>g+v,0);for(let g of h??[]){let{matchUpStatus:v,tieMatchUps:y,tieFormat:b,score:I,winningSide:T,sides:w}=g,S=b&&g._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:E})=>E),U=T&&PGe(g),P=T&&EGe(g);if(!U&&!P)if(v&&kr.includes(v)){let E=DI(g,0),D=DI(g,1);E&&(_f(p,E),p[E].matchUpsCancelled+=1),D&&(_f(p,D),p[D].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let E of y){if(E.winningSide){let D=(o=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:o.participantId,R=(s=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:s.participantId;D&&R&&(_f(p,D),_f(p,R),p[D].tieMatchUpsWon+=1,p[R].tieMatchUpsLost+=1,xn(Pn)(E.matchUpType)?(p[D].tieSinglesWon+=1,p[R].tieSinglesLost+=1):xn(Yi)(E.matchUpType)&&(p[D].tieDoublesWon+=1,p[R].tieDoublesLost+=1))}RK({score:E.score,manualGamesOverride:S,participantResults:p,sides:w})}}else RK({manualGamesOverride:S,participantResults:p,score:I,sides:w});else if(_f(p,U),_f(p,P),y==null?void 0:y.length){n=0;for(let E of y){let{matchUpType:D}=E,R=xn(Yi)(D),N=xn(Pn)(D);E.winningSide&&(E.winningSide===T?(U&&(p[U].tieMatchUpsWon+=1,N&&(p[U].tieSinglesWon+=1),R&&(p[U].tieDoublesWon+=1)),P&&(p[P].tieMatchUpsLost+=1,N&&(p[P].tieSinglesLost+=1),R&&(p[P].tieDoublesLost+=1))):E.winningSide!==T&&(P&&(p[P].tieMatchUpsWon+=1,N&&(p[P].tieSinglesWon+=1),R&&(p[P].tieDoublesWon+=1)),U&&(p[U].tieMatchUpsLost+=1,N&&(p[U].tieSinglesLost+=1),R&&(p[U].tieDoublesLost+=1)))),MK({matchUpFormat:E.matchUpFormat,matchUpStatus:E.matchUpStatus,score:E.score,winningParticipantId:U,losingParticipantId:P,participantResults:p,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:i,winningSide:T})}Khe({winningParticipantId:U,losingParticipantId:P,participantResults:p,matchUpStatus:v})}else MK({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:U,manualGamesOverride:S,losingParticipantId:P,participantResults:p,matchUpStatus:v,tallyPolicy:i,winningSide:T,score:I});if(S){let E=(l=w==null?void 0:w.find(({sideNumber:M})=>M===1))==null?void 0:l.participantId,D=(u=w==null?void 0:w.find(({sideNumber:M})=>M===2))==null?void 0:u.participantId;_f(p,E),_f(p,D);let R=(c=I==null?void 0:I.sets)==null?void 0:c.reduce((M,A)=>M+((A==null?void 0:A.side1Score)??0),0),N=(d=I==null?void 0:I.sets)==null?void 0:d.reduce((M,A)=>M+(A.side2Score??0),0);E&&(p[E].gamesWon+=R,p[E].gamesLost+=N),D&&(p[D].gamesWon+=N,p[D].gamesLost+=R)}}return DGe({participantResults:p,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:m}),{participantResults:p}}function PGe(t){let e=t.winningSide-1;return DI(t,e)}function EGe(t){let e=1-(t.winningSide-1);return DI(t,e)}function DI(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function _f(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function RK({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:u,side1Score:c,side2Score:d}=l;u&&(o[u-1]+=1),a[0].push(Tt(c||0)),a[1].push(Tt(d||0))}let s=[a[0].reduce((l,u)=>l+u,0),a[1].reduce((l,u)=>l+u,0)];n.forEach((l,u)=>{let{participantId:c}=l;c&&(_f(e,c),e[c].setsWon+=o[u],e[c].setsLost+=o[1-u],t||(e[c].gamesWon+=s[u],e[c].gamesLost+=s[1-u]))})}function MK({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:u}){let c=l&&l-1,d=1-c;o||Khe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:a});let p=h4({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:u}),f=zhe({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:u}),{pointsTally:h}=qhe({score:u,matchUpFormat:r});t&&(i[t].setsWon+=p[c],i[t].setsLost+=p[d],n||(i[t].gamesWon+=f[c],i[t].gamesLost+=f[d]),i[t].pointsWon+=h[c],i[t].pointsLost+=h[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[c],n||(i[e].gamesWon+=f[d],i[e].gamesLost+=f[c]),i[e].pointsWon+=h[d],i[e].pointsLost+=h[c])}function Khe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Ni&&(i[e].walkovers+=1),n===bi&&(i[e].defaults+=1),n===xa&&(i[e].retirements+=1),[bi,xa,Ni].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function CGe({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let u=a.excludedDirectives.map(({attribute:p})=>p).join(", "),c=`${u.length} directives were excluded due to participants limit}`;r.push(c);let d=`Excluded: ${u}`;r.push(d)}else{let u=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),c=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(u).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",f=a.groups?"grouped":"separated",h=`Step ${o+1}: ${c} particiants were ${f}${p} by ${a.attribute}`;if(r.push(h),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function Yhe({participantResults:t,participantIds:e,attribute:i}){return Zhe({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function Zhe(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var RGe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],iF={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function NK(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!MGe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Yhe({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(h=>parseFloat(h)).sort((h,m)=>m-h).map(h=>s[h]).map(h=>{let m=Xhe({participantIds:h,...t});return a.push(...m.report??[]),m.order}).flat(1/0),u=1,c;l.forEach((h,m)=>{m&&(h.resolved||c&&!h.resolved)&&(u+=1),c=h.resolved,h.resolved?(h.position=m+1,u=h.position):h.position=u});let d=l.map(({position:h})=>h),p=ts(d);return l.forEach(h=>{let{participantId:m,position:g}=h||{},v=i[m];h.GEMscore=f(v);let y=p[g];(h==null?void 0:h.position)!==void 0&&(y>1&&(h.ties=y,n&&(h.subOrder=n[m])),h.rankOrder=g,h.groupOrder=g+(h.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(h){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(iF).filter(m=>r.GEMscore.includes(m)):Object.keys(iF)).map(m=>(h[m]||0)*Math.pow(10,iF[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function MGe({participantResults:t,participantsCount:e}){let i=Zhe({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function NGe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=iE({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=Yhe({participantResults:l,participantIds:e,attribute:r}),c=[{attribute:r,reversed:s,groups:u,idsFilter:a}],d;return Object.keys(u).length>1&&e.length&&(d=Object.keys(u).map(p=>parseFloat(p)).sort((p,f)=>s?p-f:f-p).map(p=>u[p]).map(p=>{let f=Xhe({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return c.push(...f.report??[]),f.order}).flat(1/0)),{order:d,report:c}}function Xhe({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let c=AGe({participantIds:i,participantResults:t});if(c){let d=c[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[c],headToHeadWinner:d,report:s}}}let u=((r==null?void 0:r.tallyDirectives)||RGe).filter(c=>{let d=!(Mn(c.maxParticipants)&&(i==null?void 0:i.length)>c.maxParticipants);return d||o.push(c),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),u.every(({attribute:c,reversed:d,idsFilter:p,disableHeadToHead:f})=>(l=NGe({disableHeadToHead:f,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:c,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(c=>({participantId:c})),report:s}}function AGe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function yS({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:a}){if(!(n!=null&&n.length)||!pl(n))return{error:Ld};let o=Ht(n.map(({structureId:b})=>b));if(o.length!==1)return ue({result:{error:Se,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=n.filter(b=>b&&b.matchUpStatus!==Di),l=s.length&&Ht(s.map(({drawPositions:b})=>b).flat()).length,u=s.filter(b=>_m({matchUp:b})).length===s.length;u||(a=0);let c=n.every(({matchUpType:b,tieMatchUps:I})=>b===Xi&&(I==null?void 0:I.every(T=>_m({matchUp:T})))),d=t==null?void 0:t[Xq],p=n.filter(b=>_m({matchUp:b})||b.matchUpType===Xi),{participantResults:f}=iE({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:a}),h,m,{groupOrder:g,report:v}=NK({matchUps:p,participantResults:f,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r});if(u&&g)h=v,m=g,g.forEach(b=>{let{participantId:I,groupOrder:T,rankOrder:w,subOrder:S,ties:U,GEMscore:P}=b,E=f[I];Object.assign(E,{groupOrder:T,rankOrder:w,GEMscore:P,subOrder:S,ties:U})});else{let{groupOrder:b,report:I}=NK({requireCompletion:!1,participantResults:f,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r,matchUps:n});h=I,m=b,b&&b.forEach(T=>{let{participantId:w,groupOrder:S,GEMscore:U}=T,P=f[w];Object.assign(P,{provisionalOrder:S,GEMscore:U})})}let y={completedTieMatchUps:c,readableReport:"",participantResults:f,bracketComplete:u,order:[],report:h};if((u||c)&&(y.order=m),e||il({tally:!0})){let b=CGe({matchUps:n,report:h,order:m});il({tally:!0})&&console.log(b),y.readableReport=b}return y}function Jhe({positionAssignments:t}){let e=(t||[]).filter(is(Dd)).map(r=>{let{extension:a}=qt({element:r,name:Rw}),o=Tt(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=ts(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function g4({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!pl(r))return{error:Se};if(!t)return{error:Se};let{policyDefinitions:o}=sf({policyTypes:[Xq],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=Jhe({positionAssignments:t}),l=r.length?yS({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:u={},bracketComplete:c,report:d}=l??{},p=Object.keys(u);return t.forEach(f=>{let{participantId:h}=f;if(p.includes(h)){let m={value:u[h],name:fh};hi({element:f,extension:m}),u[h].ties||qa({element:f,name:Rw})}else qa({element:f,name:fh}),qa({element:f,name:Rw})}),Qi({drawDefinition:i}),{...ae,participantResults:u,bracketComplete:c,report:d}}function Qhe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function on({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:u}){if(!r)return{error:nt};if(!o)return{error:va};if(typeof o!="string")return{error:Se};let{structures:c=[]}=_d({drawDefinition:r});n&&!i&&(i=uf({contextProfile:n,drawDefinition:r}));for(let d of c){let{matchUps:p}=Ci({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:d,context:l,event:u}),{matchUp:f}=Qhe({matchUps:p,matchUpId:o});if(f)return{matchUp:f,structure:d}}return{error:Da}}function PO(t){var e;return typeof t!="object"?{error:dt}:typeof t.element!="object"?{error:Se}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:Se}:(Object.assign(t.element,{notes:t.notes}),{...ae}):{error:dt}}function eme(t){return typeof t!="object"?{error:dt}:typeof t.element!="object"?{error:Se}:(t.element.notes&&delete t.element.notes,{...ae})}var EO={matchUpStatus:Vn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function cc(t){var e,i,n,r,a,o,s,l;let u="modifyMatchUpScore",c=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:f,removeWinningSide:h,tournamentRecord:m,drawDefinition:g,matchUpStatus:v,removeScore:y,winningSide:b,matchUpId:I,event:T,notes:w,score:S}=t,U=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Ai({policyTypes:[Rd],tournamentRecord:m,drawDefinition:g,structure:p,event:T}))==null?void 0:e.appliedPolicies,P=d.matchUpType===Xi;if(P&&g){if(I&&d.matchUpId!==I){let _=on({drawDefinition:g,matchUpId:I,event:T});if(!_.matchUp)return{error:Da};({matchUp:d,structure:p}=_)}}else d.matchUpId!==I&&console.log("!!!!!");v&&[Ni,nr].includes(v)||y?Object.assign(d,{...EO}):S&&(d.score=S);let E=v&&(d==null?void 0:d.matchUpStatus)===bi&&v!==bi;v&&(d.matchUpStatus=v),c&&(d.matchUpFormat=c),f&&(d.matchUpStatusCodes=f),b&&(d.winningSide=b),h&&(d.winningSide=void 0),!p&&g&&({structure:p}=on({drawDefinition:g,matchUpId:I,event:T})),v&&!d.winningSide&&Jr(d)&&!kr.includes(v)&&![hb,Hh].includes(v)&&(d.matchUpStatus=nu);let D;if((E&&(i=d==null?void 0:d.processCodes)!=null&&i.length||v===bi)&&(D=(r=(n=U==null?void 0:U[Rd])==null?void 0:n.processCodes)==null?void 0:r.incompleteAssignmentsOnDefault),!d.collectionId){let _=(p==null?void 0:p.structureType)===oo,k=ns({structure:p});if(LW({drawDefinition:g,structure:p})||k||_){let B=$=>{c=P?"SET1-S:T100":c??d.matchUpFormat??($==null?void 0:$.matchUpFormat)??(g==null?void 0:g.matchUpFormat)??(T==null?void 0:T.matchUpFormat);let j=P?{matchUpTypes:[Xi]}:void 0,{matchUps:V}=Ci({afterRecoveryTimes:!1,tournamentRecord:m,inContext:!0,matchUpFilters:j,drawDefinition:g,structure:$,event:T});return k&&($.positionAssignments=Ht(V.flatMap(H=>(H.sides??[]).map(z=>z.participantId)).filter(Boolean)).map(H=>({participantId:H}))),g4({positionAssignments:$.positionAssignments,tournamentRecord:m,drawDefinition:g,matchUpFormat:c,matchUps:V,event:T})},F=_&&p.structures.find($=>$==null?void 0:$.matchUps.find(j=>j.matchUpId===I)),x=B(F||p);if(x.error)return ue({result:x,stack:u})}}if(w){let _=PO({element:d,notes:w});if(_.error)return ue({result:_,stack:u})}let R=m==null?void 0:m.tournamentId,N=iu().topics.includes(uO),M=(N||D)&&ya({drawDefinition:g}),A=M&&((a=fr({matchUpFilters:{matchUpIds:[I]},nextMatchUps:!0,tournamentRecord:m,inContext:!0,drawDefinition:g,matchUpsMap:M}).matchUps)==null?void 0:a[0]);if(N&&A&&N$e({tournamentId:R,inContextMatchUp:A}),Array.isArray(D)&&A&&!((o=A.sides)!=null&&o.every(({participantId:_})=>_)))if(v===bi)d.processCodes=Ht([...d.processCodes??[],...D]);else for(let _ of D||[]){let k=_&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(_));(l=d==null?void 0:d.processCodes)==null||l.splice(k,1)}return di({eventId:T==null?void 0:T.eventId,context:u,drawDefinition:g,tournamentId:R,matchUp:d}),{...ae}}function v4(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=jP({matchUpStatus:n})||[af,vs].includes(n)&&e,s="attemptToModifyScore",l=!!a.collectionId,u=ns({structure:r});if(!(l||u||_Ge({structure:r,matchUp:a})))return{error:pq};let c=[Ni].includes(n),d=cc({...t,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&n||Zn,context:s,removeScore:c});return ue({result:d,stack:s})}function _Ge({structure:t,matchUp:e}){var i;let{drawPositions:n}=e,{positionAssignments:r}=Or({structure:t});return((i=r==null?void 0:r.filter(a=>(n==null?void 0:n.includes(a.drawPosition))&&a.participantId))==null?void 0:i.length)===2}function tme({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>At(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>Tt(n));return{groupValueGroups:e,groupValueNumbers:i}}function kGe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>kr.includes(y.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,matchUpValue:p,winCriteria:f,scoreValue:h,setValue:m}=t,g=c&&e.includes(c),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),At(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):At(m)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(o[T.winningSide-1]+=m)})}):At(h)?a.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:P=0}=T;(y.matchUpStatus===Zn||y.winningSide||T.winningSide)&&(U||P?(o[0]+=U,o[1]+=P):(w||S)&&T.winningSide&&(o[T.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=OGe({collectionDefinition:t,collectionPosition:b});At(I)&&(o[y.winningSide-1]+=I)}}),At(d)){let y;if(f!=null&&f.aggregateValue)l&&(At(p||m||h)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(f!=null&&f.valueGoal)y=o.reduce((b,I,T)=>I>=f.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,w)=>T>=b?w+1:I,0)}y&&(g?i[c].values[y-1]+=d:s[y-1]+=d)}else g?(i[c].values[0]+=o[0]||0,i[c].values[1]+=o[1]||0):s=o;g?(i[c].sideWins[0]+=v[0]||0,i[c].sideWins[1]+=v[1]||0,i[c].allGroupMatchUpsCompleted=i[c].allGroupMatchUpsCompleted&&l,i[c].matchUpsCount+=a.length):s.forEach((y,b)=>n[b]+=y||0)}function OGe({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function ime({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Ht(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ae}}var xGe="MIXED events can not contain mixed singles or { gender: ANY } collections",LGe="events with { gender: ANY } can not contain MIXED singles collections";function CO(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Ki,vn].includes(i)&&i!==r?ue({result:{valid:!1,error:SR},context:{gender:r},stack:e}):i===Ho&&(r===Uc||r===Ho&&n!==Yi)?ue({result:{error:SR,valid:!1},info:xGe,stack:e}):i===Uc&&r===Ho&&n!==Yi?ue({result:{error:SR,valid:!1},info:LGe,stack:e}):{valid:!0}}function RO(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return FGe(t,e)}function i1(t){return!isNaN(Number(t))&&Number(t)}function nme(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function FGe(t,e){var i;let n=i1(t.bestOf)||void 0,r=i1(t.exactly)||void 0,a=n||r;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return nme(t.setFormat);let o=a&&`${RR}${a}`||"",s=AK(t.setFormat,e),l=s&&`S:${s}`||"",u=AK(t.finalSetFormat,e),c=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,c].filter(d=>d).join("-")}function AK(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return nme(t);if(t.tiebreakSet)return _K(t.tiebreakSet);let i=i1(t.setTo);if(i){let n=t.NoAD&&BW||"",r=_K(t.tiebreakFormat),a=r&&`/${r}`||"",o=i1(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function _K(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&i1(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?BW:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function rs({matchUpFormat:t}){if(typeof t!="string")return!1;let e=bo(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],u=o==null?void 0:o[3];return RO(e,!!(i&&r&&n===a||o&&l&&s===u))===t}var BGe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),$Ge=t=>t.filter(Boolean).every(Mn);function nE(t){let e=t.category;if(typeof e!="object")return{error:sN};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!BGe([i,n,r,s],"string")||!$Ge([a,o]))return{error:sN};let u=t.consideredDate??Bt(new Date().toLocaleDateString("sv"));if(!hs(u))return{error:Qa};let[c]=u.split("-").slice(0,3).map(F=>parseInt(F)),d=lT(u,-1),[p,f]=d.split("-").slice(1,3).map(F=>parseInt(F)),h=`${Bs(p)}-${Bs(f)}`,m=lT(u,1),[g,v]=m.split("-").slice(1,3).map(F=>parseInt(F)),y=`${Bs(g)}-${Bs(v)}`,b=o&&lT(u,-1*365*o),I=a&&lT(u,-1*365*a),T=[],w=F=>!T.includes(F)&&T.push(F);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),E=P&&(i==null?void 0:i.match(U)),D=i==null?void 0:i.match(S),R=(F,x)=>`${F}-${x}`,N=F=>{let x=c-F,$=R(x,y);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F-1&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=F-1)},M=F=>{let x=c-F-1,$=R(x,y);e.ageMin&&e.ageMin>F&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>F&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=F)},A=F=>{let x=c-F,$=R(x,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F+1&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=F+1)},_=F=>{let x=c-F-1,$=R(x,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F&&(w(`Invalid submitted ageMin: ${o}`),b=void 0),o=F)},k=F=>{let[x,$,j]=(F.match(S)||[]).slice(1),V=parseInt($);x==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(V)):x==="O"&&A(V),j==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),M(V)):j==="O"&&_(V),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let $=c-e.ageMin;n=R($,h)}if(e.ageMax){let $=c-e.ageMax-1;r=R($,y)}let[F,x]=((i==null?void 0:i.match(U))??[]).slice(1).map($=>parseInt($));F<=x?(o=F,a=x,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(k):D?k(i):(o&&A(o),a&&M(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let B=ft({consideredDate:u,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return T.length&&(B.errors=T),B}function CN({category:t}){if(!ln(t))return{error:Se};let e=nE({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Mn(i)?ue({result:{error:Se},context:{ratingMax:i}}):n&&!Mn(n)?ue({result:{error:Se},context:{ratingMin:n}}):{...e}}function MO({childCategory:t,withDetails:e,category:i}){let n=CN({category:i}),r=CN({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),c=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=ft({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:c,invalidAgeMax:o,invalidAgeMin:a,valid:!u&&!s&&!l&&!c&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function rE({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ue({result:{errors:l,error:rf},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:c,collectionValue:d,collectionId:p,matchUpCount:f,matchUpFormat:h,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof f!="number"&&l.push(`matchUpCount is not type number: ${f}`),g&&!yO([Pn,Yi],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(u!=null&&u.length)].concat([m,d,v,y].map(At)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),u&&f){let T=ime({collectionValueProfiles:u,matchUpCount:f});T.errors&&l.push(...T.errors)}if(c&&typeof c!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!rs({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),n){let T=CO({referenceGender:a,matchUpType:g,gender:I});if(T.error)return ue({context:{referenceGender:a,gender:I},result:T,stack:s})}if(t&&r&&b){let T=MO({category:r,childCategory:b});if(!T.valid)return ue({result:{error:sN},context:T,stack:s})}return l.length?ue({result:{errors:l,error:Gde},stack:s}):{valid:!0}}function Ao(t){var e,i,n,r;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,u=t==null?void 0:t.event,c="validateTieFormat",d=[];if(!t||!l||typeof l!="object")return d.push("tieFormat must be an object"),ue({result:{error:Jd},context:{tieFormat:l,errors:d},stack:c});if(typeof l.winCriteria!="object")return d.push("tieFormat.winCriteria must be an object"),ue({result:{error:Jd},context:{tieFormat:l,errors:d},stack:c});if(!Array.isArray(l.collectionDefinitions))return d.push(Od("tieFormat.collectionDefinitions")),ue({result:{error:Jd},context:{tieFormat:l,errors:d},stack:c});let p,f=l.collectionDefinitions.every(y=>{let{setValue:b,scoreValue:I,collectionValue:T}=y;(b||I)&&!T&&(p=!0);let{valid:w,errors:S}=rE({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:y,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return w?!0:(Array.isArray(S)&&d.push(...S),!1)}),h=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!p||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!(h||(r=l.winCriteria)!=null&&r.aggregateValue))return p?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ue({context:{tieFormat:l,errors:d,aggregateValueImperative:p},result:{error:Jd},stack:c});let m=l.collectionDefinitions.map(({collectionId:y})=>y),g=!s||m.length===Ht(m).length,v=f&&h&&g;return v?{valid:v,errors:d}:ue({result:{error:Jd},context:{tieFormat:l,errors:d},stack:c})}function aE(t){var e,i,n,r,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:c,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((P,E)=>P+E)))return{error:Se};if(!d)return{error:No};let f=((e=_a({matchUp:d,drawDefinition:l,structure:c,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!f)return{error:dP};let h=Ao({tieFormat:f});if(h.error)return h;let m=(f==null?void 0:f.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:b}=tme(f);for(let P of m)kGe({collectionDefinition:P,groupValueNumbers:b,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let P of b){let E=y[P],{allGroupMatchUpsCompleted:D,matchUpCount:R,winCriteria:N,groupValue:M,sideWins:A,values:_}=E,k;if(N!=null&&N.aggregateValue)D&&_[0]!==_[1]&&(k=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)k=_.reduce((B,F,x)=>F>=N.valueGoal?x+1:B,void 0);else{let B=Math.floor(R/2)+1;k=A.reduce((F,x,$)=>x>=B?$+1:F,void 0)}k&&(v[k-1]+=M||0)}let I=v.map((P,E)=>(P||0)+o[E]),T={side1Score:I[0],side2Score:I[1],winningSide:void 0},w=I.join(s),S=I.slice().reverse().join(s),U;if(f!=null&&f.winCriteria){let{valueGoal:P,aggregateValue:E,tallyDirectives:D}=f.winCriteria;if(P?U=(i=I.map((R,N)=>({sideNumber:N+1,points:R})).find(({points:R})=>R>=P))==null?void 0:i.sideNumber:E&&g.every(R=>R.matchUpStatus&&kr.includes(R.matchUpStatus)||R.winningSide)&&I[0]!==I[1]&&(U=I[0]>I[1]?1:2),!U&&D){let R=d.matchUpId,N=d.hasContext?d:((n=u==null?void 0:u.drawMatchUps)==null?void 0:n[R])||l&&((r=on({inContext:!0,drawDefinition:l,matchUpId:R}))==null?void 0:r.matchUp);if(N){let{completedTieMatchUps:M,order:A}=yS({matchUps:[N]});if(M&&A!=null&&A.length){let _=A[0].participantId;U=(a=N.sides.find(({participantId:k})=>k===_))==null?void 0:a.sideNumber}}}}return U&&(T.winningSide=U),{scoreStringSide1:w,scoreStringSide2:S,winningSide:U,set:T}}function oE({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=on({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=qt({element:e,name:Np}),l=ut((s==null?void 0:s.value)||{},!1,!0),u=({displaySideNumber:c,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:c});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(c=>{var d;let p=c.participantId,f=p&&l[p]||void 0,{lineUp:h,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===c.sideNumber))??{},g=h!=null&&h.length?h:f;return{...u(c),...m,lineUp:g}}),di({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function aa(t){if(t)return ut(t,!1,!0)}function y4(t){let e=wi(t,[{[Ea]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function rme({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=y4({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function df(t){var e,i,n,r;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:c,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},f=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&rme({tournamentRecords:p,...t});let h=f&&p[f];if(!h)return{error:Oe};let m=on({drawDefinition:o,event:d,matchUpId:c});if(m.error)return m;if(!m.matchUp)return{error:Da};let{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:go};oE({tournamentId:h==null?void 0:h.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=qt({name:Cw,element:g});if(y!=null&&y.value)if(l)qa({element:g,name:Cw});else return{...ae,score:g.score};let b=(n=_a({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=aa(b);let I=aE({drawDefinition:o,matchUpsMap:u,structure:v,matchUp:g,event:d}),{winningSide:T,set:w,scoreStringSide1:S,scoreStringSide2:U}=I,P=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!P)return{...ae};let E={scoreStringSide1:S,scoreStringSide2:U,sets:w?[w]:[]},D=T&&[1,2].includes(T),R=D&&Zn||GW({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:E})&&nu||Vn,N=!!(g.winningSide&&!D),M=g.tieMatchUps.find(({score:_,winningSide:k,matchUpStatus:B})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||B&&kr.includes(B)||k}),A;if(g.tieFormat&&!D&&!M){let _=(r=_a({drawDefinition:o,structure:v,event:d}))==null?void 0:r.tieFormat;_&&JSON.stringify(b)===JSON.stringify(_)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return cc({appliedPolicies:t.appliedPolicies,matchUpStatus:R,score:E,removeWinningSide:N,tournamentRecord:h,drawDefinition:o,removeScore:l,winningSide:T,matchUpId:c,matchUp:g,event:d}),{...ae,score:E,removeWinningSide:N,tieFormatRemoved:A,winningSide:T}}function VGe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:c,matchUpsMap:d,event:p}){var f,h,m,g,v;let y="directWinner";if(o){let b=u.drawPositions||[],I=b[t],T=o.source.structureId,w=Pt({structureId:T,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=Or({structureId:T,drawDefinition:l}),P=(f=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:f.participantId,E=o.target.structureId,{positionAssignments:D}=Or({structureId:E,drawDefinition:l}),R=(h=D==null?void 0:D.find(A=>A.participantId===P))==null?void 0:h.drawPosition,N=D==null?void 0:D.filter(A=>{let _=b.includes(A.drawPosition),k=!A.participantId&&!A.bye&&!A.qualifier;return _&&k}).map(A=>A.drawPosition),M=N==null?void 0:N.includes(I);if(P&&o.target.roundNumber===1&&M)Dc({drawPosition:I,participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&N!=null&&N.length){let A=N.pop();A&&Dc({participantId:P,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(R){let A=Lw({drawPosition:R,matchUpId:u.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return ue({result:A,stack:y})}else if((S==null?void 0:S.stage)!==vt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:k})=>k===P),_=A==null?void 0:A.participantId;A&&_&&gS({eventId:u==null?void 0:u.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let b=Lw({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(c&&i){let b=(m=c.sides)==null?void 0:m.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=c.roundPosition,T=u.roundPosition,w=I===T&&I!==1||Math.floor(I/2)===T?2:1,S=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:E})=>E===u.matchUpId),U=[1,2].map(E=>{var D;return{...((D=S.sides)==null?void 0:D.find(R=>R.sideNumber===E))||{},sideNumber:E}});S.sides=U;let P=S.sides.find(E=>E.sideNumber===w);if(P){let E=(v=b.lineUp)==null?void 0:v.filter(D=>D==null?void 0:D.participantId);P.lineUp=n4({lineUp:E}),di({tournamentId:a==null?void 0:a.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:S,context:y,drawDefinition:l})}}}return{...ae}}function jGe(t){var e,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:c,drawDefinition:d,loserMatchUp:p,dualMatchUp:f,matchUpsMap:h,event:m}=t,g="directLoser",v=c.linkCondition,y=p.drawPositions||[],b=v===Nd&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),I=b||y[r],T=b||y[1-r],w=c.source.structureId,{structure:S}=Pt({structureId:w,drawDefinition:d}),{matchUps:U}=Ci({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:S,event:m}),P=U.filter(V=>{var H;return(H=V.drawPositions)==null?void 0:H.includes(l)}).filter(V=>{let H=V.sides.find(q=>q.drawPosition===l),z=V.matchUpStatus===Ni||V.matchUpStatus===bi&&!Jr(V);return(H==null?void 0:H.sideNumber)===V.winningSide&&!z}),E=v===Nd&&P.length===0,{positionAssignments:D}=Or({structureId:w,drawDefinition:d}),R=(e=D==null?void 0:D.find(V=>V.drawPosition===l))==null?void 0:e.participantId,N=c.target.structureId,{positionAssignments:M}=Or({structureId:N,drawDefinition:d}),A=M==null?void 0:M.filter(({drawPosition:V})=>y.includes(V));if(A!=null&&A.some(V=>V.participantId===R))return{...ae};let _=A==null?void 0:A.filter(V=>{let H=y.includes(V.drawPosition),z=!V.participantId&&!V.bye&&!V.qualifier;return H&&z}).map(V=>V.drawPosition),k=_==null?void 0:_.includes(I),B=c.target.roundNumber>1&&(_==null?void 0:_.length),F=c.target.roundNumber===1&&k;if(b){let V=x();if(V.error)return ue({result:V,stack:g})}else if(F){let V=j();if(V.error)return ue({result:V,stack:g})}else if(R&&B){_.sort(lr);let V=_[0],H=Dc({participantId:R,structureId:N,drawPosition:V,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:m});if(H.error)return ue({result:H,stack:g})}else return ue({result:{error:q0},context:{loserDrawPosition:l,loserTargetLink:c},stack:g});if(S!=null&&S.seedAssignments&&S.structureId!==N){let V=S.seedAssignments.find(({participantId:z})=>z===R),H=V==null?void 0:V.participantId;V&&H&&gS({eventId:p==null?void 0:p.eventId,structureId:N,...V,tournamentRecord:u,drawDefinition:d,participantId:H})}if(f&&o){let V=(i=f.sides)==null?void 0:i.find(H=>H.sideNumber===3-o);if(V!=null&&V.lineUp){let{roundNumber:H,eventId:z}=p,{roundPosition:q}=f,W=H===1?2-q%2:1,Y=(n=h==null?void 0:h.drawMatchUps)==null?void 0:n.find(({matchUpId:Q})=>Q===p.matchUpId),Z=[1,2].map(Q=>{var ce;return{...((ce=Y.sides)==null?void 0:ce.find(J=>J.sideNumber===Q))||{},sideNumber:Q}});Y.sides=Z;let X=Y.sides.find(Q=>Q.sideNumber===W);X&&(X.lineUp=n4({lineUp:V.lineUp}),di({tournamentId:u==null?void 0:u.tournamentId,matchUp:Y,context:g,drawDefinition:d,eventId:z}))}}return{...ae};function x(){let V="loserLinkFedFMLC";return ue(E?{result:j(),stack:V}:{result:$(),stack:V})}function $(){let V=Ds({drawPosition:T,structureId:N,tournamentRecord:u,drawDefinition:d,event:m});return ue({result:V,stack:"assignLoserPositionBye"})}function j(){let V=R?Dc({drawPosition:I,participantId:R,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,event:m}):{error:wr};return ue({result:V,stack:"assignLoserDrawPosition"})}}function ame(t){var e;let i=v4(t);if(i.error)return i;let n=jP({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:u,dualMatchUp:c,matchUpsMap:d,winningSide:p,targetData:f,matchUpId:h,structure:m,matchUp:g,event:v}=t,y="directParticipants",b=!!g.collectionId,I=ns({structure:m}),T=g.drawPositions,w;if(b){let{matchUpTieId:S,matchUpsMap:U}=t,P=df({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:s,drawDefinition:l,matchUpsMap:U,event:v});if(w=P&&{tieMatchUpResult:P},T=(e=o.find(({matchUpId:E})=>E===S))==null?void 0:e.drawPositions,!r)return ue({result:{...ae,...w},stack:y})}if(I)return ue({result:{...ae,...w},stack:y});if(T){let S=a?a-1:p-1,U=1-S,P=T[S],E=T[U],{targetLinks:{loserTargetLink:D,winnerTargetLink:R,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:M,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:k,byeMatchUp:B}}=f;if(_){let F=VGe({sourceMatchUpStatus:n&&u||Zn,winnerMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:P,tournamentRecord:s,winnerTargetLink:R,drawDefinition:l,winnerMatchUp:_,dualMatchUp:c,matchUpsMap:d,event:v});if(F.error)return ue({result:F,stack:y})}if(k){let F=jGe({sourceMatchUpStatus:n&&u||Zn,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:E,tournamentRecord:s,loserTargetLink:D,drawDefinition:l,loserMatchUp:k,winningSide:p,matchUpsMap:d,dualMatchUp:c,event:v});if(F.error)return ue({result:F,stack:y})}if(B){let F=B.drawPositions||[],x=Math.min(...F.filter(Boolean)),$=N.target.structureId,j=Ds({drawPosition:x,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(j.error)return ue({result:j,stack:y})}}else return ue({result:{error:lP},stack:y});return ue({result:{...ae,...w},stack:y})}function b4(t){var e,i,n,r;let a="genPlayoffStructure";if(!t.drawDefinition)return ue({result:{error:nt},stack:a});let o=QP(t);if(o.error)return ue({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:c,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:f,roundOffsetLimit:h,tournamentRecord:m,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:b,isMock:I,event:T,uuids:w}=t,S=ut(t.drawDefinition,!1,!0),{structure:U}=Pt({structureId:s,drawDefinition:S});if(!U)return ue({result:{error:Tn},stack:a});if(U.structureType===oo||U.structures)return vGe({sourceStructureId:U.structureId,...t,...o,drawDefinition:S});let{playoffRoundsRanges:P,playoffRounds:E}=o,{playoffPositionsReturned:D,error:R,playoffSourceRounds:N,playoffRoundsRanges:M}=Bhe(t);if(R)return ue({result:{error:R},stack:a});let A=(v==null?void 0:v.length)&&Object.assign({},...v),_=y||typeof v=="object"&&v.map(Q=>Object.keys(Q)).flat(),k=Array.isArray(_)&&_.map(Q=>!isNaN(Q)&&Tt(Q)).filter(Boolean);if(k){if(!Array.isArray(k))return ue({result:{error:Se},context:{validRoundNumbers:k},stack:a});k.forEach(Q=>{if(!(E!=null&&E.includes(Q)))return ue({result:{error:Se},context:{roundNumber:Q},stack:a})})}f&&f.forEach(Q=>{if(!(D!=null&&D.includes(Q)))return ue({result:{error:Se},context:{playoffPosition:Q},stack:a})});let B=k||N,F=k?P:M,x=[],$=[];for(let Q of B??[]){let ce=F==null?void 0:F.find(fe=>fe.roundNumber===Q);if(!ce)return ue({result:{error:Se},context:{roundNumber:Q},stack:a});let J=ce.finishingPositions.length,ee=Math.min(...ce.finishingPositions)-1,ne=2,ie=Q&&(A==null?void 0:A[Q])&&ne+A[Q]-1,oe=_I({exitProfile:`0-${Q}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:ee,playoffAttributes:p,exitProfileLimit:g,stage:An,roundOffset:0,drawDefinition:S,sequenceLimit:ie,stageSequence:ne,drawSize:J,idPrefix:b,isMock:I,uuids:w,finishingPositionNaming:c,finishingPositionLimit:d,roundOffsetLimit:h});if(oe.error)return ue({result:oe,stack:a});let{structures:se,links:pe}=oe;if(se!=null&&se.length&&x.push(...se),pe!=null&&pe.length&&$.push(...pe),oe.structureId&&Q){let fe={linkType:Md,source:{structureId:s,roundNumber:Q},target:{structureId:oe.structureId,feedProfile:Ml,roundNumber:1}};$.push(fe)}}if(!x.length)return ue({result:{error:Se},info:"No structures generated",stack:a});S.structures.push(...x),S.links.push(...$);let{matchUps:j,matchUpsMap:V}=fr({inContext:!0,drawDefinition:S}),H=x.map(({structureId:Q})=>Q),z=j==null?void 0:j.filter(({structureId:Q})=>H.includes(Q)).map(Ar),q=(e=V==null?void 0:V.drawMatchUps)==null?void 0:e.filter(({matchUpId:Q})=>z==null?void 0:z.includes(Q));if(q!=null&&q.length){let Q=(i=_a({drawDefinition:S,event:T}))==null?void 0:i.tieFormat;Q&&q.forEach(ce=>{let{tieMatchUps:J}=eE({matchUp:ce,tieFormat:Q,isMock:I});Object.assign(ce,{tieMatchUps:J,matchUpType:Xi})})}(n=j==null?void 0:j.filter(Q=>_m({matchUp:Q})&&Q.structureId===s))==null||n.forEach(Q=>{let{matchUpId:ce,score:J,winningSide:ee}=Q,ne=io({inContextDrawMatchUps:j,drawDefinition:S,matchUpId:ce}),ie=ame({inContextDrawMatchUps:j,tournamentRecord:m,drawDefinition:S,matchUpsMap:V,winningSide:ee,targetData:ne,matchUpId:ce,structure:U,matchUp:Q,score:J,event:T});ie.error&&console.log(ie.error)}),(r=j==null?void 0:j.filter(Q=>Q.matchUpStatus===Di&&Q.structureId===s))==null||r.forEach(Q=>{let{matchUpId:ce}=Q,J=io({inContextDrawMatchUps:j,drawDefinition:S,matchUpId:ce}),{targetLinks:{loserTargetLink:ee},targetMatchUps:{loserMatchUpDrawPositionIndex:ne,loserMatchUp:ie}}=J;if(ee&&ie){let oe=ee.target.structureId,se=ie.drawPositions[ne],pe=Ds({drawPosition:se,structureId:oe,tournamentRecord:m,drawDefinition:S,event:T});pe.error&&console.log(pe.error)}});let W=[],Y=sg({inContextDrawMatchUps:j,drawDefinition:S,matchUpsMap:V}).goesToMap,{structure:Z}=Pt({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:X}=Ci({structure:Z});return X.forEach(Q=>{var ce,J;let ee=Y==null?void 0:Y.loserMatchUpIds[Q.matchUpId];if(ee&&Q.loserMatchUpId!==ee){Q.loserMatchUpId=ee;let ie={tournamentId:m==null?void 0:m.tournamentId,eventId:(ce=t.event)==null?void 0:ce.eventId,context:a,matchUp:Q};W.push(ie)}let ne=Y==null?void 0:Y.winnerMatchUpIds[Q.matchUpId];if(ne&&Q.winnerMatchUpId!==ne){Q.winnerMatchUpId=ne;let ie={tournamentId:m==null?void 0:m.tournamentId,eventId:(J=t.event)==null?void 0:J.eventId,context:a,matchUp:Q};W.push(ie)}}),{structures:x,matchUpModifications:W,links:$,drawDefinition:S,...ae}}function ome(t){return NO({...t,itemType:"attachConsolationStructures"})}function I4(t){return NO({...t,itemType:"attachPlayoffStructures"})}function NO({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var s,l,u;let c="attachStructures";if(!n)return{error:nt};if(!Array.isArray(r)||!Array.isArray(a))return ue({result:{error:Se},stack:c});let d=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},p=(s=n.links)==null?void 0:s.map(d);if(a.some(b=>{let I=d(b);return p==null?void 0:p.includes(I)}))return ue({result:{error:Aq},info:"playoff structure exists",stack:c});a.length&&((l=n.links)==null||l.push(...a));let f=r.map(({structureId:b})=>b),h=(u=n.structures)==null?void 0:u.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>f.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let m=r==null?void 0:r.filter(({structureId:b})=>!(h!=null&&h.includes(b)));m.length&&n.structures.push(...m),sg({drawDefinition:n});let g=r.map(b=>{var I;return((I=Ci({structure:b}))==null?void 0:I.matchUps)||[]}).flat();mh({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:g});let v=r.map(({structureId:b})=>b);if(Qi({drawDefinition:n,structureIds:v}),e==null?void 0:e.length){let b={};e.forEach(T=>{var w;let S=(w=T.matchUp)==null?void 0:w.matchUpId;S&&(b[S]=T)});let I=T=>{T.matchUps.forEach(w=>{if(b[w.matchUpId]){let{tieMatchUps:S,...U}=b[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let P={};S.forEach(E=>b[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,P[E.matchUpId]))}b[w.matchUpId].matchUp=w,di(b[w.matchUpId])}})};n.structures.forEach(T=>{if(h!=null&&h.includes(T.structureId))if(T.structures)for(let w of T.structures)I(w);else I(T)})}let y=m.map(is("structureId"));if(i){let b={itemValue:{structureIds:v,drawId:n.drawId},itemType:t};zh({element:i,timeItem:b})}return{...ae,addedStructureIds:y}}function AO(t){var e,i;let{structures:n,links:r,matchUpModifications:a,error:o}=b4(t);if(o)return{error:o};let s=t.drawDefinition;return I4({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:n,links:r})}function lg(t){let e=wi(t,[{_anyOf:{[Ea]:!1,[Fd]:!1,[Yu]:!1,[eS]:!1},[$q]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=kK(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&Qi({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Oe};for(let a of r){let o=t.tournamentRecords[a],s=kK(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:Oe};return i.length?{...ae,applied:i}:{error:yq}}function kK(t,e){let i=Ai(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:Fk};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!ln(o))return{error:Se};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!mo(s))return{error:Se};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...hi({element:e,extension:{name:qU,value:i}}),applied:n}:{applied:n,error:yq}}function w4({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||typeof n!="string")return ue({result:{error:Se},context:{drawName:n}});i||(i=Hn({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===r);if(s){s.drawName=n;let l={name:zl,value:{...i,flights:i.flights}};Gh({event:a,extension:l})}return e&&(e.drawName=n,Qi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:nt}:{...ae,flight:s}}function sme({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var a;if(!ln(i))return{error:Se};let o=Hn({event:r}).flightProfile,s=i.drawName&&w4({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:n,event:r});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(u=>u.drawId===n));if(!l&&!e)return{error:nt};if(l){let u={name:zl,value:{...o,flights:o.flights}};Gh({event:r,extension:u})}return e&&(i.policyDefinitions&&lg({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Qi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...ae}}function lme({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n,r;if(!i)return{error:nt};let a=ya({drawDefinition:i}),o=l=>{var u;return(u=a==null?void 0:a.drawMatchUps)==null?void 0:u.find(c=>c.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:u,stage:c,stageSequence:d}=l;u&&(d!==1||![vt,at].includes(c))&&(l.positionAssignments=u.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:f}=Ci({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let h of p){let{matchUpId:m,roundNumber:g}=h,v=h.sides||[],y=o(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Di&&Object.assign(y,EO),g&&g>1&&((n=y.drawPositions)==null?void 0:n.length)&&!f){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:w})=>!w&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(r=y.timeItems)!=null&&r.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![Lp,rg,uS,gfe,cS,dS].includes(b.itemType))),di({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let s=(i.structures||[]).map(({structureId:l})=>l);return Qi({drawDefinition:i,structureIds:s}),{...ae}}function sE({tournamentRecord:t}){var e;if(!t)return{error:Oe};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{let a=r.eventId;return n[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:u}=DO({drawDefinition:r}),c=n[a],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:w,structureId:S}=I,U=hy[T],{inContextStructureMatchUps:P}=GP({drawDefinition:r,structure:I,event:c}),E=P==null?void 0:P.filter(({winningSide:V})=>V),D=E.filter(Boolean).length||0;s+=D,l+=P.length-s;let R=Math.max(E.filter(({roundNumber:V})=>V===1).map(({roundPosition:V})=>V)),{positionAssignments:N}=Hi({structure:I}),M=N==null?void 0:N.filter(({participantId:V})=>V);o+=(M==null?void 0:M.length)??0;let A=((N==null?void 0:N.length)??0)-((M==null?void 0:M.length)??0),{roundMatchUps:_,roundProfile:k,roundNumbers:B,maxMatchUpsCount:F}=to({matchUps:P}),x=k&&Object.keys(k).filter(V=>!k[V].inactiveRound).map(V=>parseInt(V)),$=k&&Object.keys(k).filter(V=>k[V].inactiveRound).map(V=>parseInt(V)),j=k&&Object.values(k).every(V=>V.inactiveRound);return{positionsAssignedCount:(M==null?void 0:M.length)??0,maxWinningSideFirstRoundPosition:R,unassignedPositionsCount:A,inactiveStructure:j,maxMatchUpsCount:F,inactiveRounds:$,roundMatchUps:_,activeRounds:x,roundNumbers:B,roundProfile:k,structureId:S,stageSequence:w,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),f=d.filter(({inactiveStructure:I})=>!I).length,{links:h}=pS({structureId:p.structureId,drawDefinition:r}),m=Tt(p.activeRounds[0])===1&&p.activeRounds.length===1&&f===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:u,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=b}),{...ae,drawsAnalysis:i}}function ume({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:Oe};if(!i)return{error:nt};let a=[],{drawsAnalysis:o}=sE({tournamentRecord:e});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[u]}=_d({stageSequence:1,drawDefinition:i,stage:at}),c=l.structuresData.find(({structureId:h})=>u.structureId===h),d=(u.matchUps??[]).sort((h,m)=>h.roundPosition-m.roundPosition);a=d.filter(({roundNumber:h})=>!c.inactiveRounds.includes(h));let p=a.map(Ar),f=d.map(Ar).filter(h=>!p.includes(h));if(s){let h=a.filter(({roundNumber:b})=>!c.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=h.map(Ar),g=p.filter(b=>!m.includes(b));f.push(...g);let v=h.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(h.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(r=u==null?void 0:u.positionAssignments)==null?void 0:r.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));u.positionAssignments=b}else u.positionAssignments=[];u.matchUps=h,a=h}of({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,drawDefinition:i}),Qi({drawDefinition:i})}return{...ae,matchUps:a}}function cme({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:nt};if(!n)return{error:W0};if(!r)return{error:Ts};if(s){let l=Ds({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:qk};{let l=Dc({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...ae}}function dme(t){var e,i,n,r,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(f=>{var h;return(h=f.matchUps)==null?void 0:h.some(({matchUpId:m})=>o.includes(m))}))==null?void 0:i.structureId)??((r=(n=s==null?void 0:s.structures)==null?void 0:n[0])==null?void 0:r.structureId);if(!l)return{error:Tn};let u=(a=s.structures)==null?void 0:a.find(f=>f.structureId===l);if(!u)return{error:Tn};let c=u==null?void 0:u.matchUps,d=c==null?void 0:c.find(f=>!!f.roundPosition);if(u.structures||d||u.finishingPosition===mb)return{error:lb};let p=c.filter(({roundNumber:f})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(f)}).map(Ar);return o=o.filter(f=>!p.includes(f)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:c,matchUpIds:o,structureId:l,structure:u}}function pme(t){let e=wi(t,[{[Yu]:!0},{[jU]:{[gP]:!1,roundNumbers:!1},[Pd]:Se,[Vh]:Fo}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=dme(t);if(l.error)return l;let{structure:u,structureId:c,existingMatchUps:d,matchUpIds:p}=l,f=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(Jr({score:y})){if(!b&&!i)return!1;f.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=h.map(Ar),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(Ar)).filter(Boolean).flat();if(m.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),of({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=Ht(u.matchUps.map(is("roundNumber"))),y=EBe(v);if(y.length){y.reverse();for(let b of y)u.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,di({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:I}))})}if(f.length){u.positionAssignments=Ht(u.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let b=(u==null?void 0:u.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:I}=Ci({afterRecoveryTimes:!1,inContext:!0,structure:u,event:s}),T=g4({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:b,matchUps:I,event:s});T.error&&console.log(T)}Qi({structureIds:[c],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:Kk}:{...ae,deletedMatchUpsCount:[...m,...g].length}}function fme({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:Oe};if(!i)return{error:nt};if(!r)return ue({result:{error:dt},info:"roundNumber required"});let o=Pt({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:lb}:ns({structure:s})?GGe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...ae})}function GGe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],u=!1;if(o.reduce((c,d)=>{let p=d==null?void 0:d.roundNumber;return p?c.includes(p)?c:c.concat(p):c},[]).sort(lr).includes(n)){let c=o.filter(d=>{let p=d.roundNumber===n&&(!kr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Ar))),!p});l.length&&(of({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),c.some(d=>d.roundNumber===n)||(c.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,di({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),u=!0),r.matchUps=c)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...ae}}function _O(t){var e,i,n,r,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:c,event:d}=t;if(typeof u!="object")return{error:nt};let p=t==null?void 0:t.structureId;if(!p&&((e=u.structures)==null?void 0:e.length)===1&&(p=(n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:Ts};if(!pl(c))return{error:Se,info:Od("matchUps")};let f=(r=u.structures)==null?void 0:r.find(y=>y.structureId===p);if(!f)return{error:Tn};let h=(f==null?void 0:f.matchUps).find(y=>!!y.roundPosition);if(f.structures||h||f.finishingPosition===mb)return{error:lb};let m=((o=(a=Xr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Ar))??[],g=c.map(Ar);if(eo(m,g))return{error:Kde,info:"One or more matchUpIds already present in tournamentRecord"};f.matchUps.push(...c);let v=c.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(mh({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...c],eventId:d==null?void 0:d.eventId,drawDefinition:u}),Qi({drawDefinition:u,structureIds:[p]})),{...ae}}function hme({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var o;if(!e)return{error:nt};if(!n)return{error:Ts};if(!i)return{error:W0};let{structure:s}=Pt({drawDefinition:e,structureId:n});if(!s)return{error:Tn};let l=s;s.structures&&s.structureType===oo&&(l=(o=s.structures)==null?void 0:o.find(h=>{var m;return(m=h.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let u=l==null?void 0:l.positionAssignments,c=u==null?void 0:u.find(h=>h.drawPosition===i);c&&hi({element:c,extension:{name:Rw,value:r}});let d=((a==null?void 0:a.eventType)===Xi||e.matchUpType===Xi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[Xi]},{matchUps:p}=Ci({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),f=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return g4({positionAssignments:u,tournamentRecord:t,drawDefinition:e,matchUpFormat:f,matchUps:p,event:a}),Qi({drawDefinition:e,structureIds:[n]}),{...ae}}var mme={};Yt(mme,{addGoesTo:()=>sg,allPlayoffPositionsFilled:()=>s4,checkValidEntries:()=>LO,findDrawDefinition:()=>D4,getAssignedParticipantIds:()=>Gg,getAvailableMatchUpsCount:()=>kO,getAvailablePlayoffProfiles:()=>QP,getDrawDefinitionTimeItem:()=>VW,getDrawParticipantRepresentativeIds:()=>T4,getDrawTypeCoercion:()=>lE,getEligibleVoluntaryConsolationParticipants:()=>S4,getMatchUpsMap:()=>ya,getParticipantIdFinishingPositions:()=>U4,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>vS,getSeedingThresholds:()=>t4,getSeedsCount:()=>uE,getStructureSeedAssignments:()=>nl,getTeamLineUp:()=>og,getValidGroupSizes:()=>KP,isAdHoc:()=>ns,isCompletedStructure:()=>yh,isValidForQualifying:()=>_4,positionActions:()=>A4});function S4({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:c,allEntries:d,winsLimit:p,event:f}){var h,m,g,v,y;if(!s)return{error:nt};let b=[at,An];i&&b.push(vt);let I=f!=null&&f.eventType?{matchUpTypes:[f.eventType]}:void 0,T=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&f?((h=cf({contextFilters:{stages:b},matchUpFilters:I,tournamentRecord:o,inContext:!0,event:f}))==null?void 0:h.matchUps)??[]:((m=po({contextFilters:{stages:b},matchUpFilters:T,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:m.matchUps)??[],S=vb({stage:jr,drawDefinition:s}).map(({participantId:j})=>j),U={},P={},E={},D={};r||(r=sf({policyTypes:[AB],tournamentRecord:o,drawDefinition:s,event:f}).policyDefinitions);let R=r==null?void 0:r[AB];t=t.length&&t||(R==null?void 0:R.excludedMatchUpStatuses)||[],e=e??(R==null?void 0:R.includeEventParticipants),d=d??(R==null?void 0:R.allEntries),n=n??(R==null?void 0:R.finishingRoundLimit),a=a??(R==null?void 0:R.roundNumberLimit),l=l??(R==null?void 0:R.matchUpsLimit),u===void 0&&(u=(R==null?void 0:R.requirePlay)!==void 0?R.requirePlay:!0),c===void 0&&(c=(R==null?void 0:R.requireLoss)!==void 0?R.requireLoss:!0),p=p??(R==null?void 0:R.winsLimit);for(let j of w){if(u&&j.winningSide&&![1,2].includes(j.winningSide)&&j.matchUpStatus!==nr||j.finishingRound&&n&&j.finishingRound>=n||j.finishingRound&&a&&j.finishingRound<=a)continue;let V=(g=j.sides)==null?void 0:g.find(({sideNumber:z})=>j.winningSide&&z===3-j.winningSide),H=(v=j.sides)==null?void 0:v.find(({sideNumber:z})=>j.winningSide&&z===j.winningSide);if((y=j.sides)==null||y.forEach(z=>{var q;let W=(q=z==null?void 0:z.participant)==null?void 0:q.participantId;W&&(E[W]=z.participant,j.matchUpStatus===nr&&!u&&(P[W]=z.participant,U[W]||(U[W]=0),(!j.matchUpStatus||!t.includes(j.matchUpStatus))&&(U[W]+=1)))}),V==null?void 0:V.participant){let z=V.participant.participantId;P[z]=V.participant,U[z]||(U[z]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(U[z]+=1)}if(H!=null&&H.participant){let z=H.participant.participantId;D[z]||(D[z]=0),D[z]+=1,U[z]||(U[z]=0),j.matchUpStatus&&!t.includes(j.matchUpStatus)&&(U[z]+=1)}}let N=(o==null?void 0:o.participants)&&!u&&!c&&d,M=N?((e&&f?f.entries:s.entries)??[]).filter(j=>![xp,ru].includes(j.entryStatus)).map(({participantId:j})=>j):[],A=Object.keys(P),_=N?((o==null?void 0:o.participants)??[]).filter(({participantId:j})=>M.includes(j)):c&&Object.values(P)||Object.values(E),k=j=>!c||A.includes(j),B=j=>!u||(U[j]||0)>=0,F=j=>!p||(D[j]||0)<=p,x=j=>!l||U[j]<=l,$=j=>!S.includes(j);return{eligibleParticipants:_.filter(j=>k(j.participantId)&&B(j.participantId)&&F(j.participantId)&&x(j.participantId)&&$(j.participantId)).map(j=>{var V;return{...j,individualParticipants:(V=j.individualParticipantIds)==null?void 0:V.map(H=>{var z;return(z=o==null?void 0:o.participants)==null?void 0:z.find(q=>q.participantId===H)})}}),losingParticipantIds:A,...ae}}function kO(t){var e,i,n,r,a,o,s,l;let u=wi(t,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:c,roundNumber:d}=t,p=t.structureId??(((e=c.structures)==null?void 0:e.length)===1&&((n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof p!="string")return{error:Ts};let f=(r=c.structures)==null?void 0:r.find(w=>w.structureId===p);if(!f)return{error:Tn};let h,m=(a=f.matchUps??[])==null?void 0:a.reduce((w,S)=>(S.roundPosition&&(h=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(f.structures||h||f.finishingPosition===mb)return{error:lb};let g=((o=c==null?void 0:c.entries)==null?void 0:o.filter(w=>{let S=w.entryStatus;return au.includes(S)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??m??1,b=((l=(s=f.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,I=v-b,T=I>0?I:0;return{...ae,availableMatchUpsCount:T,lastRoundNumber:m,roundMatchUpsCount:v}}function T4({drawDefinition:t}){var e;let i=qt({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function HGe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:nt};let n=fr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=ut(n.matchUps,!1,!0),a=Ht(r.reduce((s,l)=>s.concat(...l.sides.map(u=>u.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(u=>u.sides.map(c=>c.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function U4({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:nt};let{participantIds:n,participantIdMatchUps:r}=HGe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[Zn,Di].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),f=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&f)===f?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),u=d=>Math.abs(d[0]-d[1]),c=l.reduce((d,p)=>d&&u(d)<u(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:c}}}))||[];return Object.assign({},...a)}function qh({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:Oe};if(!n)return{error:Ku};if(!e&&t){if(typeof i!="string"&&(i=rme({tournamentRecords:t,drawId:n}),!i))return{error:bw};if(e=t[i],!e)return{error:Oe}}let r=e&&vo({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ae}:ue({result:{error:Qo},stack:"findDrawDefinition"})}function D4(t){let{drawDefinition:e,error:i}=qh(t);return i?{error:i}:{drawDefinition:ut(e)}}function KB({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=pS({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:u}=Pt({structureId:l,drawDefinition:i});if(!(e&&(u==null?void 0:u.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var zGe="qualifierDrawPositionAssignment",qGe="withdrawParticipantAtDrawPosition",WGe="alternateDrawPositionAssignment",KGe="luckyLoserDrawPositionAssignment",OK="removeDrawPositionAssignment",YGe="swapDrawPositionAssignments",ZGe="modifyPairAssignment",XGe="modifyParticipantOtherName",xK="assignDrawPosition",JGe="removeSeededParticipant",QGe="assignDrawPositionBye",eHe="modifySeedAssignment",gme="addPenalty",P4="MODIFY_PAIR",OO="QUALIFIER",E4="ALTERNATE",C4="WITHDRAW",vy="ASSIGN",YB="REMOVE",R4="LUCKY",BT="REMOVE_SEED",M4="SWAP",n1="NICKNAME",Lv="SEED_VALUE",yy="PENALTY",RN="BYE",tHe={MODIFY_PAIR_ASSIGNMENT:P4,QUALIFYING_PARTICIPANT:OO,ALTERNATE_PARTICIPANT:E4,WITHDRAW_PARTICIPANT:C4,ASSIGN_PARTICIPANT:vy,LUCKY_PARTICIPANT:R4,REMOVE_ASSIGNMENT:YB,SWAP_PARTICIPANTS:M4,ADD_NICKNAME:n1,REMOVE_SEED:BT,ADD_PENALTY:yy,ASSIGN_BYE:RN,SEED_VALUE:Lv};function iHe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[ru,xg].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=n.individualParticipantIds,u=e?t.filter(({participantId:d})=>s.includes(d)):void 0,c=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:ft({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:ZGe,availableIndividualParticipantIds:s,availableIndividualParticipants:u,existingIndividualParticipantIds:l,existingIndividualParticipants:c,type:P4},!1,!1,!0)}}return{}}function ug(t){var e,i;let{inContextDrawMatchUps:n,targetData:r,drawDefinition:a,relevantLink:o}=t;if((o==null?void 0:o.linkCondition)===Nd&&((e=r==null?void 0:r.matchUp)==null?void 0:e.matchUpStatus)===Di)return!1;let{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:u}=r,c=[bi,Ni].includes(s==null?void 0:s.matchUpStatus),d=((i=l==null?void 0:l.drawPositions)==null?void 0:i.filter(Boolean).length)||0;if(s!=null&&s.winningSide&&!c||l!=null&&l.winningSide&&d===2&&(!l.feedRound||![Ni,bi].includes(l==null?void 0:l.matchUpStatus)))return!0;let p=s&&io({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),f=l&&io({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),h=p&&ug({relevantLink:u==null?void 0:u.loserTargetLink,targetData:p,inContextDrawMatchUps:n,drawDefinition:a});return!!(f&&ug({targetData:f,inContextDrawMatchUps:n,drawDefinition:a})||h)}var vme={[Mp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[vt,at],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[n1,yy,OO,Lv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},AR="positionAction",ZB="matchUpAction";function yme({actionType:t=AR,appliedPolicies:e,drawDefinition:i,structure:n}){var r,a;let o=t===AR&&Mp||t===ZB&&Vr,s=t===AR&&vme||t===ZB&&Xfe,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),u=((a=(r=i.links)==null?void 0:r.filter(f=>{var h;return((h=f==null?void 0:f.target)==null?void 0:h.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:a.map(({target:f})=>f.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=l||{},p=d==null?void 0:d.find(f=>{let{stages:h,stageSequences:m,structureTypes:g,feedProfiles:v}=f;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>u.includes(y)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:c,actionsDisabled:p,actionsPolicy:l}}function LK({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function bme({enabledStructures:t,drawDefinition:e,structure:i}){var n,r;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((r=(n=e.links)==null?void 0:n.filter(u=>{var c;return((c=u==null?void 0:u.target)==null?void 0:c.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:r.map(({target:u})=>u.feedProfile))||[];return{policyActions:t.find(u=>{let{stages:c,stageSequences:d,structureTypes:p,feedProfiles:f}=u||{},h=!(c!=null&&c.length)||Array.isArray(c)&&c.includes(a),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(f!=null&&f.length)||Array.isArray(f)&&f.some(y=>l.includes(y));return m&&g&&v&&u&&h})}}function To({action:t,policyActions:e}){var i;let n=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n}var Ime="replaceTieMatchUpParticipantId",wme="assignTieMatchUpParticipantId",XB="removeTieMatchUpParticipantId",FK="assignMatchUpSideParticipant",nHe="removeMatchUpSideParticipant",Sme="substituteParticipant",JB="REMOVE_SUBSTITUTION",Tme="REPLACE_PARTICIPANT",N4="REMOVE_PARTICIPANT",QB="setMatchUpStatus",e$="SUBSTITUTION",Ume="SCHEDULE",rHe="PENALTY",t$="REFEREE",Dme="STATUS",i$="START",Pme="SCORE",n$="END",aHe={REPLACE_TEAM_POSITION_METHOD:Ime,ASSIGN_TEAM_POSITION_METHOD:wme,REMOVE_TEAM_POSITION_METHOD:XB,REPLACE_PARTICIPANT:Tme,SUBSTITUTION_METHOD:Sme,REMOVE_SUBSTITUTION:JB,REMOVE_PARTICIPANT:N4,SCHEDULE_METHOD:QB,SUBSTITUTION:e$,SCHEDULE:Ume,PENALTY:rHe,REFEREE:t$,STATUS:Dme,SCORE:Pme,START:i$,END:n$};function oHe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:c,drawId:d,side:p}){var f,h,m,g,v,y,b,I,T,w,S,U,P,E,D;let R=[],N=(f=r.sides)==null?void 0:f.find(Z=>Z.participant),M=r.gender===Ho&&r.sideNumber&&((h=r.sides)==null?void 0:h.filter(Z=>Z.particiapntId).length)===1&&((g=(m=N==null?void 0:N.participant)==null?void 0:m.person)==null?void 0:g.sex),A=r.matchUpType,_=(o??((v=n==null?void 0:n.participants)==null?void 0:v.enforceGender))!==!1?r.gender:void 0,k=(b=(y=r.sides)==null?void 0:y.flatMap(Z=>{var X;return((X=Z.participant)==null?void 0:X.individualParticipants)||Z.participant}).filter(Boolean))==null?void 0:b.map(ei),B=(I=r.sides)==null?void 0:I.filter(Z=>!l||Z.sideNumber===l).flatMap(Z=>{var X;return((X=Z.participant)==null?void 0:X.individualParticipants)||Z.participant}).filter(Boolean),F=B==null?void 0:B.map(ei),x=(w=(T=e==null?void 0:e.find(Z=>Z.matchUpId===r.matchUpTieId))==null?void 0:T.sides)==null?void 0:w.map(Z=>{var X;return(X=Z.participant)==null?void 0:X.individualParticipants.filter(({participantId:Q,person:ce})=>!(F!=null&&F.includes(Q))&&(!_||_===Uc||ce.sex===_||_===Ho&&!M||M&&ce.sex!==M))}),$=l?x==null?void 0:x[l-1]:x==null?void 0:x.map((Z,X)=>({participants:Z,sideNumber:X+1})),j=l?(S=x==null?void 0:x[l-1])==null?void 0:S.map(ei):x==null?void 0:x.map((Z,X)=>({participants:Z==null?void 0:Z.map(ei),sideNumber:X+1})),V=l&&(xn(kv)(A)&&!(F!=null&&F.length)||xn(ig)(A)&&((F==null?void 0:F.length)??0)<2)||!l&&(xn(kv)(A)&&((F==null?void 0:F.length)??0)<2||xn(ig)(A)&&((F==null?void 0:F.length)??0)<4),H=j==null?void 0:j.filter(Z=>!(k!=null&&k.includes(Z))),z=$==null?void 0:$.filter(({participantId:Z})=>H.includes(Z));if(V&&H!=null&&H.length&&R.push({availableParticipantIds:H,method:wme,availableParticipants:z,type:vy,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:d}}),F!=null&&F.length&&(!Jr(c)||(U=p==null?void 0:p.substitutions)!=null&&U.length)&&R.push({method:XB,type:N4,existingParticipantIds:F,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),z!=null&&z.length&&(!l&&F!=null&&F.length||l&&p!=null&&p.participant)&&R.push({availableParticipantIds:H,method:Ime,availableParticipants:z,type:Tme,existingParticipantIds:F,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),To({policyActions:a,action:JB})&&((P=p==null?void 0:p.substitutions)==null?void 0:P.length)){let Z=((E=p.participant)==null?void 0:E.participantType)===ti&&[p.participantId]||((D=p.participant)==null?void 0:D.participantType)===xt&&p.participant.individualParticipantIds||[],X=p.substitutions.map(Q=>Q.participantId).filter(Q=>Z.includes(Q));(!s||X.includes(s))&&R.push({method:XB,type:JB,substitutedParticipantIds:X,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let q=t==null?void 0:t[Vr],W=q==null?void 0:q.substituteWithoutScore,Y=q==null?void 0:q.substituteAfterCompleted;if(To({policyActions:a,action:e$})&&i.length===2&&(!l&&F!=null&&F.length||l&&p!=null&&p.participant)&&(W||Jr(c))&&(Y||c.matchUpStatus&&!kr.includes(c.matchUpStatus))&&B!=null&&B.length&&$.length){let Z=B.map(ei);R.push({info:"list of team players available for substitution",method:Sme,availableParticipantIds:j,existingParticipantIds:Z,availableParticipants:$,existingParticipants:B,type:e$,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:d}})}return R}function sHe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:c,drawId:d,event:p}){var f,h,m,g,v;if(i.includes(s))return{};let y=(f=l.find(R=>R.type===vy))==null?void 0:f.availableParticipantIds,b=(h=a==null?void 0:a[Mp])==null?void 0:h.otherFlightEntries,I=(m=a==null?void 0:a[Mp])==null?void 0:m.restrictQualifyingAlternates,T=(o.entries??[]).filter(({entryStage:R})=>!I||(c.stage===vt?R===vt:R!==vt)).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:R})=>R).filter(Boolean),{allPositionedParticipantIds:w}=Qpe({drawDefinition:o}),S=n.map(R=>R.participantId).filter(Boolean),U=T.filter(R=>c.stage&&[vt,at,An].includes(c.stage)?!(w!=null&&w.includes(R)):!S.includes(R)),P=((p==null?void 0:p.entries)??[]).filter(R=>R.entryStatus===xl&&Eme({restrictQualifyingAlternates:I,structure:c,entry:R})&&(c.stage&&[vt,at,An].includes(c.stage)?!(w!=null&&w.includes(R.participantId)):!S.includes(R.participantId))).sort((R,N)=>(R.entryPosition??1/0)-(N.entryPosition??1/0)).map(R=>R.participantId),E=Ht(U.concat(P));if(b){let R=(v=(g=p?Hn({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(M=>M.participantId&&![xp,ru,xg].includes(M.entryStatus)&&!T.includes(M.participantId)).map(({participantId:M})=>M)).flat().filter(Boolean);R!=null&&R.length&&E.push(...R)}y!=null&&y.length&&(E=E.filter(R=>!y.includes(R)));let D=r?t==null?void 0:t.filter(R=>E.includes(R.participantId)):void 0;return D==null||D.forEach(R=>{let N=(o.entries??[]).find(M=>M.participantId===R.participantId);R.entryPosition=N==null?void 0:N.entryPosition}),D==null||D.sort((R,N)=>(R.entryPosition||1/0)-(N.entryPosition||1/0)),E.length?{validAlternatesAction:ft({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:e,method:WGe,availableAlternatesParticipantIds:E,type:E4,availableAlternates:D})}:{}}function Eme({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===vt&&!t||i.entryStage===at&&n===ha)return!0}function lHe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===xl&&Eme({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(ei)}function uHe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:c,event:d}){var p,f,h,m,g;let v=[],y=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:D})=>D===u.roundNumber),b=((p=r==null?void 0:r.entries)==null?void 0:p.filter(({entryStatus:D})=>D&&Lg.includes(D)).map(ei))??[],I=y.map(D=>(D.sides??[]).flatMap(ei)).flat().filter(Boolean),T=b.filter(D=>!i.includes(D)&&(!t||!I.includes(D))),w=e==null?void 0:e.filter(D=>T==null?void 0:T.includes(D.participantId)).map(D=>ut(D,void 0,!0));w==null||w.forEach(D=>{let R=(r.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=R==null?void 0:R.entryPosition}),T.length&&v.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:FK,type:vy,availableParticipantIds:T,participantsAvailable:w});let S=(d==null?void 0:d.entries)??[],U=lHe({eventEntries:S,structure:l}),P=Ht(b.concat(U));if(n){let D=(h=(f=d?Hn({event:d}):void 0)==null?void 0:f.flights)==null?void 0:h.filter(R=>R.drawId!==c).flatMap(R=>R.drawEntries.filter(N=>N.participantId&&![xp,ru,xg].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);D!=null&&D.length&&P.push(...D)}P=P.filter(D=>!i.includes(D)&&!T.includes(D)&&(!t||!I.includes(D)));let E=e==null?void 0:e.filter(D=>P.includes(D.participantId)).map(D=>ut(D,void 0,!0));return E==null||E.forEach(D=>{let R=(r.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=R==null?void 0:R.entryPosition}),E==null||E.sort((D,R)=>(D.entryPosition||1/0)-(R.entryPosition||1/0)),P.length&&v.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:P,participantsAvailable:E,method:FK,type:xl}),!Jr(u)&&o&&(g=(m=u.sides)==null?void 0:m.find(D=>D.sideNumber===o))!=null&&g.participantId&&v.push({payload:{drawId:c,matchUpId:s,structureId:a,sideNumber:o},method:nHe,type:N4}),v}function xO(t){var e,i,n,r,a,o,s,l,u;if(!t)return{error:Se};let{drawDefinition:c,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:f,enforceGender:h,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&mo(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:Oe};if(!v||!mo(v))return{error:va};if(g&&![1,2].includes(g))return ue({result:{error:Se},context:{sideNumber:g}});if(!c){let se=(Xr({tournamentRecord:y}).matchUps??[]).find(fe=>fe.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(fe=>fe.eventId===(se==null?void 0:se.eventId));let pe=((d==null?void 0:d.drawDefinitions)??[]).find(fe=>fe.drawId===(se==null?void 0:se.drawId));pe&&(c=pe)}if(!c)return{error:nt};let b=jn({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:I}=c,{matchUp:T,structure:w}=on({drawDefinition:c,matchUpId:v,event:d});if(!T)return{error:Da};let S=Ai({tournamentRecord:y,drawDefinition:c,structure:w,event:d}).appliedPolicies??{};Object.assign(S,f??{});let U=(i=S==null?void 0:S[Mp])==null?void 0:i.otherFlightEntries,P=(S==null?void 0:S[Vr])??mS[Vr],{enabledStructures:E}=yme({actionType:ZB,appliedPolicies:S,drawDefinition:c,structure:w}),{policyActions:D}=bme({enabledStructures:E,drawDefinition:c,structure:w}),R=t.matchUpsMap??ya({drawDefinition:c}),N=t.inContextDrawMatchUps??fr({tournamentParticipants:b,inContext:!0,drawDefinition:c,matchUpsMap:R,event:d}).matchUps,M=N==null?void 0:N.find(se=>se.matchUpId===v),A=g&&((n=M==null?void 0:M.sides)==null?void 0:n.find(se=>se.sideNumber===g)),_=((r=M==null?void 0:M.sides)==null?void 0:r.map(se=>{var pe;return se.participantId||((pe=se.participant)==null?void 0:pe.participantid)}).filter(Boolean))??[],{assignedPositions:k,allPositionsAssigned:B}=Or({structure:w}),{structureId:F}=w??{},x=[];if(!F)return{validActions:x};let $=ns({structure:w}),j=T.collectionId;if($&&!j){let se=uHe({restrictAdHocRoundParticipants:p,tournamentParticipants:b,matchUpParticipantIds:_,otherFlightEntries:U,drawDefinition:c,structureId:F,sideNumber:g,matchUpId:v,structure:w,matchUp:T,drawId:I,event:d});x.push(...se)}let V=yh({drawDefinition:c,structure:w}),H=k==null?void 0:k.filter(se=>se.participantId).map(se=>se.drawPosition),z=k==null?void 0:k.filter(se=>se.bye).map(se=>se.drawPosition),q=T.matchUpStatus===Di||!j&&((a=T.drawPositions)==null?void 0:a.reduce((se,pe)=>(z==null?void 0:z.includes(pe))||se,!1));if(q)return{validActions:x,isByeMatchUp:q};To({policyActions:D,action:t$})&&x.push({type:t$,payload:{matchUpId:v}});let W=!jP({matchUpStatus:T.matchUpStatus}),Y=(o=S==null?void 0:S.scoring)==null?void 0:o.structures,Z=(w==null?void 0:w.stage)&&(Y==null?void 0:Y.stage)&&(Y==null?void 0:Y.stage[w.stage]),X=(w==null?void 0:w.stageSequence)&&(Z==null?void 0:Z.stageSequence)&&Z.stageSequence[w.stageSequence],Q=!((s=S==null?void 0:S.scoring)!=null&&s.requireAllPositionsAssigned||Z!=null&&Z.requireAllPositionsAssigned||X!=null&&X.requireAllPositionsAssigned)||B,ce=T.sides&&T.sides.filter(se=>se==null?void 0:se.participantId).length===2,J=T.matchUpStatus&&[nr,Ir].includes(T.matchUpStatus),ee=io({inContextDrawMatchUps:N,drawDefinition:c,matchUpId:v}),ne=ug({inContextDrawMatchUps:N,drawDefinition:c,targetData:ee}),ie=(((l=M==null?void 0:M.drawPositions)==null?void 0:l.length)===2&&M.drawPositions.every(se=>H==null?void 0:H.includes(se))&&((u=M==null?void 0:M.sides)==null?void 0:u.length)===2&&M.sides.every(({participantId:se})=>se)||ce)&&!(J&&ne),oe={method:gme,type:yy,payload:{drawId:I,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(W&&x.push({payload:{drawId:I,matchUpId:v,schedule:{}},method:QB,type:Ume}),To({policyActions:D,action:yy})&&(A!=null&&A.participant||!g&&_!=null&&_.length)&&x.push(oe),W&&ie&&x.push({type:Dme}),Q&&ie){let{matchUpId:se,matchUpFormat:pe}=T,fe={drawId:I,matchUpId:se,matchUpFormat:pe,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};x.push({info:"set outcome and winningSide",method:QB,type:Pme,payload:fe}),To({policyActions:D,action:i$})&&x.push({type:i$}),To({policyActions:D,action:n$})&&x.push({type:n$})}if(j&&M){let se=oHe({specifiedPolicyDefinitions:f,inContextDrawMatchUps:N,matchUpParticipantIds:_,matchUpActionsPolicy:P,inContextMatchUp:M,policyActions:D,enforceGender:h,participantId:m,sideNumber:g,matchUpId:v,matchUp:T,drawId:I,side:A});x.push(...se)}return{structureIsComplete:V,validActions:x,isDoubleExit:J,...ae}}function cHe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:c,event:d}){var p,f,h,m,g,v,y;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:b,targetStructureIds:I}=((p=o.links)==null?void 0:p.reduce((U,P)=>{var E,D;let R=(E=P.source)==null?void 0:E.structureId,N=(D=P.target)==null?void 0:D.structureId;return U.sourceStructureIds.includes(R)||U.sourceStructureIds.push(R),U.targetStructureIds.includes(N)||U.targetStructureIds.push(N),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},T=[],w=((f=o.links)==null?void 0:f.filter(U=>{var P;return((P=U.target)==null?void 0:P.structureId)===u.structureId}))??[];for(let U of w){let P=(h=U==null?void 0:U.source)==null?void 0:h.structureId,{structure:E}=Pt({structureId:P,drawDefinition:o}),D=(E==null?void 0:E.finishingPosition)===mb&&((b==null?void 0:b.length)!==1||(I==null?void 0:I.length)!==1),R={};if(D){let{matchUps:A}=Ci({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:_}=gy({drawPosition:s,matchUps:A}),k=(v=(g=(m=o.links)==null?void 0:m.find(B=>{var F;return((F=B.target)==null?void 0:F.structureId)===(u==null?void 0:u.structureId)&&B.target.roundNumber===_}))==null?void 0:g.source)==null?void 0:v.roundNumber;R.roundNumbers=[k]}let{completedMatchUps:N}=bO({structureId:P,inContext:!0,matchUpFilters:R,drawDefinition:o}),M=a.map(A=>A.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==Rr||A===Rr)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(ei).filter(A=>A&&!M.includes(A)))==null||y.forEach(A=>{T.includes(A)||T.push(A)})}let S=t==null?void 0:t.filter(U=>T==null?void 0:T.includes(U.participantId));return S==null||S.forEach(U=>{let P=(o.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=P==null?void 0:P.entryPosition}),T!=null&&T.length?{validLuckyLosersAction:{type:R4,method:KGe,availableLuckyLosers:S,availableLuckyLoserParticipantIds:T,willDisableLinks:i,payload:{drawId:c,structureId:l,drawPosition:s}}}:{}}function dHe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:c,isByePosition:d,drawPosition:p,structureId:f,event:h}){var m,g,v;let{drawId:y}=u,b=[],I,T,w=[],S=(g=(m=l==null?void 0:l[Dl])==null?void 0:m.validSeedPositions)==null?void 0:g.ignore;if(S||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:T,unfilledPositions:w}=che({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:c,structureId:f,event:h})),w!=null&&w.length||(w=o.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||b.push({payload:{drawId:y,structureId:f,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:QGe,type:RN}),a&&S){let U=o.map(N=>N.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:E}=fS({inContext:!0,matchUpFilters:P,drawDefinition:u}),D=Ht((v=(E??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==Rr||N===Rr))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(ei)).flat().filter(N=>N&&!U.includes(N))),R=s?r==null?void 0:r.filter(N=>D==null?void 0:D.includes(N.participantId)).map(N=>ut(N,void 0,!0)):void 0;return R==null||R.forEach(N=>{let M=(u.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=M==null?void 0:M.entryPosition}),R!=null&&R.length&&b.push(ft({payload:{drawId:y,structureId:f,drawPosition:p},willDisableLinks:i,method:xK,type:vy,availableParticipantIds:D,participantsAvailable:R})),{validAssignmentActions:b}}if(w.includes(p)||d){let U;if(T!=null&&T.length){let E=T.filter(D=>I==null?void 0:I.includes(D.participantId));E.sort(pHe),U=E.map(D=>D.participantId)}else U=e;let P=s?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>ut(E,void 0,!0)):void 0;P!=null&&P.length&&b.push(ft({payload:{drawId:y,structureId:f,drawPosition:p},willDisableLinks:i,method:xK,type:vy,availableParticipantIds:U,participantsAvailable:P}))}return{validAssignmentActions:b}}function pHe(t,e){return t.bye||xw(t.seedValue)<xw(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function fHe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,c,d;let p=[],f=[],h=[],m=[],g=i.map(U=>U.participantId).filter(Boolean),v=r==null?void 0:r[Mp],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],b=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:T}=KB({targetRoundNumber:y,linkType:kp,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&m.push(...I);let{sourceStructureIds:w,relevantLinks:S}=KB({targetRoundNumber:y,linkType:_p,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&m.push(...w);for(let U of T){let P=(u=a.structures)==null?void 0:u.find(D=>D.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==vt)continue;let E=yh({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let D=P.qualifyingRoundNumber,{matchUps:R}=Ci({matchUpFilters:{roundNumbers:[D],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let N of R){let M=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===Di&&((c=N.sides)==null?void 0:c.find(({participantId:_})=>_));if(M||A){let{participantId:_,participant:k}=M||A||{};_&&!g.includes(_)&&(k&&n&&p.push(k),f.push(_))}}}}for(let U of S){let P=(d=a.structures)==null?void 0:d.find(D=>D.structureId===U.source.structureId);if((P==null?void 0:P.stage)!==vt)continue;let E=yh({structureId:U.source.structureId,drawDefinition:a});if(!b||E){let{positionAssignments:D}=Hi({structure:P}),R=(D==null?void 0:D.map(N=>{var M;let A=N.participantId,_=(M=qt({element:N,name:fh}).extension)==null?void 0:M.value;return _?{participantId:A,groupOrder:_==null?void 0:_.groupOrder}:{}}).filter(({groupOrder:N,participantId:M})=>N===1&&!g.includes(M)).map(({participantId:N})=>N))??[];if(R&&f.push(...R),n){let N=e.filter(({participantId:M})=>R.includes(M));p.push(...N)}}}return f.length&&h.push(ft({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:zGe,type:OO,qualifyingParticipantIds:f,qualifyingParticipants:n?p:void 0})),{validAssignmentActions:h,sourceStructureIds:m}}function hHe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:c,structureId:d,structure:p,drawId:f,event:h}){if(r.includes(c))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==c&&!(u&&s.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=Ci({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),I=b.filter(({drawPositions:E})=>eo(E,y)),T=Object.assign({},...I.map(E=>{var D;return(D=E.sides)==null?void 0:D.filter(({sourceDrawPositionRange:R})=>R).map(({drawPosition:R,sourceDrawPositionRange:N})=>({[R]:N}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),P=v.map(E=>{let D=U==null?void 0:U[E.participantId],R=T[E.drawPosition];return ft({...E,participant:o?ut(D,!1,!0):void 0,sourceDrawPositionRange:R})});return P.length?{validSwapAction:{payload:{drawId:f,structureId:d,drawPositions:[c]},willDisableLinks:e,method:YGe,type:M4,availableAssignments:P}}:{}}function A4(t){var e;let i=wi(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=t,c=t.tournamentParticipants??(o&&jn({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=Pt({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Tn};let f=p.structureId;if(d=GP({drawDefinition:s,structureId:f}),l===void 0&&!d.isAdHoc)return{error:W0};if(d.isAdHoc)return xO(t);if(d.error)return d;let{drawPositionInitialRounds:h,inactiveDrawPositions:m,activeDrawPositions:g,byeDrawPositions:v}=d,y=Ai({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(y,n??{});let{actionsPolicy:b,enabledStructures:I,actionsDisabled:T}=yme({actionType:AR,appliedPolicies:y,drawDefinition:s,structure:p}),w=(b==null?void 0:b.activePositionOverrides)||[],{sourceStructureIds:S}=KB({finishingPosition:sS,targetRoundNumber:1,linkType:_p,drawDefinition:s,structureId:f})||{},U;S!=null&&S.length&&(U=S.reduce((Y,Z)=>yh({structureId:Z,drawDefinition:s})&&Y,!0));let P=S.length,E=S.length&&!U,{policyActions:D}=bme({enabledStructures:I,drawDefinition:s,structure:p}),R=![vt,at].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,M=[],{assignedPositions:A,positionAssignments:_}=Or({structure:p}),k=A==null?void 0:A.find(Y=>Y.drawPosition===l);if(!((e=_==null?void 0:_.map(Y=>Y.drawPosition))!=null&&e.includes(l)))return{error:q0};let{stage:B,stageSequence:F}=p,x=[B];B===ha&&x.push(at),B===at&&x.push(ha);let $=vb({entryStatuses:Lg,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:f,stages:x}),j=Gg({drawDefinition:s,stages:x}).assignedParticipantIds??[],V=$.filter(Y=>!j.includes(Y.participantId)).map(Y=>Y.participantId),H=v.includes(l),z=g.includes(l);if(T)return{hasPositionAssigned:!!k,info:"Actions Disabled for structure",isActiveDrawPosition:z,isDrawPosition:!0,validActions:[],isByePosition:H};if(To({policyActions:D,action:vy})&&!z&&_&&!E&&(!k||H)){let{validAssignmentActions:Y}=dHe({positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:R,isWinRatioFedStructure:P,tournamentParticipants:c,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,isByePosition:H,drawPosition:l,structureId:f,event:u});Y==null||Y.forEach(Z=>M.push(Z))}if(To({policyActions:D,action:OO})){let{validAssignmentActions:Y}=fHe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:f,drawId:N});Y==null||Y.forEach(Z=>M.push(Z))}let{participantId:q}=k||{},W=q&&c.find(Y=>Y.participantId===q);if(k){To({policyActions:D,action:YB})&&!z&&(M.push({type:YB,method:OK,payload:{drawId:N,structureId:f,drawPosition:l},willDisableLinks:R}),H||M.push({type:C4,method:qGe,payload:{drawId:N,structureId:f,drawPosition:l},willDisableLinks:R}),To({policyActions:D,action:RN})&&!H&&M.push({type:RN,method:OK,payload:{drawId:N,structureId:f,drawPosition:l,replaceWithBye:!0},willDisableLinks:R}));let Y=p.stage===vt||p.stage===at&&p.stageSequence===1;if(!H&&LK({activePositionOverrides:w,activeDrawPositions:g,action:Lv})&&To({policyActions:D,action:Lv})&&UN({drawDefinition:s,structureId:f,drawPosition:l})&&Y){let{seedAssignments:Z}=nl({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:X,seedValue:Q}=(Z==null?void 0:Z.find(ce=>ce.participantId===q))??{};M.push({type:Lv,method:eHe,participant:W,seedNumber:X,payload:{drawId:N,structureId:f,participantId:q,seedValue:Q}})}if(!H&&LK({activePositionOverrides:w,activeDrawPositions:g,action:BT})&&To({policyActions:D,action:BT})&&UN({drawDefinition:s,structureId:f,drawPosition:l})&&Y){let{seedAssignments:Z}=nl({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:X}=(Z==null?void 0:Z.find(Q=>Q.participantId===q))??{};M.push({method:JGe,type:BT,participant:W,seedNumber:X,payload:{participantId:q,structureId:f,drawId:N}})}if(!H&&q){if(To({policyActions:D,action:yy})){let Z={type:yy,method:gme,participant:W,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};M.push(Z)}if(To({policyActions:D,action:n1})){let Z={type:n1,method:XGe,participant:W,payload:{participantId:q,otherName:void 0}};M.push(Z)}}if(To({policyActions:D,action:M4})){let{validSwapAction:Z}=hHe({possiblyDisablingAction:R,tournamentParticipants:c,inactiveDrawPositions:m,activeDrawPositions:g,positionAssignments:_,returnParticipants:r,byeDrawPositions:v,drawDefinition:s,isByePosition:H,drawPosition:l,structureId:f,structure:p,drawId:N});Z&&M.push(Z)}}if(To({policyActions:D,action:E4})&&!E){let{validAlternatesAction:Y}=sHe({possiblyDisablingAction:R,tournamentParticipants:c,positionAssignments:_,activeDrawPositions:g,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:M,structureId:f,structure:p,drawId:N,event:u});Y&&M.push(Y)}if(To({policyActions:D,action:R4})&&!E&&_){let{validLuckyLosersAction:Y}=cHe({sourceStructuresComplete:U,possiblyDisablingAction:R,isWinRatioFedStructure:P,tournamentParticipants:c,activeDrawPositions:g,positionAssignments:_,drawDefinition:s,drawPosition:l,structureId:f,structure:p,drawId:N});Y&&M.push(Y)}if((W==null?void 0:W.participantType)===xt&&To({policyActions:D,action:P4})){let{validModifyAssignedPairAction:Y}=iHe({tournamentParticipants:c,returnParticipants:r,drawPosition:l,participant:W,drawId:N,event:u});Y&&M.push(Y)}return{hasPositionAssigned:!!k,isActiveDrawPosition:z,isDrawPosition:!0,isByePosition:H,validActions:M,...ae}}function lE({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;let a=(n=t==null?void 0:t[fN])==null?void 0:n.drawTypeCoercion,o=(r=e==null?void 0:e[fN])==null?void 0:r.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function r1({tournamentRecord:t,drawDefinition:e,stage:i=at,structureId:n,structure:r}){var a;if(!t)return{error:Oe};if(!r&&!e)return{error:nt};if(!r&&!n&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:Ts};let{error:o,positionAssignments:s}=Hi({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r==null?void 0:r.structureId,error:o}}function _4({structureId:t,drawDefinition:e}){if(!e)return{error:nt};if(!mo(t))return{error:Se};let i=pS({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!$n([tg,Ml,oO,eg],n).length;return{...ae,valid:r}}function Cme({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Se};let i=Q0(t);return i?{drawSize:i}:ue({result:{error:Se},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function uE(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",u=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=sf({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return ue({result:h,stack:l});i=h.policyDefinitions}let c=At(u);if(u&&!c)return ue({result:{error:Se},context:{participantsCount:u},stack:l});if(r&&!c)return ue({result:{error:Ude},stack:l});if(isNaN(n))if(u)({drawSize:n}=Cme({participantsCount:u}));else return ue({result:{error:uP},stack:l});let d=r&&u||n;if(d&&d>n)return{error:Sq};let p=i==null?void 0:i[Dl];if(!p)return{error:fde};let f=p.seedsCountThresholds;return f?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:f.filter(h=>e?h.drawSize<=n:n===h.drawSize).reduce((h,m)=>u&&u>=m.minimumParticipantCount?m.seedsCount:h,0)}):{error:Jce}}function LO({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var l;if((!o||!r)&&i&&({participants:o,participantMap:r}=jn({tournamentRecord:i})),!o)return{error:pP};if(!Array.isArray(o))return{error:Se};if(!s)return{error:Oi};let u=(e==null?void 0:e[Vr])??(n==null?void 0:n[Vr])??mS[Vr],c=(a??((l=u==null?void 0:u.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,f=d===vh,h=d===rl&&qi||f&&xt||ti,m=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let b=mHe({participant:y,participantType:h,eventType:d,entryStatusMap:m}),I=gHe({genderEnforced:c,participantMap:r,eventGender:p,participant:y,isDoubles:f,mismatch:b});return b||!I});if(v.length){let y=v.map(b=>b.participantId);return{error:sde,invalidParticipantIds:y}}return{...ae,valid:!0}}function mHe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[vh,rl].includes(i)&&t.participantType===ti&&(vm(r)||r===xp);return t.participantType!==e&&!a}function gHe(t){var e,i,n;let{participant:r,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=t,c=!s&&l&&Ht(((e=r==null?void 0:r.individualParticipantIds)==null?void 0:e.map(h=>{var m,g,v;return(v=(g=(m=a==null?void 0:a[h])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(c!=null&&c.length)||Uc===o||[Ki,vn].includes(o)&&c[0]===o||Ho===o&&(c.length==1&&((i=r.individualParticipantIds)==null?void 0:i.length)===1||c.length===2),p=(n=r==null?void 0:r.person)==null?void 0:n.sex,f=!(r!=null&&r.person)||!o||[Uc,Ho].includes(o)||[Ki,vn].includes(o)&&p===o;return!u||d&&f}function Rme({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var a;let o="generateQualifyingSTructures",s=[],l=[],u=[],c=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,f=0,h,m=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];m=g.roundTarget||m;let y=1,b=0,I,T,w;for(let S of(v||[]).sort(c)){let U=kq(S.drawSize||S.participantsCount),{qualifyingRoundNumber:P,structureOptions:E,matchUpFormat:D,structureName:R,structureId:N,drawType:M}=S,A=S.matchUpType,_=S.qualifyingPositions||vHe({drawSize:U,qualifyingRoundNumber:P}),k,B,F;if(!At(U))return ue({result:{error:uP},stack:o});let x=t.length>1?`${m}-`:"",$=v.length>1||x?y:"",j=R||(x||$?`${ca(vt)} ${x}${$}`:ca(vt));if(M===Wl){let{structures:V,groupCount:H,maxRoundNumber:z}=WP({structureName:S.structureName||j,structureId:N||(r==null?void 0:r.pop()),stage:vt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:m,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=H,k=z,B=V[0],h=[1]}else({drawSize:U,matchUps:F,roundLimit:k}=Pc({qualifyingRoundNumber:P,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),B=$s({structureName:S.structureName||j,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:k,stage:vt,matchUpFormat:D,stageSequence:y,matchUpType:A,roundLimit:k,matchUps:F}),m&&hi({extension:{name:Oc,value:m},element:B}),b=((a=F==null?void 0:F.filter(V=>V.roundNumber===k))==null?void 0:a.length)||0;if(y>1){let{link:V}=JP({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:B.structureId,finishingPositions:w===_p?[1]:void 0,linkType:w});u.push(V),p+=(U||0)-b}else p+=U||0;w=M===Wl?_p:kp,T=B.structureId,I=k,l.push(B),y+=1}f+=b,s.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:h,roundTarget:m,linkType:w}),m+=1}return{qualifiersCount:f,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...ae,links:u}}function vHe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function Mme(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=Tt(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&uc||t.drawType||uc,a=Xpe.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=uc;else if(n<4&&i)return{...ue({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:Lk},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function yHe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:ca(at),...t,stage:at},{structures:a,groupCount:o,groupSize:s}=WP(r);if(o<1)return{error:jde};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:ca(An)}],[u]=a,{structures:c,links:d}=Ghe({sourceStructureId:u.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return c&&a.push(...c),{...ae,structures:a,links:d}}function bHe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((u,c)=>(c.drawPositions||[]).filter(Boolean).length&&!u.includes(c.roundNumber)?u.concat(c.roundNumber):u,[]),r=t.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),a=e.matchUps.reduce((u,c)=>!u||c.roundNumber>u?c.roundNumber:u,void 0),o=n.map((u,c)=>{let d=n.indexOf(u)%2?Ml:tg,p=1+c;return{linkType:Md,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:u,structureId:e.structureId}}}),s={linkType:kp,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Ml,roundNumber:r,structureId:t.structureId}},l=[{linkType:kp,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Ml,roundNumber:1,structureId:i.structureId}},{linkType:Md,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Ml,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function IHe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=bh({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Kf({structureName:t||ca(at),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:at,matchUpType:e,matchUps:s});o.push(l);let u=n/2,{matchUps:c}=bh({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Kf({structureName:ca(Zpe),matchUps:c,structureId:a==null?void 0:a.pop(),stage:ha,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=Pc({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),f=Kf({structureName:ca(Ype),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:An,matchUpType:e});o.push(f);let h=bHe({mainStructure:l,consolationStructure:d,deciderStructure:f});return{structures:o,links:h,...ae}}function wHe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!At(o)||o<2)return{matchUps:[],roundsCount:0};if($u(o))return Pc(t);let u=SHe(o),c=u.shift(),d=Je(1,((c==null?void 0:c.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],f=1;({matchUps:p}=EN({roundNumber:f,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),f++;let h=t.roundLimit||e;for(let g of u){let v=g.participantsCount/2,y=Je(1,v+1);n&&v===n&&(h=f-1);let b=y.map(I=>{let T=d4({roundPosition:I,roundNumber:f,idPrefix:a,uuids:l});return{roundPosition:I,roundNumber:f,matchUpId:T}});p.push(...b),f++}let m=f-1;return p=PP({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:m,roundLimit:h}}function SHe(t){let e=Tt(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function Nme(t){var e,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=at,matchUpType:o,drawSize:s,uuids:l}=t,u=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,c=t.structureId||u()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Ai(t),p=((e=t.policyDefinitions)==null?void 0:e[Ew])||(d==null?void 0:d[Ew]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let f=t.structureName??((i=n==null?void 0:n[0])==null?void 0:i.name)??ca(at),h=()=>{let{matchUps:m}=Pc(t);return{structures:[$s({stageSequence:r,structureName:f,matchUpType:o,structureId:c,matchUps:m,stage:a})],links:[],...ae}};return{generators:{[ql]:()=>({structures:[$s({finishingPosition:sS,stageSequence:r,structureName:f,matchUps:[],matchUpType:o,structureId:c,stage:a})],links:[],...ae}),[kg]:()=>{let{matchUps:m}=wHe(t);return{structures:[$s({stageSequence:r,structureName:f,matchUpType:o,structureId:c,matchUps:m,stage:a})],links:[],...ae}},[uc]:()=>h(),[SP]:()=>IHe(t),[Mw]:()=>_I({...t,roundOffsetLimit:3,playoffAttributes:n??cW}),[Nw]:()=>_I({...t,roundOffsetLimit:2,playoffAttributes:n??dW}),[An]:()=>_I(t),[oS]:()=>{let{matchUps:m}=bh({drawSize:s,uuids:l,matchUpType:o});return{structures:[$s({stageSequence:r,structureName:f,matchUpType:o,structureId:c,stage:at,matchUps:m})],links:[],...ae}},[TP]:()=>$he(t),[Aw]:()=>lv({...t,feedRounds:1,fmlc:!0}),[Kpe]:()=>lv({...t,feedRounds:1}),[sW]:()=>lv({...t,feedsFromFinal:1}),[lW]:()=>lv({...t,feedsFromFinal:2}),[uW]:()=>lv({...t,feedsFromFinal:3}),[UP]:()=>lv(t),[sO]:()=>jhe(t),[Wl]:()=>WP(t),[Ad]:()=>yHe(t)}}}function k4(t){var e,i,n,r,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:c,tieFormat:d,isMock:p,uuids:f}=t||{},h=Tt(t.drawSize),m=t.drawTypeCoercion??lE({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=Mme({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:m,drawSize:h});if(v.error)return v;let y=v.drawType,b=[],I=[],T=(t==null?void 0:t.matchUpType)??Pn,w=(e=c==null?void 0:c.structures)==null?void 0:e.filter(({stage:W})=>W===vt);w&&b.push(...w);let S=w==null?void 0:w.map(({structureId:W})=>W),U=(i=c==null?void 0:c.structures)==null?void 0:i.find(({stage:W,stageSequence:Y})=>W===at&&Y===1),P=(n=c==null?void 0:c.links)==null?void 0:n.filter(W=>W.target.structureId===(U==null?void 0:U.structureId)&&(S==null?void 0:S.includes(W.source.structureId))),E=(W,Y)=>{var Z;if(W.linkType===_p&&Y!=null&&Y.structures){let X=W.source.finishingPositions||[];return Y.structures.length*X.length}else if(W.linkType===kp&&(Z=Y==null?void 0:Y.matchUps)!=null&&Z.length){let X=W.source.roundNumber;return Y.matchUps.filter(({roundNumber:Q})=>Q===X).length}},D=w==null?void 0:w.map(W=>{var Y,Z,X;let Q=P==null?void 0:P.find(ie=>ie.target.structureId===W.structureId),ce=((Z=(Y=Hi({structure:W}))==null?void 0:Y.positionAssignments)==null?void 0:Z.length)??0;if(!Q)return ce;let J=Q==null?void 0:Q.source.structureId,ee=(X=c.structures)==null?void 0:X.find(ie=>ie.structureId===J),ne=E(Q,ee)||0;return ce-ne}).filter(Boolean).reduce((W,Y)=>W+Y,0),R=P==null?void 0:P.map(W=>{let Y=W.source.structureId,Z=w==null?void 0:w.find(X=>X.structureId===Y);return E(W,Z)}).filter(Boolean).reduce((W,Y)=>W+Y,0),N=!!(U&&!((r=U==null?void 0:U.matchUps)!=null&&r.length));if(w!=null&&w.length&&!N)return{error:CB};let M=!(w!=null&&w.length)&&t.qualifyingProfiles,A=(M==null?void 0:M.length)&&Rme({idPrefix:t.idPrefix,qualifyingProfiles:M,appliedPolicies:l,isMock:p,uuids:f});if(A!=null&&A.error)return A;let{qualifyingDrawPositionsCount:_,qualifyingDetails:k,qualifiersCount:B}=A||{qualifyingDrawPositionsCount:D,qualifiersCount:R};_&&(A!=null&&A.structures&&b.push(...A.structures),A!=null&&A.links&&I.push(...A.links)),Object.assign(t,ft({drawSize:h,matchUpType:T,tieFormat:d}));let F=y!==ql&&(!h||h<2||!u&&![oS,kg].includes(y)&&([Ad,Wl].includes(y)&&h<3||![Wl,Ad].includes(y)&&!$u(h)));if(F&&!_)return ue({context:{drawSize:h,invalidDrawSize:F},result:{error:Lk},stack:g});let{generators:x,error:$}=Nme(t);if($)return{error:$};let j=x[y];if(!j)return{error:sq};let V=j==null?void 0:j();if(V.error)return V;let{structures:H,links:z}=V;if(H!=null&&H.length){let W=H.find(({stage:Y,stageSequence:Z})=>Y===at&&Z===1);if(U&&W){if(N){let Y=W.structureId;if(W.structureId=U.structureId,z==null?void 0:z.length)for(let Z of z)Z.source.structureId===Y&&(Z.source.structureId=U.structureId),Z.target.structureId===Y&&(Z.target.structureId=U.structureId)}else if(!s)return{error:CB}}b.push(...H)}b.sort(gb),z!=null&&z.length&&I.push(...z);let q=V.structures.find(({stage:W,stageSequence:Y})=>W===at&&Y===1);for(let W of k||[]){let{finalQualifyingRoundNumber:Y,finalQualifyingStructureId:Z,roundTarget:X,finishingPositions:Q,linkType:ce}=W,J=q&&((a=JP({targetStructureId:q.structureId,sourceStructureId:Z,sourceRoundNumber:Y,finishingPositions:Q,targetEntryRound:X,linkType:ce}))==null?void 0:a.link);if(J!=null&&J.error)return J;J&&I.push(J)}return P&&I.push(...P),{...ae,qualifyingResult:{qualifyingDrawPositionsCount:_,qualifiersCount:B},structures:b,links:I}}function O4(t){var e,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ue({result:{error:nt},stack:o});let s=n?t.drawDefinition:ut(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=t;if(l){let T=Ao({tieFormat:l});if(T.error)return T}l=aa(l??((e=_a({drawDefinition:s}))==null?void 0:e.tieFormat)),u=u??(s.matchUpType||Pn),t.tieFormat=l,t.matchUpType=u;let c=TN({drawDefinition:s,stage:at});t.drawSize=t.drawSize??c,!c&&t.drawSize&&PN({drawSize:t.drawSize,drawDefinition:s,stageSequence:r,stage:at});let d=ya({drawDefinition:s}).drawMatchUps.map(Ar),p=k4(t);if(p.error)return ue({result:p,stack:o});let{structures:f,links:h,qualifyingResult:m}=p;s.structures=f,s.links=h;let g=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!TN({stage:vt,drawDefinition:s})){let T=PN({drawSize:m.qualifyingDrawPositionsCount,stage:vt,drawDefinition:s});if(T.error)return T}if(g){let T=khe({qualifiersCount:g,drawDefinition:s,stage:at});if(T.error)return T}let v=t.drawSize??c;Object.assign(t,ft({drawSize:v,matchUpType:u,tieFormat:l}));let{matchUps:y,matchUpsMap:b}=fr({drawDefinition:s});l&&(y==null||y.forEach(T=>{if(!d.includes(T.matchUpId)){let{tieMatchUps:w}=eE({tieFormat:l,matchUp:T,isMock:a});Object.assign(T,{tieMatchUps:w,matchUpType:u})}}));let{inContextDrawMatchUps:I}=sg({drawDefinition:s,matchUpsMap:b});return Qi({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:I,drawDefinition:s,matchUpsMap:b,...ae,structures:f,matchUps:y,links:h}}function Fw(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:wr};let{participant:a,tournamentId:o}=jg({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...ud({participant:a,scaleAttributes:i}),tournamentId:o}:{error:qn}}function Bw(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!_me({scaleItem:r}))return{error:hP};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=kme({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=iu();l.includes(ma)&&oi({topic:ma,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...ae,info:Mq,existingValue:r==null?void 0:r.scaleValue}||o&&{...ae,newValue:r==null?void 0:r.scaleValue}||{error:qn}}function Ame(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:o}=t;if(!r)return{error:Oe};if(!r.participants)return{error:pP};let s=0,l={},u=[];for(let p of i){let f=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(_me({scaleItem:h}))Array.isArray(l[f])||(l[f]=[]),l[f].push(h);else return{error:hP}}r.participants.forEach(p=>{let{participantId:f}=p||{};Array.isArray(l[f])&&l[f].forEach(h=>{kme({participant:p,scaleItem:h,removePriorValues:n}),u.push(p),s++})});let c=s?void 0:J0,{topics:d}=iu();if(d.includes(ma)&&s&&oi({topic:ma,payload:{tournamentId:r.tournamentId,participants:u}}),o){let{eventId:p,drawId:f,...h}=o,m=((e=h.scaleAttributes)==null?void 0:e.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:fW,itemValue:h};if(m&&(g.itemSubTypes=m),f||p){let{drawDefinition:v,event:y}=vo({tournamentRecord:r,eventId:p,drawId:f});f&&c4({drawDefinition:v,timeItem:g}),p&&Eb({event:y,timeItem:g})}else Pb({tournamentRecord:r,timeItem:g})}}return a&&d.includes(_w)&&oi({topic:_w,payload:a}),ft({...ae,modificationsApplied:s,info:c})}function _me({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function kme({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:cb};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(u=>n.includes(u)&&i[u]).length!==r.length)return{error:hP};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=ud({scaleAttributes:i,participant:e}),s=u=>[void 0,null,""].includes(u),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:u,eventType:c,scaleName:d}=i,p=[uy,u,c,d].join("."),f=ft({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(f.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(f)}return{...ae,valueChanged:l,newValue:i.scaleValue}}var Sm="ELO",Ome="NTRP",THe="TRN",xme="UTR",x4="WTN",UHe={ELO:Sm,NTRP:Ome,TRN:THe,UTR:xme,WTN:x4},DHe={[Sm]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Ome]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[xme]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[x4]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},ds=DHe,PHe=t=>250/Math.pow(t+5,.4),EHe=()=>1;function CHe(t=3,e=2){let i=t/e;return isNaN(i)?mI.kDefault():i}var mI={nSpread:400,diffThreshold:.125,kCalc:PHe,kMultiplier:CHe,kDefault:EHe};function Lme(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t,{ratings:r=ds,winnerCountables:a=1,loserCountables:o=0,ratingType:s=Sm,maxCountables:l,countables:u}=t||{},c=r==null?void 0:r[s];if(!c)return{error:dt};n=c.range||n,e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=n[0]>n[1],p=c.decimalsCount||0,f=d?n.slice().reverse():n,h=(k,B)=>parseFloat(B)>=Math.min(...k)&&parseFloat(B)<=Math.max(...k);(!h(n,e)||!h(n,i))&&(h(n,e)||(e=c.defaultInitialization),h(n,i)||(i=c.defaultInitialization));let m=({value:k,sourceRange:B,targetRange:F})=>(k-B[0])*(F[1]-F[0])/(B[1]-B[0])+F[0],g=m({targetRange:ds[Sm].range,sourceRange:f,value:d?n[0]-e:e}),v=m({targetRange:ds[Sm].range,sourceRange:f,value:d?n[0]-i:i}),y=(k,B)=>1/(1+Math.pow(10,(B-k)/mI.nSpread)),b=y(g,v),I=y(v,g),T=mI.kCalc(a),w=mI.kCalc(o),S=mI.kMultiplier(l,u),U=g+S*T*(1-b),P=v+S*w*(0-I),E=m({sourceRange:ds[Sm].range,value:U,targetRange:f}),D=m({sourceRange:ds[Sm].range,value:P,targetRange:f}),R=d?n[0]-E:E,N=parseFloat(parseFloat(R).toFixed(p)),M=d?n[0]-D:D,A=parseFloat(parseFloat(M).toFixed(p)),_=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(E>D&&_>mI.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}var RHe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function Fme(t){var e,i;let{removePriorValues:n=!0,tournamentRecord:r,ratingType:a=Sm,considerGames:o,matchUpIds:s,asDynamic:l}=t;if(!r)return{error:Oe};if(!Array.isArray(s))return{error:Ld};if(typeof a!="string")return{error:Se,ratingType:a};if(!ds[a])return{error:Se};let u=ds[a],{accessor:c}=u,d={},p=t.matchUps??Xr({matchUpFilters:{matchUpIds:s,matchUpStatuses:kr},tournamentRecord:r,inContext:!0}).matchUps??[];p.sort(wb);for(let h of p){let{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:b}=h,I=h.matchUpType,T={eventType:I,scaleName:a,scaleType:Am},w=`${a}.${Tpe}`,S={scaleName:w,eventType:I,scaleType:Am},U=Object.assign({},...(y??[]).map(B=>{let{sideNumber:F,participant:x}=B;return F&&{[F]:[x==null?void 0:x.participantId,...(x==null?void 0:x.individualParticipantIds)??[]].filter(Boolean).flat()}})),P=l?w:a,E=Object.assign({},...Object.values(U).flat().map(B=>{let{scaleItem:F}=Fw({scaleAttributes:S,tournamentRecord:r,participantId:B}),{scaleItem:x}=Fw({tournamentRecord:r,scaleAttributes:T,participantId:B}),$=c?{[c]:void 0}:void 0;return B&&{[B]:F??x??{scaleName:P,eventType:I,scaleDate:m,scaleType:Am,scaleValue:$}}})),D=g?bo(g):{},R=(D==null?void 0:D.bestOf)||1,N=(D==null?void 0:D.setsTo)||1,M=o?R&N:R,A=(v==null?void 0:v.sets)&&RHe(v.sets)||b===1&&[1,0]||[0,1],_=b?U[b]:[],k=b?U[3-b]:[];for(let B of _){let F=(e=E[B])==null?void 0:e.scaleValue,x=typeof F=="object"?F[c]:F;for(let $ of k){let j=(i=E[$])==null?void 0:i.scaleValue,V=typeof j=="object"?j[c]:j,H=b?A[b]:[0,0],z=b?A[3-b]:[0,0],{newWinnerRating:q,newLoserRating:W}=Lme({winnerCountables:H,loserCountables:z,maxCountables:M,winnerRating:x,loserRating:V,ratingType:a}),Y=c?{...F,[c]:q}:q,Z=c?{...j,[c]:W}:W;E[B].scaleValue=Y,E[$].scaleValue=Z;let X=Bw({participantId:B,removePriorValues:n,tournamentRecord:r,scaleItem:{...E[B],scaleName:P}});if(X.error||(X=Bw({participantId:$,removePriorValues:n,tournamentRecord:r,scaleItem:{...E[$],scaleName:P}}),X.error))return X}}Object.assign(d,E)}let f=p.map(({matchUpId:h})=>h);return{...ae,modifiedScaleValues:d,processedMatchUpIds:f}}function FO(t){var e;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:o,event:s}=t;if(typeof n!="object")return{error:nt};let{participantIdPairings:l,matchUpsCount:u}=t,c=kO(t);if(c.error)return ue({result:c});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:f=0}=c;if(!u)a?u=f:p>0&&(u=p);else if(u>f&&t.restrictMatchUpsCount!==!1)return ue({result:{error:Se,info:"matchUpsCount error",context:{roundMatchUpsCount:f}}});if(l&&!Array.isArray(l)||u&&!At(u)||i&&!Array.isArray(i)||!l&&!u)return{error:Se,info:"matchUpsCount or pairings error"};if(u&&t.restrictMatchUpsCount!==!1&&u>32)return{error:Se,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(d||0))return{error:Se,info:"roundNumber error"};let h=r??(a&&(d??0)+1||d||1);l=l??Je(0,u).map(()=>({participantIds:[void 0,void 0]}));let m=v=>{if(!t.idPrefix)return;let y=n.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${h}-${v}`},g=l==null?void 0:l.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((w,S)=>ft({sideNumber:S+1,participantId:w})),T=i[y]??m(y)??Li();return{roundNumber:h,matchUpStatus:Vn,matchUpId:T,sides:I}});if(g!=null&&g.length){let v=(e=_a({drawDefinition:n,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:b}=eE({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:b,matchUpType:Xi})})}return{roundNumber:h,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...ae}}function MHe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=BK({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[nF(l)];s.push(l);let c=l.value,d=l,p=0,f=0,h=o.length,m;do h-=1,m=o.length*i[o[0]].length;while(m>t&&h>5);let g=[];o.forEach(y=>{i[y].slice(0,h).forEach(b=>{f+=1;let I=Fv(y,b.opponent);if(!g.includes(I)){let T=BK({stipulated:[[y,b.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(nF(T))){u.push(nF(T)),s.push(T);let{maxDelta:w,value:S}=T;w<d.maxDelta&&(d=T),(S<c||S===c&&Math.round(Math.random()))&&(c=S),g.push(I),p+=1}}}),s=s.filter(b=>Math.abs(b.value-c)<5)}),s.sort((y,b)=>y.maxDiff-b.maxDiff);let v=jo(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:f,candidate:v}}function nF(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function BK({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,f]=d,h=Fv(p,f),m=i[h];s.push({participantIds:d,value:m}),l+=i[h]}),Yr(t,a).map(d=>Va(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((f,h)=>o.includes(h)||f,!1)){o.push(...p);let f=d.value;l+=f,s.push({participantIds:p,value:f})}}),s.sort((d,p)=>d.value-p.value);let u=s.reduce((d,p)=>{let[f,h]=p.participantIds,m=Fv(f,h),g=n[m];return g>d?g:d},0),c=s.reduce((d,p)=>{let[f,h]=p.participantIds,m=Fv(f,h),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:c}}function Fv(t,e){return[t,e].sort(IO).join("|")}function Bme({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=Fv(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function NHe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(ei);if(n.length===2){let[r,a]=n,o=Fv(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function AHe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=Fv(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var _He=0;function kHe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let o=((a=ds[n])==null?void 0:a.defaultInitialization)??_He;return r.split("|").map(s=>{var l;if(i===Kl){let u=(l=t==null?void 0:t.find(c=>c.participantId===s))==null?void 0:l.individualParticipantIds;return u?u==null?void 0:u.map(c=>e[c]||o):o*2}else return e[s]||o})}function OHe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:u}){n.forEach(v=>{let y=kHe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),b=typeof u=="number"&&u||.5,I=u&&(Math.round(Math.random())?b:b*-1)||0,T=Math.abs(y[0]-y[1])+I,w=Math.abs(y[0]-y[1]);a[v]=w,o[v]||(o[v]=0),o[v]+=T?Math.pow(T,2):0});let c=n.map(v=>({pairing:v,value:o[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=AHe({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:f,deltaCandidate:h,iterations:m}=MHe({valueSortedPairings:c,maxIterations:r,pairingValues:d,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:f,deltaCandidate:h,iterations:m,candidate:p}}var xHe=100,LHe=100,FHe=4e3;function L4({encounterValue:t=xHe,sameTeamValue:e=LHe,maxIterations:i=FHe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:u,adHocRatings:c,salted:d=.5,roundNumber:p,structureId:f,matchUpIds:h,eventType:m,structure:g,scaleName:v,idPrefix:y,isMock:b,event:I}){var T,w;if(!u)return{error:nt};if(!g&&!f)return{error:Tn};if(g||(g=Pt({drawDefinition:u,structureId:f}).structure),!ln(g))return{error:Lh};if(!(l!=null&&l.length))return{error:Fh};let S=[...a??[],...(g==null?void 0:g.matchUps)??[]],{encounters:U}=NHe({matchUps:S}),P=(o==null?void 0:o.participants)??[];if(s){let V=Ht(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:z})=>z):[]),H=Math.max(...V,0);if(H){let z=(T=g==null?void 0:g.matchUps)==null?void 0:T.filter(({roundNumber:q})=>q===H).map(({matchUpId:q})=>q);Fme({ratingType:v||((w=I==null?void 0:I.category)==null?void 0:w.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:z})}}let{valueObjects:E}=BHe({tournamentParticipants:P,encounterValue:t,sameTeamValue:e,encounters:U}),{uniquePairings:D,possiblePairings:R,deltaObjects:N}=Bme({participantIds:l}),M={tournamentParticipants:P,possiblePairings:R,drawDefinition:u,participantIds:l,uniquePairings:D,maxIterations:i,adHocRatings:c,deltaObjects:N,valueObjects:E,eventType:m,scaleName:v,structure:g,salted:d},{candidatesCount:A,participantIdPairings:_,iterations:k,candidate:B}=OHe(M);if(!A)return{error:Hk};let F,x;if(n){let V=FO({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:r,participantIdPairings:_,newRound:!0,drawDefinition:u,roundNumber:p,matchUpIds:h,idPrefix:y,isMock:b,event:I});if(V.error)return V;F=V.roundNumber,x=V.matchUps}let{maxDelta:$,maxDiff:j}=B;return{roundNumber:F,participantIdPairings:_,candidatesCount:A,...ae,iterations:k,matchUps:x,maxDelta:$,maxDiff:j}}function BHe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===qi);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=Bme({participantIds:s});for(let u of l)r[u]||(r[u]=0),r[u]+=n}return{valueObjects:r}}function $me(t){var e,i,n,r;let{drawType:a=uc,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:c,placeByes:d,isMock:p,event:f}=t,h=t==null?void 0:t.drawDefinition;if(!h)return{error:nt};let m=jr,g=vb({stageSequence:1,drawDefinition:h,stage:m}),v=[Wl,SP,Ad].includes(a)?g.length:Q0(g.length);if(!u&&a===oS&&g.length<2||a===Wl&&g.length<3)return{error:Lk};let{tieFormat:y,matchUpType:b}=t;if(y){let A=Ao({tieFormat:y});if(A.error)return A}y=aa(y??((e=_a({drawDefinition:h}))==null?void 0:e.tieFormat)),b=b??h.matchUpType??Pn;let{structures:I}=_d({stageSequence:1,drawDefinition:h,stage:m});if(I.length>1)return{error:lde};if((n=(i=I==null?void 0:I[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:Aq};let T=(r=I==null?void 0:I[0])==null?void 0:r.structureId;Object.assign(t,ft({structureName:t.structureName??ca(jr),structureId:T,matchUpType:b,tieFormat:y,drawSize:v,stage:m}));let w=Nme(t);if(w.error)return w;let S=w.generators[a];if(!S)return{error:sq};let U=S==null?void 0:S();if(U.error)return U;let{structures:P,links:E}=U,D=P.map(A=>Ci({structure:A}).matchUps).flat();y&&D.forEach(A=>{let{tieMatchUps:_}=eE({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:_,matchUpType:b})}),(!s||!o)&&(h=ut(h,!1,!0)),h.links||(h.links=[]),E.length&&h.links.push(...E);let R=P.map(({structureId:A})=>A);h.structures||(h.structures=[]);let N=h.structures.map(({structureId:A})=>A);h.structures=h.structures.map(A=>R.includes(A.structureId)?P.find(({structureId:_})=>_===A.structureId):A);let M=P.filter(({structureId:A})=>!N.includes(A));return M.length&&h.structures.push(...M),c&&ZP({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:h,structureId:T,placeByes:d,drawSize:v,event:f}),o&&Qi({drawDefinition:h}),{links:E,structures:P,...ae}}var F4={};Yt(F4,{addGame:()=>Kme,addPoint:()=>Wme,addSet:()=>Zme,addShot:()=>Yme,analyzeSet:()=>o1,calculateHistoryScore:()=>Hme,checkScoreHasValue:()=>Jr,checkSetIsComplete:()=>VO,clearHistory:()=>qme,generate:()=>Vme,generateScoreString:()=>dd,generateTieMatchUpScore:()=>aE,getSetComplement:()=>z4,getTiebreakComplement:()=>zO,helpers:()=>ege,isValidMatchUpFormat:()=>rs,keyValueScore:()=>Pge,mutate:()=>Gme,parseMatchUpFormat:()=>bo,parseScoreString:()=>_N,query:()=>Nge,redo:()=>Xme,reverseScore:()=>jme,setServingSide:()=>zme,stringifyMatchUpFormat:()=>RO,tidyScore:()=>Mge,umo:()=>Qme,undo:()=>Jme,validateScore:()=>H4,validateTieFormat:()=>Ao});var Vme={};Yt(Vme,{generateScoreString:()=>dd,generateTieMatchUpScore:()=>aE,reverseScore:()=>jme});function dd(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:dt,info:"missing sets"};let u=a&&bo(a),{bestOf:c,finalSetFormat:d,setFormat:p}=u??{},f=n||!(!e||!s||s===1),h=i?$He({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(VHe).map(g).filter(Boolean).join(" "))||"";if(!h)return m;if(s===2)return`${h} ${m}`;return`${m} ${h}`;function g(v){let y=c&&v.setNumber===c&&d?d:p,b=k=>Mn(k==null?void 0:k.side1Score)||Mn(k==null?void 0:k.side2Score),I=k=>Mn(k==null?void 0:k.side1TiebreakScore)||Mn(k==null?void 0:k.side2TiebreakScore),T=(y==null?void 0:y.tiebreakSet)||!b(v)&&I(v),{side1Score:w,side2Score:S,side1TiebreakScore:U,side2TiebreakScore:P}=v,E=U||(Mn(U)||o?0:""),D=P||(Mn(P)||o?0:"");if(T)return`[${(f?[D,E]:[E,D]).join("-")}]`;let R=Math.min(E,D),N=R?`(${R})`:"",M=w||(Mn(w)||o?0:""),A=S||(Mn(S)||o?0:""),_=f?`${[A,M].join("-")}${N}`:`${[M,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function $He({matchUpStatus:t}){let e={[xa]:"RET",[Ni]:"WO",[Ir]:"DF/DF",[nr]:"WO/WO",[Hh]:"SUS",[vs]:"ABN",[bi]:"DEF",[aS]:"DR"};return t&&e[t]||""}function VHe(t,e){return t.setNumber-e.setNumber}function jme(t){if(!(t!=null&&t.score))return{error:dt};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:u,side2Score:c,setNumber:d}=a;return ft({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:c,side2Score:u,setNumber:d})}),n=dd({sets:i}),r=dd({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...ae}}var Gme={};Yt(Gme,{addGame:()=>Kme,addPoint:()=>Wme,addSet:()=>Zme,addShot:()=>Yme,calculateHistoryScore:()=>Hme,clearHistory:()=>qme,redo:()=>Xme,setServingSide:()=>zme,umo:()=>Qme,undo:()=>Jme});function Hg({matchUp:t}){let{extension:e}=qt({name:nO,element:t});if(!e)return{error:Pa};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ae}}function Hme(t){var e,i;if(!t)return{error:dt};let{matchUp:n,updateScore:r}=t;if(!n)return{error:No};let a=((e=Hg({matchUp:n}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:Se,info:"history is not an array"};let{matchUpFormat:o}=n;if(!o)return{error:mq};if(!rs({matchUpFormat:o}))return{error:hq};let s=bo(o),{bestOf:l,finalSetFormat:u,setFormat:c}=s,d=["0","15","30","40","A","G"],p={sets:[]},f=[],h,m=[0,0],g=1,v=0,y,b=0,I=R=>[1,2].includes(R),T=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),U=S(),P=w(),E=T(),D=0;for(let R of a){D+=1,y=p.sets.length+1===l;let N=y&&u?u:c,{tiebreakAt:M,setTo:A,NoAD:_,tiebbreakFormat:k}=N,B=E.side1Score===M&&E.side1Score===E.side2Score,F=!!N.tiebreakSet,x=F?N.tiebreakSet:k,{tiebreakTo:$,NoAD:j}=x||{},V=()=>{h=void 0,m=[0,0],g=3-g,E.side1TiebreakScore=0,E.side2TiebreakScore=0,E.side1PointScore="",E.side2PointScore="",b=0},H=W=>{E.winningSide=W;let{s:Y,...Z}=E;p.sets.push(Z),U=S(),P=w(),E=T(),V()},z=W=>{P.winningSide=W;let{g:Y,...Z}=P;E.games.push(Z),U=S(),P=w(),V();let X=`side${W}Score`;E[X]+=1},q=W=>{U.winningSide=W;let{p:Y,...Z}=U;P.points.push(Z),U=S(),b=0;let X=()=>m.reduce((ce,J)=>ce+J)%4/4>.5?g:3-g,Q=W-1;if(B||F){m[Q]+=1,h=X(),E[`side${W}TiebreakScore`]=m[Q],E[`side${3-W}TiebreakScore`]=m[1-Q];let ce=j?1:2;if(m[Q]>=$&&m[Q]>=m[1-Q]+ce)return z(W),{gameCompleted:!0}}else if(m[1-Q]===4&&m[Q]===3?m[1-Q]-=1:m[Q]+=1,E.side1PointScore=d[m[0]],E.side2PointScore=d[m[1]],m[Q]===5||m[Q]===4&&m[1-Q]<3||_&&m[Q]===4)return z(W),{gameCompleted:!0}};if(I(R.srv)&&(g=R.srv),["p","s","g","o"].includes(R.u)&&f.push(R.u),R.shotOutcome&&(U.shots.push(R),R.shotType==="SERVE"&&["OUT","NET"].includes(R.shotOutcome)&&(b+=1),b===2)){let W=3-g;q(W)}if(I(R.p)||At(R.pointNumber)){let W=R.winningSide||R.p;if((i=q(W))!=null&&i.gameCompleted)continue}if(I(R.g)||At(R.gameNumber)){let W=R.winningSide||R.g;P.winningSide=W;let Y=`side${W}Score`,Z=`side${3-W}Score`;if(f.length&&(f.includes("p"),f=[]),z(W),E[Y]===A&&E[Y]-E[Z]>=(_?1:2)&&(H(W),y))break}if(I(R.s)||At(R.setNumber)){let W=R.winningSide||R.s;if(H(W),f.length&&(f.includes("p"),f.includes("g"),f=[]),y)break}}return D!==a.length&&console.log({error:"Match completed with excess history"}),(E.side1Score||E.side2Score||E.games.length||E.side1TiebreakScore||E.side2TiebreakScore)&&p.sets.push(E),p.scoreStringSide1=dd({...p,matchUpFormat:o}),p.scoreStringSide2=dd({...p,matchUpFormat:o,reversed:!0}),g=h||g,r&&(n.score=p),{...ae,servingSide:g,score:p}}function zg({undoHistory:t,history:e,matchUp:i}){return hi({element:i,extension:{value:{history:e,undoHistory:t},name:nO}})}function zme({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:bq};let{history:i=[]}=Hg({matchUp:t});return i.push({srv:e}),zg({matchUp:t,history:i})}function qme({matchUp:t}){return zg({matchUp:t})}function Wme({matchUp:t,point:e}){if(!e||!t)return{error:dt};if(typeof e!="object")return{error:Se,context:{point:e}};let{history:i=[]}=Hg({matchUp:t});return i.push(e),zg({matchUp:t,history:i})}function Kme({matchUp:t,game:e}){if(typeof e!="object")return{error:Se,context:{game:e}};let{history:i=[]}=Hg({matchUp:t});return i.push(e),zg({matchUp:t,history:i})}function Yme({matchUp:t,shot:e}){if(typeof e!="object")return{error:dt};let{history:i=[]}=Hg({matchUp:t});return i.push(e),zg({matchUp:t,history:i})}function Zme({matchUp:t,set:e}){if(typeof e!="object")return{error:dt};let{history:i=[]}=Hg({matchUp:t});return i.push(e),zg({matchUp:t,history:i})}function Xme({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Hg({matchUp:t});return i.length&&e.push(i.pop()),zg({matchUp:t,history:e,undoHistory:i})}function Jme({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Hg({matchUp:t});return i.push(e.pop()),zg({matchUp:t,history:e,undoHistory:i})}var Qme={},ege={};Yt(ege,{keyValueScore:()=>Pge,parseMatchUpFormat:()=>bo,stringifyMatchUpFormat:()=>RO,tidyScore:()=>Mge});var Bv=" ",r$="DEF",jHe="COMPLETED",tge="WO",GHe="WO/WO",ige="ABN",nge="SUS",rge="RET",age="INT",oge=[rge,r$,tge,GHe,ige,nge,age],a$="DEFAULTED",sge="WALKOVER",lge="ABANDONED",uge="SUSPENDED",cge="RETIRED",dge="INTERRUPTED",HHe=[cge,a$,sge],zHe="Enter Score",by="()",cg="[]",B4=["up","left","shift+tab"],$4=["enter","down","tab","right"],MN="backspace",pge="r",fge="s",hge="a",mge="d",gge="w",vge="i",BO=[pge,mge,gge,hge,fge,vge],$O="space",rF=["[","("],NN=[...B4,...$4,$O,"]"],yge="-",qHe="/",$v=yge,pd=yge,bge=[qHe],WHe=0,KHe=["=","+","num_1","num_2","shift+=","shift+-"],V4=["0","1","2","3","4","5","6","7","8","9"].concat(BO),Ige=V4.map(t=>`shift+${t}`),wge=[$v,MN].concat(NN,bge),Sge=[V4,Ige,wge].join(","),YHe=[Sge,B4,$4,KHe].join(","),ZHe={OUTCOMEKEYS:BO,SIDE1KEYS:V4,SIDE2KEYS:Ige,MODIFIERS:wge,PROMPT:zHe,MOVEUP:B4,MOVEDOWN:$4,HOTKEYS:YHe};function Jb({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Tge({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Bv?Bv:"";return t+n+i}else return i+Bv+t}function Tge({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of oge){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Bv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function o$({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:u,removed:c}=Tge({scoreString:e});if(e=u,c)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:f}=t.setFormat,{tiebreakTo:h,NoAD:m}=f||{},{isTiebreakEntry:g}=kI({brackets:cg,scoreString:e}),v=JHe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=kI({brackets:by,scoreString:s}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=kI({brackets:cg,scoreString:s}),T=s&&s[s.length-1].trim(),w=s&&!isNaN(T),S=t.isIncompleteSetScore;if(g&&I){let U=s.slice(b+1).split(pd),P=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,D=[P,E];if(E){let R=n===1?1:0;D[R]=((D==null?void 0:D[1-R])||0)+(m?1:2),(D[R]||0)<h&&(D[R]=h),s=e.slice(0,b+1),s+=D.join(pd)}else P!==void 0?(s=e.slice(0,b+1),s+=P):(s=e.slice(0,b),S=!0);d.side1TiebreakScore=D[0]||0,d.side2TiebreakScore=D[1]||0}if(s.length||(s=void 0),S){let U=(r=d.side1Score)==null?void 0:r.toString();if(U){let P=U==null?void 0:U.slice(0,U.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(a=d.side2Score)==null?void 0:a.toString(),P=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);d.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=P==null?void 0:P.slice(0,P.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!I?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function kI({brackets:t=by,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...lc(i,r)),o=Math.max(...lc(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function XHe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=cg.split(""),a=t.split(""),o=Math.max(...lc(n,a)),s=Math.max(...lc(r,a)),l=Math.max(...lc(pd,a));return i&&o>s&&l>o}function JHe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function Uge(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function $K({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var r;let a=bo(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((r=n==null?void 0:n.reduce((u,c)=>{let{winningSide:d}=c;return d&&u[d-1]++,u},[0,0]))==null?void 0:r.indexOf(s))+1||void 0;return HHe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function VO({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:dt,info:"missing set"};e=e||i&&bo(i);let s=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:u}=a,{setTo:c,tiebreakAt:d}=s,p=jO({set:a}),f=Math.abs(l-u),h=l>=c||u>=c,m=n||l>=c&&u>=c||d&&d<c&&(l===d||u===d),g=t||m&&(p===1&&a.side1TiebreakScore>a.side2TiebreakScore||p===2&&a.side2TiebreakScore>a.side1TiebreakScore),v=!m&&s.NoAD||m||n&&(o=s.tiebreakFormat)!=null&&o.NoAD?1:2,y=f>=v;return!!((h&&(y||m)||n)&&(!m||g))}function jO({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function j4({analysis:t,set:e}){let i=jO({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return VO({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function QHe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=Tt(n);let{validSide2Score:o,requiresTiebreak:s}=eze({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=j4({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let u=by.split("")[0];e+=u}else t.isDecidingSet||(e+=Bv)}return{sets:i,scoreString:e,updated:r}}function eze({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,u;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?u=s===a&&i===r||s===r&&i===a:u=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:u}}function Dge({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===pge?n?(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:rge}),r=t===2?1:2,a=cge):(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:r$}),r=t===2?1:2,a=a$):e===mge?(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:r$}),r=t===2?1:2,a=a$):e===gge?(o=!0,i=[],n=tge,r=t===2?1:2,a=sge):e===fge&&n?(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:nge}),a=uge,r=void 0):e===hge?(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:ige}),a=lge,r=void 0):e===vge&&n&&(o=!0,n=Jb({scoreString:n,lowSide:t,outcome:age}),a=dge,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function tze(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,u,c;!(e!=null&&e.length)&&l!==MN&&(e=[{setNumber:1}]);let d=e.length-1;if(BO.includes(l)){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;f&&!h?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=Dge({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===MN){if({scoreString:n,sets:e,outcomeRemoved:c}=o$({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),c){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p;if(f&&h){let m=f>h&&1||h>f&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,u=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===$O){let p=e[e.length-1]||{},{side1Score:f,side2Score:h}=p,m=f>h&&1||h>f&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",u=!0)}else if(l===$v&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let f=Tt((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Tt(f),p=e[d].side1Score.toString(),u=!0}else{let f=Tt((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Tt(f),p=[e[d].side1Score,e[d].side2Score].join("-"),u=!0}if(u){let f=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:m,side2Score:g}=h;return[m,g].join("-")}).join(" ");f?n=f+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:u}}function ize({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:c}}=t.setFormat,[d]=cg.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=kI({brackets:cg,scoreString:n}),f=(n.slice((p??0)+1)+(e?"":a)).split(pd);if((((o=f[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(f[0]=(f[0]||"")+a),i===2&&(f[1]=(f[1]||"")+a);let h=[f[0]||0,f[1]||0].map(v=>Tt(v)),m=i===1?1:0;h[m]=h[1-m]+(c?1:2),h[m]<u&&(h[m]=u);let g=r[r.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],n=n.slice(0,(p??0)+1),n+=h.join(pd),s=!0}else{let h=[f[0]||0,f[1]||0].map(g=>Tt(g)),m=r[r.length-1];m.side1TiebreakScore=h[0],m.side2TiebreakScore=h[1],n+=a,s=!0}}else{let p=Uge({lowValue:Tt(a||0),tiebreakTo:u,NoAD:c}),f=[Tt(a),p];i===2&&f.reverse();let h={side1TiebreakScore:f[0],side2TiebreakScore:f[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(h),n+=f.join(pd),s=!0}return{info:l,scoreString:n,sets:r,updated:s}}function nze({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=h(),u=[n,l];e===2&&u.reverse();let c=by.split("")[0],d=u.join($v)+(s?c:Bv);i=(i||"")+d;let p={side1Score:u[0],side2Score:u[1]},f=j4({analysis:t,set:p});return p.winningSide=f||void 0,{scoreString:i,set:p};function h(){return s?n+1:n+1===r?n+(o?1:2):r}}function rze({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var a,o,s;let l=(((a=r==null?void 0:r.filter(j=>j==null?void 0:j.winningSide))==null?void 0:a.length)||0)+(i?0:1),u=bo(t),c=l===(u==null?void 0:u.bestOf),d=c&&(u==null?void 0:u.finalSetFormat)||(u==null?void 0:u.setFormat)||{},p=d==null?void 0:d.timed,f=c&&r[(u==null?void 0:u.bestOf)-1],h=f==null?void 0:f.winningSide,{isTiebreakEntry:m}=kI({brackets:by,scoreString:e}),{isTiebreakEntry:g}=kI({brackets:cg,scoreString:e}),v=m||g,y=!!d.tiebreakSet,b=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),I=e&&!isNaN(b),T=!v&&b===$v,w=m&&rF.includes(b),S=g&&rF.includes(b),U=g&&b===pd,P=e==null?void 0:e.split(""),[E]=cg.split(""),D=P&&Math.max(...lc(E,P)),R=P&&Math.max(...lc(pd,P)),N=P&&R>D,M=(s=r[r.length-1])==null?void 0:s.winningSide,A=(r==null?void 0:r.length)&&!M,_=oge.find(j=>(e==null?void 0:e.indexOf(j))>=0),k=!isNaN(n),B=n===$O,F=NN.includes(n),x=e==null?void 0:e.split("").find(j=>rF.includes(j)),$=F&&g&&!S&&(U||!XHe({scoreString:e}));return{isTiebreakSetValue:y&&k,matchUpScoringFormat:u,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:A,isSpace:B,isCloser:F,isTiebreakCloser:F&&x&&v&&I,isDecidingSet:c,isTiebreakSet:y,isTimedSet:p,isNumericEnding:I,isNumericValue:k,hasOpener:x,hasOutcome:_,finalSet:f,finalSetIsComplete:h,lastSetIsComplete:M,isInvalidSetTiebreakValue:B&&v&&w,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:T,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:U}}function Pge(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:u=!0}=t,c,d,p=l&&e===2||!l&&e===1;if(!Sge.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:f}=$K({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=f;let h=rze({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(bge.includes(i)&&(i=$v),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Tt(i)===0&&(h.isTiebreakCloser=!0),NN.includes(i)&&h.hasOpener&&(i=""),NN.includes(i)&&(i=$O),h.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(h.isTimedSet)({info:d,sets:r,scoreString:n,updated:c,matchUpStatus:o,winningSide:a}=tze({analysis:h,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(BO.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:c}=Dge({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===MN)c=!0,{scoreString:n,sets:r}=o$({analysis:h,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===$v&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(c=!0,{scoreString:n,sets:r}=o$({analysis:h,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===pd&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(c=!0,n+=pd);else if([$v,pd].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:r,scoreString:n,updated:c}=QHe({analysis:h,scoreString:n,sets:r,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let m=h.isSetTiebreakEntry?by:cg,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=h.setFormat,{tiebreakTo:I,NoAD:T}=b||{},w=jO({set:y});if(!h.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),P=Uge({lowValue:U,tiebreakTo:I,NoAD:T});w===1?(y.side1TiebreakScore=P,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=P)}n=(n||"")+g,h.isDecidingSet||(n+=Bv);let S=j4({analysis:h,set:y});y.winningSide=S||void 0,c=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:c}=ize({analysis:h,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(h.isSetTiebreakEntry){let[m]=by.split(""),g=Math.max(...lc(m,n.split(""))),v=n.slice(g+1),y=v&&Tt(v)===WHe,b=Tt(v?v+i:i),{tiebreakFormat:I}=h.setFormat,{tiebreakTo:T,NoAD:w}=I||{};!y&&v.length<2?w&&b>T-1?d="invalid low value for NoAD tiebreak":(c=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!r.length){c=!0;let{scoreString:m,set:g}=nze({analysis:h,lowSide:e,scoreString:n,value:Tt(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(c){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=$K({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[Vn,Sc].includes(o))?(o=jHe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!a&&![uge,lge,dge].includes(o)&&(o=void 0),{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:c,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var GO="\\d+-\\d+",a1="\\d+-\\d+\\(\\d+\\)",G4="\\[\\d+-\\d+\\]",aze="\\d+-\\d+\\(\\d+-\\d+\\)",oze=new RegExp(`(${GO}),`,"g"),sze=new RegExp(`(${a1}),`,"g"),lze=[GO,a1,G4,aze],uze=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],cze=uze.map(t=>{let e=t.split("").map(i=>lze[i]).join(" ");return new RegExp(`^${e}$`)});function VK(t){return!t||cze.some(e=>e.test(t))}function dze(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let u=n.includes(l)&&l,c=r.includes(u);if(c&&u)return a[u]+=1,o=u,l;if(!c&&u&&o&&u!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(f=>f!==o);if(d.includes(u))a[o]||(o="");else return a[u]||(o=""),p}return l}).join("");return t!==s?s:t}function _R(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function pze(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function $w(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function AN(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function jK(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function fze(t){return t.startsWith("(")&&t.endsWith(")")}function hze({score:t,applied:e}){t=dze(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let u=/\((\d+)\/\)/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,f,h,m,g,v=()=>{g=ts(t.split("")),f=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,m=f&&!h};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(fze)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),h&&!f&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);T(w)&&(t=w,v())}return{score:t,applied:e}}function HO(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=lc("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function mze({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[oze,sze].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(HO).join(" "),{score:t,applied:e}}function gze({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let f=/^-(\d+)$/;if(f.test(p)){let[h]=p.match(f).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(_R),a=0,o="";for(let p of r){let f=lc(p,n).filter(v=>!a||v>a)[0],h=n.slice(a,f-1),m=n[f-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[h.join(" "),[m,p].join("")].join(" ");o+=b,a=f+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),w=[h.join(" "),[T,p].join("")].join(" ");o+=w,a=f+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((f,h)=>+f-+h,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>pze(p)&&"bracket"||$w(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,f="";return n.forEach((h,m)=>{s[m]==="bracket"&&p==="set"?(h=i(h),f+=h):f+=` ${h}`,p=s[m]}),{score:f.trim()}}n=t.split(" ");let l,u=n.map(p=>{let f=new RegExp(/^(\d+)-(\d+)$/);if(f.test(p)){let[h,m]=p.match(f).slice(1),g=Math.abs([h,m].reduce((y,b)=>+y-+b)),v=Math.max(h,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),c=lc("tiebreak",u);if(c.length){let p="";n.forEach((f,h)=>{c.includes(h)?p+=`(${f}) `:c.includes(h+1)?p+=`${f}`:p+=`${f} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,f,h]=t.match(d).slice(1),m=Math.max(f,h)>=10;!$w(p)&&m&&(t=t.replace(d,`${p} [${f}-${h}]`))}return u=[],t=t.split(" ").map(p=>{let f=/^\((.*)\)$/,h=f.test(p),m=new RegExp(G4).test(p)&&"super"||new RegExp(a1).test(p)&&"tiebreak"||new RegExp(GO).test(p)&&"standard"||"unknown";return u.push(m),m==="standard"&&h?p.match(f)[1]:p}).join(" "),{score:t}}function vze({score:t,applied:e}){for(let U of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(P.test(t)){let E=t.match(P).slice(1).map(R=>parseInt(R)),D=Math.abs(E[0]-E[1]);D<=10&&D>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,P,E,D,R,N]=t.match(i).slice(1);t=t.replace(i,`${U}${P}-${E} ${D}-${R}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let o=HO(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[U,P,E]=t.match(s).slice(1),[D,R]=P.split("");t=`${U}-${D} ${R}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(t)){let[U,P]=t.match(u).slice(1),E=U.trim(),D=P.trim();if(l.test(E)&&l.test(D)){let R=E.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("slashSeparationPattern")}}let c=/^([\d -]+),([\d -]+)$/;if(c.test(t)){let[U,P]=t.match(c).slice(1),E=U.trim(),D=P.trim();if(l.test(E)&&l.test(D)){let R=E.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${R} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("singleSetCommaSeparationPattern")}let p=0,f=/(\d+)-(\d{2})-(\d+)/;for(;f.test(t)&&p<3;){let[U,P,E]=t.match(f).slice(1),D=P.split(""),R=`${U}-${D[0]} ${D[1]}-${E}`;t=t.replace(f,R),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,m=t.match(h);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(P=>{let E=P.match(U).slice(2)[0];t=t.replace(P,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let P=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let P=" "+U.slice(1).split(" ").join("-");t=t.replace(U,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],P=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,P),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(D=>{let[R,N]=D.match(P).slice(1),M=`${R}-${N}`;E=E.replace(D,M)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,P,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${P}${E}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(T)||[]){let[P,E,D,R]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,M]=E.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(U,`${P}${E}(${D})${R}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,D,R]=U.match(P).slice(1),[N,M]=E.split("-").map(A=>parseInt(A));Math.abs(N-M)===1&&(t=t.replace(U,`${E}(${D})${R}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let P=/(^|\s)(\d \d)\(/,[E,D]=U.match(P).slice(1);t=t.replace(U,`${E}${D.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function yze({score:t,matchUpStatus:e}){var i;let n=t==null?void 0:t.split(" ");t=n.map(l=>{if(l.endsWith("]")){let u=l.split("[");if($w(u[0]))return u[0]+`(${u[1].slice(0,u[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let u=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(Mn(u)&&(u==null?void 0:u[0])>2){if([2,4].includes(u.length))u=u.split("").join("-");else if(u.length===3){let c=u.indexOf("1");u=AN(u.split(""),c)}}t=t.replace(l,`(${u})`)}n=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=n.length-1;t=n.map((l,u)=>{let c=[void 0,"","COMPLETED"].includes(e)||u!==o;if(a.test(l)&&c){let[d,p,f]=Array.from(l.match(a)).slice(1),h=Math.min(p,f);return`${d}(${h})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1),d=u.split("");return`${d[0]}-${d[1]}(${c})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(a.test(l)){let[u,c]=Array.from(l.match(a)).slice(1);return $w(u)?`${u}(${c})`:u}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[u]=l.match(a).slice(1);return`[${u<9?10:parseInt(u)+2}-${u}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function bze({score:t,attributes:e,identifier:i}){var n,r,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let f of s||[]){let h=(r=(n=f.match(/^\((.*)\)$/))==null?void 0:n.slice(1))==null?void 0:r[0],m=t.split(f)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=jK(h),v=HO(g);t=t.replace(f,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(f=>{let h=jK(f.match(/^\[(.*)\]$/)[1]);t=t.replace(f,`(${h}) `).trim()});let u=[")","]"],c=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&u.some(f=>t.endsWith(f))&&c.some(f=>t.includes(f))){let f="",h=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=h.every(b=>b.includes(",")||_R(b)),g=h.every(b=>b.includes("/")||_R(b)),v=h.every(b=>b.includes("-")||_R(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;h.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(f+=" "),I.includes(y))f+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);f+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...T);b==="set"?f+=`(${w}) `:f+=`[${T.join("-")}] `,b="tiebreak"}}),t=f.trim()}}let d=ts(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&$w(t)&&Mn(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function Ege({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Mn(s)&&parseInt(s),u=n[0]!==void 0&&n[1]!==void 0;if(Mn(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(u&&e.length===1&&Mn(e[0])){let c=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=c,i.push(a()),n=[void 0,void 0]}u&&o()}}return{sets:i}}function s$(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=AN(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=AN(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function Cge(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>Mn(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(Ege({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,u,c]=s;e=`${l}-${u}(${c})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,u,c]=s;e=`[${l}${u}-${c}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,u,c,d]=s,p=Math.min(c,d);e=`${l}-${u}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,u,c,d]=s;e=`[${l}${u}-${c}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,u,c,d]=s;e=`${l}${u} ${c}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,u,c,d,p]=s;e=`${l}-${u}(${c}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,u,c,d,p]=s;e=`${l}-${u} ${c}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d} [${p}${f}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u}(${c}) ${d}-${p} ${f}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d}(${p}) ${f}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,u,c,d,p,f,h]=s;e=`${l}-${u} ${c}-${d} ${p}-${f}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=s$(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Yr(e.split(""),2).map(g=>g.join("")),u=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),c=u.reduce((g,v)=>g>0&&v>0,1),d=ts(u),p=u.map(g=>Math.abs(g)),f=ts(p),h=u[0]<0,m=!h&&u[1]<0;if(u[0]>0&&u[1]>0&&u[0]!==u[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(c)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(f).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=s,w=u.reduce((S,U,P)=>U<0?P:S,void 0);if(w===0){let S=Math.min(y,b);e=`${g}-${v}(${S}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,b,I,T,w,S]=s;h||m?s[5]===1&&(h?e=`${g}-${v}(${y}) ${b}-${I} [${T}${w}-${S}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${w}-${S}]`):(u[0],u[1])}}}return{score:e,applied:i,matchUpStatus:n}}function Rge(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let u=l.match(r).slice(1).map(d=>parseInt(d)),c=u[0]>u[1]&&1||u[1]>u[0]&&2;c&&(e[c-1]+=1,i.push(c))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,u)=>l+u,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function Ize({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((c,d)=>{if(new RegExp(a1).test(c)){let f=c.slice(3),h=c.slice(0,3),m=h.split("-");if(!$w(h)&&!e){let g=Math.max(...m),v=h.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+f}}else if(c.length===2&&Mn(c))return c.split("").join("-");c=HO(c);let p=new RegExp(`^${G4}$`).test(c)&&"super"||new RegExp(`^${a1}$`).test(c)&&"tiebreak"||new RegExp(`^${GO}$`).test(c)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[f,h]=c.split("-"),m=Math.abs(parseInt(f)-parseInt(h)),g=Math.max(f,h),v=Math.min(f,h),y=[parseInt(f),parseInt(h)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(c=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[f,h]=c.split("-");if(!Math.abs(parseInt(f)-parseInt(h))&&e!=="RETIRED")return""}return c}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=Rge(t);if(u===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let c=[0,0];t=t.split(" ").map((d,p)=>(c[l[p]]+=1,Math.max(...c)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function wze({score:t}){let{setsTied:e,winningSide:i}=Rge(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Mn(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(u=>parseInt(u));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(u=>+u>=10)){let u=o.map(c=>c===s?c-10:10).sort();l=Math.abs(u[0]-u[1]),l>2&&(o=u)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function Sze({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function Tze({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function Uze({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=AN(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=Cge({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function Dze({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&s$(t)?{score:s$(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function Pze({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function Eze({score:t,profile:e,applied:i}){var n;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function Cze({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function Rze({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function Mze({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function Nze({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function Aze({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Mn(i))&&e.length===4&&(t=e)}return{score:t}}function _ze({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var kze={handleTiebreakSlashSeparation:Nze,handleSetSlashSeparation:Rze,punctuationAdjustments:hze,handleGameSeparation:Mze,joinFloatingTiebreak:gze,handleBracketSpacing:mze,handleSpaceSeparator:Aze,separateScoreBlocks:Uze,matchKnownPatterns:vze,removeDanglingBits:Cze,removeErroneous:Dze,handleWalkover:Pze,properTiebreak:yze,handleNumeric:Cge,handleRetired:Eze,containedSets:bze,sensibleSets:Ize,stringScore:Sze,superSquare:wze,setBuilder:Ege,excisions:_ze,replaceOh:Tze},aF={},Oze=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],xze=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function Mge(t){if(!t.score)return{error:Se};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],u,c=[],d,p,f=e,h=g=>{g.forEach(v=>{p=kze[v]({profile:s,identifier:n,matchUpStatus:u,attributes:d,applied:c,score:f});let y=p.score!==f;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==u)&&console.log(u?{score:p.score,matchUpStatus:u}:{score:p.score},v),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(c=p.applied),f=p.score})};h(Oze);let m=VK(f);return m||(f=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(xze),m=VK(f),m||(f="")),c.forEach(g=>{aF[g]||(aF[g]=0),aF[g]+=1}),{matchUpStatus:u==null?void 0:u.toUpperCase(),modifications:l,attributes:d,isValid:m,score:f}}var Nge={};Yt(Nge,{analyzeSet:()=>o1,checkScoreHasValue:()=>Jr,checkSetIsComplete:()=>VO,getSetComplement:()=>z4,getTiebreakComplement:()=>zO,isValidMatchUpFormat:()=>rs,parseScoreString:()=>_N,validateScore:()=>H4,validateTieFormat:()=>Ao});function Lze({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(I=>I==null?void 0:I.winningSide))||[]).reduce((I,T)=>{let{winningSide:w}=T;if(!w)return I;let S=w-1;return I[S]++,I},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,u=s!==void 0&&o[s],c=l!==void 0&&o[l],d=e?bo(e):void 0,p=Math.max(...o),f=ts(o)[p],h=d==null?void 0:d.bestOf,m=h&&Math.ceil(h/2)||1,g=i??t,v=g&&[bi,xa,Ni].includes(g),y=!d||!a.length||a.every((I,T)=>{let w=T+1,S=w===h,U=w===a.length,{side1Score:P,side2Score:E,side1TiebreakScore:D,side2TiebreakScore:R,winningSide:N}=I,M=Math.max(P??0,E??0),A=D??R,{finalSetFormat:_,setFormat:k}=d,B=S&&_||k;if(A){let{tiebreakTo:F,NoAD:x}=(B==null?void 0:B.tiebreakFormat)||{},$=Math.max(D??0,R??0);if(x&&$>F||$<F&&N&&(U&&!v||!U))return!1}return B.setTo?!(!B.noTiebreak&&M>B.setTo+1):!0}),b=(!e||p===m)&&f===1&&o.indexOf(p)+1||void 0;return{valid:y&&(n&&u>c&&n===b||!n&&!b||v)}}function H4({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Se};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:Se,info:l};if(s!==void 0&&typeof s!="string")return{error:Se,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Se,info:Od("sets")};if(a!=null&&a.length){let u=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(u.length!==Ht(u).length)return{error:Se,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,f],[h,m],[g,v]].filter(I=>I.some(T=>T!==void 0)).every(I=>I.every(T=>At(T))))return{error:Se,info:"non-numeric values"};if(![b,y].filter(I=>I!==void 0).every(I=>At(I)))return{error:Se,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Se,info:"winningSide must be 1 or 2"}}let{valid:c}=Lze({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!c)return{error:yde,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var z4=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=Tt(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},zO=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=Fze({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function Fze(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function _N({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,u=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,c=(u&&zO({lowValue:u,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[f,h]=a||c||[];return{side1Score:d,side2Score:p,side1TiebreakScore:f,side2TiebreakScore:h,winningSide:l,setNumber:r}}}function Bze({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=jO({set:n});return VO({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function o1(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:Bk};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),u=!s&&!l,c=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],f=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],h=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=f.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=f==null?void 0:f.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=o||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:U,result:P}=$ze({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:f}),{error:E,result:D}=Vze({setObject:e,setFormat:o,sideTiebreakScores:f}),R=u&&!w&&P||s&&w&&D,N=c&&!(s&&!w)&&!(u&&w)&&(!S||R),M=Bze({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:c,isValidSetOutcome:R,leadingSide:T,setFormat:o,sideGameScores:d,sideGameScoresCount:h,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:f,sideTiebreakScoresCount:g,winningSide:M};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=D,D||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=P,P||(A.standardSetError=U))),A}function $ze({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:Bk};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Se};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:DB};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=e||{};if(!(o&&i!=null&&i.find(S=>S>=o)))return{result:!1,error:DB};let c=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!c)return{result:!1,error:$k};let d=(t==null?void 0:t.winningSide)-1,p=1-d,f=i[d],h=i[p],m=f-h;if(!(f>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&n!=null&&n.find(N=>N>=U)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=s<o?o:o+1;if(f>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,D=y-b,R=b>=U-1;if(D&&R&&D<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(f>o&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=u?1:2,w=h>=o-1;return m&&w&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&f>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Vze({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:Bk};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:$k};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(t==null?void 0:t.winningSide)-1,c=1-u,d=i[u],p=i[c];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let f=s?1:2,h=d-p,m=p>=l-1;return h&&m&&h<f?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var Age={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},_ge={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},kge={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Oge={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},xge={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Lge={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Fge={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Bge={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},$ge={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Vge={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},jge={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Gge={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Hge={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},zge={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},qge={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Wge={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Kge={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},l$="COLLEGE_DEFAULT",u$="COLLEGE_JUCO",c$="COLLEGE_D3",Yge="DOMINANT_DUO",Zge="DOMINANT_DUO_MIXED",Xge="LAVER_CUP",Jge="TEAM_DOUBLES_3_AGGREGATION",Qge="TIME_TENNIS_DUAL",eve="TIME_TENNIS_PRO_CIRCUIT",tve="USTA_BREWER_CUP",ive="USTA_OZAKI_CUP",nve="USTA_COLLEGE",rve="USTA_GOLD_TEAM_CHALLENGE",ave="USTA_LEVEL_1",ove="USTA_INTERSECTIONAL",sve="USTA_SECTION_BATTLE",lve="USTA_SOUTHERN_LEVEL_5",uve="USTA_TOC",cve="USTA_WTT_ITT",dve="USTA_ZONAL",jze={COLLEGE_D3:c$,COLLEGE_DEFAULT:l$,COLLEGE_JUCO:u$,DOMINANT_DUO:Yge,DOMINANT_DUO_MIXED:Zge,LAVER_CUP:Xge,TEAM_DOUBLES_3_AGGREGATION:Jge,TIME_TENNIS_DUAL:Qge,TIME_TENNIS_PRO_CIRCUIT:eve,USTA_BREWER_CUP:tve,USTA_OZAKI_CUP:ive,USTA_COLLEGE:nve,USTA_GOLD_TEAM_CHALLENGE:rve,USTA_INTERSECTIONAL:ove,USTA_LEVEL_1:ave,USTA_SECTION_BATTLE:sve,USTA_SOUTHERN_LEVEL_5:lve,USTA_TOC:uve,USTA_WTT_ITT:cve,USTA_ZONAL:dve},pve="STANDARD",GK={[pve]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[c$]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Vs,matchUpCount:6,matchUpValue:1},tieFormatName:c$,valueGoal:5},[l$]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Vs},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Vs},tieFormatName:l$,valueGoal:4},[u$]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Vs},tieFormatName:u$,valueGoal:5},[Xge]:Wge,[Yge]:jge,[Zge]:Fge,[Jge]:_ge,[Qge]:Bge,[eve]:Lge,[tve]:$ge,[ive]:Vge,[nve]:Gge,[rve]:Age,[ove]:xge,[ave]:Hge,[sve]:Oge,[lve]:kge,[cve]:zge,[uve]:Kge,[dve]:qge},Gze=t=>{let e=t!=null&&t.namedFormat&&Object.keys(GK).includes(t.namedFormat)?t.namedFormat:pve,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=ut(GK[e],!1,!0),s=l=>{var u,c;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Li();let d=(c=t==null?void 0:t.event)==null?void 0:c.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Hhe,collectionName:"Doubles",matchUpType:Yi,...o.doubles},{collectionId:s(1),matchUpFormat:Vs,collectionName:"Singles",matchUpType:Pn,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,u)=>l.collectionId=s(u)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},Iy=Gze;function Hze(t){var e,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:c,event:d}=t,{tieFormat:p,matchUpFormat:f}=t;if(l===Rr&&u===Rr){let h=(i=(e=r==null?void 0:r.structures)==null?void 0:e.find(({stage:m})=>m===at))==null?void 0:i.tieFormat;p=p||h||s&&((n=d==null?void 0:d.tieFormat)==null?void 0:n.tieFormatName)===s&&d.tieFormat||s&&Iy({namedFormat:s,hydrateCollections:a,isMock:c,event:d})||(d==null?void 0:d.tieFormat)||Iy({event:d,isMock:c,hydrateCollections:a}),f=void 0}else f||(p=void 0,d!=null&&d.matchUpFormat||(f=Vs));if(p){let h=Ao({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(h.error)return h}return{tieFormat:p,matchUpFormat:f}}function zze(t){var e,i,n,r,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:u,structureId:c,idPrefix:d,isMock:p}=t,f=t.qualifyingProfiles,h=f!=null&&f.length?Rme({uuids:t.uuids,qualifyingProfiles:f,appliedPolicies:u,idPrefix:d,isMock:p}):void 0;if(h!=null&&h.error)return h;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:S})=>S!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:S})=>S.structureId!==s);let{qualifiersCount:m,qualifyingDrawPositionsCount:g,qualifyingDetails:v}=h??{};g&&(h!=null&&h.structures&&((n=o.structures)==null||n.push(...h.structures)),h!=null&&h.links&&((r=o.links)==null||r.push(...h.links)));let y=(a=o.structures)==null?void 0:a.find(({stage:S,stageSequence:U})=>S===at&&U===1),{qualifiersCount:b}=hS({stageSequence:1,drawDefinition:o,structureId:c,stage:at}),I=Math.max(m??0,b??0),T=khe({qualifiersCount:I,drawDefinition:o,stage:at});if(T.error||(T=PN({drawSize:g,stage:vt,drawDefinition:o}),T.error))return T;qze({drawDefinition:o,drawEntries:l});let w=Wze({mainStructure:y,qualifyingDetails:v,drawDefinition:o});return w.error?w:{drawDefinition:o,structureId:c}}function qze({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:n})=>n===vt)){let n={...i,entryStage:i.entryStage??at,drawDefinition:t};Zfe(n)}}function Wze({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:u}=r,c=t&&((n=JP({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:u}))==null?void 0:n.link);if(c!=null&&c.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}function fve(t){var e,i;let{participantIds:n}=t,r=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||au.includes(o)}).map(ei))??[];if(n){let a=n.filter(o=>!(r!=null&&r.includes(o)));if(a!=null&&a.length)return ue({result:{error:Ic},info:{invalidParticipantIds:a}})}else n=r;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>n.length-1&&(!t.enableDoubleRobin||t.roundsCount>(n.length-1)*2)?{error:Se,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Se,info:"roundsCount must be less than 32"}:{participantIds:n}}function q4(t){var e;let i=[],{roundsCount:n=1,drawDefinition:r,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:u}=t,c,d=fve(t);if(d.error)return d;for(let p of Je(1,n+1)){let f=FO({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:a,structureId:o,roundNumber:c,idPrefix:s,isMock:l,event:u});if(f.error)return ue({result:f,info:{iteration:p}});(e=f.matchUps)!=null&&e.length&&i.push(...f.matchUps),c=((f==null?void 0:f.roundNumber)??1)+1}return{matchUps:i}}function Kze(t){var e;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=ds[r])==null?void 0:e.accessor),l=i.participants??[];for(let u of n??[]){let c=l==null?void 0:l.find(p=>p.participantId===u),d=HK({scaleName:`${r}.${Tpe}`,participant:c,eventType:a});!d&&r&&(d=HK({scaleAccessor:s,participant:c,scaleName:r,eventType:a})),d&&!o[u]&&(o[u]=d)}return o}function HK({scaleType:t=Am,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,o;let s=(o=(a=i&&ud({scaleAttributes:{eventType:r??my,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&ln(s)?s[e]:s}function W4(t){var e,i;let n=Zze(t);if(n!=null&&n.error)return n;let r=fve(t);if(r.error)return r;let a=Yze(t);if(a.error)return a;let o=Kze(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),u=[],c=[],d;for(let p of Je(1,(t.roundsCount??1)+1)){let f=L4({...t,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:u,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(f.error)return f;let{matchUps:h,...m}=f;c.push({...m,iteration:p,matchUpsCount:h==null?void 0:h.length}),d=((m==null?void 0:m.roundNumber)??1)+1,h!=null&&h.length&&u.push(...h)}return{...ae,matchUps:u,roundResults:c}}function Yze(t){var e,i,n;if(t.structureId)return t.structureId;let r=t.drawDefinition,a=(i=(e=r==null?void 0:r.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let u=l.stage&&hy[l.stage];return ns({structure:l})&&u>(hy[s==null?void 0:s.stage]||1)?l:s},void 0),o=(n=r==null?void 0:r.structures)==null?void 0:n.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?ns({structure:o})?{structure:o}:{error:Av}:{error:Tn}}function Zze(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Se,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==ql?{error:Av}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Se,info:"Missing Entries"}:{error:void 0}}function Xze(t){var e,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,u=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:f})=>(!p||p===at)&&f&&au.includes(f)),c=u==null?void 0:u.map(ei),d=u?Math.floor(u.length/2):0;if(t.automated)return Jze({...t,participantIds:c});{let p=q4({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&_O({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...ae}}function Jze(t){var e,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},u=W4({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:o});return u.error?u:((i=u==null?void 0:u.matchUps)!=null&&i.length&&_O({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:t.event,structureId:a}),{...ae})}function Qze({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var c,d;n=n??r;let p=Pt({drawDefinition:o,structureId:l});if(p.error)return p;let f=p.structure;if(!f)return{error:Tn};let{positionAssignments:h}=Or({structure:f}),m=(h==null?void 0:h.length)||0;if(u>m)return{error:Xce};let g=(c=f.structures)==null?void 0:c.length,v=At(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=e4({roundRobinGroupsCount:g,drawSize:m}))==null?void 0:d.seedGroups,{seedsCount:b}=uE({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:m});return b&&a!=null&&a[Dl]&&u>b&&e&&(u=b),f.seedLimit=u,f.seedAssignments=Je(1,u+1).map(I=>{let T=y==null?void 0:y.find(U=>U.includes(I)),w=T&&Math.min(...T),S=v&&I>=v?w:I;return{participantId:void 0,seedNumber:I,seedValue:S}}),Qi({drawDefinition:o,structureIds:[l]}),{...ae,seedLimit:u}}function Cb({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:Oe};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||!c.entryStageSequence||c.entryStageSequence===r)&&au.includes(c.entryStatus)).map(c=>{let{participantId:d}=c,{scaleItem:p}=Fw({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...c,...p}}).filter(c=>{let d=c.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(c,d){return t?u(d)-u(c):u(c)-u(d)}function u(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function hve(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=_d({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:f})=>!r.includes(f));if(!a)return ue({result:{error:Tn},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=s3e({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&i3e({...t,seedsCount:s,structure:a,structureId:o});let c=t.automated!==!1&&t.drawType!==ql&&!(t.qualifyingOnly&&t.stage!==vt),d=((n==null?void 0:n.length)||0)>1,p=c?t3e({...t,multipleStructures:d,seedLimit:u,structureId:o}):{};return p!=null&&p.error?ue({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function e3e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,o;let s=(o=(a=qt({name:Oc,element:r}))==null?void 0:a.extension)==null?void 0:o.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!s||s===n)&&Lg.includes(r.entryStatus)})}function t3e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=ZP({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function i3e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(ei);e?n3e({...t,enteredParticipantIds:a}):(r||i)&&r3e({...t,enteredParticipantIds:a})}function n3e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:c}=t,d=u?Ub({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,f)=>p.seedNumber<f.seedNumber?-1:p.seedNumber<f.seedNumber?1:0).forEach(p=>{let{participantId:f,seedNumber:h,seedValue:m}=p;gS({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:f,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:m,event:c})})}function r3e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:c,event:d}=t,{categoryName:p,ageCategoryCode:f}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,m=a3e({...t,ageCategoryCode:f,categoryName:p,eventType:h})||l&&o3e({...t,ageCategoryCode:f,categoryName:p,eventType:h}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,w=(r==null?void 0:r[b])||T||b;gS({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:I,structureId:c,seedNumber:b,seedValue:w,event:d})})}function a3e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},u=o==null?void 0:o.eventType,c={scaleName:i||s||l||o.eventId,scaleType:sd,eventType:u};return Cb({scaleAttributes:c,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function o3e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return Cb({scaleAttributes:{scaleName:o||s,scaleType:dh,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function s3e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=e3e(t);e>i.length&&(e=i.length);let{seedLimit:n}=Qze({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function l3e(t){var e;let i=O4({...t,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:c,drawSize:d,drawType:p,entries:f}=t,h=[],m=[],g=u3e({ignoreStageSpace:r,drawDefinition:n,drawEntries:u,drawType:p,entries:f});if(g.error)return g;let v=p===kg?0:Tt(t.seedsCount??0),y=hve({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:n,seedingProfile:s,participants:l,stage:at,seedsCount:v,placeByes:c,drawSize:d,entries:f});if(y.error&&!y.conflicts)return y;(e=y.positioningReport)!=null&&e.length&&h.push({[at]:y.positioningReport});let b=y.structureId;return y.conflicts&&(m=y.conflicts),p===ql&&t.roundsCount&&Xze({...t,drawDefinition:n,structureId:b}),{drawDefinition:n,positioningReports:h,conflicts:m,structureId:b}}function u3e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==at)continue;let s={...o,ignoreStageSpace:e??r===ql,entryStage:o.entryStage??at,drawDefinition:i,drawType:r},l=Zfe(s);if(n&&l.error)return l}return{error:void 0}}var c3e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),d3e=c3e;function p3e(t){let{drawId:e=Li(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=d3e();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function K4(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=wi(t,[{[Yu]:!0,[Vq]:!0}]);if(l.error)return l;if(!rs({matchUpFormat:r}))return{error:cP};let u="setMatchUpFormat";if(o){let c=on({drawDefinition:n,matchUpId:o,event:s});if(c.error)return c;let d=c.matchUp;if((d==null?void 0:d.matchUpType)===Rr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:go};d&&(d.matchUpFormat=r,di({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:u,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Rr)return{error:ch};for(let c of e){let d=Pt({drawDefinition:n,structureId:c});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===Rr)return{error:ch};let c=Pt({drawDefinition:n,structureId:a});if(c.error)return c;c.structure&&(c.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Qi({drawDefinition:n,structureIds:e}),{...ae}}function f3e({tieFormat:t}){let e=Ao({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Li());return{tieFormat:t}}function h3e({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=f3e({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=K4({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var mve={};Yt(mve,{attachPolicies:()=>lg,findPolicy:()=>Fg,getAppliedPolicies:()=>Ai,getPolicyDefinitions:()=>sf,mutate:()=>gve,query:()=>yve,removePolicy:()=>vve});var gve={};Yt(gve,{attachPolicies:()=>lg,removePolicy:()=>vve});function vve(t){let e=wi(t,[{[xBe]:!0,_anyOf:{[Ea]:!1,[Fd]:!1,[Yu]:!1,[eS]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return zK(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Oe};for(let a of r){let o=t.tournamentRecords[a],s=zK(t,o);if(s.error)return s;i=!0}}else return{error:Oe};return i?{...ae}:{error:Sw}}function zK(t,e){let i=Ai(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?hi({element:e,extension:{name:qU,value:i}}):qa({element:e,name:qU}),{...ae}):{error:Sw}}var yve={};Yt(yve,{findPolicy:()=>Fg,getAppliedPolicies:()=>Ai,getPolicyDefinitions:()=>sf});var bve={[Dl]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Ad]:{positioning:eg},[Wl]:{positioning:eg}},positioning:U$e},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},d$=bve;function m3e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return ue({info:"policyDefinitions must be an object",result:{error:Se},stack:n});let r={[zU]:t==null?void 0:t[zU]};return e?g3e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&lg({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Dl])&&!(e!=null&&e[Dl])&&(lg({policyDefinitions:d$,drawDefinition:i}),t&&Object.assign(t,d$)),{error:void 0}}function g3e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(lg({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function v3e(t){var e,i,n,r,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:c,tieFormat:d,drawType:p,stack:f,event:h}=t,m=t.drawId?(e=h==null?void 0:h.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);let g=m??p3e({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=h3e({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:c,tieFormat:d,event:h});if(v.error)return ue({result:v,stack:f});let y=m3e({appliedPolicies:l,policyDefinitions:u,drawDefinition:g,stack:f});if(y.error)return y;let b=(n=(i=m==null?void 0:m.structures)==null?void 0:i.find(w=>w.stage===at&&w.stageSequence===1))==null?void 0:n.structureId,I=m?(r=m.structures)==null?void 0:r.filter(w=>w.stage===vt):[],T=(I==null?void 0:I.length)===1&&!((a=I[0].matchUps)!=null&&a.length)&&I[0].structureId;return{drawDefinition:g,structureId:b,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:T}}function y3e(t){var e,i;let n="generateOrGetExisting",r=[],a=[],o=v3e(t);if(o.error)return ue({result:o,stack:n});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,c=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&zze({...t,...o})||l3e({...t,...o,entries:c});return d.error?ue({result:d,stack:n}):((e=d.positioningReports)!=null&&e.length&&r.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,u=d.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:l,structureId:u,conflicts:a,entries:c})}function b3e(t){var e,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:c,seedingProfile:d,participants:p,structureId:f,entries:h,stack:m}=t,g=r&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,S)=>w.stageSequence-S.stageSequence,b=(w,S)=>w.roundTarget-S.roundTarget,I=[],T=1;a.sort(b);for(let w of a){if(!Array.isArray(w.structureProfiles))return ue({info:Od("structureProfiles"),result:{error:dt},stack:m});T=w.roundTarget||T;let S=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],U=1;for(let P of S){let{qualifyingRoundNumber:E,qualifyingPositions:D,seededParticipants:R,seedingScaleName:N,seedsCount:M=0,seedByRanking:A,placeByes:_,drawSize:k}=P,B=hve({...t,seedingProfile:P.seedingProfile??d,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:D,seededParticipants:R,stage:vt,seedingScaleName:N,appliedPolicies:l,drawDefinition:c,qualifyingOnly:u,seedByRanking:A,participants:p,roundTarget:T,seedsCount:M,placeByes:_,drawSize:k,entries:h});if(B.error)return B;B.structureId&&I.push(B.structureId),U+=1,(i=B.conflicts)!=null&&i.length&&v.push(...B.conflicts),(n=B.positioningReport)!=null&&n.length&&s.push({[vt]:B.positioningReport})}T+=1}}else if(f&&g){let y=$s({structureName:ca(vt),stage:vt}),{link:b}=JP({sourceStructureId:y.structureId,targetStructureId:f,sourceRoundNumber:0,linkType:_p});c.structures||(c.structures=[]),c.structures.push(y),c.links||(c.links=[]),c.links.push(b)}return{qualifyingConflicts:v,error:void 0}}var Ive={};Yt(Ive,{addGoesTo:()=>sg,allCompetitionMatchUps:()=>Vu,allDrawMatchUps:()=>po,allEventMatchUps:()=>cf,allPlayoffPositionsFilled:()=>s4,allTournamentMatchUps:()=>Xr,analyzeDraws:()=>sE,analyzeMatchUp:()=>l1,analyzeTournament:()=>n5,bulkUpdatePublishedEventIds:()=>o5,calculateWinCriteria:()=>Mb,categoryCanContain:()=>MO,checkMatchUpIsComplete:()=>_m,checkValidEntries:()=>LO,compareTieFormats:()=>Bp,competitionScheduleMatchUps:()=>hE,credits:()=>I3e,drawMatchUps:()=>I5,eventMatchUps:()=>ix,filterParticipants:()=>zP,findDrawDefinition:()=>D4,findExtension:()=>qt,getAllDrawMatchUps:()=>fr,getAllEventData:()=>s5,getAllStructureMatchUps:()=>Ci,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>e5,getAppliedPolicies:()=>Ai,getAssignedParticipantIds:()=>Gg,getAvailableMatchUpsCount:()=>kO,getAvailablePlayoffProfiles:()=>QP,getCategoryAgeDetails:()=>nE,getCheckedInParticipantIds:()=>yb,getCompetitionDateRange:()=>KO,getCompetitionMatchUps:()=>s1,getCompetitionParticipants:()=>Y4,getCompetitionPenalties:()=>t5,getCompetitionVenues:()=>cE,getCourtInfo:()=>mO,getCourts:()=>w5,getDrawData:()=>YO,getDrawDefinitionTimeItem:()=>VW,getDrawParticipantRepresentativeIds:()=>T4,getDrawTypeCoercion:()=>lE,getEligibleVoluntaryConsolationParticipants:()=>S4,getEntriesAndSeedsCount:()=>ex,getEvent:()=>U5,getEventData:()=>ZO,getEventMatchUpFormatTiming:()=>d5,getEventProperties:()=>S5,getEventPublishStatus:()=>fl,getEventStructures:()=>UO,getEventTimeItem:()=>$P,getEvents:()=>T5,getFlightProfile:()=>Hn,getLinkedTournamentIds:()=>wP,getMatchUpCompetitiveProfile:()=>OP,getMatchUpContextIds:()=>g5,getMatchUpDailyLimits:()=>rx,getMatchUpDailyLimitsUpdate:()=>p5,getMatchUpDependencies:()=>su,getMatchUpFormat:()=>v5,getMatchUpFormatTiming:()=>LP,getMatchUpFormatTimingUpdate:()=>c5,getMatchUpScheduleDetails:()=>gO,getMatchUpType:()=>vO,getMatchUpsMap:()=>ya,getMatchUpsStats:()=>y5,getMaxEntryPosition:()=>u5,getModifiedMatchUpFormatTiming:()=>tx,getPairedParticipant:()=>Yl,getParticipantEventDetails:()=>Z4,getParticipantIdFinishingPositions:()=>U4,getParticipantMembership:()=>X4,getParticipantResults:()=>iE,getParticipantScaleItem:()=>Fw,getParticipantSchedules:()=>J4,getParticipantSignInStatus:()=>Q4,getParticipantTimeItem:()=>jW,getParticipants:()=>jn,getPersonRequests:()=>qg,getPolicyDefinitions:()=>sf,getPositionAssignments:()=>r1,getPositionsPlayedOff:()=>vS,getPredictiveAccuracy:()=>m5,getProfileRounds:()=>QO,getPublishState:()=>Sb,getRoundMatchUps:()=>to,getRounds:()=>b5,getScaleValues:()=>tS,getScaledEntries:()=>Cb,getScheduledRoundsDetails:()=>dE,getSchedulingProfile:()=>ff,getSchedulingProfileIssues:()=>l5,getSeedingThresholds:()=>t4,getSeedsCount:()=>uE,getStructureSeedAssignments:()=>nl,getTeamLineUp:()=>og,getTieFormat:()=>a5,getTimeItem:()=>Lc,getTournamentIds:()=>bP,getTournamentInfo:()=>Rb,getTournamentPenalties:()=>WO,getTournamentPersons:()=>i5,getTournamentStructures:()=>o4,getTournamentTimeItem:()=>VP,getValidGroupSizes:()=>KP,getVenueData:()=>Ow,getVenuesAndCourts:()=>pf,isAdHoc:()=>ns,isCompletedStructure:()=>yh,isValidForQualifying:()=>_4,isValidMatchUpFormat:()=>rs,matchUpActions:()=>xO,participantScaleItem:()=>ud,participantScheduledMatchUps:()=>f5,positionActions:()=>A4,publicFindVenue:()=>xW,tallyParticipantResults:()=>yS,tieFormatGenderValidityCheck:()=>CO,tournamentMatchUps:()=>nx,validMatchUp:()=>fO,validMatchUps:()=>pl,validateCollectionDefinition:()=>rE,validateLineUp:()=>TO});function I3e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var wve={};Yt(wve,{filterParticipants:()=>zP,getCompetitionParticipants:()=>Y4,getPairedParticipant:()=>Yl,getParticipantEventDetails:()=>Z4,getParticipantMembership:()=>X4,getParticipantScaleItem:()=>Fw,getParticipantSchedules:()=>J4,getParticipantSignInStatus:()=>Q4,getParticipantTimeItem:()=>jW,getParticipants:()=>jn,getScaleValues:()=>tS,participantScaleItem:()=>ud,validateLineUp:()=>TO});function Y4(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Rn};let i=[],n={},r={},a={},o=[],s={},l=[];for(let u of Object.values(e)){let{participantIdsWithConflicts:c,mappedMatchUps:d,participantMap:p,participants:f,matchUps:h,derivedEventInfo:m,derivedDrawInfo:g}=jn({...t,tournamentRecord:u});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...f??[]),o.push(...h??[]),c==null||c.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...ae,matchUps:o}}function Z4({tournamentRecord:t,participantId:e}){if(!t)return{error:Oe};if(!e)return{error:wr};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[qi,xt].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return eo(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function X4({tournamentRecord:t,participantId:e}){if(!t)return{error:Oe};if(!e)return{error:wr};let{participants:i}=jn({participantFilters:{participantTypes:[qi,xt,Us]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function J4({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Oe};if(typeof t!="object")return{error:rf,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Xr({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=su({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:u}=l,c,d=(u==null?void 0:u.map(f=>{if(f.participant)return[f.participant].concat(...f.participant.individualParticipants||[]);o[l.matchUpId]&&!c&&(c=(o[l.matchUpId]||[]).map(h=>r[h]).filter(({winningSide:h,bye:m})=>!h&&!m))}).filter(Boolean).flat())??[];for(let f of d){let{participantId:h}=f;s[h]||(s[h]={potentialMatchUps:[],participant:f,matchUps:[]}),s[h].matchUps.push(l)}let p=(c==null?void 0:c.map(({sides:f})=>f).flat().map(({participant:f})=>f&&[f].concat(...f.individualParticipants||[])).filter(Boolean).flat())||[];for(let f of p){let{participantId:h}=f;s[h]||(s[h]={potentialMatchUps:[],participant:f,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ae}}function Q4({tournamentRecord:t,participantId:e}){if(!t)return{error:Oe};if(!e)return{error:wr};let{participant:i}=jg({tournamentRecord:t,participantId:e});if(!i)return{error:qn};let{timeItem:n}=Lc({itemType:EP,element:i});return n&&n.itemValue===JU&&JU}var Sve={};Yt(Sve,{analyzeDraws:()=>sE,analyzeTournament:()=>n5,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>e5,getAppliedPolicies:()=>Ai,getCompetitionDateRange:()=>KO,getCompetitionPenalties:()=>t5,getPolicyDefinitions:()=>sf,getTournamentInfo:()=>Rb,getTournamentPenalties:()=>WO,getTournamentPersons:()=>i5,getTournamentStructures:()=>o4,getTournamentTimeItem:()=>VP});function e5({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:Oe};let{appliedPolicies:r}=Ai({tournamentRecord:t});return(((n=r==null?void 0:r[Rd])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function qO({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:Oe};let{appliedPolicies:r}=Ai({tournamentRecord:t});return(((n=r==null?void 0:r[fN])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function WO({tournamentRecord:t}){if(!t)return{error:Oe};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function t5({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let e=[];for(let i of Object.values(t)){let{penalties:n}=WO({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function Tve({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:f,notes:h})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:u,endDate:c,ballType:d,discipline:p,onlineResources:f,notes:h}))(t)}}var w3e={[nS]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},S3e=w3e;function Rb(t){var e,i,n,r;let{tournamentRecord:a}=t??{};if(!a)return{error:Oe};let o=(({tournamentId:c,tournamentRank:d,tournamentStatus:p,formalName:f,tournamentName:h,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S})=>({tournamentId:c,tournamentRank:d,tournamentStatus:p,formalName:f,tournamentName:h,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:w,updatedAt:S}))(a),s=jn({participantFilters:{participantRoles:[Jfe,WW,Qfe,ehe,ihe]},policyDefinitions:S3e,tournamentRecord:a}).participants;s&&(o.tournamentContacts=s);let l=((r=(n=(i=(e=Sb({tournamentRecord:a}))==null?void 0:e.publishState)==null?void 0:i.tournament)==null?void 0:n.status)==null?void 0:r.publishedEventIds)||[],u=[];for(let c of a.events??[])if(!(t!=null&&t.usePublishState)||l.includes(c.eventId)){let d=Tve({event:c}).eventInfo;d&&u.push(d)}return o.eventInfo=u,{tournamentInfo:ut(o,!1,!0),...ae}}function KO({tournamentRecords:t}){if(!ln(t))return{error:Rn};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=Rb({tournamentRecord:o}),u=s&&new Date(Bt(s));(!r.startDate||u&&u<r.startDate)&&(r.startDate=u);let c=l&&new Date(Bt(l));return(!r.endDate||c&&c>r.endDate)&&(r.endDate=c),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Bt(e.startDate.toISOString()),n=e.endDate&&Bt(e.endDate.toISOString());return!i||!n?{error:hde}:{startDate:i,endDate:n}}function i5({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Oe};let i=t.participants||[];e&&(i=zP({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function T3e(t){var e,i,n,r,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===qi))==null?void 0:i.length)===2,u=((n=t.events)==null?void 0:n.length)===1&&t.events[0],c=((r=u==null?void 0:u.drawDefinitions)==null?void 0:r.length)===1&&u.drawDefinitions[0],d=((s=(o=((a=c==null?void 0:c.structures)==null?void 0:a.length)===1&&c.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(u.tieFormat&&l&&d)}function n5({tournamentRecord:t}){if(!t)return{error:Oe};let{drawsAnalysis:e}=sE({tournamentRecord:t}),i={isDual:T3e(t),drawsAnalysis:e};return{...ae,analysis:i}}var Uve={};Yt(Uve,{compareTieFormats:()=>Bp,getTieFormat:()=>a5,tieFormatGenderValidityCheck:()=>CO,validateCollectionDefinition:()=>rE});function kN(t){var e;if(!t)return{};let i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:u,gender:c}=a;i.includes(s)||i.push(s);let d=u==null?void 0:u.ageCategoryCode;return[l,o===ig?"D":"S",d,s,c].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function Bp({considerations:t={},descendant:e,ancestor:i}){var n,r;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=kN(e),{matchUpFormats:u,tieFormatDesc:c}=kN(i),d=Ht((s??[]).filter(S=>!(u??[]).includes(S)).concat((u??[]).filter(S=>!(s??[]).includes(S)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),f=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),h=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));a.collectionIds=pK(Object.keys(h),Object.keys(m)),o.collectionIds=pK(Object.keys(m),Object.keys(h)),a.collectionsValue=qK(h),o.collectionsValue=qK(m),a.groupsCount=((n=i==null?void 0:i.collectionGroups)==null?void 0:n.length)??(0-(((r=e==null?void 0:e.collectionGroups)==null?void 0:r.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,b=o.collectionsValue.assignmentValues.some((S,U)=>{let P=a.collectionsValue.assignmentValues[U];return!P||S.valueKey!==P.valueKey||S.value!==P.value?!0:Array.isArray(S.value)?S.value.every((E,D)=>P.value[D]===E):!1}),I=p||f||c!==l||y||b||g!==0,T=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=T.length&&T;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:f,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:c,...ae,different:I,invalid:w}}function qK(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(IO).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=o,f={collectionValueProfiles:s,collectionValue:l,matchUpValue:c,scoreValue:d,setValue:p},h=Object.keys(f).filter(g=>![void 0,null].includes(f[g]));h.length!==1&&e.push({collectionId:a});let m=h[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):f[m];i.push({valueKey:m,value:g})}return n+=u,s?r+s.reduce((g,v)=>g+v.value,0):u?At(c)?r+c*u:At(d)?r+d*u:At(p)?r+p*u:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function r5(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Dve(t);return{matchUp:ut(e,!0,!0),error:i}}function Dve({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:c,event:d}){var p;if(!i)return{error:Oe};if(typeof s!="string")return{error:va};if(!a||!d){let m=(Xr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:Da};({eventId:u,drawId:c}=m),{event:d,drawDefinition:a}=vo({tournamentRecord:i,eventId:u,drawId:c})}if(!a)return{error:Qo};r&&!n&&(n=uf({tournamentRecord:i,contextProfile:r}));let f={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(d==null?void 0:d.eventId),drawId:c},{participants:h=[]}=Ib({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(po({context:l?f:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:Da};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=on({context:l?f:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function a5({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var l,u,c,d,p;if(!t)return{error:Oe};if(!o&&!s&&!i&&!n)return ue({result:{error:dt},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let f=r5({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&f!=null&&f.error)return f;if(!e&&f!=null&&f.drawDefinition&&(e=f==null?void 0:f.drawDefinition),r=r??(f==null?void 0:f.structure),!r&&i&&!n){if(!e)return{error:Ku};let y=Pt({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let h=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((u=_a({structure:r,drawDefinition:e,event:s}))==null?void 0:u.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((c=_a({drawDefinition:e,event:s}))==null?void 0:c.tieFormat),g=(d=_a({event:s}))==null?void 0:d.tieFormat,v=(p=_a({matchUp:f==null?void 0:f.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:p.tieFormat;return{...ae,matchUp:f==null?void 0:f.matchUp,structureDefaultTieFormat:aa(h),eventDefaultTieFormat:aa(g),drawDefaultTieFormat:aa(m),tieFormat:aa(v),structure:r}}var Pve={};Yt(Pve,{bulkUpdatePublishedEventIds:()=>o5,getAllEventData:()=>s5,getCourtInfo:()=>mO,getDrawData:()=>YO,getEventData:()=>ZO,getEventPublishStatus:()=>fl,getPublishState:()=>Sb,getVenueData:()=>Ow});function o5({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:Oe};if(!(e!=null&&e.length))return{error:dt,info:"Missing outcomes"};let n=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>r.includes(a.eventId))).filter(a=>{let o=fl({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:u}=a;return n[u].filter(c=>{let d=s?Object.keys(o.drawDetails).filter(p=>zW({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(c))||d.includes(c)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function Eve({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let n=ln(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function Cve({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;let a={...ut(n,t,!0),venueId:i.venueId},{extension:o}=qt({name:Au,element:n});if(e&&o){let s=ln(o.value)?(r=o.value)==null?void 0:r.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(u=>{let c=u.date;if(!(!c||s.includes(c)))return u}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function pf(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter(c=>!t.tournamentId||c===t.tournamentId).forEach(c=>{let d=a[c];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:f}=qt({name:Au,element:p});if(f!=null&&f.value)continue}o.includes(p.venueId)||(u.push(ut(p,e,!0)),o.push(p.venueId));for(let f of p.courts??[])if(!s.includes(f.courtId)){if(i){let{extension:m}=qt({name:Au,element:f});if(Eve({extension:m,dates:r}))continue}let{inContextCourt:h}=Cve({convertExtensions:e,ignoreDisabled:i,venue:p,court:f});l.push(h),s.push(f.courtId)}}}),{courts:l,venues:u,...ae}}function U3e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Rn};let r=ut(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=qt({name:Au,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(u=>{if(!i&&!(n!=null&&n.length))return u;let{extension:c}=qt({name:Au,element:u});return Eve({extension:c,dates:n})}).filter(Boolean).map(u=>{let{inContextCourt:c}=Cve({convertExtensions:t,ignoreDisabled:i,venue:s,court:u});return c});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function cE({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Rn}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=U3e({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:u}=s;(!e||u!=null&&u.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function s5({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Oe};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=Rb({tournamentRecord:t}),{venues:a}=pf({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,u=Tve({event:s}).eventInfo,c=xP({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(f=>{let h=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:w})=>({matchUpFormat:T,updatedAt:w,drawName:I,drawId:b}))(f),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=fS({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:f,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=fl({event:s});return Object.assign(u,{drawsData:d,publish:p}),u});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function Rve({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function YO(t){var e,i;let{tournamentParticipants:n=[],includePositionAssignments:r,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,status:u=ou,drawDefinition:c,noDeepCopy:d,sortConfig:p,context:f,event:h}=t;if(!c)return{error:nt};let m=(({matchUpFormat:D,updatedAt:R,drawType:N,drawName:M,drawId:A})=>({matchUpFormat:D,updatedAt:R,drawName:M,drawType:N,drawId:A}))(c),g,v,{allStructuresLinked:y,sourceStructureIds:b,hasDrawFeedProfile:I,structureGroups:T}=DO({drawDefinition:c});if(!y)return{error:rde};let w=(t==null?void 0:t.publishStatus)??fl({event:h,status:u}),S=t.eventPublished??!!((i=(e=Sb({event:h}).publishState)==null?void 0:e.status)!=null&&i.published),U=!1,P=!1,E=T.map(D=>{let R={},N=D.map(M=>{let{structure:A}=Pt({drawDefinition:c,structureId:M}),{seedAssignments:_}=nl({drawDefinition:c,structure:A});return(A==null?void 0:A.stage)===at&&A.stageSequence===1&&(g=_),(A==null?void 0:A.stage)===vt&&A.stageSequence===1&&(v=_),A}).sort((M,A)=>gb(M,A,p)).map(M=>{var A;if(!M)return;let _=M==null?void 0:M.structureId,k=[];M.stage&&[at,ha,An].includes(M.stage)&&(k=g),(M==null?void 0:M.stage)===vt&&(k=v);let{matchUps:B,roundMatchUps:F,roundProfile:x}=Ci({seedAssignments:(A=M==null?void 0:M.seedAssignments)!=null&&A.length?void 0:k,context:{drawId:m.drawId,...f},tournamentParticipants:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:w,drawDefinition:c,inContext:s,structure:M,event:h}),{positionAssignments:$}=Hi({structure:M}),j=$==null?void 0:$.filter(is(Dd)).map(z=>{let{drawPosition:q,participantId:W}=z,{extension:Y}=qt({element:z,name:fh});return P=!0,{participantResult:Y==null?void 0:Y.value,participantId:W,drawPosition:q}});if(!(j!=null&&j.length)&&B.length&&t.allParticipantResults){let{subOrderMap:z}=Jhe({positionAssignments:$}),q=yS({matchUpFormat:M.matchUpFormat,policyDefinitions:a,subOrderMap:z,matchUps:B});j=$==null?void 0:$.filter(is(Dd)).map(W=>{let{drawPosition:Y,participantId:Z}=W;return P=!0,{participantResult:Z&&q.participantResults[Z],participantId:Z,drawPosition:Y}})}let V=M?(({stageSequence:z,structureName:q,structureType:W,matchUpFormat:Y,stage:Z})=>({stageSequence:z,structureName:q,structureType:W,matchUpFormat:Y,stage:Z}))(M):{};V.sourceStructureIds=b[_],V.hasDrawFeedProfile=I[_],V.positionAssignments=$,V.structureActive=B.reduce((z,q)=>{var W;let Y=[Zn,af,bi,xa,Ni,nu,Ir,nr].includes(q.matchUpStatus);return z||Y||!!q.winningSide||!!((W=q.score)!=null&&W.scoreStringSide1)},!1);let H=B.reduce((z,q)=>z&&[Di,Zn,xa,Ni,bi,vs].includes(q.matchUpStatus),!!B.length);return V.structureCompleted=H,R[_]=H,V.structureActive&&(U=!0),{...V,participantResults:j,seedAssignments:k,roundMatchUps:F,roundProfile:x,structureId:_}});return N.forEach(M=>{var A;r||delete M.positionAssignments,M.sourceStructuresComplete=(A=M.sourceStructureIds)==null?void 0:A.every(_=>R[_])}),N}).flat();return m.drawActive=U,m.participantPlacements=P,m.drawGenerated=E==null?void 0:E.reduce((D,R)=>D||!!(R!=null&&R.roundMatchUps),!1),m.drawCompleted=E==null?void 0:E.reduce((D,R)=>D&&R.structureCompleted,!0),m.drawPublished=l?S&&Rve({publishStatus:w,drawId:m.drawId}):void 0,{structures:!l||m.drawPublished?d?E:ut(E,!1,!0):void 0,drawInfo:d?m:ut(m,!1,!0),...ae}}function ZO(t){var e,i;let{includePositionAssignments:n,participantsProfile:r,policyDefinitions:a,usePublishState:o,status:s=ou,sortConfig:l}=t,u=wi(t,[{tournamentRecord:!0},{[qq]:{event:!1,eventId:!1}}]);if(u.error)return u;let c=ut(t.tournamentRecord,!1,!0),d=t.event?void 0:vo({tournamentRecord:c,eventId:t.eventId}).event,p=t.event?ut(t.event,!1,!0):d&&ut(d,!1,!0)||void 0;if(!p)return{error:es};let{eventId:f}=p,{tournamentId:h,endDate:m}=c,g=fl({event:p,status:s}),v=Sb({event:p}).publishState??{},y=!!((e=v==null?void 0:v.status)!=null&&e.published),{participants:b}=jn({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:a,...r,tournamentRecord:c}),I=({stage:M,drawId:A})=>{var _,k,B;if(!o)return!0;let F=(k=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:k.stageDetails;return!F||!Object.keys(F).length?!0:(B=F[M])==null?void 0:B.published},T=({structureId:M,drawId:A})=>{var _,k,B;if(!o)return!0;let F=(k=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:k.structureDetails;return!F||!Object.keys(F).length?!0:(B=F[M])==null?void 0:B.published},w=({drawId:M})=>o?Rve({publishStatus:g,drawId:M}):!0,S=({drawId:M,structure:A})=>{var _,k,B,F;if(!o)return A;let x=(F=(B=(k=(_=g==null?void 0:g.drawDetails)==null?void 0:_[M])==null?void 0:k.structureDetails)==null?void 0:B[A.structureId])==null?void 0:F.roundLimit;if(At(x)){let $=Je(1,x+1),j={},V={};for(let H of $)A.roundMatchUps[H]&&(j[H]=A.roundMatchUps[H],V[H]=A.roundProfile[H]);A.roundMatchUps=j,A.roundProfile=V}return A},U=p.drawDefinitions||[],P=!o||y?U.filter(w).map(M=>(({drawInfo:A,structures:_})=>({...A,structures:_}))(YO({allParticipantResults:t.allParticipantResults,context:{eventId:f,tournamentId:h,endDate:m},includePositionAssignments:n,tournamentParticipants:b,noDeepCopy:!0,policyDefinitions:a,tournamentRecord:c,usePublishState:o,drawDefinition:M,publishStatus:g,sortConfig:l,event:p}))).map(({structures:M,...A})=>{let _=M==null?void 0:M.filter(({stage:k,structureId:B})=>T({structureId:B,drawId:A.drawId})&&I({stage:k,drawId:A.drawId})).map(k=>S({drawId:A.drawId,structure:k}));return{...A,structures:_}}).filter(M=>{var A;return(A=M.structures)==null?void 0:A.length}):void 0,{tournamentInfo:E}=Rb({tournamentRecord:c}),D=(c.venues||[]).map(M=>(({venueData:A})=>({...A}))(Ow({tournamentRecord:c,venueId:M.venueId}))),R=(({eventId:M,eventName:A,eventType:_,eventLevel:k,surfaceCategory:B,matchUpFormat:F,category:x,gender:$,startDate:j,endDate:V,ballType:H,discipline:z})=>({eventId:M,eventName:A,eventType:_,eventLevel:k,surfaceCategory:B,matchUpFormat:F,category:x,gender:$,startDate:j,endDate:V,ballType:H,discipline:z}))(p),N={tournamentInfo:E,venuesData:D,eventInfo:R,drawsData:P};return N.eventInfo.publishState=v,N.eventInfo.published=(i=v==null?void 0:v.status)==null?void 0:i.published,{...ae,eventData:N,participants:b}}var Mve={};Yt(Mve,{getPersonRequests:()=>qg,getProfileRounds:()=>QO,getScheduledRoundsDetails:()=>dE,getSchedulingProfile:()=>ff,getSchedulingProfileIssues:()=>l5});function XO({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!rs({matchUpFormat:n}))return{error:cP};let u=Object.keys(i).filter(d=>!o||d===o),c;return u.forEach(d=>{var p;if(c)return;let f=i[d],h=l?(p=vo({tournamentRecord:f,eventId:l}))==null?void 0:p.event:void 0;return c=LP({tournamentRecord:f,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:h}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function dE({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:Rn};if(!Array.isArray(a))return{error:dt,info:Od("rounds")};let o={},s=[];a.sort((p,f)=>(p.sortOrder??0)-(f.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>lS({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Vu({nextMatchUps:!0,tournamentRecords:i}));let l=0,u={},c={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var f;let h=p.periodLength||n,m=[];e!=null&&e[p.structureId]?m.push(...e[p.structureId]):m.push(p.structureId);let g=r?hv({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:m,matchUps:r}).sort(wb):[],{segmentNumber:v,segmentsCount:y}=p.roundSegment||{};if(At(v)&&$u(g==null?void 0:g.length)&&$u(y)&&v>0&&v<=y&&y<(g==null?void 0:g.length)&&!((f=p.matchUpIds)!=null&&f.length)){let w=g.length/y,S=w*(v-1);g=g.slice(S,S+w)}let b=i[p.tournamentId],I=vo({drawId:p.drawId,tournamentRecord:b}).event,T=[];for(let w of g){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),T.push(S))}for(let w of T){let{eventType:S,category:U}=I??{},{categoryName:P,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:D,recoveryMinutes:R,averageMinutes:N,error:M}=XO({categoryName:P??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(M)return{error:M,round:p};let A=g.filter(k=>(t||!kr.includes(k.matchUpStatus))&&k.matchUpStatus!==Di).map(Ar);A.forEach(k=>{d[k]={typeChangeRecoveryMinutes:D,recoveryMinutes:R,averageMinutes:N},u[k]=R,c[k]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${h}`;return{roundPeriodLength:h,recoveryMinutes:R,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:u,averageMinutesMap:c,orderedMatchUpIds:s,minutesMap:d,...ae}}function Nve({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=Bt(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let u=((s==null?void 0:s.venues)||[]).map(c=>{let{rounds:d,venueId:p}=c;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let f=d.filter(h=>{let m=i.includes(h.eventId)&&n.includes(h.drawId);return m||r.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),m});if(f.length)return{venueId:p,rounds:f}}).filter(Boolean);return u.length&&l&&{...s,venues:u}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function JO({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Se};let{venueIds:i,tournamentsMap:n}=P3e({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:u}=s;return hs(l)?u.every(c=>{let{venueId:d,rounds:p}=c;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(f=>{var h,m,g,v;if(!f)return a="empty round",!1;let{roundSegment:y,tournamentId:b,structureId:I,roundNumber:T,eventId:w,drawId:S}=f,U=(v=(g=(m=(h=n==null?void 0:n[b])==null?void 0:h[w])==null?void 0:m[S])==null?void 0:g[I])==null?void 0:v.includes(T);U||(a="Invalid rounds");let{segmentNumber:P,segmentsCount:E}=y||{},D=!y||At(P)&&$u(E)&&P<=E;return D||(a="Invalid segment"),U&&D}):(r=X0,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=Se),{valid:!!o,error:r,info:a}}function D3e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:c,courts:d})=>(!n||(d==null?void 0:d.length))&&c),u=e==null?void 0:e.tournamentId;return u&&(r.push(u),i[u]={},((e==null?void 0:e.events)||[]).forEach(c=>{let d=c.eventId;o.push(d),i[u][d]={},(c.drawDefinitions||[]).forEach(p=>{let f=p.drawId;s.push(f),i[u][d][f]={};let{structures:h}=_d({drawDefinition:p});(h||[]).forEach(m=>{var g;let v=m.structureId,{matchUps:y}=Ci({structure:m}),{roundMatchUps:b}=to({matchUps:y}),I=b&&Object.keys(b).map(T=>parseInt(T));i[u][d][f][v]=I,a.push(v),(g=m.structures)!=null&&g.length&&m.structures.forEach(T=>{a.push(T.structureId),i[u][d][f][T.structureId]=I})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function P3e(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,u)=>{let{tournamentIds:c,tournamentMap:d,structureIds:p,venueIds:f,eventIds:h,drawIds:m}=D3e({tournamentRecord:u});return f.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...c),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function ff({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let{extension:i}=qt({element:e,name:py,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=cE({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=y4({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:u}=Nve({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let c=bS({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return c.error?c:{schedulingProfile:n,modifications:l,issues:u}}}return{schedulingProfile:n,modifications:0}}function bS({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=JO({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?hi({tournamentRecords:t,discover:!0,extension:{name:py,value:i}}):qa({element:e,name:py,tournamentRecords:t,discover:!0})}function pE(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:u,issues:c}=ff({tournamentRecords:i,tournamentRecord:e});return{success:!u,modifications:u,issues:c}}let{venueIds:n}=cE({tournamentRecords:i}),{eventIds:r,drawIds:a}=y4({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=Nve({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...bS({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...ae,modifications:s,issues:l}}function l5(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:sP};if(!Array.isArray(e))return{error:Se};if(!e.every(hs))return{error:Qa};let r=[],a=0,o={},{schedulingProfile:s}=ff({tournamentRecords:i});if(!s)return{issues:r,...ae};let{matchUps:l}=Vu({nextMatchUps:!0,tournamentRecords:i});for(let c of s){let{scheduleDate:d,venues:p=[]}=c;if(!(e!=null&&e.length)||e.includes(d)){for(let f of p||[])if(f){let{rounds:h}=f,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=dE({tournamentRecords:i,periodLength:n,matchUps:l,rounds:h}),{matchUpDependencies:y}=su({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(I);return U&&(T=S),U}),T};if(g==null||g.forEach((I,T)=>{var w;let S=g.slice(T+1),U=$n(S,((w=y==null?void 0:y[I])==null?void 0:w.matchUpIds)||[]);U.length&&m.push({matchUpId:I,shouldBeAfter:U})}),m.length){a+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:w})=>{let S=b(T),U=Ht(w.map(b));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),U.forEach(P=>{o[d][S].includes(P)||o[d][S].push(P)}),{matchUpId:T,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...I)}}}}let u={matchUpIdShouldBeAfter:Object.assign({},...r.map(c=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:f}=c;return{[d]:{earlierRoundIndices:f,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...ae}}function qg(t){let{tournamentRecords:e,requestType:i}=t,n=wi(t,[{[Ea]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=qt({element:a,name:rS}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:u,requests:c}=l||{};r[u]||(r[u]=[]);for(let d of c)i&&d.requestType!==i||r[u].push(d)}}return{personRequests:r,...ae}}function p$(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,u=n?e:o,c=[r,s,l,u,a].join("|");return ft({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:c})}function WK({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:u}=o||{},c=ts(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(c).forEach(p=>{let f=c[p],h=XO({categoryName:l||u,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let m=h.averageMinutes*f;isNaN(d)||(d+=m)}),{roundMinutes:d}}function E3e(t){return(t||[]).reduce((e,i)=>{var n,r;let a=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((s,l)=>s+l,0),o=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function KK(t){let e=t.length,i=t.filter(({sides:u})=>u==null?void 0:u.some(({bye:c})=>c)).length||0,n=t.filter(({winningSide:u,matchUpStatus:c})=>u||kr.includes(c)).length||0,r=t.filter(({schedule:u,matchUpStatus:c})=>(u==null?void 0:u.scheduledDate)&&(u==null?void 0:u.scheduledTime)&&c!==Di).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function QO({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:sP};t={[i.tournamentId]:i}}if(e){let a=JO({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=ff({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Pa};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=p$(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),ft({id:n?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:r}}var Ave={};Yt(Ave,{getEntriesAndSeedsCount:()=>ex,getMaxEntryPosition:()=>u5});function ex({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Oi};let{entries:o,stageEntries:s}=rhe({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:u}=Cme({participantsCount:l}),c=uE({drawSize:i??u,participantsCount:l,policyDefinitions:t});if(c.error)return ue({result:c,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=c;return{entries:o,seedsCount:d,stageEntries:s}}function u5(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>Tt(r||0)),0)}var _ve={};Yt(_ve,{allCompetitionMatchUps:()=>Vu,allDrawMatchUps:()=>po,allEventMatchUps:()=>cf,allTournamentMatchUps:()=>Xr,analyzeMatchUp:()=>l1,calculateWinCriteria:()=>Mb,checkMatchUpIsComplete:()=>_m,competitionScheduleMatchUps:()=>hE,drawMatchUps:()=>I5,eventMatchUps:()=>ix,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>Ci,getCheckedInParticipantIds:()=>yb,getCompetitionMatchUps:()=>s1,getEventMatchUpFormatTiming:()=>d5,getMatchUpCompetitiveProfile:()=>OP,getMatchUpContextIds:()=>g5,getMatchUpDailyLimits:()=>rx,getMatchUpDailyLimitsUpdate:()=>p5,getMatchUpDependencies:()=>su,getMatchUpFormat:()=>v5,getMatchUpFormatTiming:()=>LP,getMatchUpFormatTimingUpdate:()=>c5,getMatchUpScheduleDetails:()=>gO,getMatchUpType:()=>vO,getMatchUpsStats:()=>y5,getModifiedMatchUpFormatTiming:()=>tx,getParticipantResults:()=>iE,getPredictiveAccuracy:()=>m5,getRoundMatchUps:()=>to,getRounds:()=>b5,isValidMatchUpFormat:()=>rs,matchUpActions:()=>xO,participantScheduledMatchUps:()=>f5,tallyParticipantResults:()=>yS,tournamentMatchUps:()=>nx,validMatchUp:()=>fO,validMatchUps:()=>pl});function kve({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let i=[],n;for(let r of Object.values(t)){let{extension:a}=qt({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:u}=qt({name:e,element:s});u&&i.push({params:{eventId:l,extension:u},method:"addEventExtension"})}}return{methods:i}}function c5({tournamentRecords:t}){return kve({extensionName:Ap,tournamentRecords:t})}var oF="ADULT",sF="JUNIOR",fC="WHEELCHAIR",Ove={[jh]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Yi]:30,default:60}}]},defaultDailyLimits:{[Pn]:2,[Yi]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Vs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[fC],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[oF,fC],minutes:{default:60,[Yi]:30}},{categoryTypes:[sF],minutes:{default:60,[Yi]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[oF,fC],minutes:{default:30}},{categoryTypes:[sF],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[oF,sF],minutes:{default:30}},{categoryTypes:[fC],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},C3e=Ove;function d5({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Oi};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let f=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(f==null?void 0:f.matchUpFormat)&&rs({matchUpFormat:f==null?void 0:f.matchUpFormat}))return d.push(f.matchUpFormat),f}).filter(Boolean)}else{let{policy:d}=Fg({policyType:Rd,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=qt({name:Ap,element:n}),f,h;p!=null&&p.value?{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:f,matchUpRecoveryTimes:h}=C3e[jh],r=Ht([...(f||[]).map(m=>m.matchUpFormatCodes),...(h||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,u=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Oi};let c=r.map(({matchUpFormat:d,description:p})=>{let f=LP({tournamentRecord:t,matchUpFormat:d,categoryName:u,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...f}});return ft({eventMatchUpFormatTiming:c,info:a})}function tx(t){let e=wi(t,[{[Fd]:!0},{[wu]:m=>rs({matchUpFormat:m}),[Pd]:cP,[Vq]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=qt({name:Ap,element:r}),o=a==null?void 0:a.value,{extension:s}=qt({element:i,name:Ap}),l=s==null?void 0:s.value,u=(o==null?void 0:o.matchUpAverageTimes)&&xT({...o,matchUpFormat:n}),c=(l==null?void 0:l.matchUpAverageTimes)&&xT({...l,matchUpFormat:n}),d=[u,c].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&LT({...o,matchUpFormat:n}),f=(l==null?void 0:l.matchUpRecoveryTimes)&&LT({...l,matchUpFormat:n}),h=[p,f].find(m=>m);return{matchUpFormat:n,recoveryTimes:h,averageTimes:d}}function p5({tournamentRecords:t}){return kve({extensionName:IP,tournamentRecords:t})}var fE=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function f5({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!pl(e))return{error:Ld};if(!Array.isArray(t))return{error:Se};let i=e.filter(Boolean).filter(({schedule:n})=>fE({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=Bt(a==null?void 0:a.scheduledDate),s=an(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return Dpe(an((o=r.schedule)==null?void 0:o.scheduledTime),an((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...ae,scheduledMatchUps:i}}function R3e({tournamentRecords:t}){var e;let i=[],n={};for(let r of Object.values(t))for(let a of r.events??[]){let o=fl({event:a}),s=o==null?void 0:o.drawDetails;ln(s)?(Object.assign(n,s),i.push(...Object.keys(s).filter(l=>zW({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:n}}function ON({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:u,roundNumber:c})=>`${s}|${l}|${u}${c}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,u)=>(l.sortOrder||0)-(u.sortOrder||0)).forEach(({eventId:l,drawId:u,structureId:c,roundNumber:d},p)=>{let f=n({eventId:l,drawId:u,structureId:c,roundNumber:d});i[f]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},u=l.scheduledDate&&Bt(l.scheduledDate)||l.scheduledTime&&Bt(l.scheduledTime)||"noScheduledDate";a[u]||(a[u]=[]),a[u].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],u={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},f=p.scheduledTime&&an(p.scheduledTime)||"noScheduledTime";u[f]||(u[f]=[]),u[f].push(d)}let c=Object.keys(u).sort();for(let d of c){let p=u[d];p.sort((f,h)=>{let m=i[n(f)]||0,g=i[n(h)]||0;return m-g}),r.push(...p)}}return r}function h5({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Se};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],u=Math.max(0,...l.map(c=>c.schedule.courtOrder||0));return u>o?u:o},1),r=e?Math.max(e,n):n,a=Je(0,r).map(o=>({matchUps:Je(0,i.length).map(s=>{let l=i[s],{courtId:u,venueId:c}=l;return{schedule:{courtOrder:o+1,venueId:c,courtId:u}}})}));return i.forEach((o,s)=>{var l;for(let u of o.matchUps){let c=(l=u.schedule)==null?void 0:l.courtOrder;c&&(a[c-1].matchUps[s]=u)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,u)=>({[`${t}${u}`]:l}))))}}function ix(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,usePublishState:d,contextFilters:p,matchUpFilters:f,contextProfile:h,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Oi};let{eventId:I,eventName:T,endDate:w,eventType:S,category:U,gender:P}=b??{},E={...y,...ft({surfaceCategory:b.surfaceCategory??(c==null?void 0:c.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(c==null?void 0:c.indoorOutdoor),tournamentId:g??(c==null?void 0:c.tournamentId),endDate:w??(c==null?void 0:c.endDate),eventName:T,eventType:S,category:U,eventId:I,gender:P})},D;!e&&c&&({participants:e,participantMap:n,groupInfo:D}=Ib({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:c,contextProfile:h,inContext:v})),h&&!i&&(i=uf({policyDefinitions:l,tournamentRecord:c,contextProfile:h,event:b}));let R=fl({event:b});return{...(b.drawDefinitions??[]).reduce((N,M)=>{var A;let _=fS({context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:c,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:f,participantMap:n,publishStatus:R,contextProfile:h,drawDefinition:M,nextMatchUps:m,inContext:v,event:b});return(A=Object.keys(_))==null||A.forEach(k=>{Array.isArray(_[k])&&(N[k]||(N[k]=[]),N[k]=N[k].concat(_[k]))}),N},{}),...ae,groupInfo:D}}function nx(t){if(!(t!=null&&t.tournamentRecord))return{error:Oe};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:c,matchUpFilters:d,contextProfile:p,nextMatchUps:f,context:h}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=Ib({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=uf({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:I}=Ai({tournamentRecord:s}),T=(c==null?void 0:c.eventIds)??[];return{...g.filter(w=>!T.includes(w.eventId)).map(w=>{var S,U,P;let E={eventDrawsCount:((U=(S=Hn({event:w}).flightProfile)==null?void 0:S.flights)==null?void 0:U.length)||((P=w.drawDefinitions)==null?void 0:P.length)||0,...h};return ix({context:E,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:c,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:f,inContext:l,event:w})}).reduce((w,S)=>{var U;return(U=S&&Object.keys(S).filter(P=>!["success","matchUpsMap"].includes(P)))==null||U.forEach(P=>{Array.isArray(S[P])&&(w[P]||(w[P]=[]),w[P]=w[P].concat(S[P]),w.matchUpsCount+=S[P].length)}),w},{matchUpsCount:0}),groupInfo:b}}function s1({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Rn};let u=Object.keys(i).map(d=>{let p=i[d];return nx({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),c={};return{...u.reduce((d,p)=>(Object.keys(p).forEach(f=>{Array.isArray(p[f])&&(d[f]||(d[f]=[]),d[f]=d[f].concat(p[f])),f==="groupInfo"&&Object.assign(c,p[f])}),d),{}),groupInfo:c}}function hE(t){var e,i,n,r,a,o,s,l;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Rn};let{courts:u,venues:c}=pf(t),d=ff(t).schedulingProfile,{sortDateMatchUps:p=!0,courtCompletedMatchUps:f,alwaysReturnCompleted:h,activeTournamentId:m,tournamentRecords:g,withCourtGridRows:v,minCourtGridRows:y,usePublishState:b,status:I=ou,sortCourtsData:T}=t,w=b?(i=(e=VP({tournamentRecord:g[m??db()],itemType:`${Bg}.${$g}`}).timeItem)==null?void 0:e.itemValue)==null?void 0:i[I]:void 0,S=h?s1({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Zn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(b&&(!w||!Object.keys(w).length))return{completedMatchUps:S,dateMatchUps:[],courtsData:[],venues:c};let U,P;b&&({drawIds:U,detailsMap:P}=R3e({tournamentRecords:g})),U!=null&&U.length&&(t.contextFilters||(t.contextFilters={}),(n=t.contextFilters)!=null&&n.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>U.includes(F)):t.contextFilters.drawIds=U),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(a=t.matchUpFilters)!=null&&a.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>w.eventIds.includes(F)):t.matchUpFilters.eventIds=w.eventIds),(o=w==null?void 0:w.scheduledDates)!=null&&o.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>w.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=w.scheduledDates),h&&(t.matchUpFilters||(t.matchUpFilters={}),(l=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&l.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Zn)||t.matchUpFilters.excludeMatchUpStatuses.push(Zn):t.matchUpFilters.excludeMatchUpStatuses=[Zn]);let{completedMatchUps:E,upcomingMatchUps:D,pendingMatchUps:R,groupInfo:N}=s1({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),M=[...D??[],...R??[]];P&&Object.keys(P).length&&(M=M.filter(F=>{let{drawId:x,structureId:$,stage:j}=F;if(!P[x])return!1;if(P[x].stageDetails){let V=Object.keys(P[x].stageDetails),H=V.filter(q=>!P[x].stageDetails[q].published),z=V.filter(q=>P[x].stageDetails[q].published);return H.length&&H.includes(j)?!1:z.length&&z.includes(j)?!0:H.length&&!H.includes(j)&&!z.length}if(P[x].structureDetails){let V=Object.keys(P[x].structureDetails),H=V.filter(q=>!P[x].structureDetails[q].published),z=V.filter(q=>P[x].structureDetails[q].published);return H.length&&H.includes($)?!1:z.length&&z.includes($)?!0:H.length&&!H.includes($)&&!z.length}return!0}));let A=p?ON({matchUps:M,schedulingProfile:d}):M,_=u==null?void 0:u.map(F=>{let x=B(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:x,...F}}),k={completedMatchUps:h?S:E,dateMatchUps:A,courtsData:_,groupInfo:N,venues:c};if(v){let{rows:F,courtPrefix:x}=h5({minRowsCount:y,courtsData:_});k.courtPrefix=x,k.rows=F}return{...k,...ae};function B({courtId:F}){let x=(f?A.concat(E??[]):A).filter($=>{var j,V,H;return((j=$.schedule)==null?void 0:j.courtId)===F||((H=(V=$.schedule)==null?void 0:V.allocatedCourts)==null?void 0:H.map(({courtId:z})=>z).includes(F))});return T?ON({matchUps:x,schedulingProfile:d}):x}}function rx({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Rn};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=M3e({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function M3e(t){var e;let i=wi(t,[{[Fd]:!0}]);if(i.error)return i;let{tournamentRecord:n}=t,{policy:r}=Fg({policyType:jh,tournamentRecord:n}),{extension:a}=qt({element:n,name:IP}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function m5(t){var e,i,n,r;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:c,zoneDoubling:d,matchUpType:p,scaleName:f,eventId:h,zonePct:m,drawId:g,event:v}=t;if(!s&&!a)return{error:Oe};if(p&&![Pn,Yi].includes(p))return{error:Se,info:{matchUpType:p}};if(a&&!pl(a))return{error:Se,context:{matchUps:a}};let y=ds[f],b=(y==null?void 0:y.ascending)??t.ascending??!1,I=(y==null?void 0:y.accessor)??t.valueAccessor,T=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=At(m)&&T?(m??0/100)*T:t.zoneMargin??T,S={withScaleValues:!0,withCompetitiveness:!0},U={matchUpTypes:p?[p]:[Pn,Yi]},P=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(B=>B.drawId===g):h&&(a=a.filter(B=>B.eventId===h)):a===void 0&&(a=g&&!l&&[]||!g&&h&&!v&&[]||g&&((i=po({inContext:!0,drawDefinition:l,contextFilters:U,contextProfile:S,participants:P}))==null?void 0:i.matchUps)||!g&&h&&((n=cf({inContext:!0,contextFilters:U,contextProfile:S,participants:P,event:v}))==null?void 0:n.matchUps)||((r=Xr({tournamentRecord:s,contextFilters:U,contextProfile:S}))==null?void 0:r.matchUps)||[]),p&&(a=a.filter(B=>B.matchUpType===p));let E=a.filter(({winningSide:B,score:F,sides:x,matchUpStatus:$})=>![xa,bi,Ni,aS,vs].includes($??"")&&Jr({score:F})&&(x==null?void 0:x.length)===2&&B),D=A3e({matchUps:E,excludeMargin:u,exclusionRule:c,valueAccessor:I,ascending:b,scaleName:f}),R=!d||xn(Pn)(p)?w:(w||0)*2,N=w?E.map(({competitiveProfile:B,matchUpType:F,score:x,sides:$})=>{let j=xve({singlesForDoubles:o,valueAccessor:I,matchUpType:F,scaleName:f,sides:$}),V=Math.abs(j[0].value-j[1].value);return{competitiveness:B==null?void 0:B.competitiveness,valuesGap:V,score:x}}).filter(({valuesGap:B})=>B<=R):[],M=N3e({zoneData:N}),A=M&&[].concat(Object.values(M)).flat().length,_=A&&Object.assign({},...Object.keys(M).map(B=>({[B]:Math.round(1e4*M[B].length/A)/100}))),k=E.length-((N==null?void 0:N.length)||0);return{...ae,relevantMatchUps:E,zoneDistribution:_,zoneData:N,accuracy:D,nonZone:k}}function N3e({zoneData:t}){let e={[MW]:[],[QU]:[],[e1]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function xve({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let u=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&u>=o[0]&&u<=o[1],exclusionValue:u}};return a.sort((l,u)=>l.sideNumber-u.sideNumber).map(({participant:l})=>{let u=[],c=l==null?void 0:l.individualParticipants;if(c!=null&&c.length){let d=[],p=0;for(let f of c){let{scaleValue:h,value:m}=YK({singlesForDoubles:t,valueAccessor:i,participant:f,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(h);g&&u.push(v),d.push(h),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:u,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=YK({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:f,exclusionValue:h}=s(d);return f&&u.push(h),{participantName:l.participantName,exclusionValues:u,scaleValue:d,value:p}}else return{}})}function YK({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var a,o,s,l,u;let c=t?Pn:i,d=(o=(a=n==null?void 0:n.rankings)==null?void 0:a[c])==null?void 0:o.find(h=>h.scaleName===r),p=(u=((l=(s=n==null?void 0:n.ratings)==null?void 0:s[c])==null?void 0:l.find(h=>h.scaleName===r))||d)==null?void 0:u.scaleValue,f=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:f}}function A3e({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:c,sides:d,score:p,winningSide:f}=u;if(!f)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:dt};let h=f-1,m=xve({exclusionRule:e,valueAccessor:i,matchUpType:c,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:w})=>w).flat();if(T.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:f,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:f,sideValues:m});continue}let g=m[h].value-m[1-h].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:f,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=f===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?o.affirmative.push({winningScoreString:I,winningSide:f,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:I,winningSide:f,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Mb({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=tme({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:u,matchUpValue:c,scoreValue:d,setValue:p}=a,f=s&&n.includes(s);if(At(p||d))r=!0;else{if(f)continue;if(typeof l=="number"&&At(l))i+=l;else if(o!=null&&o.length)for(let h of o)i+=h.matchUpValue;else typeof c=="number"&&At(c)&&(i+=(u??0)*c)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...ae}:{valueGoal:Math.floor(i/2)+1,...ae}}function g5({matchUps:t,matchUpId:e}){if(!pl(t))return{error:Se};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function mE(t,e){if(!ln(t))return{error:Se};if(!Array.isArray(e))return{error:Se};let i={};for(let{param:n,error:r,attr:a}of e){let o=_3e({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function _3e({params:t,param:e,attr:i,error:n}){if(e===zq&&ln(t.drawDefinition)&&mo(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===$h){let r=Dve({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Pa,info:{param:e}}}function v5(t){var e,i;let{structureId:n,matchUpId:r,event:a}=t,o=t.drawDefinition,s=wi(t,[{[Fd]:!0},{[qq]:{[jq]:!1,[_g]:!1,[Ipe]:!1,[eS]:!1}}]);if(s[_v])return s;let l=(e=mE(t,[{[vP]:$h,[_v]:dt}]))==null?void 0:e.matchUp;if(r&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let u=l==null?void 0:l.structure;if(!u&&n&&!r){if(!o)return{error:Ku};let h=Pt({drawDefinition:o,structureId:n});if(h.error)return h;u=h.structure}let c=u==null?void 0:u.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,f=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||c||d||p;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:f}}function y5({profileBands:t,tournamentRecord:e,matchUps:i}){if(!pl(i))return{error:Ld};let n=!t&&Fg({policyType:rp,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||NW[rp].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(ffe),s=(p,f)=>{let h=pfe(f,r);return p[h]+=1,p},l=hfe(o).reduce((p,f)=>s(p,f),{[MW]:0,[QU]:0,[e1]:0,[dfe]:0}),u=Object.keys(l).reduce((p,f)=>(l[f]||0)+p,0),c=Object.keys(l).map(p=>{let f=parseFloat((l[p]/u).toFixed(4));return{[p]:f*100}}),d=a.filter(({matchUpStatus:p})=>p===mK).length;return c.push({[mK]:parseFloat((d/u).toFixed(4))*100}),{competitiveBands:Object.assign({},...c),...ae}}var{stageOrder:ZK}=R$e;function k3e(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(ZK[t==null?void 0:t.stage]||0)-(ZK[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function b5({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:c,venueId:d,context:p}){var f;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Se,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:sP};r={[o.tournamentId]:o}}let h=typeof r!="object"||!Object.keys(r).length;if((d||u||!n||!a&&(t||i||a||s))&&h)return{error:Rn};let m=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:P})=>P)}))),g=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:P,endDate:E})=>S.map(D=>({...D,validVenueIds:m[U],startDate:D.startDate??P,endDate:D.endDate??E}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||a||s)&&QO({tournamentRecords:r,schedulingProfile:a})||{},b=t&&Object.assign({},...y.map(S=>({[S.id]:S}))),I=n||r&&((f=Vu({tournamentRecords:r,matchUpFilters:l}))==null?void 0:f.matchUps)||[],T=[],w=I&&Object.values(I.reduce((S,U)=>{var P;let E=p$(U).id,D=v==null?void 0:v[E],R=[...((P=S[E])==null?void 0:P.matchUps)??[],U],{containerStructureId:N,stageSequence:M,structureName:A,tournamentId:_,isRoundRobin:k,matchUpType:B,roundNumber:F,roundOffset:x,structureId:$,eventName:j,roundName:V,drawName:H,eventId:z,drawId:q}=U,W=k?N:$;return{...S,[E]:{id:c?E:void 0,structureId:W,stageSequence:M,segmentsCount:D,structureName:A,tournamentId:_,matchUpType:B,roundNumber:F,roundOffset:x,eventName:j,roundName:V,drawName:H,matchUps:R,eventId:z,drawId:q}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:P}=E3e(S.matchUps),E=S.segmentsCount;if(E){let B=S.matchUps.length/E;return Yr(S.matchUps.sort((F,x)=>F.roundPosition-x.roundPosition),B).map((F,x)=>{let{unscheduledCount:$,incompleteCount:j,matchUpsCount:V,isScheduled:H,isComplete:z,byeCount:q}=KK(F),W=WK({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return ft({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:x+1},winnerFinishingPositionRange:P,unscheduledCount:$,incompleteCount:j,minFinishingSum:U,matchUpsCount:V,isScheduled:H,roundTiming:W,isComplete:z,byeCount:q,matchUps:F})})}let{unscheduledCount:D,incompleteCount:R,matchUpsCount:N,isScheduled:M,isComplete:A,byeCount:_}=KK(S.matchUps),k=WK({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return ft({...S,...p,winnerFinishingPositionRange:P,unscheduledCount:D,incompleteCount:R,minFinishingSum:U,matchUpsCount:N,isScheduled:M,roundTiming:k,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let x=Bt(t),$=c?S.id:p$(S).id;if(x&&b[$]&&Bt(b[$].scheduleDate)===x)return!1}let{isComplete:U,isScheduled:P}=S,E=!i||!U,D=!e||!P,R=d||u?g==null?void 0:g.find(({eventId:x})=>x===S.eventId):void 0,N=(R==null?void 0:R.startDate)??(o==null?void 0:o.startDate),M=(R==null?void 0:R.endDate)??(o==null?void 0:o.endDate),A=!u||!N||new Date(u)>=new Date(N),_=!u||!M||new Date(u)<=new Date(M),k=A&&_,B=!d||(R==null?void 0:R.validVenueIds.includes(d)),F=E&&D&&B&&k;return F||T.push(S),F}).sort(k3e)||[];return{...ae,rounds:w,excludedRounds:T}}function l1(t){var e;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:No};s=s||(i==null?void 0:i.matchUpFormat);let l=bo(s),u=!!(i!=null&&i.winningSide),c=(e=i.score)==null?void 0:e.sets,d=c==null?void 0:c.length,p=r&&r-1,f=!!(c!=null&&c.find((z,q)=>z.setNumber===r&&q===p)),h=(c==null?void 0:c.filter(z=>z==null?void 0:z.winningSide))||[],m=(h==null?void 0:h.length)||0,g=r&&(c==null?void 0:c.slice(r))||[],v=!!(d&&r&&g!=null&&g.reduce((z,q)=>(!q||!q.side1Score&&!q.side2Score&&!q.side1TiebreakScore&&!q.side2TiebreakScore&&!q.side1PointScore&&!q.side2PointScore)&&z,!0)),y=r<=d&&c.find(z=>z.setNumber===r),b=y&&o1({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:I,sideGameScores:T,sideTiebreakScores:w}=b||{},S=!!(y&&!I&&v||r&&r===d+1&&!u),U=[1,2].includes(n),P=U?n-1:0,E=y&&U&&(!a&&!o&&T[P]!==void 0&&T[P]||a&&w[P]!==void 0&&w[P]),D=!!E,R=h==null?void 0:h.map(z=>o1({setObject:z,matchUpScoringFormat:l}).isValidSetOutcome).reduce((z,q)=>z&&q,!0),N=h.reduce((z,q)=>{let{winningSide:W}=q,Y=W-1;return z[Y]++,z},[0,0]),M=i==null?void 0:i.winningSide,A=M&&M-1,_=1-A,k=N[A],B=N[_],F=Math.max(...N),x=ts(N)[F],{bestOf:$}=l??{},j=$&&Math.ceil($/2)||1,V=F===j&&x===1&&N.indexOf(F)+1||void 0,H=k>B&&M===V;return{completedSetsHaveValidOutcomes:R,validMatchUpWinningSide:H,calculatedWinningSide:V,matchUpScoringFormat:l,validMatchUpOutcome:V&&R&&H,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:u,isValidSideNumber:U,hasExistingValue:D,existingValue:E,isExistingSet:f,isActiveSet:S,...b}}function I5({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:c,matchUpFilters:d,participantMap:p,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:w,endDate:S,eventType:U,category:P,gender:E}=I??{},D={...b,...ft({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:U,category:P,eventId:T,gender:E})},R;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:R}=Ib({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:y})),I&&h&&!c&&(c=uf({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:m,event:I})),{...fS({context:D,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:c,contextFilters:u,matchUpFilters:d,publishStatus:f,contextProfile:h,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:R}}var Lve={};Yt(Lve,{getCompetitionVenues:()=>cE,getCourts:()=>w5,getVenuesAndCourts:()=>pf,publicFindVenue:()=>xW});function w5({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=ut(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:Oe}}var Fve={};Yt(Fve,{categoryCanContain:()=>MO,getCategoryAgeDetails:()=>nE,getEvent:()=>U5,getEventProperties:()=>S5,getEventStructures:()=>UO,getEventTimeItem:()=>$P,getEvents:()=>T5,getFlightProfile:()=>Hn,getScaledEntries:()=>Cb});function S5({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:Oe};if(!e)return{error:Oi};let r=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:s}=e,l=r.map(f=>f.participantId),u=a.filter(f=>l.includes(f.participantId)),c,d,p;return{entryScaleAttributes:u.map(f=>{var h,m,g,v,y,b;let{participantId:I,participantName:T,name:w}=f,S={scaleType:kW,eventType:s,scaleName:o},U=(m=(h=ud({participant:f,scaleAttributes:S}))==null?void 0:h.scaleItem)==null?void 0:m.scaleValue;S={scaleType:Ufe,eventType:s,scaleName:o};let P=(v=(g=ud({participant:f,scaleAttributes:S}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;S={scaleType:Tfe,eventType:s,scaleName:o};let E=(b=(y=ud({participant:f,scaleAttributes:S}))==null?void 0:y.scaleItem)==null?void 0:b.scaleValue;return c=!!(c||U),d=!!(d||P),p=!!(p||E),{participantId:I,participantName:T||w,seed:U,ranking:P,rating:E}}),hasSeededParticipants:c,hasRankedParticipants:d,hasRatedParticipants:p}}function T5({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var s,l,u,c;if(!t)return{error:Oe};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:h})=>!r||Array.isArray(r)&&r.includes(h)).map(h=>{var m;let g=(m=h.drawDefinitions)==null?void 0:m.map(WU);if(a!=null&&a.length&&!$n(a,g).length)return;let v=ut(h);return n&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),f={};if(e){let h=jn({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;f[y]||(f[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>au.includes(E)).map(ei),I=E=>{var D,R,N,M,A,_;if((D=E==null?void 0:E.ratings)!=null&&D[v])for(let k of((R=E==null?void 0:E.ratings)==null?void 0:R[v])??[]){let B=k.scaleName;f[y].ratings[B]||(f[y].ratings[B]=[]);let F=(N=ds[B])==null?void 0:N.accessor;if(F){let x=parseFloat((M=k.scaleValue)==null?void 0:M[F]);x&&f[y].ratings[B].push(x)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let k of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){let B=k.scaleName;f[y].ranking[B]||(f[y].ranking[B]=[]),k.scaleValue&&f[y].ranking[B].push(k.scaleValue)}};for(let E of b){let D=(s=h==null?void 0:h[E])==null?void 0:s.participant;if((D==null?void 0:D.participantType)!==ti)for(let R of(D==null?void 0:D.individualParticipantIds)??[]){let N=(l=h==null?void 0:h[R])==null?void 0:l.participant;I(N)}else I(D)}let T=f[y].ratings;for(let E of Object.keys(T)){let D=T[E];if(!D.length)continue;let R=(u=dK(D))==null?void 0:u.toFixed(2);f[y].ratingsStats[E]={avg:parseFloat((m(D)/D.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...D),min:Math.min(...D)}}let w=(E,D)=>{var R,N;let M=A=>{var _,k,B,F,x,$,j,V,H,z;if((_=f[y].draws)!=null&&_[E]&&(k=A==null?void 0:A.ratings)!=null&&k[v])for(let q of((B=A==null?void 0:A.ratings)==null?void 0:B[v])??[]){let W=q.scaleName;(F=f[y].draws[E])!=null&&F.ratings[W]||(f[y].draws[E].ratings[W]=[]);let Y=(x=ds[W])==null?void 0:x.accessor;if(Y){let Z=parseFloat(($=q.scaleValue)==null?void 0:$[Y]);Z&&f[y].draws[E].ratings[W].push(Z)}}if((j=f[y].draws)!=null&&j[E]&&(V=A==null?void 0:A.rankings)!=null&&V[v])for(let q of((H=A==null?void 0:A.rankings)==null?void 0:H[v])??[]){let W=q.scaleName;(z=f[y].draws[E])!=null&&z.ranking[W]||(f[y].draws[E].ranking[W]=[]);let Y=q.scaleValue;Y&&f[y].draws[E].ranking[W].push(Y)}};for(let A of D.filter(Boolean)){let _=(R=h==null?void 0:h[A])==null?void 0:R.participant;if((_==null?void 0:_.participantType)!==ti)for(let k of(_==null?void 0:_.individualParticipantIds)??[]){let B=(N=h==null?void 0:h[k])==null?void 0:N.participant;M(B)}else M(_)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let D=E.drawId;if(U(D))continue;let R=Gg({drawDefinition:E}).assignedParticipantIds??[];f[y].draws[D]||(f[y].draws[D]={ratingsStats:{},ratings:{},ranking:{}}),S.push(D),w(D,R)}let P=Hn({event:g}).flightProfile;for(let E of(P==null?void 0:P.flights)??[]){let D=E.drawId;if(U(D))continue;let R=E.drawEntries.map(ei);w(D,R)}for(let E of S){let D=f[y].draws[E].ratings;for(let R of Object.keys(D)){let N=D[R];if(!N.length)continue;let M=(c=dK(N))==null?void 0:c.toFixed(2);f[y].draws[E].ratingsStats[R]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return ft({eventScaleValues:f,events:p,...ae})}function U5({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:Oe};if(!n)return{error:Oi};let a=ut(n);i&&Object.assign(a,i);let o=e&&((r=a.drawDefinitions)==null?void 0:r.find(({drawId:s})=>e.drawId===s));return ft({drawDefinition:o,event:a})}function O3e(t){var e,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=F3e(t),o=B3e({...t,policyDefinitions:a,appliedPolicies:r}),s=L3e(t),l=$3e({...t,consideredEntries:s,appliedPolicies:r});if(l!=null&&l.error)return ue({result:l,stack:n});let u=V3e({...t,consideredEntries:s}),c=x3e({...t,appliedPolicies:r,policyDefinitions:a,drawSize:u});if(c.error)return ue({result:c,stack:n});let d=c.drawType;if(isNaN(u)&&d!==ql)return ue({result:{error:uP},stack:n});let p=(a==null?void 0:a[Dl])??(r==null?void 0:r[Dl]),f=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[Dl]||(a[Dl]={...d$[Dl]}),a[Dl].seedingProfile=f);let h=j3e({...t,drawType:d});return h!=null&&h.error?ue({result:h,stack:n}):{drawSize:u,drawType:d,enforceGender:o,seedingProfile:f,appliedPolicies:r,policyDefinitions:a}}function x3e(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??lE({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=Mme({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function Bve(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...au,_P].includes(e.entryStatus))}function L3e({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||Bve(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===at)}function F3e(t){let{tournamentRecord:e,event:i}=t,n=Ai({tournamentRecord:e,event:i}).appliedPolicies??{},r=ut(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function B3e({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[Vr])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[Vr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function $3e(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&LO({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function V3e(t){return!t.drawSize&&t.consideredEntries.length&&![ql,SP,oS,Wl,Ad].includes(t.drawType??"")&&Q0(t.consideredEntries.length)||t.drawSize&&Tt(t.drawSize)||!1}function j3e(t){var e,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&n&&qO({tournamentRecord:n,categoryType:(e=r==null?void 0:r.category)==null?void 0:e.categoryType,categoryName:(i=r==null?void 0:r.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:lq}:{...ae}}function ax(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=jn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Bve(n==null?void 0:n.entries)??[],l=O3e({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ue({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:c,drawSize:d,drawType:p,enforceGender:f,seedingProfile:h}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=Hze({...t,enforceGender:f,eventType:m,matchUpType:g});if(v.error)return ue({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return ue({result:{error:Se},stack:r});let I=y3e({...t,isMock:t.isMock??!0,policyDefinitions:c,tournamentRecord:i,appliedPolicies:u,matchUpFormat:y,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return ue({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:w,drawDefinition:S,structureId:U,conflicts:P,entries:E}=I;if(!S)return ue({result:{error:Se},stack:r});let D=b3e({...t,existingDrawDefinition:T,positioningReports:w,appliedPolicies:u,drawDefinition:S,seedingProfile:h,participants:a,structureId:U,entries:E,params:t,stack:r});if(D.error)return D;let{qualifyingConflicts:R}=D;return S.drawName=t.drawName??(p&&ca(p)),d&&typeof e=="object"&&d>=4&&XW({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:R,positioningReports:w,drawDefinition:S,structureId:U,...ae,conflicts:P}}function $ve({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:dt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:sd,scaleName:r,scaleDate:o}],participantId:s}))}}function G3e({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:c}){let d=ex({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:f,stageEntries:h}=d;if(!h||!f)return{error:Se};let m=Cb({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:c,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=$ve({scaleAttributes:n,scaledEntries:m,stageEntries:h,seedsCount:f,scaleName:r});return{scaleItemsWithParticipantIds:g}}var Vve={};Yt(Vve,{addDrawEntries:()=>qW,addEventEntries:()=>cd,addEventEntryPairs:()=>qve,destroyPairEntries:()=>ohe,destroyPairEntry:()=>ZW,getEntriesAndSeedsCount:()=>ex,getMaxEntryPosition:()=>u5,modifyEntriesStatus:()=>SN,modifyEventEntries:()=>Wve,mutate:()=>jve,promoteAlternate:()=>Hve,promoteAlternates:()=>P5,query:()=>Ave,removeDrawEntries:()=>zve,removeEventEntries:()=>qP,setEntryPosition:()=>D5,setEntryPositions:()=>Gve});var jve={};Yt(jve,{addDrawEntries:()=>qW,addEventEntries:()=>cd,addEventEntryPairs:()=>qve,destroyPairEntries:()=>ohe,destroyPairEntry:()=>ZW,modifyEntriesStatus:()=>SN,modifyEventEntries:()=>Wve,promoteAlternate:()=>Hve,promoteAlternates:()=>P5,removeDrawEntries:()=>zve,removeEventEntries:()=>qP,setEntryPosition:()=>D5,setEntryPositions:()=>Gve});function D5({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:Oe};if(!i)return ue({result:{error:wr},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Se,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(u=>{u.entryPosition===n&&u.participantId!==i&&(u.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=_u({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=_u({entries:e.entries}))),{...ae}}function Gve({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:Oe};if(!Array.isArray(e))return{error:Se};for(let r of e){let{participantId:a,entryPosition:o}=r,s=D5({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=_u({entries:n.entries})),i!=null&&i.entries&&(i.entries=_u({entries:i.entries})),{...ae}}function Hve(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Se,participantId:e}:P5({...t,participantIds:[e].filter(Boolean)})}function P5({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=at,eventId:a,event:o}){if(!t)return{error:Oe};if(!Array.isArray(i))return{error:Se,participantIds:i};if(!o)return{error:Oi};let s="promoteAlternates";if(o){let l=XK({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=XK({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?ue({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ae},stack:s}):l}return{...ae}}function XK({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===xl),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:f}=p;return isNaN(f)&&d||(!d||f<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:Ede};let l=s.filter(({entryStatus:d})=>d!==xl);if(l.length)return{error:PB,invalidEntryStatus:l};let u=s.filter(({entryStage:d})=>d&&d!==n);if(u.length)return{error:Z2e,invalidStage:u};let c=e&&s.filter(d=>d.stageSequence!==e);if(c!=null&&c.length)return{error:X2e,invalidStageSequence:c};for(let d of s){d.entryStatus=ys;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===xl&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let f=Math.max(...i.entries.filter(h=>h.entryStatus===ys&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Tt(h||0)),0);d.entryPosition=f||0}return{...ae}}function zve({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var o;if(!a)return{error:Oi};if(!n)return{error:Ku};if(!(e!=null&&e.length))return{error:Fh};let s=Gg({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(eo(s,e))return{error:Z0};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:u}=Hn({event:a}),c=(o=u==null?void 0:u.flights)==null?void 0:o.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(l),t&&(c.drawEntries=_u({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=_u({entries:i.entries}))),{...ae}}function Ec(t){var e,i,n,r,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:c,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:Oe};if(!d)return ue({result:{error:cb},stack:o});d.participantId||(d.participantId=Li()),p.participants||(p.participants=[]);let{participantId:f,individualParticipantIds:h}=d;if(p.participants.reduce((I,T)=>T.participantId===f||I,!1))return{error:Sde};let{participantType:m,participantRole:g}=d;if(!m||!Object.keys(OT).includes(m))return{error:Bu,participantType:m};if(!g)return{error:wde};let v=p.participants||[],y=v.filter(I=>I.participantType===ti).map(I=>I.participantId);if(m!==ti&&d.person)return{error:Se,person:d.person};if(h&&!Array.isArray(h))return{error:Se,individualParticipantIds:h};if(m===xt){if(d.person)return{error:Se,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!c)return ue({info:"PAIR must be 2 individualParticipantIds",result:{error:Ol},stack:o});{let w=v.filter(S=>S.participantType===ti).map(S=>S.participantId);if(!Array.isArray(d.individualParticipantIds))return ue({result:{error:Ol},stack:o});if(!d.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return ue({result:{error:Ol},stack:o})}}else return ue({result:{error:Fh},stack:o});let I=v.filter(w=>w.participantType===xt).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),T=d.participantType===xt&&I.find(w=>$n(w.individualParticipantIds,d.individualParticipantIds).length===2);if(T&&!s)return{...ae,existingParticipant:!0,participant:l&&ut(T.participant)};if(!d.participantName){let w=v.filter(U=>{var P;return(P=d.individualParticipantIds)==null?void 0:P.includes(U.participantId)}),S=w.map(U=>{var P;return(P=U.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),d.participantName=S}}else if(m===ti){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:Pde};if(!d.participantName){let I=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=I}}else if(m&&[qi,Us].includes(m)){if(h||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let I of d.individualParticipantIds){if(typeof I!="string")return ue({result:{participantId:I,error:Se},stack:o});if(!y.includes(I))return ue({result:{participantId:I,error:qn},stack:o})}}else return{error:Bu};p.participants.push(d),u||oi({payload:{tournamentId:p.tournamentId,participants:[d]},topic:hh});let b={participant:l&&ut(d),...ae};return ft(b)}function ju({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Oe};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=Li())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===ti),l=a.filter(d=>d.participantType!==ti),u=s.concat(...l),c=[];if(u.length){for(let p of u){let f=Ec({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(f.error)return f;f.success&&!f.existingParticipant&&c.push(f.participant)}c.length&&oi({topic:hh,payload:{tournamentId:i.tournamentId,participants:c}});let d={participants:e&&ut(c),addedCount:c.length,...ae};return o.length&&Object.assign(d,{notAdded:o,info:jk}),ft(d)}else return{info:"No new participants to add",addedCount:0,...ae}}function qve({allowDuplicateParticipantIdPairs:t,entryStage:e=at,entryStatus:i=xl,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:Oe};if(!o)return{error:Oi};if(o.eventType!==Yi)return{error:ch};let l=[],u=new Map;for(let y of r.participants??[]){let{participantType:b,participantId:I,person:T,individualParticipantIds:w}=y;b===ti&&T!=null&&T.sex?u.set(I,T.sex):b===xt&&w&&l.push(w)}let c=n.filter(y=>{if(y.length!==2||!u.has(y[0])||!u.has(y[1]))return!0;if(!o.gender||o.gender===Uc)return!1;let b=y.map(T=>u.get(T)),I=o.gender===Ki&&(b[0]!==Ki||b[1]!==Ki)||o.gender===vn&&(b[0]!==vn||b[1]!==vn);return o.gender===Ho&&(b.sort(IO),(b[0]!==vn||b[1]!==Ki)&&(I=!0)),I});if(c.length)return{error:Ol,invalidParticipantIdPairs:c};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??Li(),participantRole:Sa,individualParticipantIds:y,participantType:xt})),p=t?d:d.filter(y=>!l.find(b=>$n(b,y.individualParticipantIds).length===2)),f,h=[];if(p){let y=ju({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;h=y.participants||[],f=y.info}let m=n.map(y=>{let b=h.find(T=>$n(T.individualParticipantIds,y).length===2);if(b)return b;let{participant:I}=Yl({tournamentRecord:r,participantIds:y});return I}).map(y=>y.participantId),g=cd({participantIds:m,tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&oi({payload:{participants:p},topic:hh});let v=p.map(ei);return{...g,info:f,newParticipantIds:v}}function Wve({entryStatus:t=ys,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=at,tournamentRecord:r,event:a}){if(!r)return{error:Oe};if(!a)return{error:Oi};let o=r.participants??[],s=o.filter(m=>m.participantType===ti).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:Ol,invalidParticipantIds:l};let u=i.filter(m=>m.length!==2);if(u.length)return{error:Ol,invalidParticipantIdPairs:u};let c=o.filter(m=>m.participantType===xt).map(m=>m.individualParticipantIds),d=i.filter(m=>!c.find(g=>$n(g,m).length===2)).map(m=>({participantType:xt,participantRole:Sa,individualParticipantIds:m})),p=ju({participants:d,tournamentRecord:r});if(p.error)return p;let f=i.map(m=>{let{participant:g}=Yl({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),h=e.map(m=>({entryStatus:ru,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...f,...h),{...ae}}var Kve={};Yt(Kve,{addDrawDefinition:()=>lx,addEvent:()=>gE,addFlight:()=>cx,assignSeedPositions:()=>rye,attachFlightProfile:()=>A5,categoryCanContain:()=>MO,deleteDrawDefinitions:()=>ox,deleteEvents:()=>oye,deleteFlightAndFlightDraw:()=>iye,deleteFlightProfileAndFlightDraws:()=>Jve,getCategoryAgeDetails:()=>nE,getEvent:()=>U5,getEventProperties:()=>S5,getEventStructures:()=>UO,getEventTimeItem:()=>$P,getEvents:()=>T5,getFlightProfile:()=>Hn,getScaledEntries:()=>Cb,modifyEvent:()=>sye,modifyEventMatchUpFormatTiming:()=>Qve,modifyPairAssignment:()=>nye,mutate:()=>Yve,query:()=>Fve,refreshEventDrawOrder:()=>N5,removeEventMatchUpFormatTiming:()=>sx,removeScaleValues:()=>_5,removeSeeding:()=>aye,setEventDates:()=>eye,setEventDisplay:()=>ux,setEventEndDate:()=>R5,setEventStartDate:()=>C5,updateDrawIdsOrder:()=>M5,validateCategory:()=>CN});var Yve={};Yt(Yve,{addDrawDefinition:()=>lx,addEvent:()=>gE,addFlight:()=>cx,assignSeedPositions:()=>rye,attachFlightProfile:()=>A5,deleteDrawDefinitions:()=>ox,deleteEvents:()=>oye,deleteFlightAndFlightDraw:()=>iye,deleteFlightProfileAndFlightDraws:()=>Jve,modifyEvent:()=>sye,modifyEventMatchUpFormatTiming:()=>Qve,modifyPairAssignment:()=>nye,refreshEventDrawOrder:()=>N5,removeEventMatchUpFormatTiming:()=>sx,removeScaleValues:()=>_5,removeSeeding:()=>aye,setEventDates:()=>eye,setEventDisplay:()=>ux,setEventEndDate:()=>R5,setEventStartDate:()=>C5,updateDrawIdsOrder:()=>M5,validateCategory:()=>CN});function IS({removePriorValues:t=!0,status:e=ou,statusObject:i,event:n}){if(!ln(i))return{error:Se};let r=fl({event:n,status:e}),a=`${Bg}.${$g}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return Eb({timeItem:o,removePriorValues:t,event:n})}function wS(t){var e,i,n,r,a,o,s;let{includePositionAssignments:l,removePriorValues:u,tournamentRecord:c,status:d=ou,event:p,drawIdsToRemove:f,drawIdsToAdd:h}=t;if(!c)return{error:Oe};if(!p)return{error:Oi};let{appliedPolicies:m}=Ai({tournamentRecord:c,event:p}),g={...m,...t.policyDefinitions},v=((e=p.drawDefinitions)==null?void 0:e.map(({drawId:D})=>D))??[],y=t.drawDetails?Object.keys(t.drawDetails):[],b=y.length?[]:t.drawIds,I=(h??[]).concat(...f??[],...b??[],...y),T=I.filter(D=>!v.includes(D));if(T.length)return ue({result:{error:Qo},context:{invalidDrawIds:T}});let w=fl({event:p,status:d}),S=Object.keys((w==null?void 0:w.drawDetails)||{}).filter(D=>v.includes(D)).reduce((D,R)=>(D[R]=w.drawDetails[R],D),{});for(let D of v)if((!I.length||I.includes(D))&&(f!=null&&f.includes(D)||b!=null&&b.length&&!b.includes(D)?S[D]={...S[D],publishingDetail:{published:!1}}:(h!=null&&h.includes(D)||b!=null&&b.includes(D)||!(b!=null&&b.length))&&(S[D]={...S[D],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[D]){let R=t.drawDetails[D],N=R.structureDetails??S[D].structureDetails,M=R.stageDetails??S[D].stageDetails??{},{structureIdsToRemove:A=[],structureIdsToAdd:_=[],publishingDetail:k={},stagesToRemove:B=[],stagesToAdd:F=[]}=R;if((_||F)&&(k.published=!0),S[D]={publishingDetail:k,structureDetails:N,stageDetails:M},_.length||A.length){let $=(((r=(n=p.drawDefinitions)==null?void 0:n.find(V=>V.drawId===D))==null?void 0:r.structures)??[]).map(({structureId:V})=>V),j=(_??[]).concat(A??[]).filter(V=>!$.includes(V));if(j.length)return ue({result:{error:Tn},context:{invalidStructureIds:j}});N=N??{};for(let V of $)A.includes(V)?N[V]={published:!1}:N[V]={published:!0};S[D].structureDetails=N}let x=(((o=(a=p.drawDefinitions)==null?void 0:a.find($=>$.drawId===D))==null?void 0:o.structures)??[]).map(({stage:$})=>$);if(F.length){for(let $ of F)M[$]={published:!0};for(let $ of x)M[$]||(M[$]={published:!1})}if(F.length||B.length){for(let $ of B)M[$]={published:!1};for(let $ of x)M[$]||(M[$]={published:!0})}(F.length||B.length)&&(S[D].stageDetails=M)}IS({statusObject:{drawDetails:S},removePriorValues:u,status:d,event:p});let{topics:U}=iu(),P=U.includes(xB),E=P||t.returnEventData?(s=ZO({includePositionAssignments:l,usePublishState:!0,tournamentRecord:c,policyDefinitions:g,event:p}))==null?void 0:s.eventData:void 0;return P&&oi({payload:{eventData:E,tournamentId:c.tournamentId},topic:xB}),{...ae,eventData:E}}var Zve="deleteDrawDefinitions",Xve="autoSchedulingAudit",f$="deleteEvents",H3e={AUTO_SCHEDULING_AUDIT:Xve,DELETE_EVENTS:f$,DELETE_DRAW_DEFINITIONS:Zve};function ox(t){var e,i,n;if(!t.tournamentRecord)return{error:Oe};let r="deleteDrawDefinitions",a=t.drawIds??[],o=t.event,{autoPublish:s=!0,tournamentRecord:l,auditData:u,eventId:c,force:d}=t,{appliedPolicies:p}=Ai({tournamentRecord:l,event:o}),f={...p,...t.policyDefinitions},h=Array.isArray(a)?a[0]:void 0;if(!o){let D=vo({tournamentRecord:l,eventId:c,drawId:h});if(D.error)return D;o=D.event}let m=[],g=[],v=[];if(!(o!=null&&o.drawDefinitions))return ue({info:"event has no drawDefinition",result:{...ae},stack:r});let y=o.drawDefinitions.map(({drawId:D})=>D);if(a.length||(a=y),a=a.filter(D=>y.includes(D)),!a.length)return ue({info:"nothing to do; no matching drawIds in event.",result:{...ae},stack:r});let b=ut(Hn({event:o}).flightProfile,!1,!0),I=({participantId:D,drawPosition:R,qualifier:N,bye:M})=>({bye:M,qualifier:N,drawPosition:R,participantId:D}),T=d??((i=(e=p==null?void 0:p[Rd])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),w=fl({event:o})??{},S=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],U,P=[],E=o.drawDefinitions.filter(D=>{var R,N,M,A,_,k,B,F;if(a.includes(D.drawId)){let x=((R=po({event:o,drawDefinition:D}))==null?void 0:R.matchUps)??[];if(x.some(({score:X})=>Jr({score:X}))&&!T)return P.push(D.drawId),!0;let{drawId:$,drawType:j,drawName:V}=D,H=(N=b==null?void 0:b.flights)==null?void 0:N.find(X=>X.drawId===D.drawId);H&&(H.drawEntries=(M=H.drawEntries)==null?void 0:M.filter(X=>au.includes(X.entryStatus))),S.includes($)&&(S=S.filter(X=>X!==$),U=!0);let z=(_=(A=_d({stageSequence:1,drawDefinition:D,stage:at}))==null?void 0:A.structures)==null?void 0:_[0],q=(B=(k=z?r1({structureId:z.structureId,tournamentRecord:l,drawDefinition:D}):void 0)==null?void 0:k.positionAssignments)==null?void 0:B.map(I),W=(F=_d({stage:vt,drawDefinition:D}))==null?void 0:F.structures,Y=W!=null&&W.length?W.map(X=>{var Q;let ce=X.stageSequence;return{positionAssignments:(Q=r1({structureId:X.structureId,tournamentRecord:l,drawDefinition:D}))==null?void 0:Q.positionAssignments.map(I),stageSequence:ce}}):void 0,Z={action:Zve,payload:{drawDefinitions:[D],eventId:c??(o==null?void 0:o.eventId),auditData:u}};v.push(Z),m.push(ft({tournamentId:l.tournamentId,eventId:c??(o==null?void 0:o.eventId),qualifyingPositionAssignments:Y,positionAssignments:q,auditData:u,drawType:j,drawName:V,drawId:$})),x==null||x.forEach(({matchUpId:X})=>g.push(X))}return!a.includes(D.drawId)});if(P.length&&!d)return ue({context:{drawIdsWithScoresPresent:P},result:{error:Kk},stack:r});if(o.drawDefinitions=E,b&&Gh({event:o,extension:{name:zl,value:b}}),pE({tournamentRecord:l}),U){let D={};for(let N of S)D[N]=((n=w.drawDetails)==null?void 0:n[N])??{published:!0};let R=IS({statusObject:{drawDetails:D},event:o});if(R.error)return{error:R.error}}if(v.length&&oi({topic:_w,payload:v}),g.length&&of({tournamentId:l==null?void 0:l.tournamentId,matchUpIds:g}),a.forEach(D=>{A$e({drawId:D})}),z3e({event:o,deletedDrawsDetail:m,auditData:u}),s&&U){let D=wS({drawIdsToRemove:a,policyDefinitions:f,tournamentRecord:l,event:o});if(D.error)return{...ae,info:D.error}}return{...ae}}function z3e({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:n}=qt({name:mN,element:t}),r={...i,deletedDrawsDetail:e},a={name:mN,value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(r):[r]};hi({element:t,extension:a})}function Jve({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:Oe};if(!n)return{error:Oi};let{flightProfile:o}=Hn({event:n});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:u})=>u).filter(Boolean),l=ox({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:eO({event:n,name:zl})}return{...ae}}function E5(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Rn};let s=Object.keys(o).filter(u=>!r||r===u);if(r&&!s.includes(r))return{error:Se};let l;for(let u of s){let c=o[u],{event:d}=vo({tournamentRecord:c,eventId:a});a&&d&&(l=!0);let p=q3e({tournamentRecord:c,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...ae}:{error:es}}function q3e({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:Oe};if(n&&!Array.isArray(n))return{error:Se};if(e&&!Array.isArray(e))return{error:Se};let a=Ap;if(r){let{extension:o}=qt({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=JK({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});hi({element:r,extension:{name:a,value:l}})}else{let{extension:o}=qt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=JK({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});hi({extension:{name:a,value:l},element:t})}return{...ae}}function JK(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var u,c;return((u=l==null?void 0:l.categoryNames)==null?void 0:u.length)||((c=l==null?void 0:l.categoryTypes)==null?void 0:c.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var u;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(u=l.matchUpFormatCodes)==null?void 0:u.filter(c=>c!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:u})=>(l==null?void 0:l.length)||u).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Qve(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:Oe};if(!rs({matchUpFormat:r}))return{error:Se};if(!s)return{error:Oi};let{averageTimes:l=[],recoveryTimes:u=[]}=tx({tournamentRecord:e,matchUpFormat:r,event:s}),c=s.category,d=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},f={categoryNames:[d],minutes:{}},h=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(a)&&console.log("encountered:",{categoryType:a}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(w=>w!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(Tt(n)),g=i&&!isNaN(Tt(i)),v=l.map(h).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=u.map(h).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||Pn]:n}),v.push(p)),g&&(Object.assign(f.minutes,{[(s==null?void 0:s.eventType)||Pn]:i}),y.push(f)),!m&&!g?{error:Se}:E5({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function sx(t){if(t.event)return QK({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=wi(t,[{[Ea]:!0,[bpe]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=vo({tournamentRecord:r,eventId:n});if(a)return QK({event:a})}}return{error:es}}function QK({event:t}){return eO({event:t,name:Ap})}function C5({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Oe};if(!e)return{error:Oi};if(!Ed.test(i))return{error:Qa};let n=tye(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Bt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Qa};let s=e.endDate&&new Date(Bt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...ae}}function R5({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:Oe};if(!e)return{error:Oi};if(!Ed.test(i))return{error:Qa};let n=tye(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Bt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Qa};let s=e.startDate&&new Date(Bt(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...ae}}function eye({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:Oe};if(!e)return{error:Oi};if(!i&&!n)return{error:dt,info:"missing date"};if(i&&!Ed.test(i))return{error:Qa};if(n&&!Ed.test(n))return{error:Qa};if(i&&n){let r=new Date(Bt(i)).getTime(),a=new Date(Bt(n)).getTime();if(r>a)return{error:Se}}if(i){let r=C5({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=R5({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...ae}}function tye(t){let{startDate:e,endDate:i}=t;return!Ed.test(e)||!Ed.test(i)?ue({result:{error:vde},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Bt(e)).getTime(),tournamentEndDate:new Date(Bt(i)).getTime()}}function M5({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:Oi};if(!e)return{error:dt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Se,info:"orderedDrawIdsMap must be an object"};let r=Object.values(e);if(!r.every(o=>!isNaN(o)))return{error:Se,info:"drawOrder must be numeric"};if(Ht(r).length!==r.length)return{error:Se,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&$n(o,s).length!==o.length)return{error:Se,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Hn({event:t});return(n=a==null?void 0:a.flights)==null||n.forEach(o=>{o.flightNumber=e[o.drawId]}),{...ae}}function N5({tournamentRecord:t,event:e}){var i;if(!t)return{error:Oe};if(!e)return{error:Oi};let{flightProfile:n}=Hn({event:e}),r=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?M5({event:e,orderedDrawIdsMap:r}):{...ae}}function iye({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var o,s;if(!e)return{error:Oe};if(!n)return{error:Ku};if(!r)return{error:Oi};let{flightProfile:l}=Hn({event:r});if(l&&(o=l.flights)!=null&&o.find(u=>u.drawId===n)){let u=l.flights.filter(d=>d.drawId!==n),c={name:zl,value:{...l,flights:u}};Gh({event:r,extension:c})}if((s=r.drawDefinitions)!=null&&s.find(u=>u.drawId===n)){let u=ox({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(u.error)return u}return N5({tournamentRecord:e,event:r})}function nye({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var s,l;if(!a)return{error:Oi};if((a==null?void 0:a.eventType)!==Kl)return{error:ch};if(o&&!Array.isArray(o))return{error:Se};if(!i)return{error:Oe};if(![t,e,r].every(g=>typeof g=="string"))return{error:wr};if(!(((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:g})=>[ru,xg].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:Ic};let u=(i.participants||[]).find(g=>g.participantId===r);if((u==null?void 0:u.participantType)!==xt)return{error:Y0,participant:u};let c=u.individualParticipantIds,d=[t,...c.filter(g=>g!==e)],{participant:p}=Yl({participantIds:d,tournamentRecord:i}),f;if(p)f=p.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:Sa,individualParticipantIds:d,participantType:xt},v=Ec({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;f=v.participant.participantId}let{flightProfile:h}=Hn({event:a});if(n){let g=(l=h==null?void 0:h.flights)==null?void 0:l.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:f}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:f}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:f}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:f}:b)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:f}||g.participantId===t&&{...g,participantId:e}||g);let m=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:b,entries:I})=>b===(n==null?void 0:n.drawId)?!1:I==null?void 0:I.find(T=>T.participantId===r)):g==null?void 0:g.find(b=>b.participantId===r));if(!m){let g=Tb({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...ae,participantOtherEntries:m,newPairParticipantId:f}}function lx(t){var e,i,n,r,a,o,s,l,u,c,d,p;let{flight:f,suppressNotifications:h,modifyEventEntries:m,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:b,drawDefinition:I,event:T}=t;if(!I)return{error:nt};if(!T)return{error:Oi};T.drawDefinitions||(T.drawDefinitions=[]);let{drawId:w,drawName:S,entries:U}=I,{entries:P}=T,E=0;if(g!==void 0&&g!==T.drawDefinitions.length)return{error:Se,info:"drawDefintions count mismatch"};let{flightProfile:D}=Hn({event:T}),R=f&&((e=D==null?void 0:D.flights)==null?void 0:e.find(H=>H.flightNumber===f.flightNumber)),N=(r=(n=(i=D==null?void 0:D.links)==null?void 0:i.find(H=>{var z;return((z=H==null?void 0:H.target)==null?void 0:z.drawId)===w}))==null?void 0:n.source)==null?void 0:r.drawId;if(N&&!T.drawDefinitions.find(H=>H.drawId===N))return ue({result:{error:nt},info:{sourceDrawId:N}});if(R&&R.drawId!==I.drawId)return ue({result:{error:Av},info:{relevantFlight:R}});let M=U==null?void 0:U.every(({participantId:H,entryStatus:z})=>{let q=R==null?void 0:R.drawEntries.find(W=>W.participantId===H);return!z||(q==null?void 0:q.entryStatus)===z}),A=!y||P&&(U==null?void 0:U.every(({participantId:H,entryStatus:z,entryStage:q})=>{var W;return((W=P.find(Y=>Y.participantId===H&&(!Y.entryStage||Y.entryStage===q)))==null?void 0:W.entryStatus)===z}));if(R&&!M)return ue({result:{error:Av},context:{drawEntriesPresentInFlight:M,matchingEventEntries:A,relevantFlight:R},info:"Draw entries are not present in flight or do not match entryStatuses"});if(m&&(U==null||U.filter(Boolean).forEach(H=>{if(H!=null&&H.entryStatus&&au.includes(H==null?void 0:H.entryStatus)){let z=P==null?void 0:P.filter(Boolean).find(q=>q.participantId===H.participantId);z&&H.entryStatus&&(z==null?void 0:z.entryStatus)!==H.entryStatus&&(z.entryStatus=H.entryStatus,E+=1)}})),P&&!A)return ue({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:A,eventEntries:P},error:Av}});let _=((o=(a=D==null?void 0:D.flights)==null?void 0:a.map(({flightNumber:H})=>!isNaN(H)&&Tt(H)))==null?void 0:o.filter(Boolean))||[],k=((s=T.drawDefinitions.map(({drawOrder:H})=>H&&Tt(H)))==null?void 0:s.filter(Boolean))||[],B=Math.max(0,...k,..._)+1,F=(l=D==null?void 0:D.flights)==null?void 0:l.find(H=>H.drawId===w),x;if(F){F.drawName=I.drawName,x={name:zl,value:{...D,flights:D.flights}};let H=F.flightNumber;H&&!k.includes(H)?B=H:F.flightNumber=B}else{let H=(D==null?void 0:D.flights)||[];H.push({manuallyAdded:!0,flightNumber:B,drawEntries:U,drawName:S,drawId:w}),x={name:zl,value:{...D||{},flights:H}}}Gh({event:T,extension:x}),Object.assign(I,{drawOrder:B});let $=T.drawDefinitions.find(H=>H.drawId===w),j=b==null?void 0:b.tournamentId,V=T.eventId;if($){if(!v)return{error:Yce};let H=((c=(u=po({drawDefinition:$}))==null?void 0:u.matchUps)==null?void 0:c.map(Ar))??[],z=(d=po({drawDefinition:I}))==null?void 0:d.matchUps;if(!h){H!=null&&H.length&&of({matchUpIds:H,action:"modifyDrawDefinition",tournamentId:j,eventId:V}),z!=null&&z.length&&mh({matchUps:z,tournamentId:j,eventId:V}),T.drawDefinitions=T.drawDefinitions.map(W=>W.drawId===w?I:W);let q=(p=I.structures)==null?void 0:p.map(({structureId:W})=>W);Qi({drawDefinition:I,tournamentId:j,structureIds:q,eventId:V})}}else if(T.drawDefinitions.push(I),!h){let{matchUps:H}=po({drawDefinition:I,event:T});H&&mh({tournamentId:b==null?void 0:b.tournamentId,matchUps:H}),DP({drawDefinition:I,tournamentId:j,eventId:V})}return{...ae,modifiedEventEntryStatusCount:E}}function rye(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=t,c=0;if(!(s!=null&&s.length))return{error:pq};if(!n)return{error:Oe};if(!l)return{error:Ku};let d=nl({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:f}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;f&&y<=f&&(!i||h[y])&&(h[y]=v)});let m=Object.values(h),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==tpe(g).length)return{error:Zce};for(let v of m){let y=gS({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:u});if(y!=null&&y.error)return y;y!=null&&y.success&&c++}return c?{...ae,modifications:c}:{error:J0}}function A5({deleteExisting:t,event:e,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return ue({result:{error:dt},stack:r});if(!e)return ue({result:{error:Oi},stack:r});let{flightProfile:a}=Hn({event:e});return a&&!t?ue({result:{error:Nq},stack:r}):(n=e.drawDefinitions)!=null&&n.length?ue({result:{error:qce},stack:r}):(Gh({event:e,extension:{name:zl,value:i}}),{flightProfile:ut(i,!1,!0),...ae})}function W3e({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var n;if(!t)return{error:Oe};if(!i)return{error:Fh};if(!e)return{error:dt,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:o}=e,s=[Sfe,r,a,o].join(".");return(n=t.participants)==null||n.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(u=>u&&(u==null?void 0:u.itemType)!==s))}),{...ae}}function _5({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var s;if(!a)return{error:Oi};if(n&&!Array.isArray(n))return ue({result:{error:Se},info:Od("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:c}=Hn({event:a}),d=(s=c==null?void 0:c.flights)==null?void 0:s.find(p=>p.drawId===r);d?l=d.drawEntries:l=i==null?void 0:i.entries}let u=(l||[]).filter(c=>(!o||!c.entryStage||c.entryStage===o)&&(!n||n.includes(c.entryStatus))).map(ei);return W3e({tournamentRecord:t,scaleAttributes:e,participantIds:u})}function ux({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=ou,event:r}){if(!e)return ue({result:{error:Oe}});if(!r)return ue({result:{error:Oi}});if(!ln(i))return ue({result:{error:dt}});if(ln(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let u of s){let c=l.find(d=>O2e(d.attributes,u.attributes));c!=null&&c.dates&&u.dates?c.dates.push(...u.dates):l.push(u)}i.draws[o].scheduleDetails=l}}let a=IS({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...ae}}function aye({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var s,l;if(!t)return{error:Oe};if(!a)return{error:Oi};n=n||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let u={eventType:a.eventType,scaleType:sd,scaleName:n};return _5({tournamentRecord:t,scaleAttributes:u,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function oye({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:Oe};if(!e.events)return{error:es};if(!Array.isArray(i))return{error:dt,info:Od("drawIds")};let n=[],r=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let c={action:f$,payload:{events:[s]}};n.push(c),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===Kl?(s.entries||[]).map(({entryStatus:c,participantId:d})=>c!==ru&&d).filter(Boolean):[],u=i.includes(s.eventId);return u?o.push(...l):a.push(...l),!u}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return pE({tournamentRecord:e}),n.length&&(oi({topic:_w,payload:n}),Pb({tournamentRecord:e,timeItem:{itemType:f$,itemValue:r}})),{...ae}}function sye({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var r;let a="modifyEvent";if(!t)return ue({result:{error:Oe},stack:a});if(!mo(i))return ue({result:{error:Oi},context:{eventId:i},stack:a});if(!ln(e))return ue({result:{error:Se},context:{eventUpdates:e},stack:a});let o=((r=n==null?void 0:n.entries)==null?void 0:r.filter(({entryStatus:f})=>{let h=f;return[...au,xl].includes(h)}).map(({participantId:f})=>f))??[],s=o?jn({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],l=[],u=s.reduce((f,h)=>{var m,g;let v=(m=h.person)!=null&&m.sex?[h.person.sex]:((g=h.individualParticpants)==null?void 0:g.map(y=>{var b;return(b=y.person)==null?void 0:b.sex}))||[];return l.push(...v),f.includes(h.participantType)?f:f.concat(h.participantType)},[]),c=Ht(l),d=!c.length||[Ho,Uc].includes(e.gender??"")||c.length===1&&c[0]===e.gender;if(e.gender&&!d)return ue({context:{gender:e.gender,validGender:d},result:{error:Se},stack:a});let p=(u.includes(Rr)&&[Rr]||u.includes(ti)&&[kd]||u.includes(xt)&&[Kl]||[Kl,kd,Rr]).includes(e.eventType??"");return e.eventType&&!p?ue({context:{participantType:e.eventType,validEventType:p},result:{error:Se},stack:a}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...ae})}function cx({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var o,s,l;let u="addFlight";if(!r)return ue({result:{error:Oi},stack:u});if(!i)return ue({result:{error:dt},stack:u});if(e!=null&&e.length){let g=(r.entries??[]).map(ei),v=e.map(ei);if($n(v,g).length!==v.length)return ue({result:{error:Se},stack:u})}let c=(o=Hn({event:r}))==null?void 0:o.flightProfile,d=((l=(s=c==null?void 0:c.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&Tt(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,f={drawId:n||Li(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(f.stage=a),t&&(f.qualifyingPositions=t),((c==null?void 0:c.flights)||[]).find(({drawId:g})=>g===f.drawId))return ue({result:{error:qde},stack:u});let h=((c==null?void 0:c.flights)||[]).concat(f),m={name:zl,value:{...c||{},flights:h}};return Gh({event:r,extension:m})}var K3e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Y3e={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Z3e={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},lye={COLLEGE_D3:K3e,COLLEGE_DEFAULT:Y3e,COLLEGE_JUCO:Z3e,DOMINANT_DUO:jge,DOMINANT_DUO_MIXED:Fge,LAVER_CUP:Wge,TEAM_DOUBLES_3_AGGREGATION:_ge,TIME_TENNIS_DUAL:Bge,TIME_TENNIS_PRO_CIRCUIT:Lge,USTA_BREWER_CUP:$ge,USTA_OZAKI_CUP:Vge,USTA_COLLEGE:Gge,USTA_GOLD_TEAM_CHALLENGE:Age,USTA_INTERSECTIONAL:xge,USTA_LEVEL_1:Hge,USTA_SECTION_BATTLE:Oge,USTA_SOUTHERN_LEVEL_5:kge,USTA_TOC:Kge,USTA_WTT_ITT:zge,USTA_ZONAL:qge};function gE({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,a,o,s;if(!e)return{error:Oe};if(e.events||(e.events=[]),!n)return{error:Oi};let{startDate:l,endDate:u}=e;if(!i&&((r=n.entries)!=null&&r.length||(a=n.drawDefinitions)!=null&&a.length)){let d=ft({drawDefinitions:!!((o=n.drawDefinitions)!=null&&o.length),entries:!!((s=n.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:Se,context:d}}let c={eventType:my,drawDefinitions:[],entries:[],startDate:l,endDate:u,...n};if(n.eventType===rl){if(n.tieFormat){let d=Ao({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!lye[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Se};let d=Iy({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});c.tieFormat=d}}if(c.eventId||(c.eventId=Li()),e.events.reduce((d,p)=>d||p.eventId===c.eventId,void 0))return{error:ade};{let d=c;if(e.events.push(d),!t){let{topics:p}=iu();if(p.includes(lO)){let f=cf({event:n}).matchUps??[];mh({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:f})}for(let f of n.drawDefinitions||[])DP({drawDefinition:f})}return{...ae,event:c}}}var uye={};Yt(uye,{drawMatic:()=>W4,garman:()=>hye,generateAdHocMatchUps:()=>FO,generateAdHocRounds:()=>q4,generateAndPopulatePlayoffStructures:()=>b4,generateCourts:()=>k5,generateDrawDefinition:()=>ax,generateDrawMaticRound:()=>L4,generateDrawStructuresAndLinks:()=>k4,generateDrawTypeAndModifyDrawDefinition:()=>O4,generateFlightProfile:()=>Q3e,generateLineUps:()=>fye,generateQualifyingStructure:()=>p4,generateSeedingScaleItems:()=>$ve,generateVoluntaryConsolation:()=>$me,roundRobinGroups:()=>pje});var X3e="splitLevelBased",cye="splitWaterfall",dye="splitShuttle",J3e={SPLIT_LEVEL_BASED:X3e,SPLIT_WATERFALL:cye,SPLIT_SHUTTLE:dye};function Q3e(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:c,uuids:d=[],event:p,stage:f}=t;if(!p)return{error:Oi};let h=p.entries??[],{flightProfile:m}=Hn({event:p});if(m&&i&&!o)return{error:Nq};let g=t.scaledEntries??Cb({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:f}).scaledEntries,v=g.map(ei),y=Va(h.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!f||!E.entryStage||E.entryStage===f)&&(!E.entryStatus||Lg.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/u),w=Yr(b,T);c===cye?w=RB(b,u):c===dye&&(w=RB(b,u,!0));function S(E){return(E||[]).map(({participantId:D,scaleValue:R})=>{let N=h.find(M=>M.participantId===D);return N!=null&&N.scaleValue&&R&&(N.scaleValue=R),N}).sort((D,R)=>D.scaleValue-R.scaleValue).map((D,R)=>(D.scaleValue&&(D.seedNumber=R+1),D))}let U=Je(0,u).map(E=>{let D=E+1;return{flightNumber:D,drawId:(d==null?void 0:d.pop())??Li(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${D}`}}),P={scaleAttributes:r,splitMethod:c,flights:U};if(i){let E=A5({flightProfile:P,deleteExisting:o,event:p});return{splitEntries:il()&&w||void 0,...E}}else return{flightProfile:P,...ae}}var eqe="ASC",pye="ASC",tqe="DESC",h$="DESC",iqe={ASC:eqe,ASCENDING:pye,DESC:tqe,DESCENDING:h$};function fye(t){var e,i,n,r,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:c,singlesOnly:d,attach:p,event:f}=t;if((f==null?void 0:f.eventType)!==rl)return{error:ch};if(!l)return{error:Oe};if(!o&&!u)return{error:Qo};if(o=o??((e=_a({drawDefinition:u,event:f}))==null?void 0:e.tieFormat),Ao({tieFormat:o}).error)return{error:Jd};if(typeof c!="object"&&!s)return{error:Se,context:{scaleAccessor:c}};let h={},m=((u==null?void 0:u.entries)??(f==null?void 0:f.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===ys).map(ei),{participants:g=[]}=jn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:_})=>m.includes(_)),y=_=>_===dh?"rankings":"ratings",b=((i=f==null?void 0:f.category)==null?void 0:i.categoryName)??((n=f==null?void 0:f.category)==null?void 0:n.ageCategoryCode),{scaleName:I=b,scaleType:T=dh,sortOrder:w,accessor:S}=c||{},U=y(T),P=(_,k)=>{var B,F,x;let $=(B=_[U])==null?void 0:B[k];if(!$&&s&&($=(F=_[U])==null?void 0:F[kv]),Array.isArray($)){let j=(x=$.find(V=>V.scaleName===I))==null?void 0:x.scaleValue;if(Mn(j))return j;if(S&&typeof j=="object")return j[S]}return 0},E=(_,k,B)=>{let F=w===h$?k:_,x=w===h$?_:k;return P(F,B)-P(x,B)},D=(_,k)=>E(_,k,kv),R=(_,k)=>E(_,k,ig),N=[],M=(o==null?void 0:o.collectionDefinitions)??[];for(let _ of v){let k=((r=_.individualParticipants)==null?void 0:r.sort(D))??[],B=d?k:((a=_.individualParticipants)==null?void 0:a.sort(R))??[],F={};for(let $ of M){let j=[],{collectionId:V,matchUpCount:H,matchUpType:z,gender:q}=$,W=xn(kv)(z);Je(0,H).forEach(Y=>{let Z=W?k:B??[],X=Y+1,Q=[];Je(0,W?1:2).forEach(ce=>{var J;let ee=(J=Z==null?void 0:Z.find(ne=>{var ie;let oe=q&&([Ki,vn].includes(q)&&q||q===Ho&&[Ki,vn][ce]);return(!oe||oe===((ie=ne.person)==null?void 0:ie.sex))&&!j.includes(ne.participantId)}))==null?void 0:J.participantId;ee&&(Q.push(ee),j.push(ee),F[ee]||(F[ee]=[]),F[ee].push({collectionPosition:X,collectionId:V}))}),W||N.push(Q)})}let x=Object.keys(F).map($=>({collectionAssignments:F[$],participantId:$}));h[_.participantId]=x}let A=[];for(let _ of N){let{participant:k}=Yl({tournamentParticipants:g,participantIds:_});if(!k){let B={individualParticipantIds:_,participantRole:Sa,participantType:xt};A.push(B)}}if(p){for(;A.length;)Ec({participant:A.pop(),tournamentRecord:l});hi({element:u,extension:{name:Np,value:h}})}return{...ae,lineUps:h,participantsToAdd:A}}function k5(t){if(!t)return{error:dt};let e=wi(t,[{dates:!1,[wu]:o=>Array.isArray(o)&&o.every(hs)},{uuids:!1,[wu]:o=>Array.isArray(o)&&o.every(mo)},{startTime:!1,endTime:!1,[wu]:Kq},{idPrefix:!1,namePrefix:!1,[wu]:mo},{count:!0,[wu]:Mn}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&Dw(i,n)||[],a=Je(1,t.count+1).map(o=>{var s,l;return ft({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Li(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(u=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:u}))})});return{...ae,courts:a}}var hye={};Yt(hye,{default:()=>aqe,garman:()=>vye});function vE({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>Cd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function SS(t){let e=wi(t,[{courtDate:!0,_ofType:Kd}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=tr(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>dN(s.startTime).localeCompare(dN(l.startTime))).forEach(s=>{let l={startTime:an(a.toISOString()),endTime:s.startTime};tr(s.startTime)>a&&r.push(l),tr(s.endTime)>a&&(a=tr(s.endTime))});let o={startTime:an(a.toISOString()),endTime:n.endTime};return tr(n.endTime)>a&&r.push(o),{timeSlots:r}}function nqe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var s;let{timeSlots:l}=SS({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=tr(o.startTime),l=tr(o.endTime);return s>i||l<n?!1:yP(i,l)>=t}return{enoughTime:r}}function mye(t){let e=wi(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Fo}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=tr(r),l=Yq(s,i),{enoughTime:u}=nqe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(c=>{if(!Array.isArray(c.dateAvailability))return!1;let d=vE({date:a,court:c});return!!(d&&u(d))}))||[]).length,...ae}}function dx(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:Se,courts:o};if(!Array.isArray(s))return{error:oN};if(!hs(a))return{error:Qa};n&&(Array.isArray(n)?n.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce((f,h)=>{let{courtId:m}=h;return m?f.courtBookings[m]?f.courtBookings[m].push(h):f.courtBookings[m]=[h]:f.unassignedBookings.push(h),f},{courtBookings:{},unassignedBookings:[]}),c=o.map((f,h)=>{let{courtId:m,courtName:g}=f,v=l[m]||[],y=vE({date:a,court:f})||{},{bookings:b=[],startTime:I,endTime:T,date:w}=y,S=[i[h]&&{startTime:I,endTime:i[h]},...ut(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:I,endTime:T,date:w}}});u.sort((f,h)=>ui(f.startTime)-ui(h.startTime));let d=()=>c.map(f=>{let h=f.dateAvailability,{timeSlots:m=[]}=SS({courtDate:h});return{courtName:f.courtName,courtId:f.courtId,timeSlots:m}}).flat(),p=[];for(let f of u){let{startTime:h,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=f,b=ui(h),I=ui(m),T=d().reduce((w,{courtId:S,courtName:U,timeSlots:P})=>{let E;return P.find(({startTime:D,endTime:R})=>{E=ui(D)-b;let N=b>=ui(D);return I<=ui(R)&&w.startDifference!==0&&((E===0||E+r>=0)&&(w.startDifference===void 0||E<w.startDifference)||N)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(T.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:h,endTime:m};p.push(w),(e=c.find(({courtId:S})=>S===T.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:f})}return{virtualCourts:c.map(({courtId:f,courtName:h,dateAvailability:m})=>({dateAvailability:[m],courtName:h,courtId:f})),assignedBookings:p}}function px({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function gye(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Je(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function Vw({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=vE({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&ui(l)<ui(a)||i&&ui(l)>ui(a))?l:a},void 0)}function rqe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||Vw({courts:n,scheduleDate:r,startTime:!0}),i=i||Vw({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=tr(e),s=tr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let u=vE({court:l,date:r}),{timeSlots:c}=SS({courtDate:u});c==null||c.forEach(d=>{let p=tr(d.startTime),f=tr(d.endTime);if(p>s||p<o||f<o)return!1;if(yP(p,f)>=t){let h=an(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function O5(t){let e=wi(t,[{courts:!0,_ofType:Fo}]);if(e.error)return e;let{date:i=Wq(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:c,courtsCount:d,bookings:p}=t;a=a||px({averageMatchUpMinutes:u}),i=Bt(i),n=an(n),r=an(r);let f=0,h=0,m=0,g=0,v=0;!o&&d&&(o=gye({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=dx({remainingScheduleTimes:l,clearScheduleDates:c,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:b}=rqe({averageMinutes:u,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);let I=ui(n),T=ui(r)-I,w=Math.floor(T/a),S=Je(0,w+1).map(U=>{let P=I+U*a,E=n$e(P),D=mye({courts:y??[],averageMatchUpMinutes:u,periodStart:E,date:i});if(D.error)return{error:D.error};let{availableToScheduleCount:R=0}=D,N=R>h?R-h:0;v+=U?R:0;let M=U?v/U:R,A=a*M/u,_=U?A*(U-1)+M:M,k=R?h&&_-f||N:0;f=_,h=R,m+=k;let B=Tt(m)-g;return g+=B,{periodStart:E,add:B,availableToScheduleCount:R,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,P)=>{let E=Je(0,P.add).map(()=>({scheduleTime:P.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var vye={getCourtsAvailableAtPeriodStart:mye,generateTimeSlots:SS,getScheduleTimes:O5,courtGenerator:gye},aqe=vye,yye={};Yt(yye,{isValid:()=>rs,isValidMatchUpFormat:()=>rs,parse:()=>bo,stringify:()=>RO});var bye={};Yt(bye,{allCompetitionMatchUps:()=>Vu,allDrawMatchUps:()=>po,allEventMatchUps:()=>cf,allTournamentMatchUps:()=>Xr,analyzeMatchUp:()=>l1,applyLineUps:()=>Vye,assignMatchUpSideParticipant:()=>wye,assignTieMatchUpParticipantId:()=>xN,bulkMatchUpStatusUpdate:()=>Lye,calculateWinCriteria:()=>Mb,checkInParticipant:()=>L5,checkMatchUpIsComplete:()=>_m,checkOutParticipant:()=>x5,competitionScheduleMatchUps:()=>hE,disableTieAutoCalc:()=>kye,drawMatchUps:()=>I5,enableTieAutoCalc:()=>Nye,eventMatchUps:()=>ix,findMatchUp:()=>r5,getAllDrawMatchUps:()=>fr,getAllStructureMatchUps:()=>Ci,getCheckedInParticipantIds:()=>yb,getCompetitionMatchUps:()=>s1,getEventMatchUpFormatTiming:()=>d5,getMatchUpCompetitiveProfile:()=>OP,getMatchUpContextIds:()=>g5,getMatchUpDailyLimits:()=>rx,getMatchUpDailyLimitsUpdate:()=>p5,getMatchUpDependencies:()=>su,getMatchUpFormat:()=>v5,getMatchUpFormatTiming:()=>LP,getMatchUpFormatTimingUpdate:()=>c5,getMatchUpScheduleDetails:()=>gO,getMatchUpType:()=>vO,getMatchUpsStats:()=>y5,getModifiedMatchUpFormatTiming:()=>tx,getParticipantResults:()=>iE,getPredictiveAccuracy:()=>m5,getRoundMatchUps:()=>to,getRounds:()=>b5,isValidMatchUpFormat:()=>rs,matchUpActions:()=>xO,mutate:()=>Iye,participantScheduledMatchUps:()=>f5,query:()=>_ve,removeDelegatedOutcome:()=>Aye,removeMatchUpSideParticipant:()=>$5,removeTieMatchUpParticipantId:()=>Tye,replaceTieMatchUpParticipantId:()=>B5,resetAdHocMatchUps:()=>Bye,resetMatchUpLineUps:()=>q5,resetScorecard:()=>K5,resetTieFormat:()=>W5,setDelegatedOutcome:()=>Fye,setMatchUpFormat:()=>Oye,setMatchUpStatus:()=>bE,setOrderOfFinish:()=>$ye,substituteParticipant:()=>_ye,tallyParticipantResults:()=>yS,toggleParticipantCheckInState:()=>fx,tournamentMatchUps:()=>nx,updateTieMatchUpScore:()=>df,validMatchUp:()=>fO,validMatchUps:()=>pl});var Iye={};Yt(Iye,{applyLineUps:()=>Vye,assignMatchUpSideParticipant:()=>wye,assignTieMatchUpParticipantId:()=>xN,bulkMatchUpStatusUpdate:()=>Lye,checkInParticipant:()=>L5,checkOutParticipant:()=>x5,disableTieAutoCalc:()=>kye,enableTieAutoCalc:()=>Nye,findMatchUp:()=>r5,removeDelegatedOutcome:()=>Aye,removeMatchUpSideParticipant:()=>$5,removeTieMatchUpParticipantId:()=>Tye,replaceTieMatchUpParticipantId:()=>B5,resetAdHocMatchUps:()=>Bye,resetMatchUpLineUps:()=>q5,resetScorecard:()=>K5,resetTieFormat:()=>W5,setDelegatedOutcome:()=>Fye,setMatchUpFormat:()=>Oye,setMatchUpStatus:()=>bE,setOrderOfFinish:()=>$ye,substituteParticipant:()=>_ye,toggleParticipantCheckInState:()=>fx,updateTieMatchUpScore:()=>df});function wye({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var o,s;if(i&&typeof i!="string")return{error:Ic};if(!e)return{error:nt};if(!r)return{error:va};let l=n===void 0;if(l&&(n=1),![1,2].includes(n))return ue({result:{error:Se,context:{sideNumber:n}}});let{matchUp:u,structure:c}=on({drawDefinition:e,matchUpId:r,event:a});if(!u)return{error:Da};if(!(!(c!=null&&c.structures)&&!(e.drawType&&e.drawType!==ql)&&!((o=c==null?void 0:c.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:lq};if(!i&&((s=u==null?void 0:u.score)!=null&&s.scoreStringSide1||kr.includes(u==null?void 0:u.matchUpstatus)||u!=null&&u.matchUpStatus&&[nr,Ir].includes(u.matchUpStatus)))return{error:Vk,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map(d=>{var p;let f=((p=u.sides)==null?void 0:p.find(h=>h.sideNumber===d))??{sideNumber:d};return n===d?{...f,participantId:i}:f}),l)for(let d of u.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);di({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:u})}return{...ae,sidesSwapped:l}}function bs({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=on({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:Da};let u=zh({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||di({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function x5(t){var e;let i=[{[Fd]:!0},{[Yu]:!0},{[Dd]:!0},{[_g]:!0}],n=wi(t,i);if(n.error)return n;let r=mE(t,[{[vP]:$h,attr:{[Hq]:!0}}]);if(r.error)return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:d}=u??{};if(c&&aW.includes(c)||c&&kr.includes(c)||Jr({score:d}))return{error:Qce};let p=yb({matchUp:u});if(p!=null&&p.error)return p;let{checkedInParticipantIds:f,allRelevantParticipantIds:h}=p??{};if(!(h!=null&&h.includes(s)))return{error:Ic};if(!(f!=null&&f.includes(s)))return{error:Dde};let m=mfe({matchUp:u});if(m!=null&&m.error)return m;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=m??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(b=>{bs({drawDefinition:o,matchUpId:l,timeItem:{itemType:bN,itemValue:b}})}),bs({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:bN}}),{...ae,checkedOut:!0}}function L5(t){var e;let i=[{[Fd]:!0},{[Yu]:!0},{[Dd]:!0},{[_g]:!0}],n=wi(t,i);if(n[_v])return n;let r=mE(t,[{[vP]:$h,attr:{[Hq]:!0}}]);if(r[_v])return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,u=yb({matchUp:(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp});if(u!=null&&u.error)return u;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=u??{};if(!(d!=null&&d.includes(s)))return{[_v]:Ic};let p={...ae,checkedIn:!0};return c!=null&&c.includes(s)||bs({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:yN}}),p}function fx(t){var e,i;let n=wi(t,[{[Dd]:!0,[Yu]:!0,[_g]:!0}]);if(n.error)return n;let r=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r]));if(!a)return{error:Oe};let o=(i=mE(t,[{[vP]:$h,attr:{[Hq]:!0},[_v]:Da}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:Da};let{checkedInParticipantIds:s=[]}=yb({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:c}=t;return l&&s.includes(l)?x5({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o}):L5({tournamentRecord:a,drawDefinition:c,participantId:l,matchUpId:u,matchUp:o})}function F5({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,a;if(!t)return{error:Oe};if(!e)return{error:Ku};if(!n)return{error:es};let o=ya({drawDefinition:e}),{matchUp:s}=on({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:Da};let{matchUp:l,structure:u}=on({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:n});if(!l)return{error:Da};let{collectionPosition:c,drawPositions:d,collectionId:p,matchUpTieId:f,matchUpType:h}=l;if(h&&!yO([Pn,Yi],h))return{error:go};let{positionAssignments:m}=Hi({structure:u}),g=m==null?void 0:m.filter(U=>d==null?void 0:d.includes(U.drawPosition)),{matchUp:v}=on({matchUpId:f,drawDefinition:e,matchUpsMap:o}),y=((r=v==null?void 0:v.sides)==null?void 0:r.map(ei))??[],b=(g==null?void 0:g.map(ei))??[],I=[...y,...b],{participants:T}=jn({tournamentRecord:t,participantFilters:{participantTypes:[qi],participantIds:I}}),{matchUp:w}=on({matchUpId:f,inContext:!0,drawDefinition:e,matchUpsMap:o}),S=(a=_a({matchUp:v,drawDefinition:e,structure:u,event:n}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:c,teamParticipants:T,collectionId:p,matchUpType:h,dualMatchUp:v,tieMatchUp:s,tieFormat:S,structure:u,...ae}}function B5(t){var e,i,n,r,a,o,s,l,u,c,d,p,f,h,m,g;let v=F5(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:b,tournamentRecord:I,newParticipantId:T,drawDefinition:w,substitution:S,event:U}=t;if(!b||!T)return ue({result:{error:wr},stack:y});if(b===T)return{...ae};let{inContextDualMatchUp:P,inContextTieMatchUp:E,collectionPosition:D,collectionId:R,dualMatchUp:N,tieMatchUp:M,tieFormat:A}=v,_=E==null?void 0:E.matchUpType,k=(e=E==null?void 0:E.sides)==null?void 0:e.find(ee=>{var ne,ie,oe;return((ne=ee.participant)==null?void 0:ne.participantId)===b||((oe=(ie=ee.participant)==null?void 0:ie.individualParticipantIds)==null?void 0:oe.includes(b))});if(!k)return{error:qn};let B=((i=jn({tournamentRecord:I,participantFilters:{participantIds:[b,T]}}))==null?void 0:i.participants)??[];if(B.length!==2)return ue({result:{error:wr},stack:y});if(B[0].participantType!==B[1].participantType)return ue({result:{error:Bu},stack:y});let{appliedPolicies:F}=Ai({tournamentRecord:I,drawDefinition:w,event:U}),x=((n=t.policyDefinitions)==null?void 0:n[Vr])??(F==null?void 0:F[Vr])??mS[Vr],$=B.find(({participantId:ee})=>ee===T);if((t.enforceGender??((r=x==null?void 0:x.participants)==null?void 0:r.enforceGender))!==!1&&[Ki,vn].includes(E==null?void 0:E.gender)&&(E==null?void 0:E.gender)!==((a=$==null?void 0:$.person)==null?void 0:a.sex))return{error:Y0,info:"Gender mismatch"};let j=(o=x==null?void 0:x.processCodes)==null?void 0:o.substitution;oE({tournamentId:I.tournamentId,eventId:U.eventId,inContextDualMatchUp:P,drawDefinition:w,dualMatchUp:N});let V=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:ee})=>ee===k.sideNumber);if(!V)return ue({result:{sideNumber:k.sideNumber,existingParticipantId:b,error:Pa},stack:y});if((u=(l=E==null?void 0:E.sides)==null?void 0:l.flatMap(ee=>{var ne,ie;return((ne=ee.participant)==null?void 0:ne.individualParticipantIds)||((ie=ee.participant)==null?void 0:ie.participantId)||[]}))!=null&&u.includes(T))return ue({result:{error:jk},stack:y});let H=(d=(c=P==null?void 0:P.sides)==null?void 0:c.find(({sideNumber:ee})=>ee===k.sideNumber))==null?void 0:d.participantId,z=V.lineUp,q=z==null?void 0:z.find(({participantId:ee})=>T===ee),W=z==null?void 0:z.reduce((ee,ne)=>ne.substitutionOrder>ee?ne.substitutionOrder:ee,0),Y=(z==null?void 0:z.map(ee=>{var ne;let ie=ut(ee,!1,!0);if(![b,T].includes(ie.participantId))return ie;if(!S&&[b,T].includes(ie.participantId)&&(ie.collectionAssignments=(ne=ie.collectionAssignments)==null?void 0:ne.filter(oe=>!(oe.collectionPosition===D&&oe.collectionId===R))),S&&b===ie.participantId&&(ie.collectionAssignments=ie.collectionAssignments.map(oe=>oe.collectionPosition===D&&oe.collectionId===R&&oe.substitutionOrder===void 0?{...oe,substitutionOrder:W}:oe)),ie.participantId===T){ie.collectionAssignments||(ie.collectionAssignments=[]);let oe={collectionId:R,collectionPosition:D};S&&(oe.previousParticipantId=b,oe.substitutionOrder=(W??0)+1),ie.collectionAssignments.push(oe)}return ie}))??[];if(!q){let ee={collectionId:R,collectionPosition:D};S&&(ee.substitutionOrder=(W??0)+1,ee.previousParticipantId=b);let ne={collectionAssignments:[ee],participantId:T};Y.push(ne)}let Z=_===Yi,{assignedParticipantIds:X}=IN({lineUp:z,collectionPosition:D,collectionId:R}),{assignedParticipantIds:Q}=IN({lineUp:Y,collectionPosition:D,collectionId:R});if(V.lineUp=Y,H&&A){let ee=Db({participantId:H,lineUp:Y,drawDefinition:w,tieFormat:A});if(ee.error)return ue({result:ee,stack:y})}else console.log("team participantId not found");let ce,J;if(Z){let{tournamentRecord:ee}=t,ne=Yl({participantIds:Q,tournamentRecord:ee});if(!ne.participant){let oe=Ec({returnParticipant:!0,pairOverride:!0,tournamentRecord:ee,participant:{participantRole:Sa,individualParticipantIds:Q,participantType:xt}});if(oe.error)return ue({result:oe,stack:y});ce=(p=oe.participant)==null?void 0:p.participantId}ne=Yl({participantIds:X,tournamentRecord:ee});let ie=(f=ne.participant)==null?void 0:f.participantId;ie&&Tb({participantIds:[ie],tournamentRecord:ee}).success&&(J=ie)}if(S||((h=k.substitutions)==null?void 0:h.length)===1){if(S)j&&M&&(M.processCodes=Ht([...(M==null?void 0:M.processCodes)??[],...j]));else for(let ee of j||[]){let ne=(m=M==null?void 0:M.processCodes)==null?void 0:m.lastIndexOf(ee);ne!==void 0&&((g=M==null?void 0:M.processCodes)==null||g.splice(ne,1))}M&&di({tournamentId:I==null?void 0:I.tournamentId,matchUp:M,context:y,drawDefinition:w})}return N&&di({tournamentId:I==null?void 0:I.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...ae,modifiedLineUp:Y,participantRemoved:J,participantAdded:ce}}function Sye({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Se};let s=(i==null?void 0:i.lineUp)||((o=og({participantId:e,drawDefinition:n}))==null?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(s==null?void 0:s.map(c=>{var d;if(!r.includes(c.participantId))return c;let p=(d=c.collectionAssignments)==null?void 0:d.filter(f=>{let h=f.collectionId===a&&f.collectionPosition===t;return h&&(f.previousParticipantId&&l.push(f.previousParticipantId),u.push({participantId:c.participantId,...f})),!h});return{participantId:c.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function oqe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===Rr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(u=>u.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Hn({event:s});(n=l==null?void 0:l.flights)==null||n.forEach(u=>{u.drawEntries=(u.drawEntries||[]).filter(o)}),(r=s==null?void 0:s.drawDefinitions)==null||r.forEach(u=>{u.entries=(u.entries||[]).filter(o)})}return{...ae}}function hx({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return ue({result:{error:Oe},stack:r});if(!e||!t)return ue({result:{error:dt},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ue({result:{error:qn},stack:r});if(o!=null&&o.participantType&&![qi,Us].includes(o.participantType))return ue({context:{participantType:o.participantType},result:{error:Bu},stack:r});let s=t.filter(d=>{var p;return((p=a.find(f=>f.participantId===d))==null?void 0:p.participantType)!==ti});if(s.length)return ue({result:{error:Ol,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=t.filter(d=>!l.includes(d));u.length&&(i&&wO({individualParticipantIds:u,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:c}=iu();if(c.includes(ma)){let d=a.find(({participantId:p})=>p===e);oi({topic:ma,payload:{participants:[d]}})}return oqe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:ut(o,!1,!0),added:u.length,...ae}}function mx(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:Oe};if(!o)return{error:cb};if(!o.participantId)return Ec({tournamentRecord:r,participant:o});let{participant:s}=jg({participantId:o.participantId,tournamentRecord:r});if(!s)return Ec({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:c,participantName:d,participantRole:p,participantType:f,onlineResources:h,contacts:m,person:g}=o;if(f&&s.participantType!==f)return{error:bde};let v={};if(m&&(v.contacts=m),h&&(v.onlineResources=h),d&&typeof d=="string"&&(v.participantName=d),c&&typeof c=="string"&&(v.participantOtherName=c),Array.isArray(u)){let{participants:y}=jn({participantFilters:{participantTypes:[ti]},tournamentRecord:r}),b=y==null?void 0:y.map(ei);if(b){let I=u.filter(T=>typeof T=="string"&&b.includes(T));([Us,Xi].includes(f||s.participantType)||f===xt&&(I.length===2||a))&&(v.individualParticipantIds=I),s.participantType===OT.PAIR&&e&&(v.participantName=sqe({individualParticipants:y,newValues:v}))}}return Object.keys(KW).includes(p)&&(v.participantRole=p),Object.keys(OT).includes(f)&&(v.participantType=f),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===OT.INDIVIDUAL&&g&&lqe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,ft(v)),i&&hx({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),oi({topic:ma,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:ut(s),...ae}}function sqe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function lqe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,sex:u}=n;u&&Object.keys($W).includes(u)&&(r.sex=u);let c;if(l&&typeof l=="string"&&(r.personId=l),s&&typeof s=="string"&&(uqe(s)||s==="")&&(r.nationalityCode=s),a&&typeof a=="string"&&a.length>1&&(r.standardFamilyName=a,c=!0),o&&typeof o=="string"&&o.length>1&&(r.standardGivenName=o,c=!0),c&&t){let d=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=d}Object.assign(e.person,r)}function uqe(t){return Wf.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function xN(t){var e,i,n,r,a,o,s,l,u,c,d,p,f,h,m,g,v,y,b,I;let T=F5(t);if(T.error)return T;let w="assignTieMatchUpParticipantId",S=t.teamParticipantId,{tournamentRecord:U,drawDefinition:P,participantId:E,event:D}=t;if(!E)return ue({result:{error:wr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ue({result:{error:bq},stack:w});let{inContextDualMatchUp:R,inContextTieMatchUp:N,relevantAssignments:M,collectionPosition:A,teamParticipants:_,collectionId:k,matchUpType:B,dualMatchUp:F,tieFormat:x}=T;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(fe=>{var ge,me;return((ge=fe.participant)==null?void 0:ge.individualParticipantIds)||((me=fe.participant)==null?void 0:me.participantId)||[]}))!=null&&i.includes(E))return ue({result:{...ae},stack:w});S=S??(t.sideNumber?(r=(n=R==null?void 0:R.sides)==null?void 0:n.find(fe=>fe.sideNumber===t.sideNumber))==null?void 0:r.participantId:void 0);let $=(o=(a=jn({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:a.participants)==null?void 0:o[0];if(!$)return ue({result:{error:qn},stack:w});let{appliedPolicies:j}=Ai({tournamentRecord:U,drawDefinition:P,event:D}),V=((s=t.policyDefinitions)==null?void 0:s[Vr])??(j==null?void 0:j[Vr])??mS[Vr];if((t.enforceGender??((l=V==null?void 0:V.participants)==null?void 0:l.enforceGender))!==!1&&[Ki,vn].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((u=$.person)==null?void 0:u.sex))return{error:Y0,info:"Gender mismatch"};let{individualParticipantIds:H,participantType:z}=$;if(xn(Pn)(B)&&z!==ti)return{error:Bu};let q=z===ti?[E]:H,W=S&&(_==null?void 0:_.find(({participantId:fe})=>fe===S))||(_==null?void 0:_.find(({individualParticipantIds:fe})=>eo(q,fe)));if(!W)return{error:Rq};if(S||(S=W.participantId),!S)return{error:qn};let Y=(c=M==null?void 0:M.find(fe=>fe.participantId===(W==null?void 0:W.participantId)))==null?void 0:c.drawPosition,Z=(p=(d=F==null?void 0:F.sides)==null?void 0:d.find(fe=>fe.participantId===S))==null?void 0:p.sideNumber,X=(h=(f=N==null?void 0:N.sides)==null?void 0:f.find(fe=>Y&&fe.drawPosition===Y))==null?void 0:h.sideNumber,Q=Z??X??t.sideNumber;if(!x)return{error:dP};if(!((m=x.collectionDefinitions)!=null&&m.find(fe=>fe.collectionId===k)))return{error:dde};oE({tournamentId:U.tournamentId,eventId:D.eventId,inContextDualMatchUp:R,drawDefinition:P,dualMatchUp:F});let ce=(g=F==null?void 0:F.sides)==null?void 0:g.find(fe=>fe.sideNumber===Q),J=(v=N==null?void 0:N.sides)==null?void 0:v.find(fe=>fe.sideNumber===Q),ee=(I=(b=(ce==null?void 0:ce.lineUp)??((y=og({participantId:S,drawDefinition:P}))==null?void 0:y.lineUp))==null?void 0:b.filter(fe=>{var ge;return(ge=fe.collectionAssignments)==null?void 0:ge.find(me=>me.collectionPosition===A&&me.collectionId===k&&!me.previousParticipantId)}))==null?void 0:I.map(fe=>fe==null?void 0:fe.participantId),ne=(ee==null?void 0:ee.length)>1&&ee||(z===xt?$.individualParticipantIds:[E]),ie=Sye({collectionPosition:A,teamParticipantId:S,dualMatchUpSide:ce,drawDefinition:P,participantIds:ne,collectionId:k});if(ie.error)return ue({result:ie,stack:w});let{modifiedLineUp:oe}=ie,se;if(B===Yi){if(z!==xt){let fe=lF({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:oe,participantId:E,collectionId:k,tieFormat:x});if(fe!=null&&fe.error)return ue({result:fe,stack:w});if(fe=pe({side:J}),fe.error)return fe;se=fe.deletedParticipantId,ce&&(ce.lineUp=oe),F&&di({tournamentId:U==null?void 0:U.tournamentId,matchUp:F,context:w,drawDefinition:P})}else if(z===xt)for(let fe of ne)lF({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:oe,participantId:fe,collectionId:k,tieFormat:x})}else{let fe=lF({collectionPosition:A,teamParticipantId:S,drawDefinition:P,modifiedLineUp:oe,participantId:E,collectionId:k,tieFormat:x});if(fe!=null&&fe.error)return fe}if(ce&&(ce.lineUp=oe),F&&di({tournamentId:U==null?void 0:U.tournamentId,matchUp:F,context:w,drawDefinition:P}),se){let{error:fe}=Tb({participantIds:[se],tournamentRecord:U});fe&&console.log("cleanup")}return{...ae,modifiedLineUp:oe};function pe({side:fe}){let ge;if(fe.participant){let me=fe.participant.individualParticipantIds||[];if(me.filter(Boolean).length===1){let{participant:Ee}=Yl({participantIds:me,tournamentRecord:U});me.push(E);let{participant:Be}=Yl({participantIds:me,tournamentRecord:U});if(!Be&&Ee){Ee.individualParticipantIds=me;let Pe=mx({pairOverride:!0,tournamentRecord:U,participant:Ee});if(Pe.error)return Pe}else ge=Ee==null?void 0:Ee.participantId}}else{let me=Ec({participant:{individualParticipantIds:[E],participantRole:Sa,participantType:xt},pairOverride:!0,tournamentRecord:U});if(me.error)return me}return{...ae,deletedParticipantId:ge}}}function lF({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,l;let u=(s=og({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,c=(l=n||u)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===r),d={collectionId:a,collectionPosition:t};if(c)c.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:r};n.push(p)}return Db({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Tye(t){var e,i,n,r,a,o,s,l,u,c,d,p,f,h,m,g,v,y,b,I,T,w;let{tournamentRecord:S,drawDefinition:U,participantId:P,event:E}=t,D="removeTieMatchUpParticiapantId";if(!P)return ue({result:{error:wr},stack:D});let R=F5(t);if(R.error)return R;let{appliedPolicies:N}=Ai({tournamentRecord:S,drawDefinition:U,event:E}),M=(n=(i=((e=t.policyDefinitions)==null?void 0:e[Vr])??(N==null?void 0:N[Vr])??mS[Vr])==null?void 0:i.processCodes)==null?void 0:n.substitution,{inContextDualMatchUp:A,inContextTieMatchUp:_,relevantAssignments:k,collectionPosition:B,teamParticipants:F,collectionId:x,matchUpType:$,dualMatchUp:j,tieMatchUp:V,tieFormat:H}=R;if(!j)return ue({result:{error:No},stack:D});let z=(r=_==null?void 0:_.sides)==null?void 0:r.find(ce=>{var J,ee,ne;return((J=ce.participant)==null?void 0:J.participantId)===P||((ne=(ee=ce.participant)==null?void 0:ee.individualParticipantIds)==null?void 0:ne.includes(P))});if(!z)return ue({result:{error:qn},stack:D});if(!((a=z.substitutions)!=null&&a.length)&&(Jr({score:_==null?void 0:_.score})||_!=null&&_.winningSide))return ue({result:{error:Wde},stack:D});let q=(s=(o=A==null?void 0:A.sides)==null?void 0:o.find(({sideNumber:ce})=>ce===z.sideNumber))==null?void 0:s.participantId;if(!q)return ue({result:{error:qn},stack:D});let W=(u=(l=jn({participantFilters:{participantIds:[P]},tournamentRecord:S}))==null?void 0:l.participants)==null?void 0:u[0];if(!W)return ue({result:{error:qn},stack:D});if($===Pn&&W.participantType===xt)return ue({result:{error:Y0},stack:D});let Y=W.participantType===ti?[P]:W.individualParticipantIds;oE({tournamentId:S.tournamentId,eventId:E.eventId,inContextDualMatchUp:A,drawDefinition:U,dualMatchUp:j});let Z=(c=j.sides)==null?void 0:c.find(({sideNumber:ce})=>ce===z.sideNumber);if(!Z&&(((d=j.sides)==null?void 0:d.filter(({lineUp:ce})=>!ce).length)||0)<2){let ce=F==null?void 0:F.map(({participantId:J})=>{var ee;return{drawPosition:(ee=k==null?void 0:k.find(ne=>ne.participantId===J))==null?void 0:ee.drawPosition,teamParticipantId:J}});Z=(p=j.sides)==null?void 0:p.find(J=>{var ee;return((ee=ce==null?void 0:ce.find(({drawPosition:ne})=>ne===J.drawPosition))==null?void 0:ee.teamParticipantId)===q})}if(!Z)return ue({result:{error:qn,context:{participantId:P}}});let{modifiedLineUp:X,previousParticipantIds:Q}=Sye({collectionPosition:B,teamParticipantId:q,dualMatchUpSide:Z,participantIds:Y,drawDefinition:U,collectionId:x});if(Z.lineUp=X,q&&H&&Db({participantId:q,lineUp:X,drawDefinition:U,tieFormat:H}),$===Yi&&W.participantType===ti){let ce=(f=_==null?void 0:_.sides)==null?void 0:f.find(ne=>ne.sideNumber===(Z==null?void 0:Z.sideNumber)),{participantId:J}=ce??{},ee=J&&((m=(h=jn({participantFilters:{participantIds:[J]},tournamentRecord:S,withDraws:!0}))==null?void 0:h.participants)==null?void 0:m[0]);if(ee){let ne=((g=ee==null?void 0:ee.individualParticipantIds)==null?void 0:g.filter(ie=>ie!==P))??[];if(Q&&ne.push(...Q),ne.length>2)return ue({result:{error:Ol},stack:D});if((v=ee.draws)!=null&&v.length){if(ne.length===1){let{participant:ie}=Yl({participantIds:ne,tournamentRecord:S});if(!ie){let oe=Ec({participant:{participantRole:Sa,individualParticipantIds:ne,participantType:xt},pairOverride:!0,tournamentRecord:S});if(oe.error)return ue({result:oe,stack:D})}}}else if(ne.length){ee.individualParticipantIds=ne;let ie=mx({participant:ee,pairOverride:!0,tournamentRecord:S});if(ie.error)return ue({result:ie,stack:D})}else{let ie=Tb({participantIds:[J],tournamentRecord:S});ie.error&&console.log("cleanup",{result:ie})}}else return ue({result:{error:qn},stack:D})}if(((y=z.substitutions)==null?void 0:y.length)===1&&!((T=(I=(b=_==null?void 0:_.sides)==null?void 0:b.find(ce=>ce.sideNumber!==z.sideNumber))==null?void 0:I.substitutions)!=null&&T.length)&&(w=V==null?void 0:V.processCodes)!=null&&w.length){for(let ce of M||[]){let J=V.processCodes.lastIndexOf(ce);V.processCodes.splice(J,1)}di({tournamentId:S==null?void 0:S.tournamentId,matchUp:V,context:D,drawDefinition:U})}return di({tournamentId:S==null?void 0:S.tournamentId,matchUp:j,context:D,drawDefinition:U}),{...ae,modifiedLineUp:X}}function $5(t){var e,i;let n=wi(t,[{[Fd]:!0,[Yu]:!0,[_g]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:Se,sideNumber:a};let{matchUp:l,structure:u}=on({drawDefinition:r,matchUpId:o,event:s});return l?ns({structure:u})?((e=l.sides)==null||e.forEach(c=>{(!a||c.sideNumber===a)&&delete c.participantId}),di({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...ae}):{error:lq}:{error:Da}}function cqe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var c;let d=ut(r,void 0,!0);for(let f of(d==null?void 0:d.tieMatchUps)||[])f.matchUpId===s.matchUpId&&(f.winningSide=n,f.score=u,!Jr({score:u})&&!e?Object.assign(f,{...EO}):e&&(f.matchUpStatus=e));a=a??((c=_a({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:c.tieFormat);let{winningSide:p}=aE({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function dqe({matchUpStatuses:t=[Di,Ni,bi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(r=a==null?void 0:a.drawPositions)==null?void 0:r.find(d=>d!==i),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),u=eo(s||[],t),c=eo(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:u,winnerMatchUpStatuses:s,loserHadMatchUpStatus:c,loserMatchUpStatuses:l}}function pqe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:c}){let{structure:d}=Pt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===oo)return{...ae};u=u??ya({drawDefinition:a});let p=((u==null?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:f}=gy({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==f&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Hi({drawDefinition:a,structureId:o});for(let g of h??[])fqe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:c});return{...ae}}function fqe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:c}){var d,p,f;let h="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>u.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(f=u.sides)==null?void 0:f.find(y=>y.sideNumber===g);v&&delete v.lineUp}u.drawPositions=(u.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let m=e.filter(({drawPosition:g})=>{var v;return(v=u.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return u.matchUpStatus=m&&Di||[bi,Ni].includes(u.matchUpStatus)&&u.matchUpStatus||Vn,[Ni,bi].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&fhe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),di({tournamentId:r==null?void 0:r.tournamentId,eventId:c==null?void 0:c.eventId,context:`${h}-${n}`,drawDefinition:o,matchUp:u}),{...ae}}function TS(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:c,event:d}=t,p=!!t.matchUp.collectionId,f=ns({structure:c}),{drawPositions:h,winningSide:m}=l.matchUp||{};if(!f&&!h)return{error:lP};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,w=cc({...t,matchUpStatus:a||Vn,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:k,matchUpsMap:B}=t;if(S=df({appliedPolicies:t.appliedPolicies,matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:B,event:d}),!e&&!S.removeWinningSide)return{...ae}}if(f)return{...ae};let{matchUps:U}=Ci({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:c}),{positionAssignments:P}=Or({structure:c}),E=m-1,D=1-E,R=h[E],N=h[D],{winnerParticipantId:M,loserParticipantId:A}=(P==null?void 0:P.reduce((k,B)=>(B.drawPosition===N&&(k.loserParticipantId=B.participantId),B.drawPosition===R&&(k.winnerParticipantId=B.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(k=>{var B;return(B=k.drawPositions)==null?void 0:B.includes(N)});if(I&&Uye({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:R,winnerParticipantId:M,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:o}),b){let{winnerHadMatchUpStatus:k}=dqe({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),B=g.linkCondition===Nd;if(k&&B){let x=Math.min(...b.drawPositions);m$({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:x,matchUpsMap:o,event:d})}let F=hqe({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:o,event:d});if(F.error)return F}if(T){let k=Math.min(...T.drawPositions);m$({sourceMatchUpId:u,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:k,matchUpsMap:o,event:d})}return{...ae,...S&&{tieMatchUpResult:S}}}function Uye({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:c,event:d}){var p,f;let{structureId:h,roundNumber:m}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=Pt({drawDefinition:s,structureId:v});if(!y)return{error:Tn};let{positionAssignments:b}=Or({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(P=>P.participantId!==n);let I=(p=b==null?void 0:b.find(P=>P.participantId===n))==null?void 0:p.drawPosition,{matchUps:T}=Ci({drawDefinition:s,structure:y,event:d}),w=T.map(P=>P.drawPositions).flat(1/0).filter(Boolean),S=ts(w);if((I?S[I]:void 0)===1)b==null||b.forEach(P=>{P.participantId===n&&delete P.participantId});else{let P=T.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let U=(f=u==null?void 0:u.drawMatchUps)==null?void 0:f.find(({matchUpId:P})=>P===l.matchUpId);U&&di({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:g,drawDefinition:s})}return m&&pqe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:c,matchUpsMap:u,roundNumber:m,structureId:h}),{...ae}}function hqe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var c,d,p;let f="removeDirectedLoser",h=n.target.structureId,{structure:m}=Pt({drawDefinition:a,structureId:h});if(!m)return{error:Tn};let{positionAssignments:g}=Or({structure:m}),v=(c=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:c.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),m.seedAssignments=(m.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((T,w,S)=>w.drawPosition===v?S:T,void 0),b=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:T})=>T===o.matchUpId),I=(p=b==null?void 0:b.sides)==null?void 0:p[y];I&&(delete I.lineUp,di({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,matchUp:b,context:f,drawDefinition:a}))}return{...ae}}function m$({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return HP({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...ae}}function mqe(t){var e,i;let{matchUpFormat:n,score:r}=t,a=(e=r==null?void 0:r.sets)==null?void 0:e.length,o=n&&bo(n),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return((i=u&&a===u&&l||s)==null?void 0:i.timed)||!1}function gqe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return ue({result:{error:ww},context:{matchUpStatus:Di},stack:a});let{positionAssignments:o}=Or({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(r=n.drawPositions)!=null&&r.some(l=>s==null?void 0:s.includes(l))?(n.matchUpStatus=Di,n.matchUpStatusCodes=[],di({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:n}),{...ae}):ue({result:{error:cde},info:"matchUp does not include BYE",stack:a})}function $T(t){var e;let{tournamentRecord:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,structure:s,event:l}=t,u="doubleExitAdvancement";if(s.structureType===oo)return ue({result:{...ae},stack:u});let{matchUp:c,targetMatchUps:d,targetLinks:p}=o,{loserMatchUp:f,winnerMatchUp:h,loserTargetDrawPosition:m}=d;if(f&&f.matchUpStatus!==Di){let{loserTargetLink:g}=p;if((e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){let v=Dye({loserTargetDrawPosition:m,tournamentRecord:i,loserTargetLink:g,drawDefinition:r,loserMatchUp:f,matchUpsMap:a,event:l});if(v.error)return ue({result:v,stack:u})}else{let{feedRound:v,drawPositions:y,matchUpId:b}=f,I=v?2:2-y.indexOf(m),T=eY({...t,targetMatchUp:f,walkoverWinningSide:I,tournamentRecord:i,sourceMatchUp:c,matchUpId:b});if(T.error)return ue({result:T,stack:u})}}if(h){let g=eY({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:i,sourceMatchUp:c});if(g.error)return ue({result:g,stack:u})}return ue({result:{...ae},stack:u})}function eY(t){var e,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=t,c=o.structures.find(({structureId:Y})=>Y===l.structureId),d=t.matchUpStatus===Ir?Ir:nr,p=t.matchUpStatus===Ir?bi:Ni,f="conditionallyAdvanceDrawPosition",h=u.drawMatchUps.find(Y=>Y.matchUpId===l.matchUpId);if(!h)return{error:No};let m=(s==null?void 0:s.drawPositions)||[],g=(e=h.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&eo(m,g)&&(g=g.filter(Y=>!m.includes(Y))),v&&g.length>1)return ue({result:{error:Iw},stack:f});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:b}=dhe(t),I=io({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:o}),{targetMatchUps:T,targetLinks:w}=I,{loserTargetDrawPosition:S,winnerMatchUp:U,loserMatchUp:P}=T;if(P){let{loserTargetLink:Y}=w,Z=Dye({loserTargetDrawPosition:S,loserMatchUp:P,tournamentRecord:a,loserTargetLink:Y,drawDefinition:o,matchUpsMap:u});if(Z.error)return ue({result:Z,stack:f})}let E=((i=h.drawPositions)==null?void 0:i.filter(Boolean))||[],D=E.length===1,R=t.walkoverWinningSide||D&&MR({drawPosition:E[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,N=[Ni,bi].includes(h.matchUpStatus)&&!E.length,M=h.finishingRound===1,A=N&&!M?d:p,_=r.find(Y=>Y.matchUpId===b.matchUpId),k=[],B;s&&((s==null?void 0:s.structureId)===(_==null?void 0:_.structureId)?s.roundPosition<(b==null?void 0:b.roundPosition)?B=1:B=2:l.feedRound?s.structureId===l.structureId?B=2:B=1:R&&(B=3-R));let F=t.matchUpStatus,x=b==null?void 0:b.matchUpStatus;B===1?k=[{matchUpStatus:hC(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:hC(x),previousMatchUpStatus:x,sideNumber:2}]:B===2&&(k=[{matchUpStatus:hC(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:hC(F),previousMatchUpStatus:F,sideNumber:2}]),k.length&&(k=k.map(Y=>ft(Y)));let $=cc({...t,winningSide:R,matchUp:h,matchUpStatusCodes:k,context:f,matchUpStatus:A});if($.error)return ue({result:$,stack:f});if(N)return $T({...t,matchUpStatus:A,targetData:I});if(!U)return ue({result:{...ae},stack:f});let j=g.length===2?g[R-1]:g[0],{positionAssignments:V}=Hi({structure:c}),H=V==null?void 0:V.find(Y=>Y.drawPosition===j),z=u.drawMatchUps.find(Y=>Y.matchUpId===U.matchUpId),q=(n=z==null?void 0:z.drawPositions)==null?void 0:n.filter(Boolean),W=q.length===1;if(j){if(H!=null&&H.bye){let Y=io({matchUpId:z.matchUpId,inContextDrawMatchUps:r,drawDefinition:o});if(W){let Z=q.filter(Boolean)[0],X=MR({drawPosition:Z,matchUpId:z.matchUpId,inContextDrawMatchUps:r}),Q=cc({appliedPolicies:t.appliedPolicies,matchUpId:z.matchUpId,matchUp:z,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:f,drawDefinition:o,winningSide:X});return Q.error?ue({result:Q,stack:f}):HW({drawPositionToAdvance:Z,matchUpId:z.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:u})}else if([Ni,bi].includes(U.matchUpStatus)){let Z=$T({...t,matchUpId:z.matchUpId,matchUpStatus:A,targetData:Y});if(Z.error)return ue({result:Z,stack:f})}return ue({result:{...ae},stack:f})}return Lw({matchUpId:U.matchUpId,drawPosition:j,inContextDrawMatchUps:r,drawDefinition:o})}else if(y){if(!z)return{error:No};if(W){let X=q[0],Q=MR({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:X});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Q})}let Y=[Ni,bi].includes(z.matchUpStatus)?p:d,Z=cc({matchUpId:z.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:z,matchUpStatusCodes:[],removeScore:!0,context:f,drawDefinition:o,matchUpStatus:Y});if(Z.error)return ue({result:Z,stack:f});if(Y===d){let X=$T({...t,matchUpId:l.matchUpId,matchUpStatus:Y,targetData:I});if(X.error)return X}}return ue({result:{...ae},stack:f})}function Dye(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=r==null?void 0:r.target)==null?void 0:e.structureId,{structure:u}=Pt({drawDefinition:a,structureId:l});return u?Ds({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Lh}}function hC(t){return t===nr?Ni:t===Ir?bi:t}function vqe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===Di,u=a.winningSide,c=[nr,Ir].includes(n),d=jP({matchUpStatus:n}),p=GB({matchUpStatus:n}),f=!d&&!p,h=t.matchUpTieId||u&&d&&!c,m=u&&c,g=()=>cc({...t,removeScore:[af,Ni].includes(n),matchUpStatus:n||Vn});return f&&{error:UB}||h&&g$(t)||m&&yqe(t)||u&&TS(t)||p&&g()||l&&gqe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:UB}||c&&bqe(t)||o&&g$(t)||ue({result:{error:ww},stack:s})}function yqe(t){let e=TS(t);return e.error?e:$T(t)}function bqe(t){let e=g$({...t,removeScore:!0});return e.error?e:$T(t)}function g$(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=TS(t);if(a.error)return ue({result:a,stack:i})}let n=!!t.matchUp.collectionId,r=cc({...t,context:i});if(n){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=df({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ue({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return ue({result:r,stack:i})}function Iqe({drawDefinition:t,structure:e,matchUp:i}){var n,r,a,o;let{drawPositions:s}=i,{positionAssignments:l}=Hi({drawDefinition:t,structure:e}),u=(n=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:n.map(p=>{var f;let{extension:h}=qt({element:p,name:fh});return(f=h==null?void 0:h.value)==null?void 0:f.groupOrder}),{containerStructures:c}=lS({drawDefinition:t}),d=c[e.structureId];return{structureIds:(o=(a=(r=pS({drawDefinition:t,structureId:d}))==null?void 0:r.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var f;return eo(u,((f=p.source)==null?void 0:f.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Pye({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===sS&&yh({drawDefinition:t,structure:e})){let{structureIds:r}=Iqe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function wqe(t){var e,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===Su){let c=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===u.target.structureId&&p.roundNumber===u.target.roundNumber&&p.sides.some(({participantId:f})=>f===c));if((d==null?void 0:d.matchUpStatus)===Vn){let p=io({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!ug({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:f}=Pt({structureId:d.structureId,drawDefinition:s}),h=Hi({structure:f}).positionAssignments;for(let m of h||[])if(m.participantId===c){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(m.participantId=g,f==null?void 0:f.positionAssignments)f.positionAssignments=h;else if(f!=null&&f.structures){let v=Object.assign({},...(h||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of f.structures)(i=y.positionAssignments)==null||i.forEach(b=>b.participantId=v[b.drawPosition])}gh({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:s,structure:f}),r=!0}}}}return{...ae,qualifierReplaced:r}}function Sqe(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:c}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===Su){let p=(i=l.sides.find(({sideNumber:m})=>m===c))==null?void 0:i.participantId,f=s.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=Rl(f);if((h==null?void 0:h.matchUpStatus)===Vn){let m=io({matchUpId:h.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!ug({inContextDrawMatchUps:s,drawDefinition:u,targetData:m})){let g=(n=h.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:n.drawPosition,{structure:v}=Pt({structureId:h.structureId,drawDefinition:u});if(!v)return{error:Tn};let y=Hi({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(r=T.positionAssignments)==null||r.forEach(w=>w.participantId=I[w.drawPosition])}gh({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:v}),o=!0}}}}return{...ae,qualifierPlaced:o}}function Tqe(t){var e,i;let n="attemptToSetWinningSide",r,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:c,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return v4(t);if(d.winningSide&&d.winningSide!==u){let{connectedStructureIds:m}=Pye({drawDefinition:s,structure:c,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);let g=TS(t);if(g.error)return g}let p=ame(t);if(p.error)return ue({result:p,stack:n});let f,h;return t.qualifierChanging&&(e=a==null?void 0:a[HU])!=null&&e.autoReplaceQualifiers&&(f=wqe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[HU])!=null&&i.autoPlaceQualifiers&&(h=Sqe(t).qualifierPlaced),ue({result:ft({...ae,...p,connectedStructures:r,qualifierReplaced:f,qualifierPlaced:h}),stack:n})}var kR={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Eye(t){var e;let{inContextDrawMatchUps:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,matchUp:s}=t,{iteration:l=0}=t;l+=1;let u="removeDoubleExit";Ks({method:u,color:"brightyellow",iteration:l,keyColors:kR});let{targetLinks:{loserTargetLink:c},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:f}}=o;if(p&&p.matchUpStatus!==Di){let{stage:h,roundNumber:m,roundPosition:g}=p;Ks({winner:"winner",stage:h,roundNumber:m,roundPosition:g,keyColors:kR}),tY({...t,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(d&&d.matchUpStatus!==Di){let h=i.find(({matchUpId:I})=>I===d.matchUpId),{structure:m}=Pt({drawDefinition:r,structureId:h.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=d;if(Ks({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:kR,feedRound:b}),(e=n==null?void 0:n.progression)==null?void 0:e.doubleExitPropagateBye)m$({drawPosition:f,targetLink:c,inContextDrawMatchUps:i,drawDefinition:r,matchUpsMap:a});else{let I=tY({...t,structure:m,targetMatchUp:d,iteration:l});if(I.error)return ue({result:I,stack:u})}}return ue({result:{...ae},stack:u})}function tY(t){var e,i,n,r,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:c,targetMatchUp:d,matchUpsMap:p,structure:f,iteration:h}=t,m="conditionallyRemoveDrawPosition";Ks({method:m});let g=io({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(E=>E.matchUpId===d.matchUpId),b=[],I,T,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(E=>d.drawPositions.includes(E));else if(!c)w=(n=$n((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:n[0];else if(T=(r=phe({structureId:f.structureId,matchUp:c,matchUpsMap:p}))==null?void 0:r.pairedPreviousMatchUp,I=[nr,Ir].includes(T==null?void 0:T.matchUpStatus),b=((a=T==null?void 0:T.drawPositions)==null?void 0:a.filter(Boolean))||[],[...kr,Di].includes(T==null?void 0:T.matchUpStatus)||(T==null?void 0:T.winningSide)){let E=c.drawPositions||[],D=(o=d.drawPositions)==null?void 0:o.filter(Boolean);eo(E,D)&&(D=D==null?void 0:D.filter(R=>!E.includes(R))),w=E.concat(b).find(R=>D==null?void 0:D.includes(R))}if(v&&w){let{stage:E,roundNumber:D,roundPosition:R}=v;Ks({method:"removeDirectedWinner",drawPositionToRemove:w,keyColors:kR,color:"brightgreen",stage:E,roundNumber:D,roundPosition:R}),Uye({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let S=Eye({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:f,iteration:h});if(S.error)return ue({result:S,stack:m});let U=Uqe({pairedPreviousDoubleExit:I,noContextTargetMatchUp:y}),P=!I;return S=cc({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:m,matchUpStatus:U,removeScore:P,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),S.error?ue({result:S,stack:m}):{...ae}}function Uqe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Di?Di:t?[Ir,bi].includes(e==null?void 0:e.matchUpStatus)?bi:Ni:Vn}function Dqe(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===Su){let d=(n=(i=l.sides)==null?void 0:i.find(({sideNumber:f})=>f===l.winningSide))==null?void 0:n.participantId,p=s.find(f=>{var h;return f.structureId===c.target.structureId&&f.roundNumber===c.target.roundNumber&&((h=f.sides)==null?void 0:h.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Vn){let f=io({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u});if(!ug({inContextDrawMatchUps:s,drawDefinition:u,targetData:f})){let{structure:h}=Pt({structureId:p.structureId,drawDefinition:u}),m=Hi({structure:h}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=m;else if(h!=null&&h.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(h==null?void 0:h.structures)||[])(r=y.positionAssignments)==null||r.forEach(b=>b.participantId=v[b.drawPosition])}gh({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:u,structure:h}),o=!0}}}}return{qualifierRemoved:o}}function Pqe(t){var e;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=t,o="noDownStreamDependencies";if([nr,Ir].includes(i==null?void 0:i.matchUpStatus)&&![nr,Ir].includes(n)){let g=Eye(t);if(g.error)return ue({result:g,stack:o})}let s=n===nr,l=Jr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),u=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&mqe(t.inContextMatchUp),c=t.removeScore||!u&&![Sc,vs].includes(n||Sc),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!Jr({score:r}),p=n&&n!==Vn,f=g=>{var v,y;let b,{structure:I,drawDefinition:T,dualMatchUp:w,disableAutoCalc:S}=t;if(w!=null&&w._disableAutoCalc&&S!==!1)return v4(t);let{connectedStructureIds:U}=Pye({drawDefinition:T,structure:I,matchUp:i});U.length&&(console.log({connectedStructureIds:U}),b=!0),Object.assign(t,{removeScore:g});let P=TS(t);if(P.error)return P;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[HU])!=null&&y.autoRemoveQualifiers){let E=Dqe(t);return{...ae,connectedStructures:b,...E}}return{...ae,connectedStructures:b}};if(d&&a&&t.isCollectionMatchUp)return iY(t);let h=[af,vs].includes(n)&&t.dualWinningSideChange,m=(a||h)&&Tqe(t)||l&&f(c)||p&&vqe(t)||d&&f(c)||i&&iY({...t,removeScore:!0})||{...ae};return ue({result:m,stack:o})}function iY(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let r=TS(t);if(r.error)return r}let n=cc({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=df({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ue({result:n,stack:i})}function Wh(t){var e;let i="addMatchUpScheduledTime",n=t.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=t;if(!u)return ue({result:{error:va},stack:i});if(!iS(l))return ue({result:{error:wl},stack:i});if(!n){let h=on({drawDefinition:o,matchUpId:u});if(h.error)return ue({result:h,stack:i});n=h.matchUp}let c=Bt(l),d=ag({matchUp:n}).scheduledDate,p=c&&!d;if((e=OW({matchUp:n}).timeModifiers||[])!=null&&e.length){let h=Cye({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:n});if(h!=null&&h.error)return ue({result:h,stack:i})}let f=fb(l,!0,p);return bs({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:dS,itemValue:f}})}function Cye({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ue({result:{error:va},stack:s});if(r!==void 0&&!Array.isArray(r))return ue({info:Od("timeModifiers"),result:{error:Se},stack:s});if(!o){let d=on({drawDefinition:i,matchUpId:a});if(d.error)return ue({result:d,stack:s});o=d.matchUp}let l=OW({matchUp:o}).timeModifiers||[],u=r.filter(d=>!l.includes(d));if(r.length&&!u.length)return{...ae};if(u.some(d=>FB.includes(d))){l=l.filter(p=>!FB.includes(p));let d=Wh({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ue({result:d,stack:s})}let c=r!=null&&r.length?[...u,...l]:void 0;return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:_W,itemValue:c}})}function gx({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!e)return{error:Oe};if(!o)return{error:va};let c=on({drawDefinition:n,matchUpId:o});if(c.error)return c;if(((l=c==null?void 0:c.matchUp)==null?void 0:l.matchUpType)!==Tc)return{error:go};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Se,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},f=pf({tournamentRecords:p});if(f.error)return f;let h=(u=f.courts)==null?void 0:u.filter(m=>s.includes(m.courtId));if((h==null?void 0:h.length)!==s.length)return{error:Se,context:{courtIds:s}};d=h==null?void 0:h.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Lp,itemDate:a,itemValue:d}})}function US({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:Oe};if(!a)return{error:va};if(o){let s=lf({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:uS,itemValue:o}})}function Nb({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:Oe};if(!o)return{error:va};if(s){let u=bb({tournamentRecords:e,tournamentRecord:i,courtId:s});if(u.error)return u;let c=(l=u.venue)==null?void 0:l.venueId;US({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:c})}return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:rg,itemDate:a,itemValue:s}})}function nc(t,e){let i=Upe.test(t)?t:an(t),n=Bt(t)||Bt(e)||Nu(new Date);return new Date(`${n}T${i}`).getTime()}function vx({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:u,matchUpId:c,schedule:d,event:p}){var f;if(!d)return{error:dt,info:"Missing schedule"};if(!s)return{error:nt};if(!c)return{error:va};let h="addMatchUpScheduleItems",m,g;if(u)m=u.find(N=>N.matchUpId===c);else{let N=on({drawDefinition:s,event:p,matchUpId:c});if(N.error)return N;m=N.matchUp}let{endTime:v,courtId:y,courtIds:b,courtOrder:I,resumeTime:T,scheduledDate:w,scheduledTime:S,startTime:U,stopTime:P,timeModifiers:E,venueId:D}=d;e&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=su({drawDefinition:s}));let R=(f=i==null?void 0:i[c])==null?void 0:f.matchUpIds;if(d.scheduledDate&&e&&R){let N=n==null?void 0:n.filter(M=>{var A,_;return(((A=M.schedule)==null?void 0:A.scheduledDate)||Bt((_=M.schedule)==null?void 0:_.scheduledTime))&&R.includes(M.matchUpId)}).map(({schedule:M})=>{let A=uN(M);return new Date(A).getTime()});if(N!=null&&N.length){let M=uN(d),A=new Date(M).getTime();if(Math.max(...N)>=A){if(t)return ue({result:{error:wB},stack:h});g=wB}}}if(w!==void 0){let N=yx({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:c});if(N!=null&&N.error)return ue({result:N,stack:h,context:{scheduledDate:w}})}if(S!==void 0){let N=Wh({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledTime:S,matchUpId:c,matchUp:m});if(N!=null&&N.error)return ue({result:N,stack:h,context:{scheduledTime:S}})}if(U!==void 0){let N=j5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:c,startTime:U,event:p});if(N!=null&&N.error)return ue({result:N,stack:h,context:{startTime:U}})}if(P!==void 0){let N=H5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:c,stopTime:P,event:p});if(N!=null&&N.error)return ue({result:N,stack:h,context:{stopTime:P}})}if(T!==void 0){let N=z5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,resumeTime:T,matchUpId:c,event:p});if(N!=null&&N.error)return ue({result:N,stack:h,context:{resumeTime:T}})}if(v!==void 0){let N=G5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:c,endTime:v,event:p});if(N!=null&&N.error)return ue({result:N,stack:h,context:{endTime:v}})}if(b!==void 0){let N=gx({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:c,courtIds:b});if(N!=null&&N.error)return ue({result:N,stack:h,context:{courtIds:b}})}if(y!==void 0&&w!==void 0){let N=Nb({courtDayDate:w,disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:c,courtId:y});if(N!=null&&N.error)return ue({result:N,stack:h,context:{courtId:y}})}if(D!==void 0){let N=US({disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:c,venueId:D});if(N!=null&&N.error)return ue({result:N,stack:h,context:{venueId:D}})}if(I!==void 0&&At(I)){let N=V5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,courtOrder:I,matchUpId:c});if(N!=null&&N.error)return ue({result:N,stack:h,context:{courtOrder:I}})}if(E!==void 0){let N=Cye({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,timeModifiers:E,matchUpId:c,matchUp:m});if(N!=null&&N.error)return ue({result:N,stack:h,context:{timeModifiers:E}})}return l||di({tournamentId:o==null?void 0:o.tournamentId,eventId:p==null?void 0:p.eventId,context:h,drawDefinition:s,matchUp:m}),g?{...ae,warnings:[g]}:{...ae}}function yx({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:va};let o=t&&Ed.test(t);if(t&&!o)return{error:Qa};let s={itemValue:Bt(t),itemType:cS};return bs({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function V5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:va};if(r&&!At(r))return{error:Se,info:"courtOrder must be numeric"};let o=r&&Tt(r);return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:AW,itemValue:o}})}function Rye({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:va};if(!r)return{error:wr};if(e){let l=jn({tournamentRecord:e,participantFilters:{participantTypes:[ti],participantRoles:[WW]}}).participants??[];if(!ph({tournamentParticipants:l,participantId:r}))return{error:qn}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function j5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:va};if(!iS(a))return{error:wl};let{matchUp:s}=on({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=ag({matchUp:s}),u=((s==null?void 0:s.timeItems)??[]).filter(c=>[dp,ld,Fp].includes(c==null?void 0:c.itemType)).map(c=>nc(c.itemValue,l)).reduce((c,d)=>!c||d<c?d:c,void 0);if(!u||nc(a,l)<u){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==Tu));let c=fb(a,!0,!0);return bs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:Tu,itemValue:c}})}else return{error:Lde}}function G5({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:va};if(!iS(o))return{error:wl};let{matchUp:l}=on({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:u}=ag({matchUp:l}),c=((l==null?void 0:l.timeItems)??[]).filter(d=>[Tu,ld,dp].includes(d==null?void 0:d.itemType)).map(d=>nc(d.itemValue,u)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!c||nc(o,u)>c){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Fp));let d=fb(o,!0,!0);return bs({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Fp,itemValue:d}})}else return{error:Ode}}function H5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:va};if(!iS(a))return{error:wl};let{matchUp:s}=on({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=ag({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,m)=>m.itemType===Fp||h,void 0))return{error:Dq};let c=u.filter(h=>[Tu,ld,dp].includes(h==null?void 0:h.itemType)).sort((h,m)=>nc(h.itemValue,l)-nc(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===dp,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>nc(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(nc(a,l)>f){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:fb(a,!0,!0),itemType:dp};return bs({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:h})}else return{error:xde}}function z5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:va};if(!iS(r))return{error:wl};let{matchUp:s}=on({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=ag({matchUp:s}),u=(s==null?void 0:s.timeItems)??[];if(u.reduce((h,m)=>m.itemType===Fp||h,void 0))return{error:Dq};let c=u.filter(h=>[Tu,ld,dp].includes(h==null?void 0:h.itemType)).sort((h,m)=>nc(h.itemValue,l)-nc(m.itemValue,l)),d=c[c.length-1],p=d&&d.itemType===ld,f=c.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>nc(h.itemValue,l)).reduce((h,m)=>!h||m>h?m:h,void 0);if(nc(r,l)>f){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let h={itemValue:fb(r,!0,!0),itemType:ld};return bs({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:h})}else return{error:J2e}}function Eqe(t){var e;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=t,o=n.roundNumber,s=n.sides.find(w=>w.sideNumber===n.winningSide),l=n.sides.find(w=>w.sideNumber!==n.winningSide),{drawPosition:u,participantId:c}=s,{drawPosition:d,participantId:p}=l,f="swapWinnerLoser",{matchUps:h}=Ci(t),m=h.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(u))&&S>o);il({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(P=>P===u?d:P))||[],di({tournamentId:i==null?void 0:i.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:f,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=r,y=a.structures.filter(({stage:w,stageSequence:S})=>w===g&&S>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:b,winnerTargetLink:I}}=t.targetData,T=[b==null?void 0:b.target.structureId,(e=I==null?void 0:I.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:S})=>w!==g&&T.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{y.includes(U)||y.push(U),a.structures.filter(({stage:P,stageSequence:E})=>P===w&&E>S).forEach(({structureId:P})=>{y.includes(P)||y.push(P)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:S}=Hi({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===c),P=S==null?void 0:S.find(({participantId:E})=>E===p);U&&(U.participantId=p),P&&(P.participantId=c)}),cc({...t,context:f})}function yE(t){var e,i,n,r;let a="setMatchUpStatus";t.matchUpStatus&&[Ni,nr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:o,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:u,disableAutoCalc:c,enableAutoCalc:d,drawDefinition:p,matchUpStatus:f,winningSide:h,matchUpId:m,event:g,score:v}=t;if(!p)return{error:nt};if(f&&[af,Sc,vs,Vn].includes(f)&&h)return{error:Se,winningSide:h,matchUpStatus:f};if(![void 0,...$pe].includes(f))return ue({result:{error:ww},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let y=ya({drawDefinition:p}),{matchUps:b}=fr({nextMatchUps:!0,tournamentRecord:u,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g}),I=y.drawMatchUps.find(W=>W.matchUpId===m),T=b==null?void 0:b.find(W=>W.matchUpId===m);if(!I||!b)return{error:Da};if((I.winningSide||h)&&f===Di)return{context:"Cannot have Bye with winningSide",error:IR,matchUpStatus:f};let w=T==null?void 0:T.structureId,{structure:S}=Pt({drawDefinition:p,structureId:w}),U=xn(Xi)(I.matchUpType),P=(e=T==null?void 0:T.drawPositions)==null?void 0:e.filter(Boolean),E;if(U){if(c)hi({extension:{name:Cw,value:!0},element:I});else if(d){let W=I.winningSide;qa({name:Cw,element:I});let{winningSide:Y,scoreStringSide1:Z,scoreStringSide2:X,set:Q}=aE({drawDefinition:p,matchUpsMap:y,structure:S,matchUp:I,event:g}),ce={scoreStringSide1:Z,scoreStringSide2:X,sets:Q?[Q]:[]};E=Y!==W,Object.assign(t,{winningSide:Y,dualWinningSideChange:E,projectedWinningSide:Y,score:ce})}oE({tournamentId:u==null?void 0:u.tournamentId,inContextDualMatchUp:T,eventId:g==null?void 0:g.eventId,dualMatchUp:I,drawDefinition:p})}if(U&&f&&[hb].includes(f))return{error:Se,info:"Not supported for matchUpType: TEAM"};let D=T==null?void 0:T.matchUpTieId,R=io({matchUpId:D||m,inContextDrawMatchUps:b,drawDefinition:p});if(v&&!U&&!s){let W=I.matchUpFormat??(S==null?void 0:S.matchUpFormat)??(p==null?void 0:p.matchUpFormat)??(g==null?void 0:g.matchUpFormat),Y=H4({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:W,matchUpStatus:f,winningSide:h,score:v});if(Y.error)return Y}let N=I!=null&&I.sides?[]:Hi({drawDefinition:p,structureId:w}).positionAssignments,M=(i=T==null?void 0:T.sides)==null?void 0:i.map(W=>W.participantId).filter(Boolean).length,A=M&&M===2||I.collectionId&&ns({structure:S})&&M&&M>=1||(P==null?void 0:P.length)===2&&(N==null?void 0:N.filter(W=>P.includes(W.drawPosition)).every(W=>W.participantId));if(f&&Bpe.includes(f)&&!A)return ue({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:f,requiredParticipants:A},result:{error:ww}});let _=((n=Ai({policyTypes:[HU,Rd],tournamentRecord:u,drawDefinition:p,event:g}))==null?void 0:n.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(_,t.policyDefinitions);let k=(T==null?void 0:T.stage)===vt&&T.finishingRound===1,B=k&&h,F=k&&I.winningSide&&!h&&(!t.matchUpStatus||t.matchUpStatus&&GB({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Jr({outcome:t.outcome})),x=B&&h!==I.winningSide&&I.winningSide;if(Object.assign(t,{inContextDrawMatchUps:b,qualifierAdvancing:B,qualifierChanging:x,removingQualifier:F,inContextMatchUp:T,appliedPolicies:_,matchUpTieId:D,matchUpsMap:y,targetData:R,structure:S,matchUp:I}),D){let{matchUp:W}=on({matchUpId:D,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g});if(W){let Y=(r=_a({matchUp:W,drawDefinition:p,structure:S,event:g}))==null?void 0:r.tieFormat,{projectedWinningSide:Z}=cqe({drawDefinition:p,matchUpStatus:f,dualMatchUp:W,matchUpsMap:y,winningSide:h,tieFormat:Y,structure:S,matchUp:I,event:g,score:v}),X=W.winningSide;E=Z!==X,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:Z,matchUpTieId:D,dualMatchUp:W,tieFormat:Y})}}let $=ug(t),j=jP({matchUpStatus:f});if(!D){if($&&!h&&(f&&GB({matchUpStatus:f})||f&&[nr,Ir].includes(f)))return{error:IR,activeDownstream:$,winningSide:h};if(h&&h===I.winningSide&&f&&!j)return{context:"winningSide must include directing matchUpStatus",error:IR,directingMatchUpStatus:j,matchUpStatus:f}}let{schedule:V}=t;if(V){let W=vx({disableNotice:!0,tournamentRecords:l,tournamentRecord:u,drawDefinition:p,matchUpId:m,schedule:V});if(W.error)return W}let H=!U&&!E&&h&&I.winningSide&&I.winningSide!==h;if(o&&H&&I.roundPosition)return Eqe(t);let z=h&&!D||t.projectedWinningSide;Ks({activeDownstream:$,matchUpWinner:z,method:a,winningSide:h});let q=!$&&Pqe(t)||z&&Cqe(t)||j&&Mye(t)||{error:zde};return ue({result:q,stack:a})}function Cqe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Mye(t):ue({stack:"winningSideWithDownstreamDependencies",result:{error:wq},context:{winningSide:i,matchUp:e}})}function Mye(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Jr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Vn||Zn:t.matchUpStatus||Zn,o=t.removeScore||[af,Ni].includes(a)&&![Sc,vs].includes(a),s=cc({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:u,matchUpsMap:c}=t,d=df({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:u,matchUpsMap:c,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function Nye({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:nt};let{matchUp:r}=on({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==Tc?{error:go}:yE({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function Aye({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:nt};if(!i)return{error:va};let{matchUp:n}=on({drawDefinition:t,event:e,matchUpId:i});return n?qa({name:tO,element:n}):{error:Da}}function Rqe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var s,l,u,c,d;let p="substituteParticipant";if(!n)return{error:nt};if(!a)return{error:va};if(!e||!t)return ue({result:{error:wr},stack:p});let{matchUp:f}=on({drawDefinition:n,matchUpId:a,event:o});if(!f)return{error:Da};if(!f.collectionId)return ue({result:{error:go},stack:p});let h=ya({drawDefinition:n}),{matchUps:m}=fr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:h}),g=m==null?void 0:m.find(y=>y.matchUpId===a),v=(l=(s=m==null?void 0:m.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!v||r&&v.sideNumber!==r?{error:Ic}:(d=(c=(u=v.participant)==null?void 0:u.individualParticipants)==null?void 0:c.map(ei).filter(y=>y!==e))!=null&&d.includes(t)?B5({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):ue({result:{error:Ic},stack:p})}function _ye(t){return Rqe(t)}function kye({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:nt};let{matchUp:n}=on({drawDefinition:t,matchUpId:e,event:i});return hi({extension:{name:Cw,value:!0},element:n})}function Oye(t){let e="setMatchUpFormat",i=wi(t,[{tournamentRecord:!0},{[wu]:T=>rs({matchUpFormat:T}),[Pd]:cP,matchUpFormat:!0}]);if(i.error)return ue({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:c,eventId:d,stages:p,drawId:f,event:h,force:m}=t;if(a&&!Array.isArray(a))return ue({result:{error:Se,scheduledDates:a},stack:e});if(u&&!yO([kd,Kl],u))return ue({result:{error:ch},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||f&&[f].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return ue({result:{error:nt},stack:e});if(f&&c&&r){let T=K4({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:c});if(T.error)return T;g+=1}let I=T=>{let w=[];for(let S of T.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let U=((m||a)&&Ci({matchUpFilters:{matchUpStatuses:[Vn]},structure:S}).matchUps)??[],P=(a&&Ci({matchUpFilters:{matchUpStatuses:[Vn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=P?P.map(Ar):U.map(Ar);for(let D of U)E.includes(D.matchUpId)&&(D.matchUpFormat=a!=null&&a.length?s:void 0,di({tournamentId:n==null?void 0:n.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:T,matchUp:D}))}}return!w.length&&T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1),w};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||u&&u!==T.eventType||u===Rr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let w of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(w.drawId))continue;let S=I(w);Qi({structureIds:S,drawDefinition:w})}else T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1);return g?{...ae,modificationsCount:g}:{...ae,info:J0}}function q5({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var a,o;if(!i)return{error:nt};let s=(a=on({drawDefinition:i,matchUpId:n}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:go};let l=(o=on({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:o.matchUp,u=0;return((s==null?void 0:s.sides)||[]).forEach(c=>{c.lineUp&&delete c.lineUp}),((l==null?void 0:l.sides)||[]).forEach(c=>{if(u+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=c.participantId;d&&p&&Db({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}di({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:s})}),{...ae,modificationsCount:u}}function xye(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=dd({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=dd({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=dd({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),u=o===l?s:o;return n&&(o=n===1?l:u,s=n===2?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function bE(t){var e;let i=wi(t,[{[_g]:!0,[Yu]:!0}]);if(i.error)return i;let n=xc(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let b=vo({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:u,matchUpFormat:c,matchUpId:d,schedule:p,event:f,notes:h}=t,{policy:m}=Fg({policyType:Rd,tournamentRecord:o,event:f}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(m==null?void 0:m.allowChangePropagation)!==void 0&&m.allowChangePropagation||void 0,{outcome:v}=t;if(v!=null&&v.winningSide&&![1,2].includes(v.winningSide))return{error:$k};if(c){let y=K4({tournamentRecord:o,drawDefinition:u,matchUpFormat:c,matchUpId:d,event:f});if(y.error)return y}if((e=v==null?void 0:v.score)!=null&&e.sets&&!v.score.scoreStringSide1){let{score:y}=xye(v);v.score=y,v.score.sets=v.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return yE({matchUpStatusCodes:v==null?void 0:v.matchUpStatusCodes,matchUpStatus:v==null?void 0:v.matchUpStatus,winningSide:v==null?void 0:v.winningSide,allowChangePropagation:g,disableScoreValidation:r,score:v==null?void 0:v.score,tournamentRecords:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:u,matchUpFormat:c,matchUpId:d,schedule:p,event:f,notes:h})}function Lye(t){if(!(t!=null&&t.outcomes))return{error:dt};if(!Array.isArray(t.outcomes))return{error:dt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:Oe};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=Mqe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...ae}}function Mqe(t){var e;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=t,o={};r.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=vo({tournamentRecord:n,eventId:s});for(let u of o[s]){let{drawId:c}=u,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===c);if(d&&c){let{matchUpFormat:p,matchUpId:f}=u,h=bE({schedule:u==null?void 0:u.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:f,outcome:u,drawId:c,event:l});if(h.error)return h}}}return{...ae}}function Nqe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:nt};if(!i)return{error:dt,info:"missing outcome"};if(!n&&!e)return{error:No};if(!n){let o=on({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Se}:hi({element:n,extension:{name:tO,value:i}})}function Fye(t){return Nqe(t)}function W5(t){var e,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:o}=t,s=wi(t,[{[Fd]:!0,[_g]:!0}],n);if(s.error)return s;let l=mE(t,[{[vP]:$h}]);if(l[_v])return l;let u=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:c,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(c!=null&&c.tieMatchUps))return ue({result:{error:go},info:"Must be a TEAM matchUp",stack:n});if(!c.tieFormat)return{...ae};let p=(i=_a({structure:d,drawDefinition:r,event:a}))==null?void 0:i.tieFormat;if(!p)return ue({result:{error:Pa},info:"No inherited tieFormat",stack:n});let f=[],h=[],m=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;h.push(b);let I=(c.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,w)=>(T.matchUpStatus===Vn?1:0)-(w.matchUpStatus===Vn?1:0)),m.push(...I.slice(0,y)),f.push(...I.slice(3).map(Ar));else if(m.push(...I),I.length<y){let T=y-I.length,w=tE({collectionDefinition:v,matchUpsLimit:T,matchUp:c,uuids:o});g.push(...w)}}for(let v of(c==null?void 0:c.tieMatchUps)||[])v.collectionId&&!h.includes(v.collectionId)&&f.push(v.matchUpId);return g.length&&(m.push(...g),mh({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:r,tournamentId:u})),f.length&&of({matchUpIds:f,eventId:a==null?void 0:a.eventId,drawDefinition:r,tournamentId:u}),c&&(c.tieMatchUps=m,c.tieFormatId=void 0,c.tieFormat=void 0,di({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:u,matchUp:c})),{...ae,newMatchUps:g,deletedMatchUpIds:f}}function K5(t){var e,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return ue({result:{error:nt},stack:l});if(!o)return ue({result:{error:va},stack:l});if(!mo(o))return ue({result:{error:Se,matchUpId:o},stack:l});let u=ya({drawDefinition:a}),{matchUps:c}=fr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),d=u.drawMatchUps.find(y=>y.matchUpId===o),p=c==null?void 0:c.find(y=>y.matchUpId===o);if(!d||!c)return{error:Da};if(d.matchUpType!==rl)return{error:go};let f=io({inContextDrawMatchUps:c,drawDefinition:a,matchUpId:o}),h=p==null?void 0:p.structureId,{structure:m}=Pt({drawDefinition:a,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:p,matchUpsMap:u,targetData:f,structure:m,matchUp:d}),ug(t))return{error:wq};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let b=yE({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:s});if(b.error)return ue({result:b,stack:l})}let g=(i=Ai({tournamentRecord:r,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=df({event:t.event,removeScore:!0,tournamentRecord:r,appliedPolicies:g,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(v.error)return ue({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(n=_a({drawDefinition:a,structure:m,event:s}))==null?void 0:n.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:w}=Bp({descendant:d.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&w===1){let S=W5({tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s});if(S.error)return S}}}return{...ae}}function Bye(t){let e=wi(t,[{[Yu]:!0,[eS]:!0},{[jU]:{[gP]:!1,roundNumbers:!1},[wpe]:"At least one must be provided",[Vh]:Fo}]);if(e.error)return e;let i=dme(t);if(i.error)return i;let{matchUpIds:n}=i,r=xn(rl)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let c=K5({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error||t.removeAssignments&&q5({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return c}let u=yE({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error)return u;if(t.removeAssignments){let c=$5({...t,matchUpId:l});if(c.error)return c}}return{...ae}}function Aqe({drawDefinition:t,finishingOrder:e}){var i;if(!t)return{error:nt};let n="setOrderOfFinish";if(!Array.isArray(e))return ue({info:Od("finishingOrder"),result:{error:Se},stack:n});let{completedMatchUps:r,matchUpsMap:a}=fS({inContext:!0,drawDefinition:t}),o=(r==null?void 0:r.map(Ar))??[],s=e.map(Ar),{matchUpTypes:l,roundNumbers:u,structureIds:c,matchUpTieIds:d}=(r??[]).filter(({matchUpId:y})=>s.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:T,roundNumber:w,structureId:S}=b;return y.matchUpTypes.includes(T)||y.matchUpTypes.push(T),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||u.length>1||c.length>1)return ue({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Se},stack:n});let p,f,h={},m=[],g=[];if(!e.every(({orderOfFinish:y,matchUpId:b})=>(m.push(b),y&&g.push(y),h[b]=y,p=o.includes(b),f=y===void 0||At(y)&&Math.floor(y)>0,p&&f)))return ue({result:{error:p?Se:ww},info:!p&&"matchUps must be completed"||!f&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let v=r==null?void 0:r.filter(y=>y.structureId===c[0]&&y.roundNumber===u[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:b}=y||{};if(b){if(!At(b))return ue({context:{orderOfFinish:b,matchUp:y},result:{error:Se},stack:n});g.push(b)}}if(tpe(g).length!==g.length||Math.max(...g)>g.length)return ue({info:"Values not unique or greater than expected number of values",result:{error:Se},stack:n});if(c.length){let y=bO({matchUpFilters:{matchUpIds:s},structureId:c[0],drawDefinition:t,matchUpsMap:a});if(y.error)return ue({result:y,stack:n});(i=y.completedMatchUps)==null||i.forEach(b=>b.orderOfFinish=h[b.matchUpId])}return{...ae}}function $ye(t){return Aqe(t)}function Vye({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var a,o,s,l;if(!t)return{error:Oe};if(!e)return{error:Qo};if(typeof i!="string")return{error:go};if(!Array.isArray(n))return{error:Se,lineUps:n};let u="applyLineUps",c=t.participants||[],d=on({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpId:i});if(d.error)return d;if(!d.matchUp)return{error:Da};let{matchUp:p,structure:f}=d,{drawPositions:h,matchUpType:m}=p;if(m!==Xi)return{error:go};if(!(h!=null&&h.length))return{error:lP};let g=(a=_a({matchUp:p,drawDefinition:e,structure:f,event:r}))==null?void 0:a.tieFormat,v={};for(let b of n){if(!Array.isArray(b))return{error:Se,lineUp:b};let I={},T=[];for(let E of b){if(typeof E!="object")return{error:Se,lineUpAssignment:E};let{participantId:D,collectionAssignments:R=[]}=E;if(!Array.isArray(R))return{error:Se,collectionAssignments:R};let N=c.find(A=>A.participantId===D);if(!N)return{error:qn};if(N.participantType!==ti)return{error:Bu};let M=(s=(o=p.sides)==null?void 0:o.find(A=>{var _,k;return(k=(_=A.participant)==null?void 0:_.individualParticipantIds)==null?void 0:k.includes(D)}))==null?void 0:s.sideNumber;M&&T.push(M);for(let A of R){if(typeof A!="object")return{error:Se,collectionAssignment:A};let{collectionId:_,collectionPosition:k}=A,B=(l=g==null?void 0:g.collectionDefinitions)==null?void 0:l.find($=>$.collectionId===_);if(!B)return{error:Se,collectionId:_};let F=`${_}-${k}`;I[F]||(I[F]=[]);let x=I[F].length;if(xn(Pn)(B.matchUpType)&&x||B.matchUpType===Yi&&x>1)return{info:"Excessive collectionPosition assignments",error:Se};I[F].push(D)}}let w=Object.values(I);for(let E of w)if(E.length===2){let{participant:D}=Yl({tournamentParticipants:c,participantIds:E});if(!D){let R=Ec({participant:{participantType:xt,participantRole:Sa,individualParticipantIds:E},pairOverride:!0,tournamentRecord:t});if(R.error)return R}}let S=ts(T),U=(S[1]||0)>(S[2]||0)&&1||(S[2]||0)>(S[1]||0)&&2||void 0,P=Object.keys(v).map(E=>parseInt(E));U&&!P.includes(U)&&(v[U]=b)}if(!Object.keys(v).length)return{error:Mq};if(d=on({drawDefinition:e,matchUpId:i}),d.error)return d;if(!d.matchUp)return{error:Da};let{matchUp:y}=d;y.sides||(y.sides=[]);for(let b of[1,2]){let I=y.sides.find(w=>w.sideNumber===b),T=v[b];if(T)I?I.lineUp=T:y.sides.push({lineUp:T,sideNumber:b});else continue}return di({tournamentId:t==null?void 0:t.tournamentId,context:u,drawDefinition:e,matchUp:y}),{...ae}}var Y5={};Yt(Y5,{anonymizeTournamentRecord:()=>pbe,generate:()=>jye,generateEventWithDraw:()=>Sx,generateOutcome:()=>i6,generateOutcomeFromScoreString:()=>Z5,generateParticipants:()=>TE,generateTournamentRecord:()=>cbe,modifyTournamentRecord:()=>fbe,mutate:()=>dbe});var jye={};Yt(jye,{generateEventWithDraw:()=>Sx,generateOutcome:()=>i6,generateOutcomeFromScoreString:()=>Z5,generateParticipants:()=>TE,generateTournamentRecord:()=>cbe});function Z5(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...EO,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Se,winningSide:n};let a=r&&_N({scoreString:r}),o={},s=dd({sets:a,matchUpFormat:e}),l=dd({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=_N({scoreString:o.scoreStringSide1}),ft({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function X5({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;let a=(((r=e==null?void 0:e[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function jw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;let{individualParticipantIds:l}=pO(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);let u=f=>{t[f]||(t[f]=[]),t[f]=Ht(t[f].concat(...l))},c=f=>{i&&(!e[f]||i>e[f])&&(e[f]=i)},d=((a=n.winnerTo)==null?void 0:a.matchUpId)||n.winnerMatchUpId;d&&(i&&c(d),u(d));let p=((o=n.loserTo)==null?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&c(p),u(p)),(s=n.sidesTo)!=null&&s.length&&n.sidesTo.forEach(({matchUpId:f})=>{f&&(i&&c(f),u(f))})}function IE({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function _qe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function u1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,c;let d=an((u=l==null?void 0:l.schedule)==null?void 0:u.endTime),p=d?Do(d,Tt(o)):Do(s,Tt(n)+Tt(o)),f=i&&(d?Do(an(d),i):Do(s,Tt(n)+Tt(i))),h=((c=a==null?void 0:a[l.matchUpId])==null?void 0:c.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();h.forEach(g=>{IE({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&f||p;m.includes(g)?_qe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),jw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function Gye({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,l,u;let c,d=(o=(a=r.minutesMap)==null?void 0:a[n])==null?void 0:o.recoveryMinutes,p=(((l=(s=r.minutesMap)==null?void 0:s[n])==null?void 0:l.averageMinutes)||0)+(d||0),f=Do(i,p),h=((u=e==null?void 0:e[n])==null?void 0:u.dependentMatchUpIds)||[];if(h.length){let m=h.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||ui(y)<ui(g.scheduleTime)?b:g},{});m.scheduleTime&&ui(f)>ui(m.scheduleTime)&&(c=m)}return{scheduledDependent:c}}function kqe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Yi&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var wE="DO_NOT_SCHEDULE",Oqe={DO_NOT_SCHEDULE:wE};function J5({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=kqe(o).map(({person:f})=>f==null?void 0:f.personId);if(i){let f=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...f)}let l=s.map(f=>{var h;return(h=n[f])==null?void 0:h.map(m=>({...m,personId:f}))}).filter(Boolean).flat().filter(f=>f.requestType===wE&&Cd(a,f.date)),u=[],c=o==null?void 0:o.matchUpId,d=tr(an(r),Bt(a)),p=an(Yq(d,t).toISOString());for(let f of l){let{requestId:h,startTime:m,endTime:g}=f;(r>m&&r<g||p>m&&p<g)&&(u.push({matchUpId:c,request:f,scheduleTime:r}),e[h]?(e[h].scheduleTimes.includes(r)||e[h].scheduleTimes.push(r),e[h].matchUpIds.includes(c)||e[h].matchUpIds.push(c)):e[h]={request:f,scheduleTimes:[r],matchUpIds:[c]})}return{conflicts:u}}function v$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=pO(i),o=(t[i.matchUpId]||[]).filter(s=>!eo(s,a)).flat();[...a,...o].forEach(s=>{if(IE({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Ll]?l[Ll]+=n:n>0&&(l[Ll]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function xqe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:c,matchUps:d}){var p,f;let h=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===Di;return b&&h.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&fE({schedule:y})&&(!u||v.schedule.scheduledDate===u)}),i=r.map(Ar));let m=Array.isArray(l)?l.includes(u):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){v$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let b=(f=c==null?void 0:c[v.matchUpId])==null?void 0:f.recoveryMinutes;u1({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:h,dateScheduledMatchUps:r,clearDate:m}}function Lqe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),u=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),f=[Di,bi,Zn,vs,xa,Ni,nr,Ir].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!f}),{matchUpMap:c}=u.reduce((d,p)=>{let{drawId:f,tournamentId:h}=p;return d.matchUpMap[h]||(d.matchUpMap[h]={}),d.matchUpMap[h][f]?d.matchUpMap[h][f].push(p):d.matchUpMap[h][f]=[p],jw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:u,matchUpMap:c}}function bx({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:Rn};if(!pl(s)&&!Array.isArray(i))return{error:Ld};a=a??px({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:f}=xP({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:f}}})).flat()),u={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return fE({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let c=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==Di);return{bookings:c==null?void 0:c.map(({eventId:d,schedule:p,matchUpFormat:f})=>{let{event:h,scheduleTiming:m}=l[d],g=h==null?void 0:h.eventType,v={...m,defaultTiming:u,matchUpFormat:f},{averageMinutes:y,recoveryMinutes:b}=hO({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,w=an(p.scheduledTime),S=Do(w,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:a,startTime:w,courtId:I,endTime:S,venueId:T}}).filter(Boolean),relevantMatchUps:c,dateScheduledMatchUps:i}}function Fqe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:c,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Rn};s=s??px({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:f,venues:h}=pf({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(f==null?void 0:f.filter(T=>!c||c.includes(T.venueId)))??[];u=u??Vw({courts:m,scheduleDate:l,startTime:!0}),p=p??Vw({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=bx({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:c,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:u,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=O5(y),I=(c==null?void 0:c.length)===1&&c[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(is("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function Bqe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let u of t.filter(Boolean))l||(l=u.hash),(u.hash===l||i)&&(r=r.concat(u.matchUpIds)),u.hash!==l&&!i&&(l=u.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=u.matchUpIds),s=i?e:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function Hye({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:c,useGarman:d,matchUps:p,courts:f,venues:h}){var m;let g={},v=[],y=[],b=[];for(let I of h){let{rounds:T=[],venueId:w}=I,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:P,minutesMap:E}=dE({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:T});b.push(...P??[]);let{groupedRounds:D}=Bqe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),R,N,M=[];d&&({scheduleTimes:M,dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=Fqe({averageMatchUpMinutes:(m=D[0])==null?void 0:m.averageMinutes,scheduleDate:Bt(c),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=xqe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:R,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:c,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:R,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:k}=A;_!=null&&_.length&&y.push(..._);let{matchUpsToSchedule:B,matchUpMap:F}=Lqe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:k,matchUps:p}),x=f.filter($=>$.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:x.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:B,scheduleTimes:M,groupedRounds:D,venueCourts:x,minutesMap:E,matchUpMap:F},s||v.push(...R)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:b}}function $qe(t,e){let i=ui(t.scheduleTime),n=ui(t.timeAfterRecovery),r=ui(e.scheduleTime),a=ui(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,u=n>r&&n<a,c=a>i&&a<n;return ft({hasOverlap:o||s||u||l||c,startAisContained:s,endAisContained:u,startBisContained:l,endBisContained:c},!0)}function Q5({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,l,u,c;let d=(((o=i==null?void 0:i[r.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[r.matchUpId])==null?void 0:l.averageMinutes)||0,f=((c=(u=a==null?void 0:a.minutesMap)==null?void 0:u[r.matchUpId])==null?void 0:c.recoveryMinutes)||0,h=d.every(v=>{var y;IE({individualParticipantProfiles:t,participantId:v});let b=t[v];if(!b.timeAfterRecovery)return!0;let I=an((y=r==null?void 0:r.schedule)==null?void 0:y.endTime),T=I?Do(I,Tt(f)):Do(n,Tt(p)+Tt(f));return![...Object.keys(b.potentialBookings).filter(w=>w!==r.drawId).map(w=>b.potentialBookings[w]).flat(),...b.bookings].find(w=>$qe({scheduleTime:n,timeAfterRecovery:T},w).hasOverlap)}),m=e[r.matchUpId],g=(m?yP(tr(m),tr(n),!1):0)>=0;return{enoughTime:h&&g}}function e6({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=pO(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=Ht(r.concat(...s));return l.forEach(u=>{IE({individualParticipantProfiles:t,participantId:u})}),{participantIdsAtLimit:l.filter(u=>{let c=t[u];if(c)return[o,Ll].find(d=>{var p;let f=((p=c.counters)==null?void 0:p[d])||0,h=i[d]||0;return f&&h&&f>=h})}),relevantParticipantIds:l}}function c1({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:c}){var d,p,f;if(!s)return{error:Oe};if(!l&&(!u||!Array.isArray(u)))return{error:K0};if(!l&&(!c||typeof c!="object"))return{error:Bde};let h,m=[],g=0;if(n&&!r){let b=su({tournamentRecords:o,tournamentRecord:s});r=b.matchUpDependencies,h=b.matchUps}h||(h=((d=Xr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=h.reduce((b,I)=>{let{matchUpId:T,drawId:w,matchUpStatus:S}=I;return(e||S!==Di)&&(t||!kr.includes(S))&&(b[w]?b[w].push(T):b[w]=[T]),b},{}),y=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(v)){let{drawDefinition:I}=qh({tournamentRecord:s,drawId:b});if(!I)continue;let T=v[b].filter(S=>(u==null?void 0:u.includes(S))??(y==null?void 0:y.includes(S))),w=po({inContext:!1,drawDefinition:I}).matchUps;for(let S of T){let U=((p=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:p.schedule)||c,P=vx({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:h,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:w,matchUpId:S});if((f=P==null?void 0:P.warnings)!=null&&f.length&&m.push(...P.warnings),P!=null&&P.success&&(g+=1),P.error)return P}}return m.length?{...ae,scheduled:g,warnings:m}:{...ae,scheduled:g}}function SE(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:c}=t;if(t.matchUpIds&&!a)return c1(t);let d=wi(t,[{[Ea]:!0},{[jU]:{matchUpContextIds:!1,matchUpDetails:!1},[Pd]:Se,[Vh]:Fo}]);if(d.error)return d;if((!u||a)&&!c)return{error:dt,info:"schedule is required"};let p=[],f=0,{matchUpDependencies:h}=su({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:g}=m,v=a==null?void 0:a.filter(b=>b.tournamentId===g).map(Ar),y=u==null?void 0:u.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=c1({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:h,errorOnAnachronism:r,removePriorValues:o,tournamentRecords:s,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:c});if((e=b.warnings)!=null&&e.length&&p.push(...b.warnings),b.scheduled&&(f+=b.scheduled),b.error)return b}}return p.length?{...ae,scheduled:f,warnings:p}:{...ae,scheduled:f}}function zye({autoSchedulingAudit:t,tournamentRecords:e}){var i;oi({topic:_w,payload:t});let n=s=>s?Object.values(s).reduce((l,u)=>l+u.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((u,c)=>u+c.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:r},o={itemType:Xve,itemValue:a};for(let s of Object.values(e))Pb({tournamentRecord:s,timeItem:o})}function Vqe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:c,personRequests:d,periodLength:p,matchUps:f,courts:h,dryRun:m}){var g,v,y,b,I,T,w;let S={},U={},P={},E={},D={},R={},N={},M={},A={},_={};for(let F of r){let x=Bt(F==null?void 0:F.scheduleDate),$=(F==null?void 0:F.venues)||[],j={},V={},H=(J,ee)=>{J.forEach(ne=>{let ie=V[ne].counters;ie[ee]?ie[ee]+=1:ie[ee]=1,ie[Ll]?ie[Ll]+=1:ie[Ll]=1})};P[x]={},E[x]={},S[x]={},U[x]={},N[x]=[],M[x]=[],A[x]=[],_[x]=[];let z={};f.forEach(J=>{var ee;(ee=J.schedule)!=null&&ee.scheduledDate&&Cd(x,Bt(J.schedule.scheduledDate))&&jw({matchUpPotentialParticipantIds:j,matchUpNotBeforeTimes:z,matchUp:J})});let{allDateScheduledByeMatchUpDetails:q,venueScheduledRoundDetails:W,allDateMatchUpIds:Y}=Hye({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:z,matchUpScheduleTimes:R,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:x,matchUps:f,courts:h,venues:$}),Z=10,X=0,Q,ce=10;for(;!Q;){for(let{venueId:J}of $){let ee=0,ne=W[J];for(;ne.courtsCount&&(g=ne.scheduleTimes)!=null&&g.length&&(v=ne.matchUpsToSchedule)!=null&&v.length&&ee<=ne.courtsCount;){let{scheduleTime:ie,attempts:oe=0}=ne.scheduleTimes.shift(),se=ne.matchUpsToSchedule.find(pe=>{var fe,ge;let{matchUpId:me,matchUpType:Ee}=pe,{participantIdsAtLimit:Be,relevantParticipantIds:Pe}=e6({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,matchUpDailyLimits:s,matchUp:pe});if(Be.length)return M[x].includes(me)||M[x].push(me),!1;let{scheduledDependent:et}=Gye({matchUpScheduleTimes:R,matchUpDependencies:o,scheduleTime:ie,matchUpId:me,details:ne});if(et)return!1;let{dependenciesScheduled:Ie,remainingDependencies:Ne}=X5({matchUpScheduleTimes:R,matchUpDependencies:o,allDateMatchUpIds:Y,matchUp:pe});if(!Ie)return E[x][me]||(E[x][me]=[]),E[x][me].push({scheduleTime:ie,remainingDependencies:Ne}),!1;let{enoughTime:be}=Q5({individualParticipantProfiles:V,matchUpNotBeforeTimes:z,matchUpDependencies:o,scheduleTime:ie,details:ne,matchUp:pe});if(!be)return P[x][me]||(P[x][me]=[]),P[x][me].push({scheduleTime:ie}),!1;let Le=ne.greatestAverageMinutes,{conflicts:Me}=J5({potentials:e,averageMatchUpMinutes:Le,requestConflicts:_,personRequests:d,scheduleTime:ie,scheduleDate:x,matchUp:pe});if(Me!=null&&Me.length)return D[x]||(D[x]=[]),D[x].push(...Me),!1;H(Pe,Ee);let Ze=(ge=(fe=ne.minutesMap)==null?void 0:fe[me])==null?void 0:ge.recoveryMinutes;return u1({matchUpPotentialParticipantIds:j,individualParticipantProfiles:V,matchUpNotBeforeTimes:z,averageMatchUpMinutes:Le,matchUpDependencies:o,recoveryMinutes:Ze,scheduleTime:ie,matchUp:pe}),R[me]=ie,!0});ne.matchUpsToSchedule=ne.matchUpsToSchedule.filter(({matchUpId:pe})=>pe!==(se==null?void 0:se.matchUpId)),se?ee+=1:(U[x][J]||(U[x][J]=[]),U[x][J].push({scheduleTime:ie,attempts:oe+1}))}(y=ne.matchUpsToSchedule)!=null&&y.length&&(U[x][J]=(b=U[x][J])==null?void 0:b.filter(ie=>{let oe=ie.attempts<Z;return oe&&ne.scheduleTimes.push(ie),!oe})),(!((I=ne.scheduleTimes)!=null&&I.length)||!((T=ne.matchUpsToSchedule)!=null&&T.length))&&(ne.complete=!0)}X+=1,Q=$.every(({venueId:J})=>W[J].complete)||X===ce}for(let{venueId:J}of $){let ee=W[J].matchUpMap;Object.keys(ee).forEach(ne=>{let ie=u[ne];ie&&Object.keys(ee[ne]).forEach(oe=>{let{drawDefinition:se}=qh({tournamentRecord:ie,drawId:oe});se&&ee[ne][oe].forEach(({matchUpId:pe})=>{let fe=R[pe];if(fe){let ge=fe.split(":").map(Bs).join(":"),me=`${Bt(x)}T${ge}`;m?N[x].push(pe):(Wh({drawDefinition:se,scheduledTime:me,matchUpId:pe}).success&&N[x].push(pe),J&&US({tournamentRecord:ie,drawDefinition:se,matchUpId:pe,venueId:J}))}})})}),A[x]=W[J].matchUpsToSchedule.map(Ar),S[x][J]=W[J].scheduleTimes.sort((ne,ie)=>ui(ne.scheduleTime)-ui(ie.scheduleTime))}!m&&q!=null&&q.length&&SE({matchUpDetails:q,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of F.venues)for(let ee of J.rounds){let ne=(((w=ee.matchUps)==null?void 0:w.map(({matchUpId:oe})=>oe))||[]).filter(oe=>N[x].includes(oe));ee.canScheduledMatchUpIds=ne;let ie=Math.round(ne.length/ee.matchUpsCount*1e4)/100;(ie===1/0||isNaN(ie))&&(ie=0),ee.possibleToSchedulePct=ie,ee.matchUpsCount===ne.length&&(ee.possibleToSchedule=!0)}}let k=r.map(({scheduleDate:F})=>F),B={timeStamp:Date.now(),overLimitMatchUpIds:M,scheduledMatchUpIds:N,schedulingProfile:c,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:k};return zye({tournamentRecords:u,autoSchedulingAudit:B}),{...ae,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:S,dateSchedulingProfiles:r,skippedScheduleTimes:U,recoveryTimeDeferredMatchUpIds:P,dependencyDeferredMatchUpIds:E,matchUpScheduleTimes:R,overLimitMatchUpIds:M,scheduledMatchUpIds:N,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:k}}function nY({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:dt,stack:"getEarliestCourtTime"};let a=Vw({scheduleDate:r,courts:[n],startTime:!0}),o=Vw({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=vE({court:n,date:r}),{timeSlots:l}=SS({courtDate:s}),u=tr(e),c=tr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let f=tr(p.startTime),h=tr(p.endTime);if(f>c||h<u)return d;let m=u>f?u:f;if(yP(m,h)>=t){let g=an(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function jqe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:c=30,schedulingProfile:d,personRequests:p,matchUps:f=[],courts:h,dryRun:m}){var g,v;let y={},b={},I={},T={},w={},S={},U={},P={},E={};for(let N of r??[]){let M=Bt(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},k={},B=(J,ee)=>{J.forEach(ne=>{let ie=k[ne].counters;ie[ee]?ie[ee]+=1:ie[ee]=1,ie[Ll]?ie[Ll]+=1:ie[Ll]=1})};y[M]={},b[M]={},S[M]=[],U[M]=[],P[M]=[],E[M]=[];let F={};f==null||f.forEach(J=>{var ee;(ee=J.schedule)!=null&&ee.scheduledDate&&Cd(M,Bt(J.schedule.scheduledDate))&&jw({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:F,matchUp:J})});let{allDateScheduledByeMatchUpDetails:x,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:j,allDateMatchUpIds:V}=Hye({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:F,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:c,scheduleDate:M,matchUps:f,courts:h,venues:A}),H=f==null?void 0:f.filter(({matchUpId:J})=>$.includes(J)),{bookings:z}=bx({dateScheduledMatchUps:H,tournamentRecords:u,scheduleDate:M,periodLength:c}),{virtualCourts:q}=dx({scheduleDate:M,periodLength:c,bookings:z,courts:h}),W=q==null?void 0:q.reduce((J,ee)=>{let{earliestCourtTime:ne,courtEndTime:ie}=nY({date:M,averageMinutes:0,court:ee});return(!J.startTime||tr(ne)<tr(J.startTime))&&(J.startTime=ne),(!J.endTime||tr(ie)>tr(J.endTime))&&(J.endTime=ie),J},{}),Y=W.startTime,Z=({courtId:J,booking:ee})=>{var ne;return(ne=q==null?void 0:q.find(ie=>ie.courtId===J))==null?void 0:ne.dateAvailability[0].bookings.push(ee)},X=10,Q=0,ce;for(;!ce;){for(let{venueId:J}of A){let ee=j[J],ne=ee.matchUpsToSchedule.length,ie=[],oe=[],se,pe=0;for(;!se;){for(let fe of ee.matchUpsToSchedule){if(oe.length===ee.courtsCount||ie.length===ee.courtsCount){se=!0;break}let{matchUpId:ge,matchUpType:me}=fe,{participantIdsAtLimit:Ee,relevantParticipantIds:Be}=e6({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpDailyLimits:s,matchUp:fe});if(Ee.length){U[M].includes(ge)||U[M].push(ge);continue}let{dependenciesScheduled:Pe,remainingDependencies:et}=X5({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:V,matchUp:fe});if(!Pe){b[M][ge]||(b[M][ge]=[]),b[M][ge].push({remainingDependencies:et});continue}let Ie=[],Ne=q==null?void 0:q.reduce((be,Le)=>{var Me,Ze,qe,ye;if(oe.includes(Le.courtId))return be;let{earliestCourtTime:_e}=nY({averageMinutes:ee.greatestAverageMinutes,startTime:Y,date:M,court:Le});if(be.scheduleTime&&ui(_e)>=ui(be.scheduleTime))return be;let{scheduledDependent:Ae}=Gye({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:_e,matchUpId:ge,details:ee});if(Ae)return be;let{enoughTime:Ve}=Q5({individualParticipantProfiles:k,matchUpNotBeforeTimes:F,matchUpDependencies:o,scheduleTime:_e,details:ee,matchUp:fe});if(!Ve)return y[M][ge]||(y[M][ge]=[]),y[M][ge].includes(_e)||y[M][ge].push(_e),be;let Ke=((Ze=(Me=ee.minutesMap)==null?void 0:Me[ge])==null?void 0:Ze.averageMinutes)||ee.greatestAverageMinutes,{conflicts:he}=J5({potentials:e,averageMatchUpMinutes:Ke,requestConflicts:E,personRequests:p,scheduleTime:_e,scheduleDate:M,matchUp:fe});if(he!=null&&he.length)return Ie.push(...he),!1;B(Be,me);let ve=(ye=(qe=ee.minutesMap)==null?void 0:qe[ge])==null?void 0:ye.recoveryMinutes;return u1({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpNotBeforeTimes:F,averageMatchUpMinutes:Ke,matchUpDependencies:o,recoveryMinutes:ve,scheduleTime:_e,matchUp:fe}),(!be.scheduleTime||ui(_e)<ui(be.scheduleTime))&&(be.averageMatchUpMinutes=Ke,be.recoveryMinutes=ve,be.scheduleTime=_e,be.courtName=Le.courtName,be.courtId=Le.courtId),be},{});if(Ne.scheduleTime){let{averageMatchUpMinutes:be,recoveryMinutes:Le,scheduleTime:Me,courtId:Ze}=Ne;w[ge]=Me,T[ge]=Ze,ie.push(ge),oe.push(Ze);let qe=Me,ye=Do(qe,be);Z({courtId:Ze,booking:{averageMatchUpMinutes:be,recoveryMinutes:Le,periodLength:c,matchUpId:ge,startTime:qe,courtId:Ze,endTime:ye,venueId:J}}),ee.matchUpsToSchedule=ee.matchUpsToSchedule.filter(_e=>_e.matchUpId!==ge)}else Ie!=null&&Ie.length&&(I[M]||(I[M]=[]),I[M].push(...Ie))}(oe.length===ee.courtsCount||ie.length===ee.courtsCount||!ee.matchUpsToSchedule.length)&&(se=!0),ee.matchUpsToSchedule.length&&ie<ee.courtsCount&&(tr(Y)<tr(W.endTime)?Y=Do(Y,c):(se=!0,ee.complete=!0)),pe+=1,!se&&pe>=ne&&(se=!0)}(g=ee.matchUpsToSchedule)!=null&&g.length||(ee.complete=!0)}Q+=1,ce=A.every(({venueId:J})=>j[J].complete)||Q===X}for(let{venueId:J}of A){let ee=j[J].matchUpMap;Object.keys(ee).forEach(ne=>{let ie=u[ne];ie&&Object.keys(ee[ne]).forEach(oe=>{let{drawDefinition:se}=qh({tournamentRecord:ie,drawId:oe});se&&ee[ne][oe].forEach(({matchUpId:pe})=>{let fe=w[pe],ge=T[pe];if(fe){let me=fe.split(":").map(Bs).join(":"),Ee=`${Bt(M)}T${me}`;m||(Wh({drawDefinition:se,scheduledTime:Ee,matchUpId:pe}),Nb({courtDayDate:M,tournamentRecords:u,tournamentRecord:ie,drawDefinition:se,matchUpId:pe,courtId:ge})),S[M].push(pe)}})})}),P[M]=j[J].matchUpsToSchedule.map(Ar)}!m&&x!=null&&x.length&&SE({matchUpDetails:x,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let ee of J.rounds){let ne=(v=(ee.matchUps??[]).map(({matchUpId:oe})=>oe))==null?void 0:v.filter(oe=>S[M].includes(oe));ee.canScheduledMatchUpIds=ne;let ie=Math.round(((ne==null?void 0:ne.length)||0)/ee.matchUpsCount*1e4)/100;(ie===1/0||isNaN(ie))&&(ie=void 0),ee.possibleToSchedulePct=ie,ee.matchUpsCount===(ne==null?void 0:ne.length)&&(ee.possibleToSchedule=!0)}}let D=(r??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:P,requestConflicts:E,scheduledDates:D};return zye({tournamentRecords:u,autoSchedulingAudit:R}),{...ae,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:w,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:P,requestConflicts:E,scheduledDates:D}}function Ix(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=kr,scheduledDates:n,venueIds:r}=t,a=xc(t),o=ln(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Rn};let s=0;for(let l of o){let u=a[l],c=Gqe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:u,scheduledDates:n,venueIds:r});if(c.error)return c;s+=c.clearedScheduleCount??0}return{...ae,clearedScheduleCount:s}}function Gqe({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=kr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:Oe};if(!Array.isArray(e)||!Array.isArray(r))return{error:Se};r.length&&t.push("venueId");let a=Xr({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:u,schedule:c,drawId:d,matchUpId:p})=>{(!u||!e.includes(u))&&fE({schedule:c,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(c.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let u in o){let{event:c,drawDefinition:d}=vo({tournamentRecord:i,drawId:u}),p=po({drawDefinition:d,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let f of p){let h=!1;f.timeItems=(f.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Lp,rg,uS,cS,dS].includes(m==null?void 0:m.itemType);return g||(h=!0),g}),h&&(di({context:"clear schedules",eventId:c==null?void 0:c.eventId,drawDefinition:d,tournamentId:s,matchUp:f}),l+=1)}}return{...ae,clearedScheduleCount:l}}function wx(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=t,c=wi(t,[{[Ea]:!0},{[wu]:P=>!P||Array.isArray(P)&&P.every(hs),[mpe]:!1,[Vh]:Fo}]);if(c.error)return c;let d=ff({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...ae};let{modifications:p,issues:f=[],schedulingProfile:h=[]}=d,m=Object.assign({},...Object.values(a).map(P=>lS({tournamentRecord:P}).containedStructures)),g=r.map(P=>{if(hs(P))return Bt(P)}).filter(Boolean),v=h.map(P=>P.scheduleDate).map(P=>hs(P)&&Bt(P)).filter(P=>P&&(!r.length||g.includes(P)));if(!v.length)return{error:mde};if(n&&!l){let P=Array.isArray(n)?n:[];Ix({tournamentRecords:a,scheduledDates:P})}let y=pf({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:b}=Vu({matchUpFilters:{matchUpTypes:[Pn,Yi]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:I}=su({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:b}),{matchUpDailyLimits:T}=rx({tournamentRecords:a}),{personRequests:w}=qg({requestType:wE,tournamentRecords:a}),S=h.filter(P=>{let E=Bt(P==null?void 0:P.scheduleDate);return v.includes(E)}).sort((P,E)=>new Date(P.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:f,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:b,dryRun:l,courts:y};return u?jqe(U):Vqe(U)}function qye(t){let e=t||{};return e.tournamentId||(e.tournamentId=Li()),e.startDate&&!Qm(e.startDate)&&!lN.test(e.startDate)?{error:Qa}:e.endDate&&!Qm(e.endDate)&&!lN.test(e.endDate)?{error:Qa}:(e.extensions&&(e.extensions=e.extensions.filter(wc)),{...e})}function t6({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var s,l;if(!i)return{error:Oe};let u={},c=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===ti&&v===Sa),d=0;for(let g of c){let v=a&&((s=Ov({element:g,accessor:a}))==null?void 0:s.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(u).includes(v)){u[v]={participantName:(r==null?void 0:r[d])??v,participantId:(o==null?void 0:o.pop())??Li(),individualParticipantIds:[],participantRole:Sa,participantType:qi};let y={value:n??e,name:_B};hi({element:u[v],extension:y}),d+=1}u[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(u),f=(i.participants??[]).map(g=>{if(g.participantType!==qi||g.participantRole!==Sa)return;let{extension:v}=qt({name:_B,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),h=0,m=[];return Object.keys(u).forEach(g=>{let v=u[g],{participantId:y}=v;f.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),h++)}),t&&h?(oi({payload:{tournamentId:i.tournamentId,participants:m},topic:hh}),{...ae,participantsAdded:h}):m.length?{...ae,newParticipants:m}:{error:K2e}}var Hqe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],zqe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Wye({count:t=1,participantsCount:e=32}={}){let i=Va(zqe),n=i.slice(0,t);return{cities:Je(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Rl(n))}}function Kye({count:t=1,participantsCount:e=32}={}){let i=Va(Hqe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Je(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Rl(n))}}function Yye({count:t=1,participantsCount:e=32}={}){let i=Je(0,t).map(()=>Je(0,5).map(()=>As(0,9)).join(""));return{postalCodes:Je(0,e).map(n=>n<t?i[n]:Rl(i))}}function Zye(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var qqe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function uF(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Ki,vn].includes(i))return{personData:[],error:Se};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=qqe,s=Wf.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),c=Math.ceil(n/o.length),d=Je(0,l).flatMap(()=>{let m=ut(r,!1,!0);return Je(0,r.length).map(()=>jo(m))}),p=Je(0,u).flatMap(()=>{let m=ut(a,!1,!0);return Je(0,a.length).map(()=>jo(m))}),f=Je(0,c).flatMap(()=>{let m=ut(o,!1,!0);return Je(0,o.length).map(()=>jo(m))}),h={};for(let m=0;m<n;m++){let g=d.pop(),v=i||Rl([Ki,vn]),y=v===Ki?f.pop():p.pop(),b=Rl(s);h[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function Xye(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:Se};let u=(a==null?void 0:a[Ki])||l===Ki&&e||0,c=(a==null?void 0:a[vn])||l===vn&&e||0;e=Math.max(e,u+c);let d=e-(u+c),p=u&&uF({count:u,sex:Ki}).personData||[],f=c&&uF({count:c,sex:vn}).personData||[],h=[...p,...f,...d&&uF({count:d}).personData||[]],m=h.filter(U=>!l||u&&c||U.sex===l),g=[];if(Array.isArray(o)){let U=o.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![Ki,vn].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!Wf.find(({iso:E,ioc:D})=>[E,D].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(U.length)m=U;else return{error:Se}}let v=o?m:Va(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:P,femaleFirstNames:E,femaleLastNames:D,nationalityCodes:R}=h.reduce((N,M)=>{let{firstName:A,lastName:_,nationalityCode:k}=M;return M.sex===Ki?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(k)||N.nationalityCodes.push(k),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Je(0,e-v.length).forEach(()=>{let N=l||Rl([Ki,vn]),M=Rl(R),A=Rl(N===Ki?U:E),_=Rl(N===Ki?P:D),k={firstName:A,lastName:_,sex:N,nationalityCode:M};v.push(k)})}let{ageMinDate:y,ageMaxDate:b}=nE({consideredDate:n,category:s}),I=Tt((y==null?void 0:y.slice(0,4))||0)||Tt((b==null?void 0:b.slice(0,4))||0)-3,T=Tt((b==null?void 0:b.slice(0,4))||0)||Tt((y==null?void 0:y.slice(0,4))||0)+3,w=(y||b)&&[I,T],S=v.slice(0,e).map((U,P)=>{let[E,D]=w||[],R=w&&jo(Je(E,D)),N=jo(Je(0,365)),M=R&&l$e(R,N);return Object.assign(ft({extensions:i||[{name:"regionCode",value:P+1}],birthDate:M,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var Wqe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function y$({nameRoot:t="TEAM",count:e=1}={}){let i=Va(Wqe).slice(0,e);return i.length<e&&Je(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function b$({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===ti?"I":"P"}-${i}`:(n==null?void 0:n.pop())||Li()}function TE(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:n=ds,valuesInstanceLimit:r,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:u,participantsCount:c=32,participantType:d,personIds:p,idPrefix:f,uuids:h,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:b,sex:I,inContext:T,withISO2:w,withIOC:S,scaleAllParticipants:U}=t,P=d===xt||y===ig,E=d===qi||y===qi;e&&(!Array.isArray(e)||!e.every(pe=>Mn(pe))||e.length!==2)&&(e=void 0),i=U?c:i;let D=1e3,R=i&&i>D?i:D;e=e||[1,R],e[1]+=1;let N=c*(P?2:E?8:1),M=Xye({count:N,personExtensions:m,consideredDate:a,gendersCount:v,personData:b,category:o,sex:I});if(M.error)return M;let{nationalityCodes:A,persons:_}=M,k=[],B=[],F=[],x=[];if(typeof o=="object"){let{categoryName:pe,ageCategoryCode:fe,ratingType:ge}=o;if((pe||fe)&&!ge){let[me,Ee]=e||[];if(B=Va(Je(me,Ee)).slice(0,i||As(20,30)),[xt,qi].includes(d)){let[Be,Pe]=e||[];k=Va(Je(Be,Pe)).slice(0,i||As(20,30))}}if(ge&&n[ge]){let{ratingMax:me,ratingMin:Ee,ratingAttributes:Be}=o,Pe={...n[ge],...Be||{}},{attributes:et={},decimalsCount:Ie,accessors:Ne,range:be,step:Le}=Pe,Me=Ae=>{let Ve={},Ke=Object.keys(Ae||{});for(let he of Ke){let ve=Ae[he];if(typeof ve=="object"&&ve.generator){let{range:Ce}=ve,[De,Ue]=Ce.slice().sort();Ve[he]=As(De,Ue)}else Ve[he]=ve}return Ve},Ze=be[0]>be[1]?2:.5,[qe,ye]=be.slice().sort(),_e=()=>Je(0,2e3).map(()=>Qde(qe,ye,Ze,Le,Ie)).filter(Ae=>(!me||Ae<=me)&&(!Ee||Ae>=Ee)).slice(0,i||As(20,30)).map(Ae=>Ne?Object.assign({},...Ne.map(Ve=>({[Ve]:Ae})),Me(et)):Ae);F=_e(),[xt,qi].includes(d)&&(x=_e())}}let $=Wf.filter(pe=>l==="IOC"&&pe.ioc||pe.iso);function j(pe){let fe=Math.ceil(N/pe);return r&&fe>r?Math.ceil(N/r):pe}let{postalCodesProfile:V,postalCodesCount:H,statesProfile:z,citiesProfile:q,citiesCount:W,statesCount:Y}=g||{},Z=pe=>Object.keys(pe).map(fe=>Je(0,z[fe]).map(()=>fe)).flat(),X=q&&Z(q)||(g==null?void 0:g.cities)||Wye({count:W||N,participantsCount:N}).cities,Q=z&&Z(z)||(g==null?void 0:g.states)||Kye({count:Y||N,participantsCount:N}).states,ce=V&&Z(V)||(g==null?void 0:g.postalCodes)||Yye({count:H||N,participantsCount:N}).postalCodes,J={cities:X,states:Q,postalCodes:ce},ee=j(s),ne=ee?Va($).slice(0,s):u?$.filter(pe=>u.includes(pe.iso)):$,ie=Va(Je(0,Math.ceil(N/(ee||1))).map(()=>ne).flat(1/0)),oe=y$({count:c}).names;return{participants:Je(0,c).map(pe=>{let fe=P?2:E?8:1,ge=Je(0,fe).map(et=>{let Ie=pe*fe+et;return se(Ie)}),me=ge.map(et=>et.participantId),Ee=ge.map(et=>et.person.standardFamilyName).join("/"),Be=P?xt:qi,Pe={participantId:b$({participantType:Be,idPrefix:f,index:pe,uuids:h}),participantRole:Sa,participantName:P?Ee:oe[pe],individualParticipantIds:me,participantType:Be};return T&&(Pe.individualParticipants=ge),P||E?[Pe,...ge]:ge}).flat(),...ae};function se(pe){let fe=_[pe],{nationalityCode:ge,participantExtensions:me,participantTimeItems:Ee,extensions:Be,firstName:Pe,birthDate:et,lastName:Ie,personId:Ne,sex:be}=fe||{},Le=Pe||"GivenName",Me=Ie||"FamilyName",Ze=`${Le} ${Me}`,qe=ie[pe],ye=(A==null?void 0:A.length)&&ge||qe&&(l==="IOC"?qe.ioc||qe.iso:qe.iso||qe.ioc)||ge;ie!=null&&ie.length&&!ye&&!ge&&console.log("%c Invalid Nationality Code",{participantIndex:pe,country:qe});let _e=Zye({...J,participantIndex:pe,nationalityCode:ye}),Ae=ft({participantId:b$({participantType:ti,index:pe,idPrefix:f,uuids:h}),extensions:me,timeItems:Ee,participantRole:Sa,participantType:ti,participantName:Ze,person:{addresses:[_e],personId:Ne||(p==null?void 0:p.length)&&p[pe]||Li(),standardFamilyName:Me,standardGivenName:Le,nationalityCode:ye,extensions:Be,birthDate:hs(et)?et:void 0,sex:be}});if(S&&ye){let Ve=Wf.find(({iso:Ke})=>Ke===ye);Ve!=null&&Ve.ioc&&(Ae.person.iocNationalityCode=Ve.ioc),Ve!=null&&Ve.label&&(Ae.person.countryName=Ve.label)}if(w&&ye){let Ve=Wf.find(({iso:Ke})=>Ke===ye);Ve!=null&&Ve.iso2&&(Ae.person.iso2NationalityCode=Ve.iso2),Ve!=null&&Ve.label&&(Ae.person.countryName=Ve.label)}if(o){let Ve=B[pe],Ke=k[pe];mC({scaleValue:Ve,eventType:my,scaleType:dh,participant:Ae,category:o}),mC({scaleValue:Ke,eventType:vh,scaleType:dh,participant:Ae,category:o});let he=F[pe],ve=x[pe];mC({scaleValue:he,eventType:my,scaleType:Am,participant:Ae,category:o}),mC({scaleValue:ve,eventType:vh,scaleType:Am,participant:Ae,category:o})}return Ae}}function mC({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[uy,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function Jye({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var r;let a=0,o=0,s=0,l=0,u={},c={[Ki]:0,[vn]:0,[Ho]:0,[mv]:0,[Uc]:0};i=typeof i=="object"?i:Iy({namedFormat:e}),(r=i==null?void 0:i.collectionDefinitions)==null||r.filter(Boolean).forEach(h=>{let{category:m,collectionId:g,matchUpType:v,matchUpCount:y,gender:b}=h;if([Ki,vn].includes(b)){let I=y*(v===Yi?2:1);c[b]<I&&(c[b]=I)}else b===Ho&&(c[Ki]<y&&(c[Ki]=y),c[vn]<y&&(c[vn]=y));if(m){let I=JSON.stringify(m);u[I]=m}if(g||(h.collectionId=Li()),xn(Yi)(v)){let I=y;l+=y,a=Math.max(a,I)}if(xn(Pn)(v)){let I=y;s+=y,o=Math.max(o,I)}});let d=Object.keys(u).length?Math.max(s,l*2):Math.max(o,a*2),p=a*(n+t),f=o*(n+t);return{maxDoublesDraw:p,maxSinglesDraw:f,teamSize:d,genders:c}}function Kqe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=ti}=t||{},a=n||0,o={[vn]:0,[Ho]:0,[mv]:0,[Ki]:0,[Uc]:0},s=0,l=0,u=0,c=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:w})=>{let S=y===Kl,U=y===Rr,P=!!(m||w===vt||I||T);if(U){c=Math.max(c,v+h),b=typeof b=="object"?b:Iy({namedFormat:g});let{teamSize:E,maxDoublesDraw:D,maxSinglesDraw:R,genders:N}=Jye({alternatesCount:h,tieFormatName:g,tieFormat:b,drawSize:v});u=Math.max(u,E),l=Math.max(l,R),P||(s=Math.max(s,D)),Object.keys(N).forEach(M=>o[M]+=N[M])}else if(S)if(P){let E=(v+h)*2;d+=E,T&&(o[T]+=E)}else v+h&&v+h>s&&(s=v+h);else if(P){let E=v+h;T&&(o[T]+=E),d+=E}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=h;if(v)for(let T of v){let{tieFormatName:w,tieFormat:S}=T;p({...T,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let h of i)p(h);let f=Math.max(c*u,s*2,l);return s&&(r=xt),(n||a)<f&&(n=f),n&&s&&[xt,Rr].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:c,largestTeamSize:u,participantType:r,gendersCount:o}}function Qye({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:c}=Kqe({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=TE({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s,gendersCount:c}).participants,f=0,h=ju({tournamentRecord:e,participants:p});if(h.error)return h;if(f+=h.addedCount,d){let y=t6({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===ti).map(ei),g=t!=null&&t.idPrefix?`${qi}-${t.idPrefix}`:void 0,v=Je(0,l).map(y=>{let b=m.slice(y*u,(y+1)*u),I=b$({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:Sa,individualParticipantIds:b,participantType:qi,participantId:I}});return h=ju({participants:v,tournamentRecord:e}),h.error?h:(f+=h.addedCount,{addedCount:f,...ae})}function ebe({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:u=0,uniqueParticipants:c,stage:d=at,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let f=(u||p)-l;return c||i||e||d===vt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=f):o[d]=Math.max(o[d],f),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function tbe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[at]||0,a=e[vt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var Yqe={[Ni]:2,[nr]:1,[Ir]:1,[xa]:1,[bi]:4};function i6(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=Yqe,matchUpFormat:r=Vs,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!rs({matchUpFormat:r}))return{error:hq};if(typeof n!="object")return{error:Se};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:Se};let s=Object.keys(n).filter(U=>Object.keys(Hpe).includes(U)&&U!==Zn);if(Object.keys(s).reduce((U,P)=>U+n[P],0)>100)return{error:Se,matchUpStatusProfile:n};let l=s.reduce((U,P)=>(U.pointer=U.pointer+n[P],U.valueMap.push([U.pointer,P]),U),{pointer:0,valueMap:[]}),u=As(1,100),c=(l.valueMap.find(U=>u<=U[0])??[100,Zn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ni,bi].includes(c)){i=i||As(1,2);let U={score:d,winningSide:i,matchUpStatus:c};if(!(c===bi&&As(1,100)>100-e))return{outcome:U}}else if([nr,Ir].includes(c))return{outcome:{score:d,matchUpStatus:c}};let p=bo(r),{bestOf:f,setFormat:h,finalSetFormat:m}=p??{},g=[],v=As(0,1),y=i?[i-1]:[...Je(0,o).map(()=>v),1-v],b=[xa,bi,Sc,Hh].includes(c)&&(jo(Je(1,f))||1),I;for(let U of Je(1,(f??0)+1)){let P=U===f,{set:E,incomplete:D,winningSideNumber:R}=Zqe({incomplete:b===U,matchUpStatus:c,pointsPerMinute:a,setFormat:P&&m||h,setNumber:U,weightedRange:y});if(g.push(E),D){I=R;break}if(l1({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let T=l1({matchUp:{score:{sets:g},matchUpFormat:r}}),w=I?i||I:T.calculatedWinningSide,{score:S}=xye({score:{sets:g},winningSide:w,matchUpStatus:c});return{outcome:{score:S,winningSide:w,matchUpStatus:c}}}function Zqe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:u,tiebreakSet:c,timed:d,minutes:p}=r,f=As(0,t.length-1),h=t[f],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+jo([1,-1])*v,b=bBe(y,2),I=[b,y-b];h&&I.reverse(),m=t[f]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,P]=I;return Object.assign(o,{side1Score:U,side2Score:P}),kr.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}T||(I[As(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[w,S]=I;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=As(0,u),o.side2Score=As(0,u),kr.includes(i)&&(m=t[f]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Je(1,s+1).map(S=>Je(0,s+2-S).map(()=>S)).flat(),v=g[As(0,g.length-1)],y=s&&z4({isSide1:!0,tiebreakAt:u,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[f]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():h&&y.reverse();let[S,U]=y;Object.assign(o,{side1Score:S,side2Score:U})}let T=o1({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(T.hasTiebreakCondition||b){let{NoAD:S,tiebreakTo:U}=l||c||{},P=Je(1,U+1).map(R=>Je(0,U+2-R).map(()=>R)).flat(),E=P[As(0,P.length-1)],D=zO({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(D)if(b){let R=D[0]>D[1]?1:2;I?R!==I&&D.reverse():h&&D.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=D,w=D[0]>D[1]&&1||D[1]>D[0]&&2||void 0}else T.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=D:[o.side2TiebreakScore,o.side1TiebreakScore]=D}o.winningSide=T.winningSide||T.leadingSide||I||w}}return{set:o}}function LN(t){var e,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:c}=t;if(!u)return{error:nt};let d=t.matchUpFormat||u.matchUpFormat||(c==null?void 0:c.matchUpFormat),p=u.structures.slice().sort(gb),f=0,{matchUps:h,matchUpsMap:m}=fr({contextFilters:{stages:[at,vt]},matchUpFilters:{matchUpTypes:[Xi],roundNumbers:[1]},inContext:!0,drawDefinition:u});if(h!=null&&h.length){let y=((e=c==null?void 0:c.category)==null?void 0:e.ageCategoryCode)||((i=c==null?void 0:c.category)==null?void 0:i.categoryName);if(y){let b=fye({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:y,sortOrder:pye,scaleType:dh},event:c});if(b.error)return b;let{lineUps:I,participantsToAdd:T}=b;ju({tournamentRecord:s,participants:T}),hi({element:u,extension:{name:Np,value:I}})}else{let b=(n=h[0])==null?void 0:n.structureId,{positionAssignments:I}=Hi({drawDefinition:u,structureId:b});if(I!=null&&I.length){let{participants:T}=jn({participantFilters:{participantTypes:[Xi]},tournamentRecord:s}),w=S=>{let U=S.tieMatchUps.filter(xn(Pn)),P=S.tieMatchUps.filter(xn(Yi));U.forEach((E,D)=>{let R=E.matchUpId;E.sides.forEach(N=>{var M;let{drawPosition:A}=N,_=T==null?void 0:T.find(k=>{var B;let{participantId:F}=k;return((B=I.find(x=>x.participantId===F))==null?void 0:B.drawPosition)===A});if(_){let k=(M=_.individualParticipantIds)==null?void 0:M[D];k&&xN({teamParticipantId:_.participantId,participantId:k,tournamentRecord:s,drawDefinition:u,tieMatchUpId:R,event:c})}})}),P.forEach((E,D)=>{let R=E.matchUpId;E.sides.forEach(N=>{var M,A;let{drawPosition:_}=N,k=T==null?void 0:T.find(B=>{var F;let{participantId:x}=B;return((F=I.find($=>$.participantId===x))==null?void 0:F.drawPosition)===_});k&&((A=(M=k.individualParticipantIds)==null?void 0:M.slice(D*2,D*2+2))==null||A.forEach(B=>{xN({teamParticipantId:k.participantId,participantId:B,tournamentRecord:s,drawDefinition:u,tieMatchUpId:R,event:c})}))})})};h.forEach(w)}}}let g=typeof a=="string"&&a,v=g&&Zn;for(let y of p){if(f>=l)break;let{matchUps:b}=Ci({matchUpFilters:{matchUpTypes:[Yi,Pn]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:m,structure:y,event:c}),I=b.filter(({winningSide:T})=>!T).sort(wb).map(Ar);for(let T of I){if(!isNaN(l)&&f>=l)break;let{matchUps:w}=Ci({matchUpFilters:{matchUpTypes:[Yi,Pn]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:m,structure:y,event:c}),S=w.find(P=>P.matchUpId===T),U=[nr,Ir].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!U){let P=Xqe({winningSide:!o&&1,matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:u,targetMatchUp:S,matchUpFormat:d,matchUpStatus:v,scoreString:g,event:c});if(P!=null&&P.error)return P;f+=1}}}return{...ae,completedCount:f}}function ibe(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:c}=t;if(!a||a.matchUpStatus===Di)return;let{matchUpId:d}=a||{},{outcome:p}=Z5({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return e&&(p.matchUpStatusCodes=e),bE({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:c})}function Xqe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:c}=t;if(l||a)return ibe(t);let{matchUpId:d}=s||{},{outcome:p}=i6({matchUpStatusProfile:e,matchUpFormat:o,winningSide:u});return bE({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:c})}function nbe({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var o,s,l,u;let c=Hn({event:a}).flightProfile,{eventName:d,eventType:p,category:f}=a,{startDate:h}=n,m=[],g=(f==null?void 0:f.categoryName)||(f==null?void 0:f.ageCategoryCode)||(f==null?void 0:f.ratingType),v=(o=a.drawDefinitions)==null?void 0:o.map(({drawId:y})=>y);if(Array.isArray(c==null?void 0:c.flights))for(let[y,b]of c.flights.entries()){let{drawId:I,stage:T,drawName:w,drawEntries:S}=b;m.push(b.drawId);let U=r[y],{seedsCount:P,generate:E=!0}=U||{};if(E){let D=S.filter(is(Dd)).map(is(Dd)),R=g||d;if(n&&P&&P<=D.length&&Je(1,P+1).forEach((k,B)=>{let F={scaleValue:k,scaleName:R,scaleType:sd,eventType:p,scaleDate:h},x=D[B];Bw({tournamentRecord:n,participantId:x,scaleItem:F})}),v==null?void 0:v.includes(I))break;let N=ax({...U,matchUpType:p,seedingScaleName:R,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:w,drawId:I,event:a,stage:T});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:M}=N;if(!M)return{error:Qo};let A=(s=r[y])==null?void 0:s.drawExtensions;if(Array.isArray(A)&&A.filter(wc).forEach(k=>hi({element:M,extension:k})),N=lx({suppressNotifications:!0,tournamentRecord:n,drawDefinition:M,event:a}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){let k=(l=M.structures)==null?void 0:l[0].structureId,B=AO({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:M,isMock:!0,structureId:k,event:a});if(B!=null&&B.error)return B}let _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){let k=U==null?void 0:U.matchUpFormat,B=LN({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:M,matchUpFormat:k,event:a});if(B.error)return{error:B.error,drawIds:[]};let F=B.completedCount;if((U==null?void 0:U.drawType)===Ad){let x=(u=M.structures)==null?void 0:u.find(V=>V.stage===at);if(!x)return{error:Tn};let $=XP({structureId:x.structureId,tournamentRecord:n,drawDefinition:M,event:a});if($.error)return{error:$.error,drawIds:[]};let j=_?_-(F??0):void 0;if($=LN({completeAllMatchUps:!_&&e,completionGoal:_?j:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:M,matchUpFormat:k,event:a}),$.error)return{error:$.error,drawIds:[]}}}}}return{...ae,drawIds:m}}function rbe(t){var e,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:c}=t,{category:d,gender:p,eventType:f}=u,h=xn(kd)(f)&&ti||xn(Kl)(f)&&xt||f,m=r[at]||0,g=r[vt]||0,v=(e=s.drawProfiles)!=null&&e.length?m+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[Ki,vn].includes(p)?p:void 0,b=n!=null&&n.idPrefix?`E-${l}-${n==null?void 0:n.idPrefix}`:void 0,{participants:I}=TE({uuids:s.uuids||c,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:h,participantsCount:v,ratingsParameters:a,category:d,idPrefix:b,sex:y}),T=ju({tournamentRecord:o,participants:I});if(T.error)return T;let w=I==null?void 0:I.filter(({participantType:U})=>U===h),S=I==null?void 0:I.map(ei);return{uniqueDrawParticipants:w,uniqueParticipantIds:S}}function Jqe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=uc,qualifyingPositions:o=0,stage:s=at,drawSize:l=0,drawName:u,drawId:c}=n,d=l-o,p=i.slice(0,d).map(ei);if(p.length){let m=cd({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let f=p.map(m=>({entryStatus:ys,entryStage:s,participantId:m})),h=cx({drawName:u||a,qualifyingPositions:o,drawEntries:f,drawId:c,event:r,stage:s});return h.error?h:{...ae}}function abe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let u of r){let{qualifyingPositions:c=0,uniqueParticipants:d,stage:p=at,drawSize:f=0}=u,h=f-c,m=d||o||a||p===vt,g=m?t.slice(l,l+h):i[p||at]||[];m&&(l+=h);let v=Jqe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:u,event:s});if(v.error)return v}return{...ae}}function obe(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,publish:f,isMock:h,uuids:m}=t,g=d.gender,v=d.eventName,{eventType:y=kd,policyDefinitions:b,drawProfiles:I=[],eventExtensions:T,surfaceCategory:w,tieFormatName:S,processCodes:U,discipline:P,eventLevel:E,timeItems:D,ballType:R,category:N}=d,M=d.eventId||Li(),A=d.tieFormat||(y===Rr?Iy({namedFormat:S,event:{eventId:M,category:N,gender:g},hydrateCollections:s,isMock:h}):void 0),_=c.participants;for(let X of I)!g&&X.gender&&(g=X==null?void 0:X.gender);let{stageParticipantsCount:k,uniqueParticipantsCount:B,uniqueParticipantStages:F}=ebe({drawProfiles:I,category:N,gender:g}),x=xn(kd)(y)&&ti||xn(Kl)(y)&&xt||y,{uniqueDrawParticipants:$=[],uniqueParticipantIds:j=[]}=F?rbe({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:B,participantsProfile:r,ratingsParameters:u,tournamentRecord:c,eventProfile:d,eventIndex:p,uuids:m}):{},{eventAttributes:V}=d;typeof V!="object"&&(V={});let H=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||H||"Generated Event";let z={...V,surfaceCategory:w,processCodes:U,discipline:P,eventLevel:E,eventName:v,eventType:y,tieFormat:A,ballType:R,category:N,eventId:M,gender:g};if(T!=null&&T.length&&Array.isArray(T)){let X=T.filter(wc);X!=null&&X.length&&Object.assign(z,{extensions:X})}if(Array.isArray(D)&&D.forEach(X=>Eb({event:Y,timeItem:X})),typeof b=="object")for(let X of Object.keys(b))lg({policyDefinitions:{[X]:b[X]},event:z});z.category&&(z.category.categoryName=H);let q,W=gE({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(W.error)return W;let Y=W==null?void 0:W.event,{stageParticipants:Z}=tbe({allUniqueParticipantIds:i,stageParticipantsCount:k,eventParticipantType:x,targetParticipants:_});if(I!=null&&I.length){let X=abe({uniqueDrawParticipants:$,autoEntryPositions:o,stageParticipants:Z,tournamentRecord:c,drawProfiles:I,category:N,gender:g,event:Y});if(X.error)return X;let Q=nbe({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:c,drawProfiles:I,event:Y});if(Q.error)return Q;q=Q.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let X=$.map(ei);if(X.length){let Q=cd({participantIds:X,autoEntryPositions:o,tournamentRecord:c,entryStage:at,event:Y});if(Q.error)return Q}}return f&&wS({tournamentRecord:c,event:Y}),{drawIds:q,eventId:M,uniqueParticipantIds:j}}function n6({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!hs(e))return{error:Qa};let r="addSchedulingProfileRound",{extension:a}=qt({name:py,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Cd(e,p.scheduleDate));if(!s){let{startDate:p,endDate:f}=KO({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||f&&h>new Date(f))return{error:Qa};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let u=["notBeforeTime"],c=p=>Object.keys(p).filter(f=>!u.includes(f)).sort().map(f=>ln(p[f])?c(p[f]):p[f]).flat().join("|");if(l.rounds.find(p=>c(p)===c(n)))return ue({result:{error:nde},stack:r});l.rounds.push(n);let d=bS({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...ae}}function Qqe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Se};let i=lS({tournamentRecord:e}).containedStructures,n=Xr({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let u of l){let{rounds:c,venueId:d}=u;for(let p of c){let{drawId:f,winnerFinishingPositionRange:h,roundSegment:m}=p,g=n.filter(v=>{var y;let b=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(T=>+T),I=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===f&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!b||$n(I,b).length===2||Ht(I).length===Ht(b).length&&$n(I,b).length===Ht(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,w=g.structureId;y&&!h&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:f},U=n6({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(U.error)return U;a.push({structureName:I,roundName:T,drawName:b,...S})}}}}return{scheduledRounds:a}}function Sx(t){var e,i,n;let r=wi(t,[{drawProfile:!0,_ofType:Kd}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:c,randomWinningSide:d,ratingsParameters:p,tournamentRecord:f,isMock:h=!0,drawProfile:m,startDate:g,drawIndex:v,uuids:y}=t,b=ut(m,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:T=Vs,drawType:w=uc,tournamentAlternates:S=0,alternatesCount:U=0,qualifyingPositions:P,qualifyingProfiles:E,generate:D=!0,eventExtensions:R,drawExtensions:N,completionGoal:M,tieFormatName:A,seedsCount:_,timeItems:k,drawName:B,category:F,idPrefix:x,publish:$,gender:j,stage:V}=b,H=b.drawSize||(b.ignoreDefaults?void 0:32),z=b.eventId||Li(),q=m.eventType||m.matchUpType||kd,W=q===Kl?xt:ti,Y=typeof m.tieFormat=="object"&&m.tieFormat||q===qi&&Iy({event:{eventId:z,category:F,gender:j},namedFormat:A,hydrateCollections:c,isMock:h})||void 0,Z=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),X=m.eventName||Z||`Generated ${q}`,Q=(f==null?void 0:f.participants)||[],ce=((E==null?void 0:E.map(Ie=>Ie.structureProfiles||[]).flat().reduce((Ie,Ne)=>{let be=!Ne.participantsCount||Ne.participantsCount>Ne.drawSize?Ne.drawSize:Ne.participantsCount||0;return Ie+be},0))||0)*(W===xt?2:1),J=(!m.participantsCount||m.participantsCount>H?H:m.participantsCount)||0,ee={eventName:X,eventType:q,tieFormat:Y,category:F,eventId:z,gender:j};Array.isArray(k)&&k.forEach(Ie=>Eb({event:ee,timeItem:Ie}));let{eventAttributes:ne}=m;if(typeof ne!="object"&&(ne={}),Object.assign(ee,ne),(R==null?void 0:R.length)&&Array.isArray(R)){let Ie=R.filter(wc);Ie!=null&&Ie.length&&Object.assign(ee,{extensions:Ie})}let ie=[];if(ce||m.uniqueParticipants||!f||j||F){let Ie=(J||0)+U+ce,Ne=Ie,be={[Ki]:0,[vn]:0},Le,Me;q===qi&&({teamSize:Le,genders:Me}=Jye({alternatesCount:U,tieFormatName:A,tieFormat:Y,drawSize:H}),Object.keys(Me).forEach(ye=>{[Ki,vn].includes(ye)&&Me[ye]&&(be[ye]=H*Me[ye])}),Ne=Le*((H||0)+ce));let Ze=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,qe=TE({...o,scaledParticipantsCount:m.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:Ne,consideredDate:f==null?void 0:f.startDate,sex:j||(o==null?void 0:o.sex),rankingRange:m.rankingRange,uuids:m.uuids||y,ratingsParameters:p,participantType:W,gendersCount:be,idPrefix:Ze,category:F}).participants;if(ee.category&&(ee.category.categoryName=Z),f){let ye=ju({participants:qe,tournamentRecord:f});if(ye.error)return ye}if(qe.forEach(({participantId:ye})=>ie.push(ye)),Q=qe,q===qi){let ye=Me[Ki]?qe.filter(({participantType:Ue,person:Qe})=>Ue===ti&&(Qe==null?void 0:Qe.sex)===Ki).map(ei):[],_e=Me[vn]?qe.filter(({participantType:Ue,person:Qe})=>Ue===ti&&(Qe==null?void 0:Qe.sex)===vn).map(ei):[],Ae=qe.filter(({participantType:Ue})=>Ue===ti).map(ei).filter(Ue=>!ye.includes(Ue)&&!_e.includes(Ue)),Ve=Le-(Me[Ki]+Me[vn]),Ke=0,he=0,ve=0,Ce=Je(0,Ie).map(Ue=>{let Qe=_e.slice(Ke,Ke+Me[vn]),je=ye.slice(he,he+Me[Ki]),ke=Ae.slice(ve,ve+Ve);return Ke+=Me[vn],he+=Me[Ki],ve+=Ve,{individualParticipantIds:[...Qe,...je,...ke],participantOtherName:`TM${Ue+1}`,participantName:`Team ${Ue+1}`,participantRole:Sa,participantType:qi,participantId:Li()}}),De=ju({participants:Ce,tournamentRecord:f});if(!De.success)return De;Q=Ce}}let oe=Ie=>{let{participantType:Ne}=Ie;return xn(kd)(q)&&Ne===ti||xn(Kl)(q)&&Ne===xt?!0:q===qi&&Ne===qi},se=Ie=>{var Ne,be;return!m.gender||((Ne=Ie.person)==null?void 0:Ne.sex)===m.gender?!0:(be=Ie.individualParticipantIds)==null?void 0:be.some(Le=>{let Me=Q.find(Ze=>Ze.participantId===Le);return Me&&se(Me)})},pe=Q.filter(oe).filter(se).filter(({participantId:Ie})=>!a.includes(Ie)),fe=pe.slice(0,J).map(Ie=>Ie.participantId);if(h&&fe!=null&&fe.length){let Ie=cd({autoEntryPositions:u,entryStage:V,tournamentRecord:f,participantIds:fe,event:ee});if(Ie.error)return Ie}let ge=ce?pe.slice(J,J+ce).map(Ie=>Ie.participantId):0;if(h&&ge!=null&&ge.length){let Ie=0,Ne=1,be=(Me,Ze)=>Me.stageSequence-Ze.stageSequence,Le=(Me,Ze)=>Me.roundTarget-Ze.roundTarget;for(let Me of E.sort(Le)){Ne=Me.roundTarget||Ne;let Ze=1,qe;for(let ye of Me.structureProfiles.sort(be)){let _e=(ye.drawSize||kq(ye.participantsCount))-(qe||0),Ae=ge.slice(Ie,Ie+_e),Ve=cd({entryStage:vt,entryStageSequence:Ze,autoEntryPositions:u,tournamentRecord:f,participantIds:Ae,roundTarget:Ne,event:ee});if(Ve.error)return Ve;qe=ye.qualifyingPositions,Ie+=_e,Ze+=1}Ne+=1}}let me=I&&((e=f==null?void 0:f.participants)==null?void 0:e.filter(({participantId:Ie})=>!fe.includes(Ie)).filter(oe).filter(se).slice(0,U||H-J||S).map(Ie=>Ie.participantId));if(h&&me!=null&&me.length){let Ie=cd({participantIds:me,autoEntryPositions:!1,entryStatus:xl,tournamentRecord:f,event:ee});if(Ie.error)return Ie.error}let Ee=Z||X;f&&_&&_<=fe.length&&Je(1,_+1).forEach((Ie,Ne)=>{let be={scaleName:Ee,scaleDate:g,scaleType:kW,scaleValue:Ie,eventType:q},Le=fe[Ne];Bw({tournamentRecord:f,participantId:Le,scaleItem:be})});let Be=ax({...ut(m,!1,!0),tournamentRecord:f,seedingScaleName:Ee,matchUpFormat:T,eventId:z,isMock:h,event:ee});if(Be.error)return Be;if(!Be.drawDefinition)return{error:Qo};let{drawDefinition:Pe}=Be,et=Pe.drawId;if(Array.isArray(N)&&N.filter(wc).forEach(Ie=>hi({element:Pe,extension:Ie})),D){if(lx({drawDefinition:Pe,event:ee,suppressNotifications:!0}),m.withPlayoffs){let Ne=(i=Pe.structures)==null?void 0:i[0].structureId,be=AO({...m.withPlayoffs,tournamentRecord:f,drawDefinition:Pe,structureId:Ne,idPrefix:x,isMock:h,event:ee});if(be!=null&&be.error)return be}let Ie=m.automated===!1;if(h&&!Ie){let Ne=be=>{var Le;let Me=LN({completeAllMatchUps:be.completeAllMatchUps,completionGoal:be.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:f,drawDefinition:Pe,matchUpFormat:T,event:ee});if(Me.error)return Me;let Ze=Me.completedCount;if(w===Ad){let qe=(Le=Pe.structures)==null?void 0:Le.find(Ae=>Ae.stage===at);if(!qe)return{error:Tn};XP({structureId:qe.structureId,tournamentRecord:f,drawDefinition:Pe,event:ee});let ye=M?M-(Ze??0):void 0,_e=LN({completionGoal:M?ye:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:f,drawDefinition:Pe,matchUpFormat:T,event:ee});if(_e.error)return _e}};if(M&&Ne({completionGoal:M}),m.outcomes){let{matchUps:be}=po({inContext:!0,drawDefinition:Pe,event:ee});for(let Le of m.outcomes){let{matchUpStatus:Me=Zn,matchUpStatusCodes:Ze,stageSequence:qe=1,matchUpIndex:ye=0,structureOrder:_e,matchUpFormat:Ae,drawPositions:Ve,roundPosition:Ke,stage:he=at,roundNumber:ve,winningSide:Ce,scoreString:De}=Le,Ue=(be==null?void 0:be.reduce((bt,Gt)=>{let{structureId:Zt,matchUpId:Sr}=Gt;return bt[Zt]?bt[Zt].push(Sr):bt[Zt]=[Sr],bt},{}))??[],Qe=Object.assign({},...Object.keys(Ue).map((bt,Gt)=>({[bt]:Gt+1}))),je=(n=be==null?void 0:be.filter(bt=>(!he||bt.stage===he)&&(!qe||bt.stageSequence===qe)&&(!ve||bt.roundNumber===ve)&&(!Ke||bt.roundPosition===Ke)&&(!_e||Qe[bt.structureId]===_e)&&(!Ve||$n(Ve,bt.drawPositions).length===2)))==null?void 0:n[ye],ke=ibe({matchUpStatusCodes:Ze,tournamentRecord:f,drawDefinition:Pe,targetMatchUp:je,matchUpFormat:Ae,matchUpStatus:Me,scoreString:De,winningSide:Ce});if(ke!=null&&ke.error)return ke}}l&&Ne({completeAllMatchUps:l})}$&&wS({tournamentRecord:f,event:ee})}else{let Ie=cx({drawEntries:Pe.entries,drawName:B||w,qualifyingPositions:P,drawId:et,event:ee,stage:V});if(Ie.error)return Ie}return{...ae,event:ft(ee),uniqueParticipantIds:ie,targetParticipants:Q,drawDefinition:Pe,eventId:z,drawId:et}}var sbe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),eWe=sbe;function FN(t){return parseInt(t)}function rY({startTime:t="",endTime:e=""}={}){if(!t||!e||!Pm.test(t)||!Pm.test(e))return!1;let[i,n]=t.split(":").map(FN),[r,a]=e.split(":").map(FN);return r<i?!1:!(i===r&&a<n)}function tWe(t,e){let[i,n]=t.startTime.split(":").map(FN),[r,a]=e.startTime.split(":").map(FN);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function lbe({dateAvailability:t}){if(!t)return{error:gde};if(!Array.isArray(t))return{error:wR};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:wR};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:wR};if(r&&!Ed.test(r))return{error:Qa,dateAvailability:{date:r},info:e};if(!Pm.test(a))return{error:wl,dateAvailability:{startTime:a},info:i};if(!Pm.test(o))return{error:wl,dateAvailability:{endTime:o},info:i};if(a===o)return{error:wl,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!rY({startTime:a,endTime:o}))return{error:wl,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:oN};for(let l of s){if(typeof l!="object")return{error:oN};let{startTime:u,endTime:c}=l;if(!Pm.test(u))return{error:wl,booking:{startTime:u},info:i};if(!Pm.test(c))return{error:wl,booking:{endTime:c},info:i};if(u===c)return{error:wl,dateAvailability:{startTime:u,endTime:c},info:"startTime and endTime are equivalent"};if(!rY({startTime:u,endTime:c}))return{error:wl,dateAvailability:{startTime:u,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function Tx({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=lf({tournamentRecord:t,venueId:i});if(!a)return{error:X0};a.courts||(a.courts=[]);let o={...sbe(),venueId:i,courtId:n};if(o.courtId||(o.courtId=Li()),a.courts.some(s=>s.courtId===o.courtId))return{error:_de};{let s=((r==null?void 0:r.dateAvailability)||[]).map(c=>{var d;return{...c,date:Bt(c.date),startTime:an(c.startTime),endTime:an(c.endTime),bookings:(d=c.bookings)==null?void 0:d.map(({startTime:p,endTime:f,bookingType:h})=>({startTime:an(p),endTime:an(f),bookingType:h}))}}),l=Object.keys(o);for(let c of l)if(r!=null&&r[c])if(c==="dateAvailability"){let d=lbe({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[c]=r[c];let u=o;return a.courts.push(u),e||oi({payload:{venue:a,tournamentId:t.tournamentId},topic:Og,key:a.venueId}),{...ae,court:ut(o),venueId:i}}}function r6(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Bh};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=lf({tournamentRecord:o,venueId:i});if(s){let l=iWe({...t,tournamentRecord:o});for(let u of(l==null?void 0:l.courts)??[])r.push(u==null?void 0:u.courtId);if(l.error)return l;a=!0}}return a?{...ae,courtIds:r}:{error:X0}}function iWe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:c,venueId:d,dates:p}){if(!d)return{error:Bh};let f=lf({tournamentRecord:n,venueId:d});if(f.error)return f;let{venue:h}=f;if(!Mn(o)||!r)return{error:Ade};o=o??r.length;let m=Je(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(b=>({date:Nu(b),startTime:s,endTime:u,...v})):e;return v&&s&&u&&y.push({startTime:s,endTime:u}),{courtName:r[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||c&&`${c}-${v+1}`;return Tx({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?ue({info:"not all courts could be generated",result:{error:Se}}):(h&&oi({payload:{venue:h,tournamentId:n.tournamentId},topic:Og,key:h.venueId}),{...ae,courts:ut(m)})}function ube({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:n,endDate:r}=t,a=[];for(let[o,s]of e.entries()){let{venueAbbreviation:l,venueId:u=(i==null?void 0:i.pop())??Li(),dateAvailability:c,startTime:d="07:00",endTime:p="19:00",courtTimings:f,courtsCount:h,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,b={venueName:g||`Venue ${o+1}`,venueAbbreviation:l,venueId:u},I=FP({tournamentRecord:t,venue:b});if(I.error)return I;a.push(u);let T=Dw(n,r),w=!Array.isArray(c)&&[{startTime:d,endTime:p}].concat(T.map(U=>({date:Nu(U),startTime:d,endTime:p}))),S=r6({dateAvailability:c||w,tournamentRecord:t,courtTimings:f,courtsCount:h,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:u,dates:T});if(S.error)return S}return a}var nWe=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function cbe(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{},{tournamentName:r=jo(nWe),ratingsParameters:a=ds,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:u,participantsProfile:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:f,policyDefinitions:h,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:b,drawProfiles:I,uuids:T}=t??{};if(i&&!hs(i)||n&&!hs(n))return{error:Qa};if(y&&!Array.isArray(y))return{error:Se};if(!i){let M=new Date;i=Nu(n??M),n=Nu(M.setDate(M.getDate()+7))}if(!n){let M=new Date(i);n=Nu(M.setDate(M.getDate()+7))}typeof e!="object"&&(e={});let w=qye({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){let M=s.filter(A=>wc({extension:A}));M!=null&&M.length&&Object.assign(w,{extensions:M,isMock:!0})}if(typeof h=="object")for(let M of Object.keys(h))lg({policyDefinitions:{[M]:h[M]},tournamentRecord:w});let S=Qye({participantsProfile:c,tournamentRecord:w,eventProfiles:y,drawProfiles:I,startDate:i,uuids:T});if(!S.success)return S;let U=[],P=[],E=[];if(Array.isArray(I)){let M=0;for(let A of I){let _=Sx({allUniqueParticipantIds:U,matchUpStatusProfile:l,completeAllMatchUps:u,autoEntryPositions:d,hydrateCollections:p,participantsProfile:c,randomWinningSide:f,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:A,startDate:i,drawIndex:M,uuids:T});if(_.error)return _;let{drawId:k,eventId:B,event:F,uniqueParticipantIds:x}=_;if(_=gE({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:F}),_.error)return _;k&&E.push(k),P.push(B),x!=null&&x.length&&U.push(...x),M+=1}}if(y){let M=0;for(let A of y){let _=obe({allUniqueParticipantIds:U,matchUpStatusProfile:l,participantsProfile:c,completeAllMatchUps:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:f,ratingsParameters:a,tournamentRecord:w,eventProfile:A,eventIndex:M,startDate:i,uuids:T});if(_.error)return _;let{eventId:k,drawIds:B,uniqueParticipantIds:F}=_;B&&E.push(...B),P.push(k),F!=null&&F.length&&U.push(...F),M+=1}}let D=b!=null&&b.length?ube({tournamentRecord:w,venueProfiles:b,uuids:T}):[],R,N={};if(m){let M=Qqe({schedulingProfile:m,tournamentRecord:w});if(M.error)return M;if(R=M.scheduledRounds,v){let{tournamentId:A}=w,_={[A]:w};N=wx({scheduleCompletedMatchUps:o,tournamentRecords:_,periodLength:g})}}return Lq(),ft({...ae,tournamentRecord:w,scheduledRounds:R,schedulerResult:N,eventIds:P,venueIds:D,drawIds:E})}var dbe={};Yt(dbe,{anonymizeTournamentRecord:()=>pbe,modifyTournamentRecord:()=>fbe});function pbe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var o,s,l,u,c;if(!i)return{error:Oe};let d=Array.isArray(t)?hK.concat(...t):hK,p=V=>{var H;return Array.isArray(t)?(H=V==null?void 0:V.extensions)==null?void 0:H.filter(z=>d.includes(z.name)):V==null?void 0:V.extensions},f={};i.extensions=p(i);let h=a||Li();f[i.tournamentId]=h,i.tournamentId=h,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Nu(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let V of i.participants||[]){let H=Li();f[V.participantId]=H,V.participantId=H}for(let V of i.participants||[])Array.isArray(V.individualParticipantIds)&&(V.individualParticipantIds=V.individualParticipantIds.map(H=>f[H]));let m=0;for(let V of i.venues||[]){V.extensions=p(V),V.venueName=`Venue #${m}`,V.venueAbbreviation=`V${m}`;let H=Li();f[V.venueId]=H,V.isMock=!0,m+=1}let g=1;for(let V of i.events||[]){V.extensions=p(V),V.isMock=!0;let H=Li();f[V.eventId]=H,V.eventId=H;let z=((o=V.category)==null?void 0:o.categoryName)||((s=V.category)==null?void 0:s.ageCategoryCode)||((l=V.category)==null?void 0:l.ratingType)||V.gender;if(V.eventName=`Event ${g} ${z}`,Array.isArray(V.entries))for(let W of V.entries)W.participantId=f[W.participantId];for(let W of V.drawDefinitions||[]){W.extensions=p(W);let Y=Li();if(f[W.drawId]=Y,W.drawId=Y,W.isMock=!0,Array.isArray(W.entries))for(let X of W.entries)X.participantId=f[X.participantId];let Z=X=>{X.extensions=p(X);let Q=Li();f[X.structureId]=Q,X.structureId=Q;for(let ce of X.positionAssignments||[])ce.participantId&&(ce.participantId=f[ce.participantId]);for(let ce of X.seedAssignments||[])ce.participantId&&(ce.participantId=f[ce.participantId]);for(let ce of X.matchUps||[]){ce.isMock=!0;for(let J of ce.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:ee,collectionAssignments:ne})=>({participantId:f[ee],collectionAssignments:ne})))}};for(let X of W.structures||[])if(Z(X),Array.isArray(X.structures))for(let Q of X.structures)Z(Q);for(let X of W.links||[])X.source.structureId=f[X.source.structureId],X.target.structureId=f[X.target.structureId]}let{extension:q}=qt({name:zl,element:V});Array.isArray((u=q==null?void 0:q.value)==null?void 0:u.flights)&&((c=q==null?void 0:q.value.flights)==null||c.forEach(W=>{if(W.drawId=f[W.drawId],Array.isArray(W.drawEntries))for(let Y of W.drawEntries)Y.participantId=f[Y.participantId]})),g+=1}let v=i.startDate||Nu(new Date),y=(i.participants||[]).filter(({participantType:V})=>V===ti),b=y.reduce((V,H)=>{var z;let q=(z=H.person)==null?void 0:z.sex;return[Ki,vn].includes(q)?V[q]+=1:V[mv]+=1,V},{[Ki]:0,[vn]:0,[mv]:0}),I=Object.assign({},...Object.keys(b).map(V=>{var H;return{[V]:((H=Xye({category:{ageCategoryCode:"O18"},count:b[V],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:V}))==null?void 0:H.persons)||[]}})),T={[Ki]:0,[vn]:0,[mv]:0},w=y.length,S=y.reduce((V,H)=>{var z,q;let W=((q=(z=H.person)==null?void 0:z.addresses)==null?void 0:q[0])||{},{city:Y,state:Z,postalCode:X}=W;return V.cities.includes(Y)||V.cities.push(Y),V.states.includes(Z)||V.states.push(Z),V.postalCodes.includes(X)||V.postalCodes.push(X),V},{cities:[],postalCodes:[],states:[]}),U=S.postalCodes.length,P=S.cities.length,E=S.states.length,{cities:D}=Wye({count:P||w,participantsCount:w}),{states:R}=Kye({count:E||w,participantsCount:w}),{postalCodes:N}=Yye({count:U||w,participantsCount:w}),M={cities:D,states:R,postalCodes:N};y.forEach((V,H)=>{var z,q;let W=V==null?void 0:V.person,Y=(W==null?void 0:W.sex)||mv,Z=(z=Bt(W==null?void 0:W.birthDate))==null?void 0:z.split("-")[0],X=T[Y],Q=I[Y][X];if(T[Y]+=1,Z){let[,ce,J]=((q=Q==null?void 0:Q.birthDate)==null?void 0:q.split("-"))||[],ee=[Z,ce,J].join("-");Q.birthDate=ee}if(W!=null&&W.addresses){let ce=Zye({...M,participantIndex:H,nationalityCode:Q.nationalityCode});Q.addresses=[ce]}Q.personId=(r==null?void 0:r[H])||Li(),e?(Q.standardFamilyName=Q.lastName,Q.standardGivenName=Q.firstName,V.participantName=`${Q.standardGivenName} ${Q.standardFamilyName}`):(Q.standardFamilyName=W==null?void 0:W.standardFamilyName,Q.standardGivenName=W==null?void 0:W.standardGivenName),delete Q.firstName,delete Q.lastName,Q.extensions=p(W),V.person=Q,f[W==null?void 0:W.personId]=Q.personId}),(i.participants||[]).filter(({participantType:V})=>V===xt).forEach(V=>{let{individualParticipantIds:H}=V;V.participantName=rWe({individualParticipantIds:H,individualParticipants:y})});let A=(i.participants||[]).filter(({participantType:V})=>V===qi),_=A.length,k=y$({count:_}).names;A.forEach((V,H)=>{V.participantName=k[H]});let B=(i.participants||[]).filter(({participantType:V})=>V===Us),F=B.length,x=y$({count:F,nameRoot:"Group"}).names;B.forEach((V,H)=>{V.participantName=x[H]});let{extension:$}=qt({element:i,name:py});Array.isArray($==null?void 0:$.value)&&($==null||$.value.forEach(V=>{V.tournamentId=f[V.tournamentId],V.structureId=f[V.structureId],V.eventId=f[V.eventId],V.drawId=f[V.drawId]}));let{extension:j}=qt({element:i,name:rS});return Array.isArray(j==null?void 0:j.value)&&(j==null||j.value.forEach(V=>{V.personId=f[V.personId]})),{...ae}}function rWe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function fbe(t){var e,i,n;let{ratingsParameters:r=ds,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,schedulingProfile:d,tournamentRecord:p,eventProfiles:f,periodLength:h,venueProfiles:m,autoSchedule:g,drawProfiles:v,uuids:y}=t;if(!p)return{error:Oe};let b=[],I=[],T=[];f==null||f.forEach(D=>{var R;let N=(R=p.events)==null?void 0:R.find((M,A)=>D.eventIndex!==void 0&&A===D.eventIndex||D.eventName&&M.eventName===D.eventName||D.eventId&&M.eventId===D.eventId);N!=null&&N.gender&&(D.gender=N.gender)});let w=((e=p.participants)==null?void 0:e.length)||void 0;w&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${w}`);let S=Qye({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:f,drawProfiles:v,uuids:y});if(!S.success)return S;if(f){let D=((i=p.events)==null?void 0:i.length)||0;for(let R of f){let{ratingsParameters:N}=R,M=(n=p.events)==null?void 0:n.find((A,_)=>R.eventIndex!==void 0&&_===R.eventIndex||R.eventName&&A.eventName===R.eventName||R.eventId&&A.eventId===R.eventId);if(M){let{gender:A,category:_,eventType:k}=M,{drawProfiles:B,publish:F}=R,x=xn(kd)(k)&&ti||xn(Kl)(k)&&xt||k;if(B){let{stageParticipantsCount:$,uniqueParticipantsCount:j,uniqueParticipantStages:V}=ebe({drawProfiles:B,category:_,gender:A}),{uniqueDrawParticipants:H=[],uniqueParticipantIds:z=[]}=V?rbe({event:{eventType:k,category:_,gender:A},uniqueParticipantsCount:j,participantsProfile:a,ratingsParameters:N,tournamentRecord:p,eventProfile:R,uuids:y}):{};b.push(...z);let{stageParticipants:q}=tbe({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:$,eventParticipantType:x}),W=abe({uniqueDrawParticipants:H,autoEntryPositions:l,stageParticipants:q,tournamentRecord:p,drawProfiles:B,category:_,gender:A,event:M});if(W.error||(W=nbe({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:c,tournamentRecord:p,drawProfiles:B,event:M}),W.error))return W;T.push(...W.drawIds)}F&&wS({tournamentRecord:p,event:M})}else{let A=obe({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:c,ratingsParameters:N,tournamentRecord:p,eventProfile:R,eventIndex:D,uuids:y});if(A.error)return A;let{eventId:_,drawIds:k,uniqueParticipantIds:B}=A;k&&T.push(...k),I.push(_),B!=null&&B.length&&b.push(...B),D+=1}}}if(v){let D=(p.events||[]).map(R=>{var N;return((N=R.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((R,N)=>R+N,0);for(let R of v){let N=Sx({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:c,ratingsParameters:r,tournamentRecord:p,drawProfile:R,drawIndex:D,uuids:y});if(N.error)return N;let{drawId:M,eventId:A,event:_,uniqueParticipantIds:k}=N;if(N=gE({tournamentRecord:p,event:_,internalUse:!0}),N.error)return N;M&&T.push(M),I.push(A),k!=null&&k.length&&b.push(...k),D+=1}}let U=m!=null&&m.length?ube({tournamentRecord:p,venueProfiles:m}):[],P,E={};if(d!=null&&d.length){let D={[p.tournamentId]:p},R=bS({tournamentRecords:D,schedulingProfile:d});if(R.error)return R;if(g){let{tournamentId:N}=p,M={[N]:p};E=wx({tournamentRecords:M,periodLength:h})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:P,schedulerResult:E,...ae,eventIds:I,venueIds:U,drawIds:T}}var hbe={};Yt(hbe,{addIndividualParticipantIds:()=>hx,addParticipant:()=>Ec,addParticipants:()=>ju,addPenalty:()=>kbe,addPersonRequests:()=>Ibe,addPersons:()=>Obe,createGroupParticipant:()=>Pbe,createTeamsFromParticipantAttributes:()=>t6,deleteParticipants:()=>Tb,filterParticipants:()=>zP,findParticipant:()=>Dbe,getCompetitionParticipants:()=>Y4,getPairedParticipant:()=>Yl,getParticipantEventDetails:()=>Z4,getParticipantMembership:()=>X4,getParticipantScaleItem:()=>Fw,getParticipantSchedules:()=>J4,getParticipantSignInStatus:()=>Q4,getParticipantTimeItem:()=>jW,getParticipants:()=>jn,getScaleValues:()=>tS,mergeParticipants:()=>_be,modifyIndividualParticipantIds:()=>wbe,modifyParticipant:()=>mx,modifyParticipantName:()=>Ebe,modifyParticipantOtherName:()=>Tbe,modifyParticipantsSignInStatus:()=>Sbe,modifyPenalty:()=>Nbe,modifyPersonRequests:()=>ybe,mutate:()=>mbe,participantScaleItem:()=>ud,query:()=>wve,regenerateParticipantNames:()=>Ube,removeIndividualParticipantIds:()=>YW,removeParticipantIdsFromAllTeams:()=>wO,removePenalty:()=>Rbe,removePersonRequests:()=>bbe,scaledTeamAssignment:()=>Cbe,setParticipantScaleItem:()=>Bw,setParticipantScaleItems:()=>Ame,validateLineUp:()=>TO});var mbe={};Yt(mbe,{addIndividualParticipantIds:()=>hx,addParticipant:()=>Ec,addParticipants:()=>ju,addPenalty:()=>kbe,addPersonRequests:()=>Ibe,addPersons:()=>Obe,createGroupParticipant:()=>Pbe,createTeamsFromParticipantAttributes:()=>t6,deleteParticipants:()=>Tb,findParticipant:()=>Dbe,mergeParticipants:()=>_be,modifyIndividualParticipantIds:()=>wbe,modifyParticipant:()=>mx,modifyParticipantName:()=>Ebe,modifyParticipantOtherName:()=>Tbe,modifyParticipantsSignInStatus:()=>Sbe,modifyPenalty:()=>Nbe,modifyPersonRequests:()=>ybe,regenerateParticipantNames:()=>Ube,removeIndividualParticipantIds:()=>YW,removeParticipantIdsFromAllTeams:()=>wO,removePenalty:()=>Rbe,removePersonRequests:()=>bbe,scaledTeamAssignment:()=>Cbe,setParticipantScaleItem:()=>Bw,setParticipantScaleItems:()=>Ame});function gbe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function vbe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===wE&&(a=Bt(a),o=an(o),s=an(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=gbe(),t[e].push(r);return{mergeCount:n.length}}function a6(t){let{tournamentRecords:e,personRequests:i}=t,n=wi(t,[{[Ea]:!0}]);if(n.error)return n;if(!i)return{...ae};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(ph({tournamentParticipants:o,personId:l})){let u=i[l];u.length&&s.push({personId:l,requests:u})}Object.keys(s).length&&hi({element:a,extension:{value:s,name:rS}})}return{...ae}}function ybe(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=wi(t,[{[Ea]:!0},{requests:!0,[Vh]:Fo,[Pd]:Se}]);if(r.error)return r;let a=i.map(({requestId:u})=>u).filter(Boolean),{personRequests:o}=qg({tournamentRecords:e}),s=u=>{o&&(o[u]=o[u].map(c=>{if(!a.includes(c.requestId))return c;let d=i.find(p=>p.requestId===c.requestId);if(d.requestType)return Object.assign(c,d)}).filter(Boolean))};if(n&&o!=null&&o[n])s(n);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter(u=>!u.requestId);return l.length&&vbe({personRequests:o,personId:n,requests:l}),a6({tournamentRecords:e,personRequests:o})}function bbe(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=wi(t,[{[Ea]:!0}]);if(o.error)return o;let{personRequests:s}=qg({tournamentRecords:e}),l=c=>{var d;s&&(s[c]=s[c].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[c])!=null&&d.length||delete s[c])},u=!i&&!n&&!r&&!a;if(!u){if(r&&s!=null&&s[r])l(r);else if(s)for(let c of Object.keys(s))l(c)}return u||!s||!Object.keys(s).length?qa({name:rS,tournamentRecords:e,discover:!0}):a6({tournamentRecords:e,personRequests:s})}function Ibe(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=wi(t,[{[Ea]:!0,[LBe]:!0},{requests:!0,[Vh]:Fo,[Pd]:Se}]);if(r.error)return r;let{personRequests:a}=qg({tournamentRecords:e}),{mergeCount:o}=vbe({personRequests:a,personId:i,requests:n});return o&&a?a6({tournamentRecords:e,personRequests:a}):{error:Se}}function wbe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return ue({result:{error:Oe},stack:n});if(!e||!t)return ue({result:{error:dt},stack:n});let r=i.participants||[],a=r.find(f=>f.participantId===e);if(!a)return ue({result:{error:qn},stack:n});if(![qi,Us].includes(a.participantType))return ue({result:{error:Bu},context:{participantType:a.participantType},stack:n});let o=t.filter(f=>{var h;return((h=r.find(m=>m.participantId===f))==null?void 0:h.participantType)!==ti});if(o.length)return ue({result:{error:Ol,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(f=>!s.includes(f)),u=s.filter(f=>!t.includes(f)),c=hx({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(c.error)return ue({result:c,stack:n});let d=YW({individualParticipantIds:u,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ue({result:d,stack:n});let{topics:p}=iu();if(p.includes(ma)){let f=r.find(({participantId:h})=>h===e);oi({topic:ma,payload:{tournamentId:i.tournamentId,participants:[f]}})}return{...c,...d}}function Sbe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Oe};if(!Array.isArray(e))return{error:dt};if(![JU,lfe].includes(i))return{error:Se,signInState:i};let n=t.participants||[];if(!n.length)return{error:pP};let r=n.map(ei),a=e.filter(u=>!r.includes(u));if(a.length)return{error:Se,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let u of n){let{participantId:c}=u;if(e.includes(c)){let d=l4({duplicateValues:!1,tournamentRecord:t,participantId:c,timeItem:{itemType:EP,itemValue:i,createdAt:s}});if(d.error)return d;o.push(u)}}let{topics:l}=iu();return o.length&&l.includes(ma)&&oi({topic:ma,payload:{tournamentId:t.tournamentId,participants:o}}),{...ae}}function Tbe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Oe};if(!e)return{error:wr};let{participant:n}=jg({tournamentRecord:t,participantId:e});if(!n)return{error:qn};n.participantOtherName=i;let{topics:r}=iu();return r.includes(ma)&&oi({topic:ma,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ae}}function aY({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,u=m=>m.toLowerCase().indexOf("f")<0,c=m=>m.indexOf(" ")>0;if(!e)return;let d=c(t)?" ":"",p=zB((e==null?void 0:e.standardGivenName)??""),f=zB((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${f}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),f=f.toLowerCase()):r(t)?(p=p.toUpperCase(),f=f.toUpperCase()):a(t)&&(f=f.toUpperCase());let h=`${p}${d}${f}`;return u(t)?h=f:o(t)&&(s(t)?h=`${f},${d}${p}`:h=`${f}${d}${p}`),h}function aWe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==Ws&&o){let{personFormat:s,doublesJoiner:l}=o;n===ti&&(e.participantName=aY({person:a,personFormat:s})),n===xt&&(e.participantName=r==null?void 0:r.map(u=>{var c;let d=(c=t[u])==null?void 0:c.person;return aY({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Ube({tournamentRecord:t,formats:e}){if(!t)return{error:Oe};if(!ln(e))return{error:dt};let i=t.participants??[],n=Hce(i,"participantId");for(let r of i)aWe({participant:r,participantMap:n,formats:e});return{...ae}}function Dbe(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:dt,stack:"publicFindParticipant"};let s,l;for(let u of Object.values(o)){l=u.tournamentId;let c=u.participants||[];if(s=ph({tournamentParticipants:c,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...ae}}function Pbe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=the,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:Oe};if(!a)return{error:dt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Se};let o=(jn({participantFilters:{participantTypes:[ti]},tournamentRecord:n}).participants??[]).map(c=>c.participantId);for(let c of t)if(!o.includes(c))return{error:Bu,participantId:c};let s=ft({participantId:r||Li(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Us,participantRole:i}),l=Ec({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:u}=iu();return u.includes(hh)&&oi({topic:hh,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ae,participant:ut(s)}}function Ebe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Oe};if(!i)return{error:wr};if(!e)return{error:dt,info:"Missing participantName"};let{participant:n}=jg({tournamentRecord:t,participantId:i});if(!n)return{error:qn};n.participantName=e;let{topics:r}=iu();return r.includes(ma)&&oi({topic:ma,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ae}}function Cbe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:c,event:d}){var p,f,h,m,g;if(!o)return{error:Oe};if(!Array.isArray(a)&&!At(u)&&!c||!At(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Se};if(!s&&!r.length||!r&&!(e&&s))return{error:dt,info:"Missing scaling details"};if(c&&!a){if((d==null?void 0:d.eventType)!==rl)return{error:ch};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===ys).map(ei)}if(!(a!=null&&a.length)&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:dt};let v=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let y=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],b=[];for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(y.includes(S)){if(U!==Ws)return{error:Bu,participant:w};b.push(w)}}if(u&&b.length<u){let w=u-((b==null?void 0:b.length)||0),S=l??"Team",U=Je(0,w).map(R=>({participantName:`${S} ${R+1}`,participantType:Ws,participantRole:Sa})),{participants:P=[]}=ju({participants:U,returnParticipants:!0,tournamentRecord:o}),E=P.map(ei),D=((f=o.participants)==null?void 0:f.filter(({participantId:R})=>E.includes(R)))??[];b.push(...D)}if(!b.length)return{error:Rq};if(t)for(let w of b)w.individualParticipantIds=[];else{let w=b.map(S=>S).flat();e!=null&&e.length?v=v.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:Hk,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(!v.includes(S))continue;if(U!==ti)return{error:Bu,participant:w};let P=(h=ud({scaleAttributes:s,participant:w}))==null?void 0:h.scaleItem,E=s!=null&&s.accessor?(m=P==null?void 0:P.scaleValue)==null?void 0:m[s==null?void 0:s.accessor]:P==null?void 0:P.scaleValue,D={participantId:S,scaleValue:E};r.push(D)}if(!r.length)return{error:qn}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Se,scaledParticipant:w};let I=0;for(;I<r.length;){for(let w of b){if(I+1>r.length)break;let S=r[I];w.individualParticipantIds.push(S.participantId),I++}b.reverse()}let T=b.map(ei);for(let w of o.events??[]){if(w.eventType!==rl)continue;let S=(w.entries??[]).filter(U=>T.includes(U.participantId));for(let U of S){let P=U.participantId,E=(g=b.find(R=>R.participantId===P))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(R=>!E.includes(R.participantId)),(w.drawDefinitions??[]).forEach(R=>{R.entries=(R.entries??[]).filter(N=>!E.includes(N.participantId))});let{flightProfile:D}=Hn({event:w});((D==null?void 0:D.flights)||[]).forEach(R=>{R.drawEntries=(R.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...ae,scaledParticipants:r}}function Rbe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Rn};for(let i of Object.values(e)){let n=oWe({...t,tournamentRecord:i});if(n.error&&n.error!==Tw)return n}return{...ae}}function oWe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Oe};if(!e)return{error:Uq};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&oi({topic:ma,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...ae,penalty:a}:{error:Tw}}var sWe=({penaltyId:t=Li()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Mbe=sWe;function Nbe(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Rn};for(let i of Object.values(e)){let n=lWe({...t,tournamentRecord:i});if(n.error&&n.error!==Tw||n.success)return n}return{error:Tw}}function lWe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Oe};if(!e)return{error:Se,modifications:e};if(!i)return{error:Uq};let n=(t==null?void 0:t.participants)??[],r=Object.keys(Mbe()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:zk};let o,s=[];return n.forEach(l=>{let u=!1;l.penalties=(l.penalties??[]).map(c=>(c.penaltyId===i&&(u=!0,a.forEach(d=>Object.assign(c,{[d]:e[d]})),o||(o=c)),c)),u&&s.push(l)}),o&&oi({topic:ma,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...ae,penalty:o}:{error:Tw}}function Abe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ht(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Ht(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=Abe(t[r],e[r],i):n[r]=e[r];return n},{})}function _be({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Oe};e.participants||(e.participants=[]);let n=t.filter(is(Dd)).map(u=>({[u.participantId]:u})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(u=>{if(r[u.participantId]){let c=Abe(u,r[u.participantId],i);return a.push(c),c}return u});let o=e.participants.map(is(Dd))||[],s=t.filter(({participantId:u})=>!o.includes(u)),{topics:l}=iu();return s.length&&(e.participants=e.participants.concat(...s),l.includes(hh)&&oi({topic:hh,payload:{participants:s}})),a.length&&l.includes(ma)&&oi({topic:ma,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...ae}}function kbe(t){var e;let{tournamentRecord:i,participantIds:n}=t,r=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(r)){let s=(e=jn({tournamentRecord:o}).participants??[])==null?void 0:e.map(ei).filter(l=>n.includes(l));s.length&&(a=uWe({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...ae,penaltyId:a}:{error:qn}}function uWe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!e)return{error:Oe};if(!i)return{error:wr};if(!r)return{error:Nde};let c=((e==null?void 0:e.participants)??[]).filter(f=>i.includes(f.participantId));if(!c.length)return{error:qn};let d=new Date().toISOString(),p=Object.assign(Mbe({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach(f=>hi({element:p,extension:f})),c.forEach(f=>{f.penalties||(f.penalties=[]),f.penalties.push(p)}),oi({topic:ma,payload:{tournamentId:e.tournamentId,participants:c}}),{...ae,penaltyId:p.penaltyId}}function Obe({participantRole:t=Sa,tournamentRecord:e,persons:i}){var n;if(!e)return{error:Oe};if(!Array.isArray(i))return{error:Se};if(!Object.keys(KW).includes(t))return{error:Ide};let r=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),a=[],o=i.filter(m=>m&&(!m.personId||!r.includes(m.personId))).map(m=>(m.personId||(m.personId=Li()),a.push(m.personId),m)),s=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),l=o.map(m=>ft({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:ti,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),u=0,c=0,d=ju({participants:l,tournamentRecord:e});if(d.error)return d;c=d.addedCount||0;let p=[],f=((n=jn({participantFilters:{participantTypes:[ti]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===Sa&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>ph({tournamentParticipants:f,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(ei);p.push(ft({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Sa,individualParticipantIds:b,participantType:xt}))}})}),p.length){if(d=ju({participants:p,tournamentRecord:e}),d.error)return d;u=d.addedCount||0}let h=c+u;return{...ae,addedCount:h,newPersonIds:a}}var xbe={};Yt(xbe,{bulkUpdatePublishedEventIds:()=>o5,getAllEventData:()=>s5,getCourtInfo:()=>mO,getDrawData:()=>YO,getEventData:()=>ZO,getEventPublishStatus:()=>fl,getPublishState:()=>Sb,getVenueData:()=>Ow,mutate:()=>Lbe,publishEvent:()=>wS,publishEventSeeding:()=>Fbe,publishOrderOfPlay:()=>Vbe,query:()=>Pve,setEventDisplay:()=>ux,unPublishEvent:()=>jbe,unPublishEventSeeding:()=>Bbe,unPublishOrderOfPlay:()=>$be});var Lbe={};Yt(Lbe,{publishEvent:()=>wS,publishEventSeeding:()=>Fbe,publishOrderOfPlay:()=>Vbe,setEventDisplay:()=>ux,unPublishEvent:()=>jbe,unPublishEventSeeding:()=>Bbe,unPublishOrderOfPlay:()=>$be});function Fbe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=ou,drawIds:a=[],event:o}){var s,l,u,c;if(!n)return{error:Oe};if(!o)return{error:Oi};let d=fl({event:o,status:r}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},f=(((u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames)||e)&&{...(c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames,...e},h=ft({stageSeedingScaleNames:f,seedingScaleNames:p,published:!0,drawIds:a});return IS({statusObject:{seeding:h},removePriorValues:t,status:r,event:o}),oi({topic:nfe,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...ae}}function Bbe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=ou,drawIds:r,stages:a,event:o}){var s,l;if(!i)return{error:Oe};if(!o)return{error:Oi};let u=fl({event:o});if(u){let c=u.seeding;if(Array.isArray(a)&&c.stageSeedingScaleNames)for(let d of a)c.stageSeedingScaleNames[d]&&delete c.stageSeedingScaleNames[d];Array.isArray(e)&&c!=null&&c.seedingScaleNames&&(c.seedingScaleNames=c.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&c!=null&&c.drawIds&&(c.drawIds=c.drawIds.filter(d=>!r.includes(d))),(!Object.values(c.stageSeedingScaleNames??{}).length&&!((s=c.seedingScaleNames)!=null&&s.length)&&!((l=c.drawIds)!=null&&l.length)||!a&&!e&&!(r!=null&&r.length))&&(delete c.stageSeedingScaleNames,delete c.seedingScaleNames,delete c.drawIds,c.published=!1),IS({statusObject:{seeding:c},removePriorValues:t,status:n,event:o})}return oi({topic:UW,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...ae}}function $be(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Rn};for(let i of Object.values(e)){let n=cWe({tournamentRecord:i,...t});if(n.error)return n}return{...ae}}function cWe({removePriorValues:t=!0,tournamentRecord:e,status:i=ou}){if(!e)return{error:Oe};let n=`${Bg}.${$g}`,{timeItem:r}=Lc({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,zh({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),oi({topic:DW,payload:{tournamentId:e.tournamentId}}),{...ae}}function Vbe(t){let e=xc(t);if(!Object.keys(e).length)return{error:Rn};for(let i of Object.values(e)){let n=dWe({tournamentRecord:i,...t});if(n.error)return n}return{...ae}}function dWe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=ou,eventIds:r=[]}){if(!i)return{error:Oe};let a=`${Bg}.${$g}`,{timeItem:o}=Lc({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},zh({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),oi({topic:rfe,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ae}}function jbe({removePriorValues:t=!0,tournamentRecord:e,status:i=ou,event:n}){if(!e)return{error:Oe};if(!n)return{error:Oi};let r=`${Bg}.${$g}`,{timeItem:a}=$P({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Eb({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),IS({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),oi({topic:TW,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ae}}var Gbe={};Yt(Gbe,{getEntryStatusReports:()=>fWe,getParticipantStats:()=>pWe,getStructureReports:()=>mWe,getVenuesReport:()=>vWe});function pWe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,c,d,p;if(!r)return{error:Oe};if(s&&!Array.isArray(s))return{error:go};if(s=s??Xr({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Ld};let f=[];e&&f.push(e),n&&f.push(n);let h=f.length?{participantIds:f}:{participantTypes:[Ws]},m=jn({participantFilters:h,tournamentRecord:r}).participants??[];if(!m.every(({participantType:R})=>R===Ws))return{error:Ol};f.length||f.push(...m.map(ei));let g=new Map,v=new Map,y=new Map,b=new Map,I=(R,N="")=>v.get(R)||v.set(R,{participantName:N,participantId:R,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(R);for(let R of m){let{participantId:N,individualParticipantIds:M}=R;b.set(N,M??[]),I(N,R.participantName)}if(n&&!b.get(n))return ue({result:{error:qn},context:{teamParticipantId:n}});if(e&&!b.get(e))return ue({result:{error:qn},context:{opponentParticipantId:e}});let T=[],w=R=>{let N=[[],[]];for(let A of R){let _=A.participant;if(_!=null&&_.participantName){g.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let k=v.get(_.participantId);k&&(k.participantName=_.participantName)}}let M=({side:A,individualParticipantIds:_})=>{var k,B,F,x,$;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((B=(k=A.participant)==null?void 0:k.individualParticipantIds)==null?void 0:B.length)&&(!(_!=null&&_.length)||$n(_,(F=A.participant)==null?void 0:F.individualParticipantIds).length===(($=(x=A.participant)==null?void 0:x.individualParticipantIds)==null?void 0:$.length))&&A.participant.individualParticipantIds};if(b.size){let A=(_,k)=>{for(let B of R){if(!B.participant)continue;let F=M({individualParticipantIds:k,side:B});if(F!=null&&F.length){let x=B.sideNumber;if(!x)continue;let $=[_];i&&$.push(...F),N[x-1]=$;let j=v.get(_);for(let V of F.filter(Boolean))j&&!j.competitorIds.includes(V)&&j.competitorIds.push(V)}}};if(n)(!e||R.every(_=>_.participant&&(M({individualParticipantIds:b.get(n),side:_})||M({individualParticipantIds:b.get(e),side:_}))))&&A(n,b.get(n));else for(let[_,k]of b)A(_,k)}else if(i)for(let A of R){if(!A.participant)continue;let _=M({individualParticipantIds:[],side:A}),k=A.sideNumber;k&&(N[k-1]=_)}return N};for(let R of s){if(!ln(R))return{error:go};let{matchUpStatus:N,matchUpFormat:M,matchUpType:A,winningSide:_,score:k,sides:B}=R;if(!B||!k||A===Tc||N===Di)continue;let F=w(B);if(!F.filter(Boolean).length)continue;let x=t&&_&&((l=OP({matchUp:R}))==null?void 0:l.competitiveness);T.push(R);let $=h4({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:k}),j=zhe({matchUpStatus:N,matchUpFormat:M,tallyPolicy:o,winningSide:_,score:k}),{pointsTally:V,tiebreaksTally:H}=qhe({matchUpFormat:M,score:k});F.forEach((z,q)=>{var W;for(let Y of z){let Z=(W=g.get(Y))==null?void 0:W.participantName,X=I(Y,Z);if(X){let Q=(ie,oe)=>oe.forEach((se,pe)=>X[ie][pe]+=se),ce=q?[...H].reverse():H,J=q?[...V].reverse():V,ee=q?[...j].reverse():j,ne=q?[...$].reverse():$;if(Q("tiebreaks",ce),Q("points",J),Q("games",ee),Q("sets",ne),_){let ie=_-1===q?0:1;X.matchUps[ie]+=1}if(x){let ie=x.toLowerCase();X.competitiveness[ie]||(X.competitiveness[ie]=[0,0]),X.competitiveness[ie][q]+=1}if(N){let ie=N.toLowerCase();X.matchUpStatuses[ie]||(X.matchUpStatuses[ie]=0),X.matchUpStatuses[ie]+=1}}}})}let S=["tiebreaks","matchUps","points","games","sets"],U=["competitive","routine","decisive"],P=new Map,E=(R,N)=>(R??0)+(N??0);for(let[R,N]of v.entries()){for(let M of S){let A=N[M].reduce(E);if(A){let _=N[M][0]/A,k=`${M}Ratio`,B=parseFloat(_.toFixed(2));N[k]=B,y.set(R,!0),P.has(k)||P.set(k,[]),(u=P.get(k))==null||u.push(B)}}for(let M of U){let A=(d=(c=N.competitiveness)==null?void 0:c[M])==null?void 0:d.reduce(E);if(A){let _=N.competitiveness[M][0]/A,k=`${M}Ratio`,B=parseFloat(_.toFixed(2));N[k]=B}}}if(!n){let R=(N,M)=>M-N;for(let N of v.values())for(let M of S){let A=`${M}Ratio`;if(typeof N[A]=="number"){let _=(p=P.get(A))==null?void 0:p.sort(R).indexOf(N[A]);if(typeof _=="number"&&_>=0){let k=`${M}Rank`;N[k]=_+1}}}}let D={relevantMatchUps:T,...ae};return n?(D.teamStats=v.get(n),e&&(D.opponentStats=v.get(e))):D.participatingTeamsCount=y.size,D.allParticipantStats=[...v.values()],D}function BN({participant:t,eventType:e}){var i,n,r,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,u=(r=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],c=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:m})=>m===x4),p=d==null?void 0:d.scaleValue,{wtnRating:f,confidence:h}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:u,confidence:h,wtnRating:f,personId:l,tennisId:c}}function fWe({tournamentRecord:t}){if(!t)return{error:Oe};let e=t.tournamentId,{participantMap:i}=jn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Xr({matchUpFilters:{matchUpTypes:[kv,ig]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:f,matchUpType:h})=>f==null?void 0:f.flatMap(m=>{var g,v;return h===ig?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,u=({id:f,entry:h,eventId:m,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:b,entryStatus:I,entryStage:T,drawId:w}=h;a[f]||(a[f]=[]);let{participant:S,events:U}=(i==null?void 0:i[f])??{},P=BN({participant:S,eventType:g}),E=(v=U==null?void 0:U[m])==null?void 0:v.ranking;I===C4&&r.push(f),a[f].push({participantType:S==null?void 0:S.participantType,participantId:f,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:I,entryStage:T,...P,ranking:E,mainSeeding:b,qualifyingSeeding:y})};for(let f of t.events??[]){let h={},m=S=>{h[S]||(h[S]={count:0}),h[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=f,b=g.flatMap(S=>{let{drawId:U,entries:P}=S;l+=1;let E=({stage:M,stageSequence:A})=>M===at&&A===1||M===vt,D=(S.structures??[]).filter(E).flatMap(({positionAssignments:M})=>M).filter(Boolean).map(({participantId:M})=>M),R=({participantId:M})=>D.includes(M),N=M=>{var A,_,k,B,F,x,$,j;let{participantId:V,entryStatus:H,entryStage:z}=M;m(H);let q=(B=(k=(_=(A=i==null?void 0:i[V])==null?void 0:A.draws)==null?void 0:_[U])==null?void 0:k.seedAssignments)==null?void 0:B[at];return{qualifyingSeeding:(j=($=(x=(F=i==null?void 0:i[V])==null?void 0:F.draws)==null?void 0:x[U])==null?void 0:$.seedAssignments)==null?void 0:j[vt],participantId:V,mainSeeding:q,entryStatus:H,entryStage:z,drawId:U}};return P==null?void 0:P.filter(R).map(N)}),I=S=>{var U;let P=S.participantId,E=(U=i==null?void 0:i[P].participant.individualParticipantIds)==null?void 0:U.filter(D=>n.includes(D));return P&&{[P]:{individualParticipantIds:E}}};v===vh?(()=>{let S=Object.assign({},...b.map(I).filter(Boolean)),U=P=>{S[P.participantId].individualParticipantIds.forEach(E=>{u({id:E,eventType:v,eventId:y,entry:P})})};b.forEach(U)})():b.forEach(S=>{u({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let T=Object.values(h).reduce((S,U)=>S+U.count,0);Object.keys(h).forEach(S=>{h[S].pct=h[S].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:h};let w=Object.assign({},...au.flatMap(S=>{var U,P;return[{[S+"_count"]:(U=h[S])==null?void 0:U.count},{[S+"_pct"]:(P=h[S])==null?void 0:P.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let c=Object.values(i??{}).filter(({participant:{participantType:f,participantRole:h}})=>f===ti&&h===Sa),d=c.filter(({participant:f})=>!n.includes(f.participantId)).map(({participant:f})=>f.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:c.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function hWe({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=h=>{let m=h==null?void 0:h.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===n).reduce((h,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>BN({participant:h,eventType:t})).filter(({wtnRating:h})=>h),u=(s.length-l.length)/s.length*100,c=l.reduce((h,m)=>{let{wtnRating:g,confidence:v}=m;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?c.totalWTN/l.length:0,p=l!=null&&l.length?c.totalConfidence/l.length:0,f=Object.values(r).reduce((h,m)=>h+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:f,avgConfidence:p,pctNoRating:u,avgWTN:d}}function mWe({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var n;if(!i)return{error:bw};let r={},a=Object.assign({},...(e??[]).map(({name:c,label:d,accessor:p})=>{var f,h,m;let g=(h=(f=qt({element:i,name:c}))==null?void 0:f.extension)==null?void 0:h.value,v=p?(m=Ov({element:g,accessor:p}))==null?void 0:m.value:g;return{[d||c]:v}})),o=i==null?void 0:i.tournamentId,s=Xr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=c=>{var d,p,f;return(f=(p=(d=Lc({itemType:fW,itemSubTypes:[sd],element:{timeItems:c}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:f.scaleBasis},u=(n=i==null?void 0:i.events)==null?void 0:n.flatMap(({timeItems:c,drawDefinitions:d=[],extensions:p,eventType:f,eventId:h,category:m})=>{var g,v,y,b,I;let T=(y=(v=(g=p==null?void 0:p.find(D=>D.name===zl))==null?void 0:g.value)==null?void 0:v.flights)==null?void 0:y.map(D=>({[D.drawId]:D.flightNumber})),w=T&&Object.assign({},...T),S=((I=(b=p==null?void 0:p.find(D=>D.name===mN))==null?void 0:b.value)==null?void 0:I.length)||0,U=Object.values(w),P=w&&Math.min(...U),E=l(c);return r[h]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,seedingBasis:E?JSON.stringify(E):void 0,tournamentId:o,eventId:h},d.filter(D=>!t||!T||w[D.drawId]===P).flatMap(D=>{let{matchUpFormat:R,tieFormat:N,timeItems:M,extensions:A,structures:_,drawType:k,drawId:B}=D,{matchUpFormatCounts:F,matchUpsCount:x,avgConfidence:$,pctNoRating:j,avgWTN:V}=hWe({eventType:f,matchUps:s,drawId:B}),H=l(M)||E,z=gWe({extensions:A}),q=(z==null?void 0:z.length)||0;return r[h].totalPositionManipulations+=q,r[h].generatedDrawsCount+=1,q>r[h].maxPositionManipulations&&(r[h].maxPositionManipulations=q),_==null?void 0:_.filter(W=>W.stageSequence===1&&[vt,at,ha,An].includes(W.stage)).map(W=>{var Y,Z,X;let Q=[at,An].includes(W.stage)?s.find(ve=>ve.structureId===W.structureId&&ve.finishingRound===1&&ve.winningSide):void 0,ce=(Z=(Y=Q==null?void 0:Q.sides)==null?void 0:Y.find(ve=>ve.sideNumber===Q.winningSide))==null?void 0:Z.participant,J=(ce==null?void 0:ce.participantType)===Ws&&ce.participantId,ee=(ce==null?void 0:ce.participantType)===xt?ce.individualParticipants:[],ne=BN({participant:(ee==null?void 0:ee[0])||ce,eventType:f}),{personId:ie,personOtherId:oe,tennisId:se,confidence:pe,wtnRating:fe}=ne||{},ge=BN({participant:ee==null?void 0:ee[1],eventType:f}),{personId:me,personOtherId:Ee,tennisId:Be,confidence:Pe,wtnRating:et}=ge||{},{ageCategoryCode:Ie,categoryName:Ne,subType:be}=m??{},Le=W.matchUpFormat||R,Me=(F[Le]||0)/x*100,{tieFormatName:Ze,tieFormatDesc:qe}=kN(N),{tieFormatName:ye,tieFormatDesc:_e}=kN(W.tieFormat),Ae=qe===_e,Ve=!Ae&&ye,Ke=W.tieFormat&&!Ae&&_e,he=((X=z==null?void 0:z.filter(ve=>ve.structureId===W.structureId))==null?void 0:X.length)||0;return{...a,tournamentId:o,eventId:h,structureId:W.structureId,drawId:B,eventType:f,category:be,categoryName:Ne,ageCategoryCode:Ie,flightNumber:w[B],drawType:k,stage:W.stage,seedingBasis:H?JSON.stringify(H):void 0,winningPersonId:ie,winningPersonOtherId:oe,winningPersonTennisId:se,winningPersonWTNrating:fe,winningPersonWTNconfidence:pe,winningPerson2Id:me,winningPerson2OtherId:Ee,winningPerson2TennisId:Be,winningPerson2WTNrating:et,winningPerson2WTNconfidence:Pe,winningTeamId:J,positionManipulations:he,pctNoRating:j,matchUpFormat:Le,pctInitialMatchUpFormat:Me,matchUpsCount:x,drawTieFormatName:Ze,drawTieFormatDesc:qe,tieFormatName:Ve,tieFormatDesc:Ke,avgConfidence:$,avgWTN:V}})})});return{eventStructureReports:Object.values(r),structureReports:u}}function gWe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===hN))==null?void 0:e.value)==null?void 0:i.slice(1)}function vWe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,o;if(!Array.isArray(r))return{error:Se,dates:r};if(!Array.isArray(n))return{error:Se,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Rn};if(!r.every(hs))return{error:Qa};let s=pf({tournamentRecords:e,ignoreDisabled:t,dates:r});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),u=(o=s.courts)==null?void 0:o.reduce((p,f)=>{var h;return(h=f.dateAvailability)==null||h.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),c={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Vu({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:c});return{venuesReport:l==null?void 0:l.map(p=>yWe(u,p,d))}}function yWe(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var l;let u=0,c=0,d=0;for(let h of r){let m=h.dateAvailability.find(v=>v.date===s),g=(l=m&&SS({courtDate:m}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=ui(I)-ui(b);return v+T},0);g&&(d+=1),u+=g}let p=i.filter(({schedule:h})=>h.venueId===n&&Cd(s,h.scheduledDate));p.forEach(({schedule:h})=>{let m=an(h.scheduledTime),g=Do(m,h.averageMinutes),v=ui(g)-ui(m);c+=v});let f=u?(c/u*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:u,scheduledMinutes:c,percentUtilization:f}}),{venueId:n,venueName:a,venueReport:o}}var Hbe={};Yt(Hbe,{addMatchUpCourtOrder:()=>V5,addMatchUpEndTime:()=>G5,addMatchUpOfficial:()=>Rye,addMatchUpResumeTime:()=>z5,addMatchUpScheduleItems:()=>vx,addMatchUpScheduledDate:()=>yx,addMatchUpScheduledTime:()=>Wh,addMatchUpStartTime:()=>j5,addMatchUpStopTime:()=>H5,addSchedulingProfileRound:()=>n6,allocateTeamMatchUpCourts:()=>gx,assignMatchUpCourt:()=>Nb,assignMatchUpVenue:()=>US,bulkRescheduleMatchUps:()=>Jbe,bulkScheduleMatchUps:()=>SE,bulkScheduleTournamentMatchUps:()=>c1,bulkUpdateCourtAssignments:()=>Kbe,calculateScheduleTimes:()=>o6,clearMatchUpSchedule:()=>eIe,clearScheduledMatchUps:()=>Ix,courtGridRows:()=>h5,findMatchUpFormatTiming:()=>XO,findVenue:()=>lf,generateBookings:()=>bx,generateVirtualCourts:()=>dx,getPersonRequests:()=>qg,getProfileRounds:()=>QO,getScheduledRoundsDetails:()=>dE,getSchedulingProfile:()=>ff,getSchedulingProfileIssues:()=>l5,matchUpScheduleChange:()=>Qbe,modifyMatchUpFormatTiming:()=>E5,mutate:()=>zbe,proAutoSchedule:()=>Wbe,proConflicts:()=>Zbe,publicFindCourt:()=>_fe,query:()=>Mve,removeEventMatchUpFormatTiming:()=>sx,removeMatchUpCourtAssignment:()=>qbe,reorderUpcomingMatchUps:()=>Xbe,scheduleMatchUps:()=>Ybe,scheduleProfileRounds:()=>wx,setMatchUpDailyLimits:()=>tIe,setSchedulingProfile:()=>bS,toggleParticipantCheckInState:()=>fx,validateSchedulingProfile:()=>JO});var zbe={};Yt(zbe,{addMatchUpCourtOrder:()=>V5,addMatchUpEndTime:()=>G5,addMatchUpOfficial:()=>Rye,addMatchUpResumeTime:()=>z5,addMatchUpScheduleItems:()=>vx,addMatchUpScheduledDate:()=>yx,addMatchUpScheduledTime:()=>Wh,addMatchUpStartTime:()=>j5,addMatchUpStopTime:()=>H5,addSchedulingProfileRound:()=>n6,allocateTeamMatchUpCourts:()=>gx,assignMatchUpCourt:()=>Nb,assignMatchUpVenue:()=>US,bulkRescheduleMatchUps:()=>Jbe,bulkScheduleMatchUps:()=>SE,bulkScheduleTournamentMatchUps:()=>c1,bulkUpdateCourtAssignments:()=>Kbe,calculateScheduleTimes:()=>o6,clearMatchUpSchedule:()=>eIe,clearScheduledMatchUps:()=>Ix,courtGridRows:()=>h5,findMatchUpFormatTiming:()=>XO,findVenue:()=>lf,generateBookings:()=>bx,generateVirtualCourts:()=>dx,matchUpScheduleChange:()=>Qbe,modifyMatchUpFormatTiming:()=>E5,proAutoSchedule:()=>Wbe,proConflicts:()=>Zbe,publicFindCourt:()=>_fe,removeEventMatchUpFormatTiming:()=>sx,removeMatchUpCourtAssignment:()=>qbe,reorderUpcomingMatchUps:()=>Xbe,scheduleMatchUps:()=>Ybe,scheduleProfileRounds:()=>wx,setMatchUpDailyLimits:()=>tIe,setSchedulingProfile:()=>bS,toggleParticipantCheckInState:()=>fx,validateSchedulingProfile:()=>JO});function o6({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:c}){if(typeof a!="object"||!Object.keys(a).length)return{error:Rn};o=o??px({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=pf({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),f=d==null?void 0:d.filter(E=>!u||u.includes(E.venueId));l||(l=f==null?void 0:f.reduce((E,D)=>{var R,N;let M=((N=(R=D.dateAvailability)==null?void 0:R.find(A=>!A.date||Cd(s,A.date)))==null?void 0:N.startTime)??D.startTime;return M&&(!E||ui(M)<ui(E))?M:E},void 0)),c||(c=f==null?void 0:f.reduce((E,D)=>{var R,N;let M=((N=(R=D.dateAvailability)==null?void 0:R.find(A=>!A.date||Cd(s,A.date)))==null?void 0:N.endTime)??D.endTime;return M&&(!E||ui(M)>ui(E))?M:E},void 0));let h=Object.values(a),m=Object.assign({},...h.map(E=>(E.events??[]).map(D=>{let{scheduleTiming:R}=xP({tournamentRecord:E,event:D});return{[D.eventId]:{event:D,scheduleTiming:R}}})).flat()),g=hE({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:E,schedule:D,matchUpFormat:R})=>{let{event:N,scheduleTiming:M}=m[E],A=N==null?void 0:N.eventType,_={...M,defaultTiming:I,matchUpFormat:R},{averageMinutes:k,recoveryMinutes:B}=hO({eventType:A,timingDetails:_}),{courtId:F,venueId:x}=D,$=an(D.scheduledTime),j=Do($,k);return{recoveryMinutes:B,averageMinutes:k,periodLength:o,startTime:$,endTime:j,courtId:F,venueId:x}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:c,bookings:T,courts:f},{scheduleTimes:S}=O5(w),U=(u==null?void 0:u.length)===1&&u[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=b.map(Ar);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:P}}function qbe(t){var e;let i=wi(t,[{[Ea]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=t,c=r[a];if(!c)return{error:Oe};let{drawDefinition:d,event:p}=qh({tournamentRecord:c,drawId:u});if(!d)return{error:nt};let f=on({drawDefinition:d,event:p,matchUpId:s});if(f.error)return f;if(((e=f==null?void 0:f.matchUp)==null?void 0:e.matchUpType)===Tc){let{itemValue:h}=Vg({timeItems:f.matchUp.timeItems??[],itemType:Lp}),m=l&&h.filter(g=>g.courtId!==l);return bs({duplicateValues:!1,removePriorValues:n,tournamentRecord:c,drawDefinition:d,matchUpId:s,timeItem:{itemType:Lp,itemValue:m}})}else return Nb({tournamentRecord:c,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function Wbe({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!pl(n))return{error:Se};if(n.some(({hasContext:f})=>!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Gk};let r=hE({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=f=>[(f.sides||[]).map(h=>{var m;return[h.participantId,(m=h.participant)==null?void 0:m.individualParticipantIds]}),(f.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((f,h)=>{let m=[],g=[];Object.values(h).forEach(y=>{if(ln(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let b=s(y);g.push(...b)}});let v=Object.values(h).filter(y=>ln(y)&&!y.matchUpId);return f.concat({matchUpIds:m,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:f})=>f&&f!==Di&&(t||!kr.includes(f))).sort(wb);let u=su({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,c=[],d=[];for(;n.length&&l.length;){let f=l.shift(),h=[];for(;n.length&&f.availableCourts.length;){let m=n.concat(h).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&u[v].matchUpIds.concat(u[v].dependentMatchUpIds),b=v&&m.some(U=>u[v].matchUpIds.includes(U)),I=v&&d.some(U=>u[v].dependentMatchUpIds.includes(U)),T=f.matchUpIds.some(U=>y.includes(U)),w=s(g),S=f.participantIds.some(U=>w.includes(U));if(g&&!T&&!b&&!S&&!I){let U=f.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),c.push(g),f.participantIds.push(...w),f.matchUpIds.push(v)}else g&&h.push(g)}n.push(...h),d.push(...f.matchUpIds)}let p=c.map(({matchUpId:f,tournamentId:h,schedule:m,drawId:g})=>({tournamentId:h,matchUpId:f,drawId:g,schedule:{...m,scheduledDate:i}}));return r=SE({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:c,notScheduled:n}}function Kbe(t){let{courtDayDate:e}=t,i=wi(t,[{courtAssignments:!0,[Vh]:Fo,[Pd]:dt},{[Ea]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[Ea][a];if(!o)return r={error:Oe},!1;let s=n[a].reduce((l,u)=>{let{drawId:c}=u;return l[c]||(l[c]=[]),l[c].push(u),l},{});Object.keys(s).every(l=>{let{drawDefinition:u}=vo({tournamentRecord:o,drawId:l});return u?(s[l].every(c=>{let{matchUpId:d,courtId:p}=c,f=Nb({tournamentRecord:o,drawDefinition:u,courtDayDate:e,matchUpId:d,courtId:p});if(f.success)return f==null?void 0:f.success;r={error:Vde}}),!0):(r={error:nt},!1)})}),r||ae}function Ybe(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:c=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:f=30,scheduleDate:h,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=wi(t,[{[Ea]:!0,[gP]:!0},{[wu]:hs,[Pd]:Qa,[OBe]:!0},{[wu]:z=>!z||!isNaN(z),[BBe]:!1,[Pd]:Se,[$Be]:!1,[VBe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??Vu({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??su({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(z=>{var q;(q=z.schedule)!=null&&q.scheduledDate&&Cd(h,Bt(z.schedule.scheduledDate))&&jw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:z})});let S=m.map(z=>T.find(q=>q.matchUpId===z)).filter(Boolean),{venueId:U,scheduleTimes:P,dateScheduledMatchUpIds:E}=o6({tournamentRecords:e,remainingScheduleTimes:d,startTime:an(v),endTime:an(y),scheduleDate:Bt(h),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:f,venueIds:g}),D={},R=[],N={},M={},A={};T.filter(({matchUpId:z})=>E==null?void 0:E.includes(z)).forEach(z=>{var q;v$({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:z,value:1});let W=(q=z.schedule)==null?void 0:q.scheduledTime;if(W){N[z.matchUpId]=W;let Y=a==null?void 0:a[z.matchUpId];u1({recoveryMinutes:Y||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:W,matchUp:z})}});let _=S.filter(z=>{let q=E==null?void 0:E.includes(z.matchUpId),W=[Di,bi,Zn,vs,xa,Ni].includes(z==null?void 0:z.matchUpStatus);return!q&&!z.winningSide&&!W}),{matchUpMap:k,overLimitMatchUpIds:B,participantIdsAtLimit:F}=_.reduce((z,q)=>{let{drawId:W,tournamentId:Y,matchUpType:Z}=q,{participantIdsAtLimit:X,relevantParticipantIds:Q}=e6({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:q});return X!=null&&X.length?(z.overLimitMatchUpIds.push(q.matchUpId),z.participantIdsAtLimit.push(...X),z):(Q.forEach(ce=>{IE({individualParticipantProfiles:s,participantId:ce});let J=s[ce].counters;J[Z]?J[Z]+=1:J[Z]=1,J[Ll]?J[Ll]+=1:J[Ll]=1}),z.matchUpMap[Y]||(z.matchUpMap[Y]={}),z.matchUpMap[Y][W]?z.matchUpMap[Y][W].push(q):z.matchUpMap[Y][W]=[q],jw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:q}),z)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:z})=>!B.includes(z));let x=0,$=(P==null?void 0:P.length)??0,{personRequests:j}=qg({tournamentRecords:e,requestType:wE});for(;P!=null&&P.length&&_.length&&x<=$;){x++;let{scheduleTime:z}=P.shift(),q=_.find(W=>{let{matchUpId:Y}=W,{dependenciesScheduled:Z,remainingDependencies:X}=X5({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:W});if(!Z)return A[Y]||(A[Y]=[]),A[Y].push({scheduleTime:z,remainingDependencies:X}),!1;let{enoughTime:Q}=Q5({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:z,matchUp:W});if(!Q)return M[Y]||(M[Y]=[]),M[Y].push({scheduleTime:z}),!1;let{conflicts:ce}=J5({potentials:c,averageMatchUpMinutes:n,requestConflicts:D,personRequests:j,scheduleTime:z,scheduleDate:h,matchUp:W});if(ce!=null&&ce.length)return!1;let J=a==null?void 0:a[W.matchUpId];return u1({recoveryMinutes:J||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:z,matchUp:W}),N[W.matchUpId]=z,!0});_=_.filter(({matchUpId:W})=>W!==(q==null?void 0:q.matchUpId)),q||R.push(z)}_.forEach(z=>{v$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:z})});let V=[];Object.keys(k).forEach(z=>{let q=e[z];q&&Object.keys(k[z]).forEach(W=>{let{drawDefinition:Y}=qh({tournamentRecord:q,drawId:W});Y&&k[z][W].forEach(({matchUpId:Z})=>{let X=N[Z];if(X){let Q=X.split(":").map(Bs).join(":"),ce=`${Bt(h)}T${Q}`;b?V.push(Z):(Wh({drawDefinition:Y,matchUpId:Z,scheduledTime:ce}).success&&V.push(Z),U&&US({tournamentRecords:e,tournamentRecord:q,drawDefinition:Y,matchUpId:Z,venueId:U}))}})})});let H=nW(_);return{...ae,requestConflicts:Object.values(D),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:z})=>z),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:B,scheduledMatchUpIds:V,noTimeMatchUpIds:H,recoveryTimeDeferred:M,dependencyDeferred:A}}function Zbe({tournamentRecords:t,matchUps:e}){if(!pl(e))return{error:Ld};if(e.some(({matchUpId:f,hasContext:h})=>f&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Gk};let i=Math.max(...e.map(({schedule:f})=>(f==null?void 0:f.courtOrder)||1).map(f=>Tt(f))),n=Je(1,i+1).map(f=>e.filter(h=>{var m;return Tt((m=h.schedule)==null?void 0:m.courtOrder)===f})),r={},a={},o={};n.flat().filter(Boolean).sort(wb).forEach(({schedule:f})=>delete f[ER]);let s=Ht(e.map(({drawId:f})=>f)),l=su({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,u=n.map((f,h)=>f.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:w}=g,S=I==null?void 0:I.courtId;r[v]=h,a[S]=[],m.matchUpIds.push(v),o[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let P=(T==null?void 0:T.map(D=>{var R;return[(R=D.participant)==null?void 0:R.individualParticipantIds,D.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:D,participantId:R})=>[D,R]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...P),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=(f,h)=>l[f].sources.reduce((m,g,v)=>g.includes(h)&&v+1||m,0),d=u.map(()=>[]),p=(f,h,m,g)=>{if(!o[f].schedule[ER]){o[f].schedule[ER]=h,o[f].schedule[Rfe]=g,d[r[f]].push({matchUpId:f,issueType:m,issueIds:g,issue:h});let v=o[f].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:f,issue:h,issueType:m,issueIds:g})}};return u.forEach((f,h)=>{let m=h?u[h-1]:void 0,g=u.slice(h+1),v={},y=ts(f.participantIds),b=Object.keys(y).filter(w=>y[w]>1),I=f.matchUpIds.filter(w=>l[w].participantIds.some(S=>b.includes(S)));I.forEach(w=>{v[w]||(v[w]={}),v[w][pm]||(v[w][pm]=I.filter(S=>S!==w))});let T=m&&f.participantIds.filter(w=>m.participantIds.includes(w));T&&T.forEach(w=>{let S=f.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][fm]||(v[U][fm]=S.filter(P=>P!==U))})}),f.matchUpIds.forEach(w=>{var S,U,P,E;let D=l[w].matchUpIds;for(let N of g){let M=N.matchUpIds.filter(A=>D.includes(A));M!=null&&M.length&&(M.forEach(A=>p(A,$B,Af,[w])),p(w,$B,Af,M))}if((S=v[w])!=null&&S[pm]&&p(w,pm,BB,v[w][pm]),f.sourceMatchUpIds.includes(w)){let N=f.matchUpIds.filter(M=>l[M].matchUpIds.includes(w));p(w,pm,Af,N),f.matchUpIds.filter(M=>l[M].matchUpIds.includes(w)).forEach(M=>p(M,pm,Af,[w]))}let R=(U=m==null?void 0:m.matchUpIds)==null?void 0:U.filter(N=>c(w,N)>1);if(R!=null&&R.length&&(p(w,VB,Af,R),R.forEach(N=>p(N,VB,Af,[w]))),(P=v[w])!=null&&P[fm]&&p(w,fm,BB,v[w][fm]),(E=m==null?void 0:m.targetMatchUpIds)==null?void 0:E.includes(w)){let N=o[w].schedule.courtId,M=D.filter(A=>m.matchUpIds.includes(A));M.some(A=>o[A].schedule.courtId===N)||(M.forEach(A=>p(A,fm,Af,[w])),p(w,fm,Af,M))}})}),{courtIssues:a,rowIssues:d}}function Xbe(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ue({result:{error:Rn},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return ue({result:{error:dt},stack:e});let a=n==null?void 0:n.length;if(!a)return{...ae};let o=0;return n.forEach((l,u)=>{let{tournamentId:c,drawId:d,matchUpId:p}=l,f=u+(r?-1:1);f<0&&(f=a-1),f===a&&(f=0);let h=n[f].schedule.scheduledTime,m=s({tournamentId:c,scheduledTime:h,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?ae:ue({result:{error:$de},stack:e});function s({tournamentId:l,scheduledTime:u,matchUpId:c,drawId:d}){let p=i[l],{drawDefinition:f}=qh({tournamentRecord:p,drawId:d});return f?Wh({drawDefinition:f,scheduledTime:u,matchUpId:c}):{error:Qo}}}function Jbe(t){var e,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=t;if(!r||!Array.isArray(r))return{error:K0};if(typeof n!="object")return{error:Se};let o=xc(t),s=[],l=[];for(let c of Object.values(o)){let d=bWe({tournamentRecord:c,scheduleChange:n,matchUpIds:r,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=nW(d.notRescheduled),f=[];(e=d.rescheduled)==null||e.forEach(h=>{let{matchUpId:m}=h;p.includes(m)&&f.push(m),s.push(h)}),f.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:h})=>!f.includes(h)))||[])}let u=!!(s.length&&!l.length);return{...ae,rescheduled:s,notRescheduled:l,allRescheduled:u}}function bWe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var r;if(!t)return{error:Oe};if(!i||!Array.isArray(i))return{error:K0};if(typeof e!="object")return{error:Se};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...ae};if(s&&isNaN(s))return{error:Se};if(l&&isNaN(l))return{error:Se};let{matchUps:u}=Xr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:T})=>!kr.includes(T),d=u==null?void 0:u.filter(T=>fE({schedule:T.schedule})).filter(T=>c({matchUpStatus:T.matchUpStatus}));if(!(d!=null&&d.length))return{...ae};let{tournamentInfo:p}=Rb({tournamentRecord:t}),{startDate:f,endDate:h}=p,m=d==null?void 0:d.reduce((T,w)=>{let{matchUpId:S,drawId:U}=w;return T[U]?T[U].push(S):T[U]=[S],T},{}),g=1440;for(let T of Object.keys(m)){let w=qh({tournamentRecord:t,drawId:T});if(w.error)return w;let S=w.drawDefinition,U=m[T].filter(P=>i.includes(P));for(let P of U)if(P&&S){let E=(r=d.find(_=>_.matchUpId===P))==null?void 0:r.schedule,{scheduledTime:D,scheduledDate:R}=E,N,M,A;if(!N&&l&&R){let _=Bt(R);A=lT(_,l),N=new Date(A)<new Date(f)||new Date(A)>new Date(h)}if(s&&D){let _=Bt(D),k=ui(an(D))+s;if(N=k<0||k>g,!N){let B=Do(D,s),F=_&&A||R===_&&_;M=F?`${F}T${B}`:B}}if(N)o.push(P);else{if(!n){if(M){let _=Wh({scheduledTime:M,drawDefinition:S,matchUpId:P});if(_.error)return _}if(A){let _=yx({scheduledDate:A,drawDefinition:S,matchUpId:P});if(_.error)return _}}(M||A)&&a.push(P)}}}let v=Xr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:T})=>a.includes(T)),b=v.filter(({matchUpId:T})=>o.includes(T)),I=y.length&&!b.length;return{...ae,rescheduled:y,notRescheduled:b,allRescheduled:I}}function Qbe(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Rn};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:u,tournamentId:c}=n||{},{drawId:d,matchUpId:p,tournamentId:f}=r||{};if(!u&&!p)return ue({result:{error:dt},stack:e});let{matchUps:h}=Vu({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=h==null?void 0:h.find(({matchUpId:I})=>I===u),g=h==null?void 0:h.find(({matchUpId:I})=>I===p),v=0;if(o&&u&&!p){let I=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I!=null&&I.success&&v++,I.error)return ue({result:I,stack:e})}else if(a&&o&&u&&p){let I=y({tournamentId:c,matchUpId:u,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(I.success&&v++,I.error)return ue({result:I,stack:e,info:"source"});let T=y({tournamentId:f,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(T.success&&v++,T.error)return ue({result:T,stack:e,info:"target"})}else return{error:dt};return v?ae:ue({result:{error:J0},stack:e});function y(I){let{tournamentRecords:T,tournamentId:w,matchUp:S,drawId:U}=I,P=T[w],{drawDefinition:E}=qh({tournamentRecord:P,drawId:U});return S.matchUpType===Xi?b({...I,tournamentRecord:P,drawDefinition:E}):Nb({...I,tournamentRecord:P,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:P,matchUpId:E,matchUp:D,courtId:R}){let N=[R].concat(D.schedule.allocatedCourts.map(({courtId:M})=>M).filter(M=>M!==U));return gx({removePriorValues:I,tournamentRecords:T,tournamentRecord:w,drawDefinition:S,courtDayDate:P,matchUpId:E,courtIds:N})}}function eIe({scheduleAttributes:t=[Lp,rg,uS,cS,dS,Tu,Fp,ld,dp],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,a;let o="clearMatchUpSchedule",s=i?(r=po({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(a=Xr({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:Da};let l=(s.timeItems??[]).filter(u=>(u==null?void 0:u.itemType)&&!t.includes(u==null?void 0:u.itemType));return s.timeItems=l,di({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...ae}}function tIe(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Rn};if(typeof n!="object")return{error:rf};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:Se};for(let o of a){let s=r[o],l=hi({element:s,extension:{name:IP,value:{dailyLimits:n}}});if(l.error)return l}return{...ae}}var iIe={};Yt(iIe,{addCollectionDefinition:()=>u6,addCollectionGroup:()=>lIe,aggregateTieFormats:()=>cIe,compareTieFormats:()=>Bp,getTieFormat:()=>a5,modifyCollectionDefinition:()=>s6,modifyTieFormat:()=>uIe,mutate:()=>nIe,orderCollectionDefinitions:()=>oIe,query:()=>Uve,removeCollectionDefinition:()=>l6,removeCollectionGroup:()=>aIe,tieFormatGenderValidityCheck:()=>CO,validateCollectionDefinition:()=>rE});var nIe={};Yt(nIe,{addCollectionDefinition:()=>u6,addCollectionGroup:()=>lIe,aggregateTieFormats:()=>cIe,modifyCollectionDefinition:()=>s6,modifyTieFormat:()=>uIe,orderCollectionDefinitions:()=>oIe,removeCollectionDefinition:()=>l6,removeCollectionGroup:()=>aIe});function dg({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var s;let l="getTieFormat",u;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:nt};if(a&&o)u=Of(o);else if(i){if(t&&(!r||!n)){let c=on({drawDefinition:t,matchUpId:i});if(c.error)return c;if(((s=c.matchUp)==null?void 0:s.matchUpType)!==Tc)return ue({result:{error:go},stack:l});n||(n=c.structure),r||(r=c.matchUp)}u=FT({item:r,drawDefinition:t,structure:n,event:o})||FT({item:n,drawDefinition:t,structure:n,event:o})||Of(t)||Of(o)}else if(t&&e){if(!n){let c=Pt({drawDefinition:t,structureId:e});if(c.error)return c;n=c==null?void 0:c.structure}u=FT({item:n,drawDefinition:t,structure:n,event:o})||Of(t)||Of(o)}else u=Of(t)||Of(o);return u?{...ae,structure:n,tieFormat:u,matchUp:r}:ue({result:{error:dP},stack:l})}function $N({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![kr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==nu&&!Jr(t))}function cF({from:t,to:e}){let i=Object.keys(t),n=$n(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function IWe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var u,c,d,p;let f="updateTieFormat",h=e==null?void 0:e.tournamentId,m=0,g=0,v=0,y=0,b=r==null?void 0:r.collectionDefinitions.reduce((E,D)=>(E[D.collectionId]=(E[D.collectionId]||0)+D.matchUpCount,E),{}),I=({tieFormat:E})=>{let D=E==null?void 0:E.collectionDefinitions.reduce((R,N)=>(R[N.collectionId]=(R[N.collectionId]||0)+N.matchUpCount,R),{});return cF({from:D,to:b}).equivalent},T=(u=dg({drawDefinition:i}))==null?void 0:u.tieFormat,w=(c=dg({event:s}))==null?void 0:c.tieFormat;if(s&&a){for(let E of s.drawDefinitions??[])S({drawDefinition:E});s.tieFormat=aa(r),y+=1}else if(o){if(!o.tieMatchUps)return ue({result:{error:go},stack:f});let E=ts((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:A})=>A)),D=cF({to:b,from:E}),{changes:R,changesArePossible:N,cannotChangeReaon:M}=oY({matchUp:o,check:D});if(D.equivalent)if($N({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=aa(r),y+=1;else return ue({result:{error:Iq},info:"matchUp is IN_PROGRESS or COMPLETE",stack:f});else if(N)P({tieFormat:r,matchUp:o,changes:R,uuids:l});else return ue({context:{collectionMap:b,matchUpMap:E},result:{error:Jd},info:M||"specified changes not possible",stack:f});g+=1,di({eventId:s==null?void 0:s.eventId,context:f,drawDefinition:i,tournamentId:h,matchUp:o})}else if(n){let E=(p=U({inheritedTieFormat:T??w,structure:n}))==null?void 0:p.modifiedMatchUpsCount;E&&(g+=E,m+=1,y+=1);let D=!n.tieFormat||Bp({ancestor:n.tieFormat,descendant:r}).different;D&&(n.tieFormat=aa(r),m+=1,y+=1),(E||D)&&i&&Qi({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)S({drawDefinition:i}),i.tieFormat=aa(r),y+=1;else return{error:nt};return{modifiedStructuresCount:m,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...ae,tieFormat:r};function S({drawDefinition:E}){var D;let R=E.structures||[],N=[];for(let M of R){if(M.tieFormat)continue;let A=(D=U({inheritedTieFormat:w,structure:M}))==null?void 0:D.modifiedMatchUpsCount;if(A){m+=1,g+=A;let _=M.structureId;N.push(_)}}return Qi({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:E}),N.length}function U({inheritedTieFormat:E,structure:D}){var R,N;let M=0,A=((R=Ci({matchUpFilters:{matchUpTypes:[Xi]},structure:D}))==null?void 0:R.matchUps)||[];for(let _ of A){let k=$N({matchUp:_,updateInProgressMatchUps:t}),B=!1,F=ts((N=_.tieMatchUps)==null?void 0:N.map(({collectionId:$})=>$)),x=cF({from:F,to:b});if(x.equivalent)_.tieFormat&&I(_)&&k&&(_.tieFormat=aa(r),B=!0);else{let{changes:$,changesArePossible:j}=oY({matchUp:_,check:x});if(j&&!_.tieFormat)P({changes:$,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||Bp({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,B=!0);else return ue({result:{error:dP},stack:f})}B&&(M+=1,di({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:f,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:M}}function P({uuids:E,matchUp:D,tieFormat:R,changes:N}){D.tieFormat=aa(R);let M=[],A=[];return N.forEach(_=>{if(_.countChange>0){let k=Math.max(0,...D.tieMatchUps.filter(x=>x.collectionId===_.collectionId).map(is("collectionPosition"))),B=R.collectionDefinitions.find(x=>x.collectionId===_.collectionId),F=tE({matchUpsLimit:_.countChange,collectionPositionOffset:k,collectionDefinition:B,matchUp:D,uuids:E});A.push(...ut(F,!1,!0)),v+=A.length,D.tieMatchUps.push(...F)}else{let k=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",k.length),M.push(...k),D.tieMatchUps=D.tieMatchUps.filter(({matchUpId:B})=>!k.includes(B))}}),A.length&&mh({matchUps:A,drawDefinition:i,tournamentId:h,eventId:a}),M.length&&of({matchUpIds:M,action:"updateTieFormat",drawDefinition:i,tournamentId:h,eventId:a}),{matchUpIdsRemoved:M,matchUpsAdded:A}}}function oY({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Vn).map(is("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function Ux({drawDefinition:t,auditData:e}){let{extension:i}=qt({name:fy,element:t}),n={name:fy,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};hi({element:t,extension:n})}function s6({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:c,matchUpId:d,category:p,eventId:f,gender:h,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){var T;let w="modifyCollectionDefinition";if(o&&!rs({matchUpFormat:o}))return ue({result:{error:Se},context:{matchUpFormat:o},stack:w});if(n&&typeof n!="string")return ue({result:{error:Se},context:{collectionName:n},stack:w});if(h&&!Object.values($W).includes(h))return ue({result:{error:Se},context:{gender:h},stack:w});if(p&&typeof p!="object")return ue({result:{error:Se},context:{category:p},stack:w});let S={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(S).filter(Boolean).length&&!i&&!n&&!o&&!s&&!u)return ue({result:{error:dt},stack:w});if(Object.values(S).filter(Boolean).length>1)return ue({info:"Only one value assignment allowed per collectionDefinition",result:{error:Se},stack:w});let U=dg({drawDefinition:a,structureId:c,matchUpId:d,eventId:f,event:m});if(U.error)return ue({result:U,stack:w});let{matchUp:P,structure:E,tieFormat:D}=U,R=aa(D),N=D==null?void 0:D.collectionDefinitions.find(H=>H.collectionId===l),M=R==null?void 0:R.collectionDefinitions.find(H=>H.collectionId===l);if(!N)return ue({info:"source collectionDefinition",result:{error:Pa},context:{collectionId:l},stack:w});let A=v??y??b??I;if(g){let H=ime({matchUpCount:s??(N==null?void 0:N.matchUpCount)??0,collectionValueProfiles:g});if(H.errors)return ue({result:{error:Se},info:H.errors,stack:w})}else if(A&&!At(A))return ue({result:{error:Se},info:"value is not an integer",context:{value:A},stack:w});let _=(H,z)=>$n(Object.keys(H),Object.keys(z)).length===Object.keys(H).length&&$n(Object.values(H),Object.values(z)).length===Object.values(H).length,k=g&&(!N.collectionValueProfiles||!_(N.collectionValueProfiles,g)),B=At(v)&&N.collectionValue!==v||At(y)&&N.matchUpValue!==y||At(b)&&N.scoreValue!==b||At(I)&&N.setValue!==I||k,F=[];if(B&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,S),F.push({collectionId:l,...ft(S)})),(At(b)||At(I))&&M.collectionGroupNumber){let H=M.collectionGroupNumber;R.collectionDefinitions=R.collectionDefinitions.map(z=>{let{collectionGroupNumber:q,...W}=z;return q===H?W:z}),R.collectionGroups=R.collectionGroups.filter(({groupNumber:z})=>z!==H),F.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:$}=Mb(R),j=ft({aggregateValue:x,valueGoal:$});if((j.aggregateValue!==(D==null?void 0:D.winCriteria.aggregateValue)||j.valueGoal!==(D==null?void 0:D.winCriteria.valueGoal))&&(R.winCriteria=j,F.push({collectionId:l,winCriteria:j})),At(i)&&N.collectionOrder!==i&&(M.collectionOrder=i,F.push({collectionId:l,collectionOrder:i})),n&&N.collectionName!==n&&(M.collectionName=n,F.push({collectionId:l,collectionName:n})),o&&N.matchUpFormat!==o&&(M.matchUpFormat=o,F.push({collectionId:l,matchUpFormat:o})),At(s)&&N.matchUpCount!==s&&(M.matchUpCount=s,F.push({collectionId:l,matchUpCount:s})),u&&N.matchUpType!==u)return ue({result:{error:qk},context:{matchUpType:u},stack:w});p&&N.category!==p&&(M.category=p,F.push({collectionId:l,category:p})),h&&N.gender!==h&&(M.gender=h,F.push({collectionId:l,gender:h}));let V=ft(R);if(U=Ao({tieFormat:V}),U.error)return ue({result:U,stack:w});if(!F.length)return ue({result:{...ae,modifications:F}});if((D==null?void 0:D.tieFormatName)!==r?(V.tieFormatName=r,F.push({tieFormatName:r})):F.length&&(delete V.tieFormatName,F.push("tieFormatName removed: modifications without new tieFormatName")),U=IWe({tieFormat:V,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:E,eventId:f,matchUp:P,event:m}),!U.error){let{appliedPolicies:H}=Ai({tournamentRecord:e});if((T=H==null?void 0:H.audit)!=null&&T[fy]){let z=ft({collectionDefinition:M,drawId:a==null?void 0:a.drawId,action:w,structureId:c,matchUpId:d,eventId:f});Ux({drawDefinition:a,auditData:z})}}return ue({result:{...U,modifications:F},stack:w})}function wWe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,s;let l=[];return r&&a?l=[a]:i&&n?l=((o=Ci({matchUpFilters:{matchUpTypes:[Xi]},structure:n}))==null?void 0:o.matchUps)??[]:e&&(l=((s=po({matchUpFilters:{matchUpTypes:[Xi]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(u=>!u.winningSide&&u.matchUpStatus!==Zn&&(t||u.matchUpStatus!==nu&&!Jr(u)))}}function SWe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=aa(r));let l;if(t){let u=Ai({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,c=df({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:u,drawDefinition:i,event:a});if(c.error)return c;l=c.score}s&&!l&&di({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...ae}}function rIe({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:c,eventId:d,event:p}){let{aggregateValue:f,valueGoal:h}=Mb(l);l.winCriteria=ft({aggregateValue:f,valueGoal:h}),(e&&e!==h||f&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=wWe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:c});SWe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=ft(l),v=Ao({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(u&&c)c.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!c||!a)return{error:nt};return Qi({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...ae}}function aIe({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){var c;if(!e)return{error:dt};if(isNaN(e))return{error:Se};let d="removeCollectionGroup",p=s?void 0:dg({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:u});if(p!=null&&p.error)return ue({result:p,stack:d});let f=p==null?void 0:p.structure;s=s??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,m=h==null?void 0:h.winCriteria.valueGoal,g=h==null?void 0:h.winCriteria.aggregateValue,v=aa(h);if(p=Ao({tieFormat:v}),p.error)return ue({result:p,stack:d});let y=[];if(v.collectionDefinitions=v.collectionDefinitions.map(b=>{let{collectionGroupNumber:I,...T}=b;return I!==e?b:(y.push(b.collectionId),T)}),v.collectionGroups=v.collectionGroups.filter(({groupNumber:b})=>b!==e),p=rIe({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:g,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:f,tieFormat:v,matchUpId:o,matchUp:s,eventId:l,event:u}),!p.error){let{appliedPolicies:b}=Ai({tournamentRecord:i});if((c=b==null?void 0:b.audit)!=null&&c[fy]){let I=ft({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:d,structureId:a,matchUpId:o,eventId:l});Ux({drawDefinition:n,auditData:I})}}return ue({result:{...p,modifiedCollectionIds:y},stack:d})}function Gw({tieFormat:t,orderMap:e}){let i=aa(t);return i.collectionDefinitions.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>Uw(n.collectionOrder)-Uw(r.collectionOrder)),i}function oIe({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>At(l)))return ue({result:{error:Se},context:{orderMap:r}});if(a&&s!=null&&s.tieFormat)sY({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&on({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:No};o!=null&&o.tieFormat&&(o.tieFormat=Gw({tieFormat:o.tieFormat,orderMap:r}),di({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=Pt({drawDefinition:e,structureId:i});if(l.error)return l;let u=l.structure;if(u!=null&&u.tieFormat)u.tieFormat=Gw({tieFormat:u.tieFormat,orderMap:r}),sIe({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:u,orderMap:r}),Qi({drawDefinition:e,structureIds:[u.structureId]});else if(e.tieFormat)I$({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)sY({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:Pa}}else if(e!=null&&e.tieFormat)I$({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:Pa};return{...ae}}function sY({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=Gw({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])I$({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function I$({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=Gw({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Gw({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),sIe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));Qi({drawDefinition:e,structureIds:s})}function sIe({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let o=(a=Ci({matchUpFilters:{matchUpTypes:[Xi]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=Gw({tieFormat:s.tieFormat,orderMap:n}),di({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function l6({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:c}){var d,p,f,h,m,g;let v="removeCollectionDefinition",y=u?void 0:dg({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:c});if(y!=null&&y.error)return ue({result:y,stack:v});let b=y==null?void 0:y.structure;u=u??(y==null?void 0:y.matchUp);let I=y==null?void 0:y.tieFormat,T=aa(I);if(y=Ao({tieFormat:T}),y.error)return ue({result:y,stack:v});let w=(d=T==null?void 0:T.collectionDefinitions)==null?void 0:d.find(_=>_.collectionId===a);if(!w)return ue({result:{error:Pa,collectionId:a}});T.collectionDefinitions=T.collectionDefinitions.filter(_=>_.collectionId!==a),w.collectionGroupNumber&&(T.collectionDefinitions=T.collectionDefinitions.map(_=>{let{collectionGroupNumber:k,...B}=_;return B}),T.collectionGroups=T.collectionGroups.filter(({groupNumber:_})=>_!==w.collectionGroupNumber));let{aggregateValue:S,valueGoal:U}=Mb(T);T.winCriteria=ft({aggregateValue:S,valueGoal:U});let P=I==null?void 0:I.winCriteria.valueGoal,E=I==null?void 0:I.winCriteria.aggregateValue;(P&&P!==U||S&&!E)&&(r?T.tieFormatName=r:delete T.tieFormatName);let D=[];s&&u?D=[u]:o&&b?D=((p=Ci({matchUpFilters:{matchUpTypes:[Xi]},structure:b}))==null?void 0:p.matchUps)??[]:n?D=((f=po({matchUpFilters:{matchUpTypes:[Xi]},drawDefinition:n}))==null?void 0:f.matchUps)??[]:c&&(D=((h=cf({matchUpFilters:{matchUpTypes:[Xi]},drawDefinition:n}))==null?void 0:h.matchUps)??[]);let R=(D||[]).filter(_=>{var k,B,F;let x=(B=(k=_.tieMatchUps)==null?void 0:k.filter(j=>j.collectionId===a))==null?void 0:B.some(Jr),$=e&&_.tieFormat?(F=Bp({descendant:_.tieFormat,ancestor:T}))==null?void 0:F.different:!1;return t&&!x||!_.winningSide&&_.matchUpStatus!==Zn&&(t||_.matchUpStatus!==nu&&!Jr(_)&&!$)});if(!R.length)return{error:J0};let{appliedPolicies:N}=Ai({tournamentRecord:i});if(s&&u&&t){let _=(m=u.tieMatchUps)==null?void 0:m.filter(k=>k.collectionId===a);for(let k of _??[]){let B=yE({matchUpId:k.matchUpId,tieMatchUpId:u==null?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:c});if(B.error||(B=on({drawDefinition:n,matchUpId:s}),B.error))return B;u=B==null?void 0:B.matchUp}}let M=[];for(let _ of R){for(let k of(_==null?void 0:_.sides)??[])k.lineUp=(k.lineUp??[]).map(B=>({participantId:B.participantId,collectionAssignments:((B==null?void 0:B.collectionAssignments)??[]).filter(F=>F.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(k=>{let B=k.collectionId===a;return B&&M.push(k.matchUpId),!B}),_.tieFormat&&(_.tieFormat=aa(T)),t){let k=df({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:c});if(k.error)return k}di({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,drawDefinition:n,context:v,matchUp:_})}M.length&&of({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:M,eventId:c==null?void 0:c.eventId,drawDefinition:n});let A=ft(T);if(y=Ao({tieFormat:A}),y.error)return ue({result:y,stack:v});if(l&&c)c.tieFormat=A;else if(s&&u)u.tieFormat=A;else if(b)b.tieFormat=A;else if(n)n.tieFormat=A;else if(!u||!n)return{error:nt};if(Qi({drawDefinition:n,eventId:c==null?void 0:c.eventId}),(g=N==null?void 0:N.audit)==null?void 0:g[fy]){let _=ft({drawId:n==null?void 0:n.drawId,action:v,collectionId:a,structureId:o,matchUpId:s,eventId:l});Ux({drawDefinition:n,auditData:_})}return{tieFormat:A,deletedMatchUpIds:M,targetMatchUps:R,...ae}}function lIe({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:c}){let d="addCollectionGroup";if(!Array.isArray(r))return ue({result:{error:dt},stack:d});let p=l?void 0:dg({drawDefinition:n,structureId:o,matchUpId:s,eventId:u,event:c});if(p!=null&&p.error)return ue({result:p,stack:d});let f=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,m=h==null?void 0:h.winCriteria.valueGoal,g=aa(h);if(p=Ao({tieFormat:g}),p.error)return ue({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return ue({info:"collectionIds cannot be part of other collectionGroups",result:{error:Se},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],rIe({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:f,tieFormat:g,matchUpId:s,matchUp:l,eventId:u,event:c})}function u6({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:c,matchUpId:d,matchUp:p,eventId:f,uuids:h,event:m}){var g,v,y;let b="addCollectionDefinition",I=Ai({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},T=(r==null?void 0:r[Vr])??(I==null?void 0:I[Vr]);a=a??((g=T==null?void 0:T.participants)==null?void 0:g.enforceCategory);let w=(u??((v=T==null?void 0:T.participants)==null?void 0:v.enforceGender))!==!1,S=!!((i??(m==null?void 0:m.category))&&a!==!1),U=!!((o??(m==null?void 0:m.gender))&&w),P=rE({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:S,checkGender:U,event:m});if(P.error)return ue({result:P,stack:b});let E=p!=null&&p.tieFormat?void 0:dg({drawDefinition:s,structureId:c,matchUpId:d,eventId:f,event:m});if(E!=null&&E.error)return ue({result:{error:E.error},stack:b});let D=E==null?void 0:E.structure;p=p??(E==null?void 0:E.matchUp);let R=(p==null?void 0:p.tieFormat)??(E==null?void 0:E.tieFormat),N=aa(R);if(E=Ao({tieFormat:N}),E==null?void 0:E.error)return ue({result:{error:E.error},stack:b});if(!e.collectionId)e.collectionId=Li();else if(N.collectionDefinitions.map(({collectionId:j})=>j).includes(e.collectionId))return ue({context:{collectionId:e.collectionId},result:{error:Hde}});N.collectionDefinitions.push(e),N.collectionDefinitions.sort((j,V)=>(j.collectionOrder||0)-(V.collectionOrder||0)).forEach((j,V)=>j.collectionOrder=V+1);let{aggregateValue:M,valueGoal:A}=Mb(N);N.winCriteria=ft({aggregateValue:M,valueGoal:A});let _=R==null?void 0:R.winCriteria.valueGoal,k=R==null?void 0:R.winCriteria.aggregateValue;(_&&_!==A||M&&!k)&&(l?N.tieFormatName=l:delete N.tieFormatName);let B=[],F=[],x=[],$=ft(N);if(E=Ao({tieFormat:$}),E==null?void 0:E.error)return ue({result:{error:E.error},stack:b});if(f&&m){m.tieFormat=$;for(let j of m.drawDefinitions??[])if(!j.tieFormat)for(let V of j.structures??[]){if(V.tieFormat)continue;let H=dF({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:h});F.push(...H.newMatchUps),x.push(...H.targetMatchUps),B.push(V.structureId)}gC({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,modifiedStructureIds:B,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else if(c&&D){D.tieFormat=$;let j=dF({updateInProgressMatchUps:t,collectionDefinition:e,structure:D,uuids:h});F.push(...j.newMatchUps),x=j.targetMatchUps,gC({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,modifiedStructureIds:B,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else if(d&&p){if(!$N({matchUp:p,updateInProgressMatchUps:t}))return ue({result:{error:Iq},stack:b});p.tieFormat=$;let j=tE({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...j),F.push(...j),gC({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:B,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else if(s){s.tieFormat=$;for(let j of s.structures??[]){let V=dF({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:h});B.push(j.structureId),F.push(...V.newMatchUps),x.push(...V.targetMatchUps)}gC({modifiedMatchUps:x,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else return{error:nt};if((y=I==null?void 0:I.audit)!=null&&y[fy]){let j=ft({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:b,structureId:c,matchUpId:d,eventId:f});Ux({drawDefinition:s,auditData:j})}return{tieFormat:$,targetMatchUps:x,addedMatchUps:F,...ae}}function dF({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;let a=[],o=((r=Ci({matchUpFilters:{matchUpTypes:[Xi]},structure:i}))==null?void 0:r.matchUps).filter(s=>$N({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=tE({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function gC({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){mh({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{di({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),Qi({structureIds:t,drawDefinition:n,eventId:a})}function uIe({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,uuids:l,event:u}){let c="modifyTieFormat";if(!Ao({tieFormat:i}).valid)return ue({result:{error:Jd},info:"falied validation",stack:c});let d=dg({drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:u});if(d.error)return ue({result:d,stack:c});let{matchUp:p,tieFormat:f}=d,h=aa(f),m=Bp({descendant:i,ancestor:h});if(m.invalid)return ue({context:{invalid:m.invalid},result:{error:Jd},stack:c});if(!(m!=null&&m.different))return ue({result:{...ae},info:"Nothing to do",stack:c});let g=h.collectionDefinitions.map(({collectionId:U})=>U),v=i.collectionDefinitions.map(({collectionId:U})=>U),y=g.filter(U=>!v.includes(U)),b=i.collectionDefinitions.filter(({collectionId:U})=>!g.includes(U)),I=b.map(is("collectionId")),T=[],w,S=i.tieFormatName;for(let U of i.collectionDefinitions){if(I.includes(U.collectionId))continue;let P=s6({updateInProgressMatchUps:t,...U,tournamentRecord:n,tieFormatName:S,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:u});if(P.modifications&&T.push(...P.modifications),P.error)return ue({result:P,stack:c});P.tieFormat&&(w=P.tieFormat)}for(let U of b){let P=u6({updateInProgressMatchUps:t,collectionDefinition:U,tournamentRecord:n,drawDefinition:r,tieFormatName:S,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:u});if(P.error)return ue({result:P,stack:c});P.tieFormat&&(w=P.tieFormat)}for(let U of y){let P=l6({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:S,collectionId:U,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:u});if(P.error)return ue({result:P,stack:c});P.tieFormat&&(w=P.tieFormat)}return(f==null?void 0:f.tieFormatName)!==S?(w.tieFormatName=S,T.push({tieFormatName:S})):(T.length||I.length||y.length)&&(delete w.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort((U,P)=>Uw(U.collectionOrder)-Uw(P.collectionOrder)).map((U,P)=>({...U,collectionOrder:P+1})),{processedTieFormat:aa(w),modifications:T,...ae}}function cIe({tournamentRecord:t}){if(!t)return{error:Oe};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=c=>{if(!c.tieFormat)return;let d;for(let p of n)Bp({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)c.tieFormatId=d,delete c.tieFormat;else{let p=ut(c.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Li()),c.tieFormatId=p.tieFormatId,delete c.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let c of i.drawDefinitions??[]){r({tieFormat:c.tieFormat,eventType:a});for(let d of c.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(c,d)=>{var p;let f=(p=l.matchUps)==null?void 0:p.find(h=>h.matchUpId===c);f&&(f.tieFormatId=d,delete f.tieFormat,di({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:f}))},s=c=>{let d=ut(c.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Li()),n.push(d),e+=1,o(c.matchUpId,d.tieFormatId)},l=cf({matchUpFilters:{matchUpTypes:[Tc]},event:i}),u=l.matchUps??[];for(let c of u){let d;for(let p of n)c.tieFormat&&Bp({descendant:c.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(c.matchUpId,d):s(c)}n.length&&(i.tieFormats=n)}return{...ae,addedCount:e}}var dIe={};Yt(dIe,{addDrawDefinitionExtension:()=>Qk,addEventExtension:()=>Gh,addEventTimeItem:()=>Eb,addExtension:()=>hi,addNotes:()=>PO,addOnlineResource:()=>mIe,addParticipantExtension:()=>Epe,addParticipantTimeItem:()=>l4,addTimeItem:()=>zh,addTournamentExtension:()=>Qq,addTournamentTimeItem:()=>Pb,analyzeDraws:()=>sE,analyzeTournament:()=>n5,getAllowedDrawTypes:()=>qO,getAllowedMatchUpFormats:()=>e5,getAppliedPolicies:()=>Ai,getCompetitionDateRange:()=>KO,getCompetitionPenalties:()=>t5,getPolicyDefinitions:()=>sf,getTournamentInfo:()=>Rb,getTournamentPenalties:()=>WO,getTournamentPersons:()=>i5,getTournamentStructures:()=>o4,getTournamentTimeItem:()=>VP,mutate:()=>pIe,query:()=>Sve,removeDrawDefinitionExtension:()=>Cpe,removeEventExtension:()=>eO,removeExtension:()=>qa,removeNotes:()=>eme,removeParticipantExtension:()=>Rpe,removeTournamentExtension:()=>eW,setTournamentCategories:()=>yIe,setTournamentDates:()=>Dx,setTournamentEndDate:()=>IIe,setTournamentName:()=>gIe,setTournamentNotes:()=>vIe,setTournamentStartDate:()=>bIe,setTournamentStatus:()=>hIe});var pIe={};Yt(pIe,{addDrawDefinitionExtension:()=>Qk,addEventExtension:()=>Gh,addEventTimeItem:()=>Eb,addExtension:()=>hi,addNotes:()=>PO,addOnlineResource:()=>mIe,addParticipantExtension:()=>Epe,addParticipantTimeItem:()=>l4,addTimeItem:()=>zh,addTournamentExtension:()=>Qq,addTournamentTimeItem:()=>Pb,removeDrawDefinitionExtension:()=>Cpe,removeEventExtension:()=>eO,removeExtension:()=>qa,removeNotes:()=>eme,removeParticipantExtension:()=>Rpe,removeTournamentExtension:()=>eW,setTournamentCategories:()=>yIe,setTournamentDates:()=>Dx,setTournamentEndDate:()=>IIe,setTournamentName:()=>gIe,setTournamentNotes:()=>vIe,setTournamentStartDate:()=>bIe,setTournamentStatus:()=>hIe});var TWe="ABANDONED",UWe="ACTIVE",DWe="CANCELLED",PWe="COMPLETED",EWe="IN_PROGRESS",fIe={ABANDONED:TWe,ACTIVE:UWe,CANCELLED:DWe,COMPLETED:PWe,IN_PROGRESS:EWe};function hIe({tournamentRecord:t,status:e}){return t?e&&!Object.keys(fIe).includes(e)?{error:Se,info:"Unknown status"}:(t.tournamentStatus=e,{...ae}):{error:Oe}}function mIe({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:a,venueId:o}){var s,l,u;if(!t)return{error:Oe};if(!ln(e))return{error:dt};if($n(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return ue({result:{error:rf},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return ue({result:{error:Pa}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){let c=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!c)return ue(r?{result:{error:Pa}}:{result:{error:qn}});if(r){if(((l=c.person)==null?void 0:l.personId)!==r)return ue({result:{error:Y0}});c.person.onlineResources||(c.person.onlineResources=[]),c.person.onlineResources.push(e)}else c.onlineResources||(c.onlineResources=[]),c.onlineResources.push(e)}else if(a){let c=(u=(t.venues??[]).filter(d=>!o||d.venueId===o).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===a)))==null?void 0:u[0];if(!c)return ue({result:{error:fP}});c.onlineResources||(c.onlineResources=[]),c.onlineResources.push(e)}else if(o){let c=(t.venues??[]).find(d=>d.venueId===o);if(!c)return ue({result:{error:X0}});c.onlineResources||(c.onlineResources=[]),c.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...ae}}function gIe({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...ae}):{error:Oe}}function vIe({tournamentRecord:t,notes:e}){return t?PO({element:t,notes:e}):{error:Oe}}function yIe({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...ae}):{error:Oe}}function CWe({tournamentRecord:t}){var e,i;if(!t)return{error:Oe};let{startDate:n,endDate:r}=t,a=Dw(n,r),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:u}=(s.dateAvailability??[]).reduce((p,f)=>{let h=ui(p.startTime),m=ui(p.endTime);return f.startTime&&ui(f.startTime)<h&&(p.startTime=f.startTime),f.endTime&&ui(f.endTime)>m&&(p.endTime=f.endTime),p},{startTime:"08:00",endTime:"18:00"}),c=a.map(p=>{var f;return((f=s.dateAvailability)==null?void 0:f.find(h=>h.date===p))??{date:p,startTime:l,endTime:u}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&c.unshift(d),s.dateAvailability=c}return{...ae}}function Dx(t){var e;let{tournamentRecord:i,startDate:n,endDate:r}=t,a=wi(t,[{tournamentRecord:!0},{[qq]:{startDate:!1,endDate:!1},[Pd]:Qa,[wu]:p=>Ed.test(p)}]);if(a.error)return a;if(r&&n&&new Date(r)<new Date(n))return{error:Se};let o;(n&&i.startDate&&new Date(n)>new Date(i.startDate)||r&&i.endDate&&new Date(r)<new Date(i.endDate))&&(o=!0);let s=Dw(i.startDate,i.endDate);n&&(i.startDate=n),r&&(i.endDate=r);let l=Dw(i.startDate,i.endDate),u=s.filter(p=>!l.includes(p)),c=l.filter(p=>!s.includes(p));for(let p of i.events??[])n&&p.startDate&&new Date(n)>new Date(p.startDate)&&(p.startDate=n),r&&p.endDate&&new Date(r)<new Date(p.endDate)&&(p.endDate=r);n&&i.endDate&&new Date(n)>new Date(i.endDate)&&(i.endDate=n),r&&i.startDate&&new Date(r)<new Date(i.startDate)&&(i.startDate=r);let d=o&&((e=RWe({tournamentRecord:i}))==null?void 0:e.unscheduledMatchUpIds);return CWe({tournamentRecord:i}),oi({topic:ife,payload:{startDate:n,endDate:r}}),{...ae,unscheduledMatchUpIds:d,datesAdded:c,datesRemoved:u}}function bIe({tournamentRecord:t,startDate:e}){return Dx({tournamentRecord:t,startDate:e})}function IIe({tournamentRecord:t,endDate:e}){return Dx({tournamentRecord:t,endDate:e})}function RWe({tournamentRecord:t}){let e=Xr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let u=new Date(s.scheduledDate);(i&&u<i||n&&u>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!Ix({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:Wce}:{unscheduledMatchUpIds:a}}var wIe={};Yt(wIe,{addCourt:()=>Tx,addCourts:()=>r6,addVenue:()=>FP,deleteCourt:()=>MIe,deleteVenue:()=>f6,deleteVenues:()=>DIe,disableCourts:()=>PIe,disableVenues:()=>EIe,enableCourts:()=>CIe,enableVenues:()=>RIe,generate:()=>SIe,generateCourts:()=>k5,getCompetitionVenues:()=>cE,getCourts:()=>w5,getVenuesAndCourts:()=>pf,modifyCourt:()=>h6,modifyCourtAvailability:()=>d6,modifyVenue:()=>NIe,mutate:()=>TIe,publicFindVenue:()=>xW,query:()=>Lve});var SIe={};Yt(SIe,{generateCourts:()=>k5});var TIe={};Yt(TIe,{addCourt:()=>Tx,addCourts:()=>r6,addVenue:()=>FP,deleteCourt:()=>MIe,deleteVenue:()=>f6,deleteVenues:()=>DIe,disableCourts:()=>PIe,disableVenues:()=>EIe,enableCourts:()=>CIe,enableVenues:()=>RIe,modifyCourt:()=>h6,modifyCourtAvailability:()=>d6,modifyVenue:()=>NIe});function c6(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:Oe};if(!(t!=null&&t.courtId))return{error:ub};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=ff({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=Xr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:u,courtId:c}){let d=u.filter(p=>{var f,h,m;let g=(h=(f=p.schedule)==null?void 0:f.allocatedCourts)==null?void 0:h.map(({courtId:v})=>v);return((m=p.schedule)==null?void 0:m.courtId)===c||(g==null?void 0:g.includes(c))});return ON({matchUps:d,schedulingProfile:o})}}function MWe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:Oe};if(!n)return{error:Bh};let{schedulingProfile:r}=ff({tournamentRecord:e}),{matchUps:a}=Xr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let u=s.filter(c=>{var d,p,f;let h=(p=(d=c.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:m})=>m);return((f=c.schedule)==null?void 0:f.venueId)===l||(h==null?void 0:h.includes(l))});return ON({matchUps:u,schedulingProfile:r})}}function d6({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var o,s,l;if(!t)return{error:Oe};if(!r)return{error:ub};let u=lbe({dateAvailability:e});if(u.error)return u;let{updatedDateAvailability:c,totalMergeCount:d}=NWe(e);e=c;let p=bb({tournamentRecord:t,courtId:r});if(p.error)return p;let{court:f,venue:h}=p,{matchUps:m}=c6({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){let g=(o=Ai({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[jh])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return f&&(f.dateAvailability=e,!i&&h&&oi({payload:{venue:h,tournamentId:t.tournamentId},topic:Og,key:h.venueId})),{...ae,totalMergeCount:d}}function NWe(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:u}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:u}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(tWe);let{mergedAvailability:a,mergeCount:o}=AWe(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function AWe(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:u,endTime:c,bookings:d}=l;if(r-=1,!e)e=u,n=d,i=c;else if(yP(tr(i),tr(u),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=u,n=d,i=c}else d&&(n?n.push(d):n=d),i=c,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function p6({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Yde,info:e}}function UIe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:va};if(!e&&!n)return{error:Ku};let a;if(!e){if(!t)return{error:Oe};({drawDefinition:e}=vo({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=on({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Oe};let o=Xr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Qhe({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[rg,Lp].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![rg,Lp].includes(o)),di({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...ae}):{error:Da}}function f6(t){var e,i,n;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Bh};let{tournamentRecord:r,venueId:a,force:o}=t,s=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:Oe};let l=Vu({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=(e=Ai({tournamentRecord:r}))==null?void 0:e.appliedPolicies,c=o??((n=(i=u==null?void 0:u[jh])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(!l.length||c)for(let d of Object.values(s)){for(let f of l){let h=UIe({matchUpId:f.matchUpId,drawId:f.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(f=>(f==null?void 0:f.venueId)!==a?!0:(p=!0,!1)),p&&oi({payload:{venueId:a,tournamentId:d.tournamentId},topic:gW,key:a})}else return p6({matchUpsCount:l.length});return pE({tournamentRecords:s}),{...ae}}function DIe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Oe};if(!Array.isArray(e))return{error:Se};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=f6({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...ae}}function PIe(t){let{courtIds:e,dates:i}=t,n=xc(t),r=[{[Ea]:!0,[Xk]:!0}],a=wi(t,r);if(a.error)return a;for(let o of Object.values(n))_We({tournamentRecord:o,courtIds:e,dates:i});return{...ae}}function _We({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>hi({extension:{value:n,name:Au},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...ae}}function EIe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Ea]:!0,[Jk]:!0}],a=wi(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];kWe({tournamentRecord:l,venueIds:n})}return{...ae}}function kWe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=hi({creationTime:!1,element:i,extension:{name:Au,value:!0}});if(n.error)return n}return{...ae}}function CIe(t){let e=xc(t),i=[{[Ea]:!0}];!t.enableAll&&i.push({[Xk]:!0});let n=wi(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))OWe({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...ae}}function OWe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=qt({element:a,name:Au});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),hi({extension:{name:Au,value:s},creationTime:!1,element:a})}}else qa({element:a,name:Au});return{...ae}}function RIe(t){let e=xc(t),i=[{[Ea]:!0}];!t.enableAll&&i.push({[Jk]:!0});let n=wi(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&qa({element:s,name:Au});return{...ae}}function MIe(t){let{courtId:e,disableNotice:i,force:n}=t,r=xc(t),a=wi(t,[{[Ea]:!0,[ype]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=xWe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==fP)return s;s.success&&(o=!0)}return o?{...ae}:s}function xWe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,a,o;let s=bb({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=c6({tournamentRecord:t,courtId:i}),c=(r=Ai({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((o=(a=c==null?void 0:c[jh])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(u!=null&&u.length)||d){for(let p of u??[]){let f=UIe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(f.error)return f}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||oi({payload:{venue:l,tournamentId:t.tournamentId},topic:Og,key:l.venueId}))}else return p6({matchUpsCount:u.length});return{...ae}}function h6(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=xc(t);if(!Object.keys(o).length)return{error:Rn};let s,l;for(let u of Object.values(o)){let c=LWe({tournamentRecord:u,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(c!=null&&c.error)return c;s=!0}return s?{...ae}:l}function LWe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:Oe};if(!r)return{error:ub};if(!n||typeof n!="object")return{error:rf};let o=bb({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(eWe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>u.includes(p)).length)return{error:zk};let c=u.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>c.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=d6({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||oi({payload:{venue:s,tournamentId:t.tournamentId},topic:Og,key:s==null?void 0:s.venueId}),{...ae,court:ut(l)}}var FWe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),BWe=FWe;function NIe(t){let{modifications:e,venueId:i,force:n}=t,r=xc(t);if(!Object.keys(r).length)return{error:Rn};if(typeof i!="string")return{error:Bh};let a,o;for(let s of Object.values(r)){let l=$We({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==X0)return l}return pE({tournamentRecords:r}),o?{...ae}:{error:a}}function $We({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a,o,s,l,u,c,d;if(!t)return{error:Oe};if(!e||typeof e!="object")return{error:rf};if(!i)return{error:Bh};let p=(r=Ai({tournamentRecord:t}))==null?void 0:r.appliedPolicies,f=n??((o=(a=p==null?void 0:p[jh])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:h}=MWe({tournamentRecord:t,venueId:i}),m=lf({tournamentRecord:t,venueId:i});if(m.error)return m;let g=m.venue,v=Object.keys(BWe()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>v.includes(U)).length)return{error:zk};let y=v.filter(U=>!["courts","onlineResources"].includes(U)),b=Object.keys(e).filter(U=>y.includes(U));g&&b.forEach(U=>Object.assign(g,{[U]:e[U]}));let I=((s=g==null?void 0:g.courts)==null?void 0:s.map(U=>U.courtId))??[],T=((l=e.courts)==null?void 0:l.map(U=>U.courtId))||[],w=T.length?I.filter(U=>!T.includes(U)):(e==null?void 0:e.courts)&&I,S=[];if(w!=null&&w.length){let U=(c=(u=g==null?void 0:g.courts)==null?void 0:u.filter(P=>w.includes(P.courtId)))==null?void 0:c.map(P=>{var E;let D=c6({courtId:P.courtId,tournamentRecord:t,venueMatchUps:h});for(let R of D.matchUps??[])S.push({matchUpId:R.matchUpId,drawId:R.drawId});return((E=D.matchUps)==null?void 0:E.length)??0}).reduce((P,E)=>P+E);if(g&&(!U||f))g.courts=(d=g.courts)==null?void 0:d.filter(P=>T.includes(P.courtId)),c1({schedule:{courtId:"",scheduledDate:""},matchUpDetails:S,removePriorValues:!0,tournamentRecord:t});else return p6({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:P}=U||{},E=h6({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:P,force:n});if(E.error===fP&&(E=Tx({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return pE({tournamentRecord:t}),g&&oi({payload:{venue:g,tournamentId:t.tournamentId},topic:Og,key:g==null?void 0:g.venueId}),{...ae,venue:ut(g)}}var m6={};Yt(m6,{JSON2CSV:()=>qWe,UUID:()=>Li,UUIDS:()=>fVe,allNumeric:()=>npe,attributeFilter:()=>cy,chunkArray:()=>Yr,chunkByNth:()=>RB,chunkSizeProfile:()=>ipe,constantToString:()=>ca,countValues:()=>SBe,createMap:()=>Hce,dateTime:()=>u$e,definedAttributes:()=>ft,dehydrateMatchUps:()=>jWe,extractAttributes:()=>sfe,flattenJSON:()=>g6,generateDateRange:()=>Dw,generateHashCode:()=>L2e,generateRange:()=>Je,generateTimeCode:()=>gbe,groupValues:()=>epe,hasAttributeValues:()=>x2e,instanceCount:()=>ts,intersection:()=>$n,isConvertableInteger:()=>At,isNumeric:()=>Mn,isOdd:()=>Jde,isPowerOf2:()=>$u,makeDeepCopy:()=>ut,matchUpSort:()=>wb,nearestPowerOf2:()=>Oq,nextPowerOf2:()=>Q0,noNulls:()=>wBe,noNumeric:()=>rpe,numericSort:()=>lr,occurrences:()=>UBe,overlap:()=>eo,randomMember:()=>Rl,randomPop:()=>jo,shuffleArray:()=>Va,structureSort:()=>gb,subSort:()=>DBe,undefinedToNull:()=>bB,unique:()=>Ht,visualizeScheduledMatchUps:()=>VWe});function VWe({scheduledMatchUps:t,showGlobalLog:e}){WVe();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var a;Ks({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===r),s=((a=to({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{Ks({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:u,schedule:c})=>{let d=an(c.scheduledTime);Ks({matchUpId:u,time:d,date:c.scheduledDate,venue:c.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&qVe()}function jWe({tournamentRecord:t}){if(!t)return{error:Oe};if(typeof t!="object"||!t.tournamentId)return{error:Se};let{matchUps:e}=Xr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=GWe({tournamentRecord:t});zWe(e,i)}return{...ae}}function GWe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var HWe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function zWe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))HWe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function qWe(t,e){if(e&&typeof e!="object")return{error:Se};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:c={},valuesMap:d={},context:p={},delimiter:f='"',columnJoiner:h=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof c!="object"||typeof i!="object"||typeof u!="object"||typeof d!="object"||typeof h!="string"||typeof m!="string"||typeof g!="string"||typeof f!="string")return{error:Se};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));let v=t.filter(Boolean).map(M=>g6(M,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((M,A)=>Object.keys(A).every(_=>!M.includes(_)&&M.push(_)||!0)&&M,[]).filter(M=>!(l!=null&&l.length)||l.includes(M)),I=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(A=>({[A]:M})).flat()).flat()),T=(M,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=b.reduce((M,A)=>{let _=I[A];return _?M.includes(_)||M.push(_):M.push(A),M},[]).sort(T);Object.keys(c).forEach(M=>!w.includes(M)&&w.unshift(M)),Object.keys(i).forEach(M=>!w.includes(M)&&w.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!w.includes(M)&&w.unshift(M));let S=w.map(M=>c[M]||M);if(s)return[S];let U=M=>`${f}${M}${f}`,P=[],E=M=>Object.values(w.reduce((A,_,k)=>{var B;let F=i[_],x=(F!=null&&F.length?M[F.find(V=>M[V])]:M[_])||(p==null?void 0:p[_])||"",$=((B=d[_])==null?void 0:B[x])||x,j=$o(u[_])?u[_]($):$;return A[_]=U(j),j&&(P[k]=(P[k]||0)+1),A},{})),D=v.map(E),R=o&&[...P].map((M,A)=>!M&&A).filter(Mn).reverse();if(R){let M=A=>A.filter((_,k)=>!R.includes(k));D=D.map(M),S=M(S)}let N=D.map(M=>M.join(h));return a?N.map(M=>{let A=M.split(h);return Object.assign({},...A.map((_,k)=>({[S[k]]:_})))}):r?[S.map(U).join(h),...N].join(m):N.join(m)}function g6(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,g6(t[r],e,i.concat(r))),{})}var{FACTORY:lY}=Npe;function WWe({tournamentRecord:t,value:e}){let{extension:i}=qt({element:t,name:lY}),n={name:lY,value:{...i==null?void 0:i.value,...e}};hi({element:t,extension:n})}function AIe({timeStamp:t}){let e=pb(),i=Lq();return i&&Object.values(e).forEach(n=>{WWe({tournamentRecord:n,value:{version:Ok(),timeStamp:t}})}),i}function _Ie({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var a,o;let s=il();if(typeof s!="object")return;let l={method:e},u=(r==null?void 0:r.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),c=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||c,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||d)&&(l.params=n),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||c)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=r),Object.keys(l).length>1&&fpe(l,t)}function v6({methodName:t,params:e,start:i}){let n={error:Wk,methodName:t},r=i?Date.now()-i:0;return _Ie({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function KWe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Oe};let n=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(n){let{event:o,drawDefinition:s,tournamentId:l}=vo({tournamentRecords:t,drawId:n});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=vo({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:es};e.tournamentId=s,e.event=o}let r=e.tournamentId??db();if(!r&&e)return e;let a=t[r];return r&&!a?{error:Oe}:(a&&(e.tournamentRecord=a),e)}function y6(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=db();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||Bq(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||pb(),u=i?ut(i,void 0,!0):void 0,c=i?KWe(l,i):void 0;if(c!=null&&c.error)return c;let d=YWe({params:c,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return _Ie({result:d,methodName:n,elapsed:p,params:u,engineType:r}),d}function YWe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(il())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return Zk({engineName:"engine",methodName:n,params:i,err:a})}}function Px(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=iu();for(let o of[...a].sort(ZWe)){let s=cpe({topic:o});s!=null&&s.length&&MB({topic:o,notices:s})}e&&r&&a.includes(OB)&&MB({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:OB})}var uY={[UW]:5,[TW]:5,[DW]:5,[SW]:5,[wW]:5,[bW]:5,[efe]:5,[tfe]:5,[IW]:1,[uO]:1,[ma]:5,[Og]:5,[yW]:4,[mW]:4,[gW]:4,[vW]:4,[lO]:3,[pW]:2};function ZWe(t,e){return(uY[e]||0)-(uY[t]||0)}function XWe({convertExtensions:t,removeExtensions:e}){let i=pb();return{tournamentId:db(),tournamentRecords:ut(i,t,!1,e)}}function JWe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??db();if(typeof n!="string")return{};let r=Bq(n);return{tournamentRecord:ut(r,e,!1,i)}}function QWe(){var t;let e=pb(),{extension:i}=qt({name:dy,tournamentRecords:e,discover:!0}),n=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(r=>{n.includes(r)||delete e[r]}),Yk(e)}function cY(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:rf}:t!=null&&t.tournamentId?dpe(e?ut(t):t):{error:Se}}function Ex(t,e=!0){if(typeof t!="object")return{error:rf};if(VU(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:SB};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},VU(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:SB};return Yk(e?ut(t):t)}function e4e(t,e,i,n,r,a){let o=hpe(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>$o(s[l])).forEach(l=>{t[l]=u=>{let c=()=>e(t,{[l]:s[l],...u});if(il())return c();try{return c()}catch(d){Zk({engineName:"engine",methodName:l,params:u,err:d})}}}),{...ae,...t}}function Qb(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function kIe(t,e){t.importMethods=(i,n,r,a)=>e4e(t,e,i,n,r,a),t.getTournament=i=>JWe(i),t.getState=i=>XWe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>Ok(),t.reset=()=>(Yk({}),Qb(t)),t.devContext=i=>(BU(i),Qb(t)),t.getDevContext=i=>il(i),t.newTournamentRecord=(i={})=>{let n=qye(i),r=n.tournamentId;return n.error?n:(cY(n),VU(r),{...ae,tournamentId:r})},t.setState=(i,n,r)=>{$U(n,r);let a=Ex(i,n);return Qb(t,a)},t.setTournamentId=i=>VU(i),t.getTournamentId=()=>db(),t.setTournamentRecord=(i,n,r)=>{$U(n,r);let a=cY(i,n);return Qb(t,a)},t.removeTournamentRecord=i=>{let n=ppe(i);return Qb(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=QWe();return Qb(t,i)}}function t4e(t,e,i){if(!Array.isArray(e))return{error:Se,message:"directives must be an array"};let n=upe(),r=Date.now(),a=i&&ut(pb(),!1,!0),o=[];for(let u of e){if(typeof u!="object")return{error:Se,message:"directive must be an object"};if(u.params&&typeof u.params!="object")return{error:Se,message:"params must be an object"};let{method:c,pipe:d}=u,p=u.params?{...u.params}:{};if(!n[c])return v6({methodName:c,start:r,params:p});if(d){let h=o[o.length-1],m=Object.keys(d);for(let g of m)h[g]&&(p[g]=h[g])}let f=y6(t,n[c],p,c,"sync");if(f!=null&&f.error)return a&&Ex(a),{...f,rolledBack:!!a};o.push({...f,methodName:c})}let s=Date.now(),l=AIe({timeStamp:s});return Px({directives:e,mutationStatus:l,timeStamp:s}),mP(),{success:o.every(u=>u.success),results:o}}function dY(t,e){if(!ln(e))return{error:Se,message:"args must be an object"};let i=Object.values(e).filter($o).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Se};let n=i?Object.keys(e).find(f=>$o(e[f])):mo(e.method)&&e.method;if(!n)return{error:Wk};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&ut(pb(),!1,!0),l=r||t[n]||_q()[n];if(!l)return v6({methodName:n,params:o});let u=y6(t,l,o,n,"sync")??{};u!=null&&u.error&&s&&Ex(s);let c=Date.now(),d=AIe({timeStamp:c}),p=(u==null?void 0:u.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&Px({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:c}),(p||!(u!=null&&u.success)||o!=null&&o.doNotNotify)&&mP(),u}var i4e=(()=>{let t={executionQueue:(e,i)=>t4e(t,e,i),execute:e=>dY(t,e)};return kIe(t,dY),t})(),b6=i4e;function pY(t,e){if(!ln(e))return{error:Se,message:"args must be an object"};let i=Object.values(e).filter($o).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Se};let n=i?Object.keys(e).find(l=>$o(e[l])):mo(e.method)&&e.method;if(!n)return{error:Wk};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||_q()[n];return s?y6(t,s,o,n,"ask"):v6({methodName:n,params:o})}(()=>{let t={execute:e=>pY(t,e)};return kIe(t,pY),t})();var Vv={},Ff;function fY(t,e=!0){if(!t)return{error:dt};if(typeof t!="object")return{error:rf};if(t.matchUpId)Ff=t.matchUpId,Vv[Ff]=e?ut(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Vv[i.matchUpId]=e?ut(i):i,Ff||(Ff=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Vv[i.matchUpId]=e?ut(i):i,Ff||(Ff=i.matchUpId));return e?ut(t):t}function n4e(){return Vv[Ff]}function r4e(){return Object.values(Vv)}function a4e(){Ff=void 0,Vv={}}function o4e(t){return ut(Vv[Ff],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:r=>o4e(r),version:()=>Ok(),reset:()=>(a4e(),{...ae}),drawId:void 0,error:void 0,success:!1,devContext:r=>(BU(r),t),setState:(r,a,o)=>{$U(a,o);let s=fY(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([F4]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(il())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){Zk({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||n4e(),l=(r==null?void 0:r.matchUps)||r4e(),u=(r==null?void 0:r.rollbackOnError)&&ut(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let c=a[o](r);if(c!=null&&c.error)return u&&fY(u),{...c,rolledBack:!!u};let d=(c==null?void 0:c.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&Px(),(d||!(c!=null&&c.success)||r!=null&&r.doNotNotify)&&mP(),c}})();var pF=!1;(()=>{let t={version:()=>Ok(),setDeepCopy:(n,r)=>($U(n,r),t),devContext:n=>(BU(n),pF=!0,t)};return i([Y5]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||Px(),mP(),pF&&(BU(!1),pF=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{try{let s=e(r[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&Ex(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();b6.importMethods(Vce,!0,1);var OIe=b6;function xIe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function s4e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:u}=t,{participationOrder:c,flightNumber:d,rankingStage:p}=e,f=h=>!n&&!l||!h.dateRanges?!0:h.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(h=>{var m,g,v,y,b,I,T,w,S,U;return f(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((m=h.drawTypes)!=null&&m.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((y=h.stages)!=null&&y.length)||h.stages.includes(p))&&(!((b=h.levels)!=null&&b.length)||h.levels.includes(u))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||u<=h.maxLevel)&&(!d||!((T=(I=h.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===c)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=h.eventTypes)!=null&&S.length)||((U=h.eventTypes)==null?void 0:U.includes(r)))})}}function hY({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},u=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(At(g)?g:0),b=xIe(a,g==null?void 0:g.level);return{value:l(v,b)||At(b)&&b||y}},c=0,d,p,f,h,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),p=u(g,e).value,f=u(v,e).value,h=u(y,e).value,c=p||f||h,d=p&&g.requireWin||f&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[n],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),p=u(g,e).value,h=u(v,e).value,c=p||h,d=p?g.requireWin:v==null?void 0:v.requireWin}else At(i)&&m===void 0&&(c=i);return e&&(s=r==null?void 0:r.pct)!=null&&s[e]&&(c=Math.round(c*r.pct[e])),{awardPoints:c,requireWin:d}}function l4e({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var r;if(!i)return{error:Oe};let{policyDefinitions:a}=sf({policyTypes:[UR],tournamentRecord:i}),o=(e==null?void 0:e[UR])??(a==null?void 0:a[UR]);if(!o)return{error:Fk};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:c,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:f}=jn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),m={},g={},v={};for(let y of h??[]){let{participantType:b,participantId:I,person:T,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:P,eventId:E}=S,D=d[E],R=p[U],N=R==null?void 0:R.drawType,{category:M,eventType:A}=D||{},_=S.startDate||D.startDate||i.startDate,k=S.endDate||D.endDate||i.endDate;if(A===rl&&I!==Ws)continue;let B;if(s){let F=u,x=0,$=0,j=0,V;for(let H of P){let{finishingPositionRange:z,participationOrder:q,participantWon:W,flightNumber:Y,rankingStage:Z,winCount:X}=H;x+=X||0;let Q=R==null?void 0:R.drawSize,{awardProfile:ce}=s4e({awardProfiles:s,participation:H,eventType:A,startDate:_,category:M,drawSize:Q,drawType:N,endDate:k,level:n});if(ce){if(!Q)continue;let J=Array.isArray(z)&&Math.max(...z),ee=Ht(z||[]).join("-"),ne=J&&Z!==vt&&(z==null?void 0:z.includes(Q));ce.requireWinForPoints!==void 0&&(F=ce.requireWinForPoints),ce.requireWinFirstRound!==void 0&&(l=ce.requireWinFirstRound);let{finishingPositionPoints:ie={},finishingPositionRanges:oe,finishingRound:se,pointsPerWin:pe,flights:fe}=ce,ge=Array.isArray(ce.perWinPoints)?(r=ce.perWinPoints)==null?void 0:r.find(Pe=>{var et;return(et=Pe.participationOrders)==null?void 0:et.includes(q)}):ce.perWinPoints,me=ie.participationOrders,Ee=0,Be;if((!me||me.includes(q))&&oe&&J){let Pe=oe[J];Pe&&({awardPoints:Ee,requireWin:Be}=hY({flightNumber:Y,valueObj:Pe,drawSize:Q,flights:fe,level:n}))}if(!Ee&&se&&q===1&&J){let Pe=se[J];Pe&&({awardPoints:Ee,requireWin:Be}=hY({participantWon:W,flightNumber:Y,valueObj:Pe,drawSize:Q,flights:fe,level:n}))}if(ne&&l!==void 0&&(F=l),Be!==void 0&&(F=Be),Ee>$&&(!F||X)&&($=Ee,V=J),!Ee&&pe&&X&&(j+=X*pe,V=ee),!Ee&&X&&ge){let Pe=xIe(n,ge==null?void 0:ge.level);Pe?j+=X*Pe:ge.value&&(j+=X*ge.value)}}if(B=$+j,b===Ws){let J=(y.matchUps||[]).filter(({structureId:ee})=>ee===H.structureId);for(let{matchUpId:ee}of J){let ne=f[ee],ie=ne.sides.find(oe=>oe.participantId===I).sideNumber;if(ne.winningSice===ie)for(let oe of ne.tieMatchUps)oe.winningSide}}}if(j||$){let H={winCount:x,positionPoints:$,rangeAccessor:V,perWinPoints:j,eventType:A,drawId:U,points:B},z=T==null?void 0:T.personId;z?(m[z]||(m[z]=[]),m[z].push(H)):b===xt?(v[I]||(v[I]=[]),v[I].push(H)):b===Ws&&(g[I]||(g[I]=[]),g[I].push(H))}}}}return{participantsWithOutcomes:h,personPoints:m,pairPoints:v,teamPoints:g,...ae}}var u4e={getTournamentPoints:l4e},c4e=u4e,d4e={calculateNewRatings:Lme,generateDynamicRatings:Fme},p4e=d4e,f4e={...c4e,...p4e};b6.importMethods(f4e);var h4e={[zU]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},m4e={[Mp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Lv,BT]}},g4e={[Mp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Lv,n1,yy],disabledActions:[]}]}},v4e={[Mp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},y4e={[nS]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},b4e={[Rd]:{defaultMatchUpFormat:Vs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[at]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},I4e={[Rd]:{requireAllPositionsAssigned:!1,stage:{[at]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Vs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Vs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},w4e={[Dl]:{seedingProfile:{positioning:rO},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},S4e={POLICY_AVOIDANCE_COUNTRY:h4e,POLICY_POSITION_ACTIONS_DEFAULT:vme,POLICY_POSITION_ACTIONS_DISABLED:v4e,POLICY_POSITION_ACTIONS_NO_MOVEMENT:g4e,POLICY_POSITION_ACTIONS_UNRESTRICTED:m4e,POLICY_PRIVACY_DEFAULT:y4e,POLICY_ROUND_NAMING_DEFAULT:FW,POLICY_SCHEDULING_DEFAULT:Ove,POLICY_SCORING_DEFAULT:b4e,POLICY_SCORING_USTA:I4e,POLICY_SEEDING_ITF:w4e,POLICY_SEEDING_DEFAULT:bve},T4e={ratingsParameters:ds,matchUpFormats:UGe,countryToFlag:$fe,tieFormats:lye,countries:Wf,policies:S4e,flagIOC:xVe},U4e={};Yt(U4e,{activeMatchUpStatuses:()=>aW,auditConstants:()=>H3e,completedMatchUpStatuses:()=>kr,directingMatchUpStatuses:()=>Vpe,drawDefinitionConstants:()=>Jpe,entryStatusConstants:()=>x$e,errorConditionConstants:()=>Q2e,eventConstants:()=>lVe,extensionConstants:()=>Npe,flightConstants:()=>J3e,genderConstants:()=>$W,keyValueConstants:()=>ZHe,matchUpActionConstants:()=>aHe,matchUpStatusConstants:()=>Hpe,matchUpTypes:()=>_$e,nonDirectingMatchUpStatuses:()=>jpe,particicipantsRequiredMatchUpStatuses:()=>Bpe,participantConstants:()=>k$e,participantRoles:()=>KW,participantTypes:()=>OT,penaltyConstants:()=>j4e,policyConstants:()=>p$e,positionActionConstants:()=>tHe,ratingConstants:()=>UHe,recoveryTimeRequiredMatchUpStatuses:()=>S$e,requestConstants:()=>Oqe,resultConstants:()=>B2e,scaleConstants:()=>ZBe,scheduleConstants:()=>rVe,sortingConstants:()=>iqe,surfaceConstants:()=>K4e,tieFormatConstants:()=>jze,timeItemConstants:()=>tVe,topicConstants:()=>M$e,tournamentConstants:()=>fIe,upcomingMatchUpStatuses:()=>Gpe,validMatchUpStatuses:()=>$pe,venueConstants:()=>X4e});var D4e="Coaching",P4e="Ball Abuse",E4e="Racket Abuse",C4e="Verbal Abuse",R4e="INELIGIBILITY",M4e="Physical Abuse",N4e="Unsportmanlike Conduct",A4e="Dress Code Violation",_4e="Equipment Violation",k4e="Leaving the court",O4e="Failure to complete",x4e="No Show",L4e="Other",F4e="REFUSAL_TO_PLAY",B4e="PROHIBITED_SUBSTANCE",$4e="Puncuality",V4e="Failure to sign in",j4e={COACHING:D4e,BALL_ABUSE:P4e,RACKET_ABUSE:E4e,VERBAL_ABUSE:C4e,PHYSICAL_ABUSE:M4e,INELIGIBILITY:R4e,UNSPORTSMANLIKE_CONDUCT:N4e,PROHIBITED_SUBSTANCE:B4e,DRESS_CODE_VIOLATION:A4e,EQUIMENT_VIOLATION:_4e,LEAVING_THE_COURT:k4e,REFUSAL_TO_PLAY:F4e,FAILURE_TO_COMPLETE:O4e,NO_SHOW:x4e,OTHER:L4e,PUNCTUALITY:$4e,FAILUIRE_TO_SIGN_IN:V4e},G4e="CLAY",H4e="HARD",z4e="GRASS",q4e="CARPET",W4e="ARTIFICIAL",K4e={CLAY:G4e,HARD:H4e,GRASS:z4e,CARPET:q4e,ARTIFICIAL:W4e},Y4e="INDOOR",Z4e="OUTDOOR",X4e={INDOOR:Y4e,OUTDOOR:Z4e};const J4e=Ri({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function Q4e({matchUp:t,individualParticipant:e,spacer:i}){var n,r,a;const o=((n=e==null?void 0:e.person)==null?void 0:n.iso2NationalityCode)||"",s=o?(r=T4e.countryToFlag(o))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),u=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=J4e({variant:u})),l.innerHTML=i?"":s,l}function fF({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:a,type:o}){if(o==="scale")return A2e({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&Q4e({className:i,matchUp:n,individualParticipant:t,spacer:r})||o==="seeding"&&M2e({className:i,composition:e,matchUp:n,side:a})||l}const e5e="Qualifier",t5e="BYE",i5e="TBD";function mY(t){var e,i,n,r;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:c}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},f=c==null?void 0:c.configuration,h={QUALIFIER:((e=f==null?void 0:f.placeHolders)==null?void 0:e.qualifier)||e5e,BYE:((i=f==null?void 0:f.placeHolders)==null?void 0:i.bye)||t5e,TBD:((n=f==null?void 0:f.placeHolders)==null?void 0:n.tbd)||i5e},m=l==null?void 0:l.participantName,g=S=>{Du(p==null?void 0:p.participantClick)&&(S.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:S,matchUp:u,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=c2e({variant:d});const b=(f==null?void 0:f.flags)&&fF({...t,type:"flag"});if(b)y.appendChild(b);else{const S=fF({type:"scale",...t});S&&y.appendChild(S)}const I=document.createElement("div");if(I.className=d2e({variant:d}),m){const S=document.createElement("span");if(a&&f!=null&&f.winnerColor)S.style.color=typeof f.winnerColor=="string"?f.winnerColor:"green";else if(f!=null&&f.genderColor){const U=(r=l==null?void 0:l.person)==null?void 0:r.sex,P=U==="MALE"&&"#2E86C1"||U==="FEMALE"&&"#AA336A"||"";S.style.color=typeof f.genderColor=="string"?f.genderColor:P}S.innerHTML=m,I.appendChild(S)}else{const S=document.createElement("abbr");S.className=u2e({variant:f.showAddress?"showAddress":""}),S.innerHTML=(o==null?void 0:o.bye)&&h.BYE||(o==null?void 0:o.qualifier)&&h.QUALIFIER||h.TBD,I.appendChild(S)}const T=fF({...t,className:R2e(),type:"seeding"});T&&I.appendChild(T),y.appendChild(I),v.appendChild(y);const w=C2e(t);return v.appendChild(w),{element:v}}const n5e=Ri({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function r5e({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",n=document.createElement("div");n.className=n5e({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function a5e(t){return t instanceof Element||t}const o5e=Ri({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function s5e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=o5e(),e}const l5e=Ri({flexDirection:"column",position:"relative",display:"flex"}),u5e=Ri({alignItems:"stretch",display:"flex"}),c5e=Ri({marginInlineEnd:".25rem",color:"green"});function d5e({dim:t="20px"}={}){const e=c5e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function LIe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:o,matchUp:s}){var l,u,c;const{winningSide:d,matchUpType:p,isRoundRobin:f,matchUpStatus:h}=s||{},m=n==null?void 0:n.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(M=>M.sideNumber===o):void 0;r||(r=v==null?void 0:v.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||f)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",b=y?(u=r==null?void 0:r.individualParticipants)==null?void 0:u[0]:r,I=y&&((c=r==null?void 0:r.individualParticipants)==null?void 0:c[1]),T=o===d||h==="BYE"&&r,w=(m==null?void 0:m.winnerChevron)&&T,S=m==null?void 0:m.teamLogo,U=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(h)&&!T,P=m==null?void 0:m.gameScoreOnly,E=document.createElement("div");if(E.className=i&&f2e({drawPosition:g,sideNumber:o}),E.classList.add("tmx-p"),E.setAttribute("id",r==null?void 0:r.participantId),S){const M=s5e({teamLogo:S});E.appendChild(M)}const D=document.createElement("div");D.className=p2e({variant:y?"doubles":"singles"});const R=document.createElement("div");R.className=h2e({winnerChevron:w,isDoubles:y});const N=mY({individualParticipant:b,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:o,matchUp:s,side:v}).element;if(R.appendChild(N),I){const M=mY({individualParticipant:I,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:o,matchUp:s,side:v}).element;R.appendChild(M)}else y&&a&&a5e(a)&&R.appendChild(a);if(D.appendChild(R),E.appendChild(D),i){const M=document.createElement("div");if(T&&!P){const A=d5e();typeof A=="string"?M.innerHTML=A:M.appendChild(A)}else if(U){const A=r5e({matchUpStatus:h});M.appendChild(A)}E.appendChild(M)}return E}const p5e=Ri({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});function f5e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var a;const o=document.createElement("div");o.className=p5e(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",n);const s=Du(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=s?"":"",u=(a=i==null?void 0:i[n])==null?void 0:a.roundName,c=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${u}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=c||"",o}const FIe=Ri({flexDirection:"column",display:"flex"}),h5e=Ri({flexDirection:"row",display:"flex"}),BIe=Ri({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),m5e=Ri({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),g5e=Ri({fontWeight:"bold",color:"blue",height:"1em"}),gY=Ri({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),v5e=Ri({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function y5e(){return Ri({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const b5e=Ri({});function I5e({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Ri(e)}function w5e({variant:t}){return Ri({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const S5e=Ri({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),T5e=Ri({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),vY=Ri({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function U5e({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");Du(t==null?void 0:t.centerInfoClick)&&(a.onclick=c=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:c})),a.className=Ng(w5e({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=S5e();const s=document.createElement("div");s.className=T5e();const l=document.createElement("div");l.className=vY(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=vY(),u.innerHTML=e||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const VT={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function D5e({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(t==null?void 0:t.configuration)||{},a=(r==null?void 0:r.connectorWidth)||16,o=r.centerInfo?VT.centerInfo*n:0,s=r.scheduleInfo?VT.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+o,u=l*i,c=(l+s)*i;return Ri({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:u,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:c}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const $Ie=t=>Ri({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),P5e=Ri({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),VIe=Ri({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),E5e=Ri({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function C5e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=VIe(),e.value=t,e}function R5e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=n===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,u=l||a,c=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=C5e({value:u});else if(p=document.createElement("p"),p.className=VIe({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=c,p.innerHTML=isNaN(u)?"":u,!t){const f=document.createElement("span");f.className=P5e(),f.innerHTML=o&&!l?s:"",p.appendChild(f)}return p}function M5e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var a,o,s,l;const u=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,c=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=r==null?void 0:r.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,f=n===2?t:t-1,h=$Ie(f),m=y=>{Du(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=h({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=E5e();for(const y of d||[]){const b=R5e({gameScoreOnly:c,scoreStripes:u,sideNumber:n,set:y});v.appendChild(b)}return g.appendChild(v),g}const N5e=Ri({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var jIe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(m2e,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var A=["th","st","nd","rd"],_=M%100;return"["+M+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(M,A,_){var k=String(M);return!k||k.length>=A?M:""+Array(A+1-k.length).join(_)+M},I={s:b,z:function(M){var A=-M.utcOffset(),_=Math.abs(A),k=Math.floor(_/60),B=_%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(B,2,"0")},m:function M(A,_){if(A.date()<_.date())return-M(_,A);var k=12*(_.year()-A.year())+(_.month()-A.month()),B=A.clone().add(k,d),F=_-B<0,x=A.clone().add(k+(F?-1:1),d);return+(-(k+(_-B)/(F?B-x:x-B))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",U=function(M){return M instanceof R||!(!M||!M[S])},P=function M(A,_,k){var B;if(!A)return T;if(typeof A=="string"){var F=A.toLowerCase();w[F]&&(B=F),_&&(w[F]=_,B=F);var x=A.split("-");if(!B&&x.length>1)return M(x[0])}else{var $=A.name;w[$]=A,B=$}return!k&&B&&(T=B),B||!k&&T},E=function(M,A){if(U(M))return M.clone();var _=typeof A=="object"?A:{};return _.date=M,_.args=arguments,new R(_)},D=I;D.l=P,D.i=U,D.w=function(M,A){return E(M,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var R=function(){function M(_){this.$L=P(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=M.prototype;return A.parse=function(_){this.$d=function(k){var B=k.date,F=k.utc;if(B===null)return new Date(NaN);if(D.u(B))return new Date;if(B instanceof Date)return new Date(B);if(typeof B=="string"&&!/Z$/i.test(B)){var x=B.match(g);if(x){var $=x[2]-1||0,j=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],$,x[3]||1,x[4]||0,x[5]||0,x[6]||0,j)):new Date(x[1],$,x[3]||1,x[4]||0,x[5]||0,x[6]||0,j)}}return new Date(B)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return D},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,k){var B=E(_);return this.startOf(k)<=B&&B<=this.endOf(k)},A.isAfter=function(_,k){return E(_)<this.startOf(k)},A.isBefore=function(_,k){return this.endOf(k)<E(_)},A.$g=function(_,k,B){return D.u(_)?this[k]:this.set(B,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,k){var B=this,F=!!D.u(k)||k,x=D.p(_),$=function(Z,X){var Q=D.w(B.$u?Date.UTC(B.$y,X,Z):new Date(B.$y,X,Z),B);return F?Q:Q.endOf(u)},j=function(Z,X){return D.w(B.toDate()[Z].apply(B.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),B)},V=this.$W,H=this.$M,z=this.$D,q="set"+(this.$u?"UTC":"");switch(x){case f:return F?$(1,0):$(31,11);case d:return F?$(1,H):$(0,H+1);case c:var W=this.$locale().weekStart||0,Y=(V<W?V+7:V)-W;return $(F?z-Y:z+(6-Y),H);case u:case h:return j(q+"Hours",0);case l:return j(q+"Minutes",1);case s:return j(q+"Seconds",2);case o:return j(q+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,k){var B,F=D.p(_),x="set"+(this.$u?"UTC":""),$=(B={},B[u]=x+"Date",B[h]=x+"Date",B[d]=x+"Month",B[f]=x+"FullYear",B[l]=x+"Hours",B[s]=x+"Minutes",B[o]=x+"Seconds",B[a]=x+"Milliseconds",B)[F],j=F===u?this.$D+(k-this.$W):k;if(F===d||F===f){var V=this.clone().set(h,1);V.$d[$](j),V.init(),this.$d=V.set(h,Math.min(this.$D,V.daysInMonth())).$d}else $&&this.$d[$](j);return this.init(),this},A.set=function(_,k){return this.clone().$set(_,k)},A.get=function(_){return this[D.p(_)]()},A.add=function(_,k){var B,F=this;_=Number(_);var x=D.p(k),$=function(H){var z=E(F);return D.w(z.date(z.date()+Math.round(H*_)),F)};if(x===d)return this.set(d,this.$M+_);if(x===f)return this.set(f,this.$y+_);if(x===u)return $(1);if(x===c)return $(7);var j=(B={},B[s]=n,B[l]=r,B[o]=i,B)[x]||1,V=this.$d.getTime()+_*j;return D.w(V,this)},A.subtract=function(_,k){return this.add(-1*_,k)},A.format=function(_){var k=this,B=this.$locale();if(!this.isValid())return B.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",x=D.z(this),$=this.$H,j=this.$m,V=this.$M,H=B.weekdays,z=B.months,q=B.meridiem,W=function(X,Q,ce,J){return X&&(X[Q]||X(k,F))||ce[Q].slice(0,J)},Y=function(X){return D.s($%12||12,X,"0")},Z=q||function(X,Q,ce){var J=X<12?"AM":"PM";return ce?J.toLowerCase():J};return F.replace(v,function(X,Q){return Q||function(ce){switch(ce){case"YY":return String(k.$y).slice(-2);case"YYYY":return D.s(k.$y,4,"0");case"M":return V+1;case"MM":return D.s(V+1,2,"0");case"MMM":return W(B.monthsShort,V,z,3);case"MMMM":return W(z,V);case"D":return k.$D;case"DD":return D.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return W(B.weekdaysMin,k.$W,H,2);case"ddd":return W(B.weekdaysShort,k.$W,H,3);case"dddd":return H[k.$W];case"H":return String($);case"HH":return D.s($,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return Z($,j,!0);case"A":return Z($,j,!1);case"m":return String(j);case"mm":return D.s(j,2,"0");case"s":return String(k.$s);case"ss":return D.s(k.$s,2,"0");case"SSS":return D.s(k.$ms,3,"0");case"Z":return x}return null}(X)||x.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,k,B){var F,x=this,$=D.p(k),j=E(_),V=(j.utcOffset()-this.utcOffset())*n,H=this-j,z=function(){return D.m(x,j)};switch($){case f:F=z()/12;break;case d:F=z();break;case p:F=z()/3;break;case c:F=(H-V)/6048e5;break;case u:F=(H-V)/864e5;break;case l:F=H/r;break;case s:F=H/n;break;case o:F=H/i;break;default:F=H}return B?F:D.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,k){if(!_)return this.$L;var B=this.clone(),F=P(_,k,!0);return F&&(B.$L=F),B},A.clone=function(){return D.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},M}(),N=R.prototype;return E.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",f],["$D",h]].forEach(function(M){N[M[1]]=function(A){return this.$g(A,M[0],M[1])}}),E.extend=function(M,A){return M.$i||(M(A,R,E),M.$i=!0),E},E.locale=P,E.isDayjs=U,E.unix=function(M){return E(1e3*M)},E.en=w[T],E.Ls=w,E.p={},E})})(jIe);var A5e=jIe.exports;const _5e=Bce(A5e);function k5e({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=m6,l=s(i);let u=o(n),c="ddd D MMMM";l&&(c+=", hh:mm A",u+=`T${l}`);const d=n?_5e(u).format(c):"Not scheduled",p=r&&(a==null?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",f=document.createElement("div");f.className=N5e(),f.classList.add("tmx-sch"),Du(e==null?void 0:e.scheduleClick)&&(f.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const h=document.createElement("div");h.innerHTML=d,f.append(h);const m=y=>{Du(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),f.append(g),f.onclick){const y=document.createElement("div");y.innerHTML="",g.append(y)}return f}function yY({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},u=l==null?void 0:l.scheduleInfo,c=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&c,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!OIe.checkScoreHasValue({matchUp:a}),f=document.createElement("div");if(f.className=Ng(l5e(),r),f.classList.add("tmx-sd"),f.setAttribute("sideNumber",n),u&&n===1){const g=k5e({matchUp:a,eventHandlers:e});f.appendChild(g)}const h=document.createElement("div");h.className=u5e();const m=LIe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:a});if(h.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",h.appendChild(g)}if(c){const g=M5e({eventHandlers:e,composition:i,sideNumber:n,matchUp:a});h.appendChild(g)}if(p){const g=$Ie(),v=b=>{Du(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:b,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",h.appendChild(y)}return f.appendChild(h),f}function GIe(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moeity:r,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:c,preFeedRound:d,stage:p}=n,f=t.isFinalRound||parseInt(u)===1,h=p==="QUALIFYING"&&f,m=f,g=parseInt(l)===i,v=c==="DOUBLES",y=(o||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(h||d)&&"m0"||r&&"m1"||"m2",b=D5e({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),I=(e==null?void 0:e.configuration)||{},{resultsInfo:T,centerInfo:w}=I||{},S=t.eventHandlers||{},U=M=>{Du(S==null?void 0:S.matchUpClick)&&S.matchUpClick({pointerEvent:M,matchUp:n})},P=document.createElement("div");P.className=Ng(e.theme,t==null?void 0:t.className,"matchup",b5e()),P.classList.add("tmx-m"),P.setAttribute("id",n==null?void 0:n.matchUpId),P.onclick=U;const E=document.createElement("div");E.className=I5e({configuration:I});const D=({sideNumber:M})=>{var A,_,k;const B=(k=(_=(A=n==null?void 0:n.sides.find(F=>F.sideNumber===M))==null?void 0:A.participant)==null?void 0:_.entryStatus)==null?void 0:k.replace("_"," ");return U5e({eventHandlers:S,entryStatus:B,sideNumber:M,className:M===2&&b,matchUp:n})},R=yY({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:n}),N=yY({className:!w&&b,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:n});if(E.appendChild(R),w){const M=D({sideNumber:1}),A=D({sideNumber:2});E.appendChild(M.element),E.appendChild(A.element)}if(E.appendChild(N),T){const M=O5e({score:n.score});E.appendChild(M)}if(P.appendChild(E),a===n.matchUpId){const M=document.createElement("div");M.className=y5e(),P.appendChild(M)}return P}function O5e({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),n=i==null?void 0:i[i.length-1],r=(n==null?void 0:n.side1PointsScore)||(n==null?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=v5e(),r){const o=document.createElement("div");o.className=gY({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=gY({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function x5e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,matchUps:c,context:d,isLucky:p}){const f=c.filter(P=>P.roundNumber===l).sort((P,E)=>(P.roundPosition||0)-(E.roundPosition||0)),h=f.every(({roundPosition:P,drawPositions:E})=>!P&&!E),m=(o==null?void 0:o.configuration)||{},g=document.createElement("div");if(g.className=FIe(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),m.roundHeader){const P=f5e({roundProfile:u,roundMatchUps:f,roundNumber:l,eventHandlers:i,context:d});g.appendChild(P)}const v=document.createElement("div");v.className=BIe({variant:h?"adHoc":void 0});let y,b,I;if(r){const P=D=>D.reduce((R,N)=>N+R,0);f.sort((D,R)=>{const N=P(D.drawPositions)-P(R.drawPositions),M=Math.min(...D.drawPositions??[])-Math.min(...R.drawPositions??[]);return N||M});const E=f.reduce((D,R)=>(D[R.structureId]=R.structureName,D),{});y=Object.values(E),b=Object.keys(E),I=Object.keys(m6.instanceCount(f.map(({structureId:D})=>D))).length}else h&&f.sort((P,E)=>(P.roundOrder??0)-(E.roundOrder??0));const T=I&&f.length/I,w=Object.keys(u).map(P=>parseInt(P)),S=w.indexOf(l),U=S===0&&"first"||S===w.length-1&&"last";return f.forEach((P,E)=>{const D=T&&!(E%T),R=T&&Math.floor(E/T),N=T&&y[R];if(D){const _=document.createElement("div");_.className=m5e({variant:R,roundOrder:U}),v.appendChild(_);const k=document.createElement("div");if(k.className=g5e(),Du(i==null?void 0:i.groupHeaderClick)){const{drawId:B,containerStructureId:F}=f[0];v.onclick=x=>i.groupHeaderClick({drawId:B,structureId:b[R],containerStructureId:F,pointerEvent:x})}l===t&&(k.innerHTML=N),v.appendChild(k)}const M=E%2===0;s?P.roundFactor=s:t>1&&(P.roundFactor=Math.pow(2,l-t));const A=GIe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:a,composition:o,isAdHoc:h,isLucky:p,matchUp:P,moeity:M});v.appendChild(A)}),g.appendChild(v),g}function L5e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:o,matchUps:s,context:l}){var u;const{roundNumbers:c,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:f}=OIe.getRoundMatchUps({matchUps:s});a=a||(l==null?void 0:l.structureId)||((u=s==null?void 0:s[0])==null?void 0:u.structureId);const h=s.some(({isRoundRobin:y})=>y),m=p||f,g=document.createElement("div");g.className=h5e(),g.classList.add("tmx-str"),g.setAttribute("id",a);const v=Math.max(...c);for(const y of c){if(y<t)continue;const b=x5e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:y===v,isRoundRobin:h,searchActive:n,composition:r,roundNumber:y,roundProfile:d,matchUps:s,context:l,isLucky:m});g.appendChild(b)}if(o){const y=document.createElement("div");y.className=FIe();const b=document.createElement("div");b.className=BIe(),b.appendChild(o),y.appendChild(b),g.appendChild(y)}return g}const bY=Ri({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function F5e({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Ng(bY(),e):bY(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Ab}=Fce({theme:{lineHeights:{scheduleInfo:`${VT.scheduleInfo}rem`,centerInfo:`${VT.centerInfo}rem`,gameScore:`${VT.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),IY=Ab("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),B5e=Ab("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),$5e=Ab("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),V5e=Ab("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),wY=Ab("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),j5e=Ab("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),G5e=Ab("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),VN={Australian:{configuration:{flags:!0},theme:IY},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:wY},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:wY},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:$5e},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:B5e},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:V5e},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:G5e},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:IY},Night:{configuration:{flags:!0},theme:j5e}};function Hw(){aN.close()}function yn(t){const{title:e,content:i,buttons:n,footer:r,onClose:a}=t,s={padding:!e&&!n?"":".5",maxWidth:500};return aN.open({title:e,content:i,footer:r,buttons:n,config:s,onClose:a})}function H5e(){let t;const e=()=>{if(t.action.value==="upload"&&t.replace.checked){const r=$e.getTournament().tournamentRecord;return Mt({action:{onClick:()=>K3({tournamentRecord:r}).then(_Fe,kFe),text:"Send??"},message:"Upload tournament",intent:"is-danger"})}},i=[{control:"replace",onChange:({e:r})=>{const a=document.getElementById("go");a.disabled=!r.target.checked}},{onChange:({e:r})=>{const a=document.getElementById("replace"),o=Jo(a,"field");o.style.display=r.target.value==="upload"?"block":"none"},control:"action"}];yn({title:"Tournament Actions",content:r=>t=Wn(r,[{options:[{label:"-- select action --",close:!0},{label:"Upload tournament",value:"upload",close:!0},{label:"Delete tournament",disabled:!0,value:"delete",close:!0},{label:"Go Offline - standalone mode",disabled:!0,value:"offline",close:!0}],label:"Action",field:"action"},{label:"Replace tournament on server",field:"replace",visible:!1,checkbox:!0,id:"replace"}],i),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Go",id:"go",intent:"is-danger",disabled:!0,onClick:e,close:!0}]})}const ur=(t,e)=>i=>(i==null?void 0:i.trim().length)>=t&&(!e||e&&(i==null?void 0:i.trim().length)<=e);function z5e(t){let e;const i=({inputs:o})=>{const s=ur(10)(o.providerName.value)&&ur(3)(o.providerAbbr.value)&&(!o.providerId.value.length||ur(36)(o.providerId.value)),l=document.getElementById("createButton");l&&(l.disabled=!s)},n=[{control:"providerAbbr",onInput:i},{control:"providerName",onInput:i},{control:"providerId",onInput:i}];yn({title:"Create provider",content:o=>e=Wn(o,[{placeholder:"Provider name",validator:ur(10),label:"Provider Name",field:"providerName",autocomplete:"off"},{placeholder:"Abbreviation",validator:ur(3),label:"Abbreviation",field:"providerAbbr",autocomplete:"off"},{placeholder:"NOT REQUIRED - automatically generated",label:"Provider ID",autocomplete:"off",field:"providerId"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"createButton",disabled:!0,onClick:()=>{const o=e.providerAbbr.value,s=e.providerName.value,l=Wt.UUID(),u={organisationAbbreviation:o,organisationName:s,organisationId:l},c=d=>{console.log(d),rt(t)&&t(d)};HLe({provider:u}).then(c,d=>console.log({err:d}))},close:!0}]})}function HIe(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}const I6=que();function zIe(){localStorage.removeItem(I6)}function qIe(){return localStorage.getItem(I6)}function q5e(t){localStorage.setItem(I6,t)}var WIe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};function w6({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"falied normal parse",note:t})}}function W5e(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function KIe(t,e){let i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);let n=document.body.appendChild(i);n.click(),n.remove()}function K5e(t,e){let i="data:text/json;charset=utf-8,"+encodeURIComponent(W5e(e));KIe(t,i)}function Y5e(t,e){let i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);KIe(t,i)}function Z5e(){const t=s=>s.toString()[1]?s:"0"+s,e=s=>{if(!s)return"";const l=new Date(s);return[t(l.getMonth()+1),t(l.getDate()),l.getFullYear()].join("/")},{tournamentInfo:i}=$e.getTournamentInfo(),{completedMatchUps:n}=$e.tournamentMatchUps({context:{tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventType:"Tournament",...i,idType:oy}}),r=n.map(s=>{const{winningSide:l,sides:u,score:c}=s,d=u.find(({sideNumber:h})=>h===l),p=u.find(({sideNumber:h})=>h!==l);return{winnerScore:c[`scoreStringSide${l}`],...s,winners:d,losers:p}}),a={columnAccessors:[""],columnTransform:{"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament Import Source":["tournamentEventSource"],"Tournament Event Type":["tournamentEventType"],"Tournament Name":["tournamentName"],"Draw Name":[ay],"Draw Type":[Xc],"Match ID":["matchUpId"],Score:["winnerScore"],"Id Type":["idType"]}};let o=Wt.JSON2CSV(r,a);Y5e(`UTR-${i.tournamentId}.csv`,o)}function X5e(){const{tournamentRecord:t}=$e.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:oy,intent:"is-warning",onClick:Z5e,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?K5e(`${t.tournamentId}.tods.json`,t):Mt({message:"Error"})},close:!0}],n=`${Lr.tr("phrases.export")}: ${Lr.tr("trn")}`;yn({title:n,content:t.tournamentName,buttons:i})}function d1(t){var n,r,a,o,s;const e=((n=t.tournamentName)==null?void 0:n.toLowerCase())||"Error",i=(a=(r=t.onlineResources)==null?void 0:r.find(({name:l,resourceType:u})=>l==="tournamentImage"&&u==="URL"))==null?void 0:a.identifier;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:(o=new Date(t.startDate).toISOString())==null?void 0:o.split("T")[0],endDate:(s=new Date(t.endDate).toISOString())==null?void 0:s.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i}}}const _b=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n==null?void 0:n.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(r)},i.forEach(a=>a.addFilter(e))}else e=void 0}},Fr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Wa=Object.keys,fs=Array.isArray;function al(t,e){return typeof e!="object"||Wa(e).forEach(function(i){t[i]=e[i]}),t}typeof Promise>"u"||Fr.Promise||(Fr.Promise=Promise);const p1=Object.getPrototypeOf,J5e={}.hasOwnProperty;function Gu(t,e){return J5e.call(t,e)}function zw(t,e){typeof e=="function"&&(e=e(p1(t))),(typeof Reflect>"u"?Wa:Reflect.ownKeys)(e).forEach(i=>{Yf(t,i,e[i])})}const YIe=Object.defineProperty;function Yf(t,e,i,n){YIe(t,e,al(i&&Gu(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},n))}function OI(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Yf(t.prototype,"constructor",t),{extend:zw.bind(null,t.prototype)}}}}const Q5e=Object.getOwnPropertyDescriptor;function S6(t,e){let i;return Q5e(t,e)||(i=p1(t))&&S6(i,e)}const e6e=[].slice;function jN(t,e,i){return e6e.call(t,e,i)}function ZIe(t,e){return e(t)}function uT(t){if(!t)throw new Error("Assertion Failed")}function XIe(t){Fr.setImmediate?setImmediate(t):setTimeout(t,0)}function JIe(t,e){return t.reduce((i,n,r)=>{var a=e(n,r);return a&&(i[a[0]]=a[1]),i},{})}function Zf(t,e){if(typeof e=="string"&&Gu(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var i=[],n=0,r=e.length;n<r;++n){var a=Zf(t,e[n]);i.push(a)}return i}var o=e.indexOf(".");if(o!==-1){var s=t[e.substr(0,o)];return s==null?void 0:Zf(s,e.substr(o+1))}}function fd(t,e,i){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){uT(typeof i!="string"&&"length"in i);for(var n=0,r=e.length;n<r;++n)fd(t,e[n],i[n])}else{var a=e.indexOf(".");if(a!==-1){var o=e.substr(0,a),s=e.substr(a+1);if(s==="")i===void 0?fs(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=i;else{var l=t[o];l&&Gu(t,o)||(l=t[o]={}),fd(l,s,i)}}else i===void 0?fs(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}function QIe(t){var e={};for(var i in t)Gu(t,i)&&(e[i]=t[i]);return e}const t6e=[].concat;function ewe(t){return t6e.apply([],t)}const twe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ewe([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>Fr[t]),i6e=twe.map(t=>Fr[t]);JIe(twe,t=>[t,!0]);let ym=null;function UE(t){ym=typeof WeakMap<"u"&&new WeakMap;const e=w$(t);return ym=null,e}function w$(t){if(!t||typeof t!="object")return t;let e=ym&&ym.get(t);if(e)return e;if(fs(t)){e=[],ym&&ym.set(t,e);for(var i=0,n=t.length;i<n;++i)e.push(w$(t[i]))}else if(i6e.indexOf(t.constructor)>=0)e=t;else{const a=p1(t);for(var r in e=a===Object.prototype?{}:Object.create(a),ym&&ym.set(t,e),t)Gu(t,r)&&(e[r]=w$(t[r]))}return e}const{toString:n6e}={};function S$(t){return n6e.call(t).slice(8,-1)}const T$=typeof Symbol<"u"?Symbol.iterator:"@@iterator",r6e=typeof T$=="symbol"?function(t){var e;return t!=null&&(e=t[T$])&&e.apply(t)}:function(){return null},gI={};function $f(t){var e,i,n,r;if(arguments.length===1){if(fs(t))return t.slice();if(this===gI&&typeof t=="string")return[t];if(r=r6e(t)){for(i=[];!(n=r.next()).done;)i.push(n.value);return i}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}const T6=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var hf=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function iwe(t,e){hf=t,nwe=e}var nwe=()=>!0;const a6e=!new Error("").stack;function kb(){if(a6e)try{throw kb.arguments,new Error}catch(t){return t}return new Error}function U$(t,e){var i=t.stack;return i?(e=e||0,i.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),i.split(`
`).slice(e).filter(nwe).map(n=>`
`+n).join("")):""}var rwe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],U6=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(rwe),o6e={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function xI(t,e){this._e=kb(),this.name=t,this.message=e}function awe(t,e){return t+". Errors: "+Object.keys(e).map(i=>e[i].toString()).filter((i,n,r)=>r.indexOf(i)===n).join(`
`)}function GN(t,e,i,n){this._e=kb(),this.failures=e,this.failedKeys=n,this.successCount=i,this.message=awe(t,e)}function jT(t,e){this._e=kb(),this.name="BulkError",this.failures=Object.keys(e).map(i=>e[i]),this.failuresByPos=e,this.message=awe(t,e)}OI(xI).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+U$(this._e,2))}},toString:function(){return this.name+": "+this.message}}),OI(GN).from(xI),OI(jT).from(xI);var D6=U6.reduce((t,e)=>(t[e]=e+"Error",t),{});const s6e=xI;var pi=U6.reduce((t,e)=>{var i=e+"Error";function n(r,a){this._e=kb(),this.name=i,r?typeof r=="string"?(this.message=`${r}${a?`
 `+a:""}`,this.inner=a||null):typeof r=="object"&&(this.message=`${r.name} ${r.message}`,this.inner=r):(this.message=o6e[e]||i,this.inner=null)}return OI(n).from(s6e),t[e]=n,t},{});pi.Syntax=SyntaxError,pi.Type=TypeError,pi.Range=RangeError;var SY=rwe.reduce((t,e)=>(t[e+"Error"]=pi[e],t),{}),OR=U6.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=pi[e]),t),{});function mr(){}function f1(t){return t}function l6e(t,e){return t==null||t===f1?e:function(i){return e(t(i))}}function wy(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function u6e(t,e){return t===mr?e:function(){var i=t.apply(this,arguments);i!==void 0&&(arguments[0]=i);var n=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?wy(n,this.onsuccess):n),r&&(this.onerror=this.onerror?wy(r,this.onerror):r),a!==void 0?a:i}}function c6e(t,e){return t===mr?e:function(){t.apply(this,arguments);var i=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?wy(i,this.onsuccess):i),n&&(this.onerror=this.onerror?wy(n,this.onerror):n)}}function d6e(t,e){return t===mr?e:function(i){var n=t.apply(this,arguments);al(i,n);var r=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?wy(r,this.onsuccess):r),a&&(this.onerror=this.onerror?wy(a,this.onerror):a),n===void 0?o===void 0?void 0:o:al(n,o)}}function p6e(t,e){return t===mr?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function P6(t,e){return t===mr?e:function(){var i=t.apply(this,arguments);if(i&&typeof i.then=="function"){for(var n=this,r=arguments.length,a=new Array(r);r--;)a[r]=arguments[r];return i.then(function(){return e.apply(n,a)})}return e.apply(this,arguments)}}OR.ModifyError=GN,OR.DexieError=xI,OR.BulkError=jT;var h1={};const owe=100,[D$,HN,P$]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,p1(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,p1(e),t]})(),swe=HN&&HN.then,xR=D$&&D$.constructor,E6=!!P$;var E$=!1,f6e=P$?()=>{P$.then(vC)}:Fr.setImmediate?setImmediate.bind(null,vC):Fr.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{vC(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(vC,0)},GT=function(t,e){cT.push([t,e]),zN&&(f6e(),zN=!1)},C$=!0,zN=!0,jv=[],LR=[],R$=null,M$=f1,LI={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:DY,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{DY(t[0],t[1])}catch{}})}},Xt=LI,cT=[],Gv=0,FR=[];function Ut(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=mr,this._lib=!1;var e=this._PSD=Xt;if(hf&&(this._stackHolder=kb(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==h1)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&A$(this,this._value))}this._state=null,this._value=null,++e.ref,uwe(this,t)}const N$={get:function(){var t=Xt,e=qN;function i(n,r){var a=!t.global&&(t!==Xt||e!==qN);const o=a&&!Ih();var s=new Ut((l,u)=>{C6(this,new lwe(WN(n,t,a,o),WN(r,t,a,o),l,u,t))});return hf&&pwe(s,this),s}return i.prototype=h1,i},set:function(t){Yf(this,"then",t&&t.prototype===h1?N$:{get:function(){return t},set:N$.set})}};function lwe(t,e,i,n,r){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=i,this.reject=n,this.psd=r}function uwe(t,e){try{e(i=>{if(t._state===null){if(i===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&DE();i&&typeof i.then=="function"?uwe(t,(r,a)=>{i instanceof Ut?i._then(r,a):i.then(r,a)}):(t._state=!0,t._value=i,cwe(t)),n&&PE()}},A$.bind(null,t))}catch(i){A$(t,i)}}function A$(t,e){if(LR.push(e),t._state===null){var i=t._lib&&DE();e=M$(e),t._state=!1,t._value=e,hf&&e!==null&&typeof e=="object"&&!e._promise&&function(n,r,a){try{n.apply(null,a)}catch(o){r&&r(o)}}(()=>{var n=S6(e,"stack");e._promise=t,Yf(e,"stack",{get:()=>E$?n&&(n.get?n.get.apply(e):n.value):t.stack})}),function(n){jv.some(r=>r._value===n._value)||jv.push(n)}(t),cwe(t),i&&PE()}}function cwe(t){var e=t._listeners;t._listeners=[];for(var i=0,n=e.length;i<n;++i)C6(t,e[i]);var r=t._PSD;--r.ref||r.finalize(),Gv===0&&(++Gv,GT(()=>{--Gv==0&&R6()},[]))}function C6(t,e){if(t._state!==null){var i=t._state?e.onFulfilled:e.onRejected;if(i===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Gv,GT(h6e,[i,t,e])}else t._listeners.push(e)}function h6e(t,e,i){try{R$=e;var n,r=e._value;e._state?n=t(r):(LR.length&&(LR=[]),n=t(r),LR.indexOf(r)===-1&&function(a){for(var o=jv.length;o;)if(jv[--o]._value===a._value)return void jv.splice(o,1)}(e)),i.resolve(n)}catch(a){i.reject(a)}finally{R$=null,--Gv==0&&R6(),--i.psd.ref||i.psd.finalize()}}function dwe(t,e,i){if(e.length===i)return e;var n="";if(t._state===!1){var r,a,o=t._value;o!=null?(r=o.name||"Error",a=o.message||o,n=U$(o,0)):(r=o,a=""),e.push(r+(a?": "+a:"")+n)}return hf&&((n=U$(t._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),t._prev&&dwe(t._prev,e,i)),e}function pwe(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function vC(){DE()&&PE()}function DE(){var t=C$;return C$=!1,zN=!1,t}function PE(){var t,e,i;do for(;cT.length>0;)for(t=cT,cT=[],i=t.length,e=0;e<i;++e){var n=t[e];n[0].apply(null,n[1])}while(cT.length>0);C$=!0,zN=!0}function R6(){var t=jv;jv=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=FR.slice(0),i=e.length;i;)e[--i]()}function yC(t){return new Ut(h1,!1,t)}function ea(t,e){var i=Xt;return function(){var n=DE(),r=Xt;try{return fg(i,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{fg(r,!1),n&&PE()}}}zw(Ut.prototype,{then:N$,_then:function(t,e){C6(this,new lwe(null,null,t,e,Xt))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],i=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?i(n):yC(n)):this.then(null,n=>n&&n.name===e?i(n):yC(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),yC(e)))},stack:{get:function(){if(this._stack)return this._stack;try{E$=!0;var t=dwe(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{E$=!1}}},timeout:function(t,e){return t<1/0?new Ut((i,n)=>{var r=setTimeout(()=>n(new pi.Timeout(e)),t);this.then(i,n).finally(clearTimeout.bind(null,r))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Yf(Ut.prototype,Symbol.toStringTag,"Dexie.Promise"),LI.env=fwe(),zw(Ut,{all:function(){var t=$f.apply(null,arguments).map(bC);return new Ut(function(e,i){t.length===0&&e([]);var n=t.length;t.forEach((r,a)=>Ut.resolve(r).then(o=>{t[a]=o,--n||e(t)},i))})},resolve:t=>{if(t instanceof Ut)return t;if(t&&typeof t.then=="function")return new Ut((i,n)=>{t.then(i,n)});var e=new Ut(h1,!0,t);return pwe(e,R$),e},reject:yC,race:function(){var t=$f.apply(null,arguments).map(bC);return new Ut((e,i)=>{t.map(n=>Ut.resolve(n).then(e,i))})},PSD:{get:()=>Xt,set:t=>Xt=t},totalEchoes:{get:()=>qN},newPSD:pg,usePSD:PS,scheduler:{get:()=>GT,set:t=>{GT=t}},rejectionMapper:{get:()=>M$,set:t=>{M$=t}},follow:(t,e)=>new Ut((i,n)=>pg((r,a)=>{var o=Xt;o.unhandleds=[],o.onunhandled=a,o.finalize=wy(function(){(function(s){function l(){s(),FR.splice(FR.indexOf(l),1)}FR.push(l),++Gv,GT(()=>{--Gv==0&&R6()},[])})(()=>{this.unhandleds.length===0?r():a(this.unhandleds[0])})},o.finalize),t()},e,i,n))}),xR&&(xR.allSettled&&Yf(Ut,"allSettled",function(){const t=$f.apply(null,arguments).map(bC);return new Ut(e=>{t.length===0&&e([]);let i=t.length;const n=new Array(i);t.forEach((r,a)=>Ut.resolve(r).then(o=>n[a]={status:"fulfilled",value:o},o=>n[a]={status:"rejected",reason:o}).then(()=>--i||e(n)))})}),xR.any&&typeof AggregateError<"u"&&Yf(Ut,"any",function(){const t=$f.apply(null,arguments).map(bC);return new Ut((e,i)=>{t.length===0&&i(new AggregateError([]));let n=t.length;const r=new Array(n);t.forEach((a,o)=>Ut.resolve(a).then(s=>e(s),s=>{r[o]=s,--n||i(new AggregateError(r))}))})}));const ps={awaits:0,echoes:0,id:0};var m6e=0,BR=[],hF=0,qN=0,g6e=0;function pg(t,e,i,n){var r=Xt,a=Object.create(r);a.parent=r,a.ref=0,a.global=!1,a.id=++g6e;var o=LI.env;a.env=E6?{Promise:Ut,PromiseProp:{value:Ut,configurable:!0,writable:!0},all:Ut.all,race:Ut.race,allSettled:Ut.allSettled,any:Ut.any,resolve:Ut.resolve,reject:Ut.reject,nthen:TY(o.nthen,a),gthen:TY(o.gthen,a)}:{},e&&al(a,e),++r.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=PS(a,t,i,n);return a.ref===0&&a.finalize(),s}function DS(){return ps.id||(ps.id=++m6e),++ps.awaits,ps.echoes+=owe,ps.id}function Ih(){return!!ps.awaits&&(--ps.awaits==0&&(ps.id=0),ps.echoes=ps.awaits*owe,!0)}function bC(t){return ps.echoes&&t&&t.constructor===xR?(DS(),t.then(e=>(Ih(),e),e=>(Ih(),fo(e)))):t}function v6e(t){++qN,ps.echoes&&--ps.echoes!=0||(ps.echoes=ps.id=0),BR.push(Xt),fg(t,!0)}function y6e(){var t=BR[BR.length-1];BR.pop(),fg(t,!1)}function fg(t,e){var i=Xt;if((e?!ps.echoes||hF++&&t===Xt:!hF||--hF&&t===Xt)||hwe(e?v6e.bind(null,t):y6e),t!==Xt&&(Xt=t,i===LI&&(LI.env=fwe()),E6)){var n=LI.env.Promise,r=t.env;HN.then=r.nthen,n.prototype.then=r.gthen,(i.global||t.global)&&(Object.defineProperty(Fr,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))}}function fwe(){var t=Fr.Promise;return E6?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Fr,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:HN.then,gthen:t.prototype.then}:{}}function PS(t,e,i,n,r){var a=Xt;try{return fg(t,!0),e(i,n,r)}finally{fg(a,!1)}}function hwe(t){swe.call(D$,t)}function WN(t,e,i,n){return typeof t!="function"?t:function(){var r=Xt;i&&DS(),fg(e,!0);try{return t.apply(this,arguments)}finally{fg(r,!1),n&&hwe(Ih)}}}function TY(t,e){return function(i,n){return t.call(this,WN(i,e),WN(n,e))}}(""+swe).indexOf("[native code]")===-1&&(DS=Ih=mr);const UY="unhandledrejection";function DY(t,e){var i;try{i=e.onuncatched(t)}catch{}if(i!==!1)try{var n,r={promise:e,reason:t};if(Fr.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(UY,!0,!0),al(n,r)):Fr.CustomEvent&&al(n=new CustomEvent(UY,{detail:r}),r),n&&Fr.dispatchEvent&&(dispatchEvent(n),!Fr.PromiseRejectionEvent&&Fr.onunhandledrejection))try{Fr.onunhandledrejection(n)}catch{}hf&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var fo=Ut.reject;function _$(t,e,i,n){if(t.idbdb&&(t._state.openComplete||Xt.letThrough||t._vip)){var r=t._createTransaction(e,i,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===D6.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>_$(t,e,i,n))):fo(a)}return r._promise(e,(a,o)=>pg(()=>(Xt.trans=r,n(a,o,r)))).then(a=>r._completion.then(()=>a))}if(t._state.openComplete)return fo(new pi.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return fo(new pi.DatabaseClosed);t.open().catch(mr)}return t._state.dbReadyPromise.then(()=>_$(t,e,i,n))}const PY="3.2.6",gv="",k$=-1/0,Ef="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",mwe="String expected.",HT=[],Cx=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),b6e=Cx,I6e=Cx,gwe=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Rx="__dbnames",mF="readonly",gF="readwrite";function Sy(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const vwe={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function IC(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=UE(e))[t],e)}class w6e{_trans(e,i,n){const r=this._tx||Xt.trans,a=this.name;function o(l,u,c){if(!c.schema[a])throw new pi.NotFound("Table "+a+" not part of transaction");return i(c.idbtrans,c)}const s=DE();try{return r&&r.db===this.db?r===Xt.trans?r._promise(e,o,n):pg(()=>r._promise(e,o,n),{trans:r,transless:Xt.transless||Xt}):_$(this.db,e,[this.name],o)}finally{s&&PE()}}get(e,i){return e&&e.constructor===Object?this.where(e).first(i):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(r=>this.hook.reading.fire(r))).then(i)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(fs(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const i=Wa(e);if(i.length===1)return this.where(i[0]).equals(e[i[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(u=>{if(u.compound&&i.every(c=>u.keyPath.indexOf(c)>=0)){for(let c=0;c<i.length;++c)if(i.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort((u,c)=>u.keyPath.length-c.keyPath.length)[0];if(n&&this.db._maxKey!==gv){const u=n.keyPath.slice(0,i.length);return this.where(u).equals(u.map(c=>e[c]))}!n&&hf&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${i.join("+")}]`);const{idxByName:r}=this.schema,a=this.db._deps.indexedDB;function o(u,c){try{return a.cmp(u,c)===0}catch{return!1}}const[s,l]=i.reduce(([u,c],d)=>{const p=r[d],f=e[d];return[u||p,u||!p?Sy(c,p&&p.multi?h=>{const m=Zf(h,d);return fs(m)&&m.some(g=>o(f,g))}:h=>o(f,Zf(h,d))):c]},[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(l):n?this.filter(l):this.where(i).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,fs(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const i=n=>{if(!n)return n;const r=Object.create(e.prototype);for(var a in n)if(Gu(n,a))try{r[a]=n[a]}catch{}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),e}defineClass(){return this.mapToClass(function(e){al(this,e)})}add(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let a=e;return r&&n&&(a=IC(r)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:i!=null?[i]:null,values:[a]})).then(o=>o.numFailures?Ut.reject(o.failures[0]):o.lastResult).then(o=>{if(r)try{fd(e,r,o)}catch{}return o})}update(e,i){if(typeof e!="object"||fs(e))return this.where(":id").equals(e).modify(i);{const n=Zf(e,this.schema.primKey.keyPath);if(n===void 0)return fo(new pi.InvalidArgument("Given object does not contain its primary key"));try{typeof i!="function"?Wa(i).forEach(r=>{fd(e,r,i[r])}):i(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(i)}}put(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let a=e;return r&&n&&(a=IC(r)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[a],keys:i!=null?[i]:null})).then(o=>o.numFailures?Ut.reject(o.failures[0]):o.lastResult).then(o=>{if(r)try{fd(e,r,o)}catch{}return o})}delete(e){return this._trans("readwrite",i=>this.core.mutate({trans:i,type:"delete",keys:[e]})).then(i=>i.numFailures?Ut.reject(i.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:vwe})).then(e=>e.numFailures?Ut.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",i=>this.core.getMany({keys:e,trans:i}).then(n=>n.map(r=>this.hook.reading.fire(r))))}bulkAdd(e,i,n){const r=Array.isArray(i)?i:void 0,a=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new pi.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new pi.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&s?e.map(IC(l)):e;return this.core.mutate({trans:o,type:"add",keys:r,values:c,wantResults:a}).then(({numFailures:d,results:p,lastResult:f,failures:h})=>{if(d===0)return a?p:f;throw new jT(`${this.name}.bulkAdd(): ${d} of ${u} operations failed`,h)})})}bulkPut(e,i,n){const r=Array.isArray(i)?i:void 0,a=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new pi.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new pi.InvalidArgument("Arguments objects and keys must have the same length");const u=e.length;let c=l&&s?e.map(IC(l)):e;return this.core.mutate({trans:o,type:"put",keys:r,values:c,wantResults:a}).then(({numFailures:d,results:p,lastResult:f,failures:h})=>{if(d===0)return a?p:f;throw new jT(`${this.name}.bulkPut(): ${d} of ${u} operations failed`,h)})})}bulkDelete(e){const i=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:r,failures:a})=>{if(n===0)return r;throw new jT(`${this.name}.bulkDelete(): ${n} of ${i} operations failed`,a)})}}function zT(t){var e={},i=function(o,s){if(s){for(var l=arguments.length,u=new Array(l-1);--l;)u[l-1]=arguments[l];return e[o].subscribe.apply(null,u),t}if(typeof o=="string")return e[o]};i.addEventType=a;for(var n=1,r=arguments.length;n<r;++n)a(arguments[n]);return i;function a(o,s,l){if(typeof o!="object"){var u;s||(s=p6e),l||(l=mr);var c={subscribers:[],fire:l,subscribe:function(d){c.subscribers.indexOf(d)===-1&&(c.subscribers.push(d),c.fire=s(c.fire,d))},unsubscribe:function(d){c.subscribers=c.subscribers.filter(function(p){return p!==d}),c.fire=c.subscribers.reduce(s,l)}};return e[o]=i[o]=c,c}Wa(u=o).forEach(function(d){var p=u[d];if(fs(p))a(d,u[d][0],u[d][1]);else{if(p!=="asap")throw new pi.InvalidArgument("Invalid event config");var f=a(d,f1,function(){for(var h=arguments.length,m=new Array(h);h--;)m[h]=arguments[h];f.subscribers.forEach(function(g){XIe(function(){g.apply(null,m)})})})}})}}function zS(t,e){return OI(e).from({prototype:t}),e}function eI(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function vF(t,e){t.filter=Sy(t.filter,e)}function yF(t,e,i){var n=t.replayFilter;t.replayFilter=n?()=>Sy(n(),e()):e,t.justLimit=i&&!n}function $R(t,e){if(t.isPrimKey)return e.primaryKey;const i=e.getIndexByKeyPath(t.index);if(!i)throw new pi.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function EY(t,e,i){const n=$R(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function wC(t,e,i,n){const r=t.replayFilter?Sy(t.filter,t.replayFilter()):t.filter;if(t.or){const a={},o=(s,l,u)=>{if(!r||r(l,u,p=>l.stop(p),p=>l.fail(p))){var c=l.primaryKey,d=""+c;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(c)),Gu(a,d)||(a[d]=!0,e(s,l,u))}};return Promise.all([t.or._iterate(o,i),CY(EY(t,n,i),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return CY(EY(t,n,i),Sy(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function CY(t,e,i,n){var r=ea(n?(a,o,s)=>i(n(a),o,s):i);return t.then(a=>{if(a)return a.start(()=>{var o=()=>a.continue();e&&!e(a,s=>o=s,s=>{a.stop(s),o=mr},s=>{a.fail(s),o=mr})||r(a.value,a,s=>o=s),o()})})}function Os(t,e){try{const i=RY(t),n=RY(e);if(i!==n)return i==="Array"?1:n==="Array"?-1:i==="binary"?1:n==="binary"?-1:i==="string"?1:n==="string"?-1:i==="Date"?1:n!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(r,a){const o=r.length,s=a.length,l=o<s?o:s;for(let u=0;u<l;++u)if(r[u]!==a[u])return r[u]<a[u]?-1:1;return o===s?0:o<s?-1:1}(MY(t),MY(e));case"Array":return function(r,a){const o=r.length,s=a.length,l=o<s?o:s;for(let u=0;u<l;++u){const c=Os(r[u],a[u]);if(c!==0)return c}return o===s?0:o<s?-1:1}(t,e)}}catch{}return NaN}function RY(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const i=S$(t);return i==="ArrayBuffer"?"binary":i}function MY(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class S6e{_read(e,i){var n=this._ctx;return n.error?n.table._trans(null,fo.bind(null,n.error)):n.table._trans("readonly",e).then(i)}_write(e){var i=this._ctx;return i.error?i.table._trans(null,fo.bind(null,i.error)):i.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var i=this._ctx;i.algorithm=Sy(i.algorithm,e)}_iterate(e,i){return wC(this._ctx,e,i,this._ctx.table.core)}clone(e){var i=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&al(n,e),i._ctx=n,i}raw(){return this._ctx.valueMapper=null,this}each(e){var i=this._ctx;return this._read(n=>wC(i,e,n,i.table.core))}count(e){return this._read(i=>{const n=this._ctx,r=n.table.core;if(eI(n,!0))return r.count({trans:i,query:{index:$R(n,r.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var a=0;return wC(n,()=>(++a,!1),i,r).then(()=>a)}).then(e)}sortBy(e,i){const n=e.split(".").reverse(),r=n[0],a=n.length-1;function o(u,c){return c?o(u[n[c]],c-1):u[r]}var s=this._ctx.dir==="next"?1:-1;function l(u,c){var d=o(u,a),p=o(c,a);return d<p?-s:d>p?s:0}return this.toArray(function(u){return u.sort(l)}).then(i)}toArray(e){return this._read(i=>{var n=this._ctx;if(n.dir==="next"&&eI(n,!0)&&n.limit>0){const{valueMapper:r}=n,a=$R(n,n.table.core.schema);return n.table.core.query({trans:i,limit:n.limit,values:!0,query:{index:a,range:n.range}}).then(({result:o})=>r?o.map(r):o)}{const r=[];return wC(n,a=>r.push(a),i,n.table.core).then(()=>r)}},e)}offset(e){var i=this._ctx;return e<=0||(i.offset+=e,eI(i)?yF(i,()=>{var n=e;return(r,a)=>n===0||(n===1?(--n,!1):(a(()=>{r.advance(n),n=0}),!1))}):yF(i,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),yF(this._ctx,()=>{var i=e;return function(n,r,a){return--i<=0&&r(a),i>=0}},!0),this}until(e,i){return vF(this._ctx,function(n,r,a){return!e(n.value)||(r(a),i)}),this}first(e){return this.limit(1).toArray(function(i){return i[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var i,n;return vF(this._ctx,function(r){return e(r.value)}),i=this._ctx,n=e,i.isMatch=Sy(i.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.key,r)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.primaryKey,r)})}keys(e){var i=this._ctx;i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(e)}primaryKeys(e){var i=this._ctx;if(i.dir==="next"&&eI(i,!0)&&i.limit>0)return this._read(r=>{var a=$R(i,i.table.core.schema);return i.table.core.query({trans:r,values:!1,limit:i.limit,query:{index:a,range:i.range}})}).then(({result:r})=>r).then(e);i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(i){return i[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,i=e.index&&e.table.schema.idxByName[e.index];if(!i||!i.multi)return this;var n={};return vF(this._ctx,function(r){var a=r.primaryKey.toString(),o=Gu(n,a);return n[a]=!0,!o}),this}modify(e){var i=this._ctx;return this._write(n=>{var r;if(typeof e=="function")r=e;else{var a=Wa(e),o=a.length;r=function(m){for(var g=!1,v=0;v<o;++v){var y=a[v],b=e[y];Zf(m,y)!==b&&(fd(m,y,b),g=!0)}return g}}const s=i.table.core,{outbound:l,extractKey:u}=s.schema.primaryKey,c=this.db._options.modifyChunkSize||200,d=[];let p=0;const f=[],h=(m,g)=>{const{failures:v,numFailures:y}=g;p+=m-y;for(let b of Wa(v))d.push(v[b])};return this.clone().primaryKeys().then(m=>{const g=v=>{const y=Math.min(c,m.length-v);return s.getMany({trans:n,keys:m.slice(v,v+y),cache:"immutable"}).then(b=>{const I=[],T=[],w=l?[]:null,S=[];for(let P=0;P<y;++P){const E=b[P],D={value:UE(E),primKey:m[v+P]};r.call(D,D.value,D)!==!1&&(D.value==null?S.push(m[v+P]):l||Os(u(E),u(D.value))===0?(T.push(D.value),l&&w.push(m[v+P])):(S.push(m[v+P]),I.push(D.value)))}const U=eI(i)&&i.limit===1/0&&(typeof e!="function"||e===bF)&&{index:i.index,range:i.range};return Promise.resolve(I.length>0&&s.mutate({trans:n,type:"add",values:I}).then(P=>{for(let E in P.failures)S.splice(parseInt(E),1);h(I.length,P)})).then(()=>(T.length>0||U&&typeof e=="object")&&s.mutate({trans:n,type:"put",keys:w,values:T,criteria:U,changeSpec:typeof e!="function"&&e}).then(P=>h(T.length,P))).then(()=>(S.length>0||U&&e===bF)&&s.mutate({trans:n,type:"delete",keys:S,criteria:U}).then(P=>h(S.length,P))).then(()=>m.length>v+y&&g(v+c))})};return g(0).then(()=>{if(d.length>0)throw new GN("Error modifying one or more objects",d,p,f);return m.length})})})}delete(){var e=this._ctx,i=e.range;return eI(e)&&(e.isPrimKey&&!I6e||i.type===3)?this._write(n=>{const{primaryKey:r}=e.table.core.schema,a=i;return e.table.core.count({trans:n,query:{index:r,range:a}}).then(o=>e.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(({failures:s,lastResult:l,results:u,numFailures:c})=>{if(c)throw new GN("Could not delete some values",Object.keys(s).map(d=>s[d]),o-c);return o-c}))}):this.modify(bF)}}const bF=(t,e)=>e.value=null;function T6e(t,e){return t<e?-1:t===e?0:1}function U6e(t,e){return t>e?-1:t===e?0:1}function gu(t,e,i){var n=t instanceof bwe?new t.Collection(t):t;return n._ctx.error=i?new i(e):new TypeError(e),n}function tI(t){return new t.Collection(t,()=>ywe("")).limit(0)}function D6e(t,e,i,n,r,a){for(var o=Math.min(t.length,n.length),s=-1,l=0;l<o;++l){var u=e[l];if(u!==n[l])return r(t[l],i[l])<0?t.substr(0,l)+i[l]+i.substr(l+1):r(t[l],n[l])<0?t.substr(0,l)+n[l]+i.substr(l+1):s>=0?t.substr(0,s)+e[s]+i.substr(s+1):null;r(t[l],u)<0&&(s=l)}return o<n.length&&a==="next"?t+i.substr(t.length):o<t.length&&a==="prev"?t.substr(0,i.length):s<0?null:t.substr(0,s)+n[s]+i.substr(s+1)}function SC(t,e,i,n){var r,a,o,s,l,u,c,d=i.length;if(!i.every(m=>typeof m=="string"))return gu(t,mwe);function p(m){r=function(v){return v==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(m),a=function(v){return v==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(m),o=m==="next"?T6e:U6e;var g=i.map(function(v){return{lower:a(v),upper:r(v)}}).sort(function(v,y){return o(v.lower,y.lower)});s=g.map(function(v){return v.upper}),l=g.map(function(v){return v.lower}),u=m,c=m==="next"?"":n}p("next");var f=new t.Collection(t,()=>hm(s[0],l[d-1]+n));f._ondirectionchange=function(m){p(m)};var h=0;return f._addAlgorithm(function(m,g,v){var y=m.key;if(typeof y!="string")return!1;var b=a(y);if(e(b,l,h))return!0;for(var I=null,T=h;T<d;++T){var w=D6e(y,b,s[T],l[T],o,u);w===null&&I===null?h=T+1:(I===null||o(I,w)>0)&&(I=w)}return g(I!==null?function(){m.continue(I+c)}:v),!1}),f}function hm(t,e,i,n){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:n}}function ywe(t){return{type:1,lower:t,upper:t}}class bwe{get Collection(){return this._ctx.table.db.Collection}between(e,i,n,r){n=n!==!1,r=r===!0;try{return this._cmp(e,i)>0||this._cmp(e,i)===0&&(n||r)&&(!n||!r)?tI(this):new this.Collection(this,()=>hm(e,i,!n,!r))}catch{return gu(this,Ef)}}equals(e){return e==null?gu(this,Ef):new this.Collection(this,()=>ywe(e))}above(e){return e==null?gu(this,Ef):new this.Collection(this,()=>hm(e,void 0,!0))}aboveOrEqual(e){return e==null?gu(this,Ef):new this.Collection(this,()=>hm(e,void 0,!1))}below(e){return e==null?gu(this,Ef):new this.Collection(this,()=>hm(void 0,e,!1,!0))}belowOrEqual(e){return e==null?gu(this,Ef):new this.Collection(this,()=>hm(void 0,e))}startsWith(e){return typeof e!="string"?gu(this,mwe):this.between(e,e+gv,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):SC(this,(i,n)=>i.indexOf(n[0])===0,[e],gv)}equalsIgnoreCase(e){return SC(this,(i,n)=>i===n[0],[e],"")}anyOfIgnoreCase(){var e=$f.apply(gI,arguments);return e.length===0?tI(this):SC(this,(i,n)=>n.indexOf(i)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=$f.apply(gI,arguments);return e.length===0?tI(this):SC(this,(i,n)=>n.some(r=>i.indexOf(r)===0),e,gv)}anyOf(){const e=$f.apply(gI,arguments);let i=this._cmp;try{e.sort(i)}catch{return gu(this,Ef)}if(e.length===0)return tI(this);const n=new this.Collection(this,()=>hm(e[0],e[e.length-1]));n._ondirectionchange=a=>{i=a==="next"?this._ascending:this._descending,e.sort(i)};let r=0;return n._addAlgorithm((a,o,s)=>{const l=a.key;for(;i(l,e[r])>0;)if(++r,r===e.length)return o(s),!1;return i(l,e[r])===0||(o(()=>{a.continue(e[r])}),!1)}),n}notEqual(e){return this.inAnyRange([[k$,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=$f.apply(gI,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return gu(this,Ef)}const i=e.reduce((n,r)=>n?n.concat([[n[n.length-1][1],r]]):[[k$,r]],null);return i.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,i){const n=this._cmp,r=this._ascending,a=this._descending,o=this._min,s=this._max;if(e.length===0)return tI(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&r(y[0],y[1])<=0))return gu(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",pi.InvalidArgument);const l=!i||i.includeLowers!==!1,u=i&&i.includeUppers===!0;let c,d=r;function p(y,b){return d(y[0],b[0])}try{c=e.reduce(function(y,b){let I=0,T=y.length;for(;I<T;++I){const w=y[I];if(n(b[0],w[1])<0&&n(b[1],w[0])>0){w[0]=o(w[0],b[0]),w[1]=s(w[1],b[1]);break}}return I===T&&y.push(b),y},[]),c.sort(p)}catch{return gu(this,Ef)}let f=0;const h=u?y=>r(y,c[f][1])>0:y=>r(y,c[f][1])>=0,m=l?y=>a(y,c[f][0])>0:y=>a(y,c[f][0])>=0;let g=h;const v=new this.Collection(this,()=>hm(c[0][0],c[c.length-1][1],!l,!u));return v._ondirectionchange=y=>{y==="next"?(g=h,d=r):(g=m,d=a),c.sort(p)},v._addAlgorithm((y,b,I)=>{for(var T=y.key;g(T);)if(++f,f===c.length)return b(I),!1;return!!function(w){return!h(w)&&!m(w)}(T)||(this._cmp(T,c[f][1])===0||this._cmp(T,c[f][0])===0||b(()=>{d===r?y.continue(c[f][0]):y.continue(c[f][1])}),!1)}),v}startsWithAnyOf(){const e=$f.apply(gI,arguments);return e.every(i=>typeof i=="string")?e.length===0?tI(this):this.inAnyRange(e.map(i=>[i,i+gv])):gu(this,"startsWithAnyOf() only works with strings")}}function Yd(t){return ea(function(e){return m1(e),t(e.target.error),!1})}function m1(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const g1="storagemutated",Tm="x-storagemutated-1",hg=zT(null,g1);class P6e{_lock(){return uT(!Xt.global),++this._reculock,this._reculock!==1||Xt.global||(Xt.lockOwnerFor=this),this}_unlock(){if(uT(!Xt.global),--this._reculock==0)for(Xt.global||(Xt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{PS(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&Xt.lockOwnerFor!==this}create(e){if(!this.mode)return this;const i=this.db.idbdb,n=this.db._state.dbOpenError;if(uT(!this.idbtrans),!e&&!i)switch(n&&n.name){case"DatabaseClosedError":throw new pi.DatabaseClosed(n);case"MissingAPIError":throw new pi.MissingAPI(n.message,n);default:throw new pi.OpenFailed(n)}if(!this.active)throw new pi.TransactionInactive;return uT(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):i.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ea(r=>{m1(r),this._reject(e.error)}),e.onabort=ea(r=>{m1(r),this.active&&this._reject(new pi.Abort(e.error)),this.active=!1,this.on("abort").fire(r)}),e.oncomplete=ea(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&hg.storagemutated.fire(e.mutatedParts)}),this}_promise(e,i,n){if(e==="readwrite"&&this.mode!=="readwrite")return fo(new pi.ReadOnly("Transaction is readonly"));if(!this.active)return fo(new pi.TransactionInactive);if(this._locked())return new Ut((a,o)=>{this._blockedFuncs.push([()=>{this._promise(e,i,n).then(a,o)},Xt])});if(n)return pg(()=>{var a=new Ut((o,s)=>{this._lock();const l=i(o,s,this);l&&l.then&&l.then(o,s)});return a.finally(()=>this._unlock()),a._lib=!0,a});var r=new Ut((a,o)=>{var s=i(a,o,this);s&&s.then&&s.then(a,o)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var i=this._root();const n=Ut.resolve(e);if(i._waitingFor)i._waitingFor=i._waitingFor.then(()=>n);else{i._waitingFor=n,i._waitingQueue=[];var r=i.idbtrans.objectStore(i.storeNames[0]);(function o(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(r.get(-1/0).onsuccess=o)})()}var a=i._waitingFor;return new Ut((o,s)=>{n.then(l=>i._waitingQueue.push(ea(o.bind(null,l))),l=>i._waitingQueue.push(ea(s.bind(null,l)))).finally(()=>{i._waitingFor===a&&(i._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new pi.Abort))}table(e){const i=this._memoizedTables||(this._memoizedTables={});if(Gu(i,e))return i[e];const n=this.schema[e];if(!n)throw new pi.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),i[e]=r,r}}function O$(t,e,i,n,r,a,o){return{name:t,keyPath:e,unique:i,multi:n,auto:r,compound:a,src:(i&&!o?"&":"")+(n?"*":"")+(r?"++":"")+Iwe(e)}}function Iwe(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function wwe(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:JIe(i,n=>[n.name,n])}}let v1=t=>{try{return t.only([[]]),v1=()=>[[]],[[]]}catch{return v1=()=>gv,gv}};function x$(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>Zf(n,e)}(t):e=>Zf(e,t)}function NY(t){return[].slice.call(t)}let E6e=0;function qT(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function C6e(t,e,i){function n(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:c,lowerOpen:d,upperOpen:p}=l;return u===void 0?c===void 0?null:e.upperBound(c,!!p):c===void 0?e.lowerBound(u,!!d):e.bound(u,c,!!d,!!p)}const{schema:r,hasGetAll:a}=function(l,u){const c=NY(l.objectStoreNames);return{schema:{name:l.name,tables:c.map(d=>u.objectStore(d)).map(d=>{const{keyPath:p,autoIncrement:f}=d,h=fs(p),m=p==null,g={},v={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:h,keyPath:p,autoIncrement:f,unique:!0,extractKey:x$(p)},indexes:NY(d.indexNames).map(y=>d.index(y)).map(y=>{const{name:b,unique:I,multiEntry:T,keyPath:w}=y,S={name:b,compound:fs(w),keyPath:w,unique:I,multiEntry:T,extractKey:x$(w)};return g[qT(w)]=S,S}),getIndexByKeyPath:y=>g[qT(y)]};return g[":id"]=v.primaryKey,p!=null&&(g[qT(p)]=v.primaryKey),v})},hasGetAll:c.length>0&&"getAll"in u.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,i),o=r.tables.map(l=>function(u){const c=u.name;return{name:c,schema:u,mutate:function({trans:d,type:p,keys:f,values:h,range:m}){return new Promise((g,v)=>{g=ea(g);const y=d.objectStore(c),b=y.keyPath==null,I=p==="put"||p==="add";if(!I&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);const{length:T}=f||h||{length:1};if(f&&h&&f.length!==h.length)throw new Error("Given keys array must have same length as given values array.");if(T===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let w;const S=[],U=[];let P=0;const E=R=>{++P,m1(R)};if(p==="deleteRange"){if(m.type===4)return g({numFailures:P,failures:U,results:[],lastResult:void 0});m.type===3?S.push(w=y.clear()):S.push(w=y.delete(n(m)))}else{const[R,N]=I?b?[h,f]:[h,null]:[f,null];if(I)for(let M=0;M<T;++M)S.push(w=N&&N[M]!==void 0?y[p](R[M],N[M]):y[p](R[M])),w.onerror=E;else for(let M=0;M<T;++M)S.push(w=y[p](R[M])),w.onerror=E}const D=R=>{const N=R.target.result;S.forEach((M,A)=>M.error!=null&&(U[A]=M.error)),g({numFailures:P,failures:U,results:p==="delete"?f:S.map(M=>M.result),lastResult:N})};w.onerror=R=>{E(R),D(R)},w.onsuccess=D})},getMany:({trans:d,keys:p})=>new Promise((f,h)=>{f=ea(f);const m=d.objectStore(c),g=p.length,v=new Array(g);let y,b=0,I=0;const T=S=>{const U=S.target;v[U._pos]=U.result,++I===b&&f(v)},w=Yd(h);for(let S=0;S<g;++S)p[S]!=null&&(y=m.get(p[S]),y._pos=S,y.onsuccess=T,y.onerror=w,++b);b===0&&f(v)}),get:({trans:d,key:p})=>new Promise((f,h)=>{f=ea(f);const m=d.objectStore(c).get(p);m.onsuccess=g=>f(g.target.result),m.onerror=Yd(h)}),query:function(d){return p=>new Promise((f,h)=>{f=ea(f);const{trans:m,values:g,limit:v,query:y}=p,b=v===1/0?void 0:v,{index:I,range:T}=y,w=m.objectStore(c),S=I.isPrimaryKey?w:w.index(I.name),U=n(T);if(v===0)return f({result:[]});if(d){const P=g?S.getAll(U,b):S.getAllKeys(U,b);P.onsuccess=E=>f({result:E.target.result}),P.onerror=Yd(h)}else{let P=0;const E=g||!("openKeyCursor"in S)?S.openCursor(U):S.openKeyCursor(U),D=[];E.onsuccess=R=>{const N=E.result;return N?(D.push(g?N.value:N.primaryKey),++P===v?f({result:D}):void N.continue()):f({result:D})},E.onerror=Yd(h)}})}(a),openCursor:function({trans:d,values:p,query:f,reverse:h,unique:m}){return new Promise((g,v)=>{g=ea(g);const{index:y,range:b}=f,I=d.objectStore(c),T=y.isPrimaryKey?I:I.index(y.name),w=h?m?"prevunique":"prev":m?"nextunique":"next",S=p||!("openKeyCursor"in T)?T.openCursor(n(b),w):T.openKeyCursor(n(b),w);S.onerror=Yd(v),S.onsuccess=ea(U=>{const P=S.result;if(!P)return void g(null);P.___id=++E6e,P.done=!1;const E=P.continue.bind(P);let D=P.continuePrimaryKey;D&&(D=D.bind(P));const R=P.advance.bind(P),N=()=>{throw new Error("Cursor not stopped")};P.trans=d,P.stop=P.continue=P.continuePrimaryKey=P.advance=()=>{throw new Error("Cursor not started")},P.fail=ea(v),P.next=function(){let M=1;return this.start(()=>M--?this.continue():this.stop()).then(()=>this)},P.start=M=>{const A=new Promise((k,B)=>{k=ea(k),S.onerror=Yd(B),P.fail=B,P.stop=F=>{P.stop=P.continue=P.continuePrimaryKey=P.advance=N,k(F)}}),_=()=>{if(S.result)try{M()}catch(k){P.fail(k)}else P.done=!0,P.start=()=>{throw new Error("Cursor behind last entry")},P.stop()};return S.onsuccess=ea(k=>{S.onsuccess=_,_()}),P.continue=E,P.continuePrimaryKey=D,P.advance=R,_(),A},g(P)},v)})},count({query:d,trans:p}){const{index:f,range:h}=d;return new Promise((m,g)=>{const v=p.objectStore(c),y=f.isPrimaryKey?v:v.index(f.name),b=n(h),I=b?y.count(b):y.count();I.onsuccess=ea(T=>m(T.target.result)),I.onerror=Yd(g)})}}}(l)),s={};return o.forEach(l=>s[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!s[l])throw new Error(`Table '${l}' not found`);return s[l]},MIN_KEY:-1/0,MAX_KEY:v1(e),schema:r}}function L$({_novip:t},e){const i=e.db,n=function(r,a,{IDBKeyRange:o,indexedDB:s},l){return{dbcore:function(c,d){return d.reduce((p,{create:f})=>({...p,...f(p)}),c)}(C6e(a,o,l),r.dbcore)}}(t._middlewares,i,t._deps,e);t.core=n.dbcore,t.tables.forEach(r=>{const a=r.name;t.core.schema.tables.some(o=>o.name===a)&&(r.core=t.core.table(a),t[a]instanceof t.Table&&(t[a].core=r.core))})}function KN({_novip:t},e,i,n){i.forEach(r=>{const a=n[r];e.forEach(o=>{const s=S6(o,r);(!s||"value"in s&&s.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Yf(o,r,{get(){return this.table(r)},set(l){YIe(this,r,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[r]=new t.Table(r,a))})})}function F$({_novip:t},e){e.forEach(i=>{for(let n in i)i[n]instanceof t.Table&&delete i[n]})}function R6e(t,e){return t._cfg.version-e._cfg.version}function M6e(t,e,i,n){const r=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,r);a.create(i),a._completion.catch(n);const o=a._reject.bind(a),s=Xt.transless||Xt;pg(()=>{Xt.trans=a,Xt.transless=s,e===0?(Wa(r).forEach(l=>{IF(i,l,r[l].primKey,r[l].indexes)}),L$(t,i),Ut.follow(()=>t.on.populate.fire(a)).catch(o)):function({_novip:l},u,c,d){const p=[],f=l._versions;let h=l._dbSchema=$$(l,l.idbdb,d),m=!1;const g=f.filter(y=>y._cfg.version>=u);function v(){return p.length?Ut.resolve(p.shift()(c.idbtrans)).then(v):Ut.resolve()}return g.forEach(y=>{p.push(()=>{const b=h,I=y._cfg.dbschema;V$(l,b,d),V$(l,I,d),h=l._dbSchema=I;const T=Swe(b,I);T.add.forEach(S=>{IF(d,S[0],S[1].primKey,S[1].indexes)}),T.change.forEach(S=>{if(S.recreate)throw new pi.Upgrade("Not yet support for changing primary key");{const U=d.objectStore(S.name);S.add.forEach(P=>B$(U,P)),S.change.forEach(P=>{U.deleteIndex(P.name),B$(U,P)}),S.del.forEach(P=>U.deleteIndex(P))}});const w=y._cfg.contentUpgrade;if(w&&y._cfg.version>u){L$(l,d),c._memoizedTables={},m=!0;let S=QIe(I);T.del.forEach(D=>{S[D]=b[D]}),F$(l,[l.Transaction.prototype]),KN(l,[l.Transaction.prototype],Wa(S),S),c.schema=S;const U=T6(w);let P;U&&DS();const E=Ut.follow(()=>{if(P=w(c),P&&U){var D=Ih.bind(null,null);P.then(D,D)}});return P&&typeof P.then=="function"?Ut.resolve(P):E.then(()=>P)}}),p.push(b=>{(!m||!b6e)&&function(I,T){[].slice.call(T.db.objectStoreNames).forEach(w=>I[w]==null&&T.db.deleteObjectStore(w))}(y._cfg.dbschema,b),F$(l,[l.Transaction.prototype]),KN(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),c.schema=l._dbSchema})}),v().then(()=>{var y,b;b=d,Wa(y=h).forEach(I=>{b.db.objectStoreNames.contains(I)||IF(b,I,y[I].primKey,y[I].indexes)})})}(t,e,a,i).catch(o)})}function Swe(t,e){const i={del:[],add:[],change:[]};let n;for(n in t)e[n]||i.del.push(n);for(n in e){const r=t[n],a=e[n];if(r){const o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||r.primKey.auto!==a.primKey.auto&&!Cx)o.recreate=!0,i.change.push(o);else{const s=r.idxByName,l=a.idxByName;let u;for(u in s)l[u]||o.del.push(u);for(u in l){const c=s[u],d=l[u];c?c.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&i.change.push(o)}}else i.add.push([n,a])}return i}function IF(t,e,i,n){const r=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return n.forEach(a=>B$(r,a)),r}function B$(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function $$(t,e,i){const n={};return jN(e.objectStoreNames,0).forEach(r=>{const a=i.objectStore(r);let o=a.keyPath;const s=O$(Iwe(o),o||"",!1,!1,!!a.autoIncrement,o&&typeof o!="string",!0),l=[];for(let c=0;c<a.indexNames.length;++c){const d=a.index(a.indexNames[c]);o=d.keyPath;var u=O$(d.name,o,!!d.unique,!!d.multiEntry,!1,o&&typeof o!="string",!1);l.push(u)}n[r]=wwe(r,s,l)}),n}function V$({_novip:t},e,i){const n=i.db.objectStoreNames;for(let r=0;r<n.length;++r){const a=n[r],o=i.objectStore(a);t._hasGetAll="getAll"in o;for(let s=0;s<o.indexNames.length;++s){const l=o.indexNames[s],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+jN(u).join("+")+"]";if(e[a]){const d=e[a].idxByName[c];d&&(d.name=l,delete e[a].idxByName[c],e[a].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Fr.WorkerGlobalScope&&Fr instanceof Fr.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class N6e{_parseStoresSpec(e,i){Wa(e).forEach(n=>{if(e[n]!==null){var r=e[n].split(",").map((o,s)=>{const l=(o=o.trim()).replace(/([&*]|\+\+)/g,""),u=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return O$(l,u||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),fs(u),s===0)}),a=r.shift();if(a.multi)throw new pi.Schema("Primary key cannot be multi-valued");r.forEach(o=>{if(o.auto)throw new pi.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new pi.Schema("Index must have a name and cannot be an empty string")}),i[n]=wwe(n,a,r)}})}stores(e){const i=this.db;this._cfg.storesSource=this._cfg.storesSource?al(this._cfg.storesSource,e):e;const n=i._versions,r={};let a={};return n.forEach(o=>{al(r,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(r,a)}),i._dbSchema=a,F$(i,[i._allTables,i,i.Transaction.prototype]),KN(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],Wa(a),a),i._storeNames=Wa(a),this}upgrade(e){return this._cfg.contentUpgrade=P6(this._cfg.contentUpgrade||mr,e),this}}function M6(t,e){let i=t._dbNamesDB;return i||(i=t._dbNamesDB=new pp(Rx,{addons:[],indexedDB:t,IDBKeyRange:e}),i.version(1).stores({dbnames:"name"})),i.table("dbnames")}function N6(t){return t&&typeof t.databases=="function"}function j$(t){return pg(function(){return Xt.letThrough=!0,t()})}function A6e(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function _6e(t){const e=t._state,{indexedDB:i}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?fo(e.dbOpenError):t);hf&&(e.openCanceller._stackHolder=kb()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function r(){if(e.openCanceller!==n)throw new pi.DatabaseClosed("db.open() was cancelled")}let a=e.dbReadyResolve,o=null,s=!1;const l=()=>new Ut((u,c)=>{if(r(),!i)throw new pi.MissingAPI;const d=t.name,p=e.autoSchema?i.open(d):i.open(d,Math.round(10*t.verno));if(!p)throw new pi.MissingAPI;p.onerror=Yd(c),p.onblocked=ea(t._fireOnBlocked),p.onupgradeneeded=ea(f=>{if(o=p.transaction,e.autoSchema&&!t._options.allowEmptyDB){p.onerror=m1,o.abort(),p.result.close();const m=i.deleteDatabase(d);m.onsuccess=m.onerror=ea(()=>{c(new pi.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{o.onerror=Yd(c);var h=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;s=h<1,t._novip.idbdb=p.result,M6e(t,h/10,o,c)}},c),p.onsuccess=ea(()=>{o=null;const f=t._novip.idbdb=p.result,h=jN(f.objectStoreNames);if(h.length>0)try{const g=f.transaction((m=h).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:v},y,b){v.verno=y.version/10;const I=v._dbSchema=$$(0,y,b);v._storeNames=jN(y.objectStoreNames,0),KN(v,[v._allTables],Wa(I),I)}(t,f,g):(V$(t,t._dbSchema,g),function(v,y){const b=Swe($$(0,v.idbdb,y),v._dbSchema);return!(b.add.length||b.change.some(I=>I.add.length||I.change.length))}(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),L$(t,g)}catch{}var m;HT.push(t),f.onversionchange=ea(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),f.onclose=ea(g=>{t.on("close").fire(g)}),s&&function({indexedDB:g,IDBKeyRange:v},y){!N6(g)&&y!==Rx&&M6(g,v).put({name:y}).catch(mr)}(t._deps,d),u()},c)}).catch(u=>u&&u.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):Ut.reject(u));return Ut.race([n,(typeof navigator>"u"?Ut.resolve():A6e()).then(l)]).then(()=>(r(),e.onReadyBeingFired=[],Ut.resolve(j$(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(P6,mr);return e.onReadyBeingFired=[],Ut.resolve(j$(()=>c(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch{}return n===e.openCanceller&&t._close(),fo(u)}).finally(()=>{e.openComplete=!0,a()})}function G$(t){var e=a=>t.next(a),i=r(e),n=r(a=>t.throw(a));function r(a){return o=>{var s=a(o),l=s.value;return s.done?l:l&&typeof l.then=="function"?l.then(i,n):fs(l)?Promise.all(l).then(i,n):i(l)}}return r(e)()}function k6e(t,e,i){var n=arguments.length;if(n<2)throw new pi.InvalidArgument("Too few arguments");for(var r=new Array(n-1);--n;)r[n-1]=arguments[n];return i=r.pop(),[t,ewe(r),i]}function Twe(t,e,i,n,r){return Ut.resolve().then(()=>{const a=Xt.transless||Xt,o=t._createTransaction(e,i,t._dbSchema,n),s={trans:o,transless:a};if(n)o.idbtrans=n.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===D6.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Twe(t,e,i,null,r))):fo(d)}const l=T6(r);let u;l&&DS();const c=Ut.follow(()=>{if(u=r.call(o,o),u)if(l){var d=Ih.bind(null,null);u.then(d,d)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=G$(u))},s);return(u&&typeof u.then=="function"?Ut.resolve(u).then(d=>o.active?d:fo(new pi.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(d=>(n&&o._resolve(),o._completion.then(()=>d))).catch(d=>(o._reject(d),fo(d)))})}function TC(t,e,i){const n=fs(t)?t.slice():[t];for(let r=0;r<i;++r)n.push(e);return n}const O6e={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const i=t.table(e),{schema:n}=i,r={},a=[];function o(c,d,p){const f=qT(c),h=r[f]=r[f]||[],m=c==null?0:typeof c=="string"?1:c.length,g=d>0,v={...p,isVirtual:g,keyTail:d,keyLength:m,extractKey:x$(c),unique:!g&&p.unique};return h.push(v),v.isPrimaryKey||a.push(v),m>1&&o(m===2?c[0]:c.slice(0,m-1),d+1,p),h.sort((y,b)=>y.keyTail-b.keyTail),v}const s=o(n.primaryKey.keyPath,0,n.primaryKey);r[":id"]=[s];for(const c of n.indexes)o(c.keyPath,0,c);function l(c){const d=c.query.index;return d.isVirtual?{...c,query:{index:d,range:(p=c.query.range,f=d.keyTail,{type:p.type===1?2:p.type,lower:TC(p.lower,p.lowerOpen?t.MAX_KEY:t.MIN_KEY,f),lowerOpen:!0,upper:TC(p.upper,p.upperOpen?t.MIN_KEY:t.MAX_KEY,f),upperOpen:!0})}}:c;var p,f}return{...i,schema:{...n,primaryKey:s,indexes:a,getIndexByKeyPath:function(c){const d=r[qT(c)];return d&&d[0]}},count:c=>i.count(l(c)),query:c=>i.query(l(c)),openCursor(c){const{keyTail:d,isVirtual:p,keyLength:f}=c.query.index;return p?i.openCursor(l(c)).then(h=>h&&function(m){return Object.create(m,{continue:{value:function(v){v!=null?m.continue(TC(v,c.reverse?t.MAX_KEY:t.MIN_KEY,d)):c.unique?m.continue(m.key.slice(0,f).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,d)):m.continue()}},continuePrimaryKey:{value(v,y){m.continuePrimaryKey(TC(v,t.MAX_KEY,d),y)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const v=m.key;return f===1?v[0]:v.slice(0,f)}},value:{get:()=>m.value}})}(h)):i.openCursor(c)}}}}}};function A6(t,e,i,n){return i=i||{},n=n||"",Wa(t).forEach(r=>{if(Gu(e,r)){var a=t[r],o=e[r];if(typeof a=="object"&&typeof o=="object"&&a&&o){const s=S$(a);s!==S$(o)?i[n+r]=e[r]:s==="Object"?A6(a,o,i,n+r+"."):a!==o&&(i[n+r]=e[r])}else a!==o&&(i[n+r]=e[r])}else i[n+r]=void 0}),Wa(e).forEach(r=>{Gu(t,r)||(i[n+r]=e[r])}),i}const x6e={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const i=t.table(e),{primaryKey:n}=i.schema;return{...i,mutate(a){const o=Xt.trans,{deleting:s,creating:l,updating:u}=o.table(e).hook;switch(a.type){case"add":if(l.fire===mr)break;return o._promise("readwrite",()=>c(a),!0);case"put":if(l.fire===mr&&u.fire===mr)break;return o._promise("readwrite",()=>c(a),!0);case"delete":if(s.fire===mr)break;return o._promise("readwrite",()=>c(a),!0);case"deleteRange":if(s.fire===mr)break;return o._promise("readwrite",()=>function(p){return d(p.trans,p.range,1e4)}(a),!0)}return i.mutate(a);function c(p){const f=Xt.trans,h=p.keys||function(m,g){return g.type==="delete"?g.keys:g.keys||g.values.map(m.extractKey)}(n,p);if(!h)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?{...p,keys:h}:{...p}).type!=="delete"&&(p.values=[...p.values]),p.keys&&(p.keys=[...p.keys]),function(m,g,v){return g.type==="add"?Promise.resolve([]):m.getMany({trans:g.trans,keys:v,cache:"immutable"})}(i,p,h).then(m=>{const g=h.map((v,y)=>{const b=m[y],I={onerror:null,onsuccess:null};if(p.type==="delete")s.fire.call(I,v,b,f);else if(p.type==="add"||b===void 0){const T=l.fire.call(I,v,p.values[y],f);v==null&&T!=null&&(v=T,p.keys[y]=v,n.outbound||fd(p.values[y],n.keyPath,v))}else{const T=A6(b,p.values[y]),w=u.fire.call(I,T,v,b,f);if(w){const S=p.values[y];Object.keys(w).forEach(U=>{Gu(S,U)?S[U]=w[U]:fd(S,U,w[U])})}}return I});return i.mutate(p).then(({failures:v,results:y,numFailures:b,lastResult:I})=>{for(let T=0;T<h.length;++T){const w=y?y[T]:h[T],S=g[T];w==null?S.onerror&&S.onerror(v[T]):S.onsuccess&&S.onsuccess(p.type==="put"&&m[T]?p.values[T]:w)}return{failures:v,results:y,numFailures:b,lastResult:I}}).catch(v=>(g.forEach(y=>y.onerror&&y.onerror(v)),Promise.reject(v)))})}function d(p,f,h){return i.query({trans:p,values:!1,query:{index:n,range:f},limit:h}).then(({result:m})=>c({type:"delete",keys:m,trans:p}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):m.length<h?{failures:[],numFailures:0,lastResult:void 0}:d(p,{...f,lower:m[m.length-1],lowerOpen:!0},h)))}}}}})};function Uwe(t,e,i){try{if(!e||e.keys.length<t.length)return null;const n=[];for(let r=0,a=0;r<e.keys.length&&a<t.length;++r)Os(e.keys[r],t[a])===0&&(n.push(i?UE(e.values[r]):e.values[r]),++a);return n.length===t.length?n:null}catch{return null}}const L6e={stack:"dbcore",level:-1,create:t=>({table:e=>{const i=t.table(e);return{...i,getMany:n=>{if(!n.cache)return i.getMany(n);const r=Uwe(n.keys,n.trans._cache,n.cache==="clone");return r?Ut.resolve(r):i.getMany(n).then(a=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?UE(a):a},a))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),i.mutate(n))}}})};function _6(t){return!("from"in t)}const Bf=function(t,e){if(!this){const i=new Bf;return t&&"d"in t&&al(i,t),i}al(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function y1(t,e,i){const n=Os(e,i);if(isNaN(n))return;if(n>0)throw RangeError();if(_6(t))return al(t,{from:e,to:i,d:1});const r=t.l,a=t.r;if(Os(i,t.from)<0)return r?y1(r,e,i):t.l={from:e,to:i,d:1,l:null,r:null},AY(t);if(Os(e,t.to)>0)return a?y1(a,e,i):t.r={from:e,to:i,d:1,l:null,r:null},AY(t);Os(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),Os(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;r&&!t.l&&YN(t,r),a&&o&&YN(t,a)}function YN(t,e){_6(e)||function i(n,{from:r,to:a,l:o,r:s}){y1(n,r,a),o&&i(n,o),s&&i(n,s)}(t,e)}function F6e(t,e){const i=H$(e);let n=i.next();if(n.done)return!1;let r=n.value;const a=H$(t);let o=a.next(r.from),s=o.value;for(;!n.done&&!o.done;){if(Os(s.from,r.to)<=0&&Os(s.to,r.from)>=0)return!0;Os(r.from,s.from)<0?r=(n=i.next(s.from)).value:s=(o=a.next(r.from)).value}return!1}function H$(t){let e=_6(t)?null:{s:0,n:t};return{next(i){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Os(i,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Os(i,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function AY(t){var e,i;const n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((i=t.l)===null||i===void 0?void 0:i.d)||0),r=n>1?"r":n<-1?"l":"";if(r){const a=r==="r"?"l":"r",o={...t},s=t[r];t.from=s.from,t.to=s.to,t[r]=s[r],o[r]=s[a],t[a]=o,o.d=_Y(o)}t.d=_Y(t)}function _Y({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}zw(Bf.prototype,{add(t){return YN(this,t),this},addKey(t){return y1(this,t,t),this},addKeys(t){return t.forEach(e=>y1(this,e,e)),this},[T$](){return H$(this)}});const B6e={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,i=new Bf(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const r=t.table(n),{schema:a}=r,{primaryKey:o}=a,{extractKey:s,outbound:l}=o,u={...r,mutate:p=>{const f=p.trans,h=f.mutatedParts||(f.mutatedParts={}),m=w=>{const S=`idb://${e}/${n}/${w}`;return h[S]||(h[S]=new Bf)},g=m(""),v=m(":dels"),{type:y}=p;let[b,I]=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[];const T=p.trans._cache;return r.mutate(p).then(w=>{if(fs(b)){y!=="delete"&&(b=w.results),g.addKeys(b);const S=Uwe(b,T);S||y==="add"||v.addKeys(b),(S||I)&&function(U,P,E,D){function R(N){const M=U(N.name||"");function A(k){return k!=null?N.extractKey(k):null}const _=k=>N.multiEntry&&fs(k)?k.forEach(B=>M.addKey(B)):M.addKey(k);(E||D).forEach((k,B)=>{const F=E&&A(E[B]),x=D&&A(D[B]);Os(F,x)!==0&&(F!=null&&_(F),x!=null&&_(x))})}P.indexes.forEach(R)}(m,a,S,I)}else if(b){const S={from:b.lower,to:b.upper};v.add(S),g.add(S)}else g.add(i),v.add(i),a.indexes.forEach(S=>m(S.name).add(i));return w})}},c=({query:{index:p,range:f}})=>{var h,m;return[p,new Bf((h=f.lower)!==null&&h!==void 0?h:t.MIN_KEY,(m=f.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},d={get:p=>[o,new Bf(p.key)],getMany:p=>[o,new Bf().addKeys(p.keys)],count:c,query:c,openCursor:c};return Wa(d).forEach(p=>{u[p]=function(f){const{subscr:h}=Xt;if(h){const m=I=>{const T=`idb://${e}/${n}/${I}`;return h[T]||(h[T]=new Bf)},g=m(""),v=m(":dels"),[y,b]=d[p](f);if(m(y.name||"").add(b),!y.isPrimaryKey){if(p!=="count"){const I=p==="query"&&l&&f.values&&r.query({...f,values:!1});return r[p].apply(this,arguments).then(T=>{if(p==="query"){if(l&&f.values)return I.then(({result:S})=>(g.addKeys(S),T));const w=f.values?T.result.map(s):T.result;f.values?g.addKeys(w):v.addKeys(w)}else if(p==="openCursor"){const w=T,S=f.values;return w&&Object.create(w,{key:{get:()=>(v.addKey(w.primaryKey),w.key)},primaryKey:{get(){const U=w.primaryKey;return v.addKey(U),U}},value:{get:()=>(S&&g.addKey(w.primaryKey),w.value)}})}return T})}v.add(i)}}return r[p].apply(this,arguments)}}),u}}}};class pp{constructor(e,i){this._middlewares={},this.verno=0;const n=pp.dependencies;this._options=i={addons:pp.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...i},this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange};const{addons:r}=i;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:mr,dbReadyPromise:null,cancelOpen:mr,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;a.dbReadyPromise=new Ut(s=>{a.dbReadyResolve=s}),a.openCanceller=new Ut((s,l)=>{a.cancelOpen=l}),this._state=a,this.name=e,this.on=zT(this,"populate","blocked","versionchange","close",{ready:[P6,mr]}),this.on.ready.subscribe=ZIe(this.on.ready.subscribe,s=>(l,u)=>{pp.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||Ut.resolve().then(l),u&&s(l);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(l),u&&s(l);else{s(l);const d=this;u||s(function p(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(p)})}})}),this.Collection=(o=this,zS(S6e.prototype,function(s,l){this.db=o;let u=vwe,c=null;if(l)try{u=l()}catch(h){c=h}const d=s._ctx,p=d.table,f=p.hook.reading.fire;this._ctx={table:p,index:d.index,isPrimKey:!d.index||p.schema.primKey.keyPath&&d.index===p.schema.primKey.name,range:u,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:c,or:d.or,valueMapper:f!==f1?f:null}})),this.Table=function(s){return zS(w6e.prototype,function(l,u,c){this.db=s,this._tx=c,this.name=l,this.schema=u,this.hook=s._allTables[l]?s._allTables[l].hook:zT(null,{creating:[u6e,mr],reading:[l6e,f1],updating:[d6e,mr],deleting:[c6e,mr]})})}(this),this.Transaction=function(s){return zS(P6e.prototype,function(l,u,c,d,p){this.db=s,this.mode=l,this.storeNames=u,this.schema=c,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=zT(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ut((f,h)=>{this._resolve=f,this._reject=h}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var h=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):h&&this.idbtrans&&this.idbtrans.abort(),fo(f)})})}(this),this.Version=function(s){return zS(N6e.prototype,function(l){this.db=s,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(s){return zS(bwe.prototype,function(l,u,c){this.db=s,this._ctx={table:l,index:u===":id"?null:u,or:c};const d=s._deps.indexedDB;if(!d)throw new pi.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(p,f)=>d.cmp(f,p),this._max=(p,f)=>d.cmp(p,f)>0?p:f,this._min=(p,f)=>d.cmp(p,f)<0?p:f,this._IDBKeyRange=s._deps.IDBKeyRange})}(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=v1(i.IDBKeyRange),this._createTransaction=(s,l,u,c)=>new this.Transaction(s,l,u,this._options.chromeTransactionDurability,c),this._fireOnBlocked=s=>{this.on("blocked").fire(s),HT.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(s))},this.use(O6e),this.use(x6e),this.use(B6e),this.use(L6e),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new pi.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new pi.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const i=this._versions;var n=i.filter(r=>r._cfg.version===e)[0];return n||(n=new this.Version(e),i.push(n),i.sort(R6e),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Xt.letThrough||this._vip)?e():new Ut((i,n)=>{if(this._state.openComplete)return n(new pi.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new pi.DatabaseClosed);this.open().catch(mr)}this._state.dbReadyPromise.then(i,n)}).then(e)}use({stack:e,create:i,level:n,name:r}){r&&this.unuse({stack:e,name:r});const a=this._middlewares[e]||(this._middlewares[e]=[]);return a.push({stack:e,create:i,level:n??10,name:r}),a.sort((o,s)=>o.level-s.level),this}unuse({stack:e,name:i,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(r=>n?r.create!==n:!!i&&r.name!==i)),this}open(){return _6e(this)}_close(){const e=this._state,i=HT.indexOf(this);if(i>=0&&HT.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new Ut(n=>{e.dbReadyResolve=n}),e.openCanceller=new Ut((n,r)=>{e.cancelOpen=r})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new pi.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,i=this._state;return new Ut((n,r)=>{const a=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=ea(()=>{(function({indexedDB:s,IDBKeyRange:l},u){!N6(s)&&u!==Rx&&M6(s,l).delete(u).catch(mr)})(this._deps,this.name),n()}),o.onerror=Yd(r),o.onblocked=this._fireOnBlocked};if(e)throw new pi.InvalidArgument("Arguments not allowed in db.delete()");i.isBeingOpened?i.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Wa(this._allTables).map(e=>this._allTables[e])}transaction(){const e=k6e.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,i,n){let r=Xt.trans;r&&r.db===this&&e.indexOf("!")===-1||(r=null);const a=e.indexOf("?")!==-1;let o,s;e=e.replace("!","").replace("?","");try{if(s=i.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===mF)o=mF;else{if(e!="rw"&&e!=gF)throw new pi.InvalidArgument("Invalid transaction mode: "+e);o=gF}if(r){if(r.mode===mF&&o===gF){if(!a)throw new pi.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach(u=>{if(r&&r.storeNames.indexOf(u)===-1){if(!a)throw new pi.SubTransaction("Table "+u+" not included in parent transaction.");r=null}}),a&&r&&!r.active&&(r=null)}}catch(u){return r?r._promise(null,(c,d)=>{d(u)}):fo(u)}const l=Twe.bind(null,this,o,s,r,n);return r?r._promise(o,l,"lock"):Xt.trans?PS(Xt.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!Gu(this._allTables,e))throw new pi.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const $6e=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class V6e{constructor(e){this._subscribe=e}subscribe(e,i,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:i,complete:n})}[$6e](){return this}}function Dwe(t,e){return Wa(e).forEach(i=>{YN(t[i]||(t[i]=new Bf),e[i])}),t}function j6e(t){let e,i=!1;const n=new V6e(r=>{const a=T6(t);let o=!1,s={},l={};const u={get closed(){return o},unsubscribe:()=>{o=!0,hg.storagemutated.unsubscribe(f)}};r.start&&r.start(u);let c=!1,d=!1;function p(){return Wa(l).some(m=>s[m]&&F6e(s[m],l[m]))}const f=m=>{Dwe(s,m),p()&&h()},h=()=>{if(c||o)return;s={};const m={},g=function(v){a&&DS();const y=()=>pg(t,{subscr:v,trans:null}),b=Xt.trans?PS(Xt.transless,y):y();return a&&b.then(Ih,Ih),b}(m);d||(hg(g1,f),d=!0),c=!0,Promise.resolve(g).then(v=>{i=!0,e=v,c=!1,o||(p()?h():(s={},l=m,r.next&&r.next(v)))},v=>{c=!1,i=!1,r.error&&r.error(v),u.unsubscribe()})};return h(),u});return n.hasValue=()=>i,n.getValue=()=>e,n}let z$;try{z$={indexedDB:Fr.indexedDB||Fr.mozIndexedDB||Fr.webkitIndexedDB||Fr.msIndexedDB,IDBKeyRange:Fr.IDBKeyRange||Fr.webkitIDBKeyRange}}catch{z$={indexedDB:null,IDBKeyRange:null}}const ev=pp;function VR(t){let e=jf;try{jf=!0,hg.storagemutated.fire(t)}finally{jf=e}}zw(ev,{...OR,delete:t=>new ev(t,{addons:[]}).delete(),exists:t=>new ev(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:i}){return N6(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==Rx)):M6(e,i).toCollection().primaryKeys()}(ev.dependencies).then(t)}catch{return fo(new pi.MissingAPI)}},defineClass:()=>function(t){al(this,t)},ignoreTransaction:t=>Xt.trans?PS(Xt.transless,t):t(),vip:j$,async:function(t){return function(){try{var e=G$(t.apply(this,arguments));return e&&typeof e.then=="function"?e:Ut.resolve(e)}catch(i){return fo(i)}}},spawn:function(t,e,i){try{var n=G$(t.apply(i,e||[]));return n&&typeof n.then=="function"?n:Ut.resolve(n)}catch(r){return fo(r)}},currentTransaction:{get:()=>Xt.trans||null},waitFor:function(t,e){const i=Ut.resolve(typeof t=="function"?ev.ignoreTransaction(t):t).timeout(e||6e4);return Xt.trans?Xt.trans.waitFor(i):i},Promise:Ut,debug:{get:()=>hf,set:t=>{iwe(t,t==="dexie"?()=>!0:gwe)}},derive:OI,extend:al,props:zw,override:ZIe,Events:zT,on:hg,liveQuery:j6e,extendObservabilitySet:Dwe,getByKeyPath:Zf,setByKeyPath:fd,delByKeyPath:function(t,e){typeof e=="string"?fd(t,e,void 0):"length"in e&&[].map.call(e,function(i){fd(t,i,void 0)})},shallowClone:QIe,deepClone:UE,getObjectDiff:A6,cmp:Os,asap:XIe,minKey:k$,addons:[],connections:HT,errnames:D6,dependencies:z$,semVer:PY,version:PY.split(".").map(t=>parseInt(t)).reduce((t,e,i)=>t+e/Math.pow(10,2*i))}),ev.maxKey=v1(ev.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(hg(g1,t=>{if(!jf){let e;Cx?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Tm,!0,!0,t)):e=new CustomEvent(Tm,{detail:t}),jf=!0,dispatchEvent(e),jf=!1}}),addEventListener(Tm,({detail:t})=>{jf||VR(t)}));let jf=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Tm);typeof t.unref=="function"&&t.unref(),hg(g1,e=>{jf||t.postMessage(e)}),t.onmessage=e=>{e.data&&VR(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){hg(g1,e=>{try{jf||(typeof localStorage<"u"&&localStorage.setItem(Tm,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(i=>i.postMessage({type:Tm,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Tm){const i=JSON.parse(e.newValue);i&&VR(i.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Tm&&VR(e.changedParts)})}Ut.rejectionMapper=function(t,e){if(!t||t instanceof xI||t instanceof TypeError||t instanceof SyntaxError||!t.name||!SY[t.name])return t;var i=new SY[t.name](e||t.message,t);return"stack"in t&&Yf(i,"stack",{get:function(){return this.inner.stack}}),i},iwe(hf,gwe);const Ys=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new pp("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),pp.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.dex[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>{t.findWhere(e,i,n).then(o=>r(o!=null&&o.length?o[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.dex[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return a("exists");t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,a)=>new Promise((o,s)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(o,l=>{console.log("error:",l),s()})}),t}();async function Pwe(t){var i;console.log("%c localSave","color: yellow");const e=(t==null?void 0:t.tournamentRecord)??((i=$e.getTournament())==null?void 0:i.tournamentRecord);await Ys.addTournament(e),rt(t==null?void 0:t.callback)&&t.callback()}function Ewe({tournamentRecord:t,callback:e}){var n;const i=(n=ol())==null?void 0:n.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),Pwe({tournamentRecord:t,callback:e})}function G6e({callback:t,autoClose:e=!0}={}){const i=s=>{const l=s.name.split(".").reverse()[0];let u=new FileReader;u.onload=function(c){if(c.target.error){console.log("file error",c.target.error);return}let d=c.target.result;d.length&&(rt(t)?t(d):console.log(d))},["csv","json"].includes(l)?u.readAsText(s):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),r.appendChild(a),n.appendChild(r),yn({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(s=>{n.addEventListener(s,function(l){l.preventDefault(),l.stopPropagation()})});const o="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(o)},!1),n.addEventListener("dragleave",function(){this.classList.remove(o)},!1),n.addEventListener("drop",function(s){const l=a.getAttribute("multiple");this.classList.remove(o);const u=s.dataTransfer.files,c=new DataTransfer;Array.prototype.forEach.call(u,p=>{if(c.items.add(p),!l)return!1});const d=c.files;Array.from(d).forEach(i),e&&Hw()},!1)}function H6e(t){const e=t.getData().map(i=>i.tournamentId);G6e({callback:i=>{const n=w6({data:i});if(n){let r,a;n.tournamentId&&n.startDate?a=n:n.tuid&&n.start&&Mt({message:"TMX Classic file not converted"}),r=$e.setState(a),r.success?EE({tournamentRecord:a,tournamentIds:e,table:t}):console.log(r)}}})}function EE({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=d1(t);(e==null?void 0:e.includes(t.tournamentId))?i==null||i.updateOrAddData([r],!0):i==null||i.addData([r],!0),Ewe({tournamentRecord:t}),rt(n)&&n()}const ze={matchUpsToBroadcast:[],tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{schedule_day:null,draw_event:null},columns:{}},k6="@VERSION@",ii={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!0,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},firstTimeUser:!1,serverFirst:!1,version:k6,version_check:void 0,format_version:"1.2",ioc:"gbr",orientation:void 0,locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},calendar:{start:void 0,end:void 0,category:void 0,first_day:0},scoring:{delegationOfficial:!1,delegation:!0},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};var Cwe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(eq,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",u="day",c="week",d="month",p="quarter",f="year",h="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var A=["th","st","nd","rd"],_=M%100;return"["+M+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(M,A,_){var k=String(M);return!k||k.length>=A?M:""+Array(A+1-k.length).join(_)+M},I={s:b,z:function(M){var A=-M.utcOffset(),_=Math.abs(A),k=Math.floor(_/60),B=_%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(B,2,"0")},m:function M(A,_){if(A.date()<_.date())return-M(_,A);var k=12*(_.year()-A.year())+(_.month()-A.month()),B=A.clone().add(k,d),F=_-B<0,x=A.clone().add(k+(F?-1:1),d);return+(-(k+(_-B)/(F?B-x:x-B))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:f,w:c,d:u,D:h,h:l,m:s,s:o,ms:a,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},T="en",w={};w[T]=y;var S="$isDayjsObject",U=function(M){return M instanceof R||!(!M||!M[S])},P=function M(A,_,k){var B;if(!A)return T;if(typeof A=="string"){var F=A.toLowerCase();w[F]&&(B=F),_&&(w[F]=_,B=F);var x=A.split("-");if(!B&&x.length>1)return M(x[0])}else{var $=A.name;w[$]=A,B=$}return!k&&B&&(T=B),B||!k&&T},E=function(M,A){if(U(M))return M.clone();var _=typeof A=="object"?A:{};return _.date=M,_.args=arguments,new R(_)},D=I;D.l=P,D.i=U,D.w=function(M,A){return E(M,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var R=function(){function M(_){this.$L=P(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=M.prototype;return A.parse=function(_){this.$d=function(k){var B=k.date,F=k.utc;if(B===null)return new Date(NaN);if(D.u(B))return new Date;if(B instanceof Date)return new Date(B);if(typeof B=="string"&&!/Z$/i.test(B)){var x=B.match(g);if(x){var $=x[2]-1||0,j=(x[7]||"0").substring(0,3);return F?new Date(Date.UTC(x[1],$,x[3]||1,x[4]||0,x[5]||0,x[6]||0,j)):new Date(x[1],$,x[3]||1,x[4]||0,x[5]||0,x[6]||0,j)}}return new Date(B)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return D},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,k){var B=E(_);return this.startOf(k)<=B&&B<=this.endOf(k)},A.isAfter=function(_,k){return E(_)<this.startOf(k)},A.isBefore=function(_,k){return this.endOf(k)<E(_)},A.$g=function(_,k,B){return D.u(_)?this[k]:this.set(B,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,k){var B=this,F=!!D.u(k)||k,x=D.p(_),$=function(Z,X){var Q=D.w(B.$u?Date.UTC(B.$y,X,Z):new Date(B.$y,X,Z),B);return F?Q:Q.endOf(u)},j=function(Z,X){return D.w(B.toDate()[Z].apply(B.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),B)},V=this.$W,H=this.$M,z=this.$D,q="set"+(this.$u?"UTC":"");switch(x){case f:return F?$(1,0):$(31,11);case d:return F?$(1,H):$(0,H+1);case c:var W=this.$locale().weekStart||0,Y=(V<W?V+7:V)-W;return $(F?z-Y:z+(6-Y),H);case u:case h:return j(q+"Hours",0);case l:return j(q+"Minutes",1);case s:return j(q+"Seconds",2);case o:return j(q+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,k){var B,F=D.p(_),x="set"+(this.$u?"UTC":""),$=(B={},B[u]=x+"Date",B[h]=x+"Date",B[d]=x+"Month",B[f]=x+"FullYear",B[l]=x+"Hours",B[s]=x+"Minutes",B[o]=x+"Seconds",B[a]=x+"Milliseconds",B)[F],j=F===u?this.$D+(k-this.$W):k;if(F===d||F===f){var V=this.clone().set(h,1);V.$d[$](j),V.init(),this.$d=V.set(h,Math.min(this.$D,V.daysInMonth())).$d}else $&&this.$d[$](j);return this.init(),this},A.set=function(_,k){return this.clone().$set(_,k)},A.get=function(_){return this[D.p(_)]()},A.add=function(_,k){var B,F=this;_=Number(_);var x=D.p(k),$=function(H){var z=E(F);return D.w(z.date(z.date()+Math.round(H*_)),F)};if(x===d)return this.set(d,this.$M+_);if(x===f)return this.set(f,this.$y+_);if(x===u)return $(1);if(x===c)return $(7);var j=(B={},B[s]=n,B[l]=r,B[o]=i,B)[x]||1,V=this.$d.getTime()+_*j;return D.w(V,this)},A.subtract=function(_,k){return this.add(-1*_,k)},A.format=function(_){var k=this,B=this.$locale();if(!this.isValid())return B.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",x=D.z(this),$=this.$H,j=this.$m,V=this.$M,H=B.weekdays,z=B.months,q=B.meridiem,W=function(X,Q,ce,J){return X&&(X[Q]||X(k,F))||ce[Q].slice(0,J)},Y=function(X){return D.s($%12||12,X,"0")},Z=q||function(X,Q,ce){var J=X<12?"AM":"PM";return ce?J.toLowerCase():J};return F.replace(v,function(X,Q){return Q||function(ce){switch(ce){case"YY":return String(k.$y).slice(-2);case"YYYY":return D.s(k.$y,4,"0");case"M":return V+1;case"MM":return D.s(V+1,2,"0");case"MMM":return W(B.monthsShort,V,z,3);case"MMMM":return W(z,V);case"D":return k.$D;case"DD":return D.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return W(B.weekdaysMin,k.$W,H,2);case"ddd":return W(B.weekdaysShort,k.$W,H,3);case"dddd":return H[k.$W];case"H":return String($);case"HH":return D.s($,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return Z($,j,!0);case"A":return Z($,j,!1);case"m":return String(j);case"mm":return D.s(j,2,"0");case"s":return String(k.$s);case"ss":return D.s(k.$s,2,"0");case"SSS":return D.s(k.$ms,3,"0");case"Z":return x}return null}(X)||x.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,k,B){var F,x=this,$=D.p(k),j=E(_),V=(j.utcOffset()-this.utcOffset())*n,H=this-j,z=function(){return D.m(x,j)};switch($){case f:F=z()/12;break;case d:F=z();break;case p:F=z()/3;break;case c:F=(H-V)/6048e5;break;case u:F=(H-V)/864e5;break;case l:F=H/r;break;case s:F=H/n;break;case o:F=H/i;break;default:F=H}return B?F:D.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,k){if(!_)return this.$L;var B=this.clone(),F=P(_,k,!0);return F&&(B.$L=F),B},A.clone=function(){return D.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},M}(),N=R.prototype;return E.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",u],["$M",d],["$y",f],["$D",h]].forEach(function(M){N[M[1]]=function(A){return this.$g(A,M[0],M[1])}}),E.extend=function(M,A){return M.$i||(M(A,R,E),M.$i=!0),E},E.locale=P,E.isDayjs=U,E.unix=function(M){return E(1e3*M)},E.en=w[T],E.Ls=w,E.p={},E})})(Cwe);var z6e=Cwe.exports;const O6=tq(z6e);async function yt(t){var h,m,g;const{tournamentRecord:e,methods:i,engine:n=FL,callback:r}=t,a=v=>{if(e&&aB[n].reset(),rt(r))return r(v);v.error&&Mt({message:v.error.message??"Error",intent:"is-danger"})};if(!Array.isArray(i))return a();const o=aB[n];if(!o)return a();e&&o.setState(e);const s=v=>{var y;return(y=v==null?void 0:v.parentOrganisation)==null?void 0:y.organisationId},l=((h=o.getState())==null?void 0:h.tournamentRecords)??{},u=n===FL?[o.getTournamentId()]:(m=Object.values(l))==null?void 0:m.map(v=>v.tournamentId),c=Wt.unique(n===FL?[s(o.getTournament().tournamentRecord)]:(g=Object.values(l))==null?void 0:g.map(s)).filter(Boolean);if(c.length>1)return Mt({message:"Multiple providers",intent:"is-danger"});const d=new Date().getTime(),p=Object.values(l).every(v=>{const y=O6(v.endDate).endOf("day").valueOf();return y&&y>=d}),f=v=>W6e({methods:i,factoryEngine:o,tournamentIds:u,completion:a,saveLocal:v});return p?c.length?Rwe({providerIds:c,mutate:f}):f(!0):q6e({providerIds:c,mutate:f})}function q6e({providerIds:t,mutate:e}){return Mt({action:{onClick:()=>t!=null&&t.length?Rwe({providerIds:t,mutate:e}):e(),text:"Modify?"},message:"Not in date range",intent:"is-danger"})}function Rwe({providerIds:t,mutate:e}){var s,l,u,c;const i=ol();if(!i)return Mt({message:"Not logged in",intent:"is-warning"});const n=!!((s=i==null?void 0:i.providerIds)!=null&&s.includes(t[0])||((l=i==null?void 0:i.provider)==null?void 0:l.organisationId)===t[0]),r=(u=i==null?void 0:i.roles)==null?void 0:u.includes(Dk),a=((c=ze.provider)==null?void 0:c.organisationId)===t[0];return!n&&!r?Mt({message:"Not authorized",intent:"is-danger"}):!n&&r&&!a?Mt({action:{onClick:()=>(ze.provider={organisationId:t[0]},e(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):e(!n&&!(r&&a))}function kY({factoryEngine:t,methods:e}){var n;(n=ii.log)!=null&&n.verbose&&console.log("%c executing locally","color: lightgreen");const i=Wt.makeDeepCopy(e);return t.executionQueue(i)||{}}async function OY(t){(t||ii.saveLocal)&&await Pwe()}async function W6e({methods:t,completion:e,factoryEngine:i,tournamentIds:n,saveLocal:r}){var o,s,l;if((o=window.dev)!=null&&o.params)for(const u of t)window.dev.params[u.method]&&(u.params={...u.params,...window.dev.params[u.method]});(s=window==null?void 0:window.dev)!=null&&s.getContext().internal&&console.log({methods:t});let a;if(!ii.serverFirst&&(a=kY({factoryEngine:i,methods:t}),a.error))return e(a);if(a!=null&&a.success||ii.serverFirst){const u=async c=>{if(ii.serverFirst&&(c!=null&&c.success))return a=kY({factoryEngine:i,methods:t}),a.error||await OY(r),e(a)};(l=ii.log)!=null&&l.verbose&&console.log("%c invoking remote","color: lightblue"),a8({data:{type:"executionQueue",payload:{methods:t,tournamentIds:n}},ackCallback:u}),ii.serverFirst||await OY(r)}if(!ii.serverFirst)return e(a)}function xY(t){return Wt.dateTime.dateValidation.test(t)}function Ob(t,e,i){if(!t)return;const n={};for(const r of e||[]){if(!(r!=null&&r.label)||r.hide)continue;const a=document.createElement("button");r.id&&(n[r.id]=a,a.id=r.id),a.style="margin-right: .5em;",a.className="button font-medium",r.intent&&a.classList.add(r.intent),a.innerHTML=r.label,r.disabled&&(a.disabled=!0),a.onclick=o=>{o.stopPropagation(),!o.target.disabled&&rt(r.onClick)&&r.onClick(),rt(i)&&i()},t.appendChild(a)}return{elements:n}}const K6e="addCourts",Y6e="addFlight",Z6e="addDrawDefinition",Mwe="addAdHocMatchUps",X6e="addDrawEntries",J6e="addDrawDefinitionExtension",Q6e="addDynamicRatings",e8e="addEvent",x6="addEventEntries",t8e="addEventEntryPairs",i8e="addEventExtension",Nwe="addIndividualParticipantIds",q$="addMatchUpScheduleItems",n8e="addOnlineResource",CE="addParticipants",LY="addParticipantTimeItem",Awe="addPlayoffStructures",r8e="addTournamentExtension",a8e="addVenue",o8e="attachQualifyingStructure",s8e="attachPolicies",l8e="automatedPlayoffPositioning",_we="bulkScheduleMatchUps",kwe="deleteAdHocMatchUps",L6="deleteFlightAndFlightDraw",u8e="deleteEvents",c8e="deleteParticipants",d8e="deleteVenues",p8e="destroyPairEntries",f8e="modifyCourt",h8e="modifyEvent",Owe="modifyEntriesStatus",W$="modifyParticipant",F6="modifyParticipantsSignInStatus",m8e="modifyTieFormmat",g8e="modifyVenue",v8e="proAutoSchedule",xwe="publishEvent",y8e="removeIndividualParticipantIds",b8e="removeStructure",I8e="renameStructures",w8e="resetDrawDefinition",Lwe="resetMatchUpLinesUps",Fwe="resetScorecard",S8e="setMatchUpFormat",B6="setMatchUpStatus",T8e="setParticipantScaleItems",U8e="setTournamentDates",D8e="setTournamentName",P8e="setTournamentNotes",E8e="unPublishEvent";function Bwe({table:t,tournamentRecord:e}){const i={tournamentName:(e==null?void 0:e.tournamentName)||"",startDate:(e==null?void 0:e.startDate)||"",endDate:(e==null?void 0:e.endDate)||""};let n;const r=[{error:"minimum of 5 characters",placeholder:"Tournament name",value:i.tournamentName,validator:ur(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",value:i.startDate,label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",value:i.endDate,label:"End date",field:"endDate"}],a=({tournamentName:m,startDate:g,endDate:v})=>ur(5)(m)&&xY(g)&&xY(v),o=({inputs:m})=>{const g=a({tournamentName:m.tournamentName.value,startDate:m.startDate.value,endDate:m.endDate.value}),v=document.getElementById("saveTournamentEdits");v&&(v.disabled=!g)},s=[{fields:["startDate","endDate"],dateRange:!0},{control:"tournamentName",onInput:o},{onFocusOut:o,control:"startDate"},{onFocusOut:o,control:"endDate"}],l=m=>{n=Wn(m,r,s)},u=()=>ur(5)(n.drawName.value),c=()=>{var y,b;const m=(y=n.tournamentName.value)==null?void 0:y.trim(),g=n.startDate.value,v=n.endDate.value;if(e){const I={...e,tournamentName:m,startDate:g,endDate:v};yt({tournamentRecord:I,methods:[{method:D8e,params:{tournamentName:m}},{method:U8e,params:{startDate:g,endDate:v}}],callback:S=>{S.success?(t==null||t.updateData([d1(I)],!0),EE({tournamentRecord:I})):console.log({result:S})}})}else if($e.newTournamentRecord({tournamentName:m,startDate:g,endDate:v}).success){const T=ol(),w=(b=$e.getTournament())==null?void 0:b.tournamentRecord;if(T!=null&&T.providerId){const S=U=>{var E;const P=(E=U.data)==null?void 0:E.provider;if(w.parentOrganisation=P,P){const D=R=>console.log("sendTournament",R);K3({tournamentRecord:w}).then(()=>{},D)}FY({tournamentRecord:w,table:t})};zLe({providerId:T.providerId}).then(S)}else FY({tournamentRecord:w,table:t})}},d=e?"Save":"Add",p=[{label:"Cancel",intent:"none",close:!0},{disabled:!a(i),id:"saveTournamentEdits",label:d,intent:"is-primary",onClick:c,close:u}],f=(m,g)=>Ob(m,p,g),h=e?"Edit tournament":"New tournament";ze.drawer.open({title:h,content:l,footer:f,side:mt,width:"300px"})}function FY({tournamentRecord:t,table:e}){EE({tournamentRecord:t,callback:()=>e==null?void 0:e.addData([d1(t)],!0)})}function C8e({table:t}){const e=t.getData().map(s=>s.tournamentId);let i;const n=s=>i=Wn(s,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{Mt({onClose:()=>ze.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=s=>{var d;const l=i.tournamentId.value,u=(d=s.data.tournamentRecords)==null?void 0:d[l];EE({tournamentRecord:u,tournamentIds:e,table:t,callback:()=>{}})};yn({title:"Login",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const s=i.tournamentId.value;_k({tournamentId:s}).then(a,r)},close:!0}]})}const wF="font-medium";function K$({target:t,button:e,stateChange:i}){var v;let n=0;const r=()=>(n+=1,`Item${n}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===mt?(a.classList.add("is-right"),a.style="margin-left: 1em"):a.style="margin-right: 1em";const o=y=>y.classList.contains("is-active"),s=()=>{o(a)&&a.classList.remove("is-active")},l=y=>{if(o(y))y.classList.remove("is-active");else return y.classList.add("is-active"),!0};a.onmouseleave=s,a.onclick=()=>l(a);const u=document.createElement("div");u.classList.add("dropdown-trigger");const c=document.createElement("button");c.className="button font-medium",e.intent&&c.classList.add(e.intent),c.setAttribute("aria-haspopup","true");const d=document.createElement("span");rt(e.onClick)&&(d.onclick=e.onClick),d.style="margin-right: 1em",d.innerHTML=e.label,c.appendChild(d);const p=document.createElement("span");rt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,c.appendChild(p),u.appendChild(c),a.appendChild(u);const f=document.createElement("div");f.classList.add("dropdown-menu"),f.setAttribute("z-index","99998");const h=document.createElement("div");h.classList.add("dropdown-content");const m=()=>{const y=f.querySelectorAll(".dropdown-item");for(const b of Array.from(y))b.classList.remove("is-active")},g=y=>{const b=document.createElement("a");b.className=wF;const I=y.disabled?"0.4":"1";return b.style=`text-decoration: none; opacity: ${I};`,y.color&&(b.style.color=y.color),b.classList.add("dropdown-item"),y.isActive&&b.classList.add("is-active"),y.value&&(b.value=y.value),y.class&&b.classList.add(y.class),b.onclick=T=>{if(y.disabled)return;y.value&&(c.value=y.value,a.value=y.value),T.stopPropagation(),rt(y.onClick)&&(rt(i)&&i(),y.onClick(T)),y.close&&s();const w=o(b);m(),w?d.innerHTML=e.label:(e.selection&&l(b),e.modifyLabel&&y.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${(y==null?void 0:y.label)||r()}`))},b.innerHTML=(y==null?void 0:y.label)||r(),b};for(const y of e.options||[])if(y.heading){const b=document.createElement("div");b.style="font-weight: bold",b.classList.add("dropdown-item"),b.classList.add(wF),b.innerHTML=y.heading,h.appendChild(b)}else if(y.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(wF),h.appendChild(b)}else y.hide||h.appendChild(g(y));return(v=e.options)!=null&&v.length&&(e.options[0].value&&(a.value=e.options[0].value),f.appendChild(h)),a.appendChild(f),t&&t.appendChild(a),a}class hl{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Gr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],a=r.length,o;for(let s=0;s<a&&(n=n[r[s]],o=n,!!n);s++);return o}static deepClone(e,i,n=[]){var r={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,u;s!=null&&typeof s=="object"&&(s.__proto__===r||s.__proto__===a)&&(l=n.findIndex(c=>c.subject===s),l>-1?i[o]=n[l].copy:(u=Object.assign(Array.isArray(s)?[]:{},s),n.unshift({subject:s,copy:u}),i[o]=this.deepClone(s,u,n)))}return i}}let R8e=class $we extends hl{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Gr.elOffset(this.container);n-=a.left,r-=a.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=Gr.elOffset(e),r,a,o;switch(this.container!==document.body&&(r=Gr.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":a=n.left+e.offsetWidth,o=n.top-1;break;case"bottom":a=n.left,o=n.top+e.offsetHeight;break;case"left":a=n.left,o=n.top-1;break;case"top":a=n.left,o=n.top;break;case"center":a=n.left+e.offsetWidth/2,o=n.top+e.offsetHeight/2;break}return{x:a,y:o,offset:n}}show(e,i){var n,r,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,n=s.x,r=s.y):typeof e=="number"?(o={top:0,left:0},n=e,r=i):(s=this.containerEventCoords(e),n=s.x,r=s.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),i+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(n)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new $we(this.table,e,this),this.childPopup}};class en extends hl{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new R8e(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var M8e={};class qw extends en{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,n[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":qw.accessors[e]?i=qw.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),a=Gr.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,u,c;o.modules.accessor&&(l=o.modules.accessor[n]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(c=o.getComponent(),u=typeof l.params=="function"?l.params(s,a,i,c,r):l.params,o.setFieldValue(a,l.accessor(s,a,i,u,c,r)))))}),a}}qw.moduleName="accessor";qw.accessors=M8e;var N8e={method:"GET"};function Y$(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(Y$(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(Y$(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function A8e(t){var e=Y$(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function Vwe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+A8e(i)),t}function _8e(t,e,i){var n;return new Promise((r,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var o in n.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=n.headers[o]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{r(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function Z$(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(Z$(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(Z$(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var k8e={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=Z$(i),r=new FormData;return n.forEach(function(a){r.append(a.key,a.value)}),r}}};class Jc extends en{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Jc.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Jc.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Jc.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),r=Object.assign(Object.assign({},a),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(n),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Jc.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}}Jc.moduleName="ajax";Jc.defaultConfig=N8e;Jc.defaultURLGenerator=Vwe;Jc.defaultLoaderPromise=_8e;Jc.contentTypeFormatters=k8e;var O8e={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)},range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,a,o,s,l;return l=t.length,i&&(r=i.getBounds(),a=r.start,r.start===r.end&&(n=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),n?s=t.length:s=e.indexOf(r.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((u,c)=>{u.updateData(t[c%l])}),this.table.restoreRedraw()))),e}},x8e={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=n.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?r.push(s):i=!1}),i||(i=!0,r=[],e[0].forEach(function(o){var s=n.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?r.push(s):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,u){r[u]&&(s[r[u].field]=l)}),a.push(s)}),a):!1},range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,a,o,s,l,u;return n&&(a=n.getBounds(),o=a.start,a.start===a.end&&(r=!0),o&&(t=t.split(`
`),t.forEach(function(c){e.push(c.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),u=l.indexOf(o.column),u>-1)))?(r?s=e[0].length:s=l.indexOf(a.end.column)-u+1,l=l.slice(u,u+s),e.forEach(c=>{var d={},p=c.length;l.forEach(function(f,h){d[f.field]=c[h%p]}),i.push(d)}),i):!1}};class Ty extends en{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(a=>{var o="";if(a)if(n.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}r.push(o)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=Ty.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=Ty.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}Ty.moduleName="clipboard";Ty.pasteActions=O8e;Ty.pasteParsers=x8e;class L8e{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class jwe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class RE extends hl{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new jwe(this)),this.component}}class Gwe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.parent instanceof fp?this._column.parent.getComponent():!1}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var Hwe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class fp extends hl{constructor(e,i){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,r)=>{var a=new fp(n,this);this.attachColumn(a)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(fp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{fp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,a;for(let o=0;o<r&&(i=i[n[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,a=r.length;for(let o=0;o<a;o++)if(o==a-1)n[r[o]]=i;else{if(!n[r[o]])if(typeof i<"u")n[r[o]]={};else break;n=n[r[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new RE(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var a=r.getWidth();a>i&&(i=a)}),i)){var n=i+1;this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new Gwe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}}fp.defaultOptionList=Hwe;class Mx{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class _s extends hl{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach(function(r){var a=r.getHeight();a>i&&(i=a)}),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Gr.elVisible(this.element),n={},r;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let s in r)this.data[s]=r[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(u=>{let c=this.getCell(u.getField());if(c){let d=u.getFieldValue(r);c.getValue()!==d&&(c.setValueProcessData(d),i&&c.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Mx(this)),this.component}}var F8e={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(a,o){return Number(a)+Number(o)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),n+=isNaN(a)?0:Number(a)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,a){return String(r)+String(a)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,a)=>(t||r===0)&&t.indexOf(r)===a);return n.length}};class Em extends en{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new fp({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Em.calculations[i.topCalc]?n.topCalc=Em.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Em.calculations[i.bottomCalc]?n.botCalc=Em.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[];return e.forEach(n=>{if(i.push(n.getData()),this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs&&n.modules.dataTree&&n.modules.dataTree.open){var r=this.rowsToData(this.table.modules.dataTree.getFilteredTreeChildren(n));i=i.concat(r)}}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new _s(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new L8e(r)),r.component),r.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new RE(this.genColumn,r);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),r.cells=a},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return r.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(c){u.push(l.getFieldValue(c))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](u,i):l.modules.columnCalcs[s],l.setFieldValue(n,l.modules.columnCalcs[a](u,i,o)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},a={};return n.forEach(o=>{r[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}Em.moduleName="columnCalcs";Em.calculations=F8e;class zwe extends en{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var a,o;i.push(n),n instanceof _s&&(n.create(),a=n.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(n),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i){var n=e.modules.dataTree,r=[],a=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(n.children):r=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(r),r.forEach(o=>{a.push(o);var s=this.getChildren(o);s.forEach(l=>{a.push(l)})})),a}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var a=new _s(r||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(a=>{a instanceof _s&&n.push(a)})),n}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(a=this.findChildIndex(r,e),a!==!1&&e.data[this.field].splice(n?a:a+1,0,i)),a===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof _s?n=e.data:e instanceof Mx?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof _s?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,a=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(o=>{o instanceof _s&&(a.push(i?o.getComponent():o),n&&(a=a.concat(this.getTreeChildren(o,i,n))))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}zwe.moduleName="dataTree";function B8e(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,u)=>{l&&l.depth===1&&(a[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(s.join(n));break}}),a.length&&r.unshift(a.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function $8e(t,e,i){var n=[];t.forEach(r=>{var a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(a);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function V8e(t,e={},i){var n=[],r=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":n.push(c(p));break;case"group":r.push(c(p,o));break;case"calc":r.push(c(p,s));break;case"row":r.push(c(p));break}});function c(p,f){var h=[];return p.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},f&&(g.styles=f),h.push(g)}}),h}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),u&&(a.didDrawPage=function(p){d.text(u,40,30)}),a.head=n,a.body=r,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function j8e(t,e,i){var n=this,r=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new hl(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},u;l.type="binary",a.SheetNames=[],a.Sheets={};function c(){var f=[],h=[],m={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var b=[];v.columns.forEach(function(I,T){I?(b.push(!(I.value instanceof Date)&&typeof I.value=="object"?JSON.stringify(I.value):I.value),(I.width>1||I.height>-1)&&(I.height>1||I.width>1)&&h.push({s:{r:y,c:T},e:{r:y+I.height-1,c:T+I.width-1}})):b.push("")}),f.push(b)}),XLSX.utils.sheet_add_aoa(m,f),m["!ref"]=XLSX.utils.encode_range(g),h.length&&(m["!merges"]=h),m}if(e.sheetOnly){i(c());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=c()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(f){a.Sheets[d]=f}}));else a.SheetNames.push(r),a.Sheets[r]=c();e.documentProcessing&&(a=e.documentProcessing(a));function p(f){for(var h=new ArrayBuffer(f.length),m=new Uint8Array(h),g=0;g!=f.length;++g)m[g]=f.charCodeAt(g)&255;return h}u=XLSX.write(a,l),i(p(u),"application/octet-stream")}function G8e(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function H8e(t,e,i){const n=[];t.forEach(r=>{const a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(JSON.stringify(a));break}}),i(n.join(`
`),"application/x-ndjson")}var z8e={csv:B8e,json:$8e,jsonLines:H8e,pdf:V8e,xlsx:j8e,html:G8e};class Ww extends en{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadReady",void 0),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,a){var o=!1;function s(u,c){a?a===!0?this.triggerDownload(u,c,e,i,!0):a(u):this.triggerDownload(u,c,e,i)}if(typeof e=="function"?o=e:Ww.downloaders[e]?o=Ww.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(r);o.call(this.table,l,n||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var a;r.type==="group"&&(a=r.columns[0],n&&n[r.indent]&&(a.value=n[r.indent](a.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,r):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}}Ww.moduleName="download";Ww.downloaders=z8e;function Nx(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==n&&l!==r&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,u=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case n:if(u.toUpperCase()==u.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case r:if(isNaN(u))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(u!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function q8e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",r.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",r.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):n()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&Nx(o,r),o}function W8e(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function c(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",c),l.addEventListener("blur",c),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=u&&(u=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&c();break;case 27:n();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&Nx(l,r),l}function K8e(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let c in r.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),s.setAttribute(c,s.getAttribute(c)+r.elementAttributes["+"+c])):s.setAttribute(c,r.elementAttributes[c]);s.value=a;var l=function(c){u()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),r.selectContents&&s.select())});function u(){var c=s.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==a?i(c)&&(a=c):n()}return s.addEventListener("keydown",function(c){switch(c.keyCode){case 13:u();break;case 27:n();break;case 38:case 40:o=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),r.mask&&Nx(s,r),s}function Y8e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof r.max<"u"&&o.setAttribute("max",r.max),typeof r.min<"u"&&o.setAttribute("min",r.min),typeof r.step<"u"&&o.setAttribute("step",r.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):n()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break}}),o}function Z8e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),u=document.createElement("input");function c(p){var f;return s.isDateTime(p)?f=p:a==="iso"?f=s.fromISO(String(p)):f=s.fromFormat(String(p),a),f.toFormat("yyyy-MM-dd")}if(u.type="date",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.max&&u.setAttribute("max",a?c(r.max):r.max),r.min&&u.setAttribute("min",a?c(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=c(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=l,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,f;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(f=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(l=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function X8e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),console.log("val",u),c.value=u,e(function(){t.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=s.fromFormat(String(p),"hh:mm"),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function J8e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,u=t.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);u=typeof u<"u"?u:"",a&&(s?(s.isDateTime(u)?l=u:a==="iso"?l=s.fromISO(String(u)):l=s.fromFormat(String(u),a),u=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=u,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,f;if((u===null||typeof u>"u")&&p!==""||p!==u){if(p&&a)switch(f=s.fromISO(String(p)),a){case!0:p=f;break;case"iso":p=f.toISO();break;default:p=f.toFormat(a)}i(p)&&(u=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}class $6{constructor(e,i,n,r,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&Nx(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=Vwe(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(a=>{var o=r.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,a,o,s=0,l,u=/(\d+)|(\D+)/g,c=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(c.test(n)&&c.test(r)))return n>r?1:-1;for(n=n.match(u),r=r.match(u),l=n.length>r.length?r.length:n.length;s<l;)if(a=n[s],o=r[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(a=>{this._filterItem(e,i,a)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}}function Q8e(t,e,i,n,r){this.deprecationMsg("The select editor has been deprecated, please use the new list editor");var a=new $6(this,t,e,i,n,r);return a.input}function e7e(t,e,i,n,r){var a=new $6(this,t,e,i,n,r);return a.input}function t7e(t,e,i,n,r){this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),r.autocomplete=!0;var a=new $6(this,t,e,i,n,r);return a.input}function i7e(t,e,i,n,r){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,u=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(v){c.forEach(function(y,b){b<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(v){var y=document.createElement("span"),b=p.cloneNode(!0);c.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),f(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){s=v,f(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",u),p.setAttribute("height",u),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)h(g);return s=Math.min(parseInt(s),l),f(s),d.addEventListener("mousemove",function(v){f(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){n()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(s+1);break;case 37:m(s-1);break;case 13:i(s);break;case 27:n();break}}),d}function n7e(t,e,i,n,r){var a=t.getElement(),o=typeof r.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,s=typeof r.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(o-s)/100,u=t.getValue()||0,c=document.createElement("div"),d=document.createElement("div"),p,f;function h(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",u)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return a.style.padding="4px 4px",u=Math.min(parseFloat(u),o),u=Math.max(parseFloat(u),s),u=Math.round((u-s)/l),d.style.width=u+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(c),c.addEventListener("mousedown",function(m){p=m.screenX,f=d.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=f+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,f=!1,h())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:n();break}}),a.addEventListener("blur",function(){n()}),d}function r7e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input"),s=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,u=!1,c=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let f in r.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),o.setAttribute(f,o.getAttribute(f)+r.elementAttributes["+"+f])):o.setAttribute(f,r.elementAttributes[f]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(u=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=c?a===r.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(f){var h=o.checked;return c&&h?h=r.trueValue:d&&!h&&(h=r.falseValue),s?f?u?l:h:o.checked&&!u?(o.checked=!1,o.indeterminate=!0,u=!0,l):(u=!1,h):h}return o.addEventListener("change",function(f){i(p())}),o.addEventListener("blur",function(f){i(p(!0))}),o.addEventListener("keydown",function(f){f.keyCode==13&&i(p()),f.keyCode==27&&n()}),o}var a7e={input:q8e,textarea:W8e,number:K8e,range:Y8e,date:Z8e,time:X8e,datetime:J8e,select:Q8e,list:e7e,autocomplete:t7e,star:i7e,progress:n7e,tickCross:r7e};class ME extends en{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.editors=ME.editors,this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableOption("editTriggerEvent","focus"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let a=e.cells[r];if(a.column.modules.edit&&Gr.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let a=e.cells[r];if(a.column.modules.edit&&Gr.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{}};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?i.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":i.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?i.editor=this.editors[e.definition.formatter]:i.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}i.editor&&(e.modules.edit=i)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,a=!0,o=function(){},s=e.getElement(),l=!1,u,c,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function f(){r.currentCell===e&&!l&&r.cancelEdit()}function h(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),c=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,c)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,c),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",c),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(c):e.column.modules.edit.params,u=e.column.modules.edit.editor.call(r,c,h,p,f,d),this.currentCell&&u!==!1)if(u instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(u),o();for(var m=s.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",u),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}ME.moduleName="edit";ME.editors=a7e;class BY{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class SF{constructor(e,i,n,r,a){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=a}}class qwe extends en{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r;var a,o;if(n==="range"){var s=this.table.modules.selectRange.selectedColumns();a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],o=this.bodyToExportRows(this.rowLookup(n),this.table.modules.selectRange.selectedColumns(!0))}else a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders()):[],o=this.bodyToExportRows(this.rowLookup(n));return a.concat(o)}generateTable(e,i,n,r){var a=this.generateExportList(e,i,n,r);return this.generateTableElement(a)}rowLookup(e){var i=[];if(typeof e=="function")e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)});else switch(e){case!0:case"visible":i=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":i=this.table.rowManager.rows;break;case"selected":i=this.table.modules.selectRow.selectedRows;break;case"range":i=this.table.modules.selectRange.selectedRows();break;case"active":default:this.table.options.pagination?i=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):i=this.table.rowManager.getDisplayRows()}return Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||e.definition.title,a={title:r,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>n&&(n=s.depth))}),a.depth+=n,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i!==!1&&(e.visible||!e.visible&&i)}headersToExportRows(e){var i=[],n=0,r=[];function a(o,s){var l=n-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let u=1;u<o.height;u++)typeof i[s+u]>"u"&&(i[s+u]=[]),i[s+u].push(!1);if(o.width>1)for(let u=1;u<o.width;u++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(u){a(u,s+1)})}return e.forEach(function(o){o.depth>n&&(n=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;s.push(new SF(u,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),r.push(new BY("header",s))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,a)=>{var o=r.getData(this.colVisProp),s=[],l=0;switch(r.type){case"group":l=r.level,s.push(new SF(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(u=>{s.push(new SF(u._column.getFieldValue(o),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new BY(r.type,s,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let c;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,s,a));break;case"group":r.appendChild(this.generateGroupElement(l,s,a));break;case"calc":r.appendChild(this.generateCalcElement(l,s,a));break;case"row":c=this.generateRowElement(l,s,a),this.mapElementStyles(u%2&&a.evenRow?a.evenRow:a.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(c);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]),r.appendChild(o)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(a),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,u=this.table,c=u.columnManager.findColumnIndex(l),d=a.value,p,f={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return u},getComponent:function(){return f},column:l},h=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(h.forEach(function(m){s.classList.add(m)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,p=n.styleCells&&n.styleCells[c]?n.styleCells[c]:n.firstCell,p&&(this.mapElementStyles(p,s,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),r.appendChild(s),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var a=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);n.forEach(function(o){i.style[r[o]]||(i.style[r[o]]=a.getPropertyValue(o))})}}}}qwe.moduleName="export";var o7e={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return r.forEach(s=>{a.includes(s)&&o.push(!0)}),n.matchAll?o.length===r.length:!!o.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Vf extends en{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete n.headerFilters[r];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":Vf.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(o,f,d):p,Vf.filters[e.definition.headerFilterFunc](o,f,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(d){var p=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(d);return p=typeof p=="function"?p(o,f,d):p,e.definition.headerFilterFunc(o,f,d,p)},l=c;break}if(!c)switch(s){case"partial":c=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:c=function(d){return e.getFieldValue(d)==o},l="="}n.headerFilters[r]={value:o,func:c,type:l}}e.modules.filter.value=o,u=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==u&&(n.prevHeaderFilterChangeCheck=u,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,a=e.modules.filter.success,o=e.getField(),s,l,u,c,d,p,f,h;e.modules.filter.value=i;function m(){}function g(v){h=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(c={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(r.table,c):f,u=l.call(this.table.modules.edit,c,g,a,m,f),!u){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",u);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){u.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),u.addEventListener("click",function(v){v.stopPropagation(),u.focus()}),u.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(u.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",p),u.addEventListener("search",p),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(v){a(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(u),e.contentElement.appendChild(s),n||r.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:Vf.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return Vf.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return Vf.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var a;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(a={field:r.field,type:r.type,value:r.value},i&&typeof a.type=="function"&&(a.type="function"),n.push(a))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var a=-1;typeof r.field=="object"?a=this.filterList.findIndex(o=>r===o):a=this.filterList.findIndex(o=>r.field===o.field&&r.type===o.type&&r.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(u=>{this.filterRecurse(u,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&n.push(a)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(a=>{r.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,r)||(n=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}}Vf.moduleName="filter";Vf.filters=o7e;function s7e(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function l7e(t,e,i){return t.getValue()}function u7e(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function c7e(t,e,i){var n=parseFloat(t.getValue()),r="",a,o,s,l,u,c=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",f=e.symbol||"",h=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),a=m!==!1?n.toFixed(m):n,a=String(a).split("."),o=a[0],s=a.length>1?c+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return u=o+s,r===!0?(u="("+u+")",h?u+f:f+u):h?r+u+f:r+f+u}function d7e(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",a=e.download,o=n,s=document.createElement("a"),l;function u(c,d){var p=c.shift(),f=d[p];return c.length&&typeof f=="object"?u(c,f):f}if(e.labelField&&(l=t.getData(),o=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),n=Gr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return s.setAttribute("href",r+n),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function p7e(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function f7e(t,e,i){var n=t.getValue(),r=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&n===e.trueValue||!s&&(o&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):a&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),u||"")}function h7e(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(s)?l=s:r==="iso"?l=n.fromISO(String(s)):l=n.fromFormat(String(s),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function m7e(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:n.now(),c=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(c)?d=c:r==="iso"?d=n.fromISO(String(c)):d=n.fromFormat(String(c),r),d.isValid?l?d.diff(u,s).toHuman()+(o?" "+o:""):parseInt(d.diff(u,s)[s])+(o?" "+o:""):a===!0?c:typeof a=="function"?a(c):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function g7e(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function v7e(t,e,i){var n=t.getValue(),r=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,a));for(var c=1;c<=a;c++){var d=s.cloneNode(!0);d.innerHTML=c<=n?l:u,o.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),o}function y7e(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,c;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),c=parseFloat(n)<=a?parseFloat(n):a,c=parseFloat(c)>=o?parseFloat(c):o,u=(a-o)/100,c=Math.round((c-o)/u),typeof s){case"string":l=s;break;case"function":l=s(n);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(c/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return r.style.backgroundColor=l,r}}function b7e(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,u,c,d,p;switch(u=parseFloat(n)<=a?parseFloat(n):a,u=parseFloat(u)>=o?parseFloat(u):o,l=(a-o)/100,u=Math.round((u-o)/l),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(u/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),c=e.color[v];break}default:c="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(u/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",u);var f=document.createElement("div");f.style.display="inline-block",f.style.width=u+"%",f.style.backgroundColor=c,f.style.height="100%",f.setAttribute("data-max",a),f.setAttribute("data-min",o);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=s,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof jwe)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(h),h.appendChild(f),d&&h.appendChild(m)}),""}function I7e(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function w7e(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function S7e(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function T7e(t,e,i){var n=document.createElement("span"),r=t.getRow(),a=t.getTable();return r.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),n.innerText=o}),n}function U7e(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function D7e(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=r.element;r.open=o,s&&(r.open?(n.classList.add("open"),s.style.display=""):(n.classList.remove("open"),s.style.display="none"))}return n.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!r.open),t.getTable().rowManager.adjustTableSize()}),a(r.open),n}function P7e(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof Mx?(n.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",o=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),n.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,n)):n=""}else n.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var E7e={plaintext:s7e,html:l7e,textarea:u7e,money:c7e,link:d7e,image:p7e,tickCross:f7e,datetime:h7e,datetimediff:m7e,lookup:g7e,star:v7e,traffic:y7e,progress:b7e,color:I7e,buttonTick:w7e,buttonCross:S7e,rownum:T7e,handle:U7e,responsiveCollapse:D7e,rowSelection:P7e};class ec extends en{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];switch(typeof r){case"string":ec.formatters[r]?n.formatter=ec.formatters[r]:(console.warn("Formatter Error - No such formatter found: ",r),n.formatter=ec.formatters.plaintext);break;case"function":n.formatter=r;break;default:n.formatter=ec.formatters.plaintext;break}return n}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,a,o,s;return e.definition.titleFormatter?(r=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,r.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":ec.formatters[e]?e=ec.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=ec.formatters.plaintext);break;case"function":break;default:e=ec.formatters.plaintext;break}return e}}ec.moduleName="format";ec.formatters=E7e;class Wwe extends en{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}Wwe.moduleName="frozenColumns";class Kwe extends en{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}Kwe.moduleName="frozenRows";class C7e{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class PI{constructor(e,i,n,r,a,o,s){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=a,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new PI(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var a=this.rows.indexOf(i);a>-1?n?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var a=r.getElement();e.parentNode.insertBefore(a,e.nextSibling),r.initialize(),e=a})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Gr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new C7e(this)),this.component}}class Ywe extends en{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,u)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(u){return l.getFieldValue(u)}:s=function(u){return u[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof PI&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof PI?i:i.modules.group,a=e instanceof PI?e:e.modules.group;r===a?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(a&&a.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var a=[];n.hasSubGroups?(a=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=a.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(a)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,a;n=n||[],a=new PI(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),a;a=n.length==r.length&&n.every((o,s)=>o===r[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Ywe.moduleName="groupRows";var R7e={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},M7e={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}};class Uy extends en{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return Uy.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return Uy.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof _s)n.component===e&&(n.component=i);else if(n.component instanceof RE&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}}Uy.moduleName="history";Uy.undoers=R7e;Uy.redoers=M7e;class Zwe extends en{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var o=0;o<r.length;o++){var s=r[o],l=s.getElementsByTagName("td"),u={};this.hasIndex||(u[i.index]=o);for(var c=0;c<l.length;c++){var d=l[c];typeof this.fieldIndex[c]<"u"&&(u[this.fieldIndex[c]]=d.innerHTML)}a.push(u)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,a=Object.keys(n||i),o={};a.forEach(c=>{o[c.toLowerCase()]=c});for(var s in r){var l=r[s],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof o[u]<"u"&&(i[o[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a=!1,o=this._findCol(r.textContent),s;o?a=!0:o={title:r.textContent.trim()},o.field||(o.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),s=r.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(r,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a={title:"",field:"col"+n};this.fieldIndex[n]=a.field;var o=r.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Zwe.moduleName="htmlTableImport";function N7e(t){var e=[],i=0,n=0,r=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),o=='"'&&r&&s=='"'){e[i][n]+=o,a++;continue}if(o=='"'){r=!r;continue}if(o==","&&!r){n++;continue}if(o=="\r"&&s==`
`&&!r){n=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!r){n=0,i++;continue}e[i][n]+=o}return e}function A7e(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function _7e(t){return t}var k7e={csv:N7e,json:A7e,array:_7e};class NE extends en{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=NE.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i){var n=this.lookupImporter(e);if(n)return this.pickFile(i).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(r=>(console.error("Import Error:",r||"Unable to import file"),Promise.reject(r)))}pickFile(e){return new Promise((i,n)=>{var r=document.createElement("input");r.type="file",r.accept=e,r.addEventListener("change",a=>{var o=r.files[0],s=new FileReader;switch(this.table.options.importReader){case"buffer":s.readAsArrayBuffer(o);break;case"binary":s.readAsBinaryString(o);break;case"url":s.readAsDataURL(o);break;case"text":default:s.readAsText(o)}s.onload=l=>{i(s.result)},s.onerror=l=>{console.warn("File Load Error - Unable to read file"),n()}}),r.click()})}importData(e,i){var n=e.call(this.table,i);return n instanceof Promise?n:n?Promise.resolve(n):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),n=e.map(r=>{var a={};return i.forEach((o,s)=>{a[o]=r[s]}),a});return n}structureArrayToColumns(e){var i=[],n=this.table.getColumns();return n[0]&&e[0][0]&&n[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(r=>{var a={};r.forEach((o,s)=>{var l=n[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.table.setData(e)}}NE.moduleName="import";NE.importers=k7e;class Xwe extends en{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",n,r)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),a;this.columnSubscribers[e]&&(n instanceof RE?a=n.column.definition[e]:n instanceof fp&&(a=n.definition[e]),a&&a(i,r)),this.dispatchExternal(e,i,r)}}Xwe.moduleName="interaction";var O7e={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 67"],rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},x7e={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)},rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)},undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};class km extends en{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,km.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)km.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:km.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(a=>{switch(a){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),n.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var a=e.pressedKeys.indexOf(n);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var a=this.pressedKeys.indexOf(r);a==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}}km.moduleName="keybindings";km.bindings=O7e;km.actions=x7e;class Jwe extends en{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("menuContainer",void 0),this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!n||!n.length)){if(r)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}n.forEach(u=>{var c=document.createElement("div"),d=u.label,p=u.disabled;u.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?c.appendChild(d):c.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",f=>{f.stopPropagation()})):u.menu&&u.menu.length?c.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,i,u.menu,c,l)}):u.action&&c.addEventListener("click",f=>{u.action(f,i.getComponent())}),u.menu&&u.menu.length&&c.classList.add("tabulator-menu-item-submenu")),s.appendChild(c)}),s.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Jwe.moduleName="menu";class Qwe extends en{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&(r=e.getElement(),n.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Gr.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),o=r?r.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,u=0,n=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",c=>{var d,p;this.moving&&(this.moveHover(c),n||(n=c.touches[0].pageX),d=c.touches[0].pageX-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(n=c.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=o,o=r?r.getWidth()/2:0,a=p.prevColumn(),u=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Gr.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-Gr.elOffset(i).left+n,a;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}Qwe.moduleName="moveColumn";class Ax extends en{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var a;r.pageY-Gr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),n.mousemove=(function(a){var o=e.getElement();a.pageY-Gr.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,a,o,s,l,u;i.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),o=r?r.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,u=0,n=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",c=>{var d,p;this.moving&&(c.preventDefault(),this.moveHover(c),n||(n=c.touches[0].pageY),d=c.touches[0].pageY-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-u>s&&(p=a,p!==e&&(n=c.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=o,o=r?r.getHeight()/2:0,a=p.prevRow(),u=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-n+window.pageXOffset,this.startY=o.top-r+window.pageYOffset):this.startY=r-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=a=>{this.elementRowDrop(a,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=this.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=this.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}}Ax.prototype.receivers={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};Ax.prototype.senders={delete:function(t,e,i){t.delete()}};Ax.moduleName="moveRow";var L7e={};class Kw extends en{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,n[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":Kw.mutators[e]?i=Kw.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,u;o.modules.mutate&&(s=o.modules.mutate[r]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof a<"u")&&(u=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,u):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,u)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}Kw.moduleName="mutator";Kw.mutators=L7e;function F7e(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{c.innerHTML=d}),n?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",u.innerHTML=" "+n+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(c)),a}function B7e(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),u.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{c.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(u),a.appendChild(c),a}var $7e={rows:F7e,pages:B7e};class AE extends en{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),a;return i?r.length?a=r[0]:n.activeRows.length&&(a=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(a=r[r.length-1],i=!(r.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,a;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=AE.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=n;a<=r;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,a=e.length):(r=this.size*(this.page-1),a=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<a;l++){let u=e[l];u&&(n.push(u),u.type==="row"&&(o||(o=u),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),n}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}AE.moduleName="page";AE.pageCounters=$7e;var V7e={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),a,o;return r>-1&&(i=i.slice(r),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(n+"=","")),o?JSON.parse(o):!1}},j7e={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};class Sl extends en{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:Sl.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Sl.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Sl.readers[this.mode]?this.readFunc=Sl.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:Sl.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Sl.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Sl.writers[this.mode]?this.writeFunc=Sl.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var a=Object.getOwnPropertyDescriptor(i,r),o=i[r];a&&Object.defineProperty(i,r,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(n?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(u=>{u!=="columns"&&typeof a[u]<"u"&&(s[u]=a[u])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),r.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(r.length>o?r.splice(o,0,a):r.push(a))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var a={},o=r.getDefinition(),s;r.isGroup?(a.title=o.title,a.columns=this.parseColumns(r.getColumns())):(a.field=r.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=r.getWidth();break;case"visible":a.visible=r.visible;break;default:typeof o[l]!="function"&&n.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}}Sl.moduleName="persistence";Sl.moduleInitOrder=-10;Sl.readers=V7e;Sl.writers=j7e;let e0e=class extends en{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var a;function o(s){a=s}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),o):e,this.loadPopup(i,n,e,a,r)}loadPopup(e,i,n,r,a){var o=!(e instanceof MouseEvent),s,l;n instanceof HTMLElement?s=n:(s=document.createElement("div"),s.innerHTML=n),s.classList.add("tabulator-popup"),s.addEventListener("click",u=>{u.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};e0e.moduleName="popup";class t0e extends en{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?s.innerHTML=c:s.appendChild(c),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,a),this.manualBlock=!1}}t0e.moduleName="print";class i0e extends en{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a=r[0]<0?e.length+r[0]:r[0],o=r[1],s=r[2]?r.slice(2):!1,l,u;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var c=e.slice(a,typeof r[1]>"u"?r[1]:a+o);c.forEach((d,p)=>{var f=i.table.rowManager.getRowFromDataObject(d);f&&f.deleteActual(p!==c.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),u=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,a=Object.getOwnPropertyDescriptor(i,n),o=i[n],s=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(o=l,!r.blocked&&s===r.currentVersion){r.block("key");var u={};u[n]=l,e.updateData(u),r.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}i0e.moduleName="reactiveData";class n0e extends en{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var a=this,o=!1,s=n.definition.resizable,l={},u=n.getLastColumn();if(e==="header"&&(o=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(u)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=n,a.initialNextColumn=a.nextColumn=u.nextColumn(),a._mouseDown(p,u,c)};c.addEventListener("mousedown",d),c.addEventListener("touchstart",d,{passive:!0}),c.addEventListener("dblclick",p=>{var f=u.getWidth();p.stopPropagation(),u.reinitializeWidth(!0),f!==u.getWidth()&&(a.dispatch("column-resized",u),a.table.externalEvents.dispatch("columnResized",u.getComponent()))}),n.modules.frozen&&(c.style.position="sticky",c.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=c,r.parentNode&&n.visible&&r.after(c)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function a(s){var l=typeof s.screenX>"u"?s.touches[0].screenX:s.screenX,u=l-r.startX,c=l-r.latestX,d,p;if(r.latestX=l,r.table.rtl&&(u=-u,c=-c),d=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(r.startWidth+u),p=i.width==i.minWidth||i.width==i.maxWidth,c<0&&(r.nextColumn=r.initialNextColumn),r.table.options.resizableColumnFit&&r.nextColumn&&!(d&&p)){let f=r.nextColumn.getWidth();c>0&&f<=r.nextColumn.minWidth&&(r.nextColumn=r.nextColumn.nextColumn()),r.nextColumn&&r.nextColumn.setWidth(r.nextColumn.getWidth()-c)}r.table.columnManager.rerenderColumns(!0),!r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}function o(s){r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",a),n.removeEventListener("touchmove",a),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.table.externalEvents.dispatch("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.screenX>"u"?e.touches[0].screenX:e.screenX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",a,{passive:!0}),n.addEventListener("touchend",o)}}n0e.moduleName="resizeColumns";class r0e extends en{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",o),r.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var u=i.table.rowManager.prevDisplayRow(e);u&&(i.startRow=u,i._mouseDown(l,u,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),n.appendChild(r),n.appendChild(a)}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function a(s){i.setHeight(r.startHeight+((typeof s.screenY>"u"?s.touches[0].screenY:s.screenY)-r.startY))}function o(s){document.body.removeEventListener("mouseup",a),document.body.removeEventListener("mousemove",a),n.removeEventListener("touchmove",a),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",a,{passive:!0}),n.addEventListener("touchend",o)}}r0e.moduleName="resizeRows";class a0e extends en{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=a)&&(this.tableHeight=r,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=a)&&(this.containerHeight=r,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}a0e.moduleName="resizeTable";class o0e extends en{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};r={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},n.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,r,a.modules.format.params,s)})}else n.push({field:a.field,title:a.definition.title,value:o})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(function(n){var r=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.langBind("columns|"+n.field,function(u){l.innerHTML=u||n.title}),n.value instanceof Node?(s=document.createElement("div"),s.appendChild(n.value),o.appendChild(s)):o.innerHTML=n.value,r.appendChild(a),r.appendChild(o),i.appendChild(r)},this),Object.keys(e).length?i:""}}o0e.moduleName="responsiveLayout";class s0e extends en{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){this.deprecationCheck("selectable","selectableRows",!0),this.deprecationCheck("selectableRollingSelection","selectableRowsRollingSelection",!0),this.deprecationCheck("selectableRangeMode","selectableRowsRangeMode",!0),this.deprecationCheck("selectablePersistence","selectableRowsPersistence",!0),this.deprecationCheck("selectableCheck","selectableRowsCheck",!0)}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),a=n<=r?n:r,o=n>=r?n:r,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(a=>{r=this._selectRow(a,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,a;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&n.push(a)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),a,o;if(r){if(a=n.selectedRows.findIndex(function(s){return s==r}),a>-1)return o=r.getElement(),o&&o.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}s0e.moduleName="selectRow";function G7e(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,u=o.thousandSeparator,c=0;if(t=String(t),e=String(e),u&&(t=t.split(u).join(""),e=e.split(u).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(c*=-1),c}function H7e(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=0,u;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(u=this.langLocale());break;case"string":u=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function V6(t,e,i,n,r,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",u=o.alignEmptyValues,c=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return t-e;return(u==="top"&&a==="desc"||u==="bottom"&&a==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function z7e(t,e,i,n,r,a,o){return o.format||(o.format="dd/MM/yyyy"),V6.call(this,t,e,i,n,r,a,o)}function q7e(t,e,i,n,r,a,o){return o.format||(o.format="HH:mm"),V6.call(this,t,e,i,n,r,a,o)}function W7e(t,e,i,n,r,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function K7e(t,e,i,n,r,a,o){var s=o.type||"length",l=o.alignEmptyValues,u=0;function c(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(f,h){return f+h});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(f,h){return f+h})/d.length;break}return p}if(!Array.isArray(t))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return c(e)-c(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(u*=-1),u}function Y7e(t,e,i,n,r,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function Z7e(t,e,i,n,r,a,o){var s,l,u,c,d=0,p,f=/(\d+)|(\D+)/g,h=/\d/,m=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(h.test(s)&&h.test(l)))return s>l?1:-1;for(s=s.match(f),l=l.match(f),p=s.length>l.length?l.length:s.length;d<p;)if(u=s[d],c=l[d++],u!==c)return isFinite(u)&&isFinite(c)?(u.charAt(0)==="0"&&(u="."+u),c.charAt(0)==="0"&&(c="."+c),u-c):u>c?1:-1;return s.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var X7e={number:G7e,string:H7e,date:z7e,time:q7e,datetime:V6,boolean:W7e,array:K7e,exists:Y7e,alphanum:Z7e};class Hv extends en{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var a=this.getSort();return a.forEach(o=>{delete o.column}),r.sort=a,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":Hv.sorters[e.definition.sorter]?i=Hv.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(u=>u.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=n.table.columnManager.findColumn(a.column),o?(a.column=o,r.push(a),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,a;if(i&&(i=i.getData(),r=e.getField(),r))switch(a=e.getFieldValue(i),typeof a){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(a)&&a!==""?n="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return Hv.sorters[n]}sort(e){var i=this,n=this.table.options.sortOrderReverse?i.sortList.slice().reverse():i.sortList,r=[],a=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",i.getSort()),i.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,s){var l;o.column&&(l=o.column.modules.sort,l&&(l.sorter||(l.sorter=i.findSorter(o.column)),o.params=typeof l.params=="function"?l.params(o.column.getComponent(),o.dir):l.params,r.push(o)),i.setColumnHeader(o.column,o.dir))}),r.length&&i._sortItems(e,r)):n.forEach(function(o,s){i.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{a.push(o.getComponent())}),this.dispatchExternal("dataSorted",i.getSort(),a)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,a)=>{for(var o,s=n;s>=0;s--){let l=i[s];if(o=this._sortRow(r,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,n,r,a){var o,s,l=r=="asc"?e:i,u=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(u.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=u.getComponent(),n.modules.sort.sorter.call(this,e,i,o,s,n.getComponent(),r,a)}}Hv.moduleName="sort";Hv.sorters=X7e;class J7e{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class Q7e extends hl{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows()}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,a,o,s,l,u,c;e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,n),l=Math.min(this.right,r),u=this.rangeManager.getCell(a,s),c=this.rangeManager.getCell(o,l),this.element.classList.add("tabulator-range-active"),this.element.style.left=u.row.getElement().offsetLeft+u.getElement().offsetLeft+"px",this.element.style.top=u.row.getElement().offsetTop+"px",this.element.style.width=c.getElement().offsetLeft+c.getElement().offsetWidth-u.getElement().offsetLeft+"px",this.element.style.height=c.row.getElement().offsetTop+c.row.getElement().offsetHeight-u.row.getElement().offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var a=r.getData(),o={};n.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var n=[],r=this.getRows(),a=this.getColumns();return e?n=r.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):r.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&n.push(i?s.getComponent():s)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new J7e(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}class l0e extends en{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior")))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e)&&i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i)&&e.preventDefault()}navigate(e,i,n){var r=!1,a,o,s,l,u,c;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(n){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(r=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),r)return u=this.getRowByRangePos(a.end.row),c=this.getColumnByRangePos(a.end.col),(n==="left"||n==="right")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):(n==="up"||n==="down")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):this.autoScroll(a,u.getElement(),c.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,i,n,r){var a;i&&(e=e.reverse());for(let o of e){let s=o.getValue();if(n){if(a=o,s)break}else if(r){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(c=>c.column.visible),a=!r[i].getValue(),o=r[i]?!r[i].getValue():!1,s=i,l=this.rowHeader?r.slice(1,i):r.slice(0,i),u=this.findJumpCell(l,!0,a,o);return u&&(s=u.column.getPosition()-1),s}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(u=>u.column.visible),a=!r[i].getValue(),o=r[i+1]?!r[i+1].getValue():!1,s=i,l=this.findJumpCell(r.slice(i+1,r.length),!1,a,o);return l&&(s=l.column.getPosition()-1),s}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(u=>this.table.rowManager.activeRows.includes(u.row)),a=!r[e].getValue(),o=r[e-1]?!r[e-1].getValue():!1,s=e,l=this.findJumpCell(r.slice(0,s),!0,a,o);return l&&(s=l.row.position-1),s}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(u=>this.table.rowManager.activeRows.includes(u.row)),a=!r[e].getValue(),o=r[e+1]?!r[e+1].getValue():!1,s=e,l=this.findJumpCell(r.slice(s+1,r.length),!1,a,o);return l&&(s=l.row.position-1),s}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,a=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,a,o,s,l,u;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:r.scrollLeft,right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,u=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(r.scrollLeft=o.left,a&&(r.scrollLeft-=a.offsetWidth)):o.right>s.right&&(r.scrollLeft=o.right-r.clientWidth)),u||(o.top<s.top?r.scrollTop=o.top:o.bottom>s.bottom&&(r.scrollTop=o.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e;this.table.initialized&&(e=this.getActiveCell(),e&&(this.activeRangeCellElement.style.left=e.row.getElement().offsetLeft+e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.top=e.row.getElement().offsetTop+"px",this.activeRangeCellElement.style.width=e.getElement().offsetLeft+e.getElement().offsetWidth-e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.height=e.row.getElement().offsetTop+e.row.getElement().offsetHeight-e.row.getElement().offsetTop+"px",this.ranges.forEach(i=>i.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows()}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new Q7e(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(i=this.table.rowManager.activeRows[0].cells[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}}l0e.moduleName="selectRange";class u0e extends en{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipGenerationMode",void 0),this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,a,o;function s(l){a=l}typeof n=="function"&&(n=n(e,i.getComponent(),s)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof RE?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}u0e.moduleName="tooltip";var e9e={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==r&&e==a.getFieldValue(s)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class _E extends en{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{r=i._extractValidator(a),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:_E.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(r,i.getComponent(),n,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}_E.moduleName="validate";_E.validators=e9e;var t9e=Object.freeze({__proto__:null,AccessorModule:qw,AjaxModule:Jc,ClipboardModule:Ty,ColumnCalcsModule:Em,DataTreeModule:zwe,DownloadModule:Ww,EditModule:ME,ExportModule:qwe,FilterModule:Vf,FormatModule:ec,FrozenColumnsModule:Wwe,FrozenRowsModule:Kwe,GroupRowsModule:Ywe,HistoryModule:Uy,HtmlTableImportModule:Zwe,ImportModule:NE,InteractionModule:Xwe,KeybindingsModule:km,MenuModule:Jwe,MoveColumnsModule:Qwe,MoveRowsModule:Ax,MutatorModule:Kw,PageModule:AE,PersistenceModule:Sl,PopupModule:e0e,PrintModule:t0e,ReactiveDataModule:i0e,ResizeColumnsModule:n0e,ResizeRowsModule:r0e,ResizeTableModule:a0e,ResponsiveLayoutModule:o0e,SelectRowModule:s0e,SortModule:Hv,SelectRangeModule:l0e,TooltipModule:u0e,ValidateModule:_E}),i9e={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class c0e{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let a in i)n.hasOwnProperty(a)||(r&&console.warn("Invalid "+this.msgType+" option:",a),n[a]=i.key);for(let a in n)a in i?n[a]=i[a]:Array.isArray(n[a])?n[a]=Object.assign([],n[a]):typeof n[a]=="object"&&n[a]!==null?n[a]=Object.assign({},n[a]):typeof n[a]>"u"&&delete n[a];return n}}class _x extends hl{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&Gr.elVisible(a)&&(o=Gr.elOffset(a).top-Gr.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class n9e extends _x{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class r9e extends _x{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=r,o.rightPos=r+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),r+s>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,r+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let a=i.cells[r];n.appendChild(a.getElement()),a.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let a=this.columns[r];a.modules.vdomHoz.leftPos+=n,a.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);r.getElement().insertBefore(a.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(n);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class a9e extends hl{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new c0e(this.table,"column definition",Hwe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:r9e,basic:n9e};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n=this.table.options.autoColumnsDefinitions,r,a;if(e&&e.length){r=e[0];for(var o in r){let s={field:o,title:o},l=r[o];switch(typeof l){case"undefined":a="string";break;case"boolean":a="boolean";break;case"object":Array.isArray(l)?a="array":a="string";break;default:!isNaN(l)&&l!==""?a="number":l.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?a="alphanum":a="string";break}s.sorter=a,i.push(s)}if(n)switch(typeof n){case"function":this.table.options.columns=n.call(this.table,i);break;case"object":Array.isArray(n)?i.forEach(s=>{var l=n.find(u=>u.field===s.field);l&&Object.assign(s,l)}):i.forEach(s=>{n[s.field]&&Object.assign(s,n[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new fp(e,this),a=r.getElement(),o=n&&this.findColumnIndex(n);if(n&&o>-1){var s=n.getTopColumn(),l=this.columns.indexOf(s),u=s.getElement();i?(this.columns.splice(l,0,r),u.parentNode.insertBefore(a,u)):(this.columns.splice(l+1,0,r),u.parentNode.insertBefore(a,u.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof fp)return e;if(e instanceof Gwe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(n),s>-1?r&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var c=u.cells.splice(o,1)[0];u.cells.splice(s,0,c)}})))}scrollToColumn(e,i,n){var r=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,u)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!n&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;r=a+o,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,a,o;n.visible&&(r=n.definition.width||0,a=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?o=e/100*parseInt(r):o=parseInt(r):o=r,i+=o>a?o:a)}),i}addColumn(e,i,n){return new Promise((r,a)=>{var o=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(o)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Gr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class o9e extends _x{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),n.appendChild(a.getElement())}),e.appendChild(n),r.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),r.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Gr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Gr.elOffset(i).top-Gr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class s9e extends _x{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=s;else break}o.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-n>a||r>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(n<0&&this._addTopRow(o,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(o,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(r)if(n-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(r=!0,n-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,u=0,c=0,d=0,p=this.rows(),f=p.length,h=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,T=this.elementVertical.clientHeight,w=this.table.options.rowHeight,S=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);u=(f-e+1)*this.vDomRowHeight,u<T&&(e-=Math.ceil((T-u)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(f&&Gr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(w&&(b=T/w+this.vDomWindowBuffer/w),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=f;(b==f||s<=T+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<f-1;)h=this.vDomBottom+1,m=p[h],this.styleRow(m,h),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(U=>{U.rendered(),U.heightInitialized||U.calcHeight(!0)}),v.forEach(U=>{U.heightInitialized||U.setCellHeight()}),v.forEach(U=>{l=U.getHeight(),y<o?c+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),S=this.table.rowManager.adjustTableSize(),T=this.elementVertical.clientHeight,S&&(I||this.table.options.maxHeight)&&(w=s/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(T/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+c)/y),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=c+s+this.vDomBottomPad-T),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+c+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-T:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-T),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-T),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),n.insertBefore(u.getElement(),n.firstChild),(!u.initialized||!u.heightInitialized)&&r.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let u of r)u.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let u=e[o],c,d;u&&s<this.vDomMaxRenderChain?(c=u.getHeight()||this.vDomRowHeight,d=u.initialized,i>=c?(this.styleRow(u,o),n.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&r.push(u),u.initialize(),d||(c=u.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),i-=c,a+=c,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let u of r)u.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class l9e extends hl{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof _s)return e;if(e instanceof Mx)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var a=new _s(n,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var a=this.addRowActual(e,i,n,r);return a}addRows(e,i,n,r){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,u)=>{var c=this.addRow(l,i,n,!0);a.push(c),this.dispatch("row-added",c,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var a=e instanceof _s?e:new _s(e||{},this),o=this.findAddRowPos(i),s=-1,l,u;return n||(u=this.chain("row-adding-position",[a,o],null,{index:n,top:o}),n=u.index,o=u.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[a,n,o],null,n),n&&(s=this.rows.indexOf(n)),n&&s>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(c){var d=c.indexOf(n);d>-1&&c.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(c){c.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(c){c.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),a}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var a,o,s,l;if(i!==n&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(n),o>-1?r?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let u=s;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof _s)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof _s)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(a){a.type=="row"&&n.push(a.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:a,index:o});return}else Gr.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,n)):(this.refreshPipelines(e,a,o,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=n;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let a=n;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),r);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:s9e,basic:o9e};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class u9e extends hl{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class c9e extends hl{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(a=>{var o=r[e];return a!==e&&(!o||o&&!o.includes(a))}),n.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let a=n+"-"+r;this.subscriptionChange(a,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,a=r.indexOf(e),o=!1;n?a===-1&&(r.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(r.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let a=r.classList?[...r.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>n.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],a={},o={};for(let s of n){let l,u=i[s],c=this.previousTargets[s];if(c&&c.target===u)l=c.component;else switch(s){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===u),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":r.components.includes("column")&&(l=this.table.columnManager.findColumn(u));break;case"cell":r.components.includes("cell")&&(a.row instanceof _s?l=a.row.findCell(u):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:u,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,n){var r=this.listeners[e];for(let a in n)n[a]&&r.components.includes(a)&&this.dispatch(a+"-"+e,i,n[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class d9e{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class p9e extends hl{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,n,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,a],!1,Promise.resolve([]));return l.then(u=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",u,null,u);s==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,r,typeof o>"u"?!r:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof o>"u"?!r:o),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class f9e{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,a)=>{let o=r.apply(this.table,e);a||(n=o)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class h9e{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,a)=>r.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var a=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,a)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class m9e extends hl{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class yu{static register(e){yu.tables.push(e)}static deregister(e){var i=yu.tables.indexOf(e);i>-1&&yu.tables.splice(i,1)}static lookupTable(e,i){var n=[],r,a;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var o=0;o<r.length;o++)a=yu.matchElement(r[o]),a&&n.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Dy?(a=yu.matchElement(e),a&&n.push(a)):Array.isArray(e)?e.forEach(function(s){n=n.concat(yu.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n}static matchElement(e){return yu.tables.find(function(i){return e instanceof Dy?i===e:i.element===e})}}yu.tables=[];function g9e(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function $Y(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function v9e(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(r=n-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?a.setWidth(r):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function y9e(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,a=0,o=0,s=[],l=[],u=0,c=0,d=0;function p(h){var m;return typeof h=="string"?h.indexOf("%")>-1?m=i/100*parseInt(h):m=parseInt(h):m=h,m}function f(h,m,g,v){var y=[],b=0,I=0,T=0,w=a,S=0,U=0,P=[];function E(R){return g*(R.column.definition.widthGrow||1)}function D(R){return p(R.width)-g*(R.column.definition.widthShrink||0)}return h.forEach(function(R,N){var M=v?D(R):E(R);R.column.minWidth>=M?y.push(R):R.column.maxWidth&&R.column.maxWidth<M?(R.width=R.column.maxWidth,m-=R.column.maxWidth,w-=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1,w&&(g=Math.floor(m/w))):(P.push(R),U+=v?R.column.definition.widthShrink||1:R.column.definition.widthGrow||1)}),y.length?(y.forEach(function(R){b+=v?R.width-R.column.minWidth:R.column.minWidth,R.width=R.column.minWidth}),I=m-b,T=U?Math.floor(I/U):I,S=f(P,I,T,v)):(S=U?m-Math.floor(m/U)*U:m,P.forEach(function(R){R.width=v?D(R):E(R)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var m,g,v;h.visible&&(m=h.definition.width,g=parseInt(h.minWidth),m?(v=p(m),n+=v>g?v:g,h.definition.widthShrink&&(l.push({column:h,width:v>g?v:g}),u+=h.definition.widthShrink)):(s.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),r=i-n,o=Math.floor(r/a),d=f(s,r,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(h){r-=h.width}),c=Math.abs(d)+r,c>0&&u&&(d=f(l,c,Math.floor(c/u),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var b9e={fitData:g9e,fitDataFill:$Y,fitDataTable:$Y,fitDataStretch:v9e,fitColumns:y9e};class Yw extends en{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;Yw.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),Yw.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}}Yw.moduleName="layout";Yw.modes=b9e;var I9e={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class kE extends en{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Gr.deepClone(kE.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var a in n)typeof n[a]=="object"?(r[a]||(r[a]={}),i(n[a],r[a])):r[a]=n[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Gr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),a=this._getLangElement(r,this.locale);return a||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var a;n&&(a=n[r],typeof a<"u"?n=a:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}kE.moduleName="localize";kE.langs=I9e;class d0e extends en{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=yu.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,n,r)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}d0e.moduleName="comms";var w9e=Object.freeze({__proto__:null,LayoutModule:Yw,LocalizeModule:kE,CommsModule:d0e});class p0e{constructor(e,i){this.bindStaticFunctionality(e),this.bindModules(e,w9e,!0),i&&this.bindModules(e,i)}bindStaticFunctionality(e){e.moduleBindings={},e.extendModule=function(i,n,r){if(e.moduleBindings[i]){var a=e.moduleBindings[i][n];if(a)if(typeof r=="object")for(let o in r)a[o]=r[o];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",n)}else console.warn("Module Error - module does not exist:",i)},e.registerModule=function(i){Array.isArray(i)||(i=[i]),i.forEach(n=>{e.registerModuleBinding(n)})},e.registerModuleBinding=function(i){e.moduleBindings[i.moduleName]=i},e.findTable=function(i){var n=yu.lookupTable(i,!0);return Array.isArray(n)&&!n.length?!1:n},e.prototype.bindModules=function(){var i=[],n=[],r=[];this.modules={};for(var a in e.moduleBindings){let o=e.moduleBindings[a],s=new o(this);this.modules[a]=s,o.prototype.moduleCore?this.modulesCore.push(s):o.moduleInitOrder?o.moduleInitOrder<0?i.push(s):n.push(s):r.push(s)}i.sort((o,s)=>o.moduleInitOrder>s.moduleInitOrder?1:-1),n.sort((o,s)=>o.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=i.concat(r.concat(n))}}bindModules(e,i,n){var r=Object.values(i);n&&r.forEach(a=>{a.prototype.moduleCore=!0}),e.registerModule(r)}}class S9e extends hl{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class Dy{constructor(e,i){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new d9e(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new m9e(this),this.optionsList=new c0e(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),yu.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new a9e(this),this.rowManager=new l9e(this),this.footerManager=new u9e(this),this.dataLoader=new p9e(this),this.alertManager=new S9e(this),this.bindModules(),this.options=this.optionsList.generate(Dy.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new f9e(this,this.options,this.options.debugEventsExternal),this.eventBus=new h9e(this.options.debugEventsInternal),this.interactionMonitor=new c9e(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var a in r)typeof r[a]=="object"&&n.setAttribute(r[a].name,r[a].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){this.dataLoader.load(this.options.data),this.columnManager.verticalAlignHeaders()}destroy(){var e=this.element;for(this.destroyed=!0,yu.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||n()}).catch(s=>{r("Update Error - Unable to update row",a,s)})):r("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),r(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);n++,s?s.updateData(o).then(()=>{n--,i.push(s.getComponent()),n||r(i)}):this.rowManager.addRows(o).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),r?a?this.columnManager.moveColumn(r,a,n):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}Dy.defaultOptions=i9e;new p0e(Dy);class da extends Dy{}new p0e(da,t9e);const{MALE:T9e,FEMALE:U9e}=kc;function D9e(t){var o;const e=t.getValue(),i=t.getRow().getData(),n=i.sex||((o=i.person)==null?void 0:o.sex),r=(n==null?void 0:n.toUpperCase())===T9e&&"#2E86C1"||(n==null?void 0:n.toUpperCase())===U9e&&"#AA336A"||"",a=document.createElement("div");return a.style.color=r,a.innerHTML=e,a}function P9e(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:D9e,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function f0e(t){let{data:e=[]}=t;const{selectedParticipantIds:i,selectionLimit:n=1,targetAttribute:r,placeholder:a,onSelected:o,anchorId:s}=t;e.some(p=>p.participant)&&(e=e.map(({participant:p,...f})=>({...f,participantName:"BYE",...p}))),e.forEach(p=>{var f;return p.searchText=(f=p.participantName)==null?void 0:f.toLowerCase()});const u=P9e(e),c=document.getElementById(s),d=new da(c,{placeholder:a||"No options",selectable:n,index:r,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:u,data:e});return ze.tables||(ze.tables={}),ze.tables.selectionTable=d,d.on("tableBuilt",()=>{i!=null&&i.length&&d.selectRow(i)}),d.on("rowSelectionChanged",(p,f)=>{const h=f==null?void 0:f.map(m=>m.getData());rt(o)&&o(h)}),{table:d}}function j6(t){const{title:e,placeholder:i,options:n,selectionLimit:r}=t,a="selectionControl",o="selectionTable",s=[{label:"Cancel",intent:"is-none",close:!0}],l=()=>{const m=ze.tables.selectionTable;m==null||m.destroy(),delete ze.tables.selectionTable},u=`
    <div style='min-height: 420px'>
      <div id='${a}'></div>
      <div id='${o}'></div>
    </div>
  `;yn({title:e,content:u,buttons:s,onClose:l});const c=m=>{var g;(g=m==null?void 0:m[0])!=null&&g.onClick&&(m[0].onClick(),Hw())},{table:d}=f0e({targetAttribute:"participantid",selectionLimit:r,data:n,placeholder:i,onSelected:c,anchorId:o}),p=_b(d),f=[{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onChange:m=>p(m.target.value),onKeyUp:m=>p(m.target.value),clearSearch:()=>p(""),placeholder:"Search",location:Ct,search:!0}],h=document.getElementById(a);no({table:d,target:h,items:f})}var Fl="top",Cc="bottom",Rc="right",Bl="left",G6="auto",OE=[Fl,Cc,Rc,Bl],Zw="start",b1="end",E9e="clippingParents",h0e="viewport",qS="popper",C9e="reference",VY=OE.reduce(function(t,e){return t.concat([e+"-"+Zw,e+"-"+b1])},[]),m0e=[].concat(OE,[G6]).reduce(function(t,e){return t.concat([e,e+"-"+Zw,e+"-"+b1])},[]),R9e="beforeRead",M9e="read",N9e="afterRead",A9e="beforeMain",_9e="main",k9e="afterMain",O9e="beforeWrite",x9e="write",L9e="afterWrite",F9e=[R9e,M9e,N9e,A9e,_9e,k9e,O9e,x9e,L9e];function $p(t){return t?(t.nodeName||"").toLowerCase():null}function Hu(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Py(t){var e=Hu(t).Element;return t instanceof e||t instanceof Element}function dc(t){var e=Hu(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function H6(t){if(typeof ShadowRoot>"u")return!1;var e=Hu(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function B9e(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},a=e.elements[i];!dc(a)||!$p(a)||(Object.assign(a.style,n),Object.keys(r).forEach(function(o){var s=r[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function $9e(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],a=e.attributes[n]||{},o=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),s=o.reduce(function(l,u){return l[u]="",l},{});!dc(r)||!$p(r)||(Object.assign(r.style,s),Object.keys(a).forEach(function(l){r.removeAttribute(l)}))})}}const g0e={name:"applyStyles",enabled:!0,phase:"write",fn:B9e,effect:$9e,requires:["computeStyles"]};function hp(t){return t.split("-")[0]}var zv=Math.max,ZN=Math.min,Xw=Math.round;function X$(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function v0e(){return!/^((?!chrome|android).)*safari/i.test(X$())}function Jw(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,a=1;e&&dc(t)&&(r=t.offsetWidth>0&&Xw(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&Xw(n.height)/t.offsetHeight||1);var o=Py(t)?Hu(t):window,s=o.visualViewport,l=!v0e()&&i,u=(n.left+(l&&s?s.offsetLeft:0))/r,c=(n.top+(l&&s?s.offsetTop:0))/a,d=n.width/r,p=n.height/a;return{width:d,height:p,top:c,right:u+d,bottom:c+p,left:u,x:u,y:c}}function z6(t){var e=Jw(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function y0e(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&H6(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function wh(t){return Hu(t).getComputedStyle(t)}function V9e(t){return["table","td","th"].indexOf($p(t))>=0}function Wg(t){return((Py(t)?t.ownerDocument:t.document)||window.document).documentElement}function kx(t){return $p(t)==="html"?t:t.assignedSlot||t.parentNode||(H6(t)?t.host:null)||Wg(t)}function jY(t){return!dc(t)||wh(t).position==="fixed"?null:t.offsetParent}function j9e(t){var e=/firefox/i.test(X$()),i=/Trident/i.test(X$());if(i&&dc(t)){var n=wh(t);if(n.position==="fixed")return null}var r=kx(t);for(H6(r)&&(r=r.host);dc(r)&&["html","body"].indexOf($p(r))<0;){var a=wh(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function xE(t){for(var e=Hu(t),i=jY(t);i&&V9e(i)&&wh(i).position==="static";)i=jY(i);return i&&($p(i)==="html"||$p(i)==="body"&&wh(i).position==="static")?e:i||j9e(t)||e}function q6(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function WT(t,e,i){return zv(t,ZN(e,i))}function G9e(t,e,i){var n=WT(t,e,i);return n>i?i:n}function b0e(){return{top:0,right:0,bottom:0,left:0}}function I0e(t){return Object.assign({},b0e(),t)}function w0e(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var H9e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,I0e(typeof e!="number"?e:w0e(e,OE))};function z9e(t){var e,i=t.state,n=t.name,r=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=hp(i.placement),l=q6(s),u=[Bl,Rc].indexOf(s)>=0,c=u?"height":"width";if(!(!a||!o)){var d=H9e(r.padding,i),p=z6(a),f=l==="y"?Fl:Bl,h=l==="y"?Cc:Rc,m=i.rects.reference[c]+i.rects.reference[l]-o[l]-i.rects.popper[c],g=o[l]-i.rects.reference[l],v=xE(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[f],T=y-p[c]-d[h],w=y/2-p[c]/2+b,S=WT(I,w,T),U=l;i.modifiersData[n]=(e={},e[U]=S,e.centerOffset=S-w,e)}}function q9e(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||y0e(e.elements.popper,r)&&(e.elements.arrow=r))}const W9e={name:"arrow",enabled:!0,phase:"main",fn:z9e,effect:q9e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Qw(t){return t.split("-")[1]}var K9e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Y9e(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:Xw(i*r)/r||0,y:Xw(n*r)/r||0}}function GY(t){var e,i=t.popper,n=t.popperRect,r=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,d=t.isFixed,p=o.x,f=p===void 0?0:p,h=o.y,m=h===void 0?0:h,g=typeof c=="function"?c({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=Bl,I=Fl,T=window;if(u){var w=xE(i),S="clientHeight",U="clientWidth";if(w===Hu(i)&&(w=Wg(i),wh(w).position!=="static"&&s==="absolute"&&(S="scrollHeight",U="scrollWidth")),w=w,r===Fl||(r===Bl||r===Rc)&&a===b1){I=Cc;var P=d&&w===T&&T.visualViewport?T.visualViewport.height:w[S];m-=P-n.height,m*=l?1:-1}if(r===Bl||(r===Fl||r===Cc)&&a===b1){b=Rc;var E=d&&w===T&&T.visualViewport?T.visualViewport.width:w[U];f-=E-n.width,f*=l?1:-1}}var D=Object.assign({position:s},u&&K9e),R=c===!0?Y9e({x:f,y:m},Hu(i)):{x:f,y:m};if(f=R.x,m=R.y,l){var N;return Object.assign({},D,(N={},N[I]=y?"0":"",N[b]=v?"0":"",N.transform=(T.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",N))}return Object.assign({},D,(e={},e[I]=y?m+"px":"",e[b]=v?f+"px":"",e.transform="",e))}function Z9e(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,u={placement:hp(e.placement),variation:Qw(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,GY(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,GY(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const X9e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Z9e,data:{}};var UC={passive:!0};function J9e(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,a=r===void 0?!0:r,o=n.resize,s=o===void 0?!0:o,l=Hu(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&u.forEach(function(c){c.addEventListener("scroll",i.update,UC)}),s&&l.addEventListener("resize",i.update,UC),function(){a&&u.forEach(function(c){c.removeEventListener("scroll",i.update,UC)}),s&&l.removeEventListener("resize",i.update,UC)}}const Q9e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:J9e,data:{}};var eKe={left:"right",right:"left",bottom:"top",top:"bottom"};function jR(t){return t.replace(/left|right|bottom|top/g,function(e){return eKe[e]})}var tKe={start:"end",end:"start"};function HY(t){return t.replace(/start|end/g,function(e){return tKe[e]})}function W6(t){var e=Hu(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function K6(t){return Jw(Wg(t)).left+W6(t).scrollLeft}function iKe(t,e){var i=Hu(t),n=Wg(t),r=i.visualViewport,a=n.clientWidth,o=n.clientHeight,s=0,l=0;if(r){a=r.width,o=r.height;var u=v0e();(u||!u&&e==="fixed")&&(s=r.offsetLeft,l=r.offsetTop)}return{width:a,height:o,x:s+K6(t),y:l}}function nKe(t){var e,i=Wg(t),n=W6(t),r=(e=t.ownerDocument)==null?void 0:e.body,a=zv(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=zv(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-n.scrollLeft+K6(t),l=-n.scrollTop;return wh(r||i).direction==="rtl"&&(s+=zv(i.clientWidth,r?r.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function Y6(t){var e=wh(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function S0e(t){return["html","body","#document"].indexOf($p(t))>=0?t.ownerDocument.body:dc(t)&&Y6(t)?t:S0e(kx(t))}function KT(t,e){var i;e===void 0&&(e=[]);var n=S0e(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),a=Hu(n),o=r?[a].concat(a.visualViewport||[],Y6(n)?n:[]):n,s=e.concat(o);return r?s:s.concat(KT(kx(o)))}function J$(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function rKe(t,e){var i=Jw(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function zY(t,e,i){return e===h0e?J$(iKe(t,i)):Py(e)?rKe(e,i):J$(nKe(Wg(t)))}function aKe(t){var e=KT(kx(t)),i=["absolute","fixed"].indexOf(wh(t).position)>=0,n=i&&dc(t)?xE(t):t;return Py(n)?e.filter(function(r){return Py(r)&&y0e(r,n)&&$p(r)!=="body"}):[]}function oKe(t,e,i,n){var r=e==="clippingParents"?aKe(t):[].concat(e),a=[].concat(r,[i]),o=a[0],s=a.reduce(function(l,u){var c=zY(t,u,n);return l.top=zv(c.top,l.top),l.right=ZN(c.right,l.right),l.bottom=ZN(c.bottom,l.bottom),l.left=zv(c.left,l.left),l},zY(t,o,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function T0e(t){var e=t.reference,i=t.element,n=t.placement,r=n?hp(n):null,a=n?Qw(n):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(r){case Fl:l={x:o,y:e.y-i.height};break;case Cc:l={x:o,y:e.y+e.height};break;case Rc:l={x:e.x+e.width,y:s};break;case Bl:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var u=r?q6(r):null;if(u!=null){var c=u==="y"?"height":"width";switch(a){case Zw:l[u]=l[u]-(e[c]/2-i[c]/2);break;case b1:l[u]=l[u]+(e[c]/2-i[c]/2);break}}return l}function I1(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?E9e:s,u=i.rootBoundary,c=u===void 0?h0e:u,d=i.elementContext,p=d===void 0?qS:d,f=i.altBoundary,h=f===void 0?!1:f,m=i.padding,g=m===void 0?0:m,v=I0e(typeof g!="number"?g:w0e(g,OE)),y=p===qS?C9e:qS,b=t.rects.popper,I=t.elements[h?y:p],T=oKe(Py(I)?I:I.contextElement||Wg(t.elements.popper),l,c,o),w=Jw(t.elements.reference),S=T0e({reference:w,element:b,strategy:"absolute",placement:r}),U=J$(Object.assign({},b,S)),P=p===qS?U:w,E={top:T.top-P.top+v.top,bottom:P.bottom-T.bottom+v.bottom,left:T.left-P.left+v.left,right:P.right-T.right+v.right},D=t.modifiersData.offset;if(p===qS&&D){var R=D[r];Object.keys(E).forEach(function(N){var M=[Rc,Cc].indexOf(N)>=0?1:-1,A=[Fl,Cc].indexOf(N)>=0?"y":"x";E[N]+=R[A]*M})}return E}function sKe(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?m0e:l,c=Qw(n),d=c?s?VY:VY.filter(function(h){return Qw(h)===c}):OE,p=d.filter(function(h){return u.indexOf(h)>=0});p.length===0&&(p=d);var f=p.reduce(function(h,m){return h[m]=I1(t,{placement:m,boundary:r,rootBoundary:a,padding:o})[hp(m)],h},{});return Object.keys(f).sort(function(h,m){return f[h]-f[m]})}function lKe(t){if(hp(t)===G6)return[];var e=jR(t);return[HY(t),e,HY(e)]}function uKe(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,u=i.padding,c=i.boundary,d=i.rootBoundary,p=i.altBoundary,f=i.flipVariations,h=f===void 0?!0:f,m=i.allowedAutoPlacements,g=e.options.placement,v=hp(g),y=v===g,b=l||(y||!h?[jR(g)]:lKe(g)),I=[g].concat(b).reduce(function(H,z){return H.concat(hp(z)===G6?sKe(e,{placement:z,boundary:c,rootBoundary:d,padding:u,flipVariations:h,allowedAutoPlacements:m}):z)},[]),T=e.rects.reference,w=e.rects.popper,S=new Map,U=!0,P=I[0],E=0;E<I.length;E++){var D=I[E],R=hp(D),N=Qw(D)===Zw,M=[Fl,Cc].indexOf(R)>=0,A=M?"width":"height",_=I1(e,{placement:D,boundary:c,rootBoundary:d,altBoundary:p,padding:u}),k=M?N?Rc:Bl:N?Cc:Fl;T[A]>w[A]&&(k=jR(k));var B=jR(k),F=[];if(a&&F.push(_[R]<=0),s&&F.push(_[k]<=0,_[B]<=0),F.every(function(H){return H})){P=D,U=!1;break}S.set(D,F)}if(U)for(var x=h?3:1,$=function(z){var q=I.find(function(W){var Y=S.get(W);if(Y)return Y.slice(0,z).every(function(Z){return Z})});if(q)return P=q,"break"},j=x;j>0;j--){var V=$(j);if(V==="break")break}e.placement!==P&&(e.modifiersData[n]._skip=!0,e.placement=P,e.reset=!0)}}const cKe={name:"flip",enabled:!0,phase:"main",fn:uKe,requiresIfExists:["offset"],data:{_skip:!1}};function qY(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function WY(t){return[Fl,Rc,Cc,Bl].some(function(e){return t[e]>=0})}function dKe(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,o=I1(e,{elementContext:"reference"}),s=I1(e,{altBoundary:!0}),l=qY(o,n),u=qY(s,r,a),c=WY(l),d=WY(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}const pKe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:dKe};function fKe(t,e,i){var n=hp(t),r=[Bl,Fl].indexOf(n)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*r,[Bl,Rc].indexOf(n)>=0?{x:s,y:o}:{x:o,y:s}}function hKe(t){var e=t.state,i=t.options,n=t.name,r=i.offset,a=r===void 0?[0,0]:r,o=m0e.reduce(function(c,d){return c[d]=fKe(d,e.rects,a),c},{}),s=o[e.placement],l=s.x,u=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=o}const mKe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:hKe};function gKe(t){var e=t.state,i=t.name;e.modifiersData[i]=T0e({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const vKe={name:"popperOffsets",enabled:!0,phase:"read",fn:gKe,data:{}};function yKe(t){return t==="x"?"y":"x"}function bKe(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,u=i.rootBoundary,c=i.altBoundary,d=i.padding,p=i.tether,f=p===void 0?!0:p,h=i.tetherOffset,m=h===void 0?0:h,g=I1(e,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),v=hp(e.placement),y=Qw(e.placement),b=!y,I=q6(v),T=yKe(I),w=e.modifiersData.popperOffsets,S=e.rects.reference,U=e.rects.popper,P=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),D=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(w){if(a){var N,M=I==="y"?Fl:Bl,A=I==="y"?Cc:Rc,_=I==="y"?"height":"width",k=w[I],B=k+g[M],F=k-g[A],x=f?-U[_]/2:0,$=y===Zw?S[_]:U[_],j=y===Zw?-U[_]:-S[_],V=e.elements.arrow,H=f&&V?z6(V):{width:0,height:0},z=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:b0e(),q=z[M],W=z[A],Y=WT(0,S[_],H[_]),Z=b?S[_]/2-x-Y-q-E.mainAxis:$-Y-q-E.mainAxis,X=b?-S[_]/2+x+Y+W+E.mainAxis:j+Y+W+E.mainAxis,Q=e.elements.arrow&&xE(e.elements.arrow),ce=Q?I==="y"?Q.clientTop||0:Q.clientLeft||0:0,J=(N=D==null?void 0:D[I])!=null?N:0,ee=k+Z-J-ce,ne=k+X-J,ie=WT(f?ZN(B,ee):B,k,f?zv(F,ne):F);w[I]=ie,R[I]=ie-k}if(s){var oe,se=I==="x"?Fl:Bl,pe=I==="x"?Cc:Rc,fe=w[T],ge=T==="y"?"height":"width",me=fe+g[se],Ee=fe-g[pe],Be=[Fl,Bl].indexOf(v)!==-1,Pe=(oe=D==null?void 0:D[T])!=null?oe:0,et=Be?me:fe-S[ge]-U[ge]-Pe+E.altAxis,Ie=Be?fe+S[ge]+U[ge]-Pe-E.altAxis:Ee,Ne=f&&Be?G9e(et,fe,Ie):WT(f?et:me,fe,f?Ie:Ee);w[T]=Ne,R[T]=Ne-fe}e.modifiersData[n]=R}}const IKe={name:"preventOverflow",enabled:!0,phase:"main",fn:bKe,requiresIfExists:["offset"]};function wKe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function SKe(t){return t===Hu(t)||!dc(t)?W6(t):wKe(t)}function TKe(t){var e=t.getBoundingClientRect(),i=Xw(e.width)/t.offsetWidth||1,n=Xw(e.height)/t.offsetHeight||1;return i!==1||n!==1}function UKe(t,e,i){i===void 0&&(i=!1);var n=dc(e),r=dc(e)&&TKe(e),a=Wg(e),o=Jw(t,r,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&(($p(e)!=="body"||Y6(a))&&(s=SKe(e)),dc(e)?(l=Jw(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=K6(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function DKe(t){var e=new Map,i=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function r(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&r(l)}}),n.push(a)}return t.forEach(function(a){i.has(a.name)||r(a)}),n}function PKe(t){var e=DKe(t);return F9e.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function EKe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function CKe(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var KY={placement:"bottom",modifiers:[],strategy:"absolute"};function YY(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function RKe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,a=r===void 0?KY:r;return function(s,l,u){u===void 0&&(u=a);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},KY,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,f={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;m(),c.options=Object.assign({},a,c.options,y),c.scrollParents={reference:Py(s)?KT(s):s.contextElement?KT(s.contextElement):[],popper:KT(l)};var b=PKe(CKe([].concat(n,c.options.modifiers)));return c.orderedModifiers=b.filter(function(I){return I.enabled}),h(),f.update()},forceUpdate:function(){if(!p){var v=c.elements,y=v.reference,b=v.popper;if(YY(y,b)){c.rects={reference:UKe(y,xE(b),c.options.strategy==="fixed"),popper:z6(b)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(E){return c.modifiersData[E.name]=Object.assign({},E.data)});for(var I=0;I<c.orderedModifiers.length;I++){if(c.reset===!0){c.reset=!1,I=-1;continue}var T=c.orderedModifiers[I],w=T.fn,S=T.options,U=S===void 0?{}:S,P=T.name;typeof w=="function"&&(c=w({state:c,options:U,name:P,instance:f})||c)}}}},update:EKe(function(){return new Promise(function(g){f.forceUpdate(),g(c)})}),destroy:function(){m(),p=!0}};if(!YY(s,l))return f;f.setOptions(u).then(function(g){!p&&u.onFirstUpdate&&u.onFirstUpdate(g)});function h(){c.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var T=I({state:c,name:v,instance:f,options:b}),w=function(){};d.push(T||w)}})}function m(){d.forEach(function(g){return g()}),d=[]}return f}}var MKe=[Q9e,vKe,X9e,g0e,mKe,cKe,IKe,W9e,pKe],NKe=RKe({defaultModifiers:MKe}),AKe="tippy-box",U0e="tippy-content",_Ke="tippy-backdrop",D0e="tippy-arrow",P0e="tippy-svg-arrow",uv={passive:!0,capture:!0},E0e=function(){return document.body};function TF(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function Z6(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function C0e(t,e){return typeof t=="function"?t.apply(void 0,e):t}function ZY(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function kKe(t){return t.split(/\s+/).filter(Boolean)}function vI(t){return[].concat(t)}function XY(t,e){t.indexOf(e)===-1&&t.push(e)}function OKe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function xKe(t){return t.split("-")[0]}function XN(t){return[].slice.call(t)}function JY(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function YT(){return document.createElement("div")}function Ox(t){return["Element","Fragment"].some(function(e){return Z6(t,e)})}function LKe(t){return Z6(t,"NodeList")}function FKe(t){return Z6(t,"MouseEvent")}function BKe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function $Ke(t){return Ox(t)?[t]:LKe(t)?XN(t):Array.isArray(t)?t:XN(document.querySelectorAll(t))}function UF(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function QY(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function VKe(t){var e,i=vI(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function jKe(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var a=r.popperRect,o=r.popperState,s=r.props,l=s.interactiveBorder,u=xKe(o.placement),c=o.modifiersData.offset;if(!c)return!0;var d=u==="bottom"?c.top.y:0,p=u==="top"?c.bottom.y:0,f=u==="right"?c.left.x:0,h=u==="left"?c.right.x:0,m=a.top-n+d>l,g=n-a.bottom-p>l,v=a.left-i+f>l,y=i-a.right-h>l;return m||g||v||y})}function DF(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function eZ(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var Zd={isTouch:!1},tZ=0;function GKe(){Zd.isTouch||(Zd.isTouch=!0,window.performance&&document.addEventListener("mousemove",R0e))}function R0e(){var t=performance.now();t-tZ<20&&(Zd.isTouch=!1,document.removeEventListener("mousemove",R0e)),tZ=t}function HKe(){var t=document.activeElement;if(BKe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function zKe(){document.addEventListener("touchstart",GKe,uv),window.addEventListener("blur",HKe)}var qKe=typeof window<"u"&&typeof document<"u",WKe=qKe?!!window.msCrypto:!1,KKe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},YKe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Qc=Object.assign({appendTo:E0e,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},KKe,YKe),ZKe=Object.keys(Qc),XKe=function(e){var i=Object.keys(e);i.forEach(function(n){Qc[n]=e[n]})};function M0e(t){var e=t.plugins||[],i=e.reduce(function(n,r){var a=r.name,o=r.defaultValue;if(a){var s;n[a]=t[a]!==void 0?t[a]:(s=Qc[a])!=null?s:o}return n},{});return Object.assign({},t,i)}function JKe(t,e){var i=e?Object.keys(M0e(Object.assign({},Qc,{plugins:e}))):ZKe,n=i.reduce(function(r,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return r;if(a==="content")r[a]=o;else try{r[a]=JSON.parse(o)}catch{r[a]=o}return r},{});return n}function iZ(t,e){var i=Object.assign({},e,{content:C0e(e.content,[t])},e.ignoreAttributes?{}:JKe(t,e.plugins));return i.aria=Object.assign({},Qc.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var QKe=function(){return"innerHTML"};function Q$(t,e){t[QKe()]=e}function nZ(t){var e=YT();return t===!0?e.className=D0e:(e.className=P0e,Ox(t)?e.appendChild(t):Q$(e,t)),e}function rZ(t,e){Ox(e.content)?(Q$(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Q$(t,e.content):t.textContent=e.content)}function eV(t){var e=t.firstElementChild,i=XN(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(U0e)}),arrow:i.find(function(n){return n.classList.contains(D0e)||n.classList.contains(P0e)}),backdrop:i.find(function(n){return n.classList.contains(_Ke)})}}function N0e(t){var e=YT(),i=YT();i.className=AKe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=YT();n.className=U0e,n.setAttribute("data-state","hidden"),rZ(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(a,o){var s=eV(e),l=s.box,u=s.content,c=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&rZ(u,t.props),o.arrow?c?a.arrow!==o.arrow&&(l.removeChild(c),l.appendChild(nZ(o.arrow))):l.appendChild(nZ(o.arrow)):c&&l.removeChild(c)}return{popper:e,onUpdate:r}}N0e.$$tippy=!0;var eYe=1,DC=[],PF=[];function tYe(t,e){var i=iZ(t,Object.assign({},Qc,M0e(JY(e)))),n,r,a,o=!1,s=!1,l=!1,u=!1,c,d,p,f=[],h=ZY(ee,i.interactiveDebounce),m,g=eYe++,v=null,y=OKe(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:YT(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:et,setProps:Ie,setContent:Ne,show:be,hide:Le,hideWithInteractivity:Me,enable:Be,disable:Pe,unmount:Ze,destroy:qe};if(!i.render)return I;var T=i.render(I),w=T.popper,S=T.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+I.id,I.popper=w,t._tippy=I,w._tippy=I;var U=y.map(function(ye){return ye.fn(I)}),P=t.hasAttribute("aria-expanded");return Q(),x(),k(),B("onCreate",[I]),i.showOnCreate&&me(),w.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",h)}),I;function E(){var ye=I.props.touch;return Array.isArray(ye)?ye:[ye,0]}function D(){return E()[0]==="hold"}function R(){var ye;return!!((ye=I.props.render)!=null&&ye.$$tippy)}function N(){return m||t}function M(){var ye=N().parentNode;return ye?VKe(ye):document}function A(){return eV(w)}function _(ye){return I.state.isMounted&&!I.state.isVisible||Zd.isTouch||c&&c.type==="focus"?0:TF(I.props.delay,ye?0:1,Qc.delay)}function k(ye){ye===void 0&&(ye=!1),w.style.pointerEvents=I.props.interactive&&!ye?"":"none",w.style.zIndex=""+I.props.zIndex}function B(ye,_e,Ae){if(Ae===void 0&&(Ae=!0),U.forEach(function(Ke){Ke[ye]&&Ke[ye].apply(Ke,_e)}),Ae){var Ve;(Ve=I.props)[ye].apply(Ve,_e)}}function F(){var ye=I.props.aria;if(ye.content){var _e="aria-"+ye.content,Ae=w.id,Ve=vI(I.props.triggerTarget||t);Ve.forEach(function(Ke){var he=Ke.getAttribute(_e);if(I.state.isVisible)Ke.setAttribute(_e,he?he+" "+Ae:Ae);else{var ve=he&&he.replace(Ae,"").trim();ve?Ke.setAttribute(_e,ve):Ke.removeAttribute(_e)}})}}function x(){if(!(P||!I.props.aria.expanded)){var ye=vI(I.props.triggerTarget||t);ye.forEach(function(_e){I.props.interactive?_e.setAttribute("aria-expanded",I.state.isVisible&&_e===N()?"true":"false"):_e.removeAttribute("aria-expanded")})}}function $(){M().removeEventListener("mousemove",h),DC=DC.filter(function(ye){return ye!==h})}function j(ye){if(!(Zd.isTouch&&(l||ye.type==="mousedown"))){var _e=ye.composedPath&&ye.composedPath()[0]||ye.target;if(!(I.props.interactive&&eZ(w,_e))){if(vI(I.props.triggerTarget||t).some(function(Ae){return eZ(Ae,_e)})){if(Zd.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else B("onClickOutside",[I,ye]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),s=!0,setTimeout(function(){s=!1}),I.state.isMounted||q())}}}function V(){l=!0}function H(){l=!1}function z(){var ye=M();ye.addEventListener("mousedown",j,!0),ye.addEventListener("touchend",j,uv),ye.addEventListener("touchstart",H,uv),ye.addEventListener("touchmove",V,uv)}function q(){var ye=M();ye.removeEventListener("mousedown",j,!0),ye.removeEventListener("touchend",j,uv),ye.removeEventListener("touchstart",H,uv),ye.removeEventListener("touchmove",V,uv)}function W(ye,_e){Z(ye,function(){!I.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&_e()})}function Y(ye,_e){Z(ye,_e)}function Z(ye,_e){var Ae=A().box;function Ve(Ke){Ke.target===Ae&&(DF(Ae,"remove",Ve),_e())}if(ye===0)return _e();DF(Ae,"remove",d),DF(Ae,"add",Ve),d=Ve}function X(ye,_e,Ae){Ae===void 0&&(Ae=!1);var Ve=vI(I.props.triggerTarget||t);Ve.forEach(function(Ke){Ke.addEventListener(ye,_e,Ae),f.push({node:Ke,eventType:ye,handler:_e,options:Ae})})}function Q(){D()&&(X("touchstart",J,{passive:!0}),X("touchend",ne,{passive:!0})),kKe(I.props.trigger).forEach(function(ye){if(ye!=="manual")switch(X(ye,J),ye){case"mouseenter":X("mouseleave",ne);break;case"focus":X(WKe?"focusout":"blur",ie);break;case"focusin":X("focusout",ie);break}})}function ce(){f.forEach(function(ye){var _e=ye.node,Ae=ye.eventType,Ve=ye.handler,Ke=ye.options;_e.removeEventListener(Ae,Ve,Ke)}),f=[]}function J(ye){var _e,Ae=!1;if(!(!I.state.isEnabled||oe(ye)||s)){var Ve=((_e=c)==null?void 0:_e.type)==="focus";c=ye,m=ye.currentTarget,x(),!I.state.isVisible&&FKe(ye)&&DC.forEach(function(Ke){return Ke(ye)}),ye.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||o)&&I.props.hideOnClick!==!1&&I.state.isVisible?Ae=!0:me(ye),ye.type==="click"&&(o=!Ae),Ae&&!Ve&&Ee(ye)}}function ee(ye){var _e=ye.target,Ae=N().contains(_e)||w.contains(_e);if(!(ye.type==="mousemove"&&Ae)){var Ve=ge().concat(w).map(function(Ke){var he,ve=Ke._tippy,Ce=(he=ve.popperInstance)==null?void 0:he.state;return Ce?{popperRect:Ke.getBoundingClientRect(),popperState:Ce,props:i}:null}).filter(Boolean);jKe(Ve,ye)&&($(),Ee(ye))}}function ne(ye){var _e=oe(ye)||I.props.trigger.indexOf("click")>=0&&o;if(!_e){if(I.props.interactive){I.hideWithInteractivity(ye);return}Ee(ye)}}function ie(ye){I.props.trigger.indexOf("focusin")<0&&ye.target!==N()||I.props.interactive&&ye.relatedTarget&&w.contains(ye.relatedTarget)||Ee(ye)}function oe(ye){return Zd.isTouch?D()!==ye.type.indexOf("touch")>=0:!1}function se(){pe();var ye=I.props,_e=ye.popperOptions,Ae=ye.placement,Ve=ye.offset,Ke=ye.getReferenceClientRect,he=ye.moveTransition,ve=R()?eV(w).arrow:null,Ce=Ke?{getBoundingClientRect:Ke,contextElement:Ke.contextElement||N()}:t,De={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(je){var ke=je.state;if(R()){var bt=A(),Gt=bt.box;["placement","reference-hidden","escaped"].forEach(function(Zt){Zt==="placement"?Gt.setAttribute("data-placement",ke.placement):ke.attributes.popper["data-popper-"+Zt]?Gt.setAttribute("data-"+Zt,""):Gt.removeAttribute("data-"+Zt)}),ke.attributes.popper={}}}},Ue=[{name:"offset",options:{offset:Ve}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!he}},De];R()&&ve&&Ue.push({name:"arrow",options:{element:ve,padding:3}}),Ue.push.apply(Ue,(_e==null?void 0:_e.modifiers)||[]),I.popperInstance=NKe(Ce,w,Object.assign({},_e,{placement:Ae,onFirstUpdate:p,modifiers:Ue}))}function pe(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function fe(){var ye=I.props.appendTo,_e,Ae=N();I.props.interactive&&ye===E0e||ye==="parent"?_e=Ae.parentNode:_e=C0e(ye,[Ae]),_e.contains(w)||_e.appendChild(w),I.state.isMounted=!0,se()}function ge(){return XN(w.querySelectorAll("[data-tippy-root]"))}function me(ye){I.clearDelayTimeouts(),ye&&B("onTrigger",[I,ye]),z();var _e=_(!0),Ae=E(),Ve=Ae[0],Ke=Ae[1];Zd.isTouch&&Ve==="hold"&&Ke&&(_e=Ke),_e?n=setTimeout(function(){I.show()},_e):I.show()}function Ee(ye){if(I.clearDelayTimeouts(),B("onUntrigger",[I,ye]),!I.state.isVisible){q();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ye.type)>=0&&o)){var _e=_(!1);_e?r=setTimeout(function(){I.state.isVisible&&I.hide()},_e):a=requestAnimationFrame(function(){I.hide()})}}function Be(){I.state.isEnabled=!0}function Pe(){I.hide(),I.state.isEnabled=!1}function et(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(a)}function Ie(ye){if(!I.state.isDestroyed){B("onBeforeUpdate",[I,ye]),ce();var _e=I.props,Ae=iZ(t,Object.assign({},_e,JY(ye),{ignoreAttributes:!0}));I.props=Ae,Q(),_e.interactiveDebounce!==Ae.interactiveDebounce&&($(),h=ZY(ee,Ae.interactiveDebounce)),_e.triggerTarget&&!Ae.triggerTarget?vI(_e.triggerTarget).forEach(function(Ve){Ve.removeAttribute("aria-expanded")}):Ae.triggerTarget&&t.removeAttribute("aria-expanded"),x(),k(),S&&S(_e,Ae),I.popperInstance&&(se(),ge().forEach(function(Ve){requestAnimationFrame(Ve._tippy.popperInstance.forceUpdate)})),B("onAfterUpdate",[I,ye])}}function Ne(ye){I.setProps({content:ye})}function be(){var ye=I.state.isVisible,_e=I.state.isDestroyed,Ae=!I.state.isEnabled,Ve=Zd.isTouch&&!I.props.touch,Ke=TF(I.props.duration,0,Qc.duration);if(!(ye||_e||Ae||Ve)&&!N().hasAttribute("disabled")&&(B("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,R()&&(w.style.visibility="visible"),k(),z(),I.state.isMounted||(w.style.transition="none"),R()){var he=A(),ve=he.box,Ce=he.content;UF([ve,Ce],0)}p=function(){var Ue;if(!(!I.state.isVisible||u)){if(u=!0,w.offsetHeight,w.style.transition=I.props.moveTransition,R()&&I.props.animation){var Qe=A(),je=Qe.box,ke=Qe.content;UF([je,ke],Ke),QY([je,ke],"visible")}F(),x(),XY(PF,I),(Ue=I.popperInstance)==null||Ue.forceUpdate(),B("onMount",[I]),I.props.animation&&R()&&Y(Ke,function(){I.state.isShown=!0,B("onShown",[I])})}},fe()}}function Le(){var ye=!I.state.isVisible,_e=I.state.isDestroyed,Ae=!I.state.isEnabled,Ve=TF(I.props.duration,1,Qc.duration);if(!(ye||_e||Ae)&&(B("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,u=!1,o=!1,R()&&(w.style.visibility="hidden"),$(),q(),k(!0),R()){var Ke=A(),he=Ke.box,ve=Ke.content;I.props.animation&&(UF([he,ve],Ve),QY([he,ve],"hidden"))}F(),x(),I.props.animation?R()&&W(Ve,I.unmount):I.unmount()}}function Me(ye){M().addEventListener("mousemove",h),XY(DC,h),h(ye)}function Ze(){I.state.isVisible&&I.hide(),I.state.isMounted&&(pe(),ge().forEach(function(ye){ye._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),PF=PF.filter(function(ye){return ye!==I}),I.state.isMounted=!1,B("onHidden",[I]))}function qe(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),ce(),delete t._tippy,I.state.isDestroyed=!0,B("onDestroy",[I]))}}function Sh(t,e){e===void 0&&(e={});var i=Qc.plugins.concat(e.plugins||[]);zKe();var n=Object.assign({},e,{plugins:i}),r=$Ke(t),a=r.reduce(function(o,s){var l=s&&tYe(s,n);return l&&o.push(l),o},[]);return Ox(t)?a[0]:a}Sh.defaultProps=Qc;Sh.setDefaultProps=XKe;Sh.currentInput=Zd;Object.assign({},g0e,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});Sh.setDefaultProps({render:N0e});function aZ(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===mt?e.style="margin-left: 1em":e.style="margin-right: 1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&Sh(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=lt),e}const X6=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":fw;const i=(n,r,a)=>{const o=t.getElementsByClassName(`options_${n}`)[0];o&&(o.style.display=e!=null&&e.length?r:a)};i(gr,lC,lt),i(Ct,lt,lC),i(Et,lt,lC),i(mt,lt,lC)};function no(t){var v;const{table:e,targetClassName:i,items:n=[],onSelection:r}=t;let{target:a}=t;const o=!!a;if(a=a||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]),!a)return;let s=0,l=0;const u={},c={};let d;if(o){Oa(a);const y=iYe();Object.assign(u,y.elements),a.appendChild(y.anchor)}const p=Object.assign({},...[gr,Ct,Et,mt,qM].map(y=>{var I;const b=(I=a.getElementsByClassName(`options_${y}`))==null?void 0:I[0];return Oa(b),{[y]:b}}).filter(Boolean)),f=X6({table:e,target:a}),h=(y,b)=>{rt(b.onClick)&&(y.stopPropagation(),!b.disabled&&b.onClick(y,e),b.stateChange&&f())},m={onClick:()=>{},location:mt};for(const y of n){const b={...m};fc(y)&&Object.assign(b,y);const I=p[b.location];if(!I){console.log(b.location,p);continue}if(b.location===gr&&(s+=1),b.location===qM){if(rt(b.headerClick)){const T=a.getElementsByClassName("panelHeader")[0];T&&(T.onclick=b.headerClick)}l+=1}if(!b.hide&&(b.input||b.placeholder||b.search)){const T=document.createElement("p");T.style="margin-right: 1em",T.className=`control ${b.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(b.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","off"),w.setAttribute("placeholder",y.placeholder||fw),b.id&&(c[b.id]=w),b.id&&w.setAttribute("id",b.id),b.onKeyDown&&w.addEventListener("keydown",S=>b.onKeyDown(S,b)),b.onChange&&w.addEventListener("change",S=>b.onChange(S,b)),b.onKeyUp&&w.addEventListener("keyup",S=>{b.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),w.value="",b.clearSearch()),b.onKeyUp(S,b)}),b.class&&w.classList.add(b.class),b.visible===!1&&(T.style.display=lt),b.value&&(w.value=b.value),T.appendChild(w),b.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',T.appendChild(S),rt(b.clearSearch)){const U=document.createElement("span");U.className="icon is-small is-right font-medium",U.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',U.onclick=P=>{P.stopPropagation(),w.value="",b.clearSearch()},T.appendChild(U)}}if(y.validator){const S=document.createElement("p");S.className="help font-medium",T.appendChild(S),w.addEventListener("input",U=>xce(y,U,w,S,y.validator))}b.id&&(u[b.id]=T,T.id=b.id),I==null||I.appendChild(T);continue}if(!b.hide&&b.text){const T=document.createElement("div");T.className="font-medium",b.id&&(u[b.id]=T,T.id=b.id),T.innerHTML=b.text,T.onclick=w=>h(w,b),I==null||I.appendChild(T);continue}if(!(!b.id&&(!(b!=null&&b.label)||b.hide))){if(b.options){const T=K$({target:I,button:b,stateChange:f});b.visible===!1&&(T.style.display=lt),b.id&&(u[b.id]=T)}else if(fc(b.selection)){const{selection:{options:T,actions:w},actionPlacement:S,threshold:U=8,...P}=b;if((T==null?void 0:T.length)<U){T.length&&(S===P9?T.unshift({divider:!0}):T.push({divider:!0})),w.forEach(R=>{const{label:N,...M}=R,A={...M,label:`<p style="font-weight: bold">${N}</p>`};S===P9?T.unshift(A):T.push(A)});const E={...P,options:T},D=K$({target:I,button:E,stateChange:f});E.visible===!1&&(D.style.display=lt),E.id&&(u[b.id]=D)}else{const E=aZ(b);E.onclick=D=>{D.stopPropagation(),j6({title:"Select team",options:T})},b.id&&(u[b.id]=E),I==null||I.appendChild(E)}}else if(b.tabs){const T=document.createElement("div");T.className="tabs is-toggle is-toggle-rounded";const w=document.createElement("ul");T.appendChild(w),b.tabs.forEach(S=>{const U=document.createElement("li");S.active&&U.classList.add("is-active");const P=document.createElement("a");U.appendChild(P),P.onclick=D=>{w.querySelectorAll("li").forEach(R=>R.classList.remove("is-active")),U.classList.add("is-active"),rt(S.onClick)&&S.onClick(D,b)};const E=document.createElement("span");E.innerHTML=S.label,P.appendChild(E),w.appendChild(U)}),b.id&&(u[b.id]=T),I.appendChild(T)}else{const T=aZ(b);T.onclick=w=>h(w,b),b.id&&(u[b.id]=T),I==null||I.appendChild(T)}(!(b!=null&&b.label||b.tabs)||b.hide)&&u[b.id]&&(u[b.id].style.display=lt)}}const g=a.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?fw:lt),e==null||e.on("rowSelectionChanged",(y,b)=>{rt(r)&&r(b),s&&f(b)}),f(),d&&setTimeout(()=>d.focus(),200),{elements:u,inputs:c}}function iYe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=lt,t.appendChild(e);const i=document.createElement("div");i.className=Bue,i.style="flex-wrap: wrap-reverse;";const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:nYe,COMPASS:rYe,ROUND_ROBIN:aYe}=rr,{MALE:oYe,FEMALE:sYe}=ao.genderConstants,{DOUBLES:oZ}=ao.eventConstants,{WTN:PC}=ao.ratingConstants;function lYe(t){const e=t.getData().map(n=>n.tournamentId),i=uYe();for(const n of i)EE({tournamentRecord:n,tournamentIds:e,table:t});return{...JD}}function uYe(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},tournamentName:"CourtHive Challenge",participantsProfile:{scaledParticipantsCount:200},drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventType:oZ,gender:oYe,seedsCount:4,drawSize:16},{drawType:nYe,category:{categoryName:"U16"},eventName:"U16 Girls Singles",gender:sYe,seedsCount:8,drawSize:32},{category:{ratingType:PC,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,seedsCount:8,drawSize:32},{category:{ratingType:PC,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventType:oZ,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:PC,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,drawType:rYe,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:PC,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:aYe,seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>XD.generateTournamentRecord(n).tournamentRecord)}function cYe(t){var s;const e=ol(),i=(s=e==null?void 0:e.roles)==null?void 0:s.includes(Dk),n=[{label:"Create new tournament",onClick:()=>Bwe({table:t})},{label:"Import tournament",onClick:()=>H6e(t)},i&&{label:"Load by ID",onClick:()=>C8e({table:t})},{divider:!0},{divider:!0},{label:"Example Tournaments",onClick:()=>lYe(t),close:!0}].filter(Boolean),r=_b(t),a=[{label:"Actions",options:n,align:mt},{onKeyDown:l=>l.keyCode===8&&l.target.value.length===1&&r(""),onChange:l=>r(l.target.value),onKeyUp:l=>r(l.target.value),clearSearch:()=>r(""),placeholder:"Search tournaments",location:Ct,search:!0}],o=document.getElementById(Fue);no({target:o,items:a})}function dYe(t){const e=document.createElement("span"),i=document.createElement("table"),n=t.getValue();i.style.width="400px";const r="4em",a=document.createElement("tr"),o=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"",s=`<td style='min-width: ${r}'>${o}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;return a.innerHTML=s,i.appendChild(a),e.appendChild(i),e}function pYe({providerId:t,tournamentId:e}){const i=()=>ze.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(a=>a.tournamentId!==e),Ys.addProvider(r).then(i))};Ys.findProvider(t).then(n)}function A0e(t,e,i){if(!t)return;const n=document.createElement("aside");n.classList.add("menu");const r={},a=d=>i&&d.close!==!1?p=>{p.stopPropagation(),i(),d.onClick()}:p=>{p.stopPropagation(),d.onClick()};let o=0;const s=()=>(o+=1,o),l=d=>(d==null?void 0:d.heading)||(d==null?void 0:d.text)||(d==null?void 0:d.label)||`Item ${s()}`,u=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style=d.style),d.onClick){const f=d.fontSize||"1em";if(d.divider){const h=document.createElement("hr");h.classList.add("dropdown-divider"),p.appendChild(h)}else{const h=document.createElement("a"),m=d.disabled?"0.4":"1";h.style=`text-decoration: none; opacity: ${m}; font-size: ${f}`,d.class&&h.classList.add(d.class),d.color&&(h.style.color=d.color),d.heading&&(h.style.fontWeight="bold"),d.disabled||(h.onclick=a(d)),h.innerHTML=l(d),p.appendChild(h)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let c;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const f=document.createElement("p");f.className="menu-label font-medium",f.innerHTML=d.text,n.appendChild(f)}const p=document.createElement("ul");p.className="menu-list";for(const f of d.items)f.hide||p.appendChild(u(f));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:f}=kT(d);d.focus&&(c=f),r[d.field]=f,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:c}}let Qd;function Pu(t){Qd&&(Qd==null||Qd.destroy(!0),Qd=void 0),t!=null&&t.remove&&t.remove()}function Ps(t){var d;const{title:e,options:i,menuItems:n=[],coords:r,callback:a,config:o}=t;let{target:s,items:l}=t;if(!(i!=null&&i.length)&&!(l!=null&&l.length)&&!n)return;Pu();const u=document.createElement("div"),c=()=>{l=(l==null?void 0:l.filter(h=>!h.hide&&!h.disabled).map(h=>({...h,onClick:()=>{Pu(u),rt(h.onClick)&&h.onClick()}})))||(i==null?void 0:i.filter(h=>!h.hide&&!h.disabled).map(h=>({text:typeof h=="object"?h.option:h,style:h.style,onClick:()=>{h.subMenu?Qd.setContent("IMPLEMENT SUB MENU"):rt(h.onClick)?(Pu(u),h.onClick()):rt(a)&&(Pu(u),a(typeof h=="object"?{...h,coords:r}:h))}})));const p=[{text:e,items:l},...n],{focusElement:f}=A0e(u,p);return f&&f.focus(),u};return s=s||((d=r==null?void 0:r.evt)==null?void 0:d.target),s&&(Qd=Sh(s,{content:c,theme:"light-border",trigger:"click",...o}),Qd.show(),Qd.setProps({interactive:!0})),Qd}const fYe=t=>e=>{const i=document.createElement("span");i.style.width="100%";const n=e.getValue(),r=()=>{var h;const l=e.getRow(),u=((h=ol())==null?void 0:h.providerId)||l.getData().providerId,c=()=>{l.delete(),u&&pYe({tournamentId:n,providerId:u})},d=()=>Ys.deleteTournament(n).then(c,m=>console.log(m)),p=ol();(p==null?void 0:p.provider)||(ze==null?void 0:ze.provider)?YLe({providerId:u,tournamentId:n}).then(d,m=>console.log(m)):d()},a=()=>{const c=`<div style='font-size: 2em'>${e.getTable().getData().find(p=>p.tournamentId===n).tournament.tournamentName} will be deleted!</div>`,d=[{onClick:r,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];yn({title:Lr.tr("actions.delete_tournament"),buttons:d,content:c})},o=()=>hYe({table:e.getTable(),tournamentId:n,replaceTableData:t}),s=document.createElement("span");return s.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",i.onclick=l=>{l.stopPropagation(),Ps({target:s,items:[{text:"Delete",onClick:a},{text:"Edit",onClick:o}],config:{placement:tf}})},i.appendChild(s),i};function hYe({tournamentId:t,replaceTableData:e,table:i}){const n=ol(),r=n==null?void 0:n.provider,a=()=>{Mt({message:"Tournament not found",onClose:()=>{ze.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},o=s=>{var u,c;const l=(c=(u=s==null?void 0:s.data)==null?void 0:u.tournamentRecords)==null?void 0:c[t];l?Bwe({table:i,tournamentRecord:l,replaceTableData:e}):a()};r?_k({tournamentId:t}).then(o,s=>console.log(s)):Ys.findTournament(t).then(s=>o(s),s=>console.log(s))}function mYe(t){const e=(i,n)=>{const r=n.getRow().getData().tournamentId;if(r){$e.reset();const a=`/${Ia}/${r}`;ze.router.navigate(a)}};return[{formatter:"responsiveCollapse",hozAlign:Et,headerSort:!1,resizable:!1,minWidth:50,width:50},{formatter:dYe,cellClick:e,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{title:"Open",vertAlign:"middle",formatter:()=>'<div class="button font-medium">Open</div>',cellClick:e,width:90},{formatter:fYe(t),field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:mt,width:10}]}function mf({anchorId:t}){const e=da.findTable(`#${t}`)[0];e&&e.destroy()}function xx(){var t;if(ze.tables)for(const e of Object.keys(ze.tables))(t=ze.tables[e])==null||t.destroy(),delete ze.tables[e];for(;(ze.collectionTables||[]).length;)ze.collectionTables.pop().destroy()}function _0e(){const t=d=>console.log("db Error",{error:d});let e,i;const n=()=>{setTimeout(()=>{const p=f=>e.replaceData(f.map(d1));Ys.findAllTournaments().then(p,t)},i?0:1e3)},r=mYe(),a=d=>{mf({anchorId:lB});const p=document.getElementById(lB);e=new da(p,{responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,placeholder:"No tournaments",responsiveLayout:"collapse",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:d,columns:r}),e.on("scrollVertical",Pu),e.on("tableBuilt",()=>{cYe(e),i=!0})},o=d=>{d.sort((p,f)=>new Date(f.startDate||f.start)-new Date(p.startDate||p.start)),a(d.map(d1))},s=({tournaments:d,provider:p})=>{const f=d.sort((h,m)=>new Date(m.tournament.startDate)-new Date(h.tournament.startDate)).map(h=>{var g,v;const m=(v=(g=h.tournament.onlineResources)==null?void 0:g.find(({name:y,resourceType:b})=>y==="tournamentImage"&&b==="URL"))==null?void 0:v.identifier;return m&&(h.tournament.tournamentImageURL=m),{...h,provider:p}});a(f)},l=ol(),u=(l==null?void 0:l.provider)||(ze==null?void 0:ze.provider),c=()=>Ys.findAllTournaments().then(o,t);if(u!=null&&u.organisationAbbreviation){const d=p=>{var f;(f=p==null?void 0:p.data)!=null&&f.calendar?s(p.data.calendar):c()};qLe({providerAbbr:u.organisationAbbreviation}).then(d)}else c();return{table:e,replaceTableData:n}}const JN=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{const n="&puid, hash, cuid, &id, [last_name+first_name], last_name, birthdate",r="&muid, *puids, format, date, tournament.category, tournament.tuid",a="[puid+tuid+format+round], puid, tuid, muid, date",o="&tuid, name, start, end, category, cuid",s="&hash, date, type",l="&uuid, name",u="[hash+ioc]",c="&uuid, name",d="category",p="&id, &code",f="&alias",h="key",m="ioc",g={calculations:s,clubs:p,idioms:m,matches:r,players:n,points:a,rankings:d,settings:h,tournaments:o};t.db=new pp("CourtHiveTournaments",{autoOpen:!1}),t.db.version(1).stores({aliases:f,ignored:u,...g}),t.db.version(2).stores({aliases:f,ignored:u,...g,idioms:m}),t.db.version(3).stores({teams:c,themes:l,idioms:m,...g}),t.db.open().then(e,i)}),t.resetDB=e=>{t.db.close(),pp.delete("CourtHiveTournaments").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{let r=t.db[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.db[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.db.tournaments.where("tuid").equals(e).delete().then(r,n);function r(){t.deleteTournamentMatches(e).then(a,n)}function a(){t.deleteTournamentPoints(e).then(i,n)}}),t.deleteAllTournamentAttr=e=>t.db.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>t.findWhere(e,i,n).then(o=>r(o&&o.length?o[0]:void 0),a)),t.findTournament=e=>t.findUnique("tournaments","tuid",e),t.addItem=(e,i)=>new Promise((n,r)=>t.db[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.db[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return a("exists");t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tuid",e.tuid,e),t.replaceOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.db[e].where(i).equals(n).delete().then(()=>{t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.modify=(e,i,n,r,a)=>new Promise((o,s)=>{t.db[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(o,l=>{console.log("error:",l),s()})}),t}(),k0e="leaveTournament",gYe="providerCalendar",vYe="processDirective",yYe="tmxDirective",bYe="tmxMessage",IYe="add idiom";function O0e(t){const e=w6({data:t}),{directive:i,content:n}=e||{};i&&(i===gYe&&n.calendar&&Mt({action:{onClick:()=>wYe({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&ze.ee.emit("sendKey",i.subKey),i===IYe&&n&&(Lr.define(n),JN.addIdiom(n).then(r,a=>console.log("error:",a))));function r(){ze.ee.emit("changeIdiom",{ioc:n.ioc})}}function wYe({providerId:t,calendar:e}){const i=()=>_0e();t&&e&&Ys.addProvider({providerId:t,calendar:e}).then(i)}const Vp=Object.create(null);Vp.open="0";Vp.close="1";Vp.ping="2";Vp.pong="3";Vp.message="4";Vp.upgrade="5";Vp.noop="6";const GR=Object.create(null);Object.keys(Vp).forEach(t=>{GR[Vp[t]]=t});const tV={type:"error",data:"parser error"},x0e=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",L0e=typeof ArrayBuffer=="function",F0e=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,J6=({type:t,data:e},i,n)=>x0e&&e instanceof Blob?i?n(e):sZ(e,n):L0e&&(e instanceof ArrayBuffer||F0e(e))?i?n(e):sZ(new Blob([e]),n):n(Vp[t]+(e||"")),sZ=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function lZ(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let EF;function SYe(t,e){if(x0e&&t.data instanceof Blob)return t.data.arrayBuffer().then(lZ).then(e);if(L0e&&(t.data instanceof ArrayBuffer||F0e(t.data)))return e(lZ(t.data));J6(t,!1,i=>{EF||(EF=new TextEncoder),e(EF.encode(i))})}const uZ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dT=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<uZ.length;t++)dT[uZ.charCodeAt(t)]=t;const TYe=t=>{let e=t.length*.75,i=t.length,n,r=0,a,o,s,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const u=new ArrayBuffer(e),c=new Uint8Array(u);for(n=0;n<i;n+=4)a=dT[t.charCodeAt(n)],o=dT[t.charCodeAt(n+1)],s=dT[t.charCodeAt(n+2)],l=dT[t.charCodeAt(n+3)],c[r++]=a<<2|o>>4,c[r++]=(o&15)<<4|s>>2,c[r++]=(s&3)<<6|l&63;return u},UYe=typeof ArrayBuffer=="function",Q6=(t,e)=>{if(typeof t!="string")return{type:"message",data:B0e(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:DYe(t.substring(1),e)}:GR[i]?t.length>1?{type:GR[i],data:t.substring(1)}:{type:GR[i]}:tV},DYe=(t,e)=>{if(UYe){const i=TYe(t);return B0e(i,e)}else return{base64:!0,data:t}},B0e=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},$0e="",PYe=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((a,o)=>{J6(a,!1,s=>{n[o]=s,++r===i&&e(n.join($0e))})})},EYe=(t,e)=>{const i=t.split($0e),n=[];for(let r=0;r<i.length;r++){const a=Q6(i[r],e);if(n.push(a),a.type==="error")break}return n};function CYe(){return new TransformStream({transform(t,e){SYe(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let CF;function EC(t){return t.reduce((e,i)=>e+i.length,0)}function CC(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function RYe(t,e){CF||(CF=new TextDecoder);const i=[];let n=0,r=-1,a=!1;return new TransformStream({transform(o,s){for(i.push(o);;){if(n===0){if(EC(i)<1)break;const l=CC(i,1);a=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(EC(i)<2)break;const l=CC(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(EC(i)<8)break;const l=CC(i,8),u=new DataView(l.buffer,l.byteOffset,l.length),c=u.getUint32(0);if(c>Math.pow(2,21)-1){s.enqueue(tV);break}r=c*Math.pow(2,32)+u.getUint32(4),n=3}else{if(EC(i)<r)break;const l=CC(i,r);s.enqueue(Q6(a?l:CF.decode(l),e)),n=0}if(r===0||r>t){s.enqueue(tV);break}}}})}const V0e=4;function ja(t){if(t)return MYe(t)}function MYe(t){for(var e in ja.prototype)t[e]=ja.prototype[e];return t}ja.prototype.on=ja.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ja.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};ja.prototype.off=ja.prototype.removeListener=ja.prototype.removeAllListeners=ja.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};ja.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};ja.prototype.emitReserved=ja.prototype.emit;ja.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ja.prototype.hasListeners=function(t){return!!this.listeners(t).length};const tc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function j0e(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const NYe=tc.setTimeout,AYe=tc.clearTimeout;function Lx(t,e){e.useNativeTimers?(t.setTimeoutFn=NYe.bind(tc),t.clearTimeoutFn=AYe.bind(tc)):(t.setTimeoutFn=tc.setTimeout.bind(tc),t.clearTimeoutFn=tc.clearTimeout.bind(tc))}const _Ye=1.33;function kYe(t){return typeof t=="string"?OYe(t):Math.ceil((t.byteLength||t.size)*_Ye)}function OYe(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function xYe(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function LYe(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class FYe extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class e8 extends ja{constructor(e){super(),this.writable=!1,Lx(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,i,n){return super.emitReserved("error",new FYe(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=Q6(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=xYe(e);return i.length?"?"+i:""}}const G0e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),iV=64,BYe={};let cZ=0,RC=0,dZ;function pZ(t){let e="";do e=G0e[t%iV]+e,t=Math.floor(t/iV);while(t>0);return e}function H0e(){const t=pZ(+new Date);return t!==dZ?(cZ=0,dZ=t):t+"."+pZ(cZ++)}for(;RC<iV;RC++)BYe[G0e[RC]]=RC;let z0e=!1;try{z0e=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const $Ye=z0e;function q0e(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||$Ye))return new XMLHttpRequest}catch{}if(!e)try{return new tc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function VYe(){}const jYe=function(){return new q0e({xdomain:!1}).responseType!=null}();class GYe extends e8{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}const i=e&&e.forceBase64;this.supportsBinary=jYe&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};EYe(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,PYe(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=H0e()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new mp(this.uri(),e)}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}class mp extends ja{constructor(e,i){super(),Lx(this,i),this.opts=i,this.method=i.method||"GET",this.uri=e,this.data=i.data!==void 0?i.data:null,this.create()}create(){var e;const i=j0e(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const n=this.xhr=new q0e(i);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this.opts.cookieJar)===null||r===void 0||r.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=mp.requestsCount++,mp.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=VYe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete mp.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}mp.requestsCount=0;mp.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",fZ);else if(typeof addEventListener=="function"){const t="onpagehide"in tc?"pagehide":"unload";addEventListener(t,fZ,!1)}}function fZ(){for(let t in mp.requests)mp.requests.hasOwnProperty(t)&&mp.requests[t].abort()}const t8=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),MC=tc.WebSocket||tc.MozWebSocket,hZ=!0,HYe="arraybuffer",mZ=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class zYe extends e8{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),i=this.opts.protocols,n=mZ?{}:j0e(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=hZ&&!mZ?i?new MC(e,i):new MC(e):new MC(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;J6(n,this.supportsBinary,a=>{const o={};try{hZ&&this.ws.send(a)}catch{}r&&t8(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=H0e()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}check(){return!!MC}}class qYe extends e8{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const i=RYe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=CYe();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const a=()=>{n.read().then(({done:s,value:l})=>{s||(this.onPacket(l),a())}).catch(s=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this.writer.write(n).then(()=>{r&&t8(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const WYe={websocket:zYe,webtransport:qYe,polling:GYe},KYe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,YYe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function nV(t){if(t.length>2e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=KYe.exec(t||""),a={},o=14;for(;o--;)a[YYe[o]]=r[o]||"";return i!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=ZYe(a,a.path),a.queryKey=XYe(a,a.query),a}function ZYe(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function XYe(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,a){r&&(i[r]=a)}),i}let W0e=class yI extends ja{constructor(e,i={}){super(),this.binaryType=HYe,this.writeBuffer=[],e&&typeof e=="object"&&(i=e,e=null),e?(e=nV(e),i.hostname=e.host,i.secure=e.protocol==="https"||e.protocol==="wss",i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=nV(i.host).host),Lx(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=LYe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=V0e,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new WYe[e](n)}open(){let e;if(this.opts.rememberUpgrade&&yI.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(e){let i=this.createTransport(e),n=!1;yI.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;yI.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(c(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){n||(n=!0,c(),i.close(),i=null)}const o=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function s(){o("transport closed")}function l(){o("socket closed")}function u(d){i&&d.name!==i.name&&a()}const c=()=>{i.removeListener("open",r),i.removeListener("error",o),i.removeListener("close",s),this.off("close",l),this.off("upgrading",u)};i.once("open",r),i.once("error",o),i.once("close",s),this.once("close",l),this.once("upgrading",u),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onOpen(){if(this.readyState="open",yI.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const i=this.upgrades.length;for(;e<i;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=e.data,this.onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=kYe(r)),n>0&&i>this.maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}write(e,i,n){return this.sendPacket("message",e,i,n),this}send(e,i,n){return this.sendPacket("message",e,i,n),this}sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:i,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){yI.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const i=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}};W0e.protocol=V0e;function JYe(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=nV(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(i&&i.port===n.port?"":":"+n.port),n}const QYe=typeof ArrayBuffer=="function",eZe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,K0e=Object.prototype.toString,tZe=typeof Blob=="function"||typeof Blob<"u"&&K0e.call(Blob)==="[object BlobConstructor]",iZe=typeof File=="function"||typeof File<"u"&&K0e.call(File)==="[object FileConstructor]";function i8(t){return QYe&&(t instanceof ArrayBuffer||eZe(t))||tZe&&t instanceof Blob||iZe&&t instanceof File}function HR(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(HR(t[i]))return!0;return!1}if(i8(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return HR(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&HR(t[i]))return!0;return!1}function nZe(t){const e=[],i=t.data,n=t;return n.data=rV(i,e),n.attachments=e.length,{packet:n,buffers:e}}function rV(t,e){if(!t)return t;if(i8(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=rV(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=rV(t[n],e));return i}return t}function rZe(t,e){return t.data=aV(t.data,e),delete t.attachments,t}function aV(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=aV(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=aV(t[i],e));return t}const aZe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],oZe=5;var hn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(hn||(hn={}));class sZe{constructor(e){this.replacer=e}encode(e){return(e.type===hn.EVENT||e.type===hn.ACK)&&HR(e)?this.encodeAsBinary({type:e.type===hn.EVENT?hn.BINARY_EVENT:hn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===hn.BINARY_EVENT||e.type===hn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=nZe(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function gZ(t){return Object.prototype.toString.call(t)==="[object Object]"}class n8 extends ja{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===hn.BINARY_EVENT;n||i.type===hn.BINARY_ACK?(i.type=n?hn.EVENT:hn.ACK,this.reconstructor=new lZe(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(i8(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(hn[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===hn.BINARY_EVENT||n.type===hn.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const o=e.substring(a,i);if(o!=Number(o)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(a,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const a=i+1;for(;++i;){const o=e.charAt(i);if(o==null||Number(o)!=o){--i;break}if(i===e.length)break}n.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(n8.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case hn.CONNECT:return gZ(i);case hn.DISCONNECT:return i===void 0;case hn.CONNECT_ERROR:return typeof i=="string"||gZ(i);case hn.EVENT:case hn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&aZe.indexOf(i[0])===-1);case hn.ACK:case hn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class lZe{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=rZe(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const uZe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:n8,Encoder:sZe,get PacketType(){return hn},protocol:oZe},Symbol.toStringTag,{value:"Module"}));function Wc(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const cZe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Y0e extends ja{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Wc(e,"open",this.onopen.bind(this)),Wc(e,"packet",this.onpacket.bind(this)),Wc(e,"error",this.onerror.bind(this)),Wc(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){if(cZe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const n={type:hn.EVENT,data:i};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const o=this.ids++,s=i.pop();this._registerAckCallback(o,s),n.id=o}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);i.call(this,new Error("operation has timed out"))},r),o=(...s)=>{this.io.clearTimeoutFn(a),i.apply(this,s)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...i){return new Promise((n,r)=>{const a=(o,s)=>o?r(o):n(s);a.withError=!0,i.push(a),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>n!==this._queue[0]?void 0:(r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:hn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case hn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case hn.EVENT:case hn.BINARY_EVENT:this.onevent(e);break;case hn.ACK:case hn.BINARY_ACK:this.onack(e);break;case hn.DISCONNECT:this.ondisconnect();break;case hn.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:hn.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(delete this.acks[e.id],i.withError&&e.data.unshift(null),i.apply(this,e.data))}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:hn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function ES(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}ES.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};ES.prototype.reset=function(){this.attempts=0};ES.prototype.setMin=function(t){this.ms=t};ES.prototype.setMax=function(t){this.max=t};ES.prototype.setJitter=function(t){this.jitter=t};class oV extends ja{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,Lx(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new ES({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||uZe;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new W0e(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Wc(i,"open",function(){n.onopen(),e&&e()}),a=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},o=Wc(i,"error",a);if(this._timeout!==!1){const s=this._timeout,l=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),i.close()},s);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Wc(e,"ping",this.onping.bind(this)),Wc(e,"data",this.ondata.bind(this)),Wc(e,"error",this.onerror.bind(this)),Wc(e,"close",this.onclose.bind(this)),Wc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){t8(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Y0e(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const WS={};function zR(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=JYe(t,e.path||"/socket.io"),n=i.source,r=i.id,a=i.path,o=WS[r]&&a in WS[r].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return s?l=new oV(n,e):(WS[r]||(WS[r]=new oV(n,e)),l=WS[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(zR,{Manager:oV,Socket:Y0e,io:zR,connect:zR});function dZe(){const t=qIe();return t?{authorization:`Bearer ${t}`}:void 0}const Na={timestampOffset:0,socket:void 0},bm={},sV=[];function pZe(t){console.log("tmxMessage:",{data:t})}function r8(t){const e={transportOptions:{polling:{extraHeaders:dZe()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(Na.socket)console.log("socket exists");else{const n=`${ii.socketPath||"https://courthive.net"}/tmx`;Na.socket=zR.connect(n,e),Na.socket.on("ack",gZe),Na.socket.on(bYe,pZe),Na.socket.on(yYe,O0e),Na.socket.on("connect",()=>hZe(t)),Na.socket.on("disconnect",()=>console.log("disconnect")),Na.socket.on("timestamp",r=>Na.timestampOffset=new Date().getTime()-r.timestamp),Na.socket.on("connect_error",r=>{console.log("connection error:",{data:r}),LE()})}}function fZe(){return!!Na.socket}function LE(){Na!=null&&Na.socket&&Na.socket.disconnect(),setTimeout(()=>delete Na.socket,1e3)}function a8({data:t,ackCallback:e}){const i=ol(),{email:n}=i||{},r=t.type??"tmx",a=()=>{if(e&&rt(e)){const s=Wt.UUID();t.payload&&Object.assign(t.payload,{ackId:s}),mZe({ackId:s,callback:e})}const o=Na.timestampOffset?new Date().getTime()+Na.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:s0(),tmxVersion:k6,timestamp:o,userId:n}),Z0e(r,t)};if(Na.socket)a();else try{r8(a)}catch{sV.push({header:r,data:t,ackCallback:e})}}function Z0e(t,e){Na.socket.connected?Na.socket.emit(t,e):console.log("socket not connected")}function hZe(t){for(console.log("** connected"),a8({data:{type:"timestamp"}});sV.length;){const e=sV.pop();Z0e(e.header,e.data)}rt(t)&&t()}function mZe({ackId:t,uuid:e,callback:i}){t&&(bm[t]=i),e&&(bm[e]=i)}function gZe(t){t.ackId&&bm[t.ackId]&&(bm[t.ackId](t),delete bm[t.ackId]),t.uuid&&bm[t.uuid]&&(bm[t.uuid](t),delete bm[t.uuid])}function vZe(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function Fx({e:t,table:e,classNames:i,className:n,visible:r,columns:a}){const o=Jo(t.target,"options_right"),s=r?"":lt,l=r?lt:"";for(const u of o.children){const c=n?Array.from(u.classList).includes(n):Array.from(u.classList).some(d=>i.includes(d));u.style.display=c?s:l}for(const u of a)e.updateColumnDefinition(u,{formatter:r?vZe:void 0,editable:r})}function yZe(t,e){Fx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0)}const X0e=t=>{const e=document.createElement("ul");return t.forEach(i=>{let n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(fc(i.value)){if(i.value){let r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),Object.keys(t).length?e:""},bZe=(t,e)=>{var i,n;return(n=(i=t.groups)==null?void 0:i.find(r=>{var a;return(a=r.participantRoleResponsibilities)==null?void 0:a.includes(e)}))==null?void 0:n.participantName},IZe=t=>bZe(t,"CLUB"),J0e=(t,e)=>(t.events||[]).map(({eventId:i})=>e==null?void 0:e[i]),Q0e=t=>{var e;return((e=pw.countries.find(i=>i.ioc===t||i.iso===t))==null?void 0:e.label)||""},wZe=/[\p{Lu}]/u,SZe=/[\p{Ll}]/u,vZ=/^[\p{Lu}](?![\p{Lu}])/gu,eSe=/([\p{Alpha}\p{N}_]|$)/u,o8=/[_.\- ]+/,TZe=new RegExp("^"+o8.source),yZ=new RegExp(o8.source+eSe.source,"gu"),bZ=new RegExp("\\d+"+eSe.source,"gu"),UZe=(t,e,i,n)=>{let r=!1,a=!1,o=!1,s=!1;for(let l=0;l<t.length;l++){const u=t[l];s=l>2?t[l-3]==="-":!0,r&&wZe.test(u)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,o=a,a=!0,l++):a&&o&&SZe.test(u)&&(!s||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),o=a,a=!1,r=!0):(r=e(u)===u&&i(u)!==u,o=a,a=i(u)===u&&e(u)!==u)}return t},DZe=(t,e)=>(vZ.lastIndex=0,t.replaceAll(vZ,i=>e(i))),PZe=(t,e)=>(yZ.lastIndex=0,bZ.lastIndex=0,t.replaceAll(bZ,(i,n,r)=>["_","-"].includes(t.charAt(r+i.length))?i:e(i)).replaceAll(yZ,(i,n)=>e(n)));function EZe(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const i=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?o8.test(t)?"":e.pascalCase?n(t):i(t):(t!==i(t)&&(t=UZe(t,i,n,e.preserveConsecutiveUppercase)),t=t.replace(TZe,""),t=e.preserveConsecutiveUppercase?DZe(t,i):i(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),PZe(t,n))}const{WTN:CZe,UTR:RZe}=ao.ratingConstants,{SINGLES:IZ}=ao.eventConstants,MZe=(t,e)=>{var f,h,m,g,v,y,b,I,T;const{participantId:i,participantName:n,participantType:r,person:a}=t,{standardFamilyName:o,standardGivenName:s}=a||{},l=(h=(f=t.person)==null?void 0:f.addresses)==null?void 0:h[0],u=l!=null&&l.city&&(l!=null&&l.state)?`${l.city}, ${l.state}`:void 0,c=(v=(g=(m=t.ratings)==null?void 0:m[IZ])==null?void 0:g.find(w=>w.scaleName===RZe))==null?void 0:v.scaleValue,p={wtn:(I=(b=(y=t.ratings)==null?void 0:y[IZ])==null?void 0:b.find(w=>w.scaleName===CZe))==null?void 0:I.scaleValue,utr:c};return{searchText:`${n} ${s} ${o}`.toLowerCase(),sex:EZe(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:w})=>w),ioc:Q0e((T=t.person)==null?void 0:T.nationalityCode),events:J0e(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:o,firstName:s,club:IZe(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:u,ratings:p}},gf=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:NZe,FEMALE:AZe}=kc,{PAIR:_Ze}=Ra,xb=t=>(e,i,n)=>{var d;const r=e.getColumn().getDefinition(),a=r.field==="side1"&&1||r.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,u=e.getValue(),c=s.participant||(u==null?void 0:u.participant)||s.person&&s;if(c){const p=ii.scales[ii.activeScale],f=m=>LIe({eventHandlers:{participantClick:g=>rt(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"ADDRESS",genderColor:!0,winnerColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:m,placeholder:i,sideNumber:a}),h=m=>{var v;const g=document.createElement("div");return g.className="flexrow flexjustifystart",(v=m.individualParticipants)==null||v.forEach((y,b)=>{if(g.appendChild(f(y)),!b){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return n==="sideBySide"&&c.participantType===_Ze?h(c):f(c)}if(l){const p=r.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(u==null?void 0:u.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),f=p===NZe&&"#2E86C1"||p===AZe&&"#AA336A"||"";o.style.color=f}return o.innerHTML=(fc(u)?u.participantName:u)||"",o};function kZe(t){const e=t.getValue();return(e==null?void 0:e.length)||0}function e0(t,e){var r,a,o,s;const i=(t==null?void 0:t.person)||((r=t==null?void 0:t.participant)==null?void 0:r.person),n=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||n?i!=null&&i.standardFamilyName&&!(n!=null&&n.standardFamilyName)||n!=null&&n.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(n!=null&&n.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(n==null?void 0:n.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}async function tSe({participantIds:t,participantId:e,callback:i}){(e||t)&&yt({methods:[{params:{participantIds:t||[e]},method:c8e}],callback:a=>{a.success?rt(i)&&i(a):console.log({result:a})}})}const{COMPETITOR:OZe,OFFICIAL:wZ}=_h,{INDIVIDUAL:xZe}=Ra;function iSe({participant:t,view:e,callback:i}){var m,g,v,y;const n=pw.countries.map(b=>({label:pw.countryToFlag(b.iso||"")+" "+b.label,value:b.ioc})),r={nationalityCode:(m=t==null?void 0:t.person)==null?void 0:m.nationalityCode,firstName:(g=t==null?void 0:t.person)==null?void 0:g.standardGivenName,lastName:(v=t==null?void 0:t.person)==null?void 0:v.standardFamilyName,sex:(y=t==null?void 0:t.person)==null?void 0:y.sex};let a;const o=b=>r.nationalityCode=b,s=({firstName:b,lastName:I})=>ur(3)(b||"")&&ur(3)(I||""),l=({inputs:b})=>{const I=s({firstName:b.firstName.value,lastName:b.lastName.value}),T=document.getElementById("saveParticipant");T&&(T.disabled=!I)},u=[{onInput:l,control:"firstName"},{onInput:l,control:"lastName"}],c=b=>{a=Wn(b,[{error:"Please enter a name of at least 3 characters",value:r.firstName||"",validator:ur(3),placeholder:"Given name",label:"First name",field:"firstName",focus:!0},{error:"Please enter a name of at least 3 characters",value:r.lastName||"",validator:ur(3),placeholder:"Family name",label:"Last name",field:"lastName"},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}]},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",field:"birthday",date:!0},{typeAhead:{list:n,callback:o},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}],u)},d=(b,I)=>Ob(b,[{label:"Cancel",close:!0},{disabled:!s(r),onClick:f,id:"saveParticipant",intent:"is-info",label:"Save",close:!0}],I),p=t?"Edit":"New";ze.drawer.open({title:`<b style='larger'>${p} participant</b>`,callback:()=>{},width:"300px",side:mt,content:c,footer:d});function f(){if(!(t!=null&&t.participantId))h();else{const b={nationalityCode:a.nationalityCode.value,standardFamilyName:a.lastName.value,standardGivenName:a.firstName.value,birthdate:a.birthday.value,sex:a.sex.value},I=[{params:{participant:{participantId:t.participantId,person:b}},method:W$}];yt({methods:I,callback:w=>{w.success?rt(i)&&i():console.log(w)}})}}function h(){const b=a.firstName.value,I=a.lastName.value,T=a.sex.value,w={participantRole:e===wZ?wZ:OZe,participantType:xZe,participantId:Wt.UUID(),person:{nationalityCode:r.nationalityCode,standardGivenName:b,standardFamilyName:I,sex:T}};yt({methods:[{params:{participants:[w]},method:CE}],callback:P=>{P.success&&rt(i)&&i(),!P.success&&console.log(P)}})}return{...JD}}function LZe({participantId:t,callback:e}){var n;const i=(n=$e.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants)==null?void 0:n[0];if(i)return iSe({participant:i,callback:e})}const qR=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(c=>c.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),o=a.getData(),{participantId:s,participantType:l}=o;Ps({items:[{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>{var c;return console.log("Participant profile",(c=i.getData())==null?void 0:c.participant)}},{hide:l!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{LZe({participantId:s,callback:t})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{tSe({participantId:s,callback:d=>{if(d.success)a.delete();else{const p=i.getTable();p.alert(d.error.message||"Cannot Remove Participant"),setTimeout(()=>p.clearAlert(),2500)}}})}}],target:r||e.target,config:{placement:tf}})},{SINGLES:FZe}=ko,nSe=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=e.getRow().getData(),{participantId:o}=a,s=(l,u)=>{var c;return(c=l==null?void 0:l.eventName)==null?void 0:c.localeCompare(u==null?void 0:u.eventName)};return r.sort(s).forEach(l=>{const u=rSe({def:i,participantId:o,event:l,eventClick:t});n.appendChild(u)}),n};function rSe({matchUpId:t,participantId:e,event:i,eventClick:n}){var a,o;const r=document.createElement("span");return rt(n)&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",(a=i.gender)!=null&&a.toLowerCase().includes("female")?r.classList.add("is-danger"):(o=i.gender)!=null&&o.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===FZe&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const BZe=t=>e=>{const i=e.getColumn().getDefinition(),n=e.getRow().getData(),{matchUpId:r}=n,a=document.createElement("div");a.className="tags";const o=rSe({def:i,matchUpId:r,event:n,eventClick:t});return a.append(o),a},$Ze=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=(o,s)=>{var l;return(l=o==null?void 0:o.participantName)==null?void 0:l.localeCompare(s==null?void 0:s.participantName)};return r.sort(a).forEach(o=>{const s=VZe({def:i,team:o,teamClick:t});n.appendChild(s)}),n};function VZe({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:a}=e;return rt(i)&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=a,n}const lV=({maxValue:t,decimals:e,field:i})=>(n,r,a)=>{const o=e?/[^0-9.]/g:/[^0-9]/g,s=document.createElement("input");s.style.backgroundColor="lightyellow",s.style.boxSizing="border-box",s.style.textAlign="center",s.style.padding="3px",s.style.height="100%",s.style.width="100%",s.value=n.getValue()||"",r(()=>{s.focus(),s.select()});function l(){let u=s.value;e&&(u=parseFloat(u).toFixed(2)),a(isNaN(u)?void 0:u)}return s.addEventListener("keydown",u=>{u.key==="Tab"&&(u.preventDefault(),u.stopPropagation())}),s.addEventListener("keyup",u=>{const c=u.target.value.replace(o,"")||"";if(u.target.value=c>t?"":c,u.key==="Tab"&&u.shiftKey&&i){const p=Jo(u.target,"tabulator-row").previousSibling,f=p&&lh(p,"tabulator-editable");if(f)for(n of f)n.getAttribute("tabulator-field")===i&&n.focus()}else if((u.key==="Enter"||u.key==="Tab")&&i){const p=Jo(u.target,"tabulator-row").nextSibling,f=p&&lh(p,"tabulator-editable");if(f)for(n of f)n.getAttribute("tabulator-field")===i&&n.focus()}}),s.addEventListener("blur",l),s},SZ=t=>ze.columns[t]!==!1;function Yn({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:a,view:o}){var d,p,f,h;const s=(p=(d=$e.getTournament())==null?void 0:d.tournamentRecord)==null?void 0:p.tournamentId,l=t&&$e.getEvent({eventId:t,drawId:e}).event,u=((f=l==null?void 0:l.drawDefinitions)==null?void 0:f.length)===1&&l.drawDefinitions[0];r&&u&&(e=u.drawId,n=!0),a&&(e=(h=l.drawDefinitions.find(({drawId:m})=>$e.allDrawMatchUps({drawId:m,inContext:!1}).matchUps.find(v=>v.matchUpId===a)))==null?void 0:h.drawId,n=!!e);let c=`/${Ia}/${s}/${sv}/${t}`;n&&e?(c+=`/${oT}/${e}`,i&&(c+=`/${oB}/${i}`),[uB,mw,hw].includes(o)&&(c+=`/${sB}/${o}`)):e&&(c+=`/${Pue}/${e}`),ze.router.navigate(c)}const Kh=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:jZe,SIGNED_OUT:GZe}=Ra;function HZe(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();yt({methods:[{params:{signInState:n?jZe:GZe,participantIds:[i]},method:F6}],callback:s=>{s.success&&e.setValue(n)}})}const zZe=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function a(){const o=r.value;n(o)}return r.addEventListener("keydown",o=>{o.key==="Tab"&&(o.preventDefault(),o.stopPropagation())}),r.addEventListener("keyup",o=>{if(o.key==="Tab"&&o.shiftKey&&t){const l=Jo(o.target,"tabulator-row").previousSibling,u=l&&lh(l,"tabulator-editable");if(u)for(e of u)e.getAttribute("tabulator-field")===t&&e.focus()}else if((o.key==="Enter"||o.key==="Tab")&&t){const l=Jo(o.target,"tabulator-row").nextSibling,u=l&&lh(l,"tabulator-editable");if(u)for(e of u)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",a),r},RF="fa-check-square",vf=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),a=[];for(const o of r){const s=o.getDefinition();if(s.title){const l=document.createElement("i");l.classList.add("fas"),l.classList.add(o.isVisible()?RF:"fa-square");const u=document.createElement("span"),c=document.createElement("span"),d=(t==null?void 0:t[s.field])||s.displayTitle||s.title;c.textContent=" "+d,u.appendChild(l),u.appendChild(c),a.push({label:u,action:function(p){p.stopPropagation(),o.toggle(),ze.columns[o.getField()]=o.isVisible(),n.redraw(),o.isVisible()?(l.classList.remove("fa-square"),l.classList.add(RF)):(l.classList.remove(RF),l.classList.add("fa-square"))}})}}return a},{WTN:qZe,UTR:WZe}=ao.ratingConstants,{FEMALE:KZe,MALE:YZe}=kc,TZ="ratings.utr.utrRating",UZ="ratings.wtn.wtnRating";function ZZe({data:t,replaceTableData:e}){const i=t.some(o=>o.cityState),n=t.some(o=>o.tennisId),r=t.some(o=>{var s;return(s=o.ratings)==null?void 0:s.utr}),a=t.some(o=>{var s;return(s=o.ratings)==null?void 0:s.wtn});return[{cellClick:(o,s)=>s.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{headerMenu:vf({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:Ct,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,resizable:!1,hozAlign:Et,width:50},{formatter:xb(({event:o,cell:s,...l})=>qR(o)),cellClick:qR,sorter:e0,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:zZe({field:"tennisId"}),visible:n,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:Ct,editor:"list",width:80,editorParams:{itemFormatter:(o,s)=>s,values:{Male:YZe,Female:KZe,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:HZe,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:Ct,tooltip:!1,width:40},{sorter:(o,s)=>(o.length||0)-((s==null?void 0:s.length)||0),formatter:kZe,title:"Penalties",field:"penalties",hozAlign:Ct,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:Ct,minWidth:70,editor:!1,visible:!1},{sorter:(o,s)=>{var l;return(l=o==null?void 0:o[0].eventName)==null?void 0:l.localeCompare(s==null?void 0:s[0].eventName)},formatter:nSe(Yn),visible:SZ("events"),title:"Events",field:"events",hozAlign:Ct,minWidth:200,editor:!1,widthGrow:2},{sorter:(o,s)=>{var l;return(l=o==null?void 0:o[0].participantName)==null?void 0:l.localeCompare(s==null?void 0:s[0].participantName)},formatter:$Ze(()=>console.log("boo")),visible:SZ("teams"),title:"Teams",field:"teams",hozAlign:Ct,minWidth:200,editor:!1,widthGrow:2},{headerFilter:"input",visible:!!i,title:"City/State",field:"cityState",minWidth:110},{editor:lV({maxValue:40,decimals:!0,field:UZ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:UZ,editable:!1,visible:!!a,title:qZe,width:70},{editor:lV({maxValue:16,decimals:!0,field:TZ}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:TZ,editable:!1,visible:!!r,title:WZe,width:70},{cellClick:qR(e),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,maxWidth:40}]}const{INDIVIDUAL:XZe,GROUP:JZe,TEAM:QZe}=Ra,{OFFICIAL:DZ,COMPETITOR:eXe}=_h;function tXe({view:t}={}){let e,i,n,r,a,o;const s={participantRoles:[t===DZ?DZ:eXe]},l=()=>{({participants:n=[],derivedEventInfo:r}=$e.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:s,withEvents:!0,withISO2:!0}));const m=n.filter(({participantType:g})=>g===XZe);return i=n.filter(({participantType:g})=>g===JZe),a=n.filter(({participantType:g})=>g===QZe),(m==null?void 0:m.map(g=>MZe(g,r)))||[]},u=()=>{setTimeout(()=>e.replaceData(l()),o?0:1e3)},c=l(),d=ZZe({data:c,replaceTableData:u}),p=(h,m)=>(Wt.isNumeric(h)&&h||0)+(Wt.isNumeric(m)&&m||0);return(h=>{var y;mf({anchorId:VM});const m=document.getElementById(VM),g=(y=Jo(m,"section"))==null?void 0:y.querySelector(".tabHeader");e=new da(m,{headerSortElement:gf(["sex","signedIn","events","teams","cityState","tennisId","ratings.wtn.wtnRating","ratings.utr.utrRating"]),responsiveLayoutCollapseFormatter:X0e,responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.86,placeholder:"No participants",responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:h});const v=b=>`Participants (${b.length})`;e.on("dataChanged",b=>g&&(g.innerHTML=v(b))),e.on("dataFiltered",(b,I)=>{g&&(g.innerHTML=v(I));const T=[],w=[];for(const D of I){const R=D.getData(),{wtn:N,utr:M}=R.ratings;Wt.isNumeric(M==null?void 0:M.utrRating)&&w.push(parseFloat(M.utrRating)),Wt.isNumeric(N==null?void 0:N.wtnRating)&&T.push(parseFloat(N.wtnRating))}const S=w.reduce(p,0),U=T.reduce(p,0),P=(w.length?S/w.length:0).toFixed(2),E=(T.length?U/T.length:0).toFixed(2);ii.averages&&console.log(`UTR ${P}x`),ii.averages&&console.log(`WTN ${E}x`)}),e.on("scrollVertical",Pu),e.on("tableBuilt",()=>o=!0)})(c),{table:e,replaceTableData:u,teamParticipants:a,groupParticipants:i}}function iXe(t,e){Fx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!1,table:e,e:t}),e.showColumn("ratings.utr.utrRating"),e.showColumn("ratings.wtn.wtnRating"),e.redraw(!0),$e.getParticipants({withScaleValues:!0});const n=e.getData().flatMap(a=>{var h,m,g;const o=(h=a.ratings)==null?void 0:h.wtn,s=o==null?void 0:o.wtnRating,l=o!=null&&o.confidence||s?50:0;let u=l?{...o,wtnRating:s,confidence:l}:"";const c={method:LY,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:u}}},d=(g=(m=a.ratings)==null?void 0:m.utr)==null?void 0:g.utrRating,p=d?50:0;u=p?{utrRating:d,confidence:p}:"";const f={method:LY,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:u}}};return[c,f]});yt({methods:n,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:nXe,OTHER:rXe}=_h,{TEAM:PZ}=Ra;function aSe({individualParticipantIds:t,participantType:e=PZ,title:i="Edit team",participant:n,refresh:r,table:a}){const o="participantName",s={[o]:n==null?void 0:n[o]};let l;const u=()=>{},c=h=>{l=Wn(h,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:s[o]||"",validator:ur(3),field:o,onChange:u,label:"Name"}])},d=(h,m)=>Ob(h,[{label:"Cancel",onClick:()=>a==null?void 0:a.deselectRow(),close:!0},{label:"Save",onClick:p,close:!0,intent:"is-info"}],m);ze.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>console.log("drawer callback"),width:"300px",side:mt,content:c,footer:d});function p(){a.deselectRow(),n!=null&&n.participantId?console.log("update existing"):f()}function f(){var y;const h=e===PZ?nXe:rXe,m={individualParticipantIds:t||(n==null?void 0:n.individualParticipantIds)||[],participantName:(y=l[o])==null?void 0:y.value,participantRole:h,participantType:e};yt({methods:[{params:{participants:[m]},method:CE}],callback:b=>{b.success?rt(r)&&r():console.log({result:b})}})}return{...JD}}const{TEAM:MF}=Ra;function EZ({participants:t,table:e,replaceTableData:i,participantType:n=MF}){const r=({team:s})=>{const u=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const c=[{method:Nwe,params:{groupingParticipantId:s.participantId,individualParticipantIds:u}}];yt({methods:c,callback:p=>{p.success&&i()}})},a=()=>{const s=n===MF?"New team":"New Group",u=e.getSelectedData().map(({participantId:c})=>c);aSe({refresh:i,individualParticipantIds:u,participantType:n,table:e,title:s})},o=n===MF?"Create new team":"Create new group";return{options:t.map(s=>({onClick:()=>r({team:s}),label:s.participantName,participant:s,close:!0})),actions:[{onClick:()=>a(),close:!0,label:o}]}}const aXe=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:s})=>s),o=t.getData("active").map(({participantId:s})=>s).filter(s=>!n.includes(s));o.length===1&&(t.selectRow(o),e.target.value="",t.clearFilter())}};function oSe(t){let e;const i=s=>{var l;return(l=s==null?void 0:s.eventIds)==null?void 0:l.includes(e)},n=s=>{t.removeFilter(i),e=s,s&&t.addFilter(i)},r=$e.getEvents().events||[];return{eventOptions:[{label:`<span style='font-weight: bold'>${oh}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(s=>({onClick:()=>n(s.eventId),label:s.eventName,close:!0}))),events:r}}const{WTN:oXe,UTR:sXe}=ao.ratingConstants,{FEMALE:lXe,MALE:uXe,MIXED:cXe,ANY:dXe}=kc;function pXe({callback:t}){let e;yn({title:"Generate mock players",content:a=>e=Wn(a,[{options:[{label:"Any",value:dXe,close:!0},{label:"Female",value:lXe,close:!0},{label:"Male",value:uXe,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32},{text:"Generate Ratings",header:!0},{label:"WTN",field:"wtnRating",id:"wtnRating",checkbox:!0},{label:"UTR",field:"utrRating",id:"utrRating",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,o=e.wtnRating.checked,s=e.utrRating.checked,l=e.gender.value,u=l===cXe?void 0:l,c=[o&&{ratingType:oXe,ratingMin:14,ratingMax:19.99},s&&{ratingType:sXe,ratingMin:8,ratingMax:10}].filter(Boolean),{participants:d}=XD.generateParticipants({participantsCount:parseInt(a),scaleAllParticipants:!0,categories:c,sex:u});yt({methods:[{method:CE,params:{participants:d}}],callback:t})}}]})}function fXe({callback:t}){let e=r=>{let a=r==null?void 0:r.players;a!=null&&a.length?hXe(a):a&&!a.length&&ze.modal.inform({message:"Sheet Empty: No Player Rows"}),rt(t)&&t()};const{extension:i}=$e.findExtension({discover:!0,name:Xv.REGISTRATION});(i==null?void 0:i.value)||pXe({callback:e})}function hXe(t){console.log({registeredPlayers:t})}function sSe(t){const i=t.getSelectedData().filter(r=>{var a;return!((a=r.events)!=null&&a.length)}).map(({participantId:r})=>r),n=()=>{tSe({participantIds:i,callback:a=>{a.success&&t.deleteRow(i)&&t.deselectRow()}})};yn({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})}const{FEMALE:CZ,MALE:RZ,ANY:MZ}=kc;function mXe(t){let e;const i=l=>{var u,c;return((c=(u=l.participant)==null?void 0:u.person)==null?void 0:c.sex)===e},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[RZ,CZ],a={[RZ]:"Male",[CZ]:"Female",[MZ]:exe};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[MZ]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:gXe}=Ra;function vXe(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);yt({methods:[{params:{signInState:gXe,participantIds:i},method:F6}],callback:a=>{a.success&&(e.forEach(o=>o.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:yXe,SIGNED_OUT:bXe}=Ra;function IXe(t){const i=$e.getParticipants({participantFilters:{participantTypes:[yXe]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);yt({methods:[{params:{signInState:bXe,participantIds:i},method:F6}],callback:a=>{a.success&&t()}})}function wXe(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const Cf={participantName:["full name","name"],participantId:["id","participantid"],person:{standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],address:{city:["city"],state:["state"]},birthDate:["*birth"],sex:["gender","sex"]}};function SXe({data:t,sheetId:e,callback:i}){var u;const r=$e.getParticipants().participants.map(({participantId:c})=>c),a=pw.countries.map(c=>[c.ioc,c.iso]).flat().filter(Boolean),o=[],s=c=>c.map(d=>[d.toLowerCase(),d.toLowerCase().split(" ").join("")]).flat(),l=c=>(d=[])=>{const p=Object.keys(c),f=s(d),h=f.reduce((g,v)=>c[v]||g,void 0),m=!h&&p.filter(g=>f.find(v=>v.startsWith("*")&&g.toLowerCase().includes(v.slice(1))));return h||c[m]};for(const c of t||[]){const d=Object.assign({},...Object.keys(c).map(E=>({[E.toLowerCase()]:c[E]}))),p=l(d),f={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};f.participantName=p(Cf.participantName);const h=p(["tennis id","tennisid"]);h&&(f.person.tennisId=h);const m=p(Cf.person.standardFamilyName),g=p(Cf.person.standardGivenName);if(m&&g)f.person.standardFamilyName=m,f.person.standardGivenName=g,f.participantName=`${g} ${m}`;else continue;const v=p(Cf.person.address.state),y=p(Cf.person.address.city);(y||v)&&(f.person.addresses=[{city:y,state:v}]);const b=p(Cf.person.nationalityCode);b&&a.includes(b.toUpperCase())&&(f.person.nationalityCode=b);const I=p(Cf.person.birthDate);if(Wt.dateTime.dateValidation.test(I)){const E=Wt.dateTime.extractDate(I);E&&(f.person.birthDate=E)}const T=p(Cf.person.sex);if(T){const E=T.toUpperCase();["MALE","FEMALE"].includes(E)?f.person.sex=E:["F","W","G"].includes(T[0])?f.person.sex="FEMALE":["M","B"].includes(T[0])&&(f.person.sex="MALE")}const w=p(["utr profile"]);if(w){f.onlineResources||(f.onlineResources=[]);const E=(u=w.split("profiles/"))==null?void 0:u.reverse()[0];E&&(f.person.personOtherIds||(f.person.personOtherIds=[]),f.person.personOtherIds.push({uniqueOrganisationName:"UTR",personId:E}),w.startsWith("http")&&f.onlineResources.push({resourceSubType:"PROFILE",identifier:w,name:"UTR Profile",resource:"URL"}))}const S=p(["utr"]);if(S){f.timeItems||(f.timeItems=[]);const E={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:S}};f.timeItems.push(E)}const U=p(["wtn"]);if(U){f.timeItems||(f.timeItems=[]);const E={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:U}};f.timeItems.push(E)}f.participantId=p(Cf.participantId)||`XXX-${wXe(f.participantName)}`,r.includes(f.participantId)||o.push(Wt.definedAttributes(f))}o.length?yt({methods:[{method:CE,params:{participants:o}},{method:r8e,params:{extension:{name:Uue,value:e}}}],callback:p=>{p.success?(Mt({message:`Added ${p.results[0].addedCount} participant(s)`,intent:"is-success"}),rt(i)&&i()):console.log(p)}}):Mt({message:"No new participants found",intent:"is-primary"}),rt(i)&&i()}const lSe=t=>![null,void 0].includes(t),uSe=({c:t})=>t.map(e=>lSe(e==null?void 0:e.v)?e:{});function NZ({header:t,rows:e,useFormat:i=!1}){const n=u=>O1e(u)&&/Date\((\d+),(\d+),(\d+)\)/.test(u),r=u=>u.f||u.v,a=u=>i||n(u.v)?r(u):u.v,o=(u,c,d)=>({...u,[t[d]]:a(c)}),s=(u,c,d)=>lSe(c.v)?o(u,c,d):u,l=u=>u.reduce((c,d,p)=>s(c,d,p),{});return e.map(uSe).map(l)}function TXe(t){try{const e=t.split("setResponse(")[1].split(");")[0],i=JSON.parse(e),{cols:n,rows:r}=i.table??{},a=n.map(({label:o})=>o);if(a.filter(Boolean).length)return NZ({header:a,rows:r});{const[o,...s]=r,l=uSe(o).map(u=>u.v);return NZ({header:l,rows:s})}}catch{return[]}}async function UXe({sheetId:t}){const e=`https://docs.google.com/spreadsheets/d/${t}/gviz/tq?`;try{const i=await window.fetch(e);return i!=null&&i.ok?i.text():void 0}catch{return}}async function DXe({sheetId:t}){const e=await UXe({sheetId:t});return e?TXe(e):[]}function PXe({callback:t}){const{extension:e}=$e.findExtension({discover:!0,name:Uue}),i=e==null?void 0:e.value;let n;yn({title:"Import participants",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Submit",intent:"is-primary",onClick:()=>{const s=n.url.value;if(s){const l=s.split("/"),u=l.reduce((f,h)=>!f||h.length>f.length?h:f,void 0),c=!i||i&&u!==i,d=i||l.indexOf("docs.google.com")>0&&l.indexOf("spreadsheets")>0,p=c?u:i;if(d)d?DXe({sheetId:p}).then(f=>SXe({data:f,sheetId:p,callback:t})):Mt({message:"URL unchanged",intent:"is-info"});else{const f=Lr.tr("phrases.invalidsheeturl");Mt({message:f,intent:"is-danger"}),n.url.value=""}}},close:!0}],content:s=>{n=Wn(s,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])}})}const{ALTERNATE:EXe,WILDCARD:CXe,DIRECT_ACCEPTANCE:AZ,UNGROUPED:RXe}=Ql,{MAIN:_Z,QUALIFYING:MXe}=rr,{INDIVIDUAL:NXe}=Ra,{TEAM:kZ,DOUBLES:AXe}=ko;function _Xe({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const a=[kZ,AXe].includes(i)&&n===NXe;if(!(r!=null&&r.length)){Mt({message:"Nothing to do",intent:"is-info"});return}const s=[{label:"Main",value:_Z,selected:!0},{label:"Qualifying",value:MXe}].map(({label:p,value:f,selected:h})=>({selected:h,label:p,value:f})),l=[{hide:a,label:"Direct Acceptance",value:AZ,selected:!0},{hide:a,label:"Alternate",value:EXe},{hide:a,label:"Wildcard",value:CXe},{hide:n===kZ,label:"Ungrouped",value:RXe,selected:a}];let u;yn({title:"Add to event",content:p=>u=Wn(p,[{text:`Add ${r.length} participant to ${e}`},{options:s,label:"Event stage",field:"entryStage",value:_Z},{options:l,value:AZ,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=u.entryStatus.value,f=u.entryStage.value;rt(t)&&t({entryStatus:p,entryStage:f})}}]})}function cSe({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:a,eventName:o,eventType:s}=t,l=r.filter(c=>!c.events.map(d=>d.eventId).includes(a)).map(({participantId:c})=>c);_Xe({callback:({entryStatus:c,entryStage:d}={})=>{i.deselectRow(),yt({methods:[{params:{eventId:a,participantIds:l,entryStatus:c,entryStage:d},method:x6}],callback:h=>{h.success?rt(n)&&n():(console.log({result:h}),h.misMatchedGender&&Mt({intent:"is-danger",message:"Invalid gender"}))}})},eventName:o,participantType:e,eventType:s,participantIds:l})}const{ALTERNATE:kXe,DIRECT_ACCEPTANCE:OXe,UNGROUPED:xXe,STRUCTURE_SELECTED_STATUSES:LXe}=Ql,{ANY:tv,FEMALE:iI,MALE:nI,MIXED:rI}=kc,{DOUBLES:am,SINGLES:aI,TEAM:om}=ko,{INDIVIDUAL:NC,PAIR:OZ}=Ra,{MAIN:FXe}=rr;function Bx({table:t,event:e,participants:i,callback:n}={}){var I,T,w;const r=((I=$e.getEvents().events)==null?void 0:I.length)||0,a=((T=$e.getTournamentInfo())==null?void 0:T.tournamentInfo)||{},o={eventName:(e==null?void 0:e.eventName)||`Event ${r+1}`,startDate:(e==null?void 0:e.startDate)??a.startDate,endDate:(e==null?void 0:e.endDate)??a.endDate,eventType:(e==null?void 0:e.eventType)||aI,gender:(e==null?void 0:e.gender)||tv},s=(w=e==null?void 0:e.entries)==null?void 0:w.filter(({entryStatus:S})=>[...LXe,kXe].includes(S)).map(({participantId:S})=>S),l=s?$e.getParticipants({participantFilters:{participantIds:s},withIndividualParticipants:!0}).participants:[],u=[],c=l.reduce((S,U)=>{var E,D;const P=(E=U.person)!=null&&E.sex?[U.person.sex]:((D=U.individualParticpants)==null?void 0:D.map(R=>{var N;return(N=R.person)==null?void 0:N.sex}))||[];return u.push(P),S.includes(U.participantType)?S:S.concat(U.participantType)},[]);let d,p;const f=i==null?void 0:i[0].participantType;if(i!=null&&i.length){o.eventType=f===NC&&aI||f===OZ&&am||om,f===NC&&(d=[aI,am,om]),f===OZ&&(d=[am]),f===om&&(d=[om]),p=[tv];const S=f===NC&&Wt.unique(i.map(U=>{var P,E;return(E=(P=U.participant)==null?void 0:P.person)==null?void 0:E.sex})).filter(Boolean);S.length===1&&(S[0]===iI&&p.push(iI),S[0]===nI&&p.push(nI),o.gender=S[0])}if(u.length){p=[tv],e.gender&&!e.gender===tv&&p.push(e.gender),e.eventType===am&&!p.includes(rI)&&p.push(rI);const S=Wt.unique(...u);S.length===1&&!p.includes(S[0])&&p.push(...S)}else e&&(p=[tv,nI,rI,iI]);const h=()=>{},m=[{fields:["startDate","endDate"],minDate:a.startDate,maxDate:a.endDate,dateRange:!0}],g=S=>Wn(S,[{error:"minimum of 5 characters",validator:ur(5),placeholder:"Event name",value:o.eventName,onChange:h,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:c.length,value:o.eventType,field:"eventType",label:"Format",options:[{hide:d&&!d.includes(aI),selected:o.eventType===aI,label:"Singles",value:aI},{hide:d&&!d.includes(am),selected:o.eventType===am,label:"Doubles",value:am},{hide:d&&!d.includes(om),selected:o.eventType===om,label:"Team",value:om}],onChange:h},{value:o.gender,label:"Gender",field:"gender",options:[{hide:p&&!p.includes(nI),selected:o.gender===nI,label:"Male",value:nI},{hide:p&&!p.includes(iI),selected:o.gender===iI,label:"Female",value:iI},{selected:o.gender===tv,label:"Any",value:tv},{hide:p&&!p.includes(rI),selected:o.gender===rI,label:"Mixed",value:rI}],onChange:h},{value:(e==null?void 0:e.startDate)??a.startDate,placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{value:(e==null?void 0:e.endDate)??a.endDate,placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"},{hide:e||i,divider:!0}],m),v=()=>{const S=ze.drawer.attributes.content.eventName.value,U=ze.drawer.attributes.content.eventType.value,P=ze.drawer.attributes.content.startDate.value,E=ze.drawer.attributes.content.endDate.value,D=ze.drawer.attributes.content.gender.value,R={eventName:S,eventType:U,gender:D,startDate:P,endDate:E},N=M=>{var A,_;if(M.success){const k=(_=(A=M.results)==null?void 0:A[0])==null?void 0:_.event;rt(n)&&n({...M,event:k,eventUpdates:R})}else console.log({result:M})};if(e){const M=e.eventId;yt({methods:[{method:h8e,params:{eventId:M,eventUpdates:R}}],callback:N})}else{const M=Wt.UUID(),A=[{method:e8e,params:{event:{eventId:M,eventName:S,eventType:U,gender:D,startDate:P,endDate:E}}}];if(i!=null&&i.length){const _=i.map(({participantId:F})=>F),k=f===NC&&[am,om].includes(U)?xXe:OXe,B={params:{eventId:M,participantIds:_,entryStatus:k,entryStage:FXe},method:x6};A.push(B)}yt({methods:A,callback:N})}},y=(S,U)=>Ob(S,[{label:"Cancel",onClick:()=>t==null?void 0:t.deselectRow(),close:!0},{label:"Save",onClick:v,close:!0,intent:"is-info"}],U),b=e!=null&&e.eventId?"Edit event":"Add event";ze.drawer.open({title:`<b style='larger'>${b}</b>`,width:"300px",side:mt,content:g,footer:y})}const QN=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(o=>o.participantId),r=i.filter(o=>n.includes(o.participantId));Bx({table:t,callback:o=>{var s,l;if(t.deselectRow(),o!=null&&o.success){const u=(l=(s=o==null?void 0:o.results[0])==null?void 0:s.event)==null?void 0:l.eventId;rt(e)?e({eventId:u}):u&&Yn({eventId:u})}},participants:r})},{INDIVIDUAL:xZ,TEAM:LZ,GROUP:FZ}=Ra,{OFFICIAL:BZ}=_h,dSe=t=>[{label:"Individuals",value:xZ,isActive:t===xZ,close:!0},{label:"Officials",value:BZ,isActive:t===BZ,close:!0},{label:"Groups",value:FZ,isActive:t===FZ,close:!0},{label:"Teams",value:LZ,isActive:t===LZ,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${$e.getTournament().tournamentRecord.tournamentId}/${Rp}/${e.value}`;ze.router.navigate(n)}}})),{INDIVIDUAL:BXe,GROUP:$Xe}=Ra,{OFFICIAL:VXe}=_h,{MIXED:jXe}=kc;function GXe({view:t}){const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=tXe({view:t}),a=_b(e),{eventOptions:o,events:s}=oSe(e),{sexOptions:l,genders:u}=mXe(e),c=()=>PXe({callback:i}),d=()=>{fXe({callback:()=>{i(),e==null||e.redraw(!0)},showNotice:!0})},p=t===VXe?"Officials":"Individuals",{extension:f}=$e.findExtension({discover:!0,name:Xv.REGISTRATION}),h=f==null?void 0:f.value,m=[{onClick:()=>IXe(i),label:"Sign out players not approved for events",close:!0},{onClick:w=>yZe(w,e),label:"Edit ratings",close:!0},{divider:!0},{heading:"Add participants"},{hide:h,label:"Generate mock participants",onClick:d,close:!0},{label:"Import from Google sheet",onClick:c,close:!0},{onClick:()=>iSe({callback:i,view:t}),label:"New participant",close:!0}],g=s.map(w=>({onClick:()=>cSe({event:w,participantType:BXe,table:e,callback:i}),label:w.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>QN(e,i),close:!0}]),v=EZ({participants:r,participantType:$Xe,replaceTableData:i,table:e}),y=EZ({participants:n,table:e,replaceTableData:i}),b=aXe(e),I=[{onKeyDown:w=>{w.keyCode===8&&w.target.value.length===1&&a(""),b(w)},onChange:w=>a(w.target.value),onKeyUp:w=>a(w.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:gr,search:!0},{options:g,label:"Add to event",hide:!s.length,intent:"is-none",location:gr},{onClick:()=>QN(e),label:"Create event",hide:s.length,intent:"is-info",location:gr},{selection:y,label:"Add to team",intent:"is-none",location:gr},{selection:v,label:"Add to group",intent:"is-none",location:gr},{onClick:()=>vXe(e),intent:"is-primary",location:gr,label:"Sign in"},{onClick:()=>sSe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onKeyDown:w=>{w.keyCode===8&&w.target.value.length===1&&a(""),b(w)},onChange:w=>a(w.target.value),onKeyUp:w=>a(w.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:Ct,search:!0},{hide:(s||[]).length<1,options:o,label:oh,modifyLabel:!0,location:Ct,selection:!0},{options:l,label:u[jXe],modifyLabel:!0,location:Ct,selection:!0},{options:dSe(t),label:p,intent:"is-info",modifyLabel:!0,location:mt,selection:!0,align:mt},{options:m,label:"Actions",selection:!1,location:mt,align:mt},{onClick:w=>iXe(w,e),label:"Save ratings",intent:"is-primary",class:"saveRatings",location:mt,visible:!1}],T=document.getElementById(M3);no({table:e,target:T,items:I})}function HXe(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:a,participantId:o,representing:s}=t,l=(i==null?void 0:i.length)||0;return{events:J0e(t,e),eventIds:t.events.map(({eventId:u})=>u),searchText:r.toLowerCase(),representing:Q0e(s),individualParticipants:n,participantName:r,participantType:a,participantId:o,membersCount:l}}function zXe({table:t,team:e}){const n=t.getSelectedData().map(({participantId:o})=>o);t.deselectRow();const r=[{method:y8e,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];yt({methods:r,callback:o=>{o.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:qXe,ASSIGN_PARTICIPANT:WXe,QUALIFYING_PARTICIPANT:KXe,SWAP_PARTICIPANTS:YXe}=ib,ZXe={[qXe]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[WXe]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[KXe]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[YXe]:{selections:"availableAssignments",targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function FE({title:t="Select participant",selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:a,update:o,action:s}){const l=ZXe[s.type];if(!(l!=null&&l.targetAttribute))return;let u,c;const d=()=>{var R;const P=l.targetAttribute,E=l.param||l.targetAttribute,D=Array.isArray(u)?(R=u[0])==null?void 0:R[P]:u==null?void 0:u[P];D&&(s.type==="SWAP"?(s.payload.drawPositions.push(D),a({[E]:s.payload.drawPositions})):a({[E]:D,selected:u}))},p="selectionControl",f="selectionTable",h=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:d,close:!0}],m=()=>{const P=ze.tables.selectionTable;P==null||P.destroy(),delete ze.tables.selectionTable},g=`
    <div style='min-height: 420px'>
      <div id='${p}'></div>
      <div id='${f}'></div>
    </div>
  `;o?o({title:t,content:g,buttons:h,onClose:m}):yn({title:t,content:g,buttons:h,onClose:m});const v=P=>{u=P,i&&(u==null?void 0:u.length)===i&&(Hw(),d())},y=s[l.selections],{table:b}=f0e({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:v,anchorId:f,data:y}),I=_b(b),T=()=>{const P=b.getData("active");if(P.length===1){if(r)u=P[0],Hw(),d();else if(n){const E=(u==null?void 0:u.map(R=>R.participantId))||[],D=P[0].participantId;E.includes(D)||(Array.isArray(u)?u.push(P[0]):u=P,b.selectRow([D]),c.participantSearch.value="")}}},S=[{onKeyDown:P=>{P.keyCode===8&&P.target.value.length===1&&I(""),P.key==="Enter"&&T()},onChange:P=>I(P.target.value),onKeyUp:P=>I(P.target.value),clearSearch:()=>I(""),placeholder:"Search entries",id:"participantSearch",location:Ct,search:!0,focus:!0}],U=document.getElementById(p);c=no({table:b,target:U,items:S}).inputs}const{ASSIGN_PARTICIPANT:XXe}=ib,NF=Wt.extractAttributes,JXe=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=Ek,e.style.display=lt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBotom=n,e.appendChild(r),t.getElement().appendChild(e);const a=t.getData(),o=d=>{const p={};return d==null?void 0:d.map(f=>{var m;const h=((m=f.person)==null?void 0:m.sex)||"OTHER";return p[h]||(p[h]=0),p[h]+=1,{...f,order:p[h]}})},s=o(a.individualParticipants),l=new da(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:s,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:xb()},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",Pu),l.on("rowMoved",d=>{const p=d.getTable(),h=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:h}},method:W$}];yt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(T=>T.getData()),I=o(b);y.forEach((T,w)=>T.update(I[w]))}}})}),no({table:l,target:i,items:[{onClick:()=>zXe({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onClick:()=>{var g;const d=v=>{if(v.participantId){const y=v.selected,b=(v.selected?v.selected.map(NF("participantId")):[v.participantId]).filter(Boolean),I=(a.individualParticipants??[]).map(NF("participantId")).concat(b);if(b!=null&&b.length){const T=[{method:Nwe,params:{groupingParticipantId:a.participantId,individualParticipantIds:b}},{params:{participant:{participantId:a.participantId,individualParticipantIds:I}},method:W$}];yt({methods:T,callback:S=>{S.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(y),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=((g=a.individualParticipants)==null?void 0:g.map(NF("participantId")))||[],{participants:f}=$e.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),h=f.filter(({participantId:v})=>!p.includes(v));FE({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:XXe,participantsAvailable:h}})},label:"Add players",intent:"is-primary",location:mt}]})},s8="&#9660;",pSe=" &#9654;",ap="&#8964;",fSe=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${s8} </span>`,hSe=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${pSe} </span>`,mSe=Ek;function qv(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(mSe)[0];if(n){const r=n.style.display!==lt;n.style.display=r?lt:"";const o=i.getCells().find(s=>s.getColumn().getDefinition().field===jue)._cell.element;return o&&(o.innerHTML=r?hSe:fSe),{open:!r}}}function l8(t){const i=t.getRow()._row.element.getElementsByClassName(mSe)[0];return(i==null?void 0:i.style.display)!==lt?hSe:fSe}const{GROUP:QXe}=Ra;function eJe({view:t,replaceTableData:e}){const i=(n,r)=>{qv(n,r).open};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:Ct,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:Et,resizable:!1,headerSort:!1},{headerMenu:vf({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:Ct,width:55},{cellClick:(n,r)=>i(n,r),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(n,r)=>{var a,o,s;return(s=(a=n==null?void 0:n[0])==null?void 0:a.eventName)==null?void 0:s.localeCompare((o=r==null?void 0:r[0])==null?void 0:o.eventName)},formatter:nSe(Yn),visible:t!==QXe,hozAlign:Ct,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:Et,field:"membersCount",hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:Et,field:"matchUpsCount",hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:Et,field:"winLoss",hozAlign:Et,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:i,formatter:l8,responsive:!1,headerSort:!1,hozAlign:mt,field:jue,width:20},{cellClick:qR(e),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,width:20}]}const{TEAM:AF}=Ra;function tJe({view:t}={}){let e,i,n,r;const a=()=>({participants:i,derivedEventInfo:n}=$e.getParticipants({participantFilters:{participantTypes:[t||AF]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(c=>HXe(c,n))),o=()=>{setTimeout(()=>e.replaceData(a()),r?0:1e3)},s=eJe({view:t});return(u=>{var p;mf({anchorId:HM});const c=document.getElementById(HM),d=(p=Jo(c,"section"))==null?void 0:p.querySelector(".tabHeader");e=new da(c,{headerSortElement:gf(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:X0e,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:JXe,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:u,columns:s}),e.on("dataChanged",f=>{const h=t===AF?"Teams":"Groups";d&&(d.innerHTML=`${h} (${f.length})`)}),e.on("dataFiltered",(f,h)=>{const m=t===AF?"Teams":"Groups";d&&(d.innerHTML=`${m} (${h.length})`)}),e.on("scrollVertical",Pu),e.on("tableBuilt",()=>r=!0)})(a()),{table:e,replaceTableData:o}}const iJe={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function nJe({callback:t}={}){const e=[{label:Lr.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";yn({title:"Create Team",content:a=>Wn(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const o=a==null?void 0:a.selection.value;if(!o||o===i)return;const s=iJe[o],l=$e.createTeamsFromParticipantAttributes({...s,addParticipants:!1});if(l.newParticipants){const u=[{params:{participants:l.newParticipants},method:CE}];yt({methods:u,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:$Z}=Ra;function rJe({view:t}){const{table:e,replaceTableData:i}=tJe({view:t}),n=_b(e),{eventOptions:r,events:a}=oSe(e),o=[{label:"New team",onClick:()=>aSe({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>nJe({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>QN(e),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===$Z).map(p=>({onClick:()=>cSe({event:p,participantType:$Z,table:e,callback:i}),label:p.eventName,close:!0}))),u=t==="GROUP"?"Groups":"Teams",c=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:gr,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:gr},{onClick:()=>QN(e),label:"Create event",hide:a.length,intent:"is-info",location:gr},{onClick:()=>sSe(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:Ct,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:oh,location:Ct,selection:!0},{options:dSe(t),label:u,modifyLabel:!0,intent:"is-info",location:mt,selection:!0,align:mt},{options:o,label:"Actions",selection:!1,location:mt,align:mt}],d=document.getElementById(x3);no({table:e,target:d,items:c})}const{INDIVIDUAL:aJe,TEAM:oJe,GROUP:sJe}=Ra;function lJe({participantView:t=aJe}={}){const e=t.toUpperCase(),i=[oJe,sJe].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n.style.display=lt,r.style.display=""):(r.style.display=lt,n.style.display=""),i?rJe({view:e}):GXe({view:e})}const{TEAM:uJe}=ko,CS=t=>{var A,_,k,B,F;const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:a,schedule:o,eventId:s,drawId:l,gender:u,sides:c,...d}=t,{scheduledDate:p,scheduledTime:f,courtName:h}=o||{},m=x=>{var $;return(($=x.person)==null?void 0:$.standardFamilyName)||x.participantName},g=(e==null?void 0:e.map(x=>({participantName:x.map(m).filter(Boolean).join(" or ")})))||[],v=((A=c==null?void 0:c[0])==null?void 0:A.participant)||g.shift(),y=((_=c==null?void 0:c[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(B=y==null?void 0:y.person)==null?void 0:B.sex,participant:y},T=c.flatMap(({participant:x})=>{var $;return($=x==null?void 0:x.individualParticipantIds)!=null&&$.length?x.individualParticipantIds:x==null?void 0:x.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),P=(F=d.score)==null?void 0:F.scoreStringSide1,E=c.flatMap(x=>{var j,V,H;const $=(j=x.participant)==null?void 0:j.person;return $?[$.standardGivenName,$.standardFamilyName]:(H=(V=x.participant)==null?void 0:V.individualParticipants)==null?void 0:H.map(({person:z})=>[z.standardGivenName,z.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),D=WIe([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?uJe:i,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:P,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,scheduledDate:p,readyToScore:U,scheduledTime:f,matchUpType:i,scoreDetail:M,winningSide:w,searchText:D,courtName:h,eventName:r,eventType:R,matchUpId:n,roundName:a,complete:S,eventId:s,matchUp:t,gender:u,drawId:l,side1:b,side2:I,score:P}};function gSe(t,e){const i=t.target.id;t.dataTransfer.setData("itemid",i),e&&(t.dataTransfer.setData("itemtype",rxe),t.dataTransfer.setDragImage(ze.dragMatch,10,10)),t.dataTransfer.effectAllowed="move"}const{MALE:cJe,FEMALE:dJe}=kc;function pJe(t){function e(a){const o=document.createElement("div"),s=a.getValue(),l=fc(s)&&(s==null?void 0:s.sex)===cJe&&"#2E86C1"||(s==null?void 0:s.sex)===dJe&&"#AA336A"||"";return o.style.color=l,o.innerHTML=(fc(s)?s.participantName:s)||"",o}function i(a){const o=document.createElement("div");return o.innerHTML=a.getValue(),o}function n(a){const o=a.getElement();return o.classList.add("tag"),o.classList.add("is-info"),o.classList.add("is-light"),(t==null?void 0:t.length)||0}const r=(a,o)=>{var s;return a.participantName&&!o.participantName||o.participantName&&!a.participantName||!(a!=null&&a.participantName)&&!(o!=null&&o.participantName)?1:(s=a==null?void 0:a.participantName)==null?void 0:s.localeCompare(o==null?void 0:o.participantName)};return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:Et,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const VZ=Object.keys(Rue);function fJe(t,e){return VZ.indexOf(t.issue)-VZ.indexOf(e.issue)}function eA(t){var o;const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(fc)).filter(s=>s.matchUpId),{courtIssues:n,rowIssues:r}=Mg.proConflicts({matchUps:i});n&&((o=Object.keys(n))!=null&&o.length),e!=null&&e.length&&t.updateData(e);const a=t.getColumns()[0].getCells();r!=null&&r.length&&r.forEach((s,l)=>{const u=l+1,c=a.find(d=>d.getData().rowNumber===u);if(c){c.getElement().classList.forEach(p=>{p.startsWith("matchup")&&c.getElement().classList.remove(p)});const d=c.getData();if(s.length){const p=s.sort(fJe);d.issues=p;const f=Rue[p[0].issue];c.getElement().classList.add(f)}else c.getElement().style.backgroundColor="white",d.issues=[]}else console.log("control cell not found",{rowNumber:u})})}function hJe(t,e){var m;t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=da.findTable("#tournamentSchedule")[0],a=n.getData().flatMap(g=>Object.values(g).filter(v=>v.matchUpId)).find(g=>g.matchUpId===i)||{};if(!((m=a==null?void 0:a.schedule)!=null&&m.courtId))return;let o;const s=n.getData().find(g=>(o=Object.keys(g).find(v=>{if(fc(g[v]))return g[v].matchUpId===i}),o)),{courtId:l,courtOrder:u,venueId:c}=a.schedule;s[o]={schedule:{courtOrder:u,courtId:l,venueId:c}},n.updateData([s]),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:q$,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId}}];yt({methods:p,engine:$M,callback:g=>!g.success&&console.log({result:g})}),a.schedule=d;const h=CS(a);e.addRow(h,!0),eA(n)}const{SINGLES:mJe,DOUBLES:gJe}=ko;function vJe({scheduledDate:t}={}){let e=t,i,n,r;function a(d){const p=d.getElement(),h=d.getData().matchUp.matchUpId;p.id=h,p.addEventListener("dragstart",m=>gSe(m,!0)),p.draggable=!0}function o({scheduledDate:d}){var m;const p=((m=Mg.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:ao.upcomingMatchUpStatuses,matchUpTypes:[mJe,gJe]},nextMatchUps:!0}).matchUps)==null?void 0:m.filter(g=>{var v,y;return!((v=g.schedule)!=null&&v.courtId)&&!((y=g.sides)!=null&&y.some(({bye:b})=>b))}))||[],f=d||e;return i=p.filter(g=>{var v;return!((v=g.schedule)!=null&&v.scheduledDate)||g.schedule.scheduledDate===f}),{rowMatchUps:i.map(CS)}}function s({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:f=[]}=o({scheduledDate:d});r&&r.replaceData(f)},n?0:1e3),{unscheduledMatchUps:i}}const l=pJe(i);mf({anchorId:Rv});const u=document.getElementById(Rv),{rowMatchUps:c=[]}=o({scheduledDate:e});return r=new da(u,{placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:c,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=u.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>hJe(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const f=r.getColumns()[0]._getSelf().titleElement;f.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const f=p.getData();console.log({matchUp:f})}),{table:r,replaceTableData:s,unscheduledMatchUps:i}}function u8(t,e){return t?Wt.dateTime.convertTime(t,e):""}function yJe(t){const e=u8(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function jZ(t){return t.toString()[1]?t:"0"+t}function bJe(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*(60*60))/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${jZ(i)}:${jZ(n)}`}function GZ(t,e,i,n){return new(i||(i=Promise))(function(r,a){function o(u){try{l(n.next(u))}catch(c){a(c)}}function s(u){try{l(n.throw(u))}catch(c){a(c)}}function l(u){var c;u.done?r(u.value):(c=u.value,c instanceof i?c:new i(function(d){d(c)})).then(o,s)}l((n=n.apply(t,e||[])).next())})}const HZ=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:a,top:o}=e.getBoundingClientRect();let s={x:0,y:0};if(i===void 0)s={x:n-a,y:r-o};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:u}=i[0];s={x:l-a,y:u-o}}return Object.keys(s).length!==0||s.constructor!==Object?s:void 0},Bi=(t,e)=>!!t&&t.classList.contains(e),Ju=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},_F=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),AC=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(t)+n),kF=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(e)-n).reverse(),_C=t=>{t&&typeof t=="function"&&t()},OF=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,n=>` ${n}`),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},mu=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[f,h]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:f,type:h}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:f}=i;let h=d;if(d||(h=new Date),f&&n){const[v,y]=new Date(h).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[b,I]=y.split(" ");return{hour:v,minutes:b,type:I}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(h).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[b,I]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:b,type:I}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[a,o]=r.split(" "),[s,l]=a.split(":");if(/[a-z]/i.test(a))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!o)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||o!=="AM"&&o!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${o}.`,currentLength:r.length,currentType:o}}let u=Number(l);const c=Number(s);return u<10?u=`0${u}`:u===0&&(u="00"),e==="12h"?c>12||u>59||u<0||c===0||o!=="AM"&&o!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${c}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(u)} or invalid type (PM or AM), currentType: ${o}.`,currentHour:c,currentMin:u,currentType:o}:{hour:c<10?`0${c}`:c.toString(),minutes:u.toString(),type:o}:c<0||c>23||u>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${c}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(u)}`,currentHour:c,currentMin:u}:{hour:c<10?`0${c}`:c.toString(),minutes:u.toString()}},Im=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},kC=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(r=>Im(r,e,i)).some(r=>r===!1);if(typeof t=="string"||typeof t=="number"){const r=Im(t,e,i),a=n==null?void 0:n.map(Number).includes(Number(t));return!(!r||a)}}};function $x(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}$x(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);$x(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);$x(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var pT=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;$x(pT);const IJe={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},xF="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",zZ=["00","13","14","15","16","17","18","19","20","21","22","23"],oI=["12","1","2","3","4","5","6","7","8","9","10","11"],iv=["00","05","10","15","20","25","30","35","40","45","50","55"];class Rf{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(a)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,a=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach((o,s)=>{var l,u,c,d,p,f;const h=s*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=o,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((c=(u=this.disabledTime)===null||u===void 0?void 0:u.startMinutes)===null||c===void 0)&&c.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),Bi(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),Bi(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(h)*a-m.offsetWidth+"px",m.style.bottom=r+Math.cos(h)*a-m.offsetHeight+"px",m.appendChild(g),(f=this.tipsWrapper)===null||f===void 0||f.appendChild(m)})},this.updateDisable=i=>{var n,r;const a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),o=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(a),this._removeClasses(o),i!=null&&i.hoursToUpdate&&a&&this._addClassesWithIncludes(a,i.hoursToUpdate),(i==null?void 0:i.minutesToUpdate)&&o){const{actualHour:s,removedEndHour:l,removedStartedHour:u,startMinutes:c,endMinutes:d}=i.minutesToUpdate;l===s&&d.length>0?this._addClassesWithIncludes(o,d):Number(s)>Number(u)&&Number(s)<Number(l)&&this._addClasses(o),u===s&&c.length>0?this._addClassesWithIncludes(o,c):Number(s)>Number(u)&&Number(s)<Number(l)&&this._addClasses(o)}if(i){const{amHours:s,pmHours:l,activeMode:u,startMinutes:c,endMinutes:d,removedAmHour:p,removedPmHour:f,actualHour:h}=i.minutesToUpdate;if(!s||!l)return;a&&(s&&u==="AM"&&this._addClassesWithIncludes(a,s),l&&u==="PM"&&this._addClassesWithIncludes(a,l)),o&&c&&d&&(u==="AM"&&(d[0]==="00"&&d.length===1&&c.length===0&&Number(h)>=Number(s[0])&&this._addClasses(o),c.length===0&&d.length>1&&Number(h)>=Number(p)&&this._addClasses(o),c.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(h)?this._addClassesWithIncludes(o,c):Number(h)>Number(p)&&this._addClasses(o)),d[0]==="00"&&d.length===1&&c.length>0&&(Number(p)===Number(h)?this._addClassesWithIncludes(o,c):Number(h)>Number(p)&&this._addClasses(o))),u==="PM"&&(h<Number(f)&&this._addClasses(o),h===f&&this._addClassesWithIncludes(o,d),d.length>0&&Number(h)===f-1&&this._addClassesWithIncludes(o,d)))}},this._removeClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0})},this._addClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1})},this._addClassesWithIncludes=(i,n)=>{i==null||i.forEach(({classList:r,children:a,textContent:o})=>{n!=null&&n.includes(o)&&(r.add("timepicker-ui-tips-disabled"),a[0].classList.add("timepicker-ui-tips-disabled"),a[0].tabIndex=-1)})},this.array=e==null?void 0:e.array,this.classToAdd=e==null?void 0:e.classToAdd,this.clockFace=e==null?void 0:e.clockFace,this.tipsWrapper=e==null?void 0:e.tipsWrapper,this.theme=e==null?void 0:e.theme,this.clockType=e==null?void 0:e.clockType,this.disabledTime=e==null?void 0:e.disabledTime,this.hour=e==null?void 0:e.hour}}const qZ=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t(...n)},e)}};class wJe{constructor(e,i){var n,r,a;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=o=>{this.create(),this._eventsBundle(),_C(o)},this.close=()=>qZ((...o)=>{var s;if(o.length>2||!this.modalElement)return;const[l]=o.filter(c=>typeof c=="boolean"),[u]=o.filter(c=>typeof c=="function");l&&(this._handleOkButton(),(s=this.okButton)===null||s===void 0||s.click()),this._isTouchMouseMove=!1,xF.split(" ").map(c=>document.removeEventListener(c,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach(c=>c==null?void 0:c.classList.remove("disabled")),setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400),this.openElement.forEach(c=>c==null?void 0:c.classList.remove("disabled")),setTimeout(()=>{var c;this._options.focusInputAfterCloseModal&&((c=this.input)===null||c===void 0||c.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)},300),_C(u)},this._options.delayHandler||300),this.destroy=o=>{xF.split(" ").map(s=>document.removeEventListener(s,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&_C(o),this._element=this._cloned},this.update=(o,s)=>{this._options=Object.assign(Object.assign({},this._options),o.options),this._checkMobileOption(),o.create&&this.create(),_C(s)},this._preventClockTypeByCurrentTime=()=>{var o,s,l,u,c;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((u=this._options)===null||u===void 0?void 0:u.currentTime)=="boolean"&&(!((c=this._options)===null||c===void 0)&&c.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:f}=mu(this.input,p,d,!0);this._options.clockType=f?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var o,s,l,u,c;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.updateInput)||typeof((u=this._options)===null||u===void 0?void 0:u.currentTime)=="boolean"&&(!((c=this._options)===null||c===void 0)&&c.currentTime)){const{hour:d,minutes:p,type:f}=mu(this.input,this._options.clockType,this._options.currentTime);this.input.value=f?`${d}:${p} ${f}`:`${d}:${p}`}},this._setTheme=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div"),u=[...(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("input"),...l],{theme:c}=this._options;c==="crane-straight"?u.forEach(d=>d.classList.add("crane-straight")):c==="crane-radius"?u.forEach(d=>d.classList.add("crane-straight","radius")):c==="m3"&&u.forEach(d=>d.classList.add("m3"))},this._setInputClassToInputElement=()=>{var o;Bi(this.input,"timepicker-ui-input")||(o=this.input)===null||o===void 0||o.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var o;this.openElementData===null&&((o=this.input)===null||o===void 0||o.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach(o=>o==null?void 0:o.classList.add("timepicker-ui-open-element"))},this._removeBackdrop=()=>{var o;this._options.backdrop||((o=this.modalElement)===null||o===void 0||o.classList.add("removed"),this.openElement.forEach(s=>s==null?void 0:s.classList.add("disabled")))},this._setNormalizeClass=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div");(s=this.modalElement)===null||s===void 0||s.classList.add("timepicker-ui-normalize"),l==null||l.forEach(u=>u.classList.add("timepicker-ui-normalize"))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var o,s,l,u,c,d,p,f,h,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach(b=>b==null?void 0:b.classList.add("disabled")),(o=this.input)===null||o===void 0||o.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const b=new Rf({array:oI,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(u=this._disabledTime)===null||u===void 0?void 0:u.value.rangeArrHour:(d=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});b.create(),this._options.clockType==="24h"?new Rf({array:zZ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((f=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||f===void 0)&&f.isInterval?(h=this._disabledTime)===null||h===void 0?void 0:h.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout(()=>{var I,T,w,S,U,P,E,D;((I=this._disabledTime)===null||I===void 0?void 0:I.value.startType)===((T=this.activeTypeMode)===null||T===void 0?void 0:T.textContent)&&b.updateDisable({hoursToUpdate:(S=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||S===void 0?void 0:S.rangeArrHour,minutesToUpdate:{endMinutes:(U=this._disabledTime)===null||U===void 0?void 0:U.value.endMinutes,removedEndHour:(P=this._disabledTime)===null||P===void 0?void 0:P.value.removedEndHour,removedStartedHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(D=this._disabledTime)===null||D===void 0?void 0:D.value.startMinutes}})},300):setTimeout(()=>{var I,T,w;b.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(I=this._disabledTime)===null||I===void 0?void 0:I.value.pmHours,amHours:(T=this._disabledTime)===null||T===void 0?void 0:T.value.amHours,activeMode:(w=this.activeTypeMode)===null||w===void 0?void 0:w.textContent}})},300),b.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this._setTheme()},0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach(o=>this._clickTouchEvents.forEach(s=>o==null?void 0:o.addEventListener(s,()=>this._eventsBundle())))},this._getInputValueOnOpenAndSet=()=>{var o,s;const l=mu(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",Ju(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[u,c,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(u=l.hour,c=l.minutes,d=l.type),this.hour.value=u,this.minutes.value=c;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),Ju(this._element,"show",Object.assign(Object.assign({},l),{type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach(o=>{this.cancelButton.addEventListener(o,()=>{var s;const l=mu(this.input,this._options.clockType);Ju(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})})},this._handleOkButton=()=>{this._clickTouchEvents.forEach(o=>{var s;(s=this.okButton)===null||s===void 0||s.addEventListener(o,()=>{var l,u,c;const{clockType:d,disabledTime:p}=this._options,f=Im(this.hour.value,"hour",d),h=Im(this.minutes.value,"minutes",d);let m;const g=kC(this.hour.value,"hour",d,p==null?void 0:p.hours),v=kC(this.minutes.value,"minutes",d,p==null?void 0:p.minutes);if(p!=null&&p.interval&&(m=((y,b,I,T)=>{const w=I?OF(`${y}:${b} ${I}`.trim()):`${y}:${b}`.trim();let S,U;if(I){const[P,E]=T.trim().split("-").map(D=>D.trim());S=OF(P),U=OF(E)}else{const[P,E]=T.trim().split("-"),D=R=>R.trim().split(":").map(N=>Number(N)<=9?`0${Number(N)}`:N).join(":");S=D(P),U=D(E)}return w<S||w>U})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||f===!1||h===!1||g===!1||v===!1)return m!==!1&&h&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&f&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type}`.trimEnd(),Ju(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()})})},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout(()=>{this.modalElement.classList.add("show")},300)},this._handleBackdropClick=()=>{var o;(o=this.modalElement)===null||o===void 0||o.addEventListener("click",s=>{var l;const u=s.target;if(!Bi(u,"timepicker-ui-modal"))return;const c=mu(this.input,this._options.clockType);Ju(this._element,"cancel",Object.assign(Object.assign({},c),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:o,theme:s}=this._options;o||this.circle===null||(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?pT.cranered400:pT.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:o}=this._options;this.minutes.value&&iv.includes(this.minutes.value)&&(this.circle.style.backgroundColor=o==="crane-straight"||o==="crane-radius"?pT.cranered400:pT.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&iv.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var o;(o=this._element)===null||o===void 0||o.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var o;this._options.mobile||this._isMobileView||(o=this.hour)===null||o===void 0||o.classList.add("active")},this._setMinutesToClock=o=>{var s,l,u,c,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(o),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.minutes?(c=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||c===void 0?void 0:c.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,f=new Rf({array:iv,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});f.create(),this._options.clockType==="12h"&&f.updateDisable(),this._toggleClassActiveToValueTips(o),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=o=>{var s,l,u,c,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(o),this._setBgColorToCirleWithHourTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(u=this._disabledTime)===null||u===void 0?void 0:u.value.rangeArrHour:(d=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||d===void 0?void 0:d.hours,f=new Rf({array:oI,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});f.create(),this._options.clockType==="24h"?new Rf({array:zZ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():f.updateDisable(),this._toggleClassActiveToValueTips(o)}},this._setTransformToCircleWithSwitchesHour=o=>{const s=Number(o);let l=s>12?30*s-360:30*s;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=o=>{const s=6*Number(o);s>360||(this.clockHand.style.transform=`rotateZ(${s}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach(o=>{this.AM.addEventListener(o,s=>{var l,u,c,d;if(s.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Rf({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Bi(this.hour,"active")?oI:iv});((u=this._disabledTime)===null||u===void 0?void 0:u.value.startType)===((c=this._disabledTime)===null||c===void 0?void 0:c.value.endType)?setTimeout(()=>{var f,h,m,g;((f=this._disabledTime)===null||f===void 0?void 0:f.value.startType)===((h=this.activeTypeMode)===null||h===void 0?void 0:h.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300),p.updateDisable()}Ju(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handlePmClick=()=>{this._clickTouchEvents.forEach(o=>{this.PM.addEventListener(o,s=>{var l,u,c,d;if(s.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new Rf({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Bi(this.hour,"active")?oI:iv});((u=this._disabledTime)===null||u===void 0?void 0:u.value.startType)===((c=this._disabledTime)===null||c===void 0?void 0:c.value.endType)?setTimeout(()=>{var f,h,m,g;((f=this._disabledTime)===null||f===void 0?void 0:f.value.startType)===((h=this.activeTypeMode)===null||h===void 0?void 0:h.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Ju(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handleAnimationClock=()=>{this._options.animation&&setTimeout(()=>{var o;(o=this.clockFace)===null||o===void 0||o.classList.add("timepicker-ui-clock-animation"),setTimeout(()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.remove("timepicker-ui-clock-animation")},600)},150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout(()=>{var o;(o=this.clockHand)===null||o===void 0||o.classList.remove("timepicker-ui-tips-animation")},401)},this._handleClasses24h=(o,s)=>{var l;const u=o.target;this.hourTips&&this._options.clockType==="24h"&&(Number(u.textContent)>12||Number(u.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),u&&s&&(s.value=u.value.replace(/\D+/g,""),s.click())},this._handleHourEvents=()=>{var o,s;this._inputEvents.forEach(l=>{var u;(u=this.hour)===null||u===void 0||u.addEventListener(l,c=>{var d,p,f,h,m;const g=c.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Rf({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Bi(this.hour,"active")?oI:iv});((f=this._disabledTime)===null||f===void 0?void 0:f.value.startType)===((h=this._disabledTime)===null||h===void 0?void 0:h.value.endType)?setTimeout(()=>{var y,b,I,T;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Ju(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")})}),(o=this.hour)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.hour)),(s=this.hour)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.hour))},this._handleMinutesEvents=()=>{var o,s;this._inputEvents.forEach(l=>{this.minutes.addEventListener(l,u=>{var c,d,p,f,h,m;const g=u.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(c=this.tipsWrapperFor24h)===null||c===void 0||c.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new Rf({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Bi(this.hour,"active")?oI:iv});((f=this._disabledTime)===null||f===void 0?void 0:f.value.startType)===((h=this._disabledTime)===null||h===void 0?void 0:h.value.endType)?setTimeout(()=>{var y,b,I;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(I=this._disabledTime)===null||I===void 0?void 0:I.value.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Ju(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})}),(o=this.minutes)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.minutes)),(s=this.minutes)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.minutes))},this._handleEventToMoveHand=o=>{var s,l,u,c,d,p,f,h,m,g,v,y,b,I,T,w,S,U,P,E,D,R,N,M,A,_,k,B,F,x,$,j,V,H,z,q,W,Y,Z,X,Q,ce,J,ee,ne,ie,oe,se,pe,fe,ge,me,Ee,Be,Pe,et,Ie,Ne,be,Le,Me,Ze;const{target:qe,type:ye,touches:_e}=o,Ae=qe,{incrementMinutes:Ve,incrementHours:Ke,switchToMinutesAfterSelectHour:he}=this._options;if(!HZ(o,this.clockFace))return;const ve=HZ(o,this.clockFace),Ce=this.clockFace.offsetWidth/2,De=ve&&Math.atan2(ve.y-Ce,ve.x-Ce);if(ye==="mouseup"||ye==="touchend")return this._isTouchMouseMove=!1,void(he&&(Bi(Ae,"timepicker-ui-value-tips")||Bi(Ae,"timepicker-ui-value-tips-24h")||Bi(Ae,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(ye!=="mousedown"&&ye!=="mousemove"&&ye!=="touchmove"&&ye!=="touchstart"||ye!=="mousedown"&&ye!=="touchstart"&&ye!=="touchmove"||((Bi(Ae,"timepicker-ui-clock-face")||Bi(Ae,"timepicker-ui-circle-hand")||Bi(Ae,"timepicker-ui-hour-time-12")||Bi(Ae,"timepicker-ui-minutes-time")||Bi(Ae,"timepicker-ui-clock-hand")||Bi(Ae,"timepicker-ui-value-tips")||Bi(Ae,"timepicker-ui-value-tips-24h")||Bi(Ae,"timepicker-ui-tips-wrapper")||Bi(Ae,"timepicker-ui-tips-wrapper-24h"))&&!Bi(Ae,"timepicker-ui-tips-disabled")?(o.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let je,ke=De&&_F(Math.trunc(180*De/Math.PI)+90,Ve,6);if(ke===void 0)return;if(ke<0?(je=Math.round(360+ke/6)%60,ke=360+6*Math.round(ke/6)):(je=Math.round(ke/6)%60,ke=6*Math.round(ke/6)),(s=this._disabledTime)===null||s===void 0?void 0:s.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(h=(f=this._disabledTime)===null||f===void 0?void 0:f.value)===null||h===void 0?void 0:h.endMinutes)===null||m===void 0)&&m.includes(je<=9?`0${je}`:`${je}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)||!((w=(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.startMinutes)===null||w===void 0)&&w.includes(je<=9?`0${je}`:`${je}`)&&this.hour.value===((U=(S=this._disabledTime)===null||S===void 0?void 0:S.value)===null||U===void 0?void 0:U.removedStartedHour)&&((P=this._disabledTime)===null||P===void 0?void 0:P.value.startType)===((E=this.activeTypeMode)===null||E===void 0?void 0:E.textContent))return}else if(((D=this.activeTypeMode)===null||D===void 0?void 0:D.textContent)===((R=this._disabledTime)===null||R===void 0?void 0:R.value.endType)&&(!((A=(M=(N=this._disabledTime)===null||N===void 0?void 0:N.value)===null||M===void 0?void 0:M.endMinutes)===null||A===void 0)&&A.includes(je<=9?`0${je}`:`${je}`)&&((_=this._disabledTime)===null||_===void 0?void 0:_.value.removedPmHour)===this.hour.value||!((k=this._disabledTime)===null||k===void 0)&&k.value.pmHours.map(Number).includes(Number(this.hour.value)))||((B=this.activeTypeMode)===null||B===void 0?void 0:B.textContent)===((F=this._disabledTime)===null||F===void 0?void 0:F.value.startType)&&(!((j=($=(x=this._disabledTime)===null||x===void 0?void 0:x.value)===null||$===void 0?void 0:$.startMinutes)===null||j===void 0)&&j.includes(je<=9?`0${je}`:`${je}`)&&((V=this._disabledTime)===null||V===void 0?void 0:V.value.removedAmHour)===this.hour.value||!((H=this._disabledTime)===null||H===void 0)&&H.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((c=(u=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||u===void 0?void 0:u.minutes)===null||c===void 0)&&c.includes(je<=9?`0${je}`:`${je}`))return;this.minutes.value=je>=10?`${je}`:`0${je}`,this.clockHand.style.transform=`rotateZ(${ke}deg)`,this._degreesMinutes=ke,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),Ju(this._element,"update",Object.assign(Object.assign({},mu(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:ye,type:(z=this.activeTypeMode)===null||z===void 0?void 0:z.dataset.type}))}const Ue=_e?_e[0]:void 0,Qe=_e&&Ue?document.elementFromPoint(Ue.clientX,Ue.clientY):null;if(this.hourTips!==null){if((q=this.hour)===null||q===void 0||q.classList.add("active"),!Bi(Qe||Ae,"timepicker-ui-value-tips-24h")&&!Bi(Qe||Ae,"timepicker-ui-tips-disabled")&&(Bi(Qe||Ae,"timepicker-ui-value-tips")||Bi(Qe||Ae,"timepicker-ui-tips-wrapper"))){let je,ke=De&&_F(Math.trunc(180*De/Math.PI)+90,Ke,30);if(this._degreesHours=ke,ke===void 0)return;ke<0?(je=Math.round(360+ke/30)%12,ke=360+ke):(je=Math.round(ke/30)%12,(je===0||je>12)&&(je=12));const bt=!((W=this._disabledTime)===null||W===void 0)&&W.value.isInterval?"rangeArrHour":"hours";if(((Y=this._disabledTime)===null||Y===void 0?void 0:Y.value.endType)===((X=(Z=this._disabledTime)===null||Z===void 0?void 0:Z.value)===null||X===void 0?void 0:X.startType)){if(typeof((ce=(Q=this._disabledTime)===null||Q===void 0?void 0:Q.value)===null||ce===void 0?void 0:ce.endType)=="string"){if(((ee=(J=this._disabledTime)===null||J===void 0?void 0:J.value)===null||ee===void 0?void 0:ee.endType)===((ne=this.activeTypeMode)===null||ne===void 0?void 0:ne.textContent)&&((oe=(ie=this._disabledTime)===null||ie===void 0?void 0:ie.value)===null||oe===void 0?void 0:oe.startType)===((se=this.activeTypeMode)===null||se===void 0?void 0:se.textContent)&&(!((fe=(pe=this._disabledTime)===null||pe===void 0?void 0:pe.value[bt])===null||fe===void 0)&&fe.includes(je.toString())))return}else if(!((me=(ge=this._disabledTime)===null||ge===void 0?void 0:ge.value[bt])===null||me===void 0)&&me.includes(je.toString()))return}else if(((Ee=this._disabledTime)===null||Ee===void 0?void 0:Ee.value.startType)===((Be=this.activeTypeMode)===null||Be===void 0?void 0:Be.textContent)&&(!((Pe=this._disabledTime)===null||Pe===void 0)&&Pe.value.amHours.includes(je.toString()))||((et=this._disabledTime)===null||et===void 0?void 0:et.value.endType)===((Ie=this.activeTypeMode)===null||Ie===void 0?void 0:Ie.textContent)&&(!((Ne=this._disabledTime)===null||Ne===void 0)&&Ne.value.pmHours.includes(je.toString())))return;this.clockHand.style.transform=`rotateZ(${ke}deg)`,this.hour.value=je>9?`${je}`:`0${je}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(je)}if((Bi(Qe||Ae,"timepicker-ui-value-tips-24h")||Bi(Qe||Ae,"timepicker-ui-tips-wrapper-24h"))&&!Bi(Qe||Ae,"timepicker-ui-tips-disabled")){let je,ke=De&&_F(Math.trunc(180*De/Math.PI)+90,Ke,30);if(this._degreesHours=ke,ke===void 0)return;ke<0?(je=Math.round(360+ke/30)%24,ke=360+ke):(je=Math.round(ke/30)+12,je===12&&(je="00"));const bt=!((be=this._disabledTime)===null||be===void 0)&&be.value.isInterval?"rangeArrHour":"hours";if(!((Me=(Le=this._disabledTime)===null||Le===void 0?void 0:Le.value[bt])===null||Me===void 0)&&Me.includes(je.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${ke}deg)`,this.hour.value=`${je}`,this._toggleClassActiveToValueTips(je)}Ju(this._element,"update",Object.assign(Object.assign({},mu(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:ye,type:(Ze=this.activeTypeMode)===null||Ze===void 0?void 0:Ze.dataset.type}))}},this._toggleClassActiveToValueTips=o=>{const s=this.allValueTips.find(l=>Number(l.innerText)===Number(o));this.allValueTips.map(l=>l.classList.remove("active")),s!==void 0&&s.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||xF.split(" ").forEach(o=>{o==="touchstart"||o==="touchmove"||o==="touchend"?document.addEventListener(o,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(o,this._mutliEventsMoveHandler,!1)})},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:o}=this._options;if(o!==""&&o){const s=document==null?void 0:document.querySelector(o);s==null||s.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400):(document.body.style.paddingRight=`${(()=>{const o=document.createElement("div");o.className="timepicker-ui-measure",document.body.appendChild(o);const s=o.getBoundingClientRect().width-o.clientWidth;return document.body.removeChild(o),s})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var o,s;(o=this.modalElement)===null||o===void 0||o.classList.add("opacity"),this._options.animation?setTimeout(()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")},150):(s=this.modalElement)===null||s===void 0||s.classList.add("show")},this._removeAnimationToClose=()=>{var o;this.modalElement&&(this._options.animation?setTimeout(()=>{var s;(s=this.modalElement)===null||s===void 0||s.classList.remove("show")},150):(o=this.modalElement)===null||o===void 0||o.classList.remove("show"))},this._handlerViewChange=()=>qZ(()=>{var o,s,l,u;const{clockType:c}=this._options;if(Bi(this.modalElement,"mobile")){const d=Im(this.hour.value,"hour",c),p=Im(this.minutes.value,"minutes",c);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(s=this.hour)===null||s===void 0||s.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const f=this.hour.value,h=this.minutes.value,m=(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout(()=>{if(this.open(),this.hour.value=f,this.minutes.value=h,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()},300)},300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,f=(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout(()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const h=f==="PM"?"AM":"PM";this[f==="PM"?"PM":"AM"].classList.add("active"),this[h].classList.remove("active")}},300)},300)}},this._options.delayHandler||300),this._handleIconChangeView=()=>GZ(this,void 0,void 0,function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))}),this._handlerClickHourMinutes=o=>GZ(this,void 0,void 0,function*(){var s,l;if(!this.modalElement)return;const{clockType:u,editable:c}=this._options,d=o.target,p=Im(this.hour.value,"hour",u),f=Im(this.minutes.value,"minutes",u);c&&(Bi(d,"timepicker-ui-hour")||Bi(d,"timepicker-ui-minutes")?p!==!1&&f!==!1||(f||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&f===!0&&(f&&this.minutes.classList.remove("invalid-value"),p&&((s=this.hour)===null||s===void 0||s.classList.remove("invalid-value"))))}),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=o=>{o.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout(()=>{var o,s;const l=(o=this.wrapper)===null||o===void 0?void 0:o.querySelectorAll('div[tabindex="0"]:not([disabled])'),u=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||u.length<=0)return;const c=[...u,...l],d=c[0],p=c[c.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",({key:f,shiftKey:h,target:m})=>{const g=m;if(f==="Tab"&&(h?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),f==="Enter"&&(Bi(g,"timepicker-ui-minutes")&&this.minutes.click(),Bi(g,"timepicker-ui-hour")&&this.hour.click(),Bi(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),Bi(g,"timepicker-ui-ok-btn")&&this.okButton.click(),Bi(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),Bi(g,"timepicker-ui-am")&&this.AM.click(),Bi(g,"timepicker-ui-pm")&&this.PM.click(),Bi(g,"timepicker-ui-value-tips")||Bi(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:b,y:I,width:T,height:w}=g.getBoundingClientRect(),S=document.elementFromPoint(b,I);(()=>{var P;const E=new MouseEvent("mousedown",{clientX:v+T/2,clientY:y+w/2,cancelable:!0,bubbles:!0});Bi(S,"timepicker-ui-value-tips-24h")?S==null||S.dispatchEvent(E):(P=S==null?void 0:S.childNodes[0])===null||P===void 0||P.dispatchEvent(E),this._isTouchMouseMove=!1})()}setTimeout(()=>{this.wrapper.addEventListener("mousedown",()=>document.activeElement.blur())},100)})},301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",({target:o,key:s})=>{o.disabled||s==="Enter"&&this.open()})},this._element=e,this._cloned=null,this._options=((o,s)=>Object.assign(Object.assign({},s),o))(Object.assign(Object.assign({},i),(o=>{if(!o)return;const s=JSON.parse(JSON.stringify(o)),l=Object.keys(s);return Object.values(s).reduce((u,c,d)=>(Number(c)?u[l[d]]=Number(c):u[l[d]]=c==="true"||c==="false"?JSON.parse(c):c,u),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),IJe),this._isTouchMouseMove=!1,this._degreesHours=30*Number(mu((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(mu((a=this._element)===null||a===void 0?void 0:a.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=o=>this._handleEventToMoveHand(o),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=o=>this._handlerClickHourMinutes(o),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:a,okLabel:o,iconTemplateMobile:s,minuteMobileLabel:l,hourMobileLabel:u,enableSwitchIcon:c,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${u}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${c?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${s}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${o}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:a,cancelLabel:o,okLabel:s,enableSwitchIcon:l,animation:u,clockType:c,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${u?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${c==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${c==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${c!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${a}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${c==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${o}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if((i==null?void 0:i.length)>0){const n=[];return i.forEach(({dataset:r})=>{var a;return n.push((a=r.open)!==null&&a!==void 0?a:"")}),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map(n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)})[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||kC(e,"hour",n),a=!i||kC(i,"minutes",n);if(!r||!a)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:a,minutes:o}=i;if(a){delete i.hours,delete i.minutes;const[s,l]=a.toString().split("-"),{hour:u,minutes:c,type:d}=mu({value:s.trimEnd()},n),{hour:p,minutes:f,type:h}=mu({value:l.trimEnd().trimStart()},n);let m=AC(u,p).map(b=>b==="00"||Number(b)===0?`0${Number(b)}`:`${Number(b)}`);const g=[],v=Number(c),y=Number(f);if(h===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:AC(c,59).map(b=>Number(b)<=9?`0${b}`:`${b}`),endMinutes:kF(0,f).map(b=>Number(b)<=9?`0${b}`:`${b}`),endType:h,startType:d}};{const b=AC(u,12).map(String),I=kF(1,p).map(String),T=[],w=[];return v>0&&y<=0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y<59&&y>0&&v<=0?(w.push(b[0]),T.push(I[I.length-1]),I.splice(-1,1)):y>0&&v>0?(T.push(I[I.length-1]),w.push(b[0]),I.splice(-1,1),b.splice(0,1)):y===0&&v===0&&(T.push(I[I.length-1]),w.push(b[0]),I.pop()),{value:{isInterval:!0,endType:h,startType:d,pmHours:I,amHours:b,startMinutes:Number(c)===0?[]:AC(c,59).map(S=>Number(S)<=9?`0${S}`:`${S}`),endMinutes:kF(0,f).map(S=>Number(S)<=9?`0${S}`:`${S}`),removedAmHour:Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:Number(T[0])<=9?`0${T[0]}`:T[0]}}}}return r==null||r.forEach(s=>{if(n==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),o==null||o.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r==null?void 0:r.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:o==null?void 0:o.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:u}=mu(this.input,this._options.clockType);if(a){const c=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),c.classList.add("timepicker-ui-invalid-text"),c.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(c)),Ju(this._element,"geterror",{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:u}),new Error(`Invalid Time Format: ${a}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=mu(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:a,startMinutes:o,pmHours:s,amHours:l,removedAmHour:u,removedPmHour:c}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:s,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:o,endMinutes:n,removedAmHour:u,removedPmHour:c}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:a,actualHour:this.hour.value,startMinutes:o}}}}function SJe({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=TJe(t);const a=new wJe(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});a.create(),a.open(),n.addEventListener("accept",()=>{const o=r.value;rt(i)&&i({time:o}),a.destroy()})}function TJe(t,e){var n;let i=UJe(t||((n=e==null?void 0:e.schedule)==null?void 0:n.default_time));return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function UJe(t){t=t||"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t&&t.split(" ")||"",{0:i.hours,1:i.minutes}=e.time&&e.time.split(":")||"",i.ampm=e.ampm,i}const{AFTER_REST:WZ,FOLLOWED_BY:KZ,NEXT_AVAILABLE:YZ,NOT_BEFORE:ZZ,TO_BE_ANNOUNCED:XZ}=s_;function vSe({e:t,cell:e,callback:i,matchUpId:n}={}){const r=e.getRow().getData(),a=f=>{const h=Object.values(r).filter(y=>y==null?void 0:y.matchUpId),g=[{params:{matchUpIds:n?[n]:h.map(({matchUpId:y})=>y),schedule:f},method:_we}];yt({methods:g,callback:y=>{y.success&&rt(i)&&i(f)}})},o=()=>a({scheduledTime:"",timeModifiers:[]}),s=({time:f})=>{const m=Wt.dateTime.convertTime(f,!0);a({scheduledTime:m})},l=()=>{const h=e.getTable().getData();let m;const g=h.flatMap((I,T)=>{if(!m&&!(I.rowId===r.rowId&&(m=T+1,T)))return Object.values(I).flatMap(w=>{var S;return(S=w==null?void 0:w.schedule)==null?void 0:S.scheduledTime})}).filter(Boolean).map(yJe),v=Math.max(...g,0),y=m>1,b=v&&bJe(v,y)||"8:00 AM";SJe({time:b,callback:s})},u=f=>a({timeModifiers:[f]}),d=[{option:n?"Set match time":"Set match times",onClick:l},{option:BS[KZ],onClick:()=>u(KZ)},{option:BS[YZ],onClick:()=>u(YZ)},{option:BS[ZZ],onClick:()=>u(ZZ)},{option:BS[WZ],onClick:()=>u(WZ)},{option:BS[XZ],onClick:()=>u(XZ)},{option:"Clear time settings",onClick:o}],p=t.target;Ps({options:d,target:p,config:{placement:mt}})}function DJe({courtInfo:t}){yn({title:"Rename Court",content:n=>Wn(n,[{value:t.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:n})=>{const r=n==null?void 0:n.courtName.value;r&&r!==t.courtName&&console.log({newValue:r})},close:!0}]})}function PJe(t,e,i){const r=[{option:`${Lr.tr("remove")} court identifiers`,onClick:o},{option:Lr.tr("rename"),onClick:()=>DJe({courtInfo:i})}],a=t.target;Ps({options:r,target:a});function o(){console.log("toggle court identifiers",{cell:e})}}function EJe(t,e){t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=e.getTable(),r=n.getData(),a=e.getRow().getData();let o=n.getData().flatMap(P=>Object.values(P).filter(E=>E.matchUpId)),s=o.find(P=>P.matchUpId===i);s||(s=da.findTable(`#${Rv}`)[0].getData().map(D=>D.matchUp).find(D=>D.matchUpId===i)||{});const l=document.getElementById(Mue).value,{courtOrder:u,courtId:c,venueId:d}=s.schedule||{},p=t.currentTarget,f=p.id;if(i===f)return;const h=s.schedule,m=f&&o.find(P=>P.matchUpId===f),g=p.getAttribute("venueId"),v=p.getAttribute("courtId"),y=p.getAttribute("courtOrder"),b=Object.keys(a).find(P=>{var M;if(!fc(a[P]))return;const E=((M=a[P])==null?void 0:M.schedule)||{},{courtOrder:D,courtId:R,venueId:N}=E;return(D==null?void 0:D.toString())===y.toString()&&N===g&&R===v});let I;const T=r.find(P=>(I=Object.keys(P).find(E=>{var A;if(!fc(P[E]))return;const D=((A=P[E])==null?void 0:A.schedule)||{},{courtOrder:R,courtId:N,venueId:M}=D;return R===u&&M===d&&N===c}),I)),w=({scheduledTime:P="",timeModifiers:E=[]}={})=>{const D={courtOrder:y,scheduledDate:l,venueId:g,courtId:v,scheduledTime:P,timeModifiers:E},R=[{method:q$,params:{tournamentId:s==null?void 0:s.tournamentId,matchUpId:s==null?void 0:s.matchUpId,schedule:D,drawId:s==null?void 0:s.drawId}}];yt({methods:R,engine:$M,callback:M=>!M.success&&console.log({result:M})}),s.schedule=D},S={scheduledDate:h==null?void 0:h.scheduledDate,scheduledTime:h==null?void 0:h.scheduledTime,timeModifiers:h==null?void 0:h.timeModifiers,courtOrder:u,venueId:d,courtId:c},U=()=>{const P=[{method:q$,params:{tournamentId:m==null?void 0:m.tournamentId,matchUpId:m==null?void 0:m.matchUpId,schedule:S,drawId:m==null?void 0:m.drawId}}];yt({methods:P,engine:$M,callback:D=>!D.success&&console.log({result:D})}),m?m.schedule=S:console.log("missing targetMatchUp")};if(f==="")T?(w(),T[I]={schedule:{courtOrder:u,venueId:d,courtId:c}},T.rowId==a.rowId?(T[b]=s,n.updateData([T])):(a[b]=s,n.updateData([T,a]))):(da.findTable(`#${Rv}`)[0].deleteRow(i),w(),a[b]=s,n.updateData([a]));else if(!T&&m){const P=da.findTable(`#${Rv}`)[0];P.deleteRow(i),w(),a[b]=s,n.updateData([a]),P.addRow(CS(m),!0),U()}else{const P=m==null?void 0:m.schedule;w({scheduledTime:P==null?void 0:P.scheduledTime,timeModifiers:P==null?void 0:P.timeModifiers}),U(),T.rowId==a.rowId?(T[I]=m,T[b]=s,n.updateData([T])):(T[I]=m,a[b]=s,n.updateData([T,a]))}eA(n)}const{SCHEDULE_STATE:CJe,SCHEDULE_ERROR:RJe,SCHEDULE_WARNING:MJe,SCHEDULE_CONFLICT:NJe}=ao.scheduleConstants;function ySe(t){var N;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:a="",roundName:o="",schedule:s={},matchUpStatus:l,winningSide:u,matchUpId:c,sides:d}=n||{},{courtOrder:p="",scheduledTime:f="",courtId:h="",timeModifiers:m,venueId:g=""}=s;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",h),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=M=>M.preventDefault(),c)if(e.draggable=!0,e.id=c,u)e.classList.add("matchup-complete");else{const M=s[CJe];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):M===NJe?e.classList.add("matchup-conflict"):M===Cue?e.classList.add("matchup-issue"):M===MJe?e.classList.add("matchup-warning"):M===RJe&&e.classList.add("matchup-error")}if(e.addEventListener("drop",M=>EJe(M,t)),e.addEventListener("dragstart",gSe),!c)return e;const v=`${a} ${o}`,y=M=>{var A,_;return((_=(A=M.person)==null?void 0:A.standardFamilyName)==null?void 0:_.toUpperCase())||M.participantName},b=r==null?void 0:r.map(M=>M==null?void 0:M.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=M=>{var _,k;const A=(k=(_=d==null?void 0:d.find(B=>M===B.sideNumber))==null?void 0:_.participant)==null?void 0:k.participantName;if(A)return u===M?`<span style='font-weight: bold'>${A}</span>`:A},T=I(1)||(b==null?void 0:b.shift())||"Unkown",w=I(2)||(b==null?void 0:b.shift())||"Unknown";e.id=c;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=((m==null?void 0:m[0])&&lxe[m[0]]+"&nbsp;"||"")+u8(f),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=v,e.appendChild(U);const P=document.createElement("div");P.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style="font-size: 1em",E.innerHTML=T,P.appendChild(E);const D=document.createElement("div");D.className="divider",D.innerHTML="vs.",P.appendChild(D);const R=document.createElement("div");if(R.className="scheduled_team",R.style="font-size: 1em",R.innerHTML=w,P.appendChild(R),u){const M=document.createElement("div");M.innerHTML=((N=n.score)==null?void 0:N.scoreStringSide1)||"",P.appendChild(M)}return e.appendChild(P),e}function AJe({values:t,valueChange:e,isValid:i}){const n=(o,s)=>l=>l.length>=o&&(!s||s&&l.length<=s),r=o=>!isNaN(o),a=o=>e(o);return[{error:"Please enter a name of at least 5 characters",placeholder:"Venue name",value:t.venueName||"",validator:n(5),label:"Venue name",field:"venueName",focus:!0,onChange:a},{error:"Please enter an abbreviation of 2-6 characters",value:t.venueAbbreviation||"",validator:n(2,6),field:"venueAbbreviation",label:"Abbreviation",onChange:a},{error:"Must be a whole number",value:t.courtsCount||"",validator:r,label:"Number of courts",field:"courtsCount",onChange:a}]}function _Je(t){return{venueAbbreviation:t==null?void 0:t.venueAbbreviation.value,courtsCount:t==null?void 0:t.courtsCount.value,venueName:t==null?void 0:t.venueName.value}}const kJe=t=>{const e=_Je(ze.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,a=Wt.UUID();if(!i||!n||!r){Mt({message:"Invalid values",intent:"is-danger"});return}const o=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:a},returnDetails:!0},method:a8e},{params:{courtsCount:parseInt(r),venueId:a,venueAbbreviationRoot:!0},method:K6e}];yt({methods:o,callback:l=>{if(l!=null&&l.success&&rt(t)){const{venue:u}=$e.findVenue({venueId:a});u&&t({...l,venue:u})}}})};function bSe(t){const e=()=>{},i=s=>s&&!isNaN(s),n=({inputs:s})=>{const l=!!(ur(2,6)(s.venueAbbreviation.value)&&i(s.courtsCount.value)&&ur(5)(s.venueName.value)),u=document.getElementById("addVenue");u&&(u.disabled=!l)},r=[{control:"venueAbbreviation",onInput:n},{control:"courtsCount",onInput:n},{control:"venueName",onInput:n}],a=s=>Wn(s,AJe({values:{},valueChange:e}),r),o=(s,l)=>Ob(s,[{label:"Cancel",close:!0},{onClick:()=>kJe(t),intent:"is-info",disabled:!0,id:"addVenue",label:"Save",close:!0}],l);ze.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:mt,content:a,footer:o})}function OJe({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),bSe(ISe)},n=r=>{if(!r)return t!=null&&t.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>"};return e>0?Wt.generateRange(0,e).map(r=>({headerClick:a=>r===0&&i(a),title:n(r),headerHozAlign:Et,formatter:ySe,headerSort:!1,resizable:!1,minWidth:150})):[]}function xJe({notice:t,notes:e,callback:i}){let n;yn({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const s=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:s,notes:l})},close:!0}],content:s=>{n=Wn(s,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:JZ}=s_;function LJe(t,e){var r;const i=e.getRow().getData(),n=Object.values(i).filter(a=>a==null?void 0:a.matchUpId);(r=i.issues)!=null&&r.length&&console.log({issues:i.issues}),n.length&&vSe({e:t,cell:e,rowData:i,callback:o=>{if(fc(o)){const s=e.getTable(),l=s.getData().find(u=>u.rowId===i.rowId);Object.values(l).forEach(u=>{var c;u.matchUpId&&(o.scheduledTime&&(u.schedule.scheduledTime=u8(o.scheduledTime),((c=u.schedule.timeModifiers)==null?void 0:c[0])!==JZ&&(u.schedule.timeModifiers=[])),o.timeModifiers&&(u.schedule.scheduledTime&&o.timeModifiers[0]!==JZ&&(u.schedule.scheduledTime=""),u.schedule.timeModifiers=o.timeModifiers))}),s.updateData([l])}}})}function FJe(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),a=n.getRow().getData();return r.innerHTML=a.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{xJe({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:LJe,headerSort:!1,resizable:!1,hozAlign:Et,frozen:!0,width:55}}function BJe({courtsData:t,courtPrefix:e}){const i=(l,u)=>{const c=u.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=u.getData()[c];vSe({e:l,cell:u,matchUpId:p,callback:()=>{var v,y;const h=(y=(v=$e.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0}))==null?void 0:v.matchUps)==null?void 0:y[0],m=u.getRow().getData();m[c]=h,u.getTable().updateData([m])}})},n=axe-(t==null?void 0:t.length)||0,r=n<=0?1:n,a=OJe({courtsData:t,count:r}),o=FJe(),s=(l,u)=>({headerClick:(c,d)=>PJe(c,d,l),cellClick:i,field:`${e}${u}`,title:l.courtName,headerHozAlign:Et,formatter:ySe,headerSort:!1,resizable:!1,hozAlign:Et,minWidth:150});return[o].concat(t==null?void 0:t.map(s),a)}function $Je({scheduledDate:t}={}){let e,i,n,r=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},f=Mg.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:h=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=f,I=h.concat(...m),T=BJe({courtsData:g,courtPrefix:v});return y==null||y.forEach((w,S)=>{w.rowId=`rowId-${S+1}`,w.rowNumber=S+1}),{rows:y,columns:T,matchUps:I,courtsCount:(g==null?void 0:g.length)??0,courtsData:g,groupInfo:b}},o=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:f,matchUps:h,columns:m,courtsData:g}=a({scheduledDate:d}),v=g==null?void 0:g.map(b=>b.courtId);Wt.intersection(r,v).length===(v==null?void 0:v.length)||(i.setColumns(m),r=v),n=!0,i==null||i.replaceData(f),i.matchUps=h},e?0:1e3)};mf({anchorId:GM});const s=document.getElementById(GM),{rows:l=[],columns:u=[],courtsCount:c}=a({scheduledDate:t});return r=u.map(d=>d==null?void 0:d.courtId).filter(Boolean),i=new da(s,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:u}),i.on("scrollVertical",Pu),i.on("tableBuilt",()=>{eA(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,eA(i))}),{table:i,replaceTableData:o,courtsCount:c}}function VJe({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const a=[{params:{matchUps:n.getData("active").map(s=>s.matchUp),scheduledDate:i},method:v8e}];yt({methods:a,callback:s=>{s.success&&(t(),e())},engine:$M})}function jJe({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const a=Mg.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:o=[],completedMatchUps:s=[]}=a,u=o.concat(...s).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),c=u.filter(({schedule:m})=>m.scheduledDate===t);let d=[{option:"Clear scheduled matches",disabled:!c.length,onClick:h},{option:"Clear all matches",disabled:!c.length,onClick:f},{option:"Clear all days",disabled:!u.length,onClick:p}];d.filter(m=>!m.disabled).length&&Ps({target:e,options:d,config:{placement:tf}});function p(){h({all:!0})}function f(){h({completed:!0})}function h({all:m,completed:g}={}){let v=u.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!n||n===w);g||(v=v==null?void 0:v.filter(({matchUpStatus:w,winningSide:S})=>w!=="COMPLETED"&&!S));const b=(m?u:v).map(w=>w.matchUpId);yt({methods:[{method:_we,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},matchUpIds:b}}],callback:w=>{w.success&&rt(r)&&r()}})}}function GJe({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,roundNameFilter:n,controlAnchor:r,eventIdFilter:a,scheduledDate:o,matchUps:s=[],table:l}){const u=P=>P.eventId===a,c=P=>{l.removeFilter(u),a=P,P&&l.addFilter(u)},d=$e.getEvents().events||[],f=[{label:oh,onClick:()=>c(),close:!0}].concat(d.map(P=>({onClick:()=>c(P.eventId),label:P.eventName,close:!0}))),h=P=>P.roundName===n,m=Wt.unique(s.map(P=>P.roundName)),g=P=>{l.removeFilter(h),n=P,P&&l.addFilter(h)},y=[{label:D9,onClick:()=>g(),close:!0}].concat(m.map(P=>({onClick:()=>g(P),label:P,close:!0}))),b=()=>{t()&&e(),console.log("clear filters ?")},I=P=>{const E=Jo(P.target,"dropdown");jJe({target:E||(P==null?void 0:P.target),callback:b,roundNameFilter:n,eventIdFilter:a,scheduledDate:o,eventFilter:u,roundFilter:h})},T=_b(l),S=[{onClick:()=>VJe({scheduledDate:o,table:l,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:I,intent:"is-warning",id:"clearSchedule",close:!0}],U=[{onKeyDown:P=>P.keyCode===8&&P.target.value.length===1&&T(""),onChange:P=>T(P.target.value),onKeyUp:P=>T(P.target.value),clearSearch:()=>T(""),placeholder:"Search participants",location:Ct,search:!0},{hide:f.length<2,options:f,id:"eventOptions",label:oh,modifyLabel:!0,location:Ct,selection:!0},{hide:y.length<2,options:y,id:"roundOptions",label:D9,modifyLabel:!0,location:Ct,selection:!0},{options:S,label:"Actions",selection:!1,location:mt,align:mt},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];no({target:r,items:U}).elements}function HJe({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r,setDate:a}={}){if(!i)return;let o;const s=h=>O6(h).format("dddd MMM D"),{startDate:l,endDate:u}=Mg.getCompetitionDateRange(),d=Wt.generateDateRange(l,u).map(h=>({onClick:()=>rt(a)&&a(h),isActive:h===n,label:s(h),value:h,close:!0})),p=()=>{},f=[{clearSearch:()=>p(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:Ct,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:Ct,align:Ct},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:mt},{label:s(n||l),value:n||l,id:Mue,options:d,modifyLabel:!0,intent:"is-info",location:mt,align:mt}];return o=no({target:i,items:f}).elements,{elements:o}}function ISe({scheduledDate:t}){let e;const i=document.getElementById(Lue),n=document.getElementById(N3),r=document.getElementById(A3);n.style.paddingBottom="1em",r.style.paddingBottom="1em";let a=ze.state.schedulingActive;i.style.display=a?"":lt,t=t||Mg.getCompetitionDateRange().startDate;const{replaceTableData:o,table:s,unscheduledMatchUps:l}=vJe({scheduledDate:t}),u=()=>{a=!a,ze.state.schedulingActive=a,i.style.display=a?"":lt,e!=null&&e.scheduleMatchUps&&(e.scheduleMatchUps.style.display=a?lt:"")},{replaceTableData:c,table:d,courtsCount:p}=$Je({scheduledDate:t});GJe({controlAnchor:n,matchUps:l,table:s,updateUnscheduledTable:o,updateScheduleTable:c,toggleUnscheduled:u,scheduledDate:t}),e=HJe({table:d,unscheduledMatchUps:l,updateScheduleTable:c,toggleUnscheduled:u,schedulingActive:a,controlAnchor:r,scheduledDate:t,courtsCount:p,setDate:h=>{ze.displayed.schedule_day=h,o({scheduledDate:h}),c({scheduledDate:h})}}).elements}const{SUBSTITUTION:QZ,PENALTY:eX,REMOVE_PARTICIPANT:tX,REPLACE_PARTICIPANT:iX}=vH,{POLICY_TYPE_MATCHUP_ACTIONS:zJe}=yg,{ASSIGN_PARTICIPANT:uV}=ib,{TEAM:qJe,DOUBLES:wSe}=ko,WJe=Wt.extractAttributes;function w1(t,e,i,n){var v;if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(y=>y.remove());return}const o=e.getRow().getData(),s=e.getColumn().getDefinition(),l=o.matchUpType===wSe,u=o.eventType===qJe,{matchUpId:c,drawId:d}=o,p=s.field==="side1"&&1||s.field==="side2"&&2,{validActions:f}=$e.matchUpActions({matchUpId:c,drawId:d,sideNumber:p,policyDefinitions:{[zJe]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),h=(v=n==null?void 0:n.individualParticipant)==null?void 0:v.participantId,m={[uV]:{params:{data:o,sideNumber:p,callback:i,isTeam:u,isDoubles:l},text:"Assign participant",method:LF},[eX]:{onClick:()=>console.log({data:o}),text:"Assess penalty"},[tX]:{params:{data:o,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:h},text:"Remove participant",method:KJe},[iX]:{params:{data:o,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:h},text:"Replace participant",method:LF},[QZ]:{params:{data:o,sideNumber:p,callback:i,isTeam:u,isDoubles:l,clickedParticipantId:h},method:LF,text:"Substitution"}},g=f.filter(({type:y})=>[uV,eX,tX,iX,QZ].includes(y)).map(y=>{const b=m[y.type];return{onClick:()=>{rt(b.method)?b.method({...b.params,action:y}):rt(b.onClick)&&b.onClick()},text:b.text}});g.length===1?g[0].onClick():g.length>0&&(t!=null&&t.target)&&Ps({items:g,target:t.target,config:{placement:tf}})}function KJe(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];yt({methods:r,callback:o=>rt(i)&&i(o)})}function LF(t){var m;const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:a}=t,o=t.action.availableParticipants,s=a.matchUp.matchUpType,l=a.matchUp.sides.find(g=>e===g.sideNumber),u=(m=l==null?void 0:l.participant)==null?void 0:m.individualParticipantIds,c=t.clickedParticipantId;FE({selectedParticipantIds:u,selectOnEnter:!0,selectionLimit:s===wSe&&!c?2:1,onSelection:g=>{if(g.participantId||g.selected){const v=[];(Array.isArray(g.selected)?g.selected.map(WJe("participantId")):[g.participantId]).filter(Boolean).forEach(I=>{v.push({params:{...t.action.payload,substituteParticipantId:I,newParticipantId:I,existingParticipantId:c,participantId:I},method:t.action.method})}),yt({methods:v,callback:I=>{rt(i)&&i(I)}})}},action:{type:uV,participantsAvailable:o},title:n&&r?"Doubles: Select participants":void 0})}function SSe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function TSe(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:n}=e,r=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=i;r.style.color=a[s],r.style.fontSize="smaller",r.innerHTML=s}return r}function c8(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style="font-size: smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style="color: blue; font-size: smaller",n.innerHTML="Enter score"),n}function nX(t){const e=document.createElement("div");return e.style="font-weight: bold",e.innerHTML=t.getValue(),e}function d8({pointerEvent:t,cell:e,matchUp:i,callback:n}){const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(c=>c.remove());return}const a=!(i!=null&&i.roundPosition)&&!(i!=null&&i.drawPositions),o=e&&t.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=(e==null?void 0:e.getRow().getData())||i,l=()=>{rt(n)&&n(s)},u=[{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&u.push({onClick:()=>YJe({...i,callback:l}),text:"Delete match",color:"red"}),Ps({items:u,target:o||t.target,config:{placement:tf}})}function YJe({drawId:t,structureId:e,matchUpId:i,callback:n}){yt({methods:[{method:kwe,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:o=>{o.success?rt(n)&&n():console.log({postMutationError:o.error})}})}const rX=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&xb(t)(e,i))??i},OC=t=>({cell:e,event:i,...n})=>{w1(i,e,a=>{if(a.success){const o=e.getRow(),{drawId:s,matchUpId:l}=t,u=$e.findMatchUp({drawId:s,matchUpId:l}).matchUp,c=o.getData().matchUp.collectionId,p=u.tieMatchUps.filter(h=>h.collectionId===c).map(h=>CS({...h,dualMatchUp:t})),f=e.getTable();f.updateData(p),f.redraw(!0)}},n)},tA=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let n={};const r=(d,p)=>d.filter(f=>p.indexOf(f)!==-1).filter((f,h,m)=>m.indexOf(f)===h);e.reset=()=>(n={},e),e.register=(d,p,f,h)=>(typeof f=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:f,delay:h},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...f)=>{var h,m;return(m=(h=n==null?void 0:n[p])==null?void 0:h[d])==null?void 0:m.fx(...f)},e.trigger=(d,p,f,h)=>n[p][d].fx(f,h,p),e.list=()=>console.log(n);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let o=0;function s({evt:d,evnt:p,stopPropagation:f=!0}){f&&d.stopPropagation();const h={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?r(m,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-o,o=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:h})})}}function l({cls:d,evt:p,evnt:f,mouse:h}){let m=p.target;n[f][d].fx(m,h,f,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){c()},e.holdTime))},!1),document.addEventListener("touchend",function(){u()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&u()},!1);function u(){clearTimeout(t)}function c(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,f="";function h(){clearTimeout(p),d=!0,f!=="can-touch"&&(f="can-touch",document.documentElement.classList.add(f)),p=setTimeout(function(){d=!1},500)}function m(){!d&&f==="can-touch"&&(d=!1,f="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",h,!1),document.addEventListener("mouseover",m,!1)}(),e}(),ZJe=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function USe(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const XJe=function(){let t={};t.display=({muid:l,teams:u})=>{let c={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:u});return yn({content:p,config:{maxWidth:450}}),Object.assign(d,c),USe(d)};function e({muid:l,teams:u,round_name:c,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},f=i();Object.assign(p,f.ids);let h=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${c||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:u[0],index:0})}
                              ${o({team:u[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:u[1],index:0})}
                              ${o({team:u[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${f.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${Lr.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${Lr.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${Lr.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:h}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},u=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Lr.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${Lr.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${Lr.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Lr.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${Lr.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${Lr.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:u}}const n=(l,u)=>{let c=parseInt(l,10),d=Math.floor(c/3600),p=Math.floor((c-d*3600)/60),f=c-d*3600-p*60,h=!u||(u==null?void 0:u.display_seconds),m=!u||(u==null?void 0:u.pad_hours);return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),f<10&&(f="0"+f),h?d+":"+p+":"+f:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let u=a(l.schedule);if(u)return`Duration ${u}`;let c=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${c?" / "+c:""}`;return l.winner_index===void 0?d:""}function a(l){if(!l.start||!l.end)return"";let u=s(l.end)-s(l.start);return n(u,{pad_hours:!1,display_seconds:!1})}function o({team:l,index:u=0}){var p,f;if(u===1)return"";const c=(p=l.person)==null?void 0:p.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${c?(f=pw.countryToFlag(c))==null?void 0:f.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function s(l){let u=l.split(":");return u[0]*60*60+u[1]*60}return t}();function DSe(t,e){if(!t||!e)return;let i=Object.keys(t),n=Object.keys(e);for(let r of i)if(n.indexOf(r)>=0){let a=e[r],o=t[r];typeof a=="object"&&typeof o!="function"&&a.constructor!==Array?DSe(t[r],e[r]):e[r]=t[r]}}function PSe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function JJe(t){return t.length===1&&(t=QJe(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}}function QJe(t){return function(e,i){return PSe(t(e),i)}}JJe(PSe);var eQe={value:function(){}};function ESe(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new WR(i)}function WR(t){this._=t}function tQe(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}WR.prototype=ESe.prototype={constructor:WR,on:function(t,e){var i=this._,n=tQe(t+"",i),r,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((r=(t=n[a]).type)&&(r=iQe(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(r=(t=n[a]).type)i[r]=aX(i[r],t.name,e);else if(e==null)for(r in i)i[r]=aX(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new WR(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,r=a.length;n<r;++n)a[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};function iQe(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function aX(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=eQe,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var cV="http://www.w3.org/1999/xhtml";const oX={svg:"http://www.w3.org/2000/svg",xhtml:cV,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Vx(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),oX.hasOwnProperty(e)?{space:oX[e],local:t}:t}function nQe(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===cV&&e.documentElement.namespaceURI===cV?e.createElement(t):e.createElementNS(i,t)}}function rQe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function CSe(t){var e=Vx(t);return(e.local?rQe:nQe)(e)}function aQe(){}function p8(t){return t==null?aQe:function(){return this.querySelector(t)}}function oQe(t){typeof t!="function"&&(t=p8(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=new Array(o),l,u,c=0;c<o;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),s[c]=u);return new zu(n,this._parents)}function sQe(){return[]}function RSe(t){return t==null?sQe:function(){return this.querySelectorAll(t)}}function lQe(t){typeof t!="function"&&(t=RSe(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var o=e[a],s=o.length,l,u=0;u<s;++u)(l=o[u])&&(n.push(t.call(l,l.__data__,u,o)),r.push(l));return new zu(n,r)}function MSe(t){return function(){return this.matches(t)}}function uQe(t){typeof t!="function"&&(t=MSe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,u=0;u<o;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&s.push(l);return new zu(n,this._parents)}function NSe(t){return new Array(t.length)}function cQe(){return new zu(this._enter||this._groups.map(NSe),this._parents)}function iA(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}iA.prototype={constructor:iA,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function dQe(t){return function(){return t}}var sX="$";function pQe(t,e,i,n,r,a){for(var o=0,s,l=e.length,u=a.length;o<u;++o)(s=e[o])?(s.__data__=a[o],n[o]=s):i[o]=new iA(t,a[o]);for(;o<l;++o)(s=e[o])&&(r[o]=s)}function fQe(t,e,i,n,r,a,o){var s,l,u={},c=e.length,d=a.length,p=new Array(c),f;for(s=0;s<c;++s)(l=e[s])&&(p[s]=f=sX+o.call(l,l.__data__,s,e),f in u?r[s]=l:u[f]=l);for(s=0;s<d;++s)f=sX+o.call(t,a[s],s,a),(l=u[f])?(n[s]=l,l.__data__=a[s],u[f]=null):i[s]=new iA(t,a[s]);for(s=0;s<c;++s)(l=e[s])&&u[p[s]]===l&&(r[s]=l)}function hQe(t,e){if(!t)return f=new Array(this.size()),u=-1,this.each(function(w){f[++u]=w}),f;var i=e?fQe:pQe,n=this._parents,r=this._groups;typeof t!="function"&&(t=dQe(t));for(var a=r.length,o=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var c=n[u],d=r[u],p=d.length,f=t.call(c,c&&c.__data__,u,n),h=f.length,m=s[u]=new Array(h),g=o[u]=new Array(h),v=l[u]=new Array(p);i(c,d,m,g,v,f,e);for(var y=0,b=0,I,T;y<h;++y)if(I=m[y]){for(y>=b&&(b=y+1);!(T=g[b])&&++b<h;);I._next=T||null}}return o=new zu(o,n),o._enter=s,o._exit=l,o}function mQe(){return new zu(this._exit||this._groups.map(NSe),this._parents)}function gQe(t,e,i){var n=this.enter(),r=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function vQe(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],u=i[s],c=l.length,d=o[s]=new Array(c),p,f=0;f<c;++f)(p=l[f]||u[f])&&(d[f]=p);for(;s<n;++s)o[s]=e[s];return new zu(o,this._parents)}function yQe(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,a=n[r],o;--r>=0;)(o=n[r])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function bQe(t){t||(t=IQe);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var o=i[a],s=o.length,l=r[a]=new Array(s),u,c=0;c<s;++c)(u=o[c])&&(l[c]=u);l.sort(e)}return new zu(r,this._parents).order()}function IQe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function wQe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function SQe(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function TQe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var o=n[r];if(o)return o}return null}function UQe(){var t=0;return this.each(function(){++t}),t}function DQe(){return!this.node()}function PQe(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],a=0,o=r.length,s;a<o;++a)(s=r[a])&&t.call(s,s.__data__,a,r);return this}function EQe(t){return function(){this.removeAttribute(t)}}function CQe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function RQe(t,e){return function(){this.setAttribute(t,e)}}function MQe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function NQe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function AQe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function _Qe(t,e){var i=Vx(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?CQe:EQe:typeof e=="function"?i.local?AQe:NQe:i.local?MQe:RQe)(i,e))}function ASe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function kQe(t){return function(){this.style.removeProperty(t)}}function OQe(t,e,i){return function(){this.style.setProperty(t,e,i)}}function xQe(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function LQe(t,e,i){return arguments.length>1?this.each((e==null?kQe:typeof e=="function"?xQe:OQe)(t,e,i??"")):t0(this.node(),t)}function t0(t,e){return t.style.getPropertyValue(e)||ASe(t).getComputedStyle(t,null).getPropertyValue(e)}function FQe(t){return function(){delete this[t]}}function BQe(t,e){return function(){this[t]=e}}function $Qe(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function VQe(t,e){return arguments.length>1?this.each((e==null?FQe:typeof e=="function"?$Qe:BQe)(t,e)):this.node()[t]}function _Se(t){return t.trim().split(/^|\s+/)}function f8(t){return t.classList||new kSe(t)}function kSe(t){this._node=t,this._names=_Se(t.getAttribute("class")||"")}kSe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function OSe(t,e){for(var i=f8(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function xSe(t,e){for(var i=f8(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function jQe(t){return function(){OSe(this,t)}}function GQe(t){return function(){xSe(this,t)}}function HQe(t,e){return function(){(e.apply(this,arguments)?OSe:xSe)(this,t)}}function zQe(t,e){var i=_Se(t+"");if(arguments.length<2){for(var n=f8(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?HQe:e?jQe:GQe)(i,e))}function qQe(){this.textContent=""}function WQe(t){return function(){this.textContent=t}}function KQe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function YQe(t){return arguments.length?this.each(t==null?qQe:(typeof t=="function"?KQe:WQe)(t)):this.node().textContent}function ZQe(){this.innerHTML=""}function XQe(t){return function(){this.innerHTML=t}}function JQe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function QQe(t){return arguments.length?this.each(t==null?ZQe:(typeof t=="function"?JQe:XQe)(t)):this.node().innerHTML}function eet(){this.nextSibling&&this.parentNode.appendChild(this)}function tet(){return this.each(eet)}function iet(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function net(){return this.each(iet)}function ret(t){var e=typeof t=="function"?t:CSe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function aet(){return null}function oet(t,e){var i=typeof t=="function"?t:CSe(t),n=e==null?aet:typeof e=="function"?e:p8(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function set(){var t=this.parentNode;t&&t.removeChild(this)}function uet(){return this.each(set)}function cet(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function det(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pet(t){return this.select(t?det:cet)}function fet(t){return arguments.length?this.property("__data__",t):this.node().__data__}var LSe={};if(typeof document<"u"){var het=document.documentElement;"onmouseenter"in het||(LSe={mouseenter:"mouseover",mouseleave:"mouseout"})}function met(t,e,i){return t=FSe(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function FSe(t,e,i){return function(n){try{t.call(this,this.__data__,e,i)}finally{}}}function get(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function vet(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,a;i<r;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++n]=a;++n?e.length=n:delete this.__on}}}function yet(t,e,i){var n=LSe.hasOwnProperty(t.type)?met:FSe;return function(r,a,o){var s=this.__on,l,u=n(e,a,o);if(s){for(var c=0,d=s.length;c<d;++c)if((l=s[c]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=u,l.capture=i),l.value=e;return}}this.addEventListener(t.type,u,i),l={type:t.type,name:t.name,value:e,listener:u,capture:i},s?s.push(l):this.__on=[l]}}function bet(t,e,i){var n=get(t+""),r,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,u=s.length,c;l<u;++l)for(r=0,c=s[l];r<a;++r)if((o=n[r]).type===c.type&&o.name===c.name)return c.value}return}for(s=e?yet:vet,i==null&&(i=!1),r=0;r<a;++r)this.each(s(n[r],e,i));return this}function BSe(t,e,i){var n=ASe(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function Iet(t,e){return function(){return BSe(this,t,e)}}function wet(t,e){return function(){return BSe(this,t,e.apply(this,arguments))}}function Tet(t,e){return this.each((typeof e=="function"?wet:Iet)(t,e))}var $Se=[null];function zu(t,e){this._groups=t,this._parents=e}function BE(){return new zu([[document.documentElement]],$Se)}zu.prototype=BE.prototype={constructor:zu,select:oQe,selectAll:lQe,filter:uQe,data:hQe,enter:cQe,exit:mQe,join:gQe,merge:vQe,order:yQe,sort:bQe,call:wQe,nodes:SQe,node:TQe,size:UQe,empty:DQe,each:PQe,attr:_Qe,style:LQe,property:VQe,classed:zQe,text:YQe,html:QQe,raise:tet,lower:net,append:ret,insert:oet,remove:uet,clone:pet,datum:fet,on:bet,dispatch:Tet};function VSe(t){return typeof t=="string"?new zu([[document.querySelector(t)]],[document.documentElement]):new zu([[t]],$Se)}function h8(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function jSe(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function $E(){}var S1=.7,nA=1/S1,FI="\\s*([+-]?\\d+)\\s*",T1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",gp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Uet=/^#([0-9a-f]{3,8})$/,Det=new RegExp("^rgb\\("+[FI,FI,FI]+"\\)$"),Pet=new RegExp("^rgb\\("+[gp,gp,gp]+"\\)$"),Eet=new RegExp("^rgba\\("+[FI,FI,FI,T1]+"\\)$"),Cet=new RegExp("^rgba\\("+[gp,gp,gp,T1]+"\\)$"),Ret=new RegExp("^hsl\\("+[T1,gp,gp]+"\\)$"),Met=new RegExp("^hsla\\("+[T1,gp,gp,T1]+"\\)$"),lX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};h8($E,U1,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:uX,formatHex:uX,formatHsl:Net,formatRgb:cX,toString:cX});function uX(){return this.rgb().formatHex()}function Net(){return GSe(this).formatHsl()}function cX(){return this.rgb().formatRgb()}function U1(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=Uet.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?dX(e):i===3?new Eu(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?xC(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?xC(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Det.exec(t))?new Eu(e[1],e[2],e[3],1):(e=Pet.exec(t))?new Eu(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Eet.exec(t))?xC(e[1],e[2],e[3],e[4]):(e=Cet.exec(t))?xC(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ret.exec(t))?hX(e[1],e[2]/100,e[3]/100,1):(e=Met.exec(t))?hX(e[1],e[2]/100,e[3]/100,e[4]):lX.hasOwnProperty(t)?dX(lX[t]):t==="transparent"?new Eu(NaN,NaN,NaN,0):null}function dX(t){return new Eu(t>>16&255,t>>8&255,t&255,1)}function xC(t,e,i,n){return n<=0&&(t=e=i=NaN),new Eu(t,e,i,n)}function Aet(t){return t instanceof $E||(t=U1(t)),t?(t=t.rgb(),new Eu(t.r,t.g,t.b,t.opacity)):new Eu}function dV(t,e,i,n){return arguments.length===1?Aet(t):new Eu(t,e,i,n??1)}function Eu(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}h8(Eu,dV,jSe($E,{brighter:function(t){return t=t==null?nA:Math.pow(nA,t),new Eu(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?S1:Math.pow(S1,t),new Eu(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pX,formatHex:pX,formatRgb:fX,toString:fX}));function pX(){return"#"+FF(this.r)+FF(this.g)+FF(this.b)}function fX(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function FF(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function hX(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new ep(t,e,i,n)}function GSe(t){if(t instanceof ep)return new ep(t.h,t.s,t.l,t.opacity);if(t instanceof $E||(t=U1(t)),!t)return new ep;if(t instanceof ep)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),o=NaN,s=a-r,l=(a+r)/2;return s?(e===a?o=(i-n)/s+(i<n)*6:i===a?o=(n-e)/s+2:o=(e-i)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new ep(o,s,l,t.opacity)}function _et(t,e,i,n){return arguments.length===1?GSe(t):new ep(t,e,i,n??1)}function ep(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}h8(ep,_et,jSe($E,{brighter:function(t){return t=t==null?nA:Math.pow(nA,t),new ep(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?S1:Math.pow(S1,t),new ep(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Eu(BF(t>=240?t-240:t+120,r,n),BF(t,r,n),BF(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function BF(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function HSe(t){return function(){return t}}function ket(t,e){return function(i){return t+i*e}}function Oet(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function xet(t){return(t=+t)==1?zSe:function(e,i){return i-e?Oet(e,i,t):HSe(isNaN(e)?i:e)}}function zSe(t,e){var i=e-t;return i?ket(t,i):HSe(isNaN(t)?e:t)}const mX=function t(e){var i=xet(e);function n(r,a){var o=i((r=dV(r)).r,(a=dV(a)).r),s=i(r.g,a.g),l=i(r.b,a.b),u=zSe(r.opacity,a.opacity);return function(c){return r.r=o(c),r.g=s(c),r.b=l(c),r.opacity=u(c),r+""}}return n.gamma=t,n}(1);function wm(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var pV=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$F=new RegExp(pV.source,"g");function Let(t){return function(){return t}}function Fet(t){return function(e){return t(e)+""}}function Bet(t,e){var i=pV.lastIndex=$F.lastIndex=0,n,r,a,o=-1,s=[],l=[];for(t=t+"",e=e+"";(n=pV.exec(t))&&(r=$F.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:wm(n,r)})),i=$F.lastIndex;return i<e.length&&(a=e.slice(i),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?Fet(l[0].x):Let(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)s[(d=l[c]).i]=d.x(u);return s.join("")})}var gX=180/Math.PI,fV={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function qSe(t,e,i,n,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*gX,skewX:Math.atan(l)*gX,scaleX:o,scaleY:s}}var KS,VF,vX,LC;function $et(t){return t==="none"?fV:(KS||(KS=document.createElement("DIV"),VF=document.documentElement,vX=document.defaultView),KS.style.transform=t,t=vX.getComputedStyle(VF.appendChild(KS),null).getPropertyValue("transform"),VF.removeChild(KS),t=t.slice(7,-1).split(","),qSe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function Vet(t){return t==null||(LC||(LC=document.createElementNS("http://www.w3.org/2000/svg","g")),LC.setAttribute("transform",t),!(t=LC.transform.baseVal.consolidate()))?fV:(t=t.matrix,qSe(t.a,t.b,t.c,t.d,t.e,t.f))}function WSe(t,e,i,n){function r(u){return u.length?u.pop()+" ":""}function a(u,c,d,p,f,h){if(u!==d||c!==p){var m=f.push("translate(",null,e,null,i);h.push({i:m-4,x:wm(u,d)},{i:m-2,x:wm(c,p)})}else(d||p)&&f.push("translate("+d+e+p+i)}function o(u,c,d,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:wm(u,c)})):c&&d.push(r(d)+"rotate("+c+n)}function s(u,c,d,p){u!==c?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:wm(u,c)}):c&&d.push(r(d)+"skewX("+c+n)}function l(u,c,d,p,f,h){if(u!==d||c!==p){var m=f.push(r(f)+"scale(",null,",",null,")");h.push({i:m-4,x:wm(u,d)},{i:m-2,x:wm(c,p)})}else(d!==1||p!==1)&&f.push(r(f)+"scale("+d+","+p+")")}return function(u,c){var d=[],p=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,p),o(u.rotate,c.rotate,d,p),s(u.skewX,c.skewX,d,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,p),u=c=null,function(f){for(var h=-1,m=p.length,g;++h<m;)d[(g=p[h]).i]=g.x(f);return d.join("")}}}var jet=WSe($et,"px, ","px)","deg)"),Get=WSe(Vet,", ",")",")"),i0=0,fT=0,YS=0,KSe=1e3,rA,hT,aA=0,Ey=0,jx=0,D1=typeof performance=="object"&&performance.now?performance:Date,YSe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Gx(){return Ey||(YSe(Het),Ey=D1.now()+jx)}function Het(){Ey=0}function oA(){this._call=this._time=this._next=null}oA.prototype=ZSe.prototype={constructor:oA,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?Gx():+i)+(e==null?0:+e),!this._next&&hT!==this&&(hT?hT._next=this:rA=this,hT=this),this._call=t,this._time=i,hV()},stop:function(){this._call&&(this._call=null,this._time=1/0,hV())}};function ZSe(t,e,i){var n=new oA;return n.restart(t,e,i),n}function zet(){Gx(),++i0;for(var t=rA,e;t;)(e=Ey-t._time)>=0&&t._call.call(null,e),t=t._next;--i0}function yX(){Ey=(aA=D1.now())+jx,i0=fT=0;try{zet()}finally{i0=0,Wet(),Ey=0}}function qet(){var t=D1.now(),e=t-aA;e>KSe&&(jx-=e,aA=t)}function Wet(){for(var t,e=rA,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:rA=i);hT=t,hV(n)}function hV(t){if(!i0){fT&&(fT=clearTimeout(fT));var e=t-Ey;e>24?(t<1/0&&(fT=setTimeout(yX,t-D1.now()-jx)),YS&&(YS=clearInterval(YS))):(YS||(aA=D1.now(),YS=setInterval(qet,KSe)),i0=1,YSe(yX))}}function bX(t,e,i){var n=new oA;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var Ket=ESe("start","end","cancel","interrupt"),Yet=[],XSe=0,IX=1,mV=2,KR=3,wX=4,gV=5,YR=6;function Hx(t,e,i,n,r,a){var o=t.__transition;if(!o)t.__transition={};else if(i in o)return;Zet(t,i,{name:e,index:n,group:r,on:Ket,tween:Yet,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:XSe})}function m8(t,e){var i=Bd(t,e);if(i.state>XSe)throw new Error("too late; already scheduled");return i}function Yh(t,e){var i=Bd(t,e);if(i.state>KR)throw new Error("too late; already running");return i}function Bd(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Zet(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=ZSe(a,0,i.time);function a(u){i.state=IX,i.timer.restart(o,i.delay,i.time),i.delay<=u&&o(u-i.delay)}function o(u){var c,d,p,f;if(i.state!==IX)return l();for(c in n)if(f=n[c],f.name===i.name){if(f.state===KR)return bX(o);f.state===wX?(f.state=YR,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete n[c]):+c<e&&(f.state=YR,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete n[c])}if(bX(function(){i.state===KR&&(i.state=wX,i.timer.restart(s,i.delay,i.time),s(u))}),i.state=mV,i.on.call("start",t,t.__data__,i.index,i.group),i.state===mV){for(i.state=KR,r=new Array(p=i.tween.length),c=0,d=-1;c<p;++c)(f=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=f);r.length=d+1}}function s(u){for(var c=u<i.duration?i.ease.call(null,u/i.duration):(i.timer.restart(l),i.state=gV,1),d=-1,p=r.length;++d<p;)r[d].call(t,c);i.state===gV&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=YR,i.timer.stop(),delete n[e];for(var u in n)return;delete t.__transition}}function Xet(t,e){var i=t.__transition,n,r,a=!0,o;if(i){e=e==null?null:e+"";for(o in i){if((n=i[o]).name!==e){a=!1;continue}r=n.state>mV&&n.state<gV,n.state=YR,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[o]}a&&delete t.__transition}}function Jet(t){return this.each(function(){Xet(this,t)})}function Qet(t,e){var i,n;return function(){var r=Yh(this,t),a=r.tween;if(a!==i){n=i=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===e){n=n.slice(),n.splice(o,1);break}}r.tween=n}}function ett(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=Yh(this,t),o=a.tween;if(o!==n){r=(n=o).slice();for(var s={name:e,value:i},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=s;break}l===u&&r.push(s)}a.tween=r}}function ttt(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=Bd(this.node(),i).tween,r=0,a=n.length,o;r<a;++r)if((o=n[r]).name===t)return o.value;return null}return this.each((e==null?Qet:ett)(i,t,e))}function g8(t,e,i){var n=t._id;return t.each(function(){var r=Yh(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return Bd(r,n).value[e]}}function JSe(t,e){var i;return(typeof e=="number"?wm:e instanceof U1?mX:(i=U1(e))?(e=i,mX):Bet)(t,e)}function itt(t){return function(){this.removeAttribute(t)}}function ntt(t){return function(){this.removeAttributeNS(t.space,t.local)}}function rtt(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttribute(t);return o===r?null:o===n?a:a=e(n=o,i)}}function att(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===n?a:a=e(n=o,i)}}function ott(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function stt(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function ltt(t,e){var i=Vx(t),n=i==="transform"?Get:JSe;return this.attrTween(t,typeof e=="function"?(i.local?stt:ott)(i,n,g8(this,"attr."+t,e)):e==null?(i.local?ntt:itt)(i):(i.local?att:rtt)(i,n,e))}function utt(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function ctt(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function dtt(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&ctt(t,a)),i}return r._value=e,r}function ptt(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&utt(t,a)),i}return r._value=e,r}function ftt(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=Vx(t);return this.tween(i,(n.local?dtt:ptt)(n,e))}function htt(t,e){return function(){m8(this,t).delay=+e.apply(this,arguments)}}function mtt(t,e){return e=+e,function(){m8(this,t).delay=e}}function gtt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?htt:mtt)(e,t)):Bd(this.node(),e).delay}function vtt(t,e){return function(){Yh(this,t).duration=+e.apply(this,arguments)}}function ytt(t,e){return e=+e,function(){Yh(this,t).duration=e}}function btt(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?vtt:ytt)(e,t)):Bd(this.node(),e).duration}function Itt(t,e){if(typeof e!="function")throw new Error;return function(){Yh(this,t).ease=e}}function wtt(t){var e=this._id;return arguments.length?this.each(Itt(e,t)):Bd(this.node(),e).ease}function Stt(t){typeof t!="function"&&(t=MSe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,u=0;u<o;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&s.push(l);return new Th(n,this._parents,this._name,this._id)}function Ttt(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],u=i[s],c=l.length,d=o[s]=new Array(c),p,f=0;f<c;++f)(p=l[f]||u[f])&&(d[f]=p);for(;s<n;++s)o[s]=e[s];return new Th(o,this._parents,this._name,this._id)}function Utt(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function Dtt(t,e,i){var n,r,a=Utt(e)?m8:Yh;return function(){var o=a(this,t),s=o.on;s!==n&&(r=(n=s).copy()).on(e,i),o.on=r}}function Ptt(t,e){var i=this._id;return arguments.length<2?Bd(this.node(),i).on.on(t):this.each(Dtt(i,t,e))}function Ett(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function Ctt(){return this.on("end.remove",Ett(this._id))}function Rtt(t){var e=this._name,i=this._id;typeof t!="function"&&(t=p8(t));for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o)for(var s=n[o],l=s.length,u=a[o]=new Array(l),c,d,p=0;p<l;++p)(c=s[p])&&(d=t.call(c,c.__data__,p,s))&&("__data__"in c&&(d.__data__=c.__data__),u[p]=d,Hx(u[p],e,i,p,u,Bd(c,i)));return new Th(a,this._parents,e,i)}function Mtt(t){var e=this._name,i=this._id;typeof t!="function"&&(t=RSe(t));for(var n=this._groups,r=n.length,a=[],o=[],s=0;s<r;++s)for(var l=n[s],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var p=t.call(c,c.__data__,d,l),f,h=Bd(c,i),m=0,g=p.length;m<g;++m)(f=p[m])&&Hx(f,e,i,m,p,h);a.push(p),o.push(c)}return new Th(a,o,e,i)}var Ntt=BE.prototype.constructor;function Att(){return new Ntt(this._groups,this._parents)}function _tt(t,e){var i,n,r;return function(){var a=t0(this,t),o=(this.style.removeProperty(t),t0(this,t));return a===o?null:a===i&&o===n?r:r=e(i=a,n=o)}}function QSe(t){return function(){this.style.removeProperty(t)}}function ktt(t,e,i){var n,r=i+"",a;return function(){var o=t0(this,t);return o===r?null:o===n?a:a=e(n=o,i)}}function Ott(t,e,i){var n,r,a;return function(){var o=t0(this,t),s=i(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),t0(this,t))),o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s))}}function xtt(t,e){var i,n,r,a="style."+e,o="end."+a,s;return function(){var l=Yh(this,t),u=l.on,c=l.value[a]==null?s||(s=QSe(e)):void 0;(u!==i||r!==c)&&(n=(i=u).copy()).on(o,r=c),l.on=n}}function Ltt(t,e,i){var n=(t+="")=="transform"?jet:JSe;return e==null?this.styleTween(t,_tt(t,n)).on("end.style."+t,QSe(t)):typeof e=="function"?this.styleTween(t,Ott(t,n,g8(this,"style."+t,e))).each(xtt(this._id,t)):this.styleTween(t,ktt(t,n,e),i).on("end.style."+t,null)}function Ftt(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function Btt(t,e,i){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Ftt(t,o,i)),n}return a._value=e,a}function $tt(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Btt(t,e,i??""))}function Vtt(t){return function(){this.textContent=t}}function jtt(t){return function(){var e=t(this);this.textContent=e??""}}function Gtt(t){return this.tween("text",typeof t=="function"?jtt(g8(this,"text",t)):Vtt(t==null?"":t+""))}function Htt(t){return function(e){this.textContent=t.call(this,e)}}function ztt(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&Htt(r)),e}return n._value=t,n}function qtt(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,ztt(t))}function Wtt(){for(var t=this._name,e=this._id,i=eTe(),n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,u=0;u<s;++u)if(l=o[u]){var c=Bd(l,e);Hx(l,t,i,u,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Th(n,this._parents,t,i)}function Ktt(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,o){var s={value:o},l={value:function(){--r===0&&a()}};i.each(function(){var u=Yh(this,n),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),u.on=e})})}var Ytt=0;function Th(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function eTe(){return++Ytt}var sI=BE.prototype;Th.prototype={constructor:Th,select:Rtt,selectAll:Mtt,filter:Stt,merge:Ttt,selection:Att,transition:Wtt,call:sI.call,nodes:sI.nodes,node:sI.node,size:sI.size,empty:sI.empty,each:sI.each,on:Ptt,attr:ltt,attrTween:ftt,style:Ltt,styleTween:$tt,text:Gtt,textTween:qtt,remove:Ctt,tween:ttt,delay:gtt,duration:btt,ease:wtt,end:Ktt};function Ztt(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var vV={time:null,delay:0,duration:250,ease:Ztt};function Xtt(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return vV.time=Gx(),vV;return i}function Jtt(t){var e,i;t instanceof Th?(e=t._id,t=t._name):(e=eTe(),(i=vV).time=Gx(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,u=0;u<s;++u)(l=o[u])&&Hx(l,t,e,u,o,i||Xtt(l,e));return new Th(n,this._parents,t,e)}BE.prototype.interrupt=Jet;BE.prototype.transition=Jtt;var Qu="$";function sA(){}sA.prototype=tTe.prototype={constructor:sA,has:function(t){return Qu+t in this},get:function(t){return this[Qu+t]},set:function(t,e){return this[Qu+t]=e,this},remove:function(t){var e=Qu+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Qu&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Qu&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Qu&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Qu&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Qu&&++t;return t},empty:function(){for(var t in this)if(t[0]===Qu)return!1;return!0},each:function(t){for(var e in this)e[0]===Qu&&t(this[e],e.slice(1),this)}};function tTe(t,e){var i=new sA;if(t instanceof sA)t.each(function(s,l){i.set(l,s)});else if(Array.isArray(t)){var n=-1,r=t.length,a;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(a=t[n],n,t),a)}else if(t)for(var o in t)i.set(o,t[o]);return i}function SX(){}var nv=tTe.prototype;SX.prototype={constructor:SX,has:nv.has,add:function(t){return t+="",this[Qu+t]=t,this},remove:nv.remove,clear:nv.clear,values:nv.keys,size:nv.size,empty:nv.empty,each:nv.each};function RS(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(RS);const Qtt=function t(e){function i(n,r){var a,o;return n=n==null?0:+n,r=r==null?1:+r,function(){var s;if(a!=null)s=a,a=null;else do a=e()*2-1,s=e()*2-1,o=a*a+s*s;while(!o||o>1);return n+r*s*Math.sqrt(-2*Math.log(o)/o)}}return i.source=t,i}(RS);(function t(e){function i(){var n=Qtt.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(RS);const eit=function t(e){function i(n){return function(){for(var r=0,a=0;a<n;++a)r+=e();return r}}return i.source=t,i}(RS);(function t(e){function i(n){var r=eit.source(e)(n);return function(){return r()/n}}return i.source=t,i})(RS);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(RS);function lA(){this._=null}function zx(t){t.U=t.C=t.L=t.R=t.P=t.N=null}lA.prototype={constructor:lA,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=TX(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(ZS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,XS(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(XS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,ZS(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,a,o;if(n?r?a=TX(r):a=n:a=r,e?e.L===t?e.L=a:e.R=a:this._=a,n&&r?(o=a.C,a.C=t.C,a.L=n,n.U=a,a!==r?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=r,r.U=a):(a.U=e,e=a,t=a.R)):(o=t.C,t=a),t&&(t.U=e),!o){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,ZS(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,XS(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,ZS(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,XS(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,ZS(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,XS(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function ZS(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function XS(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function TX(t){for(;t.L;)t=t.L;return t}function mT(t,e,i,n){var r=[null,null],a=cs.push(r)-1;return r.left=t,r.right=e,i&&uA(r,t,e,i),n&&uA(r,e,t,n),Uu[t.index].halfedges.push(a),Uu[e.index].halfedges.push(a),r}function JS(t,e,i){var n=[e,i];return n.left=t,n}function uA(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function tit(t,e,i,n,r){var a=t[0],o=t[1],s=a[0],l=a[1],u=o[0],c=o[1],d=0,p=1,f=u-s,h=c-l,m;if(m=e-s,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=n-s,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[s+d*f,l+d*h]),p<1&&(t[1]=[s+p*f,l+p*h])),!0}}}}}function iit(t,e,i,n,r){var a=t[1];if(a)return!0;var o=t[0],s=t.left,l=t.right,u=s[0],c=s[1],d=l[0],p=l[1],f=(u+d)/2,h=(c+p)/2,m,g;if(p===c){if(f<e||f>=n)return;if(u>d){if(!o)o=[f,i];else if(o[1]>=r)return;a=[f,r]}else{if(!o)o=[f,r];else if(o[1]<i)return;a=[f,i]}}else if(m=(u-d)/(p-c),g=h-m*f,m<-1||m>1)if(u>d){if(!o)o=[(i-g)/m,i];else if(o[1]>=r)return;a=[(r-g)/m,r]}else{if(!o)o=[(r-g)/m,r];else if(o[1]<i)return;a=[(i-g)/m,i]}else if(c<p){if(!o)o=[e,m*e+g];else if(o[0]>=n)return;a=[n,m*n+g]}else{if(!o)o=[n,m*n+g];else if(o[0]<e)return;a=[e,m*e+g]}return t[0]=o,t[1]=a,!0}function nit(t,e,i,n){for(var r=cs.length,a;r--;)(!iit(a=cs[r],t,e,i,n)||!tit(a,t,e,i,n)||!(Math.abs(a[0][0]-a[1][0])>Qr||Math.abs(a[0][1]-a[1][1])>Qr))&&delete cs[r]}function rit(t){return Uu[t.index]={site:t,halfedges:[]}}function ait(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function iTe(t,e){return e[+(e.left!==t.site)]}function oit(t,e){return e[+(e.left===t.site)]}function sit(){for(var t=0,e=Uu.length,i,n,r,a;t<e;++t)if((i=Uu[t])&&(a=(n=i.halfedges).length)){var o=new Array(a),s=new Array(a);for(r=0;r<a;++r)o[r]=r,s[r]=ait(i,cs[n[r]]);for(o.sort(function(l,u){return s[u]-s[l]}),r=0;r<a;++r)s[r]=n[o[r]];for(r=0;r<a;++r)n[r]=s[r]}}function lit(t,e,i,n){var r=Uu.length,a,o,s,l,u,c,d,p,f,h,m,g,v=!0;for(a=0;a<r;++a)if(o=Uu[a]){for(s=o.site,u=o.halfedges,l=u.length;l--;)cs[u[l]]||u.splice(l,1);for(l=0,c=u.length;l<c;)h=oit(o,cs[u[l]]),m=h[0],g=h[1],d=iTe(o,cs[u[++l%c]]),p=d[0],f=d[1],(Math.abs(m-p)>Qr||Math.abs(g-f)>Qr)&&(u.splice(l,0,cs.push(JS(s,h,Math.abs(m-t)<Qr&&n-g>Qr?[t,Math.abs(p-t)<Qr?f:n]:Math.abs(g-n)<Qr&&i-m>Qr?[Math.abs(f-n)<Qr?p:i,n]:Math.abs(m-i)<Qr&&g-e>Qr?[i,Math.abs(p-i)<Qr?f:e]:Math.abs(g-e)<Qr&&m-t>Qr?[Math.abs(f-e)<Qr?p:t,e]:null))-1),++c);c&&(v=!1)}if(v){var y,b,I,T=1/0;for(a=0,v=null;a<r;++a)(o=Uu[a])&&(s=o.site,y=s[0]-t,b=s[1]-e,I=y*y+b*b,I<T&&(T=I,v=o));if(v){var w=[t,e],S=[t,n],U=[i,n],P=[i,e];v.halfedges.push(cs.push(JS(s=v.site,w,S))-1,cs.push(JS(s,S,U))-1,cs.push(JS(s,U,P))-1,cs.push(JS(s,P,w))-1)}}for(a=0;a<r;++a)(o=Uu[a])&&(o.halfedges.length||delete Uu[a])}var nTe=[],v8;function uit(){zx(this),this.x=this.y=this.arc=this.site=this.cy=null}function EI(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,a=i.site;if(n!==a){var o=r[0],s=r[1],l=n[0]-o,u=n[1]-s,c=a[0]-o,d=a[1]-s,p=2*(l*d-u*c);if(!(p>=-hit)){var f=l*l+u*u,h=c*c+d*d,m=(d*f-u*h)/p,g=(l*h-c*f)/p,v=nTe.pop()||new uit;v.arc=t,v.site=r,v.x=m+o,v.y=(v.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,b=P1._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}P1.insert(y,v),y||(v8=v)}}}}function BI(t){var e=t.circle;e&&(e.P||(v8=e.N),P1.remove(e),nTe.push(e),zx(e),t.circle=null)}var rTe=[];function cit(){zx(this),this.edge=this.site=this.circle=null}function UX(t){var e=rTe.pop()||new cit;return e.site=t,e}function jF(t){BI(t),$I.remove(t),rTe.push(t),zx(t)}function dit(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,o=t.N,s=[t];jF(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<Qr&&Math.abs(n-l.circle.cy)<Qr;)a=l.P,s.unshift(l),jF(l),l=a;s.unshift(l),BI(l);for(var u=o;u.circle&&Math.abs(i-u.circle.x)<Qr&&Math.abs(n-u.circle.cy)<Qr;)o=u.N,s.push(u),jF(u),u=o;s.push(u),BI(u);var c=s.length,d;for(d=1;d<c;++d)u=s[d],l=s[d-1],uA(u.edge,l.site,u.site,r);l=s[0],u=s[c-1],u.edge=mT(l.site,u.site,null,r),EI(l),EI(u)}function pit(t){for(var e=t[0],i=t[1],n,r,a,o,s=$I._;s;)if(a=aTe(s,i)-e,a>Qr)s=s.L;else if(o=e-fit(s,i),o>Qr){if(!s.R){n=s;break}s=s.R}else{a>-Qr?(n=s.P,r=s):o>-Qr?(n=s,r=s.N):n=r=s;break}rit(t);var l=UX(t);if($I.insert(n,l),!(!n&&!r)){if(n===r){BI(n),r=UX(n.site),$I.insert(l,r),l.edge=r.edge=mT(n.site,l.site),EI(n),EI(r);return}if(!r){l.edge=mT(n.site,l.site);return}BI(n),BI(r);var u=n.site,c=u[0],d=u[1],p=t[0]-c,f=t[1]-d,h=r.site,m=h[0]-c,g=h[1]-d,v=2*(p*g-f*m),y=p*p+f*f,b=m*m+g*g,I=[(g*y-f*b)/v+c,(p*b-m*y)/v+d];uA(r.edge,u,h,I),l.edge=mT(u,t,null,I),r.edge=mT(t,h,null,I),EI(n),EI(r)}}function aTe(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var o=t.P;if(!o)return-1/0;i=o.site;var s=i[0],l=i[1],u=l-e;if(!u)return s;var c=s-n,d=1/a-1/u,p=c/u;return d?(-p+Math.sqrt(p*p-2*d*(c*c/(-2*u)-l+u/2+r-a/2)))/d+n:(n+s)/2}function fit(t,e){var i=t.N;if(i)return aTe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var Qr=1e-6,hit=1e-12,$I,Uu,P1,cs;function mit(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function git(t,e){return e[1]-t[1]||e[0]-t[0]}function DX(t,e){var i=t.sort(git).pop(),n,r,a;for(cs=[],Uu=new Array(t.length),$I=new lA,P1=new lA;;)if(a=v8,i&&(!a||i[1]<a.y||i[1]===a.y&&i[0]<a.x))(i[0]!==n||i[1]!==r)&&(pit(i),n=i[0],r=i[1]),i=t.pop();else if(a)dit(a.arc);else break;if(sit(),e){var o=+e[0][0],s=+e[0][1],l=+e[1][0],u=+e[1][1];nit(o,s,l,u),lit(o,s,l,u)}this.edges=cs,this.cells=Uu,$I=P1=cs=Uu=null}DX.prototype={constructor:DX,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return iTe(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(s=(a=i.halfedges).length)for(var r=i.site,a,o=-1,s,l,u=e[a[s-1]],c=u.left===r?u.right:u.left;++o<s;)l=c,u=e[a[o]],c=u.left===r?u.right:u.left,l&&c&&n<l.index&&n<c.index&&mit(r,l,c)<0&&t.push([r.data,l.data,c.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var l=t-s.site[0],u=e-s.site[1],c=l*l+u*u;do s=n.cells[r=a],a=null,s.halfedges.forEach(function(d){var p=n.edges[d],f=p.left;if(!((f===s.site||!f)&&!(f=p.right))){var h=t-f[0],m=e-f[1],g=h*h+m*m;g<c&&(c=g,a=f.index)}});while(a!==null);return n._found=r,i==null||c<=i*i?s.site:null}};function gT(t,e,i){this.k=t,this.x=e,this.y=i}gT.prototype={constructor:gT,scale:function(t){return t===1?this:new gT(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new gT(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};gT.prototype;const vit=function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),a=e(i.tiereaks_at),o=a>r?r:a;n.setFormat={setTo:r,tiebreakAt:o,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t}(),oTe=function(){let t={};function e(o,s){let l=parseInt(o);return isNaN(l)?s:l}function i({source:o={},objects:s=[]}){let l=Object.assign({},o);return s&&!Array.isArray(s)&&(s=[s]),s=s.filter(u=>u),s.forEach(u=>{if(typeof u!="object")return;Object.keys(u).forEach(d=>l[d]=l[d]!==void 0?l[d]:u[d])}),l}t.setsToWin=o=>o&&Math.ceil(o/2)||1,t.tiebreakTo=(o,s)=>{var c,d,p,f;let l=(d=(c=o==null?void 0:o.setFormat)==null?void 0:c.tiebreakFormat)==null?void 0:d.tiebreakTo,u=(f=(p=o==null?void 0:o.finalSetFormat)==null?void 0:p.tiebreakFormat)==null?void 0:f.tiebreakTo;return s?u:l},t.matchFormat=n;function n(o){return(o||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:o})=>{if(o!=null&&o.score)return r({string_score:o.score,winner_index:o.winner_index,matchFormat:o.matchFormat})},t.generateMatchFormat=({cfg_obj:o})=>{let s=o.bestof.ddlb.getValue(),l=e(s),u=oTe.setsToWin(l),c={max_sets:l,sets_to_win:u,games_for_set:e(o.setsto.ddlb.getValue()),tiebreaks_at:e(o.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(o.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(o.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:o.finalset.ddlb.getValue()!=="N"};return{matchFormat:Ep.stringify(vit.jsonTODS(c)),score_format:c}},t.getScoringFormat=({e:o,match:s})=>{var c,d;let l=(s==null?void 0:s.format)||((o==null?void 0:o.format)==="D"?"doubles":"singles"),u=[s==null?void 0:s.score_format,(c=s==null?void 0:s.match)==null?void 0:c.score_format,(d=o.scoring_format)==null?void 0:d[l],o.score_format];return i({objects:u})},t.defaultMatchFormat=({format:o,category:s,env:l})=>{let u=l.scoreboard.matchFormats,c={S:"singles",D:"doubles"};return Object.keys(c).indexOf(o)>=0&&(o=c[o]),o&&s&&u.categories[s]&&u.categories[s][o]?u.categories[s][o]:o&&u[o]?u[o]:u.singles},t.convertStringScore=r;function r({string_score:o,winner_index:s,split:l=" ",matchFormat:u}){if(!o)return[];o=s?a(o):o;let c=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,f=Ep.parse(u),h=o.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(b=>d.exec(b)?{games:+d.exec(b)[1]}:void 0).filter(b=>b);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let b;return p.test(y)?(g=+p.exec(y)[2],b={games:+p.exec(y)[1]}):d.test(y)?b={games:+d.exec(y)[1]}:c=y,b||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(b=>b.games));v.forEach(b=>{+b.games==+y?b.tiebreak=g:b.spacer=g})}return v});if(h=h.filter(m=>m&&m.length===2),h.forEach(m=>{var y;let g=f&&(f.finalSetFormat||f.setFormat),v=(y=g==null?void 0:g.tiebreakSet)==null?void 0:y.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),s!==void 0&&(h.winner_index=s),c){if(c==="Cancelled"&&(h.cancelled=!0),c==="Abandoned"&&(h.abandoned=!0),c==="INC."&&(h.incomplete=!0),c==="INT."&&(h.interrupted=!0),c==="LIVE"&&(h.live=!0),c==="TIME"&&(h.time=!0),c==="DEF."&&(h.default=!0),c==="W.O."&&(h.walkover=!0),!h.length)return h;s!==void 0&&(h[h.length-1][1-s].outcome=c,h[h.length-1].outcome=c,h.outome=c)}return h}t.reverseScore=a;function a(o,s=" "){let l=null;if(o){let d=o.split(s).map(u).join(s);return l?`${l} ${d}`:d}function u(d){let p=d.indexOf("/")>0?"/":"-",f=d.split(p).map(c).reverse().filter(y=>y),h=f.map(y=>y.games),m=f.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?h.join(p):h.map((y,b)=>`${y}(${m[b]})`).join(p)}${g}`}function c(d){let p=/(\d+)/,f=/(\d+)\((\d+)\)/;if(f.test(d))return{games:f.exec(d)[1],tiebreak:f.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t}(),Ba=function(){let t={};function e(l,u){let c=1;if(Array.from(l.classList).indexOf(u)>=0)return{elem:l,depth:c};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(u)>=0)return{elem:l,depth:c};c+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:u,css_class:c,id:d,locked:p,max:f,maxFx:h,value_attribute:m=!0,background:g}){var v,y,b,I,T;!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=f,this.maxFx=h,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=c,this.value_attribute=m,this.list=(v=this.el)==null?void 0:v.querySelector(".dd_state"),this.options=(y=this.el)==null?void 0:y.querySelector(".options"),this.label=(b=this.el)==null?void 0:b.querySelector("div:first-of-type"),this.opts=((I=this.list)==null?void 0:I.querySelectorAll("li"))||[],this.selection=((T=this.list)==null?void 0:T.querySelector(i))||void 0,typeof u=="function"&&(this.onChange=u),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",u=>{if(l.locked)return;let{elem:c,depth:d}=e(u.target,"dd_state"),{elem:p,depth:f}=e(u.target,"dd_option"),h=c&&Array.from(c.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),c&&(!f||d<f)&&c.classList[h?"remove":"add"]("active"),u.stopPropagation()})))}function a(l){Array.from(l.opts).forEach(u=>{u.addEventListener("click",()=>{l.list.classList.remove("active");let c=u.querySelector(i),d=c.getAttribute("value");l.selection.innerHTML=c.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function o(l,u){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${u||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),a(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,u=""){if(!Array.isArray(l)||!l.length||!this.list)return;let c=this.list.querySelector("ul");if(c)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),c.innerHTML=l.map(d=>o(d,u)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),a(this),this},getOptions(){return Array.from(this.opts).map(l=>{let u=l.querySelector(i);return{key:u.innerHTML,value:u.getAttribute("value")}})},setLabel(l,u,c,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(u),this.labelColor(c),this.borderColor(d))},setValue(l,u,c,d){let p=Array.from(this.opts).filter(h=>h.querySelector(i).getAttribute("value")==l),f=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=f,this.selectionBackground(u),this.labelColor(c),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options&&this.options.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let s=(l,u=[],c,d=!0,p,f)=>{let h=c!==void 0&&u[c]?u[c].key:"",m=d?"style='border: 1px solid #000;'":"",g=u.map(v=>o(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${h}</span>
                  <div>
                     <ul class='${f?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:u,label:c="",options:d,selected:p=0,css_class:f,border:h,style:m,floatleft:g,display:v="flex"})=>{!u&&!l||(l=l||document.getElementById(u),l&&(l.style.display=v,l.classList.add(f||"dd"),l.innerHTML=s(c,d,p,h,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(u=>{u.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t}(),PX=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},EX=1500;function CX({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let a=VSe(t);o();function o(){let s=a.select("."+e),l=s.style("display"),u=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&u==="flex"?(s.style("height","0px"),s.style("display",u).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&u==="none")&&s.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const yit=function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",a=>{if(a.key&&a.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),a.key&&t.numericFx&&typeof t.numericFx=="function"){let o=["0","1","2","3","4","5","6","7","8","9"].indexOf(a.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(a.key);o>=0?t.numericFx(o):s>=0&&t.numericFx(s,1)}});let e={};tA.register("setClick","tap",i);function i(a){let o=ly(a,"set_number");if(!o)return;let s=o.getAttribute("setnum"),l=ly(a,"muid").getAttribute("muid");e[l]&&typeof e[l]=="function"&&e[l](s)}let n={auto_score:!0},r={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=a=>{if(!a)return r;DSe(a,r)},t.setMatchScore=({muid:a,lock:o,match:s,teams:l,grouped:u,callback:c,round_name:d,matchFormat:p,existing_scores:f,auto_score:h=!0})=>{var qe,ye,_e,Ae,Ve,Ke;n.auto_score=h;let m={...n},g=Ep.parse(p||"SET3-S:6/TB7");if(!g)return;let v=(qe=g==null?void 0:g.setFormat)==null?void 0:qe.tiebreakAt,y=(ye=g==null?void 0:g.setFormat)==null?void 0:ye.setTo,b=g.bestOf,I=oTe.setsToWin(b),T=g.finalSetFormat||g.setFormat,w=(_e=T==null?void 0:T.tiebreakSet)==null?void 0:_e.tiebreakTo,S=(Ve=(Ae=g==null?void 0:g.setFormat)==null?void 0:Ae.tiebreakFormat)==null?void 0:Ve.tiebreakTo,U=(Ke=g==null?void 0:g.finalSetFormat)==null?void 0:Ke.tiebreakSet,P,E,D,R,N,M=XJe.display({muid:a,teams:l});M.details.element.style.display="none",d&&(M.round_name.element.innerHTML=d),M.details.element.innerHTML=bit(s),M.scoring.element.style.display=o?"none":"inline",M.favorite.element.style.display=o?"inline":"none",a&&(e[a]=he=>{o||(R.length-he>1&&(R=R.slice(0,R.length-1),he=R.length-1,fe()),Ie({selected_set:he}),A(!0),B(),M.scoring.element.style.display="inline",M.edit_scoring.element.style.display="inline")});let A=he=>{let ve=he&&!o;N=ve,CX({elem:M.actions.element,type:"edit",height:50,visible:ve}),M.scoring.element.style.display=N||o?"none":"inline",M.edit_scoring.element.style.display=N?"none":"inline"};Ze({sobj:M,changeFx:x}),z(),V(),q(),k();function _(){return[]}function k(){if(R=f?_():[],N=!1,D=!1,t.enterFx=()=>{N&&j()},B(),H(),P=me(!u)!==void 0?R.length:Math.max(0,R.length-1),f&&(Object.keys(f).length||f.length||f.walkover||f.default)){let ve=R.length?R[R.length-1]:void 0;if(R.interrupted)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("interrupted"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),ve&&Q(ve[0].games,ve[1].games)&&(P+=1);else if(R.abandoned)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("abandoned"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0);else if(R.cancelled)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("cancelled"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0);else if(R.incomplete)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("incomplete"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),ve&&Q(ve[0].games,ve[1].games)&&(P+=1);else if(R.live)M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue("live"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),ve&&Q(ve[0].games,ve[1].games)&&(P+=1),m.auto_score=!1;else if(R.retired){let Ce=f.winner_index!==void 0?1-f.winner_index:void 0;M.p1action.ddlb.setValue(Ce===0?"retired":"winner"),M.p2action.ddlb.setValue(Ce===1?"retired":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),F(1-Ce)}else if(R.time){let Ce=f.winner_index!==void 0?1-f.winner_index:void 0;M.p1action.ddlb.setValue(Ce===0?"time":"winner"),M.p2action.ddlb.setValue(Ce===1?"time":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),F(1-Ce)}else if(R.default){let Ce=f.winner_index!==void 0?1-f.winner_index:void 0;M.p1action.ddlb.setValue(Ce===0?"defaulted":"winner"),M.p2action.ddlb.setValue(Ce===1?"defaulted":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!1),F(1-Ce)}else if(R.walkover){let Ce=f.winner_index!==void 0?1-f.winner_index:void 0;M.p1action.ddlb.setValue(Ce===0?"walkover":"winner"),M.p2action.ddlb.setValue(Ce===1?"walkover":"winner"),M.p1action.ddlb.lock(),M.p2action.ddlb.lock(),A(!0),F(1-Ce)}else A(!1)}else M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ");(R.time||R.retired||R.default||R.walkover)&&(P=void 0),Ie({selected_set:P,actions:!u})}function B(){Array.from(M.root.element.querySelectorAll(".victor")).forEach(ve=>ve.classList.remove("victor")),o||fe()}function F(he){Array.from(M.root.element.querySelectorAll(`.opponent${he}`)).forEach(De=>De.classList.add("victor")),Array.from(M.root.element.querySelectorAll(`.opponent${he} .hasvalue`)).forEach(De=>De.classList.add("victor"))}function x(){B(),P=0,R=[],Le(),be(),H(),t.enterFx=void 0,M.p2action.ddlb.setValue(" "),M.p1action.ddlb.setValue(" "),m.auto_score=n.auto_score,Ie({selected_set:P})}function $(he){let ve={bestOf:b,setFormat:{setTo:y,tiebreakAt:v,tiebreakFormat:{tiebreakTo:S}}};U&&(ve.finalSetFormat={tiebreakSet:{tiebreakTo:w}});const Ce=Ep.stringify(ve);if(he){const De=R.map((Ue,Qe)=>Wt.definedAttributes({side1TiebreakScore:Ue[0].supertiebreak,side2TiebreakScore:Ue[1].supertiebreak,side1score:Ue[0].games,side2score:Ue[1].games,setNumber:Qe+1}));he.sets=De,he.set_scores=R,he.matchUpFormat=Ce}he&&typeof c=="function"&&c(he),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,VSe(M.scoreboard.element).remove()}function j(){t.numericFx=void 0,t.enterFx=void 0,me(),$(Ne())}function V(){M.cancel.element.addEventListener("click",()=>$(),!1),M.accept.element.addEventListener("click",j,!1),M.clear.element.addEventListener("click",x,!1),M.scoring.element.addEventListener("click",he,!1);function he(){let Ce=M.scoring.element.innerHTML==="-";Ce||(M.edit_scoring.element.style.overflow="hidden"),M.scoring.element.innerHTML=Ce?"&#x25A2;":"-",ve(M.edit_scoring.element,Ce)}function ve(Ce,De){let Ue=800;CX({elem:Ce,type:"edit",height:100,visible:De,duration:Ue}),De&&setTimeout(function(){Ce.style.overflow="visible"},Ue)}}function H(){let he=[{key:"-",value:""}],ve=y===v?y+2:y+1;Wt.generateRange(0,ve).forEach(je=>he.push({key:je,value:je}));let Ce=je=>J(0,je),De=je=>J(1,je);Ba.attachDropDown({id:M.p1selector.id,options:he,border:!1}),Ba.attachDropDown({id:M.p2selector.id,options:he,border:!1}),M.p1selector.ddlb=new Ba.DropDown({element:M.p1selector.element,onChange:Ce,id:M.p1selector.id,value_attribute:!1}),M.p2selector.ddlb=new Ba.DropDown({element:M.p2selector.element,onChange:De,id:M.p2selector.id,value_attribute:!1}),o&&(M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock()),M.p1selector.ddlb.selectionBackground(),M.p2selector.ddlb.selectionBackground();let Ue;t.numericFx=(je,ke=0)=>{Ue=new Date().getTime(),M.p1tiebreak.element.style.display==="none"&&je<ve?(ke?M.p1selector.ddlb.setValue(je):M.p2selector.ddlb.setValue(je),J(1-ke,je)):setTimeout(function(){Qe()},EX)};function Qe(){if(new Date().getTime()-Ue>EX){let ke=+M.p1tiebreak.element.value,bt=+M.p2tiebreak.element.value;(ke!=""||bt!="")&&(E?Z(ke,bt,!0):Y(ke,bt,!0))}}}function z(){let he=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${ZJe}' class='completed_icon'></div>`,value:"winner"}],ve=De=>Me(0,De),Ce=De=>Me(1,De);Ba.attachDropDown({id:M.p1action.id,options:he,border:!1,floatleft:!0}),Ba.attachDropDown({id:M.p2action.id,options:he,border:!1,floatleft:!0}),M.p1action.ddlb=new Ba.DropDown({element:M.p1action.element,onChange:ve,id:M.p1action.id}),M.p2action.ddlb=new Ba.DropDown({element:M.p2action.element,onChange:Ce,id:M.p2action.id}),o&&(M.p1action.ddlb.lock(),M.p2action.ddlb.lock()),M.p1action.ddlb.selectionBackground(),M.p2action.ddlb.selectionBackground()}function q(){let he=Ce=>W(Ce,0),ve=Ce=>W(Ce,1);M.p1tiebreak.element.addEventListener("keyup",he,!1),M.p2tiebreak.element.addEventListener("keyup",ve,!1)}function W(he,ve,Ce){let De=+M.p1tiebreak.element.value,Ue=+M.p2tiebreak.element.value;(he.which===13||Ce)&&(De!=""||Ue!="")&&(E?Z(De,Ue,!0):Y(De,Ue,!0));let Qe=M[ve?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),je=Qe&&!isNaN(Qe[0])?parseInt(Qe[0].toString().slice(-2)):void 0,ke=E?w:S,bt=je===void 0||je==""||je+2<ke?ke:je+2;M[ve?"p2tiebreak":"p1tiebreak"].element.value=je!==void 0?je:"",m.auto_score&&!oe()&&(M[ve?"p1tiebreak":"p2tiebreak"].element.value=bt)}function Y(he,ve,Ce){let De=R.length,Ue=De>P?De-1:P-1;R!=null&&R[Ue]&&(R[Ue][0][he<ve?"tiebreak":"spacer"]=he<ve?he:ve,R[Ue][1][ve<he?"tiebreak":"spacer"]=ve<he?ve:he,Ce&&X())}function Z(he,ve,Ce){if(he<w&&ve<w)return;let De=[{supertiebreak:he},{supertiebreak:ve}],Ue=R.length;Ue&&R[Ue-1][0].supertiebreak!==void 0?R[Ue-1]=De:R.push(De),Ce&&X()}function X(){Le(),me()!==void 0&&A(!0),Ie({selected_set:P})}function Q(he,ve){let Ce=Math.abs(he-ve);return!v&&(+he===y||+ve===y)?!0:Ce>=2&&(+he>=y||+ve>=y)}function ce(he,ve){return v?+he===v+1&&+ve===v||+he===v&&+ve===v+1:!1}function J(he,ve){if(ve===""){M.p1selector.ddlb.setValue(""),M.p2selector.ddlb.setValue(""),R[P]=[{games:0},{games:0}];return}se()&&fe();let Ce=!1;Le(),ne()&&(P=R.length-1,M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),be());let De=M.p1selector.ddlb.getValue(),Ue=M.p2selector.ddlb.getValue();m.auto_score?he===0&&Ue===""?(Ue=je(ve),M.p2selector.ddlb.setValue(Ue)):he===1&&De===""?(De=je(ve),M.p1selector.ddlb.setValue(De)):v?(+De===v+1&&+Ue===v+1&&Qe(v),+De===v+1&&+Ue<v-1&&Qe(v),+Ue===v+1&&+De<v-1&&Qe(v)):+De===y&&+Ue===y&&Qe(y-1):he===0&&!Ue?(Ue=0,M.p2selector.ddlb.setValue(Ue)):he===1&&!De&&(De=0,M.p1selector.ddlb.setValue(De)),R[P]=[{games:PX(De)||0},{games:PX(Ue)||0}],!Q(De,Ue)&&!ce(De,Ue)?(R=R.slice(0,P+1),Ie({selected_set:P})):(ce(De,Ue)&&(Ce=!0),me(),ee(De,Ue,Ce));function Qe(ke){he?(De=ke,M.p1selector.ddlb.setValue(De)):(Ue=ke,M.p2selector.ddlb.setValue(Ue))}function je(ke){return ke===""?"":v?((+ke===v||+ke===v+1)&&(Ce=!0),+ke===v-1||+ke===v?parseInt(v||0)+1:+ke<v?y:v):+ke===y?y-1:(+ke===y-1,y)}}function ee(he,ve,Ce){Ce&&!o&&(M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M[he>ve?"p1tiebreak":"p2tiebreak"].element.disabled=!0,M[he>ve?"p2tiebreak":"p1tiebreak"].element.disabled=!1,M[he>ve?"p2tiebreak":"p1tiebreak"].element.focus(),A(!1));let De=he!==""&&ve!=="",Ue=me()===void 0&&oe()===void 0;De&&Ue&&P+1<b&&(P+=1),Ie({selected_set:P,tiebreak:Ce})}function ne(){let he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue();return he==="winner"||ve==="winner"}function ie(){let he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(he)>=0||["cancelled","incomplete","abandoned"].indexOf(ve)>=0)return!1}function oe(){let he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(he)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(ve)>=0)return 1}function se(){let he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue();return["interrupted"].indexOf(he)>=0||["interrupted"].indexOf(ve)>=0}function pe(){let he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue();return["live"].indexOf(he)>=0||["live"].indexOf(ve)>=0}function fe(){pe()||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" ")),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function ge(){return R.length?R.map(ve=>{let Ce=isNaN(ve[0].games)?ve[0].games:+ve[0].games,De=isNaN(ve[1].games)?ve[1].games:+ve[1].games;if(Ce!==void 0&&De!==void 0&&Ce!==""&&De!==""){if(ce(Ce,De)&&ve[0].tiebreak===void 0&&ve[1].tiebreak===void 0)return[0,0];const Ue=+Ce===y&&+Ce==+De+1,Qe=+De===y&&+De==+Ce+1;if(v)if(!v||y===v){if(Ue)return[0,0];if(+De===y&&+De==+Ce+1)return[0,0]}else{if(Ue)return[1,0];if(Qe)return[0,1]}else{if(+Ce===y&&+Ce==+De+1)return[1,0];if(+De===y&&+De==+Ce+1)return[0,1]}if(Ce>De&&Ce>=y)return[1,0];if(De>Ce&&De>=y)return[0,1]}else if(ve[0].supertiebreak!==void 0&&ve[1].supertiebreak!==void 0){if(ve[0].supertiebreak>ve[1].supertiebreak+1&&ve[0].supertiebreak>=w)return[1,0];if(ve[1].supertiebreak>ve[0].supertiebreak+1&&ve[1].supertiebreak>=w)return[0,1]}return[0,0]}).reduce((ve,Ce)=>[ve[0]+Ce[0],ve[1]+Ce[1]]):[0,0]}function me(he=!0){if(!R.length)return;let ve=ge();if(+ve[0]==+ve[1]&&!pe()&&!se()&&!ie()&&oe()===void 0)return;let Ce=Math.max(...ve),De=Math.max(I,Math.floor(R.length/2)+1);if(Ce<De)return;const Ue=ve[0]>=De&&1||(ve[1]>=De?2:void 0);if(Ue===void 0&&!pe()&&!se()&&!ie()&&oe()===void 0){A(!1);return}return M.p1tiebreak.element.style.display!=="inline"&&he&&A(!0),M[Ue===1?"p1action":"p2action"].ddlb.setValue("winner"),M[Ue===2?"p1action":"p2action"].ddlb.setValue(""),M[Ue===2?"p1action":"p2action"].ddlb.lock(),F(Ue-1),P=R.length,Ue-1}function Ee(he){let ve=R.length;return+he===R.length-1&&ve&&R[ve-1][0].supertiebreak!==void 0?R[ve-1]:!1}function Be(he,ve){return U?me(ve)!==void 0&&Ee(he)?!0:Pe(he):!1}function Pe(he){let ve=ge();if(+ve[0]==+ve[1]&&+ve[0]+1===I&&+he==+R.length)return!0}function et(he,ve,Ce){return ve||D||he===void 0?!1:R.length===0?!0:!((me(Ce)!==void 0||oe()!==void 0)&&(he===void 0||+he===R.length))}function Ie({selected_set:he,tiebreak:ve,actions:Ce}){E=Be(he,Ce);let De=et(he,ve||E,Ce);if(!De&&!E&&(he=R.length),P=Math.min(b-1,+he),De&&Le(),E&&!o){let Gt=Pe(he);M.p1tiebreak.element.style.display="inline",M.p2tiebreak.element.style.display="inline",M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,Gt||(M.p1action.ddlb.setValue(" "),M.p2action.ddlb.setValue(" "),A(!1));let Zt=Ee(he);Zt&&(M.p1tiebreak.element.value=Zt[0].supertiebreak,M.p2tiebreak.element.value=Zt[1].supertiebreak)}let Ue=R[he],Qe=o?R:R.slice(0,+he),je=R.slice(+he+1);o&&!R.length&&(Qe=[[{games:0},{games:0}]]);let ke=Qe.map((Gt,Zt)=>FC({setnum:Zt,score:Gt[0]})).join(""),bt=Qe.map((Gt,Zt)=>FC({setnum:Zt,score:Gt[1]})).join("");M.p1scores.element.innerHTML=ke,M.p2scores.element.innerHTML=bt,M.p1selector.ddlb.setValue(Ue?Ue[0].games+"":""),M.p2selector.ddlb.setValue(Ue?Ue[1].games+"":""),M.p1selector.element.style.display=De&&!D&&!o?"flex":"none",M.p2selector.element.style.display=De&&!D&&!o?"flex":"none",ke=je.map((Gt,Zt)=>FC({setnum:+he+1+Zt,score:Gt[0]})).join(""),bt=je.map((Gt,Zt)=>FC({setnum:+he+1+Zt,score:Gt[1]})).join(""),M.p1scores_e.element.innerHTML=ke,M.p2scores_e.element.innerHTML=bt}function Ne(){const he=M.p1action.ddlb.getValue(),ve=M.p2action.ddlb.getValue(),Ce=he==="winner"&&1||ve==="winner"&&2||void 0;let De=[1,2].includes(Ce),Ue=R.map(je=>{if(je[0].supertiebreak)return`[${je[0].supertiebreak}-${je[1].supertiebreak}]`;let ke=je[0].tiebreak,bt=je[1].tiebreak,Gt=ke!==void 0||bt!==void 0?`(${[ke,bt].filter(Zt=>Zt>=0).join("-")})`:"";return`${je[0].games}-${je[1].games}${Gt}`}).join(" "),Qe;return[1,2].includes(Ce)&&(Qe="COMPLETED"),(he==="retired"||ve==="retired")&&(Qe="RETIRED"),(he==="time"||ve==="time")&&(Ue+=" TIME"),(he==="walkover"||ve==="walkover")&&(Qe="WALKOVER",De=!0),(he==="defaulted"||ve==="defaulted")&&(Qe="DEFAULTED",De=!0),(he==="abandoned"||ve==="abandoned")&&(Qe="ABANDONED",De=!0,Ue=""),(he==="interrupted"||ve==="interrupted")&&(Qe="SUSPENDED",De=!1),(he==="live"||ve==="live")&&(Qe="IN_PROGRESS",De=!1),(he==="cancelled"||ve==="cancelled")&&(Qe="CANCELLED",De=!1),(he==="incomplete"||ve==="incomplete")&&(Qe="ABANDONED",De=!1),{matchUpStatus:Qe,winningSide:Ce,complete:De,score:Ue}}function be(){D=!1,M.p1selector.ddlb.unlock(),M.p2selector.ddlb.unlock(),M.p1action.ddlb.unlock(),M.p2action.ddlb.unlock()}function Le(){M.p1tiebreak.element.value="",M.p2tiebreak.element.value="",M.p1tiebreak.element.style.display="none",M.p2tiebreak.element.style.display="none"}function Me(he,ve){let Ce=M.p1action.ddlb.getValue(),De=M.p2action.ddlb.getValue(),Ue=me(),Qe=he?Ce:De;if(m.auto_score=n.auto_score,ve===""){Ue!==void 0&&(R=[],P=0,M[he?"p2action":"p1action"].ddlb.setValue(" ")),M[he?"p1action":"p2action"].ddlb.setValue(" "),be();let je=R.length;if(je){let ke=R[je-1];!ce(ke[0].games,ke[1].games)&&!Q(ke[0].games,ke[1].games)&&(P=je-1)}Ie({selected_set:P})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(ve)>=0?(M[he?"p1action":"p2action"].ddlb.setValue(" "),Ie({selected_set:P}),A(!0)):ve==="live"?(m.auto_score=!1,M[he?"p1action":"p2action"].ddlb.setValue(" "),Ie({selected_set:P}),A(!0)):ve==="winner"&&Qe==="winner"?(Ue===void 0&&M[he?"p1action":"p2action"].ddlb.setValue("retired"),Ie({selected_set:P}),A(!0)):["time","retired","walkover","defaulted"].indexOf(ve)>=0?(A(!0),Ue!==void 0?(M[Ue?"p2action":"p1action"].ddlb.setValue("winner"),M[Ue?"p1action":"p2action"].ddlb.setValue(" "),M[Ue?"p2action":"p1action"].ddlb.unlock(),M[Ue?"p1action":"p2action"].ddlb.lock()):(M.p1tiebreak.element.disabled=!1,M.p2tiebreak.element.disabled=!1,M[he?"p1action":"p2action"].ddlb.setValue("winner"),M[he?"p1action":"p2action"].ddlb.unlock(),M[he?"p2action":"p1action"].ddlb.lock(),(ve==="time"||ve==="retired"||ve==="defaulted")&&(Ue!==void 0&&M[he?"p2action":"p1action"].ddlb.setValue(" "),P=R.length),(ve==="time"||ve==="retired")&&!R.length&&M[he?"p2action":"p1action"].ddlb.setValue("walkover"),ve==="walkover"&&(R=[],P=0),Ie({selected_set:P}))):ve==="winner"&&(Ue===void 0?M[he?"p1action":"p2action"].ddlb.setValue(R.length?"retired":"walkover"):M[he?"p1action":"p2action"].ddlb.setValue(" "),M[he?"p1action":"p2action"].ddlb.lock(),D=!0,M.p1selector.ddlb.lock(),M.p2selector.ddlb.lock(),Ie({selected_set:P}))}function Ze({sobj:he,changeFx:ve}){Ba.attachDropDown({id:he.bestof.id,options:Ue(r.bestof)}),he.bestof.ddlb=new Ba.DropDown({element:he.bestof.element,id:he.bestof.id,onChange:Qe}),he.bestof.ddlb.setValue(b,"white"),Ba.attachDropDown({id:he.setsto.id,options:Ue(r.setsto)}),he.setsto.ddlb=new Ba.DropDown({element:he.setsto.element,id:he.setsto.id,onChange:bt}),he.setsto.ddlb.setValue(y,"white");let Ce=y,De=ke(Ce);Ba.attachDropDown({id:he.tiebreaksat.id,options:De}),he.tiebreaksat.ddlb=new Ba.DropDown({element:he.tiebreaksat.element,id:he.tiebreaksat.id,onChange:Gt}),he.tiebreaksat.ddlb.setValue(v&&v<Ce?v:Ce,"white"),he.tiebreaksat.ddlb.setValue(v||"","white"),Ba.attachDropDown({id:he.tiebreaksto.id,options:Ue(r.tiebreaksto)}),he.tiebreaksto.ddlb=new Ba.DropDown({element:he.tiebreaksto.element,id:he.tiebreaksto.id,onChange:Zt}),he.tiebreaksto.ddlb.setValue(S,"white"),Ba.attachDropDown({id:he.finalset.id,options:[{key:Lr.tr("scoring.normal"),value:"N"},{key:Lr.tr("scoring.supertiebreak"),value:"S"}]}),he.finalset.ddlb=new Ba.DropDown({element:he.finalset.element,id:he.finalset.id,onChange:Sr}),he.finalset.ddlb.selectionBackground(),he.finalset.ddlb.setValue(U?"S":"N","white"),Ba.attachDropDown({id:he.supertiebreakto.id,options:Ue(r.supertiebreakto)}),he.supertiebreakto.ddlb=new Ba.DropDown({element:he.supertiebreakto.element,id:he.supertiebreakto.id,onChange:Oo}),he.supertiebreakto.ddlb.selectionBackground(),he.supertiebreakto.ddlb.setValue(w||10,"white"),je(U);function Ue(ri){return!ri||!Array.isArray(ri)?{}:ri.map(Tr=>({key:Tr,value:Tr}))}function Qe(ri){b=parseInt(ri),I=Math.ceil(ri/2),U=!1,he.finalset.ddlb.setValue("N","white"),je(U),typeof ve=="function"&&ve()}function je(ri){he.stb2.element.style.opacity=ri?1:0,he.supertiebreakto.element.style.opacity=ri?1:0}function ke(ri){return[{key:Lr.tr("none"),value:""},{key:`${ri-1}-${ri-1}`,value:ri-1},{key:`${ri}-${ri}`,value:ri}]}function bt(ri){y=parseInt(ri),v=parseInt(ri);let Tr=ke(ri);he.tiebreaksat.ddlb.setOptions(Tr),he.tiebreaksat.ddlb.setValue(ri,"white"),typeof ve=="function"&&ve()}function Gt(ri){v=parseInt(ri),typeof ve=="function"&&ve()}function Zt(ri){S=parseInt(ri),typeof ve=="function"&&ve()}function Sr(ri){w=he.supertiebreakto.ddlb.getValue()||10,U=ri==="S"?{tiebreakTo:w}:!1,je(U),typeof ve=="function"&&ve()}function Oo(ri){w=parseInt(ri),typeof ve=="function"&&ve()}}},t}();function FC({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function bit(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=wit(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const Iit=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60,o=!e||(e==null?void 0:e.display_seconds),s=!e||(e==null?void 0:e.pad_hours);return n<10&&s&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),o?n+":"+r+":"+a:n+":"+r};function wit(t){if(!t.start||!t.end)return"";let e=RX(t.end)-RX(t.start);return Iit(e,{pad_hours:!1,display_seconds:!1})}function RX(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function qx({matchUpId:t,callback:e}){var o;const{matchUp:i}=$e.findMatchUp({matchUpId:t}),n=s=>{const{matchUpStatus:l,winningSide:u,score:c}=s,d=c&&$e.parseScoreString({scoreString:c}),p=[{method:B6,params:{allowChangePropagation:!0,drawId:i.drawId,outcome:{score:{sets:d},matchUpStatus:l,winningSide:u},matchUpId:t}}];yt({methods:p,callback:h=>{Hw(),rt(e)&&e({...h,outcome:s})}})},r=i.sides.map(s=>s.participant),a=((o=i.score)==null?void 0:o.sets)||[];yit.setMatchScore({delegation:ii.scoring.delegation,round_name:i.roundName||"",matchFormat:i.matchUpFormat,callback:n,muid:i.matchUpId,existing_scores:a,teams:r})}function Sit(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:a}=n;a&&qx({matchUpId:r,callback:s=>{var l;if(s.success){const{matchUpStatus:u,sets:c,matchUpFormat:d,score:p,winningSide:f}=s.outcome;Object.assign(n,{matchUpStatus:u,sets:c,matchUpFormat:d,score:p}),n.winningSide=f&&`side${f}`,i.update(n),e.getTable().redraw(!0);const m=(l=s.results.find(({methodName:g})=>g===B6))==null?void 0:l.tieMatchUpResult;Oit(m)}else console.log({result:s})}})}function Tit({matchUp:t}){var r,a,o,s,l,u;const e=((o=(a=(r=t.sides)==null?void 0:r.find(c=>c.sideNumber===1))==null?void 0:a.participant)==null?void 0:o.participantName)||"Side 1",i=((u=(l=(s=t.sides)==null?void 0:s.find(c=>c.sideNumber===2))==null?void 0:l.participant)==null?void 0:u.participantName)||"Side 2",n=(c,d)=>{var p;return(p=c==null?void 0:c.participantName)==null?void 0:p.localeCompare(d==null?void 0:d.participantName)};return[{formatter:rX(OC(t)),cellClick:(c,d)=>OC(t)({event:c,cell:d}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:rX(OC(t)),cellClick:(c,d)=>OC(t)({event:c,cell:d}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:c8,cellClick:Sit,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function Uit({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(o=>CS({...o,dualMatchUp:t})),r=Tit({matchUp:t});return{table:new da(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function sTe({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const o=Dit({side1Score:i,side2Score:n});return a.appendChild(t),a.appendChild(o),a.appendChild(e),r.appendChild(a),r}function cA({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function Dit({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function dA({winningSide:t,sets:e,sideNumber:i,id:n}){var l;const r=`side${i}Score`,a=((l=e==null?void 0:e[0])==null?void 0:l[r])||0,o=document.createElement("span");return n&&(o.id=n),o.className="side-score",i===1?o.style.paddingLeft="1rem":o.style.paddingRight="1rem",i===t&&o.classList.add("has-text-success"),o.innerHTML=a,o}let lTe;function uTe({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(_U);n&&Oa(n);const r=document.createElement("div");r.className="overlay noselect",r.id=_U;const a=document.createElement("div");a.className="overlay-center-align",r.appendChild(a);const o=document.createElement("div");if(o.className="overlay-root",a.appendChild(o),t){const c=Eit({title:t});o.appendChild(c)}const s=document.createElement("div");s.className="overlay-content",typeof e=="string"?s.innerHTML=e:e&&s.appendChild(e),o.appendChild(s);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),o.appendChild(l),document.body.appendChild(r),lTe=window.scrollY||document.documentElement.scrollTop;const u=document.getElementById("root");u.style.display=lt}function Pit({content:t}){var i,n;const e=(n=(i=document.getElementById(_U))==null?void 0:i.getElementsByClassName("overlay-content"))==null?void 0:n[0];e&&(Oa(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function Eit({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function cTe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:lTe});let e=document.getElementById(_U);Oa(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(_U)}const dTe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let rv,xr;const ZR="Timed set",vT="Tiebreak",yV="No-Ad",Tl="Set",ZT="Ad",lo={setFormat:{descriptor:"Best of",bestOf:3,advantage:ZT,what:Tl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:ZT,what:Tl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function MX(t){var a;const e=t?"finalSetFormat":"setFormat",i=lo[e].what,n={setTo:lo[e].setTo};return i===Tl&&lo[e].advantage===yV&&(n.NoAD=!0),i===Tl&&((a=document.getElementById(t?"finalSetTiebreak":"setTiebreak"))==null?void 0:a.checked)&&(n.tiebreakAt=lo[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:lo[e].tiebreakTo},i===Tl&&lo[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===ZR&&(n.minutes=lo[e].minutes,n.timed=!0),i===vT&&(n.tiebreakSet={tiebreakTo:lo[e].tiebreakTo},lo[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function pTe(){var o;const t=MX();xr={bestOf:lo.setFormat.bestOf,setFormat:t},((o=document.getElementById("finalSetOption"))==null?void 0:o.checked)&&(xr.finalSetFormat=MX(1));const i=EA.scoreGovernor.stringifyMatchUpFormat(xr),n=!!dTe.find(s=>s.format===i),r=document.getElementById("matchUpFormatSelector"),a=r==null?void 0:r.querySelectorAll("option");return Array.from(a).forEach(s=>{s.selected=!n&&s.value==="Custom"||s.value===i}),i}function yT(t){const e=t||pTe(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const av=(t,e)=>e&&t.finalSetFormat||t.setFormat,bI=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=av(t,e),n=i!=null&&i.NoAD?yV:ZT;return i!=null&&i.timed||i!=null&&i.tiebreakSet?void 0:n},options:[ZT,yV],defaultValue:ZT,id:"advantage",whats:[Tl]},{getValue:(t,e)=>{const i=av(t,e);return i||console.log({pmf:t}),i!=null&&i.timed?ZR:i!=null&&i.tiebreakSet?vT:Tl},options:[Tl,vT,ZR],finalSetLabel:`${Tl}${ap}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>av(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[Tl],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{var n,r;const i=av(t,e);return((n=i.tiebreakFormat)==null?void 0:n.tiebreakTo)||((r=i.tiebreakSet)==null?void 0:r.tiebreakTo)},options:[5,7,9,10,12],whats:[Tl,vT],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>av(t,e).tiebreakAt,options:t=>{const e=lo[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[Tl],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{var n;const i=av(t,e);if(i.tiebreakFormat)return(n=i.tiebreakFormat)!=null&&n.NoAD?1:2},whats:[Tl,vT],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=av(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[ZR],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],NX={changeWhat:(t,e,i)=>{const n=i===Tl,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(r);a.style.display=n?"":lt,bI.forEach(o=>{if(o.whats){const{prefix:s="",suffix:l="",pluralize:u}=o,c=o.whats.includes(i),d=e?`${o.id}-${e}`:o.id,p=document.getElementById(d);if(p.style.display===lt&&c){const f=xr.bestOf,h=!e&&u&&f>1?"s":"",m=o.defaultValue;p.innerHTML=`${s}${m}${h}${l}${ap}`}p.style.display=c?"":lt}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";lo[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${ap}`},pluralize:(t,e,i)=>{const n=lo[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",a=document.getElementById(r),o=i>1?"s":"";a.innerHTML=`${n}${o}${ap}`}};function y8({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){var T;rv=t,xr=Ep.parse(rv);const i=()=>{const w=pTe();rt(e)&&e(w)};let n,r,a,o,s;const l=[{onClick:()=>e(),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],u="switch is-rounded is-danger",c=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=rv,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",c.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const f={id:"matchUpFormatSelector",options:dTe.map(w=>({selected:w.format===rv,value:w.format,label:w.name}))},{field:h,inputElement:m}=kT(f);m.onchange=w=>{rv=w.target.value,yT(rv),xr=Ep.parse(rv),lo.setFormat=xr.setFormat,lo.setFormat.bestOf=xr.bestOf,xr.finalSetFormat&&(lo.finalSetFormat=xr.finalSetFormat);const S=xr.finalSetFormat;n.style.display=S?"":lt,r.style.display=S?"":lt,a.checked=S,s.checked=!!(S!=null&&S.tiebreakFormat),o.checked=xr.setFormat.tiebreakFormat,bI.forEach(U=>{if(U.getValue){const P=U.getValue(xr),E=document.getElementById(U.id);if(E&&P){const{prefix:D="",suffix:R="",pluralize:N}=U,M=xr.bestOf,A=N&&M>1?"s":"";E.innerHTML=`${D}${P}${A}${R}${ap}`,E.style.display=""}else E&&(E.style.display=lt);if(S){const D=U.getValue(xr,!0),R=document.getElementById(`${U.id}-1`);if(R&&D){const{prefix:N="",suffix:M="",pluralize:A}=U,_=xr.bestOf,k=A&&_>1?"s":"";R.innerHTML=`${N}${D}${k}${M}${ap}`,R.style.display=""}else R&&(R.style.display=lt)}}})},p.appendChild(h),c.appendChild(p);const g=document.createElement("div");bI.map(w=>{const S=w.getValue(xr);return AX({...w,value:S})}).forEach(w=>g.appendChild(w)),g.id="setFormat",c.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",o=document.createElement("input"),o.className=u,o.name="setTiebreak",o.id="setTiebreak",o.type="checkbox",o.checked=xr.tiebreakFormat,o.onchange=w=>{const S=w.target.checked;bI.filter(({tb:U})=>U).forEach(U=>{const P=document.getElementById(U.id);if(P.style.display===lt&&S){const{prefix:E="",suffix:D="",pluralize:R,defaultValue:N}=U,M=xr.bestOf,A=R&&M>1?"s":"";P.innerHTML=`${E}${N}${A}${D}${ap}`}P.style.display=S?"":lt}),yT()},v.appendChild(o);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),a=document.createElement("input"),a.className="switch is-rounded is-info",a.type="checkbox",a.name="finalSetOption",a.checked=!!xr.finalSetFormat,a.id="finalSetOption",a.onchange=w=>{const S=w.target.checked;n.style.display=S?"":lt,r.style.display=S?"":lt,yT()},v.appendChild(a);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",v.appendChild(b),c.appendChild(v),n=document.createElement("div"),n.style.display=xr.finalSetFormat?"":lt,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[]}].concat(bI.map(w=>{const S=w.getValue(xr,!0);return{...w,value:S}})).filter(w=>w.finalSet!==!1).map(w=>AX({...w,index:1})).forEach(w=>n.appendChild(w)),c.appendChild(n),r=document.createElement("div"),r.style.display=xr.finalSetFormat?"":lt,r.className="field",r.style.fontSize="1em",s=document.createElement("input"),s.className=u,s.name="finalSetTiebreak",s.id="finalSetTiebreak",s.type="checkbox",s.checked=(T=xr.finalSetFormat)==null?void 0:T.tiebreakFormat,r.onchange=w=>{const S=w.target.checked;bI.filter(({tb:U})=>U).forEach(U=>{const P=document.getElementById(`${U.id}-1`);if(P.style.display===lt&&S){const{prefix:E="",suffix:D="",pluralize:R,defaultValue:N}=U,M=xr.bestOf,A=R&&M>1?"s":"";P.innerHTML=`${E}${N}${A}${D}${ap}`}P.style.display=S?"":lt}),yT()},r.appendChild(s);const I=document.createElement("label");I.setAttribute("for","finalSetTiebreak"),I.id="finalSetTiebreakToggle",I.innerHTML="Tiebreak",I.style.marginRight="1em",r.appendChild(I),c.appendChild(r),yn({title:"Score format",content:c,buttons:l})}function Cit({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:a,pluralize:o}){const s=!t&&o&&lo.setFormat.bestOf>1?"s":"";return i||t&&e||`${n}${a}${s}${r}${ap}`}function AX(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,a=document.createElement("button");return a.className="mfcButton",a.id=n?`${e}-${n}`:e,a.innerHTML=Cit(t),a.onclick=o=>Rit({e:o,button:a,...t}),a.style.display=r||t.label?"":lt,i&&(a.style.display=lt),a}function Rit(t){const{e,id:i,button:n,pluralize:r,options:a,onChange:o,index:s,prefix:l="",suffix:u=""}=t,c=lo.setFormat.bestOf,d=!s&&r&&c>1?"s":"",f=(rt(a)?a(s):a).map(h=>({text:`${h}${d}`,onClick:()=>{n.innerHTML=`${l}${h}${d}${u}${ap}`,o&&rt(NX[o])&&NX[o](e,s,h),lo[s?"finalSetFormat":"setFormat"][i]=h,yT()}}));Ps({items:f,target:e.target,config:{arrow:!1,offset:[0,0]}})}function Mit(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:Ct,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:Et,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();y8({callback:o=>{o&&(Object.assign(r,{matchUpFormat:o}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:V3,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[L3,F3,$3,B3]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function _X(t){return(t==null?void 0:t[0].toUpperCase())+(t==null?void 0:t.substring(1).toLowerCase())||""}function Nit({tableElement:t,tieFormat:e}){var a;const i=(((a=e==null?void 0:e.collectionDefinitions)==null?void 0:a.sort((o,s)=>o.collectionOrder-s.collectionOrder))||[]).map(o=>{const{collectionValue:s,matchUpValue:l,scoreValue:u,setValue:c,matchUpType:d,gender:p}=o,f=Wt.isConvertableInteger(s)&&L3||Wt.isConvertableInteger(u)&&B3||Wt.isConvertableInteger(c)&&$3||F3,h=s??u??c??l;return{...o,matchUpType:_X(d),gender:_X(p),awardValue:h,awardType:f}}),n=Mit();return{table:new da(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function fTe(t){var r,a,o;const e=(r=t==null?void 0:t.winCriteria)==null?void 0:r.valueGoal,i=(a=t==null?void 0:t.collectionDefinitions)!=null&&a.length?((o=t==null?void 0:t.winCriteria)==null?void 0:o.aggregateValue)&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function hTe({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:a,table:o}=Ait({tieFormat:e}),s=c=>{const d=r.tieFormatName.value,p=c.map(h=>Wt.definedAttributes({collectionValue:h.awardType===L3?h.awardValue:void 0,matchUpValue:h.awardType===F3?h.awardValue:void 0,scoreValue:h.awardType===B3?h.awardValue:void 0,setValue:h.awardType===$3?h.awardValue:void 0,matchUpType:h.matchUpType.toUpperCase(),collectionName:h.collectionName,matchUpFormat:h.matchUpFormat,gender:h.gender.toUpperCase(),collectionId:h.collectionId,matchUpCount:h.matchUpCount})),f=$e.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:f}};o.on("dataChanged",()=>{const c=s(o.getData());a.winCriteria.innerHTML=fTe(c)});const u=kit({table:o,onClose:c=>{var p;const d=s(c);rt(i)&&i(((p=d==null?void 0:d.collectionDefinitions)==null?void 0:p.length)&&d)}});return uTe({title:t,content:n,footer:u})}function Ait({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=Nit({tieFormat:t,tableElement:i}),r=_it();e.appendChild(r);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const o=()=>{const c=n==null?void 0:n.getSelectedData().map(({collectionId:d})=>d);n==null||n.deleteRow(c)},s=[{value:(t==null?void 0:t.tieFormatName)||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:ur(5),field:"tieFormatName",id:"tieFormatName",location:Ct},{text:fTe(t),id:"winCriteria",location:Ct},{onClick:o,label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:Wt.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:mt}],{elements:l,inputs:u}=no({table:n,target:a,items:s});return{content:e,table:n,elements:l,inputs:u}}function _it(t){const e=document.createElement("div");e.className="overlay-content-overview";const i=document.createElement("div");return i.className="overlay-content-body",e.appendChild(i),e}function kit({table:t,onClose:e}){const i=()=>{t.destroy(),cTe()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=o=>{o.preventDefault(),o.stopPropagation();const s=t.getData();i(),rt(e)&&e(s)},r.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(n),a.appendChild(r),a}function mTe({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:a}=$e.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});hTe({title:"Edit scorecard",tieFormat:a,onClose:s=>{var l,u;if(s){(l=s.collectionDefinitions)==null||l.forEach((h,m)=>h.collectionOrder=m+1);const c={collectionName:!0,collectionOrder:!0};if(!((u=_D.compareTieFormats({descendant:s,ancestor:a,considerations:c}))==null?void 0:u.different)){Mt({intent:"is-info",message:"No changes"});return}yt({methods:[{method:m8e,params:{modifiedTieFormat:s,considerations:c,structureId:e,matchUpId:t,drawId:n}}],callback:h=>{var m;return h.success?(Mt({intent:"is-success",message:"Scorecard updated"}),rt(r)&&r()):Mt({intent:"is-danger",message:((m=h.error)==null?void 0:m.message)||"Error"})}})}}})}const BC="has-text-success",gTe="tieSide1",vTe="tieSide2";function Wx({title:t,drawId:e,matchUpId:i,onClose:n}){var l;const r=$e.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=r.matchUp;if(!a||r.error||!t||!Array.isArray((l=a==null?void 0:a.tieFormat)==null?void 0:l.collectionDefinitions))return;const o=Kx({matchUp:a}),s=xit({title:t,drawId:e,matchUpId:i,onClose:n});return uTe({title:t,content:o,footer:s})}function Kx({matchUp:t}){var c;const e=document.createElement("div");e.className="overlay-content-container";const i=cA({participantName:kX({matchUp:t,sideNumber:1}),justify:"end"}),n=cA({participantName:kX({matchUp:t,sideNumber:2}),justify:"start"}),{winningSide:r,sets:a}=t,o=dA({winningSide:r,sets:a,sideNumber:1,id:gTe}),s=dA({winningSide:r,sets:a,sideNumber:2,id:vTe}),l=sTe({side1:i,side2:n,side1Score:o,side2Score:s});e.appendChild(l),ze.collectionTables||(ze.collectionTables=[]);const u=((c=t.tieFormat.collectionDefinitions)==null?void 0:c.sort((d,p)=>d.collectionOrder-p.collectionOrder))||[];for(const d of u){const p=t.tieMatchUps.filter(v=>v.collectionId===d.collectionId),f=document.createElement("div");f.className="collection";const h=document.createElement("div");h.className="title is-4",h.innerHTML=d.collectionName,f.appendChild(h);const m=document.createElement("div");f.appendChild(m);const{table:g}=Uit({matchUp:t,tableElement:m,collectionMatchUps:p});ze.collectionTables.push(g),e.appendChild(f)}return e}function Oit(t){var r,a;const e=(a=(r=t==null?void 0:t.score)==null?void 0:r.sets)==null?void 0:a[0];if(!e)return;const i=document.getElementById(gTe),n=document.getElementById(vTe);i.classList.remove(BC),n.classList.remove(BC),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(BC),t.winningSide===2&&n.classList.add(BC)}function kX({matchUp:t,sideNumber:e}){var i,n;return(n=(i=t.sides.find(r=>r.sideNumber===e))==null?void 0:i.participant)==null?void 0:n.participantName}function xit({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{mTe({matchUpId:i,drawId:e,callback:()=>Wx({title:t,drawId:e,matchUpId:i,onClose:()=>console.log("closed")})})},r.innerHTML="Edit scorecard";const a=c=>{var d;if(c.success){const p=(d=$e.findMatchUp({drawId:e,matchUpId:i}))==null?void 0:d.matchUp,f=Kx({matchUp:p});Pit({content:f})}},o=document.createElement("button");o.className="button is-warning is-light button-spacer",o.innerHTML="Remove players",o.onclick=()=>{yt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:Lwe}],callback:a})};const s=document.createElement("button");s.className="button is-info is-light button-spacer",s.innerHTML="Clear results",s.onclick=()=>{yt({methods:[{params:{drawId:e,matchUpId:i},method:Fwe}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=c=>{for(c.preventDefault(),c.stopPropagation();ze.collectionTables.length;)ze.collectionTables.pop().destroy();cTe(),rt(n)&&n()},l.innerHTML="Done";const u=document.createElement("div");return u.className="overlay-footer-wrap",u.appendChild(r),u.appendChild(o),u.appendChild(s),u.appendChild(l),u}const{TEAM:Lit}=Ra,Fit=(t,e)=>(i,n)=>{var c;const r=n.getRow().getData(),{matchUpId:a,readyToScore:o,matchUpType:s,drawId:l,eventName:u}=r.matchUp;if(s===Lit)Wx({title:u,matchUpId:a,drawId:l,onClose:()=>t()});else if(o||(c=r.matchUp.score)!=null&&c.scoreStringSide1)if(ii.hotkeys){e({e:i,cell:n,replaceTableData:t});const d=document.querySelectorAll(".activeScoreCell");for(const p of Array.from(d))p.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else qx({matchUpId:a,callback:t})};function yTe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function Bit({data:t,replaceTableData:e,setFocusData:i}){const n=(l,u)=>{var h,m;const d=u.getRow().getData(),{courtName:p,scheduledDate:f}=d;if(p&&f){const g=(m=(h=$e.getTournament())==null?void 0:h.tournamentRecord)==null?void 0:m.tournamentId,v=`/${Ia}/${g}/${ry}/${f}`;ze.router.navigate(v)}},r=()=>e(),a=t.some(l=>l.courtName),o=(l,u)=>w1(l,u,r),s=l=>{const u=document.createElement("div");u.className="has-text-warning-dark",u.innerHTML="Select participant";const c=({event:p,...f})=>{w1(p,l,r,f)};return l.getValue().participantName&&xb(c)(l,u)};return[{cellClick:(l,u)=>u.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Et,minWidth:50,width:50},{headerMenu:vf({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Ct,width:55},{formatter:BZe(Yn),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:nX,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:nX,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!a,field:"courtName",title:"Court",width:100},{cellClick:n,field:"scheduledTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:o,sorter:e0,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:o,sorter:e0,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Fit(e,i),formatter:c8,sorter:yTe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:SSe,formatter:TSe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Ct,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(l,u)=>d8({pointerEvent:l,...u.getData()}),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,widthGrow:0,width:50}]}const GF=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function HF(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on".concat(e),i)}function QS(t,e,i,n){t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on".concat(e),i)}function bTe(t,e){const i=e.slice(0,e.length-1);for(let n=0;n<i.length;n++)i[n]=t[i[n].toLowerCase()];return i}function ITe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function $it(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let a=0;a<i.length;a++)n.indexOf(i[a])===-1&&(r=!1);return r}const E1={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":GF?173:189,"=":GF?61:187,";":GF?59:186,"'":222,"[":219,"]":221,"\\":220},jp={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},bV={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Lo={16:!1,18:!1,17:!1,91:!1},oa={};for(let t=1;t<20;t++)E1["f".concat(t)]=111+t;let Er=[],XT=null,wTe="all";const xf=new Map,VE=t=>E1[t.toLowerCase()]||jp[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Vit=t=>Object.keys(E1).find(e=>E1[e]===t),jit=t=>Object.keys(jp).find(e=>jp[e]===t);function STe(t){wTe=t||"all"}function C1(){return wTe||"all"}function Git(){return Er.slice(0)}function Hit(){return Er.map(t=>Vit(t)||jit(t)||String.fromCharCode(t))}function zit(){const t=[];return Object.keys(oa).forEach(e=>{oa[e].forEach(i=>{let{key:n,scope:r,mods:a,shortcut:o}=i;t.push({scope:r,shortcut:o,mods:a,keys:n.split("+").map(s=>VE(s))})})}),t}function qit(t){const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n}function Wit(t){return typeof t=="string"&&(t=VE(t)),Er.indexOf(t)!==-1}function Kit(t,e){let i,n;t||(t=C1());for(const r in oa)if(Object.prototype.hasOwnProperty.call(oa,r))for(i=oa[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(o=>{let{element:s}=o;return b8(s)}):n++;C1()===t&&STe(e||"all")}function Yit(t){let e=t.keyCode||t.which||t.charCode;const i=Er.indexOf(e);if(i>=0&&Er.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Er.splice(0,Er.length),(e===93||e===224)&&(e=91),e in Lo){Lo[e]=!1;for(const n in jp)jp[n]===e&&(op[n]=!1)}}function TTe(t){if(typeof t>"u")Object.keys(oa).forEach(r=>{Array.isArray(oa[r])&&oa[r].forEach(a=>$C(a)),delete oa[r]}),b8(null);else if(Array.isArray(t))t.forEach(r=>{r.key&&$C(r)});else if(typeof t=="object")t.key&&$C(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];let[r,a]=i;typeof r=="function"&&(a=r,r=""),$C({key:t,scope:r,method:a,splitKey:"+"})}}const $C=t=>{let{key:e,scope:i,method:n,splitKey:r="+"}=t;ITe(e).forEach(o=>{const s=o.split(r),l=s.length,u=s[l-1],c=u==="*"?"*":VE(u);if(!oa[c])return;i||(i=C1());const d=l>1?bTe(jp,s):[],p=[];oa[c]=oa[c].filter(f=>{const m=(n?f.method===n:!0)&&f.scope===i&&$it(f.mods,d);return m&&p.push(f.element),!m}),p.forEach(f=>b8(f))})};function OX(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const a in Lo)Object.prototype.hasOwnProperty.call(Lo,a)&&(!Lo[a]&&e.mods.indexOf(+a)>-1||Lo[a]&&e.mods.indexOf(+a)===-1)&&(r=!1);(e.mods.length===0&&!Lo[16]&&!Lo[18]&&!Lo[17]&&!Lo[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Er),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function xX(t,e){const i=oa["*"];let n=t.keyCode||t.which||t.charCode;if(!op.filter.call(this,t))return;if((n===93||n===224)&&(n=91),Er.indexOf(n)===-1&&n!==229&&Er.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=bV[s];t[s]&&Er.indexOf(l)===-1?Er.push(l):!t[s]&&Er.indexOf(l)>-1?Er.splice(Er.indexOf(l),1):s==="metaKey"&&t[s]&&Er.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Er=Er.slice(Er.indexOf(l))))}),n in Lo){Lo[n]=!0;for(const s in jp)jp[s]===n&&(op[s]=!0);if(!i)return}for(const s in Lo)Object.prototype.hasOwnProperty.call(Lo,s)&&(Lo[s]=t[bV[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Er.indexOf(17)===-1&&Er.push(17),Er.indexOf(18)===-1&&Er.push(18),Lo[17]=!0,Lo[18]=!0);const r=C1();if(i)for(let s=0;s<i.length;s++)i[s].scope===r&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&OX(t,i[s],r,e);if(!(n in oa))return;const a=oa[n],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:u}=l,c=l.key.split(u),d=[];for(let p=0;p<c.length;p++)d.push(VE(c[p]));d.sort().join("")===Er.sort().join("")&&OX(t,l,r,e)}}function op(t,e,i){Er=[];const n=ITe(t);let r=[],a="all",o=document,s=0,l=!1,u=!0,c="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(c=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&TTe(t,a);s<n.length;s++)t=n[s].split(c),r=[],t.length>1&&(r=bTe(jp,t)),t=t[t.length-1],t=t==="*"?"*":VE(t),t in oa||(oa[t]=[]),oa[t].push({keyup:l,keydown:u,scope:a,mods:r,shortcut:n[s],method:i,key:n[s],splitKey:c,element:o});if(typeof o<"u"&&window){if(!xf.has(o)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return xX(m,o)},h=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;xX(m,o),Yit(m)};xf.set(o,{keydownListener:f,keyupListenr:h,capture:d}),HF(o,"keydown",f,d),HF(o,"keyup",h,d)}if(!XT){const f=()=>{Er=[]};XT={listener:f,capture:d},HF(window,"focus",f,d)}}}function Zit(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(oa).forEach(i=>{oa[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function b8(t){const e=Object.values(oa).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:a}=xf.get(t)||{};n&&r&&(QS(t,"keyup",r,a),QS(t,"keydown",n,a),xf.delete(t))}if((e.length<=0||xf.size<=0)&&(Object.keys(xf).forEach(r=>{const{keydownListener:a,keyupListenr:o,capture:s}=xf.get(r)||{};a&&o&&(QS(r,"keyup",o,s),QS(r,"keydown",a,s),xf.delete(r))}),xf.clear(),Object.keys(oa).forEach(r=>delete oa[r]),XT)){const{listener:r,capture:a}=XT;QS(window,"focus",r,a),XT=null}}const zF={getPressedKeyString:Hit,setScope:STe,getScope:C1,deleteScope:Kit,getPressedKeyCodes:Git,getAllKeyCodes:zit,isPressed:Wit,filter:qit,trigger:Zit,unbind:TTe,keyMap:E1,modifier:jp,modifierMap:bV};for(const t in zF)Object.prototype.hasOwnProperty.call(zF,t)&&(op[t]=zF[t]);if(typeof window<"u"){const t=window.hotkeys;op.noConflict=e=>(e&&window.hotkeys===op&&(window.hotkeys=t),op),window.hotkeys=op}const{HOTKEYS:Xit,SIDE1KEYS:Jit,MODIFIERS:Qit}=EH;function ent(){let t,e;const i=n=>{e=void 0,t=n};return op(Xit+",esc",(n,r)=>{if(t){const a=t.cell.getElement(),o=a.classList.contains("tabulator-cell")?a.firstChild:a;n.preventDefault();const s=t.cell.getRow().getData();e||(e=s.matchUp);const l=op.shift,u=l?r.key.split(r.splitKey)[1]:r.key;u==="esc"&&(t.replaceTableData(),t=void 0);const c=Jit.some(d=>d===u)&&(l?2:1)||void 0;if(c||Qit.includes(u)){const{matchUpFormat:d,matchUpStatus:p,score:f,sets:h,winningSide:m}=e,{matchUpStatus:g,scoreString:v,winningSide:y,sets:b,updated:I}=Mm.keyValueScore({scoreString:f==null?void 0:f.scoreStringSide1,shiftFirst:!0,sets:h||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:c,value:u});I&&(e={matchUpId:s.matchUp.matchUpId,drawId:s.matchUp.drawId,score:{scoreStringSide1:v},matchUpStatus:g,winningSide:y,sets:b,matchUpFormat:d,updated:I},o.innerText=v||"Enter score")}}if(t&&r.key==="enter"){const a=Mm.generateScoreString({sets:e.sets,reversed:!0}),o=Mm.generateScoreString({sets:e.sets}),s={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:o,scoreStringSide2:a}};tnt({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:s}),t=void 0}}),{setFocusData:i}}function tnt({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:a,score:o}=t;yt({methods:[{method:B6,params:{outcome:{matchUpStatus:r,winningSide:a,score:o},matchUpId:i,drawId:n}}],callback:u=>{rt(e)&&e({...u,outcome:t})}})}function int(){let t;const{setFocusData:e}=ent(),i=()=>($e.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(CS),n=()=>{t.replaceData(i())},r=i(),a=Bit({data:r,replaceTableData:n,setFocusData:e});return(s=>{var c;mf({anchorId:jM});const l=document.getElementById(jM),u=(c=Jo(l,"section"))==null?void 0:c.querySelector(".tabHeader");t=new da(l,{headerSortElement:gf(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:s}),t.on("dataFiltered",(d,p)=>{var y,b;const f=p.map(I=>I.getData().matchUp);u&&(u.innerHTML=`Matches (${f.length})`);const h=document.getElementById("wtnPredictiveAccuracy"),m=$e.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:f});(y=m==null?void 0:m.accuracy)!=null&&y.percent?(h.style.display="",h.innerHTML=`WTN ${m.accuracy.percent}%`):h.style.display=lt;const g=document.getElementById("utrPredictiveAccuracy"),v=$e.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:f});(b=v==null?void 0:v.accuracy)!=null&&b.percent?(g.style.display="",g.innerHTML=`UTR ${v.accuracy.percent}%`):g.style.display=lt})})(r),{table:t,data:r,replaceTableData:n}}function pA(t){ii.activeScale=t}const{TEAM_EVENT:LX,SINGLES:FX,DOUBLES:BX}=ko,{TEAM:nnt}=Ra;function rnt(){const t=new Map,e={elements:{},options:{}},{data:i,table:n,replaceTableData:r}=int(),a=$e.getEvents().events||[],o=document.getElementById(T3);o.style.display=lt,e.options.flight=lnt({matchUpFilters:t,events:a,table:n});const s=unt({matchUpFilters:t,components:e,events:a,table:n}),l=ont({table:n,matchUpFilters:t,statsPanel:o}),u=ant({table:n,matchUpFilters:t,data:i}),c=snt({matchUpFilters:t,table:n}),d=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(t.get("searchText"))},p=m=>{m||n==null||n.removeFilter(d),t.set("searchText",m),m&&(n==null||n.addFilter(d))},f=[{onClick:()=>n==null?void 0:n.deselectRow(),label:"Schedule",stateChange:!0,location:gr},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&p(""),onKeyUp:m=>p(m.target.value),clearSearch:()=>{n==null||n.removeFilter(d),t.set("searchText",""),n==null||n.removeFilter()},placeholder:"Search matches",location:Ct,search:!0},{hide:s.length<4,options:s,id:"eventOptions",label:oh,modifyLabel:!0,selection:!0,location:Ct},{options:e.options.flight.flightOptions,hide:!t.get("eventIdFilter")||e.options.flight.flightOptions.length<3,label:b3,id:"flightOptions",modifyLabel:!0,selection:!0,location:Ct},{hide:l.length<3,options:l,modifyLabel:!0,label:Sue,location:Ct,selection:!0},{options:c,label:wue,modifyLabel:!0,selection:!0,location:Ct},{hide:u.length<4,options:u,modifyLabel:!0,label:Tue,selection:!0,location:Ct},{onClick:()=>{pA(OU),r()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:mt,text:"WTN %",hide:!0},{onClick:()=>{pA(oy),r()},id:"utrPredictiveAccuracy",intent:"is-info",location:mt,text:"UTR %",hide:!0}],h=document.getElementById(_3);e.elements=no({table:n,target:h,items:f}).elements}function ant({table:t,matchUpFilters:e,data:i}){const n=s=>s.matchUpType===e.get("matchUpTypeFilter"),r=s=>{t==null||t.removeFilter(n),e.set("matchUpTypeFilter",s),s&&(t==null||t.addFilter(n))},a={label:`<span style='font-weight: bold'>${Tue}</span>`,onClick:()=>r(),close:!0},o=i.reduce((s,l)=>(s.includes(l.matchUpType)||s.push(l.matchUpType),s),[]);return[a,{divider:!0},o.includes(FX)&&{label:"Singles",close:!0,onClick:()=>r(FX)},o.includes(BX)&&{label:"Doubles",close:!0,onClick:()=>r(BX)},o.includes(LX)&&{label:"Team",close:!0,onClick:()=>r(LX)}].filter(Boolean)}function ont({table:t,matchUpFilters:e,statsPanel:i}){const n=$e.getParticipants({participantFilters:{participantTypes:[nnt]}}).participants||[],r=Object.assign({},...n.map(l=>({[l.participantId]:l.individualParticipantIds}))),a=l=>l.individualParticipantIds.some(u=>{var c;return(c=r[e.get("teamIdFilter")])==null?void 0:c.includes(u)}),o=l=>{if(e.get("teamIdFilter")&&(t==null||t.removeFilter(a)),e.set("teamIdFilter",l),l){t==null||t.addFilter(a);const{teamStats:u}=$e.getParticipantStats({teamParticipantId:l});if(u!=null&&u.participantName){i.style.display="";const c=cA({participantName:u.participantName,justify:"end"}),d=cA({participantName:"Opponents",justify:"start"}),p=[{side1Score:u.matchUps[0],side2Score:u.matchUps[1]}],f=dA({sets:p,sideNumber:1}),h=dA({sets:p,sideNumber:2});Oa(i),i.appendChild(sTe({side1:c,side2:d,side1Score:f,side2Score:h}))}}else i.style.display=lt};return[{label:`<span style='font-weight: bold'>${Sue}</span>`,onClick:()=>o(),close:!0},{divider:!0}].concat(n.sort((l,u)=>{var c;return(c=l==null?void 0:l.participantName)==null?void 0:c.localeCompare(u==null?void 0:u.participantName)}).map(l=>({onClick:()=>o(l.participantId),label:l.participantName,close:!0})))}function snt({matchUpFilters:t,table:e}){const i=a=>{const o=t.get("matchUpStatusFilter");if(o==="readyToScore")return a.scoreDetail.readyToScore&&!a.scoreDetail.score&&!a.scoreDetail.winningSide;if(o==="complete")return a.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(a.scoreDetail.matchUpStatus)},n=a=>{e==null||e.removeFilter(i),t.set("matchUpStatusFilter",a),a&&(e==null||e.addFilter(i))};return[{label:`<span style='font-weight: bold'>${wue}</span>`,onClick:()=>n(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>n("readyToScore")},{label:"Complete",close:!0,onClick:()=>n("complete")}]}function lnt({matchUpFilters:t,events:e,table:i}){const n=l=>l.drawId===t.get("drawIdFilter"),r=l=>{i==null||i.removeFilter(n),t.set("drawIdFilter",l),l&&(i==null||i.addFilter(n))},a={label:`<span style='font-weight: bold'>${b3}</span>`,onClick:()=>r(),close:!0},o=l=>{var u;return(u=l.drawDefinitions)==null?void 0:u.map(({drawId:c,drawName:d})=>({onClick:()=>r(c),label:d,close:!0}))},s=[a,{divider:!0}].concat(e.flatMap(o)).filter(Boolean);return{flightFilter:n,flightOptions:s,allFlights:a,mapFlightOptions:o}}function unt({matchUpFilters:t,table:e,events:i,components:n}){const r=s=>s.eventId===t.get("eventIdFilter"),a=s=>{if(e==null||e.removeFilter(r),t.set("eventIdFilter",s),e==null||e.removeFilter(n.options.flight.flightFilter),t.set("drawIdFilter",void 0),s){e==null||e.addFilter(r),n.options.flight.flightOptions=[n.options.flight.allFlights,{divider:!0}].concat(n.options.flight.mapFlightOptions(i.find(c=>s===c.eventId))).filter(Boolean);const l={options:n.options.flight.flightOptions,label:b3,id:"flightOptions",modifyLabel:!0,selection:!0,location:Ct},u=K$({button:l});n.elements.flightOptions.replaceWith(u),n.elements.flightOptions=u,n.elements.flightOptions.style.display=n.options.flight.flightOptions.length<3?lt:""}else n.elements.flightOptions.style.display=lt};return[{label:`<span style='font-weight: bold'>${oh}</span>`,onClick:()=>a(),close:!0},{divider:!0}].concat(i.map(s=>({onClick:()=>a(s.eventId),label:s.eventName,close:!0})))}const fA=t=>t.match(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i);async function cnt(t,e){return Wu.post("/auth/login",{password:e,email:t})}async function dnt(t,e,i,n){return Wu.post("/auth/invite",{permissions:n,providerId:e,email:t,roles:i})}async function pnt(t,e,i,n){return Wu.post("/auth/register",{firstName:t,lastName:e,password:i,code:n})}function UTe(t){let e;const n=[{onInput:({inputs:o})=>{const s=o.email.value,l=fA(s),u=document.getElementById("loginButton");u&&(u.disabled=!l)},control:"email"}];yn({title:"Log in",content:o=>e=Wn(o,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fA,autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}],n),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const o=e.email.value,s=e.password.value,l=u=>{!u&&Jx(),(u==null?void 0:u.status)===200&&Got({data:u.data,callback:t})};cnt(o,s).then(l,u=>console.log({err:u}))},intent:"is-primary",id:"loginButton",disabled:!0,label:"Login",close:!0}]})}const fnt=(t,e,i)=>{const n=ol(),r=fZe();A0e(t,[{text:"Server connection",items:[{hide:r,text:"Connect",onClick:r8},{hide:!r,text:"Disconnect",onClick:LE},{hide:n,text:"Log in",onClick:UTe},{hide:!n,text:"Log out",onClick:Jx}]}],e)};function hnt(){const{tournamentInfo:t}=$e.getTournamentInfo(),e=ol(),i=document.getElementById("mainMenu");i&&(i.onclick=a=>{var o;a.stopPropagation(),ze.drawer.open({title:((o=e==null?void 0:e.provider)==null?void 0:o.providerName)||"TMX",content:fnt,width:"200px",side:mt})});const n=document.getElementById("provider");n&&(n.onclick=()=>ze.router.navigate("/tournaments"));const r=document.getElementById("pageTitle");r&&(t!=null&&t.tournamentName)?(Oa(r),r.innerHTML=`<div class='tmx-title'>${t==null?void 0:t.tournamentName}</div>`):ze.router.navigate("/tournaments")}function DTe(t){var o;const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:a}=t;return{hasLocation:(o=n==null?void 0:n[0])==null?void 0:o.longitude,courtsCount:(a==null?void 0:a.length)||0,scheduledMatchUpsCount:0,address:n==null?void 0:n[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:a,venue:t}}function mnt(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{headerMenu:vf({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,width:50}]}function gnt(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{label:"Add courts",location:mt,align:mt}];e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=Ek,e.style.display=lt,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(a),t.getElement().appendChild(e);const o=mnt(),s=new da(a,{headerSortElement:gf(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:o});no({table:s,target:i,items:n}),s.on("scrollVertical",Pu),s.on("cellEdited",l=>{const u=l.getRow().getData(),c=l.getValue();if(c.length){const d=f=>{f.success?console.log("success",{result:f}):console.log({result:f})},p=[{method:f8e,params:{courtId:u.courtId,modifications:{courtName:c}}}];yt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const I8=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function vnt(t){let e=t.split("/");if(e[2]==="www.openstreetmap.org"){let i=e.slice(4).join(",");return I8.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function ynt(t){const i=t.split("/").reduce((o,s)=>s&&s[0]==="@"?s:o,void 0),n=i==null?void 0:i.split(","),r=n==null?void 0:n[0].slice(1),a=n==null?void 0:n[1];return{latitude:r,longitude:a}}function bnt(t){let e=t.split(",");return I8.test(t)?{latitude:e[0],longitude:e[1]}:{}}function Int(t){let e=t.split("=");if(e.length>1){let i=e[1].split(","),n=[i[0],i[1]].join(",");return I8.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var IV={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,n){n(e)})(eq,function(i){var n="1.9.4";function r(C){var O,G,K,te;for(G=1,K=arguments.length;G<K;G++){te=arguments[G];for(O in te)C[O]=te[O]}return C}var a=Object.create||function(){function C(){}return function(O){return C.prototype=O,new C}}();function o(C,O){var G=Array.prototype.slice;if(C.bind)return C.bind.apply(C,G.call(arguments,1));var K=G.call(arguments,2);return function(){return C.apply(O,K.length?K.concat(G.call(arguments)):arguments)}}var s=0;function l(C){return"_leaflet_id"in C||(C._leaflet_id=++s),C._leaflet_id}function u(C,O,G){var K,te,de,Te;return Te=function(){K=!1,te&&(de.apply(G,te),te=!1)},de=function(){K?te=arguments:(C.apply(G,arguments),setTimeout(Te,O),K=!0)},de}function c(C,O,G){var K=O[1],te=O[0],de=K-te;return C===K&&G?C:((C-te)%de+de)%de+te}function d(){return!1}function p(C,O){if(O===!1)return C;var G=Math.pow(10,O===void 0?6:O);return Math.round(C*G)/G}function f(C){return C.trim?C.trim():C.replace(/^\s+|\s+$/g,"")}function h(C){return f(C).split(/\s+/)}function m(C,O){Object.prototype.hasOwnProperty.call(C,"options")||(C.options=C.options?a(C.options):{});for(var G in O)C.options[G]=O[G];return C.options}function g(C,O,G){var K=[];for(var te in C)K.push(encodeURIComponent(G?te.toUpperCase():te)+"="+encodeURIComponent(C[te]));return(!O||O.indexOf("?")===-1?"?":"&")+K.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(C,O){return C.replace(v,function(G,K){var te=O[K];if(te===void 0)throw new Error("No value provided for variable "+G);return typeof te=="function"&&(te=te(O)),te})}var b=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"};function I(C,O){for(var G=0;G<C.length;G++)if(C[G]===O)return G;return-1}var T="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(C){return window["webkit"+C]||window["moz"+C]||window["ms"+C]}var S=0;function U(C){var O=+new Date,G=Math.max(0,16-(O-S));return S=O+G,window.setTimeout(C,G)}var P=window.requestAnimationFrame||w("RequestAnimationFrame")||U,E=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(C){window.clearTimeout(C)};function D(C,O,G){if(G&&P===U)C.call(O);else return P.call(window,o(C,O))}function R(C){C&&E.call(window,C)}var N={__proto__:null,extend:r,create:a,bind:o,get lastId(){return s},stamp:l,throttle:u,wrapNum:c,falseFn:d,formatNum:p,trim:f,splitWords:h,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:T,requestFn:P,cancelFn:E,requestAnimFrame:D,cancelAnimFrame:R};function M(){}M.extend=function(C){var O=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},G=O.__super__=this.prototype,K=a(G);K.constructor=O,O.prototype=K;for(var te in this)Object.prototype.hasOwnProperty.call(this,te)&&te!=="prototype"&&te!=="__super__"&&(O[te]=this[te]);return C.statics&&r(O,C.statics),C.includes&&(A(C.includes),r.apply(null,[K].concat(C.includes))),r(K,C),delete K.statics,delete K.includes,K.options&&(K.options=G.options?a(G.options):{},r(K.options,C.options)),K._initHooks=[],K.callInitHooks=function(){if(!this._initHooksCalled){G.callInitHooks&&G.callInitHooks.call(this),this._initHooksCalled=!0;for(var de=0,Te=K._initHooks.length;de<Te;de++)K._initHooks[de].call(this)}},O},M.include=function(C){var O=this.prototype.options;return r(this.prototype,C),C.options&&(this.prototype.options=O,this.mergeOptions(C.options)),this},M.mergeOptions=function(C){return r(this.prototype.options,C),this},M.addInitHook=function(C){var O=Array.prototype.slice.call(arguments,1),G=typeof C=="function"?C:function(){this[C].apply(this,O)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(G),this};function A(C){if(!(typeof L>"u"||!L||!L.Mixin)){C=b(C)?C:[C];for(var O=0;O<C.length;O++)C[O]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _={on:function(C,O,G){if(typeof C=="object")for(var K in C)this._on(K,C[K],O);else{C=h(C);for(var te=0,de=C.length;te<de;te++)this._on(C[te],O,G)}return this},off:function(C,O,G){if(!arguments.length)delete this._events;else if(typeof C=="object")for(var K in C)this._off(K,C[K],O);else{C=h(C);for(var te=arguments.length===1,de=0,Te=C.length;de<Te;de++)te?this._off(C[de]):this._off(C[de],O,G)}return this},_on:function(C,O,G,K){if(typeof O!="function"){console.warn("wrong listener type: "+typeof O);return}if(this._listens(C,O,G)===!1){G===this&&(G=void 0);var te={fn:O,ctx:G};K&&(te.once=!0),this._events=this._events||{},this._events[C]=this._events[C]||[],this._events[C].push(te)}},_off:function(C,O,G){var K,te,de;if(this._events&&(K=this._events[C],!!K)){if(arguments.length===1){if(this._firingCount)for(te=0,de=K.length;te<de;te++)K[te].fn=d;delete this._events[C];return}if(typeof O!="function"){console.warn("wrong listener type: "+typeof O);return}var Te=this._listens(C,O,G);if(Te!==!1){var Re=K[Te];this._firingCount&&(Re.fn=d,this._events[C]=K=K.slice()),K.splice(Te,1)}}},fire:function(C,O,G){if(!this.listens(C,G))return this;var K=r({},O,{type:C,target:this,sourceTarget:O&&O.sourceTarget||this});if(this._events){var te=this._events[C];if(te){this._firingCount=this._firingCount+1||1;for(var de=0,Te=te.length;de<Te;de++){var Re=te[de],xe=Re.fn;Re.once&&this.off(C,xe,Re.ctx),xe.call(Re.ctx||this,K)}this._firingCount--}}return G&&this._propagateEvent(K),this},listens:function(C,O,G,K){typeof C!="string"&&console.warn('"string" type argument expected');var te=O;typeof O!="function"&&(K=!!O,te=void 0,G=void 0);var de=this._events&&this._events[C];if(de&&de.length&&this._listens(C,te,G)!==!1)return!0;if(K){for(var Te in this._eventParents)if(this._eventParents[Te].listens(C,O,G,K))return!0}return!1},_listens:function(C,O,G){if(!this._events)return!1;var K=this._events[C]||[];if(!O)return!!K.length;G===this&&(G=void 0);for(var te=0,de=K.length;te<de;te++)if(K[te].fn===O&&K[te].ctx===G)return te;return!1},once:function(C,O,G){if(typeof C=="object")for(var K in C)this._on(K,C[K],O,!0);else{C=h(C);for(var te=0,de=C.length;te<de;te++)this._on(C[te],O,G,!0)}return this},addEventParent:function(C){return this._eventParents=this._eventParents||{},this._eventParents[l(C)]=C,this},removeEventParent:function(C){return this._eventParents&&delete this._eventParents[l(C)],this},_propagateEvent:function(C){for(var O in this._eventParents)this._eventParents[O].fire(C.type,r({layer:C.target,propagatedFrom:C.target},C),!0)}};_.addEventListener=_.on,_.removeEventListener=_.clearAllEventListeners=_.off,_.addOneTimeEventListener=_.once,_.fireEvent=_.fire,_.hasEventListeners=_.listens;var k=M.extend(_);function B(C,O,G){this.x=G?Math.round(C):C,this.y=G?Math.round(O):O}var F=Math.trunc||function(C){return C>0?Math.floor(C):Math.ceil(C)};B.prototype={clone:function(){return new B(this.x,this.y)},add:function(C){return this.clone()._add(x(C))},_add:function(C){return this.x+=C.x,this.y+=C.y,this},subtract:function(C){return this.clone()._subtract(x(C))},_subtract:function(C){return this.x-=C.x,this.y-=C.y,this},divideBy:function(C){return this.clone()._divideBy(C)},_divideBy:function(C){return this.x/=C,this.y/=C,this},multiplyBy:function(C){return this.clone()._multiplyBy(C)},_multiplyBy:function(C){return this.x*=C,this.y*=C,this},scaleBy:function(C){return new B(this.x*C.x,this.y*C.y)},unscaleBy:function(C){return new B(this.x/C.x,this.y/C.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=F(this.x),this.y=F(this.y),this},distanceTo:function(C){C=x(C);var O=C.x-this.x,G=C.y-this.y;return Math.sqrt(O*O+G*G)},equals:function(C){return C=x(C),C.x===this.x&&C.y===this.y},contains:function(C){return C=x(C),Math.abs(C.x)<=Math.abs(this.x)&&Math.abs(C.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function x(C,O,G){return C instanceof B?C:b(C)?new B(C[0],C[1]):C==null?C:typeof C=="object"&&"x"in C&&"y"in C?new B(C.x,C.y):new B(C,O,G)}function $(C,O){if(C)for(var G=O?[C,O]:C,K=0,te=G.length;K<te;K++)this.extend(G[K])}$.prototype={extend:function(C){var O,G;if(!C)return this;if(C instanceof B||typeof C[0]=="number"||"x"in C)O=G=x(C);else if(C=j(C),O=C.min,G=C.max,!O||!G)return this;return!this.min&&!this.max?(this.min=O.clone(),this.max=G.clone()):(this.min.x=Math.min(O.x,this.min.x),this.max.x=Math.max(G.x,this.max.x),this.min.y=Math.min(O.y,this.min.y),this.max.y=Math.max(G.y,this.max.y)),this},getCenter:function(C){return x((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,C)},getBottomLeft:function(){return x(this.min.x,this.max.y)},getTopRight:function(){return x(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(C){var O,G;return typeof C[0]=="number"||C instanceof B?C=x(C):C=j(C),C instanceof $?(O=C.min,G=C.max):O=G=C,O.x>=this.min.x&&G.x<=this.max.x&&O.y>=this.min.y&&G.y<=this.max.y},intersects:function(C){C=j(C);var O=this.min,G=this.max,K=C.min,te=C.max,de=te.x>=O.x&&K.x<=G.x,Te=te.y>=O.y&&K.y<=G.y;return de&&Te},overlaps:function(C){C=j(C);var O=this.min,G=this.max,K=C.min,te=C.max,de=te.x>O.x&&K.x<G.x,Te=te.y>O.y&&K.y<G.y;return de&&Te},isValid:function(){return!!(this.min&&this.max)},pad:function(C){var O=this.min,G=this.max,K=Math.abs(O.x-G.x)*C,te=Math.abs(O.y-G.y)*C;return j(x(O.x-K,O.y-te),x(G.x+K,G.y+te))},equals:function(C){return C?(C=j(C),this.min.equals(C.getTopLeft())&&this.max.equals(C.getBottomRight())):!1}};function j(C,O){return!C||C instanceof $?C:new $(C,O)}function V(C,O){if(C)for(var G=O?[C,O]:C,K=0,te=G.length;K<te;K++)this.extend(G[K])}V.prototype={extend:function(C){var O=this._southWest,G=this._northEast,K,te;if(C instanceof z)K=C,te=C;else if(C instanceof V){if(K=C._southWest,te=C._northEast,!K||!te)return this}else return C?this.extend(q(C)||H(C)):this;return!O&&!G?(this._southWest=new z(K.lat,K.lng),this._northEast=new z(te.lat,te.lng)):(O.lat=Math.min(K.lat,O.lat),O.lng=Math.min(K.lng,O.lng),G.lat=Math.max(te.lat,G.lat),G.lng=Math.max(te.lng,G.lng)),this},pad:function(C){var O=this._southWest,G=this._northEast,K=Math.abs(O.lat-G.lat)*C,te=Math.abs(O.lng-G.lng)*C;return new V(new z(O.lat-K,O.lng-te),new z(G.lat+K,G.lng+te))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(C){typeof C[0]=="number"||C instanceof z||"lat"in C?C=q(C):C=H(C);var O=this._southWest,G=this._northEast,K,te;return C instanceof V?(K=C.getSouthWest(),te=C.getNorthEast()):K=te=C,K.lat>=O.lat&&te.lat<=G.lat&&K.lng>=O.lng&&te.lng<=G.lng},intersects:function(C){C=H(C);var O=this._southWest,G=this._northEast,K=C.getSouthWest(),te=C.getNorthEast(),de=te.lat>=O.lat&&K.lat<=G.lat,Te=te.lng>=O.lng&&K.lng<=G.lng;return de&&Te},overlaps:function(C){C=H(C);var O=this._southWest,G=this._northEast,K=C.getSouthWest(),te=C.getNorthEast(),de=te.lat>O.lat&&K.lat<G.lat,Te=te.lng>O.lng&&K.lng<G.lng;return de&&Te},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(C,O){return C?(C=H(C),this._southWest.equals(C.getSouthWest(),O)&&this._northEast.equals(C.getNorthEast(),O)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function H(C,O){return C instanceof V?C:new V(C,O)}function z(C,O,G){if(isNaN(C)||isNaN(O))throw new Error("Invalid LatLng object: ("+C+", "+O+")");this.lat=+C,this.lng=+O,G!==void 0&&(this.alt=+G)}z.prototype={equals:function(C,O){if(!C)return!1;C=q(C);var G=Math.max(Math.abs(this.lat-C.lat),Math.abs(this.lng-C.lng));return G<=(O===void 0?1e-9:O)},toString:function(C){return"LatLng("+p(this.lat,C)+", "+p(this.lng,C)+")"},distanceTo:function(C){return Y.distance(this,q(C))},wrap:function(){return Y.wrapLatLng(this)},toBounds:function(C){var O=180*C/40075017,G=O/Math.cos(Math.PI/180*this.lat);return H([this.lat-O,this.lng-G],[this.lat+O,this.lng+G])},clone:function(){return new z(this.lat,this.lng,this.alt)}};function q(C,O,G){return C instanceof z?C:b(C)&&typeof C[0]!="object"?C.length===3?new z(C[0],C[1],C[2]):C.length===2?new z(C[0],C[1]):null:C==null?C:typeof C=="object"&&"lat"in C?new z(C.lat,"lng"in C?C.lng:C.lon,C.alt):O===void 0?null:new z(C,O,G)}var W={latLngToPoint:function(C,O){var G=this.projection.project(C),K=this.scale(O);return this.transformation._transform(G,K)},pointToLatLng:function(C,O){var G=this.scale(O),K=this.transformation.untransform(C,G);return this.projection.unproject(K)},project:function(C){return this.projection.project(C)},unproject:function(C){return this.projection.unproject(C)},scale:function(C){return 256*Math.pow(2,C)},zoom:function(C){return Math.log(C/256)/Math.LN2},getProjectedBounds:function(C){if(this.infinite)return null;var O=this.projection.bounds,G=this.scale(C),K=this.transformation.transform(O.min,G),te=this.transformation.transform(O.max,G);return new $(K,te)},infinite:!1,wrapLatLng:function(C){var O=this.wrapLng?c(C.lng,this.wrapLng,!0):C.lng,G=this.wrapLat?c(C.lat,this.wrapLat,!0):C.lat,K=C.alt;return new z(G,O,K)},wrapLatLngBounds:function(C){var O=C.getCenter(),G=this.wrapLatLng(O),K=O.lat-G.lat,te=O.lng-G.lng;if(K===0&&te===0)return C;var de=C.getSouthWest(),Te=C.getNorthEast(),Re=new z(de.lat-K,de.lng-te),xe=new z(Te.lat-K,Te.lng-te);return new V(Re,xe)}},Y=r({},W,{wrapLng:[-180,180],R:6371e3,distance:function(C,O){var G=Math.PI/180,K=C.lat*G,te=O.lat*G,de=Math.sin((O.lat-C.lat)*G/2),Te=Math.sin((O.lng-C.lng)*G/2),Re=de*de+Math.cos(K)*Math.cos(te)*Te*Te,xe=2*Math.atan2(Math.sqrt(Re),Math.sqrt(1-Re));return this.R*xe}}),Z=6378137,X={R:Z,MAX_LATITUDE:85.0511287798,project:function(C){var O=Math.PI/180,G=this.MAX_LATITUDE,K=Math.max(Math.min(G,C.lat),-G),te=Math.sin(K*O);return new B(this.R*C.lng*O,this.R*Math.log((1+te)/(1-te))/2)},unproject:function(C){var O=180/Math.PI;return new z((2*Math.atan(Math.exp(C.y/this.R))-Math.PI/2)*O,C.x*O/this.R)},bounds:function(){var C=Z*Math.PI;return new $([-C,-C],[C,C])}()};function Q(C,O,G,K){if(b(C)){this._a=C[0],this._b=C[1],this._c=C[2],this._d=C[3];return}this._a=C,this._b=O,this._c=G,this._d=K}Q.prototype={transform:function(C,O){return this._transform(C.clone(),O)},_transform:function(C,O){return O=O||1,C.x=O*(this._a*C.x+this._b),C.y=O*(this._c*C.y+this._d),C},untransform:function(C,O){return O=O||1,new B((C.x/O-this._b)/this._a,(C.y/O-this._d)/this._c)}};function ce(C,O,G,K){return new Q(C,O,G,K)}var J=r({},Y,{code:"EPSG:3857",projection:X,transformation:function(){var C=.5/(Math.PI*X.R);return ce(C,.5,-C,.5)}()}),ee=r({},J,{code:"EPSG:900913"});function ne(C){return document.createElementNS("http://www.w3.org/2000/svg",C)}function ie(C,O){var G="",K,te,de,Te,Re,xe;for(K=0,de=C.length;K<de;K++){for(Re=C[K],te=0,Te=Re.length;te<Te;te++)xe=Re[te],G+=(te?"L":"M")+xe.x+" "+xe.y;G+=O?It.svg?"z":"x":""}return G||"M0 0"}var oe=document.documentElement.style,se="ActiveXObject"in window,pe=se&&!document.addEventListener,fe="msLaunchUri"in navigator&&!("documentMode"in document),ge=Xn("webkit"),me=Xn("android"),Ee=Xn("android 2")||Xn("android 3"),Be=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Pe=me&&Xn("Google")&&Be<537&&!("AudioNode"in window),et=!!window.opera,Ie=!fe&&Xn("chrome"),Ne=Xn("gecko")&&!ge&&!et&&!se,be=!Ie&&Xn("safari"),Le=Xn("phantom"),Me="OTransition"in oe,Ze=navigator.platform.indexOf("Win")===0,qe=se&&"transition"in oe,ye="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ee,_e="MozPerspective"in oe,Ae=!window.L_DISABLE_3D&&(qe||ye||_e)&&!Me&&!Le,Ve=typeof orientation<"u"||Xn("mobile"),Ke=Ve&&ge,he=Ve&&ye,ve=!window.PointerEvent&&window.MSPointerEvent,Ce=!!(window.PointerEvent||ve),De="ontouchstart"in window||!!window.TouchEvent,Ue=!window.L_NO_TOUCH&&(De||Ce),Qe=Ve&&et,je=Ve&&Ne,ke=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,bt=function(){var C=!1;try{var O=Object.defineProperty({},"passive",{get:function(){C=!0}});window.addEventListener("testPassiveEventSupport",d,O),window.removeEventListener("testPassiveEventSupport",d,O)}catch{}return C}(),Gt=function(){return!!document.createElement("canvas").getContext}(),Zt=!!(document.createElementNS&&ne("svg").createSVGRect),Sr=!!Zt&&function(){var C=document.createElement("div");return C.innerHTML="<svg/>",(C.firstChild&&C.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Oo=!Zt&&function(){try{var C=document.createElement("div");C.innerHTML='<v:shape adj="1"/>';var O=C.firstChild;return O.style.behavior="url(#default#VML)",O&&typeof O.adj=="object"}catch{return!1}}(),ri=navigator.platform.indexOf("Mac")===0,Tr=navigator.platform.indexOf("Linux")===0;function Xn(C){return navigator.userAgent.toLowerCase().indexOf(C)>=0}var It={ie:se,ielt9:pe,edge:fe,webkit:ge,android:me,android23:Ee,androidStock:Pe,opera:et,chrome:Ie,gecko:Ne,safari:be,phantom:Le,opera12:Me,win:Ze,ie3d:qe,webkit3d:ye,gecko3d:_e,any3d:Ae,mobile:Ve,mobileWebkit:Ke,mobileWebkit3d:he,msPointer:ve,pointer:Ce,touch:Ue,touchNative:De,mobileOpera:Qe,mobileGecko:je,retina:ke,passiveEvents:bt,canvas:Gt,svg:Zt,vml:Oo,inlineSvg:Sr,mac:ri,linux:Tr},hr=It.msPointer?"MSPointerDown":"pointerdown",os=It.msPointer?"MSPointerMove":"pointermove",ss=It.msPointer?"MSPointerUp":"pointerup",Io=It.msPointer?"MSPointerCancel":"pointercancel",Vd={touchstart:hr,touchmove:os,touchend:ss,touchcancel:Io},La={touchstart:gi,touchmove:so,touchend:so,touchcancel:so},ls={},uu=!1;function Kg(C,O,G){return O==="touchstart"&&du(),La[O]?(G=La[O].bind(this,G),C.addEventListener(Vd[O],G,!1),G):(console.warn("wrong event specified:",O),d)}function bf(C,O,G){if(!Vd[O]){console.warn("wrong event specified:",O);return}C.removeEventListener(Vd[O],G,!1)}function Fc(C){ls[C.pointerId]=C}function Bc(C){ls[C.pointerId]&&(ls[C.pointerId]=C)}function cu(C){delete ls[C.pointerId]}function du(){uu||(document.addEventListener(hr,Fc,!0),document.addEventListener(os,Bc,!0),document.addEventListener(ss,cu,!0),document.addEventListener(Io,cu,!0),uu=!0)}function so(C,O){if(O.pointerType!==(O.MSPOINTER_TYPE_MOUSE||"mouse")){O.touches=[];for(var G in ls)O.touches.push(ls[G]);O.changedTouches=[O],C(O)}}function gi(C,O){O.MSPOINTER_TYPE_TOUCH&&O.pointerType===O.MSPOINTER_TYPE_TOUCH&&xo(O),so(C,O)}function Zh(C){var O={},G,K;for(K in C)G=C[K],O[K]=G&&G.bind?G.bind(C):G;return C=O,O.type="dblclick",O.detail=2,O.isTrusted=!1,O._simulated=!0,O}var Xh=200;function Jh(C,O){C.addEventListener("dblclick",O);var G=0,K;function te(de){if(de.detail!==1){K=de.detail;return}if(!(de.pointerType==="mouse"||de.sourceCapabilities&&!de.sourceCapabilities.firesTouchEvents)){var Te=_8(de);if(!(Te.some(function(xe){return xe instanceof HTMLLabelElement&&xe.attributes.for})&&!Te.some(function(xe){return xe instanceof HTMLInputElement||xe instanceof HTMLSelectElement}))){var Re=Date.now();Re-G<=Xh?(K++,K===2&&O(Zh(de))):K=1,G=Re}}}return C.addEventListener("click",te),{dblclick:O,simDblclick:te}}function We(C,O){C.removeEventListener("dblclick",O.dblclick),C.removeEventListener("click",O.simDblclick)}var ni=Ti(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Jn=Ti(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ma=Jn==="webkitTransition"||Jn==="OTransition"?Jn+"End":"transitionend";function pu(C){return typeof C=="string"?document.getElementById(C):C}function $c(C,O){var G=C.style[O]||C.currentStyle&&C.currentStyle[O];if((!G||G==="auto")&&document.defaultView){var K=document.defaultView.getComputedStyle(C,null);G=K?K[O]:null}return G==="auto"?null:G}function un(C,O,G){var K=document.createElement(C);return K.className=O||"",G&&G.appendChild(K),K}function ar(C){var O=C.parentNode;O&&O.removeChild(C)}function If(C){for(;C.firstChild;)C.removeChild(C.firstChild)}function Vc(C){var O=C.parentNode;O&&O.lastChild!==C&&O.appendChild(C)}function yl(C){var O=C.parentNode;O&&O.firstChild!==C&&O.insertBefore(C,O.firstChild)}function cn(C,O){if(C.classList!==void 0)return C.classList.contains(O);var G=Dr(C);return G.length>0&&new RegExp("(^|\\s)"+O+"(\\s|$)").test(G)}function Si(C,O){if(C.classList!==void 0)for(var G=h(O),K=0,te=G.length;K<te;K++)C.classList.add(G[K]);else if(!cn(C,O)){var de=Dr(C);vi(C,(de?de+" ":"")+O)}}function Ur(C,O){C.classList!==void 0?C.classList.remove(O):vi(C,f((" "+Dr(C)+" ").replace(" "+O+" "," ")))}function vi(C,O){C.className.baseVal===void 0?C.className=O:C.className.baseVal=O}function Dr(C){return C.correspondingElement&&(C=C.correspondingElement),C.className.baseVal===void 0?C.className:C.className.baseVal}function ct(C,O){"opacity"in C.style?C.style.opacity=O:"filter"in C.style&&kt(C,O)}function kt(C,O){var G=!1,K="DXImageTransform.Microsoft.Alpha";try{G=C.filters.item(K)}catch{if(O===1)return}O=Math.round(O*100),G?(G.Enabled=O!==100,G.Opacity=O):C.style.filter+=" progid:"+K+"(opacity="+O+")"}function Ti(C){for(var O=document.documentElement.style,G=0;G<C.length;G++)if(C[G]in O)return C[G];return!1}function fn(C,O,G){var K=O||new B(0,0);C.style[ni]=(It.ie3d?"translate("+K.x+"px,"+K.y+"px)":"translate3d("+K.x+"px,"+K.y+"px,0)")+(G?" scale("+G+")":"")}function _t(C,O){C._leaflet_pos=O,It.any3d?fn(C,O):(C.style.left=O.x+"px",C.style.top=O.y+"px")}function _i(C){return C._leaflet_pos||new B(0,0)}var ba,fu,hu;if("onselectstart"in document)ba=function(){xi(window,"selectstart",xo)},fu=function(){Pr(window,"selectstart",xo)};else{var jd=Ti(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ba=function(){if(jd){var C=document.documentElement.style;hu=C[jd],C[jd]="none"}},fu=function(){jd&&(document.documentElement.style[jd]=hu,hu=void 0)}}function Qh(){xi(window,"dragstart",xo)}function em(){Pr(window,"dragstart",xo)}var tm,tL;function iL(C){for(;C.tabIndex===-1;)C=C.parentNode;C.style&&(GE(),tm=C,tL=C.style.outlineStyle,C.style.outlineStyle="none",xi(window,"keydown",GE))}function GE(){tm&&(tm.style.outlineStyle=tL,tm=void 0,tL=void 0,Pr(window,"keydown",GE))}function N8(C){do C=C.parentNode;while((!C.offsetWidth||!C.offsetHeight)&&C!==document.body);return C}function nL(C){var O=C.getBoundingClientRect();return{x:O.width/C.offsetWidth||1,y:O.height/C.offsetHeight||1,boundingClientRect:O}}var BUe={__proto__:null,TRANSFORM:ni,TRANSITION:Jn,TRANSITION_END:Ma,get:pu,getStyle:$c,create:un,remove:ar,empty:If,toFront:Vc,toBack:yl,hasClass:cn,addClass:Si,removeClass:Ur,setClass:vi,getClass:Dr,setOpacity:ct,testProp:Ti,setTransform:fn,setPosition:_t,getPosition:_i,get disableTextSelection(){return ba},get enableTextSelection(){return fu},disableImageDrag:Qh,enableImageDrag:em,preventOutline:iL,restoreOutline:GE,getSizedParentNode:N8,getScale:nL};function xi(C,O,G,K){if(O&&typeof O=="object")for(var te in O)aL(C,te,O[te],G);else{O=h(O);for(var de=0,Te=O.length;de<Te;de++)aL(C,O[de],G,K)}return this}var Gd="_leaflet_events";function Pr(C,O,G,K){if(arguments.length===1)A8(C),delete C[Gd];else if(O&&typeof O=="object")for(var te in O)oL(C,te,O[te],G);else if(O=h(O),arguments.length===2)A8(C,function(Re){return I(O,Re)!==-1});else for(var de=0,Te=O.length;de<Te;de++)oL(C,O[de],G,K);return this}function A8(C,O){for(var G in C[Gd]){var K=G.split(/\d/)[0];(!O||O(K))&&oL(C,K,null,null,G)}}var rL={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function aL(C,O,G,K){var te=O+l(G)+(K?"_"+l(K):"");if(C[Gd]&&C[Gd][te])return this;var de=function(Re){return G.call(K||C,Re||window.event)},Te=de;!It.touchNative&&It.pointer&&O.indexOf("touch")===0?de=Kg(C,O,de):It.touch&&O==="dblclick"?de=Jh(C,de):"addEventListener"in C?O==="touchstart"||O==="touchmove"||O==="wheel"||O==="mousewheel"?C.addEventListener(rL[O]||O,de,It.passiveEvents?{passive:!1}:!1):O==="mouseenter"||O==="mouseleave"?(de=function(Re){Re=Re||window.event,lL(C,Re)&&Te(Re)},C.addEventListener(rL[O],de,!1)):C.addEventListener(O,Te,!1):C.attachEvent("on"+O,de),C[Gd]=C[Gd]||{},C[Gd][te]=de}function oL(C,O,G,K,te){te=te||O+l(G)+(K?"_"+l(K):"");var de=C[Gd]&&C[Gd][te];if(!de)return this;!It.touchNative&&It.pointer&&O.indexOf("touch")===0?bf(C,O,de):It.touch&&O==="dblclick"?We(C,de):"removeEventListener"in C?C.removeEventListener(rL[O]||O,de,!1):C.detachEvent("on"+O,de),C[Gd][te]=null}function Yg(C){return C.stopPropagation?C.stopPropagation():C.originalEvent?C.originalEvent._stopped=!0:C.cancelBubble=!0,this}function sL(C){return aL(C,"wheel",Yg),this}function AS(C){return xi(C,"mousedown touchstart dblclick contextmenu",Yg),C._leaflet_disable_click=!0,this}function xo(C){return C.preventDefault?C.preventDefault():C.returnValue=!1,this}function Zg(C){return xo(C),Yg(C),this}function _8(C){if(C.composedPath)return C.composedPath();for(var O=[],G=C.target;G;)O.push(G),G=G.parentNode;return O}function k8(C,O){if(!O)return new B(C.clientX,C.clientY);var G=nL(O),K=G.boundingClientRect;return new B((C.clientX-K.left)/G.x-O.clientLeft,(C.clientY-K.top)/G.y-O.clientTop)}var $Ue=It.linux&&It.chrome?window.devicePixelRatio:It.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function O8(C){return It.edge?C.wheelDeltaY/2:C.deltaY&&C.deltaMode===0?-C.deltaY/$Ue:C.deltaY&&C.deltaMode===1?-C.deltaY*20:C.deltaY&&C.deltaMode===2?-C.deltaY*60:C.deltaX||C.deltaZ?0:C.wheelDelta?(C.wheelDeltaY||C.wheelDelta)/2:C.detail&&Math.abs(C.detail)<32765?-C.detail*20:C.detail?C.detail/-32765*60:0}function lL(C,O){var G=O.relatedTarget;if(!G)return!0;try{for(;G&&G!==C;)G=G.parentNode}catch{return!1}return G!==C}var VUe={__proto__:null,on:xi,off:Pr,stopPropagation:Yg,disableScrollPropagation:sL,disableClickPropagation:AS,preventDefault:xo,stop:Zg,getPropagationPath:_8,getMousePosition:k8,getWheelDelta:O8,isExternalTarget:lL,addListener:xi,removeListener:Pr},x8=k.extend({run:function(C,O,G,K){this.stop(),this._el=C,this._inProgress=!0,this._duration=G||.25,this._easeOutPower=1/Math.max(K||.5,.2),this._startPos=_i(C),this._offset=O.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=D(this._animate,this),this._step()},_step:function(C){var O=+new Date-this._startTime,G=this._duration*1e3;O<G?this._runFrame(this._easeOut(O/G),C):(this._runFrame(1),this._complete())},_runFrame:function(C,O){var G=this._startPos.add(this._offset.multiplyBy(C));O&&G._round(),_t(this._el,G),this.fire("step")},_complete:function(){R(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(C){return 1-Math.pow(1-C,this._easeOutPower)}}),bn=k.extend({options:{crs:J,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(C,O){O=m(this,O),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(C),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),O.maxBounds&&this.setMaxBounds(O.maxBounds),O.zoom!==void 0&&(this._zoom=this._limitZoom(O.zoom)),O.center&&O.zoom!==void 0&&this.setView(q(O.center),O.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Jn&&It.any3d&&!It.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),xi(this._proxy,Ma,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(C,O,G){if(O=O===void 0?this._zoom:this._limitZoom(O),C=this._limitCenter(q(C),O,this.options.maxBounds),G=G||{},this._stop(),this._loaded&&!G.reset&&G!==!0){G.animate!==void 0&&(G.zoom=r({animate:G.animate},G.zoom),G.pan=r({animate:G.animate,duration:G.duration},G.pan));var K=this._zoom!==O?this._tryAnimatedZoom&&this._tryAnimatedZoom(C,O,G.zoom):this._tryAnimatedPan(C,G.pan);if(K)return clearTimeout(this._sizeTimer),this}return this._resetView(C,O,G.pan&&G.pan.noMoveStart),this},setZoom:function(C,O){return this._loaded?this.setView(this.getCenter(),C,{zoom:O}):(this._zoom=C,this)},zoomIn:function(C,O){return C=C||(It.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+C,O)},zoomOut:function(C,O){return C=C||(It.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-C,O)},setZoomAround:function(C,O,G){var K=this.getZoomScale(O),te=this.getSize().divideBy(2),de=C instanceof B?C:this.latLngToContainerPoint(C),Te=de.subtract(te).multiplyBy(1-1/K),Re=this.containerPointToLatLng(te.add(Te));return this.setView(Re,O,{zoom:G})},_getBoundsCenterZoom:function(C,O){O=O||{},C=C.getBounds?C.getBounds():H(C);var G=x(O.paddingTopLeft||O.padding||[0,0]),K=x(O.paddingBottomRight||O.padding||[0,0]),te=this.getBoundsZoom(C,!1,G.add(K));if(te=typeof O.maxZoom=="number"?Math.min(O.maxZoom,te):te,te===1/0)return{center:C.getCenter(),zoom:te};var de=K.subtract(G).divideBy(2),Te=this.project(C.getSouthWest(),te),Re=this.project(C.getNorthEast(),te),xe=this.unproject(Te.add(Re).divideBy(2).add(de),te);return{center:xe,zoom:te}},fitBounds:function(C,O){if(C=H(C),!C.isValid())throw new Error("Bounds are not valid.");var G=this._getBoundsCenterZoom(C,O);return this.setView(G.center,G.zoom,O)},fitWorld:function(C){return this.fitBounds([[-90,-180],[90,180]],C)},panTo:function(C,O){return this.setView(C,this._zoom,{pan:O})},panBy:function(C,O){if(C=x(C).round(),O=O||{},!C.x&&!C.y)return this.fire("moveend");if(O.animate!==!0&&!this.getSize().contains(C))return this._resetView(this.unproject(this.project(this.getCenter()).add(C)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new x8,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),O.noMoveStart||this.fire("movestart"),O.animate!==!1){Si(this._mapPane,"leaflet-pan-anim");var G=this._getMapPanePos().subtract(C).round();this._panAnim.run(this._mapPane,G,O.duration||.25,O.easeLinearity)}else this._rawPanBy(C),this.fire("move").fire("moveend");return this},flyTo:function(C,O,G){if(G=G||{},G.animate===!1||!It.any3d)return this.setView(C,O,G);this._stop();var K=this.project(this.getCenter()),te=this.project(C),de=this.getSize(),Te=this._zoom;C=q(C),O=O===void 0?Te:O;var Re=Math.max(de.x,de.y),xe=Re*this.getZoomScale(Te,O),Ye=te.distanceTo(K)||1,wt=1.42,si=wt*wt;function tn(Fa){var tC=Fa?-1:1,R1e=Fa?xe:Re,M1e=xe*xe-Re*Re+tC*si*si*Ye*Ye,N1e=2*R1e*si*Ye,bL=M1e/N1e,g7=Math.sqrt(bL*bL+1)-bL,A1e=g7<1e-9?-18:Math.log(g7);return A1e}function Cs(Fa){return(Math.exp(Fa)-Math.exp(-Fa))/2}function wo(Fa){return(Math.exp(Fa)+Math.exp(-Fa))/2}function Xu(Fa){return Cs(Fa)/wo(Fa)}var bl=tn(0);function zb(Fa){return Re*(wo(bl)/wo(bl+wt*Fa))}function D1e(Fa){return Re*(wo(bl)*Xu(bl+wt*Fa)-Cs(bl))/si}function P1e(Fa){return 1-Math.pow(1-Fa,1.5)}var E1e=Date.now(),h7=(tn(1)-bl)/wt,C1e=G.duration?1e3*G.duration:1e3*h7*.8;function m7(){var Fa=(Date.now()-E1e)/C1e,tC=P1e(Fa)*h7;Fa<=1?(this._flyToFrame=D(m7,this),this._move(this.unproject(K.add(te.subtract(K).multiplyBy(D1e(tC)/Ye)),Te),this.getScaleZoom(Re/zb(tC),Te),{flyTo:!0})):this._move(C,O)._moveEnd(!0)}return this._moveStart(!0,G.noMoveStart),m7.call(this),this},flyToBounds:function(C,O){var G=this._getBoundsCenterZoom(C,O);return this.flyTo(G.center,G.zoom,O)},setMaxBounds:function(C){return C=H(C),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),C.isValid()?(this.options.maxBounds=C,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(C){var O=this.options.minZoom;return this.options.minZoom=C,this._loaded&&O!==C&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(C):this},setMaxZoom:function(C){var O=this.options.maxZoom;return this.options.maxZoom=C,this._loaded&&O!==C&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(C):this},panInsideBounds:function(C,O){this._enforcingBounds=!0;var G=this.getCenter(),K=this._limitCenter(G,this._zoom,H(C));return G.equals(K)||this.panTo(K,O),this._enforcingBounds=!1,this},panInside:function(C,O){O=O||{};var G=x(O.paddingTopLeft||O.padding||[0,0]),K=x(O.paddingBottomRight||O.padding||[0,0]),te=this.project(this.getCenter()),de=this.project(C),Te=this.getPixelBounds(),Re=j([Te.min.add(G),Te.max.subtract(K)]),xe=Re.getSize();if(!Re.contains(de)){this._enforcingBounds=!0;var Ye=de.subtract(Re.getCenter()),wt=Re.extend(de).getSize().subtract(xe);te.x+=Ye.x<0?-wt.x:wt.x,te.y+=Ye.y<0?-wt.y:wt.y,this.panTo(this.unproject(te),O),this._enforcingBounds=!1}return this},invalidateSize:function(C){if(!this._loaded)return this;C=r({animate:!1,pan:!0},C===!0?{animate:!0}:C);var O=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var G=this.getSize(),K=O.divideBy(2).round(),te=G.divideBy(2).round(),de=K.subtract(te);return!de.x&&!de.y?this:(C.animate&&C.pan?this.panBy(de):(C.pan&&this._rawPanBy(de),this.fire("move"),C.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:O,newSize:G}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(C){if(C=this._locateOptions=r({timeout:1e4,watch:!1},C),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var O=o(this._handleGeolocationResponse,this),G=o(this._handleGeolocationError,this);return C.watch?this._locationWatchId=navigator.geolocation.watchPosition(O,G,C):navigator.geolocation.getCurrentPosition(O,G,C),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(C){if(this._container._leaflet_id){var O=C.code,G=C.message||(O===1?"permission denied":O===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:O,message:"Geolocation error: "+G+"."})}},_handleGeolocationResponse:function(C){if(this._container._leaflet_id){var O=C.coords.latitude,G=C.coords.longitude,K=new z(O,G),te=K.toBounds(C.coords.accuracy*2),de=this._locateOptions;if(de.setView){var Te=this.getBoundsZoom(te);this.setView(K,de.maxZoom?Math.min(Te,de.maxZoom):Te)}var Re={latlng:K,bounds:te,timestamp:C.timestamp};for(var xe in C.coords)typeof C.coords[xe]=="number"&&(Re[xe]=C.coords[xe]);this.fire("locationfound",Re)}},addHandler:function(C,O){if(!O)return this;var G=this[C]=new O(this);return this._handlers.push(G),this.options[C]&&G.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ar(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(R(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var C;for(C in this._layers)this._layers[C].remove();for(C in this._panes)ar(this._panes[C]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(C,O){var G="leaflet-pane"+(C?" leaflet-"+C.replace("Pane","")+"-pane":""),K=un("div",G,O||this._mapPane);return C&&(this._panes[C]=K),K},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var C=this.getPixelBounds(),O=this.unproject(C.getBottomLeft()),G=this.unproject(C.getTopRight());return new V(O,G)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(C,O,G){C=H(C),G=x(G||[0,0]);var K=this.getZoom()||0,te=this.getMinZoom(),de=this.getMaxZoom(),Te=C.getNorthWest(),Re=C.getSouthEast(),xe=this.getSize().subtract(G),Ye=j(this.project(Re,K),this.project(Te,K)).getSize(),wt=It.any3d?this.options.zoomSnap:1,si=xe.x/Ye.x,tn=xe.y/Ye.y,Cs=O?Math.max(si,tn):Math.min(si,tn);return K=this.getScaleZoom(Cs,K),wt&&(K=Math.round(K/(wt/100))*(wt/100),K=O?Math.ceil(K/wt)*wt:Math.floor(K/wt)*wt),Math.max(te,Math.min(de,K))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new B(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(C,O){var G=this._getTopLeftPoint(C,O);return new $(G,G.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(C){return this.options.crs.getProjectedBounds(C===void 0?this.getZoom():C)},getPane:function(C){return typeof C=="string"?this._panes[C]:C},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(C,O){var G=this.options.crs;return O=O===void 0?this._zoom:O,G.scale(C)/G.scale(O)},getScaleZoom:function(C,O){var G=this.options.crs;O=O===void 0?this._zoom:O;var K=G.zoom(C*G.scale(O));return isNaN(K)?1/0:K},project:function(C,O){return O=O===void 0?this._zoom:O,this.options.crs.latLngToPoint(q(C),O)},unproject:function(C,O){return O=O===void 0?this._zoom:O,this.options.crs.pointToLatLng(x(C),O)},layerPointToLatLng:function(C){var O=x(C).add(this.getPixelOrigin());return this.unproject(O)},latLngToLayerPoint:function(C){var O=this.project(q(C))._round();return O._subtract(this.getPixelOrigin())},wrapLatLng:function(C){return this.options.crs.wrapLatLng(q(C))},wrapLatLngBounds:function(C){return this.options.crs.wrapLatLngBounds(H(C))},distance:function(C,O){return this.options.crs.distance(q(C),q(O))},containerPointToLayerPoint:function(C){return x(C).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(C){return x(C).add(this._getMapPanePos())},containerPointToLatLng:function(C){var O=this.containerPointToLayerPoint(x(C));return this.layerPointToLatLng(O)},latLngToContainerPoint:function(C){return this.layerPointToContainerPoint(this.latLngToLayerPoint(q(C)))},mouseEventToContainerPoint:function(C){return k8(C,this._container)},mouseEventToLayerPoint:function(C){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(C))},mouseEventToLatLng:function(C){return this.layerPointToLatLng(this.mouseEventToLayerPoint(C))},_initContainer:function(C){var O=this._container=pu(C);if(O){if(O._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");xi(O,"scroll",this._onScroll,this),this._containerId=l(O)},_initLayout:function(){var C=this._container;this._fadeAnimated=this.options.fadeAnimation&&It.any3d,Si(C,"leaflet-container"+(It.touch?" leaflet-touch":"")+(It.retina?" leaflet-retina":"")+(It.ielt9?" leaflet-oldie":"")+(It.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var O=$c(C,"position");O!=="absolute"&&O!=="relative"&&O!=="fixed"&&O!=="sticky"&&(C.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var C=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),_t(this._mapPane,new B(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Si(C.markerPane,"leaflet-zoom-hide"),Si(C.shadowPane,"leaflet-zoom-hide"))},_resetView:function(C,O,G){_t(this._mapPane,new B(0,0));var K=!this._loaded;this._loaded=!0,O=this._limitZoom(O),this.fire("viewprereset");var te=this._zoom!==O;this._moveStart(te,G)._move(C,O)._moveEnd(te),this.fire("viewreset"),K&&this.fire("load")},_moveStart:function(C,O){return C&&this.fire("zoomstart"),O||this.fire("movestart"),this},_move:function(C,O,G,K){O===void 0&&(O=this._zoom);var te=this._zoom!==O;return this._zoom=O,this._lastCenter=C,this._pixelOrigin=this._getNewPixelOrigin(C),K?G&&G.pinch&&this.fire("zoom",G):((te||G&&G.pinch)&&this.fire("zoom",G),this.fire("move",G)),this},_moveEnd:function(C){return C&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return R(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(C){_t(this._mapPane,this._getMapPanePos().subtract(C))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(C){this._targets={},this._targets[l(this._container)]=this;var O=C?Pr:xi;O(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&O(window,"resize",this._onResize,this),It.any3d&&this.options.transform3DLimit&&(C?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){R(this._resizeRequest),this._resizeRequest=D(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var C=this._getMapPanePos();Math.max(Math.abs(C.x),Math.abs(C.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(C,O){for(var G=[],K,te=O==="mouseout"||O==="mouseover",de=C.target||C.srcElement,Te=!1;de;){if(K=this._targets[l(de)],K&&(O==="click"||O==="preclick")&&this._draggableMoved(K)){Te=!0;break}if(K&&K.listens(O,!0)&&(te&&!lL(de,C)||(G.push(K),te))||de===this._container)break;de=de.parentNode}return!G.length&&!Te&&!te&&this.listens(O,!0)&&(G=[this]),G},_isClickDisabled:function(C){for(;C&&C!==this._container;){if(C._leaflet_disable_click)return!0;C=C.parentNode}},_handleDOMEvent:function(C){var O=C.target||C.srcElement;if(!(!this._loaded||O._leaflet_disable_events||C.type==="click"&&this._isClickDisabled(O))){var G=C.type;G==="mousedown"&&iL(O),this._fireDOMEvent(C,G)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(C,O,G){if(C.type==="click"){var K=r({},C);K.type="preclick",this._fireDOMEvent(K,K.type,G)}var te=this._findEventTargets(C,O);if(G){for(var de=[],Te=0;Te<G.length;Te++)G[Te].listens(O,!0)&&de.push(G[Te]);te=de.concat(te)}if(te.length){O==="contextmenu"&&xo(C);var Re=te[0],xe={originalEvent:C};if(C.type!=="keypress"&&C.type!=="keydown"&&C.type!=="keyup"){var Ye=Re.getLatLng&&(!Re._radius||Re._radius<=10);xe.containerPoint=Ye?this.latLngToContainerPoint(Re.getLatLng()):this.mouseEventToContainerPoint(C),xe.layerPoint=this.containerPointToLayerPoint(xe.containerPoint),xe.latlng=Ye?Re.getLatLng():this.layerPointToLatLng(xe.layerPoint)}for(Te=0;Te<te.length;Te++)if(te[Te].fire(O,xe,!0),xe.originalEvent._stopped||te[Te].options.bubblingMouseEvents===!1&&I(this._mouseEvents,O)!==-1)return}},_draggableMoved:function(C){return C=C.dragging&&C.dragging.enabled()?C:this,C.dragging&&C.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var C=0,O=this._handlers.length;C<O;C++)this._handlers[C].disable()},whenReady:function(C,O){return this._loaded?C.call(O||this,{target:this}):this.on("load",C,O),this},_getMapPanePos:function(){return _i(this._mapPane)||new B(0,0)},_moved:function(){var C=this._getMapPanePos();return C&&!C.equals([0,0])},_getTopLeftPoint:function(C,O){var G=C&&O!==void 0?this._getNewPixelOrigin(C,O):this.getPixelOrigin();return G.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(C,O){var G=this.getSize()._divideBy(2);return this.project(C,O)._subtract(G)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(C,O,G){var K=this._getNewPixelOrigin(G,O);return this.project(C,O)._subtract(K)},_latLngBoundsToNewLayerBounds:function(C,O,G){var K=this._getNewPixelOrigin(G,O);return j([this.project(C.getSouthWest(),O)._subtract(K),this.project(C.getNorthWest(),O)._subtract(K),this.project(C.getSouthEast(),O)._subtract(K),this.project(C.getNorthEast(),O)._subtract(K)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(C){return this.latLngToLayerPoint(C).subtract(this._getCenterLayerPoint())},_limitCenter:function(C,O,G){if(!G)return C;var K=this.project(C,O),te=this.getSize().divideBy(2),de=new $(K.subtract(te),K.add(te)),Te=this._getBoundsOffset(de,G,O);return Math.abs(Te.x)<=1&&Math.abs(Te.y)<=1?C:this.unproject(K.add(Te),O)},_limitOffset:function(C,O){if(!O)return C;var G=this.getPixelBounds(),K=new $(G.min.add(C),G.max.add(C));return C.add(this._getBoundsOffset(K,O))},_getBoundsOffset:function(C,O,G){var K=j(this.project(O.getNorthEast(),G),this.project(O.getSouthWest(),G)),te=K.min.subtract(C.min),de=K.max.subtract(C.max),Te=this._rebound(te.x,-de.x),Re=this._rebound(te.y,-de.y);return new B(Te,Re)},_rebound:function(C,O){return C+O>0?Math.round(C-O)/2:Math.max(0,Math.ceil(C))-Math.max(0,Math.floor(O))},_limitZoom:function(C){var O=this.getMinZoom(),G=this.getMaxZoom(),K=It.any3d?this.options.zoomSnap:1;return K&&(C=Math.round(C/K)*K),Math.max(O,Math.min(G,C))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ur(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(C,O){var G=this._getCenterOffset(C)._trunc();return(O&&O.animate)!==!0&&!this.getSize().contains(G)?!1:(this.panBy(G,O),!0)},_createAnimProxy:function(){var C=this._proxy=un("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(C),this.on("zoomanim",function(O){var G=ni,K=this._proxy.style[G];fn(this._proxy,this.project(O.center,O.zoom),this.getZoomScale(O.zoom,1)),K===this._proxy.style[G]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ar(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var C=this.getCenter(),O=this.getZoom();fn(this._proxy,this.project(C,O),this.getZoomScale(O,1))},_catchTransitionEnd:function(C){this._animatingZoom&&C.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(C,O,G){if(this._animatingZoom)return!0;if(G=G||{},!this._zoomAnimated||G.animate===!1||this._nothingToAnimate()||Math.abs(O-this._zoom)>this.options.zoomAnimationThreshold)return!1;var K=this.getZoomScale(O),te=this._getCenterOffset(C)._divideBy(1-1/K);return G.animate!==!0&&!this.getSize().contains(te)?!1:(D(function(){this._moveStart(!0,G.noMoveStart||!1)._animateZoom(C,O,!0)},this),!0)},_animateZoom:function(C,O,G,K){this._mapPane&&(G&&(this._animatingZoom=!0,this._animateToCenter=C,this._animateToZoom=O,Si(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:C,zoom:O,noUpdate:K}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ur(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function jUe(C,O){return new bn(C,O)}var jc=M.extend({options:{position:"topright"},initialize:function(C){m(this,C)},getPosition:function(){return this.options.position},setPosition:function(C){var O=this._map;return O&&O.removeControl(this),this.options.position=C,O&&O.addControl(this),this},getContainer:function(){return this._container},addTo:function(C){this.remove(),this._map=C;var O=this._container=this.onAdd(C),G=this.getPosition(),K=C._controlCorners[G];return Si(O,"leaflet-control"),G.indexOf("bottom")!==-1?K.insertBefore(O,K.firstChild):K.appendChild(O),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ar(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(C){this._map&&C&&C.screenX>0&&C.screenY>0&&this._map.getContainer().focus()}}),_S=function(C){return new jc(C)};bn.include({addControl:function(C){return C.addTo(this),this},removeControl:function(C){return C.remove(),this},_initControlPos:function(){var C=this._controlCorners={},O="leaflet-",G=this._controlContainer=un("div",O+"control-container",this._container);function K(te,de){var Te=O+te+" "+O+de;C[te+de]=un("div",Te,G)}K("top","left"),K("top","right"),K("bottom","left"),K("bottom","right")},_clearControlPos:function(){for(var C in this._controlCorners)ar(this._controlCorners[C]);ar(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var L8=jc.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(C,O,G,K){return G<K?-1:K<G?1:0}},initialize:function(C,O,G){m(this,G),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var K in C)this._addLayer(C[K],K);for(K in O)this._addLayer(O[K],K,!0)},onAdd:function(C){this._initLayout(),this._update(),this._map=C,C.on("zoomend",this._checkDisabledLayers,this);for(var O=0;O<this._layers.length;O++)this._layers[O].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(C){return jc.prototype.addTo.call(this,C),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var C=0;C<this._layers.length;C++)this._layers[C].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(C,O){return this._addLayer(C,O),this._map?this._update():this},addOverlay:function(C,O){return this._addLayer(C,O,!0),this._map?this._update():this},removeLayer:function(C){C.off("add remove",this._onLayerChange,this);var O=this._getLayer(l(C));return O&&this._layers.splice(this._layers.indexOf(O),1),this._map?this._update():this},expand:function(){Si(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var C=this._map.getSize().y-(this._container.offsetTop+50);return C<this._section.clientHeight?(Si(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=C+"px"):Ur(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ur(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var C="leaflet-control-layers",O=this._container=un("div",C),G=this.options.collapsed;O.setAttribute("aria-haspopup",!0),AS(O),sL(O);var K=this._section=un("section",C+"-list");G&&(this._map.on("click",this.collapse,this),xi(O,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var te=this._layersLink=un("a",C+"-toggle",O);te.href="#",te.title="Layers",te.setAttribute("role","button"),xi(te,{keydown:function(de){de.keyCode===13&&this._expandSafely()},click:function(de){xo(de),this._expandSafely()}},this),G||this.expand(),this._baseLayersList=un("div",C+"-base",K),this._separator=un("div",C+"-separator",K),this._overlaysList=un("div",C+"-overlays",K),O.appendChild(K)},_getLayer:function(C){for(var O=0;O<this._layers.length;O++)if(this._layers[O]&&l(this._layers[O].layer)===C)return this._layers[O]},_addLayer:function(C,O,G){this._map&&C.on("add remove",this._onLayerChange,this),this._layers.push({layer:C,name:O,overlay:G}),this.options.sortLayers&&this._layers.sort(o(function(K,te){return this.options.sortFunction(K.layer,te.layer,K.name,te.name)},this)),this.options.autoZIndex&&C.setZIndex&&(this._lastZIndex++,C.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;If(this._baseLayersList),If(this._overlaysList),this._layerControlInputs=[];var C,O,G,K,te=0;for(G=0;G<this._layers.length;G++)K=this._layers[G],this._addItem(K),O=O||K.overlay,C=C||!K.overlay,te+=K.overlay?0:1;return this.options.hideSingleBase&&(C=C&&te>1,this._baseLayersList.style.display=C?"":"none"),this._separator.style.display=O&&C?"":"none",this},_onLayerChange:function(C){this._handlingClick||this._update();var O=this._getLayer(l(C.target)),G=O.overlay?C.type==="add"?"overlayadd":"overlayremove":C.type==="add"?"baselayerchange":null;G&&this._map.fire(G,O)},_createRadioElement:function(C,O){var G='<input type="radio" class="leaflet-control-layers-selector" name="'+C+'"'+(O?' checked="checked"':"")+"/>",K=document.createElement("div");return K.innerHTML=G,K.firstChild},_addItem:function(C){var O=document.createElement("label"),G=this._map.hasLayer(C.layer),K;C.overlay?(K=document.createElement("input"),K.type="checkbox",K.className="leaflet-control-layers-selector",K.defaultChecked=G):K=this._createRadioElement("leaflet-base-layers_"+l(this),G),this._layerControlInputs.push(K),K.layerId=l(C.layer),xi(K,"click",this._onInputClick,this);var te=document.createElement("span");te.innerHTML=" "+C.name;var de=document.createElement("span");O.appendChild(de),de.appendChild(K),de.appendChild(te);var Te=C.overlay?this._overlaysList:this._baseLayersList;return Te.appendChild(O),this._checkDisabledLayers(),O},_onInputClick:function(){if(!this._preventClick){var C=this._layerControlInputs,O,G,K=[],te=[];this._handlingClick=!0;for(var de=C.length-1;de>=0;de--)O=C[de],G=this._getLayer(O.layerId).layer,O.checked?K.push(G):O.checked||te.push(G);for(de=0;de<te.length;de++)this._map.hasLayer(te[de])&&this._map.removeLayer(te[de]);for(de=0;de<K.length;de++)this._map.hasLayer(K[de])||this._map.addLayer(K[de]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var C=this._layerControlInputs,O,G,K=this._map.getZoom(),te=C.length-1;te>=0;te--)O=C[te],G=this._getLayer(O.layerId).layer,O.disabled=G.options.minZoom!==void 0&&K<G.options.minZoom||G.options.maxZoom!==void 0&&K>G.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var C=this._section;this._preventClick=!0,xi(C,"click",xo),this.expand();var O=this;setTimeout(function(){Pr(C,"click",xo),O._preventClick=!1})}}),GUe=function(C,O,G){return new L8(C,O,G)},uL=jc.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(C){var O="leaflet-control-zoom",G=un("div",O+" leaflet-bar"),K=this.options;return this._zoomInButton=this._createButton(K.zoomInText,K.zoomInTitle,O+"-in",G,this._zoomIn),this._zoomOutButton=this._createButton(K.zoomOutText,K.zoomOutTitle,O+"-out",G,this._zoomOut),this._updateDisabled(),C.on("zoomend zoomlevelschange",this._updateDisabled,this),G},onRemove:function(C){C.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(C){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(C.shiftKey?3:1))},_zoomOut:function(C){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(C.shiftKey?3:1))},_createButton:function(C,O,G,K,te){var de=un("a",G,K);return de.innerHTML=C,de.href="#",de.title=O,de.setAttribute("role","button"),de.setAttribute("aria-label",O),AS(de),xi(de,"click",Zg),xi(de,"click",te,this),xi(de,"click",this._refocusOnMap,this),de},_updateDisabled:function(){var C=this._map,O="leaflet-disabled";Ur(this._zoomInButton,O),Ur(this._zoomOutButton,O),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||C._zoom===C.getMinZoom())&&(Si(this._zoomOutButton,O),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||C._zoom===C.getMaxZoom())&&(Si(this._zoomInButton,O),this._zoomInButton.setAttribute("aria-disabled","true"))}});bn.mergeOptions({zoomControl:!0}),bn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new uL,this.addControl(this.zoomControl))});var HUe=function(C){return new uL(C)},F8=jc.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(C){var O="leaflet-control-scale",G=un("div",O),K=this.options;return this._addScales(K,O+"-line",G),C.on(K.updateWhenIdle?"moveend":"move",this._update,this),C.whenReady(this._update,this),G},onRemove:function(C){C.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(C,O,G){C.metric&&(this._mScale=un("div",O,G)),C.imperial&&(this._iScale=un("div",O,G))},_update:function(){var C=this._map,O=C.getSize().y/2,G=C.distance(C.containerPointToLatLng([0,O]),C.containerPointToLatLng([this.options.maxWidth,O]));this._updateScales(G)},_updateScales:function(C){this.options.metric&&C&&this._updateMetric(C),this.options.imperial&&C&&this._updateImperial(C)},_updateMetric:function(C){var O=this._getRoundNum(C),G=O<1e3?O+" m":O/1e3+" km";this._updateScale(this._mScale,G,O/C)},_updateImperial:function(C){var O=C*3.2808399,G,K,te;O>5280?(G=O/5280,K=this._getRoundNum(G),this._updateScale(this._iScale,K+" mi",K/G)):(te=this._getRoundNum(O),this._updateScale(this._iScale,te+" ft",te/O))},_updateScale:function(C,O,G){C.style.width=Math.round(this.options.maxWidth*G)+"px",C.innerHTML=O},_getRoundNum:function(C){var O=Math.pow(10,(Math.floor(C)+"").length-1),G=C/O;return G=G>=10?10:G>=5?5:G>=3?3:G>=2?2:1,O*G}}),zUe=function(C){return new F8(C)},qUe='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',cL=jc.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(It.inlineSvg?qUe+" ":"")+"Leaflet</a>"},initialize:function(C){m(this,C),this._attributions={}},onAdd:function(C){C.attributionControl=this,this._container=un("div","leaflet-control-attribution"),AS(this._container);for(var O in C._layers)C._layers[O].getAttribution&&this.addAttribution(C._layers[O].getAttribution());return this._update(),C.on("layeradd",this._addAttribution,this),this._container},onRemove:function(C){C.off("layeradd",this._addAttribution,this)},_addAttribution:function(C){C.layer.getAttribution&&(this.addAttribution(C.layer.getAttribution()),C.layer.once("remove",function(){this.removeAttribution(C.layer.getAttribution())},this))},setPrefix:function(C){return this.options.prefix=C,this._update(),this},addAttribution:function(C){return C?(this._attributions[C]||(this._attributions[C]=0),this._attributions[C]++,this._update(),this):this},removeAttribution:function(C){return C?(this._attributions[C]&&(this._attributions[C]--,this._update()),this):this},_update:function(){if(this._map){var C=[];for(var O in this._attributions)this._attributions[O]&&C.push(O);var G=[];this.options.prefix&&G.push(this.options.prefix),C.length&&G.push(C.join(", ")),this._container.innerHTML=G.join(' <span aria-hidden="true">|</span> ')}}});bn.mergeOptions({attributionControl:!0}),bn.addInitHook(function(){this.options.attributionControl&&new cL().addTo(this)});var WUe=function(C){return new cL(C)};jc.Layers=L8,jc.Zoom=uL,jc.Scale=F8,jc.Attribution=cL,_S.layers=GUe,_S.zoom=HUe,_S.scale=zUe,_S.attribution=WUe;var Hd=M.extend({initialize:function(C){this._map=C},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Hd.addTo=function(C,O){return C.addHandler(O,this),this};var KUe={Events:_},B8=It.touch?"touchstart mousedown":"mousedown",im=k.extend({options:{clickTolerance:3},initialize:function(C,O,G,K){m(this,K),this._element=C,this._dragStartTarget=O||C,this._preventOutline=G},enable:function(){this._enabled||(xi(this._dragStartTarget,B8,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(im._dragging===this&&this.finishDrag(!0),Pr(this._dragStartTarget,B8,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(C){if(this._enabled&&(this._moved=!1,!cn(this._element,"leaflet-zoom-anim"))){if(C.touches&&C.touches.length!==1){im._dragging===this&&this.finishDrag();return}if(!(im._dragging||C.shiftKey||C.which!==1&&C.button!==1&&!C.touches)&&(im._dragging=this,this._preventOutline&&iL(this._element),Qh(),ba(),!this._moving)){this.fire("down");var O=C.touches?C.touches[0]:C,G=N8(this._element);this._startPoint=new B(O.clientX,O.clientY),this._startPos=_i(this._element),this._parentScale=nL(G);var K=C.type==="mousedown";xi(document,K?"mousemove":"touchmove",this._onMove,this),xi(document,K?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(C){if(this._enabled){if(C.touches&&C.touches.length>1){this._moved=!0;return}var O=C.touches&&C.touches.length===1?C.touches[0]:C,G=new B(O.clientX,O.clientY)._subtract(this._startPoint);!G.x&&!G.y||Math.abs(G.x)+Math.abs(G.y)<this.options.clickTolerance||(G.x/=this._parentScale.x,G.y/=this._parentScale.y,xo(C),this._moved||(this.fire("dragstart"),this._moved=!0,Si(document.body,"leaflet-dragging"),this._lastTarget=C.target||C.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Si(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(G),this._moving=!0,this._lastEvent=C,this._updatePosition())}},_updatePosition:function(){var C={originalEvent:this._lastEvent};this.fire("predrag",C),_t(this._element,this._newPos),this.fire("drag",C)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(C){Ur(document.body,"leaflet-dragging"),this._lastTarget&&(Ur(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Pr(document,"mousemove touchmove",this._onMove,this),Pr(document,"mouseup touchend touchcancel",this._onUp,this),em(),fu();var O=this._moved&&this._moving;this._moving=!1,im._dragging=!1,O&&this.fire("dragend",{noInertia:C,distance:this._newPos.distanceTo(this._startPos)})}});function $8(C,O,G){var K,te=[1,4,2,8],de,Te,Re,xe,Ye,wt,si,tn;for(de=0,wt=C.length;de<wt;de++)C[de]._code=Xg(C[de],O);for(Re=0;Re<4;Re++){for(si=te[Re],K=[],de=0,wt=C.length,Te=wt-1;de<wt;Te=de++)xe=C[de],Ye=C[Te],xe._code&si?Ye._code&si||(tn=HE(Ye,xe,si,O,G),tn._code=Xg(tn,O),K.push(tn)):(Ye._code&si&&(tn=HE(Ye,xe,si,O,G),tn._code=Xg(tn,O),K.push(tn)),K.push(xe));C=K}return C}function V8(C,O){var G,K,te,de,Te,Re,xe,Ye,wt;if(!C||C.length===0)throw new Error("latlngs not passed");Zu(C)||(console.warn("latlngs are not flat! Only the first ring will be used"),C=C[0]);var si=q([0,0]),tn=H(C),Cs=tn.getNorthWest().distanceTo(tn.getSouthWest())*tn.getNorthEast().distanceTo(tn.getNorthWest());Cs<1700&&(si=dL(C));var wo=C.length,Xu=[];for(G=0;G<wo;G++){var bl=q(C[G]);Xu.push(O.project(q([bl.lat-si.lat,bl.lng-si.lng])))}for(Re=xe=Ye=0,G=0,K=wo-1;G<wo;K=G++)te=Xu[G],de=Xu[K],Te=te.y*de.x-de.y*te.x,xe+=(te.x+de.x)*Te,Ye+=(te.y+de.y)*Te,Re+=Te*3;Re===0?wt=Xu[0]:wt=[xe/Re,Ye/Re];var zb=O.unproject(x(wt));return q([zb.lat+si.lat,zb.lng+si.lng])}function dL(C){for(var O=0,G=0,K=0,te=0;te<C.length;te++){var de=q(C[te]);O+=de.lat,G+=de.lng,K++}return q([O/K,G/K])}var YUe={__proto__:null,clipPolygon:$8,polygonCenter:V8,centroid:dL};function j8(C,O){if(!O||!C.length)return C.slice();var G=O*O;return C=JUe(C,G),C=XUe(C,G),C}function G8(C,O,G){return Math.sqrt(kS(C,O,G,!0))}function ZUe(C,O,G){return kS(C,O,G)}function XUe(C,O){var G=C.length,K=typeof Uint8Array<"u"?Uint8Array:Array,te=new K(G);te[0]=te[G-1]=1,pL(C,te,O,0,G-1);var de,Te=[];for(de=0;de<G;de++)te[de]&&Te.push(C[de]);return Te}function pL(C,O,G,K,te){var de=0,Te,Re,xe;for(Re=K+1;Re<=te-1;Re++)xe=kS(C[Re],C[K],C[te],!0),xe>de&&(Te=Re,de=xe);de>G&&(O[Te]=1,pL(C,O,G,K,Te),pL(C,O,G,Te,te))}function JUe(C,O){for(var G=[C[0]],K=1,te=0,de=C.length;K<de;K++)QUe(C[K],C[te])>O&&(G.push(C[K]),te=K);return te<de-1&&G.push(C[de-1]),G}var H8;function z8(C,O,G,K,te){var de=K?H8:Xg(C,G),Te=Xg(O,G),Re,xe,Ye;for(H8=Te;;){if(!(de|Te))return[C,O];if(de&Te)return!1;Re=de||Te,xe=HE(C,O,Re,G,te),Ye=Xg(xe,G),Re===de?(C=xe,de=Ye):(O=xe,Te=Ye)}}function HE(C,O,G,K,te){var de=O.x-C.x,Te=O.y-C.y,Re=K.min,xe=K.max,Ye,wt;return G&8?(Ye=C.x+de*(xe.y-C.y)/Te,wt=xe.y):G&4?(Ye=C.x+de*(Re.y-C.y)/Te,wt=Re.y):G&2?(Ye=xe.x,wt=C.y+Te*(xe.x-C.x)/de):G&1&&(Ye=Re.x,wt=C.y+Te*(Re.x-C.x)/de),new B(Ye,wt,te)}function Xg(C,O){var G=0;return C.x<O.min.x?G|=1:C.x>O.max.x&&(G|=2),C.y<O.min.y?G|=4:C.y>O.max.y&&(G|=8),G}function QUe(C,O){var G=O.x-C.x,K=O.y-C.y;return G*G+K*K}function kS(C,O,G,K){var te=O.x,de=O.y,Te=G.x-te,Re=G.y-de,xe=Te*Te+Re*Re,Ye;return xe>0&&(Ye=((C.x-te)*Te+(C.y-de)*Re)/xe,Ye>1?(te=G.x,de=G.y):Ye>0&&(te+=Te*Ye,de+=Re*Ye)),Te=C.x-te,Re=C.y-de,K?Te*Te+Re*Re:new B(te,de)}function Zu(C){return!b(C[0])||typeof C[0][0]!="object"&&typeof C[0][0]<"u"}function q8(C){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Zu(C)}function W8(C,O){var G,K,te,de,Te,Re,xe,Ye;if(!C||C.length===0)throw new Error("latlngs not passed");Zu(C)||(console.warn("latlngs are not flat! Only the first ring will be used"),C=C[0]);var wt=q([0,0]),si=H(C),tn=si.getNorthWest().distanceTo(si.getSouthWest())*si.getNorthEast().distanceTo(si.getNorthWest());tn<1700&&(wt=dL(C));var Cs=C.length,wo=[];for(G=0;G<Cs;G++){var Xu=q(C[G]);wo.push(O.project(q([Xu.lat-wt.lat,Xu.lng-wt.lng])))}for(G=0,K=0;G<Cs-1;G++)K+=wo[G].distanceTo(wo[G+1])/2;if(K===0)Ye=wo[0];else for(G=0,de=0;G<Cs-1;G++)if(Te=wo[G],Re=wo[G+1],te=Te.distanceTo(Re),de+=te,de>K){xe=(de-K)/te,Ye=[Re.x-xe*(Re.x-Te.x),Re.y-xe*(Re.y-Te.y)];break}var bl=O.unproject(x(Ye));return q([bl.lat+wt.lat,bl.lng+wt.lng])}var e1e={__proto__:null,simplify:j8,pointToSegmentDistance:G8,closestPointOnSegment:ZUe,clipSegment:z8,_getEdgeIntersection:HE,_getBitCode:Xg,_sqClosestPointOnSegment:kS,isFlat:Zu,_flat:q8,polylineCenter:W8},fL={project:function(C){return new B(C.lng,C.lat)},unproject:function(C){return new z(C.y,C.x)},bounds:new $([-180,-90],[180,90])},hL={R:6378137,R_MINOR:6356752314245179e-9,bounds:new $([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(C){var O=Math.PI/180,G=this.R,K=C.lat*O,te=this.R_MINOR/G,de=Math.sqrt(1-te*te),Te=de*Math.sin(K),Re=Math.tan(Math.PI/4-K/2)/Math.pow((1-Te)/(1+Te),de/2);return K=-G*Math.log(Math.max(Re,1e-10)),new B(C.lng*O*G,K)},unproject:function(C){for(var O=180/Math.PI,G=this.R,K=this.R_MINOR/G,te=Math.sqrt(1-K*K),de=Math.exp(-C.y/G),Te=Math.PI/2-2*Math.atan(de),Re=0,xe=.1,Ye;Re<15&&Math.abs(xe)>1e-7;Re++)Ye=te*Math.sin(Te),Ye=Math.pow((1-Ye)/(1+Ye),te/2),xe=Math.PI/2-2*Math.atan(de*Ye)-Te,Te+=xe;return new z(Te*O,C.x*O/G)}},t1e={__proto__:null,LonLat:fL,Mercator:hL,SphericalMercator:X},i1e=r({},Y,{code:"EPSG:3395",projection:hL,transformation:function(){var C=.5/(Math.PI*hL.R);return ce(C,.5,-C,.5)}()}),K8=r({},Y,{code:"EPSG:4326",projection:fL,transformation:ce(1/180,1,-1/180,.5)}),n1e=r({},W,{projection:fL,transformation:ce(1,0,-1,0),scale:function(C){return Math.pow(2,C)},zoom:function(C){return Math.log(C)/Math.LN2},distance:function(C,O){var G=O.lng-C.lng,K=O.lat-C.lat;return Math.sqrt(G*G+K*K)},infinite:!0});W.Earth=Y,W.EPSG3395=i1e,W.EPSG3857=J,W.EPSG900913=ee,W.EPSG4326=K8,W.Simple=n1e;var Gc=k.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(C){return C.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(C){return C&&C.removeLayer(this),this},getPane:function(C){return this._map.getPane(C?this.options[C]||C:this.options.pane)},addInteractiveTarget:function(C){return this._map._targets[l(C)]=this,this},removeInteractiveTarget:function(C){return delete this._map._targets[l(C)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(C){var O=C.target;if(O.hasLayer(this)){if(this._map=O,this._zoomAnimated=O._zoomAnimated,this.getEvents){var G=this.getEvents();O.on(G,this),this.once("remove",function(){O.off(G,this)},this)}this.onAdd(O),this.fire("add"),O.fire("layeradd",{layer:this})}}});bn.include({addLayer:function(C){if(!C._layerAdd)throw new Error("The provided object is not a Layer.");var O=l(C);return this._layers[O]?this:(this._layers[O]=C,C._mapToAdd=this,C.beforeAdd&&C.beforeAdd(this),this.whenReady(C._layerAdd,C),this)},removeLayer:function(C){var O=l(C);return this._layers[O]?(this._loaded&&C.onRemove(this),delete this._layers[O],this._loaded&&(this.fire("layerremove",{layer:C}),C.fire("remove")),C._map=C._mapToAdd=null,this):this},hasLayer:function(C){return l(C)in this._layers},eachLayer:function(C,O){for(var G in this._layers)C.call(O,this._layers[G]);return this},_addLayers:function(C){C=C?b(C)?C:[C]:[];for(var O=0,G=C.length;O<G;O++)this.addLayer(C[O])},_addZoomLimit:function(C){(!isNaN(C.options.maxZoom)||!isNaN(C.options.minZoom))&&(this._zoomBoundLayers[l(C)]=C,this._updateZoomLevels())},_removeZoomLimit:function(C){var O=l(C);this._zoomBoundLayers[O]&&(delete this._zoomBoundLayers[O],this._updateZoomLevels())},_updateZoomLevels:function(){var C=1/0,O=-1/0,G=this._getZoomSpan();for(var K in this._zoomBoundLayers){var te=this._zoomBoundLayers[K].options;C=te.minZoom===void 0?C:Math.min(C,te.minZoom),O=te.maxZoom===void 0?O:Math.max(O,te.maxZoom)}this._layersMaxZoom=O===-1/0?void 0:O,this._layersMinZoom=C===1/0?void 0:C,G!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var $b=Gc.extend({initialize:function(C,O){m(this,O),this._layers={};var G,K;if(C)for(G=0,K=C.length;G<K;G++)this.addLayer(C[G])},addLayer:function(C){var O=this.getLayerId(C);return this._layers[O]=C,this._map&&this._map.addLayer(C),this},removeLayer:function(C){var O=C in this._layers?C:this.getLayerId(C);return this._map&&this._layers[O]&&this._map.removeLayer(this._layers[O]),delete this._layers[O],this},hasLayer:function(C){var O=typeof C=="number"?C:this.getLayerId(C);return O in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(C){var O=Array.prototype.slice.call(arguments,1),G,K;for(G in this._layers)K=this._layers[G],K[C]&&K[C].apply(K,O);return this},onAdd:function(C){this.eachLayer(C.addLayer,C)},onRemove:function(C){this.eachLayer(C.removeLayer,C)},eachLayer:function(C,O){for(var G in this._layers)C.call(O,this._layers[G]);return this},getLayer:function(C){return this._layers[C]},getLayers:function(){var C=[];return this.eachLayer(C.push,C),C},setZIndex:function(C){return this.invoke("setZIndex",C)},getLayerId:function(C){return l(C)}}),r1e=function(C,O){return new $b(C,O)},wf=$b.extend({addLayer:function(C){return this.hasLayer(C)?this:(C.addEventParent(this),$b.prototype.addLayer.call(this,C),this.fire("layeradd",{layer:C}))},removeLayer:function(C){return this.hasLayer(C)?(C in this._layers&&(C=this._layers[C]),C.removeEventParent(this),$b.prototype.removeLayer.call(this,C),this.fire("layerremove",{layer:C})):this},setStyle:function(C){return this.invoke("setStyle",C)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var C=new V;for(var O in this._layers){var G=this._layers[O];C.extend(G.getBounds?G.getBounds():G.getLatLng())}return C}}),a1e=function(C,O){return new wf(C,O)},Vb=M.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(C){m(this,C)},createIcon:function(C){return this._createIcon("icon",C)},createShadow:function(C){return this._createIcon("shadow",C)},_createIcon:function(C,O){var G=this._getIconUrl(C);if(!G){if(C==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var K=this._createImg(G,O&&O.tagName==="IMG"?O:null);return this._setIconStyles(K,C),(this.options.crossOrigin||this.options.crossOrigin==="")&&(K.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),K},_setIconStyles:function(C,O){var G=this.options,K=G[O+"Size"];typeof K=="number"&&(K=[K,K]);var te=x(K),de=x(O==="shadow"&&G.shadowAnchor||G.iconAnchor||te&&te.divideBy(2,!0));C.className="leaflet-marker-"+O+" "+(G.className||""),de&&(C.style.marginLeft=-de.x+"px",C.style.marginTop=-de.y+"px"),te&&(C.style.width=te.x+"px",C.style.height=te.y+"px")},_createImg:function(C,O){return O=O||document.createElement("img"),O.src=C,O},_getIconUrl:function(C){return It.retina&&this.options[C+"RetinaUrl"]||this.options[C+"Url"]}});function o1e(C){return new Vb(C)}var OS=Vb.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(C){return typeof OS.imagePath!="string"&&(OS.imagePath=this._detectIconPath()),(this.options.imagePath||OS.imagePath)+Vb.prototype._getIconUrl.call(this,C)},_stripUrl:function(C){var O=function(G,K,te){var de=K.exec(G);return de&&de[te]};return C=O(C,/^url\((['"])?(.+)\1\)$/,2),C&&O(C,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var C=un("div","leaflet-default-icon-path",document.body),O=$c(C,"background-image")||$c(C,"backgroundImage");if(document.body.removeChild(C),O=this._stripUrl(O),O)return O;var G=document.querySelector('link[href$="leaflet.css"]');return G?G.href.substring(0,G.href.length-11-1):""}}),Y8=Hd.extend({initialize:function(C){this._marker=C},addHooks:function(){var C=this._marker._icon;this._draggable||(this._draggable=new im(C,C,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Si(C,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ur(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(C){var O=this._marker,G=O._map,K=this._marker.options.autoPanSpeed,te=this._marker.options.autoPanPadding,de=_i(O._icon),Te=G.getPixelBounds(),Re=G.getPixelOrigin(),xe=j(Te.min._subtract(Re).add(te),Te.max._subtract(Re).subtract(te));if(!xe.contains(de)){var Ye=x((Math.max(xe.max.x,de.x)-xe.max.x)/(Te.max.x-xe.max.x)-(Math.min(xe.min.x,de.x)-xe.min.x)/(Te.min.x-xe.min.x),(Math.max(xe.max.y,de.y)-xe.max.y)/(Te.max.y-xe.max.y)-(Math.min(xe.min.y,de.y)-xe.min.y)/(Te.min.y-xe.min.y)).multiplyBy(K);G.panBy(Ye,{animate:!1}),this._draggable._newPos._add(Ye),this._draggable._startPos._add(Ye),_t(O._icon,this._draggable._newPos),this._onDrag(C),this._panRequest=D(this._adjustPan.bind(this,C))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(C){this._marker.options.autoPan&&(R(this._panRequest),this._panRequest=D(this._adjustPan.bind(this,C)))},_onDrag:function(C){var O=this._marker,G=O._shadow,K=_i(O._icon),te=O._map.layerPointToLatLng(K);G&&_t(G,K),O._latlng=te,C.latlng=te,C.oldLatLng=this._oldLatLng,O.fire("move",C).fire("drag",C)},_onDragEnd:function(C){R(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",C)}}),zE=Gc.extend({options:{icon:new OS,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(C,O){m(this,O),this._latlng=q(C)},onAdd:function(C){this._zoomAnimated=this._zoomAnimated&&C.options.markerZoomAnimation,this._zoomAnimated&&C.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(C){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&C.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(C){var O=this._latlng;return this._latlng=q(C),this.update(),this.fire("move",{oldLatLng:O,latlng:this._latlng})},setZIndexOffset:function(C){return this.options.zIndexOffset=C,this.update()},getIcon:function(){return this.options.icon},setIcon:function(C){return this.options.icon=C,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var C=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(C)}return this},_initIcon:function(){var C=this.options,O="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),G=C.icon.createIcon(this._icon),K=!1;G!==this._icon&&(this._icon&&this._removeIcon(),K=!0,C.title&&(G.title=C.title),G.tagName==="IMG"&&(G.alt=C.alt||"")),Si(G,O),C.keyboard&&(G.tabIndex="0",G.setAttribute("role","button")),this._icon=G,C.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xi(G,"focus",this._panOnFocus,this);var te=C.icon.createShadow(this._shadow),de=!1;te!==this._shadow&&(this._removeShadow(),de=!0),te&&(Si(te,O),te.alt=""),this._shadow=te,C.opacity<1&&this._updateOpacity(),K&&this.getPane().appendChild(this._icon),this._initInteraction(),te&&de&&this.getPane(C.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Pr(this._icon,"focus",this._panOnFocus,this),ar(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ar(this._shadow),this._shadow=null},_setPos:function(C){this._icon&&_t(this._icon,C),this._shadow&&_t(this._shadow,C),this._zIndex=C.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(C){this._icon&&(this._icon.style.zIndex=this._zIndex+C)},_animateZoom:function(C){var O=this._map._latLngToNewLayerPoint(this._latlng,C.zoom,C.center).round();this._setPos(O)},_initInteraction:function(){if(this.options.interactive&&(Si(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Y8)){var C=this.options.draggable;this.dragging&&(C=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Y8(this),C&&this.dragging.enable()}},setOpacity:function(C){return this.options.opacity=C,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var C=this.options.opacity;this._icon&&ct(this._icon,C),this._shadow&&ct(this._shadow,C)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var C=this._map;if(C){var O=this.options.icon.options,G=O.iconSize?x(O.iconSize):x(0,0),K=O.iconAnchor?x(O.iconAnchor):x(0,0);C.panInside(this._latlng,{paddingTopLeft:K,paddingBottomRight:G.subtract(K)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function s1e(C,O){return new zE(C,O)}var nm=Gc.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(C){this._renderer=C.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(C){return m(this,C),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&C&&Object.prototype.hasOwnProperty.call(C,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),qE=nm.extend({options:{fill:!0,radius:10},initialize:function(C,O){m(this,O),this._latlng=q(C),this._radius=this.options.radius},setLatLng:function(C){var O=this._latlng;return this._latlng=q(C),this.redraw(),this.fire("move",{oldLatLng:O,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(C){return this.options.radius=this._radius=C,this.redraw()},getRadius:function(){return this._radius},setStyle:function(C){var O=C&&C.radius||this._radius;return nm.prototype.setStyle.call(this,C),this.setRadius(O),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var C=this._radius,O=this._radiusY||C,G=this._clickTolerance(),K=[C+G,O+G];this._pxBounds=new $(this._point.subtract(K),this._point.add(K))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(C){return C.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function l1e(C,O){return new qE(C,O)}var mL=qE.extend({initialize:function(C,O,G){if(typeof O=="number"&&(O=r({},G,{radius:O})),m(this,O),this._latlng=q(C),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(C){return this._mRadius=C,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var C=[this._radius,this._radiusY||this._radius];return new V(this._map.layerPointToLatLng(this._point.subtract(C)),this._map.layerPointToLatLng(this._point.add(C)))},setStyle:nm.prototype.setStyle,_project:function(){var C=this._latlng.lng,O=this._latlng.lat,G=this._map,K=G.options.crs;if(K.distance===Y.distance){var te=Math.PI/180,de=this._mRadius/Y.R/te,Te=G.project([O+de,C]),Re=G.project([O-de,C]),xe=Te.add(Re).divideBy(2),Ye=G.unproject(xe).lat,wt=Math.acos((Math.cos(de*te)-Math.sin(O*te)*Math.sin(Ye*te))/(Math.cos(O*te)*Math.cos(Ye*te)))/te;(isNaN(wt)||wt===0)&&(wt=de/Math.cos(Math.PI/180*O)),this._point=xe.subtract(G.getPixelOrigin()),this._radius=isNaN(wt)?0:xe.x-G.project([Ye,C-wt]).x,this._radiusY=xe.y-Te.y}else{var si=K.unproject(K.project(this._latlng).subtract([this._mRadius,0]));this._point=G.latLngToLayerPoint(this._latlng),this._radius=this._point.x-G.latLngToLayerPoint(si).x}this._updateBounds()}});function u1e(C,O,G){return new mL(C,O,G)}var Sf=nm.extend({options:{smoothFactor:1,noClip:!1},initialize:function(C,O){m(this,O),this._setLatLngs(C)},getLatLngs:function(){return this._latlngs},setLatLngs:function(C){return this._setLatLngs(C),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(C){for(var O=1/0,G=null,K=kS,te,de,Te=0,Re=this._parts.length;Te<Re;Te++)for(var xe=this._parts[Te],Ye=1,wt=xe.length;Ye<wt;Ye++){te=xe[Ye-1],de=xe[Ye];var si=K(C,te,de,!0);si<O&&(O=si,G=K(C,te,de))}return G&&(G.distance=Math.sqrt(O)),G},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return W8(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(C,O){return O=O||this._defaultShape(),C=q(C),O.push(C),this._bounds.extend(C),this.redraw()},_setLatLngs:function(C){this._bounds=new V,this._latlngs=this._convertLatLngs(C)},_defaultShape:function(){return Zu(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(C){for(var O=[],G=Zu(C),K=0,te=C.length;K<te;K++)G?(O[K]=q(C[K]),this._bounds.extend(O[K])):O[K]=this._convertLatLngs(C[K]);return O},_project:function(){var C=new $;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,C),this._bounds.isValid()&&C.isValid()&&(this._rawPxBounds=C,this._updateBounds())},_updateBounds:function(){var C=this._clickTolerance(),O=new B(C,C);this._rawPxBounds&&(this._pxBounds=new $([this._rawPxBounds.min.subtract(O),this._rawPxBounds.max.add(O)]))},_projectLatlngs:function(C,O,G){var K=C[0]instanceof z,te=C.length,de,Te;if(K){for(Te=[],de=0;de<te;de++)Te[de]=this._map.latLngToLayerPoint(C[de]),G.extend(Te[de]);O.push(Te)}else for(de=0;de<te;de++)this._projectLatlngs(C[de],O,G)},_clipPoints:function(){var C=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(C))){if(this.options.noClip){this._parts=this._rings;return}var O=this._parts,G,K,te,de,Te,Re,xe;for(G=0,te=0,de=this._rings.length;G<de;G++)for(xe=this._rings[G],K=0,Te=xe.length;K<Te-1;K++)Re=z8(xe[K],xe[K+1],C,K,!0),Re&&(O[te]=O[te]||[],O[te].push(Re[0]),(Re[1]!==xe[K+1]||K===Te-2)&&(O[te].push(Re[1]),te++))}},_simplifyPoints:function(){for(var C=this._parts,O=this.options.smoothFactor,G=0,K=C.length;G<K;G++)C[G]=j8(C[G],O)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(C,O){var G,K,te,de,Te,Re,xe=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(C))return!1;for(G=0,de=this._parts.length;G<de;G++)for(Re=this._parts[G],K=0,Te=Re.length,te=Te-1;K<Te;te=K++)if(!(!O&&K===0)&&G8(C,Re[te],Re[K])<=xe)return!0;return!1}});function c1e(C,O){return new Sf(C,O)}Sf._flat=q8;var jb=Sf.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return V8(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(C){var O=Sf.prototype._convertLatLngs.call(this,C),G=O.length;return G>=2&&O[0]instanceof z&&O[0].equals(O[G-1])&&O.pop(),O},_setLatLngs:function(C){Sf.prototype._setLatLngs.call(this,C),Zu(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Zu(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var C=this._renderer._bounds,O=this.options.weight,G=new B(O,O);if(C=new $(C.min.subtract(G),C.max.add(G)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(C))){if(this.options.noClip){this._parts=this._rings;return}for(var K=0,te=this._rings.length,de;K<te;K++)de=$8(this._rings[K],C,!0),de.length&&this._parts.push(de)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(C){var O=!1,G,K,te,de,Te,Re,xe,Ye;if(!this._pxBounds||!this._pxBounds.contains(C))return!1;for(de=0,xe=this._parts.length;de<xe;de++)for(G=this._parts[de],Te=0,Ye=G.length,Re=Ye-1;Te<Ye;Re=Te++)K=G[Te],te=G[Re],K.y>C.y!=te.y>C.y&&C.x<(te.x-K.x)*(C.y-K.y)/(te.y-K.y)+K.x&&(O=!O);return O||Sf.prototype._containsPoint.call(this,C,!0)}});function d1e(C,O){return new jb(C,O)}var Tf=wf.extend({initialize:function(C,O){m(this,O),this._layers={},C&&this.addData(C)},addData:function(C){var O=b(C)?C:C.features,G,K,te;if(O){for(G=0,K=O.length;G<K;G++)te=O[G],(te.geometries||te.geometry||te.features||te.coordinates)&&this.addData(te);return this}var de=this.options;if(de.filter&&!de.filter(C))return this;var Te=WE(C,de);return Te?(Te.feature=ZE(C),Te.defaultOptions=Te.options,this.resetStyle(Te),de.onEachFeature&&de.onEachFeature(C,Te),this.addLayer(Te)):this},resetStyle:function(C){return C===void 0?this.eachLayer(this.resetStyle,this):(C.options=r({},C.defaultOptions),this._setLayerStyle(C,this.options.style),this)},setStyle:function(C){return this.eachLayer(function(O){this._setLayerStyle(O,C)},this)},_setLayerStyle:function(C,O){C.setStyle&&(typeof O=="function"&&(O=O(C.feature)),C.setStyle(O))}});function WE(C,O){var G=C.type==="Feature"?C.geometry:C,K=G?G.coordinates:null,te=[],de=O&&O.pointToLayer,Te=O&&O.coordsToLatLng||gL,Re,xe,Ye,wt;if(!K&&!G)return null;switch(G.type){case"Point":return Re=Te(K),Z8(de,C,Re,O);case"MultiPoint":for(Ye=0,wt=K.length;Ye<wt;Ye++)Re=Te(K[Ye]),te.push(Z8(de,C,Re,O));return new wf(te);case"LineString":case"MultiLineString":return xe=KE(K,G.type==="LineString"?0:1,Te),new Sf(xe,O);case"Polygon":case"MultiPolygon":return xe=KE(K,G.type==="Polygon"?1:2,Te),new jb(xe,O);case"GeometryCollection":for(Ye=0,wt=G.geometries.length;Ye<wt;Ye++){var si=WE({geometry:G.geometries[Ye],type:"Feature",properties:C.properties},O);si&&te.push(si)}return new wf(te);case"FeatureCollection":for(Ye=0,wt=G.features.length;Ye<wt;Ye++){var tn=WE(G.features[Ye],O);tn&&te.push(tn)}return new wf(te);default:throw new Error("Invalid GeoJSON object.")}}function Z8(C,O,G,K){return C?C(O,G):new zE(G,K&&K.markersInheritOptions&&K)}function gL(C){return new z(C[1],C[0],C[2])}function KE(C,O,G){for(var K=[],te=0,de=C.length,Te;te<de;te++)Te=O?KE(C[te],O-1,G):(G||gL)(C[te]),K.push(Te);return K}function vL(C,O){return C=q(C),C.alt!==void 0?[p(C.lng,O),p(C.lat,O),p(C.alt,O)]:[p(C.lng,O),p(C.lat,O)]}function YE(C,O,G,K){for(var te=[],de=0,Te=C.length;de<Te;de++)te.push(O?YE(C[de],Zu(C[de])?0:O-1,G,K):vL(C[de],K));return!O&&G&&te.length>0&&te.push(te[0].slice()),te}function Gb(C,O){return C.feature?r({},C.feature,{geometry:O}):ZE(O)}function ZE(C){return C.type==="Feature"||C.type==="FeatureCollection"?C:{type:"Feature",properties:{},geometry:C}}var yL={toGeoJSON:function(C){return Gb(this,{type:"Point",coordinates:vL(this.getLatLng(),C)})}};zE.include(yL),mL.include(yL),qE.include(yL),Sf.include({toGeoJSON:function(C){var O=!Zu(this._latlngs),G=YE(this._latlngs,O?1:0,!1,C);return Gb(this,{type:(O?"Multi":"")+"LineString",coordinates:G})}}),jb.include({toGeoJSON:function(C){var O=!Zu(this._latlngs),G=O&&!Zu(this._latlngs[0]),K=YE(this._latlngs,G?2:O?1:0,!0,C);return O||(K=[K]),Gb(this,{type:(G?"Multi":"")+"Polygon",coordinates:K})}}),$b.include({toMultiPoint:function(C){var O=[];return this.eachLayer(function(G){O.push(G.toGeoJSON(C).geometry.coordinates)}),Gb(this,{type:"MultiPoint",coordinates:O})},toGeoJSON:function(C){var O=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(O==="MultiPoint")return this.toMultiPoint(C);var G=O==="GeometryCollection",K=[];return this.eachLayer(function(te){if(te.toGeoJSON){var de=te.toGeoJSON(C);if(G)K.push(de.geometry);else{var Te=ZE(de);Te.type==="FeatureCollection"?K.push.apply(K,Te.features):K.push(Te)}}}),G?Gb(this,{geometries:K,type:"GeometryCollection"}):{type:"FeatureCollection",features:K}}});function X8(C,O){return new Tf(C,O)}var p1e=X8,XE=Gc.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(C,O,G){this._url=C,this._bounds=H(O),m(this,G)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Si(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ar(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(C){return this.options.opacity=C,this._image&&this._updateOpacity(),this},setStyle:function(C){return C.opacity&&this.setOpacity(C.opacity),this},bringToFront:function(){return this._map&&Vc(this._image),this},bringToBack:function(){return this._map&&yl(this._image),this},setUrl:function(C){return this._url=C,this._image&&(this._image.src=C),this},setBounds:function(C){return this._bounds=H(C),this._map&&this._reset(),this},getEvents:function(){var C={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(C.zoomanim=this._animateZoom),C},setZIndex:function(C){return this.options.zIndex=C,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var C=this._url.tagName==="IMG",O=this._image=C?this._url:un("img");if(Si(O,"leaflet-image-layer"),this._zoomAnimated&&Si(O,"leaflet-zoom-animated"),this.options.className&&Si(O,this.options.className),O.onselectstart=d,O.onmousemove=d,O.onload=o(this.fire,this,"load"),O.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(O.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),C){this._url=O.src;return}O.src=this._url,O.alt=this.options.alt},_animateZoom:function(C){var O=this._map.getZoomScale(C.zoom),G=this._map._latLngBoundsToNewLayerBounds(this._bounds,C.zoom,C.center).min;fn(this._image,G,O)},_reset:function(){var C=this._image,O=new $(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),G=O.getSize();_t(C,O.min),C.style.width=G.x+"px",C.style.height=G.y+"px"},_updateOpacity:function(){ct(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var C=this.options.errorOverlayUrl;C&&this._url!==C&&(this._url=C,this._image.src=C)},getCenter:function(){return this._bounds.getCenter()}}),f1e=function(C,O,G){return new XE(C,O,G)},J8=XE.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var C=this._url.tagName==="VIDEO",O=this._image=C?this._url:un("video");if(Si(O,"leaflet-image-layer"),this._zoomAnimated&&Si(O,"leaflet-zoom-animated"),this.options.className&&Si(O,this.options.className),O.onselectstart=d,O.onmousemove=d,O.onloadeddata=o(this.fire,this,"load"),C){for(var G=O.getElementsByTagName("source"),K=[],te=0;te<G.length;te++)K.push(G[te].src);this._url=G.length>0?K:[O.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(O.style,"objectFit")&&(O.style.objectFit="fill"),O.autoplay=!!this.options.autoplay,O.loop=!!this.options.loop,O.muted=!!this.options.muted,O.playsInline=!!this.options.playsInline;for(var de=0;de<this._url.length;de++){var Te=un("source");Te.src=this._url[de],O.appendChild(Te)}}});function h1e(C,O,G){return new J8(C,O,G)}var Q8=XE.extend({_initImage:function(){var C=this._image=this._url;Si(C,"leaflet-image-layer"),this._zoomAnimated&&Si(C,"leaflet-zoom-animated"),this.options.className&&Si(C,this.options.className),C.onselectstart=d,C.onmousemove=d}});function m1e(C,O,G){return new Q8(C,O,G)}var zd=Gc.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(C,O){C&&(C instanceof z||b(C))?(this._latlng=q(C),m(this,O)):(m(this,C),this._source=O),this.options.content&&(this._content=this.options.content)},openOn:function(C){return C=arguments.length?C:this._source._map,C.hasLayer(this)||C.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(C){return this._map?this.close():(arguments.length?this._source=C:C=this._source,this._prepareOpen(),this.openOn(C._map)),this},onAdd:function(C){this._zoomAnimated=C._zoomAnimated,this._container||this._initLayout(),C._fadeAnimated&&ct(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),C._fadeAnimated&&ct(this._container,1),this.bringToFront(),this.options.interactive&&(Si(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(C){C._fadeAnimated?(ct(this._container,0),this._removeTimeout=setTimeout(o(ar,void 0,this._container),200)):ar(this._container),this.options.interactive&&(Ur(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(C){return this._latlng=q(C),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(C){return this._content=C,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var C={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(C.zoomanim=this._animateZoom),C},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Vc(this._container),this},bringToBack:function(){return this._map&&yl(this._container),this},_prepareOpen:function(C){var O=this._source;if(!O._map)return!1;if(O instanceof wf){O=null;var G=this._source._layers;for(var K in G)if(G[K]._map){O=G[K];break}if(!O)return!1;this._source=O}if(!C)if(O.getCenter)C=O.getCenter();else if(O.getLatLng)C=O.getLatLng();else if(O.getBounds)C=O.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(C),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var C=this._contentNode,O=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof O=="string")C.innerHTML=O;else{for(;C.hasChildNodes();)C.removeChild(C.firstChild);C.appendChild(O)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var C=this._map.latLngToLayerPoint(this._latlng),O=x(this.options.offset),G=this._getAnchor();this._zoomAnimated?_t(this._container,C.add(G)):O=O.add(C).add(G);var K=this._containerBottom=-O.y,te=this._containerLeft=-Math.round(this._containerWidth/2)+O.x;this._container.style.bottom=K+"px",this._container.style.left=te+"px"}},_getAnchor:function(){return[0,0]}});bn.include({_initOverlay:function(C,O,G,K){var te=O;return te instanceof C||(te=new C(K).setContent(O)),G&&te.setLatLng(G),te}}),Gc.include({_initOverlay:function(C,O,G,K){var te=G;return te instanceof C?(m(te,K),te._source=this):(te=O&&!K?O:new C(K,this),te.setContent(G)),te}});var JE=zd.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(C){return C=arguments.length?C:this._source._map,!C.hasLayer(this)&&C._popup&&C._popup.options.autoClose&&C.removeLayer(C._popup),C._popup=this,zd.prototype.openOn.call(this,C)},onAdd:function(C){zd.prototype.onAdd.call(this,C),C.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof nm||this._source.on("preclick",Yg))},onRemove:function(C){zd.prototype.onRemove.call(this,C),C.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof nm||this._source.off("preclick",Yg))},getEvents:function(){var C=zd.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(C.preclick=this.close),this.options.keepInView&&(C.moveend=this._adjustPan),C},_initLayout:function(){var C="leaflet-popup",O=this._container=un("div",C+" "+(this.options.className||"")+" leaflet-zoom-animated"),G=this._wrapper=un("div",C+"-content-wrapper",O);if(this._contentNode=un("div",C+"-content",G),AS(O),sL(this._contentNode),xi(O,"contextmenu",Yg),this._tipContainer=un("div",C+"-tip-container",O),this._tip=un("div",C+"-tip",this._tipContainer),this.options.closeButton){var K=this._closeButton=un("a",C+"-close-button",O);K.setAttribute("role","button"),K.setAttribute("aria-label","Close popup"),K.href="#close",K.innerHTML='<span aria-hidden="true">&#215;</span>',xi(K,"click",function(te){xo(te),this.close()},this)}},_updateLayout:function(){var C=this._contentNode,O=C.style;O.width="",O.whiteSpace="nowrap";var G=C.offsetWidth;G=Math.min(G,this.options.maxWidth),G=Math.max(G,this.options.minWidth),O.width=G+1+"px",O.whiteSpace="",O.height="";var K=C.offsetHeight,te=this.options.maxHeight,de="leaflet-popup-scrolled";te&&K>te?(O.height=te+"px",Si(C,de)):Ur(C,de),this._containerWidth=this._container.offsetWidth},_animateZoom:function(C){var O=this._map._latLngToNewLayerPoint(this._latlng,C.zoom,C.center),G=this._getAnchor();_t(this._container,O.add(G))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var C=this._map,O=parseInt($c(this._container,"marginBottom"),10)||0,G=this._container.offsetHeight+O,K=this._containerWidth,te=new B(this._containerLeft,-G-this._containerBottom);te._add(_i(this._container));var de=C.layerPointToContainerPoint(te),Te=x(this.options.autoPanPadding),Re=x(this.options.autoPanPaddingTopLeft||Te),xe=x(this.options.autoPanPaddingBottomRight||Te),Ye=C.getSize(),wt=0,si=0;de.x+K+xe.x>Ye.x&&(wt=de.x+K-Ye.x+xe.x),de.x-wt-Re.x<0&&(wt=de.x-Re.x),de.y+G+xe.y>Ye.y&&(si=de.y+G-Ye.y+xe.y),de.y-si-Re.y<0&&(si=de.y-Re.y),(wt||si)&&(this.options.keepInView&&(this._autopanning=!0),C.fire("autopanstart").panBy([wt,si]))}},_getAnchor:function(){return x(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),g1e=function(C,O){return new JE(C,O)};bn.mergeOptions({closePopupOnClick:!0}),bn.include({openPopup:function(C,O,G){return this._initOverlay(JE,C,O,G).openOn(this),this},closePopup:function(C){return C=arguments.length?C:this._popup,C&&C.close(),this}}),Gc.include({bindPopup:function(C,O){return this._popup=this._initOverlay(JE,this._popup,C,O),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(C){return this._popup&&(this instanceof wf||(this._popup._source=this),this._popup._prepareOpen(C||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(C){return this._popup&&this._popup.setContent(C),this},getPopup:function(){return this._popup},_openPopup:function(C){if(!(!this._popup||!this._map)){Zg(C);var O=C.layer||C.target;if(this._popup._source===O&&!(O instanceof nm)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(C.latlng);return}this._popup._source=O,this.openPopup(C.latlng)}},_movePopup:function(C){this._popup.setLatLng(C.latlng)},_onKeyPress:function(C){C.originalEvent.keyCode===13&&this._openPopup(C)}});var QE=zd.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(C){zd.prototype.onAdd.call(this,C),this.setOpacity(this.options.opacity),C.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(C){zd.prototype.onRemove.call(this,C),C.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var C=zd.prototype.getEvents.call(this);return this.options.permanent||(C.preclick=this.close),C},_initLayout:function(){var C="leaflet-tooltip",O=C+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=un("div",O),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(C){var O,G,K=this._map,te=this._container,de=K.latLngToContainerPoint(K.getCenter()),Te=K.layerPointToContainerPoint(C),Re=this.options.direction,xe=te.offsetWidth,Ye=te.offsetHeight,wt=x(this.options.offset),si=this._getAnchor();Re==="top"?(O=xe/2,G=Ye):Re==="bottom"?(O=xe/2,G=0):Re==="center"?(O=xe/2,G=Ye/2):Re==="right"?(O=0,G=Ye/2):Re==="left"?(O=xe,G=Ye/2):Te.x<de.x?(Re="right",O=0,G=Ye/2):(Re="left",O=xe+(wt.x+si.x)*2,G=Ye/2),C=C.subtract(x(O,G,!0)).add(wt).add(si),Ur(te,"leaflet-tooltip-right"),Ur(te,"leaflet-tooltip-left"),Ur(te,"leaflet-tooltip-top"),Ur(te,"leaflet-tooltip-bottom"),Si(te,"leaflet-tooltip-"+Re),_t(te,C)},_updatePosition:function(){var C=this._map.latLngToLayerPoint(this._latlng);this._setPosition(C)},setOpacity:function(C){this.options.opacity=C,this._container&&ct(this._container,C)},_animateZoom:function(C){var O=this._map._latLngToNewLayerPoint(this._latlng,C.zoom,C.center);this._setPosition(O)},_getAnchor:function(){return x(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),v1e=function(C,O){return new QE(C,O)};bn.include({openTooltip:function(C,O,G){return this._initOverlay(QE,C,O,G).openOn(this),this},closeTooltip:function(C){return C.close(),this}}),Gc.include({bindTooltip:function(C,O){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(QE,this._tooltip,C,O),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(C){if(!(!C&&this._tooltipHandlersAdded)){var O=C?"off":"on",G={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?G.add=this._openTooltip:(G.mouseover=this._openTooltip,G.mouseout=this.closeTooltip,G.click=this._openTooltip,this._map?this._addFocusListeners():G.add=this._addFocusListeners),this._tooltip.options.sticky&&(G.mousemove=this._moveTooltip),this[O](G),this._tooltipHandlersAdded=!C}},openTooltip:function(C){return this._tooltip&&(this instanceof wf||(this._tooltip._source=this),this._tooltip._prepareOpen(C)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(C){return this._tooltip&&this._tooltip.setContent(C),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(C){var O=typeof C.getElement=="function"&&C.getElement();O&&(xi(O,"focus",function(){this._tooltip._source=C,this.openTooltip()},this),xi(O,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(C){var O=typeof C.getElement=="function"&&C.getElement();O&&O.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(C){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var O=this;this._map.once("moveend",function(){O._openOnceFlag=!1,O._openTooltip(C)});return}this._tooltip._source=C.layer||C.target,this.openTooltip(this._tooltip.options.sticky?C.latlng:void 0)}},_moveTooltip:function(C){var O=C.latlng,G,K;this._tooltip.options.sticky&&C.originalEvent&&(G=this._map.mouseEventToContainerPoint(C.originalEvent),K=this._map.containerPointToLayerPoint(G),O=this._map.layerPointToLatLng(K)),this._tooltip.setLatLng(O)}});var e7=Vb.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(C){var O=C&&C.tagName==="DIV"?C:document.createElement("div"),G=this.options;if(G.html instanceof Element?(If(O),O.appendChild(G.html)):O.innerHTML=G.html!==!1?G.html:"",G.bgPos){var K=x(G.bgPos);O.style.backgroundPosition=-K.x+"px "+-K.y+"px"}return this._setIconStyles(O,"icon"),O},createShadow:function(){return null}});function y1e(C){return new e7(C)}Vb.Default=OS;var xS=Gc.extend({options:{tileSize:256,opacity:1,updateWhenIdle:It.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(C){m(this,C)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(C){C._addZoomLimit(this)},onRemove:function(C){this._removeAllTiles(),ar(this._container),C._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Vc(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yl(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(C){return this.options.opacity=C,this._updateOpacity(),this},setZIndex:function(C){return this.options.zIndex=C,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var C=this._clampZoom(this._map.getZoom());C!==this._tileZoom&&(this._tileZoom=C,this._updateLevels()),this._update()}return this},getEvents:function(){var C={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=u(this._onMoveEnd,this.options.updateInterval,this)),C.move=this._onMove),this._zoomAnimated&&(C.zoomanim=this._animateZoom),C},createTile:function(){return document.createElement("div")},getTileSize:function(){var C=this.options.tileSize;return C instanceof B?C:new B(C,C)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(C){for(var O=this.getPane().children,G=-C(-1/0,1/0),K=0,te=O.length,de;K<te;K++)de=O[K].style.zIndex,O[K]!==this._container&&de&&(G=C(G,+de));isFinite(G)&&(this.options.zIndex=G+C(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!It.ielt9){ct(this._container,this.options.opacity);var C=+new Date,O=!1,G=!1;for(var K in this._tiles){var te=this._tiles[K];if(!(!te.current||!te.loaded)){var de=Math.min(1,(C-te.loaded)/200);ct(te.el,de),de<1?O=!0:(te.active?G=!0:this._onOpaqueTile(te),te.active=!0)}}G&&!this._noPrune&&this._pruneTiles(),O&&(R(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=un("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var C=this._tileZoom,O=this.options.maxZoom;if(C!==void 0){for(var G in this._levels)G=Number(G),this._levels[G].el.children.length||G===C?(this._levels[G].el.style.zIndex=O-Math.abs(C-G),this._onUpdateLevel(G)):(ar(this._levels[G].el),this._removeTilesAtZoom(G),this._onRemoveLevel(G),delete this._levels[G]);var K=this._levels[C],te=this._map;return K||(K=this._levels[C]={},K.el=un("div","leaflet-tile-container leaflet-zoom-animated",this._container),K.el.style.zIndex=O,K.origin=te.project(te.unproject(te.getPixelOrigin()),C).round(),K.zoom=C,this._setZoomTransform(K,te.getCenter(),te.getZoom()),d(K.el.offsetWidth),this._onCreateLevel(K)),this._level=K,K}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var C,O,G=this._map.getZoom();if(G>this.options.maxZoom||G<this.options.minZoom){this._removeAllTiles();return}for(C in this._tiles)O=this._tiles[C],O.retain=O.current;for(C in this._tiles)if(O=this._tiles[C],O.current&&!O.active){var K=O.coords;this._retainParent(K.x,K.y,K.z,K.z-5)||this._retainChildren(K.x,K.y,K.z,K.z+2)}for(C in this._tiles)this._tiles[C].retain||this._removeTile(C)}},_removeTilesAtZoom:function(C){for(var O in this._tiles)this._tiles[O].coords.z===C&&this._removeTile(O)},_removeAllTiles:function(){for(var C in this._tiles)this._removeTile(C)},_invalidateAll:function(){for(var C in this._levels)ar(this._levels[C].el),this._onRemoveLevel(Number(C)),delete this._levels[C];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(C,O,G,K){var te=Math.floor(C/2),de=Math.floor(O/2),Te=G-1,Re=new B(+te,+de);Re.z=+Te;var xe=this._tileCoordsToKey(Re),Ye=this._tiles[xe];return Ye&&Ye.active?(Ye.retain=!0,!0):(Ye&&Ye.loaded&&(Ye.retain=!0),Te>K?this._retainParent(te,de,Te,K):!1)},_retainChildren:function(C,O,G,K){for(var te=2*C;te<2*C+2;te++)for(var de=2*O;de<2*O+2;de++){var Te=new B(te,de);Te.z=G+1;var Re=this._tileCoordsToKey(Te),xe=this._tiles[Re];if(xe&&xe.active){xe.retain=!0;continue}else xe&&xe.loaded&&(xe.retain=!0);G+1<K&&this._retainChildren(te,de,G+1,K)}},_resetView:function(C){var O=C&&(C.pinch||C.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),O,O)},_animateZoom:function(C){this._setView(C.center,C.zoom,!0,C.noUpdate)},_clampZoom:function(C){var O=this.options;return O.minNativeZoom!==void 0&&C<O.minNativeZoom?O.minNativeZoom:O.maxNativeZoom!==void 0&&O.maxNativeZoom<C?O.maxNativeZoom:C},_setView:function(C,O,G,K){var te=Math.round(O);this.options.maxZoom!==void 0&&te>this.options.maxZoom||this.options.minZoom!==void 0&&te<this.options.minZoom?te=void 0:te=this._clampZoom(te);var de=this.options.updateWhenZooming&&te!==this._tileZoom;(!K||de)&&(this._tileZoom=te,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),te!==void 0&&this._update(C),G||this._pruneTiles(),this._noPrune=!!G),this._setZoomTransforms(C,O)},_setZoomTransforms:function(C,O){for(var G in this._levels)this._setZoomTransform(this._levels[G],C,O)},_setZoomTransform:function(C,O,G){var K=this._map.getZoomScale(G,C.zoom),te=C.origin.multiplyBy(K).subtract(this._map._getNewPixelOrigin(O,G)).round();It.any3d?fn(C.el,te,K):_t(C.el,te)},_resetGrid:function(){var C=this._map,O=C.options.crs,G=this._tileSize=this.getTileSize(),K=this._tileZoom,te=this._map.getPixelWorldBounds(this._tileZoom);te&&(this._globalTileRange=this._pxBoundsToTileRange(te)),this._wrapX=O.wrapLng&&!this.options.noWrap&&[Math.floor(C.project([0,O.wrapLng[0]],K).x/G.x),Math.ceil(C.project([0,O.wrapLng[1]],K).x/G.y)],this._wrapY=O.wrapLat&&!this.options.noWrap&&[Math.floor(C.project([O.wrapLat[0],0],K).y/G.x),Math.ceil(C.project([O.wrapLat[1],0],K).y/G.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(C){var O=this._map,G=O._animatingZoom?Math.max(O._animateToZoom,O.getZoom()):O.getZoom(),K=O.getZoomScale(G,this._tileZoom),te=O.project(C,this._tileZoom).floor(),de=O.getSize().divideBy(K*2);return new $(te.subtract(de),te.add(de))},_update:function(C){var O=this._map;if(O){var G=this._clampZoom(O.getZoom());if(C===void 0&&(C=O.getCenter()),this._tileZoom!==void 0){var K=this._getTiledPixelBounds(C),te=this._pxBoundsToTileRange(K),de=te.getCenter(),Te=[],Re=this.options.keepBuffer,xe=new $(te.getBottomLeft().subtract([Re,-Re]),te.getTopRight().add([Re,-Re]));if(!(isFinite(te.min.x)&&isFinite(te.min.y)&&isFinite(te.max.x)&&isFinite(te.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ye in this._tiles){var wt=this._tiles[Ye].coords;(wt.z!==this._tileZoom||!xe.contains(new B(wt.x,wt.y)))&&(this._tiles[Ye].current=!1)}if(Math.abs(G-this._tileZoom)>1){this._setView(C,G);return}for(var si=te.min.y;si<=te.max.y;si++)for(var tn=te.min.x;tn<=te.max.x;tn++){var Cs=new B(tn,si);if(Cs.z=this._tileZoom,!!this._isValidTile(Cs)){var wo=this._tiles[this._tileCoordsToKey(Cs)];wo?wo.current=!0:Te.push(Cs)}}if(Te.sort(function(bl,zb){return bl.distanceTo(de)-zb.distanceTo(de)}),Te.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Xu=document.createDocumentFragment();for(tn=0;tn<Te.length;tn++)this._addTile(Te[tn],Xu);this._level.el.appendChild(Xu)}}}},_isValidTile:function(C){var O=this._map.options.crs;if(!O.infinite){var G=this._globalTileRange;if(!O.wrapLng&&(C.x<G.min.x||C.x>G.max.x)||!O.wrapLat&&(C.y<G.min.y||C.y>G.max.y))return!1}if(!this.options.bounds)return!0;var K=this._tileCoordsToBounds(C);return H(this.options.bounds).overlaps(K)},_keyToBounds:function(C){return this._tileCoordsToBounds(this._keyToTileCoords(C))},_tileCoordsToNwSe:function(C){var O=this._map,G=this.getTileSize(),K=C.scaleBy(G),te=K.add(G),de=O.unproject(K,C.z),Te=O.unproject(te,C.z);return[de,Te]},_tileCoordsToBounds:function(C){var O=this._tileCoordsToNwSe(C),G=new V(O[0],O[1]);return this.options.noWrap||(G=this._map.wrapLatLngBounds(G)),G},_tileCoordsToKey:function(C){return C.x+":"+C.y+":"+C.z},_keyToTileCoords:function(C){var O=C.split(":"),G=new B(+O[0],+O[1]);return G.z=+O[2],G},_removeTile:function(C){var O=this._tiles[C];O&&(ar(O.el),delete this._tiles[C],this.fire("tileunload",{tile:O.el,coords:this._keyToTileCoords(C)}))},_initTile:function(C){Si(C,"leaflet-tile");var O=this.getTileSize();C.style.width=O.x+"px",C.style.height=O.y+"px",C.onselectstart=d,C.onmousemove=d,It.ielt9&&this.options.opacity<1&&ct(C,this.options.opacity)},_addTile:function(C,O){var G=this._getTilePos(C),K=this._tileCoordsToKey(C),te=this.createTile(this._wrapCoords(C),o(this._tileReady,this,C));this._initTile(te),this.createTile.length<2&&D(o(this._tileReady,this,C,null,te)),_t(te,G),this._tiles[K]={el:te,coords:C,current:!0},O.appendChild(te),this.fire("tileloadstart",{tile:te,coords:C})},_tileReady:function(C,O,G){O&&this.fire("tileerror",{error:O,tile:G,coords:C});var K=this._tileCoordsToKey(C);G=this._tiles[K],G&&(G.loaded=+new Date,this._map._fadeAnimated?(ct(G.el,0),R(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this)):(G.active=!0,this._pruneTiles()),O||(Si(G.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:G.el,coords:C})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),It.ielt9||!this._map._fadeAnimated?D(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(C){return C.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(C){var O=new B(this._wrapX?c(C.x,this._wrapX):C.x,this._wrapY?c(C.y,this._wrapY):C.y);return O.z=C.z,O},_pxBoundsToTileRange:function(C){var O=this.getTileSize();return new $(C.min.unscaleBy(O).floor(),C.max.unscaleBy(O).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var C in this._tiles)if(!this._tiles[C].loaded)return!1;return!0}});function b1e(C){return new xS(C)}var Hb=xS.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(C,O){this._url=C,O=m(this,O),O.detectRetina&&It.retina&&O.maxZoom>0?(O.tileSize=Math.floor(O.tileSize/2),O.zoomReverse?(O.zoomOffset--,O.minZoom=Math.min(O.maxZoom,O.minZoom+1)):(O.zoomOffset++,O.maxZoom=Math.max(O.minZoom,O.maxZoom-1)),O.minZoom=Math.max(0,O.minZoom)):O.zoomReverse?O.minZoom=Math.min(O.maxZoom,O.minZoom):O.maxZoom=Math.max(O.minZoom,O.maxZoom),typeof O.subdomains=="string"&&(O.subdomains=O.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(C,O){return this._url===C&&O===void 0&&(O=!0),this._url=C,O||this.redraw(),this},createTile:function(C,O){var G=document.createElement("img");return xi(G,"load",o(this._tileOnLoad,this,O,G)),xi(G,"error",o(this._tileOnError,this,O,G)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(G.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(G.referrerPolicy=this.options.referrerPolicy),G.alt="",G.src=this.getTileUrl(C),G},getTileUrl:function(C){var O={r:It.retina?"@2x":"",s:this._getSubdomain(C),x:C.x,y:C.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var G=this._globalTileRange.max.y-C.y;this.options.tms&&(O.y=G),O["-y"]=G}return y(this._url,r(O,this.options))},_tileOnLoad:function(C,O){It.ielt9?setTimeout(o(C,this,null,O),0):C(null,O)},_tileOnError:function(C,O,G){var K=this.options.errorTileUrl;K&&O.getAttribute("src")!==K&&(O.src=K),C(G,O)},_onTileRemove:function(C){C.tile.onload=null},_getZoomForUrl:function(){var C=this._tileZoom,O=this.options.maxZoom,G=this.options.zoomReverse,K=this.options.zoomOffset;return G&&(C=O-C),C+K},_getSubdomain:function(C){var O=Math.abs(C.x+C.y)%this.options.subdomains.length;return this.options.subdomains[O]},_abortLoading:function(){var C,O;for(C in this._tiles)if(this._tiles[C].coords.z!==this._tileZoom&&(O=this._tiles[C].el,O.onload=d,O.onerror=d,!O.complete)){O.src=T;var G=this._tiles[C].coords;ar(O),delete this._tiles[C],this.fire("tileabort",{tile:O,coords:G})}},_removeTile:function(C){var O=this._tiles[C];if(O)return O.el.setAttribute("src",T),xS.prototype._removeTile.call(this,C)},_tileReady:function(C,O,G){if(!(!this._map||G&&G.getAttribute("src")===T))return xS.prototype._tileReady.call(this,C,O,G)}});function t7(C,O){return new Hb(C,O)}var i7=Hb.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(C,O){this._url=C;var G=r({},this.defaultWmsParams);for(var K in O)K in this.options||(G[K]=O[K]);O=m(this,O);var te=O.detectRetina&&It.retina?2:1,de=this.getTileSize();G.width=de.x*te,G.height=de.y*te,this.wmsParams=G},onAdd:function(C){this._crs=this.options.crs||C.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var O=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[O]=this._crs.code,Hb.prototype.onAdd.call(this,C)},getTileUrl:function(C){var O=this._tileCoordsToNwSe(C),G=this._crs,K=j(G.project(O[0]),G.project(O[1])),te=K.min,de=K.max,Te=(this._wmsVersion>=1.3&&this._crs===K8?[te.y,te.x,de.y,de.x]:[te.x,te.y,de.x,de.y]).join(","),Re=Hb.prototype.getTileUrl.call(this,C);return Re+g(this.wmsParams,Re,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Te},setParams:function(C,O){return r(this.wmsParams,C),O||this.redraw(),this}});function I1e(C,O){return new i7(C,O)}Hb.WMS=i7,t7.wms=I1e;var Uf=Gc.extend({options:{padding:.1},initialize:function(C){m(this,C),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Si(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var C={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(C.zoomanim=this._onAnimZoom),C},_onAnimZoom:function(C){this._updateTransform(C.center,C.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(C,O){var G=this._map.getZoomScale(O,this._zoom),K=this._map.getSize().multiplyBy(.5+this.options.padding),te=this._map.project(this._center,O),de=K.multiplyBy(-G).add(te).subtract(this._map._getNewPixelOrigin(C,O));It.any3d?fn(this._container,de,G):_t(this._container,de)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var C in this._layers)this._layers[C]._reset()},_onZoomEnd:function(){for(var C in this._layers)this._layers[C]._project()},_updatePaths:function(){for(var C in this._layers)this._layers[C]._update()},_update:function(){var C=this.options.padding,O=this._map.getSize(),G=this._map.containerPointToLayerPoint(O.multiplyBy(-C)).round();this._bounds=new $(G,G.add(O.multiplyBy(1+C*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),n7=Uf.extend({options:{tolerance:0},getEvents:function(){var C=Uf.prototype.getEvents.call(this);return C.viewprereset=this._onViewPreReset,C},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Uf.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var C=this._container=document.createElement("canvas");xi(C,"mousemove",this._onMouseMove,this),xi(C,"click dblclick mousedown mouseup contextmenu",this._onClick,this),xi(C,"mouseout",this._handleMouseOut,this),C._leaflet_disable_events=!0,this._ctx=C.getContext("2d")},_destroyContainer:function(){R(this._redrawRequest),delete this._ctx,ar(this._container),Pr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var C;this._redrawBounds=null;for(var O in this._layers)C=this._layers[O],C._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Uf.prototype._update.call(this);var C=this._bounds,O=this._container,G=C.getSize(),K=It.retina?2:1;_t(O,C.min),O.width=K*G.x,O.height=K*G.y,O.style.width=G.x+"px",O.style.height=G.y+"px",It.retina&&this._ctx.scale(2,2),this._ctx.translate(-C.min.x,-C.min.y),this.fire("update")}},_reset:function(){Uf.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(C){this._updateDashArray(C),this._layers[l(C)]=C;var O=C._order={layer:C,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=O),this._drawLast=O,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(C){this._requestRedraw(C)},_removePath:function(C){var O=C._order,G=O.next,K=O.prev;G?G.prev=K:this._drawLast=K,K?K.next=G:this._drawFirst=G,delete C._order,delete this._layers[l(C)],this._requestRedraw(C)},_updatePath:function(C){this._extendRedrawBounds(C),C._project(),C._update(),this._requestRedraw(C)},_updateStyle:function(C){this._updateDashArray(C),this._requestRedraw(C)},_updateDashArray:function(C){if(typeof C.options.dashArray=="string"){var O=C.options.dashArray.split(/[, ]+/),G=[],K,te;for(te=0;te<O.length;te++){if(K=Number(O[te]),isNaN(K))return;G.push(K)}C.options._dashArray=G}else C.options._dashArray=C.options.dashArray},_requestRedraw:function(C){this._map&&(this._extendRedrawBounds(C),this._redrawRequest=this._redrawRequest||D(this._redraw,this))},_extendRedrawBounds:function(C){if(C._pxBounds){var O=(C.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new $,this._redrawBounds.extend(C._pxBounds.min.subtract([O,O])),this._redrawBounds.extend(C._pxBounds.max.add([O,O]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var C=this._redrawBounds;if(C){var O=C.getSize();this._ctx.clearRect(C.min.x,C.min.y,O.x,O.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var C,O=this._redrawBounds;if(this._ctx.save(),O){var G=O.getSize();this._ctx.beginPath(),this._ctx.rect(O.min.x,O.min.y,G.x,G.y),this._ctx.clip()}this._drawing=!0;for(var K=this._drawFirst;K;K=K.next)C=K.layer,(!O||C._pxBounds&&C._pxBounds.intersects(O))&&C._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(C,O){if(this._drawing){var G,K,te,de,Te=C._parts,Re=Te.length,xe=this._ctx;if(Re){for(xe.beginPath(),G=0;G<Re;G++){for(K=0,te=Te[G].length;K<te;K++)de=Te[G][K],xe[K?"lineTo":"moveTo"](de.x,de.y);O&&xe.closePath()}this._fillStroke(xe,C)}}},_updateCircle:function(C){if(!(!this._drawing||C._empty())){var O=C._point,G=this._ctx,K=Math.max(Math.round(C._radius),1),te=(Math.max(Math.round(C._radiusY),1)||K)/K;te!==1&&(G.save(),G.scale(1,te)),G.beginPath(),G.arc(O.x,O.y/te,K,0,Math.PI*2,!1),te!==1&&G.restore(),this._fillStroke(G,C)}},_fillStroke:function(C,O){var G=O.options;G.fill&&(C.globalAlpha=G.fillOpacity,C.fillStyle=G.fillColor||G.color,C.fill(G.fillRule||"evenodd")),G.stroke&&G.weight!==0&&(C.setLineDash&&C.setLineDash(O.options&&O.options._dashArray||[]),C.globalAlpha=G.opacity,C.lineWidth=G.weight,C.strokeStyle=G.color,C.lineCap=G.lineCap,C.lineJoin=G.lineJoin,C.stroke())},_onClick:function(C){for(var O=this._map.mouseEventToLayerPoint(C),G,K,te=this._drawFirst;te;te=te.next)G=te.layer,G.options.interactive&&G._containsPoint(O)&&(!(C.type==="click"||C.type==="preclick")||!this._map._draggableMoved(G))&&(K=G);this._fireEvent(K?[K]:!1,C)},_onMouseMove:function(C){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var O=this._map.mouseEventToLayerPoint(C);this._handleMouseHover(C,O)}},_handleMouseOut:function(C){var O=this._hoveredLayer;O&&(Ur(this._container,"leaflet-interactive"),this._fireEvent([O],C,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(C,O){if(!this._mouseHoverThrottled){for(var G,K,te=this._drawFirst;te;te=te.next)G=te.layer,G.options.interactive&&G._containsPoint(O)&&(K=G);K!==this._hoveredLayer&&(this._handleMouseOut(C),K&&(Si(this._container,"leaflet-interactive"),this._fireEvent([K],C,"mouseover"),this._hoveredLayer=K)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,C),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(C,O,G){this._map._fireDOMEvent(O,G||O.type,C)},_bringToFront:function(C){var O=C._order;if(O){var G=O.next,K=O.prev;if(G)G.prev=K;else return;K?K.next=G:G&&(this._drawFirst=G),O.prev=this._drawLast,this._drawLast.next=O,O.next=null,this._drawLast=O,this._requestRedraw(C)}},_bringToBack:function(C){var O=C._order;if(O){var G=O.next,K=O.prev;if(K)K.next=G;else return;G?G.prev=K:K&&(this._drawLast=K),O.prev=null,O.next=this._drawFirst,this._drawFirst.prev=O,this._drawFirst=O,this._requestRedraw(C)}}});function r7(C){return It.canvas?new n7(C):null}var LS=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(C){return document.createElement("<lvml:"+C+' class="lvml">')}}catch{}return function(C){return document.createElement("<"+C+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),w1e={_initContainer:function(){this._container=un("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Uf.prototype._update.call(this),this.fire("update"))},_initPath:function(C){var O=C._container=LS("shape");Si(O,"leaflet-vml-shape "+(this.options.className||"")),O.coordsize="1 1",C._path=LS("path"),O.appendChild(C._path),this._updateStyle(C),this._layers[l(C)]=C},_addPath:function(C){var O=C._container;this._container.appendChild(O),C.options.interactive&&C.addInteractiveTarget(O)},_removePath:function(C){var O=C._container;ar(O),C.removeInteractiveTarget(O),delete this._layers[l(C)]},_updateStyle:function(C){var O=C._stroke,G=C._fill,K=C.options,te=C._container;te.stroked=!!K.stroke,te.filled=!!K.fill,K.stroke?(O||(O=C._stroke=LS("stroke")),te.appendChild(O),O.weight=K.weight+"px",O.color=K.color,O.opacity=K.opacity,K.dashArray?O.dashStyle=b(K.dashArray)?K.dashArray.join(" "):K.dashArray.replace(/( *, *)/g," "):O.dashStyle="",O.endcap=K.lineCap.replace("butt","flat"),O.joinstyle=K.lineJoin):O&&(te.removeChild(O),C._stroke=null),K.fill?(G||(G=C._fill=LS("fill")),te.appendChild(G),G.color=K.fillColor||K.color,G.opacity=K.fillOpacity):G&&(te.removeChild(G),C._fill=null)},_updateCircle:function(C){var O=C._point.round(),G=Math.round(C._radius),K=Math.round(C._radiusY||G);this._setPath(C,C._empty()?"M0 0":"AL "+O.x+","+O.y+" "+G+","+K+" 0,"+65535*360)},_setPath:function(C,O){C._path.v=O},_bringToFront:function(C){Vc(C._container)},_bringToBack:function(C){yl(C._container)}},eC=It.vml?LS:ne,FS=Uf.extend({_initContainer:function(){this._container=eC("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=eC("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ar(this._container),Pr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Uf.prototype._update.call(this);var C=this._bounds,O=C.getSize(),G=this._container;(!this._svgSize||!this._svgSize.equals(O))&&(this._svgSize=O,G.setAttribute("width",O.x),G.setAttribute("height",O.y)),_t(G,C.min),G.setAttribute("viewBox",[C.min.x,C.min.y,O.x,O.y].join(" ")),this.fire("update")}},_initPath:function(C){var O=C._path=eC("path");C.options.className&&Si(O,C.options.className),C.options.interactive&&Si(O,"leaflet-interactive"),this._updateStyle(C),this._layers[l(C)]=C},_addPath:function(C){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(C._path),C.addInteractiveTarget(C._path)},_removePath:function(C){ar(C._path),C.removeInteractiveTarget(C._path),delete this._layers[l(C)]},_updatePath:function(C){C._project(),C._update()},_updateStyle:function(C){var O=C._path,G=C.options;O&&(G.stroke?(O.setAttribute("stroke",G.color),O.setAttribute("stroke-opacity",G.opacity),O.setAttribute("stroke-width",G.weight),O.setAttribute("stroke-linecap",G.lineCap),O.setAttribute("stroke-linejoin",G.lineJoin),G.dashArray?O.setAttribute("stroke-dasharray",G.dashArray):O.removeAttribute("stroke-dasharray"),G.dashOffset?O.setAttribute("stroke-dashoffset",G.dashOffset):O.removeAttribute("stroke-dashoffset")):O.setAttribute("stroke","none"),G.fill?(O.setAttribute("fill",G.fillColor||G.color),O.setAttribute("fill-opacity",G.fillOpacity),O.setAttribute("fill-rule",G.fillRule||"evenodd")):O.setAttribute("fill","none"))},_updatePoly:function(C,O){this._setPath(C,ie(C._parts,O))},_updateCircle:function(C){var O=C._point,G=Math.max(Math.round(C._radius),1),K=Math.max(Math.round(C._radiusY),1)||G,te="a"+G+","+K+" 0 1,0 ",de=C._empty()?"M0 0":"M"+(O.x-G)+","+O.y+te+G*2+",0 "+te+-G*2+",0 ";this._setPath(C,de)},_setPath:function(C,O){C._path.setAttribute("d",O)},_bringToFront:function(C){Vc(C._path)},_bringToBack:function(C){yl(C._path)}});It.vml&&FS.include(w1e);function a7(C){return It.svg||It.vml?new FS(C):null}bn.include({getRenderer:function(C){var O=C.options.renderer||this._getPaneRenderer(C.options.pane)||this.options.renderer||this._renderer;return O||(O=this._renderer=this._createRenderer()),this.hasLayer(O)||this.addLayer(O),O},_getPaneRenderer:function(C){if(C==="overlayPane"||C===void 0)return!1;var O=this._paneRenderers[C];return O===void 0&&(O=this._createRenderer({pane:C}),this._paneRenderers[C]=O),O},_createRenderer:function(C){return this.options.preferCanvas&&r7(C)||a7(C)}});var o7=jb.extend({initialize:function(C,O){jb.prototype.initialize.call(this,this._boundsToLatLngs(C),O)},setBounds:function(C){return this.setLatLngs(this._boundsToLatLngs(C))},_boundsToLatLngs:function(C){return C=H(C),[C.getSouthWest(),C.getNorthWest(),C.getNorthEast(),C.getSouthEast()]}});function S1e(C,O){return new o7(C,O)}FS.create=eC,FS.pointsToPath=ie,Tf.geometryToLayer=WE,Tf.coordsToLatLng=gL,Tf.coordsToLatLngs=KE,Tf.latLngToCoords=vL,Tf.latLngsToCoords=YE,Tf.getFeature=Gb,Tf.asFeature=ZE,bn.mergeOptions({boxZoom:!0});var s7=Hd.extend({initialize:function(C){this._map=C,this._container=C._container,this._pane=C._panes.overlayPane,this._resetStateTimeout=0,C.on("unload",this._destroy,this)},addHooks:function(){xi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Pr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ar(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(C){if(!C.shiftKey||C.which!==1&&C.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ba(),Qh(),this._startPoint=this._map.mouseEventToContainerPoint(C),xi(document,{contextmenu:Zg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(C){this._moved||(this._moved=!0,this._box=un("div","leaflet-zoom-box",this._container),Si(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(C);var O=new $(this._point,this._startPoint),G=O.getSize();_t(this._box,O.min),this._box.style.width=G.x+"px",this._box.style.height=G.y+"px"},_finish:function(){this._moved&&(ar(this._box),Ur(this._container,"leaflet-crosshair")),fu(),em(),Pr(document,{contextmenu:Zg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(C){if(!(C.which!==1&&C.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var O=new V(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(O).fire("boxzoomend",{boxZoomBounds:O})}},_onKeyDown:function(C){C.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});bn.addInitHook("addHandler","boxZoom",s7),bn.mergeOptions({doubleClickZoom:!0});var l7=Hd.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(C){var O=this._map,G=O.getZoom(),K=O.options.zoomDelta,te=C.originalEvent.shiftKey?G-K:G+K;O.options.doubleClickZoom==="center"?O.setZoom(te):O.setZoomAround(C.containerPoint,te)}});bn.addInitHook("addHandler","doubleClickZoom",l7),bn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var u7=Hd.extend({addHooks:function(){if(!this._draggable){var C=this._map;this._draggable=new im(C._mapPane,C._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),C.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),C.on("zoomend",this._onZoomEnd,this),C.whenReady(this._onZoomEnd,this))}Si(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ur(this._map._container,"leaflet-grab"),Ur(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var C=this._map;if(C._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var O=H(this._map.options.maxBounds);this._offsetLimit=j(this._map.latLngToContainerPoint(O.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(O.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;C.fire("movestart").fire("dragstart"),C.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(C){if(this._map.options.inertia){var O=this._lastTime=+new Date,G=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(G),this._times.push(O),this._prunePositions(O)}this._map.fire("move",C).fire("drag",C)},_prunePositions:function(C){for(;this._positions.length>1&&C-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var C=this._map.getSize().divideBy(2),O=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=O.subtract(C).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(C,O){return C-(C-O)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var C=this._draggable._newPos.subtract(this._draggable._startPos),O=this._offsetLimit;C.x<O.min.x&&(C.x=this._viscousLimit(C.x,O.min.x)),C.y<O.min.y&&(C.y=this._viscousLimit(C.y,O.min.y)),C.x>O.max.x&&(C.x=this._viscousLimit(C.x,O.max.x)),C.y>O.max.y&&(C.y=this._viscousLimit(C.y,O.max.y)),this._draggable._newPos=this._draggable._startPos.add(C)}},_onPreDragWrap:function(){var C=this._worldWidth,O=Math.round(C/2),G=this._initialWorldOffset,K=this._draggable._newPos.x,te=(K-O+G)%C+O-G,de=(K+O+G)%C-O-G,Te=Math.abs(te+G)<Math.abs(de+G)?te:de;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Te},_onDragEnd:function(C){var O=this._map,G=O.options,K=!G.inertia||C.noInertia||this._times.length<2;if(O.fire("dragend",C),K)O.fire("moveend");else{this._prunePositions(+new Date);var te=this._lastPos.subtract(this._positions[0]),de=(this._lastTime-this._times[0])/1e3,Te=G.easeLinearity,Re=te.multiplyBy(Te/de),xe=Re.distanceTo([0,0]),Ye=Math.min(G.inertiaMaxSpeed,xe),wt=Re.multiplyBy(Ye/xe),si=Ye/(G.inertiaDeceleration*Te),tn=wt.multiplyBy(-si/2).round();!tn.x&&!tn.y?O.fire("moveend"):(tn=O._limitOffset(tn,O.options.maxBounds),D(function(){O.panBy(tn,{duration:si,easeLinearity:Te,noMoveStart:!0,animate:!0})}))}}});bn.addInitHook("addHandler","dragging",u7),bn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var c7=Hd.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(C){this._map=C,this._setPanDelta(C.options.keyboardPanDelta),this._setZoomDelta(C.options.zoomDelta)},addHooks:function(){var C=this._map._container;C.tabIndex<=0&&(C.tabIndex="0"),xi(C,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Pr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var C=document.body,O=document.documentElement,G=C.scrollTop||O.scrollTop,K=C.scrollLeft||O.scrollLeft;this._map._container.focus(),window.scrollTo(K,G)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(C){var O=this._panKeys={},G=this.keyCodes,K,te;for(K=0,te=G.left.length;K<te;K++)O[G.left[K]]=[-1*C,0];for(K=0,te=G.right.length;K<te;K++)O[G.right[K]]=[C,0];for(K=0,te=G.down.length;K<te;K++)O[G.down[K]]=[0,C];for(K=0,te=G.up.length;K<te;K++)O[G.up[K]]=[0,-1*C]},_setZoomDelta:function(C){var O=this._zoomKeys={},G=this.keyCodes,K,te;for(K=0,te=G.zoomIn.length;K<te;K++)O[G.zoomIn[K]]=C;for(K=0,te=G.zoomOut.length;K<te;K++)O[G.zoomOut[K]]=-C},_addHooks:function(){xi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Pr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(C){if(!(C.altKey||C.ctrlKey||C.metaKey)){var O=C.keyCode,G=this._map,K;if(O in this._panKeys){if(!G._panAnim||!G._panAnim._inProgress)if(K=this._panKeys[O],C.shiftKey&&(K=x(K).multiplyBy(3)),G.options.maxBounds&&(K=G._limitOffset(x(K),G.options.maxBounds)),G.options.worldCopyJump){var te=G.wrapLatLng(G.unproject(G.project(G.getCenter()).add(K)));G.panTo(te)}else G.panBy(K)}else if(O in this._zoomKeys)G.setZoom(G.getZoom()+(C.shiftKey?3:1)*this._zoomKeys[O]);else if(O===27&&G._popup&&G._popup.options.closeOnEscapeKey)G.closePopup();else return;Zg(C)}}});bn.addInitHook("addHandler","keyboard",c7),bn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var d7=Hd.extend({addHooks:function(){xi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Pr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(C){var O=O8(C),G=this._map.options.wheelDebounceTime;this._delta+=O,this._lastMousePos=this._map.mouseEventToContainerPoint(C),this._startTime||(this._startTime=+new Date);var K=Math.max(G-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),K),Zg(C)},_performZoom:function(){var C=this._map,O=C.getZoom(),G=this._map.options.zoomSnap||0;C._stop();var K=this._delta/(this._map.options.wheelPxPerZoomLevel*4),te=4*Math.log(2/(1+Math.exp(-Math.abs(K))))/Math.LN2,de=G?Math.ceil(te/G)*G:te,Te=C._limitZoom(O+(this._delta>0?de:-de))-O;this._delta=0,this._startTime=null,Te&&(C.options.scrollWheelZoom==="center"?C.setZoom(O+Te):C.setZoomAround(this._lastMousePos,O+Te))}});bn.addInitHook("addHandler","scrollWheelZoom",d7);var T1e=600;bn.mergeOptions({tapHold:It.touchNative&&It.safari&&It.mobile,tapTolerance:15});var p7=Hd.extend({addHooks:function(){xi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Pr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(C){if(clearTimeout(this._holdTimeout),C.touches.length===1){var O=C.touches[0];this._startPos=this._newPos=new B(O.clientX,O.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(xi(document,"touchend",xo),xi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",O))},this),T1e),xi(document,"touchend touchcancel contextmenu",this._cancel,this),xi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function C(){Pr(document,"touchend",xo),Pr(document,"touchend touchcancel",C)},_cancel:function(){clearTimeout(this._holdTimeout),Pr(document,"touchend touchcancel contextmenu",this._cancel,this),Pr(document,"touchmove",this._onMove,this)},_onMove:function(C){var O=C.touches[0];this._newPos=new B(O.clientX,O.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(C,O){var G=new MouseEvent(C,{bubbles:!0,cancelable:!0,view:window,screenX:O.screenX,screenY:O.screenY,clientX:O.clientX,clientY:O.clientY});G._simulated=!0,O.target.dispatchEvent(G)}});bn.addInitHook("addHandler","tapHold",p7),bn.mergeOptions({touchZoom:It.touch,bounceAtZoomLimits:!0});var f7=Hd.extend({addHooks:function(){Si(this._map._container,"leaflet-touch-zoom"),xi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ur(this._map._container,"leaflet-touch-zoom"),Pr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(C){var O=this._map;if(!(!C.touches||C.touches.length!==2||O._animatingZoom||this._zooming)){var G=O.mouseEventToContainerPoint(C.touches[0]),K=O.mouseEventToContainerPoint(C.touches[1]);this._centerPoint=O.getSize()._divideBy(2),this._startLatLng=O.containerPointToLatLng(this._centerPoint),O.options.touchZoom!=="center"&&(this._pinchStartLatLng=O.containerPointToLatLng(G.add(K)._divideBy(2))),this._startDist=G.distanceTo(K),this._startZoom=O.getZoom(),this._moved=!1,this._zooming=!0,O._stop(),xi(document,"touchmove",this._onTouchMove,this),xi(document,"touchend touchcancel",this._onTouchEnd,this),xo(C)}},_onTouchMove:function(C){if(!(!C.touches||C.touches.length!==2||!this._zooming)){var O=this._map,G=O.mouseEventToContainerPoint(C.touches[0]),K=O.mouseEventToContainerPoint(C.touches[1]),te=G.distanceTo(K)/this._startDist;if(this._zoom=O.getScaleZoom(te,this._startZoom),!O.options.bounceAtZoomLimits&&(this._zoom<O.getMinZoom()&&te<1||this._zoom>O.getMaxZoom()&&te>1)&&(this._zoom=O._limitZoom(this._zoom)),O.options.touchZoom==="center"){if(this._center=this._startLatLng,te===1)return}else{var de=G._add(K)._divideBy(2)._subtract(this._centerPoint);if(te===1&&de.x===0&&de.y===0)return;this._center=O.unproject(O.project(this._pinchStartLatLng,this._zoom).subtract(de),this._zoom)}this._moved||(O._moveStart(!0,!1),this._moved=!0),R(this._animRequest);var Te=o(O._move,O,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=D(Te,this,!0),xo(C)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,R(this._animRequest),Pr(document,"touchmove",this._onTouchMove,this),Pr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});bn.addInitHook("addHandler","touchZoom",f7),bn.BoxZoom=s7,bn.DoubleClickZoom=l7,bn.Drag=u7,bn.Keyboard=c7,bn.ScrollWheelZoom=d7,bn.TapHold=p7,bn.TouchZoom=f7,i.Bounds=$,i.Browser=It,i.CRS=W,i.Canvas=n7,i.Circle=mL,i.CircleMarker=qE,i.Class=M,i.Control=jc,i.DivIcon=e7,i.DivOverlay=zd,i.DomEvent=VUe,i.DomUtil=BUe,i.Draggable=im,i.Evented=k,i.FeatureGroup=wf,i.GeoJSON=Tf,i.GridLayer=xS,i.Handler=Hd,i.Icon=Vb,i.ImageOverlay=XE,i.LatLng=z,i.LatLngBounds=V,i.Layer=Gc,i.LayerGroup=$b,i.LineUtil=e1e,i.Map=bn,i.Marker=zE,i.Mixin=KUe,i.Path=nm,i.Point=B,i.PolyUtil=YUe,i.Polygon=jb,i.Polyline=Sf,i.Popup=JE,i.PosAnimation=x8,i.Projection=t1e,i.Rectangle=o7,i.Renderer=Uf,i.SVG=FS,i.SVGOverlay=Q8,i.TileLayer=Hb,i.Tooltip=QE,i.Transformation=Q,i.Util=N,i.VideoOverlay=J8,i.bind=o,i.bounds=j,i.canvas=r7,i.circle=u1e,i.circleMarker=l1e,i.control=_S,i.divIcon=y1e,i.extend=r,i.featureGroup=a1e,i.geoJSON=X8,i.geoJson=p1e,i.gridLayer=b1e,i.icon=o1e,i.imageOverlay=f1e,i.latLng=q,i.latLngBounds=H,i.layerGroup=r1e,i.map=jUe,i.marker=s1e,i.point=x,i.polygon=d1e,i.polyline=c1e,i.popup=g1e,i.rectangle=S1e,i.setOptions=m,i.stamp=l,i.svg=a7,i.svgOverlay=m1e,i.tileLayer=t7,i.tooltip=v1e,i.transformation=ce,i.version=n,i.videoOverlay=h1e;var U1e=window.L;i.noConflict=function(){return window.L=U1e,this},window.L=i})})(IV,IV.exports);var XR=IV.exports;function wnt(){try{return navigator||window.navigator}catch{return}}function Snt({coords:t,callback:e}){let i=16;(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))&&(t={latitude:0,longitude:0},i=2);let n={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${Lr.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `;yn({content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?c():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&c(),rt(e)&&e(t)},intent:"is-info",label:"Submit",close:!0}]});const u=USe(n),c=()=>{const g=u.link.element.value,v=ynt(g)||bnt(g)||vnt(g)||Int(g);v.latitude?m(v):g&&v.latitude===void 0&&Mt({message:"Invalid URL"})},d=g=>{g.which===13&&c()};let{map:p,marker:f}=Tnt({successElement:u.map.element,mapElementId:u.map.id,coords:t,zoom:i});u.link.element.value="",u.link.element.focus(),u.link.element.addEventListener("keyup",d),p&&(p.on("click",g=>h({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function h({latitude:g,longitude:v}){t={latitude:g,longitude:v};let y=new XR.LatLng(g,v);f.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){if(g&&v)return t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0;t={latitude:0,longitude:0},p.fitWorld()}}function Tnt({successElement:t,mapElementId:e,coords:i,zoom:n}){let r=wnt();if(!(r!=null&&r.onLine))return{};if(n=n===void 0?16:n,i.latitude!==void 0&&i.longitude!==void 0)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,n);return{};function a(o,s,l){if(isNaN(o)||isNaN(s))return{};let u=ii.locations.map_view||"map",c=XR.tileLayer(ii.leaflet[u].tileLayer,{attribution:ii.leaflet[u].attribution,maxZoom:ii.leaflet[u].maxZoom}),d=XR.map(e).fitWorld().addLayer(c);o&&s&&d.setView([+o,+s],l);let p=XR.marker([+o,+s]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function Unt(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=(i==null?void 0:i.address)||{};Snt({coords:{latitude:n,longitude:r},callback:(o={})=>{i.address||(i.address={});const s=i.venue;s.addresses||(s.addresses=[]),s.addresses.length?Object.assign(s.addresses[0],{latitude:o.latitude,longitude:o.longitude}):s.addresses.push({latitude:o.latitude,longitude:o.longitude});const l=c=>{var d,p;if(console.log({result:c}),(p=(d=c.results)==null?void 0:d[0])!=null&&p.success){const f=e.getTable();i.address.latitude=o.latitude,i.address.longitude=o.longitude,i.hasLocation=o.latitude&&o.longitude,f.updateData([i])}},u=[{method:g8e,params:{venueId:i.venueId,modifications:{addresses:s.addresses}}}];console.log({methods:u}),yt({methods:u,callback:l})}})}function Dnt(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{headerMenu:vf({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{cellClick:qv,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:qv,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:Et,field:"courtsCount",hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:Et,headerSort:!0,hozAlign:Et,visible:!0,minWidth:120},{title:"Time",headerHozAlign:Et,field:"availableTime",headerSort:!0,hozAlign:Et,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:Et,cellClick:Unt,field:"hasLocation",headerSort:!1,hozAlign:Et,visible:!0,width:50},{cellClick:qv,formatter:l8,responsive:!1,headerSort:!1,hozAlign:mt,field:"isOpen",width:20},{cellClick:t,formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,width:50}]}function Pnt({table:t}={}){const e=()=>{const{venues:r}=Mg.getVenuesAndCourts();return{rows:r.map(DTe)}},i=()=>{const{rows:r}=e();t==null||t.replaceData(r)},n=Dnt();if(t)i();else{mf({anchorId:zM});const r=document.getElementById(zM),{rows:a}=e();t=new da(r,{headerSortElement:gf(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:gnt,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:a}),t.on("scrollVertical",Pu),t.on("cellEdited",o=>{const s=o.getColumn().getDefinition(),l=o.getRow().getData(),u=o.getValue();console.log({cell:o,row:l,value:u,def:s})})}return{table:t,replaceTableData:i}}function Ent({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?no({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);yt({methods:[{method:d8e,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{label:"Add venue",onClick:()=>bSe(e),location:mt,id:"addVenue",intent:"none"}]}).elements:void 0}function Cnt(){const t=document.getElementById(k3),{table:e}=Pnt();Ent({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([DTe(n)])}})}const{POLICY_TYPE_AVOIDANCE:$X}=yg;function PTe({eventId:t,drawId:e}){var i,n,r;return(r=(n=(i=$e.getPolicyDefinitions({policyTypes:[$X],eventId:t,drawId:e}))==null?void 0:i.policyDefinitions)==null?void 0:n[$X])==null?void 0:r.policyAttributes}const wV={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function Rnt({event:t}){const e=PTe({eventId:t.eventId}),i=(e==null?void 0:e.map(r=>Object.keys(wV).find(a=>wV[a].some(s=>s.directive&&s.directive===r.directive||s.key&&s.key===r.key))).filter(Boolean))??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i==null?void 0:i.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function ETe({eventId:t}){const e=$e.getEvent({eventId:t}).event;if(!e)return;const{items:i}=Rnt({event:e});let n;const r=!0,a=c=>n=Wn(c,i),s=[{label:"Cancel",intent:lt,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(h=>n[h].checked).flatMap(h=>wV[h]).filter(Boolean);yt({methods:[{method:s8e,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:h=>{if(h.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else Mt({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",u=(c,d)=>Ob(c,s,d);ze.drawer.open({title:l,content:a,footer:u,side:mt,width:"300px"})}const{WTN:Mnt,UTR:Nnt}=ao.ratingConstants,{TEAM:Ant}=ao.eventConstants,{QUALIFYING:VX}=rr;function Yx({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,eventId:a}){var g,v,y,b,I,T,w,S,U,P,E,D;n=n||(i==null?void 0:i.find(R=>R.participantId===t.participantId));const o=((g=n==null?void 0:n.draws)==null?void 0:g.filter(R=>R.eventId===a).map(R=>({...R,drawName:e[R.drawId].drawName})))??[],s=(y=(v=n==null?void 0:n.person)==null?void 0:v.addresses)==null?void 0:y[0],l=s?`${s.city}, ${s.state}`:void 0,u=r===Ant?"AVERAGE":r,c=(T=(I=(b=n==null?void 0:n.ratings)==null?void 0:b[u])==null?void 0:I.find(R=>R.scaleName===Mnt))==null?void 0:T.scaleValue,d=(U=(S=(w=n==null?void 0:n.ratings)==null?void 0:w[u])==null?void 0:S.find(R=>R.scaleName===Nnt))==null?void 0:U.scaleValue,p={wtn:c,utr:d},f=t.entryStage===VX?`${a}${VX}`:a,h=(D=(E=(P=n==null?void 0:n.seedings)==null?void 0:P[r])==null?void 0:E.find(R=>R.scaleName===f))==null?void 0:D.scaleValue,m=Gue[t.entryStatus];return{searchText:n==null?void 0:n.participantName.toLowerCase(),participant:n,seedNumber:h,cityState:l,...t,ratings:p,flights:o,status:m}}function Kc(t){return Wt.isConvertableInteger(t)&&parseInt(t)>=0}const CTe=(t,e)=>i=>Kc(i)&&i>=t&&i<=e,{ORGANISER_ACCEPTANCE:_nt,DIRECT_ACCEPTANCE:knt,SPECIAL_EXEMPT:Ont,JUNIOR_EXEMPT:xnt,WILDCARD:Lnt}=Ql,{MAIN:Fnt}=rr,hA=(t=Fnt)=>[`${t}.${knt}`,`${t}.${_nt}`,`${t}.${Ont}`,`${t}.${xnt}`,`${t}.${Lnt}`],{MAIN:jX}=rr;function SV(t,e=jX){return t.entries.filter(({entryStage:i=jX,entryStatus:n})=>hA(e).includes(`${i}.${n}`)).length}const{FEED_IN:Bnt,LUCKY_DRAW:$nt,MAIN:Vnt,QUALIFYING:jnt,ROUND_ROBIN:GX,ROUND_ROBIN_WITH_PLAYOFF:VC}=rr;function Gnt({event:t,isQualifying:e,maxQualifiers:i}){const n=e?jnt:Vnt,r=({fields:p,inputs:f})=>{var T;const h=f[gm].value||0,m=Kc(h)?parseInt(h):0,g=SV(t,n),v=f.qualifiersCount.value||0,y=Kc(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(f[Ns].value=S3);const I=(T=lh(p[Ns],"help"))==null?void 0:T[0];I.style.display=b?"":lt;for(const w of f[Ns].options)w.label===Ns&&(w.disabled=b)},a=({drawType:p,fields:f,inputs:h})=>{const m=i?h[gm].value:SV(t,n),g=h.qualifiersCount.value||1,v=Kc(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[$nt,Bnt,GX,VC].includes(p))&&y||Wt.nextPowerOf2(y);return h[gm].value=b,r({fields:f,inputs:h}),b},o=({fields:p,inputs:f})=>{let h=parseInt(f[gm].value);const m=f.qualifiersCount.value;Kc(m)&&parseInt(m)<1&&(f.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=f.qualifiersCount.value;if(g.disabled=!1,i&&Kc(v)&&parseInt(v)>i)f.qualifiersCount.value=i;else if(!i){const y=f[Xc].value;h=a({drawType:y,fields:p,inputs:f})}v=f.qualifiersCount.value,g&&(!Kc(v)||h<=parseInt(v))&&(g.disabled=!0)},s=({e:p,fields:f,inputs:h})=>{const m=h[RT].value,g=p.target.value;i||a({drawType:g,fields:f,inputs:h}),r({fields:f,inputs:h}),f[fI].style.display=g===VC&&m===MT?"":lt,f[RT].style.display=g===VC?"":lt;const v=[GX,VC].includes(g);f[ip].style.display=v?"":lt},l=({fields:p,inputs:f})=>{const h=document.getElementById("generateDraw"),m=f[gm].value||0,g=CTe(2,128)(m);h.disabled=!g;const v=Kc(m)?parseInt(m):0,{validGroupSizes:y}=$e.getValidGroupSizes({drawSize:v,groupSizeLimit:8}),b=y.map(w=>({label:w,value:w})),I=f[ip],T=y.includes(v)?4:y[0];Oa(I),iq(I,{options:b,value:T}),r({fields:p,inputs:f})},u=({e:p,fields:f})=>{const h=p.target.value;f[fI].style.display=h===MT?"":lt,f[ZM].style.display=h===MT?"":lt},c=({inputs:p})=>{const f=parseInt(p[ip].value),h=p[fI].options,m=Array.from(h).map(v=>parseInt(v.value)),g=Math.max(...m);g>f?Wt.generateRange(f+1,g+1).reverse().forEach(v=>{p[fI].remove(v-2)}):g<f&&Wt.generateRange(g+1,f+1).forEach(v=>p[fI].add(new Option(v,v)))},d=({inputs:p,name:f})=>{const h=p[f].value,m=document.getElementById("generateDraw"),g=ur(4)(h);m.disabled=!g};return[{onInput:({inputs:p})=>d({inputs:p,name:ay}),control:ay},{onInput:({inputs:p})=>d({inputs:p,name:kU}),control:kU},{onChange:c,control:ip},{onChange:s,control:Xc},{onChange:u,control:RT},{onInput:l,control:gm},{onInput:o,control:YM}]}const{AD_HOC:Hnt,COMPASS:znt,CURTIS:qnt,DOUBLE_ELIMINATION:Wnt,FEED_IN_CHAMPIONSHIP:Knt,FEED_IN:Ynt,FIRST_MATCH_LOSER_CONSOLATION:Znt,FIRST_ROUND_LOSER_CONSOLATION:Xnt,LUCKY_DRAW:Jnt,OLYMPIC:Qnt,PLAY_OFF:ert,ROUND_ROBIN:trt,ROUND_ROBIN_WITH_PLAYOFF:irt,SINGLE_ELIMINATION:nrt}=rr;function RTe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:Hnt,hide:e},{label:"Compass",value:znt,hide:e},{label:"Curtis consolation",value:qnt,hide:e},{label:"Double elimination",value:Wnt,hide:t||e},{label:"Elimination: fed consolation",value:Knt,hide:e},{label:"First match loser consolation",value:Znt,hide:e},{label:"First round loser consolation",value:Xnt,hide:e},{label:"Lucky",value:Jnt,hide:t||e},{label:"Olympic",value:Qnt,hide:e},{label:"Playoff",value:ert,hide:e},{label:"Round robin w/ playoff",value:irt,hide:t||e},{label:"Round robin",value:trt},{label:"Single elimination",value:nrt},{label:"Staggered Entry",value:Ynt,hide:t||e}]}const{POLICY_TYPE_SCORING:rrt}=yg,{MAIN:art}=rr,ort={[rrt]:{requireAllPositionsAssigned:!1,stage:{[art]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"}]}},{ROUND_ROBIN:srt,ROUND_ROBIN_WITH_PLAYOFF:HX,SINGLE_ELIMINATION:lrt,QUALIFYING:urt,MAIN:zX}=rr,{DOMINANT_DUO:crt,TIME_TENNIS_DUAL:drt,TIME_TENNIS_PRO_CIRCUIT:prt}=ao.tieFormatConstants,{POLICY_TYPE_SCORING:frt}=yg,{TEAM:qX}=ko,{ENTRY_PROFILE:hrt}=ao.extensionConstants;function mrt({event:t,drawId:e,isQualifying:i,structureId:n}){var w,S,U,P,E,D;const r=i?urt:zX,a=((w=t.drawDefinitions)==null?void 0:w.length)||0;let o=lrt;const s=e&&((S=t.drawDefinitions)==null?void 0:S.find(R=>R.drawId===e)),l=n&&((U=$e.getPositionAssignments({drawId:e,structureId:n}))==null?void 0:U.positionAssignments),u=(E=(P=$e.findExtension({element:s,name:hrt}))==null?void 0:P.extension)==null?void 0:E.value,c=n?1:0,d=!n&&((D=u==null?void 0:u[zX])==null?void 0:D.qualifiersCount)||c,p="Qualifying",f=(l==null?void 0:l.length)||Wt.nextPowerOf2(SV(t,r)),h=[{label:"Custom",value:KM}].concat(ort[frt].matchUpFormats.map(({matchUpFormat:R,description:N})=>({selected:R==="SET3-S:6/TB7",value:R,label:N}))),m=[{label:"Time Tennis Pro Circuit",value:prt},{label:"Time Tennis",value:drt},{label:"Dominant Duo",value:crt,selected:!0},{label:"Custom",value:KM}],{validGroupSizes:g}=$e.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),v=g.map(R=>({label:R,value:R})),y=[{label:"Group winners",value:uxe},{label:"Group positions",value:Hue},{label:"Top finishers",value:MT}],b=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],I=[{label:Ns,value:Ns,selected:!n,disabled:!!n},{label:S3,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:ur(4),label:"Structure name",value:p,field:kU,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:ur(4),selectOnFocus:!0,hide:i,label:"Draw name",field:ay,focus:!0},{options:RTe({isQualifying:i}),label:"Draw Type",field:Xc,value:o},{error:"Must be in range 2-128",validator:CTe(2,128),selectOnFocus:!0,label:"Draw size",value:f,field:gm},{visible:[srt,HX].includes(o),options:v,label:"Group size",field:ip,value:4},{visible:[HX].includes(o),options:y,label:"Playoff Type",field:RT},{label:"Advance per group",options:b,field:fI,visible:!1},{label:"2nd playoff from remaining",field:ZM,id:ZM,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:I,label:"Creation",field:Ns,value:""},{hide:t.eventType===qX,options:h,field:V3,label:"Score format",value:""},{hide:t.eventType!==qX,options:m,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:Kc,field:YM,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function WX({eventId:t,drawOptions:e,callback:i}){var o,s;const n=ii.scales[(o=ii.activeScale)==null?void 0:o.toLowerCase()],r={scaleAccessor:n==null?void 0:n.accessor,scaleName:n==null?void 0:n.scaleName},a=$e.generateDrawDefinition({...e,...r,ignoreStageSpace:!0});if(a.success){const l=a.drawDefinition;yt({methods:[{method:Z6e,params:{eventId:t,drawDefinition:l,allowReplacement:!0}}],callback:d=>rt(i)&&i({drawDefinition:l,...d})})}else a.error&&Mt({message:((s=a.error)==null?void 0:s.message)||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:grt}=yg,{SEPARATE:vrt}=rr,{SEEDING:yrt}=v0,MTe={[grt]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:vrt,policyName:yrt,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:brt,FEED_IN:Irt,LUCKY_DRAW:wrt,MAIN:Srt,QUALIFYING:Trt,ROUND_ROBIN:KX,ROUND_ROBIN_WITH_PLAYOFF:YX}=rr,{TIME_TENNIS_PRO_CIRCUIT:Urt}=ao.tieFormatConstants,{DIRECT_ENTRY_STATUSES:ZX}=Ql,{POLICY_TYPE_ROUND_NAMING:Drt}=yg;function XX({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:a,drawId:o,event:s}){var D,R,N,M,A,_,k,B,F;const l=a[Xc].options[a[Xc].selectedIndex].getAttribute("value");e=e||((D=a[V3])==null?void 0:D.value);const u=(R=a[kU])==null?void 0:R.value,c=(N=a.tieFormatName)==null?void 0:N.value,d=(M=a[ay])==null?void 0:M.value,p=a[gm].value||0,f=parseInt(a[ip].value),h=Wt.isConvertableInteger(p)&&parseInt(p),m=[wrt,Irt,KX,YX].includes(l)&&h||Wt.nextPowerOf2(h),g=s.entries.filter(({entryStage:x,entryStatus:$})=>x===Trt&&ZX.includes($)),v=i&&g.length?g:s.entries.filter(({entryStage:x,entryStatus:$})=>(!x||x===Srt)&&ZX.includes($)),y=m<v.length?!1:a[Ns].value===Ns,b=s.eventId,I={drawEntries:v,automated:y,eventId:b,drawId:o},T=parseInt(((A=a.advancePerGroup)==null?void 0:A.value)||0),w=(_=a[ZM])==null?void 0:_.checked,S=(k=a[RT])==null?void 0:k.value;let U;if(l===YX){const x=[];if(S===MT){const $=[Wt.generateRange(1,T+1)];if(w){const j=Wt.generateRange(T+1,f+1);j.length&&$.push(j)}$.forEach((j,V)=>{x.push({structureName:`Playoff ${V+1}`,finishingPositions:j})})}else S===Hue&&Wt.generateRange(1,f+1).forEach($=>{x.push({structureName:`Playoff ${$}`,finishingPositions:[$]})});U={groupSize:f},x.length&&(U.playoffGroups=x)}else l===KX?U={groupSize:f}:l===brt&&Object.assign(I,{roundsCount:1});const P=(B=$e.getSeedsCount({participantsCount:v==null?void 0:v.length,policyDefinitions:MTe,drawSizeProgression:!0}))==null?void 0:B.seedsCount,E=Kc(a[YM].value)&&parseInt((F=a[YM])==null?void 0:F.value)||0;if(n){const x=$e.generateQualifyingStructure({qualifyingPositions:E,targetStructureId:n,structureOptions:U,matchUpFormat:e,structureName:u,automated:y,drawSize:m,drawType:l,drawId:o});if(x.success){const $=[{method:o8e,params:{structure:x.structure,link:x.link,eventId:b,drawId:o}}];yt({methods:$,callback:V=>{var H;return rt(r)&&r({...x,...(H=V.results)==null?void 0:H[0]})}})}return}if(i?(I.drawName=t,I.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:E,structureOptions:U,matchUpFormat:e,structureName:u,seedsCount:P,drawSize:m,drawType:l}]}]):(E&&(I.qualifiersCount=E,I.qualifyingPlaceholder=!0),Object.assign(I,{seedingScaleName:b,structureOptions:U,matchUpFormat:e,seedsCount:P,drawName:d,drawSize:m,drawType:l})),h)if(c===KM)hTe({title:"Custom scorecard",onClose:$=>{$&&(I.tieFormat=$,WX({drawOptions:I,eventId:b,callback:r}))}});else{if(I.tieFormatName=c,c===Urt){const x={[Drt]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};I.policyDefinitions={...x}}WX({drawOptions:I,eventId:b,callback:r})}else Mt({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function n0({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:a}){const o=$e.getEvent({eventId:t}).event;if(!o)return;const{items:s,structurePositionAssignments:l}=mrt({event:o,drawId:i,isQualifying:a,structureId:r}),u=Gnt({maxQualifiers:l==null?void 0:l.length,isQualifying:a,event:o});let c;const d=v=>{c=Wn(v,s,u)},p=()=>a?ur(4)(c[kU].value):ur(4)(c[ay].value),h=[{label:"Cancel",intent:lt,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{var v;p()?((v=c.matchUpFormat)==null?void 0:v.value)===KM?y8({callback:b=>{b&&XX({event:o,inputs:c,callback:e,structureId:r,matchUpFormat:b,drawId:i,drawName:n,isQualifying:a})}}):XX({event:o,inputs:c,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:a}):Mt({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>Ob(v,h,y);ze.drawer.open({title:m,content:d,footer:g,side:mt,width:"300px"})}const{SINGLES:Prt}=ko,Ert=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=l=>t({...l,renderDraw:!0}),a=e.getValue(),o=e.getRow().getData(),{participantId:s}=o;return a==null||a.forEach(l=>{const u=Crt({def:i,participantId:s,flight:l,flightClick:r});n.appendChild(u)}),n};function Crt({flight:t,flightClick:e}){var n,r;const i=document.createElement("span");return rt(e)&&(i.onclick=()=>e(t)),i.className="tag event-pill",(n=t.gender)!=null&&n.toLowerCase().includes("female")?i.classList.add("is-danger"):(r=t.gender)!=null&&r.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===Prt&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:Rrt,QUALIFYING:qF}=rr,{DIRECT_ACCEPTANCE:JX}=Ql;function NTe({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){yt({methods:[{method:Owe,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===vu&&JX||e===qF&&JX||e,entryStage:e===qF?qF:Rrt,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:QX,DIRECT_ACCEPTANCE:eJ,WITHDRAWN:tJ,UNGROUPED:Mrt}=Ql,{QUALIFYING:iJ}=rr,Nrt=(t,e,i)=>(n,r)=>{const{participant:a}=r.getRow().getData(),o=u=>()=>{const c=p=>{var f;if(p.success){const h=r.getRow(),m=u===vu?eJ:u;(f=ze.tables[m])==null||f.addRow(h.getData()),h.delete()}else console.log({result:p})},d=[a.participantId];NTe({participantIds:d,callback:c,eventId:e,drawId:i,group:u})},s=()=>{const u=$e.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:u})};let l=[{onClick:o(eJ),option:"Move to accepted",action:vu},{onClick:o(iJ),option:"Move to qualifying",action:iJ},{onClick:o(QX),option:"Move to alternates",action:QX},{onClick:s,option:"Unpair players",action:Mrt},{onClick:o(tJ),option:"Withdraw participant",action:tJ}].filter(u=>t.includes(u.action));if(l.length){const u=n.target;Ps({options:l,target:u,config:{placement:tf}})}},{WTN:Art,UTR:_rt}=ao.ratingConstants;function krt({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:a}={}){const o=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.utr}),s=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.wtn}),l=t.find(d=>d.cityState),u=t.find(d=>d.seedNumber),c=t.find(d=>d.ranking);return[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{headerMenu:vf(),formatter:"rownum",headerSort:!1,hozAlign:Ct,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:Et,resizable:!1,width:50},{formatter:d=>xb()(d,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!c,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.wtn.wtnRating",visible:!!s,resizable:!1,sorter:"number",title:Art,width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.utr.utrRating",visible:!!o,resizable:!1,sorter:"number",title:_rt,width:70},{visible:!!l,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:lV({maxValue:(t==null?void 0:t.length)||0,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!u,field:"seedNumber",hozAlign:Et,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:Ert(Yn),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:Nrt(r,i,n),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,maxWidth:40}].filter(({field:d})=>Array.isArray(e)&&!(e!=null&&e.includes(d)))}function ATe(){const t=$e.getTournament().tournamentRecord.tournamentId,e=`/${Ia}/${t}/${Yc}`;ze.router.navigate(e)}function _Te(t,e){Fx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:Ort}=v0;function kTe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){yt({methods:[{method:T8e,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:Ort},scaleBasis:{scaleType:e},eventId:i}}}],callback:o=>{o.success&&rt(n)&&n()}})}const{QUALIFYING:nJ}=rr,{SEEDING:xrt,MANUAL:Lrt}=v0;function OTe({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,a=e.map(({entryStage:o,participantId:s,seedNumber:l})=>{const u=o===nJ?`${n}${nJ}`:n;return{participantId:s,scaleItems:[{scaleValue:l,scaleType:xrt,scaleName:u,eventType:r}]}});kTe({scaleItemsWithParticipantIds:a,scaleBasis:Lrt,eventId:n,callback:i})}function xTe({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function Frt({event:t,table:e}){xTe({table:e});const i=e.getData();OTe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:Brt}=Ql,{QUALIFYING:rJ}=rr,aJ=t=>e=>{const i=t==null?void 0:t.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:mt,label:"Cancel",visible:!1,onClick:r=>{var h,m;_Te(r,e);const a=xTe({table:e}),o=(h=$e.getEvent({eventId:i}))==null?void 0:h.event,l=((m=o.entries)==null?void 0:m.filter(g=>g.entryStage===a&&g.entryStatus===Brt)).map(({participantId:g})=>g),{participants:u}=$e.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),c=a===rJ?`${i}${rJ}`:i,d=u.map(g=>{var y,b,I;const v=(I=(b=(y=g==null?void 0:g.seedings)==null?void 0:y[o.eventType])==null?void 0:b.find(T=>T.scaleName===c))==null?void 0:I.scaleValue;if(v)return{participantId:g.participantId,seedNumber:v}}).filter(Boolean),p=Object.assign({},...d.map(g=>({[g.participantId]:g}))),f=e.getRows();for(const g of f){const v=g.getData(),y=v.participantId;p[y]&&(v.seedNumber=p[y].seedNumber,g.update(v))}}}};function $rt(t,e){Fx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t})}const{QUALIFYING:jC,MAIN:Vrt}=rr,{SEEDING:jrt,RATING:Grt}=v0,eT={high:[80,100],medium:[60,80],low:[40,60]};function Hrt({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:a}=t,{seedsCount:o,stageEntries:s}=$e.getEntriesAndSeedsCount({stage:e===jC?jC:Vrt,policyDefinitions:MTe,eventId:r}),u=n==="ratings.wtn.wtnRating"&&((b,I)=>WF(b).wtnRating-WF(I).wtnRating),c=i.getData(),d={high:[],medium:[],low:[]};let p=0;for(const b of c){const I=WF(b);I.wtnRating&&(p+=1),I.confidence>=eT.high[0]?d.high.push(b):I.confidence>=eT.medium[0]&&I.confidence<eT.medium[1]?d.medium.push(b):I.confidence>=eT.low[0]&&I.confidence<eT.low[1]&&d.low.push(b)}const h=(rt(u)&&[].concat(d.high.toSorted(u),d.medium.toSorted(u),d.low.toSorted(u))).slice(0,Math.min(p,o)),m=e===jC?`${r}${jC}`:r,g={scaleType:jrt,scaleName:m,eventType:a},{scaleItemsWithParticipantIds:v}=$e.generateSeedingScaleItems({scaleAttributes:g,scaledEntries:h,stageEntries:s,seedsCount:o,scaleName:m});kTe({scaleItemsWithParticipantIds:v,scaleBasis:Grt,eventId:r,callback:()=>{const b=Object.assign({},...h.map((T,w)=>({[T.participantId]:w+1}))),I=i.getRows();i.showColumn("seedNumber"),i.redraw(!0);for(const T of I){const w=T.getData(),S=b[w.participantId];S&&(w.seedNumber=S,T.update(w))}}})}function WF(t){var e;return((e=t.ratings)==null?void 0:e.wtn)||{confidence:0,wtnRating:1/0}}const oJ=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn.wtnRating":"Seed by WTN"},r=i.getColumns().map(o=>o.getDefinition()).filter(o=>["ranking","ratings.wtn.wtnRating"].includes(o.field)),a=[{label:"Manual seeding",onClick:o=>$rt(o,i),close:!0},{label:"Clear seeding",onClick:()=>Frt({event:t,table:i}),close:!0}].concat(...r.map(o=>({onClick:()=>Hrt({event:t,group:e,table:i,field:o.field}),label:n[o.field],value:o.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:mt,align:mt,options:a}},zrt=(t,e,i,n)=>{const a=t.getSelectedData().filter(c=>{var d;return!((d=c.events)!=null&&d.length)}).map(({participantId:c})=>c),[o,s]=e.split(".");yt({methods:[{method:Owe,params:{ignoreAssignment:!0,participantIds:a,entryStatus:s,entryStage:o,eventId:i,drawId:n}}],callback:c=>{if(t.deselectRow(),c.success){const d=t.getRows();for(const p of d){const f=p.getData();a.includes(f.participantId)&&(f.status=Gue[s],p.update(f))}}else console.log(c.error)}})},qrt=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>zrt(n,a,e,i),label:a,value:a,close:!0}));return{location:gr,label:"Change status",options:r}},Wrt=(t,e=0)=>{const i=`${t} <span class='${Nue}'>${e}</span>`;return{location:qM,text:i}},II=({target:t,table:e,close:i})=>{var r,a,o;if(!t)return;const n=Jo(t,cv);if(n){const s=(r=n.getElementsByClassName("toggle"))==null?void 0:r[0],l=(a=n.getElementsByClassName(Bue))==null?void 0:a[0],u=(o=n.getElementsByClassName($ue))==null?void 0:o[0];if(s){const c=i||s.innerHTML.charCodeAt(0)===9660;l.style.display=c?lt:fw,u.style.display=c?lt:fw,s.parentNode.innerHTML=`<span class='toggle' style='color: white'>${c?pSe:s8}</span>`,c||e.redraw(!0)}}},Krt=t=>{const e=i=>II({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${s8}</span>`,location:qM,onClick:e}},tT=({heading:t,count:e})=>[Wrt(t,e),i=>Krt(i)],Yrt=(t,e,i)=>(n,r="Search participants")=>{let a,o;const s=l=>{var c;const u=e&&ly(n.element,"tableClass");if(u){const d=(c=lh(u,"controlBar"))==null?void 0:c[0];if(d){const p=lh(d,"search");Array.from(p).forEach(f=>f.value=l)}}a=e&&n.getSelectedData().map(d=>d[e]),n.removeFilter(o),o=d=>{var p;return((p=d.searchText)==null?void 0:p.includes(l==null?void 0:l.toLowerCase()))||(a==null?void 0:a.length)&&a.includes(d[e])},l&&n.addFilter(o)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&s(""),(l.key==="Enter"||l.keyCode===13)&&rt(i)&&i(n)&&s("")},onChange:l=>s(l.target.value),onKeyUp:l=>s(l.target.value),location:t||Ct,class:"search",search:!0,placeholder:r}},sJ=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:mt,visible:!1,onClick:n=>{_Te(n,e);const r=e.getData();OTe({event:t,rows:r})}}),{UNGROUPED:lJ}=Ql,{DOUBLES:Zrt}=ko,Xrt=(t,e)=>i=>{const n=r=>{const a=r.getSelectedData(),o=a.filter(u=>{var c;return!((c=u.events)!=null&&c.length)}).map(({participantId:u})=>u);yt({methods:[{method:p8e,params:{removeGroupParticipant:!0,participantIds:o,eventId:t,drawId:e}}],callback:u=>{var c;if(u!=null&&u.error)r.deselectRow();else{r.deleteRow(o);const p=(c=ly(r.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:c[0];p&&setTimeout(()=>X6({table:r,target:p})(),100);const f=a.flatMap(({participant:g})=>g==null?void 0:g.individualParticipantIds),{participants:h}=$e.getParticipants({participantFilters:{participantIds:f}}),m=h.map(g=>Yx({entry:{participantId:g.participantId,entryStatus:lJ},eventType:Zrt,participant:g}));ze.tables[lJ].updateOrAddData(m)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:gr}},Jrt=(t,e)=>{const n=t.getSelectedData().map(({participantId:s})=>s),r=e.entries.filter(({participantId:s})=>n.includes(s)),a=[{method:Y6e,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];yt({methods:a,callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},Qrt=(t,e)=>i=>({onClick:()=>Jrt(i,t),label:"Add flight",location:gr,hide:e}),eat=(t,e,i,n)=>{const a=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);NTe({participantIds:a,group:e,eventId:i,drawId:n,callback:s=>{if(s!=null&&s.success){const u=t.getData().filter(({participantId:c})=>a.includes(c));ze.tables[e].updateOrAddData(u),t.deleteRow(a)}else t.deselectRow(),Mt({message:s.error.message??"Error moving participants",intent:"is-danger"})}})},GC=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>eat(n,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:gr,options:r}},{ASSIGN_PARTICIPANT:tat}=ib,KF=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:mt,onClick:()=>{const{entries:r=[],eventId:a,eventType:o}=t,s=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",u=$e.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!s.includes(p.participantId));FE({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!(p!=null&&p.length))return;const f=p.map(({participantId:y})=>y),h=e===QD?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";yt({methods:[{params:{eventId:a,participantIds:f,entryStatus:m,entryStage:h},method:x6}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=$e.getParticipants({participantFilters:{participantIds:f},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),T=f.map(w=>Yx({entry:{participantId:w,entryStage:h,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:o,eventId:a}));i.addRow(T)}}})},action:{type:tat,participantsAvailable:u}})}}),{ALTERNATE:YF,UNGROUPED:iat}=Ql,{MAIN:nat}=rr,{DOUBLES:uJ}=ko,rat=(t,e=!0)=>{const{eventId:i,eventType:n,gender:r}=t,a=(l,u)=>{const c=u.getSelectedData().map(m=>m.participantId);if(c.length!==2)return;const p=[Wt.UUID()],f=[{method:t8e,params:{participantIdPairs:[c],allowDuplicateParticipantIdPairs:!0,entryStatus:YF,entryStage:nat,eventId:i,uuids:p}}];yt({methods:f,callback:m=>{var g,v,y;if(m.success){u.deleteRow(c),u.clearFilter();const b=ly(u.element,"tableClass");if(b){const w=(g=lh(b,"controlBar"))==null?void 0:g[0];if(w){const S=lh(w,"search");Array.from(S).forEach(U=>U.value="")}}const I=m.results[0].newParticipantIds,{participants:[T]}=$e.getParticipants({participantFilters:{participantIds:I},withIndividualParticipants:!0,withISO2:!0});if(T){const w=Yx({entry:{participantId:T.participantId,entryStatus:YF},eventType:uJ,participant:T});ze.tables[YF].updateOrAddData([w]);const U=(v=ly(l.target,"tableClass").getElementsByClassName("controlBar"))==null?void 0:v[0];U&&setTimeout(()=>X6({table:u,target:U})(),100)}else console.log("participant not found",{participantIds:I,methods:f,result:m})}else((y=m.error)==null?void 0:y.code)==="ERR_INVALID_PARTICIPANT_IDS"?(Mt({intent:"is-danger",message:r==="MIXED"?"Genders must be mixed":"Invalid pairing"}),u.deselectRow()):console.log({methods:f,result:m})}})};return{createPairButton:{hide:n!==uJ,label:"Create pair",onClick:a,intent:"is-info",location:gr,id:"create-pair",visible:!1},createPairFromSelected:l=>{const u=(l==null?void 0:l.length)===2;if(u&&e){const c=ze.tables[iat];a({target:c.element},c)}else{const c=document.getElementById("create-pair");c&&(c.style.display=u?"":lt)}}}},{DIRECT_ACCEPTANCE:aat}=Ql,{MAIN:oat}=rr,sat=(t,e,i)=>{const r=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);yt({methods:[{method:X6e,params:{entryStatus:aat,ignoreStageSpace:!0,entryStage:oat,participantIds:r,eventId:e,drawId:i}}],callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},lat=(t,e)=>i=>{var r;const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:a,drawId:o})=>({onClick:()=>sat(i,t.eventId,o),stateChange:!0,label:a,value:o,close:!0}));return{hide:!((r=t.drawDefinitions)!=null&&r.length)||e,label:"Add to draw",location:gr,options:n}},{DIRECT_ACCEPTANCE:uat,ALTERNATE:qd,UNGROUPED:cJ,WITHDRAWN:Wd}=Ql,{MAIN:lI,QUALIFYING:sm}=rr,{SINGLES:cat,DOUBLES:dJ}=ko;function dat({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=lI,entryStatus:b})=>v.includes(`${y}.${b}`)),a=!!t,o=t==null?void 0:t.drawId,s=e==null?void 0:e.eventId,l={[vu]:[qd,Wd],[sm]:[vu,qd,Wd],[qd]:[vu,sm,Wd],[Wd]:[qd]},{createPairFromSelected:u}=rat(e),c=n?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);if(y.length===1)return v.selectRow(b),!0;y.length===2&&v.selectRow(b)},p=r(hA(lI)),f=r([`${sm}.${uat}`]),h=r([`${lI}.${qd}`]),m=r([`${lI}.${cJ}`]),g=r([`${lI}.${Wd}`]);return[{placeholder:"No accepted participants",items:[GC(l[vu],s,o),qrt(hA(lI),s,o),lat(e,o),Qrt(e,o),...tT({heading:"Accepted",count:p.length}),!a&&oJ(e,vu),aJ(e),sJ(e),!a&&KF(e,vu)],actions:l[vu],anchorId:D3,entries:p,group:vu,excludeColumns:c,drawCreated:a,togglePanel:II},{placeholder:"No qualifying participants",items:[...tT({heading:"Qualifying",count:f.length}),GC(l[sm],s,o),!a&&oJ(e,sm),aJ(e),sJ(e),!a&&KF(e,sm)],actions:[vu,qd,Wd],anchorId:E3,entries:f,group:sm,excludeColumns:c,drawCreated:a,togglePanel:II},{items:[...tT({heading:"Alternates",count:h.length}),GC(l[qd],s,o),(e==null?void 0:e.eventType)===dJ&&Xrt(s,o),!a&&KF(e,qd)],actions:[vu,sm,Wd],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:P3,entries:h,group:qd,drawCreated:a,togglePanel:II},{hide:!!([cat].includes(e==null?void 0:e.eventType)||a),items:[...tT({heading:"Ungrouped",count:m.length}),Yrt(Ct,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:(e==null?void 0:e.eventType)===dJ&&u,anchorId:C3,entries:m,actions:[Wd],group:cJ,drawCreated:a,togglePanel:II},{items:[...tT({heading:"Withdrawn",count:g.length}),!a&&GC(l[Wd],s,o)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:R3,entries:g,actions:[qd],hide:a,group:Wd,collapsed:!0,drawCreated:a,togglePanel:II}]}function pJ({eventId:t,drawId:e,headerElement:i}){var l,u,c,d,p;(!t||t==="undefined")&&ze.router.navigate("/");let n;const r=f=>{n&&Object.values(ze.tables).forEach(m=>m.removeFilter(n));const h=f==null?void 0:f.toLowerCase();n=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(h)},f?Object.values(ze.tables).forEach(m=>m.addFilter(n)):n=void 0},a=()=>{var I;const{event:f,drawDefinition:h}=$e.getEvent({eventId:t,drawId:e});if(i&&(i.innerHTML=f==null?void 0:f.eventName),!f)return{error:"EVENT_NOT_FOUND"};const{participants:m,derivedDrawInfo:g}=$e.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},v=((I=f==null?void 0:f.drawDefinitions)==null?void 0:I.length)>1,y=((h==null?void 0:h.entries)||(f==null?void 0:f.entries)||[]).map(T=>Yx({entry:T,derivedDrawInfo:g,participants:m,eventType:f.eventType,eventId:t})),{events:b}=$e.getEvents();return{tableData:dat({event:f,drawDefinition:h,participants:m,entryData:y,hasFlights:v}),events:b,event:f}},o=f=>{for(const h of f){const{entries:m,group:g,anchorId:v,placeholder:y,excludeColumns:b,actions:I,drawCreated:T}=h,w=document.getElementById(v);if(w){w.style.display=h.hide?lt:fw,Oa(w);const S=document.createElement("div");S.className=`${sxe} flexcol flexcenter`,w.appendChild(S);const U=document.createElement("div");U.className=`${$ue} flexcol flexcenter`,w.appendChild(U);const P=new da(U,{headerSortElement:gf(["ratings.utr.utrRating","ratings.wtn.wtnRating","seedNumber","ranking","cityState","status","flights"]),columns:krt({actions:I,exclude:b,entries:m,eventId:t,drawId:e,drawCreated:T}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:m,placeholder:y});ze.tables[g]=P;const E=Jo(w,cv);P.on("tableBuilt",()=>{var R;const D=(R=h.items)==null?void 0:R.map(N=>rt(N)?N(P):N);no({target:S,table:P,items:D,onSelection:h.onSelection}),!m.length&&h.togglePanel&&h.togglePanel({target:E,table:P,close:!0})}),P.on("dataChanged",()=>{var A,_;const N=(_=((A=ly(P.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:A[0]).getElementsByClassName(Nue))==null?void 0:_[0],M=P.getData().length;h.togglePanel&&!M&&h.togglePanel({target:E,table:P,close:!0}),N&&(N.innerHTML=M||0)})}}},s=a();if(!s.error){const f="All entries",h=document.getElementById(eP),m={label:f,onClick:()=>Yn({eventId:t}),close:!0},g=(s.event.drawDefinitions||[]).map(E=>({onClick:()=>Yn({eventId:t,drawId:E.drawId}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},m]),v={label:oh,onClick:ATe,close:!0},y=s.events.map(E=>({onClick:()=>Yn({eventId:E.eventId}),label:E.eventName,close:!0})).concat([{divider:!0},v]),b=E=>{var D;E.success&&Yn({eventId:t,drawId:(D=E.drawDefinition)==null?void 0:D.drawId,renderDraw:!0})},I={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>n0({eventId:t,callback:b})},T=(l=s.event.drawDefinitions)==null?void 0:l.map(E=>({onClick:()=>Yn({eventId:t,drawId:E==null?void 0:E.drawId,renderDraw:!0}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},I]),w=(d=(c=(u=s.event)==null?void 0:u.drawDefinitions)==null?void 0:c.find(E=>(E==null?void 0:E.drawId)===e))==null?void 0:d.drawName,S=({eventId:E})=>{console.log("generateFlights",{eventId:E})},U=(p=PTe({eventId:t}))!=null&&p.length?"is-success":lt,P=[{onKeyDown:E=>E.keyCode===8&&E.target.value.length===1&&r(""),onChange:E=>r(E.target.value),onKeyUp:E=>r(E.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:Ct,search:!0},{label:s.event.eventName,options:y.length>1&&y,location:Ct},{label:w||f,options:g,location:Ct},{onClick:()=>Yn({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:mt,hide:!e},{onClick:()=>ETe({eventId:t}),intent:U,id:"editAvoidances",label:"Avoidances",location:mt},{onClick:()=>S({eventId:t,callback:()=>{}}),label:"Flights",location:mt,hide:e,intent:lt},{options:(T==null?void 0:T.length)>2&&T,hide:((T==null?void 0:T.length)||0)<3||e,intent:"is-info",location:mt,label:"Draws",align:mt},{onClick:()=>n0({eventId:t,callback:b}),hide:(T==null?void 0:T.length)>2||e,intent:"is-info",label:"Add draw",location:mt}];no({target:h,items:P}),o(s.tableData)}}function pat({drawId:t,callback:e}){var u,c;const i=(c=(u=$e.getEvent({drawId:t}))==null?void 0:u.drawDefinition)==null?void 0:c.structures;if(!(i!=null&&i.length))return;const n=i.map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:ur(4),placeholder:d,field:p,id:p}}));let r;const a=()=>{const d=i.map(({structureId:h})=>{var m;return((m=r[h])==null?void 0:m.value)&&{structureId:h,structureName:r[h].value.trim()}}).filter(Boolean);yt({methods:[{params:{drawId:t,structureDetails:d},method:I8e}],callback:h=>{h.success&&(Mt({message:"Structure renamed",intent:"is-success"}),rt(e)&&e())}})},o=()=>{const d=i.map(({structureId:m})=>{var g;return(g=r[m])==null?void 0:g.value}).filter(Boolean),p=d.every(ur(4)),f=document.getElementById("renameStructures"),h=d.length&&p;f&&(f.disabled=!h)},s=i.map(({structureId:d})=>({control:d,onInput:o}));yn({title:"Edit structure names",content:d=>r=Wn(d,n,s),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}const{ROUND_ROBIN:fJ,SINGLE_ELIMINATION:fat}=rr;function hat({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=S=>`finishingPosition-${S}`,a=n.map(({finishingPosition:S,finishingPositionRange:U})=>({field:r(S),id:r(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${U}`,width:"400px"}}));if(!a||a.length<1){Mt({message:"No playoff positions available",intent:"is-danger"});return}const o={value:WM,label:"Playoff name",field:"structureName",id:"structureName"},s=RTe({isPlayoff:!0}),l={value:fat,options:s,label:"Draw type",field:Xc,id:Xc},{validGroupSizes:u}=$e.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:u.map(S=>({label:S,value:S})),label:"Group size",field:ip,visible:!1,value:4},p="Positions to be played off:",f={text:`${p} None`,id:"selectedPlayoffRange"},m=[o,l,d,f,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const U=n.filter(({finishingPosition:M})=>{var A;return(A=g[r(M)])==null?void 0:A.checked}).map(({finishingPosition:M})=>M),P=g.structureName.value,E=g[Xc].value,D={finishingPositions:U,structureName:P,drawType:E};if(E===fJ){const M=parseInt(g[ip].value);D.structureOptions={groupSize:M}}yt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[D],playoffStructureNameBase:WM},method:Awe}],callback:M=>{var A;M.success?(Mt({message:"Structure added",intent:"is-success"}),rt(t)&&t()):(console.log({result:M}),Mt({message:((A=M.error)==null?void 0:A.message)||"Error",intent:"is-danger"}))}})},y=S=>`${Math.min(...S)}-${Math.max(...S)}`,b=()=>{const S=n.filter(({finishingPosition:F})=>{var x;return(x=g[r(F)])==null?void 0:x.checked}).map(({finishingPositions:F})=>F).flat(),U=n.map(({finishingPosition:F})=>g[r(F)].checked),P=n.map(({finishingPosition:F})=>g[r(F)].checked&&F).filter(Boolean),E=P.map((F,x)=>(P[x+1]||F)-F).every(F=>F<2),D=U.filter(Boolean).length,R=document.getElementById("addStructure"),N=D&&E;R&&(R.disabled=!N);const M=document.getElementById("selectedPlayoffRange");if(M){const F=N?y(S):"None";M.innerHTML=`${p} ${F}`}const{validGroupSizes:A}=$e.getValidGroupSizes({drawSize:(S==null?void 0:S.length)||4,groupSizeLimit:8}),_=A.map(F=>({label:F,value:F})),k=g[ip],B=A.includes(4)?4:A[0];Oa(k),iq(k,{options:_,value:B})},I=({e:S,fields:U})=>{const P=S.target.value,E=[fJ].includes(P);U[ip].style.display=E?"":lt},T=n.map(({finishingPosition:S})=>({control:r(S),onChange:b})).concat([{onChange:I,control:Xc}]);yn({title:"Add playoff structure",content:S=>g=Wn(S,m,T),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function mat({drawId:t,structureId:e,callback:i}){var h,m;const n=$e.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=g=>g.finishingPositions.reduce((v,y)=>(v||0)+(y||0));if(!n.playoffRoundsRanges&&((h=n.finishingPositionsAvailable)!=null&&h.length))return hat({...n,drawId:t,structureId:e,callback:i});const a=(m=n.playoffRoundsRanges)==null?void 0:m.sort((g,v)=>r(g)-r(v)).map(({finishingPositionRange:g})=>({label:g,field:g,id:g,checkbox:!0,fieldPair:{field:`${g}-name`,placeholder:`${WM} ${g}`,id:`${g}-name`,width:"350px"}}));if(!a||a.length<1){Mt({message:"No playoff positions available",intent:"is-danger"});return}const o=g=>{a.forEach(({label:v,fieldPair:y})=>{const b=document.getElementById(y.id);b&&(b.placeholder=`${g} ${v}`)})},l=[{onChange:g=>o(g.target.value),onKeyDown:g=>g.key==="Tab"&&o(g.target.value),value:WM,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let u;const c=()=>{const g=n.playoffRoundsRanges.filter(w=>{var S;return(S=u[w.finishingPositionRange])==null?void 0:S.checked}),v=u.nameBase.value,y={},b=g.map(({roundNumber:w,finishingPositionRange:S})=>{var P;const U=(P=u[`${S}-name`])==null?void 0:P.value;return U&&(y[`0-${w}`]={name:U}),{[w]:1}});yt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:y,roundProfiles:b,playoffStructureNameBase:v},method:Awe}],callback:w=>{var S;w.success?(Mt({message:"Structure(s) added",intent:"is-success"}),rt(i)&&i()):Mt({message:((S=w.error)==null?void 0:S.message)||"Error",intent:"is-danger"})}})},d=()=>{const g=n.playoffRoundsRanges.filter(y=>{var b;return(b=u[y.finishingPositionRange])==null?void 0:b.checked}),v=document.getElementById("addStructure");v&&(v.disabled=!g.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:g})=>({control:g,onChange:d}));yn({title:"Add playoff structures",content:g=>u=Wn(g,l,p),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:c}]})}const{FINISHING_POSITIONS:gat}=rr;function vat({drawData:t,eventId:e,structureId:i,updateControlBar:n}){var l,u,c;const r=t.drawId,a=(u=(l=$e.getAvailablePlayoffProfiles({drawId:r,structureId:i}))==null?void 0:l.playoffRounds)==null?void 0:u.length,o=(c=$e.isValidForQualifying({drawId:r,structureId:i}))==null?void 0:c.valid,s=()=>{n0({callback:d=>{if(d.success){const p=d.structure.structureId;Yn({eventId:e,drawId:r,structureId:p,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})};return t.structures.sort((d,p)=>Wt.structureSort(d,p,{mode:gat})).map(d=>({onClick:()=>{Yn({eventId:e,drawId:r,structureId:d.structureId,renderDraw:!0})},label:d.structureName,close:!0})).concat([{divider:!0},{onClick:()=>pat({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>s(),hide:!o,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>mat({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const mA=(t,e)=>i=>{const n=(i||"").trim().split(" ").length;return n>=t&&(!e||e&&n<=e)};function LTe({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const o=()=>{const p={auditReason:a.drawDeletionReason.value},f=e.map(m=>({params:{eventId:i,drawId:m,auditData:p,force:!0},method:L6}));yt({methods:f,callback:m=>m.success&&Yn({eventId:i})})},s=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:mA(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],u=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const f=p.drawDeletionReason.value,h=mA(5)(f),m=document.getElementById("deleteDraw");m&&(m.disabled=!h)}}];yn({title:r,content:p=>a=Wn(p,s,u),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:o}]})}function yat({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const o=()=>{const p={auditReason:a.drawDeletionReason.value},f=e.map(m=>({params:{eventId:i,drawId:m,auditData:p},method:w8e}));yt({methods:f,callback:m=>m.success&&Yn({eventId:i,drawId:e[0]})})},s=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:mA(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],u=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const f=p.drawDeletionReason.value,h=mA(5)(f),m=document.getElementById("deleteDraw");m&&(m.disabled=!h)}}];yn({title:r,content:p=>a=Wn(p,s,u),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:o}]})}function bat({structureId:t,drawId:e}){const i=$e.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;y8({callback:r=>{r&&(r===i?Mt({message:"No changes",intent:"is-warning"}):yt({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:S8e}],callback:s=>s.success&&Mt({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function Iat({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:b8e}],r=l=>{var u;l.success?Yn({eventId:e,drawId:t,renderDraw:!0}):Mt({message:((u=l.error)==null?void 0:u.message)||"Error",intent:"is-danger "})};yn({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>yt({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:hJ}=ko;function wat({structureName:t,dualMatchUp:e,structureId:i,eventData:n,drawData:r,drawId:a}){var d,p;const o=(d=r.structures)==null?void 0:d.find(f=>f.stage===QD),s=(p=r.structures)==null?void 0:p.find(f=>f.structureId===i),l=n.eventInfo.eventId,u=()=>{var v;const f=e.matchUpId,h=(v=$e.findMatchUp({drawId:a,matchUpId:f}))==null?void 0:v.matchUp,m=Kx({matchUp:h}),g=document.getElementById(Ud);Oa(g),g.appendChild(m)},c=[{hide:n.eventInfo.eventType!==hJ,onClick:()=>mTe({matchUpId:e.matchUpId,structureId:i,eventId:l,drawId:a,callback:u}),label:"Edit scorecard",close:!0},{hide:n.eventInfo.eventType===hJ,onClick:()=>bat({structureId:i,eventId:l,drawId:a}),label:`Edit ${t} scoring`,close:!0},{hide:(s==null?void 0:s.stage)==="MAIN"&&s.stageSequence===1&&!o,onClick:()=>Iat({drawId:a,eventId:l,structureId:i}),label:"Remove structure",close:!0},{onClick:()=>LTe({eventData:n,drawIds:[a]}),label:"Delete draw"},{onClick:()=>yat({eventData:n,drawIds:[a]}),label:"Reset draw"}];if(e){const f=e.matchUpId;c.push({divider:!0});const h=b=>b.success&&u(),g={label:"Remove players",onClick:()=>{var T;((T=$e.findMatchUp({matchUpId:f,drawId:a}).matchUp.tieMatchUps)==null?void 0:T.some($e.checkScoreHasValue))?Mt({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):yt({methods:[{params:{drawId:a,matchUpId:f,inheritance:!1},method:Lwe}],callback:h})},close:!0};c.push(g);const y={label:"Clear results",onClick:()=>{yt({methods:[{params:{drawId:a,matchUpId:f},method:Fwe}],callback:h})},close:!0};c.push(y)}return c}function Sat({eventData:t}){const e=t.drawsData.map(({drawId:s,drawName:l})=>({label:l,checkbox:!0,field:s,id:s}));let i;const n=()=>{const s=t.drawsData.filter(({drawId:l})=>{var u;return(u=i[l])==null?void 0:u.checked}).map(({drawId:l})=>l);setTimeout(()=>LTe({eventData:t,drawIds:s}),200)},r=()=>{const s=t.drawsData.filter(({drawId:u})=>{var c;return(c=i[u])==null?void 0:c.checked}).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!s)},a=t.drawsData.map(({drawId:s})=>({onChange:r,control:s}));yn({title:"Delete flights",content:s=>i=Wn(s,e,a),buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function Tat({eventData:t,drawId:e}){const i=()=>{const o=s=>{var l,u;if(s.drawDefinition){const c=(u=(l=s.drawDefinition.structures)==null?void 0:l[0])==null?void 0:u.structureId,d=t.eventInfo.eventId,p=s.drawDefinition.drawId;Yn({eventId:d,drawId:p,structureId:c,renderDraw:!0})}};n0({eventId:t.eventInfo.eventId,callback:o})},n=()=>Sat({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>Yn({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(o=>({onClick:()=>{var c,d;const s=(d=(c=o.structures)==null?void 0:c[0])==null?void 0:d.structureId,l=t.eventInfo.eventId,u=o.drawId;Yn({eventId:l,drawId:u,structureId:s,renderDraw:!0})},label:o.drawName,close:!0})).concat([{divider:!0},a,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function Uat(){return{eventOptions:($e.getEvents().events??[]).map(i=>({onClick:()=>{var r,a,o,s;const n=$e.getEventData({eventId:i.eventId});if(!((a=(r=n==null?void 0:n.eventData)==null?void 0:r.drawsData)!=null&&a.length))Yn({eventId:i.eventId});else{const l=(s=(o=n.eventData.drawsData)==null?void 0:o[0])==null?void 0:s.drawId;Yn({eventId:n.eventData.eventInfo.eventId,drawId:l,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${oh}</div>`,onClick:ATe,close:!0}])}}const{TEAM:Dat}=ko;function FTe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:a,drawId:o}){var h,m,g;const{eventOptions:s}=Uat(),l=Tat({eventData:n,drawId:o}),u=(h=n==null?void 0:n.drawsData)==null?void 0:h.find(v=>v.drawId===o),c=(g=(m=u==null?void 0:u.structures)==null?void 0:m.find(v=>v.structureId===i))==null?void 0:g.structureName,d=(r==null?void 0:r.length)===1&&n.eventInfo.eventType===Dat,p=vat({updateControlBar:e,structureId:i,drawData:u,eventId:a}),f=wat({dualMatchUp:d&&r[0],structureName:c,structureId:i,eventData:n,drawData:u,drawId:o});return[{onKeyDown:v=>v.keyCode===8&&v.target.value.length===1&&t(""),onChange:v=>t(v.target.value),onKeyUp:v=>t(v.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:Ct,search:!0},{options:s.length>1?s:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:Ct},{options:l.length>1?l:void 0,label:u.drawName,modifyLabel:!0,location:Ct},{options:p.length>1?p:void 0,label:c,modifyLabel:!0,location:Ct},{options:f,intent:"is-info",label:"Actions",location:mt,align:mt}]}function w8({eventId:t,drawId:e,structureId:i,updateDisplay:n}){var m,g;const r=$e.getEventData({eventId:t}).eventData,a=(m=r==null?void 0:r.drawsData)==null?void 0:m.find(v=>v.drawId===e),o=(a==null?void 0:a.structures)||[];i=i||((g=o==null?void 0:o[0])==null?void 0:g.structureId);const s=o.find(v=>v.structureId===i),{roundMatchUps:l}=Wt.makeDeepCopy(s||{}),u=Object.values(l||{}).flat();let c;const d=v=>{var y;return(y=v.searchText)==null?void 0:y.includes(c)},f=FTe({updateControlBar:w8,updateParticipantFilter:v=>{v||Object.values(ze.tables).filter(Boolean).forEach(y=>y.clearFilter()),c=v==null?void 0:v.toLowerCase(),v&&Object.values(ze.tables).filter(Boolean).forEach(y=>y.addFilter(d)),typeof n=="function"&&n({participantFilter:c})},structureId:i,eventData:r,drawData:a,matchUps:u,eventId:t,drawId:e}),h=document.getElementById(eP);no({target:h,items:f})}function Pat(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function Eat(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}function BTe({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||(i==null?void 0:i.structureId);const a=$e.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],o=a.reduce((h,m)=>{const g=m.roundNumber;return g&&!h.includes(g)&&h.push(g),h},[]);if(e=e||o.length&&o[o.length-1],!e)return;let s;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const h=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&s.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&s.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&s.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:s.completed.checked,removeIncomplete:s.unscored.checked,removeUnassigned:s.empties.checked,structureId:n,matchUpIds:h,drawId:t},method:kwe}],g=v=>{v.success?rt(r)&&r({refresh:!0}):console.log({postMutationError:v.error})};h.length&&yt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:o.map(h=>({label:h,value:h})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];yn({title:"Delete matches",content:h=>s=Wn(h,p),buttons:u})}function $Te({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||(e==null?void 0:e.structureId);const a=$e.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),s=Math.max(...o,1);a.length?o.push(s+1):o.length||o.push(1);let l;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{var w;const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=$e.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!((w=b.matchUps)!=null&&w.length))return;const I=[{method:Mwe,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];yt({methods:I,callback:S=>{S.success?rt(r)&&r({refresh:!0}):console.log(S.error)}})}}],p={text:"Round number:",fieldPair:{options:o.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},h={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},h];yn({title:"Add matches",content:v=>l=Wn(v,m),buttons:c})}const{ASSIGN_PARTICIPANT:Cat}=ib;function S8({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||(e==null?void 0:e.structureId);let r,a;const o=$e.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=o.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=s[s.length-1],u=Math.max(...s,1);o.length&&s.push(u+1);const c=({matchUps:v,roundResults:y})=>{const b=[{params:{structureId:i,matchUps:v,drawId:t},method:Mwe}];if(y!=null&&y.length)for(const T of y){const w=T==null?void 0:T.modifiedScaleValues;b.push({params:{modifiedScaleValues:w,replacePriorValues:!0},method:Q6e})}yt({methods:b,callback:T=>{T.success?rt(n)&&n({refresh:!0}):console.log(T.error)}})},d=v=>{var w;const y=a.wtn.checked&&"wtn"||a.utr.checked&&"utr"||"",{accessor:b,scaleName:I}=ii.scales[y]??{};pA(y);const T=$e.drawMatic({updateParticipantRatings:!0,dynamicRatings:!0,refreshRatings:!0,participantIds:v,scaleAccessor:b,scaleName:I,drawId:t});(w=T.matchUps)!=null&&w.length&&c(T)},p=({participantIds:v})=>{const y=$e.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?o.filter(({roundNumber:S,sides:U})=>S===l&&(U==null?void 0:U.some(({participantId:P})=>P))).map(({sides:S})=>S.map(({participantId:U})=>U)).flat():[],I=b.length?b:v;FE({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{var P;const U=(P=S.selected)==null?void 0:P.map(({participantId:E})=>E);d(U)},action:{type:Cat,participantsAvailable:y},update:r})},h=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{var v;if(a[Ns].value===Ns){const{drawDefinition:y}=$e.getEvent({drawId:t}),b=y.entries.filter(({entryStatus:I,entryStage:T})=>!["WITHDRAWN","UNGROUPED"].includes(I)&&(!T||T===e.stage)).map(({participantId:I})=>I);p({participantIds:b})}else{Hw();const y=$e.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(!((v=y.matchUps)!=null&&v.length))return;c(y)}}}],m=[{field:Ns,value:Ns,options:[{label:Ns,value:Ns,selected:!0},{label:S3,value:!1}]},{options:[{text:"WTN",field:"wtn",checked:ii.activeScale===OU},{text:"UTR",field:"utr",checked:ii.activeScale===oy},{text:"None",field:"none",checked:!ii.activeScale}],onClick:v=>console.log({x:v}),label:"Level of play",field:"levelOfPlay",id:"levelOfPlay",radio:!0}];r=yn({title:"Add round",content:v=>a=Wn(v,m),structure:e,buttons:h}).update}const VTe="Delete matches",jTe="Add matches",GTe="Add round";function Rat({structure:t,drawId:e,callback:i}){if(!$e.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>$Te({drawId:e,structure:t,callback:n}),label:jTe,color:"blue"},{onClick:()=>S8({drawId:e,structure:t,newRound:!0,callback:n}),label:GTe,color:"blue"},{label:VTe,color:"red",onClick:()=>BTe({drawId:e,structure:t,callback:n})}],selection:!1,location:mt,align:mt}}const{CONTAINER:Mat}=rr;function Nat({callback:t,structure:e,existingView:i}){const n=s=>i!==s&&t({refresh:!0,view:s}),r=(e==null?void 0:e.structureType)===Mat,a=$e.isAdHoc({structure:e}),o=[];return o.push({active:!i||i===uB,onClick:()=>n(uB),label:a?"Columns":"Draw",close:!0}),o.push({active:i===mw,onClick:()=>n(mw),label:"Table",close:!0}),(a||r)&&o.push({active:i===hw,onClick:()=>n(hw),label:"Stats",close:!0}),{tabs:o}}const{MAIN:Aat,QUALIFYING:_at,VOLUNTARY_CONSOLATION:kat}=rr;function T8({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){var f;const a=document.getElementById(U3),{sourceStructuresComplete:o,hasDrawFeedProfile:s}=i??{},l=!((i==null?void 0:i.stage)===Aat&&(i==null?void 0:i.stageSequence)===1)&&(i==null?void 0:i.stage)!==_at&&s,u=$e.isAdHoc({structure:i}),c=[];if(l){const h=()=>{const g={params:{structureId:i.sourceStructureIds[0],drawId:n},method:l8e};yt({methods:[g],callback:y=>{y.success&&typeof t=="function"&&t()}})},m=(f=i.positionAssignments)==null?void 0:f.filter(({participantId:g})=>g).length;c.push({intent:o?"is-primary":lt,disabled:o!==!0,visible:!m,onClick:h,label:"Auto position",location:mt})}const d=({refresh:h,view:m})=>typeof e=="function"&&e({refresh:h,view:m});if(u){const h=Rat({structure:i,drawId:n,callback:e});c.push(h)}(i==null?void 0:i.stage)===kat&&console.log("voluntary controlBar with [View participants]");const p=Nat({structure:i,existingView:r,drawId:n,callback:d}).tabs;c.push({onClick:()=>d({refresh:!0,view:"participants"}),id:"roundDisplayTabs",location:Ct,tabs:p}),c.length&&no({target:a,items:c})}function Zx(){[U3,_ue,kue].forEach(t=>{const e=document.getElementById(t);e&&Oa(e)})}const Oat=t=>t.reduce((e,i)=>e+parseFloat(i),0),mJ=t=>parseFloat((Oat(t)/t.length).toFixed(2));function gJ({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){var c,d;const r=`${(t==null?void 0:t.setsWon)||0}/${(t==null?void 0:t.setsLost)||0}`,a=`${(t==null?void 0:t.gamesWon)||0}/${(t==null?void 0:t.gamesLost)||0}`,o=(t==null?void 0:t.groupOrder)||(t==null?void 0:t.provisionalOrder),s=(c=t==null?void 0:t.pressureScores)!=null&&c.length?mJ(t.pressureScores):0,l=(d=t==null?void 0:t.ratingVariation)!=null&&d.length?mJ(t.ratingVariation):0,u=n[i];return{participantName:u.participantName,groupName:u.groupName,...t,averageVariation:l,averagePressure:s,participantId:i,drawPosition:e,participant:u,gamesResult:a,setsResult:r,order:o}}function TV(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function iT(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function vJ(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function xat(){return[{headerMenu:vf({}),field:"drawPosition",headerSort:!1,hozAlign:Ct,width:55},{formatter:"responsiveCollapse",hozAlign:Et,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:xb(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:e0,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:Et,headerWordWrap:!0,title:"Match W/L",hozAlign:Et,maxWidth:80,field:"result"},{formatter:iT,headerHozAlign:Et,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Et,maxWidth:80},{headerHozAlign:Et,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Et,maxWidth:80},{formatter:iT,headerHozAlign:Et,headerWordWrap:!0,title:"Set Win%",hozAlign:Et,field:"setsPct",maxWidth:80},{headerHozAlign:Et,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Et,maxWidth:80},{formatter:iT,headerHozAlign:Et,headerWordWrap:!0,title:"Game Win%",hozAlign:Et,field:"gamesPct",maxWidth:80},{formatter:iT,field:"averageVariation",headerHozAlign:Et,sorter:vJ,hozAlign:Et,maxWidth:70,title:"RV"},{formatter:iT,field:"averagePressure",headerHozAlign:Et,sorter:vJ,hozAlign:Et,maxWidth:70,title:"PS"},{headerHozAlign:Et,field:"pressureOrder",sorter:TV,title:"PS#",hozAlign:Et,maxWidth:80},{headerHozAlign:Et,sorter:TV,hozAlign:Et,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function HTe({eventId:t,drawId:e,structureId:i}){let n,r,a,o;const s=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},u=()=>{var w,S;const{participants:y,eventData:b}=$e.getEventData({participantsProfile:{withScaleValues:!0},allParticipantResults:!0,pressureRating:!0,refreshResults:!0,eventId:t}),I=(w=b==null?void 0:b.drawsData)==null?void 0:w.find(U=>U.drawId===e);return r=(S=I==null?void 0:I.structures)==null?void 0:S.find(U=>U.structureId===i),o||(o=s(y)),(r!=null&&r.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:U,structureName:P,structureId:E})=>{l[E]=P,U.forEach(D=>{D.participantId&&(o[D.participantId].groupName=P)})}),((r==null?void 0:r.participantResults)??[]).filter(U=>{var E;const P=o[U.participantId];return!a||((E=P==null?void 0:P.participantName)==null?void 0:E.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},c=u(),d=()=>c==null?void 0:c.map(y=>gJ({...y,participantMap:o})).sort((y,b)=>TV(y.order,b.order)),p=()=>{var y;return(y=u())==null?void 0:y.map(b=>gJ({...b,participantMap:o}))},f=y=>{(y==null?void 0:y.participantFilter)!==void 0&&(a=y.participantFilter),n.replaceData(p())},h=d(),m=xat();return(y=>{mf({anchorId:Ud});const b=document.getElementById(Ud),I=Object.values(l).length>1?["groupName"]:void 0;n=new da(b,{headerSortElement:gf(["averageVariation","averagePressure","participantName","pressureOrder","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[T=>T],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(h),T8({structure:r,drawId:e,existingView:hw,callback:({refresh:y,view:b}={})=>{Zx(),b?Yn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):R1({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),w8({eventId:t,drawId:e,structureId:i,updateDisplay:f}),{table:n,replaceTableData:f}}function Lat({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault(),S8({newRound:!0,structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const a=document.getElementById(Ud);a&&a.appendChild(n)}function Fat({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault();const s=t.drawName;n0({callback:l=>{var c,d,p;const u=(p=(d=(c=l.drawDefinition)==null?void 0:c.structures)==null?void 0:d.find(({stage:f})=>f===QD))==null?void 0:p.structureId;Yn({eventId:e,drawId:i,structureId:u,renderDraw:!0})},isQualifying:!0,drawName:s,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const a=document.getElementById(Ud);a&&a.appendChild(n)}const yJ={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function Bat({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=o=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(o.type)&&$at({action:o,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER"].includes(o.type)&&Vat({action:o,callback:i}),["SEED_VALUE"].includes(o.type)&&jat({target:n,action:o,callback:i})},a=e==null?void 0:e.filter(({type:o})=>yJ[o]).map(o=>({option:yJ[o.type]||o.type,onClick:()=>r(o)}));a!=null&&a.length&&Ps({options:a,target:n,config:{arrow:!1,offset:[0,0]}})}function $at({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];yt({methods:n,callback:i})}function Vat({action:t,callback:e}){FE({action:t,onSelection:n=>{const r=o=>o.success?e():console.log({result:o}),a=[{params:{...t.payload,...n},method:t.method}];yt({methods:a,callback:r})},selectOnEnter:!0})}function jat({target:t,action:e,callback:i}){let n;function r(o){if((o==null?void 0:o.key)==="Enter"){const s=o.target.value;if(Wt.isConvertableInteger(s)){const l=c=>c.success?i():console.log({result:c}),u=[{params:{...e.payload,seedValue:s},method:e.method}];yt({methods:u,callback:l})}n.destroy()}}n=Ps({menuItems:[{label:"Assign seed number ",validator:Kc,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function Gat(t){var a,o,s,l;const{structureId:e,drawId:i}=(t==null?void 0:t.context)??t,n=(l=(s=(o=(a=t.eventData)==null?void 0:a.drawsData)==null?void 0:o.find(u=>u.drawId===i))==null?void 0:s.structures)==null?void 0:l.find(u=>u.structureId===e),r=[];if($e.isAdHoc({structure:n})){const u=[{onClick:()=>$Te({...t}),text:jTe,color:"blue"},{onClick:()=>S8({...t,structure:n,roundNumber:void 0,newRound:!0}),text:GTe,color:"blue"},{onClick:()=>BTe({...t}),text:VTe,color:"red"}];r.push(...u)}t!=null&&t.pointerEvent&&r.length&&Ps({items:r,target:t.pointerEvent.target,config:{placement:tf}})}const{TEAM:Hat}=Ra;function zat({callback:t,drawId:e,eventData:i}){var c;const n=(c=i==null?void 0:i.drawsData)==null?void 0:c.flatMap(({structures:d})=>d.flatMap(p=>{var f;return[(f=p.structures)==null?void 0:f.flatMap(h=>Object.values(h.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]}).filter(Boolean)),r=Wt.createMap(n,"matchUpId"),a=d=>{const p=GS(d.pointerEvent.target,"tmx-m","id");return r[p]},o=d=>parseInt(GS(d.pointerEvent.target,"tmx-sd","sideNumber")),s=d=>GS(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(GS(d.pointerEvent.target,"tmx-rd","roundNumber"));return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),f=s(d);return Gat({pointerEvent:d.pointerEvent,roundNumber:p,structureId:f,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d!=null&&d.pointerEvent){d.pointerEvent.stopPropagation();const p=GS(d.pointerEvent.target,"tmx-m","id"),f=r[p];d8({pointerEvent:d.pointerEvent,matchUp:f,callback:t})}},venueClick:d=>{var f,h,m,g;const p=a(d);if(d!=null&&d.pointerEvent&&((f=p==null?void 0:p.schedule)!=null&&f.venueId)){const v=p.schedule.venueId,y=(g=(m=(h=$e.findVenue({venueId:v}))==null?void 0:h.venue)==null?void 0:m.addresses)==null?void 0:g[0],{latitude:b,longitude:I}=y||{};if(!b||!I)return;const T=`https://www.google.com/maps/@?api=1&map_action=map&center=${b}%2C${I}&zoom=18&basemap=satellite`,w=`https://bing.com/maps/default.aspx?cp=${b}~${I}&lvl=17&style=h`,S=P=>{const E=P&&b&&I&&(P==="google"&&T||w);E&&window.open(E,"_blank")};Ps({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>S("google"),hide:!b||!I,text:"Open in Google Maps"},{onClick:()=>S("bing"),hide:!b||!I,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:tf}})}},matchUpClick:d=>console.log("matchUpClick",d),scoreClick:d=>{var g;const p=o(d),f=a(d),{validActions:h}=$e.matchUpActions({matchUpId:f.matchUpId,drawId:f.drawId,sideNumber:p})||{},m=h==null?void 0:h.find(({type:v})=>v==="SCORE");if(m)if(f.matchUpType===Hat){const v=()=>t(),y=(g=i==null?void 0:i.eventInfo)==null?void 0:g.eventName,{matchUpId:b,drawId:I}=f;Wx({title:y,drawId:I,matchUpId:b,onClose:v})}else qx({matchUpId:m.payload.matchUpId,callback:t})},participantClick:d=>{var g;const p=a(d),f=o(d),h=d.side||((g=p.sides)==null?void 0:g.find(v=>v.sideNumber===f)),{validActions:m}=p.drawId&&$e.positionActions({sideNumber:f||(h==null?void 0:h.sideNumber),structureId:p==null?void 0:p.structureId,drawPosition:h==null?void 0:h.drawPosition,matchUpId:p==null?void 0:p.matchUpId,drawId:p==null?void 0:p.drawId,policyDefinitions:{positionActions:{}}})||{};Bat({...d,actions:m,callback:t})}}}var bJ=11;function qat(t,e){var i=e.attributes,n,r,a,o,s;if(!(e.nodeType===bJ||t.nodeType===bJ)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,a=n.namespaceURI,o=n.value,a?(r=n.localName||r,s=t.getAttributeNS(a,r),s!==o&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(a,r,o))):(s=t.getAttribute(r),s!==o&&t.setAttribute(r,o));for(var u=t.attributes,c=u.length-1;c>=0;c--)n=u[c],r=n.name,a=n.namespaceURI,a?(r=n.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var HC,Wat="http://www.w3.org/1999/xhtml",$l=typeof document>"u"?void 0:document,Kat=!!$l&&"content"in $l.createElement("template"),Yat=!!$l&&$l.createRange&&"createContextualFragment"in $l.createRange();function Zat(t){var e=$l.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Xat(t){HC||(HC=$l.createRange(),HC.selectNode($l.body));var e=HC.createContextualFragment(t);return e.childNodes[0]}function Jat(t){var e=$l.createElement("body");return e.innerHTML=t,e.childNodes[0]}function Qat(t){return t=t.trim(),Kat?Zat(t):Yat?Xat(t):Jat(t)}function zC(t,e){var i=t.nodeName,n=e.nodeName,r,a;return i===n?!0:(r=i.charCodeAt(0),a=n.charCodeAt(0),r<=90&&a>=97?i===n.toUpperCase():a<=90&&r>=97?n===i.toUpperCase():!1)}function eot(t,e){return!e||e===Wat?$l.createElement(t):$l.createElementNS(e,t)}function tot(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function ZF(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var IJ={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}ZF(t,e,"selected")},INPUT:function(t,e){ZF(t,e,"checked"),ZF(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,a,o;r;)if(o=r.nodeName&&r.nodeName.toUpperCase(),o==="OPTGROUP")a=r,r=a.firstChild;else{if(o==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&a&&(r=a.nextSibling,a=null)}t.selectedIndex=i}}},nT=1,wJ=11,SJ=3,TJ=8;function lm(){}function iot(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function not(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=n;n=$l.createElement("html"),n.innerHTML=a}else n=Qat(n);else n.nodeType===wJ&&(n=n.firstElementChild);var o=r.getNodeKey||iot,s=r.onBeforeNodeAdded||lm,l=r.onNodeAdded||lm,u=r.onBeforeElUpdated||lm,c=r.onElUpdated||lm,d=r.onBeforeNodeDiscarded||lm,p=r.onNodeDiscarded||lm,f=r.onBeforeElChildrenUpdated||lm,h=r.skipFromChildren||lm,m=r.addChild||function(k,B){return k.appendChild(B)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function b(k){y.push(k)}function I(k,B){if(k.nodeType===nT)for(var F=k.firstChild;F;){var x=void 0;B&&(x=o(F))?b(x):(p(F),F.firstChild&&I(F,B)),F=F.nextSibling}}function T(k,B,F){d(k)!==!1&&(B&&B.removeChild(k),p(k),I(k,F))}function w(k){if(k.nodeType===nT||k.nodeType===wJ)for(var B=k.firstChild;B;){var F=o(B);F&&(v[F]=B),w(B),B=B.nextSibling}}w(i);function S(k){l(k);for(var B=k.firstChild;B;){var F=B.nextSibling,x=o(B);if(x){var $=v[x];$&&zC(B,$)?(B.parentNode.replaceChild($,B),P($,B)):S(B)}else S(B);B=F}}function U(k,B,F){for(;B;){var x=B.nextSibling;(F=o(B))?b(F):T(B,k,!0),B=x}}function P(k,B,F){var x=o(B);x&&delete v[x],!(!F&&(u(k,B)===!1||(t(k,B),c(k),f(k,B)===!1)))&&(k.nodeName!=="TEXTAREA"?E(k,B):IJ.TEXTAREA(k,B))}function E(k,B){var F=h(k,B),x=B.firstChild,$=k.firstChild,j,V,H,z,q;e:for(;x;){for(z=x.nextSibling,j=o(x);!F&&$;){if(H=$.nextSibling,x.isSameNode&&x.isSameNode($)){x=z,$=H;continue e}V=o($);var W=$.nodeType,Y=void 0;if(W===x.nodeType&&(W===nT?(j?j!==V&&((q=v[j])?H===q?Y=!1:(k.insertBefore(q,$),V?b(V):T($,k,!0),$=q,V=o($)):Y=!1):V&&(Y=!1),Y=Y!==!1&&zC($,x),Y&&P($,x)):(W===SJ||W==TJ)&&(Y=!0,$.nodeValue!==x.nodeValue&&($.nodeValue=x.nodeValue))),Y){x=z,$=H;continue e}V?b(V):T($,k,!0),$=H}if(j&&(q=v[j])&&zC(q,x))F||m(k,q),P(q,x);else{var Z=s(x);Z!==!1&&(Z&&(x=Z),x.actualize&&(x=x.actualize(k.ownerDocument||$l)),m(k,x),S(x))}x=z,$=H}U(k,$,V);var X=IJ[k.nodeName];X&&X(k,B)}var D=i,R=D.nodeType,N=n.nodeType;if(!g){if(R===nT)N===nT?zC(i,n)||(p(i),D=tot(i,eot(n.nodeName,n.namespaceURI))):D=n;else if(R===SJ||R===TJ){if(N===R)return D.nodeValue!==n.nodeValue&&(D.nodeValue=n.nodeValue),D;D=n}}if(D===n)p(i);else{if(n.isSameNode&&n.isSameNode(D))return;if(P(D,n,g),y)for(var M=0,A=y.length;M<A;M++){var _=v[y[M]];_&&T(_,_.parentNode,!1)}}return!g&&D!==i&&i.parentNode&&(D.actualize&&(D=D.actualize(i.ownerDocument||$l)),i.parentNode.replaceChild(D,i)),D}}var rot=not(qat);const{extractTime:UJ,timeStringMinutes:DJ}=Wt.dateTime;function aot(t,e){const i=t.schedule??{},n=e.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){const r=DJ(UJ(i.scheduledTime)),a=DJ(UJ(n.scheduledTime));return r-a}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}const{DOUBLES:oot,TEAM:PJ}=ko;function R1({eventId:t,drawId:e,structureId:i,roundsView:n,redraw:r}){var D,R,N,M;const a=$e.getEvents().events;if(!(a!=null&&a.length))return;let o;tA.register("tmx-tm","mouseover",Pat),tA.register("tmx-tm","mouseout",Eat);let s,l,u,c,d,p,f,h,m;const g=()=>{var A,_,k,B;c=(A=$e.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t}))==null?void 0:A.eventData,d=(_=c==null?void 0:c.eventInfo)==null?void 0:_.eventType,f=(k=c==null?void 0:c.drawsData)==null?void 0:k.find(F=>F.drawId===e),u=(f==null?void 0:f.structures)||[],i=i||((B=u==null?void 0:u[0])==null?void 0:B.structureId),p=u.find(F=>F.structureId===i),o=$e.isAdHoc({structure:p}),{roundMatchUps:l,stage:m}=Wt.makeDeepCopy(p||{}),h=Object.values(l||{}).flat(),o&&h.sort(aot)};xx(),g();const v=({refresh:A,view:_}={})=>{const k=A||s;Zx(),_?Yn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:_}):R1({eventId:t,drawId:e,structureId:i,redraw:k,roundsView:_})},y=(h==null?void 0:h.length)===1&&c.eventInfo.eventType===PJ,b=zat({eventData:c,callback:v,drawId:e}),I=(R=(D=c.eventInfo)==null?void 0:D.display)==null?void 0:R.compositionName,T=VN[I]||ii.composition||VN[d===oot&&"National"||d===PJ&&"Basic"||"National"];T.configuration.scaleAttributes&&(T.configuration.scaleAttributes=ii.scales[ii.activeScale]),ii.composition||(T.configuration.genderColor=!0,T.configuration.showAddress=void 0,T.configuration.allDrawPositions=!0,T.configuration.drawPositions=!0),T.configuration.roundHeader=!0;const w=document.getElementById(Ud);r&&Oa(w);const S=()=>{var A,_;if(!y){for(const k of Object.keys((p==null?void 0:p.roundMatchUps)??{}))p.roundMatchUps[k]=(A=l==null?void 0:l[k])==null?void 0:A.filter(({sides:B})=>(B==null?void 0:B.some(({participant:x})=>x==null?void 0:x.participantName.toLowerCase().includes(s)))||!s);if(h.length)if(n===mw)zTe({matchUps:h,eventData:c});else if(n===hw)HTe({eventId:t,drawId:e,structureId:i});else{const k=F5e({content:L5e({context:{drawId:e,structureId:i},searchActive:s,matchUps:h,eventHandlers:b,composition:T,structure:p}),theme:T.theme}),B=x=>{var $;return($=x==null?void 0:x.classList)!=null&&$.contains("tmx-p")?x:Jo(x,"tmx-p")},F=w.firstChild;F?rot(F,k,{addChild:function(x,$){var j,V,H,z,q,W,Y;if($.classList){const Z=x.firstChild,X=$.getAttribute("id"),Q=![null,"undefined",void 0].includes(X),ce=(V=(j=x.firstChild)==null?void 0:j.getAttribute)==null?void 0:V.call(j,"id"),J=![null,"undefined",void 0].includes(ce);try{if(!Q&&!J){ii.renderLog&&console.log("condition 0");const ee=(H=B(Z))==null?void 0:H.nextSibling;ee!=null&&ee.getAttribute("id")&&((z=B(Z))!=null&&z.getAttribute("id"))&&ee.parentElement.removeChild(ee)}else Q&&J&&X&&ce&&X!==ce?(ii.renderLog&&console.log("condition 1"),x.removeChild(x.firstChild)):(q=$.classList)!=null&&q.contains("tmx-p")&&!J?(ii.renderLog&&console.log("condition 2"),x.removeChild(x.firstChild)):(Y=(W=x.firstChild)==null?void 0:W.classList)!=null&&Y.contains("tmx-p")&&x.firstChild.getAttribute("id")!=="undefined"&&$.getAttribute("id")==="undefined"?(ii.renderLog&&console.log("condition 3"),x.removeChild(x.firstChild)):!Q&&J?ii.renderLog&&console.log("condition 4"):console.log({incomingId:Q,existingId:J,incomingIdValue:X,existingIdValue:ce})}catch(ee){console.log({err:ee})}}x.appendChild($)}}):w.appendChild(k)}else if(m===QD)Fat({drawData:f,drawId:e,eventId:t});else if(o)Lat({structure:p,drawId:e,callback:v});else{const k=(_=u==null?void 0:u[0])==null?void 0:_.structureId;return R1({eventId:t,drawId:e,structureId:k,redraw:!0})}}};T8({updateDisplay:()=>{g(),S()},drawId:e,structure:p,existingView:n,callback:v});const P=document.getElementById(eP),E=A=>{A&&g();const _=F=>{var x;return(x=F.searchText)==null?void 0:x.includes(s)},B=FTe({updateParticipantFilter:F=>{F||Object.values(ze.tables).filter(Boolean).forEach(x=>x.clearFilter()),s=F==null?void 0:F.toLowerCase(),F&&Object.values(ze.tables).filter(Boolean).forEach(x=>x.addFilter(_)),Oa(w),S()},updateControlBar:E,structureId:i,eventData:c,drawData:f,matchUps:h,eventId:t,drawId:e});no({target:P,items:B})};if(!f){console.log("no draw data",{eventData:c,drawData:f});return}if(i=i||((M=(N=f.structures)==null?void 0:N[0])==null?void 0:M.structureId),!i){console.log("structure not found");return}if(y){const A=Kx({matchUp:h[0],participantFilter:s});A&&w.appendChild(A)}else S();E()}function sot(t,e,i,n){const r=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${r})</span>`}const{TEAM:lot}=Ra,uot=t=>(e,i)=>{const r=i.getRow().getData(),{matchUpId:a,readyToScore:o,matchUpType:s,drawId:l,eventName:u}=r.matchUp;s===lot?Wx({title:u,matchUpId:a,drawId:l,onClose:()=>t()}):(o||Mm.checkScoreHasValue(r.matchUp))&&qx({matchUpId:a,callback:()=>{t()}})};function cot({data:t,replaceTableData:e}){const i=(s,l)=>{var f,h;const c=l.getRow().getData(),{courtName:d,scheduledDate:p}=c;if(d&&p){const m=(h=(f=$e.getTournament())==null?void 0:f.tournamentRecord)==null?void 0:h.tournamentId,g=`/${Ia}/${m}/${ry}/${p}`;ze.router.navigate(g)}},n=()=>e(),r=t.some(s=>s.courtName),a=(s,l)=>w1(s,l,n),o=s=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const u=({event:d,...p})=>{w1(d,s,n,p)};return s.getValue().participantName&&xb(u)(s,l)};return[{cellClick:(s,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Et,minWidth:50,width:50},{headerMenu:vf({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Ct,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:o,cellClick:a,sorter:e0,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:o,cellClick:a,sorter:e0,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:uot(e),formatter:c8,sorter:yTe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:SSe,formatter:TSe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Ct,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(s,l)=>d8({pointerEvent:s,...l.getData()}),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,widthGrow:0,width:50}]}const{TEAM:dot}=ko,EJ=t=>{var A,_,k,B,F;const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:u,sides:c,...d}=t,{scheduledDate:p,scheduleTime:f,courtName:h}=s||{},m=x=>{var $;return(($=x.person)==null?void 0:$.standardFamilyName)||x.participantName},g=(e==null?void 0:e.map(x=>({participantName:x.map(m).filter(Boolean).join(" or ")})))||[],v=((A=c==null?void 0:c[0])==null?void 0:A.participant)||g.shift(),y=((_=c==null?void 0:c[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(B=y==null?void 0:y.person)==null?void 0:B.sex,participant:y},T=c.flatMap(({participant:x})=>{var $;return($=x==null?void 0:x.individualParticipantIds)!=null&&$.length?x.individualParticipantIds:x==null?void 0:x.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),P=(F=d.score)==null?void 0:F.scoreStringSide1,E=c.flatMap(x=>{var j,V,H;const $=(j=x.participant)==null?void 0:j.person;return $?[$.standardGivenName,$.standardFamilyName]:(H=(V=x.participant)==null?void 0:V.individualParticipants)==null?void 0:H.map(({person:z})=>[z.standardGivenName,z.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),D=WIe([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),R=t.collectionId?dot:n,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,M={score:P,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:U,scheduleTime:f,matchUpType:n,scoreDetail:M,winningSide:w,roundNumber:r,searchText:D,courtName:h,eventType:R,matchUpId:a,roundName:o,complete:S,eventId:l,matchUp:t,drawId:u,side1:b,side2:I,score:P}},{CONTAINER:pot}=rr;async function zTe({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let a,o,s,l;const u=()=>{var I,T;const y=$e.getEventData({eventId:t}).eventData,b=(I=y==null?void 0:y.drawsData)==null?void 0:I.find(w=>w.drawId===e);return o=(T=b==null?void 0:b.structures)==null?void 0:T.find(w=>w.structureId===i),l=(o==null?void 0:o.structureType)===pot,($e.allTournamentMatchUps({matchUpFilters:{drawIds:[e],structureIds:[i]},participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:w})=>w!=="BYE").filter(({sides:w})=>!s||w.find(S=>{var U,P;return(P=(U=S.participant)==null?void 0:U.participantName)==null?void 0:P.toLowerCase().includes(s==null?void 0:s.toLowerCase())}))};n||(n=await u()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const c=()=>n.map(EJ),d=()=>u().map(EJ),p=y=>{y!=null&&y.participantFilter&&(s=y.participantFilter),a.replaceData(d())},f=c(),h=cot({data:f,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{mf({anchorId:Ud});const b=document.getElementById(Ud);a=new da(b,{groupHeader:[sot,I=>I],headerSortElement:gf(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:h,data:y})})(f),T8({structure:o,drawId:e,existingView:mw,callback:({refresh:y,view:b}={})=>{Zx(),b?Yn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):R1({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),w8({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function qC({eventId:t,renderDraw:e}={}){const i=document.getElementById(Oue),n=document.getElementById(Aue),r=document.getElementById(Ud),a=document.getElementById(xue);a&&(a.style.display=t||e?"":lt),i&&(i.style.display=t&&!e?"":lt),n&&(n.style.display=t||e?lt:""),r&&(r.style.display=e?"":lt)}function fot({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=$e.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const CJ={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},qTe=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href,vv={"o-route":H0,"p-route":Rp,"e-route":Yc,"m-route":I3,"s-route":ry,"v-route":w3},RJ={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function hot(){var s,l,u,c;const e=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <li id='o-route' class="features-item tournaments">
        <i class="nav-icon fa-solid fa-trophy" style="font-size: larger"> <span class="status"></span> </i>
          <span class="features-item-text">Overview</span>
      </li>
      <li id='p-route' class="features-item participants">
        <i class="nav-icon fa-solid fa-user-group" style="font-size: larger"></i>
        <span class="features-item-text">Participants</span>
      </li>
      <li id='e-route' class="features-item events">
        <i class="nav-icon fa-solid fa-diagram-project" style='font-size: larger'></i>
        <span class="features-item-text">Events</span>
      </li>
      <li id='m-route' class="features-item matches">
        <img src="${qTe}" class='nav-image' srcset=""/>
        <span class="features-item-text">Matches</span>
      </li>
      <li id='s-route' class="features-item schedule">
        <i class="nav-icon fa-solid fa-clock" style='font-size: larger'></i>
        <span class="features-item-text">Schedule</span>
      </li>
      <li id='v-route' class="features-item venues">
        <i class="nav-icon fa-solid fa-location-dot" style='font-size: larger'></i>
        <span class="features-item-text">Venues</span>
      </li>
    </ul>
  </div>
`,i=document.getElementById("sideNav");i.innerHTML=e;const n=Object.keys(vv),r=(c=(u=(l=(s=ze.router)==null?void 0:s.current)==null?void 0:l[0])==null?void 0:u.data)==null?void 0:c.selectedTab,a=d=>document.querySelector(".side-bar").classList.contains("collapse")?d:"",o=document.getElementById("o-route");o.onclick=()=>{console.log("tournament information")},Sh(o,{dynContent:()=>a(RJ["o-route"]),onShow:d=>!!d.props.content,plugins:[CJ],placement:mt,arrow:!1}),n.forEach(d=>{const p=document.getElementById(d);Sh(p,{dynContent:()=>a(RJ[d]),onShow:f=>!!f.props.content,plugins:[CJ],placement:mt,arrow:!1}),(r===vv[d]||!r&&vv[d]===Rp)&&p.classList.add("active"),p.onclick=()=>{var m,g;document.querySelectorAll(".features-item").forEach(v=>v.classList.remove("active")),p.classList.add("active");const f=(g=(m=$e.getTournament())==null?void 0:m.tournamentRecord)==null?void 0:g.tournamentId,h=`/${Ia}/${f}/${vv[d]}`;ze.router.navigate(h)}})}function WTe(t){document.querySelectorAll(".features-item").forEach(i=>i.classList.remove("active")),Object.keys(vv).forEach(i=>{const n=document.getElementById(i);(t===vv[i]||!t&&vv[i]===Rp)&&n.classList.add("active")})}const KTe=t=>({drawDefinition:e,scaleValues:i})=>{var f,h,m,g,v,y,b;const{drawId:n,drawName:r,drawType:a,entries:o,matchUpFormat:s,tieFormat:l}=e,u=$e.getPublishState({drawId:n}).publishState,c=(f=u==null?void 0:u.status)==null?void 0:f.published,d=(h=o==null?void 0:o.filter(({entryStatus:I})=>I!=="WITHDRAWN"))==null?void 0:h.length,p=(m=$e.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds)==null?void 0:m.filter(Boolean);return{entries:(p==null?void 0:p.length)??d??0,matchUpFormat:s,tieFormat:l,utrAvg:(v=(g=i==null?void 0:i.ratingsStats)==null?void 0:g.UTR)==null?void 0:v.avg,wtnAvg:(b=(y=i==null?void 0:i.ratingsStats)==null?void 0:y.WTN)==null?void 0:b.avg,published:c,drawName:r,drawType:a,eventId:t,drawId:n}},{MAIN:MJ}=rr;function YTe({event:t,scaleValues:e}){var m,g,v;const{drawDefinitions:i=[],eventName:n,entries:r,eventId:a}=t,o=$e.allEventMatchUps({inContext:!0,eventId:a}).matchUps,s=bk.getPublishState({event:t}).publishState,l=i.length,u=((m=r.filter(({entryStage:y=MJ,entryStatus:b})=>hA(MJ).includes(`${y}.${b}`)))==null?void 0:m.length)||0,c=(o==null?void 0:o.length)||0,d=((g=o==null?void 0:o.filter(({winningSide:y,schedule:b})=>!y&&(b==null?void 0:b.scheduledTime)))==null?void 0:g.length)||0,p=((v=o.filter(({winningSide:y})=>y))==null?void 0:v.length)||0,f=i.map(y=>{var b;return KTe(a)({drawDefinition:y,scaleValues:(b=e==null?void 0:e.draws)==null?void 0:b[y.drawId]})}),h=[n].concat(i.map(({drawName:y})=>y||"")).join(" ").toLowerCase();return{published:s==null?void 0:s.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:c,entriesCount:u,drawsCount:l,searchText:h,drawDefs:f,eventId:a,event:t}}function ZTe({eventRow:t,drawsTable:e,drawIds:i}){e.deleteRow(i);const n=t==null?void 0:t.getData();if(n){const r=$e.allEventMatchUps({eventId:n.eventId,inContext:!1}).matchUps;n.drawDefs=n.drawDefs.filter(a=>!i.includes(a.drawId)),n.matchUpsCount=(r==null?void 0:r.length)||0,n.drawsCount-=i.length}}const XTe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.published?[n.drawId]:void 0,a=n.published?void 0:[n.drawId],s=[{method:xwe,params:{eventId:n.eventId,drawIdsToAdd:a,drawIdsToRemove:r,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}];yt({methods:s,callback:u=>{var c;if(u!=null&&u.success){i.getRow().update({published:!n.published});const d=t.getData().eventId,p=$e.getPublishState({eventId:d}).publishState,f=(c=p==null?void 0:p.status)==null?void 0:c.published;t.update({published:f})}else Mt({message:u.error.message,intent:"is-danger"})}})},JTe=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function QTe(t){var R,N;const{eventId:e,drawId:i,callback:n}=t,r=(R=$e.findExtension({discover:!0,name:"display",drawId:i,eventId:e}).extension)==null?void 0:R.value,a=["Wimbledon","French","ITF"],o="saveDisplaySettings",s={compositionName:(r==null?void 0:r.compositionName)??((N=ii.composition)==null?void 0:N.compositionName)??"Australian",configuration:(r==null?void 0:r.configuration)??{},composition:void 0,inputs:void 0},l=Wt.dateTime.extractDate(new Date().toISOString()),u="drawId",d=[{onlineResources:[{link:"https://www.google.com",label:"Google"}],venueName:"Club Courts",venueAbbreviation:"CC",startTime:"08:00",endTime:"20:00",courtsCount:6,venueId:"venueId"}],p=[{eventName:"WTN 14-19 SINGLES",category:{ratingType:"WTN",ratingMin:14,ratingMax:19.99},drawId:u,generate:!0,drawSize:4}],f=[{scheduleDate:l,venues:[{rounds:[{drawId:u,winnerFinishingPositionRange:"1-2"}],venueId:d[0].venueId}]}],h={withScaleValues:!0},m=XD.generateTournamentRecord({scheduleCompletedMatchUps:!0,completeAllMatchUps:!0,participantsProfile:h,autoSchedule:!0,schedulingProfile:f,venueProfiles:d,drawProfiles:p,startDate:l}).tournamentRecord,v=_D.allTournamentMatchUps({tournamentRecord:m}).matchUps.find(M=>M.matchUpType==="SINGLES"),y=document.createElement("div");y.style.maxWidth="500px";const b=document.createElement("div");y.appendChild(b);const I=({compositionName:M,configuration:A})=>{Oa(b),s.composition=VN[M],s.composition.configuration.scheduleInfo=s.composition.configuration.showAddress=void 0,s.composition.configuration.flags=void 0,Object.assign(s.composition.configuration,A),s.composition.genderColor=!0,s.composition.compositionName=M;const _=GIe({isLucky:!0,composition:s.composition,matchUp:v});b.appendChild(_)};I(s);const T=Object.keys(VN).filter(M=>M!=="Night").map(M=>({selected:M===s.compositionName,label:M,value:M})),w=[{label:"None",value:"NONE",selected:!0},{label:"Address",value:"ADDRESS"},{label:"Team",value:"TEAM"}],S=()=>{s.compositionName=s.inputs.composition.value,s.configuration.scheduleInfo=!a.includes(s.compositionName)&&s.inputs.showSchedule.checked,s.configuration.particiapntDetail=s.inputs.detail.value,I(s)},U=[{options:T,label:"Composition",field:"composition",onChange:S},{controlVisible:!a.includes(s.compositionName),checked:s.configuration.scheduleInfo,controlId:"scheduleToggle",label:"Show Schedule",field:"showSchedule",id:"showSchedule",checkbox:!0,onChange:S},{options:w,label:"Detail",field:"detail",onChange:S}],P=document.createElement("div");y.appendChild(P);const E=[{onChange:({e:M})=>{const A=!a.includes(M.target.value),_=document.getElementById("scheduleToggle");_.style.display=A?"block":lt},control:"composition"}];s.inputs=Wn(P,U,E),yn({title:"Edit display settings",buttons:[{label:"Cancel",intent:lt,close:!0},{label:"Save",id:o,intent:"is-info",close:!0,onClick:()=>{var F,x;const M=()=>{},_={value:{...(x=(F=$e.findExtension({name:Xv.DISPLAY,discover:!0,eventId:e,drawId:i}))==null?void 0:F.extension)==null?void 0:x.value,compositionName:s.composition.compositionName,configuration:s.configuration},name:Xv.DISPLAY};yt({methods:[{method:i?J6e:i8e,params:{eventId:e,drawId:i,extension:_}}],callback:M}),rt(n)&&n(s.composition),ii.composition=s.composition}}],content:y})}const mot=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(f=>f.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow(),o=a==null?void 0:a.getData(),{published:s,drawId:l,eventId:u}=o;Ps({items:[{onClick:()=>QTe({drawId:o.drawId}),text:"Display settings"},{text:s?"Unpublish":"Publish",onClick:()=>{XTe(t)(e,i)}},{onClick:()=>{yt({methods:[{params:{eventId:u,drawId:l,force:!1},method:L6}],callback:m=>{var g;m.success||(g=m.error)!=null&&g.message&&Mt({message:m.error.message,intent:"is-danger"}),ZTe({eventRow:t,drawsTable:i.getTable(),drawIds:[l]})}})},text:"Delete"},{text:"Edit"}],target:r||e.target,config:{placement:tf}})};function got(t,e){const i=(a,o)=>{const{eventId:s,drawId:l}=o.getRow().getData();Yn({eventId:s,drawId:l,renderDraw:!0})},n=t.find(a=>a.utrAvg),r=t.find(a=>a.wtnAvg);return[{cellClick:(a,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Ct,width:5},{headerMenu:vf({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:Et,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:XTe(e),formatter:JTe,headerSort:!1,field:"published",width:55},{title:"Draw Name",field:ay,cellClick:i},{title:"Draw Type",field:Xc,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:OU,width:80},{visible:!!n,field:"utrAvg",title:oy,width:80},{cellClick:mot(e),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt}]}const vot=t=>e=>{const i=document.createElement("div"),n=document.createElement("div");n.className="tableControl",n.style.marginBottom="1em";const r=e.getData().drawDefs;i.appendChild(n);const a=document.createElement("div");a.style.backgroundColor="white";const o="1px solid #333";a.style.border=o,a.style.width="99%",i.style.borderBotom=o,i.style.boxSizing="border-box",i.style.borderTop=o,i.style.paddingLeft="10px",i.className=Ek,i.style.display=lt,i.appendChild(a),e.getElement().appendChild(i);const s=got(r,e),l=new da(a,{headerSortElement:gf(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:s,data:r});l.on("scrollVertical",Pu);const u=e.getData().event,c=u.eventId;t(c,l);const d=()=>{const g=l.getSelectedData().map(({drawId:b})=>b);l.deselectRow();const v=g.map(b=>({params:{eventId:c,drawId:b,force:!1},method:L6}));yt({methods:v,callback:b=>{var I;if(!b.success){(I=b.error)!=null&&I.message&&Mt({message:b.error.message,intent:"is-danger"});return}ZTe({eventRow:e,drawsTable:l,drawIds:g})}})},p=m=>{var g;if(m.success){l==null||l.addRow(KTe(c)({drawDefinition:m.drawDefinition}));const v=e==null?void 0:e.getData();if(a.style.display="",v)if(!v.matchUpsCount)Yn({eventId:c,drawId:(g=m.drawDefinition)==null?void 0:g.drawId,renderDraw:!0});else{const y=$e.allDrawMatchUps({drawId:m.drawDefinition.drawId,inContext:!1,eventId:c}).matchUps;v.matchUpsCount+=(y==null?void 0:y.length)||0,v.drawsCount+=1}}},f=({success:m,eventUpdates:g})=>{if(m){const v=e==null?void 0:e.getData();Object.assign(v.event,g),e.update(v)}};no({table:l,target:n,items:[{onClick:d,label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onClick:()=>Yn({eventId:c}),label:"View entries",intent:"is-info",location:Ct},{onClick:()=>ETe({eventId:c}),id:"editAvoidances",label:"Avoidances",location:Ct},{onClick:()=>Bx({event:u,callback:f}),label:"Edit event",location:mt},{onClick:()=>n0({eventId:c,callback:p}),intent:"is-primary",label:"Add draw",location:mt}]})},eUe=t=>(e,i)=>{const n=i.getRow().getData(),r=n.eventId,a=!n.published,o=n.published?E8e:xwe;t.get(r).getRows().forEach(c=>c.update({published:a})),yt({methods:[{method:o,params:{eventId:r,eventDataParams:{participantsProfile:{withScaleValues:!0},pressureRating:!0,refreshResults:!0}}}],callback:c=>{c!=null&&c.success?i.getRow().update({published:!n.published}):Mt({message:c.error.message,intent:"is-danger"})}})},yot=t=>(e,i)=>{const n=Array.from(document.querySelectorAll(".tippy-content"));if(n.length){n.forEach(p=>p.remove());return}const r=e.target.getElementsByClassName("fa-ellipsis-vertical")[0],a=i.getRow().getData(),o=i.getRow(),s=o==null?void 0:o.getData(),l=s==null?void 0:s.published,u=({success:p,eventUpdates:f})=>{p&&(Object.assign(s.event,f),o.update(s))};Ps({items:[{onClick:()=>QTe({eventId:a.eventId}),text:"Display settings"},{text:l?"Unpublish":"Publish",onClick:()=>{eUe(t)(e,i)}},{onClick:()=>console.log("Delete",a),text:"Delete"},{onClick:()=>Bx({event:a.event,callback:u}),text:"Edit"}],target:r||e.target,config:{placement:tf}})};function bot(t){const e=(n,r)=>{n.stopPropagation();const a=r.getRow().getData().eventId;Yn({eventId:a})},i=(n,r)=>{const a=r.getRow().getData();if(a.drawDefs.length===1){const o=a.eventId,s=a.drawDefs[0].drawId;Yn({eventId:o,drawId:s,renderDraw:!0})}else qv(n,r)};return[{cellClick:(n,r)=>r.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:Ct,width:5},{headerMenu:vf({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{title:'<i class="fa-solid fa-eye"></i>',cellClick:eUe(t),formatter:JTe,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:i,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:qv,headerHozAlign:Et,field:"drawsCount",hozAlign:Et,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:Et,field:"entriesCount",cellClick:e,hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:Et,field:"matchUpsCount",hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:Et,hozAlign:Et,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:Et,hozAlign:Et,headerSort:!0,visible:!0,width:50},{cellClick:qv,formatter:l8,responsive:!1,headerSort:!1,hozAlign:mt,field:"isOpen",width:20},{cellClick:yot(t),formatter:Kh,responsive:!1,headerSort:!1,hozAlign:mt,width:20}]}function Iot(){let t;const e=new Map,i=(s,l)=>{e.has(s)||e.set(s,l)},n=()=>{var l;const s=$e.getEvents({withScaleValues:!0});return(l=s==null?void 0:s.events)==null?void 0:l.map(u=>{var c;return YTe({event:u,scaleValues:(c=s.eventScaleValues)==null?void 0:c[u.eventId]})})},r=()=>{t.replaceData(n())},a=bot(e);return(s=>{var c;mf({anchorId:AU});const l=document.getElementById(AU),u=(c=Jo(l,"section"))==null?void 0:c.querySelector(".tabHeader");u!=null&&u.innerHTML&&(u.innerHTML=`Events (${s.length})`),t=new da(l,{columnDefaults:{},headerSortElement:gf(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),responsiveLayoutCollapseStartOpen:!1,rowFormatter:vot(i),height:window.innerHeight*.8,responsiveLayout:"collapse",placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:a,data:s}),t.on("scrollVertical",Pu),t.on("dataChanged",d=>{u&&(u.innerHTML=`Events (${d.length})`)}),t.on("dataFiltered",(d,p)=>{u&&(u.innerHTML=`Events (${p.length})`)})})(n()),{table:t,replaceTableData:r}}function wot(){var d,p,f,h;const t=(d=$e.getPublishState().publishState)==null?void 0:d.tournament,e=(p=t==null?void 0:t.status)==null?void 0:p.published,{table:i}=Iot(),n=m=>{if(m!=null&&m.event){const g=YTe({event:m.event});i==null||i.updateOrAddData([g])}},r=_b(i),a=()=>{const m=i==null?void 0:i.getSelectedData().map(({eventId:v})=>v);yt({methods:[{method:u8e,params:{eventIds:m}}],callback:v=>v.success&&(i==null?void 0:i.deleteRow(m))})},o=m=>m?"Unpublish":"Publish",s=m=>`${o(m)} OOP`,l=m=>{var g,v;if(m!=null&&m.success){const y=(g=$e.getPublishState().publishState)==null?void 0:g.tournament,b=document.getElementById("oopButton");b.innerText=s((v=y==null?void 0:y.orderOfPlay)==null?void 0:v.published),b.classList.toggle("is-primary")}},u=[{onClick:a,label:"Delete selected",intent:"is-danger",stateChange:!0,location:gr},{onKeyDown:m=>m.keyCode===8&&m.target.value.length===1&&r(""),onChange:m=>r(m.target.value),onKeyUp:m=>r(m.target.value),clearSearch:()=>r(""),placeholder:"Search events",location:Ct,search:!0},{onClick:()=>{var m;return Sot((m=t==null?void 0:t.orderOfPlay)==null?void 0:m.published,l)},hide:!e,label:s((f=t==null?void 0:t.orderOfPlay)==null?void 0:f.published),intent:(h=t==null?void 0:t.orderOfPlay)!=null&&h.published?"is-primary":"",id:"oopButton",location:mt},{onClick:()=>Bx({callback:n}),label:"Add event",location:mt}],c=document.getElementById(O3);no({table:i,target:c,items:u})}function Sot(t,e){yt({methods:[{method:t?"unPublishOrderOfPlay":"publishOrderOfPlay"}],callback:e})}function Tot(t){var o;const{eventId:e,drawId:i,structureId:n,renderDraw:r,roundsView:a="roundsColumns"}=t;if(WTe(Yc),xx(),Zx(),e||i){const s=document.getElementById(AU),l=(o=Jo(s,"section"))==null?void 0:o.querySelector(".tabHeader");i&&r?fot({eventId:e,drawId:i,headerElement:l}).success?(a===mw?zTe({eventId:e,drawId:i,structureId:n,roundsView:a}):a===hw?HTe({eventId:e,drawId:i,structureId:n,roundsView:a}):R1({eventId:e,drawId:i,structureId:n,redraw:!0,roundsView:a}),qC({renderDraw:r})):(pJ({eventId:e,drawId:i}),qC({eventId:e})):(pJ({eventId:e,drawId:i,headerElement:l}),qC({eventId:e}))}else wot(),qC({eventId:e})}function Uot({callback:t}){var d,p;let e,i=!1;const n=$e.getTournament().tournamentRecord,r=(p=(d=n==null?void 0:n.onlineResources)==null?void 0:d.find(({name:f,resourceType:h})=>f==="tournamentImage"&&h==="URL"))==null?void 0:p.identifier,a=f=>{const h=document.getElementById("createButton"),m=f?!1:!i&&e.tournamentImage.value;h.disabled=m},o=()=>{i=!1;const f=document.getElementById("tournamentImagePreview");f.onload=()=>(i=!0)&&a(),f.src=e.tournamentImage.value},s=f=>e=Wn(f,[{onKeyUp:h=>h.key==="Enter"&&o(),onChange:()=>e.tournamentImage.value?o():a(!0),label:"Web address of online image",value:r,placeholder:"Image URL",field:"tournamentImage",autocomplete:"off"}]),l=document.createElement("div");s(l);const u=document.createElement("img");u.id="tournamentImagePreview",u.onload=()=>i=!0,r&&(u.src=r),u.style.width="100%",l.appendChild(u),yn({title:"Create provider",content:l,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{const f=e.tournamentImage.value;yt({methods:[{method:n8e,params:{onlineResource:{resourceSubType:"IMAGE",name:"tournamentImage",resourceType:"URL",identifier:f}}}],callback:g=>{g.success&&(Mt({message:"Tournament image updated",intent:"is-success"}),rt(t)&&t(f))}})},intent:"is-primary",id:"createButton",disabled:!0,label:"Save",close:!0}]})}var tUe={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(t,e){(function(n,r){t.exports=r()})(typeof self<"u"?self:eq,function(){return function(i){var n={};function r(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return i[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=i,r.c=n,r.d=function(a,o,s){r.o(a,o)||Object.defineProperty(a,o,{configurable:!1,enumerable:!0,get:s})},r.n=function(a){var o=a&&a.__esModule?function(){return a.default}:function(){return a};return r.d(o,"a",o),o},r.o=function(a,o){return Object.prototype.hasOwnProperty.call(a,o)},r.p="",r(r.s=109)}([function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(17),o=r(18),s=r(19),l=r(45),u=r(46),c=r(47),d=r(48),p=r(49),f=r(12),h=r(32),m=r(33),g=r(31),v=r(1),y={Scope:v.Scope,create:v.create,find:v.find,query:v.query,register:v.register,Container:a.default,Format:o.default,Leaf:s.default,Embed:d.default,Scroll:l.default,Block:c.default,Inline:u.default,Text:p.default,Attributor:{Attribute:f.default,Class:h.default,Style:m.default,Store:g.default}};n.default=y},function(i,n,r){var a=this&&this.__extends||function(){var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var b in y)y.hasOwnProperty(b)&&(v[b]=y[b])};return function(v,y){g(v,y);function b(){this.constructor=v}v.prototype=y===null?Object.create(y):(b.prototype=y.prototype,new b)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=function(g){a(v,g);function v(y){var b=this;return y="[Parchment] "+y,b=g.call(this,y)||this,b.message=y,b.name=b.constructor.name,b}return v}(Error);n.ParchmentError=o;var s={},l={},u={},c={};n.DATA_KEY="__blot";var d;(function(g){g[g.TYPE=3]="TYPE",g[g.LEVEL=12]="LEVEL",g[g.ATTRIBUTE=13]="ATTRIBUTE",g[g.BLOT=14]="BLOT",g[g.INLINE=7]="INLINE",g[g.BLOCK=11]="BLOCK",g[g.BLOCK_BLOT=10]="BLOCK_BLOT",g[g.INLINE_BLOT=6]="INLINE_BLOT",g[g.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",g[g.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",g[g.ANY=15]="ANY"})(d=n.Scope||(n.Scope={}));function p(g,v){var y=h(g);if(y==null)throw new o("Unable to create "+g+" blot");var b=y,I=g instanceof Node||g.nodeType===Node.TEXT_NODE?g:b.create(v);return new b(I,v)}n.create=p;function f(g,v){return v===void 0&&(v=!1),g==null?null:g[n.DATA_KEY]!=null?g[n.DATA_KEY].blot:v?f(g.parentNode,v):null}n.find=f;function h(g,v){v===void 0&&(v=d.ANY);var y;if(typeof g=="string")y=c[g]||s[g];else if(g instanceof Text||g.nodeType===Node.TEXT_NODE)y=c.text;else if(typeof g=="number")g&d.LEVEL&d.BLOCK?y=c.block:g&d.LEVEL&d.INLINE&&(y=c.inline);else if(g instanceof HTMLElement){var b=(g.getAttribute("class")||"").split(/\s+/);for(var I in b)if(y=l[b[I]],y)break;y=y||u[g.tagName]}return y==null?null:v&d.LEVEL&y.scope&&v&d.TYPE&y.scope?y:null}n.query=h;function m(){for(var g=[],v=0;v<arguments.length;v++)g[v]=arguments[v];if(g.length>1)return g.map(function(I){return m(I)});var y=g[0];if(typeof y.blotName!="string"&&typeof y.attrName!="string")throw new o("Invalid definition");if(y.blotName==="abstract")throw new o("Cannot register abstract class");if(c[y.blotName||y.attrName]=y,typeof y.keyName=="string")s[y.keyName]=y;else if(y.className!=null&&(l[y.className]=y),y.tagName!=null){Array.isArray(y.tagName)?y.tagName=y.tagName.map(function(I){return I.toUpperCase()}):y.tagName=y.tagName.toUpperCase();var b=Array.isArray(y.tagName)?y.tagName:[y.tagName];b.forEach(function(I){(u[I]==null||y.className==null)&&(u[I]=y)})}return y}n.register=m},function(i,n,r){var a=r(51),o=r(11),s=r(3),l=r(20),u="\0",c=function(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]};c.prototype.insert=function(d,p){var f={};return d.length===0?this:(f.insert=d,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(f.attributes=p),this.push(f))},c.prototype.delete=function(d){return d<=0?this:this.push({delete:d})},c.prototype.retain=function(d,p){if(d<=0)return this;var f={retain:d};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(f.attributes=p),this.push(f)},c.prototype.push=function(d){var p=this.ops.length,f=this.ops[p-1];if(d=s(!0,{},d),typeof f=="object"){if(typeof d.delete=="number"&&typeof f.delete=="number")return this.ops[p-1]={delete:f.delete+d.delete},this;if(typeof f.delete=="number"&&d.insert!=null&&(p-=1,f=this.ops[p-1],typeof f!="object"))return this.ops.unshift(d),this;if(o(d.attributes,f.attributes)){if(typeof d.insert=="string"&&typeof f.insert=="string")return this.ops[p-1]={insert:f.insert+d.insert},typeof d.attributes=="object"&&(this.ops[p-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof f.retain=="number")return this.ops[p-1]={retain:f.retain+d.retain},typeof d.attributes=="object"&&(this.ops[p-1].attributes=d.attributes),this}}return p===this.ops.length?this.ops.push(d):this.ops.splice(p,0,d),this},c.prototype.chop=function(){var d=this.ops[this.ops.length-1];return d&&d.retain&&!d.attributes&&this.ops.pop(),this},c.prototype.filter=function(d){return this.ops.filter(d)},c.prototype.forEach=function(d){this.ops.forEach(d)},c.prototype.map=function(d){return this.ops.map(d)},c.prototype.partition=function(d){var p=[],f=[];return this.forEach(function(h){var m=d(h)?p:f;m.push(h)}),[p,f]},c.prototype.reduce=function(d,p){return this.ops.reduce(d,p)},c.prototype.changeLength=function(){return this.reduce(function(d,p){return p.insert?d+l.length(p):p.delete?d-p.delete:d},0)},c.prototype.length=function(){return this.reduce(function(d,p){return d+l.length(p)},0)},c.prototype.slice=function(d,p){d=d||0,typeof p!="number"&&(p=1/0);for(var f=[],h=l.iterator(this.ops),m=0;m<p&&h.hasNext();){var g;m<d?g=h.next(d-m):(g=h.next(p-m),f.push(g)),m+=l.length(g)}return new c(f)},c.prototype.compose=function(d){var p=l.iterator(this.ops),f=l.iterator(d.ops),h=[],m=f.peek();if(m!=null&&typeof m.retain=="number"&&m.attributes==null){for(var g=m.retain;p.peekType()==="insert"&&p.peekLength()<=g;)g-=p.peekLength(),h.push(p.next());m.retain-g>0&&f.next(m.retain-g)}for(var v=new c(h);p.hasNext()||f.hasNext();)if(f.peekType()==="insert")v.push(f.next());else if(p.peekType()==="delete")v.push(p.next());else{var y=Math.min(p.peekLength(),f.peekLength()),b=p.next(y),I=f.next(y);if(typeof I.retain=="number"){var T={};typeof b.retain=="number"?T.retain=y:T.insert=b.insert;var w=l.attributes.compose(b.attributes,I.attributes,typeof b.retain=="number");if(w&&(T.attributes=w),v.push(T),!f.hasNext()&&o(v.ops[v.ops.length-1],T)){var S=new c(p.rest());return v.concat(S).chop()}}else typeof I.delete=="number"&&typeof b.retain=="number"&&v.push(I)}return v.chop()},c.prototype.concat=function(d){var p=new c(this.ops.slice());return d.ops.length>0&&(p.push(d.ops[0]),p.ops=p.ops.concat(d.ops.slice(1))),p},c.prototype.diff=function(d,p){if(this.ops===d.ops)return new c;var f=[this,d].map(function(y){return y.map(function(b){if(b.insert!=null)return typeof b.insert=="string"?b.insert:u;var I=y===d?"on":"with";throw new Error("diff() called "+I+" non-document")}).join("")}),h=new c,m=a(f[0],f[1],p),g=l.iterator(this.ops),v=l.iterator(d.ops);return m.forEach(function(y){for(var b=y[1].length;b>0;){var I=0;switch(y[0]){case a.INSERT:I=Math.min(v.peekLength(),b),h.push(v.next(I));break;case a.DELETE:I=Math.min(b,g.peekLength()),g.next(I),h.delete(I);break;case a.EQUAL:I=Math.min(g.peekLength(),v.peekLength(),b);var T=g.next(I),w=v.next(I);o(T.insert,w.insert)?h.retain(I,l.attributes.diff(T.attributes,w.attributes)):h.push(w).delete(I);break}b-=I}}),h.chop()},c.prototype.eachLine=function(d,p){p=p||`
`;for(var f=l.iterator(this.ops),h=new c,m=0;f.hasNext();){if(f.peekType()!=="insert")return;var g=f.peek(),v=l.length(g)-f.peekLength(),y=typeof g.insert=="string"?g.insert.indexOf(p,v)-v:-1;if(y<0)h.push(f.next());else if(y>0)h.push(f.next(y));else{if(d(h,f.next(1).attributes||{},m)===!1)return;m+=1,h=new c}}h.length()>0&&d(h,{},m)},c.prototype.transform=function(d,p){if(p=!!p,typeof d=="number")return this.transformPosition(d,p);for(var f=l.iterator(this.ops),h=l.iterator(d.ops),m=new c;f.hasNext()||h.hasNext();)if(f.peekType()==="insert"&&(p||h.peekType()!=="insert"))m.retain(l.length(f.next()));else if(h.peekType()==="insert")m.push(h.next());else{var g=Math.min(f.peekLength(),h.peekLength()),v=f.next(g),y=h.next(g);if(v.delete)continue;y.delete?m.push(y):m.retain(g,l.attributes.transform(v.attributes,y.attributes,p))}return m.chop()},c.prototype.transformPosition=function(d,p){p=!!p;for(var f=l.iterator(this.ops),h=0;f.hasNext()&&h<=d;){var m=f.peekLength(),g=f.peekType();if(f.next(),g==="delete"){d-=Math.min(m,d-h);continue}else g==="insert"&&(h<d||!p)&&(d+=m);h+=m}return d},i.exports=c},function(i,n){var r=Object.prototype.hasOwnProperty,a=Object.prototype.toString,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,l=function(f){return typeof Array.isArray=="function"?Array.isArray(f):a.call(f)==="[object Array]"},u=function(f){if(!f||a.call(f)!=="[object Object]")return!1;var h=r.call(f,"constructor"),m=f.constructor&&f.constructor.prototype&&r.call(f.constructor.prototype,"isPrototypeOf");if(f.constructor&&!h&&!m)return!1;var g;for(g in f);return typeof g>"u"||r.call(f,g)},c=function(f,h){o&&h.name==="__proto__"?o(f,h.name,{enumerable:!0,configurable:!0,value:h.newValue,writable:!0}):f[h.name]=h.newValue},d=function(f,h){if(h==="__proto__")if(r.call(f,h)){if(s)return s(f,h).value}else return;return f[h]};i.exports=function p(){var f,h,m,g,v,y,b=arguments[0],I=1,T=arguments.length,w=!1;for(typeof b=="boolean"&&(w=b,b=arguments[1]||{},I=2),(b==null||typeof b!="object"&&typeof b!="function")&&(b={});I<T;++I)if(f=arguments[I],f!=null)for(h in f)m=d(b,h),g=d(f,h),b!==g&&(w&&g&&(u(g)||(v=l(g)))?(v?(v=!1,y=m&&l(m)?m:[]):y=m&&u(m)?m:{},c(b,{name:h,newValue:p(w,y,g)})):typeof g<"u"&&c(b,{name:h,newValue:g}));return b}},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BlockEmbed=n.bubbleFormats=void 0;var a=function(){function D(R,N){for(var M=0;M<N.length;M++){var A=N[M];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(R,A.key,A)}}return function(R,N,M){return N&&D(R.prototype,N),M&&D(R,M),R}}(),o=function D(R,N,M){R===null&&(R=Function.prototype);var A=Object.getOwnPropertyDescriptor(R,N);if(A===void 0){var _=Object.getPrototypeOf(R);return _===null?void 0:D(_,N,M)}else{if("value"in A)return A.value;var k=A.get;return k===void 0?void 0:k.call(M)}},s=r(3),l=b(s),u=r(2),c=b(u),d=r(0),p=b(d),f=r(16),h=b(f),m=r(6),g=b(m),v=r(7),y=b(v);function b(D){return D&&D.__esModule?D:{default:D}}function I(D,R){if(!(D instanceof R))throw new TypeError("Cannot call a class as a function")}function T(D,R){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:D}function w(D,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);D.prototype=Object.create(R&&R.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(D,R):D.__proto__=R)}var S=1,U=function(D){w(R,D);function R(){return I(this,R),T(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return a(R,[{key:"attach",value:function(){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"attach",this).call(this),this.attributes=new p.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new c.default().insert(this.value(),(0,l.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(M,A){var _=p.default.query(M,p.default.Scope.BLOCK_ATTRIBUTE);_!=null&&this.attributes.attribute(_,A)}},{key:"formatAt",value:function(M,A,_,k){this.format(_,k)}},{key:"insertAt",value:function(M,A,_){if(typeof A=="string"&&A.endsWith(`
`)){var k=p.default.create(P.blotName);this.parent.insertBefore(k,M===0?this:this.next),k.insertAt(0,A.slice(0,-1))}else o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"insertAt",this).call(this,M,A,_)}}]),R}(p.default.Embed);U.scope=p.default.Scope.BLOCK_BLOT;var P=function(D){w(R,D);function R(N){I(this,R);var M=T(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,N));return M.cache={},M}return a(R,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(p.default.Leaf).reduce(function(M,A){return A.length()===0?M:M.insert(A.value(),E(A))},new c.default).insert(`
`,E(this))),this.cache.delta}},{key:"deleteAt",value:function(M,A){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"deleteAt",this).call(this,M,A),this.cache={}}},{key:"formatAt",value:function(M,A,_,k){A<=0||(p.default.query(_,p.default.Scope.BLOCK)?M+A===this.length()&&this.format(_,k):o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"formatAt",this).call(this,M,Math.min(A,this.length()-M-1),_,k),this.cache={})}},{key:"insertAt",value:function(M,A,_){if(_!=null)return o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"insertAt",this).call(this,M,A,_);if(A.length!==0){var k=A.split(`
`),B=k.shift();B.length>0&&(M<this.length()-1||this.children.tail==null?o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"insertAt",this).call(this,Math.min(M,this.length()-1),B):this.children.tail.insertAt(this.children.tail.length(),B),this.cache={});var F=this;k.reduce(function(x,$){return F=F.split(x,!0),F.insertAt(0,$),$.length},M+B.length)}}},{key:"insertBefore",value:function(M,A){var _=this.children.head;o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"insertBefore",this).call(this,M,A),_ instanceof h.default&&_.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"length",this).call(this)+S),this.cache.length}},{key:"moveChildren",value:function(M,A){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"moveChildren",this).call(this,M,A),this.cache={}}},{key:"optimize",value:function(M){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"optimize",this).call(this,M),this.cache={}}},{key:"path",value:function(M){return o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"path",this).call(this,M,!0)}},{key:"removeChild",value:function(M){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"removeChild",this).call(this,M),this.cache={}}},{key:"split",value:function(M){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(A&&(M===0||M>=this.length()-S)){var _=this.clone();return M===0?(this.parent.insertBefore(_,this),this):(this.parent.insertBefore(_,this.next),_)}else{var k=o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"split",this).call(this,M,A);return this.cache={},k}}}]),R}(p.default.Block);P.blotName="block",P.tagName="P",P.defaultChild="break",P.allowedChildren=[g.default,p.default.Embed,y.default];function E(D){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return D==null||(typeof D.formats=="function"&&(R=(0,l.default)(R,D.formats())),D.parent==null||D.parent.blotName=="scroll"||D.parent.statics.scope!==D.statics.scope)?R:E(D.parent,R)}n.bubbleFormats=E,n.BlockEmbed=U,n.default=P},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.overload=n.expandConfig=void 0;var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},o=function(){function F(x,$){var j=[],V=!0,H=!1,z=void 0;try{for(var q=x[Symbol.iterator](),W;!(V=(W=q.next()).done)&&(j.push(W.value),!($&&j.length===$));V=!0);}catch(Y){H=!0,z=Y}finally{try{!V&&q.return&&q.return()}finally{if(H)throw z}}return j}return function(x,$){if(Array.isArray(x))return x;if(Symbol.iterator in Object(x))return F(x,$);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function F(x,$){for(var j=0;j<$.length;j++){var V=$[j];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(x,V.key,V)}}return function(x,$,j){return $&&F(x.prototype,$),j&&F(x,j),x}}();r(50);var l=r(2),u=E(l),c=r(14),d=E(c),p=r(8),f=E(p),h=r(9),m=E(h),g=r(0),v=E(g),y=r(15),b=E(y),I=r(3),T=E(I),w=r(10),S=E(w),U=r(34),P=E(U);function E(F){return F&&F.__esModule?F:{default:F}}function D(F,x,$){return x in F?Object.defineProperty(F,x,{value:$,enumerable:!0,configurable:!0,writable:!0}):F[x]=$,F}function R(F,x){if(!(F instanceof x))throw new TypeError("Cannot call a class as a function")}var N=(0,S.default)("quill"),M=function(){s(F,null,[{key:"debug",value:function($){$===!0&&($="log"),S.default.level($)}},{key:"find",value:function($){return $.__quill||v.default.find($)}},{key:"import",value:function($){return this.imports[$]==null&&N.error("Cannot import "+$+". Are you sure it was registered?"),this.imports[$]}},{key:"register",value:function($,j){var V=this,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof $!="string"){var z=$.attrName||$.blotName;typeof z=="string"?this.register("formats/"+z,$,j):Object.keys($).forEach(function(q){V.register(q,$[q],j)})}else this.imports[$]!=null&&!H&&N.warn("Overwriting "+$+" with",j),this.imports[$]=j,($.startsWith("blots/")||$.startsWith("formats/"))&&j.blotName!=="abstract"?v.default.register(j):$.startsWith("modules")&&typeof j.register=="function"&&j.register()}}]);function F(x){var $=this,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(R(this,F),this.options=A(x,j),this.container=this.options.container,this.container==null)return N.error("Invalid Quill container",x);this.options.debug&&F.debug(this.options.debug);var V=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new f.default,this.scroll=v.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new d.default(this.scroll),this.selection=new b.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(f.default.events.EDITOR_CHANGE,function(z){z===f.default.events.TEXT_CHANGE&&$.root.classList.toggle("ql-blank",$.editor.isBlank())}),this.emitter.on(f.default.events.SCROLL_UPDATE,function(z,q){var W=$.selection.lastRange,Y=W&&W.length===0?W.index:void 0;_.call($,function(){return $.editor.update(null,q,Y)},z)});var H=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+V+"<p><br></p></div>");this.setContents(H),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return s(F,[{key:"addContainer",value:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof $=="string"){var V=$;$=document.createElement("div"),$.classList.add(V)}return this.container.insertBefore($,j),$}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function($,j,V){var H=this,z=k($,j,V),q=o(z,4);return $=q[0],j=q[1],V=q[3],_.call(this,function(){return H.editor.deleteText($,j)},V,$,-1*j)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable($),this.container.classList.toggle("ql-disabled",!$)}},{key:"focus",value:function(){var $=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=$,this.scrollIntoView()}},{key:"format",value:function($,j){var V=this,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:f.default.sources.API;return _.call(this,function(){var z=V.getSelection(!0),q=new u.default;if(z==null)return q;if(v.default.query($,v.default.Scope.BLOCK))q=V.editor.formatLine(z.index,z.length,D({},$,j));else{if(z.length===0)return V.selection.format($,j),q;q=V.editor.formatText(z.index,z.length,D({},$,j))}return V.setSelection(z,f.default.sources.SILENT),q},H)}},{key:"formatLine",value:function($,j,V,H,z){var q=this,W=void 0,Y=k($,j,V,H,z),Z=o(Y,4);return $=Z[0],j=Z[1],W=Z[2],z=Z[3],_.call(this,function(){return q.editor.formatLine($,j,W)},z,$,0)}},{key:"formatText",value:function($,j,V,H,z){var q=this,W=void 0,Y=k($,j,V,H,z),Z=o(Y,4);return $=Z[0],j=Z[1],W=Z[2],z=Z[3],_.call(this,function(){return q.editor.formatText($,j,W)},z,$,0)}},{key:"getBounds",value:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,V=void 0;typeof $=="number"?V=this.selection.getBounds($,j):V=this.selection.getBounds($.index,$.length);var H=this.container.getBoundingClientRect();return{bottom:V.bottom-H.top,height:V.height,left:V.left-H.left,right:V.right-H.left,top:V.top-H.top,width:V.width}}},{key:"getContents",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-$,V=k($,j),H=o(V,2);return $=H[0],j=H[1],this.editor.getContents($,j)}},{key:"getFormat",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof $=="number"?this.editor.getFormat($,j):this.editor.getFormat($.index,$.length)}},{key:"getIndex",value:function($){return $.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function($){return this.scroll.leaf($)}},{key:"getLine",value:function($){return this.scroll.line($)}},{key:"getLines",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof $!="number"?this.scroll.lines($.index,$.length):this.scroll.lines($,j)}},{key:"getModule",value:function($){return this.theme.modules[$]}},{key:"getSelection",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return $&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-$,V=k($,j),H=o(V,2);return $=H[0],j=H[1],this.editor.getText($,j)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function($,j,V){var H=this,z=arguments.length>3&&arguments[3]!==void 0?arguments[3]:F.sources.API;return _.call(this,function(){return H.editor.insertEmbed($,j,V)},z,$)}},{key:"insertText",value:function($,j,V,H,z){var q=this,W=void 0,Y=k($,0,V,H,z),Z=o(Y,4);return $=Z[0],W=Z[2],z=Z[3],_.call(this,function(){return q.editor.insertText($,j,W)},z,$,j.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function($,j,V){this.clipboard.dangerouslyPasteHTML($,j,V)}},{key:"removeFormat",value:function($,j,V){var H=this,z=k($,j,V),q=o(z,4);return $=q[0],j=q[1],V=q[3],_.call(this,function(){return H.editor.removeFormat($,j)},V,$)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function($){var j=this,V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f.default.sources.API;return _.call(this,function(){$=new u.default($);var H=j.getLength(),z=j.editor.deleteText(0,H),q=j.editor.applyDelta($),W=q.ops[q.ops.length-1];W!=null&&typeof W.insert=="string"&&W.insert[W.insert.length-1]===`
`&&(j.editor.deleteText(j.getLength()-1,1),q.delete(1));var Y=z.compose(q);return Y},V)}},{key:"setSelection",value:function($,j,V){if($==null)this.selection.setRange(null,j||F.sources.API);else{var H=k($,j,V),z=o(H,4);$=z[0],j=z[1],V=z[3],this.selection.setRange(new y.Range($,j),V),V!==f.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f.default.sources.API,V=new u.default().insert($);return this.setContents(V,j)}},{key:"update",value:function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:f.default.sources.USER,j=this.scroll.update($);return this.selection.update($),j}},{key:"updateContents",value:function($){var j=this,V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f.default.sources.API;return _.call(this,function(){return $=new u.default($),j.editor.applyDelta($,V)},V,!0)}}]),F}();M.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},M.events=f.default.events,M.sources=f.default.sources,M.version="1.3.7",M.imports={delta:u.default,parchment:v.default,"core/module":m.default,"core/theme":P.default};function A(F,x){if(x=(0,T.default)(!0,{container:F,modules:{clipboard:!0,keyboard:!0,history:!0}},x),!x.theme||x.theme===M.DEFAULTS.theme)x.theme=P.default;else if(x.theme=M.import("themes/"+x.theme),x.theme==null)throw new Error("Invalid theme "+x.theme+". Did you register it?");var $=(0,T.default)(!0,{},x.theme.DEFAULTS);[$,x].forEach(function(H){H.modules=H.modules||{},Object.keys(H.modules).forEach(function(z){H.modules[z]===!0&&(H.modules[z]={})})});var j=Object.keys($.modules).concat(Object.keys(x.modules)),V=j.reduce(function(H,z){var q=M.import("modules/"+z);return q==null?N.error("Cannot load "+z+" module. Are you sure you registered it?"):H[z]=q.DEFAULTS||{},H},{});return x.modules!=null&&x.modules.toolbar&&x.modules.toolbar.constructor!==Object&&(x.modules.toolbar={container:x.modules.toolbar}),x=(0,T.default)(!0,{},M.DEFAULTS,{modules:V},$,x),["bounds","container","scrollingContainer"].forEach(function(H){typeof x[H]=="string"&&(x[H]=document.querySelector(x[H]))}),x.modules=Object.keys(x.modules).reduce(function(H,z){return x.modules[z]&&(H[z]=x.modules[z]),H},{}),x}function _(F,x,$,j){if(this.options.strict&&!this.isEnabled()&&x===f.default.sources.USER)return new u.default;var V=$==null?null:this.getSelection(),H=this.editor.delta,z=F();if(V!=null&&($===!0&&($=V.index),j==null?V=B(V,z,x):j!==0&&(V=B(V,$,j,x)),this.setSelection(V,f.default.sources.SILENT)),z.length()>0){var q,W=[f.default.events.TEXT_CHANGE,z,H,x];if((q=this.emitter).emit.apply(q,[f.default.events.EDITOR_CHANGE].concat(W)),x!==f.default.sources.SILENT){var Y;(Y=this.emitter).emit.apply(Y,W)}}return z}function k(F,x,$,j,V){var H={};return typeof F.index=="number"&&typeof F.length=="number"?typeof x!="number"?(V=j,j=$,$=x,x=F.length,F=F.index):(x=F.length,F=F.index):typeof x!="number"&&(V=j,j=$,$=x,x=0),(typeof $>"u"?"undefined":a($))==="object"?(H=$,V=j):typeof $=="string"&&(j!=null?H[$]=j:V=$),V=V||f.default.sources.API,[F,x,H,V]}function B(F,x,$,j){if(F==null)return null;var V=void 0,H=void 0;if(x instanceof u.default){var z=[F.index,F.index+F.length].map(function(Z){return x.transformPosition(Z,j!==f.default.sources.USER)}),q=o(z,2);V=q[0],H=q[1]}else{var W=[F.index,F.index+F.length].map(function(Z){return Z<x||Z===x&&j===f.default.sources.USER?Z:$>=0?Z+$:Math.max(x,Z+$)}),Y=o(W,2);V=Y[0],H=Y[1]}return new y.Range(V,H-V)}n.expandConfig=A,n.overload=k,n.default=M},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function g(v,y){for(var b=0;b<y.length;b++){var I=y[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,y,b){return y&&g(v.prototype,y),b&&g(v,b),v}}(),o=function g(v,y,b){v===null&&(v=Function.prototype);var I=Object.getOwnPropertyDescriptor(v,y);if(I===void 0){var T=Object.getPrototypeOf(v);return T===null?void 0:g(T,y,b)}else{if("value"in I)return I.value;var w=I.get;return w===void 0?void 0:w.call(b)}},s=r(7),l=d(s),u=r(0),c=d(u);function d(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function f(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function h(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var m=function(g){h(v,g);function v(){return p(this,v),f(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return a(v,[{key:"formatAt",value:function(b,I,T,w){if(v.compare(this.statics.blotName,T)<0&&c.default.query(T,c.default.Scope.BLOT)){var S=this.isolate(b,I);w&&S.wrap(T,w)}else o(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"formatAt",this).call(this,b,I,T,w)}},{key:"optimize",value:function(b){if(o(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"optimize",this).call(this,b),this.parent instanceof v&&v.compare(this.statics.blotName,this.parent.statics.blotName)>0){var I=this.parent.isolate(this.offset(),this.length());this.moveChildren(I),I.wrap(this)}}}],[{key:"compare",value:function(b,I){var T=v.order.indexOf(b),w=v.order.indexOf(I);return T>=0||w>=0?T-w:b===I?0:b<I?-1:1}}]),v}(c.default.Inline);m.allowedChildren=[m,c.default.Embed,l.default],m.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],n.default=m},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(0),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}function l(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}function u(p,f){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:p}function c(p,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);p.prototype=Object.create(f&&f.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(p,f):p.__proto__=f)}var d=function(p){c(f,p);function f(){return l(this,f),u(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return f}(o.default.Text);n.default=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function y(b,I){for(var T=0;T<I.length;T++){var w=I[T];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(b,w.key,w)}}return function(b,I,T){return I&&y(b.prototype,I),T&&y(b,T),b}}(),o=function y(b,I,T){b===null&&(b=Function.prototype);var w=Object.getOwnPropertyDescriptor(b,I);if(w===void 0){var S=Object.getPrototypeOf(b);return S===null?void 0:y(S,I,T)}else{if("value"in w)return w.value;var U=w.get;return U===void 0?void 0:U.call(T)}},s=r(54),l=d(s),u=r(10),c=d(u);function d(y){return y&&y.__esModule?y:{default:y}}function p(y,b){if(!(y instanceof b))throw new TypeError("Cannot call a class as a function")}function f(y,b){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&(typeof b=="object"||typeof b=="function")?b:y}function h(y,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);y.prototype=Object.create(b&&b.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(y,b):y.__proto__=b)}var m=(0,c.default)("quill:events"),g=["selectionchange","mousedown","mouseup","click"];g.forEach(function(y){document.addEventListener(y,function(){for(var b=arguments.length,I=Array(b),T=0;T<b;T++)I[T]=arguments[T];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(w){if(w.__quill&&w.__quill.emitter){var S;(S=w.__quill.emitter).handleDOM.apply(S,I)}})})});var v=function(y){h(b,y);function b(){p(this,b);var I=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return I.listeners={},I.on("error",m.error),I}return a(b,[{key:"emit",value:function(){m.log.apply(m,arguments),o(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(T){for(var w=arguments.length,S=Array(w>1?w-1:0),U=1;U<w;U++)S[U-1]=arguments[U];(this.listeners[T.type]||[]).forEach(function(P){var E=P.node,D=P.handler;(T.target===E||E.contains(T.target))&&D.apply(void 0,[T].concat(S))})}},{key:"listenDOM",value:function(T,w,S){this.listeners[T]||(this.listeners[T]=[]),this.listeners[T].push({node:w,handler:S})}}]),b}(l.default);v.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},v.sources={API:"api",SILENT:"silent",USER:"user"},n.default=v},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});function a(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}var o=function s(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};a(this,s),this.quill=l,this.options=u};o.DEFAULTS={},n.default=o},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=["error","warn","log","info"],o="warn";function s(u){if(a.indexOf(u)<=a.indexOf(o)){for(var c,d=arguments.length,p=Array(d>1?d-1:0),f=1;f<d;f++)p[f-1]=arguments[f];(c=console)[u].apply(c,p)}}function l(u){return a.reduce(function(c,d){return c[d]=s.bind(console,d,u),c},{})}s.level=l.level=function(u){o=u},n.default=l},function(i,n,r){var a=Array.prototype.slice,o=r(52),s=r(53),l=i.exports=function(p,f,h){return h||(h={}),p===f?!0:p instanceof Date&&f instanceof Date?p.getTime()===f.getTime():!p||!f||typeof p!="object"&&typeof f!="object"?h.strict?p===f:p==f:d(p,f,h)};function u(p){return p==null}function c(p){return!(!p||typeof p!="object"||typeof p.length!="number"||typeof p.copy!="function"||typeof p.slice!="function"||p.length>0&&typeof p[0]!="number")}function d(p,f,h){var m,g;if(u(p)||u(f)||p.prototype!==f.prototype)return!1;if(s(p))return s(f)?(p=a.call(p),f=a.call(f),l(p,f,h)):!1;if(c(p)){if(!c(f)||p.length!==f.length)return!1;for(m=0;m<p.length;m++)if(p[m]!==f[m])return!1;return!0}try{var v=o(p),y=o(f)}catch{return!1}if(v.length!=y.length)return!1;for(v.sort(),y.sort(),m=v.length-1;m>=0;m--)if(v[m]!=y[m])return!1;for(m=v.length-1;m>=0;m--)if(g=v[m],!l(p[g],f[g],h))return!1;return typeof p==typeof f}},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(1),o=function(){function s(l,u,c){c===void 0&&(c={}),this.attrName=l,this.keyName=u;var d=a.Scope.TYPE&a.Scope.ATTRIBUTE;c.scope!=null?this.scope=c.scope&a.Scope.LEVEL|d:this.scope=a.Scope.ATTRIBUTE,c.whitelist!=null&&(this.whitelist=c.whitelist)}return s.keys=function(l){return[].map.call(l.attributes,function(u){return u.name})},s.prototype.add=function(l,u){return this.canAdd(l,u)?(l.setAttribute(this.keyName,u),!0):!1},s.prototype.canAdd=function(l,u){var c=a.query(l,a.Scope.BLOT&(this.scope|a.Scope.TYPE));return c==null?!1:this.whitelist==null?!0:typeof u=="string"?this.whitelist.indexOf(u.replace(/["']/g,""))>-1:this.whitelist.indexOf(u)>-1},s.prototype.remove=function(l){l.removeAttribute(this.keyName)},s.prototype.value=function(l){var u=l.getAttribute(this.keyName);return this.canAdd(l,u)&&u?u:""},s}();n.default=o},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Code=void 0;var a=function(){function U(P,E){var D=[],R=!0,N=!1,M=void 0;try{for(var A=P[Symbol.iterator](),_;!(R=(_=A.next()).done)&&(D.push(_.value),!(E&&D.length===E));R=!0);}catch(k){N=!0,M=k}finally{try{!R&&A.return&&A.return()}finally{if(N)throw M}}return D}return function(P,E){if(Array.isArray(P))return P;if(Symbol.iterator in Object(P))return U(P,E);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function U(P,E){for(var D=0;D<E.length;D++){var R=E[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(P,R.key,R)}}return function(P,E,D){return E&&U(P.prototype,E),D&&U(P,D),P}}(),s=function U(P,E,D){P===null&&(P=Function.prototype);var R=Object.getOwnPropertyDescriptor(P,E);if(R===void 0){var N=Object.getPrototypeOf(P);return N===null?void 0:U(N,E,D)}else{if("value"in R)return R.value;var M=R.get;return M===void 0?void 0:M.call(D)}},l=r(2),u=y(l),c=r(0),d=y(c),p=r(4),f=y(p),h=r(6),m=y(h),g=r(7),v=y(g);function y(U){return U&&U.__esModule?U:{default:U}}function b(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")}function I(U,P){if(!U)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P&&(typeof P=="object"||typeof P=="function")?P:U}function T(U,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);U.prototype=Object.create(P&&P.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(U,P):U.__proto__=P)}var w=function(U){T(P,U);function P(){return b(this,P),I(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return P}(m.default);w.blotName="code",w.tagName="CODE";var S=function(U){T(P,U);function P(){return b(this,P),I(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments))}return o(P,[{key:"delta",value:function(){var D=this,R=this.domNode.textContent;return R.endsWith(`
`)&&(R=R.slice(0,-1)),R.split(`
`).reduce(function(N,M){return N.insert(M).insert(`
`,D.formats())},new u.default)}},{key:"format",value:function(D,R){if(!(D===this.statics.blotName&&R)){var N=this.descendant(v.default,this.length()-1),M=a(N,1),A=M[0];A!=null&&A.deleteAt(A.length()-1,1),s(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"format",this).call(this,D,R)}}},{key:"formatAt",value:function(D,R,N,M){if(R!==0&&!(d.default.query(N,d.default.Scope.BLOCK)==null||N===this.statics.blotName&&M===this.statics.formats(this.domNode))){var A=this.newlineIndex(D);if(!(A<0||A>=D+R)){var _=this.newlineIndex(D,!0)+1,k=A-_+1,B=this.isolate(_,k),F=B.next;B.format(N,M),F instanceof P&&F.formatAt(0,D-_+R-k,N,M)}}}},{key:"insertAt",value:function(D,R,N){if(N==null){var M=this.descendant(v.default,D),A=a(M,2),_=A[0],k=A[1];_.insertAt(k,R)}}},{key:"length",value:function(){var D=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?D:D+1}},{key:"newlineIndex",value:function(D){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(R)return this.domNode.textContent.slice(0,D).lastIndexOf(`
`);var N=this.domNode.textContent.slice(D).indexOf(`
`);return N>-1?D+N:-1}},{key:"optimize",value:function(D){this.domNode.textContent.endsWith(`
`)||this.appendChild(d.default.create("text",`
`)),s(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"optimize",this).call(this,D);var R=this.next;R!=null&&R.prev===this&&R.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===R.statics.formats(R.domNode)&&(R.optimize(D),R.moveChildren(this),R.remove())}},{key:"replace",value:function(D){s(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"replace",this).call(this,D),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(R){var N=d.default.find(R);N==null?R.parentNode.removeChild(R):N instanceof d.default.Embed?N.remove():N.unwrap()})}}],[{key:"create",value:function(D){var R=s(P.__proto__||Object.getPrototypeOf(P),"create",this).call(this,D);return R.setAttribute("spellcheck",!1),R}},{key:"formats",value:function(){return!0}}]),P}(f.default);S.blotName="code-block",S.tagName="PRE",S.TAB="  ",n.Code=w,n.default=S},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},o=function(){function F(x,$){var j=[],V=!0,H=!1,z=void 0;try{for(var q=x[Symbol.iterator](),W;!(V=(W=q.next()).done)&&(j.push(W.value),!($&&j.length===$));V=!0);}catch(Y){H=!0,z=Y}finally{try{!V&&q.return&&q.return()}finally{if(H)throw z}}return j}return function(x,$){if(Array.isArray(x))return x;if(Symbol.iterator in Object(x))return F(x,$);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function F(x,$){for(var j=0;j<$.length;j++){var V=$[j];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(x,V.key,V)}}return function(x,$,j){return $&&F(x.prototype,$),j&&F(x,j),x}}(),l=r(2),u=R(l),c=r(20),d=R(c),p=r(0),f=R(p),h=r(13),m=R(h),g=r(24),v=R(g),y=r(4),b=R(y),I=r(16),T=R(I),w=r(21),S=R(w),U=r(11),P=R(U),E=r(3),D=R(E);function R(F){return F&&F.__esModule?F:{default:F}}function N(F,x,$){return x in F?Object.defineProperty(F,x,{value:$,enumerable:!0,configurable:!0,writable:!0}):F[x]=$,F}function M(F,x){if(!(F instanceof x))throw new TypeError("Cannot call a class as a function")}var A=/^[ -~]*$/,_=function(){function F(x){M(this,F),this.scroll=x,this.delta=this.getDelta()}return s(F,[{key:"applyDelta",value:function($){var j=this,V=!1;this.scroll.update();var H=this.scroll.length();return this.scroll.batchStart(),$=B($),$.reduce(function(z,q){var W=q.retain||q.delete||q.insert.length||1,Y=q.attributes||{};if(q.insert!=null){if(typeof q.insert=="string"){var Z=q.insert;Z.endsWith(`
`)&&V&&(V=!1,Z=Z.slice(0,-1)),z>=H&&!Z.endsWith(`
`)&&(V=!0),j.scroll.insertAt(z,Z);var X=j.scroll.line(z),Q=o(X,2),ce=Q[0],J=Q[1],ee=(0,D.default)({},(0,y.bubbleFormats)(ce));if(ce instanceof b.default){var ne=ce.descendant(f.default.Leaf,J),ie=o(ne,1),oe=ie[0];ee=(0,D.default)(ee,(0,y.bubbleFormats)(oe))}Y=d.default.attributes.diff(ee,Y)||{}}else if(a(q.insert)==="object"){var se=Object.keys(q.insert)[0];if(se==null)return z;j.scroll.insertAt(z,se,q.insert[se])}H+=W}return Object.keys(Y).forEach(function(pe){j.scroll.formatAt(z,W,pe,Y[pe])}),z+W},0),$.reduce(function(z,q){return typeof q.delete=="number"?(j.scroll.deleteAt(z,q.delete),z):z+(q.retain||q.insert.length||1)},0),this.scroll.batchEnd(),this.update($)}},{key:"deleteText",value:function($,j){return this.scroll.deleteAt($,j),this.update(new u.default().retain($).delete(j))}},{key:"formatLine",value:function($,j){var V=this,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(H).forEach(function(z){if(!(V.scroll.whitelist!=null&&!V.scroll.whitelist[z])){var q=V.scroll.lines($,Math.max(j,1)),W=j;q.forEach(function(Y){var Z=Y.length();if(!(Y instanceof m.default))Y.format(z,H[z]);else{var X=$-Y.offset(V.scroll),Q=Y.newlineIndex(X+W)-X+1;Y.formatAt(X,Q,z,H[z])}W-=Z})}}),this.scroll.optimize(),this.update(new u.default().retain($).retain(j,(0,S.default)(H)))}},{key:"formatText",value:function($,j){var V=this,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(H).forEach(function(z){V.scroll.formatAt($,j,z,H[z])}),this.update(new u.default().retain($).retain(j,(0,S.default)(H)))}},{key:"getContents",value:function($,j){return this.delta.slice($,$+j)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function($,j){return $.concat(j.delta())},new u.default)}},{key:"getFormat",value:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,V=[],H=[];j===0?this.scroll.path($).forEach(function(q){var W=o(q,1),Y=W[0];Y instanceof b.default?V.push(Y):Y instanceof f.default.Leaf&&H.push(Y)}):(V=this.scroll.lines($,j),H=this.scroll.descendants(f.default.Leaf,$,j));var z=[V,H].map(function(q){if(q.length===0)return{};for(var W=(0,y.bubbleFormats)(q.shift());Object.keys(W).length>0;){var Y=q.shift();if(Y==null)return W;W=k((0,y.bubbleFormats)(Y),W)}return W});return D.default.apply(D.default,z)}},{key:"getText",value:function($,j){return this.getContents($,j).filter(function(V){return typeof V.insert=="string"}).map(function(V){return V.insert}).join("")}},{key:"insertEmbed",value:function($,j,V){return this.scroll.insertAt($,j,V),this.update(new u.default().retain($).insert(N({},j,V)))}},{key:"insertText",value:function($,j){var V=this,H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return j=j.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt($,j),Object.keys(H).forEach(function(z){V.scroll.formatAt($,j.length,z,H[z])}),this.update(new u.default().retain($).insert(j,(0,S.default)(H)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var $=this.scroll.children.head;return $.statics.blotName!==b.default.blotName||$.children.length>1?!1:$.children.head instanceof T.default}},{key:"removeFormat",value:function($,j){var V=this.getText($,j),H=this.scroll.line($+j),z=o(H,2),q=z[0],W=z[1],Y=0,Z=new u.default;q!=null&&(q instanceof m.default?Y=q.newlineIndex(W)-W+1:Y=q.length()-W,Z=q.delta().slice(W,W+Y-1).insert(`
`));var X=this.getContents($,j+Y),Q=X.diff(new u.default().insert(V).concat(Z)),ce=new u.default().retain($).concat(Q);return this.applyDelta(ce)}},{key:"update",value:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,H=this.delta;if(j.length===1&&j[0].type==="characterData"&&j[0].target.data.match(A)&&f.default.find(j[0].target)){var z=f.default.find(j[0].target),q=(0,y.bubbleFormats)(z),W=z.offset(this.scroll),Y=j[0].oldValue.replace(v.default.CONTENTS,""),Z=new u.default().insert(Y),X=new u.default().insert(z.value()),Q=new u.default().retain(W).concat(Z.diff(X,V));$=Q.reduce(function(ce,J){return J.insert?ce.insert(J.insert,q):ce.push(J)},new u.default),this.delta=H.compose($)}else this.delta=this.getDelta(),(!$||!(0,P.default)(H.compose($),this.delta))&&($=H.diff(this.delta,V));return $}}]),F}();function k(F,x){return Object.keys(x).reduce(function($,j){return F[j]==null||(x[j]===F[j]?$[j]=x[j]:Array.isArray(x[j])?x[j].indexOf(F[j])<0&&($[j]=x[j].concat([F[j]])):$[j]=[x[j],F[j]]),$},{})}function B(F){return F.reduce(function(x,$){if($.insert===1){var j=(0,S.default)($.attributes);return delete j.image,x.insert({image:$.attributes.image},j)}if($.attributes!=null&&($.attributes.list===!0||$.attributes.bullet===!0)&&($=(0,S.default)($),$.attributes.list?$.attributes.list="ordered":($.attributes.list="bullet",delete $.attributes.bullet)),typeof $.insert=="string"){var V=$.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return x.insert(V,$.attributes)}return x.push($)},new u.default)}n.default=_},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Range=void 0;var a=function(){function U(P,E){var D=[],R=!0,N=!1,M=void 0;try{for(var A=P[Symbol.iterator](),_;!(R=(_=A.next()).done)&&(D.push(_.value),!(E&&D.length===E));R=!0);}catch(k){N=!0,M=k}finally{try{!R&&A.return&&A.return()}finally{if(N)throw M}}return D}return function(P,E){if(Array.isArray(P))return P;if(Symbol.iterator in Object(P))return U(P,E);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function U(P,E){for(var D=0;D<E.length;D++){var R=E[D];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(P,R.key,R)}}return function(P,E,D){return E&&U(P.prototype,E),D&&U(P,D),P}}(),s=r(0),l=v(s),u=r(21),c=v(u),d=r(11),p=v(d),f=r(8),h=v(f),m=r(10),g=v(m);function v(U){return U&&U.__esModule?U:{default:U}}function y(U){if(Array.isArray(U)){for(var P=0,E=Array(U.length);P<U.length;P++)E[P]=U[P];return E}else return Array.from(U)}function b(U,P){if(!(U instanceof P))throw new TypeError("Cannot call a class as a function")}var I=(0,g.default)("quill:selection"),T=function U(P){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;b(this,U),this.index=P,this.length=E},w=function(){function U(P,E){var D=this;b(this,U),this.emitter=E,this.scroll=P,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=l.default.create("cursor",this),this.lastRange=this.savedRange=new T(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){D.mouseDown||setTimeout(D.update.bind(D,h.default.sources.USER),1)}),this.emitter.on(h.default.events.EDITOR_CHANGE,function(R,N){R===h.default.events.TEXT_CHANGE&&N.length()>0&&D.update(h.default.sources.SILENT)}),this.emitter.on(h.default.events.SCROLL_BEFORE_UPDATE,function(){if(D.hasFocus()){var R=D.getNativeRange();R!=null&&R.start.node!==D.cursor.textNode&&D.emitter.once(h.default.events.SCROLL_UPDATE,function(){try{D.setNativeRange(R.start.node,R.start.offset,R.end.node,R.end.offset)}catch{}})}}),this.emitter.on(h.default.events.SCROLL_OPTIMIZE,function(R,N){if(N.range){var M=N.range,A=M.startNode,_=M.startOffset,k=M.endNode,B=M.endOffset;D.setNativeRange(A,_,k,B)}}),this.update(h.default.sources.SILENT)}return o(U,[{key:"handleComposition",value:function(){var E=this;this.root.addEventListener("compositionstart",function(){E.composing=!0}),this.root.addEventListener("compositionend",function(){if(E.composing=!1,E.cursor.parent){var D=E.cursor.restore();if(!D)return;setTimeout(function(){E.setNativeRange(D.startNode,D.startOffset,D.endNode,D.endOffset)},1)}})}},{key:"handleDragging",value:function(){var E=this;this.emitter.listenDOM("mousedown",document.body,function(){E.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){E.mouseDown=!1,E.update(h.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(E,D){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[E])){this.scroll.update();var R=this.getNativeRange();if(!(R==null||!R.native.collapsed||l.default.query(E,l.default.Scope.BLOCK))){if(R.start.node!==this.cursor.textNode){var N=l.default.find(R.start.node,!1);if(N==null)return;if(N instanceof l.default.Leaf){var M=N.split(R.start.offset);N.parent.insertBefore(this.cursor,M)}else N.insertBefore(this.cursor,R.start.node);this.cursor.attach()}this.cursor.format(E,D),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(E){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,R=this.scroll.length();E=Math.min(E,R-1),D=Math.min(E+D,R-1)-E;var N=void 0,M=this.scroll.leaf(E),A=a(M,2),_=A[0],k=A[1];if(_==null)return null;var B=_.position(k,!0),F=a(B,2);N=F[0],k=F[1];var x=document.createRange();if(D>0){x.setStart(N,k);var $=this.scroll.leaf(E+D),j=a($,2);if(_=j[0],k=j[1],_==null)return null;var V=_.position(k,!0),H=a(V,2);return N=H[0],k=H[1],x.setEnd(N,k),x.getBoundingClientRect()}else{var z="left",q=void 0;return N instanceof Text?(k<N.data.length?(x.setStart(N,k),x.setEnd(N,k+1)):(x.setStart(N,k-1),x.setEnd(N,k),z="right"),q=x.getBoundingClientRect()):(q=_.domNode.getBoundingClientRect(),k>0&&(z="right")),{bottom:q.top+q.height,height:q.height,left:q[z],right:q[z],top:q.top,width:0}}}},{key:"getNativeRange",value:function(){var E=document.getSelection();if(E==null||E.rangeCount<=0)return null;var D=E.getRangeAt(0);if(D==null)return null;var R=this.normalizeNative(D);return I.info("getNativeRange",R),R}},{key:"getRange",value:function(){var E=this.getNativeRange();if(E==null)return[null,null];var D=this.normalizedToRange(E);return[D,E]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(E){var D=this,R=[[E.start.node,E.start.offset]];E.native.collapsed||R.push([E.end.node,E.end.offset]);var N=R.map(function(_){var k=a(_,2),B=k[0],F=k[1],x=l.default.find(B,!0),$=x.offset(D.scroll);return F===0?$:x instanceof l.default.Container?$+x.length():$+x.index(B,F)}),M=Math.min(Math.max.apply(Math,y(N)),this.scroll.length()-1),A=Math.min.apply(Math,[M].concat(y(N)));return new T(A,M-A)}},{key:"normalizeNative",value:function(E){if(!S(this.root,E.startContainer)||!E.collapsed&&!S(this.root,E.endContainer))return null;var D={start:{node:E.startContainer,offset:E.startOffset},end:{node:E.endContainer,offset:E.endOffset},native:E};return[D.start,D.end].forEach(function(R){for(var N=R.node,M=R.offset;!(N instanceof Text)&&N.childNodes.length>0;)if(N.childNodes.length>M)N=N.childNodes[M],M=0;else if(N.childNodes.length===M)N=N.lastChild,M=N instanceof Text?N.data.length:N.childNodes.length+1;else break;R.node=N,R.offset=M}),D}},{key:"rangeToNative",value:function(E){var D=this,R=E.collapsed?[E.index]:[E.index,E.index+E.length],N=[],M=this.scroll.length();return R.forEach(function(A,_){A=Math.min(M-1,A);var k=void 0,B=D.scroll.leaf(A),F=a(B,2),x=F[0],$=F[1],j=x.position($,_!==0),V=a(j,2);k=V[0],$=V[1],N.push(k,$)}),N.length<2&&(N=N.concat(N)),N}},{key:"scrollIntoView",value:function(E){var D=this.lastRange;if(D!=null){var R=this.getBounds(D.index,D.length);if(R!=null){var N=this.scroll.length()-1,M=this.scroll.line(Math.min(D.index,N)),A=a(M,1),_=A[0],k=_;if(D.length>0){var B=this.scroll.line(Math.min(D.index+D.length,N)),F=a(B,1);k=F[0]}if(!(_==null||k==null)){var x=E.getBoundingClientRect();R.top<x.top?E.scrollTop-=x.top-R.top:R.bottom>x.bottom&&(E.scrollTop+=R.bottom-x.bottom)}}}}},{key:"setNativeRange",value:function(E,D){var R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:E,N=arguments.length>3&&arguments[3]!==void 0?arguments[3]:D,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(I.info("setNativeRange",E,D,R,N),!(E!=null&&(this.root.parentNode==null||E.parentNode==null||R.parentNode==null))){var A=document.getSelection();if(A!=null)if(E!=null){this.hasFocus()||this.root.focus();var _=(this.getNativeRange()||{}).native;if(_==null||M||E!==_.startContainer||D!==_.startOffset||R!==_.endContainer||N!==_.endOffset){E.tagName=="BR"&&(D=[].indexOf.call(E.parentNode.childNodes,E),E=E.parentNode),R.tagName=="BR"&&(N=[].indexOf.call(R.parentNode.childNodes,R),R=R.parentNode);var k=document.createRange();k.setStart(E,D),k.setEnd(R,N),A.removeAllRanges(),A.addRange(k)}}else A.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(E){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h.default.sources.API;if(typeof D=="string"&&(R=D,D=!1),I.info("setRange",E),E!=null){var N=this.rangeToNative(E);this.setNativeRange.apply(this,y(N).concat([D]))}else this.setNativeRange(null);this.update(R)}},{key:"update",value:function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:h.default.sources.USER,D=this.lastRange,R=this.getRange(),N=a(R,2),M=N[0],A=N[1];if(this.lastRange=M,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,p.default)(D,this.lastRange)){var _;!this.composing&&A!=null&&A.native.collapsed&&A.start.node!==this.cursor.textNode&&this.cursor.restore();var k=[h.default.events.SELECTION_CHANGE,(0,c.default)(this.lastRange),(0,c.default)(D),E];if((_=this.emitter).emit.apply(_,[h.default.events.EDITOR_CHANGE].concat(k)),E!==h.default.sources.SILENT){var B;(B=this.emitter).emit.apply(B,k)}}}}]),U}();function S(U,P){try{P.parentNode}catch{return!1}return P instanceof Text&&(P=P.parentNode),U.contains(P)}n.Range=T,n.default=w},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(m,g){for(var v=0;v<g.length;v++){var y=g[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}return function(m,g,v){return g&&h(m.prototype,g),v&&h(m,v),m}}(),o=function h(m,g,v){m===null&&(m=Function.prototype);var y=Object.getOwnPropertyDescriptor(m,g);if(y===void 0){var b=Object.getPrototypeOf(m);return b===null?void 0:h(b,g,v)}else{if("value"in y)return y.value;var I=y.get;return I===void 0?void 0:I.call(v)}},s=r(0),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(){return c(this,m),d(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return a(m,[{key:"insertInto",value:function(v,y){v.children.length===0?o(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"insertInto",this).call(this,v,y):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),m}(l.default.Embed);f.blotName="break",f.tagName="BR",n.default=f},function(i,n,r){var a=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,f){p.__proto__=f}||function(p,f){for(var h in f)f.hasOwnProperty(h)&&(p[h]=f[h])};return function(p,f){d(p,f);function h(){this.constructor=p}p.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(44),s=r(30),l=r(1),u=function(d){a(p,d);function p(f){var h=d.call(this,f)||this;return h.build(),h}return p.prototype.appendChild=function(f){this.insertBefore(f)},p.prototype.attach=function(){d.prototype.attach.call(this),this.children.forEach(function(f){f.attach()})},p.prototype.build=function(){var f=this;this.children=new o.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(h){try{var m=c(h);f.insertBefore(m,f.children.head||void 0)}catch(g){if(g instanceof l.ParchmentError)return;throw g}})},p.prototype.deleteAt=function(f,h){if(f===0&&h===this.length())return this.remove();this.children.forEachAt(f,h,function(m,g,v){m.deleteAt(g,v)})},p.prototype.descendant=function(f,h){var m=this.children.find(h),g=m[0],v=m[1];return f.blotName==null&&f(g)||f.blotName!=null&&g instanceof f?[g,v]:g instanceof p?g.descendant(f,v):[null,-1]},p.prototype.descendants=function(f,h,m){h===void 0&&(h=0),m===void 0&&(m=Number.MAX_VALUE);var g=[],v=m;return this.children.forEachAt(h,m,function(y,b,I){(f.blotName==null&&f(y)||f.blotName!=null&&y instanceof f)&&g.push(y),y instanceof p&&(g=g.concat(y.descendants(f,b,v))),v-=I}),g},p.prototype.detach=function(){this.children.forEach(function(f){f.detach()}),d.prototype.detach.call(this)},p.prototype.formatAt=function(f,h,m,g){this.children.forEachAt(f,h,function(v,y,b){v.formatAt(y,b,m,g)})},p.prototype.insertAt=function(f,h,m){var g=this.children.find(f),v=g[0],y=g[1];if(v)v.insertAt(y,h,m);else{var b=m==null?l.create("text",h):l.create(h,m);this.appendChild(b)}},p.prototype.insertBefore=function(f,h){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(m){return f instanceof m}))throw new l.ParchmentError("Cannot insert "+f.statics.blotName+" into "+this.statics.blotName);f.insertInto(this,h)},p.prototype.length=function(){return this.children.reduce(function(f,h){return f+h.length()},0)},p.prototype.moveChildren=function(f,h){this.children.forEach(function(m){f.insertBefore(m,h)})},p.prototype.optimize=function(f){if(d.prototype.optimize.call(this,f),this.children.length===0)if(this.statics.defaultChild!=null){var h=l.create(this.statics.defaultChild);this.appendChild(h),h.optimize(f)}else this.remove()},p.prototype.path=function(f,h){h===void 0&&(h=!1);var m=this.children.find(f,h),g=m[0],v=m[1],y=[[this,f]];return g instanceof p?y.concat(g.path(v,h)):(g!=null&&y.push([g,v]),y)},p.prototype.removeChild=function(f){this.children.remove(f)},p.prototype.replace=function(f){f instanceof p&&f.moveChildren(this),d.prototype.replace.call(this,f)},p.prototype.split=function(f,h){if(h===void 0&&(h=!1),!h){if(f===0)return this;if(f===this.length())return this.next}var m=this.clone();return this.parent.insertBefore(m,this.next),this.children.forEachAt(f,this.length(),function(g,v,y){g=g.split(v,h),m.appendChild(g)}),m},p.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},p.prototype.update=function(f,h){var m=this,g=[],v=[];f.forEach(function(y){y.target===m.domNode&&y.type==="childList"&&(g.push.apply(g,y.addedNodes),v.push.apply(v,y.removedNodes))}),v.forEach(function(y){if(!(y.parentNode!=null&&y.tagName!=="IFRAME"&&document.body.compareDocumentPosition(y)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var b=l.find(y);b!=null&&(b.domNode.parentNode==null||b.domNode.parentNode===m.domNode)&&b.detach()}}),g.filter(function(y){return y.parentNode==m.domNode}).sort(function(y,b){return y===b?0:y.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(y){var b=null;y.nextSibling!=null&&(b=l.find(y.nextSibling));var I=c(y);(I.next!=b||I.next==null)&&(I.parent!=null&&I.parent.removeChild(m),m.insertBefore(I,b||void 0))})},p}(s.default);function c(d){var p=l.find(d);if(p==null)try{p=l.create(d)}catch{p=l.create(l.Scope.INLINE),[].slice.call(d.childNodes).forEach(function(h){p.domNode.appendChild(h)}),d.parentNode&&d.parentNode.replaceChild(p.domNode,d),p.attach()}return p}n.default=u},function(i,n,r){var a=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,f){p.__proto__=f}||function(p,f){for(var h in f)f.hasOwnProperty(h)&&(p[h]=f[h])};return function(p,f){d(p,f);function h(){this.constructor=p}p.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(12),s=r(31),l=r(17),u=r(1),c=function(d){a(p,d);function p(f){var h=d.call(this,f)||this;return h.attributes=new s.default(h.domNode),h}return p.formats=function(f){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return f.tagName.toLowerCase()},p.prototype.format=function(f,h){var m=u.query(f);m instanceof o.default?this.attributes.attribute(m,h):h&&m!=null&&(f!==this.statics.blotName||this.formats()[f]!==h)&&this.replaceWith(f,h)},p.prototype.formats=function(){var f=this.attributes.values(),h=this.statics.formats(this.domNode);return h!=null&&(f[this.statics.blotName]=h),f},p.prototype.replaceWith=function(f,h){var m=d.prototype.replaceWith.call(this,f,h);return this.attributes.copy(m),m},p.prototype.update=function(f,h){var m=this;d.prototype.update.call(this,f,h),f.some(function(g){return g.target===m.domNode&&g.type==="attributes"})&&this.attributes.build()},p.prototype.wrap=function(f,h){var m=d.prototype.wrap.call(this,f,h);return m instanceof p&&m.statics.scope===this.statics.scope&&this.attributes.move(m),m},p}(l.default);n.default=c},function(i,n,r){var a=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var p in d)d.hasOwnProperty(p)&&(c[p]=d[p])};return function(c,d){u(c,d);function p(){this.constructor=c}c.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(30),s=r(1),l=function(u){a(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.value=function(d){return!0},c.prototype.index=function(d,p){return this.domNode===d||this.domNode.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(p,1):-1},c.prototype.position=function(d,p){var f=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return d>0&&(f+=1),[this.parent.domNode,f]},c.prototype.value=function(){var d;return d={},d[this.statics.blotName]=this.statics.value(this.domNode)||!0,d},c.scope=s.Scope.INLINE_BLOT,c}(o.default);n.default=l},function(i,n,r){var a=r(11),o=r(3),s={attributes:{compose:function(u,c,d){typeof u!="object"&&(u={}),typeof c!="object"&&(c={});var p=o(!0,{},c);d||(p=Object.keys(p).reduce(function(h,m){return p[m]!=null&&(h[m]=p[m]),h},{}));for(var f in u)u[f]!==void 0&&c[f]===void 0&&(p[f]=u[f]);return Object.keys(p).length>0?p:void 0},diff:function(u,c){typeof u!="object"&&(u={}),typeof c!="object"&&(c={});var d=Object.keys(u).concat(Object.keys(c)).reduce(function(p,f){return a(u[f],c[f])||(p[f]=c[f]===void 0?null:c[f]),p},{});return Object.keys(d).length>0?d:void 0},transform:function(u,c,d){if(typeof u!="object")return c;if(typeof c=="object"){if(!d)return c;var p=Object.keys(c).reduce(function(f,h){return u[h]===void 0&&(f[h]=c[h]),f},{});return Object.keys(p).length>0?p:void 0}}},iterator:function(u){return new l(u)},length:function(u){return typeof u.delete=="number"?u.delete:typeof u.retain=="number"?u.retain:typeof u.insert=="string"?u.insert.length:1}};function l(u){this.ops=u,this.index=0,this.offset=0}l.prototype.hasNext=function(){return this.peekLength()<1/0},l.prototype.next=function(u){u||(u=1/0);var c=this.ops[this.index];if(c){var d=this.offset,p=s.length(c);if(u>=p-d?(u=p-d,this.index+=1,this.offset=0):this.offset+=u,typeof c.delete=="number")return{delete:u};var f={};return c.attributes&&(f.attributes=c.attributes),typeof c.retain=="number"?f.retain=u:typeof c.insert=="string"?f.insert=c.insert.substr(d,u):f.insert=c.insert,f}else return{retain:1/0}},l.prototype.peek=function(){return this.ops[this.index]},l.prototype.peekLength=function(){return this.ops[this.index]?s.length(this.ops[this.index])-this.offset:1/0},l.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},l.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var u=this.offset,c=this.index,d=this.next(),p=this.ops.slice(this.index);return this.offset=u,this.index=c,[d].concat(p)}else return[]},i.exports=s},function(i,n){var r=function(){function a(m,g){return g!=null&&m instanceof g}var o;try{o=Map}catch{o=function(){}}var s;try{s=Set}catch{s=function(){}}var l;try{l=Promise}catch{l=function(){}}function u(m,g,v,y,b){typeof g=="object"&&(v=g.depth,y=g.prototype,b=g.includeNonEnumerable,g=g.circular);var I=[],T=[],w=typeof Buffer<"u";typeof g>"u"&&(g=!0),typeof v>"u"&&(v=1/0);function S(U,P){if(U===null)return null;if(P===0)return U;var E,D;if(typeof U!="object")return U;if(a(U,o))E=new o;else if(a(U,s))E=new s;else if(a(U,l))E=new l(function(x,$){U.then(function(j){x(S(j,P-1))},function(j){$(S(j,P-1))})});else if(u.__isArray(U))E=[];else if(u.__isRegExp(U))E=new RegExp(U.source,h(U)),U.lastIndex&&(E.lastIndex=U.lastIndex);else if(u.__isDate(U))E=new Date(U.getTime());else{if(w&&Buffer.isBuffer(U))return Buffer.allocUnsafe?E=Buffer.allocUnsafe(U.length):E=new Buffer(U.length),U.copy(E),E;a(U,Error)?E=Object.create(U):typeof y>"u"?(D=Object.getPrototypeOf(U),E=Object.create(D)):(E=Object.create(y),D=y)}if(g){var R=I.indexOf(U);if(R!=-1)return T[R];I.push(U),T.push(E)}a(U,o)&&U.forEach(function(x,$){var j=S($,P-1),V=S(x,P-1);E.set(j,V)}),a(U,s)&&U.forEach(function(x){var $=S(x,P-1);E.add($)});for(var N in U){var M;D&&(M=Object.getOwnPropertyDescriptor(D,N)),!(M&&M.set==null)&&(E[N]=S(U[N],P-1))}if(Object.getOwnPropertySymbols)for(var A=Object.getOwnPropertySymbols(U),N=0;N<A.length;N++){var _=A[N],k=Object.getOwnPropertyDescriptor(U,_);k&&!k.enumerable&&!b||(E[_]=S(U[_],P-1),k.enumerable||Object.defineProperty(E,_,{enumerable:!1}))}if(b)for(var B=Object.getOwnPropertyNames(U),N=0;N<B.length;N++){var F=B[N],k=Object.getOwnPropertyDescriptor(U,F);k&&k.enumerable||(E[F]=S(U[F],P-1),Object.defineProperty(E,F,{enumerable:!1}))}return E}return S(m,v)}u.clonePrototype=function(g){if(g===null)return null;var v=function(){};return v.prototype=g,new v};function c(m){return Object.prototype.toString.call(m)}u.__objToStr=c;function d(m){return typeof m=="object"&&c(m)==="[object Date]"}u.__isDate=d;function p(m){return typeof m=="object"&&c(m)==="[object Array]"}u.__isArray=p;function f(m){return typeof m=="object"&&c(m)==="[object RegExp]"}u.__isRegExp=f;function h(m){var g="";return m.global&&(g+="g"),m.ignoreCase&&(g+="i"),m.multiline&&(g+="m"),g}return u.__getRegExpFlags=h,u}();typeof i=="object"&&i.exports&&(i.exports=r)},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function E(D,R){var N=[],M=!0,A=!1,_=void 0;try{for(var k=D[Symbol.iterator](),B;!(M=(B=k.next()).done)&&(N.push(B.value),!(R&&N.length===R));M=!0);}catch(F){A=!0,_=F}finally{try{!M&&k.return&&k.return()}finally{if(A)throw _}}return N}return function(D,R){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return E(D,R);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function E(D,R){for(var N=0;N<R.length;N++){var M=R[N];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(D,M.key,M)}}return function(D,R,N){return R&&E(D.prototype,R),N&&E(D,N),D}}(),s=function E(D,R,N){D===null&&(D=Function.prototype);var M=Object.getOwnPropertyDescriptor(D,R);if(M===void 0){var A=Object.getPrototypeOf(D);return A===null?void 0:E(A,R,N)}else{if("value"in M)return M.value;var _=M.get;return _===void 0?void 0:_.call(N)}},l=r(0),u=I(l),c=r(8),d=I(c),p=r(4),f=I(p),h=r(16),m=I(h),g=r(13),v=I(g),y=r(25),b=I(y);function I(E){return E&&E.__esModule?E:{default:E}}function T(E,D){if(!(E instanceof D))throw new TypeError("Cannot call a class as a function")}function w(E,D){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:E}function S(E,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);E.prototype=Object.create(D&&D.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(E,D):E.__proto__=D)}function U(E){return E instanceof f.default||E instanceof p.BlockEmbed}var P=function(E){S(D,E);function D(R,N){T(this,D);var M=w(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,R));return M.emitter=N.emitter,Array.isArray(N.whitelist)&&(M.whitelist=N.whitelist.reduce(function(A,_){return A[_]=!0,A},{})),M.domNode.addEventListener("DOMNodeInserted",function(){}),M.optimize(),M.enable(),M}return o(D,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(N,M){var A=this.line(N),_=a(A,2),k=_[0],B=_[1],F=this.line(N+M),x=a(F,1),$=x[0];if(s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"deleteAt",this).call(this,N,M),$!=null&&k!==$&&B>0){if(k instanceof p.BlockEmbed||$ instanceof p.BlockEmbed){this.optimize();return}if(k instanceof v.default){var j=k.newlineIndex(k.length(),!0);if(j>-1&&(k=k.split(j+1),k===$)){this.optimize();return}}else if($ instanceof v.default){var V=$.newlineIndex(0);V>-1&&$.split(V+1)}var H=$.children.head instanceof m.default?null:$.children.head;k.moveChildren($,H),k.remove()}this.optimize()}},{key:"enable",value:function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",N)}},{key:"formatAt",value:function(N,M,A,_){this.whitelist!=null&&!this.whitelist[A]||(s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"formatAt",this).call(this,N,M,A,_),this.optimize())}},{key:"insertAt",value:function(N,M,A){if(!(A!=null&&this.whitelist!=null&&!this.whitelist[M])){if(N>=this.length())if(A==null||u.default.query(M,u.default.Scope.BLOCK)==null){var _=u.default.create(this.statics.defaultChild);this.appendChild(_),A==null&&M.endsWith(`
`)&&(M=M.slice(0,-1)),_.insertAt(0,M,A)}else{var k=u.default.create(M,A);this.appendChild(k)}else s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"insertAt",this).call(this,N,M,A);this.optimize()}}},{key:"insertBefore",value:function(N,M){if(N.statics.scope===u.default.Scope.INLINE_BLOT){var A=u.default.create(this.statics.defaultChild);A.appendChild(N),N=A}s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"insertBefore",this).call(this,N,M)}},{key:"leaf",value:function(N){return this.path(N).pop()||[null,-1]}},{key:"line",value:function(N){return N===this.length()?this.line(N-1):this.descendant(U,N)}},{key:"lines",value:function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,A=function _(k,B,F){var x=[],$=F;return k.children.forEachAt(B,F,function(j,V,H){U(j)?x.push(j):j instanceof u.default.Container&&(x=x.concat(_(j,V,$))),$-=H}),x};return A(this,N,M)}},{key:"optimize",value:function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"optimize",this).call(this,N,M),N.length>0&&this.emitter.emit(d.default.events.SCROLL_OPTIMIZE,N,M))}},{key:"path",value:function(N){return s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"path",this).call(this,N).slice(1)}},{key:"update",value:function(N){if(this.batch!==!0){var M=d.default.sources.USER;typeof N=="string"&&(M=N),Array.isArray(N)||(N=this.observer.takeRecords()),N.length>0&&this.emitter.emit(d.default.events.SCROLL_BEFORE_UPDATE,M,N),s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"update",this).call(this,N.concat([])),N.length>0&&this.emitter.emit(d.default.events.SCROLL_UPDATE,M,N)}}}]),D}(u.default.Scroll);P.blotName="scroll",P.className="ql-editor",P.tagName="DIV",P.defaultChild="block",P.allowedChildren=[f.default,p.BlockEmbed,b.default],n.default=P},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.SHORTKEY=n.default=void 0;var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},o=function(){function q(W,Y){var Z=[],X=!0,Q=!1,ce=void 0;try{for(var J=W[Symbol.iterator](),ee;!(X=(ee=J.next()).done)&&(Z.push(ee.value),!(Y&&Z.length===Y));X=!0);}catch(ne){Q=!0,ce=ne}finally{try{!X&&J.return&&J.return()}finally{if(Q)throw ce}}return Z}return function(W,Y){if(Array.isArray(W))return W;if(Symbol.iterator in Object(W))return q(W,Y);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function q(W,Y){for(var Z=0;Z<Y.length;Z++){var X=Y[Z];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(W,X.key,X)}}return function(W,Y,Z){return Y&&q(W.prototype,Y),Z&&q(W,Z),W}}(),l=r(21),u=E(l),c=r(11),d=E(c),p=r(3),f=E(p),h=r(2),m=E(h),g=r(20),v=E(g),y=r(0),b=E(y),I=r(5),T=E(I),w=r(10),S=E(w),U=r(9),P=E(U);function E(q){return q&&q.__esModule?q:{default:q}}function D(q,W,Y){return W in q?Object.defineProperty(q,W,{value:Y,enumerable:!0,configurable:!0,writable:!0}):q[W]=Y,q}function R(q,W){if(!(q instanceof W))throw new TypeError("Cannot call a class as a function")}function N(q,W){if(!q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W&&(typeof W=="object"||typeof W=="function")?W:q}function M(q,W){if(typeof W!="function"&&W!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof W);q.prototype=Object.create(W&&W.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),W&&(Object.setPrototypeOf?Object.setPrototypeOf(q,W):q.__proto__=W)}var A=(0,S.default)("quill:keyboard"),_=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",k=function(q){M(W,q),s(W,null,[{key:"match",value:function(Z,X){return X=z(X),["altKey","ctrlKey","metaKey","shiftKey"].some(function(Q){return!!X[Q]!==Z[Q]&&X[Q]!==null})?!1:X.key===(Z.which||Z.keyCode)}}]);function W(Y,Z){R(this,W);var X=N(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,Y,Z));return X.bindings={},Object.keys(X.options.bindings).forEach(function(Q){Q==="list autofill"&&Y.scroll.whitelist!=null&&!Y.scroll.whitelist.list||X.options.bindings[Q]&&X.addBinding(X.options.bindings[Q])}),X.addBinding({key:W.keys.ENTER,shiftKey:null},j),X.addBinding({key:W.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(X.addBinding({key:W.keys.BACKSPACE},{collapsed:!0},F),X.addBinding({key:W.keys.DELETE},{collapsed:!0},x)):(X.addBinding({key:W.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},F),X.addBinding({key:W.keys.DELETE},{collapsed:!0,suffix:/^.?$/},x)),X.addBinding({key:W.keys.BACKSPACE},{collapsed:!1},$),X.addBinding({key:W.keys.DELETE},{collapsed:!1},$),X.addBinding({key:W.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},F),X.listen(),X}return s(W,[{key:"addBinding",value:function(Z){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},ce=z(Z);if(ce==null||ce.key==null)return A.warn("Attempted to add invalid keyboard binding",ce);typeof X=="function"&&(X={handler:X}),typeof Q=="function"&&(Q={handler:Q}),ce=(0,f.default)(ce,X,Q),this.bindings[ce.key]=this.bindings[ce.key]||[],this.bindings[ce.key].push(ce)}},{key:"listen",value:function(){var Z=this;this.quill.root.addEventListener("keydown",function(X){if(!X.defaultPrevented){var Q=X.which||X.keyCode,ce=(Z.bindings[Q]||[]).filter(function(Le){return W.match(X,Le)});if(ce.length!==0){var J=Z.quill.getSelection();if(!(J==null||!Z.quill.hasFocus())){var ee=Z.quill.getLine(J.index),ne=o(ee,2),ie=ne[0],oe=ne[1],se=Z.quill.getLeaf(J.index),pe=o(se,2),fe=pe[0],ge=pe[1],me=J.length===0?[fe,ge]:Z.quill.getLeaf(J.index+J.length),Ee=o(me,2),Be=Ee[0],Pe=Ee[1],et=fe instanceof b.default.Text?fe.value().slice(0,ge):"",Ie=Be instanceof b.default.Text?Be.value().slice(Pe):"",Ne={collapsed:J.length===0,empty:J.length===0&&ie.length()<=1,format:Z.quill.getFormat(J),offset:oe,prefix:et,suffix:Ie},be=ce.some(function(Le){if(Le.collapsed!=null&&Le.collapsed!==Ne.collapsed||Le.empty!=null&&Le.empty!==Ne.empty||Le.offset!=null&&Le.offset!==Ne.offset)return!1;if(Array.isArray(Le.format)){if(Le.format.every(function(Me){return Ne.format[Me]==null}))return!1}else if(a(Le.format)==="object"&&!Object.keys(Le.format).every(function(Me){return Le.format[Me]===!0?Ne.format[Me]!=null:Le.format[Me]===!1?Ne.format[Me]==null:(0,d.default)(Le.format[Me],Ne.format[Me])}))return!1;return Le.prefix!=null&&!Le.prefix.test(Ne.prefix)||Le.suffix!=null&&!Le.suffix.test(Ne.suffix)?!1:Le.handler.call(Z,J,Ne)!==!0});be&&X.preventDefault()}}}})}}]),W}(P.default);k.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},k.DEFAULTS={bindings:{bold:H("bold"),italic:H("italic"),underline:H("underline"),indent:{key:k.keys.TAB,format:["blockquote","indent","list"],handler:function(W,Y){if(Y.collapsed&&Y.offset!==0)return!0;this.quill.format("indent","+1",T.default.sources.USER)}},outdent:{key:k.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(W,Y){if(Y.collapsed&&Y.offset!==0)return!0;this.quill.format("indent","-1",T.default.sources.USER)}},"outdent backspace":{key:k.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(W,Y){Y.format.indent!=null?this.quill.format("indent","-1",T.default.sources.USER):Y.format.list!=null&&this.quill.format("list",!1,T.default.sources.USER)}},"indent code-block":V(!0),"outdent code-block":V(!1),"remove tab":{key:k.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(W){this.quill.deleteText(W.index-1,1,T.default.sources.USER)}},tab:{key:k.keys.TAB,handler:function(W){this.quill.history.cutoff();var Y=new m.default().retain(W.index).delete(W.length).insert("	");this.quill.updateContents(Y,T.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(W.index+1,T.default.sources.SILENT)}},"list empty enter":{key:k.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(W,Y){this.quill.format("list",!1,T.default.sources.USER),Y.format.indent&&this.quill.format("indent",!1,T.default.sources.USER)}},"checklist enter":{key:k.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(W){var Y=this.quill.getLine(W.index),Z=o(Y,2),X=Z[0],Q=Z[1],ce=(0,f.default)({},X.formats(),{list:"checked"}),J=new m.default().retain(W.index).insert(`
`,ce).retain(X.length()-Q-1).retain(1,{list:"unchecked"});this.quill.updateContents(J,T.default.sources.USER),this.quill.setSelection(W.index+1,T.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:k.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(W,Y){var Z=this.quill.getLine(W.index),X=o(Z,2),Q=X[0],ce=X[1],J=new m.default().retain(W.index).insert(`
`,Y.format).retain(Q.length()-ce-1).retain(1,{header:null});this.quill.updateContents(J,T.default.sources.USER),this.quill.setSelection(W.index+1,T.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(W,Y){var Z=Y.prefix.length,X=this.quill.getLine(W.index),Q=o(X,2),ce=Q[0],J=Q[1];if(J>Z)return!0;var ee=void 0;switch(Y.prefix.trim()){case"[]":case"[ ]":ee="unchecked";break;case"[x]":ee="checked";break;case"-":case"*":ee="bullet";break;default:ee="ordered"}this.quill.insertText(W.index," ",T.default.sources.USER),this.quill.history.cutoff();var ne=new m.default().retain(W.index-J).delete(Z+1).retain(ce.length()-2-J).retain(1,{list:ee});this.quill.updateContents(ne,T.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(W.index-Z,T.default.sources.SILENT)}},"code exit":{key:k.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(W){var Y=this.quill.getLine(W.index),Z=o(Y,2),X=Z[0],Q=Z[1],ce=new m.default().retain(W.index+X.length()-Q-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(ce,T.default.sources.USER)}},"embed left":B(k.keys.LEFT,!1),"embed left shift":B(k.keys.LEFT,!0),"embed right":B(k.keys.RIGHT,!1),"embed right shift":B(k.keys.RIGHT,!0)}};function B(q,W){var Y,Z=q===k.keys.LEFT?"prefix":"suffix";return Y={key:q,shiftKey:W,altKey:null},D(Y,Z,/^$/),D(Y,"handler",function(Q){var ce=Q.index;q===k.keys.RIGHT&&(ce+=Q.length+1);var J=this.quill.getLeaf(ce),ee=o(J,1),ne=ee[0];return ne instanceof b.default.Embed?(q===k.keys.LEFT?W?this.quill.setSelection(Q.index-1,Q.length+1,T.default.sources.USER):this.quill.setSelection(Q.index-1,T.default.sources.USER):W?this.quill.setSelection(Q.index,Q.length+1,T.default.sources.USER):this.quill.setSelection(Q.index+Q.length+1,T.default.sources.USER),!1):!0}),Y}function F(q,W){if(!(q.index===0||this.quill.getLength()<=1)){var Y=this.quill.getLine(q.index),Z=o(Y,1),X=Z[0],Q={};if(W.offset===0){var ce=this.quill.getLine(q.index-1),J=o(ce,1),ee=J[0];if(ee!=null&&ee.length()>1){var ne=X.formats(),ie=this.quill.getFormat(q.index-1,1);Q=v.default.attributes.diff(ne,ie)||{}}}var oe=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(W.prefix)?2:1;this.quill.deleteText(q.index-oe,oe,T.default.sources.USER),Object.keys(Q).length>0&&this.quill.formatLine(q.index-oe,oe,Q,T.default.sources.USER),this.quill.focus()}}function x(q,W){var Y=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(W.suffix)?2:1;if(!(q.index>=this.quill.getLength()-Y)){var Z={},X=0,Q=this.quill.getLine(q.index),ce=o(Q,1),J=ce[0];if(W.offset>=J.length()-1){var ee=this.quill.getLine(q.index+1),ne=o(ee,1),ie=ne[0];if(ie){var oe=J.formats(),se=this.quill.getFormat(q.index,1);Z=v.default.attributes.diff(oe,se)||{},X=ie.length()}}this.quill.deleteText(q.index,Y,T.default.sources.USER),Object.keys(Z).length>0&&this.quill.formatLine(q.index+X-1,Y,Z,T.default.sources.USER)}}function $(q){var W=this.quill.getLines(q),Y={};if(W.length>1){var Z=W[0].formats(),X=W[W.length-1].formats();Y=v.default.attributes.diff(X,Z)||{}}this.quill.deleteText(q,T.default.sources.USER),Object.keys(Y).length>0&&this.quill.formatLine(q.index,1,Y,T.default.sources.USER),this.quill.setSelection(q.index,T.default.sources.SILENT),this.quill.focus()}function j(q,W){var Y=this;q.length>0&&this.quill.scroll.deleteAt(q.index,q.length);var Z=Object.keys(W.format).reduce(function(X,Q){return b.default.query(Q,b.default.Scope.BLOCK)&&!Array.isArray(W.format[Q])&&(X[Q]=W.format[Q]),X},{});this.quill.insertText(q.index,`
`,Z,T.default.sources.USER),this.quill.setSelection(q.index+1,T.default.sources.SILENT),this.quill.focus(),Object.keys(W.format).forEach(function(X){Z[X]==null&&(Array.isArray(W.format[X])||X!=="link"&&Y.quill.format(X,W.format[X],T.default.sources.USER))})}function V(q){return{key:k.keys.TAB,shiftKey:!q,format:{"code-block":!0},handler:function(Y){var Z=b.default.query("code-block"),X=Y.index,Q=Y.length,ce=this.quill.scroll.descendant(Z,X),J=o(ce,2),ee=J[0],ne=J[1];if(ee!=null){var ie=this.quill.getIndex(ee),oe=ee.newlineIndex(ne,!0)+1,se=ee.newlineIndex(ie+ne+Q),pe=ee.domNode.textContent.slice(oe,se).split(`
`);ne=0,pe.forEach(function(fe,ge){q?(ee.insertAt(oe+ne,Z.TAB),ne+=Z.TAB.length,ge===0?X+=Z.TAB.length:Q+=Z.TAB.length):fe.startsWith(Z.TAB)&&(ee.deleteAt(oe+ne,Z.TAB.length),ne-=Z.TAB.length,ge===0?X-=Z.TAB.length:Q-=Z.TAB.length),ne+=fe.length+1}),this.quill.update(T.default.sources.USER),this.quill.setSelection(X,Q,T.default.sources.SILENT)}}}}function H(q){return{key:q[0].toUpperCase(),shortKey:!0,handler:function(Y,Z){this.quill.format(q,!Z.format[q],T.default.sources.USER)}}}function z(q){if(typeof q=="string"||typeof q=="number")return z({key:q});if((typeof q>"u"?"undefined":a(q))==="object"&&(q=(0,u.default)(q,!1)),typeof q.key=="string")if(k.keys[q.key.toUpperCase()]!=null)q.key=k.keys[q.key.toUpperCase()];else if(q.key.length===1)q.key=q.key.toUpperCase().charCodeAt(0);else return null;return q.shortKey&&(q[_]=q.shortKey,delete q.shortKey),q}n.default=k,n.SHORTKEY=_},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function v(y,b){var I=[],T=!0,w=!1,S=void 0;try{for(var U=y[Symbol.iterator](),P;!(T=(P=U.next()).done)&&(I.push(P.value),!(b&&I.length===b));T=!0);}catch(E){w=!0,S=E}finally{try{!T&&U.return&&U.return()}finally{if(w)throw S}}return I}return function(y,b){if(Array.isArray(y))return y;if(Symbol.iterator in Object(y))return v(y,b);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function v(y,b,I){y===null&&(y=Function.prototype);var T=Object.getOwnPropertyDescriptor(y,b);if(T===void 0){var w=Object.getPrototypeOf(y);return w===null?void 0:v(w,b,I)}else{if("value"in T)return T.value;var S=T.get;return S===void 0?void 0:S.call(I)}},s=function(){function v(y,b){for(var I=0;I<b.length;I++){var T=b[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,b,I){return b&&v(y.prototype,b),I&&v(y,I),y}}(),l=r(0),u=p(l),c=r(7),d=p(c);function p(v){return v&&v.__esModule?v:{default:v}}function f(v,y){if(!(v instanceof y))throw new TypeError("Cannot call a class as a function")}function h(v,y){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:v}function m(v,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);v.prototype=Object.create(y&&y.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(v,y):v.__proto__=y)}var g=function(v){m(y,v),s(y,null,[{key:"value",value:function(){}}]);function y(b,I){f(this,y);var T=h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,b));return T.selection=I,T.textNode=document.createTextNode(y.CONTENTS),T.domNode.appendChild(T.textNode),T._length=0,T}return s(y,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(I,T){if(this._length!==0)return o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"format",this).call(this,I,T);for(var w=this,S=0;w!=null&&w.statics.scope!==u.default.Scope.BLOCK_BLOT;)S+=w.offset(w.parent),w=w.parent;w!=null&&(this._length=y.CONTENTS.length,w.optimize(),w.formatAt(S,y.CONTENTS.length,I,T),this._length=0)}},{key:"index",value:function(I,T){return I===this.textNode?0:o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"index",this).call(this,I,T)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var I=this.textNode,T=this.selection.getNativeRange(),w=void 0,S=void 0,U=void 0;if(T!=null&&T.start.node===I&&T.end.node===I){var P=[I,T.start.offset,T.end.offset];w=P[0],S=P[1],U=P[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==y.CONTENTS){var E=this.textNode.data.split(y.CONTENTS).join("");this.next instanceof d.default?(w=this.next.domNode,this.next.insertAt(0,E),this.textNode.data=y.CONTENTS):(this.textNode.data=E,this.parent.insertBefore(u.default.create(this.textNode),this),this.textNode=document.createTextNode(y.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),S!=null){var D=[S,U].map(function(N){return Math.max(0,Math.min(w.data.length,N-1))}),R=a(D,2);return S=R[0],U=R[1],{startNode:w,startOffset:S,endNode:w,endOffset:U}}}}},{key:"update",value:function(I,T){var w=this;if(I.some(function(U){return U.type==="characterData"&&U.target===w.textNode})){var S=this.restore();S&&(T.range=S)}}},{key:"value",value:function(){return""}}]),y}(u.default.Embed);g.blotName="cursor",g.className="ql-cursor",g.tagName="span",g.CONTENTS="\uFEFF",n.default=g},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(0),o=u(a),s=r(4),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(){return c(this,m),d(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return m}(o.default.Container);f.allowedChildren=[l.default,s.BlockEmbed,f],n.default=f},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.ColorStyle=n.ColorClass=n.ColorAttributor=void 0;var a=function(){function g(v,y){for(var b=0;b<y.length;b++){var I=y[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,y,b){return y&&g(v.prototype,y),b&&g(v,b),v}}(),o=function g(v,y,b){v===null&&(v=Function.prototype);var I=Object.getOwnPropertyDescriptor(v,y);if(I===void 0){var T=Object.getPrototypeOf(v);return T===null?void 0:g(T,y,b)}else{if("value"in I)return I.value;var w=I.get;return w===void 0?void 0:w.call(b)}},s=r(0),l=u(s);function u(g){return g&&g.__esModule?g:{default:g}}function c(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function p(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var f=function(g){p(v,g);function v(){return c(this,v),d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return a(v,[{key:"value",value:function(b){var I=o(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"value",this).call(this,b);return I.startsWith("rgb(")?(I=I.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+I.split(",").map(function(T){return("00"+parseInt(T).toString(16)).slice(-2)}).join("")):I}}]),v}(l.default.Attributor.Style),h=new l.default.Attributor.Class("color","ql-color",{scope:l.default.Scope.INLINE}),m=new f("color","color",{scope:l.default.Scope.INLINE});n.ColorAttributor=f,n.ColorClass=h,n.ColorStyle=m},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitize=n.default=void 0;var a=function(){function m(g,v){for(var y=0;y<v.length;y++){var b=v[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(g,b.key,b)}}return function(g,v,y){return v&&m(g.prototype,v),y&&m(g,y),g}}(),o=function m(g,v,y){g===null&&(g=Function.prototype);var b=Object.getOwnPropertyDescriptor(g,v);if(b===void 0){var I=Object.getPrototypeOf(g);return I===null?void 0:m(I,v,y)}else{if("value"in b)return b.value;var T=b.get;return T===void 0?void 0:T.call(y)}},s=r(6),l=u(s);function u(m){return m&&m.__esModule?m:{default:m}}function c(m,g){if(!(m instanceof g))throw new TypeError("Cannot call a class as a function")}function d(m,g){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:m}function p(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);m.prototype=Object.create(g&&g.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(m,g):m.__proto__=g)}var f=function(m){p(g,m);function g(){return c(this,g),d(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments))}return a(g,[{key:"format",value:function(y,b){if(y!==this.statics.blotName||!b)return o(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"format",this).call(this,y,b);b=this.constructor.sanitize(b),this.domNode.setAttribute("href",b)}}],[{key:"create",value:function(y){var b=o(g.__proto__||Object.getPrototypeOf(g),"create",this).call(this,y);return y=this.sanitize(y),b.setAttribute("href",y),b.setAttribute("rel","noopener noreferrer"),b.setAttribute("target","_blank"),b}},{key:"formats",value:function(y){return y.getAttribute("href")}},{key:"sanitize",value:function(y){return h(y,this.PROTOCOL_WHITELIST)?y:this.SANITIZED_URL}}]),g}(l.default);f.blotName="link",f.tagName="A",f.SANITIZED_URL="about:blank",f.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function h(m,g){var v=document.createElement("a");v.href=m;var y=v.href.slice(0,v.href.indexOf(":"));return g.indexOf(y)>-1}n.default=f,n.sanitize=h},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},o=function(){function g(v,y){for(var b=0;b<y.length;b++){var I=y[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,y,b){return y&&g(v.prototype,y),b&&g(v,b),v}}(),s=r(23),l=d(s),u=r(107),c=d(u);function d(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}var f=0;function h(g,v){g.setAttribute(v,g.getAttribute(v)!=="true")}var m=function(){function g(v){var y=this;p(this,g),this.select=v,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){y.togglePicker()}),this.label.addEventListener("keydown",function(b){switch(b.keyCode){case l.default.keys.ENTER:y.togglePicker();break;case l.default.keys.ESCAPE:y.escape(),b.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return o(g,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),h(this.label,"aria-expanded"),h(this.options,"aria-hidden")}},{key:"buildItem",value:function(y){var b=this,I=document.createElement("span");return I.tabIndex="0",I.setAttribute("role","button"),I.classList.add("ql-picker-item"),y.hasAttribute("value")&&I.setAttribute("data-value",y.getAttribute("value")),y.textContent&&I.setAttribute("data-label",y.textContent),I.addEventListener("click",function(){b.selectItem(I,!0)}),I.addEventListener("keydown",function(T){switch(T.keyCode){case l.default.keys.ENTER:b.selectItem(I,!0),T.preventDefault();break;case l.default.keys.ESCAPE:b.escape(),T.preventDefault();break}}),I}},{key:"buildLabel",value:function(){var y=document.createElement("span");return y.classList.add("ql-picker-label"),y.innerHTML=c.default,y.tabIndex="0",y.setAttribute("role","button"),y.setAttribute("aria-expanded","false"),this.container.appendChild(y),y}},{key:"buildOptions",value:function(){var y=this,b=document.createElement("span");b.classList.add("ql-picker-options"),b.setAttribute("aria-hidden","true"),b.tabIndex="-1",b.id="ql-picker-options-"+f,f+=1,this.label.setAttribute("aria-controls",b.id),this.options=b,[].slice.call(this.select.options).forEach(function(I){var T=y.buildItem(I);b.appendChild(T),I.selected===!0&&y.selectItem(T)}),this.container.appendChild(b)}},{key:"buildPicker",value:function(){var y=this;[].slice.call(this.select.attributes).forEach(function(b){y.container.setAttribute(b.name,b.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var y=this;this.close(),setTimeout(function(){return y.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(y){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,I=this.container.querySelector(".ql-selected");if(y!==I&&(I!=null&&I.classList.remove("ql-selected"),y!=null&&(y.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(y.parentNode.children,y),y.hasAttribute("data-value")?this.label.setAttribute("data-value",y.getAttribute("data-value")):this.label.removeAttribute("data-value"),y.hasAttribute("data-label")?this.label.setAttribute("data-label",y.getAttribute("data-label")):this.label.removeAttribute("data-label"),b))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":a(Event))==="object"){var T=document.createEvent("Event");T.initEvent("change",!0,!0),this.select.dispatchEvent(T)}this.close()}}},{key:"update",value:function(){var y=void 0;if(this.select.selectedIndex>-1){var b=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];y=this.select.options[this.select.selectedIndex],this.selectItem(b)}else this.selectItem(null);var I=y!=null&&y!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",I)}}]),g}();n.default=m},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(0),o=A(a),s=r(5),l=A(s),u=r(4),c=A(u),d=r(16),p=A(d),f=r(25),h=A(f),m=r(24),g=A(m),v=r(35),y=A(v),b=r(6),I=A(b),T=r(22),w=A(T),S=r(7),U=A(S),P=r(55),E=A(P),D=r(42),R=A(D),N=r(23),M=A(N);function A(_){return _&&_.__esModule?_:{default:_}}l.default.register({"blots/block":c.default,"blots/block/embed":u.BlockEmbed,"blots/break":p.default,"blots/container":h.default,"blots/cursor":g.default,"blots/embed":y.default,"blots/inline":I.default,"blots/scroll":w.default,"blots/text":U.default,"modules/clipboard":E.default,"modules/history":R.default,"modules/keyboard":M.default}),o.default.register(c.default,p.default,g.default,I.default,w.default,U.default),n.default=l.default},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(1),o=function(){function s(l){this.domNode=l,this.domNode[a.DATA_KEY]={blot:this}}return Object.defineProperty(s.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),s.create=function(l){if(this.tagName==null)throw new a.ParchmentError("Blot definition missing tagName");var u;return Array.isArray(this.tagName)?(typeof l=="string"&&(l=l.toUpperCase(),parseInt(l).toString()===l&&(l=parseInt(l))),typeof l=="number"?u=document.createElement(this.tagName[l-1]):this.tagName.indexOf(l)>-1?u=document.createElement(l):u=document.createElement(this.tagName[0])):u=document.createElement(this.tagName),this.className&&u.classList.add(this.className),u},s.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},s.prototype.clone=function(){var l=this.domNode.cloneNode(!1);return a.create(l)},s.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[a.DATA_KEY]},s.prototype.deleteAt=function(l,u){var c=this.isolate(l,u);c.remove()},s.prototype.formatAt=function(l,u,c,d){var p=this.isolate(l,u);if(a.query(c,a.Scope.BLOT)!=null&&d)p.wrap(c,d);else if(a.query(c,a.Scope.ATTRIBUTE)!=null){var f=a.create(this.statics.scope);p.wrap(f),f.format(c,d)}},s.prototype.insertAt=function(l,u,c){var d=c==null?a.create("text",u):a.create(u,c),p=this.split(l);this.parent.insertBefore(d,p)},s.prototype.insertInto=function(l,u){u===void 0&&(u=null),this.parent!=null&&this.parent.children.remove(this);var c=null;l.children.insertBefore(this,u),u!=null&&(c=u.domNode),(this.domNode.parentNode!=l.domNode||this.domNode.nextSibling!=c)&&l.domNode.insertBefore(this.domNode,c),this.parent=l,this.attach()},s.prototype.isolate=function(l,u){var c=this.split(l);return c.split(u),c},s.prototype.length=function(){return 1},s.prototype.offset=function(l){return l===void 0&&(l=this.parent),this.parent==null||this==l?0:this.parent.children.offset(this)+this.parent.offset(l)},s.prototype.optimize=function(l){this.domNode[a.DATA_KEY]!=null&&delete this.domNode[a.DATA_KEY].mutations},s.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},s.prototype.replace=function(l){l.parent!=null&&(l.parent.insertBefore(this,l.next),l.remove())},s.prototype.replaceWith=function(l,u){var c=typeof l=="string"?a.create(l,u):l;return c.replace(this),c},s.prototype.split=function(l,u){return l===0?this:this.next},s.prototype.update=function(l,u){},s.prototype.wrap=function(l,u){var c=typeof l=="string"?a.create(l,u):l;return this.parent!=null&&this.parent.insertBefore(c,this.next),c.appendChild(this),c},s.blotName="abstract",s}();n.default=o},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(12),o=r(32),s=r(33),l=r(1),u=function(){function c(d){this.attributes={},this.domNode=d,this.build()}return c.prototype.attribute=function(d,p){p?d.add(this.domNode,p)&&(d.value(this.domNode)!=null?this.attributes[d.attrName]=d:delete this.attributes[d.attrName]):(d.remove(this.domNode),delete this.attributes[d.attrName])},c.prototype.build=function(){var d=this;this.attributes={};var p=a.default.keys(this.domNode),f=o.default.keys(this.domNode),h=s.default.keys(this.domNode);p.concat(f).concat(h).forEach(function(m){var g=l.query(m,l.Scope.ATTRIBUTE);g instanceof a.default&&(d.attributes[g.attrName]=g)})},c.prototype.copy=function(d){var p=this;Object.keys(this.attributes).forEach(function(f){var h=p.attributes[f].value(p.domNode);d.format(f,h)})},c.prototype.move=function(d){var p=this;this.copy(d),Object.keys(this.attributes).forEach(function(f){p.attributes[f].remove(p.domNode)}),this.attributes={}},c.prototype.values=function(){var d=this;return Object.keys(this.attributes).reduce(function(p,f){return p[f]=d.attributes[f].value(d.domNode),p},{})},c}();n.default=u},function(i,n,r){var a=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var p in d)d.hasOwnProperty(p)&&(c[p]=d[p])};return function(c,d){u(c,d);function p(){this.constructor=c}c.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(12);function s(u,c){var d=u.getAttribute("class")||"";return d.split(/\s+/).filter(function(p){return p.indexOf(c+"-")===0})}var l=function(u){a(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.keys=function(d){return(d.getAttribute("class")||"").split(/\s+/).map(function(p){return p.split("-").slice(0,-1).join("-")})},c.prototype.add=function(d,p){return this.canAdd(d,p)?(this.remove(d),d.classList.add(this.keyName+"-"+p),!0):!1},c.prototype.remove=function(d){var p=s(d,this.keyName);p.forEach(function(f){d.classList.remove(f)}),d.classList.length===0&&d.removeAttribute("class")},c.prototype.value=function(d){var p=s(d,this.keyName)[0]||"",f=p.slice(this.keyName.length+1);return this.canAdd(d,f)?f:""},c}(o.default);n.default=l},function(i,n,r){var a=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var p in d)d.hasOwnProperty(p)&&(c[p]=d[p])};return function(c,d){u(c,d);function p(){this.constructor=c}c.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(12);function s(u){var c=u.split("-"),d=c.slice(1).map(function(p){return p[0].toUpperCase()+p.slice(1)}).join("");return c[0]+d}var l=function(u){a(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.keys=function(d){return(d.getAttribute("style")||"").split(";").map(function(p){var f=p.split(":");return f[0].trim()})},c.prototype.add=function(d,p){return this.canAdd(d,p)?(d.style[s(this.keyName)]=p,!0):!1},c.prototype.remove=function(d){d.style[s(this.keyName)]="",d.getAttribute("style")||d.removeAttribute("style")},c.prototype.value=function(d){var p=d.style[s(this.keyName)];return this.canAdd(d,p)?p:""},c}(o.default);n.default=l},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function l(u,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}return function(u,c,d){return c&&l(u.prototype,c),d&&l(u,d),u}}();function o(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var s=function(){function l(u,c){o(this,l),this.quill=u,this.options=c,this.modules={}}return a(l,[{key:"init",value:function(){var c=this;Object.keys(this.options.modules).forEach(function(d){c.modules[d]==null&&c.addModule(d)})}},{key:"addModule",value:function(c){var d=this.quill.constructor.import("modules/"+c);return this.modules[c]=new d(this.quill,this.options.modules[c]||{}),this.modules[c]}}]),l}();s.DEFAULTS={modules:{}},s.themes={default:s},n.default=s},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function v(y,b){for(var I=0;I<b.length;I++){var T=b[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,b,I){return b&&v(y.prototype,b),I&&v(y,I),y}}(),o=function v(y,b,I){y===null&&(y=Function.prototype);var T=Object.getOwnPropertyDescriptor(y,b);if(T===void 0){var w=Object.getPrototypeOf(y);return w===null?void 0:v(w,b,I)}else{if("value"in T)return T.value;var S=T.get;return S===void 0?void 0:S.call(I)}},s=r(0),l=d(s),u=r(7),c=d(u);function d(v){return v&&v.__esModule?v:{default:v}}function p(v,y){if(!(v instanceof y))throw new TypeError("Cannot call a class as a function")}function f(v,y){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:v}function h(v,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);v.prototype=Object.create(y&&y.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(v,y):v.__proto__=y)}var m="\uFEFF",g=function(v){h(y,v);function y(b){p(this,y);var I=f(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,b));return I.contentNode=document.createElement("span"),I.contentNode.setAttribute("contenteditable",!1),[].slice.call(I.domNode.childNodes).forEach(function(T){I.contentNode.appendChild(T)}),I.leftGuard=document.createTextNode(m),I.rightGuard=document.createTextNode(m),I.domNode.appendChild(I.leftGuard),I.domNode.appendChild(I.contentNode),I.domNode.appendChild(I.rightGuard),I}return a(y,[{key:"index",value:function(I,T){return I===this.leftGuard?0:I===this.rightGuard?1:o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"index",this).call(this,I,T)}},{key:"restore",value:function(I){var T=void 0,w=void 0,S=I.data.split(m).join("");if(I===this.leftGuard)if(this.prev instanceof c.default){var U=this.prev.length();this.prev.insertAt(U,S),T={startNode:this.prev.domNode,startOffset:U+S.length}}else w=document.createTextNode(S),this.parent.insertBefore(l.default.create(w),this),T={startNode:w,startOffset:S.length};else I===this.rightGuard&&(this.next instanceof c.default?(this.next.insertAt(0,S),T={startNode:this.next.domNode,startOffset:S.length}):(w=document.createTextNode(S),this.parent.insertBefore(l.default.create(w),this.next),T={startNode:w,startOffset:S.length}));return I.data=m,T}},{key:"update",value:function(I,T){var w=this;I.forEach(function(S){if(S.type==="characterData"&&(S.target===w.leftGuard||S.target===w.rightGuard)){var U=w.restore(S.target);U&&(T.range=U)}})}}]),y}(l.default.Embed);n.default=g},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.AlignStyle=n.AlignClass=n.AlignAttribute=void 0;var a=r(0),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}var l={scope:o.default.Scope.BLOCK,whitelist:["right","center","justify"]},u=new o.default.Attributor.Attribute("align","align",l),c=new o.default.Attributor.Class("align","ql-align",l),d=new o.default.Attributor.Style("align","text-align",l);n.AlignAttribute=u,n.AlignClass=c,n.AlignStyle=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundStyle=n.BackgroundClass=void 0;var a=r(0),o=l(a),s=r(26);function l(d){return d&&d.__esModule?d:{default:d}}var u=new o.default.Attributor.Class("background","ql-bg",{scope:o.default.Scope.INLINE}),c=new s.ColorAttributor("background","background-color",{scope:o.default.Scope.INLINE});n.BackgroundClass=u,n.BackgroundStyle=c},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionStyle=n.DirectionClass=n.DirectionAttribute=void 0;var a=r(0),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}var l={scope:o.default.Scope.BLOCK,whitelist:["rtl"]},u=new o.default.Attributor.Attribute("direction","dir",l),c=new o.default.Attributor.Class("direction","ql-direction",l),d=new o.default.Attributor.Style("direction","direction",l);n.DirectionAttribute=u,n.DirectionClass=c,n.DirectionStyle=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.FontClass=n.FontStyle=void 0;var a=function(){function v(y,b){for(var I=0;I<b.length;I++){var T=b[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}return function(y,b,I){return b&&v(y.prototype,b),I&&v(y,I),y}}(),o=function v(y,b,I){y===null&&(y=Function.prototype);var T=Object.getOwnPropertyDescriptor(y,b);if(T===void 0){var w=Object.getPrototypeOf(y);return w===null?void 0:v(w,b,I)}else{if("value"in T)return T.value;var S=T.get;return S===void 0?void 0:S.call(I)}},s=r(0),l=u(s);function u(v){return v&&v.__esModule?v:{default:v}}function c(v,y){if(!(v instanceof y))throw new TypeError("Cannot call a class as a function")}function d(v,y){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:v}function p(v,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);v.prototype=Object.create(y&&y.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(v,y):v.__proto__=y)}var f={scope:l.default.Scope.INLINE,whitelist:["serif","monospace"]},h=new l.default.Attributor.Class("font","ql-font",f),m=function(v){p(y,v);function y(){return c(this,y),d(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return a(y,[{key:"value",value:function(I){return o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"value",this).call(this,I).replace(/["']/g,"")}}]),y}(l.default.Attributor.Style),g=new m("font","font-family",f);n.FontStyle=g,n.FontClass=h},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.SizeStyle=n.SizeClass=void 0;var a=r(0),o=s(a);function s(c){return c&&c.__esModule?c:{default:c}}var l=new o.default.Attributor.Class("size","ql-size",{scope:o.default.Scope.INLINE,whitelist:["small","large","huge"]}),u=new o.default.Attributor.Style("size","font-size",{scope:o.default.Scope.INLINE,whitelist:["10px","18px","32px"]});n.SizeClass=l,n.SizeStyle=u},function(i,n,r){i.exports={align:{"":r(76),center:r(77),right:r(78),justify:r(79)},background:r(80),blockquote:r(81),bold:r(82),clean:r(83),code:r(58),"code-block":r(58),color:r(84),direction:{"":r(85),rtl:r(86)},float:{center:r(87),full:r(88),left:r(89),right:r(90)},formula:r(91),header:{1:r(92),2:r(93)},italic:r(94),image:r(95),indent:{"+1":r(96),"-1":r(97)},link:r(98),list:{ordered:r(99),bullet:r(100),check:r(101)},script:{sub:r(102),super:r(103)},strike:r(104),underline:r(105),video:r(106)}},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.getLastChangeIndex=n.default=void 0;var a=function(){function b(I,T){for(var w=0;w<T.length;w++){var S=T[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(I,S.key,S)}}return function(I,T,w){return T&&b(I.prototype,T),w&&b(I,w),I}}(),o=r(0),s=p(o),l=r(5),u=p(l),c=r(9),d=p(c);function p(b){return b&&b.__esModule?b:{default:b}}function f(b,I){if(!(b instanceof I))throw new TypeError("Cannot call a class as a function")}function h(b,I){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:b}function m(b,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);b.prototype=Object.create(I&&I.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(b,I):b.__proto__=I)}var g=function(b){m(I,b);function I(T,w){f(this,I);var S=h(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,T,w));return S.lastRecorded=0,S.ignoreChange=!1,S.clear(),S.quill.on(u.default.events.EDITOR_CHANGE,function(U,P,E,D){U!==u.default.events.TEXT_CHANGE||S.ignoreChange||(!S.options.userOnly||D===u.default.sources.USER?S.record(P,E):S.transform(P))}),S.quill.keyboard.addBinding({key:"Z",shortKey:!0},S.undo.bind(S)),S.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},S.redo.bind(S)),/Win/i.test(navigator.platform)&&S.quill.keyboard.addBinding({key:"Y",shortKey:!0},S.redo.bind(S)),S}return a(I,[{key:"change",value:function(w,S){if(this.stack[w].length!==0){var U=this.stack[w].pop();this.stack[S].push(U),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(U[w],u.default.sources.USER),this.ignoreChange=!1;var P=y(U[w]);this.quill.setSelection(P)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(w,S){if(w.ops.length!==0){this.stack.redo=[];var U=this.quill.getContents().diff(S),P=Date.now();if(this.lastRecorded+this.options.delay>P&&this.stack.undo.length>0){var E=this.stack.undo.pop();U=U.compose(E.undo),w=E.redo.compose(w)}else this.lastRecorded=P;this.stack.undo.push({redo:w,undo:U}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(w){this.stack.undo.forEach(function(S){S.undo=w.transform(S.undo,!0),S.redo=w.transform(S.redo,!0)}),this.stack.redo.forEach(function(S){S.undo=w.transform(S.undo,!0),S.redo=w.transform(S.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),I}(d.default);g.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function v(b){var I=b.ops[b.ops.length-1];return I==null?!1:I.insert!=null?typeof I.insert=="string"&&I.insert.endsWith(`
`):I.attributes!=null?Object.keys(I.attributes).some(function(T){return s.default.query(T,s.default.Scope.BLOCK)!=null}):!1}function y(b){var I=b.reduce(function(w,S){return w+=S.delete||0,w},0),T=b.length()-I;return v(b)&&(T-=1),T}n.default=g,n.getLastChangeIndex=y},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BaseTooltip=void 0;var a=function(){function j(V,H){for(var z=0;z<H.length;z++){var q=H[z];q.enumerable=q.enumerable||!1,q.configurable=!0,"value"in q&&(q.writable=!0),Object.defineProperty(V,q.key,q)}}return function(V,H,z){return H&&j(V.prototype,H),z&&j(V,z),V}}(),o=function j(V,H,z){V===null&&(V=Function.prototype);var q=Object.getOwnPropertyDescriptor(V,H);if(q===void 0){var W=Object.getPrototypeOf(V);return W===null?void 0:j(W,H,z)}else{if("value"in q)return q.value;var Y=q.get;return Y===void 0?void 0:Y.call(z)}},s=r(3),l=P(s),u=r(2),c=P(u),d=r(8),p=P(d),f=r(23),h=P(f),m=r(34),g=P(m),v=r(59),y=P(v),b=r(60),I=P(b),T=r(28),w=P(T),S=r(61),U=P(S);function P(j){return j&&j.__esModule?j:{default:j}}function E(j,V){if(!(j instanceof V))throw new TypeError("Cannot call a class as a function")}function D(j,V){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return V&&(typeof V=="object"||typeof V=="function")?V:j}function R(j,V){if(typeof V!="function"&&V!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof V);j.prototype=Object.create(V&&V.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),V&&(Object.setPrototypeOf?Object.setPrototypeOf(j,V):j.__proto__=V)}var N=[!1,"center","right","justify"],M=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],A=[!1,"serif","monospace"],_=["1","2","3",!1],k=["small",!1,"large","huge"],B=function(j){R(V,j);function V(H,z){E(this,V);var q=D(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,H,z)),W=function Y(Z){if(!document.body.contains(H.root))return document.body.removeEventListener("click",Y);q.tooltip!=null&&!q.tooltip.root.contains(Z.target)&&document.activeElement!==q.tooltip.textbox&&!q.quill.hasFocus()&&q.tooltip.hide(),q.pickers!=null&&q.pickers.forEach(function(X){X.container.contains(Z.target)||X.close()})};return H.emitter.listenDOM("click",document.body,W),q}return a(V,[{key:"addModule",value:function(z){var q=o(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"addModule",this).call(this,z);return z==="toolbar"&&this.extendToolbar(q),q}},{key:"buildButtons",value:function(z,q){z.forEach(function(W){var Y=W.getAttribute("class")||"";Y.split(/\s+/).forEach(function(Z){if(Z.startsWith("ql-")&&(Z=Z.slice(3),q[Z]!=null))if(Z==="direction")W.innerHTML=q[Z][""]+q[Z].rtl;else if(typeof q[Z]=="string")W.innerHTML=q[Z];else{var X=W.value||"";X!=null&&q[Z][X]&&(W.innerHTML=q[Z][X])}})})}},{key:"buildPickers",value:function(z,q){var W=this;this.pickers=z.map(function(Z){if(Z.classList.contains("ql-align"))return Z.querySelector("option")==null&&$(Z,N),new I.default(Z,q.align);if(Z.classList.contains("ql-background")||Z.classList.contains("ql-color")){var X=Z.classList.contains("ql-background")?"background":"color";return Z.querySelector("option")==null&&$(Z,M,X==="background"?"#ffffff":"#000000"),new y.default(Z,q[X])}else return Z.querySelector("option")==null&&(Z.classList.contains("ql-font")?$(Z,A):Z.classList.contains("ql-header")?$(Z,_):Z.classList.contains("ql-size")&&$(Z,k)),new w.default(Z)});var Y=function(){W.pickers.forEach(function(X){X.update()})};this.quill.on(p.default.events.EDITOR_CHANGE,Y)}}]),V}(g.default);B.DEFAULTS=(0,l.default)(!0,{},g.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var V=this,H=this.container.querySelector("input.ql-image[type=file]");H==null&&(H=document.createElement("input"),H.setAttribute("type","file"),H.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),H.classList.add("ql-image"),H.addEventListener("change",function(){if(H.files!=null&&H.files[0]!=null){var z=new FileReader;z.onload=function(q){var W=V.quill.getSelection(!0);V.quill.updateContents(new c.default().retain(W.index).delete(W.length).insert({image:q.target.result}),p.default.sources.USER),V.quill.setSelection(W.index+1,p.default.sources.SILENT),H.value=""},z.readAsDataURL(H.files[0])}}),this.container.appendChild(H)),H.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var F=function(j){R(V,j);function V(H,z){E(this,V);var q=D(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,H,z));return q.textbox=q.root.querySelector('input[type="text"]'),q.listen(),q}return a(V,[{key:"listen",value:function(){var z=this;this.textbox.addEventListener("keydown",function(q){h.default.match(q,"enter")?(z.save(),q.preventDefault()):h.default.match(q,"escape")&&(z.cancel(),q.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),q!=null?this.textbox.value=q:z!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+z)||""),this.root.setAttribute("data-mode",z)}},{key:"restoreFocus",value:function(){var z=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=z}},{key:"save",value:function(){var z=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var q=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",z,p.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",z,p.default.sources.USER)),this.quill.root.scrollTop=q;break}case"video":z=x(z);case"formula":{if(!z)break;var W=this.quill.getSelection(!0);if(W!=null){var Y=W.index+W.length;this.quill.insertEmbed(Y,this.root.getAttribute("data-mode"),z,p.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(Y+1," ",p.default.sources.USER),this.quill.setSelection(Y+2,p.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),V}(U.default);function x(j){var V=j.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||j.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return V?(V[1]||"https")+"://www.youtube.com/embed/"+V[2]+"?showinfo=0":(V=j.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(V[1]||"https")+"://player.vimeo.com/video/"+V[2]+"/":j}function $(j,V){var H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;V.forEach(function(z){var q=document.createElement("option");z===H?q.setAttribute("selected","selected"):q.setAttribute("value",z),j.appendChild(q)})}n.BaseTooltip=F,n.default=B},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function o(){this.head=this.tail=null,this.length=0}return o.prototype.append=function(){for(var s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];this.insertBefore(s[0],null),s.length>1&&this.append.apply(this,s.slice(1))},o.prototype.contains=function(s){for(var l,u=this.iterator();l=u();)if(l===s)return!0;return!1},o.prototype.insertBefore=function(s,l){s&&(s.next=l,l!=null?(s.prev=l.prev,l.prev!=null&&(l.prev.next=s),l.prev=s,l===this.head&&(this.head=s)):this.tail!=null?(this.tail.next=s,s.prev=this.tail,this.tail=s):(s.prev=null,this.head=this.tail=s),this.length+=1)},o.prototype.offset=function(s){for(var l=0,u=this.head;u!=null;){if(u===s)return l;l+=u.length(),u=u.next}return-1},o.prototype.remove=function(s){this.contains(s)&&(s.prev!=null&&(s.prev.next=s.next),s.next!=null&&(s.next.prev=s.prev),s===this.head&&(this.head=s.next),s===this.tail&&(this.tail=s.prev),this.length-=1)},o.prototype.iterator=function(s){return s===void 0&&(s=this.head),function(){var l=s;return s!=null&&(s=s.next),l}},o.prototype.find=function(s,l){l===void 0&&(l=!1);for(var u,c=this.iterator();u=c();){var d=u.length();if(s<d||l&&s===d&&(u.next==null||u.next.length()!==0))return[u,s];s-=d}return[null,0]},o.prototype.forEach=function(s){for(var l,u=this.iterator();l=u();)s(l)},o.prototype.forEachAt=function(s,l,u){if(!(l<=0))for(var c=this.find(s),d=c[0],p=c[1],f,h=s-p,m=this.iterator(d);(f=m())&&h<s+l;){var g=f.length();s>h?u(f,s-h,Math.min(l,h+g-s)):u(f,0,Math.min(g,s+l-h)),h+=g}},o.prototype.map=function(s){return this.reduce(function(l,u){return l.push(s(u)),l},[])},o.prototype.reduce=function(s,l){for(var u,c=this.iterator();u=c();)l=s(l,u);return l},o}();n.default=a},function(i,n,r){var a=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,f){p.__proto__=f}||function(p,f){for(var h in f)f.hasOwnProperty(h)&&(p[h]=f[h])};return function(p,f){d(p,f);function h(){this.constructor=p}p.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(17),s=r(1),l={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},u=100,c=function(d){a(p,d);function p(f){var h=d.call(this,f)||this;return h.scroll=h,h.observer=new MutationObserver(function(m){h.update(m)}),h.observer.observe(h.domNode,l),h.attach(),h}return p.prototype.detach=function(){d.prototype.detach.call(this),this.observer.disconnect()},p.prototype.deleteAt=function(f,h){this.update(),f===0&&h===this.length()?this.children.forEach(function(m){m.remove()}):d.prototype.deleteAt.call(this,f,h)},p.prototype.formatAt=function(f,h,m,g){this.update(),d.prototype.formatAt.call(this,f,h,m,g)},p.prototype.insertAt=function(f,h,m){this.update(),d.prototype.insertAt.call(this,f,h,m)},p.prototype.optimize=function(f,h){var m=this;f===void 0&&(f=[]),h===void 0&&(h={}),d.prototype.optimize.call(this,h);for(var g=[].slice.call(this.observer.takeRecords());g.length>0;)f.push(g.pop());for(var v=function(T,w){w===void 0&&(w=!0),!(T==null||T===m)&&T.domNode.parentNode!=null&&(T.domNode[s.DATA_KEY].mutations==null&&(T.domNode[s.DATA_KEY].mutations=[]),w&&v(T.parent))},y=function(T){T.domNode[s.DATA_KEY]==null||T.domNode[s.DATA_KEY].mutations==null||(T instanceof o.default&&T.children.forEach(y),T.optimize(h))},b=f,I=0;b.length>0;I+=1){if(I>=u)throw new Error("[Parchment] Maximum optimize iterations reached");for(b.forEach(function(T){var w=s.find(T.target,!0);w!=null&&(w.domNode===T.target&&(T.type==="childList"?(v(s.find(T.previousSibling,!1)),[].forEach.call(T.addedNodes,function(S){var U=s.find(S,!1);v(U,!1),U instanceof o.default&&U.children.forEach(function(P){v(P,!1)})})):T.type==="attributes"&&v(w.prev)),v(w))}),this.children.forEach(y),b=[].slice.call(this.observer.takeRecords()),g=b.slice();g.length>0;)f.push(g.pop())}},p.prototype.update=function(f,h){var m=this;h===void 0&&(h={}),f=f||this.observer.takeRecords(),f.map(function(g){var v=s.find(g.target,!0);return v==null?null:v.domNode[s.DATA_KEY].mutations==null?(v.domNode[s.DATA_KEY].mutations=[g],v):(v.domNode[s.DATA_KEY].mutations.push(g),null)}).forEach(function(g){g==null||g===m||g.domNode[s.DATA_KEY]==null||g.update(g.domNode[s.DATA_KEY].mutations||[],h)}),this.domNode[s.DATA_KEY].mutations!=null&&d.prototype.update.call(this,this.domNode[s.DATA_KEY].mutations,h),this.optimize(f,h)},p.blotName="scroll",p.defaultChild="block",p.scope=s.Scope.BLOCK_BLOT,p.tagName="DIV",p}(o.default);n.default=c},function(i,n,r){var a=this&&this.__extends||function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,p){d.__proto__=p}||function(d,p){for(var f in p)p.hasOwnProperty(f)&&(d[f]=p[f])};return function(d,p){c(d,p);function f(){this.constructor=d}d.prototype=p===null?Object.create(p):(f.prototype=p.prototype,new f)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(18),s=r(1);function l(c,d){if(Object.keys(c).length!==Object.keys(d).length)return!1;for(var p in c)if(c[p]!==d[p])return!1;return!0}var u=function(c){a(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d.formats=function(p){if(p.tagName!==d.tagName)return c.formats.call(this,p)},d.prototype.format=function(p,f){var h=this;p===this.statics.blotName&&!f?(this.children.forEach(function(m){m instanceof o.default||(m=m.wrap(d.blotName,!0)),h.attributes.copy(m)}),this.unwrap()):c.prototype.format.call(this,p,f)},d.prototype.formatAt=function(p,f,h,m){if(this.formats()[h]!=null||s.query(h,s.Scope.ATTRIBUTE)){var g=this.isolate(p,f);g.format(h,m)}else c.prototype.formatAt.call(this,p,f,h,m)},d.prototype.optimize=function(p){c.prototype.optimize.call(this,p);var f=this.formats();if(Object.keys(f).length===0)return this.unwrap();var h=this.next;h instanceof d&&h.prev===this&&l(f,h.formats())&&(h.moveChildren(this),h.remove())},d.blotName="inline",d.scope=s.Scope.INLINE_BLOT,d.tagName="SPAN",d}(o.default);n.default=u},function(i,n,r){var a=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var p in d)d.hasOwnProperty(p)&&(c[p]=d[p])};return function(c,d){u(c,d);function p(){this.constructor=c}c.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(18),s=r(1),l=function(u){a(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.formats=function(d){var p=s.query(c.blotName).tagName;if(d.tagName!==p)return u.formats.call(this,d)},c.prototype.format=function(d,p){s.query(d,s.Scope.BLOCK)!=null&&(d===this.statics.blotName&&!p?this.replaceWith(c.blotName):u.prototype.format.call(this,d,p))},c.prototype.formatAt=function(d,p,f,h){s.query(f,s.Scope.BLOCK)!=null?this.format(f,h):u.prototype.formatAt.call(this,d,p,f,h)},c.prototype.insertAt=function(d,p,f){if(f==null||s.query(p,s.Scope.INLINE)!=null)u.prototype.insertAt.call(this,d,p,f);else{var h=this.split(d),m=s.create(p,f);h.parent.insertBefore(m,h)}},c.prototype.update=function(d,p){navigator.userAgent.match(/Trident/)?this.build():u.prototype.update.call(this,d,p)},c.blotName="block",c.scope=s.Scope.BLOCK_BLOT,c.tagName="P",c}(o.default);n.default=l},function(i,n,r){var a=this&&this.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var d in c)c.hasOwnProperty(d)&&(u[d]=c[d])};return function(u,c){l(u,c);function d(){this.constructor=u}u.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(19),s=function(l){a(u,l);function u(){return l!==null&&l.apply(this,arguments)||this}return u.formats=function(c){},u.prototype.format=function(c,d){l.prototype.formatAt.call(this,0,this.length(),c,d)},u.prototype.formatAt=function(c,d,p,f){c===0&&d===this.length()?this.format(p,f):l.prototype.formatAt.call(this,c,d,p,f)},u.prototype.formats=function(){return this.statics.formats(this.domNode)},u}(o.default);n.default=s},function(i,n,r){var a=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var p in d)d.hasOwnProperty(p)&&(c[p]=d[p])};return function(c,d){u(c,d);function p(){this.constructor=c}c.prototype=d===null?Object.create(d):(p.prototype=d.prototype,new p)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=r(19),s=r(1),l=function(u){a(c,u);function c(d){var p=u.call(this,d)||this;return p.text=p.statics.value(p.domNode),p}return c.create=function(d){return document.createTextNode(d)},c.value=function(d){var p=d.data;return p.normalize&&(p=p.normalize()),p},c.prototype.deleteAt=function(d,p){this.domNode.data=this.text=this.text.slice(0,d)+this.text.slice(d+p)},c.prototype.index=function(d,p){return this.domNode===d?p:-1},c.prototype.insertAt=function(d,p,f){f==null?(this.text=this.text.slice(0,d)+p+this.text.slice(d),this.domNode.data=this.text):u.prototype.insertAt.call(this,d,p,f)},c.prototype.length=function(){return this.text.length},c.prototype.optimize=function(d){u.prototype.optimize.call(this,d),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof c&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},c.prototype.position=function(d,p){return[this.domNode,d]},c.prototype.split=function(d,p){if(p===void 0&&(p=!1),!p){if(d===0)return this;if(d===this.length())return this.next}var f=s.create(this.domNode.splitText(d));return this.parent.insertBefore(f,this.next),this.text=this.statics.value(this.domNode),f},c.prototype.update=function(d,p){var f=this;d.some(function(h){return h.type==="characterData"&&h.target===f.domNode})&&(this.text=this.statics.value(this.domNode))},c.prototype.value=function(){return this.text},c.blotName="text",c.scope=s.Scope.INLINE_BLOT,c}(o.default);n.default=l},function(i,n,r){var a=document.createElement("div");if(a.classList.toggle("test-class",!1),a.classList.contains("test-class")){var o=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(s,l){return arguments.length>1&&!this.contains(s)==!l?l:o.call(this,s)}}String.prototype.startsWith||(String.prototype.startsWith=function(s,l){return l=l||0,this.substr(l,s.length)===s}),String.prototype.endsWith||(String.prototype.endsWith=function(s,l){var u=this.toString();(typeof l!="number"||!isFinite(l)||Math.floor(l)!==l||l>u.length)&&(l=u.length),l-=s.length;var c=u.indexOf(s,l);return c!==-1&&c===l}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(l){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof l!="function")throw new TypeError("predicate must be a function");for(var u=Object(this),c=u.length>>>0,d=arguments[1],p,f=0;f<c;f++)if(p=u[f],l.call(d,p,f,u))return p}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(i,n){var r=-1,a=1,o=0;function s(I,T,w){if(I==T)return I?[[o,I]]:[];(w<0||I.length<w)&&(w=null);var S=d(I,T),U=I.substring(0,S);I=I.substring(S),T=T.substring(S),S=p(I,T);var P=I.substring(I.length-S);I=I.substring(0,I.length-S),T=T.substring(0,T.length-S);var E=l(I,T);return U&&E.unshift([o,U]),P&&E.push([o,P]),h(E),w!=null&&(E=v(E,w)),E=y(E),E}function l(I,T){var w;if(!I)return[[a,T]];if(!T)return[[r,I]];var S=I.length>T.length?I:T,U=I.length>T.length?T:I,P=S.indexOf(U);if(P!=-1)return w=[[a,S.substring(0,P)],[o,U],[a,S.substring(P+U.length)]],I.length>T.length&&(w[0][0]=w[2][0]=r),w;if(U.length==1)return[[r,I],[a,T]];var E=f(I,T);if(E){var D=E[0],R=E[1],N=E[2],M=E[3],A=E[4],_=s(D,N),k=s(R,M);return _.concat([[o,A]],k)}return u(I,T)}function u(I,T){for(var w=I.length,S=T.length,U=Math.ceil((w+S)/2),P=U,E=2*U,D=new Array(E),R=new Array(E),N=0;N<E;N++)D[N]=-1,R[N]=-1;D[P+1]=0,R[P+1]=0;for(var M=w-S,A=M%2!=0,_=0,k=0,B=0,F=0,x=0;x<U;x++){for(var $=-x+_;$<=x-k;$+=2){var j=P+$,V;$==-x||$!=x&&D[j-1]<D[j+1]?V=D[j+1]:V=D[j-1]+1;for(var H=V-$;V<w&&H<S&&I.charAt(V)==T.charAt(H);)V++,H++;if(D[j]=V,V>w)k+=2;else if(H>S)_+=2;else if(A){var z=P+M-$;if(z>=0&&z<E&&R[z]!=-1){var q=w-R[z];if(V>=q)return c(I,T,V,H)}}}for(var W=-x+B;W<=x-F;W+=2){var z=P+W,q;W==-x||W!=x&&R[z-1]<R[z+1]?q=R[z+1]:q=R[z-1]+1;for(var Y=q-W;q<w&&Y<S&&I.charAt(w-q-1)==T.charAt(S-Y-1);)q++,Y++;if(R[z]=q,q>w)F+=2;else if(Y>S)B+=2;else if(!A){var j=P+M-W;if(j>=0&&j<E&&D[j]!=-1){var V=D[j],H=P+V-j;if(q=w-q,V>=q)return c(I,T,V,H)}}}}return[[r,I],[a,T]]}function c(I,T,w,S){var U=I.substring(0,w),P=T.substring(0,S),E=I.substring(w),D=T.substring(S),R=s(U,P),N=s(E,D);return R.concat(N)}function d(I,T){if(!I||!T||I.charAt(0)!=T.charAt(0))return 0;for(var w=0,S=Math.min(I.length,T.length),U=S,P=0;w<U;)I.substring(P,U)==T.substring(P,U)?(w=U,P=w):S=U,U=Math.floor((S-w)/2+w);return U}function p(I,T){if(!I||!T||I.charAt(I.length-1)!=T.charAt(T.length-1))return 0;for(var w=0,S=Math.min(I.length,T.length),U=S,P=0;w<U;)I.substring(I.length-U,I.length-P)==T.substring(T.length-U,T.length-P)?(w=U,P=w):S=U,U=Math.floor((S-w)/2+w);return U}function f(I,T){var w=I.length>T.length?I:T,S=I.length>T.length?T:I;if(w.length<4||S.length*2<w.length)return null;function U(k,B,F){for(var x=k.substring(F,F+Math.floor(k.length/4)),$=-1,j="",V,H,z,q;($=B.indexOf(x,$+1))!=-1;){var W=d(k.substring(F),B.substring($)),Y=p(k.substring(0,F),B.substring(0,$));j.length<Y+W&&(j=B.substring($-Y,$)+B.substring($,$+W),V=k.substring(0,F-Y),H=k.substring(F+W),z=B.substring(0,$-Y),q=B.substring($+W))}return j.length*2>=k.length?[V,H,z,q,j]:null}var P=U(w,S,Math.ceil(w.length/4)),E=U(w,S,Math.ceil(w.length/2)),D;if(!P&&!E)return null;E?P?D=P[4].length>E[4].length?P:E:D=E:D=P;var R,N,M,A;I.length>T.length?(R=D[0],N=D[1],M=D[2],A=D[3]):(M=D[0],A=D[1],R=D[2],N=D[3]);var _=D[4];return[R,N,M,A,_]}function h(I){I.push([o,""]);for(var T=0,w=0,S=0,U="",P="",E;T<I.length;)switch(I[T][0]){case a:S++,P+=I[T][1],T++;break;case r:w++,U+=I[T][1],T++;break;case o:w+S>1?(w!==0&&S!==0&&(E=d(P,U),E!==0&&(T-w-S>0&&I[T-w-S-1][0]==o?I[T-w-S-1][1]+=P.substring(0,E):(I.splice(0,0,[o,P.substring(0,E)]),T++),P=P.substring(E),U=U.substring(E)),E=p(P,U),E!==0&&(I[T][1]=P.substring(P.length-E)+I[T][1],P=P.substring(0,P.length-E),U=U.substring(0,U.length-E))),w===0?I.splice(T-S,w+S,[a,P]):S===0?I.splice(T-w,w+S,[r,U]):I.splice(T-w-S,w+S,[r,U],[a,P]),T=T-w-S+(w?1:0)+(S?1:0)+1):T!==0&&I[T-1][0]==o?(I[T-1][1]+=I[T][1],I.splice(T,1)):T++,S=0,w=0,U="",P="";break}I[I.length-1][1]===""&&I.pop();var D=!1;for(T=1;T<I.length-1;)I[T-1][0]==o&&I[T+1][0]==o&&(I[T][1].substring(I[T][1].length-I[T-1][1].length)==I[T-1][1]?(I[T][1]=I[T-1][1]+I[T][1].substring(0,I[T][1].length-I[T-1][1].length),I[T+1][1]=I[T-1][1]+I[T+1][1],I.splice(T-1,1),D=!0):I[T][1].substring(0,I[T+1][1].length)==I[T+1][1]&&(I[T-1][1]+=I[T+1][1],I[T][1]=I[T][1].substring(I[T+1][1].length)+I[T+1][1],I.splice(T+1,1),D=!0)),T++;D&&h(I)}var m=s;m.INSERT=a,m.DELETE=r,m.EQUAL=o,i.exports=m;function g(I,T){if(T===0)return[o,I];for(var w=0,S=0;S<I.length;S++){var U=I[S];if(U[0]===r||U[0]===o){var P=w+U[1].length;if(T===P)return[S+1,I];if(T<P){I=I.slice();var E=T-w,D=[U[0],U[1].slice(0,E)],R=[U[0],U[1].slice(E)];return I.splice(S,1,D,R),[S+1,I]}else w=P}}throw new Error("cursor_pos is out of bounds!")}function v(I,T){var w=g(I,T),S=w[1],U=w[0],P=S[U],E=S[U+1];if(P==null)return I;if(P[0]!==o)return I;if(E!=null&&P[1]+E[1]===E[1]+P[1])return S.splice(U,2,E,P),b(S,U,2);if(E!=null&&E[1].indexOf(P[1])===0){S.splice(U,2,[E[0],P[1]],[0,P[1]]);var D=E[1].slice(P[1].length);return D.length>0&&S.splice(U+2,0,[E[0],D]),b(S,U,3)}else return I}function y(I){for(var T=!1,w=function(E){return E.charCodeAt(0)>=56320&&E.charCodeAt(0)<=57343},S=function(E){return E.charCodeAt(E.length-1)>=55296&&E.charCodeAt(E.length-1)<=56319},U=2;U<I.length;U+=1)I[U-2][0]===o&&S(I[U-2][1])&&I[U-1][0]===r&&w(I[U-1][1])&&I[U][0]===a&&w(I[U][1])&&(T=!0,I[U-1][1]=I[U-2][1].slice(-1)+I[U-1][1],I[U][1]=I[U-2][1].slice(-1)+I[U][1],I[U-2][1]=I[U-2][1].slice(0,-1));if(!T)return I;for(var P=[],U=0;U<I.length;U+=1)I[U][1].length>0&&P.push(I[U]);return P}function b(I,T,w){for(var S=T+w-1;S>=0&&S>=T-1;S--)if(S+1<I.length){var U=I[S],P=I[S+1];U[0]===P[1]&&I.splice(S,2,[U[0],U[1]+P[1]])}return I}},function(i,n){n=i.exports=typeof Object.keys=="function"?Object.keys:r,n.shim=r;function r(a){var o=[];for(var s in a)o.push(s);return o}},function(i,n){var r=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";n=i.exports=r?a:o,n.supported=a;function a(s){return Object.prototype.toString.call(s)=="[object Arguments]"}n.unsupported=o;function o(s){return s&&typeof s=="object"&&typeof s.length=="number"&&Object.prototype.hasOwnProperty.call(s,"callee")&&!Object.prototype.propertyIsEnumerable.call(s,"callee")||!1}},function(i,n){var r=Object.prototype.hasOwnProperty,a="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(a=!1));function s(u,c,d){this.fn=u,this.context=c,this.once=d||!1}function l(){this._events=new o,this._eventsCount=0}l.prototype.eventNames=function(){var c=[],d,p;if(this._eventsCount===0)return c;for(p in d=this._events)r.call(d,p)&&c.push(a?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},l.prototype.listeners=function(c,d){var p=a?a+c:c,f=this._events[p];if(d)return!!f;if(!f)return[];if(f.fn)return[f.fn];for(var h=0,m=f.length,g=new Array(m);h<m;h++)g[h]=f[h].fn;return g},l.prototype.emit=function(c,d,p,f,h,m){var g=a?a+c:c;if(!this._events[g])return!1;var v=this._events[g],y=arguments.length,b,I;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,p),!0;case 4:return v.fn.call(v.context,d,p,f),!0;case 5:return v.fn.call(v.context,d,p,f,h),!0;case 6:return v.fn.call(v.context,d,p,f,h,m),!0}for(I=1,b=new Array(y-1);I<y;I++)b[I-1]=arguments[I];v.fn.apply(v.context,b)}else{var T=v.length,w;for(I=0;I<T;I++)switch(v[I].once&&this.removeListener(c,v[I].fn,void 0,!0),y){case 1:v[I].fn.call(v[I].context);break;case 2:v[I].fn.call(v[I].context,d);break;case 3:v[I].fn.call(v[I].context,d,p);break;case 4:v[I].fn.call(v[I].context,d,p,f);break;default:if(!b)for(w=1,b=new Array(y-1);w<y;w++)b[w-1]=arguments[w];v[I].fn.apply(v[I].context,b)}}return!0},l.prototype.on=function(c,d,p){var f=new s(d,p||this),h=a?a+c:c;return this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],f]:this._events[h].push(f):(this._events[h]=f,this._eventsCount++),this},l.prototype.once=function(c,d,p){var f=new s(d,p||this,!0),h=a?a+c:c;return this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],f]:this._events[h].push(f):(this._events[h]=f,this._eventsCount++),this},l.prototype.removeListener=function(c,d,p,f){var h=a?a+c:c;if(!this._events[h])return this;if(!d)return--this._eventsCount===0?this._events=new o:delete this._events[h],this;var m=this._events[h];if(m.fn)m.fn===d&&(!f||m.once)&&(!p||m.context===p)&&(--this._eventsCount===0?this._events=new o:delete this._events[h]);else{for(var g=0,v=[],y=m.length;g<y;g++)(m[g].fn!==d||f&&!m[g].once||p&&m[g].context!==p)&&v.push(m[g]);v.length?this._events[h]=v.length===1?v[0]:v:--this._eventsCount===0?this._events=new o:delete this._events[h]}return this},l.prototype.removeAllListeners=function(c){var d;return c?(d=a?a+c:c,this._events[d]&&(--this._eventsCount===0?this._events=new o:delete this._events[d])):(this._events=new o,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prototype.setMaxListeners=function(){return this},l.prefixed=a,l.EventEmitter=l,typeof i<"u"&&(i.exports=l)},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.matchText=n.matchSpacing=n.matchNewline=n.matchBlot=n.matchAttributor=n.default=void 0;var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(se){return typeof se}:function(se){return se&&typeof Symbol=="function"&&se.constructor===Symbol&&se!==Symbol.prototype?"symbol":typeof se},o=function(){function se(pe,fe){var ge=[],me=!0,Ee=!1,Be=void 0;try{for(var Pe=pe[Symbol.iterator](),et;!(me=(et=Pe.next()).done)&&(ge.push(et.value),!(fe&&ge.length===fe));me=!0);}catch(Ie){Ee=!0,Be=Ie}finally{try{!me&&Pe.return&&Pe.return()}finally{if(Ee)throw Be}}return ge}return function(pe,fe){if(Array.isArray(pe))return pe;if(Symbol.iterator in Object(pe))return se(pe,fe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function se(pe,fe){for(var ge=0;ge<fe.length;ge++){var me=fe[ge];me.enumerable=me.enumerable||!1,me.configurable=!0,"value"in me&&(me.writable=!0),Object.defineProperty(pe,me.key,me)}}return function(pe,fe,ge){return fe&&se(pe.prototype,fe),ge&&se(pe,ge),pe}}(),l=r(3),u=R(l),c=r(2),d=R(c),p=r(0),f=R(p),h=r(5),m=R(h),g=r(10),v=R(g),y=r(9),b=R(y),I=r(36),T=r(37),w=r(13),S=R(w),U=r(26),P=r(38),E=r(39),D=r(40);function R(se){return se&&se.__esModule?se:{default:se}}function N(se,pe,fe){return pe in se?Object.defineProperty(se,pe,{value:fe,enumerable:!0,configurable:!0,writable:!0}):se[pe]=fe,se}function M(se,pe){if(!(se instanceof pe))throw new TypeError("Cannot call a class as a function")}function A(se,pe){if(!se)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return pe&&(typeof pe=="object"||typeof pe=="function")?pe:se}function _(se,pe){if(typeof pe!="function"&&pe!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof pe);se.prototype=Object.create(pe&&pe.prototype,{constructor:{value:se,enumerable:!1,writable:!0,configurable:!0}}),pe&&(Object.setPrototypeOf?Object.setPrototypeOf(se,pe):se.__proto__=pe)}var k=(0,v.default)("quill:clipboard"),B="__ql-matcher",F=[[Node.TEXT_NODE,oe],[Node.TEXT_NODE,ee],["br",Q],[Node.ELEMENT_NODE,ee],[Node.ELEMENT_NODE,X],[Node.ELEMENT_NODE,ne],[Node.ELEMENT_NODE,Z],[Node.ELEMENT_NODE,ie],["li",J],["b",Y.bind(Y,"bold")],["i",Y.bind(Y,"italic")],["style",ce]],x=[I.AlignAttribute,P.DirectionAttribute].reduce(function(se,pe){return se[pe.keyName]=pe,se},{}),$=[I.AlignStyle,T.BackgroundStyle,U.ColorStyle,P.DirectionStyle,E.FontStyle,D.SizeStyle].reduce(function(se,pe){return se[pe.keyName]=pe,se},{}),j=function(se){_(pe,se);function pe(fe,ge){M(this,pe);var me=A(this,(pe.__proto__||Object.getPrototypeOf(pe)).call(this,fe,ge));return me.quill.root.addEventListener("paste",me.onPaste.bind(me)),me.container=me.quill.addContainer("ql-clipboard"),me.container.setAttribute("contenteditable",!0),me.container.setAttribute("tabindex",-1),me.matchers=[],F.concat(me.options.matchers).forEach(function(Ee){var Be=o(Ee,2),Pe=Be[0],et=Be[1];!ge.matchVisual&&et===ne||me.addMatcher(Pe,et)}),me}return s(pe,[{key:"addMatcher",value:function(ge,me){this.matchers.push([ge,me])}},{key:"convert",value:function(ge){if(typeof ge=="string")return this.container.innerHTML=ge.replace(/\>\r?\n +\</g,"><"),this.convert();var me=this.quill.getFormat(this.quill.selection.savedRange.index);if(me[S.default.blotName]){var Ee=this.container.innerText;return this.container.innerHTML="",new d.default().insert(Ee,N({},S.default.blotName,me[S.default.blotName]))}var Be=this.prepareMatching(),Pe=o(Be,2),et=Pe[0],Ie=Pe[1],Ne=W(this.container,et,Ie);return z(Ne,`
`)&&Ne.ops[Ne.ops.length-1].attributes==null&&(Ne=Ne.compose(new d.default().retain(Ne.length()-1).delete(1))),k.log("convert",this.container.innerHTML,Ne),this.container.innerHTML="",Ne}},{key:"dangerouslyPasteHTML",value:function(ge,me){var Ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:m.default.sources.API;if(typeof ge=="string")this.quill.setContents(this.convert(ge),me),this.quill.setSelection(0,m.default.sources.SILENT);else{var Be=this.convert(me);this.quill.updateContents(new d.default().retain(ge).concat(Be),Ee),this.quill.setSelection(ge+Be.length(),m.default.sources.SILENT)}}},{key:"onPaste",value:function(ge){var me=this;if(!(ge.defaultPrevented||!this.quill.isEnabled())){var Ee=this.quill.getSelection(),Be=new d.default().retain(Ee.index),Pe=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(m.default.sources.SILENT),setTimeout(function(){Be=Be.concat(me.convert()).delete(Ee.length),me.quill.updateContents(Be,m.default.sources.USER),me.quill.setSelection(Be.length()-Ee.length,m.default.sources.SILENT),me.quill.scrollingContainer.scrollTop=Pe,me.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var ge=this,me=[],Ee=[];return this.matchers.forEach(function(Be){var Pe=o(Be,2),et=Pe[0],Ie=Pe[1];switch(et){case Node.TEXT_NODE:Ee.push(Ie);break;case Node.ELEMENT_NODE:me.push(Ie);break;default:[].forEach.call(ge.container.querySelectorAll(et),function(Ne){Ne[B]=Ne[B]||[],Ne[B].push(Ie)});break}}),[me,Ee]}}]),pe}(b.default);j.DEFAULTS={matchers:[],matchVisual:!0};function V(se,pe,fe){return(typeof pe>"u"?"undefined":a(pe))==="object"?Object.keys(pe).reduce(function(ge,me){return V(ge,me,pe[me])},se):se.reduce(function(ge,me){return me.attributes&&me.attributes[pe]?ge.push(me):ge.insert(me.insert,(0,u.default)({},N({},pe,fe),me.attributes))},new d.default)}function H(se){if(se.nodeType!==Node.ELEMENT_NODE)return{};var pe="__ql-computed-style";return se[pe]||(se[pe]=window.getComputedStyle(se))}function z(se,pe){for(var fe="",ge=se.ops.length-1;ge>=0&&fe.length<pe.length;--ge){var me=se.ops[ge];if(typeof me.insert!="string")break;fe=me.insert+fe}return fe.slice(-1*pe.length)===pe}function q(se){if(se.childNodes.length===0)return!1;var pe=H(se);return["block","list-item"].indexOf(pe.display)>-1}function W(se,pe,fe){return se.nodeType===se.TEXT_NODE?fe.reduce(function(ge,me){return me(se,ge)},new d.default):se.nodeType===se.ELEMENT_NODE?[].reduce.call(se.childNodes||[],function(ge,me){var Ee=W(me,pe,fe);return me.nodeType===se.ELEMENT_NODE&&(Ee=pe.reduce(function(Be,Pe){return Pe(me,Be)},Ee),Ee=(me[B]||[]).reduce(function(Be,Pe){return Pe(me,Be)},Ee)),ge.concat(Ee)},new d.default):new d.default}function Y(se,pe,fe){return V(fe,se,!0)}function Z(se,pe){var fe=f.default.Attributor.Attribute.keys(se),ge=f.default.Attributor.Class.keys(se),me=f.default.Attributor.Style.keys(se),Ee={};return fe.concat(ge).concat(me).forEach(function(Be){var Pe=f.default.query(Be,f.default.Scope.ATTRIBUTE);Pe!=null&&(Ee[Pe.attrName]=Pe.value(se),Ee[Pe.attrName])||(Pe=x[Be],Pe!=null&&(Pe.attrName===Be||Pe.keyName===Be)&&(Ee[Pe.attrName]=Pe.value(se)||void 0),Pe=$[Be],Pe!=null&&(Pe.attrName===Be||Pe.keyName===Be)&&(Pe=$[Be],Ee[Pe.attrName]=Pe.value(se)||void 0))}),Object.keys(Ee).length>0&&(pe=V(pe,Ee)),pe}function X(se,pe){var fe=f.default.query(se);if(fe==null)return pe;if(fe.prototype instanceof f.default.Embed){var ge={},me=fe.value(se);me!=null&&(ge[fe.blotName]=me,pe=new d.default().insert(ge,fe.formats(se)))}else typeof fe.formats=="function"&&(pe=V(pe,fe.blotName,fe.formats(se)));return pe}function Q(se,pe){return z(pe,`
`)||pe.insert(`
`),pe}function ce(){return new d.default}function J(se,pe){var fe=f.default.query(se);if(fe==null||fe.blotName!=="list-item"||!z(pe,`
`))return pe;for(var ge=-1,me=se.parentNode;!me.classList.contains("ql-clipboard");)(f.default.query(me)||{}).blotName==="list"&&(ge+=1),me=me.parentNode;return ge<=0?pe:pe.compose(new d.default().retain(pe.length()-1).retain(1,{indent:ge}))}function ee(se,pe){return z(pe,`
`)||(q(se)||pe.length()>0&&se.nextSibling&&q(se.nextSibling))&&pe.insert(`
`),pe}function ne(se,pe){if(q(se)&&se.nextElementSibling!=null&&!z(pe,`

`)){var fe=se.offsetHeight+parseFloat(H(se).marginTop)+parseFloat(H(se).marginBottom);se.nextElementSibling.offsetTop>se.offsetTop+fe*1.5&&pe.insert(`
`)}return pe}function ie(se,pe){var fe={},ge=se.style||{};return ge.fontStyle&&H(se).fontStyle==="italic"&&(fe.italic=!0),ge.fontWeight&&(H(se).fontWeight.startsWith("bold")||parseInt(H(se).fontWeight)>=700)&&(fe.bold=!0),Object.keys(fe).length>0&&(pe=V(pe,fe)),parseFloat(ge.textIndent||0)>0&&(pe=new d.default().insert("	").concat(pe)),pe}function oe(se,pe){var fe=se.data;if(se.parentNode.tagName==="O:P")return pe.insert(fe.trim());if(fe.trim().length===0&&se.parentNode.classList.contains("ql-clipboard"))return pe;if(!H(se.parentNode).whiteSpace.startsWith("pre")){var ge=function(Ee,Be){return Be=Be.replace(/[^\u00a0]/g,""),Be.length<1&&Ee?" ":Be};fe=fe.replace(/\r\n/g," ").replace(/\n/g," "),fe=fe.replace(/\s\s+/g,ge.bind(ge,!0)),(se.previousSibling==null&&q(se.parentNode)||se.previousSibling!=null&&q(se.previousSibling))&&(fe=fe.replace(/^\s+/,ge.bind(ge,!1))),(se.nextSibling==null&&q(se.parentNode)||se.nextSibling!=null&&q(se.nextSibling))&&(fe=fe.replace(/\s+$/,ge.bind(ge,!1)))}return pe.insert(fe)}n.default=j,n.matchAttributor=Z,n.matchBlot=X,n.matchNewline=ee,n.matchSpacing=ne,n.matchText=oe},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(m,g){for(var v=0;v<g.length;v++){var y=g[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}return function(m,g,v){return g&&h(m.prototype,g),v&&h(m,v),m}}(),o=function h(m,g,v){m===null&&(m=Function.prototype);var y=Object.getOwnPropertyDescriptor(m,g);if(y===void 0){var b=Object.getPrototypeOf(m);return b===null?void 0:h(b,g,v)}else{if("value"in y)return y.value;var I=y.get;return I===void 0?void 0:I.call(v)}},s=r(6),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(){return c(this,m),d(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return a(m,[{key:"optimize",value:function(v){o(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"optimize",this).call(this,v),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return o(m.__proto__||Object.getPrototypeOf(m),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),m}(l.default);f.blotName="bold",f.tagName=["STRONG","B"],n.default=f},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.addControls=n.default=void 0;var a=function(){function D(R,N){var M=[],A=!0,_=!1,k=void 0;try{for(var B=R[Symbol.iterator](),F;!(A=(F=B.next()).done)&&(M.push(F.value),!(N&&M.length===N));A=!0);}catch(x){_=!0,k=x}finally{try{!A&&B.return&&B.return()}finally{if(_)throw k}}return M}return function(R,N){if(Array.isArray(R))return R;if(Symbol.iterator in Object(R))return D(R,N);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function D(R,N){for(var M=0;M<N.length;M++){var A=N[M];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(R,A.key,A)}}return function(R,N,M){return N&&D(R.prototype,N),M&&D(R,M),R}}(),s=r(2),l=v(s),u=r(0),c=v(u),d=r(5),p=v(d),f=r(10),h=v(f),m=r(9),g=v(m);function v(D){return D&&D.__esModule?D:{default:D}}function y(D,R,N){return R in D?Object.defineProperty(D,R,{value:N,enumerable:!0,configurable:!0,writable:!0}):D[R]=N,D}function b(D,R){if(!(D instanceof R))throw new TypeError("Cannot call a class as a function")}function I(D,R){if(!D)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:D}function T(D,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);D.prototype=Object.create(R&&R.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(D,R):D.__proto__=R)}var w=(0,h.default)("quill:toolbar"),S=function(D){T(R,D);function R(N,M){b(this,R);var A=I(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,N,M));if(Array.isArray(A.options.container)){var _=document.createElement("div");P(_,A.options.container),N.container.parentNode.insertBefore(_,N.container),A.container=_}else typeof A.options.container=="string"?A.container=document.querySelector(A.options.container):A.container=A.options.container;if(!(A.container instanceof HTMLElement)){var k;return k=w.error("Container required for toolbar",A.options),I(A,k)}return A.container.classList.add("ql-toolbar"),A.controls=[],A.handlers={},Object.keys(A.options.handlers).forEach(function(B){A.addHandler(B,A.options.handlers[B])}),[].forEach.call(A.container.querySelectorAll("button, select"),function(B){A.attach(B)}),A.quill.on(p.default.events.EDITOR_CHANGE,function(B,F){B===p.default.events.SELECTION_CHANGE&&A.update(F)}),A.quill.on(p.default.events.SCROLL_OPTIMIZE,function(){var B=A.quill.selection.getRange(),F=a(B,1),x=F[0];A.update(x)}),A}return o(R,[{key:"addHandler",value:function(M,A){this.handlers[M]=A}},{key:"attach",value:function(M){var A=this,_=[].find.call(M.classList,function(B){return B.indexOf("ql-")===0});if(_){if(_=_.slice(3),M.tagName==="BUTTON"&&M.setAttribute("type","button"),this.handlers[_]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[_]==null){w.warn("ignoring attaching to disabled format",_,M);return}if(c.default.query(_)==null){w.warn("ignoring attaching to nonexistent format",_,M);return}}var k=M.tagName==="SELECT"?"change":"click";M.addEventListener(k,function(B){var F=void 0;if(M.tagName==="SELECT"){if(M.selectedIndex<0)return;var x=M.options[M.selectedIndex];x.hasAttribute("selected")?F=!1:F=x.value||!1}else M.classList.contains("ql-active")?F=!1:F=M.value||!M.hasAttribute("value"),B.preventDefault();A.quill.focus();var $=A.quill.selection.getRange(),j=a($,1),V=j[0];if(A.handlers[_]!=null)A.handlers[_].call(A,F);else if(c.default.query(_).prototype instanceof c.default.Embed){if(F=prompt("Enter "+_),!F)return;A.quill.updateContents(new l.default().retain(V.index).delete(V.length).insert(y({},_,F)),p.default.sources.USER)}else A.quill.format(_,F,p.default.sources.USER);A.update(V)}),this.controls.push([_,M])}}},{key:"update",value:function(M){var A=M==null?{}:this.quill.getFormat(M);this.controls.forEach(function(_){var k=a(_,2),B=k[0],F=k[1];if(F.tagName==="SELECT"){var x=void 0;if(M==null)x=null;else if(A[B]==null)x=F.querySelector("option[selected]");else if(!Array.isArray(A[B])){var $=A[B];typeof $=="string"&&($=$.replace(/\"/g,'\\"')),x=F.querySelector('option[value="'+$+'"]')}x==null?(F.value="",F.selectedIndex=-1):x.selected=!0}else if(M==null)F.classList.remove("ql-active");else if(F.hasAttribute("value")){var j=A[B]===F.getAttribute("value")||A[B]!=null&&A[B].toString()===F.getAttribute("value")||A[B]==null&&!F.getAttribute("value");F.classList.toggle("ql-active",j)}else F.classList.toggle("ql-active",A[B]!=null)})}}]),R}(g.default);S.DEFAULTS={};function U(D,R,N){var M=document.createElement("button");M.setAttribute("type","button"),M.classList.add("ql-"+R),N!=null&&(M.value=N),D.appendChild(M)}function P(D,R){Array.isArray(R[0])||(R=[R]),R.forEach(function(N){var M=document.createElement("span");M.classList.add("ql-formats"),N.forEach(function(A){if(typeof A=="string")U(M,A);else{var _=Object.keys(A)[0],k=A[_];Array.isArray(k)?E(M,_,k):U(M,_,k)}}),D.appendChild(M)})}function E(D,R,N){var M=document.createElement("select");M.classList.add("ql-"+R),N.forEach(function(A){var _=document.createElement("option");A!==!1?_.setAttribute("value",A):_.setAttribute("selected","selected"),M.appendChild(_)}),D.appendChild(M)}S.DEFAULTS={container:null,handlers:{clean:function(){var R=this,N=this.quill.getSelection();if(N!=null)if(N.length==0){var M=this.quill.getFormat();Object.keys(M).forEach(function(A){c.default.query(A,c.default.Scope.INLINE)!=null&&R.quill.format(A,!1)})}else this.quill.removeFormat(N,p.default.sources.USER)},direction:function(R){var N=this.quill.getFormat().align;R==="rtl"&&N==null?this.quill.format("align","right",p.default.sources.USER):!R&&N==="right"&&this.quill.format("align",!1,p.default.sources.USER),this.quill.format("direction",R,p.default.sources.USER)},indent:function(R){var N=this.quill.getSelection(),M=this.quill.getFormat(N),A=parseInt(M.indent||0);if(R==="+1"||R==="-1"){var _=R==="+1"?1:-1;M.direction==="rtl"&&(_*=-1),this.quill.format("indent",A+_,p.default.sources.USER)}},link:function(R){R===!0&&(R=prompt("Enter link URL:")),this.quill.format("link",R,p.default.sources.USER)},list:function(R){var N=this.quill.getSelection(),M=this.quill.getFormat(N);R==="check"?M.list==="checked"||M.list==="unchecked"?this.quill.format("list",!1,p.default.sources.USER):this.quill.format("list","unchecked",p.default.sources.USER):this.quill.format("list",R,p.default.sources.USER)}}},n.default=S,n.addControls=P},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(m,g){for(var v=0;v<g.length;v++){var y=g[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}return function(m,g,v){return g&&h(m.prototype,g),v&&h(m,v),m}}(),o=function h(m,g,v){m===null&&(m=Function.prototype);var y=Object.getOwnPropertyDescriptor(m,g);if(y===void 0){var b=Object.getPrototypeOf(m);return b===null?void 0:h(b,g,v)}else{if("value"in y)return y.value;var I=y.get;return I===void 0?void 0:I.call(v)}},s=r(28),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(g,v){c(this,m);var y=d(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,g));return y.label.innerHTML=v,y.container.classList.add("ql-color-picker"),[].slice.call(y.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(b){b.classList.add("ql-primary")}),y}return a(m,[{key:"buildItem",value:function(v){var y=o(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"buildItem",this).call(this,v);return y.style.backgroundColor=v.getAttribute("value")||"",y}},{key:"selectItem",value:function(v,y){o(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"selectItem",this).call(this,v,y);var b=this.label.querySelector(".ql-color-label"),I=v&&v.getAttribute("data-value")||"";b&&(b.tagName==="line"?b.style.stroke=I:b.style.fill=I)}}]),m}(l.default);n.default=f},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(m,g){for(var v=0;v<g.length;v++){var y=g[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}return function(m,g,v){return g&&h(m.prototype,g),v&&h(m,v),m}}(),o=function h(m,g,v){m===null&&(m=Function.prototype);var y=Object.getOwnPropertyDescriptor(m,g);if(y===void 0){var b=Object.getPrototypeOf(m);return b===null?void 0:h(b,g,v)}else{if("value"in y)return y.value;var I=y.get;return I===void 0?void 0:I.call(v)}},s=r(28),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(g,v){c(this,m);var y=d(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,g));return y.container.classList.add("ql-icon-picker"),[].forEach.call(y.container.querySelectorAll(".ql-picker-item"),function(b){b.innerHTML=v[b.getAttribute("data-value")||""]}),y.defaultItem=y.container.querySelector(".ql-selected"),y.selectItem(y.defaultItem),y}return a(m,[{key:"selectItem",value:function(v,y){o(m.prototype.__proto__||Object.getPrototypeOf(m.prototype),"selectItem",this).call(this,v,y),v=v||this.defaultItem,this.label.innerHTML=v.innerHTML}}]),m}(l.default);n.default=f},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function l(u,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(u,p.key,p)}}return function(u,c,d){return c&&l(u.prototype,c),d&&l(u,d),u}}();function o(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var s=function(){function l(u,c){var d=this;o(this,l),this.quill=u,this.boundsContainer=c||document.body,this.root=u.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){d.root.style.marginTop=-1*d.quill.root.scrollTop+"px"}),this.hide()}return a(l,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(c){var d=c.left+c.width/2-this.root.offsetWidth/2,p=c.bottom+this.quill.root.scrollTop;this.root.style.left=d+"px",this.root.style.top=p+"px",this.root.classList.remove("ql-flip");var f=this.boundsContainer.getBoundingClientRect(),h=this.root.getBoundingClientRect(),m=0;if(h.right>f.right&&(m=f.right-h.right,this.root.style.left=d+m+"px"),h.left<f.left&&(m=f.left-h.left,this.root.style.left=d+m+"px"),h.bottom>f.bottom){var g=h.bottom-h.top,v=c.bottom-c.top+g;this.root.style.top=p-v+"px",this.root.classList.add("ql-flip")}return m}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),l}();n.default=s},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function E(D,R){var N=[],M=!0,A=!1,_=void 0;try{for(var k=D[Symbol.iterator](),B;!(M=(B=k.next()).done)&&(N.push(B.value),!(R&&N.length===R));M=!0);}catch(F){A=!0,_=F}finally{try{!M&&k.return&&k.return()}finally{if(A)throw _}}return N}return function(D,R){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return E(D,R);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function E(D,R,N){D===null&&(D=Function.prototype);var M=Object.getOwnPropertyDescriptor(D,R);if(M===void 0){var A=Object.getPrototypeOf(D);return A===null?void 0:E(A,R,N)}else{if("value"in M)return M.value;var _=M.get;return _===void 0?void 0:_.call(N)}},s=function(){function E(D,R){for(var N=0;N<R.length;N++){var M=R[N];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(D,M.key,M)}}return function(D,R,N){return R&&E(D.prototype,R),N&&E(D,N),D}}(),l=r(3),u=b(l),c=r(8),d=b(c),p=r(43),f=b(p),h=r(27),m=b(h),g=r(15),v=r(41),y=b(v);function b(E){return E&&E.__esModule?E:{default:E}}function I(E,D){if(!(E instanceof D))throw new TypeError("Cannot call a class as a function")}function T(E,D){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:E}function w(E,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);E.prototype=Object.create(D&&D.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(E,D):E.__proto__=D)}var S=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],U=function(E){w(D,E);function D(R,N){I(this,D),N.modules.toolbar!=null&&N.modules.toolbar.container==null&&(N.modules.toolbar.container=S);var M=T(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,R,N));return M.quill.container.classList.add("ql-snow"),M}return s(D,[{key:"extendToolbar",value:function(N){N.container.classList.add("ql-snow"),this.buildButtons([].slice.call(N.container.querySelectorAll("button")),y.default),this.buildPickers([].slice.call(N.container.querySelectorAll("select")),y.default),this.tooltip=new P(this.quill,this.options.bounds),N.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(M,A){N.handlers.link.call(N,!A.format.link)})}}]),D}(f.default);U.DEFAULTS=(0,u.default)(!0,{},f.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(D){if(D){var R=this.quill.getSelection();if(R==null||R.length==0)return;var N=this.quill.getText(R);/^\S+@\S+\.\S+$/.test(N)&&N.indexOf("mailto:")!==0&&(N="mailto:"+N);var M=this.quill.theme.tooltip;M.edit("link",N)}else this.quill.format("link",!1)}}}}});var P=function(E){w(D,E);function D(R,N){I(this,D);var M=T(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,R,N));return M.preview=M.root.querySelector("a.ql-preview"),M}return s(D,[{key:"listen",value:function(){var N=this;o(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(M){N.root.classList.contains("ql-editing")?N.save():N.edit("link",N.preview.textContent),M.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(M){if(N.linkRange!=null){var A=N.linkRange;N.restoreFocus(),N.quill.formatText(A,"link",!1,d.default.sources.USER),delete N.linkRange}M.preventDefault(),N.hide()}),this.quill.on(d.default.events.SELECTION_CHANGE,function(M,A,_){if(M!=null){if(M.length===0&&_===d.default.sources.USER){var k=N.quill.scroll.descendant(m.default,M.index),B=a(k,2),F=B[0],x=B[1];if(F!=null){N.linkRange=new g.Range(M.index-x,F.length());var $=m.default.formats(F.domNode);N.preview.textContent=$,N.preview.setAttribute("href",$),N.show(),N.position(N.quill.getBounds(N.linkRange));return}}else delete N.linkRange;N.hide()}})}},{key:"show",value:function(){o(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),D}(p.BaseTooltip);P.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),n.default=U},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(29),o=me(a),s=r(36),l=r(38),u=r(64),c=r(65),d=me(c),p=r(66),f=me(p),h=r(67),m=me(h),g=r(37),v=r(26),y=r(39),b=r(40),I=r(56),T=me(I),w=r(68),S=me(w),U=r(27),P=me(U),E=r(69),D=me(E),R=r(70),N=me(R),M=r(71),A=me(M),_=r(72),k=me(_),B=r(73),F=me(B),x=r(13),$=me(x),j=r(74),V=me(j),H=r(75),z=me(H),q=r(57),W=me(q),Y=r(41),Z=me(Y),X=r(28),Q=me(X),ce=r(59),J=me(ce),ee=r(60),ne=me(ee),ie=r(61),oe=me(ie),se=r(108),pe=me(se),fe=r(62),ge=me(fe);function me(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}o.default.register({"attributors/attribute/direction":l.DirectionAttribute,"attributors/class/align":s.AlignClass,"attributors/class/background":g.BackgroundClass,"attributors/class/color":v.ColorClass,"attributors/class/direction":l.DirectionClass,"attributors/class/font":y.FontClass,"attributors/class/size":b.SizeClass,"attributors/style/align":s.AlignStyle,"attributors/style/background":g.BackgroundStyle,"attributors/style/color":v.ColorStyle,"attributors/style/direction":l.DirectionStyle,"attributors/style/font":y.FontStyle,"attributors/style/size":b.SizeStyle},!0),o.default.register({"formats/align":s.AlignClass,"formats/direction":l.DirectionClass,"formats/indent":u.IndentClass,"formats/background":g.BackgroundStyle,"formats/color":v.ColorStyle,"formats/font":y.FontClass,"formats/size":b.SizeClass,"formats/blockquote":d.default,"formats/code-block":$.default,"formats/header":f.default,"formats/list":m.default,"formats/bold":T.default,"formats/code":x.Code,"formats/italic":S.default,"formats/link":P.default,"formats/script":D.default,"formats/strike":N.default,"formats/underline":A.default,"formats/image":k.default,"formats/video":F.default,"formats/list/item":h.ListItem,"modules/formula":V.default,"modules/syntax":z.default,"modules/toolbar":W.default,"themes/bubble":pe.default,"themes/snow":ge.default,"ui/icons":Z.default,"ui/picker":Q.default,"ui/icon-picker":ne.default,"ui/color-picker":J.default,"ui/tooltip":oe.default},!0),n.default=o.default},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.IndentClass=void 0;var a=function(){function m(g,v){for(var y=0;y<v.length;y++){var b=v[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(g,b.key,b)}}return function(g,v,y){return v&&m(g.prototype,v),y&&m(g,y),g}}(),o=function m(g,v,y){g===null&&(g=Function.prototype);var b=Object.getOwnPropertyDescriptor(g,v);if(b===void 0){var I=Object.getPrototypeOf(g);return I===null?void 0:m(I,v,y)}else{if("value"in b)return b.value;var T=b.get;return T===void 0?void 0:T.call(y)}},s=r(0),l=u(s);function u(m){return m&&m.__esModule?m:{default:m}}function c(m,g){if(!(m instanceof g))throw new TypeError("Cannot call a class as a function")}function d(m,g){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:m}function p(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);m.prototype=Object.create(g&&g.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(m,g):m.__proto__=g)}var f=function(m){p(g,m);function g(){return c(this,g),d(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments))}return a(g,[{key:"add",value:function(y,b){if(b==="+1"||b==="-1"){var I=this.value(y)||0;b=b==="+1"?I+1:I-1}return b===0?(this.remove(y),!0):o(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"add",this).call(this,y,b)}},{key:"canAdd",value:function(y,b){return o(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"canAdd",this).call(this,y,b)||o(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"canAdd",this).call(this,y,parseInt(b))}},{key:"value",value:function(y){return parseInt(o(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"value",this).call(this,y))||void 0}}]),g}(l.default.Attributor.Class),h=new f("indent","ql-indent",{scope:l.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});n.IndentClass=h},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(4),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}function l(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}function u(p,f){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:p}function c(p,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);p.prototype=Object.create(f&&f.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(p,f):p.__proto__=f)}var d=function(p){c(f,p);function f(){return l(this,f),u(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return f}(o.default);d.blotName="blockquote",d.tagName="blockquote",n.default=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function f(h,m){for(var g=0;g<m.length;g++){var v=m[g];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(h,v.key,v)}}return function(h,m,g){return m&&f(h.prototype,m),g&&f(h,g),h}}(),o=r(4),s=l(o);function l(f){return f&&f.__esModule?f:{default:f}}function u(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}function c(f,h){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h&&(typeof h=="object"||typeof h=="function")?h:f}function d(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);f.prototype=Object.create(h&&h.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(f,h):f.__proto__=h)}var p=function(f){d(h,f);function h(){return u(this,h),c(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments))}return a(h,null,[{key:"formats",value:function(g){return this.tagName.indexOf(g.tagName)+1}}]),h}(s.default);p.blotName="header",p.tagName=["H1","H2","H3","H4","H5","H6"],n.default=p},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ListItem=void 0;var a=function(){function I(T,w){for(var S=0;S<w.length;S++){var U=w[S];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(T,U.key,U)}}return function(T,w,S){return w&&I(T.prototype,w),S&&I(T,S),T}}(),o=function I(T,w,S){T===null&&(T=Function.prototype);var U=Object.getOwnPropertyDescriptor(T,w);if(U===void 0){var P=Object.getPrototypeOf(T);return P===null?void 0:I(P,w,S)}else{if("value"in U)return U.value;var E=U.get;return E===void 0?void 0:E.call(S)}},s=r(0),l=f(s),u=r(4),c=f(u),d=r(25),p=f(d);function f(I){return I&&I.__esModule?I:{default:I}}function h(I,T,w){return T in I?Object.defineProperty(I,T,{value:w,enumerable:!0,configurable:!0,writable:!0}):I[T]=w,I}function m(I,T){if(!(I instanceof T))throw new TypeError("Cannot call a class as a function")}function g(I,T){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T&&(typeof T=="object"||typeof T=="function")?T:I}function v(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof T);I.prototype=Object.create(T&&T.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),T&&(Object.setPrototypeOf?Object.setPrototypeOf(I,T):I.__proto__=T)}var y=function(I){v(T,I);function T(){return m(this,T),g(this,(T.__proto__||Object.getPrototypeOf(T)).apply(this,arguments))}return a(T,[{key:"format",value:function(S,U){S===b.blotName&&!U?this.replaceWith(l.default.create(this.statics.scope)):o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"format",this).call(this,S,U)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(S,U){return this.parent.isolate(this.offset(this.parent),this.length()),S===this.parent.statics.blotName?(this.parent.replaceWith(S,U),this):(this.parent.unwrap(),o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"replaceWith",this).call(this,S,U))}}],[{key:"formats",value:function(S){return S.tagName===this.tagName?void 0:o(T.__proto__||Object.getPrototypeOf(T),"formats",this).call(this,S)}}]),T}(c.default);y.blotName="list-item",y.tagName="LI";var b=function(I){v(T,I),a(T,null,[{key:"create",value:function(S){var U=S==="ordered"?"OL":"UL",P=o(T.__proto__||Object.getPrototypeOf(T),"create",this).call(this,U);return(S==="checked"||S==="unchecked")&&P.setAttribute("data-checked",S==="checked"),P}},{key:"formats",value:function(S){if(S.tagName==="OL")return"ordered";if(S.tagName==="UL")return S.hasAttribute("data-checked")?S.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function T(w){m(this,T);var S=g(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,w)),U=function(E){if(E.target.parentNode===w){var D=S.statics.formats(w),R=l.default.find(E.target);D==="checked"?R.format("list","unchecked"):D==="unchecked"&&R.format("list","checked")}};return w.addEventListener("touchstart",U),w.addEventListener("mousedown",U),S}return a(T,[{key:"format",value:function(S,U){this.children.length>0&&this.children.tail.format(S,U)}},{key:"formats",value:function(){return h({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(S,U){if(S instanceof y)o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"insertBefore",this).call(this,S,U);else{var P=U==null?this.length():U.offset(this),E=this.split(P);E.parent.insertBefore(S,E)}}},{key:"optimize",value:function(S){o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"optimize",this).call(this,S);var U=this.next;U!=null&&U.prev===this&&U.statics.blotName===this.statics.blotName&&U.domNode.tagName===this.domNode.tagName&&U.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(U.moveChildren(this),U.remove())}},{key:"replace",value:function(S){if(S.statics.blotName!==this.statics.blotName){var U=l.default.create(this.statics.defaultChild);S.moveChildren(U),this.appendChild(U)}o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"replace",this).call(this,S)}}]),T}(p.default);b.blotName="list",b.scope=l.default.Scope.BLOCK_BLOT,b.tagName=["OL","UL"],b.defaultChild="list-item",b.allowedChildren=[y],n.ListItem=y,n.default=b},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(56),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}function l(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}function u(p,f){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:p}function c(p,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);p.prototype=Object.create(f&&f.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(p,f):p.__proto__=f)}var d=function(p){c(f,p);function f(){return l(this,f),u(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return f}(o.default);d.blotName="italic",d.tagName=["EM","I"],n.default=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(m,g){for(var v=0;v<g.length;v++){var y=g[v];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}return function(m,g,v){return g&&h(m.prototype,g),v&&h(m,v),m}}(),o=function h(m,g,v){m===null&&(m=Function.prototype);var y=Object.getOwnPropertyDescriptor(m,g);if(y===void 0){var b=Object.getPrototypeOf(m);return b===null?void 0:h(b,g,v)}else{if("value"in y)return y.value;var I=y.get;return I===void 0?void 0:I.call(v)}},s=r(6),l=u(s);function u(h){return h&&h.__esModule?h:{default:h}}function c(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function d(h,m){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:h}function p(h,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);h.prototype=Object.create(m&&m.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(h,m):h.__proto__=m)}var f=function(h){p(m,h);function m(){return c(this,m),d(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return a(m,null,[{key:"create",value:function(v){return v==="super"?document.createElement("sup"):v==="sub"?document.createElement("sub"):o(m.__proto__||Object.getPrototypeOf(m),"create",this).call(this,v)}},{key:"formats",value:function(v){if(v.tagName==="SUB")return"sub";if(v.tagName==="SUP")return"super"}}]),m}(l.default);f.blotName="script",f.tagName=["SUB","SUP"],n.default=f},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(6),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}function l(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}function u(p,f){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:p}function c(p,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);p.prototype=Object.create(f&&f.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(p,f):p.__proto__=f)}var d=function(p){c(f,p);function f(){return l(this,f),u(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return f}(o.default);d.blotName="strike",d.tagName="S",n.default=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=r(6),o=s(a);function s(p){return p&&p.__esModule?p:{default:p}}function l(p,f){if(!(p instanceof f))throw new TypeError("Cannot call a class as a function")}function u(p,f){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:p}function c(p,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);p.prototype=Object.create(f&&f.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(p,f):p.__proto__=f)}var d=function(p){c(f,p);function f(){return l(this,f),u(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return f}(o.default);d.blotName="underline",d.tagName="U",n.default=d},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function g(v,y){for(var b=0;b<y.length;b++){var I=y[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,y,b){return y&&g(v.prototype,y),b&&g(v,b),v}}(),o=function g(v,y,b){v===null&&(v=Function.prototype);var I=Object.getOwnPropertyDescriptor(v,y);if(I===void 0){var T=Object.getPrototypeOf(v);return T===null?void 0:g(T,y,b)}else{if("value"in I)return I.value;var w=I.get;return w===void 0?void 0:w.call(b)}},s=r(0),l=c(s),u=r(27);function c(g){return g&&g.__esModule?g:{default:g}}function d(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function p(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function f(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var h=["alt","height","width"],m=function(g){f(v,g);function v(){return d(this,v),p(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return a(v,[{key:"format",value:function(b,I){h.indexOf(b)>-1?I?this.domNode.setAttribute(b,I):this.domNode.removeAttribute(b):o(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"format",this).call(this,b,I)}}],[{key:"create",value:function(b){var I=o(v.__proto__||Object.getPrototypeOf(v),"create",this).call(this,b);return typeof b=="string"&&I.setAttribute("src",this.sanitize(b)),I}},{key:"formats",value:function(b){return h.reduce(function(I,T){return b.hasAttribute(T)&&(I[T]=b.getAttribute(T)),I},{})}},{key:"match",value:function(b){return/\.(jpe?g|gif|png)$/.test(b)||/^data:image\/.+;base64/.test(b)}},{key:"sanitize",value:function(b){return(0,u.sanitize)(b,["http","https","data"])?b:"//:0"}},{key:"value",value:function(b){return b.getAttribute("src")}}]),v}(l.default.Embed);m.blotName="image",m.tagName="IMG",n.default=m},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function g(v,y){for(var b=0;b<y.length;b++){var I=y[b];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(v,I.key,I)}}return function(v,y,b){return y&&g(v.prototype,y),b&&g(v,b),v}}(),o=function g(v,y,b){v===null&&(v=Function.prototype);var I=Object.getOwnPropertyDescriptor(v,y);if(I===void 0){var T=Object.getPrototypeOf(v);return T===null?void 0:g(T,y,b)}else{if("value"in I)return I.value;var w=I.get;return w===void 0?void 0:w.call(b)}},s=r(4),l=r(27),u=c(l);function c(g){return g&&g.__esModule?g:{default:g}}function d(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function p(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function f(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var h=["height","width"],m=function(g){f(v,g);function v(){return d(this,v),p(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return a(v,[{key:"format",value:function(b,I){h.indexOf(b)>-1?I?this.domNode.setAttribute(b,I):this.domNode.removeAttribute(b):o(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"format",this).call(this,b,I)}}],[{key:"create",value:function(b){var I=o(v.__proto__||Object.getPrototypeOf(v),"create",this).call(this,b);return I.setAttribute("frameborder","0"),I.setAttribute("allowfullscreen",!0),I.setAttribute("src",this.sanitize(b)),I}},{key:"formats",value:function(b){return h.reduce(function(I,T){return b.hasAttribute(T)&&(I[T]=b.getAttribute(T)),I},{})}},{key:"sanitize",value:function(b){return u.default.sanitize(b)}},{key:"value",value:function(b){return b.getAttribute("src")}}]),v}(s.BlockEmbed);m.blotName="video",m.className="ql-video",m.tagName="IFRAME",n.default=m},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.FormulaBlot=void 0;var a=function(){function b(I,T){for(var w=0;w<T.length;w++){var S=T[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(I,S.key,S)}}return function(I,T,w){return T&&b(I.prototype,T),w&&b(I,w),I}}(),o=function b(I,T,w){I===null&&(I=Function.prototype);var S=Object.getOwnPropertyDescriptor(I,T);if(S===void 0){var U=Object.getPrototypeOf(I);return U===null?void 0:b(U,T,w)}else{if("value"in S)return S.value;var P=S.get;return P===void 0?void 0:P.call(w)}},s=r(35),l=f(s),u=r(5),c=f(u),d=r(9),p=f(d);function f(b){return b&&b.__esModule?b:{default:b}}function h(b,I){if(!(b instanceof I))throw new TypeError("Cannot call a class as a function")}function m(b,I){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I&&(typeof I=="object"||typeof I=="function")?I:b}function g(b,I){if(typeof I!="function"&&I!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof I);b.prototype=Object.create(I&&I.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(b,I):b.__proto__=I)}var v=function(b){g(I,b);function I(){return h(this,I),m(this,(I.__proto__||Object.getPrototypeOf(I)).apply(this,arguments))}return a(I,null,[{key:"create",value:function(w){var S=o(I.__proto__||Object.getPrototypeOf(I),"create",this).call(this,w);return typeof w=="string"&&(window.katex.render(w,S,{throwOnError:!1,errorColor:"#f00"}),S.setAttribute("data-value",w)),S}},{key:"value",value:function(w){return w.getAttribute("data-value")}}]),I}(l.default);v.blotName="formula",v.className="ql-formula",v.tagName="SPAN";var y=function(b){g(I,b),a(I,null,[{key:"register",value:function(){c.default.register(v,!0)}}]);function I(){h(this,I);var T=m(this,(I.__proto__||Object.getPrototypeOf(I)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return T}return I}(p.default);n.FormulaBlot=v,n.default=y},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.CodeToken=n.CodeBlock=void 0;var a=function(){function w(S,U){for(var P=0;P<U.length;P++){var E=U[P];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(S,E.key,E)}}return function(S,U,P){return U&&w(S.prototype,U),P&&w(S,P),S}}(),o=function w(S,U,P){S===null&&(S=Function.prototype);var E=Object.getOwnPropertyDescriptor(S,U);if(E===void 0){var D=Object.getPrototypeOf(S);return D===null?void 0:w(D,U,P)}else{if("value"in E)return E.value;var R=E.get;return R===void 0?void 0:R.call(P)}},s=r(0),l=m(s),u=r(5),c=m(u),d=r(9),p=m(d),f=r(13),h=m(f);function m(w){return w&&w.__esModule?w:{default:w}}function g(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")}function v(w,S){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:w}function y(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);w.prototype=Object.create(S&&S.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(w,S):w.__proto__=S)}var b=function(w){y(S,w);function S(){return g(this,S),v(this,(S.__proto__||Object.getPrototypeOf(S)).apply(this,arguments))}return a(S,[{key:"replaceWith",value:function(P){this.domNode.textContent=this.domNode.textContent,this.attach(),o(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"replaceWith",this).call(this,P)}},{key:"highlight",value:function(P){var E=this.domNode.textContent;this.cachedText!==E&&((E.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=P(E),this.domNode.normalize(),this.attach()),this.cachedText=E)}}]),S}(h.default);b.className="ql-syntax";var I=new l.default.Attributor.Class("token","hljs",{scope:l.default.Scope.INLINE}),T=function(w){y(S,w),a(S,null,[{key:"register",value:function(){c.default.register(I,!0),c.default.register(b,!0)}}]);function S(U,P){g(this,S);var E=v(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,U,P));if(typeof E.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var D=null;return E.quill.on(c.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(D),D=setTimeout(function(){E.highlight(),D=null},E.options.interval)}),E.highlight(),E}return a(S,[{key:"highlight",value:function(){var P=this;if(!this.quill.selection.composing){this.quill.update(c.default.sources.USER);var E=this.quill.getSelection();this.quill.scroll.descendants(b).forEach(function(D){D.highlight(P.options.highlight)}),this.quill.update(c.default.sources.SILENT),E!=null&&this.quill.setSelection(E,c.default.sources.SILENT)}}}]),S}(p.default);T.DEFAULTS={highlight:function(){return window.hljs==null?null:function(w){var S=window.hljs.highlightAuto(w);return S.value}}(),interval:1e3},n.CodeBlock=b,n.CodeToken=I,n.default=T},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(i,n){i.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(i,n){i.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(i,n){i.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(i,n){i.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(i,n){i.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(i,n,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BubbleTooltip=void 0;var a=function S(U,P,E){U===null&&(U=Function.prototype);var D=Object.getOwnPropertyDescriptor(U,P);if(D===void 0){var R=Object.getPrototypeOf(U);return R===null?void 0:S(R,P,E)}else{if("value"in D)return D.value;var N=D.get;return N===void 0?void 0:N.call(E)}},o=function(){function S(U,P){for(var E=0;E<P.length;E++){var D=P[E];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(U,D.key,D)}}return function(U,P,E){return P&&S(U.prototype,P),E&&S(U,E),U}}(),s=r(3),l=g(s),u=r(8),c=g(u),d=r(43),p=g(d),f=r(15),h=r(41),m=g(h);function g(S){return S&&S.__esModule?S:{default:S}}function v(S,U){if(!(S instanceof U))throw new TypeError("Cannot call a class as a function")}function y(S,U){if(!S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return U&&(typeof U=="object"||typeof U=="function")?U:S}function b(S,U){if(typeof U!="function"&&U!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof U);S.prototype=Object.create(U&&U.prototype,{constructor:{value:S,enumerable:!1,writable:!0,configurable:!0}}),U&&(Object.setPrototypeOf?Object.setPrototypeOf(S,U):S.__proto__=U)}var I=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],T=function(S){b(U,S);function U(P,E){v(this,U),E.modules.toolbar!=null&&E.modules.toolbar.container==null&&(E.modules.toolbar.container=I);var D=y(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,P,E));return D.quill.container.classList.add("ql-bubble"),D}return o(U,[{key:"extendToolbar",value:function(E){this.tooltip=new w(this.quill,this.options.bounds),this.tooltip.root.appendChild(E.container),this.buildButtons([].slice.call(E.container.querySelectorAll("button")),m.default),this.buildPickers([].slice.call(E.container.querySelectorAll("select")),m.default)}}]),U}(p.default);T.DEFAULTS=(0,l.default)(!0,{},p.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(U){U?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var w=function(S){b(U,S);function U(P,E){v(this,U);var D=y(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,P,E));return D.quill.on(c.default.events.EDITOR_CHANGE,function(R,N,M,A){if(R===c.default.events.SELECTION_CHANGE)if(N!=null&&N.length>0&&A===c.default.sources.USER){D.show(),D.root.style.left="0px",D.root.style.width="",D.root.style.width=D.root.offsetWidth+"px";var _=D.quill.getLines(N.index,N.length);if(_.length===1)D.position(D.quill.getBounds(N));else{var k=_[_.length-1],B=D.quill.getIndex(k),F=Math.min(k.length()-1,N.index+N.length-B),x=D.quill.getBounds(new f.Range(B,F));D.position(x)}}else document.activeElement!==D.textbox&&D.quill.hasFocus()&&D.hide()}),D}return o(U,[{key:"listen",value:function(){var E=this;a(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){E.root.classList.remove("ql-editing")}),this.quill.on(c.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!E.root.classList.contains("ql-hidden")){var D=E.quill.getSelection();D!=null&&E.position(E.quill.getBounds(D))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(E){var D=a(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"position",this).call(this,E),R=this.root.querySelector(".ql-tooltip-arrow");if(R.style.marginLeft="",D===0)return D;R.style.marginLeft=-1*D-R.offsetWidth/2+"px"}}]),U}(d.BaseTooltip);w.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),n.BubbleTooltip=w,n.default=T},function(i,n,r){i.exports=r(63)}]).default})})(tUe);var Dot=tUe.exports;const Pot=tq(Dot);function Eot({controlAnchor:t}){const e={editing:!1};return no({target:t,items:[{label:"Tournament image",onClick:Uot,id:"tournamentImage",location:mt,intent:"none"},{label:"Edit overview",onClick:()=>{const r=document.getElementById("editOverview");r.innerHTML=e.editing?"Edit overview":"Save overview";const a=document.getElementById("notes");if(e.editing){a.previousElementSibling.remove(),a.style.border="none";const o=a.querySelector(".ql-editor").innerHTML;Oa(a),a.innerHTML=o,yt({methods:[{method:P8e,params:{notes:o}}]})}else{a.style.border=".5px solid",a.style.borderTop="";const o=new Pot("#notes",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["blockquote","code-block","link","video"],["clean"]]},theme:"snow"});ze.quill=o}e.editing=!e.editing},id:"editOverview",location:mt,intent:"none"}]}).elements}function Cot(){var a;const t=document.getElementById(H0);t.style.minHeight=`${window.innerHeight*.9}px`,Oa(t);const e=document.createElement("div");e.style.fontWeight="bold",e.className="block",e.innerHTML="Tournament Overview",t.appendChild(e);const i=document.createElement("div");t.appendChild(i);const n=(a=$e.getTournament().tournamentRecord)==null?void 0:a.notes,r=document.createElement("div");r.className="ql-container ql-snow",r.style.border="none",r.innerHTML=n??"",r.id="notes",t.appendChild(r),Eot({controlAnchor:i})}let mg;function Xx(t){WC(BM,t),WC(NU,t),WC(Cp,t),WC(Pk,t);const e=document.getElementById("sideNav");t===BM?e.style.display="":e.style.display=lt}function WC(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const Rot=t=>t?t===mg:mg,XF=()=>{const t=document.getElementById(Uk);t.style.display=lt,mg=NU,Xx(NU)},Mot=t=>{const e=document.getElementById(Uk);e.style.display="",mg=t,Xx(BM)},Not=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>");const e=document.getElementById(Uk);e.style.display="",mg=Cp,Xx(mg)},Aot=()=>{mg=Pk,Xx(mg)};function _ot({config:t}={}){const{tournamentRecord:e}=$e.getTournament();(e==null?void 0:e.tournamentId)===t.tournamentId?iUe(t):(ze.ee.emit(k0e,ze.tournamentId),Ys.findTournament(t.tournamentId).then(i=>UV({tournamentRecord:i,config:t})))}function JF({config:t}){Mot(Ia),hnt(),WTe(t.selectedTab),iUe(t)}function iUe(t){const{selectedTab:e=Rp}=t;zue(e)&&(e===Rp&&lJe({participantView:t.participantView}),e===ry&&ISe({scheduledDate:t.scheduledDate}),e===H0&&Cot(),e===Yc&&Tot(t),e===I3&&rnt(),e===w3&&Cnt())}function UV({tournamentRecord:t,config:e}){const i=ol(),n=(i==null?void 0:i.provider)||(ze==null?void 0:ze.provider),r=()=>{Mt({message:"Tournament not found",onClose:()=>{ze.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=o=>{var l,u;const s=(u=(l=o==null?void 0:o.data)==null?void 0:l.tournamentRecords)==null?void 0:u[e.tournamentId];s?($e.setState(s),JF({config:e})):r()};if(n){const o=()=>{t?($e.setState(t),JF({config:e})):r()};e.tournamentId&&_k({tournamentId:e.tournamentId}).then(a,o)}else $e.setState(t),JF({config:e})}const NJ={addDrawDefinition:t=>ia("addDrawDefinition",t),addMatchUps:t=>ia("addMatchUps",t),addParticipants:t=>ia("addParticipants",t),addVenue:t=>ia("addVenue",t),deletedDrawIds:t=>ia("deletedDrawIds",t),deletedMatchUpIds:t=>ia("deletedMatchUpIds",t),deleteVenue:t=>ia("deleteVenue",t),modifyDrawDefinition:t=>ia("modifyDrawDefinition",t),modifyDrawEntries:t=>ia("modifyDrawEntries",t),modifyEventEntries:t=>ia("modifyEventEntries",t),modifyMatchUp:t=>ia("modifyMatchUp",t),modifyParticipants:t=>ia("modifyParticipants",t),modifyPositionAssignments:t=>ia("modifyPositionAssignments",t),modifySeedAssignments:t=>ia("modifySeedAssignments",t),modifyVenue:t=>ia("modifyVenue",t),publishEvent:t=>ia("publishEvent",t),publishEventSeeding:t=>ia("publishEventSeeding",t),publishOrderOfPlay:t=>ia("publishOrderOfPlay",t),unPublishEvent:t=>ia("unPublishEvent",t),unPublishEventSeeding:t=>ia("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>ia("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>ia("updateInContextMatchUp",t),modifyTournamentDetail:t=>ia("modifyTournamentDetail",t)};function ia(t,e){var i,n,r;return typeof((n=(i=window.dev)==null?void 0:i.subs)==null?void 0:n[t])=="function"?window.dev.subs[t](e):(window.dev.allSubscriptions||((r=window.dev.subs)==null?void 0:r[t]))&&console.log(t,e)}function nUe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=r=>{var o;if(!Array.isArray(r)){Mt({message:"missing methods array",intent:"is-danger"});return}((o=$e.getTournament().tournamentRecord)==null?void 0:o.tournamentId)?yt({methods:r,callback:l=>{var u;if(l!=null&&l.success){Mt({message:"success",intent:"is-success"});const c=$e.getTournament().tournamentRecord;UV({tournamentRecord:c,config:{selectedTab:Ia}})}else Mt({message:((u=l==null?void 0:l.error)==null?void 0:u.message)??"error",intent:"is-danger"}),console.log({result:l})}}):Mt({message:"missing tournament",intent:"is-danger"})},i=r=>{_k({tournamentId:r}).then(a=>{var o,s;if(a!=null&&a.error)console.log({error:a.error});else{const l=(s=(o=a==null?void 0:a.data)==null?void 0:o.tournamentRecords)==null?void 0:s[r];l&&UV({tournamentRecord:l,config:{selectedTab:Ia}})}})},n=Object.assign({},...Object.keys(NJ).map(r=>({[r]:!1})));KC({getProviders:JM,getProvider:r=>JM().then(a=>{var o;return console.log((o=a==null?void 0:a.data)==null?void 0:o.providers.find(s=>s.value.organisationName.toLowerCase().includes(r.toLowerCase())))}),getTournament:()=>{var r;return(r=$e.getTournament())==null?void 0:r.tournamentRecord},getContext:RI.getDevContext,tournamentEngine:$e,context:RI.setDevContext,generateMockTournament:Oot,modifyTournament:e,fetchTournament:i,sendTournament:K3,getLoginState:ol,factory:aB,baseApi:Wu,dayjs:O6,help:t,subs:n}),KC({connectSocket:r8,disconnectSocket:LE,emitTmx:a8}),KC({tmx2db:Ys,load:kot,exportTournamentRecord:X5e}),KC({env:ii,tournamentContext:ze}),RI.setSubscriptions({subscriptions:NJ})}function KC(t){if(fc(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function kot(t){if(typeof t=="object"){const e=t.tournamentRecord||t;(e==null?void 0:e.tournamentId)&&rUe(e)}}function Oot(t){const{tournamentRecord:e,error:i}=XD.generateTournamentRecord(t);i?console.log({error:i}):rUe(e)}function rUe(t){const e=t==null?void 0:t.tournamentId;Ewe({tournamentRecord:t,callback:()=>ze.router.navigate(`/${Ia}/${e}`)})}class bT extends Error{}bT.prototype.name="InvalidTokenError";function xot(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Lot(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return xot(e)}catch{return atob(e)}}function Fot(t,e){if(typeof t!="string")throw new bT("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new bT(`Invalid token specified: missing part #${i+1}`);let r;try{r=Lot(n)}catch(a){throw new bT(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new bT(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function aUe(t){var r,a;if(!t||t==="undefined"){HIe();return}let e;try{e=Fot(t)}catch{zIe();return}const i=new Date;return(e==null?void 0:e.exp)<i.getTime()/1e3?Jx():(((r=e==null?void 0:e.permissions)!=null&&r.includes("devMode")||(a=e==null?void 0:e.roles)!=null&&a.includes("develope"))&&nUe(),e)}function oUe(){let t;yn({title:"Settings",content:n=>t=Wn(n,[{options:[{text:"WTN",field:"wtn",checked:ii.activeScale===OU},{text:"UTR",field:"utr",checked:ii.activeScale===oy}],onClick:r=>console.log({x:r}),label:"Active rating",field:"activeRating",id:"activeRating",radio:!0},{label:"Save local copies",checked:ii.saveLocal,field:"saveLocal",id:"saveLocal",checkbox:!0}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Save",intent:"is-primary",onClick:()=>{const n=t.wtn.checked?OU:oy;ii.saveLocal=t.saveLocal.checked,pA(n)},close:!0}]})}function Bot(t){const e=document.getElementById(t);e&&e.addEventListener("click",oUe)}function $ot(t,e=[]){const n=[{value:{organisationName:"None"},key:""},...e].map(({key:p,value:f})=>({label:f==null?void 0:f.organisationName,value:p}));let r;const a={providerId:""},s=[{onInput:({inputs:p})=>{const f=p.email.value,h=fA(f),m=document.getElementById("inviteUser");m&&(m.disabled=!h)},control:"email"}],l=p=>r=Wn(p,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",validator:fA,autocomplete:"off",label:"Email",field:"email"},{text:"Roles",header:!0},{label:"Client",field:"client",checkbox:!0,width:"50%",id:"client",fieldPair:{label:"Director",field:"director",id:"director",checkbox:!0}},{label:"Admin",checkbox:!0,field:"admin",width:"50%",id:"admin",fieldPair:{label:"Official",field:"official",id:"official",checkbox:!0}},{label:"Scoring",field:"score",width:"50%",id:"score",checkbox:!0,fieldPair:{label:"Developer",field:"developer",id:"developer",checkbox:!0}},{label:"Generate",field:"generate",checkbox:!0,id:"generate"},{value:a.providerId,options:n,field:"providerId",label:"Provider"},{text:"Permissions",header:!0},{label:"Delete Tournaments",field:"deleteTournament",checkbox:!0,id:"delete"},{label:"Dev mode",field:"devMode",checkbox:!0,id:"devmode"}],s),u=["client","admin","score","developer","generate","director","official"],c=["devMode"];yn({title:"Invite user",content:l,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Invite",intent:"is-primary",id:"inviteUser",disabled:!0,onClick:()=>{const p=r.email.value,f=r.providerId.value,h=c.map(v=>r[v].checked&&v).filter(Boolean),m=u.map(v=>r[v].checked&&v).filter(Boolean);console.log({userRoles:m});const g=v=>rt(t)&&t(v);dnt(p,f,m,h).then(g,v=>console.log({err:v}))},close:!0}]})}function Vot(t){navigator.clipboard.writeText(t).then(()=>Mt({message:"Copied to clipboard",intent:"is-success"})).catch(a=>Mt({message:a,intent:"is-danger"}));let e=document.createElement("input");e.style.opacity=0,e.setAttribute("id","c2c"),e.setAttribute("type","text"),e.setAttribute("value",t);let i=document.body.appendChild(e),n=document.createElement("button");n.style.display="none",n.setAttribute("data-copytarget","#c2c"),n.addEventListener("click",jot,!0);let r=document.body.appendChild(n);r.click(),r.remove(),i.remove()}function jot(t){let i=t.target.dataset.copytarget,n=i?document.querySelector(i):null;if(n!=null&&n.select){n.select();try{document.execCommand("copy"),n.blur()}catch{alert("please press Ctrl/Cmd+C to copy")}}}function sUe(t){var r;const e=document.getElementById("login"),i=ze==null?void 0:ze.provider,n=(r=t==null?void 0:t.roles)==null?void 0:r.includes(Dk);e.style.color=i&&"red"||n&&"green"||"blue"}function ol(){const t=qIe(),e=aUe(t);return e&&sUe(e),e}function Jx(){zIe(),HIe(),LE(),ze.provider=void 0,ze.router.navigate(`/${Cp}/logout`);const t=document.getElementById("login");t.style.color=""}function Got({data:t,callback:e}){var n;const i=aUe(t.token);i&&(q5e(t.token),Mt({intent:"is-success",message:"Log in successful"}),LE(),$e.reset(),sUe(i),rt(e)&&e(),ze.router.navigate(`/${Cp}/${(n=i.provider)==null?void 0:n.organisationAbbreviation}`))}function Hot(){JM().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.providers)==null?void 0:i.map(({value:n})=>({onClick:()=>{ze.provider=n,ze.router.navigate(`/${Cp}/${n.organisationAbbreviation}`)},participantName:n.organisationName}));e&&j6({title:"Select Provider",options:e,selectionLimit:1})})}function zot(){WLe().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.users)==null?void 0:i.map(({value:n})=>({participantName:`${n.firstName} ${n.lastName} (${n.email})`,onClick:()=>KLe(n).then(()=>Mt({message:"User removed"}))}));e&&j6({title:"Select User",options:e,selectionLimit:1})})}function qot(){ze.provider=void 0,ze.router.navigate(`/${Cp}/superadmin`)}function AJ(t){const e=document.getElementById(t),i=n=>console.log("Invite:",{error:n});if(e){const n=r=>{const a=r==null?void 0:r.data.inviteCode;if(a){const o=`${window.location.origin}${window.location.pathname}/#/${Eue}/${a}`;Vot(o),console.log({inviteCode:a,inviteURL:o})}else i(r)};e.addEventListener("click",()=>{var u,c;const r=ol(),a=(u=r==null?void 0:r.roles)==null?void 0:u.includes(Dk),o=(c=r==null?void 0:r.roles)==null?void 0:c.includes(nxe),s=ze==null?void 0:ze.provider;Ps({target:e,title:"Authorization",items:[{onClick:()=>Mt({message:"TBD: Registration Modal"}),text:"Register",hide:r},{onClick:()=>UTe(),hide:r,text:"Log in"},{style:"text-decoration: line-through;",hide:!a||!s,onClick:qot,text:"Impersonate"},{hide:!a||s,onClick:Hot,text:"Impersonate"},{onClick:z5e,text:"Create provider",hide:!a},{onClick:zot,text:"Remove user",hide:!a},{onClick:()=>JM().then(({data:d})=>$ot(n,d==null?void 0:d.providers),i),hide:!a&&!s,text:"Invite User"},{text:"Log out",hide:!r,onClick:Jx},{hide:!o,divider:!0},{onClick:H5e,heading:"Actions",hide:!o},{divider:!0},{onClick:oUe,heading:"Settings"}]})})}}/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */const Wot=function(){function t(){}let e=t.prototype;function i(a,o){let s=a.length;for(;s--;)if(a[s].listener===o)return s;return-1}function n(a){return function(){return this[a].apply(this,arguments)}}e.getListeners=function(o){let s=this._getEvents(),l,u;if(o instanceof RegExp){l={};for(u in s)s.hasOwnProperty(u)&&o.test(u)&&(l[u]=s[u])}else l=s[o]||(s[o]=[]);return l},e.flattenListeners=function(o){let s=[],l;for(l=0;l<o.length;l+=1)s.push(o[l].listener);return s},e.getListenersAsObject=function(o){let s=this.getListeners(o),l;return s instanceof Array&&(l={},l[o]=s),l||s};function r(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?r(a.listener):!1}return e.addListener=function(o,s){if(!r(s))throw new TypeError("listener must be a function");let l=this.getListenersAsObject(o),u=typeof s=="object",c;for(c in l)l.hasOwnProperty(c)&&i(l[c],s)===-1&&l[c].push(u?s:{listener:s,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(o,s){return this.addListener(o,{listener:s,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(o){return this.getListeners(o),this},e.defineEvents=function(o){for(let s=0;s<o.length;s+=1)this.defineEvent(o[s]);return this},e.removeListener=function(o,s){let l=this.getListenersAsObject(o),u,c;for(c in l)l.hasOwnProperty(c)&&(u=i(l[c],s),u!==-1&&l[c].splice(u,1));return this},e.off=n("removeListener"),e.addListeners=function(o,s){return this.manipulateListeners(!1,o,s)},e.removeListeners=function(o,s){return this.manipulateListeners(!0,o,s)},e.manipulateListeners=function(o,s,l){let u,c,d=o?this.removeListener:this.addListener,p=o?this.removeListeners:this.addListeners;if(typeof s=="object"&&!(s instanceof RegExp))for(u in s)s.hasOwnProperty(u)&&(c=s[u])&&(typeof c=="function"?d.call(this,u,c):p.call(this,u,c));else for(u=l.length;u--;)d.call(this,s,l[u]);return this},e.removeEvent=function(o){let s=typeof o,l=this._getEvents(),u;if(s==="string")delete l[o];else if(o instanceof RegExp)for(u in l)l.hasOwnProperty(u)&&o.test(u)&&delete l[u];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(o,s){let l=this.getListenersAsObject(o),u,c,d,p,f;for(p in l)if(l.hasOwnProperty(p))for(u=l[p].slice(0),d=0;d<u.length;d++)c=u[d],c.once===!0&&this.removeListener(o,c.listener),f=c.listener.apply(this,s||[]),f===this._getOnceReturnValue()&&this.removeListener(o,c.listener);return this},e.trigger=n("emitEvent"),e.emit=function(o){let s=Array.prototype.slice.call(arguments,1);return this.emitEvent(o,s)},e.setOnceReturnValue=function(o){return this._onceReturnValue=o,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t}();function _J(){try{return window}catch{return}}const lUe=()=>_J().dev&&typeof _J().dev=="object";function Kot(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:mxe},window.onunhandledrejection=t=>{if(lUe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(gxe(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var uUe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],gA=uUe.join(","),cUe=typeof Element>"u",Cy=cUe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,vA=!cUe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},yA=function t(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),a=r===""||r==="true",o=a||i&&e&&t(e.parentNode);return o},Yot=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},dUe=function(e,i,n){if(yA(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(gA));return i&&Cy.call(e,gA)&&r.unshift(e),r=r.filter(n),r},pUe=function t(e,i,n){for(var r=[],a=Array.from(e);a.length;){var o=a.shift();if(!yA(o,!1))if(o.tagName==="SLOT"){var s=o.assignedElements(),l=s.length?s:o.children,u=t(l,!0,n);n.flatten?r.push.apply(r,u):r.push({scopeParent:o,candidates:u})}else{var c=Cy.call(o,gA);c&&n.filter(o)&&(i||!e.includes(o))&&r.push(o);var d=o.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(o),p=!yA(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(o));if(d&&p){var f=t(d===!0?o.children:d.children,!0,n);n.flatten?r.push.apply(r,f):r.push({scopeParent:o,candidates:f})}else a.unshift.apply(a,o.children)}}return r},fUe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},dv=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Yot(e))&&!fUe(e)?0:e.tabIndex},Zot=function(e,i){var n=dv(e);return n<0&&i&&!fUe(e)?0:n},Xot=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},hUe=function(e){return e.tagName==="INPUT"},Jot=function(e){return hUe(e)&&e.type==="hidden"},Qot=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},est=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},tst=function(e){if(!e.name)return!0;var i=e.form||vA(e),n=function(s){return i.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var a=est(r,e.form);return!a||a===e},ist=function(e){return hUe(e)&&e.type==="radio"},nst=function(e){return ist(e)&&!tst(e)},rst=function(e){var i,n=e&&vA(e),r=(i=n)===null||i===void 0?void 0:i.host,a=!1;if(n&&n!==e){var o,s,l;for(a=!!((o=r)!==null&&o!==void 0&&(s=o.ownerDocument)!==null&&s!==void 0&&s.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&r;){var u,c,d;n=vA(r),r=(u=n)===null||u===void 0?void 0:u.host,a=!!((c=r)!==null&&c!==void 0&&(d=c.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return a},kJ=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},ast=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var a=Cy.call(e,"details>summary:first-of-type"),o=a?e.parentElement:e;if(Cy.call(o,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof r=="function"){for(var s=e;e;){var l=e.parentElement,u=vA(e);if(l&&!l.shadowRoot&&r(l)===!0)return kJ(e);e.assignedSlot?e=e.assignedSlot:!l&&u!==e.ownerDocument?e=u.host:e=l}e=s}if(rst(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return kJ(e);return!1},ost=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return Cy.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},bA=function(e,i){return!(i.disabled||yA(i)||Jot(i)||ast(i,e)||Qot(i)||ost(i))},DV=function(e,i){return!(nst(i)||dv(i)<0||!bA(e,i))},sst=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},lst=function t(e){var i=[],n=[];return e.forEach(function(r,a){var o=!!r.scopeParent,s=o?r.scopeParent:r,l=Zot(s,o),u=o?t(r.candidates):s;l===0?o?i.push.apply(i,u):i.push(s):n.push({documentOrder:a,tabIndex:l,item:r,isScope:o,content:u})}),n.sort(Xot).reduce(function(r,a){return a.isScope?r.push.apply(r,a.content):r.push(a.content),r},[]).concat(i)},ust=function(e,i){i=i||{};var n;return i.getShadowRoot?n=pUe([e],i.includeContainer,{filter:DV.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:sst}):n=dUe(e,i.includeContainer,DV.bind(null,i)),lst(n)},cst=function(e,i){i=i||{};var n;return i.getShadowRoot?n=pUe([e],i.includeContainer,{filter:bA.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=dUe(e,i.includeContainer,bA.bind(null,i)),n},uI=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Cy.call(e,gA)===!1?!1:DV(i,e)},dst=uUe.concat("iframe").join(","),QF=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Cy.call(e,dst)===!1?!1:bA(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function OJ(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function xJ(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?OJ(Object(i),!0).forEach(function(n){pst(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):OJ(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function pst(t,e,i){return e=hst(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function fst(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hst(t){var e=fst(t,"string");return typeof e=="symbol"?e:String(e)}var LJ={activateTrap:function(e,i){if(e.length>0){var n=e[e.length-1];n!==i&&n.pause()}var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),e.length>0&&e[e.length-1].unpause()}},mst=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},gst=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},JT=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},vst=function(e){return JT(e)&&!e.shiftKey},yst=function(e){return JT(e)&&e.shiftKey},FJ=function(e){return setTimeout(e,0)},BJ=function(e,i){var n=-1;return e.every(function(r,a){return i(r)?(n=a,!1):!0}),n},rT=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},YC=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},bst=[],Ist=function(e,i){var n=(i==null?void 0:i.document)||document,r=(i==null?void 0:i.trapStack)||bst,a=xJ({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:vst,isKeyBackward:yst},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s,l=function(R,N,M){return R&&R[N]!==void 0?R[N]:a[M||N]},u=function(R,N){var M=typeof(N==null?void 0:N.composedPath)=="function"?N.composedPath():void 0;return o.containerGroups.findIndex(function(A){var _=A.container,k=A.tabbableNodes;return _.contains(R)||(M==null?void 0:M.includes(_))||k.find(function(B){return B===R})})},c=function(R){var N=a[R];if(typeof N=="function"){for(var M=arguments.length,A=new Array(M>1?M-1:0),_=1;_<M;_++)A[_-1]=arguments[_];N=N.apply(void 0,A)}if(N===!0&&(N=void 0),!N){if(N===void 0||N===!1)return N;throw new Error("`".concat(R,"` was specified but was not a node, or did not return a node"))}var k=N;if(typeof N=="string"&&(k=n.querySelector(N),!k))throw new Error("`".concat(R,"` as selector refers to no known node"));return k},d=function(){var R=c("initialFocus");if(R===!1)return!1;if(R===void 0||!QF(R,a.tabbableOptions))if(u(n.activeElement)>=0)R=n.activeElement;else{var N=o.tabbableGroups[0],M=N&&N.firstTabbableNode;R=M||c("fallbackFocus")}if(!R)throw new Error("Your focus-trap needs to have at least one focusable element");return R},p=function(){if(o.containerGroups=o.containers.map(function(R){var N=ust(R,a.tabbableOptions),M=cst(R,a.tabbableOptions),A=N.length>0?N[0]:void 0,_=N.length>0?N[N.length-1]:void 0,k=M.find(function(x){return uI(x)}),B=M.slice().reverse().find(function(x){return uI(x)}),F=!!N.find(function(x){return dv(x)>0});return{container:R,tabbableNodes:N,focusableNodes:M,posTabIndexesFound:F,firstTabbableNode:A,lastTabbableNode:_,firstDomTabbableNode:k,lastDomTabbableNode:B,nextTabbableNode:function($){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,V=N.indexOf($);return V<0?j?M.slice(M.indexOf($)+1).find(function(H){return uI(H)}):M.slice(0,M.indexOf($)).reverse().find(function(H){return uI(H)}):N[V+(j?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(R){return R.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!c("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(R){return R.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},f=function D(R){var N=R.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?D(N.shadowRoot):N},h=function D(R){if(R!==!1&&R!==f(document)){if(!R||!R.focus){D(d());return}R.focus({preventScroll:!!a.preventScroll}),o.mostRecentlyFocusedNode=R,mst(R)&&R.select()}},m=function(R){var N=c("setReturnFocus",R);return N||(N===!1?!1:R)},g=function(R){var N=R.target,M=R.event,A=R.isBackward,_=A===void 0?!1:A;N=N||YC(M),p();var k=null;if(o.tabbableGroups.length>0){var B=u(N,M),F=B>=0?o.containerGroups[B]:void 0;if(B<0)_?k=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:k=o.tabbableGroups[0].firstTabbableNode;else if(_){var x=BJ(o.tabbableGroups,function(q){var W=q.firstTabbableNode;return N===W});if(x<0&&(F.container===N||QF(N,a.tabbableOptions)&&!uI(N,a.tabbableOptions)&&!F.nextTabbableNode(N,!1))&&(x=B),x>=0){var $=x===0?o.tabbableGroups.length-1:x-1,j=o.tabbableGroups[$];k=dv(N)>=0?j.lastTabbableNode:j.lastDomTabbableNode}else JT(M)||(k=F.nextTabbableNode(N,!1))}else{var V=BJ(o.tabbableGroups,function(q){var W=q.lastTabbableNode;return N===W});if(V<0&&(F.container===N||QF(N,a.tabbableOptions)&&!uI(N,a.tabbableOptions)&&!F.nextTabbableNode(N))&&(V=B),V>=0){var H=V===o.tabbableGroups.length-1?0:V+1,z=o.tabbableGroups[H];k=dv(N)>=0?z.firstTabbableNode:z.firstDomTabbableNode}else JT(M)||(k=F.nextTabbableNode(N))}}else k=c("fallbackFocus");return k},v=function(R){var N=YC(R);if(!(u(N,R)>=0)){if(rT(a.clickOutsideDeactivates,R)){s.deactivate({returnFocus:a.returnFocusOnDeactivate});return}rT(a.allowOutsideClick,R)||R.preventDefault()}},y=function(R){var N=YC(R),M=u(N,R)>=0;if(M||N instanceof Document)M&&(o.mostRecentlyFocusedNode=N);else{R.stopImmediatePropagation();var A,_=!0;if(o.mostRecentlyFocusedNode)if(dv(o.mostRecentlyFocusedNode)>0){var k=u(o.mostRecentlyFocusedNode),B=o.containerGroups[k].tabbableNodes;if(B.length>0){var F=B.findIndex(function(x){return x===o.mostRecentlyFocusedNode});F>=0&&(a.isKeyForward(o.recentNavEvent)?F+1<B.length&&(A=B[F+1],_=!1):F-1>=0&&(A=B[F-1],_=!1))}}else o.containerGroups.some(function(x){return x.tabbableNodes.some(function($){return dv($)>0})})||(_=!1);else _=!1;_&&(A=g({target:o.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(o.recentNavEvent)})),h(A||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},b=function(R){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=R;var M=g({event:R,isBackward:N});M&&(JT(R)&&R.preventDefault(),h(M))},I=function(R){if(gst(R)&&rT(a.escapeDeactivates,R)!==!1){R.preventDefault(),s.deactivate();return}(a.isKeyForward(R)||a.isKeyBackward(R))&&b(R,a.isKeyBackward(R))},T=function(R){var N=YC(R);u(N,R)>=0||rT(a.clickOutsideDeactivates,R)||rT(a.allowOutsideClick,R)||(R.preventDefault(),R.stopImmediatePropagation())},w=function(){if(o.active)return LJ.activateTrap(r,s),o.delayInitialFocusTimer=a.delayInitialFocus?FJ(function(){h(d())}):h(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",T,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),s},S=function(){if(o.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",T,!0),n.removeEventListener("keydown",I,!0),s},U=function(R){var N=R.some(function(M){var A=Array.from(M.removedNodes);return A.some(function(_){return _===o.mostRecentlyFocusedNode})});N&&h(d())},P=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(U):void 0,E=function(){P&&(P.disconnect(),o.active&&!o.paused&&o.containers.map(function(R){P.observe(R,{subtree:!0,childList:!0})}))};return s={get active(){return o.active},get paused(){return o.paused},activate:function(R){if(o.active)return this;var N=l(R,"onActivate"),M=l(R,"onPostActivate"),A=l(R,"checkCanFocusTrap");A||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=n.activeElement,N==null||N();var _=function(){A&&p(),w(),E(),M==null||M()};return A?(A(o.containers.concat()).then(_,_),this):(_(),this)},deactivate:function(R){if(!o.active)return this;var N=xJ({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},R);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,S(),o.active=!1,o.paused=!1,E(),LJ.deactivateTrap(r,s);var M=l(N,"onDeactivate"),A=l(N,"onPostDeactivate"),_=l(N,"checkCanReturnFocus"),k=l(N,"returnFocus","returnFocusOnDeactivate");M==null||M();var B=function(){FJ(function(){k&&h(m(o.nodeFocusedBeforeActivation)),A==null||A()})};return k&&_?(_(m(o.nodeFocusedBeforeActivation)).then(B,B),this):(B(),this)},pause:function(R){if(o.paused||!o.active)return this;var N=l(R,"onPause"),M=l(R,"onPostPause");return o.paused=!0,N==null||N(),S(),E(),M==null||M(),this},unpause:function(R){if(!o.paused||!o.active)return this;var N=l(R,"onUnpause"),M=l(R,"onPostUnpause");return o.paused=!1,N==null||N(),p(),w(),E(),M==null||M(),this},updateContainerElements:function(R){var N=[].concat(R).filter(Boolean);return o.containers=N.map(function(M){return typeof M=="string"?n.querySelector(M):M}),o.active&&p(),E(),this}},s.updateContainerElements(e),s};const wst=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const a=Due;let o;const s=I=>r=I,l=()=>{rt(r)&&r()&&(r=void 0);const I=document.getElementById(a);I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",rt(n==null?void 0:n.callback)&&n.callback()):(I.classList.remove(t.activeClass),i=!1),n=!1,o==null||o.deactivate()},t.speedClose)},u=I=>{const T=document.getElementById(a);T.classList.contains(t.leftAlignment)||T.classList.add(t.leftAlignment),m(T,!1,I)},c=I=>{const T=document.getElementById(a);T.classList.remove(t.leftAlignment),m(T,!1,I)},d=I=>{const w=document.getElementById(a).querySelector(".drawer__title");w&&(w.innerHTML=I)},p=I=>{const w=document.getElementById(a).querySelector(".drawer__footer");w&&(Oa(w),rt(I)?e.footer=I(w,l):w.innerHTML=I||"")},f=I=>{const w=document.getElementById(a).querySelector(".drawer__content");w&&(Oa(w),rt(I)?e.content=I(w,l):w.innerHTML=I)},h=I=>{const w=document.getElementById(a).querySelector(".drawer__wrapper");w.style.width=I},m=(I,T,w)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",T&&(o=Ist(I),o.activate()),rt(w)&&w(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:T,side:w,width:S,footer:U,callback:P,onClose:E}={})=>{if(T&&f(T),E&&s(E),I&&d(I),S&&h(S),p(U),i)n={callback:P};else if(w){if(w===mt)return c(P);if(w===Ct)return u(P)}else{const D=document.getElementById(a);m(D,U,P)}},v=function(I,T){let w=T.parentNode;for(;w;){if(w===I)return!0;w=w.parentNode}return!1},y=function(I){const T=I.target,w=document.querySelector(".drawer__wrapper");(!v(w,T)||T.classList.contains("drawer__close"))&&l()},b=I=>{(I.key==="Escape"||I.keyCode===27)&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:f,setFooter:p,attributes:e}},$J=t=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,12}$/.test(t);function Sst(t){let e;const i=s=>s===e.password.value,r=[{onInput:({inputs:s})=>{const l=document.getElementById("registerButton");l&&(i(s.passwordConfirm.value)&&$J(s.password.value)&&ur(2)(s.givenName.value)&&ur(2)(s.familyName.value)?l.removeAttribute("disabled"):l.setAttribute("disabled",""))},control:"passwordConfirm"}];yn({title:"Register",content:s=>e=Wn(s,[{error:"First name must be at least 2 characters long",iconLeft:"fa-regular fa-user",validator:ur(2),placeholder:"First name",autocomplete:"off",label:"First Name",field:"givenName"},{error:"Last name must be at least 2 characters long",iconLeft:"fa-solid fa-house",validator:ur(2),placeholder:"Last name",autocomplete:"off",label:"Last name",field:"familyName"},{error:"Must contain upper/lower, number, and special character",placeholder:"minimum 8 characters",validator:$J,iconLeft:"fa-solid fa-lock",autocomplete:"off",label:"Password",field:"password",type:"password"},{placeholder:"minimum 8 characters",error:"Passwords do not match",iconLeft:"fa-solid fa-lock",label:"Re-enter Password",validator:i,field:"passwordConfirm",autocomplete:"off",type:"password"}],r),buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:()=>{var h;const s=e.familyName.value,l=e.givenName.value,u=e.password.value,c=(h=t==null?void 0:t.data)==null?void 0:h.inviteKey,d=()=>{Mt({message:"Success",intent:"is-success "})},p=m=>{Mt({message:m==null?void 0:m.message,intent:"is-danger"})},f=m=>{var g;(m==null?void 0:m.status)===200&&((g=m==null?void 0:m.data)!=null&&g.success)?d():p(m==null?void 0:m.data)};pnt(l,s,u,c).then(f,p)},intent:"is-primary",id:"registerButton",label:"Register",disabled:!0,close:!0}],onClose:()=>ze.router.navigate("/")})}function Tst(){const{tournamentRecord:t}=$e.getTournament();t&&(ze.ee.emit(k0e,t.tournamentId),$e.reset())}function VJ(){xx(),Not(),Dxe(),Tst(),_0e()}function Mr(){}const Ust=t=>t;function Dst(t,e){for(const i in e)t[i]=e[i];return t}function mUe(t){return t()}function jJ(){return Object.create(null)}function ml(t){t.forEach(mUe)}function ki(t){return typeof t=="function"}function Es(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Pst(t){return Object.keys(t).length===0}function U8(t,...e){if(t==null){for(const n of e)n(void 0);return Mr}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function IA(t){let e;return U8(t,i=>e=i)(),e}function Ge(t,e,i){t.$$.on_destroy.push(U8(e,i))}function Est(t,e,i,n){if(t){const r=gUe(t,e,i,n);return t[0](r)}}function gUe(t,e,i,n){return t[1]&&n?Dst(i.ctx.slice(),t[1](n(e))):i.ctx}function Cst(t,e,i,n){if(t[2]&&n){const r=t[2](n(i));if(e.dirty===void 0)return r;if(typeof r=="object"){const a=[],o=Math.max(e.dirty.length,r.length);for(let s=0;s<o;s+=1)a[s]=e.dirty[s]|r[s];return a}return e.dirty|r}return e.dirty}function Rst(t,e,i,n,r,a){if(r){const o=gUe(e,i,n,a);t.p(o,r)}}function Mst(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let n=0;n<i;n++)e[n]=-1;return e}return-1}function Kn(t,e,i){return t.set(i),e}function Ry(t){return t&&ki(t.destroy)?t.destroy:Mr}const Nst=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Qn(t,e){t.appendChild(e)}function En(t,e,i){t.insertBefore(e,i||null)}function Un(t){t.parentNode&&t.parentNode.removeChild(t)}function Lb(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function wn(t){return document.createElement(t)}function jE(t){return document.createTextNode(t)}function xs(){return jE(" ")}function yf(){return jE("")}function dn(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function wA(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function tt(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function Ast(t){return Array.from(t.childNodes)}function vUe(t,e){e=""+e,t.data!==e&&(t.data=e)}function GJ(t,e,i,n){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,n?"important":"")}function r0(t,e){return new t(e)}let M1;function QT(t){M1=t}function MS(){if(!M1)throw new Error("Function called outside component initialization");return M1}function _st(t){MS().$$.before_update.push(t)}function kst(t){MS().$$.on_mount.push(t)}function yUe(t){MS().$$.after_update.push(t)}function Ost(t,e){return MS().$$.context.set(t,e),e}function lu(t){return MS().$$.context.get(t)}function Qx(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const wI=[],Gp=[];let VI=[];const HJ=[],bUe=Promise.resolve();let PV=!1;function IUe(){PV||(PV=!0,bUe.then(wUe))}function D8(){return IUe(),bUe}function EV(t){VI.push(t)}const e2=new Set;let cI=0;function wUe(){if(cI!==0)return;const t=M1;do{try{for(;cI<wI.length;){const e=wI[cI];cI++,QT(e),xst(e.$$)}}catch(e){throw wI.length=0,cI=0,e}for(QT(null),wI.length=0,cI=0;Gp.length;)Gp.pop()();for(let e=0;e<VI.length;e+=1){const i=VI[e];e2.has(i)||(e2.add(i),i())}VI.length=0}while(wI.length);for(;HJ.length;)HJ.pop()();PV=!1,e2.clear(),QT(t)}function xst(t){if(t.fragment!==null){t.update(),ml(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(EV)}}function Lst(t){const e=[],i=[];VI.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),VI=e}const JR=new Set;let yv;function js(){yv={r:0,c:[],p:yv}}function Gs(){yv.r||ml(yv.c),yv=yv.p}function zt(t,e){t&&t.i&&(JR.delete(t),t.i(e))}function Pi(t,e,i,n){if(t&&t.o){if(JR.has(t))return;JR.add(t),yv.c.push(()=>{JR.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function _o(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function SUe(t,e){Pi(t,1,1,()=>{e.delete(t.key)})}function TUe(t,e,i,n,r,a,o,s,l,u,c,d){let p=t.length,f=a.length,h=p;const m={};for(;h--;)m[t[h].key]=h;const g=[],v=new Map,y=new Map,b=[];for(h=f;h--;){const S=d(r,a,h),U=i(S);let P=o.get(U);P?n&&b.push(()=>P.p(S,e)):(P=u(U,S),P.c()),v.set(U,g[h]=P),U in m&&y.set(U,Math.abs(h-m[U]))}const I=new Set,T=new Set;function w(S){zt(S,1),S.m(s,c),o.set(S.key,S),c=S.first,f--}for(;p&&f;){const S=g[f-1],U=t[p-1],P=S.key,E=U.key;S===U?(c=S.first,p--,f--):v.has(E)?!o.has(P)||I.has(P)?w(S):T.has(E)?p--:y.get(P)>y.get(E)?(T.add(P),w(S)):(I.add(E),p--):(l(U,o),p--)}for(;p--;){const S=t[p];v.has(S.key)||l(S,o)}for(;f;)w(g[f-1]);return ml(b),g}function ka(t){t&&t.c()}function wa(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),EV(()=>{const a=t.$$.on_mount.map(mUe).filter(ki);t.$$.on_destroy?t.$$.on_destroy.push(...a):ml(a),t.$$.on_mount=[]}),r.forEach(EV)}function sa(t,e){const i=t.$$;i.fragment!==null&&(Lst(i.after_update),ml(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function Fst(t,e){t.$$.dirty[0]===-1&&(wI.push(t),IUe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function gl(t,e,i,n,r,a,o=null,s=[-1]){const l=M1;QT(t);const u=t.$$={fragment:null,ctx:[],props:a,update:Mr,not_equal:r,bound:jJ(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:jJ(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=i?i(t,e.props||{},(d,p,...f)=>{const h=f.length?f[0]:p;return u.ctx&&r(u.ctx[d],u.ctx[d]=h)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](h),c&&Fst(t,d)),p}):[],u.update(),c=!0,ml(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const d=Ast(e.target);u.fragment&&u.fragment.l(d),d.forEach(Un)}else u.fragment&&u.fragment.c();e.intro&&zt(t.$$.fragment),wa(t,e.target,e.anchor),wUe()}QT(l)}class vl{constructor(){IL(this,"$$");IL(this,"$$set")}$destroy(){sa(this,1),this.$destroy=Mr}$on(e,i){if(!ki(i))return Mr;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!Pst(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const dI=[];function UUe(t,e){return{subscribe:$a(t,e).subscribe}}function $a(t,e=Mr){let i;const n=new Set;function r(s){if(Es(t,s)&&(t=s,i)){const l=!dI.length;for(const u of n)u[1](),dI.push(u,t);if(l){for(let u=0;u<dI.length;u+=2)dI[u][0](dI[u+1]);dI.length=0}}}function a(s){r(s(t))}function o(s,l=Mr){const u=[s,l];return n.add(u),n.size===1&&(i=e(r,a)||Mr),s(t),()=>{n.delete(u),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:o}}function $d(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return UUe(i,(o,s)=>{let l=!1;const u=[];let c=0,d=Mr;const p=()=>{if(c)return;d();const h=e(n?u[0]:u,o,s);a?o(h):d=ki(h)?h:Mr},f=r.map((h,m)=>U8(h,g=>{u[m]=g,c&=~(1<<m),l&&p()},()=>{c|=1<<m}));return l=!0,p(),function(){ml(f),d(),l=!1}})}function SA(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function NS(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n!=null&&n.domNodes?t.replaceChildren(...n.domNodes):n!=null&&n.html&&(t.innerHTML=n.html)}};return i.update(e),i}function Bst(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const $st=86400;function My(t=void 0){return t!==void 0?t instanceof Date?qJ(t):Gst(t):qJ(new Date)}function pv(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function yr(t){return new Date(t.getTime())}function ed(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)a0(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function DUe(t,e,i=1){return ed(t,e,-i)}function gg(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function a0(t,e=1){return gg(t,-e)}function Om(t){return t.setUTCHours(0,0,0,0),t}function Nl(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function pc(t,e=19){return t.toISOString().substring(0,e)}function sp(t,...e){return e.every(i=>t.getTime()===i.getTime())}function Vst(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function PUe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function zJ(t){return typeof t=="string"&&t.length<=10}function jst(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function qJ(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function Gst(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function P8(t,e,i){i.update(n=>n.set(e,t))}function WJ(t){ml(t),t.clear()}function EUe(t,e,i){e??(e=t),i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function Fb(...t){return Object.assign(...t)}function Cm(t){return Object.keys(t)}function Hst(t){return Math.floor(t)}function IT(...t){return Math.min(...t)}function CI(...t){return Math.max(...t)}function zst(){return Symbol("ec")}function CUe(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let a of n)r.setAttribute(...a);return r}function qst(t){return t.scrollHeight>t.clientHeight}function xm(t){return t.getBoundingClientRect()}function N1(t,e){for(;e--;)t=t.parentElement;return t}function ZC(t){return xm(t).height}let E8=zst();function Wst(t,e){t[E8]=e}function Kst(t){return!!(t!=null&&t[E8])}function QR(t){return t[E8]}function eU(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(Kst(n))return n;if(n.shadowRoot){let r=eU(t,e,n.shadowRoot);if(r)return r}}return null}function Yst(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function bu(t){return t=Fb({},t),t.currentStart=Nl(t.currentStart),t.currentEnd=Nl(t.currentEnd),t.activeStart=Nl(t.activeStart),t.activeEnd=Nl(t.activeEnd),t}function CV(t){return t.startsWith("list")}let Zst=1;function TA(t){return t.map(e=>({id:"id"in e?String(e.id):`{generated-${Zst++}}`,resourceIds:Array.isArray(e.resourceIds)?e.resourceIds.map(String):"resourceId"in e?[String(e.resourceId)]:[],allDay:e.allDay??(zJ(e.start)&&zJ(e.end)),start:My(e.start),end:My(e.end),title:e.title||"",titleHTML:e.titleHTML||"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display||"auto",extendedProps:e.extendedProps||{},backgroundColor:e.backgroundColor||e.color,textColor:e.textColor}))}function Xst(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function RV(t,e,i){return{start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t}}function Jst(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function Qst(t,e,i,n,r,a){let o=r.formatRange(t.start,e&&t.event.display!=="pointer"?jst(yr(t.start),t.end):t.start),s;if(i)s=ki(i)?i({event:Zc(t.event),timeText:o,view:bu(a)}):i;else{let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[KJ(o,t,n)];break;default:l=[...t.event.allDay?[]:[KJ(o,t,n)],CUe("h4",n.eventTitle,t.event.title)]}s={domNodes:l}}return[o,s]}function KJ(t,e,i){return CUe("time",i.eventTime,t,[["datetime",pc(e.start)]])}function elt(t,e,i){return t?(ki(t)&&(t=t({event:Zc(e),view:bu(i)})),Array.isArray(t)?t:[t]):[]}function Zc(t){return RUe(t,Nl)}function YJ(t){return RUe(t,yr)}function RUe(t,e){return t=Fb({},t),t.start=e(t.start),t.end=e(t.end),t}function ZJ(t,e){let i={};if(t.length){Jst(t);let n;for(let r of t){let a=[],o=Om(yr(r.start));for(;r.end>o;){if(!e.includes(o.getUTCDay())&&(a.push(yr(o)),a.length>1)){let s=o.getTime();i[s]?i[s].chunks.push(r):i[s]={sorted:!1,chunks:[r]}}gg(o)}a.length?(r.date=a[0],r.days=a.length,r.dates=a,r.start<a[0]&&(r.start=a[0]),Om(yr(r.end))>a[a.length-1]&&(r.end=a[a.length-1])):(r.date=Om(yr(r.start)),r.days=1,r.dates=[r.date]),n&&sp(n.date,r.date)&&(r.prev=n),n=r}}return i}function tlt(t,e,i){var a,o;t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if((a=e[r])!=null&&a.sorted||(o=e[r])!=null&&o.chunks.every(s=>"top"in s)){e[r].sorted||(e[r].chunks.sort((s,l)=>s.top-l.top),e[r].sorted=!0);for(let s of e[r].chunks)if(t.top<s.bottom&&t.bottom>s.top){let l=s.bottom-t.top+1;n+=l,t.top+=l,t.bottom+=l}}return n}function MUe(t,e){var i;t.length=e.length;for(let n of t)(i=n==null?void 0:n.reposition)==null||i.call(n)}function XJ(t,e,i,n,r){return(t.start<i&&t.end>e||!r&&sp(t.start,t.end,e))&&(n===void 0||t.resourceIds.includes(n.id))}function o0(t){return ilt(t)||nlt(t)||rlt(t)}function C8(t){return t==="background"}function ilt(t){return t==="preview"}function nlt(t){return t==="ghost"}function rlt(t){return t==="pointer"}function alt(t){return olt(t,"month")}function olt(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function slt(t){return e=>({...e,view:t})}function tU(t,e){return $d([t,e],([i,n])=>{let r=ki(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(Nl(a))}})}function JJ(t,e){return $d([t,e],([i,n])=>{let r;if(ki(n))r=n;else{let a=new Intl.DateTimeFormat(i,n);r=(o,s)=>{if(o<=s)return a.formatRange(o,s);{let l=a.formatRangeToParts(s,o),u="",c=["startRange","endRange"],d=[!1,!1];for(let p of l){let f=c.indexOf(p.source);f>=0?d[f]||(u+=llt(c[1-f],l),d[f]=!0):u+=p.value}return u}}}return{formatRange:(a,o)=>r(Nl(a),Nl(o))}})}function llt(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function ult(t){var i;let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"long"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},view:void 0,viewDidMount:void 0,views:{}};for(let n of t)(i=n.createOptions)==null||i.call(n,e);return e}function clt(t){var i;let e={date:n=>Om(My(n)),duration:pv,events:TA,eventSources:Xst,hiddenDays:n=>[...new Set(n)],highlightedDates:n=>n.map(My),scrollTime:pv,slotDuration:pv,slotMaxTime:pv,slotMinTime:pv};for(let n of t)(i=n.createParsers)==null||i.call(n,e);return e}function dlt(t,e){let i=[];for(let n of Cm(t))t[n]!==e[n]&&i.push([n,t[n]]);return Fb(e,t),i}function plt(t){return $d(t.view,e=>e==null?void 0:e.startsWith("dayGrid"))}function flt(t){return $d([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let a=yr(e.start),o=yr(e.end);if(r)PUe(a,i),Vst(o,i);else if(n.days||n.seconds>$st){ed(a0(o),n);let s=a0(yr(o));s<a&&(a=s)}return{start:a,end:o}})}function hlt(t){return $d([t.date,t.duration,t.firstDay,t._dayGrid],([e,i,n,r])=>{let a=yr(e),o;return r?a.setUTCDate(1):i.inWeeks&&PUe(a,n),o=ed(yr(a),i),{start:a,end:o}})}function mlt(t){return $d([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=Om(yr(e.start)),a=Om(yr(e.end));for(;r<a;)i.includes(r.getUTCDay())||n.push(yr(r)),gg(r);return!n.length&&i.length&&i.length<7&&(t.date.update(o=>{for(;i.includes(o.getUTCDay());)gg(o);return o}),n=IA(t._viewDates)),n})}function glt(t){return $d([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,a0(yr(i.end))))}function vlt(t){return $d([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>Yst(...e))}function ylt(t){let e=$a([]),i,n=0,r={};return $d([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,o)=>P8(()=>{let[s,l,u,c,d,p]=a;if(!l.length){o(s);return}if(!c.start||c.start>u.start||c.end<u.end||!d){i&&i.abort(),i=new AbortController,ki(p)&&!n&&p(!0);let f=()=>{--n===0&&ki(p)&&p(!1)},h=[],m=b=>f(),g=b=>{h=h.concat(TA(b)),o(h),f()},v=pc(u.start),y=pc(u.end);for(let b of l){if(ki(b.events)){let I=b.events({start:Nl(u.start),end:Nl(u.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=ki(b.extraParams)?b.extraParams():Fb({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let T=b.url,w={},S;["GET","HEAD"].includes(b.method)?T+=(T.includes("?")?"&":"?")+I:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(I)),fetch(T,{method:b.method,headers:w,body:S,signal:i.signal,credentials:"same-origin"}).then(U=>U.json()).then(g).catch(m)}++n}c.start=u.start,c.end=u.end}},r,t._queue),[]).subscribe(e.set),e}function blt(){return UUe(My(),t=>{let e=setInterval(()=>{t(My())},1e3);return()=>clearInterval(e)})}function Ilt(t){return $d(t._now,e=>Om(yr(e)))}class wlt{constructor(e,i){var o,s;e=e||[];let n=ult(e),r=clt(e);n=MV(n,r),i=MV(i,r);for(let[l,u]of Object.entries(n))this[l]=$a(u);this._queue=$a(new Map),this._queue2=$a(new Map),this._tasks=new Map,this._auxiliary=$a([]),this._dayGrid=plt(this),this._currentRange=hlt(this),this._activeRange=flt(this),this._fetchedRange=$a({start:void 0,end:void 0}),this._events=ylt(this),this._now=blt(),this._today=Ilt(this),this._intlEventTime=JJ(this.locale,this.eventTimeFormat),this._intlSlotLabel=tU(this.locale,this.slotLabelFormat),this._intlDayHeader=tU(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=tU(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=JJ(this.locale,this.titleFormat),this._bodyEl=$a(void 0),this._scrollable=$a(!1),this._viewTitle=glt(this),this._viewDates=mlt(this),this._view=vlt(this),this._viewComponent=$a(void 0),this._resBgColor=$a(Mr),this._resTxtColor=$a(Mr),this._interaction=$a({}),this._iEvents=$a([null,null]),this._iClasses=$a(Ust),this._iClass=$a(void 0),this._set=(l,u)=>{NV(l,this)&&(r[l]&&(u=r[l](u)),this[l].set(u))},this._get=l=>NV(l,this)?IA(this[l]):void 0;for(let l of e)(o=l.createStores)==null||o.call(l,this);i.view&&this.view.set(i.view);let a=new Set([...Cm(n.views),...Cm(i.views??{})]);for(let l of a){let u=QJ(n,n.views[l]??{}),c=QJ(u,i,((s=i.views)==null?void 0:s[l])??{}),d=c.component;Slt(c,this);for(let p of Cm(c)){let{set:f,_set:h=f,...m}=this[p];this[p]={set:["buttonText","theme"].includes(p)?g=>{if(ki(g)){let v=g(u[p]);c[p]=v,f(f===h?v:g)}else c[p]=g,f(g)}:g=>{c[p]=g,f(g)},_set:h,...m}}this.view.subscribe(p=>{if(p===l){this._viewComponent.set(d),ki(c.viewDidMount)&&D8().then(()=>c.viewDidMount(IA(this._view)));for(let f of Cm(c))this[f]._set(c[f])}})}}}function MV(t,e){let i={...t};for(let n of Cm(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of Cm(t.views))i.views[n]=MV(t.views[n],e)}return i}function QJ(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])ki(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function Slt(t,e){Cm(t).filter(i=>!NV(i,e)||i=="view").forEach(i=>delete t[i])}function NV(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function eQ(t,e,i){const n=t.slice();return n[23]=e[i],n}function Tlt(t){let e,i=t[5][t[23]]+"",n,r,a,o;function s(){return t[20](t[23])}return{c(){e=wn("button"),n=jE(i),tt(e,"class",r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])},m(l,u){En(l,e,u),Qn(e,n),a||(o=dn(e,"click",s),a=!0)},p(l,u){t=l,u&33&&i!==(i=t[5][t[23]]+"")&&vUe(n,i),u&73&&r!==(r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])&&tt(e,"class",r)},d(l){l&&Un(e),a=!1,o()}}}function Ult(t){let e,i=t[5][t[23]]+"",n,r,a,o;return{c(){e=wn("button"),n=jE(i),tt(e,"class",r=t[3].button+" ec-"+t[23]),e.disabled=t[1]},m(s,l){En(s,e,l),Qn(e,n),a||(o=dn(e,"click",t[19]),a=!0)},p(s,l){l&33&&i!==(i=s[5][s[23]]+"")&&vUe(n,i),l&9&&r!==(r=s[3].button+" ec-"+s[23])&&tt(e,"class",r),l&2&&(e.disabled=s[1])},d(s){s&&Un(e),a=!1,o()}}}function Dlt(t){let e,i,n,r,a,o,s,l;return{c(){e=wn("button"),i=wn("i"),tt(i,"class",n=t[3].icon+" ec-"+t[23]),tt(e,"class",r=t[3].button+" ec-"+t[23]),tt(e,"aria-label",a=t[5].next),tt(e,"title",o=t[5].next)},m(u,c){En(u,e,c),Qn(e,i),s||(l=dn(e,"click",t[17]),s=!0)},p(u,c){c&9&&n!==(n=u[3].icon+" ec-"+u[23])&&tt(i,"class",n),c&9&&r!==(r=u[3].button+" ec-"+u[23])&&tt(e,"class",r),c&32&&a!==(a=u[5].next)&&tt(e,"aria-label",a),c&32&&o!==(o=u[5].next)&&tt(e,"title",o)},d(u){u&&Un(e),s=!1,l()}}}function Plt(t){let e,i,n,r,a,o,s,l;return{c(){e=wn("button"),i=wn("i"),tt(i,"class",n=t[3].icon+" ec-"+t[23]),tt(e,"class",r=t[3].button+" ec-"+t[23]),tt(e,"aria-label",a=t[5].prev),tt(e,"title",o=t[5].prev)},m(u,c){En(u,e,c),Qn(e,i),s||(l=dn(e,"click",t[16]),s=!0)},p(u,c){c&9&&n!==(n=u[3].icon+" ec-"+u[23])&&tt(i,"class",n),c&9&&r!==(r=u[3].button+" ec-"+u[23])&&tt(e,"class",r),c&32&&a!==(a=u[5].prev)&&tt(e,"aria-label",a),c&32&&o!==(o=u[5].prev)&&tt(e,"title",o)},d(u){u&&Un(e),s=!1,l()}}}function Elt(t){let e,i,n,r,a;return{c(){e=wn("h2"),tt(e,"class",i=t[3].title)},m(o,s){En(o,e,s),r||(a=Ry(n=NS.call(null,e,t[4])),r=!0)},p(o,s){s&8&&i!==(i=o[3].title)&&tt(e,"class",i),n&&ki(n.update)&&s&16&&n.update.call(null,o[4])},d(o){o&&Un(e),r=!1,a()}}}function tQ(t){let e;function i(a,o){if(a[23]=="title")return Elt;if(a[23]=="prev")return Plt;if(a[23]=="next")return Dlt;if(a[23]=="today")return Ult;if(a[23]!="")return Tlt}let n=i(t),r=n&&n(t);return{c(){r&&r.c(),e=yf()},m(a,o){r&&r.m(a,o),En(a,e,o)},p(a,o){n===(n=i(a))&&r?r.p(a,o):(r&&r.d(1),r=n&&n(a),r&&(r.c(),r.m(e.parentNode,e)))},d(a){a&&Un(e),r&&r.d(a)}}}function Clt(t){let e,i=_o(t[0]),n=[];for(let r=0;r<i.length;r+=1)n[r]=tQ(eQ(t,i,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=yf()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);En(r,e,a)},p(r,[a]){if(a&229503){i=_o(r[0]);let o;for(o=0;o<i.length;o+=1){const s=eQ(r,i,o);n[o]?n[o].p(s,a):(n[o]=tQ(s),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=i.length}},i:Mr,o:Mr,d(r){r&&Un(e),Lb(n,r)}}}function Rlt(t,e,i){let n,r,a,o,s,l,u,c,{buttons:d}=e,{_currentRange:p,_viewTitle:f,buttonText:h,date:m,duration:g,hiddenDays:v,theme:y,view:b}=lu("state");Ge(t,p,E=>i(18,o=E)),Ge(t,f,E=>i(4,l=E)),Ge(t,h,E=>i(5,u=E)),Ge(t,m,E=>i(2,r=E)),Ge(t,g,E=>i(21,n=E)),Ge(t,v,E=>i(22,a=E)),Ge(t,y,E=>i(3,s=E)),Ge(t,b,E=>i(6,c=E));let I=Om(My()),T;function w(){let E=DUe(r,n);if(a.length&&a.length<7)for(;a.includes(E.getUTCDay());)a0(E);Kn(m,r=E,r)}function S(){Kn(m,r=ed(r,n),r)}const U=()=>Kn(m,r=yr(I),r),P=E=>Kn(b,c=E,c);return t.$$set=E=>{"buttons"in E&&i(0,d=E.buttons)},t.$$.update=()=>{t.$$.dirty&262144&&i(1,T=I>=o.start&&I<o.end||null)},[d,T,r,s,l,u,c,p,f,h,m,g,v,y,b,I,w,S,o,U,P]}class NUe extends vl{constructor(e){super(),gl(this,e,Rlt,Clt,Es,{buttons:0})}}function iQ(t,e,i){const n=t.slice();return n[5]=e[i],n}function nQ(t,e,i){const n=t.slice();return n[8]=e[i],n}function Mlt(t){let e,i;return e=new NUe({props:{buttons:t[8]}}),{c(){ka(e.$$.fragment)},m(n,r){wa(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.buttons=n[8]),e.$set(a)},i(n){i||(zt(e.$$.fragment,n),i=!0)},o(n){Pi(e.$$.fragment,n),i=!1},d(n){sa(e,n)}}}function Nlt(t){let e,i,n,r;return i=new NUe({props:{buttons:t[8]}}),{c(){e=wn("div"),ka(i.$$.fragment),tt(e,"class",n=t[1].buttonGroup)},m(a,o){En(a,e,o),wa(i,e,null),r=!0},p(a,o){const s={};o&1&&(s.buttons=a[8]),i.$set(s),(!r||o&2&&n!==(n=a[1].buttonGroup))&&tt(e,"class",n)},i(a){r||(zt(i.$$.fragment,a),r=!0)},o(a){Pi(i.$$.fragment,a),r=!1},d(a){a&&Un(e),sa(i)}}}function rQ(t){let e,i,n,r;const a=[Nlt,Mlt],o=[];function s(l,u){return l[8].length>1?0:1}return e=s(t),i=o[e]=a[e](t),{c(){i.c(),n=yf()},m(l,u){o[e].m(l,u),En(l,n,u),r=!0},p(l,u){let c=e;e=s(l),e===c?o[e].p(l,u):(js(),Pi(o[c],1,1,()=>{o[c]=null}),Gs(),i=o[e],i?i.p(l,u):(i=o[e]=a[e](l),i.c()),zt(i,1),i.m(n.parentNode,n))},i(l){r||(zt(i),r=!0)},o(l){Pi(i),r=!1},d(l){l&&Un(n),o[e].d(l)}}}function aQ(t){let e,i,n,r=_o(t[0][t[5]]),a=[];for(let s=0;s<r.length;s+=1)a[s]=rQ(nQ(t,r,s));const o=s=>Pi(a[s],1,1,()=>{a[s]=null});return{c(){e=wn("div");for(let s=0;s<a.length;s+=1)a[s].c();i=xs()},m(s,l){En(s,e,l);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);Qn(e,i),n=!0},p(s,l){if(l&3){r=_o(s[0][s[5]]);let u;for(u=0;u<r.length;u+=1){const c=nQ(s,r,u);a[u]?(a[u].p(c,l),zt(a[u],1)):(a[u]=rQ(c),a[u].c(),zt(a[u],1),a[u].m(e,i))}for(js(),u=r.length;u<a.length;u+=1)o(u);Gs()}},i(s){if(!n){for(let l=0;l<r.length;l+=1)zt(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Pi(a[l]);n=!1},d(s){s&&Un(e),Lb(a,s)}}}function Alt(t){let e,i,n,r=_o(Object.keys(t[0])),a=[];for(let s=0;s<r.length;s+=1)a[s]=aQ(iQ(t,r,s));const o=s=>Pi(a[s],1,1,()=>{a[s]=null});return{c(){e=wn("nav");for(let s=0;s<a.length;s+=1)a[s].c();tt(e,"class",i=t[1].toolbar)},m(s,l){En(s,e,l);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);n=!0},p(s,[l]){if(l&3){r=_o(Object.keys(s[0]));let u;for(u=0;u<r.length;u+=1){const c=iQ(s,r,u);a[u]?(a[u].p(c,l),zt(a[u],1)):(a[u]=aQ(c),a[u].c(),zt(a[u],1),a[u].m(e,null))}for(js(),u=r.length;u<a.length;u+=1)o(u);Gs()}(!n||l&2&&i!==(i=s[1].toolbar))&&tt(e,"class",i)},i(s){if(!n){for(let l=0;l<r.length;l+=1)zt(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Pi(a[l]);n=!1},d(s){s&&Un(e),Lb(a,s)}}}function _lt(t,e,i){let n,r,{headerToolbar:a,theme:o}=lu("state");Ge(t,a,l=>i(4,n=l)),Ge(t,o,l=>i(1,r=l));let s={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of Object.keys(s))i(0,s[l]=n[l].split(" ").map(u=>u.split(",")),s)},[s,r,a,o,n]}class klt extends vl{constructor(e){super(),gl(this,e,_lt,Alt,Es,{})}}function oQ(t,e,i){const n=t.slice();return n[11]=e[i],n}function sQ(t){let e,i,n;var r=t[11];function a(o,s){return{}}return r&&(e=r0(r,a())),{c(){e&&ka(e.$$.fragment),i=yf()},m(o,s){e&&wa(e,o,s),En(o,i,s),n=!0},p(o,s){if(s&1&&r!==(r=o[11])){if(e){js();const l=e;Pi(l.$$.fragment,1,0,()=>{sa(l,1)}),Gs()}r?(e=r0(r,a()),ka(e.$$.fragment),zt(e.$$.fragment,1),wa(e,i.parentNode,i)):e=null}},i(o){n||(e&&zt(e.$$.fragment,o),n=!0)},o(o){e&&Pi(e.$$.fragment,o),n=!1},d(o){o&&Un(i),e&&sa(e,o)}}}function Olt(t){let e,i,n=_o(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=sQ(oQ(t,n,o));const a=o=>Pi(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=yf()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);En(o,e,s),i=!0},p(o,[s]){if(s&1){n=_o(o[0]);let l;for(l=0;l<n.length;l+=1){const u=oQ(o,n,l);r[l]?(r[l].p(u,s),zt(r[l],1)):(r[l]=sQ(u),r[l].c(),zt(r[l],1),r[l].m(e.parentNode,e))}for(js(),l=n.length;l<r.length;l+=1)a(l);Gs()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)zt(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Pi(r[s]);i=!1},d(o){o&&Un(e),Lb(r,o)}}}function xlt(t,e,i){let n,r,a,o,{datesSet:s,_auxiliary:l,_activeRange:u,_queue:c,_view:d}=lu("state");Ge(t,s,h=>i(7,r=h)),Ge(t,l,h=>i(0,o=h)),Ge(t,u,h=>i(5,a=h)),Ge(t,d,h=>i(6,n=h));let p={};function f(h){ki(r)&&P8(()=>r({start:Nl(h.start),end:Nl(h.end),startStr:pc(h.start),endStr:pc(h.end),view:bu(n)}),p,c)}return t.$$.update=()=>{t.$$.dirty&32&&f(a)},[o,s,l,u,d,a]}let Llt=class extends vl{constructor(e){super(),gl(this,e,xlt,Olt,Es,{})}};function Flt(t){let e,i,n,r,a,o,s,l,u,c,d;i=new klt({});var p=t[5];function f(h,m){return{}}return p&&(r=r0(p,f())),l=new Llt({}),{c(){e=wn("div"),ka(i.$$.fragment),n=xs(),r&&ka(r.$$.fragment),s=xs(),ka(l.$$.fragment),tt(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),tt(e,"role",o=CV(t[4])?"list":"table"),GJ(e,"height",t[3])},m(h,m){En(h,e,m),wa(i,e,null),Qn(e,n),r&&wa(r,e,null),En(h,s,m),wa(l,h,m),u=!0,c||(d=dn(window,"resize",t[17]),c=!0)},p(h,m){if(m[0]&32&&p!==(p=h[5])){if(r){js();const g=r;Pi(g.$$.fragment,1,0,()=>{sa(g,1)}),Gs()}p?(r=r0(p,f()),ka(r.$$.fragment),zt(r.$$.fragment,1),wa(r,e,null)):r=null}(!u||m[0]&7&&a!==(a=h[1].calendar+" "+h[1].view+(h[0]?" "+h[1].withScroll:"")+(h[2]?" "+h[1][h[2]]:"")))&&tt(e,"class",a),(!u||m[0]&16&&o!==(o=CV(h[4])?"list":"table"))&&tt(e,"role",o),m[0]&8&&GJ(e,"height",h[3])},i(h){u||(zt(i.$$.fragment,h),r&&zt(r.$$.fragment,h),zt(l.$$.fragment,h),u=!0)},o(h){Pi(i.$$.fragment,h),r&&Pi(r.$$.fragment,h),Pi(l.$$.fragment,h),u=!1},d(h){h&&(Un(e),Un(s)),sa(i),r&&sa(r),sa(l,h),c=!1,d()}}}function Blt(t,e,i){let n,r,a,o,s,l,u,c,d,p,f,{plugins:h=[]}=e,{options:m={}}=e,g=MS(),v=new wlt(h,m);Ost("state",v);let{_viewComponent:y,_bodyEl:b,_interaction:I,_iClass:T,_events:w,_queue:S,_queue2:U,_tasks:P,_scrollable:E,height:D,theme:R,view:N}=v;Ge(t,y,Y=>i(5,f=Y)),Ge(t,b,Y=>i(32,n=Y)),Ge(t,I,Y=>i(35,s=Y)),Ge(t,T,Y=>i(2,c=Y)),Ge(t,w,Y=>i(36,l=Y)),Ge(t,S,Y=>i(34,o=Y)),Ge(t,U,Y=>i(33,a=Y)),Ge(t,E,Y=>i(0,r=Y)),Ge(t,D,Y=>i(3,d=Y)),Ge(t,R,Y=>i(1,u=Y)),Ge(t,N,Y=>i(4,p=Y));let M={...m};function A(Y,Z){return v._set(Y,Z),this}function _(Y){let Z=v._get(Y);return Z instanceof Date?Nl(Z):Z}function k(){return v._fetchedRange.set({start:void 0,end:void 0}),this}function B(){return l.map(Zc)}function F(Y){for(let Z of l)if(Z.id==Y)return Zc(Z);return null}function x(Y){return l.push(TA([Y])[0]),w.set(l),this}function $(Y){for(let Z of l)if(Z.id==Y.id){Fb(Z,TA([Y])[0]),w.set(l);break}return this}function j(Y){let Z=l.findIndex(X=>X.id==Y);return Z>=0&&(l.splice(Z,1),w.set(l)),this}function V(){return bu(IA(v._view))}function H(){return s.action&&s.action.unselect(),this}function z(Y,Z){let X=eU(Y,Z);return X?QR(X)(Z):null}function q(){sa(g,!0)}_st(()=>{WJ(o)}),yUe(()=>{WJ(a),EUe(W,null,P)});function W(){n&&Kn(E,r=qst(n),r)}return t.$$set=Y=>{"plugins"in Y&&i(18,h=Y.plugins),"options"in Y&&i(19,m=Y.options)},t.$$.update=()=>{if(t.$$.dirty[0]&524288)for(let[Y,Z]of dlt(m,M))A(Y,Z)},[r,u,c,d,p,f,y,b,I,T,w,S,U,E,D,R,N,W,h,m,A,_,k,B,F,x,$,j,V,H,z,q]}class $lt extends vl{constructor(e){super(),gl(this,e,Blt,Flt,Es,{plugins:18,options:19,setOption:20,getOption:21,refetchEvents:22,getEvents:23,getEventById:24,addEvent:25,updateEvent:26,removeEventById:27,getView:28,unselect:29,dateFromPoint:30,destroy:31},null,[-1,-1])}get setOption(){return this.$$.ctx[20]}get getOption(){return this.$$.ctx[21]}get refetchEvents(){return this.$$.ctx[22]}get getEvents(){return this.$$.ctx[23]}get getEventById(){return this.$$.ctx[24]}get addEvent(){return this.$$.ctx[25]}get updateEvent(){return this.$$.ctx[26]}get removeEventById(){return this.$$.ctx[27]}get getView(){return this.$$.ctx[28]}get unselect(){return this.$$.ctx[29]}get dateFromPoint(){return this.$$.ctx[30]}get destroy(){return this.$$.ctx[31]}}let t2=!1;function Vlt(t){t2||(t2=!0,window.requestAnimationFrame(()=>{t(),t2=!1}))}function lQ(t,e,i){return CI(e,IT(i,t))}const{window:um}=Nst;function jlt(t){let e,i;return{c:Mr,m(n,r){e||(i=[dn(um,"pointermove",t[31]),dn(um,"pointerup",t[32]),dn(um,"pointercancel",t[32]),dn(um,"scroll",t[0]),dn(um,"selectstart",eM(t[33])),dn(um,"contextmenu",function(){ki(eM(t[41]))&&eM(t[41]).apply(this,arguments)}),dn(um,"touchstart",t[34]),dn(um,"touchmove",t[40],{passive:!1})],e=!0)},p(n,r){t=n},i:Mr,o:Mr,d(n){e=!1,ml(i)}}}const uQ=1,cQ=2,dQ=3,i2=4,XC=5;function pQ(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function eM(t){return e=>{t()&&e.preventDefault()}}function Glt(t,e,i){let n,r,a,o,s,l,u,c,d,p,f,h,m,g,v,y,b,I,T,w,S,U,P,E,D,R,N,M,A,{_iEvents:_,_iClass:k,_events:B,_view:F,_dayGrid:x,_draggable:$,dateClick:j,dragScroll:V,datesAboveResources:H,eventDragMinDistance:z,eventDragStart:q,eventDragStop:W,eventDrop:Y,eventLongPressDelay:Z,eventResizeStart:X,eventResizeStop:Q,eventResize:ce,longPressDelay:J,selectable:ee,select:ne,selectBackgroundColor:ie,selectLongPressDelay:oe,selectMinDistance:se,slotDuration:pe,slotHeight:fe,unselect:ge,unselectAuto:me,unselectCancel:Ee,view:Be}=lu("state");Ge(t,_,We=>i(69,o=We)),Ge(t,k,We=>i(72,u=We)),Ge(t,B,We=>i(68,a=We)),Ge(t,F,We=>i(66,n=We)),Ge(t,x,We=>i(71,l=We)),Ge(t,$,We=>i(94,A=We)),Ge(t,j,We=>i(73,c=We)),Ge(t,V,We=>i(82,b=We)),Ge(t,H,We=>i(90,D=We)),Ge(t,z,We=>i(85,w=We)),Ge(t,q,We=>i(83,I=We)),Ge(t,W,We=>i(76,f=We)),Ge(t,Y,We=>i(74,d=We)),Ge(t,Z,We=>i(88,P=We)),Ge(t,X,We=>i(84,T=We)),Ge(t,Q,We=>i(77,h=We)),Ge(t,ce,We=>i(75,p=We)),Ge(t,J,We=>i(87,U=We)),Ge(t,ee,We=>i(93,M=We)),Ge(t,ne,We=>i(78,m=We)),Ge(t,ie,We=>i(70,s=We)),Ge(t,oe,We=>i(89,E=We)),Ge(t,se,We=>i(86,S=We)),Ge(t,pe,We=>i(91,R=We)),Ge(t,fe,We=>i(81,y=We)),Ge(t,ge,We=>i(67,r=We)),Ge(t,me,We=>i(80,v=We)),Ge(t,Ee,We=>i(79,g=We)),Ge(t,Be,We=>i(92,N=We));let Pe,et,Ie,Ne,be,Le,Me,Ze,qe,ye,_e,Ae,Ve,Ke,he,ve,Ce,De,Ue,Qe,je,ke,bt,Gt,Zt;function Sr(We,ni,Jn,Ma){Pe||(Pe=pQ(ni)?Jn?cQ:A(We)?uQ:XC:XC,du()&&(Ie=We,Tr(ni),Ma&&(be=Ma),Ue=Jn?De?"resizingX":"resizingY":"dragging",Jn&&(Qe=yr(Ie.start),De?(Qe.setUTCHours(Ie.end.getUTCHours(),Ie.end.getUTCMinutes(),Ie.end.getUTCSeconds(),0),Qe<Ie.start&&gg(Qe)):ed(Qe,R)),Xn(ni)))}function Oo(We){Pe||(Pe=pQ(We)?M&&!CV(N)?dQ:i2:XC,du()&&(Tr(We),Ue="selecting",je=De?pv({day:1}):R,Ie={allDay:De,start:be,end:ed(yr(be),je),resourceIds:Me?[Me.id]:[]},Xn(We)))}function ri(){Pe||(Pe=XC)}function Tr(We){window.getSelection().removeAllRanges(),qe=_e=We.clientX,ye=Ae=We.clientY;let ni=eU(_e,Ae);({allDay:De,date:be,resource:Me}=QR(ni)(Ae)),Ve=N1(ni,Me?4:3),he=N1(ni,Me&&(bf()||D)?2:1),Io(),We.pointerType!=="mouse"&&i(1,Gt=setTimeout(()=>{Pe&&(et=!0,Xn(We))},(cu()?E:P)??U))}function Xn(We){if(et||We&&We.pointerType==="mouse"&&Kg()>=(cu()?S:w)){et=!0,so(We),Kn(k,u=Ue,u),o[0]||(cu()?La():Vd(We,Fc()?T:I));let ni=ss();if(ni){let Jn;({allDay:Jn,date:Le,resource:Ze}=QR(ni)(Ae)),Jn===De&&(Ce=pv((Le-be)/1e3),Kn(_,o[0].end=ed(yr(Ie.end),Ce),o),Fc()?o[0].end<Qe&&Kn(_,o[0].end=Qe,o):cu()?o[0].end<Ie.end?(Kn(_,o[0].start=DUe(o[0].end,je),o),Kn(_,o[0].end=Ie.end,o)):Kn(_,o[0].start=Ie.start,o):(Kn(_,o[0].start=ed(yr(Ie.start),Ce),o),Me&&(Kn(_,o[0].resourceIds=Ie.resourceIds.filter(Ma=>Ma!==Me.id),o),o[0].resourceIds.push(Ze.id))))}}if(b){let ni=y*2;Vlt(()=>{Ve&&(Ae<ni&&window.scrollBy(0,CI(-10,(Ae-ni)/3)),Ae<Ke.top+ni&&(Ve.scrollTop+=CI(-10,(Ae-Ke.top-ni)/3)),Ae>window.innerHeight-ni&&window.scrollBy(0,IT(10,(Ae-window.innerHeight+ni)/3)),Ae>Ke.bottom-ni&&(Ve.scrollTop+=IT(10,(Ae-Ke.bottom+ni)/3)))})}}function It(){du()&&(Io(),Xn())}function hr(We){du()&&We.isPrimary&&(_e=We.clientX,Ae=We.clientY,Xn(We))}function os(We){if(ke&&v&&!(g&&We.target.closest(g))&&so(We),Pe&&We.isPrimary){if(et)if(cu()){if(ke=!0,ki(m)){let{start:ni,end:Jn}=Zc(o[0]);m({start:ni,end:Jn,startStr:pc(o[0].start),endStr:pc(o[0].end),allDay:De,jsEvent:We,view:bu(n),resource:Me})}}else{Ie.display=Ne;let ni=Fc()?h:f;ki(ni)&&ni({event:Zc(Ie),jsEvent:We,view:bu(n)});let Jn=YJ(Ie);if(uu(Ie,o[0]),ls(),ni=Fc()?p:d,ki(ni)){let Ma=Ie,pu;Fc()?pu={endDelta:Ce}:pu={delta:Ce,oldResource:Me!==Ze?Me:void 0,newResource:Me!==Ze?Ze:void 0},ni(Fb(pu,{event:Zc(Ie),oldEvent:Zc(Jn),jsEvent:We,view:bu(n),revert(){uu(Ma,Jn)}}))}}else if((Bc()||cu())&&ki(c)&&!bt){_e=We.clientX,Ae=We.clientY;let ni=eU(_e,Ae);if(ni){let{allDay:Jn,date:Ma,resource:pu}=QR(ni)(Ae);c({allDay:Jn,date:Nl(Ma),dateStr:pc(Ma),dayEl:ni,jsEvent:We,view:bu(n),resource:pu})}}et=!1,Pe=qe=ye=_e=Ae=Ie=Ne=be=Le=Me=Ze=Ce=De=Kn(k,u=Qe=je=void 0,u),Ve=he=Ke=ve=void 0,Gt&&(clearTimeout(Gt),i(1,Gt=void 0))}bt=!1}function ss(){return eU(lQ(_e,Zt[0],Zt[1]),lQ(Ae,Zt[2],Zt[3]))}function Io(){Ke=xm(Ve),ve=xm(he),Zt=[CI(0,ve.left+(l?0:8)),IT(document.documentElement.clientWidth,ve.right)-2,CI(0,Ke.top),IT(document.documentElement.clientHeight,Ke.bottom)-2]}function Vd(We,ni){ki(ni)&&ni({event:Zc(Ie),jsEvent:We,view:bu(n)}),Ne=Ie.display,Ie.display="preview",Kn(_,o[0]=YJ(Ie),o),Ie.display="ghost",B.set(a)}function La(){Kn(_,o[0]={id:"{select}",allDay:Ie.allDay,start:Ie.start,title:"",display:"preview",extendedProps:{},backgroundColor:s,resourceIds:Ie.resourceIds},o)}function ls(){Kn(_,o[0]=null,o)}function uu(We,ni){We.start=ni.start,We.end=ni.end,We.resourceIds=ni.resourceIds,B.set(a)}function Kg(){return Math.sqrt(Math.pow(_e-qe,2)+Math.pow(Ae-ye,2))}function bf(){return Pe===uQ}function Fc(){return Pe===cQ}function Bc(){return Pe===i2}function cu(){return Pe===dQ}function du(){return Pe&&Pe<i2}function so(We){ke&&(ke=!1,ls(),ki(r)&&r({jsEvent:We,view:bu(n)}))}function gi(){bt=!0}F.subscribe(so);function Zh(We){if(du()){let ni=We.target,Jn=[],Ma=()=>ml(Jn);Jn.push(dn(ni,"touchmove",eM(()=>et))),Jn.push(dn(ni,"touchend",Ma)),Jn.push(dn(ni,"touchcancel",Ma))}}function Xh(We){Qx.call(this,t,We)}return[It,Gt,_,k,B,F,x,$,j,V,H,z,q,W,Y,Z,X,Q,ce,J,ee,ne,ie,oe,se,pe,fe,ge,me,Ee,Be,hr,os,du,Zh,Sr,Oo,ri,so,gi,Xh,()=>Gt]}class Hlt extends vl{constructor(e){super(),gl(this,e,Glt,jlt,Es,{drag:35,select:36,noAction:37,handleScroll:0,unselect:38,noClick:39},null,[-1,-1,-1,-1])}get drag(){return this.$$.ctx[35]}get select(){return this.$$.ctx[36]}get noAction(){return this.$$.ctx[37]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[38]}get noClick(){return this.$$.ctx[39]}}function zlt(t){let e,i;return{c:Mr,m(n,r){e||(i=[dn(window,"pointermove",t[5]),dn(window,"scroll",t[0])],e=!0)},p:Mr,i:Mr,o:Mr,d(n){e=!1,ml(i)}}}function JC(t){return t.isPrimary&&t.pointerType==="mouse"}function qlt(t,e,i){let n,r,a,o,{_iEvents:s,_events:l,_viewDates:u,_slotTimeLimits:c,slotDuration:d,slotHeight:p,hiddenDays:f,_view:h,datesAboveResources:m,theme:g}=lu("state");Ge(t,s,A=>i(9,n=A)),Ge(t,c,A=>i(18,o=A)),Ge(t,d,A=>i(16,r=A)),Ge(t,p,A=>i(17,a=A));let v,y,b,I,T,w;function S(A,_,k,B){JC(k)&&(y=A,b=_,I=xm(b),v=k.clientY,T=B)}function U(A,_){JC(_)&&(y=A,b=null,v=T=void 0)}function P(A){JC(A)&&M()}function E(){if(y){if(b){let A=v-I.top;w=ed(ed(yr(y),o.min),r,Hst(A/a))}else w=y;n[1]||N(),Kn(s,n[1].start=w,n),Kn(s,n[1].end=ed(yr(w),r),n),Kn(s,n[1].resourceIds=T?[T.id]:[],n)}}function D(){b&&(I=xm(b),E())}function R(A){JC(A)&&(v=A.clientY,E())}function N(){Kn(s,n[1]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent"},n)}function M(){y=b=Kn(s,n[1]=null,n)}return t.$$.update=()=>{t.$$.dirty&512&&n[0]&&M()},[D,s,c,d,p,R,S,U,P,n]}class Wlt extends vl{constructor(e){super(),gl(this,e,qlt,zlt,Es,{enterTimeGrid:6,enterDayGrid:7,leave:8,handleScroll:0})}get enterTimeGrid(){return this.$$.ctx[6]}get enterDayGrid(){return this.$$.ctx[7]}get leave(){return this.$$.ctx[8]}get handleScroll(){return this.$$.ctx[0]}}function fQ(t){let e,i,n,r;return{c(){e=wn("div"),tt(e,"class",i=t[1].resizer)},m(a,o){En(a,e,o),n||(r=dn(e,"pointerdown",t[8]),n=!0)},p(a,o){o&2&&i!==(i=a[1].resizer)&&tt(e,"class",i)},d(a){a&&Un(e),n=!1,r()}}}function Klt(t){let e,i=t[0]&&fQ(t);return{c(){i&&i.c(),e=yf()},m(n,r){i&&i.m(n,r),En(n,e,r)},p(n,[r]){n[0]?i?i.p(n,r):(i=fQ(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Mr,o:Mr,d(n){n&&Un(e),i&&i.d(n)}}}function Ylt(t,e,i){let n,r,a,{event:o}=e,{theme:s,eventDurationEditable:l,editable:u}=lu("state");Ge(t,s,p=>i(1,a=p)),Ge(t,l,p=>i(7,r=p)),Ge(t,u,p=>i(6,n=p));let c;function d(p){Qx.call(this,t,p)}return t.$$set=p=>{"event"in p&&i(5,o=p.event)},t.$$.update=()=>{t.$$.dirty&224&&i(0,c=!C8(o.display)&&!o0(o.display)&&((o.durationEditable??r)||(o.editable??n)))},[c,a,s,l,u,o,n,r,d]}class Zlt extends vl{constructor(e){super(),gl(this,e,Ylt,Klt,Es,{event:5})}}function hQ(t){let e,i,n={};return e=new Wlt({props:n}),t[16](e),{c(){ka(e.$$.fragment)},m(r,a){wa(e,r,a),i=!0},p(r,a){const o={};e.$set(o)},i(r){i||(zt(e.$$.fragment,r),i=!0)},o(r){Pi(e.$$.fragment,r),i=!1},d(r){t[16](null),sa(e,r)}}}function Xlt(t){let e,i,n,r,a={};e=new Hlt({props:a}),t[15](e);let o=t[1]&&hQ(t);return{c(){ka(e.$$.fragment),i=xs(),o&&o.c(),n=yf()},m(s,l){wa(e,s,l),En(s,i,l),o&&o.m(s,l),En(s,n,l),r=!0},p(s,[l]){const u={};e.$set(u),s[1]?o?(o.p(s,l),l&2&&zt(o,1)):(o=hQ(s),o.c(),zt(o,1),o.m(n.parentNode,n)):o&&(js(),Pi(o,1,1,()=>{o=null}),Gs())},i(s){r||(zt(e.$$.fragment,s),zt(o),r=!0)},o(s){Pi(e.$$.fragment,s),Pi(o),r=!1},d(s){s&&(Un(i),Un(n)),t[15](null),sa(e,s),o&&o.d(s)}}}function Jlt(t,e,i){let n,r,a,o,s,l,u,c,{theme:d,editable:p,eventStartEditable:f,eventDurationEditable:h,pointer:m,_bodyEl:g,_interaction:v,_iClasses:y,_draggable:b}=lu("state");Ge(t,d,S=>i(11,a=S)),Ge(t,p,S=>i(13,l=S)),Ge(t,f,S=>i(14,u=S)),Ge(t,m,S=>i(1,c=S)),Ge(t,g,S=>i(10,r=S)),Ge(t,v,S=>i(0,n=S)),Ge(t,y,S=>i(17,s=S)),Ge(t,b,S=>i(12,o=S)),Kn(v,n.resizer=Zlt,n);function I(){var S;for(let U of Object.values(n))(S=U==null?void 0:U.handleScroll)==null||S.call(U)}function T(S){Gp[S?"unshift":"push"](()=>{n.action=S,v.set(n)})}function w(S){Gp[S?"unshift":"push"](()=>{n.pointer=S,v.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&Kn(b,o=S=>(S.startEditable??u)||(S.editable??l),o),t.$$.dirty&6144&&Kn(y,s=(S,U)=>{let{display:P}=U;return o0(P)?[a[P]]:!C8(P)&&o(U)?[a.draggable]:[]},s),t.$$.dirty&1024&&r&&dn(r,"scroll",I)},[n,c,d,p,f,m,g,v,y,b,r,a,o,l,u,T,w]}class Qlt extends vl{constructor(e){super(),gl(this,e,Jlt,Xlt,Es,{})}}var eut={createOptions(t){t.dateClick=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.select=void 0,t.selectBackgroundColor=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=$a(Mr),t._auxiliary.update(e=>[...e,Qlt])}};function tut(t){return $d([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],a=yr(e),o=7;for(;a.getUTCDay()!==i&&o;)a0(a),--o;for(let s=0;s<7;++s)n.includes(a.getUTCDay())||r.push(yr(a)),gg(a);return r})}function mQ(t,e,i){const n=t.slice();return n[8]=e[i],n}function gQ(t){let e,i,n,r,a,o,s,l;return{c(){var u;e=wn("div"),i=wn("span"),a=xs(),tt(i,"aria-label",n=t[2].format(t[8])),tt(e,"class",o=t[0].day+" "+((u=t[0].weekdays)==null?void 0:u[t[8].getUTCDay()])),tt(e,"role","columnheader")},m(u,c){En(u,e,c),Qn(e,i),Qn(e,a),s||(l=Ry(r=NS.call(null,i,t[3].format(t[8]))),s=!0)},p(u,c){var d;t=u,c&6&&n!==(n=t[2].format(t[8]))&&tt(i,"aria-label",n),r&&ki(r.update)&&c&10&&r.update.call(null,t[3].format(t[8])),c&3&&o!==(o=t[0].day+" "+((d=t[0].weekdays)==null?void 0:d[t[8].getUTCDay()]))&&tt(e,"class",o)},d(u){u&&Un(e),s=!1,l()}}}function iut(t){let e,i,n,r,a,o,s,l=_o(t[1]),u=[];for(let c=0;c<l.length;c+=1)u[c]=gQ(mQ(t,l,c));return{c(){e=wn("div"),i=wn("div");for(let c=0;c<u.length;c+=1)u[c].c();r=xs(),a=wn("div"),tt(i,"class",n=t[0].days),tt(i,"role","row"),tt(a,"class",o=t[0].hiddenScroll),tt(e,"class",s=t[0].header)},m(c,d){En(c,e,d),Qn(e,i);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(i,null);Qn(e,r),Qn(e,a)},p(c,[d]){if(d&15){l=_o(c[1]);let p;for(p=0;p<l.length;p+=1){const f=mQ(c,l,p);u[p]?u[p].p(f,d):(u[p]=gQ(f),u[p].c(),u[p].m(i,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=l.length}d&1&&n!==(n=c[0].days)&&tt(i,"class",n),d&1&&o!==(o=c[0].hiddenScroll)&&tt(a,"class",o),d&1&&s!==(s=c[0].header)&&tt(e,"class",s)},i:Mr,o:Mr,d(c){c&&Un(e),Lb(u,c)}}}function nut(t,e,i){let n,r,a,o,{theme:s,_intlDayHeader:l,_intlDayHeaderAL:u,_days:c}=lu("state");return Ge(t,s,d=>i(0,n=d)),Ge(t,l,d=>i(3,o=d)),Ge(t,u,d=>i(2,a=d)),Ge(t,c,d=>i(1,r=d)),[n,r,a,o,s,l,u,c]}class rut extends vl{constructor(e){super(),gl(this,e,nut,iut,Es,{})}}function aut(t){let e,i,n,r,a;const o=t[7].default,s=Est(o,t,t[6],null);return{c(){e=wn("div"),i=wn("div"),s&&s.c(),tt(i,"class",n=t[0].content),tt(e,"class",r=t[0].body+(t[1]===!0?" "+t[0].uniform:""))},m(l,u){En(l,e,u),Qn(e,i),s&&s.m(i,null),t[8](e),a=!0},p(l,[u]){s&&s.p&&(!a||u&64)&&Rst(s,o,l,l[6],a?Cst(o,l[6],u,null):Mst(l[6]),null),(!a||u&1&&n!==(n=l[0].content))&&tt(i,"class",n),(!a||u&3&&r!==(r=l[0].body+(l[1]===!0?" "+l[0].uniform:"")))&&tt(e,"class",r)},i(l){a||(zt(s,l),a=!0)},o(l){Pi(s,l),a=!1},d(l){l&&Un(e),s&&s.d(l),t[8](null)}}}function out(t,e,i){let n,r,a,{$$slots:o={},$$scope:s}=e,{dayMaxEvents:l,_bodyEl:u,theme:c}=lu("state");Ge(t,l,p=>i(1,r=p)),Ge(t,u,p=>i(2,a=p)),Ge(t,c,p=>i(0,n=p));function d(p){Gp[p?"unshift":"push"](()=>{a=p,u.set(a)})}return t.$$set=p=>{"$$scope"in p&&i(6,s=p.$$scope)},[n,r,a,l,u,c,s,o,d]}class sut extends vl{constructor(e){super(),gl(this,e,out,aut,Es,{})}}function lut(t){let e,i,n,r,a,o,s,l,u,c,d;var p=t[8].resizer;function f(h,m){return{props:{event:h[0]}}}return p&&(o=r0(p,f(t)),o.$on("pointerdown",function(){ki(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)})),{c(){e=wn("article"),i=wn("div"),a=xs(),o&&ka(o.$$.fragment),tt(i,"class",n=t[2].eventBody),tt(e,"class",t[4]),tt(e,"style",t[5]),tt(e,"role",s=t[7]?"button":void 0),tt(e,"tabindex",l=t[7]?0:void 0)},m(h,m){En(h,e,m),Qn(e,i),Qn(e,a),o&&wa(o,e,null),t[52](e),u=!0,c||(d=[Ry(r=NS.call(null,i,t[6])),dn(e,"click",function(){ki(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),dn(e,"keydown",function(){ki(t[7]&&SA(t[7]))&&(t[7]&&SA(t[7])).apply(this,arguments)}),dn(e,"mouseenter",function(){ki(t[32](t[9],t[1]))&&t[32](t[9],t[1]).apply(this,arguments)}),dn(e,"mouseleave",function(){ki(t[32](t[10],t[1]))&&t[32](t[10],t[1]).apply(this,arguments)}),dn(e,"pointerdown",function(){ki(!o0(t[1])&&t[33](t[8]))&&(!o0(t[1])&&t[33](t[8])).apply(this,arguments)})],c=!0)},p(h,m){if(t=h,(!u||m[0]&4&&n!==(n=t[2].eventBody))&&tt(i,"class",n),r&&ki(r.update)&&m[0]&64&&r.update.call(null,t[6]),m[0]&256&&p!==(p=t[8].resizer)){if(o){js();const g=o;Pi(g.$$.fragment,1,0,()=>{sa(g,1)}),Gs()}p?(o=r0(p,f(t)),o.$on("pointerdown",function(){ki(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)}),ka(o.$$.fragment),zt(o.$$.fragment,1),wa(o,e,null)):o=null}else if(p){const g={};m[0]&1&&(g.event=t[0]),o.$set(g)}(!u||m[0]&16)&&tt(e,"class",t[4]),(!u||m[0]&32)&&tt(e,"style",t[5]),(!u||m[0]&128&&s!==(s=t[7]?"button":void 0))&&tt(e,"role",s),(!u||m[0]&128&&l!==(l=t[7]?0:void 0))&&tt(e,"tabindex",l)},i(h){u||(o&&zt(o.$$.fragment,h),u=!0)},o(h){o&&Pi(o.$$.fragment,h),u=!1},d(h){h&&Un(e),o&&sa(o),t[52](null),c=!1,ml(d)}}}function uut(t,e,i){let n,r,a,o,s,l,u,c,d,p,f,h,m,g,v,y,b,I,T,w,S,{chunk:U}=e,{longChunks:P={}}=e,{inPopup:E=!1}=e,{dayMaxEvents:D,displayEventEnd:R,eventAllUpdated:N,eventBackgroundColor:M,eventTextColor:A,eventClick:_,eventColor:k,eventContent:B,eventClassNames:F,eventDidMount:x,eventMouseEnter:$,eventMouseLeave:j,theme:V,_view:H,_intlEventTime:z,_interaction:q,_iClasses:W,_resBgColor:Y,_resTxtColor:Z,_hiddenEvents:X,_popupDate:Q,_tasks:ce}=lu("state");Ge(t,D,be=>i(55,a=be)),Ge(t,R,be=>i(44,h=be)),Ge(t,N,be=>i(57,u=be)),Ge(t,M,be=>i(50,I=be)),Ge(t,A,be=>i(47,v=be)),Ge(t,_,be=>i(40,n=be)),Ge(t,k,be=>i(49,b=be)),Ge(t,B,be=>i(43,f=be)),Ge(t,F,be=>i(45,m=be)),Ge(t,x,be=>i(58,c=be)),Ge(t,$,be=>i(9,w=be)),Ge(t,j,be=>i(10,S=be)),Ge(t,V,be=>i(2,p=be)),Ge(t,H,be=>i(41,l=be)),Ge(t,z,be=>i(42,d=be)),Ge(t,q,be=>i(8,s=be)),Ge(t,W,be=>i(46,g=be)),Ge(t,Y,be=>i(51,T=be)),Ge(t,Z,be=>i(48,y=be)),Ge(t,X,be=>i(54,r=be)),Ge(t,Q,be=>i(56,o=be));let J,ee,ne,ie,oe,se,pe=1,fe=!1,ge,me;kst(()=>{ki(c)&&c({event:Zc(ee),timeText:se,el:J,view:bu(l)})}),yUe(()=>{ki(u)&&!o0(ge)&&EUe(()=>u({view:bu(l)}),"eau",ce)});function Ee(be,Le){return!o0(Le)&&ki(be)?Me=>be({event:Zc(ee),el:J,jsEvent:Me,view:bu(l)}):void 0}function Be(be,Le){return be.action?Me=>s.action.drag(ee,Me,Le,E?o:void 0):void 0}function Pe(){J&&(i(38,pe=tlt(U,P,ZC(J))),a===!0?et():i(39,fe=!1))}function et(){let be=N1(J,2),Le=ZC(be)-ZC(be.firstElementChild)-Ie(be);i(39,fe=U.bottom>Le);let Me=!1;for(let Ze of U.dates){let qe=r[Ze.getTime()];if(qe){let ye=qe.size;fe?qe.add(U.event):qe.delete(U.event),ye!==qe.size&&(Me=!0)}}Me&&X.set(r)}function Ie(be){let Le=0;for(let Me=0;Me<U.days&&(Le=CI(Le,ZC(be.lastElementChild)),be=be.nextElementSibling,!!be);++Me);return Le}function Ne(be){Gp[be?"unshift":"push"](()=>{J=be,i(3,J)})}return t.$$set=be=>{"chunk"in be&&i(34,U=be.chunk),"longChunks"in be&&i(35,P=be.longChunks),"inPopup"in be&&i(36,E=be.inPopup)},t.$$.update=()=>{if(t.$$.dirty[1]&8&&i(0,ee=U.event),t.$$.dirty[0]&37|t.$$.dirty[1]&2082184){i(1,ge=ee.display);let be=ee.backgroundColor||T(ee)||I||b,Le=ee.textColor||y(ee)||v;i(5,ie=`width:calc(${U.days*100}% + ${(U.days-1)*7}px);margin-top:${pe}px;`),be&&i(5,ie+=`background-color:${be};`),Le&&i(5,ie+=`color:${Le};`),fe&&i(5,ie+="visibility:hidden;"),i(4,ne=[p.event,...g([],ee),...elt(m,ee,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15368&&i(6,[se,oe]=Qst(U,h,f,p,d,l),oe),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,me=Ee(n,ge))},[ee,ge,p,J,ne,ie,oe,me,s,w,S,D,R,N,M,A,_,k,B,F,x,$,j,V,H,z,q,W,Y,Z,X,Q,Ee,Be,U,P,E,Pe,pe,fe,n,l,d,f,h,m,g,v,y,b,I,T,Ne]}let eL=class extends vl{constructor(e){super(),gl(this,e,uut,lut,Es,{chunk:34,longChunks:35,inPopup:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function vQ(t,e,i){const n=t.slice();return n[20]=e[i],n}function yQ(t,e){let i,n,r;return n=new eL({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=yf(),ka(n.$$.fragment),this.first=i},m(a,o){En(a,i,o),wa(n,a,o),r=!0},p(a,o){e=a;const s={};o&1&&(s.chunk=e[20]),n.$set(s)},i(a){r||(zt(n.$$.fragment,a),r=!0)},o(a){Pi(n.$$.fragment,a),r=!1},d(a){a&&Un(i),sa(n,a)}}}function cut(t){let e,i,n,r,a,o,s,l,u,c,d,p,f=[],h=new Map,m,g,v,y,b,I=_o(t[0]);const T=w=>w[20].event;for(let w=0;w<I.length;w+=1){let S=vQ(t,I,w),U=T(S);h.set(U,f[w]=yQ(U,S))}return{c(){e=wn("div"),i=wn("div"),n=wn("time"),o=xs(),s=wn("a"),l=jE(""),d=xs(),p=wn("div");for(let w=0;w<f.length;w+=1)f[w].c();tt(n,"datetime",r=pc(t[3],10)),tt(s,"role","button"),tt(s,"tabindex","0"),tt(s,"aria-label",u=t[6].close),tt(i,"class",c=t[4].dayHead),tt(p,"class",m=t[4].events),tt(e,"class",g=t[4].popup),tt(e,"style",t[2])},m(w,S){En(w,e,S),Qn(e,i),Qn(i,n),Qn(i,o),Qn(i,s),Qn(s,l),Qn(e,d),Qn(e,p);for(let U=0;U<f.length;U+=1)f[U]&&f[U].m(p,null);t[16](e),v=!0,y||(b=[Ry(a=NS.call(null,n,t[5].format(t[3]))),dn(s,"click",wA(t[13])),dn(s,"keydown",SA(t[13])),Ry(Bst.call(null,e,"pointerdown")),dn(e,"pointerdown",wA(t[15])),dn(e,"pointerdownoutside",t[14])],y=!0)},p(w,[S]){(!v||S&8&&r!==(r=pc(w[3],10)))&&tt(n,"datetime",r),a&&ki(a.update)&&S&40&&a.update.call(null,w[5].format(w[3])),(!v||S&64&&u!==(u=w[6].close))&&tt(s,"aria-label",u),(!v||S&16&&c!==(c=w[4].dayHead))&&tt(i,"class",c),S&1&&(I=_o(w[0]),js(),f=TUe(f,S,T,1,w,I,h,p,SUe,yQ,null,vQ),Gs()),(!v||S&16&&m!==(m=w[4].events))&&tt(p,"class",m),(!v||S&16&&g!==(g=w[4].popup))&&tt(e,"class",g),(!v||S&4)&&tt(e,"style",w[2])},i(w){if(!v){for(let S=0;S<I.length;S+=1)zt(f[S]);v=!0}},o(w){for(let S=0;S<f.length;S+=1)Pi(f[S]);v=!1},d(w){w&&Un(e);for(let S=0;S<f.length;S+=1)f[S].d();t[16](null),y=!1,ml(b)}}}function dut(t,e,i){let n,r,a,o,s,l,{buttonText:u,theme:c,_interaction:d,_intlDayPopover:p,_popupDate:f,_popupChunks:h}=lu("state");Ge(t,u,S=>i(6,l=S)),Ge(t,c,S=>i(4,o=S)),Ge(t,d,S=>i(17,n=S)),Ge(t,p,S=>i(5,s=S)),Ge(t,f,S=>i(3,r=S)),Ge(t,h,S=>i(0,a=S));let m,g="";function v(){let S=N1(m,1),U=N1(S,3),P=xm(m),E=xm(S),D=xm(U);i(2,g="");let R;if(P.width>=D.width){R=D.left-E.left;let M=E.right-D.right;i(2,g+=`right:${M}px;`)}else R=(E.width-P.width)/2,E.left+R<D.left?R=D.left-E.left:E.left+R+P.width>D.right&&(R=D.right-E.left-P.width);i(2,g+=`left:${R}px;`);let N;if(P.height>=D.height){N=D.top-E.top;let M=E.bottom-D.bottom;i(2,g+=`bottom:${M}px;`)}else N=(E.height-P.height)/2,E.top+N<D.top?N=D.top-E.top:E.top+N+P.height>D.bottom&&(N=D.bottom-E.top-P.height);i(2,g+=`top:${N}px;`)}function y(){m&&(i(2,g=""),D8().then(()=>{a.length?v():b()}))}function b(S){Kn(f,r=null,r)}function I(S){var U;b(),(U=n.action)==null||U.noClick()}function T(S){Qx.call(this,t,S)}function w(S){Gp[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,r,o,s,l,u,c,d,p,f,h,b,I,T,w]}class put extends vl{constructor(e){super(),gl(this,e,dut,cut,Es,{})}}function bQ(t,e,i){const n=t.slice();return n[42]=e[i],n[43]=e,n[44]=i,n}function IQ(t){let e,i,n,r;return i=new eL({props:{chunk:t[2][1]}}),{c(){e=wn("div"),ka(i.$$.fragment),tt(e,"class",n=t[12].events)},m(a,o){En(a,e,o),wa(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][1]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events))&&tt(e,"class",n)},i(a){r||(zt(i.$$.fragment,a),r=!0)},o(a){Pi(i.$$.fragment,a),r=!1},d(a){a&&Un(e),sa(i)}}}function wQ(t){let e,i,n,r;return i=new eL({props:{chunk:t[2][0]}}),{c(){e=wn("div"),ka(i.$$.fragment),tt(e,"class",n=t[12].events+" "+t[12].preview)},m(a,o){En(a,e,o),wa(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][0]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events+" "+a[12].preview))&&tt(e,"class",n)},i(a){r||(zt(i.$$.fragment,a),r=!0)},o(a){Pi(i.$$.fragment,a),r=!1},d(a){a&&Un(e),sa(i)}}}function SQ(t,e){let i,n,r=e[44],a;const o=()=>e[36](n,r),s=()=>e[36](null,r);let l={chunk:e[42],longChunks:e[1]};return n=new eL({props:l}),o(),{key:t,first:null,c(){i=yf(),ka(n.$$.fragment),this.first=i},m(u,c){En(u,i,c),wa(n,u,c),a=!0},p(u,c){e=u,r!==e[44]&&(s(),r=e[44],o());const d={};c[0]&16&&(d.chunk=e[42]),c[0]&2&&(d.longChunks=e[1]),n.$set(d)},i(u){a||(zt(n.$$.fragment,u),a=!0)},o(u){Pi(n.$$.fragment,u),a=!1},d(u){u&&Un(i),s(),sa(n,u)}}}function TQ(t){let e,i;return e=new put({}),{c(){ka(e.$$.fragment)},m(n,r){wa(e,n,r),i=!0},i(n){i||(zt(e.$$.fragment,n),i=!0)},o(n){Pi(e.$$.fragment,n),i=!1},d(n){sa(e,n)}}}function UQ(t){let e,i,n,r;return{c(){e=wn("a"),tt(e,"role","button"),tt(e,"tabindex","0"),tt(e,"aria-haspopup","true")},m(a,o){En(a,e,o),n||(r=[dn(e,"click",wA(t[26])),dn(e,"keydown",SA(t[26])),dn(e,"pointerdown",wA(t[35])),Ry(i=NS.call(null,e,t[10]))],n=!0)},p(a,o){i&&ki(i.update)&&o[0]&1024&&i.update.call(null,a[10])},d(a){a&&Un(e),n=!1,ml(r)}}}function fut(t){let e,i,n,r,a,o,s=t[2][1]&&sp(t[2][1].date,t[0]),l,u=t[2][0]&&sp(t[2][0].date,t[0]),c,d,p=[],f=new Map,h,m,g,v,y,b,I,T,w,S=s&&IQ(t),U=u&&wQ(t),P=_o(t[4]);const E=N=>N[42].event;for(let N=0;N<P.length;N+=1){let M=bQ(t,P,N),A=E(M);f.set(A,p[N]=SQ(A,M))}let D=t[6]&&TQ(),R=t[5].size&&UQ(t);return{c(){var N;e=wn("div"),i=wn("time"),o=xs(),S&&S.c(),l=xs(),U&&U.c(),c=xs(),d=wn("div");for(let M=0;M<p.length;M+=1)p[M].c();m=xs(),D&&D.c(),g=xs(),v=wn("div"),R&&R.c(),tt(i,"class",n=t[12].dayHead),tt(i,"datetime",r=pc(t[0],10)),tt(d,"class",h=t[12].events),tt(v,"class",y=t[12].dayFoot),tt(e,"class",b=t[12].day+" "+((N=t[12].weekdays)==null?void 0:N[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")),tt(e,"role","cell")},m(N,M){En(N,e,M),Qn(e,i),Qn(e,o),S&&S.m(e,null),Qn(e,l),U&&U.m(e,null),Qn(e,c),Qn(e,d);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(d,null);Qn(e,m),D&&D.m(e,null),Qn(e,g),Qn(e,v),R&&R.m(v,null),t[37](e),I=!0,T||(w=[Ry(a=NS.call(null,i,t[14].format(t[0]))),dn(e,"pointerenter",function(){ki(t[25](t[13]))&&t[25](t[13]).apply(this,arguments)}),dn(e,"pointerleave",function(){var A,_;ki((A=t[13].pointer)==null?void 0:A.leave)&&((_=t[13].pointer)==null||_.leave.apply(this,arguments))}),dn(e,"pointerdown",function(){var A,_;ki((A=t[13].action)==null?void 0:A.select)&&((_=t[13].action)==null||_.select.apply(this,arguments))})],T=!0)},p(N,M){var A;t=N,(!I||M[0]&4096&&n!==(n=t[12].dayHead))&&tt(i,"class",n),(!I||M[0]&1&&r!==(r=pc(t[0],10)))&&tt(i,"datetime",r),a&&ki(a.update)&&M[0]&16385&&a.update.call(null,t[14].format(t[0])),M[0]&5&&(s=t[2][1]&&sp(t[2][1].date,t[0])),s?S?(S.p(t,M),M[0]&5&&zt(S,1)):(S=IQ(t),S.c(),zt(S,1),S.m(e,l)):S&&(js(),Pi(S,1,1,()=>{S=null}),Gs()),M[0]&5&&(u=t[2][0]&&sp(t[2][0].date,t[0])),u?U?(U.p(t,M),M[0]&5&&zt(U,1)):(U=wQ(t),U.c(),zt(U,1),U.m(e,c)):U&&(js(),Pi(U,1,1,()=>{U=null}),Gs()),M[0]&2066&&(P=_o(t[4]),js(),p=TUe(p,M,E,1,t,P,f,d,SUe,SQ,null,bQ),Gs()),(!I||M[0]&4096&&h!==(h=t[12].events))&&tt(d,"class",h),t[6]?D?M[0]&64&&zt(D,1):(D=TQ(),D.c(),zt(D,1),D.m(e,g)):D&&(js(),Pi(D,1,1,()=>{D=null}),Gs()),t[5].size?R?R.p(t,M):(R=UQ(t),R.c(),R.m(v,null)):R&&(R.d(1),R=null),(!I||M[0]&4096&&y!==(y=t[12].dayFoot))&&tt(v,"class",y),(!I||M[0]&4993&&b!==(b=t[12].day+" "+((A=t[12].weekdays)==null?void 0:A[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")))&&tt(e,"class",b)},i(N){if(!I){zt(S),zt(U);for(let M=0;M<P.length;M+=1)zt(p[M]);zt(D),I=!0}},o(N){Pi(S),Pi(U);for(let M=0;M<p.length;M+=1)Pi(p[M]);Pi(D),I=!1},d(N){N&&Un(e),S&&S.d(),U&&U.d();for(let M=0;M<p.length;M+=1)p[M].d();D&&D.d(),R&&R.d(),t[37](null),T=!1,ml(w)}}}function hut(t,e,i){let n,r,a,o,s,l,u,c,d,p,{date:f}=e,{chunks:h}=e,{longChunks:m}=e,{iChunks:g=[]}=e,{date:v,dayMaxEvents:y,highlightedDates:b,moreLinkContent:I,theme:T,_hiddenEvents:w,_intlDayCell:S,_popupDate:U,_popupChunks:P,_today:E,_interaction:D,_queue:R}=lu("state");Ge(t,v,Z=>i(33,l=Z)),Ge(t,b,Z=>i(32,s=Z)),Ge(t,I,Z=>i(30,a=Z)),Ge(t,T,Z=>i(12,c=Z)),Ge(t,w,Z=>i(31,o=Z)),Ge(t,S,Z=>i(14,p=Z)),Ge(t,U,Z=>i(29,r=Z)),Ge(t,P,Z=>i(38,n=Z)),Ge(t,E,Z=>i(34,u=Z)),Ge(t,D,Z=>i(13,d=Z));let N,M,A,_,k,B=new Set,F="",x,$=[];function j(Z){return Z.pointer?X=>Z.pointer.enterDayGrid(f,X):void 0}function V(){Kn(U,r=f,r)}function H(){var Q;let Z=gg(yr(f)),X=M.concat(((Q=m[f.getTime()])==null?void 0:Q.chunks)||[]);Kn(P,n=X.map(ce=>Fb({},ce,RV(ce.event,f,Z),{days:1,dates:[f]})).sort((ce,J)=>ce.top-J.top),n)}function z(){MUe($,M)}function q(Z){Qx.call(this,t,Z)}function W(Z,X){Gp[Z?"unshift":"push"](()=>{$[X]=Z,i(11,$)})}function Y(Z){Gp[Z?"unshift":"push"](()=>{N=Z,i(3,N)})}return t.$$set=Z=>{"date"in Z&&i(0,f=Z.date),"chunks"in Z&&i(27,h=Z.chunks),"longChunks"in Z&&i(1,m=Z.longChunks),"iChunks"in Z&&i(2,g=Z.iChunks)},t.$$.update=()=>{if(t.$$.dirty[0]&134217777){i(4,M=[]),B.clear(),i(5,B),i(27,h),i(0,f),i(4,M);for(let Z of h)sp(Z.date,f)&&M.push(Z)}if(t.$$.dirty[0]&33&&Kn(w,o[f.getTime()]=B,o),t.$$.dirty[0]&1|t.$$.dirty[1]&8&&i(7,A=sp(f,u)),t.$$.dirty[0]&1|t.$$.dirty[1]&6&&(i(8,_=f.getUTCMonth()!==l.getUTCMonth()),i(9,k=s.some(Z=>sp(Z,f)))),t.$$.dirty[0]&1073741856|t.$$.dirty[1]&1&&o&&B.size){let Z="+"+B.size+" more";a?i(10,F=ki(a)?a({num:B.size,text:Z}):a):i(10,F=Z)}t.$$.dirty[0]&536870913&&i(6,x=r&&sp(f,r)),t.$$.dirty[0]&82&&x&&m&&M&&D8().then(H),t.$$.dirty[0]&9&&N&&Wst(N,()=>({allDay:!0,date:f,resource:void 0,dayEl:N}))},[f,m,g,N,M,B,x,A,_,k,F,$,c,d,p,v,b,I,T,w,S,U,P,E,D,j,V,h,z,r,a,o,s,l,u,q,W,Y]}class mut extends vl{constructor(e){super(),gl(this,e,hut,fut,Es,{date:0,chunks:27,longChunks:1,iChunks:2,reposition:28},null,[-1,-1])}get reposition(){return this.$$.ctx[28]}}function DQ(t,e,i){const n=t.slice();return n[21]=e[i],n[22]=e,n[23]=i,n}function PQ(t){let e,i=t[23],n;const r=()=>t[18](e,i),a=()=>t[18](null,i);let o={date:t[21],chunks:t[1],longChunks:t[2],iChunks:t[3]};return e=new mut({props:o}),r(),{c(){ka(e.$$.fragment)},m(s,l){wa(e,s,l),n=!0},p(s,l){i!==s[23]&&(a(),i=s[23],r());const u={};l&1&&(u.date=s[21]),l&2&&(u.chunks=s[1]),l&4&&(u.longChunks=s[2]),l&8&&(u.iChunks=s[3]),e.$set(u)},i(s){n||(zt(e.$$.fragment,s),n=!0)},o(s){Pi(e.$$.fragment,s),n=!1},d(s){a(),sa(e,s)}}}function gut(t){let e,i,n,r,a,o=_o(t[0]),s=[];for(let u=0;u<o.length;u+=1)s[u]=PQ(DQ(t,o,u));const l=u=>Pi(s[u],1,1,()=>{s[u]=null});return{c(){e=wn("div");for(let u=0;u<s.length;u+=1)s[u].c();tt(e,"class",i=t[5].days),tt(e,"role","row")},m(u,c){En(u,e,c);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(e,null);n=!0,r||(a=dn(window,"resize",t[11]),r=!0)},p(u,[c]){if(c&31){o=_o(u[0]);let d;for(d=0;d<o.length;d+=1){const p=DQ(u,o,d);s[d]?(s[d].p(p,c),zt(s[d],1)):(s[d]=PQ(p),s[d].c(),zt(s[d],1),s[d].m(e,null))}for(js(),d=o.length;d<s.length;d+=1)l(d);Gs()}(!n||c&32&&i!==(i=u[5].days))&&tt(e,"class",i)},i(u){if(!n){for(let c=0;c<o.length;c+=1)zt(s[c]);n=!0}},o(u){s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)Pi(s[c]);n=!1},d(u){u&&Un(e),Lb(s,u),r=!1,a()}}}function vut(t,e,i){let n,r,a,o,s,{dates:l}=e,{_events:u,_iEvents:c,_queue2:d,_hiddenEvents:p,hiddenDays:f,theme:h}=lu("state");Ge(t,u,U=>i(17,o=U)),Ge(t,c,U=>i(16,a=U)),Ge(t,p,U=>i(14,n=U)),Ge(t,f,U=>i(15,r=U)),Ge(t,h,U=>i(5,s=U));let m,g,v=[],y,b,I=[],T={};function w(){P8(()=>MUe(I,l),T,d)}function S(U,P){Gp[U?"unshift":"push"](()=>{I[P]=U,i(4,I)})}return t.$$set=U=>{"dates"in U&&i(0,l=U.dates)},t.$$.update=()=>{if(t.$$.dirty&1&&(i(12,y=l[0]),i(13,b=gg(yr(l[l.length-1])))),t.$$.dirty&176130){i(1,m=[]);for(let U of o)if(!C8(U.display)&&XJ(U,y,b)){let P=RV(U,y,b);m.push(P)}i(2,g=ZJ(m,r)),w()}t.$$.dirty&110592&&i(3,v=a.map(U=>{let P;return U&&XJ(U,y,b)?(P=RV(U,y,b),ZJ([P],r)):P=null,P})),t.$$.dirty&16384&&n&&w()},[l,m,g,v,I,s,u,c,p,f,h,w,y,b,n,r,a,o,S]}class yut extends vl{constructor(e){super(),gl(this,e,vut,gut,Es,{dates:0})}}function EQ(t,e,i){const n=t.slice();return n[10]=e[i],n}function CQ(t){let e,i;return e=new yut({props:{dates:t[10]}}),{c(){ka(e.$$.fragment)},m(n,r){wa(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.dates=n[10]),e.$set(a)},i(n){i||(zt(e.$$.fragment,n),i=!0)},o(n){Pi(e.$$.fragment,n),i=!1},d(n){sa(e,n)}}}function but(t){let e,i,n=_o(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=CQ(EQ(t,n,o));const a=o=>Pi(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=yf()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);En(o,e,s),i=!0},p(o,s){if(s&1){n=_o(o[0]);let l;for(l=0;l<n.length;l+=1){const u=EQ(o,n,l);r[l]?(r[l].p(u,s),zt(r[l],1)):(r[l]=CQ(u),r[l].c(),zt(r[l],1),r[l].m(e.parentNode,e))}for(js(),l=n.length;l<r.length;l+=1)a(l);Gs()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)zt(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Pi(r[s]);i=!1},d(o){o&&Un(e),Lb(r,o)}}}function Iut(t){let e,i,n,r;return e=new rut({}),n=new sut({props:{$$slots:{default:[but]},$$scope:{ctx:t}}}),{c(){ka(e.$$.fragment),i=xs(),ka(n.$$.fragment)},m(a,o){wa(e,a,o),En(a,i,o),wa(n,a,o),r=!0},p(a,[o]){const s={};o&8193&&(s.$$scope={dirty:o,ctx:a}),n.$set(s)},i(a){r||(zt(e.$$.fragment,a),zt(n.$$.fragment,a),r=!0)},o(a){Pi(e.$$.fragment,a),Pi(n.$$.fragment,a),r=!1},d(a){a&&Un(i),sa(e,a),sa(n,a)}}}function wut(t,e,i){let n,r,a,o,{_viewDates:s,_hiddenEvents:l,dayMaxEvents:u,hiddenDays:c}=lu("state");Ge(t,s,f=>i(6,n=f)),Ge(t,l,f=>i(9,a=f)),Ge(t,u,f=>i(7,r=f)),Ge(t,c,f=>i(8,o=f));let d,p;return t.$$.update=()=>{if(t.$$.dirty&481){i(0,d=[]),i(5,p=7-o.length),Kn(l,a={},a);for(let f=0;f<n.length/p;++f){let h=[];for(let m=0;m<p;++m)h.push(n[f*p+m]);d.push(h)}}},[d,s,l,u,c,p,n,r,o]}class Sut extends vl{constructor(e){super(),gl(this,e,wut,Iut,Es,{})}}var Tut={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.view="dayGridMonth",t.views.dayGridMonth={buttonText:alt,component:Sut,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:slt("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=tut(t),t._intlDayCell=tU(t.locale,t.dayCellFormat),t._intlDayPopover=tU(t.locale,t.dayPopoverFormat),t._hiddenEvents=$a({}),t._popupDate=$a(null),t._popupChunks=$a([])}};let tM;function Uut(){var i;const t=ol(),e=(i=t==null?void 0:t.provider)==null?void 0:i.organisationId;if(e){const n=r=>{r!=null&&r.calendar?n2(r.calendar):Ys.findAllTournaments().then(n2)};Ys.findProvider(e).then(n)}else Ys.findAllTournaments().then(n2)}function n2(t){const e=document.getElementById(Pk);return tM&&Oa(e),Aot(),tM=new $lt({target:e,props:{plugins:[Tut,eut],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:Put(t),eventClick:Dut,eventMouseEnter:Eut,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...JD,calendar:tM}}function Dut({event:t}){if(t.id){tM.destroy();const e=t.id;$e.reset();const i=`/${Ia}/${e}`;ze.router.navigate(i)}}function Put(t){const e=i=>i==null?void 0:i.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function Eut({event:t,jsEvent:e}){Sh(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var Cut=/([:*])(\w+)/g,Rut="([^/]+)",Mut=/\*/g,Nut="?(?:.*)",Aut=/\/\?/g,_ut="/?([^/]+|)",kut="(?:/^|^)",Out="";function AUe(t){return t===void 0&&(t="/"),M8()?location.pathname+location.search+location.hash:t}function na(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function UA(t){return typeof t=="string"}function xut(t){return typeof t=="function"}function DA(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function Lut(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function PA(t){var e=na(t).split(/\?(.*)?$/);return[na(e[0]),e.slice(1).join("")]}function R8(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var a=decodeURIComponent(r[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(r[1]||""))):e[a]=decodeURIComponent(r[1]||"")}}return e}function _Ue(t,e){var i=PA(na(t.currentLocationPath)),n=i[0],r=i[1],a=r===""?null:R8(r),o=[],s;if(UA(e.path)){if(s=kut+na(e.path).replace(Cut,function(d,p,f){return o.push(f),Rut}).replace(Mut,Nut).replace(Aut,_ut)+"$",na(e.path)===""&&na(n)==="")return{url:n,queryString:r,hashString:DA(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,Out),u=n.match(l);if(u){var c=UA(e.path)?Lut(u,o):u.groups?u.groups:u.slice(1);return{url:na(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:DA(t.to),route:e,data:c,params:a}}return!1}function kUe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Bb(t,e){return typeof t[e]>"u"||t[e]===!0}function Fut(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var a=r.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=a[1];break;case"resolveOptionsHash":n||(n={}),n.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),n&&(i.resolveOptions=n),i}function M8(){return typeof window<"u"}function But(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function lp(t,e,i){var n=e||{},r=0;(function a(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),a()):t[r](n,function(o){typeof o>"u"||o===!0?(r+=1,a()):i&&i(n)})})()}lp.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function RQ(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=AUe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function r2(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=_Ue(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function $ut(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function Vut(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var MQ=M8(),jut=kUe();function Gut(t,e){if(Bb(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=MQ&&t.resolveOptions&&t.resolveOptions.hash===!0;jut?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):MQ&&(window.location.href=t.to)}e()}function OUe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}lp(i.lastResolved().map(function(n){return function(r,a){if(!n.route.hooks||!n.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(u){return n.route.path===u.route.path}):!1;o=!l}if(Bb(t.navigateOptions,"callHooks")&&o){lp(n.route.hooks.leave.map(function(u){return function(c,d){return u(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function Hut(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Bb(t.navigateOptions,"callHooks")?lp(t.match.route.hooks.before.map(function(i){return function(r,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function zut(t,e){Bb(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function qut(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Bb(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function Wut(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&Bb(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function Kut(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=PA(t.currentLocationPath),r=n[0],a=n[1],o=DA(t.to);i.path=na(r);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?R8(a):null};t.matches=[s],t.match=s}e()}function Yut(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Zut(t,e){t.instance._setCurrent(null),e()}function xUe(t,e){Bb(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var LUe=[Wut,Hut,zut,qut],NQ=[OUe,Kut,lp.if(function(t){var e=t.notFoundHandled;return e},LUe.concat([xUe]),[Yut,Zut])];function AV(){return AV=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},AV.apply(this,arguments)}function AQ(t,e){var i=0;function n(){if(i===t.matches.length){xUe(t,e);return}lp(LUe,AV({},t,{match:t.matches[i]}),function(){i+=1,n()})}OUe(t,n)}function a2(t){t.instance.__markAsClean(t)}function _V(){return _V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},_V.apply(this,arguments)}var _Q="[data-navigo]";function Xut(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:_Q},n=this,r="/",a=null,o=[],s=!1,l,u=kUe(),c=M8();t?r=na(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(x){return x.indexOf("#")>=0&&(i.hash===!0?x=x.split("#")[1]||"/":x=x.split("#")[0]),x}function p(x){return na(r+"/"+na(x))}function f(x,$,j,V){return x=UA(x)?p(x):x,{name:V||na(String(x)),path:x,handler:$,hooks:But(j)}}function h(x,$,j){var V=this;return typeof x=="object"&&!(x instanceof RegExp)?(Object.keys(x).forEach(function(H){if(typeof x[H]=="function")V.on(H,x[H]);else{var z=x[H],q=z.uses,W=z.as,Y=z.hooks;o.push(f(H,q,[l,Y],W))}}),this):(typeof x=="function"&&(j=$,$=x,x=r),o.push(f(x,$,[l,j])),this)}function m(x,$){if(n.__dirty){n.__waiting.push(function(){return n.resolve(x,$)});return}else n.__dirty=!0;x=x?na(r)+"/"+na(x):void 0;var j={instance:n,to:x,currentLocationPath:x,navigateOptions:{},resolveOptions:_V({},i,$)};return lp([RQ,r2,lp.if(function(V){var H=V.matches;return H&&H.length>0},AQ,NQ)],j,a2),j.matches?j.matches:!1}function g(x,$){if(n.__dirty){n.__waiting.push(function(){return n.navigate(x,$)});return}else n.__dirty=!0;x=na(r)+"/"+na(x);var j={instance:n,to:x,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(x)};lp([$ut,Vut,r2,lp.if(function(V){var H=V.matches;return H&&H.length>0},AQ,NQ),Gut,a2],j,a2)}function v(x,$,j){var V=D(x,$);return V!==null?(g(V.replace(new RegExp("^/?"+r),""),j),!0):!1}function y(x){return this.routes=o=o.filter(function($){return UA(x)?na($.path)!==na(x):xut(x)?x!==$.handler:String($.path)!==String(x)}),this}function b(){u&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=o=[],u&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function T(x,$){return n._notFoundRoute=f("*",x,[l,$],"__NOT_FOUND__"),this}function w(){if(c)return S().forEach(function(x){if(x.getAttribute("data-navigo")==="false"||x.getAttribute("target")==="_blank"){x.hasListenerAttached&&x.removeEventListener("click",x.navigoHandler);return}x.hasListenerAttached||(x.hasListenerAttached=!0,x.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var j=x.getAttribute("href");if(typeof j>"u"||j===null)return!1;if(j.match(/^(http|https)/)&&typeof URL<"u")try{var V=new URL(j);j=V.pathname+V.search}catch{}var H=Fut(x.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),n.navigate(na(j),H))},x.addEventListener("click",x.navigoHandler))}),n}function S(){return c?[].slice.call(document.querySelectorAll(i.linksSelector||_Q)):[]}function U(x){return"/"+r+"/"+na(x)}function P(x){return l=x,this}function E(){return a}function D(x,$,j){var V=o.find(function(q){return q.name===x}),H=null;if(V){if(H=V.path,$)for(var z in $)H=H.replace(":"+z,$[z]);H=H.match(/^\//)?H:"/"+H}return H&&j&&!j.includeRoot&&(H=H.replace(new RegExp("^/"+r),"")),H}function R(x){return x.getAttribute("href")}function N(x){var $=PA(na(x)),j=$[0],V=$[1],H=V===""?null:R8(V),z=DA(x),q=f(j,function(){},[l],j);return{url:j,queryString:V,hashString:z,route:q,data:null,params:H}}function M(){return N(na(AUe(r)).replace(new RegExp("^"+r),""))}function A(x){var $={instance:n,currentLocationPath:x,to:x,navigateOptions:{},resolveOptions:i};return r2($,function(){}),$.matches?$.matches:!1}function _(x,$,j){typeof $<"u"&&(typeof j>"u"||j)&&($=p($));var V={instance:n,to:$,currentLocationPath:$};RQ(V,function(){}),typeof x=="string"&&(x=typeof j>"u"||j?p(x):x);var H=_Ue(V,{name:String(x),path:x,handler:function(){},hooks:{}});return H||!1}function k(x,$,j){return typeof $=="string"&&($=B($)),$?($.hooks[x]||($.hooks[x]=[]),$.hooks[x].push(j),function(){$.hooks[x]=$.hooks[x].filter(function(V){return V!==j})}):(console.warn("Route doesn't exists: "+$),function(){})}function B(x){return typeof x=="string"?o.find(function($){return $.name===p(x)}):o.find(function($){return $.handler===x})}function F(x){x.instance.__dirty=!1,x.instance.__waiting.length>0&&x.instance.__waiting.shift()()}this.root=r,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=h,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=T,this.updatePageLinks=w,this.link=U,this.hooks=P,this.extractGETParameters=function(x){return PA(d(x))},this.lastResolved=E,this.generate=D,this.getLinkPath=R,this.match=A,this.matchLocation=_,this.getCurrentLocation=M,this.addBeforeHook=k.bind(this,"before"),this.addAfterHook=k.bind(this,"after"),this.addAlreadyHook=k.bind(this,"already"),this.addLeaveHook=k.bind(this,"leave"),this.getRoute=B,this._pathToMatchObject=N,this._clean=na,this._checkForAHash=d,this._setCurrent=function(x){return a=n.current=x},b.call(this),w.call(this)}function Jut(){const e=new Xut("/",{hash:!0});ze.router=e;const i=({selectedTab:n,renderDraw:r,data:a})=>{xx(),_ot({config:{selectedTab:n,renderDraw:r,...a}})};return e.on(`/${Ia}/:tournamentId`,({data:n})=>{i({data:n})}),e.on(`/${Ia}/:tournamentId/overview`,({data:n})=>{i({data:n,selectedTab:H0})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId`,({data:n})=>{i({selectedTab:Yc,data:n})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId/${oT}/:drawId`,({data:n})=>{i({selectedTab:Yc,renderDraw:!0,data:n})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId/${oT}/:drawId/${sB}/:roundsView`,({data:n})=>{i({selectedTab:Yc,renderDraw:!0,data:n})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId/${oT}/:drawId/${oB}/:structureId`,({data:n})=>{i({selectedTab:Yc,renderDraw:!0,data:n})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId/${oT}/:drawId/${oB}/:structureId/${sB}/:roundsView`,({data:n})=>{i({selectedTab:Yc,renderDraw:!0,data:n})}),e.on(`/${Ia}/:tournamentId/${sv}/:eventId/${Pue}/:drawId`,({data:n})=>{i({selectedTab:Yc,data:n})}),e.on(`/${Ia}/:tournamentId/${Rp}/:participantView`,({data:n})=>{i({selectedTab:Rp,data:n})}),e.on(`/${Ia}/:tournamentId/${ry}/:scheduledDate`,({data:n})=>{i({selectedTab:ry,data:n})}),e.on(`/${Ia}/:tournamentId/:selectedTab`,({data:n})=>{i({data:n})}),e.on(`/${Cp}/:uuid`,VJ),e.on(`/${Cp}`,VJ),e.on(`/${Eue}/:inviteKey`,Sst),e.on("/calendar",Uut),e.on("/actionKey/:key",({data:n})=>{n.key,e.navigate("/"),XF()}),e.on("/",()=>{XF()}),e.notFound(()=>{e.navigate("/"),XF()}),e.resolve(),{success:!0}}function Qut(t){console.log({msg:t}),Ys.findTournament(t.tournamentId).then(e,i=>console.log({err:i}));function e(i){tA.call("tournamentAuthorization","tap",i),i&&t.tournament&&t.send_auth?yn({title:"Save tournament",content:`
        <div class="content">
          <p>Choose to keep the existing tournament or replace the local copy with the incoming tournament</p>
        </div>
        `,buttons:[{label:"Save Received",onClick:()=>n(t.tournament),close:!0},{label:"Keep Existing",onClick:()=>r(i),close:!0},{label:"Cancel",close:!0}]}):!i&&t.tournament?n(t.tournament):i?r(i):o(),t.referee_key&&ze.ee.emit("sendKey",t.referee_key),t.tournament_key&&ect(t.tournament_key,t.tuid);function n(s){let l=w6({data:s,maxTilde:5});l&&(ze.ee.emit("updateTournament",l),l.start&&(l.start=new Date(l.start).getTime()),l.end&&(l.end=new Date(l.end).getTime()),JN.addTournament(l).then(()=>r(l),o))}function r(s){t.inDB=!0,t.notice=`${s.name}`;let l=`${Lr.tr(t.title)}: ${t.notice}`,u=Rot("tournament")&&{text:Lr.tr("tournaments.edit"),onClick:a};Mt({intent:"is-success",message:l,action:u})}function a(){console.log("display tournament")}function o(){t.notice="Not Found in Calendar",ii.messages.push(t)}}}function ect(t,e){const i=()=>console.log("added tournament key");JN.findSetting("tournamentKeys").then(n,n);function n(r={key:"tournamentKeys",ring:[]}){var a;r.ring=r.ring.filter(o=>o.key!==t),t&&e&&(r.ring.push({key:t,tuid:e,ouid:(a=ii.org)==null?void 0:a.ouid}),JN.addSetting(r).then(i,i))}}function tct(){return new Promise((t,e)=>{oct();const i=()=>{ii.firstTimeUser=ii.firstTimeUser&&ze.ee.emit("sendKey","players")?!1:ii.firstTimeUser,t()};nct().then(i,e)})}const ict=t=>(...e)=>lUe()?t(...e):t(...e).catch(i=>console.log(i));function nct(){return new Promise((t,e)=>{new Promise((n,r)=>ict(Ys.initDB)().then(t,rct).then(n,r)).then(t,e)})}function rct(){ze.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function FUe(t){const e=r=>Object.keys(r).map(a=>r[a]).join(""),i=e(t);ii.messages.reduce((r,a)=>e(a)===i?!0:r,!1)||ii.messages.push(t)}function act(t){console.log({tmxMessage:t}),t.authorized&&(t.tuid||t.tournamentId)?Qut(t):(t.notice=t.notice||t.tournament,t.notice&&FUe(t))}function oct(){ze.ee.addListener(vYe,O0e),ze.ee.addListener("tmxMessage",act),ze.ee.addListener("addMessage",FUe)}function o2(){dct(),Kot(),lct(),Uxe(),AJ("login"),AJ("burger"),Bot("config"),ze.drawer=wst(),tct().then(sct,t=>console.log({err:t}))}function sct(){console.log("%c TMX ready","color: lightgreen"),nUe(),pct(),document.getElementById(NU).onclick=()=>ze.router.navigate(`/${Cp}`),Jut(),hot()}function lct(){ze.dragMatch=new Image,ze.dragMatch.src=qTe,ze.ee=new Wot}const uct="ResizeObserver loop limit exceeded",cct="ResizeObserver loop completed with undelivered notifications.";function dct(){ii.device=hct(),ii.version_check=new Date().getTime();const t=$e.version();console.log(`%cversion: ${k6}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),fct()}function pct(){const t=ao.topicConstants;RI.setSubscriptions({subscriptions:{[t.MODIFY_MATCHUP]:e=>{var n;const i=(n=e.matchUp)==null?void 0:n.matchUpId;ze.matchUpsToBroadcast.push(i),ii.devNotes&&console.log("MODIFY_MATCHUP",e)}}})}function fct(){window.addEventListener("error",t=>{if([uct,cct].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function hct(){let t=mct();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function mct(){try{return navigator||window.navigator}catch{return}}if(window.attachEvent)window.attachEvent("onload",o2);else if(window.onload){const t=window.onload,e=i=>{t(i),o2()};window.onload=e}else window.onload=o2;Sxe();Txe();
//# sourceMappingURL=index-JZsNFKRo.js.map
